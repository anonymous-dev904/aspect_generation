{"contents": ["STORM-3052:", "Allow", "for", "blobs", "to", "be", "unzipped/untarred"], "code_tokens": ["Utils", ".", "unpack", "(", "new", "File", "(", "downloadFile", ")", ",", "new", "File", "(", "localFileWithVersion", ")", ",", "(", "boolean", ")", "OR", "(", "_conf", ".", "get", "(", "Config", ".", "DISABLE_SYMLINKS", ")", ",", "false", ")", ");", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ")", "{", "extractZipFile", "(", "jar", ",", "toDir", ",", "null", ")", ";", "*", "@", "param", "symlinksDisabled", "true", "if", "symlinks", "should", "be", "disabled", ",", "else", "false", ".", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "ensureDirectory", "(", "untarDir", ")", ";", "if", "(", "Utils", ".", "isOnWindows", "(", ")", "|", "|", "symlinksDisabled", ")", "{", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ",", "symlinksDisabled", ")", ";", "boolean", "gzipped", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "final", "String", "base", "=", "untarDir", ".", "getCanonicalPath", "(", ");", "LOG", ".", "trace", "(", "\"", "java", "untar", "{", "}", "to", "{", "}\"", ",", "inFile", ",", "base", ")", ";", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ",", "base", ",", "symlinksDisabled", ")", ";", "TarArchiveEntry", "entry", ",", "File", "outputDir", ",", "final", "String", "base", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "File", "target", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "target", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "return", ";", "}", "LOG", ".", "trace", "(", "\"", "Extracting", "dir", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ")", ";", "unpackEntries", "(", "tis", ",", "e", ",", "target", ",", "base", ",", "symlinksDisabled", ")", ";", "}", "else", "if", "(", "entry", ".", "isSymbolicLink", "(", "))", "{", "if", "(", "symlinksDisabled", ")", "{", "LOG", ".", "info", "(", "\"", "Symlinks", "disabled", "skipping", "{", "}\"", ",", "target", ")", ";", "}", "else", "{", "Path", "src", "=", "target", ".", "toPath", "(", ");", "Path", "dest", "=", "Paths", ".", "get", "(", "entry", ".", "getLinkName", "(", "))", ";", "LOG", ".", "trace", "(", "\"", "Extracting", "sym", "link", "{", "}", "to", "{", "}\"", ",", "target", ",", "dest", ")", ";", "/", "/", "Create", "symbolic", "link", "relative", "to", "tar", "parent", "dir", "Files", ".", "createSymbolicLink", "(", "src", ",", "dest", ")", ";", "}", "}", "else", "if", "(", "entry", ".", "isFile", "(", "))", "{", "LOG", ".", "trace", "(", "\"", "Extracting", "file", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ".", "getParentFile", "(", "))", ";", "try", "(", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "target", ")", "))", "{", "IOUtils", ".", "copy", "(", "tis", ",", "outputStream", ")", ";", "}", "}", "else", "{", "LOG", ".", "error", "(", "\"{", "}", "is", "not", "a", "currently", "supported", "tar", "entry", "type", ".", "\",", "entry", ")", ";", "Path", "p", "=", "target", ".", "toPath", "(", ");", "if", "(", "Files", ".", "exists", "(", "p", ")", ")", "{", "try", "{", "/", "/", "We", "created", "it", "so", "lets", "chmod", "it", "properly", "int", "mode", "=", "entry", ".", "getMode", "(", ");", "Files", ".", "setPosixFilePermissions", "(", "p", ",", "parsePerms", "(", "mode", ")", ");", "}", "catch", "(", "UnsupportedOperationException", "e", ")", "{", "/", "/", "Ignored", "the", "file", "system", "we", "are", "on", "does", "not", "support", "this", ",", "so", "don", "'", "t", "do", "it", ".", "}", "private", "static", "Set", "<", "PosixFilePermission", ">", "parsePerms", "(", "int", "mode", ")", "{", "Set", "<", "PosixFilePermission", ">", "ret", "=", "new", "HashSet", "<", ">(", ");", "if", "(", "(", "mode", "&", "0001", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0002", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0004", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0010", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_EXECUTE", ")", ";", "if", "(", "(", "mode", "&", "0020", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0040", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0100", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0200", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0400", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_READ", ")", ";", "}", "return", "ret", ";", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ",", "boolean", "symLinksDisabled", ")", "throws", "IOException", "{", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_jar", "\"", "))", "{", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_zip", "\"", "))", "{", "lowerDst", ".", "endsWith", "(", "\"", "_tar_gz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ",", "symLinksDisabled", ")", ";", "private", "static", "void", "extractZipFile", "(", "ZipFile", "zipFile", ",", "File", "toDir", ",", "String", "prefix", ")", "throws", "IOException", "{", "ensureDirectory", "(", "toDir", ")", ";", "final", "String", "base", "=", "toDir", ".", "getCanonicalPath", "(", ");", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "if", "(", "prefix", "!", "=", "null", "&", "&", "!", "entry", ".", "getName", "(", ").", "startsWith", "(", "prefix", ")", ")", "{", "/", "/", "No", "need", "to", "extract", "it", ",", "it", "is", "not", "what", "we", "are", "looking", "for", ".", "continue", ";", "}", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "file", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "continue", ";", "}", "try", "(", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "try", "(", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}", "}", "}", "*", "@", "param", "toDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ")", "{", "extractZipFile", "(", "zipFile", ",", "toDir", ",", "null", ")", ";", "}", "extractZipFile", "(", "jarFile", ",", "destdir", ",", "dir", ")", ";</s>Utils", ".", "unpack", "(", "new", "File", "(", "downloadFile", ")", ",", "new", "File", "(", "localFileWithVersion", ")", ");", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ";", "try", "{", "Enumeration", "<", "JarEntry", ">", "entries", "=", "jar", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "final", "JarEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "jar", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "copyBytes", "(", "in", ",", "out", ",", "8192", ")", ";", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "jar", ".", "close", "(", ");", "}", "}", "/", "**", "*", "Copies", "from", "one", "stream", "to", "another", ".", "*", "*", "@", "param", "in", "InputStream", "to", "read", "from", "*", "@", "param", "out", "OutputStream", "to", "write", "to", "*", "@", "param", "buffSize", "the", "size", "of", "the", "buffer", "*", "/", "public", "static", "void", "copyBytes", "(", "InputStream", "in", ",", "OutputStream", "out", ",", "int", "buffSize", ")", "throws", "IOException", "{", "PrintStream", "ps", "=", "out", "instanceof", "PrintStream", "?", "(", "PrintStream", ")", "out", ":", "null", ";", "byte", "buf", "[", "]", "=", "new", "byte", "[", "buffSize", "]", ";", "int", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "while", "(", "bytesRead", ">", "=", "0", ")", "{", "out", ".", "write", "(", "buf", ",", "0", ",", "bytesRead", ")", ";", "if", "(", "(", "ps", "!", "=", "null", ")", "&", "&", "ps", ".", "checkError", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "write", "to", "output", "stream", ".", "\")", ";", "}", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ")", "throws", "IOException", "{", "if", "(", "!", "untarDir", ".", "mkdirs", "(", "))", "{", "if", "(", "!", "untarDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "untarDir", ")", ";", "}", "}", "if", "(", "isOnWindows", "(", "))", "{", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ")", ";", "boolean", "gzipped", ")", "throws", "IOException", "{", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ")", ";", "TarArchiveEntry", "entry", ",", "File", "outputDir", ")", "throws", "IOException", "{", "File", "subDir", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "subDir", ".", "mkdirs", "(", ")", "&", "&", "!", "subDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "}", "unpackEntries", "(", "tis", ",", "e", ",", "subDir", ")", ";", "return", ";", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "exists", "(", "))", "{", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "int", "count", ";", "byte", "data", "[", "]", "=", "new", "byte", "[", "2048", "]", ";", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "outputFile", ")", ");", "while", "(", "(", "count", "=", "tis", ".", "read", "(", "data", ")", ")", "!", "=", "-", "1", ")", "{", "outputStream", ".", "write", "(", "data", ",", "0", ",", "count", ")", ";", "outputStream", ".", "flush", "(", ");", "outputStream", ".", "close", "(", ");", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ")", "throws", "IOException", "{", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", "))", "{", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", "))", "{", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ")", ";", "*", "@", "param", "unzipDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "unzipDir", ")", "throws", "IOException", "{", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", ";", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ";", "try", "{", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "file", ".", "getParentFile", "(", ").", "toString", "(", "))", ";", "}", "}", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "8192", "]", ";", "int", "i", ";", "while", "(", "(", "i", "=", "in", ".", "read", "(", "buffer", ")", ")", "!", "=", "-", "1", ")", "{", "out", ".", "write", "(", "buffer", ",", "0", ",", "i", ")", ";", "}", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "zipFile", ".", "close", "(", ");", "}", "Enumeration", "<", "JarEntry", ">", "jarEnums", "=", "jarFile", ".", "entries", "(", ");", "while", "(", "jarEnums", ".", "hasMoreElements", "(", "))", "{", "JarEntry", "entry", "=", "jarEnums", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", ")", "&", "&", "entry", ".", "getName", "(", ").", "startsWith", "(", "dir", ")", ")", "{", "File", "aFile", "=", "new", "File", "(", "destdir", ",", "entry", ".", "getName", "(", "))", ";", "aFile", ".", "getParentFile", "(", ").", "mkdirs", "(", ");", "try", "(", "FileOutputStream", "out", "=", "new", "FileOutputStream", "(", "aFile", ")", ";", "InputStream", "in", "=", "jarFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}"], "docstring_tokens": ["arbitrary", "file", "write"]}
{"contents": ["ALSA:", "seq:", "Make", "ioctls", "race-free", "The", "ALSA", "sequencer", "ioctls", "have", "no", "protection", "against", "racy", "calls", "while", "the", "concurrent", "operations", "may", "lead", "to", "interfere", "with", "each", "other.", "As", "reported", "recently,", "for", "example,", "the", "concurrent", "calls", "of", "setting", "client", "pool", "with", "a", "combination", "of", "write", "calls", "may", "lead", "to", "either", "the", "unkillable", "dead-lock", "or", "UAF.", "As", "a", "slightly", "big", "hammer", "solution,", "this", "patch", "introduces", "the", "mutex", "to", "make", "each", "ioctl", "exclusive.", "Although", "this", "may", "reduce", "performance", "via", "parallel", "ioctl", "calls,", "usually", "it's", "not", "demanded", "for", "sequencer", "usages,", "hence", "it", "should", "be", "negligible.", "Reported-by:", "Luo", "Quan", "<a4651386@163.com>", "Reviewed-by:", "Kees", "Cook", "<keescook@chromium.org>", "Reviewed-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["mutex_init", "(", "&", "client", "-", ">", "ioctl_mutex", ")", ";", "mutex_lock", "(", "&", "client", "-", ">", "ioctl_mutex", ")", ";", "mutex_unlock", "(", "&", "client", "-", ">", "ioctl_mutex", ")", ";", "struct", "mutex", "ioctl_mutex", ";</s>"], "docstring_tokens": ["race", "condition"]}
{"contents": ["Rename", "requiredSecret", "to", "secret", "and", "add", "secretRequired", "AJP", "Connector", "will", "not", "start", "if", "secretRequired=\"true\"", "and", "secret", "is", "set", "to", "null", "or", "zero", "length", "String."], "code_tokens": ["@", "Deprecated", "protected", "String", "secret", "=", "null", ";", "public", "void", "setSecret", "(", "String", "secret", ")", "{", "this", ".", "secret", "=", "secret", ";", "this", ".", "requiredSecret", "=", "secret", ";", "}", "@", "Deprecated", "setSecret", "(", "requiredSecret", ")", ";", "boolean", "secretPresentInRequest", "=", "false", ";", "if", "(", "secret", "!", "=", "null", ")", "{", "secretPresentInRequest", "=", "true", ";", "if", "(", "!", "tmpMB", ".", "equals", "(", "secret", ")", ")", "{", "if", "(", "(", "secret", "!", "=", "null", ")", "&", "&", "!", "secretPresentInRequest", ")", "{", "private", "String", "secret", "=", "null", ";", "/", "**", "*", "Set", "the", "secret", "that", "must", "be", "included", "with", "every", "request", ".", "*", "*", "@", "param", "secret", "The", "required", "secret", "*", "/", "public", "void", "setSecret", "(", "String", "secret", ")", "{", "this", ".", "secret", "=", "secret", ";", "this", ".", "requiredSecret", "=", "secret", ";", "}", "protected", "String", "getSecret", "(", ")", "{", "return", "secret", ";", "}", "*", "*", "@", "deprecated", "Replaced", "by", "{", "@", "link", "#", "setSecret", "(", "String", ")", "}.", "*", "Will", "be", "removed", "in", "Tomcat", "11", "onwards", "@", "Deprecated", "setSecret", "(", "requiredSecret", ")", ";", "}", "/", "**", "*", "@", "return", "The", "current", "secret", "*", "*", "@", "deprecated", "Replaced", "by", "{", "@", "link", "#", "getSecret", "(", ")}", ".", "*", "Will", "be", "removed", "in", "Tomcat", "11", "onwards", "*", "/", "@", "Deprecated", "protected", "String", "getRequiredSecret", "(", ")", "{", "return", "getSecret", "(", ");", "}", "private", "boolean", "secretRequired", "=", "true", ";", "public", "void", "setSecretRequired", "(", "boolean", "secretRequired", ")", "{", "this", ".", "secretRequired", "=", "secretRequired", ";", "}", "public", "boolean", "getSecretRequired", "(", ")", "{", "return", "secretRequired", ";", "@", "Override", "public", "void", "init", "(", ")", "throws", "Exception", "{", "if", "(", "getSecretRequired", "(", "))", "{", "String", "secret", "=", "getSecret", "(", ");", "if", "(", "secret", "=", "=", "null", "|", "|", "secret", ".", "length", "(", ")", "=", "=", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "sm", ".", "getString", "(", "\"", "ajpprotocol", ".", "nosecret", "\"", "))", ";", "}", "}", "super", ".", "init", "(", ");", "}", "processor", ".", "setSecret", "(", "proto", ".", "getSecret", "(", "))", ";", "processor", ".", "setSecret", "(", "proto", ".", "getSecret", "(", "))", ";", "processor", ".", "setSecret", "(", "proto", ".", "getSecret", "(", "))", ";", "ajpprotocol", ".", "nosecret", "=", "The", "AJP", "Connector", "is", "configured", "with", "secretRequired", "=", "\"", "true", "\"", "but", "the", "secret", "attribute", "is", "either", "null", "or", "\"", "\".", "This", "combination", "is", "not", "valid", ".", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "apache", ".", "catalina", ".", "connector", ".", "Connector", ";", "@", "Before", "@", "Override", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "Connector", "c", "=", "getTomcatInstance", "(", ").", "getConnector", "(", ");", "c", ".", "setProperty", "(", "\"", "secretRequired", "\"", ",", "\"", "false", "\"", ");", "}", "<", "add", ">", "Rename", "the", "<", "code", ">", "requiredSecret", "<", "/", "code", ">", "attribute", "of", "the", "AJP", "/", "1", ".", "3", "Connector", "to", "<", "code", ">", "secret", "<", "/", "code", ">", "and", "add", "a", "new", "attribute", "<", "code", ">", "secretRequired", "<", "/", "code", ">", "that", "defaults", "to", "<", "code", ">", "true", "<", "/", "code", ">", ".", "When", "<", "code", ">", "secretRequired", "<", "/", "code", ">", "is", "<", "code", ">", "true", "<", "/", "code", ">", "the", "AJP", "/", "1", ".", "3", "Connector", "will", "not", "start", "unless", "the", "<", "code", ">", "secret", "<", "/", "code", ">", "attribute", "is", "configured", "to", "a", "non", "-", "null", ",", "non", "-", "zero", "length", "String", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "attribute", "name", "=", "\"", "secret", "\"", "required", "=", "\"", "false", "\"", ">", "The", "default", "value", "is", "<", "code", ">", "null", "<", "/", "code", ">", ".", "This", "attrbute", "must", "be", "specified", "with", "a", "non", "-", "null", ",", "non", "-", "zero", "length", "value", "unless", "<", "strong", ">", "secretRequired", "<", "/", "strong", ">", "is", "explicitly", "configured", "to", "be", "<", "code", ">", "false", "<", "/", "code", ">", ".<", "/", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "secretRequired", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "If", "this", "attribute", "is", "<", "code", ">", "true", "<", "/", "code", ">", ",", "the", "AJP", "Connector", "will", "only", "start", "if", "the", "<", "strong", ">", "secret", "<", "/", "strong", ">", "attribute", "is", "configured", "with", "a", "non", "-", "null", ",", "non", "-", "zero", "length", "value", ".", "The", "default", "value", "is", "<", "code", ">", "true", "<", "/", "code", ">", ".</s>this", ".", "requiredSecret", "=", "requiredSecret", ";", "boolean", "secret", "=", "false", ";", "if", "(", "requiredSecret", "!", "=", "null", ")", "{", "secret", "=", "true", ";", "if", "(", "!", "tmpMB", ".", "equals", "(", "requiredSecret", ")", ")", "{", "if", "(", "(", "requiredSecret", "!", "=", "null", ")", "&", "&", "!", "secret", ")", "{", "this", ".", "requiredSecret", "=", "requiredSecret", ";", "processor", ".", "setRequiredSecret", "(", "proto", ".", "requiredSecret", ")", ";", "processor", ".", "setRequiredSecret", "(", "proto", ".", "requiredSecret", ")", ";", "processor", ".", "setRequiredSecret", "(", "proto", ".", "requiredSecret", ")", ";", "<", "attribute", "name", "=", "\"", "requiredSecret", "\"", "required", "=", "\"", "false", "\"", ">"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["drm/r128:", "Add", "test", "for", "initialisation", "to", "all", "ioctls", "that", "require", "it", "Almost", "all", "r128's", "private", "ioctls", "require", "that", "the", "CCE", "state", "has", "already", "been", "initialised.", "However,", "most", "do", "not", "test", "that", "this", "has", "been", "done,", "and", "will", "proceed", "to", "dereference", "a", "null", "pointer.", "This", "may", "result", "in", "a", "security", "vulnerability,", "since", "some", "ioctls", "are", "unprivileged.", "This", "adds", "a", "macro", "for", "the", "common", "initialisation", "test", "and", "changes", "all", "ioctl", "implementations", "that", "require", "prior", "initialisation", "to", "use", "that", "macro.", "Also,", "r128_do_init_cce()", "does", "not", "test", "that", "the", "CCE", "state", "has", "not", "been", "initialised", "already.", "Repeated", "initialisation", "may", "lead", "to", "a", "crash", "or", "resource", "leak.", "This", "adds", "that", "test.", "Signed-off-by:", "Ben", "Hutchings", "<ben@decadent.org.uk>", "Signed-off-by:", "Dave", "Airlie", "<airlied@redhat.com>"], "code_tokens": ["if", "(", "dev", "-", ">", "dev_private", ")", "{", "DRM_DEBUG", "(", "\"", "called", "when", "already", "initialized", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev", "-", ">", "dev_private", ")", ";", "#", "define", "DEV_INIT_TEST_WITH_RETURN", "(", "_dev_priv", ")", "\\", "do", "{", "\\", "if", "(", "!", "_dev_priv", ")", "{", "\\", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "\\", "return", "-", "EINVAL", ";", "\\", "}", "\\", "}", "while", "(", "0", ")", "drm_r128_sarea_t", "*", "sarea_priv", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "sarea_priv", "=", "dev_priv", "-", ">", "sarea_priv", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";", "DEV_INIT_TEST_WITH_RETURN", "(", "dev_priv", ")", ";</s>if", "(", "!", "dev_priv", ")", "{", "DRM_DEBUG", "(", "\"", "called", "before", "init", "done", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "drm_r128_sarea_t", "*", "sarea_priv", "=", "dev_priv", "-", ">", "sarea_priv", ";", "if", "(", "!", "dev_priv", ")", "{", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "!", "dev_priv", ")", "{", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "!", "dev_priv", ")", "{", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "!", "dev_priv", ")", "{", "DRM_ERROR", "(", "\"", "called", "with", "no", "initialization", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Fix", "a", "few", "incorrectly", "checked", "[io_]remap_pfn_range()", "calls", "Nico", "Golde", "reports", "a", "few", "straggling", "uses", "of", "[io_]remap_pfn_range()", "that", "really", "should", "use", "the", "vm_iomap_memory()", "helper.", "This", "trivially", "converts", "two", "of", "them", "to", "the", "helper,", "and", "comments", "about", "why", "the", "third", "one", "really", "needs", "to", "continue", "to", "use", "remap_pfn_range(),", "and", "adds", "the", "missing", "size", "check.", "Reported-by:", "Nico", "Golde", "<nico@ngolde.de>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org."], "code_tokens": ["struct", "uio_mem", "*", "mem", ";", "mem", "=", "idev", "-", ">", "info", "-", ">", "mem", "+", "mi", ";", "if", "(", "vma", "-", ">", "vm_end", "-", "vma", "-", ">", "vm_start", ">", "mem", "-", ">", "size", ")", "return", "-", "EINVAL", ";", "vma", "-", ">", "vm_ops", "=", "&", "uio_physical_vm_ops", ";", "/", "*", "*", "We", "cannot", "use", "the", "vm_iomap_memory", "(", ")", "helper", "here", ",", "*", "because", "vma", "-", ">", "vm_pgoff", "is", "the", "map", "index", "we", "looked", "*", "up", "above", "in", "uio_find_mem_index", "(", "),", "rather", "than", "an", "*", "actual", "page", "offset", "into", "the", "mmap", ".", "*", "*", "So", "we", "just", "do", "the", "physical", "mmap", "without", "a", "page", "*", "offset", ".", "*", "/", "mem", "-", ">", "addr", ">", ">", "PAGE_SHIFT", ",", "return", "vm_iomap_memory", "(", "vma", ",", "fbdev", "-", ">", "fb_phys", ",", "fbdev", "-", ">", "fb_len", ")", ";", "return", "vm_iomap_memory", "(", "vma", ",", "fbdev", "-", ">", "fb_phys", ",", "fbdev", "-", ">", "fb_len", ")", ";</s>vma", "-", ">", "vm_ops", "=", "&", "uio_physical_vm_ops", ";", "idev", "-", ">", "info", "-", ">", "mem", "[", "mi", "]", ".", "addr", ">", ">", "PAGE_SHIFT", ",", "unsigned", "int", "len", ";", "unsigned", "long", "start", "=", "0", ",", "off", ";", "if", "(", "vma", "-", ">", "vm_pgoff", ">", "(", "~", "0UL", ">", ">", "PAGE_SHIFT", ")", ")", "{", "return", "-", "EINVAL", ";", "}", "start", "=", "fbdev", "-", ">", "fb_phys", "&", "PAGE_MASK", ";", "len", "=", "PAGE_ALIGN", "(", "(", "start", "&", "~", "PAGE_MASK", ")", "+", "fbdev", "-", ">", "fb_len", ")", ";", "off", "=", "vma", "-", ">", "vm_pgoff", "<", "<", "PAGE_SHIFT", ";", "if", "(", "(", "vma", "-", ">", "vm_end", "-", "vma", "-", ">", "vm_start", "+", "off", ")", ">", "len", ")", "{", "return", "-", "EINVAL", ";", "}", "off", "+", "=", "start", ";", "vma", "-", ">", "vm_pgoff", "=", "off", ">", ">", "PAGE_SHIFT", ";", "if", "(", "io_remap_pfn_range", "(", "vma", ",", "vma", "-", ">", "vm_start", ",", "off", ">", ">", "PAGE_SHIFT", ",", "vma", "-", ">", "vm_end", "-", "vma", "-", ">", "vm_start", ",", "vma", "-", ">", "vm_page_prot", ")", ")", "{", "return", "-", "EAGAIN", ";", "}", "return", "0", ";", "unsigned", "int", "len", ";", "unsigned", "long", "start", "=", "0", ",", "off", ";", "if", "(", "vma", "-", ">", "vm_pgoff", ">", "(", "~", "0UL", ">", ">", "PAGE_SHIFT", ")", ")", "{", "return", "-", "EINVAL", ";", "}", "start", "=", "fbdev", "-", ">", "fb_phys", "&", "PAGE_MASK", ";", "len", "=", "PAGE_ALIGN", "(", "(", "start", "&", "~", "PAGE_MASK", ")", "+", "fbdev", "-", ">", "fb_len", ")", ";", "off", "=", "vma", "-", ">", "vm_pgoff", "<", "<", "PAGE_SHIFT", ";", "if", "(", "(", "vma", "-", ">", "vm_end", "-", "vma", "-", ">", "vm_start", "+", "off", ")", ">", "len", ")", "{", "return", "-", "EINVAL", ";", "}", "off", "+", "=", "start", ";", "vma", "-", ">", "vm_pgoff", "=", "off", ">", ">", "PAGE_SHIFT", ";", "return", "io_remap_pfn_range", "(", "vma", ",", "vma", "-", ">", "vm_start", ",", "off", ">", ">", "PAGE_SHIFT", ",", "vma", "-", ">", "vm_end", "-", "vma", "-", ">", "vm_start", ",", "vma", "-", ">", "vm_page_prot", ")", ";"], "docstring_tokens": ["memory", "disclosure"]}
{"contents": ["[NETFILTER]", "ctnetlink:", "check", "if", "protoinfo", "is", "present", "This", "fixes", "an", "oops", "triggered", "from", "userspace.", "If", "we", "don't", "pass", "information", "about", "the", "private", "protocol", "info,", "the", "reference", "to", "attr", "will", "be", "NULL.", "This", "is", "likely", "to", "happen", "in", "update", "messages.", "Signed-off-by:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>", "Signed-off-by:", "Harald", "Welte", "<laforge@netfilter.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["/", "*", "updates", "could", "not", "contain", "anything", "about", "the", "private", "*", "protocol", "info", ",", "in", "that", "case", "skip", "the", "parsing", "*", "/", "if", "(", "!", "attr", ")", "return", "0", ";</s>"], "docstring_tokens": ["null", "dereference"]}
{"contents": ["CAN:", "Use", "inode", "instead", "of", "kernel", "address", "for", "/proc", "file", "Since", "the", "socket", "address", "is", "just", "being", "used", "as", "a", "unique", "identifier,", "its", "inode", "number", "is", "an", "alternative", "that", "does", "not", "leak", "potentially", "sensitive", "information.", "CC-ing", "stable", "because", "MITRE", "has", "assigned", "to", "the", "issue.", "Signed-off-by:", "Dan", "Rosenberg", "<drosenberg@vsecurity.com>", "Acked-by:", "Oliver", "Hartkopp", "<socketcan@hartkopp.net>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["char", "procname", "[", "32", "]", ";", "/", "*", "inode", "number", "in", "decimal", "with", "\\", "0", "*", "/", "sprintf", "(", "bo", "-", ">", "procname", ",", "\"", "%", "lu", "\"", ",", "sock_i_ino", "(", "sk", ")", ");</s>char", "procname", "[", "20", "]", ";", "/", "*", "pointer", "printed", "in", "ASCII", "with", "\\", "0", "*", "/", "sprintf", "(", "bo", "-", ">", "procname", ",", "\"", "%", "p", "\"", ",", "sock", ")", ";"], "docstring_tokens": ["semantic", "overflows"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/1586"], "code_tokens": ["static", "PixelChannels", "*", "*", "AcquirePixelThreadSet", "(", "const", "Image", "*", "images", ")", "const", "Image", "*", "next", ";", "columns", ",", "columns", "=", "images", "-", ">", "columns", ";", "for", "(", "next", "=", "images", ";", "next", "!", "=", "(", "Image", "*", ")", "NULL", ";", "next", "=", "next", "-", ">", "next", ")", "columns", "=", "MagickMax", "(", "next", "-", ">", "columns", ",", "columns", ")", ";", "pixels", "[", "i", "]", "=(", "PixelChannels", "*", ")", "AcquireQuantumMemory", "(", "columns", ",", "sizeof", "(", "**", "pixels", ")", ");", "for", "(", "j", "=", "0", ";", "j", "<", "(", "ssize_t", ")", "columns", ";", "j", "+", "+)</s>static", "PixelChannels", "*", "*", "AcquirePixelThreadSet", "(", "const", "Image", "*", "image", ")", "pixels", "[", "i", "]", "=(", "PixelChannels", "*", ")", "AcquireQuantumMemory", "(", "image", "-", ">", "columns", ",", "sizeof", "(", "**", "pixels", ")", ");", "for", "(", "j", "=", "0", ";", "j", "<", "(", "ssize_t", ")", "image", "-", ">", "columns", ";", "j", "+", "+)"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["Submitted", "by:", "Tomas", "Hoger", "<thoger@redhat.com>", "Fix", "for", "where", "some", "kerberos", "enabled", "versions", "of", "OpenSSL", "could", "be", "crashed", "if", "the", "relevant", "tables", "were", "not", "present", "(e.g.", "chrooted)."], "code_tokens": ["Changes", "between", "0", ".", "9", ".", "8m", "and", "0", ".", "9", ".", "8n", "[", "xx", "XXX", "xxxx", "]", "*", ")", "Fix", "for", "CVE", "-", "2010", "-", "0433", "where", "some", "kerberos", "enabled", "versions", "of", "OpenSSL", "could", "be", "crashed", "if", "the", "relevant", "tables", "were", "not", "present", "(", "e", ".", "g", ".", "chrooted", ")", ".", "[", "Tomas", "Hoger", "<", "thoger", "@", "redhat", ".", "com", ">", "]", "if", "(", "krb5rc", ")", "goto", "exit", ";</s>"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Improve", "checking", "of", "EXIF", "profile", "to", "prevent", "integer", "overflow", "(bug", "report", "from", "Ibrahim", "el-sayed)"], "code_tokens": ["*", "quantum", "=", "(", "unsigned", "int", ")", "(", "*", "p", "+", "+)", "<", "<", "24", ";", "*", "quantum", "|", "=(", "unsigned", "int", ")", "(", "*", "p", "+", "+)", "<", "<", "16", ";", "*", "quantum", "|", "=(", "unsigned", "int", ")", "(", "*", "p", "+", "+)", "<", "<", "8", ";", "*", "quantum", "|", "=(", "unsigned", "int", ")", "(", "*", "p", "+", "+)", "<", "<", "0", ";", "*", "quantum", "=", "(", "unsigned", "short", ")", "(", "*", "p", "+", "+)", "<", "<", "8", ";", "*", "quantum", "|", "=(", "unsigned", "short", ")", "(", "*", "p", "+", "+)", ";", "}", "static", "inline", "void", "WriteResourceLong", "(", "unsigned", "char", "*", "p", ",", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "0", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "0", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "1", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "3", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "0", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "0", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "3", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "if", "(", "q", ">", "(", "exif", "+", "length", "-", "12", ")", ")", "break", ";", "/", "*", "corrupt", "EXIF", "*", "/", "if", "(", "components", "<", "0", ")", "break", ";", "/", "*", "corrupt", "EXIF", "*", "/", "unsigned", "int", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "0", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "3", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "0", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "1", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "3", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "0", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "0", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "3", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffffffff", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "3", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "0", "]", ";", "return", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "buffer", "[", "0", "]", "<", "<", "24", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "int", ")", "buffer", "[", "3", "]", ";", "return", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "0", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "0", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "1", "]", ";", "quantum", ".", "unsigned_value", "=", "value", "&", "0xffff", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "1", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "0", "]", ";", "return", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "buffer", "[", "0", "]", "<", "<", "8", ";", "value", "|", "=(", "unsigned", "short", ")", "buffer", "[", "1", "]", ";", "return", "(", "value", "&", "0xffff", ")", ";", "if", "(", "q", ">", "(", "exif", "+", "length", "-", "12", ")", ")", "break", ";", "/", "*", "corrupt", "EXIF", "*", "/", "if", "(", "components", "<", "0", ")", "break", ";", "/", "*", "corrupt", "EXIF", "*", "/</s>*", "quantum", "=", "(", "size_t", ")", "(", "*", "p", "+", "+", "<", "<", "24", ")", ";", "*", "quantum", "|", "=(", "size_t", ")", "(", "*", "p", "+", "+", "<", "<", "16", ")", ";", "*", "quantum", "|", "=(", "size_t", ")", "(", "*", "p", "+", "+", "<", "<", "8", ")", ";", "*", "quantum", "|", "=(", "size_t", ")", "(", "*", "p", "+", "+", "<", "<", "0", ")", ";", "*", "quantum", "=", "(", "unsigned", "short", ")", "(", "*", "p", "+", "+", "<", "<", "8", ")", ";", "*", "quantum", "|", "=(", "unsigned", "short", ")", "(", "*", "p", "+", "+", "<", "<", "0", ")", ";", "}", "static", "inline", "void", "WriteResourceLong", "(", "unsigned", "char", "*", "p", ",", "value", "=", "(", "unsigned", "short", ")", "(", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "buffer", "[", "0", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "(", "((", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "0", "]", "<", "<", "8", ")", "|", "(", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "1", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "3", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "(", "buffer", "[", "0", "]", "))", ";", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "0", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "8", ")", "|", "buffer", "[", "3", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "size_t", "value", "=", "(", "size_t", ")", "(", "buffer", "[", "0", "]", "<", "<", "24", ")", ";", "value", "|", "=", "buffer", "[", "1", "]", "<", "<", "16", ";", "value", "|", "=", "buffer", "[", "2", "]", "<", "<", "8", ";", "value", "|", "=", "buffer", "[", "3", "]", ";", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "(", "buffer", "[", "0", "]", "<", "<", "8", ")", ";", "value", "|", "=", "buffer", "[", "1", "]", ";", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "3", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "(", "buffer", "[", "0", "]", "))", ";", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "0", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "8", ")", "|", "buffer", "[", "3", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffffffff", ")", ";", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "3", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "(", "buffer", "[", "0", "]", "))", ";", "return", "(", "(", "unsigned", "int", ")", "(", "value", "&", "0xffffffff", ")", ");", "value", "=", "(", "unsigned", "int", ")", "(", "(", "buffer", "[", "0", "]", "<", "<", "24", ")", "|", "(", "buffer", "[", "1", "]", "<", "<", "16", ")", "|", "(", "buffer", "[", "2", "]", "<", "<", "8", ")", "|", "buffer", "[", "3", "]", ");", "return", "(", "(", "unsigned", "int", ")", "(", "value", "&", "0xffffffff", ")", ");", "value", "=", "(", "unsigned", "short", ")", "(", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "buffer", "[", "0", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "(", "((", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "0", "]", "<", "<", "8", ")", "|", "(", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "1", "]", ");", "quantum", ".", "unsigned_value", "=", "(", "value", "&", "0xffff", ")", ";", "value", "=", "(", "unsigned", "short", ")", "(", "(", "buffer", "[", "1", "]", "<", "<", "8", ")", "|", "buffer", "[", "0", "]", ");", "return", "(", "(", "unsigned", "short", ")", "(", "value", "&", "0xffff", ")", ");", "value", "=", "(", "unsigned", "short", ")", "(", "((", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "0", "]", "<", "<", "8", ")", "|", "(", "(", "unsigned", "char", "*", ")", "buffer", ")", "[", "1", "]", ");", "return", "(", "(", "unsigned", "short", ")", "(", "value", "&", "0xffff", ")", ");"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["catc:", "Use", "heap", "buffer", "for", "memory", "size", "test", "Allocating", "USB", "buffers", "on", "the", "stack", "is", "not", "portable,", "and", "no", "longer", "works", "on", "x86_64", "(with", "VMAP_STACK", "enabled", "as", "per", "default).", "Fixes:", "1da177e4c3f4", "(\"Linux-2.6.12-rc2\")", "Signed-off-by:", "Ben", "Hutchings", "<ben@decadent.org.uk>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["int", "pktsz", ",", "ret", ";", "u32", "*", "buf", ";", "int", "i", ";", "buf", "=", "kmalloc", "(", "4", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "buf", ")", "{", "ret", "=", "-", "ENOMEM", ";", "goto", "fail_free", ";", "}", "*", "buf", "=", "0x12345678", ";", "catc_write_mem", "(", "catc", ",", "0x7a80", ",", "buf", ",", "4", ")", ";", "*", "buf", "=", "0x87654321", ";", "catc_write_mem", "(", "catc", ",", "0xfa80", ",", "buf", ",", "4", ")", ";", "catc_read_mem", "(", "catc", ",", "0x7a80", ",", "buf", ",", "4", ")", ";", "switch", "(", "*", "buf", ")", "{", "kfree", "(", "buf", ")", ";</s>int", "i", ",", "pktsz", ",", "ret", ";", "i", "=", "0x12345678", ";", "catc_write_mem", "(", "catc", ",", "0x7a80", ",", "&", "i", ",", "4", ")", ";", "i", "=", "0x87654321", ";", "catc_write_mem", "(", "catc", ",", "0xfa80", ",", "&", "i", ",", "4", ")", ";", "catc_read_mem", "(", "catc", ",", "0x7a80", ",", "&", "i", ",", "4", ")", ";", "switch", "(", "i", ")", "{"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["Patch", "from", "the", "upstream", "git", "https://github.com/kkos/oniguruma/issues/60", "(", ")", "Thanks", "to", "Mamoru", "TASAKA", "<mtasaka@fedoraproject.org>"], "code_tokens": ["if", "(", "*", "state", "!", "=", "CCS_START", ")", "*", "state", "=", "CCS_VALUE", ";</s>*", "state", "=", "CCS_VALUE", ";"], "docstring_tokens": ["out-of-bounds", "write"]}
{"contents": ["[SECURITY-527]", "Enforcing", "USE_ITEM", "and", "@RequirePOST."], "code_tokens": ["if", "(", "context", "!", "=", "null", "&", "&", "!", "context", ".", "hasPermission", "(", "CredentialsProvider", ".", "USE_ITEM", ")", ")", "{", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "@", "RequirePOST", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsProvider", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "@", "RequirePOST", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "@", "RequirePOST", "@", "RequirePOST", "if", "(", "context", "=", "=", "null", "&", "&", "!", "Jenkins", ".", "getActiveInstance", "(", ").", "hasPermission", "(", "Jenkins", ".", "ADMINISTER", ")", "|", "|", "context", "!", "=", "null", "&", "&", "!", "context", ".", "hasPermission", "(", "Item", ".", "EXTENDED_READ", ")", ")", "{", "return", "new", "ListBoxModel", "(", ");", "/", "/", "not", "supposed", "to", "be", "seeing", "this", "form", "}", "if", "(", "context", "!", "=", "null", "&", "&", "!", "context", ".", "hasPermission", "(", "CredentialsProvider", ".", "USE_ITEM", ")", ")", "{", "return", "new", "ListBoxModel", "(", ");", "/", "/", "not", "permitted", "to", "try", "connecting", "with", "these", "credentials", "}", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "utf", "-", "8", "\"", "?>", "<", "!-", "-", "~", "The", "MIT", "License", "~", "~", "Copyright", "(", "c", ")", "2011", "-", "2016", ",", "CloudBees", ",", "Inc", ".", ",", "Stephen", "Connolly", ".", "~", "~", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "~", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "~", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "~", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "~", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "~", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "~", "~", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "~", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "~", "~", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "~", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "~", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "~", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "~", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "~", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "~", "THE", "SOFTWARE", ".", "-", "->", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", ">", "<", "st", ":", "documentation", ">", "Editor", "for", "a", "DomainCredentials", "instance", "in", "a", "f", ":", "repeatable", "<", "st", ":", "attribute", "name", "=", "\"", "domainCredential", "\"", "use", "=", "\"", "required", "\"", ">", "The", "instance", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "specificationDescriptors", "\"", "use", "=", "\"", "required", "\"", ">", "all", "types", "of", "specification", "that", "the", "user", "can", "add", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "credentialDescriptors", "\"", "use", "=", "\"", "required", "\"", ">", "all", "types", "of", "credential", "that", "the", "user", "can", "add", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "deleteCaption", "\"", ">", "caption", "of", "the", "'", "delete", "'", "button", ".", "<", "/", "st", ":", "attribute", ">", "<", "/", "st", ":", "documentation", ">", "<", "table", "width", "=", "\"", "100", "%", "\"", "name", "=", "\"", "domain", "\"", ">", "<", "j", ":", "if", "test", "=", "\"$", "{", "attrs", ".", "domainCredential", "!", "=", "null", "and", "attrs", ".", "domainCredential", ".", "domain", ".", "name", "=", "=", "null", "}", "\">", "<", "f", ":", "invisibleEntry", ">", "<", "f", ":", "textbox", "name", "=", "\"", "name", "\"", "value", "=", "\"\"", "/>", "<", "f", ":", "textbox", "name", "=", "\"", "description", "\"", "value", "=", "\"\"", "/>", "<", "/", "f", ":", "invisibleEntry", ">", "<", "f", ":", "section", "title", "=", "\"$", "{%", "Credentials", "not", "bound", "to", "a", "domain", "}", "\"/", ">", "<", "/", "j", ":", "if", ">", "<", "j", ":", "if", "test", "=", "\"$", "{", "attrs", ".", "domainCredential", "=", "=", "null", "or", "attrs", ".", "domainCredential", ".", "domain", ".", "name", "!", "=", "null", "}", "\">", "<", "f", ":", "section", "title", "=", "\"$", "{%", "Credential", "Domain", "}", "\"/", ">", "<", "f", ":", "entry", "title", "=", "\"$", "{%", "Name", "}", "\"", "help", "=", "\"/", "plugin", "/", "credentials", "/", "help", "/", "domain", "/", "name", ".", "html", "\"", ">", "<", "f", ":", "textbox", "name", "=", "\"", "name", "\"", "value", "=", "\"$", "{", "attrs", ".", "domainCredential", ".", "domain", ".", "name", "}", "\"/", ">", "<", "/", "f", ":", "entry", ">", "<", "f", ":", "entry", "title", "=", "\"$", "{%", "Description", "}", "\"", "help", "=", "\"/", "plugin", "/", "credentials", "/", "help", "/", "domain", "/", "description", ".", "html", "\"", ">", "<", "f", ":", "textarea", "name", "=", "\"", "description", "\"", "value", "=", "\"$", "{", "attrs", ".", "domainCredential", ".", "domain", ".", "description", "}", "\"/", ">", "<", "/", "f", ":", "entry", ">", "<", "f", ":", "entry", "title", "=", "\"$", "{%", "Specification", "}", "\"", "help", "=", "\"/", "plugin", "/", "credentials", "/", "help", "/", "domain", "/", "specification", ".", "html", "\"", ">", "<", "f", ":", "hetero", "-", "list", "name", "=", "\"", "specifications", "\"", "hasHeader", "=", "\"", "true", "\"", "descriptors", "=", "\"$", "{", "attrs", ".", "specificationDescriptors", "}", "\"", "items", "=", "\"$", "{", "attrs", ".", "domainCredential", ".", "domain", ".", "specifications", "}", "\"/", ">", "<", "/", "f", ":", "entry", ">", "<", "/", "j", ":", "if", ">", "<", "/", "table", ">", "<", "table", "width", "=", "\"", "100", "%", "\">", "<", "f", ":", "entry", "title", "=", "\"$", "{%", "Credentials", "}", "\">", "<", "f", ":", "hetero", "-", "list", "name", "=", "\"", "credentials", "\"", "hasHeader", "=", "\"", "true", "\"", "descriptors", "=", "\"$", "{", "attrs", ".", "credentialDescriptors", "}", "\"", "items", "=", "\"$", "{", "domainCredential", ".", "credentials", "}", "\"", "addCaption", "=", "\"$", "{%", "Add", "Credentials", "}", "\"/", ">", "<", "/", "f", ":", "entry", ">", "<", "/", "table", ">", "<", "j", ":", "if", "test", "=", "\"$", "{", "attrs", ".", "domainCredential", "=", "=", "null", "or", "attrs", ".", "domainCredential", ".", "domain", ".", "name", "!", "=", "null", "}", "\">", "<", "table", "width", "=", "\"", "100", "%", "\">", "<", "tr", ">", "<", "td", "/", ">", "<", "td", "/", ">", "<", "td", "align", "=", "\"", "right", "\"", ">", "<", "f", ":", "repeatableDeleteButton", "value", "=", "\"$", "{", "attrs", ".", "deleteCaption", "?", ":'", "%", "Remove", "Domain", "'", "}\"", "/>", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "<", "/", "j", ":", "if", ">", "<", "/", "j", ":", "jelly", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "30", "@", "@", "#", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2013", "Harald", "Albers", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "#", "Credentials", "\\", "not", "\\", "bound", "\\", "to", "\\", "a", "\\", "domain", "=", "Zugangsdaten", "ohne", "Dom", "\\", "u00E4nenbindung", "Credential", "\\", "Domain", "=", "Zugangsdaten", "-", "Dom", "\\", "u00E4ne", "Name", "=", "Name", "Description", "=", "Beschreibung", "Specification", "=", "Spezifikation", "Credentials", "=", "Zugangsdaten", "Add", "\\", "Credentials", "=", "Zugangsdaten", "hinzuf", "\\", "u00FCgen", "@", "@", "-", "0", ",", "0", "+", "1", ",", "30", "@", "@", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2014", ",", "Damien", "Finck", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "Credentials", "\\", "not", "\\", "bound", "\\", "to", "\\", "a", "\\", "domain", "=", "Identifiants", "non", "li", "\\", "u00e9s", "\\", "u00e0", "un", "domaine", "Credential", "\\", "Domain", "=", "Identifiants", "de", "domaine", "Name", "=", "Nom", "Description", "=", "Description", "Specification", "=", "Sp", "\\", "u00e9cification", "Credentials", "=", "Identifiants", "Add", "\\", "Credentials", "=", "Ajouter", "des", "identifiants", "Remove", "\\", "Domain", "=", "Supprimer", "le", "domaine", "@", "@", "-", "0", ",", "0", "+", "1", ",", "31", "@", "@", "#", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2013", "Seiji", "Sogabe", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "#", "Credentials", "\\", "not", "\\", "bound", "\\", "to", "\\", "a", "\\", "domain", "=", "\\", "u30c9", "\\", "u30e1", "\\", "u30a4", "\\", "u30f3", "\\", "u306b", "\\", "u30d0", "\\", "u30a4", "\\", "u30f3", "\\", "u30c9", "\\", "u3055", "\\", "u308c", "\\", "u3066", "\\", "u3044", "\\", "u306a", "\\", "u3044", "\\", "u8a8d", "\\", "u8a3c", "\\", "u60c5", "\\", "u5831", "Credential", "\\", "Domain", "=", "\\", "u8a8d", "\\", "u8a3c", "\\", "u30c9", "\\", "u30e1", "\\", "u30a4", "\\", "u30f3", "Name", "=", "\\", "u540d", "\\", "u79f0", "Description", "=", "\\", "u8aac", "\\", "u660e", "Specification", "=", "\\", "u30b9", "\\", "u30da", "\\", "u30c3", "\\", "u30af", "Credentials", "=", "\\", "u8a8d", "\\", "u8a3c", "\\", "u60c5", "\\", "u5831", "Add", "\\", "Credentials", "=", "\\", "u8a8d", "\\", "u8a3c", "\\", "u60c5", "\\", "u5831", "\\", "u306e", "\\", "u8ffd", "\\", "u52a0", "Remove", "\\", "Domain", "=", "\\", "u30c9", "\\", "u30e1", "\\", "u30a4", "\\", "u30f3", "\\", "u306e", "\\", "u524a", "\\", "u9664", "@", "@", "-", "0", ",", "0", "+", "1", ",", "66", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "utf", "-", "8", "\"", "?>", "<", "!-", "-", "~", "The", "MIT", "License", "~", "~", "Copyright", "(", "c", ")", "2011", "-", "2012", ",", "CloudBees", ",", "Inc", ".", ",", "Stephen", "Connolly", ".", "~", "~", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "~", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "~", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "~", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "~", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "~", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "~", "~", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "~", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "~", "~", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "~", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "~", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "~", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "~", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "~", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "~", "THE", "SOFTWARE", ".", "-", "->", "<", "!-", "-", "Index", "page", "-", "->", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", "xmlns", ":", "c", "=", "\"/", "lib", "/", "credentials", "\"", ">", "<", "st", ":", "documentation", ">", "Editor", "for", "a", "DomainCredentials", "instance", "in", "a", "f", ":", "repeatable", "<", "st", ":", "attribute", "name", "=", "\"", "name", "\"", "use", "=", "\"", "required", "\"", ">", "The", "name", "of", "this", "editor", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "domainCredentials", "\"", "use", "=", "\"", "required", "\"", ">", "The", "list", "of", "credentials", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "specificationDescriptors", "\"", "use", "=", "\"", "required", "\"", ">", "all", "types", "of", "specification", "that", "the", "user", "can", "add", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "credentialDescriptors", "\"", "use", "=", "\"", "required", "\"", ">", "all", "types", "of", "credential", "that", "the", "user", "can", "add", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "addCaption", "\"", ">", "caption", "of", "the", "'", "add", "'", "button", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "deleteCaption", "\"", ">", "caption", "of", "the", "'", "delete", "'", "button", ".", "<", "/", "st", ":", "attribute", ">", "<", "/", "st", ":", "documentation", ">", "<", "j", ":", "set", "var", "=", "\"", "dc", "\"", "value", "=", "\"$", "{", "attrs", ".", "domainCredentials", ".", "isEmpty", "(", ")", "?", "attrs", ".", "domainCredentials", ":", "attrs", ".", "domainCredentials", ".", "get", "(", "0", ")", ".", "fixList", "(", "attrs", ".", "domainCredentials", ")", "}\"", "/>", "<", "j", ":", "if", "test", "=", "\"$", "{!", "attrs", ".", "credentialDescriptors", ".", "isEmpty", "(", ")}", "\">", "<", "f", ":", "repeatable", "name", "=", "\"$", "{", "attrs", ".", "name", "}", "\"", "var", "=", "\"", "c", "\"", "items", "=", "\"$", "{", "dc", "}", "\"", "minimum", "=", "\"", "1", "\"", "add", "=", "\"$", "{", "attrs", ".", "addCaption", "?", ":'", "%", "Add", "Domain", "'", "}\"", ">", "<", "c", ":", "domainCredential", "domainCredential", "=", "\"$", "{", "c", "}", "\"", "specificationDescriptors", "=", "\"$", "{", "attrs", ".", "specificationDescriptors", "}", "\"", "credentialDescriptors", "=", "\"$", "{", "attrs", ".", "credentialDescriptors", "}", "\"", "deleteCaption", "=", "\"$", "{", "attrs", ".", "deleteCaption", "?", ":'", "%", "Remove", "Domain", "'", "}\"", "/", ">", "<", "/", "f", ":", "repeatable", ">", "<", "/", "j", ":", "if", ">", "<", "/", "j", ":", "jelly", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "25", "@", "@", "#", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2013", "Harald", "Albers", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "#", "Add", "\\", "Domain", "=", "Dom", "\\", "u00E4ne", "hinzuf", "\\", "u00FCgen", "Remove", "\\", "Domain", "=", "Dom", "\\", "u00E4ne", "entfernen", "@", "@", "-", "0", ",", "0", "+", "1", ",", "24", "@", "@", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2014", ",", "Damien", "Finck", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "Add", "\\", "Domain", "=", "Ajouter", "un", "domaine", "Remove", "\\", "Domain", "=", "Supprimer", "un", "domaine", "@", "@", "-", "0", ",", "0", "+", "1", ",", "25", "@", "@", "#", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2013", "Seiji", "Sogabe", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "#", "Add", "\\", "Domain", "=", "\\", "u30c9", "\\", "u30e1", "\\", "u30a4", "\\", "u30f3", "\\", "u306e", "\\", "u8ffd", "\\", "u52a0", "Remove", "\\", "Domain", "=", "\\", "u30c9", "\\", "u30e1", "\\", "u30a4", "\\", "u30f3", "\\", "u306e", "\\", "u524a", "\\", "u9664", "@", "@", "-", "0", ",", "0", "+", "1", ",", "150", "@", "@", "<", "!-", "-", "~", "The", "MIT", "License", "~", "~", "Copyright", "(", "c", ")", "2011", "-", "2016", ",", "CloudBees", ",", "Inc", ".", ",", "Stephen", "Connolly", ".", "~", "~", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "~", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "~", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "~", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "~", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "~", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "~", "~", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "~", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "~", "~", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "~", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "~", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "~", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "~", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "~", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "~", "THE", "SOFTWARE", ".", "-", "->", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", ">", "<", "st", ":", "documentation", ">", "A", "<", "code", ">", "select", "<", "/", "code", ">", "control", "that", "supports", "the", "data", "binding", "and", "AJAX", "updates", "with", "support", "for", "adding", "credentials", ".", "Your", "descriptor", "should", "have", "the", "'", "doFillXyzItems", "'", "method", ",", "which", "returns", "a", "StandardListBoxModel", "representation", "of", "the", "credentials", "in", "your", "drop", "-", "down", "list", "box", ",", "and", "your", "instance", "field", "should", "hold", "the", "current", "value", ".", "<", "st", ":", "attribute", "name", "=", "\"", "clazz", "\"", ">", "Additional", "CSS", "classes", "that", "the", "control", "gets", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "field", "\"", ">", "Used", "for", "databinding", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "default", "\"", ">", "The", "default", "value", "of", "the", "text", "box", ",", "in", "case", "both", "@", "value", "is", "and", "'", "instance", "[", "field", "]", "'", "is", "null", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "expressionAllowed", "\"", ">", "If", "expressions", "are", "allowed", "then", "the", "user", "can", "choose", "between", "a", "select", "drop", "down", "and", "entering", "an", "expression", ".", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "includeUser", "\"", ">", "If", "the", "user", "'", "s", "scoped", "stores", "should", "be", "included", "<", "/", "st", ":", "attribute", ">", "<", "st", ":", "attribute", "name", "=", "\"", "context", "\"", ">", "The", "context", "within", "which", "to", "look", "up", "the", "stores", ".", "(", "defaults", "to", "<", "code", ">", "it", "<", "/", "code", ">", "(", "jelly", ")", "/", "<", "code", ">", "my", "<", "/", "code", ">", "(", "groovy", ")", ")", "<", "/", "st", ":", "attribute", ">", "<", "/", "st", ":", "documentation", ">", "<", "f", ":", "prepareDatabinding", "/", ">", "<", "j", ":", "set", "var", "=", "\"", "value", "\"", "value", "=", "\"$", "{", "attrs", ".", "value", "?", ":", "instance", "[", "attrs", ".", "field", "]", "?", ":", "attrs", ".", "default", "}", "\"", "/", ">", "<", "j", ":", "set", "var", "=", "\"", "paramValue", "\"", "value", "=", "\"$", "{", "attrs", ".", "expressionAllowed", "and", "value", ".", "startsWith", "(", "'$", "{'", ")", "and", "value", ".", "endsWith", "(", "'}", "')", "}\"", "/>", "<", "j", ":", "set", "var", "=", "\"", "paramDefault", "\"", "value", "=", "\"$", "{", "attrs", ".", "expressionAllowed", "and", "attrs", ".", "default", ".", "startsWith", "(", "'$", "{'", ")", "and", "attrs", ".", "default", ".", "endsWith", "(", "'}", "')", "}\"", "/>", "<", "j", ":", "set", "var", "=", "\"", "selectHelper", "\"", "value", "=", "\"$", "{", "app", ".", "getDescriptorByName", "(", "'", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsSelectHelper", "'", ")}", "\"/", ">", "<", "j", ":", "set", "var", "=", "\"", "includeUser", "\"", "value", "=", "\"$", "{", "attrs", ".", "includeUser", "?", "true", ":", "false", "}", "\"/", ">", "<", "j", ":", "set", "var", "=", "\"", "context", "\"", "value", "=", "\"$", "{", "selectHelper", ".", "resolveContext", "(", "attrs", ".", "context", "?", ":", "it", ")", "}\"", "/>", "<", "div", "class", "=", "\"", "credentials", "-", "select", "-", "control", "\"", ">", "<", "j", ":", "if", "test", "=", "\"$", "{", "attrs", ".", "expressionAllowed", "}", "\">", "<", "label", "field", "-", "disabled", "=", "\"", "true", "\"", ">", "<", "input", "type", "=", "\"", "radio", "\"", "name", "=", "\"$", "{", "attrs", ".", "name", "?", ":", "'", "_", ".", "'+", "attrs", ".", "field", "}", "\"", "value", "=", "\"", "select", "\"", "class", "=", "\"", "credentials", "-", "select", "-", "radio", "-", "control", "\"", "checked", "=", "\"$", "{", "paramValue", "?", "null", ":", "'", "true", "'", "}\"", "/>", "$", "{%", "fixedSelection", "}", "<", "/", "label", ">", "<", "label", "field", "-", "disabled", "=", "\"", "true", "\"", ">", "<", "input", "type", "=", "\"", "radio", "\"", "name", "=", "\"$", "{", "attrs", ".", "name", "?", ":", "'", "_", ".", "'+", "attrs", ".", "field", "}", "\"", "value", "=", "\"", "param", "\"", "class", "=", "\"", "credentials", "-", "select", "-", "radio", "-", "control", "\"", "checked", "=", "\"$", "{", "paramValue", "?", "'", "true", "'", ":", "null", "}", "\"/", ">", "$", "{%", "paramExpression", "}", "<", "/", "label", ">", "<", "/", "j", ":", "if", ">", "<", "div", "field", "-", "disabled", "=", "\"$", "{", "paramValue", "?", "'", "true", "'", ":", "null", "}", "\"", "class", "=", "\"", "credentials", "-", "select", "-", "content", "-", "select", "$", "{", "paramValue", "?", "'", "credentials", "-", "select", "-", "content", "-", "inactive", "'", ":'", "credentials", "-", "select", "-", "content", "-", "active", "'", "}\"", ">", "<", "f", ":", "select", "clazz", "=", "\"$", "{", "attrs", ".", "clazz", "}", "credentials", "-", "select", "\"", "field", "=", "\"$", "{", "attrs", ".", "field", "}", "\"", "default", "=", "\"$", "{", "paramDefault", "?", "''", ":", "attrs", ".", "default", "}", "\"", "value", "=", "\"$", "{", "paramValue", "?", "(", "paramDefault", "?", "''", ":", "attrs", ".", "default", ")", ":", "value", "}", "\"", "checkMethod", "=", "\"$", "{", "attrs", ".", "checkMethod", "}", "\"/", ">", "<", "!-", "-", "TODO", "add", "support", "for", "checking", "permissions", "against", "stores", "in", "request", "path", "-", "->", "<", "st", ":", "nbsp", "/", ">", "<", "j", ":", "set", "var", "=", "\"", "storeItems", "\"", "value", "=", "\"$", "{", "selectHelper", ".", "getStoreItems", "(", "context", ",", "includeUser", ")", "}\"", "/>", "<", "j", ":", "choose", ">", "<", "j", ":", "when", "test", "=", "\"$", "{", "selectHelper", ".", "hasCreatePermission", "(", "context", ",", "includeUser", ")", "and", "storeItems", "!", "=", "null", "and", "!", "storeItems", ".", "isEmpty", "(", ")}", "\">", "<", "button", "type", "=", "\"", "button", "\"", "class", "=", "\"", "credentials", "-", "add", "-", "menu", "\"", "menualign", "=", "\"$", "{", "attrs", ".", "menuAlign", "}", "\"", "suffix", "=", "\"$", "{", "attrs", ".", "name", "}", "\">", "<", "l", ":", "icon", "class", "=", "\"", "icon", "-", "credentials", "-", "new", "-", "credential", "icon", "-", "sm", "\"", "/>", "$", "{%", "Add", "}", "<", "/", "button", ">", "<", "div", "class", "=", "\"", "credentials", "-", "add", "-", "menu", "-", "items", "yuimenu", "\"", ">", "<", "div", "class", "=", "\"", "bd", "\"", ">", "<", "ul", "class", "=", "\"", "first", "-", "of", "-", "type", "\"", ">", "<", "j", ":", "forEach", "var", "=", "\"", "storeItem", "\"", "items", "=", "\"$", "{", "storeItems", "}", "\">", "<", "j", ":", "choose", ">", "<", "j", ":", "when", "test", "=", "\"$", "{", "storeItem", ".", "enabled", "}", "\">", "<", "li", "class", "=", "\"", "yuimenuitem", "\"", "data", "-", "url", "=", "\"$", "{", "request", ".", "contextPath", "}", "/$", "{", "storeItem", ".", "url", "}", "/", "dialog", "\"", ">", "<", "span", "class", "=", "\"", "yuimenuitemlabel", "\"", "tooltip", "=", "\"$", "{", "storeItem", ".", "description", "}", "\">", "<", "l", ":", "icon", "class", "=", "\"$", "{", "storeItem", ".", "iconClassName", "}", "icon", "-", "sm", "\"", "/>", "$", "{", "storeItem", ".", "displayName", "}", "<", "/", "span", ">", "<", "/", "li", ">", "<", "/", "j", ":", "when", ">", "<", "j", ":", "otherwise", ">", "<", "li", "class", "=", "\"", "yuimenuitem", "\"", "disabled", "=", "\"", "disabled", "\"", ">", "<", "span", "class", "=", "\"", "yuimenuitemlabel", "\"", "tooltip", "=", "\"$", "{", "storeItem", ".", "description", "}", "\"", "disabled", "=", "\"", "disabled", "\"", ">", "<", "l", ":", "icon", "class", "=", "\"$", "{", "storeItem", ".", "iconClassName", "}", "icon", "-", "sm", "\"", "/>", "$", "{", "storeItem", ".", "displayName", "}", "<", "/", "span", ">", "<", "/", "li", ">", "<", "/", "j", ":", "otherwise", ">", "<", "/", "j", ":", "choose", ">", "<", "/", "j", ":", "forEach", ">", "<", "/", "ul", ">", "<", "/", "div", ">", "<", "/", "div", ">", "<", "/", "j", ":", "when", ">", "<", "j", ":", "otherwise", ">", "<", "button", "class", "=", "\"", "credentials", "-", "add", "\"", "type", "=", "\"", "button", "\"", "disabled", "=", "\"", "disabled", "\"", ">", "<", "l", ":", "icon", "class", "=", "\"", "icon", "-", "credentials", "-", "new", "-", "credential", "icon", "-", "sm", "\"", "/>", "$", "{%", "Add", "}", "<", "/", "button", ">", "<", "/", "j", ":", "otherwise", ">", "<", "/", "j", ":", "choose", ">", "<", "/", "div", ">", "<", "j", ":", "if", "test", "=", "\"$", "{", "attrs", ".", "expressionAllowed", "}", "\">", "<", "div", "class", "=", "\"", "credentials", "-", "select", "-", "content", "-", "param", "$", "{", "paramValue", "?", "'", "credentials", "-", "select", "-", "content", "-", "active", "'", ":'", "credentials", "-", "select", "-", "content", "-", "inactive", "'", "}\"", ">", "<", "f", ":", "textbox", "value", "=", "\"$", "{", "paramValue", "?", "value", ":", "(", "paramDefault", "?", "attrs", ".", "default", ":", "''", ")}", "\"", "clazz", "=", "\"$", "{", "attrs", ".", "clazz", "}", "credentials", "-", "select", "\"", "field", "=", "\"$", "{", "attrs", ".", "field", "}", "\"", "default", "=", "\"$", "{", "paramDefault", "?", "attrs", ".", "default", ":", "''", "}\"", "/>", "<", "div", "class", "=", "\"", "error", "\"", "style", "=", "\"", "display", ":", "none", ";", "\">", "$", "{%", "invalidExpression", "}", "<", "/", "div", ">", "<", "/", "div", ">", "<", "/", "j", ":", "if", ">", "<", "/", "div", ">", "<", "script", ">", "/", "/", "HACK", ":", "can", "be", "removed", "once", "base", "version", "of", "Jenkins", "has", "fix", "of", "https", ":", "//", "issues", ".", "jenkins", "-", "ci", ".", "org", "/", "browse", "/", "JENKINS", "-", "26578", "/", "/", "conditionally", "include", "the", "adjunct", "resources", "as", "AdjunctManager", "doesn", "'", "t", "do", "this", "correctly", "for", "CSS", "if", "(", "!", "document", ".", "getElementById", "(", "'", "lib", ".", "credentials", ".", "select", ".", "select", "'", "))", "{", "var", "link", "=", "document", ".", "createElement", "(", "'", "link", "'", ");", "link", ".", "id", "=", "'", "lib", ".", "credentials", ".", "select", ".", "select", "'", ";", "link", ".", "rel", "=", "'", "stylesheet", "'", ";", "link", ".", "type", "=", "'", "text", "/", "css", "'", ";", "link", ".", "href", "=", "\"", "${", "request", ".", "contextPath", "+", "'/", "'+", "app", ".", "getAdjuncts", "(", "null", ")", ".", "rootURL", "+", "'/", "lib", "/", "credentials", "/", "select", "/", "select", ".", "css", "'", "}\"", ";", "link", ".", "media", "=", "'", "all", "'", ";", "document", ".", "getElementsByTagName", "(", "'", "head", "'", ")[", "0", "]", ".", "appendChild", "(", "link", ")", ";", "var", "script", "=", "document", ".", "createElement", "(", "'", "script", "'", ");", "script", ".", "type", "=", "'", "text", "/", "javascript", "'", ";", "script", ".", "src", "=", "\"", "${", "request", ".", "contextPath", "+", "'/", "'+", "app", ".", "getAdjuncts", "(", "null", ")", ".", "rootURL", "+", "'/", "lib", "/", "credentials", "/", "select", "/", "select", ".", "js", "'", "}\"", ";", "document", ".", "getElementsByTagName", "(", "'", "body", "'", ")[", "0", "]", ".", "appendChild", "(", "script", ")", ";", "}", "<", "/", "script", ">", "<", "/", "j", ":", "jelly", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "#", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2014", ",", "CloudBees", ",", "Inc", ".", ",", "Stephen", "Connolly", ".", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "#", "invalidExpression", "=", "A", "valid", "parameter", "expression", "consists", "of", "the", "parameter", "name", "enclosed", "\\", "within", "<", "code", ">", "$'", "{'", "</", "code", ">", "and", "<", "code", ">", "'}", "'<", "/", "code", ">", "fixedSelection", "=", "Specific", "credentials", "paramExpression", "=", "Parameter", "expression", "select", ".", "credentials", "-", "select", "{", "width", ":", "auto", ";", "vertical", "-", "align", ":", "top", ";", "}", "div", ".", "credentials", "-", "select", "-", "content", "-", "inactive", "{", "display", ":", "none", ";", "}", "div", "#", "credentialsDialog", "{", "overflow", "-", "y", ":", "scroll", ";", "}", "body", ".", "masked", "{", "overflow", "-", "y", ":", "hidden", ";", "}", "@", "media", "(", "min", "-", "width", ":", "1600px", ")", "{", "select", ".", "credentials", "-", "select", "{", "max", "-", "width", ":", "90", "%", ";", "}", "}", "@", "media", "(", "max", "-", "width", ":", "1600px", ")", "{", "select", ".", "credentials", "-", "select", "{", "max", "-", "width", ":", "85", "%", ";", "}", "}", "@", "media", "(", "max", "-", "width", ":", "1400px", ")", "{", "select", ".", "credentials", "-", "select", "{", "max", "-", "width", ":", "80", "%", ";", "}", "}", "@", "media", "(", "max", "-", "width", ":", "1200px", ")", "{", "select", ".", "credentials", "-", "select", "{", "max", "-", "width", ":", "70", "%", ";", "}", "}", "@", "media", "(", "max", "-", "width", ":", "800px", ")", "{", "select", ".", "credentials", "-", "select", "{", "max", "-", "width", ":", "60", "%", ";", "}", "}", "@", "media", "(", "max", "-", "width", ":", "767px", ")", "{", "select", ".", "credentials", "-", "select", "{", "max", "-", "width", ":", "75", "%", ";", "}", "}", "@", "media", "(", "max", "-", "width", ":", "700px", ")", "{", "select", ".", "credentials", "-", "select", "{", "max", "-", "width", ":", "70", "%", ";", "}", "}", "@", "media", "(", "max", "-", "width", ":", "600px", ")", "{", "select", ".", "credentials", "-", "select", "{", "max", "-", "width", ":", "100", "%", ";", "/", "*", "force", "new", "line", "*", "/", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "271", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2013", "-", "2016", ",", "CloudBees", ",", "Inc", ".", ",", "Stephen", "Connolly", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "window", ".", "credentials", "=", "window", ".", "credentials", "|", "|", "{", "'", "dialog", "'", ":", "null", ",", "'", "body", "'", ":", "null", "}", ";", "window", ".", "credentials", ".", "init", "=", "function", "(", ")", "{", "if", "(", "!(", "window", ".", "credentials", ".", "dialog", ")", ")", "{", "var", "div", "=", "document", ".", "createElement", "(", "\"", "DIV", "\"", ");", "document", ".", "body", ".", "appendChild", "(", "div", ")", ";", "div", ".", "innerHTML", "=", "\"", "<", "div", "id", "=", "'", "credentialsDialog", "'", "><", "div", "class", "=", "'", "bd", "'", "><", "/", "div", ">", "</", "div", ">", "\";", "window", ".", "credentials", ".", "body", "=", "$", "('", "credentialsDialog", "'", ");", "window", ".", "credentials", ".", "dialog", "=", "new", "YAHOO", ".", "widget", ".", "Panel", "(", "window", ".", "credentials", ".", "body", ",", "{", "fixedcenter", ":", "true", ",", "close", ":", "true", ",", "draggable", ":", "true", ",", "zindex", ":", "1000", ",", "modal", ":", "true", ",", "visible", ":", "false", ",", "keylisteners", ":", "[", "new", "YAHOO", ".", "util", ".", "KeyListener", "(", "document", ",", "{", "keys", ":", "27", "}", ",", "{", "fn", ":", "(", "function", "(", ")", "{", "window", ".", "credentials", ".", "dialog", ".", "hide", "(", ");", "})", ",", "scope", ":", "document", ",", "correctScope", ":", "false", "}", ")", "]", "}", ");", "window", ".", "credentials", ".", "dialog", ".", "render", "(", ");", "}", "}", ";", "window", ".", "credentials", ".", "add", "=", "function", "(", "e", ")", "{", "window", ".", "credentials", ".", "init", "(", ");", "new", "Ajax", ".", "Request", "(", "e", ",", "{", "method", ":", "'", "get", "'", ",", "requestHeaders", ":", "{", "'", "Crumb", "'", ":", "crumb", "}", ",", "onSuccess", ":", "function", "(", "t", ")", "{", "window", ".", "credentials", ".", "body", ".", "innerHTML", "=", "t", ".", "responseText", ";", "Behaviour", ".", "applySubtree", "(", "window", ".", "credentials", ".", "body", ",", "false", ")", ";", "window", ".", "credentials", ".", "form", "=", "$", "('", "credentials", "-", "dialog", "-", "form", "'", ");", "/", "/", "window", ".", "credentials", ".", "form", ".", "action", "=", "e", ";", "var", "r", "=", "YAHOO", ".", "util", ".", "Dom", ".", "getClientRegion", "(", ");", "window", ".", "credentials", ".", "dialog", ".", "cfg", ".", "setProperty", "(", "\"", "width", "\"", ",", "r", ".", "width", "*", "3", "/", "4", "+", "\"", "px", "\"", ");", "window", ".", "credentials", ".", "dialog", ".", "cfg", ".", "setProperty", "(", "\"", "height", "\"", ",", "r", ".", "height", "*", "3", "/", "4", "+", "\"", "px", "\"", ");", "window", ".", "credentials", ".", "dialog", ".", "center", "(", ");", "window", ".", "credentials", ".", "dialog", ".", "show", "(", ");", "}", "}", ");", "return", "false", ";", "}", ";", "window", ".", "credentials", ".", "refreshAll", "=", "function", "(", ")", "{", "$", "$(", "'", "select", ".", "credentials", "-", "select", "'", ").", "each", "(", "function", "(", "e", ")", "{", "var", "deps", "=", "[", "];", "function", "h", "(", ")", "{", "var", "params", "=", "{", "};", "deps", ".", "each", "(", "function", "(", "d", ")", "{", "params", "[", "d", ".", "name", "]", "=", "controlValue", "(", "d", ".", "control", ")", ";", "}", ");", "var", "value", "=", "e", ".", "value", ";", "updateListBox", "(", "e", ",", "e", ".", "getAttribute", "(", "\"", "fillUrl", "\"", "),", "{", "parameters", ":", "params", ",", "onSuccess", ":", "function", "(", ")", "{", "if", "(", "value", "=", "=", "\"", "\")", "{", "/", "/", "reflect", "the", "initial", "value", ".", "if", "the", "control", "depends", "on", "several", "other", "SELECT", ".", "select", ",", "/", "/", "it", "may", "take", "several", "updates", "before", "we", "get", "the", "right", "items", ",", "which", "is", "why", "all", "these", "precautions", ".", "var", "v", "=", "e", ".", "getAttribute", "(", "\"", "value", "\"", ");", "if", "(", "v", ")", "{", "e", ".", "value", "=", "v", ";", "if", "(", "e", ".", "value", "=", "=", "v", ")", "{", "e", ".", "removeAttribute", "(", "\"", "value", "\"", ");", "}", "/", "/", "we", "were", "able", "to", "apply", "our", "initial", "value", "}", "}", "/", "/", "if", "the", "update", "changed", "the", "current", "selection", ",", "others", "listening", "to", "this", "control", "needs", "to", "be", "notified", ".", "if", "(", "e", ".", "value", "!", "=", "value", ")", "{", "fireEvent", "(", "e", ",", "\"", "change", "\"", ");", "}", "}", "}", ");", "}", "var", "v", "=", "e", ".", "getAttribute", "(", "\"", "fillDependsOn", "\"", ");", "if", "(", "v", "!", "=", "null", ")", "{", "v", ".", "split", "(", "\"", "\"", ").", "each", "(", "function", "(", "name", ")", "{", "var", "c", "=", "findNearBy", "(", "e", ",", "name", ")", ";", "if", "(", "c", "=", "=", "null", ")", "{", "if", "(", "window", ".", "console", "!", "=", "null", ")", "{", "console", ".", "warn", "(", "\"", "Unable", "to", "find", "nearby", "\"", "+", "name", ")", ";", "}", "if", "(", "window", ".", "YUI", "!", "=", "null", ")", "{", "YUI", ".", "log", "(", "\"", "Unable", "to", "find", "a", "nearby", "control", "of", "the", "name", "\"", "+", "name", ",", "\"", "warn", "\"", ")", "}", "return", ";", "}", "deps", ".", "push", "(", "{", "name", ":", "Path", ".", "tail", "(", "name", ")", ",", "control", ":", "c", "}", ");", "}", ");", "}", "h", "(", ");", "}", ");", "}", "window", ".", "credentials", ".", "addSubmit", "=", "function", "(", "e", ")", "{", "var", "id", ";", "var", "containerId", "=", "\"", "container", "\"", "+", "(", "iota", "+", "+)", ";", "var", "responseDialog", "=", "new", "YAHOO", ".", "widget", ".", "Panel", "(", "\"", "wait", "\"", "+", "(", "iota", "+", "+)", ",", "{", "fixedcenter", ":", "true", ",", "close", ":", "true", ",", "draggable", ":", "true", ",", "zindex", ":", "4", ",", "modal", ":", "true", ",", "visible", ":", "false", "}", ");", "responseDialog", ".", "setHeader", "(", "\"", "Error", "\"", ");", "responseDialog", ".", "setBody", "(", "\"<", "div", "id", "=", "'\"", "+", "containerId", "+", "\"", "'>", "</", "div", ">", "\")", ";", "responseDialog", ".", "render", "(", "document", ".", "body", ")", ";", "var", "target", ";", "/", "/", "iframe", "function", "attachIframeOnload", "(", "target", ",", "f", ")", "{", "if", "(", "target", ".", "attachEvent", ")", "{", "target", ".", "attachEvent", "(", "\"", "onload", "\"", ",", "f", ")", ";", "}", "else", "{", "target", ".", "onload", "=", "f", ";", "}", "}", "var", "f", "=", "$", "('", "credentials", "-", "dialog", "-", "form", "'", ");", "/", "/", "create", "a", "throw", "-", "away", "IFRAME", "to", "avoid", "back", "button", "from", "loading", "the", "POST", "result", "back", "id", "=", "\"", "iframe", "\"", "+", "(", "iota", "+", "+)", ";", "target", "=", "document", ".", "createElement", "(", "\"", "iframe", "\"", ");", "target", ".", "setAttribute", "(", "\"", "id", "\"", ",", "id", ")", ";", "target", ".", "setAttribute", "(", "\"", "name", "\"", ",", "id", ")", ";", "target", ".", "setAttribute", "(", "\"", "style", "\"", ",", "\"", "height", ":", "100", "%", ";", "width", ":", "100", "%", "\")", ";", "$", "(", "containerId", ")", ".", "appendChild", "(", "target", ")", ";", "attachIframeOnload", "(", "target", ",", "function", "(", ")", "{", "if", "(", "target", ".", "contentWindow", "&", "&", "target", ".", "contentWindow", ".", "applyCompletionHandler", ")", "{", "/", "/", "apply", "-", "aware", "server", "is", "expected", "to", "set", "this", "handler", "target", ".", "contentWindow", ".", "applyCompletionHandler", "(", "window", ")", ";", "}", "else", "{", "/", "/", "otherwise", "this", "is", "possibly", "an", "error", "from", "the", "server", ",", "so", "we", "need", "to", "render", "the", "whole", "content", ".", "var", "r", "=", "YAHOO", ".", "util", ".", "Dom", ".", "getClientRegion", "(", ");", "responseDialog", ".", "cfg", ".", "setProperty", "(", "\"", "width", "\"", ",", "r", ".", "width", "*", "3", "/", "4", "+", "\"", "px", "\"", ");", "responseDialog", ".", "cfg", ".", "setProperty", "(", "\"", "height", "\"", ",", "r", ".", "height", "*", "3", "/", "4", "+", "\"", "px", "\"", ");", "responseDialog", ".", "center", "(", ");", "responseDialog", ".", "show", "(", ");", "}", "window", ".", "setTimeout", "(", "function", "(", ")", "{", "//", "otherwise", "Firefox", "will", "fail", "to", "leave", "the", "\"", "connecting", "\"", "state", "$", "(", "id", ")", ".", "remove", "(", ");", "}", ",", "0", ")", "}", ");", "f", ".", "target", "=", "target", ".", "id", ";", "try", "{", "buildFormTree", "(", "f", ")", ";", "f", ".", "submit", "(", ");", "}", "finally", "{", "f", ".", "target", "=", "null", ";", "}", "window", ".", "credentials", ".", "dialog", ".", "hide", "(", ");", "return", "false", ";", "}", ";", "Behaviour", ".", "specify", "(", "\"", "BUTTON", ".", "credentials", "-", "add", "-", "menu", "\"", ",", "'", "credentials", "-", "select", "'", ",", "-", "99", ",", "function", "(", "e", ")", "{", "var", "btn", "=", "$", "(", "e", ")", ";", "var", "menu", "=", "btn", ".", "next", "(", "'", "DIV", ".", "credentials", "-", "add", "-", "menu", "-", "items", "'", ");", "if", "(", "menu", ")", "{", "var", "menuAlign", "=", "(", "btn", ".", "getAttribute", "(", "\"", "menualign", "\"", ")", "|", "|", "\"", "tl", "-", "bl", "\"", ");", "var", "menuButton", "=", "new", "YAHOO", ".", "widget", ".", "Button", "(", "btn", ",", "{", "type", ":", "\"", "menu", "\"", ",", "menu", ":", "menu", ",", "menualignment", ":", "menuAlign", ".", "split", "(", "\"-", "\")", ",", "menuminscrollheight", ":", "250", "}", ");", "$", "(", "menuButton", ".", "_button", ")", ".", "addClassName", "(", "btn", ".", "className", ")", ";", "/", "/", "copy", "class", "names", "$", "(", "menuButton", ".", "_button", ")", ".", "setAttribute", "(", "\"", "suffix", "\"", ",", "btn", ".", "getAttribute", "(", "\"", "suffix", "\"", "))", ";", "menuButton", ".", "getMenu", "(", ").", "clickEvent", ".", "subscribe", "(", "function", "(", "type", ",", "args", ",", "value", ")", "{", "var", "item", "=", "args", "[", "1", "]", ";", "if", "(", "item", ".", "cfg", ".", "getProperty", "(", "\"", "disabled", "\"", "))", "{", "return", ";", "}", "window", ".", "credentials", ".", "add", "(", "item", ".", "srcElement", ".", "getAttribute", "(", "'", "data", "-", "url", "'", "))", ";", "}", ");", "/", "/", "YUI", "menu", "will", "not", "parse", "disabled", "when", "using", "DIV", "-", "LI", "only", "when", "using", "SELECT", "-", "OPTION", "/", "/", "but", "SELECT", "-", "OPTION", "doesn", "'", "t", "support", "images", ",", "so", "we", "need", "to", "catch", "the", "rendering", "and", "roll", "our", "/", "/", "own", "disabled", "attribute", "support", "menuButton", ".", "getMenu", "(", ").", "beforeShowEvent", ".", "subscribe", "(", "function", "(", "type", ",", "args", ",", "value", ")", "{", "var", "items", "=", "this", ".", "getItems", "(", ");", "for", "(", "var", "i", "=", "0", ";", "i", "<", "items", ".", "length", ";", "i", "+", "+)", "{", "if", "(", "items", "[", "i", "]", ".", "srcElement", ".", "getAttribute", "(", "'", "disabled", "'", "))", "{", "items", "[", "i", "]", ".", "cfg", ".", "setProperty", "(", "'", "disabled", "'", ",", "true", ")", ";", "}", "}", "}", ");", "}", "e", "=", "null", ";", "}", ");", "Behaviour", ".", "specify", "(", "\"", "BUTTON", ".", "credentials", "-", "add", "\"", ",", "'", "credentials", "-", "select", "'", ",", "0", ",", "function", "(", "e", ")", "{", "makeButton", "(", "e", ",", "e", ".", "disabled", "?", "null", ":", "window", ".", "credentials", ".", "add", ")", ";", "e", "=", "null", ";", "/", "/", "avoid", "memory", "leak", "}", ");", "Behaviour", ".", "specify", "(", "\"", "DIV", ".", "credentials", "-", "select", "-", "control", "\"", ",", "'", "credentials", "-", "select", "'", ",", "100", ",", "function", "(", "d", ")", "{", "d", "=", "$", "(", "d", ")", ";", "var", "buttons", "=", "d", ".", "getElementsBySelector", "(", "\"", "INPUT", ".", "credentials", "-", "select", "-", "radio", "-", "control", "\"", ");", "var", "u", "=", "(", "function", "(", ")", "{", "for", "(", "var", "i", "=", "0", ";", "i", "<", "this", ".", "length", ";", "i", "+", "+)", "{", "this", "[", "i", "]", "()", ";", "}", "}", ").", "bind", "(", "buttons", ".", "collect", "(", "function", "(", "x", ")", "{", "return", "(", "function", "(", ")", "{", "if", "(", "x", ".", "checked", ")", "{", "this", ".", "addClassName", "(", "'", "credentials", "-", "select", "-", "content", "-", "active", "'", ");", "this", ".", "removeClassName", "(", "'", "credentials", "-", "select", "-", "content", "-", "inactive", "'", ");", "this", ".", "removeAttribute", "(", "'", "field", "-", "disabled", "'", ");", "}", "else", "{", "this", ".", "addClassName", "(", "'", "credentials", "-", "select", "-", "content", "-", "inactive", "'", ");", "this", ".", "removeClassName", "(", "'", "credentials", "-", "select", "-", "content", "-", "active", "'", ");", "this", ".", "setAttribute", "(", "'", "field", "-", "disabled", "'", ",", "'", "true", "'", ");", "}", "}", ").", "bind", "(", "d", ".", "getElementsBySelector", "(", "x", ".", "value", "=", "=", "'", "select", "'", "?", "\"", "DIV", ".", "credentials", "-", "select", "-", "content", "-", "select", "\"", ":", "\"", "DIV", ".", "credentials", "-", "select", "-", "content", "-", "param", "\"", ")[", "0", "]", ");", "}", "))", ";", "u", "(", ");", "for", "(", "var", "i", "=", "0", ";", "i", "<", "buttons", ".", "length", ";", "i", "+", "+)", "{", "buttons", "[", "i", "]", ".", "onclick", "=", "buttons", "[", "i", "]", ".", "onchange", "=", "u", ";", "}", "d", "=", "null", ";", "buttons", "=", "null", ";", "u", "=", "null", ";", "}", ");", "Behaviour", ".", "specify", "(", "\"", "INPUT", ".", "credentials", "-", "select", "\"", ",", "'", "credentials", "-", "select", "'", ",", "-", "100", ",", "function", "(", "x", ")", "{", "x", ".", "onchange", "=", "x", ".", "oninput", "=", "x", ".", "onkeyup", "=", "(", "function", "(", ")", "{", "if", "(", "!", "this", ".", "value", ".", "startsWith", "(", "'$", "{'", "))", "{", "this", ".", "next", "(", ").", "show", "(", ");", "}", "else", "if", "(", "this", ".", "value", "=", "='", "'", "|", "|", "this", ".", "value", "=", "='", "${", "}'", "|", "|", "this", ".", "value", ".", "indexOf", "(", "'}", "')", "!=", "this", ".", "value", ".", "length", "-", "1", ")", "{", "this", ".", "next", "(", ").", "show", "(", ");", "}", "else", "{", "this", ".", "next", "(", ").", "hide", "(", ");", "}", "}", ").", "bind", "(", "$(", "x", ")", ");", "x", ".", "onchange", "(", ");", "}", ");", "window", ".", "setTimeout", "(", "function", "(", ")", "{", "/", "/", "HACK", ":", "can", "be", "removed", "once", "base", "version", "of", "Jenkins", "has", "fix", "of", "https", ":", "//", "issues", ".", "jenkins", "-", "ci", ".", "org", "/", "browse", "/", "JENKINS", "-", "26578", "/", "/", "need", "to", "apply", "the", "new", "behaviours", "to", "existing", "objects", "var", "controls", "=", "document", ".", "getElementsByClassName", "(", "'", "credentials", "-", "select", "-", "control", "'", ");", "var", "count", "=", "controls", ".", "length", ";", "for", "(", "var", "i", "=", "0", ";", "i", "<", "count", ";", "i", "+", "+)", "{", "Behaviour", ".", "applySubtree", "(", "controls", "[", "i", "]", ",", "true", ")", ";", "}", "}", ",", "1", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "24", "@", "@", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2014", ",", "Damien", "Finck", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "fixedSelection", "=", "Identifiants", "sp", "\\", "u00e9cifiques", "Add", "=", "Ajouter", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "#", "#", "The", "MIT", "License", "#", "#", "Copyright", "(", "c", ")", "2014", "-", "2015", ",", "CloudBees", ",", "Inc", ".", ",", "Seiji", "Sogabe", "#", "#", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "#", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "#", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "#", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "#", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "#", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "#", "#", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "#", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "#", "#", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "#", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "#", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "#", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "#", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "#", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "#", "THE", "SOFTWARE", ".", "#", "invalidExpression", "=", "\\", "u30d1", "\\", "u30e9", "\\", "u30e1", "\\", "u30fc", "\\", "u30bf", "\\", "u306f", "\\", "u3001", "\\", "u30d1", "\\", "u30e9", "\\", "u30e1", "\\", "u30fc", "\\", "u30bf", "\\", "u540d", "\\", "u3092", "<", "code", ">", "$'", "{'", "</", "code", ">", "\\", "u3068", "<", "code", ">", "'}", "'<", "/", "code", ">", "\\", "u3067", "\\", "u56f2", "\\", "u3063", "\\", "u3066", "\\", "u304f", "\\", "u3060", "\\", "u3055", "\\", "u3044", "\\", "u3002", "fixedSelection", "=", "Specific", "credentials", "paramExpression", "=", "Parameter", "expression", "Add", "=", "\\", "u8ffd", "\\", "u52a0", "TODO", "this", "is", "a", "copy", "of", "credentials", "-", "plugin", "/", "src", "/", "main", "/", "resources", "/", "lib", "/", "credentials", "/", "except", "patched", "to", "support", "checkMethod", "@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", "xmlns", ":", "c", "=", "\"/", "lib", "/", "credentials2", "\"", "xmlns", ":", "scm", "=", "\"/", "jenkins", "/", "scm", "/", "api", "/", "form", "\"", ">", "<", "c", ":", "select", "checkMethod", "=", "\"", "post", "\"", "/>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "c", "=", "\"/", "lib", "/", "credentials2", "\"", "<", "c", ":", "select", "checkMethod", "=", "\"", "post", "\"", "/></s>if", "(", "context", "!", "=", "null", "&", "&", "!", "(", "context", ".", "hasPermission", "(", "Item", ".", "CONFIGURE", ")", "|", "|", "context", ".", "hasPermission", "(", "Item", ".", "BUILD", ")", "|", "|", "context", ".", "hasPermission", "(", "CredentialsProvider", ".", "USE_ITEM", ")", "))", "{", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", "xmlns", ":", "c", "=", "\"/", "lib", "/", "credentials", "\"", "xmlns", ":", "scm", "=", "\"/", "jenkins", "/", "scm", "/", "api", "/", "form", "\"", ">", "<", "c", ":", "select", "/", ">", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "c", "=", "\"/", "lib", "/", "credentials", "\"", "<", "c", ":", "select", "/", ">"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["CASC-228", "URL", "Encode", "Paramaters", "Passed", "to", "Server", "via", "Validate", "Problem:", "We", "currently", "don't", "pass", "encoded", "values", "to", "the", "server,", "possibly", "resolving", "in", "parsing/extraction", "errors.", "Solution:", "URL", "Encode", "all", "values", "instead", "of", "just", "the", "service", "url.", "QA", "Notes:", "Added", "unit", "test."], "code_tokens": ["urlParameters", ".", "put", "(", "\"", "service", "\"", ",", "serviceUrl", ")", ";", "final", "String", "encodedValue", "=", "encodeUrl", "(", "value", ")", ";", "buffer", ".", "append", "(", "encodedValue", ")", ";", "urlParameters", ".", "put", "(", "\"", "pgtUrl", "\"", ",", "this", ".", "proxyCallbackUrl", ")", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "@", "Test", "public", "void", "urlEncodedValues", "(", ")", "{", "final", "String", "ticket", "=", "\"", "ST", "-", "1", "-", "owKEOtYJjg77iHcCQpkl", "-", "cas01", ".", "example", ".", "org", "%", "26", "%", "73", "%", "65", "%", "72", "%", "76", "%", "69", "%", "63", "%", "65", "%", "3d", "%", "68", "%", "74", "%", "74", "%", "70", "%", "25", "%", "33", "%", "41", "%", "25", "%", "32", "%", "46", "%", "25", "%", "32", "%", "46", "%", "31", "%", "32", "%", "37", "%", "2e", "%", "30", "%", "2e", "%", "30", "%", "2e", "%", "31", "%", "25", "%", "32", "%", "46", "%", "62", "%", "6f", "%", "72", "%", "69", "%", "6e", "%", "67", "%", "25", "%", "32", "%", "46", "%", "23", "\"", ";", "final", "String", "service", "=", "\"", "foobar", "\"", ";", "final", "String", "url", "=", "this", ".", "ticketValidator", ".", "constructValidationUrl", "(", "ticket", ",", "service", ")", ";", "final", "String", "encodedValue", "=", "this", ".", "ticketValidator", ".", "encodeUrl", "(", "ticket", ")", ";", "assertTrue", "(", "url", ".", "contains", "(", "encodedValue", ")", ");", "assertFalse", "(", "url", ".", "contains", "(", "ticket", ")", ");", "}</s>urlParameters", ".", "put", "(", "\"", "service", "\"", ",", "encodeUrl", "(", "serviceUrl", ")", ");", "buffer", ".", "append", "(", "value", ")", ";", "urlParameters", ".", "put", "(", "\"", "pgtUrl", "\"", ",", "encodeUrl", "(", "this", ".", "proxyCallbackUrl", ")", ");", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";"], "docstring_tokens": ["url", "parameter", "injection"]}
{"contents": ["Adding", "CSRF", "support", "to", "the", "OIDC", "client", "reg", "webapp"], "code_tokens": ["/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "cxf", ".", "fediz", ".", "service", ".", "oidc", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "apache", ".", "cxf", ".", "common", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rt", ".", "security", ".", "crypto", ".", "CryptoUtils", ";", "public", "final", "class", "CSRFUtils", "{", "public", "static", "final", "String", "CSRF_TOKEN", "=", "\"", "CSRF_TOKEN", "\"", ";", "private", "CSRFUtils", "(", ")", "{", "/", "/", "complete", "}", "public", "static", "String", "getCSRFToken", "(", "HttpServletRequest", "request", ",", "boolean", "create", ")", "{", "if", "(", "request", "!", "=", "null", "&", "&", "request", ".", "getSession", "(", ")", "!", "=", "null", ")", "{", "/", "/", "Return", "an", "existing", "token", "first", "String", "savedToken", "=", "(", "String", ")", "request", ".", "getSession", "(", ").", "getAttribute", "(", "CSRF_TOKEN", ")", ";", "if", "(", "savedToken", "!", "=", "null", ")", "{", "return", "savedToken", ";", "}", "/", "/", "If", "no", "existing", "token", "then", "create", "a", "new", "one", ",", "save", "it", ",", "and", "return", "it", "if", "(", "create", ")", "{", "String", "token", "=", "StringUtils", ".", "toHexString", "(", "CryptoUtils", ".", "generateSecureRandomBytes", "(", "16", ")", ");", "request", ".", "getSession", "(", ").", "setAttribute", "(", "CSRF_TOKEN", ",", "token", ")", ";", "return", "token", ";", "}", "}", "return", "null", ";", "}", "}", "@", "@", "-", "38", ",", "6", "+", "38", ",", "7", "@", "@", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "apache", ".", "cxf", ".", "fediz", ".", "service", ".", "oidc", ".", "CSRFUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "message", ".", "Message", ";", "import", "org", ".", "apache", ".", "cxf", ".", "phase", ".", "PhaseInterceptorChain", ";", "import", "org", ".", "apache", ".", "cxf", ".", "transport", ".", "http", ".", "AbstractHTTPDestination", ";", "public", "RegisteredClients", "removeClient", "(", "@", "PathParam", "(", "\"", "id", "\"", ")", "String", "id", ",", "@", "FormParam", "(", "\"", "client_csrfToken", "\"", ")", "String", "csrfToken", ")", "{", "/", "/", "CSRF", "checkCSRFToken", "(", "csrfToken", ")", ";", "public", "Client", "resetClient", "(", "@", "PathParam", "(", "\"", "id", "\"", ")", "String", "id", ",", "@", "FormParam", "(", "\"", "client_csrfToken", "\"", ")", "String", "csrfToken", ")", "{", "/", "/", "CSRF", "checkCSRFToken", "(", "csrfToken", ")", ";", "@", "PathParam", "(", "\"", "tokenId", "\"", ")", "String", "tokenId", ",", "@", "FormParam", "(", "\"", "client_csrfToken", "\"", ")", "String", "csrfToken", ")", "{", "/", "/", "CSRF", "checkCSRFToken", "(", "csrfToken", ")", ";", "@", "PathParam", "(", "\"", "tokenId", "\"", ")", "String", "tokenId", ",", "@", "FormParam", "(", "\"", "client_csrfToken", "\"", ")", "String", "csrfToken", ")", "{", "/", "/", "CSRF", "checkCSRFToken", "(", "csrfToken", ")", ";", "@", "PathParam", "(", "\"", "code", "\"", ")", "String", "code", ",", "@", "FormParam", "(", "\"", "client_csrfToken", "\"", ")", "String", "csrfToken", ")", "{", "/", "/", "CSRF", "checkCSRFToken", "(", "csrfToken", ")", ";", "@", "FormParam", "(", "\"", "client_homeRealm", "\"", ")", "String", "homeRealm", ",", "@", "FormParam", "(", "\"", "client_csrfToken", "\"", ")", "String", "csrfToken", "/", "/", "CSRF", "checkCSRFToken", "(", "csrfToken", ")", ";", "private", "void", "checkCSRFToken", "(", "String", "csrfToken", ")", "{", "/", "/", "CSRF", "Message", "message", "=", "PhaseInterceptorChain", ".", "getCurrentMessage", "(", ");", "HttpServletRequest", "httpRequest", "=", "(", "HttpServletRequest", ")", "message", ".", "get", "(", "AbstractHTTPDestination", ".", "HTTP_REQUEST", ")", ";", "String", "savedToken", "=", "CSRFUtils", ".", "getCSRFToken", "(", "httpRequest", ",", "false", ")", ";", "if", "(", "StringUtils", ".", "isEmpty", "(", "csrfToken", ")", "|", "|", "StringUtils", ".", "isEmpty", "(", "savedToken", ")", "|", "|", "!", "savedToken", ".", "equals", "(", "csrfToken", ")", ")", "{", "throwInvalidRegistrationException", "(", "\"", "Invalid", "CSRF", "Token", "\"", ");", "}", "}", "<", "%@", "page", "import", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "fediz", ".", "service", ".", "oidc", ".", "CSRFUtils", "\"", "%", ">", "}", "/", "/", "Get", "or", "generate", "the", "CSRF", "token", "String", "token", "=", "CSRFUtils", ".", "getCSRFToken", "(", "request", ",", "true", ")", ";", "<", "div", "class", "=", "\"", "form", "-", "line", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "value", "=", "\"<", "%=", "token", "%", ">\"", "name", "=", "\"", "client_csrfToken", "\"", "/", ">", "<", "/", "div", ">", "<", "div", "class", "=", "\"", "form", "-", "line", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "value", "=", "\"<", "%=", "token", "%", ">\"", "name", "=", "\"", "client_csrfToken", "\"", "/", ">", "<", "/", "div", ">", "<", "%@", "page", "import", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "fediz", ".", "service", ".", "oidc", ".", "CSRFUtils", "\"", "%", ">", "}", "/", "/", "Get", "or", "generate", "the", "CSRF", "token", "String", "csrfToken", "=", "CSRFUtils", ".", "getCSRFToken", "(", "request", ",", "true", ")", ";", "<", "input", "type", "=", "\"", "hidden", "\"", "value", "=", "\"<", "%=", "csrfToken", "%", ">\"", "name", "=", "\"", "client_csrfToken", "\"", "/", ">", "<", "%@", "page", "import", "=", "\"", "org", ".", "apache", ".", "cxf", ".", "fediz", ".", "service", ".", "oidc", ".", "CSRFUtils", "\"", "%", ">", "/", "/", "Get", "or", "generate", "the", "CSRF", "token", "String", "csrfToken", "=", "CSRFUtils", ".", "getCSRFToken", "(", "request", ",", "true", ")", ";", "<", "input", "type", "=", "\"", "hidden", "\"", "value", "=", "\"<", "%=", "csrfToken", "%", ">\"", "name", "=", "\"", "client_csrfToken", "\"", "/", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "value", "=", "\"<", "%=", "csrfToken", "%", ">\"", "name", "=", "\"", "client_csrfToken", "\"", "/", ">", "import", "=", "\"", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "util", ".", "Iterator", ",", "org", ".", "apache", ".", "cxf", ".", "fediz", ".", "service", ".", "oidc", ".", "clients", ".", "RegisterClient", ",", "org", ".", "apache", ".", "cxf", ".", "fediz", ".", "service", ".", "oidc", ".", "CSRFUtils", "\"", "%", ">", "/", "/", "Get", "or", "generate", "the", "CSRF", "token", "String", "csrfToken", "=", "CSRFUtils", ".", "getCSRFToken", "(", "request", ",", "true", ")", ";", "<", "div", "class", "=", "\"", "form", "-", "line", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "value", "=", "\"<", "%=", "csrfToken", "%", ">\"", "name", "=", "\"", "client_csrfToken", "\"", "/", ">", "<", "/", "div", ">", "/", "/", "Test", "that", "the", "form", "has", "the", "correct", "CSRF", "token", "in", "it", "when", "creating", "a", "client", "@", "org", ".", "junit", ".", "Test", "public", "void", "testCSRFClientRegistration", "(", ")", "throws", "Exception", "{", "String", "url", "=", "\"", "https", ":", "//", "localhost", ":", "\"", "+", "getRpHttpsPort", "(", ")", "+", "\"", "/", "fediz", "-", "oidc", "/", "console", "/", "clients", "\"", ";", "String", "user", "=", "\"", "alice", "\"", ";", "String", "password", "=", "\"", "ecila", "\"", ";", "/", "/", "Login", "to", "the", "client", "page", "successfully", "WebClient", "webClient", "=", "setupWebClient", "(", "user", ",", "password", ",", "getIdpHttpsPort", "(", "))", ";", "HtmlPage", "loginPage", "=", "login", "(", "url", ",", "webClient", ")", ";", "final", "String", "bodyTextContent", "=", "loginPage", ".", "getBody", "(", ").", "getTextContent", "(", ");", "Assert", ".", "assertTrue", "(", "bodyTextContent", ".", "contains", "(", "\"", "Registered", "Clients", "\"", "))", ";", "/", "/", "Register", "a", "new", "client", "WebRequest", "request", "=", "new", "WebRequest", "(", "new", "URL", "(", "url", ")", ",", "HttpMethod", ".", "POST", ")", ";", "request", ".", "setRequestParameters", "(", "new", "ArrayList", "<", "NameValuePair", ">", "()", ");", "request", ".", "getRequestParameters", "(", ").", "add", "(", "new", "NameValuePair", "(", "\"", "client_name", "\"", ",", "\"", "bad_client", "\"", "))", ";", "request", ".", "getRequestParameters", "(", ").", "add", "(", "new", "NameValuePair", "(", "\"", "client_type", "\"", ",", "\"", "confidential", "\"", "))", ";", "request", ".", "getRequestParameters", "(", ").", "add", "(", "new", "NameValuePair", "(", "\"", "client_redirectURI", "\"", ",", "\"", "https", ":", "//", "127", ".", "0", ".", "0", ".", "1", "\"", "))", ";", "request", ".", "getRequestParameters", "(", ").", "add", "(", "new", "NameValuePair", "(", "\"", "client_audience", "\"", ",", "\"", "\")", ");", "request", ".", "getRequestParameters", "(", ").", "add", "(", "new", "NameValuePair", "(", "\"", "client_logoutURI", "\"", ",", "\"", "\")", ");", "request", ".", "getRequestParameters", "(", ").", "add", "(", "new", "NameValuePair", "(", "\"", "client_homeRealm", "\"", ",", "\"", "\")", ");", "request", ".", "getRequestParameters", "(", ").", "add", "(", "new", "NameValuePair", "(", "\"", "client_csrfToken", "\"", ",", "\"", "12345", "\"", "))", ";", "HtmlPage", "registeredClientPage", "=", "webClient", ".", "getPage", "(", "request", ")", ";", "Assert", ".", "assertTrue", "(", "registeredClientPage", ".", "asXml", "(", ").", "contains", "(", "\"", "Invalid", "CSRF", "Token", "\"", "))", ";", "webClient", ".", "close", "(", ");", "}</s>public", "RegisteredClients", "removeClient", "(", "@", "PathParam", "(", "\"", "id", "\"", ")", "String", "id", ")", "{", "public", "Client", "resetClient", "(", "@", "PathParam", "(", "\"", "id", "\"", ")", "String", "id", ")", "{", "@", "PathParam", "(", "\"", "tokenId", "\"", ")", "String", "tokenId", ")", "{", "@", "PathParam", "(", "\"", "tokenId", "\"", ")", "String", "tokenId", ")", "{", "@", "PathParam", "(", "\"", "code", "\"", ")", "String", "code", ")", "{", "@", "FormParam", "(", "\"", "client_homeRealm", "\"", ")", "String", "homeRealm", "}", "}", "import", "=", "\"", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ",", "java", ".", "util", ".", "Map", ",", "java", ".", "util", ".", "Iterator", ",", "org", ".", "apache", ".", "cxf", ".", "fediz", ".", "service", ".", "oidc", ".", "clients", ".", "RegisterClient", "\"", "%>"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["tcp:", "fix", "zero", "cwnd", "in", "tcp_cwnd_reduction", "Patch", "3759824da87b", "(\"tcp:", "PRR", "uses", "CRB", "mode", "by", "default", "and", "SS", "mode", "conditionally\")", "introduced", "a", "bug", "that", "cwnd", "may", "become", "0", "when", "both", "inflight", "and", "sndcnt", "are", "0", "(cwnd", "=", "inflight", "+", "sndcnt).", "This", "may", "lead", "to", "a", "div-by-zero", "if", "the", "connection", "starts", "another", "cwnd", "reduction", "phase", "by", "setting", "tp->prior_cwnd", "to", "the", "current", "cwnd", "(0)", "in", "tcp_init_cwnd_reduction().", "To", "prevent", "this", "we", "skip", "PRR", "operation", "when", "nothing", "is", "acked", "or", "sacked.", "Then", "cwnd", "must", "be", "positive", "in", "all", "cases", "as", "long", "as", "ssthresh", "is", "positive:", "1)", "The", "proportional", "reduction", "mode", "inflight", ">", "ssthresh", ">", "0", "2)", "The", "reduction", "bound", "mode", "a)", "inflight", "==", "ssthresh", ">", "0", "b)", "inflight", "<", "ssthresh", "sndcnt", ">", "0", "since", "newly_acked_sacked", ">", "0", "and", "inflight", "<", "ssthresh", "Therefore", "in", "all", "cases", "inflight", "and", "sndcnt", "can", "not", "both", "be", "0.", "We", "check", "invalid", "tp->prior_cwnd", "to", "avoid", "potential", "div0", "bugs.", "In", "reality", "this", "bug", "is", "triggered", "only", "with", "a", "sequence", "of", "less", "common", "events.", "For", "example,", "the", "connection", "is", "terminating", "an", "ECN-triggered", "cwnd", "reduction", "with", "an", "inflight", "0,", "then", "it", "receives", "reordered/old", "ACKs", "or", "DSACKs", "from", "prior", "transmission", "(which", "acks", "nothing).", "Or", "the", "connection", "is", "in", "fast", "recovery", "stage", "that", "marks", "everything", "lost,", "but", "fails", "to", "retransmit", "due", "to", "local", "issues,", "then", "receives", "data", "packets", "from", "other", "end", "which", "acks", "nothing.", "Fixes:", "3759824da87b", "(\"tcp:", "PRR", "uses", "CRB", "mode", "by", "default", "and", "SS", "mode", "conditionally\")", "Reported-by:", "Oleksandr", "Natalenko", "<oleksandr@natalenko.name>", "Signed-off-by:", "Yuchung", "Cheng", "<ycheng@google.com>", "Signed-off-by:", "Neal", "Cardwell", "<ncardwell@google.com>", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "newly_acked_sacked", "<", "=", "0", "|", "|", "WARN_ON_ONCE", "(", "!", "tp", "-", ">", "prior_cwnd", ")", ")", "return", ";</s>"], "docstring_tokens": ["divide-by-zero", "error"]}
{"contents": ["can:", "add", "missing", "socket", "check", "in", "can/raw", "release", "v2:", "added", "space", "after", "'if'", "according", "code", "style.", "We", "can", "get", "here", "with", "a", "NULL", "socket", "argument", "passed", "from", "userspace,", "so", "we", "need", "to", "handle", "it", "accordingly.", "Thanks", "to", "Dave", "Jones", "pointing", "at", "this", "issue", "in", "net/can/bcm.c", "Signed-off-by:", "Oliver", "Hartkopp", "<socketcan@hartkopp.net>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["struct", "raw_sock", "*", "ro", ";", "if", "(", "!", "sk", ")", "return", "0", ";", "ro", "=", "raw_sk", "(", "sk", ")", ";</s>struct", "raw_sock", "*", "ro", "=", "raw_sk", "(", "sk", ")", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["ALSA:", "msnd:", "Optimize", "/", "harden", "DSP", "and", "MIDI", "loops", "The", "ISA", "msnd", "drivers", "have", "loops", "fetching", "the", "ring-buffer", "head,", "tail", "and", "size", "values", "inside", "the", "loops.", "Such", "codes", "are", "inefficient", "and", "fragile.", "This", "patch", "optimizes", "it,", "and", "also", "adds", "the", "sanity", "check", "to", "avoid", "the", "endless", "loops.", "Bugzilla:", "https://bugzilla.kernel.org/show_bug.cgi?id=196131", "Bugzilla:", "https://bugzilla.kernel.org/show_bug.cgi?id=196133", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["u16", "head", ",", "tail", ",", "size", ";", "head", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ";", "tail", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wTail", ")", ";", "size", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wSize", ")", ";", "if", "(", "head", ">", "size", "|", "|", "tail", ">", "size", ")", "goto", "out", ";", "while", "(", "head", "!", "=", "tail", ")", "{", "unsigned", "char", "val", "=", "readw", "(", "pwMIDQData", "+", "2", "*", "head", ")", ";", "if", "(", "test_bit", "(", "MSNDMIDI_MODE_BIT_INPUT_TRIGGER", ",", "&", "mpu", "-", ">", "mode", ")", ")", "snd_rawmidi_receive", "(", "mpu", "-", ">", "substream_input", ",", "&", "val", ",", "1", ")", ";", "if", "(", "++", "head", ">", "size", ")", "head", "=", "0", ";", "writew", "(", "head", ",", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ";", "out", ":", "u16", "head", ",", "tail", ",", "size", ";", "head", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ";", "tail", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wTail", ")", ";", "size", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wSize", ")", ";", "if", "(", "head", ">", "size", "|", "|", "tail", ">", "size", ")", "goto", "out", ";", "while", "(", "head", "!", "=", "tail", ")", "{", "snd_msnd_eval_dsp_msg", "(", "chip", ",", "readw", "(", "pwDSPQData", "+", "2", "*", "head", ")", ");", "if", "(", "++", "head", ">", "size", ")", "head", "=", "0", ";", "writew", "(", "head", ",", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ";", "out", ":</s>while", "(", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wTail", ")", "!", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ")", "{", "u16", "wTmp", ",", "val", ";", "val", "=", "readw", "(", "pwMIDQData", "+", "2", "*", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ");", "if", "(", "test_bit", "(", "MSNDMIDI_MODE_BIT_INPUT_TRIGGER", ",", "&", "mpu", "-", ">", "mode", ")", ")", "snd_rawmidi_receive", "(", "mpu", "-", ">", "substream_input", ",", "(", "unsigned", "char", "*", ")&", "val", ",", "1", ")", ";", "wTmp", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", "+", "1", ";", "if", "(", "wTmp", ">", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wSize", ")", ")", "writew", "(", "0", ",", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ";", "else", "writew", "(", "wTmp", ",", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ";", "while", "(", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wTail", ")", "!", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ")", "{", "u16", "wTmp", ";", "snd_msnd_eval_dsp_msg", "(", "chip", ",", "readw", "(", "pwDSPQData", "+", "2", "*", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", "))", ";", "wTmp", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", "+", "1", ";", "if", "(", "wTmp", ">", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wSize", ")", ")", "writew", "(", "0", ",", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ";", "else", "writew", "(", "wTmp", ",", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ";"], "docstring_tokens": ["double-fetch", "error"]}
{"contents": ["cifs:", "fix", "unicode", "string", "area", "word", "alignment", "in", "session", "setup", "The", "handling", "of", "unicode", "string", "area", "alignment", "is", "wrong.", "decode_unicode_ssetup", "improperly", "assumes", "that", "it", "will", "always", "be", "preceded", "by", "a", "pad", "byte.", "This", "isn't", "the", "case", "if", "the", "string", "area", "is", "already", "word-aligned.", "This", "problem,", "combined", "with", "the", "bad", "buffer", "sizing", "for", "the", "serverDomain", "string", "can", "cause", "memory", "corruption.", "The", "bad", "alignment", "can", "make", "it", "so", "that", "the", "alignment", "of", "the", "characters", "is", "off.", "This", "can", "make", "them", "translate", "to", "characters", "that", "are", "greater", "than", "2", "bytes", "each.", "If", "this", "happens", "we", "can", "overflow", "the", "allocation.", "Fix", "this", "by", "fixing", "the", "alignment", "in", "CIFS_SessSetup", "instead", "so", "we", "can", "verify", "it", "against", "the", "head", "of", "the", "response.", "Also,", "clean", "up", "the", "workaround", "for", "improperly", "terminated", "strings", "by", "checking", "for", "a", "odd-length", "unicode", "buffers", "and", "then", "forcibly", "terminating", "them.", "Finally,", "resize", "the", "buffer", "for", "serverDomain.", "Now", "that", "we've", "fixed", "the", "alignment,", "it's", "probably", "fine,", "but", "a", "malicious", "server", "could", "overflow", "it.", "A", "better", "solution", "for", "handling", "these", "strings", "is", "still", "needed,", "but", "this", "should", "be", "a", "suitable", "bandaid.", "Signed-off-by:", "Jeff", "Layton", "<jlayton@redhat.com>", "CC:", "Stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["/", "*", "*", "Windows", "servers", "do", "not", "always", "double", "null", "terminate", "their", "final", "*", "Unicode", "string", ".", "Check", "to", "see", "if", "there", "are", "an", "uneven", "number", "of", "bytes", "*", "left", ".", "If", "so", ",", "then", "add", "an", "extra", "NULL", "pad", "byte", "to", "the", "end", "of", "the", "*", "response", ".", "*", "*", "See", "section", "2", ".", "7", ".", "2", "in", "\"", "Implementing", "CIFS", "\"", "for", "details", "*", "/", "if", "(", "bleft", "%", "2", ")", "{", "data", "[", "bleft", "]", "=", "0", ";", "+", "+", "bleft", ";", "}", "ses", "-", ">", "serverDomain", "=", "kzalloc", "(", "(", "4", "*", "len", ")", "+", "2", ",", "GFP_KERNEL", ")", ";", "if", "(", "ses", "-", ">", "serverDomain", "!", "=", "NULL", ")", "if", "(", "smb_buf", "-", ">", "Flags2", "&", "SMBFLG2_UNICODE", ")", "{", "/", "*", "unicode", "string", "area", "must", "be", "word", "-", "aligned", "*", "/", "if", "(", "((", "unsigned", "long", ")", "bcc_ptr", "-", "(", "unsigned", "long", ")", "smb_buf", ")", "%", "2", ")", "{", "+", "+", "bcc_ptr", ";", "-", "-", "bytes_remaining", ";", "}", "ses", ",", "nls_cp", ")", ";", "}", "else", "{", "}</s>/", "*", "SMB", "header", "is", "unaligned", ",", "so", "cifs", "servers", "word", "align", "start", "of", "Unicode", "strings", "*", "/", "data", "+", "+;", "bleft", "-", "-;", "/", "*", "Windows", "servers", "do", "not", "always", "double", "null", "terminate", "their", "final", "Unicode", "string", "-", "in", "which", "case", "we", "now", "will", "not", "attempt", "to", "decode", "the", "byte", "of", "junk", "which", "follows", "it", "*", "/", "/", "*", "We", "look", "for", "obvious", "messed", "up", "bcc", "or", "strings", "in", "response", "so", "we", "do", "not", "go", "off", "the", "end", "since", "(", "at", "least", ")", "WIN2K", "and", "Windows", "XP", "have", "a", "major", "bug", "in", "not", "null", "terminating", "last", "Unicode", "string", "in", "response", "*", "/", "ses", "-", ">", "serverDomain", "=", "kzalloc", "(", "2", "*", "(", "len", "+", "1", ")", ",", "GFP_KERNEL", ")", ";", "/", "*", "BB", "FIXME", "wrong", "length", "*", "/", "if", "(", "ses", "-", ">", "serverDomain", "!", "=", "NULL", ")", "{", "ses", "-", ">", "serverDomain", "[", "2", "*", "len", "]", "=", "0", ";", "ses", "-", ">", "serverDomain", "[", "(", "2", "*", "len", ")", "+", "1", "]", "=", "0", ";", "}", "if", "(", "smb_buf", "-", ">", "Flags2", "&", "SMBFLG2_UNICODE", ")", "ses", ",", "nls_cp", ")", ";", "else"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["DATAJPA-1519", "-", "Wildcard", "escaping", "in", "LIKE-queries.", "Derived", "queries", "with", "`contains`,", "`startWith`", "or", "`endsWith`", "predicates", "now", "use", "wildcard", "escaping", "in", "order", "to", "avoid", "selecting", "more", "then", "requested.", "A", "function", "`escape(String,", "String)`", "is", "made", "available", "in", "SpEL", "expressions", "as", "well", "for", "the", "same", "purpose.", "Note", "that", "annotated", "queries", "and", "derived", "queries", "with", "LIKE", "conditions", "don't", "get", "escaped", "because", "it", "is", "not", "clear", "if", "the", "use", "of", "wildcards", "in", "the", "argument", "is", "intended", "or", "not.", "Improved", "reference", "documentation", "accordingly."], "code_tokens": ["<", "version", ">", "2", ".", "4", ".", "1", "<", "/", "version", ">", "Derived", "queries", "with", "the", "predicates", "`", "IsStartingWith", "`", ",", "`", "StartingWith", "`", ",", "`", "StartsWith", "`", ",", "IsEndingWith", "\"", ",", "`", "EndingWith", "`", ",", "`", "EndsWith", "`", ",", "`", "IsNotContaining", "`", ",", "`", "NotContaining", "`", ",", "`", "NotContains", "`", ",", "`", "IsContaining", "`", ",", "`", "Containing", "`", ",", "`", "Contains", "`", "the", "respective", "arguments", "for", "these", "queries", "will", "get", "sanitized", ".", "This", "means", "if", "the", "arguments", "actually", "contain", "characters", "recognized", "by", "`", "LIKE", "`", "as", "wildcards", "these", "will", "get", "escaped", "so", "they", "match", "only", "as", "literals", ".", "Compare", "with", "<", "<", "jpa", ".", "query", ".", "spel", "-", "expressions", ">", ">.", "SpEL", "expressions", "to", "manipulate", "arguments", "may", "also", "be", "used", "to", "manipulate", "method", "arguments", ".", "In", "these", "SpEL", "expressions", "the", "entity", "name", "is", "not", "available", ",", "but", "the", "arguments", "are", ".", "They", "can", "be", "accessed", "by", "name", "or", "index", "as", "demonstrated", "in", "the", "following", "example", ".", ".", "Using", "SpEL", "expressions", "in", "repository", "query", "methods", "-", "accessing", "arguments", ".", "=", "==", "=", "[", "source", ",", "java", "]", "-", "--", "-", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "=", "?", "1", "and", "u", ".", "firstname", "=", "?#", "{[", "0", "]", "}", "and", "u", ".", "emailAddress", "=", "?", "#{", "principal", ".", "emailAddress", "}", "\")", "List", "<", "User", ">", "findByFirstnameAndCurrentUserWithCustomQuery", "(", "String", "firstname", ")", ";", "-", "--", "-", "=", "==", "=", "For", "`", "like", "`", "-", "conditions", "one", "often", "wants", "to", "appen", "`", "%`", "to", "the", "beginning", "or", "the", "end", "of", "a", "String", "valued", "parameter", ".", "This", "can", "be", "done", "by", "appending", "or", "prefixing", "a", "bind", "parameter", "marker", "or", "a", "SpEL", "expression", "with", "`", "%`", ".", "Again", "the", "following", "example", "demonstrates", "this", ".", ".", "Using", "SpEL", "expressions", "in", "repository", "query", "methods", "-", "wildcard", "shortcut", ".", "=", "==", "=", "[", "source", ",", "java", "]", "-", "--", "-", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "lastname", "like", "%", ":#", "{[", "0", "]", "}%", "and", "u", ".", "lastname", "like", "%", ":", "lastname", "%", "\")", "List", "<", "User", ">", "findByLastnameWithSpelExpression", "(", "@", "Param", "(", "\"", "lastname", "\"", ")", "String", "lastname", ")", ";", "-", "--", "-", "=", "==", "=", "When", "using", "`", "like", "`", "-", "conditions", "with", "values", "that", "are", "coming", "from", "a", "not", "secure", "source", "the", "values", "should", "be", "sanitized", "so", "they", "can", "'", "t", "contain", "any", "wildcards", "and", "thereby", "allow", "attackers", "to", "select", "more", "data", "than", "they", "should", "be", "able", "to", ".", "For", "this", "purpose", "the", "the", "`", "escape", "(", "String", ",", "String", ")", "`", "method", "is", "made", "available", "in", "the", "SpEL", "context", ".", "It", "prefixes", "all", "instances", "of", "`", "_", "`", "and", "`", "%`", "in", "the", "first", "argument", "with", "the", "single", "character", "from", "the", "second", "argument", ".", "In", "combination", "with", "the", "`", "escape", "`", "clause", "of", "the", "`", "like", "`", "expression", "available", "in", "JPQL", "and", "standard", "SQL", "this", "allows", "easy", "cleaning", "of", "bind", "parameters", ".", ".", "Using", "SpEL", "expressions", "in", "repository", "query", "methods", "-", "sanitizing", "input", "values", ".", "=", "==", "=", "[", "source", ",", "java", "]", "-", "--", "-", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "like", "%", "?#", "{#", "escape", "(", "[", "0", "]", ",'", "#'", ")}", "%", "escape", "'", "#'", "\")", "List", "<", "User", ">", "findContainingEscaped", "(", "String", "namePart", ")", ";", "-", "--", "-", "=", "==", "=", "Given", "this", "method", "declaration", "in", "an", "repository", "interface", "`", "findContainingEscaped", "(", "\"", "Peter_", "\"", ")\"", "will", "find", "`", "Peter_Parker", "`", "but", "not", "`", "Peter", "Parker", "`", ".", "Note", "that", "the", "method", "`", "escape", "(", "String", ",", "String", ")", "`", "available", "in", "the", "SpEL", "context", "will", "only", "escape", "the", "SQL", "and", "JPQL", "standard", "wildcards", "`", "_", "`", "and", "`", "%`", ".", "If", "the", "underlying", "database", "or", "the", "JPA", "implementation", "supports", "additional", "wildcards", "these", "will", "not", "get", "escaped", ".", "/", "**", "*", "Configures", "what", "character", "is", "used", "to", "escape", "the", "wildcards", "{", "@", "literal", "_", "}", "and", "{", "@", "literal", "%", "}", "in", "derived", "queries", "with", "*", "{", "@", "literal", "contains", "}", ",", "{", "@", "literal", "startsWith", "}", "or", "{", "@", "literal", "endsWith", "}", "clauses", ".", "*", "*", "@", "return", "a", "single", "character", "used", "for", "escaping", ".", "*", "/", "char", "escapeCharacter", "(", ")", "default", "'", "\\\\", "';", "builder", ".", "addPropertyValue", "(", "\"", "escapeCharacter", "\"", ",", "getEscapeCharacter", "(", "source", ")", ".", "orElse", "(", "'\\", "\\'", "))", ";", "/", "**", "*", "XML", "configurations", "do", "not", "support", "{", "@", "link", "Character", "}", "values", ".", "This", "method", "catches", "the", "exception", "thrown", "and", "returns", "an", "{", "@", "link", "Optional", "#", "empty", "(", ")}", "instead", ".", "*", "/", "private", "static", "Optional", "<", "Character", ">", "getEscapeCharacter", "(", "RepositoryConfigurationSource", "source", ")", "{", "try", "{", "return", "source", ".", "getAttribute", "(", "\"", "escapeCharacter", "\"", ",", "Character", ".", "class", ")", ";", "}", "catch", "(", "IllegalArgumentException", "___", ")", "{", "return", "Optional", ".", "empty", "(", ");", "}", "}", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "private", "final", "EscapeCharacter", "escape", ";", "CriteriaQuery", "<", "?>", "criteriaQuery", "=", "createCriteriaQuery", "(", "builder", ",", "type", ")", ";", "this", ".", "escape", "=", "provider", ".", "getEscape", "(", ");", "Predicate", "like", "=", "builder", ".", "like", "(", "propertyExpression", ",", "parameterExpression", ",", "escape", ".", "getValue", "(", "))", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "private", "final", "EscapeCharacter", "escape", ";", "public", "CreateQueryLookupStrategy", "(", "EntityManager", "em", ",", "QueryExtractor", "extractor", ",", "EscapeCharacter", "escape", ")", "{", "this", ".", "escape", "=", "escape", ";", "return", "new", "PartTreeJpaQuery", "(", "method", ",", "em", ",", "persistenceProvider", ",", "escape", ")", ";", "*", "@", "param", "escape", "EvaluationContextProvider", "evaluationContextProvider", ",", "EscapeCharacter", "escape", ")", "{", "return", "new", "CreateQueryLookupStrategy", "(", "em", ",", "extractor", ",", "escape", ")", ";", "return", "new", "CreateIfNotFoundQueryLookupStrategy", "(", "em", ",", "extractor", ",", "new", "CreateQueryLookupStrategy", "(", "em", ",", "extractor", ",", "escape", ")", ",", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "private", "final", "EscapeCharacter", "escape", ";", "*", "@", "param", "escape", "PersistenceProvider", "provider", ",", "EscapeCharacter", "escape", ")", "{", "this", "(", "builder", ",", "accessor", ".", "iterator", "(", "),", "accessor", ".", "getParameters", "(", "),", "provider", ",", "escape", ")", ";", "*", "@", "param", "builder", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "escape", "public", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Parameters", "<", "?,", "?", ">", "parameters", ",", "PersistenceProvider", "provider", ",", "EscapeCharacter", "escape", ")", "{", "this", "(", "builder", ",", "null", ",", "parameters", ",", "provider", ",", "escape", ")", ";", "*", "@", "param", "escape", "Parameters", "<", "?,", "?", ">", "parameters", ",", "PersistenceProvider", "provider", ",", "EscapeCharacter", "escape", ")", "{", "this", ".", "escape", "=", "escape", ";", "ParameterMetadata", "<", "T", ">", "metadata", "=", "new", "ParameterMetadata", "<", ">(", "expression", ",", "part", ".", "getType", "(", "),", "value", ",", "persistenceProvider", ",", "escape", ")", ";", "EscapeCharacter", "getEscape", "(", ")", "{", "return", "escape", ";", "}", "private", "final", "EscapeCharacter", "escape", ";", "PersistenceProvider", "provider", ",", "EscapeCharacter", "escape", ")", "{", "this", ".", "escape", "=", "escape", ";", "return", "String", ".", "format", "(", "\"%", "s", "%", "%\"", ",", "escape", ".", "escape", "(", "value", ".", "toString", "(", "))", ");", "return", "String", ".", "format", "(", "\"%", "%%", "s", "\"", ",", "escape", ".", "escape", "(", "value", ".", "toString", "(", "))", ");", "return", "String", ".", "format", "(", "\"%", "%%", "s", "%", "%\"", ",", "escape", ".", "escape", "(", "value", ".", "toString", "(", "))", ");", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "private", "final", "EscapeCharacter", "escape", ";", "*", "@", "param", "escape", "PartTreeJpaQuery", "(", "JpaQueryMethod", "method", ",", "EntityManager", "em", ",", "PersistenceProvider", "persistenceProvider", ",", "EscapeCharacter", "escape", ")", "{", "this", ".", "escape", "=", "escape", ";", ".", "map", "(", "it", "-", ">", "new", "ParameterMetadataProvider", "(", "builder", ",", "it", ",", "persistenceProvider", ",", "escape", ")", ")/", "/", ".", "orElseGet", "(", "()", "-", ">", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ",", "escape", ")", ");", ".", "map", "(", "it", "-", ">", "new", "ParameterMetadataProvider", "(", "builder", ",", "it", ",", "persistenceProvider", ",", "escape", ")", ")/", "/", ".", "orElseGet", "(", "()", "-", ">", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ",", "escape", ")", ");", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ";", "Method", "escapeMethod", "=", "ReflectionUtils", ".", "findMethod", "(", "EscapeCharacter", ".", "class", ",", "\"", "escape", "\"", ",", "String", ".", "class", ",", "String", ".", "class", ")", ";", "Assert", ".", "notNull", "(", "escapeMethod", ",", "\"", "Escape", "method", "must", "not", "be", "null", ".", "\")", ";", "context", ".", "setVariable", "(", "\"", "escape", "\"", ",", "escapeMethod", ")", ";", "/", "*", "*", "Copyright", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ";", "import", "lombok", ".", "Value", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "/", "**", "*", "A", "Value", "-", "class", "encapsulating", "an", "escape", "character", "for", "LIKE", "queries", "and", "the", "actually", "usage", "of", "it", "in", "escaping", "Strings", ".", "*", "*", "@", "author", "Jens", "Schauder", "*", "/", "@", "Value", "(", "staticConstructor", "=", "\"", "of", "\"", ")", "public", "class", "EscapeCharacter", "{", "char", "value", ";", "public", "String", "escape", "(", "String", "value", ")", "{", "Assert", ".", "notNull", "(", "value", ",", "\"", "Value", "must", "be", "not", "null", ".", "\")", ";", "return", "value", ".", "replace", "(", "\"", "_", "\"", ",", "value", "+", "\"", "_", "\"", ").", "replace", "(", "\"%", "\",", "value", "+", "\"", "%\"", ");", "}", "/", "/", "used", "for", "SpEL", "expressions", "static", "String", "escape", "(", "String", "value", ",", "String", "escape", ")", "{", "Assert", ".", "hasText", "(", "escape", ",", "\"", "escape", "must", "be", "a", "sinlge", "character", "String", ".", "\")", ";", "char", "[", "]", "chars", "=", "escape", ".", "toCharArray", "(", ");", "Assert", ".", "isTrue", "(", "chars", ".", "length", "=", "=", "1", ",", "\"", "escape", "must", "be", "a", "single", "character", "String", ".", "\")", ";", "return", "EscapeCharacter", ".", "of", "(", "chars", "[", "0", "]", ").", "escape", "(", "value", ")", ";", "}", "}", "@", "@", "-", "48", ",", "7", "+", "48", ",", "7", "@", "@", "*", "private", "EscapeCharacter", "escapeCharacter", "=", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", ");", "*", "/", "*", "/", "**", "*", "Configures", "the", "escape", "character", "to", "be", "used", "for", "like", "-", "expressions", "created", "for", "derived", "queries", ".", "*", "*", "@", "param", "escapeCharacter", "a", "character", "used", "for", "escaping", "in", "certain", "like", "expressions", ".", "*", "/", "public", "void", "setEscapeCharacter", "(", "EscapeCharacter", "escapeCharacter", ")", "{", "this", ".", "escapeCharacter", "=", "escapeCharacter", ";", "}", "*", "*", "/", "*", "return", "Optional", ".", "of", "(", "JpaQueryLookupStrategy", ".", "create", "(", "entityManager", ",", "key", ",", "extractor", ",", "evaluationContextProvider", ",", "escapeCharacter", ")", ");", "*", "/", "*", "JpaRepositoryFactory", "jpaRepositoryFactory", "=", "new", "JpaRepositoryFactory", "(", "entityManager", ")", ";", "jpaRepositoryFactory", ".", "setEscapeCharacter", "(", "escapeCharacter", ")", ";", "return", "jpaRepositoryFactory", ";", "public", "void", "setEscapeCharacter", "(", "char", "escapeCharacter", ")", "{", "this", ".", "escapeCharacter", "=", "EscapeCharacter", ".", "of", "(", "escapeCharacter", ")", ";", "}", "@", "Test", "/", "/", "DATAJPA", "-", "1519", "public", "void", "parametersForContainsGetProperlyEscaped", "(", ")", "{", "assertThat", "(", "userRepository", ".", "findByFirstnameContaining", "(", "\"", "liv", "%", "\")", ",", "iterableWithSize", "(", "0", ")", ");", "}", "@", "Test", "/", "/", "DATAJPA", "-", "1519", "public", "void", "escapingInLikeSpels", "(", ")", "{", "assertThat", "(", "userRepository", ".", "findContainingEscaped", "(", "\"", "att_", "\"", "),", "iterableWithSize", "(", "0", ")", ");", "}", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "queryMethod", ".", "getParameters", "(", "),", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "EVALUATION_CONTEXT_PROVIDER", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "EVALUATION_CONTEXT_PROVIDER", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "ParameterMetadataProvider", "provider", "=", "new", "ParameterMetadataProvider", "(", "builder", ",", "accessor", ",", "persistenceProvider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "*;", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "PersistenceProvider", ".", "fromEntityManager", "(", "em", ")", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "*;", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "persistenceProvider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "AbstractJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", ".", "isThrownBy", "(", "()", "-", ">", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ")", "/", "/", ".", "isThrownBy", "(", "()", "-", ">", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ")", "/", "/", "PersistenceProvider", ".", "fromEntityManager", "(", "entityManager", ")", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "/", "/", "DATAJPA", "-", "1519", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "like", "%", "?#", "{#", "escape", "(", "[", "0", "]", ",'", "#'", ")}", "%", "escape", "'", "#'", "\")", "List", "<", "User", ">", "findContainingEscaped", "(", "String", "namePart", ")", ";</s><", "version", ">", "2", ".", "2", ".", "8", "<", "/", "version", ">", "CriteriaQuery", "<", "?", "extends", "Object", ">", "criteriaQuery", "=", "createCriteriaQuery", "(", "builder", ",", "type", ")", ";", "Predicate", "like", "=", "builder", ".", "like", "(", "propertyExpression", ",", "parameterExpression", ")", ";", "public", "CreateQueryLookupStrategy", "(", "EntityManager", "em", ",", "QueryExtractor", "extractor", ")", "{", "return", "new", "PartTreeJpaQuery", "(", "method", ",", "em", ",", "persistenceProvider", ")", ";", "EvaluationContextProvider", "evaluationContextProvider", ")", "{", "return", "new", "CreateQueryLookupStrategy", "(", "em", ",", "extractor", ")", ";", "return", "new", "CreateIfNotFoundQueryLookupStrategy", "(", "em", ",", "extractor", ",", "new", "CreateQueryLookupStrategy", "(", "em", ",", "extractor", ")", ",", "PersistenceProvider", "provider", ")", "{", "this", "(", "builder", ",", "accessor", ".", "iterator", "(", "),", "accessor", ".", "getParameters", "(", "),", "provider", ")", ";", "*", "@", "param", "builder", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "public", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Parameters", "<", "?,", "?", ">", "parameters", ",", "PersistenceProvider", "provider", ")", "{", "this", "(", "builder", ",", "null", ",", "parameters", ",", "provider", ")", ";", "Parameters", "<", "?,", "?", ">", "parameters", ",", "PersistenceProvider", "provider", ")", "{", "ParameterMetadata", "<", "T", ">", "metadata", "=", "new", "ParameterMetadata", "<", ">(", "expression", ",", "part", ".", "getType", "(", "),", "value", ",", "persistenceProvider", ")", ";", "PersistenceProvider", "provider", ")", "{", "return", "String", ".", "format", "(", "\"%", "s", "%", "%\"", ",", "value", ".", "toString", "(", "))", ";", "return", "String", ".", "format", "(", "\"%", "%%", "s", "\"", ",", "value", ".", "toString", "(", "))", ";", "return", "String", ".", "format", "(", "\"%", "%%", "s", "%", "%\"", ",", "value", ".", "toString", "(", "))", ";", "PartTreeJpaQuery", "(", "JpaQueryMethod", "method", ",", "EntityManager", "em", ",", "PersistenceProvider", "persistenceProvider", ")", "{", ".", "map", "(", "it", "-", ">", "new", "ParameterMetadataProvider", "(", "builder", ",", "it", ",", "persistenceProvider", ")", ")/", "/", ".", "orElseGet", "(", "()", "-", ">", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ")", ");", ".", "map", "(", "it", "-", ">", "new", "ParameterMetadataProvider", "(", "builder", ",", "it", ",", "persistenceProvider", ")", ")/", "/", ".", "orElseGet", "(", "()", "-", ">", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ")", ");", "*", "*", "/", "*", "*", "*", "/", "*", "return", "Optional", ".", "of", "(", "JpaQueryLookupStrategy", ".", "create", "(", "entityManager", ",", "key", ",", "extractor", ",", "evaluationContextProvider", ")", ");", "*", "/", "*", "return", "new", "JpaRepositoryFactory", "(", "entityManager", ")", ";", "queryMethod", ".", "getParameters", "(", "),", "provider", ")", ";", "EVALUATION_CONTEXT_PROVIDER", ")", ";", "EVALUATION_CONTEXT_PROVIDER", ")", ";", "ParameterMetadataProvider", "provider", "=", "new", "ParameterMetadataProvider", "(", "builder", ",", "accessor", ",", "persistenceProvider", ")", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "PersistenceProvider", ".", "fromEntityManager", "(", "em", ")", ");", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThatExceptionOfType", ";", "persistenceProvider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "AbstractJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ")", ";", ".", "isThrownBy", "(", "()", "-", ">", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ")", ")", "/", "/", ".", "isThrownBy", "(", "()", "-", ">", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ")", ")", "/", "/", "PersistenceProvider", ".", "fromEntityManager", "(", "entityManager", ")", ");"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["scsi:", "target:", "iscsi:", "Use", "hex2bin", "instead", "of", "a", "re-implementation", "This", "change", "has", "the", "following", "effects,", "in", "order", "of", "descreasing", "importance:", "1)", "Prevent", "a", "stack", "buffer", "overflow", "2)", "Do", "not", "append", "an", "unnecessary", "NULL", "to", "an", "anyway", "binary", "buffer,", "which", "is", "writing", "one", "byte", "past", "client_digest", "when", "caller", "is:", "chap_string_to_hex(client_digest,", "chap_r,", "strlen(chap_r));", "The", "latter", "was", "found", "by", "KASAN", "(see", "below)", "when", "input", "value", "hes", "expected", "size", "(32", "hex", "chars),", "and", "further", "analysis", "revealed", "a", "stack", "buffer", "overflow", "can", "happen", "when", "network-received", "value", "is", "longer,", "allowing", "an", "unauthenticated", "remote", "attacker", "to", "smash", "up", "to", "17", "bytes", "after", "destination", "buffer", "(16", "bytes", "attacker-controlled", "and", "one", "null).", "As", "switching", "to", "hex2bin", "requires", "specifying", "destination", "buffer", "length,", "and", "does", "not", "internally", "append", "any", "null,", "it", "solves", "both", "issues.", "This", "addresses", ".", "Beyond", "this:", "-", "Validate", "received", "value", "length", "and", "check", "hex2bin", "accepted", "the", "input,", "to", "log", "this", "rejection", "reason", "instead", "of", "just", "failing", "authentication.", "-", "Only", "log", "received", "CHAP_R", "and", "CHAP_C", "values", "once", "they", "passed", "sanity", "checks.", "==================================================================", "BUG:", "KASAN:", "stack-out-of-bounds", "in", "chap_string_to_hex+0x32/0x60", "[iscsi_target_mod]", "Write", "of", "size", "1", "at", "addr", "ffff8801090ef7c8", "by", "task", "kworker/0:0/1021", "CPU:", "0", "PID:", "1021", "Comm:", "kworker/0:0", "Tainted:", "G", "O", "4.17.8kasan.sess.connops+", "#2", "Hardware", "name:", "To", "be", "filled", "by", "O.E.M.", "To", "be", "filled", "by", "O.E.M./Aptio", "CRB,", "BIOS", "5.6.5", "05/19/2014", "Workqueue:", "events", "iscsi_target_do_login_rx", "[iscsi_target_mod]", "Call", "Trace:", "dump_stack+0x71/0xac", "print_address_description+0x65/0x22e", "?", "chap_string_to_hex+0x32/0x60", "[iscsi_target_mod]", "kasan_report.cold.6+0x241/0x2fd", "chap_string_to_hex+0x32/0x60", "[iscsi_target_mod]", "chap_server_compute_md5.isra.2+0x2cb/0x860", "[iscsi_target_mod]", "?", "chap_binaryhex_to_asciihex.constprop.5+0x50/0x50", "[iscsi_target_mod]", "?", "ftrace_caller_op_ptr+0xe/0xe", "?", "__orc_find+0x6f/0xc0", "?", "unwind_next_frame+0x231/0x850", "?", "kthread+0x1a0/0x1c0", "?", "ret_from_fork+0x35/0x40", "?", "ret_from_fork+0x35/0x40", "?", "iscsi_target_do_login_rx+0x3bc/0x4c0", "[iscsi_target_mod]", "?", "deref_stack_reg+0xd0/0xd0", "?", "iscsi_target_do_login_rx+0x3bc/0x4c0", "[iscsi_target_mod]", "?", "is_module_text_address+0xa/0x11", "?", "kernel_text_address+0x4c/0x110", "?", "__save_stack_trace+0x82/0x100", "?", "ret_from_fork+0x35/0x40", "?", "save_stack+0x8c/0xb0", "?", "0xffffffffc1660000", "?", "iscsi_target_do_login+0x155/0x8d0", "[iscsi_target_mod]", "?", "iscsi_target_do_login_rx+0x3bc/0x4c0", "[iscsi_target_mod]", "?", "process_one_work+0x35c/0x640", "?", "worker_thread+0x66/0x5d0", "?", "kthread+0x1a0/0x1c0", "?", "ret_from_fork+0x35/0x40", "?", "iscsi_update_param_value+0x80/0x80", "[iscsi_target_mod]", "?", "iscsit_release_cmd+0x170/0x170", "[iscsi_target_mod]", "chap_main_loop+0x172/0x570", "[iscsi_target_mod]", "?", "chap_server_compute_md5.isra.2+0x860/0x860", "[iscsi_target_mod]", "?", "rx_data+0xd6/0x120", "[iscsi_target_mod]", "?", "iscsit_print_session_params+0xd0/0xd0", "[iscsi_target_mod]", "?", "cyc2ns_read_begin.part.2+0x90/0x90", "?", "_raw_spin_lock_irqsave+0x25/0x50", "?", "memcmp+0x45/0x70", "iscsi_target_do_login+0x875/0x8d0", "[iscsi_target_mod]", "?", "iscsi_target_check_first_request.isra.5+0x1a0/0x1a0", "[iscsi_target_mod]", "?", "del_timer+0xe0/0xe0", "?", "memset+0x1f/0x40", "?", "flush_sigqueue+0x29/0xd0", "iscsi_target_do_login_rx+0x3bc/0x4c0", "[iscsi_target_mod]", "?", "iscsi_target_nego_release+0x80/0x80", "[iscsi_target_mod]", "?", "iscsi_target_restore_sock_callbacks+0x130/0x130", "[iscsi_target_mod]", "process_one_work+0x35c/0x640", "worker_thread+0x66/0x5d0", "?", "flush_rcu_work+0x40/0x40", "kthread+0x1a0/0x1c0", "?", "kthread_bind+0x30/0x30", "ret_from_fork+0x35/0x40", "The", "buggy", "address", "belongs", "to", "the", "page:", "page:ffffea0004243bc0", "count:0", "mapcount:0", "mapping:0000000000000000", "index:0x0", "flags:", "0x17fffc000000000()", "raw:", "017fffc000000000", "0000000000000000", "0000000000000000", "00000000ffffffff", "raw:", "ffffea0004243c20", "ffffea0004243ba0", "0000000000000000", "0000000000000000", "page", "dumped", "because:", "kasan:", "bad", "access", "detected", "Memory", "state", "around", "the", "buggy", "address:", "ffff8801090ef680:", "f2", "f2", "f2", "f2", "f2", "f2", "f2", "01", "f2", "f2", "f2", "f2", "f2", "f2", "f2", "00", "ffff8801090ef700:", "f2", "f2", "f2", "f2", "f2", "f2", "f2", "00", "02", "f2", "f2", "f2", "f2", "f2", "f2", "00", ">ffff8801090ef780:", "00", "f2", "f2", "f2", "f2", "f2", "f2", "00", "00", "f2", "f2", "f2", "f2", "f2", "f2", "00", "^", "ffff8801090ef800:", "00", "f2", "f2", "f2", "f2", "f2", "f2", "00", "00", "00", "00", "02", "f2", "f2", "f2", "f2", "ffff8801090ef880:", "f2", "f2", "f2", "00", "00", "00", "00", "00", "00", "00", "00", "f2", "f2", "f2", "f2", "00", "==================================================================", "Signed-off-by:", "Vincent", "Pelletier", "<plr.vincent@gmail.com>", "Reviewed-by:", "Mike", "Christie", "<mchristi@redhat.com>", "Signed-off-by:", "Martin", "K.", "Petersen", "<martin.petersen@oracle.com>"], "code_tokens": ["if", "(", "strlen", "(", "chap_r", ")", "!", "=", "MD5_SIGNATURE_SIZE", "*", "2", ")", "{", "pr_err", "(", "\"", "Malformed", "CHAP_R", "\\", "n", "\"", ");", "goto", "out", ";", "}", "if", "(", "hex2bin", "(", "client_digest", ",", "chap_r", ",", "MD5_SIGNATURE_SIZE", ")", "<", "0", ")", "{", "pr_err", "(", "\"", "Malformed", "CHAP_R", "\\", "n", "\"", ");", "goto", "out", ";", "}", "challenge_len", "=", "DIV_ROUND_UP", "(", "strlen", "(", "challenge", ")", ",", "2", ")", ";", "if", "(", "hex2bin", "(", "challenge_binhex", ",", "challenge", ",", "challenge_len", ")", "<", "0", ")", "{", "pr_err", "(", "\"", "Malformed", "CHAP_C", "\\", "n", "\"", ");", "goto", "out", ";", "}", "pr_debug", "(", "\"[", "server", "]", "Got", "CHAP_C", "=", "%", "s", "\\", "n", "\"", ",", "challenge", ")", ";</s>static", "int", "chap_string_to_hex", "(", "unsigned", "char", "*", "dst", ",", "unsigned", "char", "*", "src", ",", "int", "len", ")", "{", "int", "j", "=", "DIV_ROUND_UP", "(", "len", ",", "2", ")", ",", "rc", ";", "rc", "=", "hex2bin", "(", "dst", ",", "src", ",", "j", ")", ";", "if", "(", "rc", "<", "0", ")", "pr_debug", "(", "\"", "CHAP", "string", "contains", "non", "hex", "digit", "symbols", "\\", "n", "\"", ");", "dst", "[", "j", "]", "=", "'", "\\", "0", "'", ";", "return", "j", ";", "}", "chap_string_to_hex", "(", "client_digest", ",", "chap_r", ",", "strlen", "(", "chap_r", ")", ");", "pr_debug", "(", "\"[", "server", "]", "Got", "CHAP_C", "=", "%", "s", "\\", "n", "\"", ",", "challenge", ")", ";", "challenge_len", "=", "chap_string_to_hex", "(", "challenge_binhex", ",", "challenge", ",", "strlen", "(", "challenge", ")", ");"], "docstring_tokens": ["stack", "buffer", "overflow"]}
{"contents": ["tmpfs:", "fix", "use-after-free", "of", "mempolicy", "object", "The", "tmpfs", "remount", "logic", "preserves", "filesystem", "mempolicy", "if", "the", "mpol=M", "option", "is", "not", "specified", "in", "the", "remount", "request.", "A", "new", "policy", "can", "be", "specified", "if", "mpol=M", "is", "given.", "Before", "this", "patch", "remounting", "an", "mpol", "bound", "tmpfs", "without", "specifying", "mpol=", "mount", "option", "in", "the", "remount", "request", "would", "set", "the", "filesystem's", "mempolicy", "object", "to", "a", "freed", "mempolicy", "object.", "To", "reproduce", "the", "problem", "boot", "a", "DEBUG_PAGEALLOC", "kernel", "and", "run:", "#", "mkdir", "/tmp/x", "#", "mount", "-t", "tmpfs", "-o", "size=100M,mpol=interleave", "nodev", "/tmp/x", "#", "grep", "/tmp/x", "/proc/mounts", "nodev", "/tmp/x", "tmpfs", "rw,relatime,size=102400k,mpol=interleave:0-3", "0", "0", "#", "mount", "-o", "remount,size=200M", "nodev", "/tmp/x", "#", "grep", "/tmp/x", "/proc/mounts", "nodev", "/tmp/x", "tmpfs", "rw,relatime,size=204800k,mpol=???", "0", "0", "#", "note", "?", "garbage", "in", "mpol=...", "output", "above", "#", "dd", "if=/dev/zero", "of=/tmp/x/f", "count=1", "#", "panic", "here", "Panic:", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "(null)", "IP:", "[<", "(null)>]", "(null)", "[...]", "Oops:", "0010", "[#1]", "SMP", "DEBUG_PAGEALLOC", "Call", "Trace:", "mpol_shared_policy_init+0xa5/0x160", "shmem_get_inode+0x209/0x270", "shmem_mknod+0x3e/0xf0", "shmem_create+0x18/0x20", "vfs_create+0xb5/0x130", "do_last+0x9a1/0xea0", "path_openat+0xb3/0x4d0", "do_filp_open+0x42/0xa0", "do_sys_open+0xfe/0x1e0", "compat_sys_open+0x1b/0x20", "cstar_dispatch+0x7/0x1f", "Non-debug", "kernels", "will", "not", "crash", "immediately", "because", "referencing", "the", "dangling", "mpol", "will", "not", "cause", "a", "fault.", "Instead", "the", "filesystem", "will", "reference", "a", "freed", "mempolicy", "object,", "which", "will", "cause", "unpredictable", "behavior.", "The", "problem", "boils", "down", "to", "a", "dropped", "mpol", "reference", "below", "if", "shmem_parse_options()", "does", "not", "allocate", "a", "new", "mpol:", "config", "=", "*sbinfo", "shmem_parse_options(data,", "&config,", "true)", "mpol_put(sbinfo->mpol)", "sbinfo->mpol", "=", "config.mpol", "/*", "BUG:", "saves", "unreferenced", "mpol", "*/", "This", "patch", "avoids", "the", "crash", "by", "not", "releasing", "the", "mempolicy", "if", "shmem_parse_options()", "doesn't", "create", "a", "new", "mpol.", "How", "far", "back", "does", "this", "issue", "go?", "I", "see", "it", "in", "both", "2.6.36", "and", "3.3.", "I", "did", "not", "look", "back", "further.", "Signed-off-by:", "Greg", "Thelen", "<gthelen@google.com>", "Acked-by:", "Hugh", "Dickins", "<hughd@google.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["config", ".", "mpol", "=", "NULL", ";", "/", "*", "*", "Preserve", "previous", "mempolicy", "unless", "mpol", "remount", "option", "was", "specified", ".", "*", "/", "if", "(", "config", ".", "mpol", ")", "{", "mpol_put", "(", "sbinfo", "-", ">", "mpol", ")", ";", "sbinfo", "-", ">", "mpol", "=", "config", ".", "mpol", ";", "/", "*", "transfers", "initial", "ref", "*", "/", "}</s>mpol_put", "(", "sbinfo", "-", ">", "mpol", ")", ";", "sbinfo", "-", ">", "mpol", "=", "config", ".", "mpol", ";", "/", "*", "transfers", "initial", "ref", "*", "/"], "docstring_tokens": ["use-after-free", "error"]}
{"contents": ["CAMEL-10575:", "regenerate", "SnakeYAMLDataFormatConfiguration"], "code_tokens": ["import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "YAMLTypeFilterDefinition", ";", "/", "**", "*", "Allow", "any", "class", "to", "be", "un", "-", "marshaled", "*", "/", "private", "Boolean", "allowAnyType", "=", "false", ";", "/", "**", "*", "Set", "the", "types", "SnakeYAML", "is", "allowed", "to", "un", "-", "marshall", "*", "/", "private", "List", "<", "YAMLTypeFilterDefinition", ">", "typeFilter", ";", "public", "Boolean", "getAllowAnyType", "(", ")", "{", "return", "allowAnyType", ";", "}", "public", "void", "setAllowAnyType", "(", "Boolean", "allowAnyType", ")", "{", "this", ".", "allowAnyType", "=", "allowAnyType", ";", "}", "public", "List", "<", "YAMLTypeFilterDefinition", ">", "getTypeFilter", "(", ")", "{", "return", "typeFilter", ";", "}", "public", "void", "setTypeFilter", "(", "List", "<", "YAMLTypeFilterDefinition", ">", "typeFilter", ")", "{", "this", ".", "typeFilter", "=", "typeFilter", ";", "}</s>"], "docstring_tokens": ["object", "de-serialization"]}
{"contents": ["virtio-console:", "avoid", "DMA", "from", "stack", "put_chars()", "stuffs", "the", "buffer", "it", "gets", "into", "an", "sg,", "but", "that", "buffer", "may", "be", "on", "the", "stack.", "This", "breaks", "with", "CONFIG_VMAP_STACK=y", "(for", "me,", "it", "manifested", "as", "printks", "getting", "turned", "into", "NUL", "bytes).", "Signed-off-by:", "Omar", "Sandoval", "<osandov@fb.com>", "Signed-off-by:", "Michael", "S.", "Tsirkin", "<mst@redhat.com>", "Reviewed-by:", "Amit", "Shah", "<amit.shah@redhat.com>"], "code_tokens": ["void", "*", "data", ";", "int", "ret", ";", "data", "=", "kmemdup", "(", "buf", ",", "count", ",", "GFP_ATOMIC", ")", ";", "if", "(", "!", "data", ")", "return", "-", "ENOMEM", ";", "sg_init_one", "(", "sg", ",", "data", ",", "count", ")", ";", "ret", "=", "__send_to_port", "(", "port", ",", "sg", ",", "1", ",", "count", ",", "data", ",", "false", ")", ";", "kfree", "(", "data", ")", ";", "return", "ret", ";</s>sg_init_one", "(", "sg", ",", "buf", ",", "count", ")", ";", "return", "__send_to_port", "(", "port", ",", "sg", ",", "1", ",", "count", ",", "(", "void", "*", ")", "buf", ",", "false", ")", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["Refactor", "secret", "check", "Moving", "the", "check", "to", "start", "allows", "invalid", "configurations", "to", "be", "fixed", "via", "JMX", "and", "changes", "to", "be", "made", "followed", "by", "stop()/start()", "for", "those", "changes", "to", "take", "effect."], "code_tokens": ["public", "void", "start", "(", ")", "throws", "Exception", "{", "super", ".", "start", "(", ");</s>public", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ");"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["[KEYCLOAK-10779]", "-", "CSRF", "check", "to", "My", "Resources"], "code_tokens": ["public", "Response", "grantPermission", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "FormParam", "(", "\"", "action", "\"", ")", "String", "action", ",", "@", "FormParam", "(", "\"", "permission_id", "\"", ")", "String", "[", "]", "permissionId", ",", "@", "FormParam", "(", "\"", "requester", "\"", ")", "String", "requester", ",", "MultivaluedMap", "<", "String", ",", "String", ">", "formData", ")", "{", "if", "(", "auth", "=", "=", "null", ")", "{", "return", "login", "(", "\"", "resource", "\"", ");", "}", "auth", ".", "require", "(", "AccountRoles", ".", "MANAGE_ACCOUNT", ")", ";", "csrfCheck", "(", "formData", ")", ";", "public", "Response", "shareResource", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "FormParam", "(", "\"", "user_id", "\"", ")", "String", "[", "]", "userIds", ",", "@", "FormParam", "(", "\"", "scope_id", "\"", ")", "String", "[", "]", "scopes", ",", "MultivaluedMap", "<", "String", ",", "String", ">", "formData", ")", "{", "if", "(", "auth", "=", "=", "null", ")", "{", "return", "login", "(", "\"", "resource", "\"", ");", "}", "auth", ".", "require", "(", "AccountRoles", ".", "MANAGE_ACCOUNT", ")", ";", "csrfCheck", "(", "formData", ")", ";", "public", "Response", "processResourceActions", "(", "@", "FormParam", "(", "\"", "resource_id", "\"", ")", "String", "[", "]", "resourceIds", ",", "@", "FormParam", "(", "\"", "action", "\"", ")", "String", "action", ",", "MultivaluedMap", "<", "String", ",", "String", ">", "formData", ")", "{", "if", "(", "auth", "=", "=", "null", ")", "{", "return", "login", "(", "\"", "resource", "\"", ");", "}", "auth", ".", "require", "(", "AccountRoles", ".", "MANAGE_ACCOUNT", ")", ";", "csrfCheck", "(", "formData", ")", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "grantResource", "(", "name", ",", "requester", ")", ";", "}", "public", "void", "grantResource", "(", "String", "name", ",", "String", "requester", ")", "{", "revokeResource", "(", "name", ",", "requester", ")", ";", "}", "public", "void", "revokeResource", "(", "String", "name", ",", "String", "requester", ")", "{", "shareResource", "(", "user", ")", ";", "shareResource", "(", "user", ")", ";", "waitForPageToLoad", "(", ");", "}", "public", "void", "shareResource", "(", "String", "user", ")", "{", "WebElement", "userIdInput", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "user_id", "\"", "))", ";", "UIUtils", ".", "setTextInputValue", "(", "userIdInput", ",", "user", ")", ";", "pause", "(", "200", ")", ";", "/", "/", "We", "need", "to", "wait", "a", "bit", "for", "the", "form", "to", "\"", "accept", "\"", "the", "input", "(", "otherwise", "it", "registers", "the", "input", "as", "empty", ")", "waitUntilElement", "(", "userIdInput", ")", ".", "attribute", "(", "UIUtils", ".", "VALUE_ATTR_NAME", ")", ".", "contains", "(", "user", ")", ";", "}", "public", "void", "assertError", "(", ")", "{", "assertEquals", "(", "\"", "We", "'", "re", "sorry", ".", "..", "\",", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "kc", "-", "page", "-", "title", "\"", "))", ".", "getText", "(", "))", ";", "public", "void", "executeScript", "(", "String", "script", ")", "{", "testExecutor", ".", "executeScript", "(", "script", ")", ";", "}", "@", "Test", "public", "void", "testCsrfGrantAccess", "(", ")", "throws", "Exception", "{", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "createAlbum", "(", "ALICE_ALBUM_NAME", ",", "true", ")", ";", "loginToClientPage", "(", "jdoeUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "clientPage", ".", "deleteAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "clientPage", ".", "accountMyResources", "(", ");", "clientPage", ".", "executeScript", "(", "\"", "document", ".", "forms", "[", "0", "]", ".", "stateChecker", ".", "value", "=", "'", "invalid", "'", "\")", ";", "clientPage", ".", "grantResource", "(", "ALICE_ALBUM_NAME", ",", "\"", "jdoe", "\"", ");", "clientPage", ".", "assertError", "(", ");", "}", "@", "Test", "public", "void", "testCsrfRevokeResource", "(", ")", "throws", "Exception", "{", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "createAlbum", "(", "ALICE_ALBUM_NAME", ",", "true", ")", ";", "loginToClientPage", "(", "jdoeUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "clientPage", ".", "deleteAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasDenied", ")", ";", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "clientPage", ".", "accountGrantResource", "(", "ALICE_ALBUM_NAME", ",", "\"", "jdoe", "\"", ");", "clientPage", ".", "navigateTo", "(", ");", "testExecutor", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertInitNotAuth", ")", ".", "login", "(", "this", ":", ":", "assertOnTestAppUrl", ")", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertSuccessfullyLoggedIn", ")", ";", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "clientPage", ".", "accountMyResource", "(", "ALICE_ALBUM_NAME", ")", ";", "clientPage", ".", "executeScript", "(", "\"", "document", ".", "forms", "[", "0", "]", ".", "stateChecker", ".", "value", "=", "'", "invalid", "'", "\")", ";", "clientPage", ".", "revokeResource", "(", "ALICE_ALBUM_NAME", ",", "\"", "jdoe", "\"", ");", "clientPage", ".", "assertError", "(", ");", "}", "@", "Test", "public", "void", "testCrfCheckSharingResource", "(", ")", "throws", "Exception", "{", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "createAlbum", "(", "ALICE_ALBUM_NAME", ",", "true", ")", ";", "clientPage", ".", "accountMyResource", "(", "ALICE_ALBUM_NAME", ")", ";", "clientPage", ".", "executeScript", "(", "\"", "document", ".", "forms", "[", "'", "shareForm", "'", "].", "stateChecker", ".", "value", "=", "'", "invalid", "'", "\")", ";", "clientPage", ".", "shareResource", "(", "\"", "jdoe", "\"", ");", "clientPage", ".", "assertError", "(", ");", "clientPage", ".", "navigateTo", "(", ");", "testExecutor", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertInitNotAuth", ")", ".", "login", "(", ")", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertSuccessfullyLoggedIn", ")", ";", "loginToClientPage", "(", "aliceUser", ")", ";", "clientPage", ".", "accountMyResource", "(", "ALICE_ALBUM_NAME", ")", ";", "clientPage", ".", "shareResource", "(", "\"", "jdoe", "\"", ");", "clientPage", ".", "navigateTo", "(", ");", "testExecutor", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertInitNotAuth", ")", ".", "login", "(", "this", ":", ":", "assertOnTestAppUrl", ")", ".", "init", "(", "defaultArguments", "(", "),", "this", ":", ":", "assertSuccessfullyLoggedIn", ")", ";", "loginToClientPage", "(", "jdoeUser", ")", ";", "clientPage", ".", "viewAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "clientPage", ".", "deleteAlbum", "(", "ALICE_ALBUM_NAME", ",", "this", ":", ":", "assertWasNotDenied", ")", ";", "}", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "stateChecker", "\"", "name", "=", "\"", "stateChecker", "\"", "value", "=", "\"$", "{", "stateChecker", "}", "\"></s>public", "Response", "grantPermission", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "FormParam", "(", "\"", "action", "\"", ")", "String", "action", ",", "@", "FormParam", "(", "\"", "permission_id", "\"", ")", "String", "[", "]", "permissionId", ",", "@", "FormParam", "(", "\"", "requester", "\"", ")", "String", "requester", ")", "{", "public", "Response", "shareResource", "(", "@", "PathParam", "(", "\"", "resource_id", "\"", ")", "String", "resourceId", ",", "@", "FormParam", "(", "\"", "user_id", "\"", ")", "String", "[", "]", "userIds", ",", "@", "FormParam", "(", "\"", "scope_id", "\"", ")", "String", "[", "]", "scopes", ")", "{", "public", "Response", "processResourceActions", "(", "@", "FormParam", "(", "\"", "resource_id", "\"", ")", "String", "[", "]", "resourceIds", ",", "@", "FormParam", "(", "\"", "action", "\"", ")", "String", "action", ")", "{", "WebElement", "userIdInput", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "user_id", "\"", "))", ";", "UIUtils", ".", "setTextInputValue", "(", "userIdInput", ",", "user", ")", ";", "pause", "(", "200", ")", ";", "/", "/", "We", "need", "to", "wait", "a", "bit", "for", "the", "form", "to", "\"", "accept", "\"", "the", "input", "(", "otherwise", "it", "registers", "the", "input", "as", "empty", ")", "waitUntilElement", "(", "userIdInput", ")", ".", "attribute", "(", "UIUtils", ".", "VALUE_ATTR_NAME", ")", ".", "contains", "(", "user", ")", ";", "WebElement", "shareButton", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "share", "-", "button", "\"", "))", ";", "waitUntilElement", "(", "shareButton", ")", ".", "is", "(", ").", "clickable", "(", ");", "shareButton", ".", "click", "(", ");", "WebElement", "userIdInput", "=", "driver", ".", "findElement", "(", "By", ".", "id", "(", "\"", "user_id", "\"", "))", ";", "UIUtils", ".", "setTextInputValue", "(", "userIdInput", ",", "user", ")", ";", "pause", "(", "200", ")", ";", "/", "/", "We", "need", "to", "wait", "a", "bit", "for", "the", "form", "to", "\"", "accept", "\"", "the", "input", "(", "otherwise", "it", "registers", "the", "input", "as", "empty", ")", "waitUntilElement", "(", "userIdInput", ")", ".", "attribute", "(", "UIUtils", ".", "VALUE_ATTR_NAME", ")", ".", "contains", "(", "user", ")", ";", "waitForPageToLoad", "(", ");"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["Fix", "bug", "#73768", "-", "Memory", "corruption", "when", "loading", "hostile", "phar"], "code_tokens": ["spprintf", "(", "error", ",", "0", ",", "\"", "cannot", "load", "phar", "\\", "\"%", "s", "\\", "\"", "with", "implicit", "alias", "\\", "\"%", ".*", "s", "\\", "\"", "under", "different", "alias", "\\", "\"%", "s", "\\", "\"\"", ",", "fname", ",", "tmp_len", ",", "buffer", ",", "alias", ")", ";", "-", "-", "TEST", "-", "-", "Phar", ":", "PHP", "bug", "#", "73768", ":", "Memory", "corruption", "when", "loading", "hostile", "phar", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "phar", "\"", "))", "die", "(", "\"", "skip", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "chdir", "(", "__DIR__", ")", ";", "try", "{", "$", "p", "=", "Phar", ":", ":", "LoadPhar", "(", "'", "bug73768", ".", "phar", "'", ",", "'", "alias", ".", "phar", "'", ");", "echo", "\"", "OK", "\\", "n", "\"", ";", "}", "catch", "(", "PharException", "$", "e", ")", "{", "echo", "$", "e", "-", ">", "getMessage", "(", ");", "}", "?", ">", "-", "-", "EXPECTF", "-", "-", "cannot", "load", "phar", "\"", "%", "sbug73768", ".", "phar", "\"", "with", "implicit", "alias", "\"", "\"", "under", "different", "alias", "\"", "alias", ".", "phar", "\"</s>buffer", "[", "tmp_len", "]", "=", "'", "\\", "0", "'", ";", "spprintf", "(", "error", ",", "0", ",", "\"", "cannot", "load", "phar", "\\", "\"%", "s", "\\", "\"", "with", "implicit", "alias", "\\", "\"%", "s", "\\", "\"", "under", "different", "alias", "\\", "\"%", "s", "\\", "\"\"", ",", "fname", ",", "buffer", ",", "alias", ")", ";"], "docstring_tokens": ["off-by-one", "error"]}
{"contents": ["Fix", "bug", "#68601", "buffer", "read", "overflow", "in", "gd_gif_in.c"], "code_tokens": ["-", "GD", ":", ".", "Fixed", "bug", "#", "68601", "(", "buffer", "read", "overflow", "in", "gd_gif_in", ".", "c", ")", ".", "(", "Remi", ")", "#", "define", "CSD_BUF_SIZE", "280", "unsigned", "char", "buf", "[", "CSD_BUF_SIZE", "]", ";", "if", "(", "i", "<", "CSD_BUF_SIZE", "*", "8", ")", "{", "ret", "|", "=", "(", "(", "scd", "-", ">", "buf", "[", "i", "/", "8", "]", "&", "(", "1", "<", "<", "(", "i", "%", "8", ")", "))", "!", "=", "0", ")", "<", "<", "j", ";", "}", "else", "{", "ret", "=", "-", "1", ";", "break", ";", "}</s>-", "SOAP", ":", "unsigned", "char", "buf", "[", "280", "]", ";", "ret", "|", "=", "(", "(", "scd", "-", ">", "buf", "[", "i", "/", "8", "]", "&", "(", "1", "<", "<", "(", "i", "%", "8", ")", "))", "!", "=", "0", ")", "<", "<", "j", ";"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["TTY:", "do", "not", "update", "atime/mtime", "on", "read/write", "On", "http://vladz.devzero.fr/013_ptmx-timing.php,", "we", "can", "see", "how", "to", "find", "out", "length", "of", "a", "password", "using", "timestamps", "of", "/dev/ptmx.", "It", "is", "documented", "in", "\"Timing", "Analysis", "of", "Keystrokes", "and", "Timing", "Attacks", "on", "SSH\".", "To", "avoid", "that", "problem,", "do", "not", "update", "time", "when", "reading", "from/writing", "to", "a", "TTY.", "I", "am", "afraid", "of", "regressions", "as", "this", "is", "a", "behavior", "we", "have", "since", "0.97", "and", "apps", "may", "expect", "the", "time", "to", "be", "current,", "e.g.", "for", "monitoring", "whether", "there", "was", "a", "change", "on", "the", "TTY.", "Now,", "there", "is", "no", "change.", "So", "this", "would", "better", "have", "a", "lot", "of", "testing", "before", "it", "goes", "upstream.", "References:", "Signed-off-by:", "Jiri", "Slaby", "<jslaby@suse.cz>", "Cc:", "stable", "<stable@vger.kernel.org>", "#", "after", "3.9", "is", "out", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["if", "(", "written", ")</s>if", "(", "i", ">", "0", ")", "inode", "-", ">", "i_atime", "=", "current_fs_time", "(", "inode", "-", ">", "i_sb", ")", ";", "if", "(", "written", ")", "{", "struct", "inode", "*", "inode", "=", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ";", "inode", "-", ">", "i_mtime", "=", "current_fs_time", "(", "inode", "-", ">", "i_sb", ")", ";", "}"], "docstring_tokens": ["key", "stroke", "timing", "local", "disclosure"]}
{"contents": ["econet:", "Fix", "econet_getname()", "leak", "econet_getname()", "can", "leak", "kernel", "memory", "to", "user.", "Signed-off-by:", "Eric", "Dumazet", "<eric.dumazet@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "sec", ",", "0", ",", "sizeof", "(", "*", "sec", ")", ");</s>"], "docstring_tokens": ["8-bytes", "kernel", "stack", "disclosure"]}
{"contents": ["Prevent", "memory", "use", "after", "free"], "code_tokens": ["*", "Prevent", "memory", "use", "after", "free", "(", "reference", "https", ":", "//", "www", ".", "imagemagick", ".", "org", "/", "discourse", "-", "server", "/", "viewtopic", ".", "php", "?", "f", "=", "3", "&", "t", "=", "30245", ")", ".</s>(", "void", ")", "CloseBlob", "(", "pwp_image", ")", ";", "pwp_image", "=", "DestroyImage", "(", "pwp_image", ")", ";"], "docstring_tokens": ["use-after-free", "error"]}
{"contents": ["mm/hotplug:", "correctly", "add", "new", "zone", "to", "all", "other", "nodes'", "zone", "lists", "When", "online_pages()", "is", "called", "to", "add", "new", "memory", "to", "an", "empty", "zone,", "it", "rebuilds", "all", "zone", "lists", "by", "calling", "build_all_zonelists().", "But", "there's", "a", "bug", "which", "prevents", "the", "new", "zone", "to", "be", "added", "to", "other", "nodes'", "zone", "lists.", "online_pages()", "{", "build_all_zonelists()", ".....", "node_set_state(zone_to_nid(zone),", "N_HIGH_MEMORY)", "}", "Here", "the", "node", "of", "the", "zone", "is", "put", "into", "N_HIGH_MEMORY", "state", "after", "calling", "build_all_zonelists(),", "but", "build_all_zonelists()", "only", "adds", "zones", "from", "nodes", "in", "N_HIGH_MEMORY", "state", "to", "the", "fallback", "zone", "lists.", "build_all_zonelists()", "->__build_all_zonelists()", "->build_zonelists()", "->find_next_best_node()", "->for_each_node_state(n,", "N_HIGH_MEMORY)", "So", "memory", "in", "the", "new", "zone", "will", "never", "be", "used", "by", "other", "nodes,", "and", "it", "may", "cause", "strange", "behavor", "when", "system", "is", "under", "memory", "pressure.", "So", "put", "node", "into", "N_HIGH_MEMORY", "state", "before", "calling", "build_all_zonelists().", "Signed-off-by:", "Jianguo", "Wu", "<wujianguo@huawei.com>", "Signed-off-by:", "Jiang", "Liu", "<liuj97@gmail.com>", "Cc:", "Mel", "Gorman", "<mgorman@suse.de>", "Cc:", "Michal", "Hocko", "<mhocko@suse.cz>", "Cc:", "Minchan", "Kim", "<minchan@kernel.org>", "Cc:", "Rusty", "Russell", "<rusty@rustcorp.com.au>", "Cc:", "Yinghai", "Lu", "<yinghai@kernel.org>", "Cc:", "Tony", "Luck", "<tony.luck@intel.com>", "Cc:", "KAMEZAWA", "Hiroyuki", "<kamezawa.hiroyu@jp.fujitsu.com>", "Cc:", "KOSAKI", "Motohiro", "<kosaki.motohiro@jp.fujitsu.com>", "Cc:", "David", "Rientjes", "<rientjes@google.com>", "Cc:", "Keping", "Chen", "<chenkeping@huawei.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "onlined_pages", ")", "{", "node_set_state", "(", "zone_to_nid", "(", "zone", ")", ",", "N_HIGH_MEMORY", ")", ";", "if", "(", "need_zonelists_rebuild", ")", "build_all_zonelists", "(", "NULL", ",", "zone", ")", ";", "else", "zone_pcp_update", "(", "zone", ")", ";", "}", "if", "(", "onlined_pages", ")</s>if", "(", "need_zonelists_rebuild", ")", "build_all_zonelists", "(", "NULL", ",", "zone", ")", ";", "else", "zone_pcp_update", "(", "zone", ")", ";", "if", "(", "onlined_pages", ")", "{", "node_set_state", "(", "zone_to_nid", "(", "zone", ")", ",", "N_HIGH_MEMORY", ")", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["UNDERTOW-1667", "Change", "AjpRequestParser", "to", "ignore", "unknown", "request", "attributes", "and", "add", "a", "new", "UndertowOption", "AJP_ALLOWED_REQUEST_ATTRIBUTES_PATTERN"], "code_tokens": ["/", "**", "*", "The", "AJP", "protocol", "itself", "supports", "the", "passing", "of", "arbitrary", "request", "attributes", ".", "*", "The", "reverse", "proxy", "passes", "various", "information", "to", "the", "AJP", "connector", "using", "request", "attributes", "through", "AJP", "protocol", ".", "*", "Unrecognised", "request", "attributes", "will", "be", "ignored", "unless", "the", "entire", "attribute", "name", "matches", "this", "regular", "expression", ".", "*", "*", "If", "not", "specified", ",", "the", "default", "value", "is", "null", ".", "*", "/", "public", "static", "final", "Option", "<", "String", ">", "AJP_ALLOWED_REQUEST_ATTRIBUTES_PATTERN", "=", "Option", ".", "simple", "(", "UndertowOptions", ".", "class", ",", "\"", "AJP_ALLOWED_REQUEST_ATTRIBUTES_PATTERN", "\"", ",", "String", ".", "class", ")", ";", "private", "static", "final", "String", "DEFAULT_AJP_ALLOWED_REQUEST_ATTRIBUTES_PATTERN", "=", "SecurityActions", ".", "getSystemProperty", "(", "\"", "io", ".", "undertow", ".", "ajp", ".", "allowedRequestAttributesPattern", "\"", ");", "parser", "=", "new", "AjpRequestParser", "(", "undertowOptions", ".", "get", "(", "URL_CHARSET", ",", "StandardCharsets", ".", "UTF_8", ".", "name", "(", "))", ",", "undertowOptions", ".", "get", "(", "DECODE_URL", ",", "true", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "MAX_PARAMETERS", ",", "UndertowOptions", ".", "DEFAULT_MAX_PARAMETERS", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "MAX_HEADERS", ",", "UndertowOptions", ".", "DEFAULT_MAX_HEADERS", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "ALLOW_ENCODED_SLASH", ",", "false", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "ALLOW_UNESCAPED_CHARACTERS_IN_URL", ",", "false", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "AJP_ALLOWED_REQUEST_ATTRIBUTES_PATTERN", ",", "DEFAULT_AJP_ALLOWED_REQUEST_ATTRIBUTES_PATTERN", ")", ");", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "private", "final", "Pattern", "allowedRequestAttributesPattern", ";", "this", "(", "encoding", ",", "doDecode", ",", "maxParameters", ",", "maxHeaders", ",", "allowEncodedSlash", ",", "allowUnescapedCharactersInUrl", ",", "null", ")", ";", "}", "public", "AjpRequestParser", "(", "String", "encoding", ",", "boolean", "doDecode", ",", "int", "maxParameters", ",", "int", "maxHeaders", ",", "boolean", "allowEncodedSlash", ",", "boolean", "allowUnescapedCharactersInUrl", ",", "String", "allowedRequestAttributesPattern", ")", "{", "if", "(", "allowedRequestAttributesPattern", "!", "=", "null", "&", "&", "!", "allowedRequestAttributesPattern", ".", "isEmpty", "(", "))", "{", "this", ".", "allowedRequestAttributesPattern", "=", "Pattern", ".", "compile", "(", "allowedRequestAttributesPattern", ")", ";", "}", "else", "{", "this", ".", "allowedRequestAttributesPattern", "=", "null", ";", "}", "}", "else", "{", "/", "/", "other", "attributes", "if", "(", "state", ".", "attributes", "=", "=", "null", ")", "{", "boolean", "isUnknownAttribute", "=", "true", ";", "/", "/", "known", "attirubtes", "for", "(", "String", "attr", ":", "ATTRIBUTES", ")", "{", "if", "(", "state", ".", "currentAttribute", ".", "equals", "(", "attr", ")", ")", "{", "state", ".", "attributes", ".", "put", "(", "state", ".", "currentAttribute", ",", "result", ")", ";", "isUnknownAttribute", "=", "false", ";", "break", ";", "}", "}", "/", "/", "unknown", "attributes", "if", "(", "isUnknownAttribute", "&", "&", "allowedRequestAttributesPattern", "!", "=", "null", ")", "{", "/", "/", "custom", "allowed", "attributes", "Matcher", "m", "=", "allowedRequestAttributesPattern", ".", "matcher", "(", "state", ".", "currentAttribute", ")", ";", "if", "(", "m", ".", "matches", "(", "))", "{", "state", ".", "attributes", ".", "put", "(", "state", ".", "currentAttribute", ",", "result", ")", ";", "}", "}", "/", "*", "*", "JBoss", ",", "Home", "of", "Professional", "Open", "Source", ".", "*", "Copyright", "2020", "Red", "Hat", ",", "Inc", ".", ",", "and", "individual", "contributors", "*", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "io", ".", "undertow", ".", "server", ".", "protocol", ".", "ajp", ";", "import", "static", "java", ".", "lang", ".", "System", ".", "getProperty", ";", "import", "static", "java", ".", "lang", ".", "System", ".", "getSecurityManager", ";", "import", "static", "java", ".", "security", ".", "AccessController", ".", "doPrivileged", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "/", "**", "*", "Security", "actions", "to", "access", "system", "environment", "information", ".", "No", "methods", "in", "*", "this", "class", "are", "to", "be", "made", "public", "under", "any", "circumstances", "!", "*", "/", "final", "class", "SecurityActions", "{", "private", "SecurityActions", "(", ")", "{", "/", "/", "forbidden", "inheritance", "}", "static", "String", "getSystemProperty", "(", "final", "String", "key", ")", "{", "return", "getSecurityManager", "(", ")", "=", "=", "null", "?", "getProperty", "(", "key", ")", ":", "doPrivileged", "(", "new", "PrivilegedAction", "<", "String", ">", "()", "{", "@", "Override", "public", "String", "run", "(", ")", "{", "return", "getProperty", "(", "key", ")", ";", "}", "}", ");", "}", "}</s>parser", "=", "new", "AjpRequestParser", "(", "undertowOptions", ".", "get", "(", "URL_CHARSET", ",", "StandardCharsets", ".", "UTF_8", ".", "name", "(", "))", ",", "undertowOptions", ".", "get", "(", "DECODE_URL", ",", "true", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "MAX_PARAMETERS", ",", "UndertowOptions", ".", "DEFAULT_MAX_PARAMETERS", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "MAX_HEADERS", ",", "UndertowOptions", ".", "DEFAULT_MAX_HEADERS", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "ALLOW_ENCODED_SLASH", ",", "false", ")", ",", "undertowOptions", ".", "get", "(", "UndertowOptions", ".", "ALLOW_UNESCAPED_CHARACTERS_IN_URL", ",", "false", ")", ");", "}", "else", "{", "/", "/", "other", "attributes", "if", "(", "state", ".", "attributes", "=", "=", "null", ")", "{", "state", ".", "attributes", ".", "put", "(", "state", ".", "currentAttribute", ",", "result", ")", ";"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["Mixed", "polishing", "along", "with", "recent", "changes", "(cherry", "picked", "from", "commit", "14e5a02)"], "code_tokens": ["*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "*", "Spring", "'", "s", "central", "cache", "manager", "SPI", ".", "*", "Allows", "for", "retrieving", "named", "{", "@", "link", "Cache", "}", "regions", ".", "*", "@", "param", "name", "the", "cache", "identifier", "(", "must", "not", "be", "{", "@", "code", "null", "}", ")", "*", "@", "return", "the", "associated", "cache", ",", "or", "{", "@", "code", "null", "}", "if", "none", "found", "*", "Return", "a", "collection", "of", "the", "cache", "names", "known", "by", "this", "manager", ".", "*", "@", "return", "the", "names", "of", "all", "caches", "known", "by", "the", "cache", "manager", "Expression", "expr", "=", "parser", ".", "parseExpression", "(", "\"", "testBean", ".", "properties", "[", "'", "key2", "'", "]\"", ");", "assertEquals", "(", "\"", "value2", "\"", ",", "expr", ".", "getValue", "(", "bean", ")", ");", "}", "@", "Test", "public", "void", "testGetValueFromRootMap", "(", ")", "{", "Map", "<", "String", ",", "String", ">", "map", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "map", ".", "put", "(", "\"", "key", "\"", ",", "\"", "value", "\"", ");", "EvaluationContext", "context", "=", "new", "StandardEvaluationContext", "(", "map", ")", ";", "ExpressionParser", "spelExpressionParser", "=", "new", "SpelExpressionParser", "(", ");", "Expression", "expr", "=", "spelExpressionParser", ".", "parseExpression", "(", "\"#", "root", "[", "'", "key", "'", "]\"", ");", "assertEquals", "(", "\"", "value", "\"", ",", "expr", ".", "getValue", "(", "map", ")", ");", "*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "public", "RollbackRuleAttribute", "(", "Class", "<", "?>", "clazz", ")", "{", "Assert", ".", "notNull", "(", "clazz", ",", "\"", "'", "clazz", "'", "cannot", "be", "null", "\"", ");", "Assert", ".", "hasText", "(", "exceptionName", ",", "\"", "'", "exceptionName", "'", "cannot", "be", "null", "or", "empty", "\"", ");", "private", "int", "getDepth", "(", "Class", "<", "?>", "exceptionClass", ",", "int", "depth", ")", "{", "if", "(", "exceptionClass", ".", "getName", "(", ").", "contains", "(", "this", ".", "exceptionName", ")", ")", "{", "*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "/", "/", "should", "never", "happen", ".", "..", "throw", "new", "UnsupportedOperationException", "(", "\"", "Unknown", "parameter", "type", ":", "\"", "+", "paramType", "+", "\"", "in", "method", ":", "\"", "+", "parameter", ".", "getMethod", "(", "))", ";", "*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UriUtils", ";", "writeOptionalAttribute", "(", "tagWriter", ",", "METHOD_ATTRIBUTE", ",", "getHttpMethod", "(", "))", ";", "private", "String", "getHttpMethod", "(", ")", "{", "return", "(", "isMethodBrowserSupported", "(", "getMethod", "(", "))", "?", "getMethod", "(", ")", ":", "DEFAULT_METHOD", ")", ";", "}", "if", "(", "servletRelativeAction", ".", "startsWith", "(", "\"/", "\")", "&", "&", "!", "servletRelativeAction", ".", "startsWith", "(", "getRequestContext", "(", ").", "getContextPath", "(", "))", ")", "{", "String", "encoding", "=", "this", ".", "pageContext", ".", "getResponse", "(", ").", "getCharacterEncoding", "(", ");", "try", "{", "requestUri", "=", "UriUtils", ".", "encodePath", "(", "requestUri", ",", "encoding", ")", ";", "}", "catch", "(", "UnsupportedEncodingException", "ex", ")", "{", "/", "/", "shouldn", "'", "t", "happen", "-", "if", "it", "does", ",", "proceed", "with", "requestUri", "as", "-", "is", "}", "if", "(", "processor", "!", "=", "null", "&", "&", "request", "instanceof", "HttpServletRequest", ")", "{</s>*", "Copyright", "2002", "-", "2011", "the", "original", "author", "or", "authors", ".", "*", "A", "manager", "for", "a", "set", "of", "{", "@", "link", "Cache", "}", "s", ".", "*", "@", "param", "name", "cache", "identifier", "(", "must", "not", "be", "{", "@", "code", "null", "}", ")", "*", "@", "return", "associated", "cache", ",", "or", "{", "@", "code", "null", "}", "if", "none", "is", "found", "*", "Return", "a", "collection", "of", "the", "caches", "known", "by", "this", "cache", "manager", ".", "*", "@", "return", "names", "of", "caches", "known", "by", "the", "cache", "manager", ".", "Expression", "exp", "=", "parser", ".", "parseExpression", "(", "\"", "testBean", ".", "properties", "[", "'", "key2", "'", "]\"", ");", "String", "key", "=", "(", "String", ")", "exp", ".", "getValue", "(", "bean", ")", ";", "assertNotNull", "(", "key", ")", ";", "*", "Copyright", "2002", "-", "2012", "the", "original", "author", "or", "authors", ".", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "public", "RollbackRuleAttribute", "(", "Class", "clazz", ")", "{", "Assert", ".", "notNull", "(", "clazz", ",", "\"", "'", "clazz", "'", "cannot", "be", "null", ".", "\")", ";", "Assert", ".", "hasText", "(", "exceptionName", ",", "\"", "'", "exceptionName", "'", "cannot", "be", "null", "or", "empty", ".", "\")", ";", "private", "int", "getDepth", "(", "Class", "exceptionClass", ",", "int", "depth", ")", "{", "if", "(", "exceptionClass", ".", "getName", "(", ").", "indexOf", "(", "this", ".", "exceptionName", ")", "!", "=", "-", "1", ")", "{", "*", "Copyright", "2002", "-", "2012", "the", "original", "author", "or", "authors", ".", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "/", "/", "should", "never", "happen", ".", ".", "Method", "method", "=", "parameter", ".", "getMethod", "(", ");", "throw", "new", "UnsupportedOperationException", "(", "\"", "Unknown", "parameter", "type", ":", "\"", "+", "paramType", "+", "\"", "in", "method", ":", "\"", "+", "method", ")", ";", "*", "Copyright", "2002", "-", "2013", "the", "original", "author", "or", "authors", ".", "writeOptionalAttribute", "(", "tagWriter", ",", "METHOD_ATTRIBUTE", ",", "isMethodBrowserSupported", "(", "getMethod", "(", "))", "?", "getMethod", "(", ")", ":", "DEFAULT_METHOD", ")", ";", "*", "if", "(", "servletRelativeAction", ".", "startsWith", "(", "\"/", "\")", "&", "&", "!", "servletRelativeAction", ".", "startsWith", "(", "getRequestContext", "(", ").", "getContextPath", "(", "))", ")", "{", "if", "(", "(", "processor", "!", "=", "null", ")", "&", "&", "(", "request", "instanceof", "HttpServletRequest", ")", ")", "{"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["Fix", "assignment", "to", "proto.", "Closes", "#34."], "code_tokens": ["return", "!", "/", "__proto__", "/", ".", "test", "(", "path", ")", "&", "&", "(", "(", "path", "=", "path", ".", "split", "?", "path", ".", "split", "(", "'.", "')", ":", "path", ".", "slice", "(", "0", ")", ").", "slice", "(", "0", ",", "-", "1", ")", ".", "reduce", "(", "function", "(", "obj", ",", "p", ")", "{", "\"", "set", "(", "obj", ",", "'", "__proto__", "'", ",", "'", "foo", "'", ")\"", ":", "{", "key", ":", "\"", "__proto__", "\"", ",", "value", ":", "\"", "foo", "\"", ",", "expected", ":", "{", "}", "}", ",", "\"", "set", "(", "obj", ",", "'", "a", ".", "__proto__", "'", ",", "'", "foo", "'", ")\"", ":", "{", "key", ":", "\"", "__proto__", "\"", ",", "value", ":", "\"", "foo", "\"", ",", "expected", ":", "{", "a", ":", "undefined", "}", "}", ",</s>return", "(", "(", "path", "=", "path", ".", "split", "?", "path", ".", "split", "(", "'.", "')", ":", "path", ".", "slice", "(", "0", ")", ").", "slice", "(", "0", ",", "-", "1", ")", ".", "reduce", "(", "function", "(", "obj", ",", "p", ")", "{"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["USB:", "iowarrior:", "fix", "NULL-deref", "at", "probe", "Make", "sure", "to", "check", "for", "the", "required", "interrupt-in", "endpoint", "to", "avoid", "dereferencing", "a", "NULL-pointer", "should", "a", "malicious", "device", "lack", "such", "an", "endpoint.", "Note", "that", "a", "fairly", "recent", "change", "purported", "to", "fix", "this", "issue,", "but", "added", "an", "insufficient", "test", "on", "the", "number", "of", "endpoints", "only,", "a", "test", "which", "can", "now", "be", "removed.", "Fixes:", "4ec0ef3a8212", "(\"USB:", "iowarrior:", "fix", "oops", "with", "malicious", "USB", "descriptors\")", "Fixes:", "946b960d13c1", "(\"USB:", "add", "driver", "for", "iowarrior", "devices.\")", "Cc:", "stable", "<stable@vger.kernel.org>", "#", "2.6.21", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["if", "(", "!", "dev", "-", ">", "int_in_endpoint", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "no", "interrupt", "-", "in", "endpoint", "found", "\\", "n", "\"", ");", "retval", "=", "-", "ENODEV", ";", "goto", "error", ";", "}</s>if", "(", "iface_desc", "-", ">", "desc", ".", "bNumEndpoints", "<", "1", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "Invalid", "number", "of", "endpoints", "\\", "n", "\"", ");", "retval", "=", "-", "EINVAL", ";", "goto", "error", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["tuntap:", "correctly", "handle", "error", "in", "tun_set_iff()", "Commit", "c8d68e6be1c3b242f1c598595830890b65cea64a", "(tuntap:", "multiqueue", "support)", "only", "call", "free_netdev()", "on", "error", "in", "tun_set_iff().", "This", "causes", "several", "issues:", "-", "memory", "of", "tun", "security", "were", "leaked", "-", "use", "after", "free", "since", "the", "flow", "gc", "timer", "was", "not", "deleted", "and", "the", "tfile", "were", "not", "detached", "This", "patch", "solves", "the", "above", "issues.", "Reported-by:", "Wannes", "Rombouts", "<wannes.rombouts@epitech.eu>", "Cc:", "Michael", "S.", "Tsirkin", "<mst@redhat.com>", "Signed-off-by:", "Jason", "Wang", "<jasowang@redhat.com>", "Acked-by:", "Michael", "S.", "Tsirkin", "<mst@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["goto", "err_free_flow", ";", "goto", "err_detach", ";", "err_detach", ":", "tun_detach_all", "(", "dev", ")", ";", "err_free_flow", ":", "tun_flow_uninit", "(", "tun", ")", ";", "security_tun_dev_free_security", "(", "tun", "-", ">", "security", ")", ";", "err_free_dev", ":</s>goto", "err_free_dev", ";", "goto", "err_free_dev", ";", "err_free_dev", ":"], "docstring_tokens": ["use-after-free", "error"]}
{"contents": ["More", "normalization", "edge", "cases", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1700898", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["if", "(", "normalized", ".", "equals", "(", "\"/", ".\"", "))", "{", "return", "\"", "/\"", ";", "}", "if", "(", "normalized", ".", "equals", "(", "\"/", "..", "\")", ")", "{", "return", "null", ";", "/", "/", "Trying", "to", "go", "outside", "our", "context", "}", "@", "Test", "public", "void", "testNormalize14", "(", ")", "{", "doTestNormalize", "(", "\"/", "/.", ".\"", ",", "null", ")", ";", "}", "@", "Test", "public", "void", "testNormalize15", "(", ")", "{", "doTestNormalize", "(", "\"/", "/.", "./", "\",", "null", ")", ";", "}", "@", "Test", "public", "void", "testNormalize16", "(", ")", "{", "doTestNormalize", "(", "\"/", "./", "..", "\",", "null", ")", ";", "}", "@", "Test", "public", "void", "testNormalize17", "(", ")", "{", "doTestNormalize", "(", "\"/", "./", "..", "/\"", ",", "null", ")", ";", "}", "@", "Test", "public", "void", "testNormalize18", "(", ")", "{", "doTestNormalize", "(", "\"/", "a", "/", "..", "/.", ".\"", ",", "null", ")", ";", "}", "@", "Test", "public", "void", "testNormalize19", "(", ")", "{", "doTestNormalize", "(", "\"/", "a", "/", "..", "/.", "./", "\",", "null", ")", ";", "}", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">", "<", "changelog", ">", "<", "fix", ">", "Correct", "some", "edge", "cases", "in", "<", "code", ">", "RequestUtil", ".", "normalize", "(", ")<", "/", "code", ">", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "Correct", "a", "couple", "of", "edge", "cases", "in", "<", "code", ">", "RequestUtil", ".", "normalize", "(", ")<", "/", "code", ">", ".</s>if", "(", "normalized", ".", "equals", "(", "\"/", ".\"", "))", "{", "return", "\"", "/\"", ";", "}", "if", "(", "normalized", ".", "equals", "(", "\"/", "..", "\")", ")", "{", "return", "null", ";", "/", "/", "Trying", "to", "go", "outside", "our", "context", "}", "Correct", "a", "coupe", "of", "edge", "cases", "in", "<", "code", ">", "RequestUtil", ".", "normalize", "(", ")<", "/", "code", ">", "."], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["x86,", "cpu,", "amd:", "Add", "workaround", "for", "family", "16h,", "erratum", "793", "This", "adds", "the", "workaround", "for", "erratum", "793", "as", "a", "precaution", "in", "case", "not", "every", "BIOS", "implements", "it.", "This", "addresses", ".", "Erratum", "text:", "[Revision", "Guide", "for", "AMD", "Family", "16h", "Models", "00h-0Fh", "Processors,", "document", "51810", "Rev.", "3.04", "November", "2013]", "793", "Specific", "Combination", "of", "Writes", "to", "Write", "Combined", "Memory", "Types", "and", "Locked", "Instructions", "May", "Cause", "Core", "Hang", "Description", "Under", "a", "highly", "specific", "and", "detailed", "set", "of", "internal", "timing", "conditions,", "a", "locked", "instruction", "may", "trigger", "a", "timing", "sequence", "whereby", "the", "write", "to", "a", "write", "combined", "memory", "type", "is", "not", "flushed,", "causing", "the", "locked", "instruction", "to", "stall", "indefinitely.", "Potential", "Effect", "on", "System", "Processor", "core", "hang.", "Suggested", "Workaround", "BIOS", "should", "set", "MSR", "C001_1020[15]", "=", "1b.", "Fix", "Planned", "No", "fix", "planned", "[", "hpa:", "updated", "description,", "fixed", "typo", "in", "MSR", "name", "]", "Signed-off-by:", "Borislav", "Petkov", "<bp@suse.de>", "Link:", "http://lkml.kernel.org/r/20140114230711.GS29865@pd.tnic", "Tested-by:", "Aravind", "Gopalakrishnan", "<aravind.gopalakrishnan@amd.com>", "Signed-off-by:", "H.", "Peter", "Anvin", "<hpa@linux.intel.com>"], "code_tokens": ["#", "define", "MSR_AMD64_LS_CFG", "0xc0011020", "/", "*", "F16h", "erratum", "793", ",", "CVE", "-", "2013", "-", "6885", "*", "/", "if", "(", "c", "-", ">", "x86", "=", "=", "0x16", "&", "&", "c", "-", ">", "x86_model", "<", "=", "0xf", ")", "{", "u64", "val", ";", "rdmsrl", "(", "MSR_AMD64_LS_CFG", ",", "val", ")", ";", "if", "(", "!(", "val", "&", "BIT", "(", "15", ")", "))", "wrmsrl", "(", "MSR_AMD64_LS_CFG", ",", "val", "|", "BIT", "(", "15", ")", ");", "}</s>"], "docstring_tokens": ["host", "hang\"):"]}
{"contents": ["SOLR-12770:", "Make", "it", "possible", "to", "configure", "a", "host", "whitelist", "for", "distributed", "search"], "code_tokens": ["*", "SOLR", "-", "12770", ":", "The", "'", "shards", "'", "parameter", "handling", "logic", "changes", "to", "use", "a", "new", "config", "element", "to", "determine", "what", "hosts", "can", "be", "requested", ".", "Please", "see", "Apache", "Solr", "Reference", "Guide", "chapter", "\"", "Distributed", "Requests", "\"", "for", "details", ",", "as", "well", "as", "SOLR", "-", "12770", ".", "*", "SOLR", "-", "12770", ":", "Make", "it", "possible", "to", "configure", "a", "host", "whitelist", "for", "distributed", "search", "(", "Christine", "Poerschke", ",", "janhoy", ",", "Erick", "Erickson", ",", "Tom", "\u00e1", "s", "Fern", "\u00e1", "ndez", "L", "\u00f6", "bbe", ")", "REM", "When", "running", "Solr", "in", "non", "-", "cloud", "mode", "and", "if", "planning", "to", "do", "distributed", "search", "(", "using", "the", "\"", "shards", "\"", "parameter", ")", ",", "the", "REM", "list", "of", "hosts", "needs", "to", "be", "whitelisted", "or", "Solr", "will", "forbid", "the", "request", ".", "The", "whitelist", "can", "be", "configured", "in", "solr", ".", "xml", ",", "REM", "or", "if", "you", "are", "using", "the", "OOTB", "solr", ".", "xml", ",", "can", "be", "specified", "using", "the", "system", "property", "\"", "solr", ".", "shardsWhitelist", "\"", ".", "Alternatively", "REM", "host", "checking", "can", "be", "disabled", "by", "using", "the", "system", "property", "\"", "solr", ".", "disable", ".", "shardsWhitelist", "\"", "REM", "set", "SOLR_OPTS", "=", "\"%", "SOLR_OPTS", "%", "-", "Dsolr", ".", "shardsWhitelist", "=", "http", ":", "//", "localhost", ":", "8983", ",", "http", ":", "//", "localhost", ":", "8984", "\"", "@", "@", "-", "178", ",", "3", "+", "178", ",", "8", "@", "@", "#", "When", "running", "Solr", "in", "non", "-", "cloud", "mode", "and", "if", "planning", "to", "do", "distributed", "search", "(", "using", "the", "\"", "shards", "\"", "parameter", ")", ",", "the", "#", "list", "of", "hosts", "needs", "to", "be", "whitelisted", "or", "Solr", "will", "forbid", "the", "request", ".", "The", "whitelist", "can", "be", "configured", "in", "solr", ".", "xml", ",", "#", "or", "if", "you", "are", "using", "the", "OOTB", "solr", ".", "xml", ",", "can", "be", "specified", "using", "the", "system", "property", "\"", "solr", ".", "shardsWhitelist", "\"", ".", "Alternatively", "#", "host", "checking", "can", "be", "disabled", "by", "using", "the", "system", "property", "\"", "solr", ".", "disable", ".", "shardsWhitelist", "\"", "#", "SOLR_OPTS", "=", "\"$", "SOLR_OPTS", "-", "Dsolr", ".", "shardsWhitelist", "=", "http", ":", "//", "localhost", ":", "8983", ",", "http", ":", "//", "localhost", ":", "8984", "\"", "@", "@", "-", "19", ",", "6", "+", "19", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Arrays", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ".", "ErrorCode", ";", "HttpShardHandlerFactory", ".", "WhitelistHostChecker", "hostChecker", "=", "httpShardHandlerFactory", ".", "getWhitelistHostChecker", "(", ");", "if", "(", "shards", "!", "=", "null", "&", "&", "zkController", "=", "=", "null", "&", "&", "hostChecker", ".", "isWhitelistHostCheckingEnabled", "(", ")", "&", "&", "!", "hostChecker", ".", "hasExplicitWhitelist", "(", "))", "{", "throw", "new", "SolrException", "(", "ErrorCode", ".", "FORBIDDEN", ",", "\"", "HttpShardHandlerFactory", "\"", "+", "HttpShardHandlerFactory", ".", "INIT_SHARDS_WHITELIST", "+", "\"", "not", "configured", "but", "required", "(", "in", "lieu", "of", "ZkController", "and", "ClusterState", ")", "when", "using", "the", "'", "\"+", "ShardParams", ".", "SHARDS", "+", "\"'", "parameter", ".", "\"", "+", "HttpShardHandlerFactory", ".", "SET_SOLR_DISABLE_SHARDS_WHITELIST_CLUE", ")", ";", "}", "if", "(", "hostChecker", ".", "isWhitelistHostCheckingEnabled", "(", ")", "&", "&", "hostChecker", ".", "hasExplicitWhitelist", "(", "))", "{", "/", "*", "*", "We", "only", "need", "to", "check", "the", "host", "whitelist", "if", "there", "is", "an", "explicit", "whitelist", "(", "other", "than", "all", "the", "live", "nodes", ")", "*", "when", "the", "\"", "shards", "\"", "indicate", "cluster", "state", "elements", "only", "*", "/", "hostChecker", ".", "checkWhitelist", "(", "clusterState", ",", "shards", ",", "Arrays", ".", "asList", "(", "rb", ".", "shortCircuitedURL", ")", ");", "}", "if", "(", "clusterState", "=", "=", "null", "&", "&", "zkController", "!", "=", "null", ")", "{", "clusterState", "=", "zkController", ".", "getClusterState", "(", ");", "}", "hostChecker", ".", "checkWhitelist", "(", "clusterState", ",", "shards", ",", "shardUrls", ")", ";", "if", "(", "slices", "=", "=", "null", ")", "{", "if", "(", "hostChecker", ".", "isWhitelistHostCheckingEnabled", "(", ")", "&", "&", "hostChecker", ".", "hasExplicitWhitelist", "(", "))", "{", "/", "*", "*", "We", "only", "need", "to", "check", "the", "host", "whitelist", "if", "there", "is", "an", "explicit", "whitelist", "(", "other", "than", "all", "the", "live", "nodes", ")", "*", "when", "the", "\"", "shards", "\"", "indicate", "cluster", "state", "elements", "only", "*", "/", "hostChecker", ".", "checkWhitelist", "(", "clusterState", ",", "shards", ",", "shardUrls", ")", ";", "}", "}", "else", "{", "if", "(", "shards", "!", "=", "null", ")", "{", "/", "/", "No", "cloud", ",", "verbatim", "check", "of", "shards", "hostChecker", ".", "checkWhitelist", "(", "shards", ",", "new", "ArrayList", "<", ">(", "Arrays", ".", "asList", "(", "shards", ".", "split", "(", "\"[", ",|", "]\"", "))", "))", ";", "}", "import", "static", "org", ".", "apache", ".", "solr", ".", "util", ".", "stats", ".", "InstrumentedHttpRequestExecutor", ".", "KNOWN_METRIC_NAME_STRATEGIES", ";", "import", "com", ".", "google", ".", "common", ".", "annotations", ".", "VisibleForTesting", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "invoke", ".", "MethodHandles", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Random", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ArrayBlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "BlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CompletionService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutorCompletionService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutorService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "SynchronousQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ".", "ErrorCode", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "cloud", ".", "ClusterState", ";", "import", "org", ".", "apache", ".", "solr", ".", "update", ".", "UpdateShardHandlerConfig", ";", "private", "WhitelistHostChecker", "whitelistHostChecker", "=", "null", ";", "public", "static", "final", "String", "INIT_SHARDS_WHITELIST", "=", "\"", "shardsWhitelist", "\"", ";", "static", "final", "String", "INIT_SOLR_DISABLE_SHARDS_WHITELIST", "=", "\"", "solr", ".", "disable", ".", "\"", "+", "INIT_SHARDS_WHITELIST", ";", "static", "final", "String", "SET_SOLR_DISABLE_SHARDS_WHITELIST_CLUE", "=", "\"", "set", "-", "D", "\"", "+", "INIT_SOLR_DISABLE_SHARDS_WHITELIST", "+", "\"=", "true", "to", "disable", "shards", "whitelist", "checks", "\"", ";", "/", "**", "*", "Returns", "this", "Factory", "'", "s", "{", "@", "link", "WhitelistHostChecker", "}", ".", "*", "This", "method", "can", "be", "overridden", "to", "change", "the", "checker", "implementation", ".", "*", "/", "public", "WhitelistHostChecker", "getWhitelistHostChecker", "(", ")", "{", "return", "this", ".", "whitelistHostChecker", ";", "}", "@", "Deprecated", "/", "/", "For", "temporary", "use", "by", "the", "TermsComponent", "only", ".", "static", "boolean", "doGetDisableShardsWhitelist", "(", ")", "{", "return", "getDisableShardsWhitelist", "(", ");", "}", "private", "static", "boolean", "getDisableShardsWhitelist", "(", ")", "{", "return", "Boolean", ".", "getBoolean", "(", "INIT_SOLR_DISABLE_SHARDS_WHITELIST", ")", ";", "}", "this", ".", "whitelistHostChecker", "=", "new", "WhitelistHostChecker", "(", "args", "=", "=", "null", "?", "null", ":", "(", "String", ")", "args", ".", "get", "(", "INIT_SHARDS_WHITELIST", ")", ",", "!", "getDisableShardsWhitelist", "(", "))", ";", "log", ".", "info", "(", "\"", "Host", "whitelist", "initialized", ":", "{", "}\"", ",", "this", ".", "whitelistHostChecker", ")", ";", "/", "**", "*", "Class", "used", "to", "validate", "the", "hosts", "in", "the", "\"", "shards", "\"", "parameter", "when", "doing", "a", "distributed", "*", "request", "*", "/", "public", "static", "class", "WhitelistHostChecker", "{", "/", "**", "*", "List", "of", "the", "whitelisted", "hosts", ".", "Elements", "in", "the", "list", "will", "be", "host", ":", "port", "(", "no", "protocol", "or", "context", ")", "*", "/", "private", "final", "Set", "<", "String", ">", "whitelistHosts", ";", "/", "**", "*", "Indicates", "whether", "host", "checking", "is", "enabled", "*", "/", "private", "final", "boolean", "whitelistHostCheckingEnabled", ";", "public", "WhitelistHostChecker", "(", "String", "whitelistStr", ",", "boolean", "enabled", ")", "{", "this", ".", "whitelistHosts", "=", "implGetShardsWhitelist", "(", "whitelistStr", ")", ";", "this", ".", "whitelistHostCheckingEnabled", "=", "enabled", ";", "}", "final", "static", "Set", "<", "String", ">", "implGetShardsWhitelist", "(", "final", "String", "shardsWhitelist", ")", "{", "if", "(", "shardsWhitelist", "!", "=", "null", "&", "&", "!", "shardsWhitelist", ".", "isEmpty", "(", "))", "{", "return", "StrUtils", ".", "splitSmart", "(", "shardsWhitelist", ",", "'", ",'", ")", ".", "stream", "(", ")", ".", "map", "(", "String", ":", ":", "trim", ")", ".", "map", "(", "(", "hostUrl", ")", "-", ">", "{", "URL", "url", ";", "try", "{", "if", "(", "!", "hostUrl", ".", "startsWith", "(", "\"", "http", ":", "//", "\")", "&", "&", "!", "hostUrl", ".", "startsWith", "(", "\"", "https", ":", "//", "\")", ")", "{", "/", "/", "It", "doesn", "'", "t", "really", "matter", "which", "protocol", "we", "set", "here", "because", "we", "are", "not", "going", "to", "use", "it", ".", "We", "just", "need", "a", "full", "URL", ".", "url", "=", "new", "URL", "(", "\"", "http", ":", "//", "\"", "+", "hostUrl", ")", ";", "}", "else", "{", "url", "=", "new", "URL", "(", "hostUrl", ")", ";", "}", "}", "catch", "(", "MalformedURLException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Invalid", "URL", "syntax", "in", "\\", "\"\"", "+", "INIT_SHARDS_WHITELIST", "+", "\"", "\\\"", ":", "\"", "+", "shardsWhitelist", ",", "e", ")", ";", "}", "if", "(", "url", ".", "getHost", "(", ")", "=", "=", "null", "|", "|", "url", ".", "getPort", "(", ")", "<", "0", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "SERVER_ERROR", ",", "\"", "Invalid", "URL", "syntax", "in", "\\", "\"\"", "+", "INIT_SHARDS_WHITELIST", "+", "\"", "\\\"", ":", "\"", "+", "shardsWhitelist", ")", ";", "}", "return", "url", ".", "getHost", "(", ")", "+", "\"", ":\"", "+", "url", ".", "getPort", "(", ");", "}", ").", "collect", "(", "Collectors", ".", "toSet", "(", "))", ";", "}", "return", "null", ";", "}", "/", "**", "*", "@", "see", "#", "checkWhitelist", "(", "ClusterState", ",", "String", ",", "List", ")", "*", "/", "protected", "void", "checkWhitelist", "(", "String", "shardsParamValue", ",", "List", "<", "String", ">", "shardUrls", ")", "{", "checkWhitelist", "(", "null", ",", "shardsParamValue", ",", "shardUrls", ")", ";", "}", "/", "**", "*", "Checks", "that", "all", "the", "hosts", "for", "all", "the", "shards", "requested", "in", "shards", "parameter", "exist", "in", "the", "configured", "whitelist", "*", "or", "in", "the", "ClusterState", "(", "in", "case", "of", "cloud", "mode", ")", "*", "*", "@", "param", "clusterState", "The", "up", "to", "date", "ClusterState", ",", "can", "be", "null", "in", "case", "of", "non", "-", "cloud", "mode", "*", "@", "param", "shardsParamValue", "The", "original", "shards", "parameter", "*", "@", "param", "shardUrls", "The", "list", "of", "cores", "generated", "from", "the", "shards", "parameter", ".", "*", "/", "protected", "void", "checkWhitelist", "(", "ClusterState", "clusterState", ",", "String", "shardsParamValue", ",", "List", "<", "String", ">", "shardUrls", ")", "{", "if", "(", "!", "whitelistHostCheckingEnabled", ")", "{", "return", ";", "}", "Set", "<", "String", ">", "localWhitelistHosts", ";", "if", "(", "whitelistHosts", "=", "=", "null", "&", "&", "clusterState", "!", "=", "null", ")", "{", "/", "/", "TODO", ":", "We", "could", "implement", "caching", ",", "based", "on", "the", "version", "of", "the", "live_nodes", "znode", "localWhitelistHosts", "=", "generateWhitelistFromLiveNodes", "(", "clusterState", ")", ";", "}", "else", "if", "(", "whitelistHosts", "!", "=", "null", ")", "{", "localWhitelistHosts", "=", "whitelistHosts", ";", "}", "else", "{", "localWhitelistHosts", "=", "Collections", ".", "emptySet", "(", ");", "}", "shardUrls", ".", "stream", "(", ").", "map", "(", "String", ":", ":", "trim", ")", ".", "forEach", "(", "(", "shardUrl", ")", "-", ">", "{", "URL", "url", ";", "try", "{", "if", "(", "!", "shardUrl", ".", "startsWith", "(", "\"", "http", ":", "//", "\")", "&", "&", "!", "shardUrl", ".", "startsWith", "(", "\"", "https", ":", "//", "\")", ")", "{", "/", "/", "It", "doesn", "'", "t", "really", "matter", "which", "protocol", "we", "set", "here", "because", "we", "are", "not", "going", "to", "use", "it", ".", "We", "just", "need", "a", "full", "URL", ".", "url", "=", "new", "URL", "(", "\"", "http", ":", "//", "\"", "+", "shardUrl", ")", ";", "}", "else", "{", "url", "=", "new", "URL", "(", "shardUrl", ")", ";", "}", "}", "catch", "(", "MalformedURLException", "e", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "\"", "Invalid", "URL", "syntax", "in", "\\", "\"", "shards", "\\", "\"", "parameter", ":", "\"", "+", "shardsParamValue", ",", "e", ")", ";", "}", "if", "(", "url", ".", "getHost", "(", ")", "=", "=", "null", "|", "|", "url", ".", "getPort", "(", ")", "<", "0", ")", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "\"", "Invalid", "URL", "syntax", "in", "\\", "\"", "shards", "\\", "\"", "parameter", ":", "\"", "+", "shardsParamValue", ")", ";", "}", "if", "(", "!", "localWhitelistHosts", ".", "contains", "(", "url", ".", "getHost", "(", ")", "+", "\"", ":\"", "+", "url", ".", "getPort", "(", "))", ")", "{", "log", ".", "warn", "(", "\"", "The", "'", "\"+", "ShardParams", ".", "SHARDS", "+", "\"'", "parameter", "value", "'", "\"+", "shardsParamValue", "+", "\"'", "contained", "value", "(", "s", ")", "not", "on", "the", "shards", "whitelist", "(", "\"+", "localWhitelistHosts", "+", "\")", ",", "shardUrl", ":", "\"", "+", "shardUrl", ")", ";", "throw", "new", "SolrException", "(", "ErrorCode", ".", "FORBIDDEN", ",", "\"", "The", "'", "\"+", "ShardParams", ".", "SHARDS", "+", "\"'", "parameter", "value", "'", "\"+", "shardsParamValue", "+", "\"'", "contained", "value", "(", "s", ")", "not", "on", "the", "shards", "whitelist", ".", "shardUrl", ":", "\"", "+", "shardUrl", "+", "\"", ".\"", "HttpShardHandlerFactory", ".", "SET_SOLR_DISABLE_SHARDS_WHITELIST_CLUE", ")", ";", "}", "}", ");", "}", "Set", "<", "String", ">", "generateWhitelistFromLiveNodes", "(", "ClusterState", "clusterState", ")", "{", "return", "clusterState", ".", "getLiveNodes", "(", ")", ".", "stream", "(", ")", ".", "map", "(", "(", "liveNode", ")", "-", ">", "liveNode", ".", "substring", "(", "0", ",", "liveNode", ".", "indexOf", "(", "'", "_", "'", "))", ")", ".", "collect", "(", "Collectors", ".", "toSet", "(", "))", ";", "}", "public", "boolean", "hasExplicitWhitelist", "(", ")", "{", "return", "this", ".", "whitelistHosts", "!", "=", "null", ";", "}", "public", "boolean", "isWhitelistHostCheckingEnabled", "(", ")", "{", "return", "whitelistHostCheckingEnabled", ";", "}", "/", "**", "*", "Only", "to", "be", "used", "by", "tests", "*", "/", "@", "VisibleForTesting", "Set", "<", "String", ">", "getWhitelistHosts", "(", ")", "{", "return", "this", ".", "whitelistHosts", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "WhitelistHostChecker", "[", "whitelistHosts", "=", "\"", "+", "whitelistHosts", "+", "\"", ",", "whitelistHostCheckingEnabled", "=", "\"", "+", "whitelistHostCheckingEnabled", "+", "\"", "]\"", ";", "}", "}", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ".", "ErrorCode", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "cloud", ".", "ClusterState", ";", "import", "org", ".", "apache", ".", "solr", ".", "handler", ".", "component", ".", "HttpShardHandlerFactory", ".", "WhitelistHostChecker", ";", "/", "/", "This", "needs", "to", "be", "created", "here", "too", ",", "because", "Solr", "doesn", "'", "t", "call", "init", "(", "..", ".)", "on", "default", "components", ".", "Bug", "?", "private", "WhitelistHostChecker", "whitelistHostChecker", "=", "new", "WhitelistHostChecker", "(", "null", ",", "!", "HttpShardHandlerFactory", ".", "doGetDisableShardsWhitelist", "(", "))", ";", "@", "Override", "public", "void", "init", "(", "NamedList", "args", ")", "{", "super", ".", "init", "(", "args", ")", ";", "whitelistHostChecker", "=", "new", "WhitelistHostChecker", "(", "(", "String", ")", "args", ".", "get", "(", "HttpShardHandlerFactory", ".", "INIT_SHARDS_WHITELIST", ")", ",", "!", "HttpShardHandlerFactory", ".", "doGetDisableShardsWhitelist", "(", "))", ";", "}", "checkShardsWhitelist", "(", "rb", ",", "lst", ")", ";", "protected", "void", "checkShardsWhitelist", "(", "final", "ResponseBuilder", "rb", ",", "final", "List", "<", "String", ">", "lst", ")", "{", "final", "List", "<", "String", ">", "urls", "=", "new", "LinkedList", "<", "String", ">", "()", ";", "for", "(", "final", "String", "ele", ":", "lst", ")", "{", "urls", ".", "addAll", "(", "StrUtils", ".", "splitSmart", "(", "ele", ",", "'", "|'", "))", ";", "}", "if", "(", "whitelistHostChecker", ".", "isWhitelistHostCheckingEnabled", "(", ")", "&", "&", "rb", ".", "req", ".", "getCore", "(", ").", "getCoreContainer", "(", ").", "getZkController", "(", ")", "=", "=", "null", "&", "&", "!", "whitelistHostChecker", ".", "hasExplicitWhitelist", "(", "))", "{", "throw", "new", "SolrException", "(", "ErrorCode", ".", "FORBIDDEN", ",", "\"", "TermsComponent", "\"", "+", "HttpShardHandlerFactory", ".", "INIT_SHARDS_WHITELIST", "+", "\"", "not", "configured", "but", "required", "when", "using", "the", "'", "\"+", "ShardParams", ".", "SHARDS", "+", "\"'", "parameter", "with", "the", "TermsComponent", ".", "\"", "+", "HttpShardHandlerFactory", ".", "SET_SOLR_DISABLE_SHARDS_WHITELIST_CLUE", ")", ";", "}", "else", "{", "ClusterState", "cs", "=", "null", ";", "if", "(", "rb", ".", "req", ".", "getCore", "(", ").", "getCoreContainer", "(", ").", "getZkController", "(", ")", "!", "=", "null", ")", "{", "cs", "=", "rb", ".", "req", ".", "getCore", "(", ").", "getCoreContainer", "(", ").", "getZkController", "(", ").", "getClusterState", "(", ");", "}", "whitelistHostChecker", ".", "checkWhitelist", "(", "cs", ",", "urls", ".", "toString", "(", "),", "urls", ")", ";", "}", "}", "<", "str", "name", "=", "\"", "shardsWhitelist", "\"", ">$", "{", "solr", ".", "tests", ".", "shardsWhitelist", ":", "}<", "/", "str", ">", "systemSetPropertySolrDisableShardsWhitelist", "(", "\"", "true", "\"", ");", "systemClearPropertySolrDisableShardsWhitelist", "(", ");", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "handler", ".", "component", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "containsString", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "SolrQuery", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "SolrServerException", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "request", ".", "QueryRequest", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "request", ".", "UpdateRequest", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "response", ".", "QueryResponse", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "response", ".", "TermsResponse", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "response", ".", "TermsResponse", ".", "Term", ";", "import", "org", ".", "apache", ".", "solr", ".", "cloud", ".", "ConfigRequest", ";", "import", "org", ".", "apache", ".", "solr", ".", "cloud", ".", "MiniSolrCloudCluster", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "util", ".", "NamedList", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "CustomTermsComponentTest", "extends", "ShardsWhitelistTest", "{", "public", "static", "class", "CustomTermsComponent", "extends", "TermsComponent", "{", "public", "void", "init", "(", "NamedList", "args", ")", "{", "super", ".", "init", "(", "args", ")", ";", "}", "@", "Override", "protected", "void", "checkShardsWhitelist", "(", "final", "ResponseBuilder", "rb", ",", "final", "List", "<", "String", ">", "lst", ")", "{", "/", "/", "ignore", "shards", "whitelist", "}", "}", "private", "static", "String", "addCustomHandlerWithTermsComponentConfig", "(", "final", "MiniSolrCloudCluster", "cluster", ",", "final", "String", "collection", ",", "final", "String", "defaultHandlerName", ",", "final", "String", "shardsWhitelist", ")", "throws", "Exception", "{", "return", "addCustomHandler", "(", "cluster", ",", "collection", ",", "defaultHandlerName", ",", "shardsWhitelist", ")", ";", "}", "private", "static", "String", "addCustomHandlerWithCustomTermsComponent", "(", "final", "MiniSolrCloudCluster", "cluster", ",", "final", "String", "collection", ",", "final", "String", "defaultHandlerName", ")", "throws", "Exception", "{", "return", "addCustomHandler", "(", "cluster", ",", "collection", ",", "defaultHandlerName", ",", "null", ")", ";", "}", "private", "static", "String", "addCustomHandler", "(", "final", "MiniSolrCloudCluster", "cluster", ",", "final", "String", "collection", ",", "final", "String", "defaultHandlerName", ",", "final", "String", "shardsWhitelist", ")", "throws", "Exception", "{", "/", "/", "determine", "custom", "handler", "name", "(", "the", "exact", "name", "should", "not", "matter", ")", "final", "String", "customHandlerName", "=", "defaultHandlerName", "+", "\"", "_custom", "\"", "+", "random", "(", ").", "nextInt", "(", ");", "/", "/", "determine", "custom", "terms", "component", "name", "(", "the", "exact", "name", "should", "not", "matter", ")", "final", "String", "customTermsComponentName", "=", "TermsComponent", ".", "COMPONENT_NAME", "+", "\"", "_custom", "\"", "+", "random", "(", ").", "nextInt", "(", ");", "/", "/", "determine", "terms", "component", "class", "name", "and", "attributes", "final", "String", "customTermsComponentClass", ";", "final", "String", "customTermsComponentAttributesJSON", ";", "if", "(", "shardsWhitelist", "!", "=", "null", ")", "{", "customTermsComponentClass", "=", "TermsComponent", ".", "class", ".", "getName", "(", ");", "customTermsComponentAttributesJSON", "=", "\"", "'", "\"+", "HttpShardHandlerFactory", ".", "INIT_SHARDS_WHITELIST", "+", "\"'", ":", "'", "\"+", "shardsWhitelist", "+", "\"'", ",\\", "n", "\"", ";", "}", "else", "{", "customTermsComponentClass", "=", "CustomTermsComponent", ".", "class", ".", "getName", "(", ");", "customTermsComponentAttributesJSON", "=", "\"", "\";", "}", "/", "/", "add", "custom", "component", "cluster", ".", "getSolrClient", "(", ").", "request", "(", "new", "ConfigRequest", "(", "\"", "{\\", "n", "\"", "\"", "'", "add", "-", "searchcomponent", "'", ":", "{", "\\", "n", "\"", "customTermsComponentAttributesJSON", "\"", "'", "name", "'", ":", "'", "\"+", "customTermsComponentName", "+", "\"'", ",\\", "n", "\"", "\"", "'", "class", "'", ":", "'", "\"+", "customTermsComponentClass", "+", "\"'", "\\", "n", "\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", "),", "collection", ")", ";", "/", "/", "add", "custom", "handler", "cluster", ".", "getSolrClient", "(", ").", "request", "(", "new", "ConfigRequest", "(", "\"", "{\\", "n", "\"", "\"", "'", "add", "-", "requesthandler", "'", ":", "{", "\\", "n", "\"", "\"", "'", "name", "'", ":", "'", "\"+", "customHandlerName", "+", "\"'", ",\\", "n", "\"", "\"", "'", "class", "'", ":", "'", "\"+", "SearchHandler", ".", "class", ".", "getName", "(", ")+", "\"'", ",\\", "n", "\"", "\"", "'", "components", "'", ":", "[", "'", "\"+", "QueryComponent", ".", "COMPONENT_NAME", "+", "\"'", ",", "'", "\"+", "customTermsComponentName", "+", "\"'", "]", "\\", "n", "\"", "\"", "}", "\\", "n", "\"", "\"", "}\"", "),", "collection", ")", ";", "return", "customHandlerName", ";", "}", "@", "Test", "@", "Override", "public", "void", "test", "(", ")", "throws", "Exception", "{", "for", "(", "final", "String", "clusterId", ":", "clusterId2cluster", ".", "keySet", "(", "))", "{", "final", "MiniSolrCloudCluster", "cluster", "=", "clusterId2cluster", ".", "get", "(", "clusterId", ")", ";", "final", "String", "collection", "=", "COLLECTION_NAME", ";", "doTest", "(", "cluster", ",", "collection", ")", ";", "}", "}", "private", "static", "void", "doTest", "(", "final", "MiniSolrCloudCluster", "cluster", ",", "final", "String", "collection", ")", "throws", "Exception", "{", "/", "/", "add", "some", "documents", "final", "String", "id", "=", "\"", "id", "\"", ";", "final", "String", "f1", "=", "\"", "a_t", "\"", ";", "final", "String", "f2", "=", "\"", "b_t", "\"", ";", "final", "String", "v1", "=", "\"", "bee", "\"", ";", "final", "String", "v2", "=", "\"", "buzz", "\"", ";", "{", "new", "UpdateRequest", "(", ")", ".", "add", "(", "sdoc", "(", "id", ",", "1", ",", "f1", ",", "v1", ",", "f2", ",", "v2", "+", "\"", "\"", "+", "v2", "+", "\"", "\"", "+", "v2", ")", ")", ".", "add", "(", "sdoc", "(", "id", ",", "2", ",", "f1", ",", "v1", "+", "\"", "\"", "+", "v1", ",", "f2", ",", "v2", "+", "\"", "\"", "+", "v2", ")", ")", ".", "add", "(", "sdoc", "(", "id", ",", "3", ",", "f1", ",", "v1", "+", "\"", "\"", "+", "v1", "+", "\"", "\"", "+", "v1", ",", "f2", ",", "v2", ")", ")", ".", "commit", "(", "cluster", ".", "getSolrClient", "(", "),", "collection", ")", ";", "}", "/", "/", "search", "for", "the", "documents", "'", "terms", ".", "..", "final", "String", "defaultHandlerName", "=", "\"", "/", "select", "\"", ";", "/", "/", "search", "with", "the", "default", "handler", ".", "..", "final", "String", "shards", "=", "findAndCheckTerms", "(", "cluster", ",", "collection", ",", "defaultHandlerName", ",", "null", ",", "/", "/", ".", "..", "without", "specifying", "shards", "(", "random", "(", ").", "nextBoolean", "(", ")", "?", "null", ":", "f1", ")", ",", "v1", ",", "(", "random", "(", ").", "nextBoolean", "(", ")", "?", "null", ":", "f2", ")", ",", "v2", ",", "null", ")", ";", "/", "/", "search", "with", "the", "default", "handler", ".", "..", "findAndCheckTerms", "(", "cluster", ",", "collection", ",", "defaultHandlerName", ",", "shards", ",", "/", "/", ".", "..", "with", "specified", "shards", ",", "but", "all", "valid", "(", "random", "(", ").", "nextBoolean", "(", ")", "?", "null", ":", "f1", ")", ",", "v1", ",", "(", "random", "(", ").", "nextBoolean", "(", ")", "?", "null", ":", "f2", ")", ",", "v2", ",", "null", ")", ";", "ignoreException", "(", "\"", "not", "on", "the", "shards", "whitelist", "\"", ");", "/", "/", "this", "case", "should", "fail", "findAndCheckTerms", "(", "cluster", ",", "collection", ",", "defaultHandlerName", ",", "shards", "+", "\"", ",", "http", ":", "//", "[", "ff01", ":", ":", "114", "]", ":", "33332", "\"", ",", "/", "/", ".", "..", "with", "specified", "shards", "with", "one", "invalid", "(", "random", "(", ").", "nextBoolean", "(", ")", "?", "null", ":", "f1", ")", ",", "v1", ",", "(", "random", "(", ").", "nextBoolean", "(", ")", "?", "null", ":", "f2", ")", ",", "v2", ",", "\"", "No", "live", "SolrServers", "available", "to", "handle", "this", "request", "\"", ");", "unIgnoreException", "(", "\"", "not", "on", "the", "shards", "whitelist", "\"", ");", "/", "/", "configure", "a", "custom", "handler", ".", "..", "final", "String", "customHandlerName", ";", "if", "(", "random", "(", ").", "nextBoolean", "(", "))", "{", "/", "/", ".", "..", "with", "a", "shards", "whitelist", "customHandlerName", "=", "addCustomHandlerWithTermsComponentConfig", "(", "cluster", ",", "collection", ",", "defaultHandlerName", ",", "shards", ")", ";", "}", "else", "{", "/", "/", ".", "..", "with", "a", "custom", "terms", "component", "that", "disregards", "shards", "whitelist", "logic", "customHandlerName", "=", "addCustomHandlerWithCustomTermsComponent", "(", "cluster", ",", "collection", ",", "defaultHandlerName", ")", ";", "}", "/", "/", "search", "with", "the", "custom", "handler", ".", "..", "findAndCheckTerms", "(", "cluster", ",", "collection", ",", "customHandlerName", ",", "shards", ",", "/", "/", ".", "..", "with", "specified", "shards", "(", "random", "(", ").", "nextBoolean", "(", ")", "?", "null", ":", "f1", ")", ",", "v1", ",", "(", "random", "(", ").", "nextBoolean", "(", ")", "?", "null", ":", "f2", ")", ",", "v2", ",", "null", ")", ";", "}", "private", "static", "String", "findAndCheckTerms", "(", "final", "MiniSolrCloudCluster", "cluster", ",", "final", "String", "collection", ",", "String", "requestHandlerName", ",", "String", "in_shards", ",", "String", "field1", ",", "String", "value1", ",", "String", "field2", ",", "String", "value2", ",", "String", "solrServerExceptionMessagePrefix", ")", "throws", "IOException", "{", "/", "/", "compose", "the", "query", ".", "..", "final", "SolrQuery", "solrQuery", "=", "new", "SolrQuery", "(", "\"*", ":*", "\")", ";", "solrQuery", ".", "setRequestHandler", "(", "requestHandlerName", ")", ";", "solrQuery", ".", "add", "(", "\"", "shards", ".", "qt", "\"", ",", "requestHandlerName", ")", ";", "/", "/", ".", "..", "asking", "for", "terms", ".", "..", "solrQuery", ".", "setTerms", "(", "true", ")", ";", "if", "(", "field1", "!", "=", "null", ")", "{", "solrQuery", ".", "addTermsField", "(", "field1", ")", ";", "}", "if", "(", "field2", "!", "=", "null", ")", "{", "solrQuery", ".", "addTermsField", "(", "field2", ")", ";", "}", "/", "/", ".", "..", "and", "shards", "info", ".", "..", "solrQuery", ".", "add", "(", "\"", "shards", ".", "info", "\"", ",", "\"", "true", "\"", ");", "/", "/", ".", "..", "passing", "shards", "to", "use", "(", "if", "we", "have", "a", "preference", ")", "if", "(", "in_shards", "!", "=", "null", ")", "{", "solrQuery", ".", "add", "(", "\"", "shards", "\"", ",", "in_shards", ")", ";", "}", "/", "/", "make", "the", "query", "final", "QueryResponse", "queryResponse", ";", "try", "{", "queryResponse", "=", "new", "QueryRequest", "(", "solrQuery", ")", ".", "process", "(", "cluster", ".", "getSolrClient", "(", "),", "collection", ")", ";", "assertNull", "(", "\"", "expected", "exception", "(", "\"+", "solrServerExceptionMessagePrefix", "+", "\")", "not", "encountered", "\"", ",", "solrServerExceptionMessagePrefix", ")", ";", "}", "catch", "(", "SolrServerException", "sse", ")", "{", "assertNotNull", "(", "\"", "unexpectedly", "caught", "exception", "\"", "+", "sse", ",", "solrServerExceptionMessagePrefix", ")", ";", "assertTrue", "(", "sse", ".", "getMessage", "(", ").", "startsWith", "(", "solrServerExceptionMessagePrefix", ")", ");", "assertThat", "(", "sse", ".", "getCause", "(", ").", "getMessage", "(", "),", "containsString", "(", "\"", "not", "on", "the", "shards", "whitelist", "\"", "))", ";", "return", "null", ";", "}", "/", "/", "analyse", "the", "response", ".", "..", "final", "TermsResponse", "termsResponse", "=", "queryResponse", ".", "getTermsResponse", "(", ");", "/", "/", ".", "..", "checking", "the", "terms", "returned", ".", "..", "checkTermsResponse", "(", "termsResponse", ",", "field1", ",", "value1", ")", ";", "checkTermsResponse", "(", "termsResponse", ",", "field2", ",", "value2", ")", ";", "/", "/", ".", "..", "and", "assemble", "info", "about", "the", "shards", ".", "..", "final", "String", "out_shards", "=", "extractShardAddresses", "(", "queryResponse", ",", "\"", ",\"", ");", "/", "/", ".", "..", "to", "return", "to", "the", "caller", "return", "out_shards", ";", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "private", "static", "String", "extractShardAddresses", "(", "final", "QueryResponse", "queryResponse", ",", "final", "String", "delimiter", ")", "{", "final", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "final", "NamedList", "<", "Object", ">", "nl", "=", "(", "NamedList", "<", "Object", ">", ")", "queryResponse", ".", "getResponse", "(", ").", "get", "(", "\"", "shards", ".", "info", "\"", ");", "assertNotNull", "(", "queryResponse", ".", "toString", "(", "),", "nl", ")", ";", "for", "(", "int", "ii", "=", "0", ";", "ii", "<", "nl", ".", "size", "(", ");", "+", "+", "ii", ")", "{", "final", "String", "shardAddress", "=", "(", "String", ")", "((", "NamedList", "<", "Object", ">", ")", "nl", ".", "getVal", "(", "ii", ")", ").", "get", "(", "\"", "shardAddress", "\"", ");", "if", "(", "sb", ".", "length", "(", ")", ">", "0", ")", "{", "sb", ".", "append", "(", "delimiter", ")", ";", "}", "sb", ".", "append", "(", "shardAddress", ")", ";", "}", "return", "sb", ".", "toString", "(", ");", "}", "private", "static", "void", "checkTermsResponse", "(", "TermsResponse", "termsResponse", ",", "String", "field", ",", "String", "value", ")", "{", "if", "(", "field", "!", "=", "null", ")", "{", "final", "List", "<", "Term", ">", "ttList", "=", "termsResponse", ".", "getTerms", "(", "field", ")", ";", "assertEquals", "(", "1", ",", "ttList", ".", "size", "(", "))", ";", "assertEquals", "(", "value", ",", "ttList", ".", "get", "(", "0", ")", ".", "getTerm", "(", "))", ";", "}", "}", "}", "@", "@", "-", "63", ",", "6", "+", "63", ",", "7", "@", "@", "private", "static", "File", "createSolrHome", "(", ")", "throws", "Exception", "{", "systemSetPropertySolrDisableShardsWhitelist", "(", "\"", "true", "\"", ");", "systemClearPropertySolrDisableShardsWhitelist", "(", ");", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "handler", ".", "component", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "instanceOf", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "notNullValue", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "nullValue", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "SolrQuery", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "SolrServerException", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "embedded", ".", "JettySolrRunner", ";", "import", "org", ".", "apache", ".", "solr", ".", "cloud", ".", "MiniSolrCloudCluster", ";", "import", "org", ".", "apache", ".", "solr", ".", "cloud", ".", "MultiSolrCloudTestCase", ";", "import", "org", ".", "apache", ".", "solr", ".", "cloud", ".", "SolrCloudTestCase", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrInputDocument", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "ShardsWhitelistTest", "extends", "MultiSolrCloudTestCase", "{", "/", "**", "*", "The", "cluster", "with", "this", "key", "will", "include", "an", "explicit", "list", "of", "host", "whitelisted", "(", "all", "hosts", "in", "both", "the", "clusters", ")", "*", "/", "private", "static", "final", "String", "EXPLICIT_CLUSTER_KEY", "=", "\"", "explicitCluster", "\"", ";", "/", "**", "*", "The", "cluster", "with", "this", "key", "will", "not", "include", "an", "explicit", "list", "of", "host", "whitelisted", ",", "will", "rely", "on", "live_nodes", "*", "/", "private", "static", "final", "String", "IMPLICIT_CLUSTER_KEY", "=", "\"", "implicitCluster", "\"", ";", "private", "static", "final", "String", "EXPLICIT_WHITELIST_PROPERTY", "=", "\"", "solr", ".", "tests", ".", "ShardsWhitelistTest", ".", "explicitWhitelist", ".", "\";", "protected", "static", "final", "String", "COLLECTION_NAME", "=", "\"", "ShardsWhitelistTestCollection", "\"", ";", "private", "static", "int", "numShards", ";", "private", "static", "int", "numReplicas", ";", "private", "static", "int", "maxShardsPerNode", ";", "private", "static", "int", "nodesPerCluster", ";", "private", "static", "void", "appendClusterNodes", "(", "final", "StringBuilder", "sb", ",", "final", "String", "delimiter", ",", "final", "MiniSolrCloudCluster", "cluster", ")", "{", "cluster", ".", "getJettySolrRunners", "(", ").", "forEach", "(", "(", "jetty", ")", "-", ">", "sb", ".", "append", "(", "jetty", ".", "getBaseUrl", "(", ").", "toString", "(", ")", "+", "delimiter", ")", ");", "}", "@", "BeforeClass", "public", "static", "void", "setupClusters", "(", ")", "throws", "Exception", "{", "final", "String", "[", "]", "clusterIds", "=", "new", "String", "[", "]", "{", "IMPLICIT_CLUSTER_KEY", ",", "EXPLICIT_CLUSTER_KEY", "}", ";", "numShards", "=", "2", ";", "/", "/", "+", "random", "(", ").", "nextInt", "(", "2", ")", ";", "numReplicas", "=", "1", ";", "/", "/", "+", "random", "(", ").", "nextInt", "(", "2", ")", ";", "maxShardsPerNode", "=", "1", ";", "/", "/", "+", "random", "(", ").", "nextInt", "(", "2", ")", ";", "nodesPerCluster", "=", "(", "numShards", "*", "numReplicas", "+", "(", "maxShardsPerNode", "-", "1", ")", ")", "/", "maxShardsPerNode", ";", "final", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "doSetupClusters", "(", "clusterIds", ",", "new", "DefaultClusterCreateFunction", "(", ")", "{", "@", "Override", "public", "MiniSolrCloudCluster", "apply", "(", "String", "clusterId", ")", "{", "try", "{", "final", "MiniSolrCloudCluster", "cluster", "=", "new", "SolrCloudTestCase", ".", "Builder", "(", "nodesPerCluster", "(", "clusterId", ")", ",", "createTempDir", "(", "))", ".", "addConfig", "(", "\"", "conf", "\"", ",", "configset", "(", "\"", "cloud", "-", "dynamic", "\"", "))", ".", "withSolrXml", "(", "MiniSolrCloudCluster", ".", "DEFAULT_CLOUD_SOLR_XML", ".", "replace", "(", "MiniSolrCloudCluster", ".", "SOLR_TESTS_SHARDS_WHITELIST", ",", "EXPLICIT_WHITELIST_PROPERTY", "+", "clusterId", ")", ")", ".", "build", "(", ");", "return", "cluster", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "@", "Override", "protected", "int", "nodesPerCluster", "(", "String", "clusterId", ")", "{", "return", "nodesPerCluster", ";", "}", "}", ",", "new", "DefaultClusterInitFunction", "(", "numShards", ",", "numReplicas", ",", "maxShardsPerNode", ")", "{", "@", "Override", "public", "void", "accept", "(", "String", "clusterId", ",", "MiniSolrCloudCluster", "cluster", ")", "{", "appendClusterNodes", "(", "sb", ",", "\"", ",\"", ",", "cluster", ")", ";", "if", "(", "clusterId", ".", "equals", "(", "EXPLICIT_CLUSTER_KEY", ")", ")", "{", "System", ".", "setProperty", "(", "EXPLICIT_WHITELIST_PROPERTY", "+", "clusterId", ",", "sb", ".", "toString", "(", "))", ";", "for", "(", "JettySolrRunner", "runner", ":", "cluster", ".", "getJettySolrRunners", "(", "))", "{", "try", "{", "runner", ".", "stop", "(", ");", "runner", ".", "start", "(", "true", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "Unable", "to", "restart", "runner", "\"", ",", "e", ")", ";", "}", "}", "}", "doAccept", "(", "COLLECTION_NAME", ",", "cluster", ")", ";", "}", "}", ");", "}", "@", "AfterClass", "public", "static", "void", "afterTests", "(", ")", "{", "System", ".", "clearProperty", "(", "EXPLICIT_WHITELIST_PROPERTY", "+", "EXPLICIT_CLUSTER_KEY", ")", ";", "}", "private", "HttpShardHandlerFactory", "getShardHandlerFactory", "(", "String", "clusterId", ")", "{", "return", "(", "HttpShardHandlerFactory", ")", "clusterId2cluster", ".", "get", "(", "clusterId", ")", ".", "getJettySolrRunner", "(", "0", ")", ".", "getCoreContainer", "(", ")", ".", "getShardHandlerFactory", "(", ");", "}", "@", "Test", "public", "void", "test", "(", ")", "throws", "Exception", "{", "assertThat", "(", "getShardHandlerFactory", "(", "EXPLICIT_CLUSTER_KEY", ")", ".", "getWhitelistHostChecker", "(", ").", "getWhitelistHosts", "(", "),", "notNullValue", "(", "))", ";", "assertThat", "(", "getShardHandlerFactory", "(", "IMPLICIT_CLUSTER_KEY", ")", ".", "getWhitelistHostChecker", "(", ").", "getWhitelistHosts", "(", "),", "nullValue", "(", "))", ";", "assertThat", "(", "getShardHandlerFactory", "(", "EXPLICIT_CLUSTER_KEY", ")", ".", "getWhitelistHostChecker", "(", ").", "hasExplicitWhitelist", "(", "),", "is", "(", "true", ")", ");", "assertThat", "(", "getShardHandlerFactory", "(", "IMPLICIT_CLUSTER_KEY", ")", ".", "getWhitelistHostChecker", "(", ").", "hasExplicitWhitelist", "(", "),", "is", "(", "false", ")", ");", "for", "(", "MiniSolrCloudCluster", "cluster", ":", "clusterId2cluster", ".", "values", "(", "))", "{", "for", "(", "JettySolrRunner", "runner", ":", "cluster", ".", "getJettySolrRunners", "(", "))", "{", "URI", "uri", "=", "runner", ".", "getBaseUrl", "(", ").", "toURI", "(", ");", "assertThat", "(", "getShardHandlerFactory", "(", "EXPLICIT_CLUSTER_KEY", ")", ".", "getWhitelistHostChecker", "(", ").", "getWhitelistHosts", "(", "),", "hasItem", "(", "uri", ".", "getHost", "(", ")", "+", "\"", ":\"", "+", "uri", ".", "getPort", "(", "))", ");", "}", "}", "MiniSolrCloudCluster", "implicitCluster", "=", "clusterId2cluster", ".", "get", "(", "IMPLICIT_CLUSTER_KEY", ")", ";", "MiniSolrCloudCluster", "explicitCluster", "=", "clusterId2cluster", ".", "get", "(", "EXPLICIT_CLUSTER_KEY", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "MiniSolrCloudCluster", ">", "entry", ":", "clusterId2cluster", ".", "entrySet", "(", "))", "{", "List", "<", "SolrInputDocument", ">", "docs", "=", "new", "ArrayList", "<", ">(", "10", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "10", ";", "i", "+", "+)", "{", "docs", ".", "add", "(", "new", "SolrInputDocument", "(", "\"", "id", "\"", ",", "entry", ".", "getKey", "(", ")", "+", "i", ")", ");", "}", "MiniSolrCloudCluster", "cluster", "=", "entry", ".", "getValue", "(", ");", "cluster", ".", "getSolrClient", "(", ").", "add", "(", "COLLECTION_NAME", ",", "docs", ")", ";", "cluster", ".", "getSolrClient", "(", ").", "commit", "(", "COLLECTION_NAME", ",", "true", ",", "true", ")", ";", "/", "/", "test", "using", "ClusterState", "elements", "assertThat", "(", "\"", "No", "shards", "specified", ",", "should", "work", "in", "both", "clusters", "\"", ",", "numDocs", "(", "\"*", ":*", "\",", "null", ",", "cluster", ")", ",", "is", "(", "10", ")", ");", "assertThat", "(", "\"", "Both", "shards", "specified", ",", "should", "work", "in", "both", "clusters", "\"", ",", "numDocs", "(", "\"*", ":*", "\",", "\"", "shard1", ",", "shard2", "\"", ",", "cluster", ")", ",", "is", "(", "10", ")", ");", "assertThat", "(", "\"", "Both", "shards", "specified", "with", "collection", "name", ",", "should", "work", "in", "both", "clusters", "\"", ",", "numDocs", "(", "\"*", ":*", "\",", "COLLECTION_NAME", "+", "\"", "_shard1", "\"", ",", "cluster", ")", ",", "is", "(", "numDocs", "(", "\"*", ":*", "\",", "\"", "shard1", "\"", ",", "cluster", ")", "))", ";", "/", "/", "test", "using", "explicit", "urls", "from", "within", "the", "cluster", "assertThat", "(", "\"", "Shards", "has", "the", "full", "URLs", ",", "should", "be", "allowed", "since", "they", "are", "internal", ".", "Cluster", "=", "\"", "+", "entry", ".", "getKey", "(", "),", "numDocs", "(", "\"*", ":*", "\",", "getShardUrl", "(", "\"", "shard1", "\"", ",", "cluster", ")", "+", "\"", ",\"", "+", "getShardUrl", "(", "\"", "shard2", "\"", ",", "cluster", ")", ",", "cluster", ")", ",", "is", "(", "10", ")", ");", "assertThat", "(", "\"", "Full", "URL", "without", "scheme", "\"", ",", "numDocs", "(", "\"*", ":*", "\",", "getShardUrl", "(", "\"", "shard1", "\"", ",", "cluster", ")", ".", "replaceAll", "(", "\"", "http", ":", "//", "\",", "\"", "\")", "+", "\"", ",\"", "+", "getShardUrl", "(", "\"", "shard2", "\"", ",", "cluster", ")", ".", "replaceAll", "(", "\"", "http", ":", "//", "\",", "\"", "\")", ",", "cluster", ")", ",", "is", "(", "10", ")", ");", "/", "/", "Mix", "shards", "with", "URLs", "assertThat", "(", "\"", "Mix", "URL", "and", "cluster", "state", "object", "\"", ",", "numDocs", "(", "\"*", ":*", "\",", "\"", "shard1", ",", "\"", "+", "getShardUrl", "(", "\"", "shard2", "\"", ",", "cluster", ")", ",", "cluster", ")", ",", "is", "(", "10", ")", ");", "assertThat", "(", "\"", "Mix", "URL", "and", "cluster", "state", "object", "\"", ",", "numDocs", "(", "\"*", ":*", "\",", "getShardUrl", "(", "\"", "shard1", "\"", ",", "cluster", ")", "+", "\"", ",", "shard2", "\"", ",", "cluster", ")", ",", "is", "(", "10", ")", ");", "}", "/", "/", "explicit", "whitelist", "includes", "all", "the", "nodes", "in", "both", "clusters", ".", "Requests", "should", "be", "allowed", "to", "go", "through", "assertThat", "(", "\"", "A", "request", "to", "the", "explicit", "cluster", "with", "shards", "that", "point", "to", "the", "implicit", "one", "\"", ",", "numDocs", "(", "\"", "id", ":", "implicitCluster", "*", "\",", "getShardUrl", "(", "\"", "shard1", "\"", ",", "implicitCluster", ")", "+", "\"", ",\"", "+", "getShardUrl", "(", "\"", "shard2", "\"", ",", "implicitCluster", ")", ",", "explicitCluster", ")", ",", "is", "(", "10", ")", ");", "assertThat", "(", "\"", "A", "request", "to", "the", "explicit", "cluster", "with", "shards", "that", "point", "to", "the", "both", "clusters", "\"", ",", "numDocs", "(", "\"", "*:", "*\"", ",", "getShardUrl", "(", "\"", "shard1", "\"", ",", "implicitCluster", ")", "+", "\"", ",\"", "+", "getShardUrl", "(", "\"", "shard2", "\"", ",", "implicitCluster", ")", "+", "\"", ",\"", "+", "getShardUrl", "(", "\"", "shard1", "\"", ",", "explicitCluster", ")", "+", "\"", ",\"", "+", "getShardUrl", "(", "\"", "shard2", "\"", ",", "explicitCluster", ")", ",", "explicitCluster", ")", ",", "is", "(", "20", ")", ");", "/", "/", "Implicit", "shouldn", "'", "t", "allow", "requests", "to", "the", "other", "cluster", "assertForbidden", "(", "\"", "id", ":", "explicitCluster", "*", "\",", "getShardUrl", "(", "\"", "shard1", "\"", ",", "explicitCluster", ")", "+", "\"", ",\"", "+", "getShardUrl", "(", "\"", "shard2", "\"", ",", "explicitCluster", ")", ",", "implicitCluster", ")", ";", "assertForbidden", "(", "\"", "id", ":", "explicitCluster", "*", "\",", "\"", "shard1", ",", "\"", "+", "getShardUrl", "(", "\"", "shard2", "\"", ",", "explicitCluster", ")", ",", "implicitCluster", ")", ";", "assertForbidden", "(", "\"", "id", ":", "explicitCluster", "*", "\",", "getShardUrl", "(", "\"", "shard1", "\"", ",", "explicitCluster", ")", "+", "\"", ",", "shard2", "\"", ",", "implicitCluster", ")", ";", "assertForbidden", "(", "\"", "id", ":", "explicitCluster", "*", "\",", "getShardUrl", "(", "\"", "shard1", "\"", ",", "explicitCluster", ")", ",", "implicitCluster", ")", ";", "assertThat", "(", "\"", "A", "typical", "internal", "request", ",", "should", "be", "handled", "locally", "\"", ",", "numDocs", "(", "\"", "id", ":", "explicitCluster", "*", "\",", "null", ",", "implicitCluster", ",", "\"", "distrib", "\"", ",", "\"", "false", "\"", ",", "\"", "shard", ".", "url", "\"", ",", "getShardUrl", "(", "\"", "shard2", "\"", ",", "explicitCluster", ")", ",", "\"", "shards", ".", "purpose", "\"", ",", "\"", "64", "\"", ",", "\"", "isShard", "\"", ",", "\"", "true", "\"", "),", "is", "(", "0", ")", ");", "}", "private", "void", "assertForbidden", "(", "String", "query", ",", "String", "shards", ",", "MiniSolrCloudCluster", "cluster", ")", "throws", "IOException", "{", "ignoreException", "(", "\"", "not", "on", "the", "shards", "whitelist", "\"", ");", "try", "{", "numDocs", "(", "query", ",", "shards", ",", "cluster", ")", ";", "fail", "(", "\"", "Expecting", "failure", "for", "shards", "parameter", ":", "'", "\"", "+", "shards", "+", "\"", "'\"", ");", "}", "catch", "(", "SolrServerException", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", "),", "instanceOf", "(", "SolrException", ".", "class", ")", ");", "assertThat", "(", "((", "SolrException", ")", "e", ".", "getCause", "(", "))", ".", "code", "(", "),", "is", "(", "SolrException", ".", "ErrorCode", ".", "FORBIDDEN", ".", "code", ")", ");", "assertThat", "(", "((", "SolrException", ")", "e", ".", "getCause", "(", "))", ".", "getMessage", "(", "),", "containsString", "(", "\"", "not", "on", "the", "shards", "whitelist", "\"", "))", ";", "}", "unIgnoreException", "(", "\"", "not", "on", "the", "shards", "whitelist", "\"", ");", "}", "private", "String", "getShardUrl", "(", "String", "shardName", ",", "MiniSolrCloudCluster", "cluster", ")", "{", "return", "cluster", ".", "getSolrClient", "(", ").", "getZkStateReader", "(", ").", "getClusterState", "(", ").", "getCollection", "(", "COLLECTION_NAME", ")", ".", "getSlice", "(", "shardName", ")", ".", "getReplicas", "(", ").", "iterator", "(", ").", "next", "(", ").", "getCoreUrl", "(", ");", "}", "private", "int", "numDocs", "(", "String", "queryString", ",", "String", "shardsParamValue", ",", "MiniSolrCloudCluster", "cluster", ",", "String", ".", "..", "otherParams", ")", "throws", "SolrServerException", ",", "IOException", "{", "SolrQuery", "q", "=", "new", "SolrQuery", "(", "queryString", ")", ";", "if", "(", "shardsParamValue", "!", "=", "null", ")", "{", "q", ".", "set", "(", "\"", "shards", "\"", ",", "shardsParamValue", ")", ";", "}", "if", "(", "otherParams", "!", "=", "null", ")", "{", "assert", "otherParams", ".", "length", "%", "2", "=", "=", "0", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "otherParams", ".", "length", ";", "i", "+", "=", "2", ")", "{", "q", ".", "set", "(", "otherParams", "[", "i", "]", ",", "otherParams", "[", "i", "+", "1", "]", ");", "}", "}", "return", "(", "int", ")", "cluster", ".", "getSolrClient", "(", ").", "query", "(", "COLLECTION_NAME", ",", "q", ")", ".", "getResults", "(", ").", "getNumFound", "(", ");", "}", "}", "@", "@", "-", "16", ",", "22", "+", "16", ",", "34", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "equalTo", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "nullValue", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "request", ".", "QueryRequest", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "cloud", ".", "ClusterState", ";", "import", "org", ".", "apache", ".", "solr", ".", "handler", ".", "component", ".", "HttpShardHandlerFactory", ".", "WhitelistHostChecker", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "private", "static", "final", "String", "SHARDS_WHITELIST", "=", "\"", "solr", ".", "tests", ".", "shardsWhitelist", "\"", ";", "@", "Test", "public", "void", "getShardsWhitelist", "(", ")", "throws", "Exception", "{", "System", ".", "setProperty", "(", "SHARDS_WHITELIST", ",", "\"", "http", ":", "//", "abc", ":", "8983", "/", ",", "http", ":", "//", "def", ":", "8984", "/", ",\"", ");", "final", "Path", "home", "=", "Paths", ".", "get", "(", "TEST_HOME", "(", "))", ";", "CoreContainer", "cc", "=", "null", ";", "ShardHandlerFactory", "factory", "=", "null", ";", "try", "{", "cc", "=", "CoreContainer", ".", "createAndLoad", "(", "home", ",", "home", ".", "resolve", "(", "\"", "solr", ".", "xml", "\"", "))", ";", "factory", "=", "cc", ".", "getShardHandlerFactory", "(", ");", "assertTrue", "(", "factory", "instanceof", "HttpShardHandlerFactory", ")", ";", "final", "HttpShardHandlerFactory", "httpShardHandlerFactory", "=", "(", "(", "HttpShardHandlerFactory", ")", "factory", ")", ";", "assertThat", "(", "httpShardHandlerFactory", ".", "getWhitelistHostChecker", "(", ").", "getWhitelistHosts", "(", ").", "size", "(", "),", "is", "(", "2", ")", ");", "assertThat", "(", "httpShardHandlerFactory", ".", "getWhitelistHostChecker", "(", ").", "getWhitelistHosts", "(", "),", "hasItem", "(", "\"", "abc", ":", "8983", "\"", "))", ";", "assertThat", "(", "httpShardHandlerFactory", ".", "getWhitelistHostChecker", "(", ").", "getWhitelistHosts", "(", "),", "hasItem", "(", "\"", "def", ":", "8984", "\"", "))", ";", "}", "finally", "{", "if", "(", "factory", "!", "=", "null", ")", "factory", ".", "close", "(", ");", "if", "(", "cc", "!", "=", "null", ")", "cc", ".", "shutdown", "(", ");", "System", ".", "clearProperty", "(", "SHARDS_WHITELIST", ")", ";", "}", "}", "@", "Test", "public", "void", "testLiveNodesToHostUrl", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "liveNodes", "=", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "1", ".", "2", ".", "3", ".", "4", ":", "8983_solr", "\"", ",", "\"", "1", ".", "2", ".", "3", ".", "4", ":", "9000_", "\"", ",", "\"", "1", ".", "2", ".", "3", ".", "4", ":", "9001_solr", "-", "2", "\"", ",", "}", "))", ";", "ClusterState", "cs", "=", "new", "ClusterState", "(", "0", ",", "liveNodes", ",", "new", "HashMap", "<", ">(", "))", ";", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "null", ",", "true", ")", ";", "Set", "<", "String", ">", "hostSet", "=", "checker", ".", "generateWhitelistFromLiveNodes", "(", "cs", ")", ";", "assertThat", "(", "hostSet", ".", "size", "(", "),", "is", "(", "3", ")", ");", "assertThat", "(", "hostSet", ",", "hasItem", "(", "\"", "1", ".", "2", ".", "3", ".", "4", ":", "8983", "\"", "))", ";", "assertThat", "(", "hostSet", ",", "hasItem", "(", "\"", "1", ".", "2", ".", "3", ".", "4", ":", "9000", "\"", "))", ";", "assertThat", "(", "hostSet", ",", "hasItem", "(", "\"", "1", ".", "2", ".", "3", ".", "4", ":", "9001", "\"", "))", ";", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerDisabled", "(", ")", "throws", "Exception", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "cde", ":", "8983", "\"", ",", "false", ")", ";", "checker", ".", "checkWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "try", "{", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "cde", ":", "8983", "\"", ",", "true", ")", ";", "checker", ".", "checkWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "fail", "(", "\"", "Expecting", "exception", "\"", ");", "}", "catch", "(", "SolrException", "se", ")", "{", "assertThat", "(", "se", ".", "code", "(", "),", "is", "(", "SolrException", ".", "ErrorCode", ".", "FORBIDDEN", ".", "code", ")", ");", "}", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerNoInput", "(", ")", "throws", "Exception", "{", "assertNull", "(", "\"", "Whitelist", "hosts", "should", "be", "null", "with", "null", "input", "\"", ",", "new", "WhitelistHostChecker", "(", "null", ",", "true", ")", ".", "getWhitelistHosts", "(", "))", ";", "assertNull", "(", "\"", "Whitelist", "hosts", "should", "be", "null", "with", "empty", "input", "\"", ",", "new", "WhitelistHostChecker", "(", "\"\"", ",", "true", ")", ".", "getWhitelistHosts", "(", "))", ";", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerSingleHost", "(", ")", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "true", ")", ";", "checker", ".", "checkWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerMultipleHost", "(", ")", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "3", ".", "com", ":", "8983", "\"", ",", "true", ")", ";", "checker", ".", "checkWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerMultipleHost2", "(", ")", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "3", ".", "com", ":", "8983", "\"", ",", "true", ")", ";", "checker", ".", "checkWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "\"", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerNoProtocolInParameter", "(", ")", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "3", ".", "com", ":", "8983", "\"", ",", "true", ")", ";", "checker", ".", "checkWhitelist", "(", "\"", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerNonWhitelistedHost1", "(", ")", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "3", ".", "com", ":", "8983", "\"", ",", "true", ")", ";", "try", "{", "checker", ".", "checkWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "http", ":", "//", "abc", "-", "4", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "fail", "(", "\"", "Expected", "exception", "\"", ");", "}", "catch", "(", "SolrException", "e", ")", "{", "assertThat", "(", "e", ".", "code", "(", "),", "is", "(", "SolrException", ".", "ErrorCode", ".", "FORBIDDEN", ".", "code", ")", ");", "assertThat", "(", "e", ".", "getMessage", "(", "),", "containsString", "(", "\"", "not", "on", "the", "shards", "whitelist", "\"", "))", ";", "}", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerNonWhitelistedHost2", "(", ")", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "3", ".", "com", ":", "8983", "\"", ",", "true", ")", ";", "try", "{", "checker", ".", "checkWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "\"", "http", ":", "//", "abc", "-", "4", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "fail", "(", "\"", "Expected", "exception", "\"", ");", "}", "catch", "(", "SolrException", "e", ")", "{", "assertThat", "(", "e", ".", "code", "(", "),", "is", "(", "SolrException", ".", "ErrorCode", ".", "FORBIDDEN", ".", "code", ")", ");", "assertThat", "(", "e", ".", "getMessage", "(", "),", "containsString", "(", "\"", "not", "on", "the", "shards", "whitelist", "\"", "))", ";", "}", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerNonWhitelistedHostHttps", "(", ")", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "3", ".", "com", ":", "8983", "\"", ",", "true", ")", ";", "checker", ".", "checkWhitelist", "(", "\"", "https", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "https", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "})", ");", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerInvalidUrl", "(", ")", "{", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", ",", "http", ":", "//", "abc", "-", "3", ".", "com", ":", "8983", "\"", ",", "true", ")", ";", "try", "{", "checker", ".", "checkWhitelist", "(", "\"", "abc_1", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "abc_1", "\"", "})", ");", "fail", "(", "\"", "Expected", "exception", "\"", ");", "}", "catch", "(", "SolrException", "e", ")", "{", "assertThat", "(", "e", ".", "code", "(", "),", "is", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ".", "code", ")", ");", "assertThat", "(", "e", ".", "getMessage", "(", "),", "containsString", "(", "\"", "Invalid", "URL", "syntax", "\"", "))", ";", "}", "}", "@", "Test", "public", "void", "testWhitelistHostCheckerCoreSpecific", "(", ")", "{", "/", "/", "cores", "are", "removed", "completely", "so", "it", "doesn", "'", "t", "really", "matter", "if", "they", "were", "set", "in", "config", "WhitelistHostChecker", "checker", "=", "new", "WhitelistHostChecker", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "abc", "-", "2", ".", "com", ":", "8983", "/", "solr2", "/", "core2", "\"", ",", "true", ")", ";", "checker", ".", "checkWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core2", "\"", ",", "Arrays", ".", "asList", "(", "new", "String", "[", "]{", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core2", "\"", "})", ");", "}", "@", "Test", "public", "void", "testGetShardsOfWhitelistedHostsUnset", "(", ")", "{", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "null", ")", ",", "nullValue", "(", "))", ";", "}", "@", "Test", "public", "void", "testGetShardsOfWhitelistedHostsEmpty", "(", ")", "{", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"\"", "),", "nullValue", "(", "))", ";", "}", "@", "Test", "public", "void", "testGetShardsOfWhitelistedHostsSingle", "(", ")", "{", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core1", "\"", ").", "size", "(", "),", "is", "(", "1", ")", ");", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core1", "\"", ").", "iterator", "(", ").", "next", "(", "),", "equalTo", "(", "\"", "abc", "-", "1", ".", "com", ":", "8983", "\"", "))", ";", "}", "@", "Test", "public", "void", "testGetShardsOfWhitelistedHostsMulti", "(", ")", "{", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8984", "/", "solr", "\"", ").", "size", "(", "),", "is", "(", "2", ")", ");", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8984", "/", "solr", "\"", "),", "hasItem", "(", "\"", "abc", "-", "1", ".", "com", ":", "8983", "\"", "))", ";", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8984", "/", "solr", "\"", "),", "hasItem", "(", "\"", "abc", "-", "1", ".", "com", ":", "8984", "\"", "))", ";", "}", "@", "Test", "public", "void", "testGetShardsOfWhitelistedHostsIpv4", "(", ")", "{", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "10", ".", "0", ".", "0", ".", "1", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "8984", "/", "solr", "\"", ").", "size", "(", "),", "is", "(", "2", ")", ");", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "10", ".", "0", ".", "0", ".", "1", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "8984", "/", "solr", "\"", "),", "hasItem", "(", "\"", "10", ".", "0", ".", "0", ".", "1", ":", "8983", "\"", "))", ";", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "10", ".", "0", ".", "0", ".", "1", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "127", ".", "0", ".", "0", ".", "1", ":", "8984", "/", "solr", "\"", "),", "hasItem", "(", "\"", "127", ".", "0", ".", "0", ".", "1", ":", "8984", "\"", "))", ";", "}", "@", "Test", "public", "void", "testGetShardsOfWhitelistedHostsIpv6", "(", ")", "{", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "[", "2001", ":", "abc", ":", "abc", ":", "0", ":", "0", ":", "123", ":", "456", ":", "1234", "]", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "[:", ":", "1", "]", ":", "8984", "/", "solr", "\"", ").", "size", "(", "),", "is", "(", "2", ")", ");", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "[", "2001", ":", "abc", ":", "abc", ":", "0", ":", "0", ":", "123", ":", "456", ":", "1234", "]", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "[:", ":", "1", "]", ":", "8984", "/", "solr", "\"", "),", "hasItem", "(", "\"[", "2001", ":", "abc", ":", "abc", ":", "0", ":", "0", ":", "123", ":", "456", ":", "1234", "]", ":", "8983", "\"", "))", ";", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "[", "2001", ":", "abc", ":", "abc", ":", "0", ":", "0", ":", "123", ":", "456", ":", "1234", "]", ":", "8983", "/", "solr", "/", "core1", ",", "http", ":", "//", "[:", ":", "1", "]", ":", "8984", "/", "solr", "\"", "),", "hasItem", "(", "\"[", "::", "1", "]", ":", "8984", "\"", "))", ";", "}", "@", "Test", "public", "void", "testGetShardsOfWhitelistedHostsHttps", "(", ")", "{", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "https", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core1", "\"", ").", "size", "(", "),", "is", "(", "1", ")", ");", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "https", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "/", "core1", "\"", "),", "hasItem", "(", "\"", "abc", "-", "1", ".", "com", ":", "8983", "\"", "))", ";", "}", "@", "Test", "public", "void", "testGetShardsOfWhitelistedHostsNoProtocol", "(", ")", "{", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "),", "equalTo", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "http", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "))", ");", "assertThat", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "),", "equalTo", "(", "WhitelistHostChecker", ".", "implGetShardsWhitelist", "(", "\"", "https", ":", "//", "abc", "-", "1", ".", "com", ":", "8983", "/", "solr", "\"", "))", ");", "}", "systemSetPropertySolrDisableShardsWhitelist", "(", "\"", "true", "\"", ");", "systemClearPropertySolrDisableShardsWhitelist", "(", ");", "systemSetPropertySolrDisableShardsWhitelist", "(", "\"", "true", "\"", ");", "systemClearPropertySolrDisableShardsWhitelist", "(", ");", "import", "com", ".", "carrotsearch", ".", "randomizedtesting", ".", "annotations", ".", "ParametersFactory", ";", "import", "com", ".", "tdunning", ".", "math", ".", "stats", ".", "AVLTreeDigest", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "SolrClient", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ";", "import", "org", ".", "apache", ".", "solr", ".", "util", ".", "hll", ".", "HLL", ";", "/", "**", "*", "Start", "all", "servers", "for", "cluster", ",", "initialize", "shards", "whitelist", "and", "then", "restart", "*", "/", "/", "/", "Set", "the", "shards", "whitelist", "to", "all", "shards", "plus", "the", "fake", "one", "used", "for", "tolerant", "test", "System", ".", "setProperty", "(", "SOLR_TESTS_SHARDS_WHITELIST", ",", "servers", ".", "getWhitelistString", "(", ")", "+", "\"", ",", "http", ":", "//", "[", "ff01", ":", ":", "114", "]", ":", "33332", "\"", ");", "systemSetPropertySolrDisableShardsWhitelist", "(", "\"", "false", "\"", ");", "restartServers", "(", ");", "/", "**", "*", "Restart", "all", "configured", "servers", ",", "i", ".", "e", ".", "configuration", "will", "be", "re", "-", "read", "*", "/", "public", "static", "void", "restartServers", "(", ")", "{", "servers", ".", "slist", ".", "forEach", "(", "s", "-", ">", "{", "try", "{", "s", ".", "stop", "(", ");", "s", ".", "start", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "fail", "(", "\"", "Exception", "during", "server", "restart", ":", "\"", "+", "e", ".", "getMessage", "(", "))", ";", "}", "}", ");", "}", "System", ".", "clearProperty", "(", "SOLR_TESTS_SHARDS_WHITELIST", ")", ";", "systemClearPropertySolrDisableShardsWhitelist", "(", ");", "client", ".", "queryDefaults", "(", ").", "set", "(", "\"", "shards", "\"", ",", "servers", ".", "getShards", "(", ")", "+", "\"", ",[", "ff01", ":", ":", "114", "]", ":", "33332", "/", "ignore_exception", "\"", ");", "systemSetPropertySolrDisableShardsWhitelist", "(", "\"", "true", "\"", ");", "systemClearPropertySolrDisableShardsWhitelist", "(", ");", "<", "str", "name", "=", "\"", "shardsWhitelist", "\"", ">$", "{", "solr", ".", "shardsWhitelist", ":", "}<", "/", "str", ">", "`", "HttpShardHandlerFactory", "`", "is", "the", "only", "`", "ShardHandlerFactory", "`", "implementation", "included", "out", "of", "the", "box", "with", "Solr", ",", "It", "accepts", "the", "following", "parameters", ":", "`", "shardsWhitelist", "`", "::", "If", "specified", ",", "this", "lists", "limits", "what", "nodes", "can", "be", "requested", "in", "the", "`", "shards", "`", "request", "parameter", ".", "In", "cloud", "mode", "this", "whitelist", "is", "automatically", "configured", "to", "include", "all", "live", "nodes", "in", "the", "cluster", ".", "In", "standalone", "mode", "the", "whitelist", "defaults", "to", "empty", "(", "sharding", "not", "allowed", ")", ".", "If", "you", "need", "to", "disable", "this", "feature", "for", "backwards", "compatibility", ",", "you", "can", "set", "the", "system", "property", "`", "solr", ".", "disable", ".", "shardsWhitelist", "=", "true", "`", ".", "The", "value", "of", "this", "parameter", "is", "a", "comma", "separated", "list", "of", "the", "nodes", "that", "will", "be", "whitelisted", ",", "i", ".", "e", ".", ":", "`", "10", ".", "0", ".", "0", ".", "1", ":", "8983", "/", "solr", ",", "10", ".", "0", ".", "0", ".", "1", ":", "8984", "/", "solr", "`", ".", "NOTE", ":", "In", "cloud", "mode", ",", "if", "at", "least", "one", "node", "is", "included", "in", "the", "whitelist", ",", "then", "the", "live_nodes", "will", "no", "longer", "be", "used", "as", "source", "for", "the", "list", ".", "This", "means", "that", ",", "if", "you", "need", "to", "do", "a", "cross", "-", "cluster", "request", "using", "the", "`", "shards", "`", "parameter", "in", "cloud", "mode", "(", "in", "addition", "to", "regular", "within", "-", "cluster", "requests", ")", ",", "you", "'", "ll", "need", "to", "add", "all", "nodes", "(", "local", "cluster", "+", "remote", "nodes", ")", "to", "the", "whitelist", ".", "=", "==", "Shards", "Whitelist", "What", "nodes", "are", "allowed", "in", "the", "`", "shards", "`", "parameter", "is", "configurable", "through", "the", "`", "shardsWhitelist", "`", "property", "in", "`", "solr", ".", "xml", "`", ".", "This", "whitelist", "is", "automatically", "configured", "for", "SolrCloud", "but", "needs", "explicit", "configuration", "for", "master", "/", "slave", "mode", ".", "Read", "more", "details", "in", "<", "<", "distributed", "-", "requests", ".", "adoc", "#", "configuring", "-", "the", "-", "shardhandlerfactory", ">", ">.", "Same", "as", "with", "regular", "distributed", "search", ",", "the", "`", "shards", "`", "parameter", "is", "subject", "to", "a", "host", "whitelist", "that", "has", "to", "be", "configured", "in", "the", "component", "init", "parameters", "using", "the", "configuration", "key", "`", "shardsWhitelist", "`", "and", "the", "list", "of", "hosts", "as", "values", ".", "In", "the", "same", "way", "as", "with", "distributed", "search", ",", "the", "whitelist", "will", "be", "populated", "to", "all", "live", "nodes", "by", "default", "when", "running", "in", "SolrCloud", "mode", ".", "If", "you", "need", "to", "disable", "this", "feature", "for", "backwards", "compatibility", ",", "you", "can", "set", "the", "system", "property", "`", "solr", ".", "disable", ".", "shardsWhitelist", "=", "true", "`", ".", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "<", "str", "name", "=", "\"", "shardsWhitelist", "\"", ">$", "{", "solr", ".", "tests", ".", "shardsWhitelist", ":", "}<", "/", "str", ">", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "@", "BeforeClass", "public", "static", "void", "setSolrDisableShardsWhitelist", "(", ")", "throws", "Exception", "{", "systemSetPropertySolrDisableShardsWhitelist", "(", "\"", "true", "\"", ");", "}", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "@", "AfterClass", "public", "static", "void", "clearSolrDisableShardsWhitelist", "(", ")", "throws", "Exception", "{", "systemClearPropertySolrDisableShardsWhitelist", "(", ");", "}", "public", "static", "final", "String", "SOLR_TESTS_SHARDS_WHITELIST", "=", "\"", "solr", ".", "tests", ".", "shardsWhitelist", "\"", ";", "/", "/", "If", "we", "want", "to", "run", "with", "whitelist", "list", ",", "this", "must", "be", "explicitly", "set", "to", "true", "for", "the", "test", "/", "/", "otherwise", "we", "disable", "the", "check", "if", "(", "System", ".", "getProperty", "(", "SYSTEM_PROPERTY_SOLR_DISABLE_SHARDS_WHITELIST", ")", "=", "=", "null", ")", "{", "systemSetPropertySolrDisableShardsWhitelist", "(", "\"", "true", "\"", ");", "}", "public", "String", "getWhitelistString", "(", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "boolean", "first", "=", "true", ";", "for", "(", "SolrInstance", "instance", ":", "slist", ")", "{", "if", "(", "first", ")", "{", "first", "=", "false", ";", "}", "else", "{", "sb", ".", "append", "(", "',", "')", ";", "}", "sb", ".", "append", "(", "instance", ".", "getBaseURL", "(", ").", "replace", "(", "\"/", "solr", "\"", ",", "\"", "\")", ");", "}", "return", "sb", ".", "toString", "(", ");", "}", "@", "Deprecated", "/", "/", "For", "backwards", "compatibility", "only", ".", "Please", "do", "not", "use", "in", "new", "tests", ".", "public", "static", "final", "String", "SYSTEM_PROPERTY_SOLR_DISABLE_SHARDS_WHITELIST", "=", "\"", "solr", ".", "disable", ".", "shardsWhitelist", "\"", ";", "@", "Deprecated", "/", "/", "For", "backwards", "compatibility", "only", ".", "Please", "do", "not", "use", "in", "new", "tests", ".", "protected", "static", "void", "systemSetPropertySolrDisableShardsWhitelist", "(", "String", "value", ")", "{", "System", ".", "setProperty", "(", "SYSTEM_PROPERTY_SOLR_DISABLE_SHARDS_WHITELIST", ",", "value", ")", ";", "}", "@", "Deprecated", "/", "/", "For", "backwards", "compatibility", "only", ".", "Please", "do", "not", "use", "in", "new", "tests", ".", "protected", "static", "void", "systemClearPropertySolrDisableShardsWhitelist", "(", ")", "{", "System", ".", "clearProperty", "(", "SYSTEM_PROPERTY_SOLR_DISABLE_SHARDS_WHITELIST", ")", ";", "}", "public", "static", "final", "String", "SOLR_TESTS_SHARDS_WHITELIST", "=", "\"", "solr", ".", "tests", ".", "shardsWhitelist", "\"", ";", "\"", "<", "str", "name", "=", "\\\"", "shardsWhitelist", "\\", "\">", "${", "\"+", "SOLR_TESTS_SHARDS_WHITELIST", "+", "\":", "}<", "/", "str", ">", "\\", "n", "\"</s>(", "No", "Changes", ")", "if", "(", "clusterState", "=", "=", "null", ")", "{", "clusterState", "=", "zkController", ".", "getClusterState", "(", ");", "import", "org", ".", "apache", ".", "solr", ".", "update", ".", "UpdateShardHandlerConfig", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "invoke", ".", "MethodHandles", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Random", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ArrayBlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "BlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CompletionService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutorCompletionService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutorService", ";", "import", "java", ".", "util", ".", "concurrent", ".", "SynchronousQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "static", "org", ".", "apache", ".", "solr", ".", "util", ".", "stats", ".", "InstrumentedHttpRequestExecutor", ".", "KNOWN_METRIC_NAME_STRATEGIES", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "request", ".", "QueryRequest", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "com", ".", "carrotsearch", ".", "randomizedtesting", ".", "annotations", ".", "ParametersFactory", ";", "import", "com", ".", "tdunning", ".", "math", ".", "stats", ".", "AVLTreeDigest", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "SolrClient", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ";", "import", "org", ".", "apache", ".", "solr", ".", "util", ".", "hll", ".", "HLL", ";", "client", ".", "queryDefaults", "(", ").", "set", "(", "\"", "shards", "\"", ",", "servers", ".", "getShards", "(", ")", "+", "\"", ",[", "ff01", ":", ":", "114", "]", ":", "33332", ":", "/", "ignore_exception", "\"", ");", "The", "parameters", "that", "can", "be", "specified", "are", "as", "follows", ":"], "docstring_tokens": ["request", "forgery"]}
{"contents": ["usb:", "usbtest:", "fix", "NULL", "pointer", "dereference", "If", "the", "usbtest", "driver", "encounters", "a", "device", "with", "an", "IN", "bulk", "endpoint", "but", "no", "OUT", "bulk", "endpoint,", "it", "will", "try", "to", "dereference", "a", "NULL", "pointer", "(out->desc.bEndpointAddress).", "The", "problem", "can", "be", "solved", "by", "adding", "a", "missing", "test.", "Signed-off-by:", "Alan", "Stern", "<stern@rowland.harvard.edu>", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Tested-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "Felipe", "Balbi", "<felipe.balbi@linux.intel.com>"], "code_tokens": ["if", "(", "in", ")", "if", "(", "out", ")</s>if", "(", "in", ")", "{", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["KVM:", "x86:", "fix", "for", "buffer", "overflow", "in", "handling", "of", "MSR_KVM_SYSTEM_TIME", "(", ")", "If", "the", "guest", "sets", "the", "GPA", "of", "the", "time_page", "so", "that", "the", "request", "to", "update", "the", "time", "straddles", "a", "page", "then", "KVM", "will", "write", "onto", "an", "incorrect", "page.", "The", "write", "is", "done", "byusing", "kmap", "atomic", "to", "get", "a", "pointer", "to", "the", "page", "for", "the", "time", "structure", "and", "then", "performing", "a", "memcpy", "to", "that", "page", "starting", "at", "an", "offset", "that", "the", "guest", "controls.", "Well", "behaved", "guests", "always", "provide", "a", "32-byte", "aligned", "address,", "however", "a", "malicious", "guest", "could", "use", "this", "to", "corrupt", "host", "kernel", "memory.", "Tested:", "Tested", "against", "kvmclock", "unit", "test.", "Signed-off-by:", "Andrew", "Honig", "<ahonig@google.com>", "Signed-off-by:", "Marcelo", "Tosatti", "<mtosatti@redhat.com>"], "code_tokens": ["/", "*", "Check", "that", "the", "address", "is", "32", "-", "byte", "aligned", ".", "*", "/", "if", "(", "vcpu", "-", ">", "arch", ".", "time_offset", "&", "(", "sizeof", "(", "struct", "pvclock_vcpu_time_info", ")", "-", "1", ")", ")", "break", ";</s>"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["KVM:", "MTRR:", "remove", "MSR", "0x2f8", "MSR", "0x2f8", "accessed", "the", "124th", "Variable", "Range", "MTRR", "ever", "since", "MTRR", "support", "was", "introduced", "by", "9ba075a664df", "(\"KVM:", "MTRR", "support\").", "0x2f8", "became", "harmful", "when", "910a6aae4e2e", "(\"KVM:", "MTRR:", "exactly", "define", "the", "size", "of", "variable", "MTRRs\")", "shrinked", "the", "array", "of", "VR", "MTRRs", "from", "256", "to", "8,", "which", "made", "access", "to", "index", "124", "out", "of", "bounds.", "The", "surrounding", "code", "only", "WARNs", "in", "this", "situation,", "thus", "the", "guest", "gained", "a", "limited", "read/write", "access", "to", "struct", "kvm_arch_vcpu.", "0x2f8", "is", "not", "a", "valid", "VR", "MTRR", "MSR,", "because", "KVM", "has/advertises", "only", "16", "VR", "MTRR", "MSRs,", "0x200-0x20f.", "Every", "VR", "MTRR", "is", "set", "up", "using", "two", "MSRs,", "0x2f8", "was", "treated", "as", "a", "PHYSBASE", "and", "0x2f9", "would", "be", "its", "PHYSMASK,", "but", "0x2f9", "was", "not", "implemented", "in", "KVM,", "therefore", "0x2f8", "could", "never", "do", "anything", "useful", "and", "getting", "rid", "of", "it", "is", "safe.", "This", "fixes", ".", "Fixes:", "910a6aae4e2e", "(\"KVM:", "MTRR:", "exactly", "define", "the", "size", "of", "variable", "MTRRs\")", "Cc:", "stable@vger.kernel.org", "Reported-by:", "David", "Matlack", "<dmatlack@google.com>", "Signed-off-by:", "Andy", "Honig", "<ahonig@google.com>", "Signed-off-by:", "Radim", "Kr\u010dm\u00e1\u0159", "<rkrcmar@redhat.com>", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["</s>case", "0x2f8", ":", "return", "true", ";"], "docstring_tokens": ["out-of-bounds", "r/w", "access"]}
{"contents": ["[SECURITY-797]", "Prevent", "session", "fixation", "-", "by", "the", "invalidation", "of", "the", "session", "after", "a", "successful", "login"], "code_tokens": ["import", "javax", ".", "servlet", ".", "http", ".", "HttpSession", ";", "String", "referer", "=", "(", "String", ")", "request", ".", "getSession", "(", ").", "getAttribute", "(", "REFERER_ATTRIBUTE", ")", ";", "HttpSession", "session", "=", "request", ".", "getSession", "(", "false", ")", ";", "if", "(", "session", "!", "=", "null", ")", "{", "/", "/", "avoid", "session", "fixation", "session", ".", "invalidate", "(", ");", "}", "request", ".", "getSession", "(", "true", ")", ";", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2017", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "org", ".", "jenkinsci", ".", "plugins", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequest", ";", "import", "hudson", ".", "model", ".", "UnprotectedRootAction", ";", "import", "hudson", ".", "util", ".", "HttpResponses", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONArray", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "Server", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "server", ".", "ServerConnector", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "servlet", ".", "DefaultServlet", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "servlet", ".", "ServletContextHandler", ";", "import", "org", ".", "eclipse", ".", "jetty", ".", "servlet", ".", "ServletHolder", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "HttpResponse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpSession", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "/", "/", "TODO", "merge", "with", "GithubAccessTokenPropertyTest", "after", "security", "release", ",", "just", "meant", "to", "ease", "the", "security", "merge", "/", "/", "or", "with", "GithubSecurityRealmTest", ",", "but", "will", "require", "more", "refactor", "to", "move", "out", "the", "mock", "server", "public", "class", "GithubAccessTokenPropertyTest_SEC797", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "private", "JenkinsRule", ".", "WebClient", "wc", ";", "private", "Server", "server", ";", "private", "URI", "serverUri", ";", "private", "MockGithubServlet", "servlet", ";", "public", "void", "setupMockGithubServer", "(", ")", "throws", "Exception", "{", "server", "=", "new", "Server", "(", ");", "ServerConnector", "connector", "=", "new", "ServerConnector", "(", "server", ")", ";", "/", "/", "auto", "-", "bind", "to", "available", "port", "connector", ".", "setPort", "(", "0", ")", ";", "server", ".", "addConnector", "(", "connector", ")", ";", "servlet", "=", "new", "MockGithubServlet", "(", "j", ")", ";", "ServletContextHandler", "context", "=", "new", "ServletContextHandler", "(", ");", "ServletHolder", "servletHolder", "=", "new", "ServletHolder", "(", "\"", "default", "\"", ",", "servlet", ")", ";", "context", ".", "addServlet", "(", "servletHolder", ",", "\"", "/*", "\")", ";", "server", ".", "setHandler", "(", "context", ")", ";", "server", ".", "start", "(", ");", "String", "host", "=", "connector", ".", "getHost", "(", ");", "if", "(", "host", "=", "=", "null", ")", "{", "host", "=", "\"", "localhost", "\"", ";", "}", "int", "port", "=", "connector", ".", "getLocalPort", "(", ");", "serverUri", "=", "new", "URI", "(", "String", ".", "format", "(", "\"", "http", ":", "//", "%", "s", ":", "%", "d", "/", "\",", "host", ",", "port", ")", ");", "servlet", ".", "setServerUrl", "(", "serverUri", ")", ";", "}", "/", "**", "*", "Based", "on", "documentation", "found", "at", "*", "https", ":", "//", "developer", ".", "github", ".", "com", "/", "v3", "/", "users", "/", "*", "https", ":", "//", "developer", ".", "github", ".", "com", "/", "v3", "/", "orgs", "/", "*", "https", ":", "//", "developer", ".", "github", ".", "com", "/", "v3", "/", "orgs", "/", "teams", "/", "*", "/", "private", "static", "class", "MockGithubServlet", "extends", "DefaultServlet", "{", "private", "String", "currentLogin", ";", "private", "List", "<", "String", ">", "organizations", ";", "private", "List", "<", "String", ">", "teams", ";", "private", "JenkinsRule", "jenkinsRule", ";", "private", "URI", "serverUri", ";", "public", "MockGithubServlet", "(", "JenkinsRule", "jenkinsRule", ")", "{", "this", ".", "jenkinsRule", "=", "jenkinsRule", ";", "}", "public", "void", "setServerUrl", "(", "URI", "serverUri", ")", "{", "this", ".", "serverUri", "=", "serverUri", ";", "}", "@", "Override", "protected", "void", "doGet", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ")", "throws", "ServletException", ",", "IOException", "{", "switch", "(", "req", ".", "getRequestURI", "(", "))", "{", "case", "\"", "/", "user", "\"", ":", "this", ".", "onUser", "(", "req", ",", "resp", ")", ";", "break", ";", "case", "\"", "/", "users", "/", "_specific_login_", "\"", ":", "this", ".", "onUser", "(", "req", ",", "resp", ")", ";", "break", ";", "case", "\"", "/", "user", "/", "orgs", "\"", ":", "this", ".", "onUserOrgs", "(", "req", ",", "resp", ")", ";", "break", ";", "case", "\"", "/", "user", "/", "teams", "\"", ":", "this", ".", "onUserTeams", "(", "req", ",", "resp", ")", ";", "break", ";", "case", "\"", "/", "orgs", "/", "org", "-", "a", "\"", ":", "this", ".", "onOrgs", "(", "req", ",", "resp", ",", "\"", "org", "-", "a", "\"", ");", "break", ";", "case", "\"", "/", "orgs", "/", "org", "-", "a", "/", "teams", "\"", ":", "this", ".", "onOrgsTeam", "(", "req", ",", "resp", ",", "\"", "org", "-", "a", "\"", ");", "break", ";", "case", "\"", "/", "orgs", "/", "org", "-", "a", "/", "members", "/", "alice", "\"", ":", "this", ".", "onOrgsMember", "(", "req", ",", "resp", ",", "\"", "org", "-", "a", "\"", ",", "\"", "alice", "\"", ");", "break", ";", "case", "\"", "/", "teams", "/", "7", "/", "members", "/", "alice", "\"", ":", "this", ".", "onTeamMember", "(", "req", ",", "resp", ",", "\"", "team", "-", "b", "\"", ",", "\"", "alice", "\"", ");", "break", ";", "case", "\"", "/", "orgs", "/", "org", "-", "c", "\"", ":", "this", ".", "onOrgs", "(", "req", ",", "resp", ",", "\"", "org", "-", "c", "\"", ");", "break", ";", "case", "\"", "/", "orgs", "/", "org", "-", "c", "/", "teams", "\"", ":", "this", ".", "onOrgsTeam", "(", "req", ",", "resp", ",", "\"", "org", "-", "c", "\"", ");", "break", ";", "case", "\"", "/", "orgs", "/", "org", "-", "c", "/", "members", "/", "bob", "\"", ":", "this", ".", "onOrgsMember", "(", "req", ",", "resp", ",", "\"", "org", "-", "c", "\"", ",", "\"", "bob", "\"", ");", "break", ";", "case", "\"", "/", "teams", "/", "7", "/", "members", "/", "bob", "\"", ":", "this", ".", "onTeamMember", "(", "req", ",", "resp", ",", "\"", "team", "-", "d", "\"", ",", "\"", "bob", "\"", ");", "break", ";", "case", "\"", "/", "login", "/", "oauth", "/", "authorize", "\"", ":", "this", ".", "onLoginOAuthAuthorize", "(", "req", ",", "resp", ")", ";", "break", ";", "case", "\"", "/", "login", "/", "oauth", "/", "access_token", "\"", ":", "this", ".", "onLoginOAuthAccessToken", "(", "req", ",", "resp", ")", ";", "break", ";", "default", ":", "throw", "new", "RuntimeException", "(", "\"", "Url", "not", "mapped", "yet", ":", "\"", "+", "req", ".", "getRequestURI", "(", "))", ";", "}", "}", "private", "void", "onUser", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ")", "throws", "IOException", "{", "resp", ".", "getWriter", "(", ").", "write", "(", "JSONObject", ".", "fromObject", "(", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "login", "\"", ",", "currentLogin", ")", ";", "put", "(", "\"", "name", "\"", ",", "currentLogin", "+", "\"", "_name", "\"", ");", "/", "/", "to", "avoid", "triggering", "a", "second", "call", ",", "due", "to", "GithubSecurityRealm", ":", "382", "put", "(", "\"", "created_at", "\"", ",", "\"", "2008", "-", "01", "-", "14T04", ":", "33", ":", "35Z", "\"", ");", "put", "(", "\"", "url", "\"", ",", "serverUri", "+", "\"", "/", "users", "/", "_specific_login_", "\"", ");", "}", "}", ")", ".", "toString", "(", "))", ";", "}", "private", "void", "onUserOrgs", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ")", "throws", "IOException", "{", "List", "<", "Map", "<", "String", ",", "Object", ">", ">", "responseBody", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "String", "orgName", ":", "organizations", ")", "{", "final", "String", "orgName_", "=", "orgName", ";", "responseBody", ".", "add", "(", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "login", "\"", ",", "orgName_", ")", ";", "}", "})", ";", "}", "resp", ".", "getWriter", "(", ").", "write", "(", "JSONArray", ".", "fromObject", "(", "responseBody", ")", ".", "toString", "(", "))", ";", "}", "private", "void", "onOrgs", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ",", "final", "String", "orgName", ")", "throws", "IOException", "{", "Map", "<", "String", ",", "Object", ">", "responseBody", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "login", "\"", ",", "orgName", ")", ";", "}", "};", "resp", ".", "getWriter", "(", ").", "write", "(", "JSONObject", ".", "fromObject", "(", "responseBody", ")", ".", "toString", "(", "))", ";", "}", "private", "void", "onOrgsMember", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ",", "String", "orgName", ",", "String", "userName", ")", "throws", "IOException", "{", "resp", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_NO_CONTENT", ")", ";", "/", "/", "302", "/", "404", "responses", "not", "implemented", "}", "private", "void", "onTeamMember", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ",", "String", "orgName", ",", "String", "userName", ")", "throws", "IOException", "{", "resp", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_NO_CONTENT", ")", ";", "/", "/", "302", "/", "404", "responses", "not", "implemented", "}", "private", "void", "onOrgsTeam", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ",", "final", "String", "orgName", ")", "throws", "IOException", "{", "List", "<", "Map", "<", "String", ",", "Object", ">", ">", "responseBody", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "String", "teamName", ":", "teams", ")", "{", "final", "String", "teamName_", "=", "teamName", ";", "responseBody", ".", "add", "(", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "id", "\"", ",", "7", ")", ";", "put", "(", "\"", "login", "\"", ",", "teamName_", "+", "\"", "_login", "\"", ");", "put", "(", "\"", "name", "\"", ",", "teamName_", ")", ";", "put", "(", "\"", "organization", "\"", ",", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "login", "\"", ",", "orgName", ")", ";", "}", "})", ";", "}", "})", ";", "}", "resp", ".", "getWriter", "(", ").", "write", "(", "JSONArray", ".", "fromObject", "(", "responseBody", ")", ".", "toString", "(", "))", ";", "}", "private", "void", "onUserTeams", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ")", "throws", "IOException", "{", "List", "<", "Map", "<", "String", ",", "Object", ">", ">", "responseBody", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "String", "teamName", ":", "teams", ")", "{", "final", "String", "teamName_", "=", "teamName", ";", "responseBody", ".", "add", "(", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "login", "\"", ",", "teamName_", "+", "\"", "_login", "\"", ");", "put", "(", "\"", "name", "\"", ",", "teamName_", ")", ";", "put", "(", "\"", "organization", "\"", ",", "new", "HashMap", "<", "String", ",", "Object", ">", "()", "{", "{", "put", "(", "\"", "login", "\"", ",", "organizations", ".", "get", "(", "0", ")", ");", "}", "})", ";", "}", "})", ";", "}", "resp", ".", "getWriter", "(", ").", "write", "(", "JSONArray", ".", "fromObject", "(", "responseBody", ")", ".", "toString", "(", "))", ";", "}", "private", "void", "onLoginOAuthAuthorize", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ")", "throws", "IOException", "{", "String", "code", "=", "\"", "test", "\"", ";", "resp", ".", "sendRedirect", "(", "jenkinsRule", ".", "getURL", "(", ")", "+", "\"", "securityRealm", "/", "finishLogin", "?", "code", "=", "\"", "+", "code", ")", ";", "}", "private", "void", "onLoginOAuthAccessToken", "(", "HttpServletRequest", "req", ",", "HttpServletResponse", "resp", ")", "throws", "IOException", "{", "resp", ".", "getWriter", "(", ").", "write", "(", "\"", "access_token", "=", "RANDOM_ACCESS_TOKEN", "\"", ");", "}", "}", "@", "Before", "public", "void", "prepareRealmAndWebClient", "(", ")", "throws", "Exception", "{", "this", ".", "setupMockGithubServer", "(", ");", "this", ".", "setupRealm", "(", ");", "wc", "=", "j", ".", "createWebClient", "(", ");", "}", "private", "void", "setupRealm", "(", ")", "{", "String", "githubWebUri", "=", "serverUri", ".", "toString", "(", ");", "String", "githubApiUri", "=", "serverUri", ".", "toString", "(", ");", "String", "clientID", "=", "\"", "xxx", "\"", ";", "String", "clientSecret", "=", "\"", "yyy", "\"", ";", "String", "oauthScopes", "=", "\"", "read", ":", "org", "\"", ";", "GithubSecurityRealm", "githubSecurityRealm", "=", "new", "GithubSecurityRealm", "(", "githubWebUri", ",", "githubApiUri", ",", "clientID", ",", "clientSecret", ",", "oauthScopes", ")", ";", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "githubSecurityRealm", ")", ";", "}", "@", "After", "public", "void", "stopEmbeddedJettyServer", "(", ")", "{", "try", "{", "server", ".", "stop", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "}", "}", "/", "/", "all", "the", "code", "above", "is", "reused", "from", "GithubAccessTokenPropertyTest", "@", "Issue", "(", "\"", "SECURITY", "-", "797", "\"", ")", "@", "Test", "public", "void", "preventSessionFixation", "(", ")", "throws", "Exception", "{", "TestRootAction", "rootAction", "=", "j", ".", "jenkins", ".", "getExtensionList", "(", "UnprotectedRootAction", ".", "class", ")", ".", "get", "(", "TestRootAction", ".", "class", ")", ";", "assertNotNull", "(", "rootAction", ")", ";", "wc", "=", "j", ".", "createWebClient", "(", ");", "String", "aliceLogin", "=", "\"", "alice", "\"", ";", "servlet", ".", "currentLogin", "=", "aliceLogin", ";", "servlet", ".", "organizations", "=", "Arrays", ".", "asList", "(", "\"", "org", "-", "a", "\"", ");", "servlet", ".", "teams", "=", "Arrays", ".", "asList", "(", "\"", "team", "-", "b", "\"", ");", "String", "sessionIdBefore", "=", "checkSessionFixationWithOAuth", "(", ");", "String", "sessionIdAfter", "=", "rootAction", ".", "sessionId", ";", "assertNotNull", "(", "sessionIdAfter", ")", ";", "assertNotEquals", "(", "\"", "Session", "must", "be", "invalidated", "after", "login", "\"", ",", "sessionIdBefore", ",", "sessionIdAfter", ")", ";", "}", "@", "TestExtension", "(", "\"", "preventSessionFixation", "\"", ")", "public", "static", "final", "class", "TestRootAction", "implements", "UnprotectedRootAction", "{", "public", "String", "sessionId", ";", "@", "Override", "public", "@", "CheckForNull", "String", "getIconFileName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "@", "CheckForNull", "String", "getDisplayName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "test", "\"", ";", "}", "public", "HttpResponse", "doIndex", "(", "StaplerRequest", "request", ")", "{", "HttpSession", "session", "=", "request", ".", "getSession", "(", "false", ")", ";", "if", "(", "session", "=", "=", "null", ")", "{", "sessionId", "=", "null", ";", "}", "else", "{", "sessionId", "=", "session", ".", "getId", "(", ");", "}", "return", "HttpResponses", ".", "plainText", "(", "\"", "ok", "\"", ");", "}", "}", "private", "String", "checkSessionFixationWithOAuth", "(", ")", "throws", "IOException", "{", "WebRequest", "req", "=", "new", "WebRequest", "(", "new", "URL", "(", "j", ".", "getURL", "(", "),", "\"", "securityRealm", "/", "commenceLogin", "\"", "))", ";", "req", ".", "setEncodingType", "(", "null", ")", ";", "String", "referer", "=", "j", ".", "getURL", "(", ")", "+", "\"", "test", "\"", ";", "req", ".", "setAdditionalHeader", "(", "\"", "Referer", "\"", ",", "referer", ")", ";", "wc", ".", "getOptions", "(", ").", "setRedirectEnabled", "(", "false", ")", ";", "wc", ".", "getOptions", "(", ").", "setThrowExceptionOnFailingStatusCode", "(", "false", ")", ";", "Page", "p", "=", "wc", ".", "getPage", "(", "req", ")", ";", "String", "cookie", "=", "p", ".", "getWebResponse", "(", ").", "getResponseHeaderValue", "(", "\"", "Set", "-", "Cookie", "\"", ");", "String", "sessionId", "=", "StringUtils", ".", "substringBetween", "(", "cookie", ",", "\"", "JSESSIONID", "=", "\",", "\"", ";\"", ");", "wc", ".", "getOptions", "(", ").", "setRedirectEnabled", "(", "true", ")", ";", "/", "/", "continue", "the", "process", "of", "authentication", "wc", ".", "getPage", "(", "new", "URL", "(", "p", ".", "getWebResponse", "(", ").", "getResponseHeaderValue", "(", "\"", "Location", "\"", "))", ");", "return", "sessionId", ";", "}", "}</s>String", "referer", "=", "(", "String", ")", "request", ".", "getSession", "(", ").", "getAttribute", "(", "REFERER_ATTRIBUTE", ")", ";"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["Insanity", "avoidance", "in", "/proc", "The", "old", "/proc", "interfaces", "were", "never", "updated", "to", "use", "loff_t,", "and", "are", "just", "generally", "broken.", "Now,", "we", "should", "be", "using", "the", "seq_file", "interface", "for", "all", "of", "the", "proc", "files,", "but", "converting", "the", "legacy", "functions", "is", "more", "work", "than", "most", "people", "care", "for", "and", "has", "little", "upside..", "But", "at", "least", "we", "can", "make", "the", "non-LFS", "rules", "explicit,", "rather", "than", "just", "insanely", "wrapping", "the", "offset", "or", "something.", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["unsigned", "long", "long", "pos", ";", "/", "*", "*", "Gaah", ",", "please", "just", "use", "\"", "seq_file", "\"", "instead", ".", "The", "legacy", "/", "proc", "*", "interfaces", "cut", "loff_t", "down", "to", "off_t", "for", "reads", ",", "and", "ignore", "*", "the", "offset", "entirely", "for", "writes", ".", ".", "*", "/", "pos", "=", "*", "ppos", ";", "if", "(", "pos", ">", "MAX_NON_LFS", ")", "return", "0", ";", "if", "(", "nbytes", ">", "MAX_NON_LFS", "-", "pos", ")", "nbytes", "=", "MAX_NON_LFS", "-", "pos", ";", "loff_t", "retval", "=", "-", "EINVAL", ";", "switch", "(", "orig", ")", "{", "case", "1", ":", "offset", "+", "=", "file", "-", ">", "f_pos", ";", "/", "*", "fallthrough", "*", "/", "case", "0", ":", "if", "(", "offset", "<", "0", "|", "|", "offset", ">", "MAX_NON_LFS", ")", "break", ";", "file", "-", ">", "f_pos", "=", "retval", "=", "offset", ";", "}", "return", "retval", ";</s>lock_kernel", "(", ");", "switch", "(", "orig", ")", "{", "case", "0", ":", "if", "(", "offset", "<", "0", ")", "goto", "out", ";", "file", "-", ">", "f_pos", "=", "offset", ";", "unlock_kernel", "(", ");", "return", "(", "file", "-", ">", "f_pos", ")", ";", "case", "1", ":", "if", "(", "offset", "+", "file", "-", ">", "f_pos", "<", "0", ")", "goto", "out", ";", "file", "-", ">", "f_pos", "+", "=", "offset", ";", "unlock_kernel", "(", ");", "return", "(", "file", "-", ">", "f_pos", ")", ";", "case", "2", ":", "goto", "out", ";", "default", ":", "goto", "out", ";", "}", "out", ":", "unlock_kernel", "(", ");", "return", "-", "EINVAL", ";"], "docstring_tokens": ["kernel", "memory", "disclosure"]}
{"contents": ["Add", "auth", "to", "UtilityService", "Extend", "auth", "check", "to", "UtiliyService", "endpoints:", "stats,", "config,", "subscription", "Issue:", "VRXEN-5", "Change-Id:", "I52a4b4a42731c244a97f97610dcaddb6837e67fb"], "code_tokens": ["String", "suffix", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "URI_PATH_CHAR", ",", "UriUtils", ".", "getLastPathSegment", "(", "op", ".", "getUri", "(", "))", ");", "/", "/", "allow", "access", "to", "ui", "endpoint", "if", "(", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ".", "equals", "(", "suffix", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "ServiceDocument", "doc", "=", "new", "ServiceDocument", "(", ");", "if", "(", "this", ".", "parent", ".", "getOptions", "(", ").", "contains", "(", "ServiceOption", ".", "FACTORY_ITEM", ")", ")", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "getParentPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "))", ",", "suffix", ")", ";", "}", "else", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "),", "suffix", ")", ";", "}", "doc", ".", "documentKind", "=", "Utils", ".", "buildKind", "(", "this", ".", "parent", ".", "getStateType", "(", "))", ";", "if", "(", "getHost", "(", ").", "isAuthorized", "(", "this", ".", "parent", ",", "doc", ",", "op", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "op", ".", "fail", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "OperationContext", ".", "setAuthorizationContext", "(", "this", ".", "host", ".", "getSystemAuthorizationContext", "(", "))", ";", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "OperationContext", ".", "setAuthorizationContext", "(", "this", ".", "host", ".", "getSystemAuthorizationContext", "(", "))", ";", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "stats", ",", "we", "should", "get", "403", "Operation", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "config", ",", "we", "should", "get", "403", "Operation", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "403", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "}", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "200", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "statsGet", ".", "addRequestHeader", "(", "Operation", ".", "REQUEST_AUTH_TOKEN_HEADER", ",", "authToken", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectSuccess", "(", "statsGet", ")", ";", "}", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "assumeIdentity", "(", "userPath", ")", ";", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "ServiceStat", "stats", "=", "this", ".", "host", ".", "getServiceStats", "(", "managementServiceUri", ")", "return", "stats", ";", "hostWithAuth", ".", "setSystemAuthorizationContext", "(", ");", "hostWithAuth", ".", "resetAuthorizationContext", "(", ");", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_SYNCHRONIZATION", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_TEMPLATE", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "AuthTestUtils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ".", "FailureResponse", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "VerificationHost", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "AuthorizationContextService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ".", "Query", ";", "@", "Test", "public", "void", "endpointAuthorization", "(", ")", "throws", "Throwable", "{", "VerificationHost", "host", "=", "VerificationHost", ".", "create", "(", "0", ")", ";", "host", ".", "setAuthorizationService", "(", "new", "AuthorizationContextService", "(", "))", ";", "host", ".", "setAuthorizationEnabled", "(", "true", ")", ";", "host", ".", "setMaintenanceIntervalMicros", "(", "TimeUnit", ".", "MILLISECONDS", ".", "toMicros", "(", "100", ")", ");", "host", ".", "start", "(", ");", "TestRequestSender", "sender", "=", "host", ".", "getTestRequestSender", "(", ");", "host", ".", "setSystemAuthorizationContext", "(", ");", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "UriUtils", ".", "buildUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ");", "String", "exampleUser", "=", "\"", "example", "@", "vmware", ".", "com", "\"", ";", "String", "examplePass", "=", "\"", "password", "\"", ";", "TestContext", "authCtx", "=", "host", ".", "testCreate", "(", "1", ")", ";", "AuthorizationSetupHelper", ".", "create", "(", ")", ".", "setHost", "(", "host", ")", ".", "setUserEmail", "(", "exampleUser", ")", ".", "setUserPassword", "(", "examplePass", ")", ".", "setResourceQuery", "(", "Query", ".", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_KIND", ",", "Utils", ".", "buildKind", "(", "ExampleServiceState", ".", "class", ")", ")", ".", "build", "(", "))", ".", "setCompletion", "(", "authCtx", ".", "getCompletion", "(", "))", ".", "start", "(", ");", "authCtx", ".", "await", "(", ");", "/", "/", "create", "a", "sample", "service", "ExampleServiceState", "doc", "=", "new", "ExampleServiceState", "(", ");", "doc", ".", "name", "=", "\"", "foo", "\"", ";", "doc", ".", "documentSelfLink", "=", "\"", "foo", "\"", ";", "Operation", "post", "=", "Operation", ".", "createPost", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ".", "setBody", "(", "doc", ")", ";", "ExampleServiceState", "postResult", "=", "sender", ".", "sendAndWait", "(", "post", ",", "ExampleServiceState", ".", "class", ")", ";", "host", ".", "resetAuthorizationContext", "(", ");", "URI", "factoryAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factorySubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "factorySynchUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_SYNCHRONIZATION", ")", ");", "URI", "factoryUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "URI", "serviceAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceSubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "serviceSynchUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_SYNCHRONIZATION", ")", ");", "URI", "serviceUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "/", "/", "check", "non", "-", "authenticated", "user", "receives", "forbidden", "response", "FailureResponse", "failureResponse", ";", "Operation", "uiOpResult", ";", "/", "/", "check", "factory", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factorySynchUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceSynchUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "authenticated", "user", "does", "NOT", "receive", "forbidden", "response", "AuthTestUtils", ".", "login", "(", "host", ",", "exampleUser", ",", "examplePass", ")", ";", "Operation", "response", ";", "/", "/", "check", "factory", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factorySynchUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceSynchUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "}", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ";", "/", "/", "Create", "resource", "group", "to", "allow", "access", "on", "utility", "paths", "String", "statsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "stats", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ".", "build", "(", "))", ";", "String", "subscriptionsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "subs", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ServiceUriPaths", ".", "CORE_LOCAL_QUERY_TASKS", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_SUBSCRIPTIONS", ")", ".", "build", "(", "))", ";", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "stats", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "statsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "subscriptions", "of", "query", "tasks", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "subscriptionsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "OperationContext", ";", "AuthorizationContext", "ctx", "=", "null", ";", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "ctx", "=", "OperationContext", ".", "getAuthorizationContext", "(", ");", "this", ".", "setSystemAuthorizationContext", "(", ");", "}", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "this", ".", "setAuthorizationContext", "(", "ctx", ")", ";", "}", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";</s>op", ".", "complete", "(", ");", "URI", "usersLink", "=", "UriUtils", ".", "buildUri", "(", "hostUri", ",", "UserService", ".", "FACTORY_LINK", ")", ";", "/", "/", "wait", "for", "factory", "availability", "this", ".", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "usersLink", ")", ";", "this", ".", "host", ".", "assumeIdentity", "(", "userPath", ")", ";", "return", "this", ".", "host", ".", "getServiceStats", "(", "managementServiceUri", ")", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildStatsUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["packet:", "fix", "tp_reserve", "race", "in", "packet_set_ring", "Updates", "to", "tp_reserve", "can", "race", "with", "reads", "of", "the", "field", "in", "packet_set_ring.", "Avoid", "this", "by", "holding", "the", "socket", "lock", "during", "updates", "in", "setsockopt", "PACKET_RESERVE.", "This", "bug", "was", "discovered", "by", "syzkaller.", "Fixes:", "8913336a7e8d", "(\"packet:", "add", "PACKET_RESERVE", "sockopt\")", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "Willem", "de", "Bruijn", "<willemb@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["lock_sock", "(", "sk", ")", ";", "if", "(", "po", "-", ">", "rx_ring", ".", "pg_vec", "|", "|", "po", "-", ">", "tx_ring", ".", "pg_vec", ")", "{", "ret", "=", "-", "EBUSY", ";", "}", "else", "{", "po", "-", ">", "tp_reserve", "=", "val", ";", "ret", "=", "0", ";", "}", "release_sock", "(", "sk", ")", ";", "return", "ret", ";</s>if", "(", "po", "-", ">", "rx_ring", ".", "pg_vec", "|", "|", "po", "-", ">", "tx_ring", ".", "pg_vec", ")", "return", "-", "EBUSY", ";", "po", "-", ">", "tp_reserve", "=", "val", ";", "return", "0", ";"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["drm:", "integer", "overflow", "in", "drm_mode_dirtyfb_ioctl()", "There", "is", "a", "potential", "integer", "overflow", "in", "drm_mode_dirtyfb_ioctl()", "if", "userspace", "passes", "in", "a", "large", "num_clips.", "The", "call", "to", "kmalloc", "would", "allocate", "a", "small", "buffer,", "and", "the", "call", "to", "fb->funcs->dirty", "may", "result", "in", "a", "memory", "corruption.", "Reported-by:", "Haogang", "Chen", "<haogangchen@gmail.com>", "Signed-off-by:", "Xi", "Wang", "<xi.wang@gmail.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Dave", "Airlie", "<airlied@redhat.com>"], "code_tokens": ["if", "(", "num_clips", "<", "0", "|", "|", "num_clips", ">", "DRM_MODE_FB_DIRTY_MAX_CLIPS", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "out_err1", ";", "}", "#", "define", "DRM_MODE_FB_DIRTY_MAX_CLIPS", "256</s>"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["Fix", "to", "resolve", "the", "command", "injection", "vulnerability.", "(#62)", "*", "fix(lib):", "fixed", "command", "injection", "vulnerability", "according", "to", "Issue", "#60", "*", "Removed", "unnecessary", "dependency", "by", "using", "child_process", "spawn()", "method"], "code_tokens": ["1", ".", "9", ".", "3", "/", "2016", "-", "09", "-", "05", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "*", "fixed", "command", "injection", "vulnerability", "var", "spawn", "=", "require", "(", "'", "child_process", "'", ").", "spawn", "exports", ".", "version", "=", "'", "1", ".", "9", ".", "3", "'", "args", ".", "push", "(", "'-", "-'", "+", "flag", ",", "image", ")", "args", ".", "push", "(", "cmd", ".", "icon", ",", "image", ")", ";", "args", ".", "push", "(", "cmd", ".", "icon", ",", "image", ")", ";", "args", ".", "push", "(", "cmd", ".", "icon", "+", "image", ")", ";", "args", ".", "push", "(", "msg", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "if", "(", "options", ".", "title", ")", "args", ".", "push", "(", "options", ".", "title", ")", ";", "var", "stringifiedMsg", "=", "msg", ";", "args", ".", "push", "(", "options", ".", "title", ")", ";", "args", ".", "push", "(", "options", ".", "subtitle", ")", ";", "args", ".", "push", "(", "options", ".", "url", ")", ";", "args", ".", "push", "(", "msg", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "if", "(", "options", ".", "title", ")", "args", ".", "push", "(", "options", ".", "title", ")", ";", "args", ".", "push", "(", "options", ".", "title", ")", ";", "args", ".", "push", "(", "msg", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "args", ".", "push", "(", "msg", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "args", ".", "push", "(", "msg", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "if", "(", "options", ".", "title", ")", "args", ".", "push", "(", "cmd", ".", "title", "+", "options", ".", "title", ")", ";", "if", "(", "options", ".", "url", ")", "args", ".", "push", "(", "cmd", ".", "url", "+", "options", ".", "url", ")", ";", "var", "command", "=", "origCommand", ".", "replace", "(", "/(", "^|", "[^", "%]", ")%", "s", "/", "g", ",", "'", "$", "1", "'", "+", "message", ")", ";", "if", "(", "command", "=", "==", "origCommand", ")", "args", ".", "push", "(", "message", ")", ";", "var", "cmd_to_exec", "=", "args", "[", "0", "]", ";", "args", ".", "shift", "(", ");", "spawn", "(", "cmd_to_exec", ",", "args", ")", ";", "\"", "version", "\"", ":", "\"", "1", ".", "9", ".", "3", "\"", ",</s>var", "exec", "=", "require", "(", "'", "child_process", "'", ").", "exec", ",", "quote", "=", "JSON", ".", "stringify", "exports", ".", "version", "=", "'", "1", ".", "4", ".", "1", "'", "args", ".", "push", "(", "'-", "-'", "+", "flag", ",", "quote", "(", "image", ")", ")", "args", ".", "push", "(", "cmd", ".", "icon", ",", "quote", "(", "image", ")", ");", "args", ".", "push", "(", "cmd", ".", "icon", ",", "quote", "(", "image", ")", ");", "args", ".", "push", "(", "cmd", ".", "icon", "+", "quote", "(", "image", ")", ");", "args", ".", "push", "(", "quote", "(", "msg", ")", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "if", "(", "options", ".", "title", ")", "args", ".", "push", "(", "quote", "(", "options", ".", "title", ")", ");", "var", "stringifiedMsg", "=", "quote", "(", "msg", ")", ";", "args", ".", "push", "(", "quote", "(", "options", ".", "title", ")", ");", "args", ".", "push", "(", "quote", "(", "options", ".", "subtitle", ")", ");", "args", ".", "push", "(", "quote", "(", "options", ".", "url", ")", ");", "args", ".", "push", "(", "quote", "(", "msg", ")", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "if", "(", "options", ".", "title", ")", "args", ".", "push", "(", "quote", "(", "options", ".", "title", ")", ");", "args", ".", "push", "(", "quote", "(", "options", ".", "title", ")", ");", "args", ".", "push", "(", "quote", "(", "msg", ")", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "args", ".", "push", "(", "quote", "(", "msg", ")", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "args", ".", "push", "(", "quote", "(", "msg", ")", ".", "replace", "(", "/\\", "\\", "n", "/", "g", ",", "'", "\\", "n", "'", "))", ";", "if", "(", "options", ".", "title", ")", "args", ".", "push", "(", "cmd", ".", "title", "+", "quote", "(", "options", ".", "title", ")", ");", "if", "(", "options", ".", "url", ")", "args", ".", "push", "(", "cmd", ".", "url", "+", "quote", "(", "options", ".", "url", ")", ");", "var", "command", "=", "origCommand", ".", "replace", "(", "/(", "^|", "[^", "%]", ")%", "s", "/", "g", ",", "'", "$", "1", "'", "+", "quote", "(", "message", ")", ");", "if", "(", "command", "=", "==", "origCommand", ")", "args", ".", "push", "(", "quote", "(", "message", ")", ");", "/", "/", "execute", "exec", "(", "args", ".", "join", "(", "'", "'", "),", "fn", ")", ";", "\"", "version", "\"", ":", "\"", "1", ".", "9", ".", "2", "\"", ","], "docstring_tokens": ["command", "execution"]}
{"contents": ["agp:", "zero", "pages", "before", "sending", "to", "userspace", "AGP", "pages", "might", "be", "mapped", "into", "userspace", "finally,", "so", "the", "pages", "should", "be", "set", "to", "zero", "before", "userspace", "can", "use", "it.", "Otherwise", "there", "is", "potential", "information", "leakage.", "Signed-off-by:", "Shaohua", "Li", "<shaohua.li@intel.com>", "Signed-off-by:", "Dave", "Airlie", "<airlied@redhat.com>"], "code_tokens": ["page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", "|", "__GFP_ZERO", ")", ";", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", "|", "__GFP_ZERO", ")", ";</s>page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", ")", ";", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", ")", ";"], "docstring_tokens": ["information", "leakage.\""]}
{"contents": ["hfs:", "add", "sanity", "check", "for", "file", "name", "length", "On", "a", "corrupted", "file", "system", "the", "->len", "field", "could", "be", "wrong", "leading", "to", "a", "buffer", "overflow.", "Reported-and-acked-by:", "Clement", "LECIGNE", "<clement.lecigne@netasq.com>", "Signed-off-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "srclen", ">", "HFS_NAMELEN", ")", "srclen", "=", "HFS_NAMELEN", ";</s>"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["KVM:", "x86:", "work", "around", "infinite", "loop", "in", "microcode", "when", "#AC", "is", "delivered", "It", "was", "found", "that", "a", "guest", "can", "DoS", "a", "host", "by", "triggering", "an", "infinite", "stream", "of", "\"alignment", "check\"", "(#AC)", "exceptions.", "This", "causes", "the", "microcode", "to", "enter", "an", "infinite", "loop", "where", "the", "core", "never", "receives", "another", "interrupt.", "The", "host", "kernel", "panics", "pretty", "quickly", "due", "to", "the", "effects", "(", ").", "Signed-off-by:", "Eric", "Northup", "<digitaleric@google.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["{", "SVM_EXIT_EXCP_BASE", "+", "AC_VECTOR", ",", "\"", "AC", "excp", "\"", "}", ",", "\\", "set_exception_intercept", "(", "svm", ",", "AC_VECTOR", ")", ";", "static", "int", "ac_interception", "(", "struct", "vcpu_svm", "*", "svm", ")", "{", "kvm_queue_exception_e", "(", "&", "svm", "-", ">", "vcpu", ",", "AC_VECTOR", ",", "0", ")", ";", "return", "1", ";", "}", "[", "SVM_EXIT_EXCP_BASE", "+", "AC_VECTOR", "]", "=", "ac_interception", ",", "(", "1u", "<", "<", "NM_VECTOR", ")", "|", "(", "1u", "<", "<", "DB_VECTOR", ")", "|", "(", "1u", "<", "<", "AC_VECTOR", ")", ";", "case", "AC_VECTOR", ":", "kvm_queue_exception_e", "(", "vcpu", ",", "AC_VECTOR", ",", "error_code", ")", ";", "return", "1", ";</s>(", "1u", "<", "<", "NM_VECTOR", ")", "|", "(", "1u", "<", "<", "DB_VECTOR", ")", ";"], "docstring_tokens": ["cpu", "lockup"]}
{"contents": ["avformat/movenc:", "Check", "that", "frame_types", "other", "than", "EAC3_FRAME_TYPE_INDEPENDENT", "have", "a", "supported", "substream", "id", "Fixes:", "out", "of", "array", "access", "Fixes:", "ffmpeg_bof_1.avi", "Found-by:", "Thuan", "Pham,", "Marcel", "B\u00f6hme,", "Andrew", "Santosa", "and", "Alexandru", "Razvan", "Caciulescu", "with", "AFLSmart", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["}", "else", "{", "if", "(", "hdr", "-", ">", "substreamid", "!", "=", "0", ")", "{", "avpriv_request_sample", "(", "mov", "-", ">", "fc", ",", "\"", "Multiple", "non", "EAC3", "independent", "substreams", "\"", ");", "ret", "=", "AVERROR_PATCHWELCOME", ";", "goto", "end", ";", "}</s>"], "docstring_tokens": ["out-of-bounds", "write"]}
{"contents": ["[SECURITY-806]"], "code_tokens": ["import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "@", "RequirePOST", "Jenkins", ".", "getActiveInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "<", "f", ":", "entry", "title", "=", "\"$", "{%", "API", "endpoint", "}", "\"", "field", "=", "\"", "apiUri", "\"", "checkMethod", "=", "\"", "post", "\"", ">", "package", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "HttpMethod", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequest", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "util", ".", "NameValuePair", ";", "import", "hudson", ".", "ExtensionList", ";", "import", "hudson", ".", "Functions", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "model", ".", "UnprotectedRootAction", ";", "import", "hudson", ".", "security", ".", "csrf", ".", "CrumbExclusion", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "MockAuthorizationStrategy", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "public", "class", "EndpointTest", "{", "@", "Rule", "public", "final", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "private", "String", "testUrl", ";", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "MockAuthorizationStrategy", "auth", "=", "new", "MockAuthorizationStrategy", "(", ");", "auth", ".", "grant", "(", "Jenkins", ".", "ADMINISTER", ")", ".", "everywhere", "(", ").", "to", "(", "\"", "alice", "\"", ");", "auth", ".", "grant", "(", "Jenkins", ".", "READ", ")", ".", "everywhere", "(", ").", "toEveryone", "(", ");", "j", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "auth", ")", ";", "testUrl", "=", "Util", ".", "rawEncode", "(", "j", ".", "getURL", "(", ").", "toString", "(", ")", "+", "\"", "testroot", "/", "\")", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "806", "\"", ")", "public", "void", "cantGet_doCheckApiUri", "(", ")", "throws", "IOException", ",", "SAXException", "{", "try", "{", "j", ".", "createWebClient", "(", ").", "goTo", "(", "appendCrumb", "(", "\"", "descriptorByName", "/", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "Endpoint", "/", "checkApiUri", "?", "apiUri", "=", "\"", "+", "testUrl", ")", ");", "fail", "(", "\"", "Should", "not", "be", "able", "to", "do", "that", "\"", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "assertEquals", "(", "405", ",", "e", ".", "getStatusCode", "(", "))", ";", "}", "assertFalse", "(", "TestRoot", ".", "get", "(", ").", "visited", ")", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "806", "\"", ")", "public", "void", "cantPostAsAnonymous_doCheckApiUri", "(", ")", "throws", "Exception", "{", "try", "{", "post", "(", "\"", "descriptorByName", "/", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "Endpoint", "/", "checkApiUri", "?", "apiUri", "=", "\"", "+", "testUrl", ",", "null", ")", ";", "fail", "(", "\"", "Should", "not", "be", "able", "to", "do", "that", "\"", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "assertEquals", "(", "403", ",", "e", ".", "getStatusCode", "(", "))", ";", "}", "assertFalse", "(", "TestRoot", ".", "get", "(", ").", "visited", ")", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "806", "\"", ")", "public", "void", "canPostAsAdmin_doCheckApiUri", "(", ")", "throws", "Exception", "{", "post", "(", "\"", "descriptorByName", "/", "org", ".", "jenkinsci", ".", "plugins", ".", "github_branch_source", ".", "Endpoint", "/", "checkApiUri", "?", "apiUri", "=", "\"", "+", "testUrl", ",", "\"", "alice", "\"", ");", "assertTrue", "(", "TestRoot", ".", "get", "(", ").", "visited", ")", ";", "}", "private", "String", "appendCrumb", "(", "String", "url", ")", "{", "return", "url", "+", "\"", "&\"", "+", "getCrumb", "(", ");", "}", "private", "String", "getCrumb", "(", ")", "{", "return", "Functions", ".", "getCrumbRequestField", "(", ")", "+", "\"", "=\"", "+", "Functions", ".", "getCrumb", "(", "null", ")", ";", "}", "private", "Page", "post", "(", "String", "relative", ",", "String", "userName", ")", "throws", "Exception", "{", "final", "JenkinsRule", ".", "WebClient", "client", ";", "if", "(", "userName", "!", "=", "null", ")", "{", "client", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "userName", ")", ";", "}", "else", "{", "client", "=", "j", ".", "createWebClient", "(", ");", "}", "final", "WebRequest", "request", "=", "new", "WebRequest", "(", "new", "URL", "(", "client", ".", "getContextPath", "(", ")", "+", "relative", ")", ",", "client", ".", "getBrowserVersion", "(", ").", "getHtmlAcceptHeader", "(", "))", ";", "request", ".", "setHttpMethod", "(", "HttpMethod", ".", "POST", ")", ";", "request", ".", "setRequestParameters", "(", "Arrays", ".", "asList", "(", "new", "NameValuePair", "(", "Functions", ".", "getCrumbRequestField", "(", "),", "Functions", ".", "getCrumb", "(", "null", ")", "))", ");", "return", "client", ".", "getPage", "(", "request", ")", ";", "}", "@", "TestExtension", "public", "static", "class", "TestRoot", "implements", "UnprotectedRootAction", "{", "boolean", "visited", "=", "false", ";", "@", "Override", "public", "String", "getIconFileName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "testroot", "\"", ";", "}", "public", "void", "doIndex", "(", "StaplerRequest", "request", ",", "StaplerResponse", "response", ")", "throws", "IOException", "{", "visited", "=", "true", ";", "response", ".", "getWriter", "(", ").", "println", "(", "\"", "OK", "\"", ");", "}", "static", "TestRoot", "get", "(", ")", "{", "return", "ExtensionList", ".", "lookup", "(", "UnprotectedRootAction", ".", "class", ")", ".", "get", "(", "TestRoot", ".", "class", ")", ";", "}", "}", "@", "TestExtension", "public", "static", "class", "CrumbExcluder", "extends", "CrumbExclusion", "{", "@", "Override", "public", "boolean", "process", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ",", "FilterChain", "chain", ")", "throws", "IOException", ",", "ServletException", "{", "final", "String", "pathInfo", "=", "request", ".", "getPathInfo", "(", ");", "if", "(", "pathInfo", "=", "=", "null", "|", "|", "!", "pathInfo", ".", "contains", "(", "\"", "testroot", "\"", "))", "{", "return", "false", ";", "}", "chain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "return", "true", ";", "}", "}", "}</s><", "f", ":", "entry", "title", "=", "\"$", "{%", "API", "endpoint", "}", "\"", "field", "=", "\"", "apiUri", "\"", ">"], "docstring_tokens": ["request", "forgery"]}
{"contents": ["mm/slab.c:", "fix", "SLAB", "freelist", "randomization", "duplicate", "entries", "This", "patch", "fixes", "a", "bug", "in", "the", "freelist", "randomization", "code.", "When", "a", "high", "random", "number", "is", "used,", "the", "freelist", "will", "contain", "duplicate", "entries.", "It", "will", "result", "in", "different", "allocations", "sharing", "the", "same", "chunk.", "It", "will", "result", "in", "odd", "behaviours", "and", "crashes.", "It", "should", "be", "uncommon", "but", "it", "depends", "on", "the", "machines.", "We", "saw", "it", "happening", "more", "often", "on", "some", "machines", "(every", "few", "hours", "of", "running", "tests).", "Fixes:", "c7ce4f60ac19", "(\"mm:", "SLAB", "freelist", "randomization\")", "Link:", "http://lkml.kernel.org/r/20170103181908.143178-1-thgarnie@google.com", "Signed-off-by:", "John", "Sperbeck", "<jsperbeck@google.com>", "Signed-off-by:", "Thomas", "Garnier", "<thgarnie@google.com>", "Cc:", "Christoph", "Lameter", "<cl@linux.com>", "Cc:", "Pekka", "Enberg", "<penberg@kernel.org>", "Cc:", "David", "Rientjes", "<rientjes@google.com>", "Cc:", "Joonsoo", "Kim", "<iamjoonsoo.kim@lge.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["state", "-", ">", "pos", "=", "rand", "%", "count", ";", "if", "(", "state", "-", ">", "pos", ">", "=", "state", "-", ">", "count", ")", "state", "-", ">", "pos", "=", "0", ";", "return", "state", "-", ">", "list", "[", "state", "-", ">", "pos", "+", "+]", ";</s>unsigned", "int", "rand", ";", "state", "-", ">", "pos", "=", "0", ";", "state", "-", ">", "rand", "=", "rand", ";", "return", "(", "state", "-", ">", "list", "[", "state", "-", ">", "pos", "+", "+]", "+", "state", "-", ">", "rand", ")", "%", "state", "-", ">", "count", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["[Fix", "SECURITY-445]", "better", "protect", "temporary", "files", "Temporary", "files", "were", "previously", "written", "to", "the", "system", "temporary", "directory", "with", "default", "permissions.", "A", "malicious", "actor", "could", "have", "captured", "sensitive", "information", "by", "reading", "files", "from", "the", "temporary", "directory.", "The", "temporary", "files", "typically", "are", "only", "on", "the", "file", "system", "for", "the", "duration", "of", "a", "single", "command", "line", "git", "invocation,", "but", "cloning", "a", "large", "git", "repo", "could", "require", "an", "extended", "time", "with", "those", "sensitive", "files", "in", "the", "temporary", "directory.", "This", "change", "sets", "permissions", "on", "the", "temporary", "files", "to", "be", "readable", "only", "by", "the", "file", "owner.", "If", "a", "workspace", "is", "available,", "a", "temporary", "directory", "adjacent", "to", "the", "workspace", "is", "used", "instead", "of", "the", "system", "temporary", "directory."], "code_tokens": ["import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "nio", ".", "file", ".", "attribute", ".", "FileAttribute", ";", "import", "java", ".", "nio", ".", "file", ".", "attribute", ".", "PosixFilePermission", ";", "import", "java", ".", "nio", ".", "file", ".", "attribute", ".", "PosixFilePermissions", ";", "private", "File", "createTempFileInSystemDir", "(", "String", "prefix", ",", "String", "suffix", ")", "throws", "IOException", "{", "if", "(", "isWindows", "(", "))", "{", "return", "Files", ".", "createTempFile", "(", "prefix", ",", "suffix", ")", ".", "toFile", "(", ");", "}", "Set", "<", "PosixFilePermission", ">", "ownerOnly", "=", "PosixFilePermissions", ".", "fromString", "(", "\"", "rw", "-", "--", "--", "--", "\")", ";", "FileAttribute", "fileAttribute", "=", "PosixFilePermissions", ".", "asFileAttribute", "(", "ownerOnly", ")", ";", "return", "Files", ".", "createTempFile", "(", "prefix", ",", "suffix", ",", "fileAttribute", ")", ".", "toFile", "(", ");", "}", "private", "File", "createTempFile", "(", "String", "prefix", ",", "String", "suffix", ")", "throws", "IOException", "{", "if", "(", "workspace", "=", "=", "null", ")", "{", "return", "createTempFileInSystemDir", "(", "prefix", ",", "suffix", ")", ";", "}", "File", "workspaceTmp", "=", "new", "File", "(", "workspace", ".", "getAbsolutePath", "(", ")", "+", "\"", "@", "tmp", "\"", ");", "if", "(", "!", "workspaceTmp", ".", "isDirectory", "(", ")", "&", "&", "!", "workspaceTmp", ".", "mkdirs", "(", "))", "{", "if", "(", "!", "workspaceTmp", ".", "isDirectory", "(", "))", "{", "return", "createTempFileInSystemDir", "(", "prefix", ",", "suffix", ")", ";", "}", "}", "Path", "tmpPath", "=", "Paths", ".", "get", "(", "workspaceTmp", ".", "getAbsolutePath", "(", "))", ";", "if", "(", "isWindows", "(", "))", "{", "return", "Files", ".", "createTempFile", "(", "tmpPath", ",", "prefix", ",", "suffix", ")", ".", "toFile", "(", ");", "}", "Set", "<", "PosixFilePermission", ">", "ownerOnly", "=", "PosixFilePermissions", ".", "fromString", "(", "\"", "rw", "-", "--", "--", "--", "\")", ";", "FileAttribute", "fileAttribute", "=", "PosixFilePermissions", ".", "asFileAttribute", "(", "ownerOnly", ")", ";", "return", "Files", ".", "createTempFile", "(", "tmpPath", ",", "prefix", ",", "suffix", ",", "fileAttribute", ")", ".", "toFile", "(", ");", "}", "msg", "=", "createTempFile", "(", "\"", "git", "-", "note", "\"", ",", "\"", ".", "txt", "\"", ");", "File", "key", "=", "createTempFile", "(", "\"", "ssh", "\"", ",", "\"", ".", "key", "\"", ");", "File", "ssh", "=", "createTempFile", "(", "\"", "pass", "\"", ",", "\"", ".", "bat", "\"", ");", "File", "ssh", "=", "createTempFile", "(", "\"", "pass", "\"", ",", "\"", ".", "sh", "\"", ");", "File", "askpass", "=", "createTempFile", "(", "\"", "pass", "\"", ",", "\"", ".", "bat", "\"", ");", "File", "askpass", "=", "createTempFile", "(", "\"", "pass", "\"", ",", "\"", ".", "sh", "\"", ");", "File", "ssh", "=", "createTempFile", "(", "\"", "ssh", "\"", ",", "\"", ".", "bat", "\"", ");", "File", "ssh", "=", "createTempFile", "(", "\"", "ssh", "\"", ",", "\"", ".", "sh", "\"", ");", "f", "=", "createTempFile", "(", "\"", "gitcommit", "\"", ",", "\"", ".", "txt", "\"", ");</s>msg", "=", "File", ".", "createTempFile", "(", "\"", "git", "-", "note", "\"", ",", "\"", "txt", "\"", ",", "workspace", ")", ";", "File", "key", "=", "File", ".", "createTempFile", "(", "\"", "ssh", "\"", ",", "\"", "key", "\"", ");", "File", "ssh", "=", "File", ".", "createTempFile", "(", "\"", "pass", "\"", ",", "\"", ".", "bat", "\"", ");", "File", "ssh", "=", "File", ".", "createTempFile", "(", "\"", "pass", "\"", ",", "\"", ".", "sh", "\"", ");", "File", "askpass", "=", "File", ".", "createTempFile", "(", "\"", "pass", "\"", ",", "\"", ".", "bat", "\"", ");", "File", "askpass", "=", "File", ".", "createTempFile", "(", "\"", "pass", "\"", ",", "\"", ".", "sh", "\"", ");", "File", "ssh", "=", "File", ".", "createTempFile", "(", "\"", "ssh", "\"", ",", "\"", ".", "bat", "\"", ");", "File", "ssh", "=", "File", ".", "createTempFile", "(", "\"", "ssh", "\"", ",", "\"", ".", "sh", "\"", ");", "f", "=", "File", ".", "createTempFile", "(", "\"", "gitcommit", "\"", ",", "\"", ".", "txt", "\"", ");"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["[PATCH]", "sg.c:", "fix", "a", "memory", "leak", "in", "devices", "seq_file", "implementation", "I", "know", "that", "scsi", "procfs", "is", "legacy", "code", "but", "this", "is", "a", "fix", "for", "a", "memory", "leak.", "While", "reading", "through", "sg.c", "I", "realized", "that", "the", "implementation", "of", "/proc/scsi/sg/devices", "with", "seq_file", "is", "leaking", "memory", "due", "to", "freeing", "the", "pointer", "returned", "by", "the", "next()", "iterator", "method.", "Since", "next()", "might", "return", "NULL", "or", "an", "error", "this", "is", "wrong.", "This", "patch", "fixes", "it", "through", "using", "the", "seq_files", "private", "field", "for", "holding", "the", "reference", "to", "the", "iterator", "object.", "Here", "is", "a", "small", "bash", "script", "to", "trigger", "the", "leak.", "Use", "slabtop", "to", "watch", "the", "size-32", "usage", "grow", "and", "grow.", "#!/bin/sh", "while", "true;", "do", "cat", "/proc/scsi/sg/devices", ">", "/dev/null", "done", "Signed-off-by:", "Jan", "Blunck", "<j.blunck@tu-harburg.de>", "Acked-by:", "James", "Bottomley", "<James.Bottomley@steeleye.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["s", "-", ">", "private", "=", "it", ";", "return", "NULL", ";", "return", "NULL", ";", "struct", "sg_proc_deviter", "*", "it", "=", "s", "-", ">", "private", ";", "kfree", "(", "s", "-", ">", "private", ")", ";</s>goto", "err1", ";", "goto", "err1", ";", "err1", ":", "kfree", "(", "it", ")", ";", "return", "NULL", ";", "struct", "sg_proc_deviter", "*", "it", "=", "(", "struct", "sg_proc_deviter", "*", ")", "v", ";", "kfree", "(", "v", ")", ";"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["[SECURITY-440]"], "code_tokens": ["<", "jenkins", ".", "version", ">", "1", ".", "625", "<", "/", "jenkins", ".", "version", ">", "<", "java", ".", "level", ">", "7", "<", "/", "java", ".", "level", ">", "<", "version", ">", "2", ".", "1", ".", "17", "<", "/", "version", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "cloudbees", "-", "folder", "<", "/", "artifactId", ">", "<", "version", ">", "6", ".", "4", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "import", "hudson", ".", "model", ".", "Items", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "hudson", ".", "util", ".", "XStream2", ";", "*", "@", "deprecated", "no", "more", "used", "since", "FileOnMaster", "-", "and", "Users", "-", "PrivateKeySource", "are", "deprecated", "too", "@", "Deprecated", "*", "@", "deprecated", "This", "approach", "has", "security", "vulnerability", "and", "should", "be", "migrated", "to", "{", "@", "link", "DirectEntryPrivateKeySource", "}", "@", "Deprecated", "Jenkins", ".", "getActiveInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "RUN_SCRIPTS", ")", ";", "LOGGER", ".", "log", "(", "Level", ".", "INFO", ",", "\"", "SECURITY", "-", "440", ":", "Migrating", "FileOnMasterPrivateKeySource", "to", "DirectEntryPrivateKeySource", "\"", ");", "/", "/", "read", "the", "content", "of", "the", "file", "and", "then", "migrate", "to", "Direct", "return", "new", "DirectEntryPrivateKeySource", "(", "getPrivateKeys", "(", "))", ";", "*", "@", "deprecated", "This", "approach", "has", "security", "vulnerability", "and", "should", "be", "migrated", "to", "{", "@", "link", "DirectEntryPrivateKeySource", "}", "@", "Deprecated", "private", "Object", "readResolve", "(", ")", "{", "Jenkins", ".", "getActiveInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "RUN_SCRIPTS", ")", ";", "LOGGER", ".", "log", "(", "Level", ".", "INFO", ",", "\"", "SECURITY", "-", "440", ":", "Migrating", "UsersPrivateKeySource", "to", "DirectEntryPrivateKeySource", "\"", ");", "/", "/", "read", "the", "content", "of", "the", "file", "and", "then", "migrate", "to", "Direct", "return", "new", "DirectEntryPrivateKeySource", "(", "getPrivateKeys", "(", "))", ";", "static", "{", "try", "{", "/", "/", "the", "critical", "field", "allow", "the", "permission", "check", "to", "make", "the", "XML", "read", "to", "fail", "completely", "in", "case", "of", "violation", "/", "/", "TODO", ":", "Remove", "reflection", "once", "baseline", "is", "updated", "past", "2", ".", "85", ".", "Method", "m", "=", "XStream2", ".", "class", ".", "getMethod", "(", "\"", "addCriticalField", "\"", ",", "Class", ".", "class", ",", "String", ".", "class", ")", ";", "m", ".", "invoke", "(", "Items", ".", "XSTREAM2", ",", "BasicSSHUserPrivateKey", ".", "class", ",", "\"", "privateKeySource", "\"", ");", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "}", "catch", "(", "NoSuchMethodException", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "BasicSSHUserPrivateKey", ".", "DisplayName", "=", "SSH", "Username", "with", "private", "key", "@", "@", "-", "22", ",", "6", "+", "22", ",", "4", "@", "@", "BasicSSHUserPrivateKey", ".", "DisplayName", "=", "SSH", "Benutzername", "und", "privater", "Schl", "\\", "u00fcssel", "@", "@", "-", "22", ",", "6", "+", "22", ",", "4", "@", "@", "BasicSSHUserPrivateKey", ".", "DisplayName", "=", "SSH", "\\", "u30e6", "\\", "u30fc", "\\", "u30b6", "\\", "u30fc", "\\", "u540d", "\\", "u3068", "\\", "u79d8", "\\", "u5bc6", "\\", "u9375", "@", "@", "-", "51", ",", "24", "+", "51", ",", "6", "@", "@", "package", "com", ".", "cloudbees", ".", "jenkins", ".", "plugins", ".", "sshcredentials", ".", "impl", ";", "import", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", ";", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "cli", ".", "CLICommandInvoker", ";", "import", "hudson", ".", "cli", ".", "UpdateJobCommand", ";", "import", "hudson", ".", "model", ".", "Job", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "recipes", ".", "LocalData", ";", "import", "static", "hudson", ".", "cli", ".", "CLICommandInvoker", ".", "Matcher", ".", "failedWith", ";", "import", "static", "hudson", ".", "cli", ".", "CLICommandInvoker", ".", "Matcher", ".", "succeeded", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "/", "/", "TODO", "merge", "it", "into", "BasicSSHUserPrivateKeyTest", "after", "security", "patch", "public", "class", "BasicSSHUserPrivateKeyTest_SEC440", "{", "@", "Rule", "public", "JenkinsRule", "r", "=", "new", "JenkinsRule", "(", ");", "{", "r", ".", "timeout", "=", "0", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "440", "\"", ")", "@", "LocalData", "(", "\"", "updateJob", "\"", ")", "public", "void", "userWithoutRunScripts_cannotMigrateDangerousPrivateKeySource", "(", ")", "throws", "Exception", "{", "Folder", "folder", "=", "r", ".", "jenkins", ".", "createProject", "(", "Folder", ".", "class", ",", "\"", "folder1", "\"", ");", "FilePath", "updateFolder", "=", "r", ".", "jenkins", ".", "getRootPath", "(", ").", "child", "(", "\"", "update_folder", ".", "xml", "\"", ");", "{", "/", "/", "as", "user", "with", "just", "configure", ",", "you", "cannot", "migrate", "CLICommandInvoker", ".", "Result", "result", "=", "new", "CLICommandInvoker", "(", "r", ",", "new", "UpdateJobCommand", "(", "))", ".", "authorizedTo", "(", "Jenkins", ".", "READ", ",", "Job", ".", "READ", ",", "Job", ".", "CONFIGURE", ")", ".", "withStdin", "(", "updateFolder", ".", "read", "(", "))", ".", "invokeWithArgs", "(", "\"", "folder1", "\"", ");", "assertThat", "(", "result", ".", "stderr", "(", "),", "containsString", "(", "\"", "user", "is", "missing", "the", "Overall", "/", "RunScripts", "permission", "\"", "))", ";", "assertThat", "(", "result", ",", "failedWith", "(", "-", "1", ")", ");", "/", "/", "config", "file", "not", "touched", "String", "configFileContent", "=", "folder", ".", "getConfigFile", "(", ").", "asString", "(", ");", "assertThat", "(", "configFileContent", ",", "not", "(", "containsString", "(", "\"", "FileOnMasterPrivateKeySource", "\"", "))", ");", "assertThat", "(", "configFileContent", ",", "not", "(", "containsString", "(", "\"", "BasicSSHUserPrivateKey", "\"", "))", ");", "}", "{", "/", "/", "but", "as", "admin", "with", "RUN_SCRIPTS", ",", "you", "can", "CLICommandInvoker", ".", "Result", "result", "=", "new", "CLICommandInvoker", "(", "r", ",", "new", "UpdateJobCommand", "(", "))", ".", "authorizedTo", "(", "Jenkins", ".", "ADMINISTER", ")", ".", "withStdin", "(", "updateFolder", ".", "read", "(", "))", ".", "invokeWithArgs", "(", "\"", "folder1", "\"", ");", "assertThat", "(", "result", ",", "succeeded", "(", "))", ";", "String", "configFileContent", "=", "folder", ".", "getConfigFile", "(", ").", "asString", "(", ");", "assertThat", "(", "configFileContent", ",", "containsString", "(", "\"", "BasicSSHUserPrivateKey", "\"", "))", ";", "assertThat", "(", "configFileContent", ",", "not", "(", "containsString", "(", "\"", "FileOnMasterPrivateKeySource", "\"", "))", ");", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "41", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", "plugin", "=", "\"", "cloudbees", "-", "folder", "@", "6", ".", "4", "\"", ">", "<", "actions", "/", ">", "<", "description", ">", "</", "description", ">", "<", "properties", ">", "<", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "properties", ".", "FolderCredentialsProvider_", "-", "FolderCredentialsProperty", ">", "<", "domainCredentialsMap", "class", "=", "\"", "hudson", ".", "util", ".", "CopyOnWriteMap", "$", "Hash", "\"", ">", "<", "entry", ">", "<", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", "plugin", "=", "\"", "credentials", "@", "2", ".", "1", ".", "16", "\"", ">", "<", "specifications", "/", ">", "<", "/", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "domains", ".", "Domain", ">", "<", "java", ".", "util", ".", "concurrent", ".", "CopyOnWriteArrayList", ">", "<", "com", ".", "cloudbees", ".", "jenkins", ".", "plugins", ".", "sshcredentials", ".", "impl", ".", "BasicSSHUserPrivateKey", "plugin", "=", "\"", "ssh", "-", "credentials", "@", "1", ".", "13", "\"", ">", "<", "id", ">", "From", "SSH", "<", "/", "id", ">", "<", "username", ">", "from_ssh", "<", "/", "username", ">", "<", "privateKeySource", "class", "=", "\"", "com", ".", "cloudbees", ".", "jenkins", ".", "plugins", ".", "sshcredentials", ".", "impl", ".", "BasicSSHUserPrivateKey", "$", "UsersPrivateKeySource", "\"", "/>", "<", "/", "com", ".", "cloudbees", ".", "jenkins", ".", "plugins", ".", "sshcredentials", ".", "impl", ".", "BasicSSHUserPrivateKey", ">", "<", "/", "java", ".", "util", ".", "concurrent", ".", "CopyOnWriteArrayList", ">", "<", "/", "entry", ">", "<", "/", "domainCredentialsMap", ">", "<", "/", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "properties", ".", "FolderCredentialsProvider_", "-", "FolderCredentialsProperty", ">", "<", "/", "properties", ">", "<", "folderViews", "class", "=", "\"", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "views", ".", "DefaultFolderViewHolder", "\"", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", "\"", "reference", "=", "\".", "./", "..", "/.", "./", "..", "\"/", ">", "<", "name", ">", "All", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "tabBar", "class", "=", "\"", "hudson", ".", "views", ".", "DefaultViewsTabBar", "\"", "/>", "<", "/", "folderViews", ">", "<", "healthMetrics", ">", "<", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "health", ".", "WorstChildHealthMetric", ">", "<", "nonRecursive", ">", "false", "<", "/", "nonRecursive", ">", "<", "/", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "health", ".", "WorstChildHealthMetric", ">", "<", "/", "healthMetrics", ">", "<", "icon", "class", "=", "\"", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "icons", ".", "StockFolderIcon", "\"", "/>", "<", "/", "com", ".", "cloudbees", ".", "hudson", ".", "plugins", ".", "folder", ".", "Folder", "></s><", "jenkins", ".", "version", ">", "1", ".", "609", "<", "/", "jenkins", ".", "version", ">", "<", "java", ".", "level", ">", "6", "<", "/", "java", ".", "level", ">", "<", "version", ">", "2", ".", "1", ".", "0", "<", "/", "version", ">", "import", "com", ".", "cloudbees", ".", "plugins", ".", "credentials", ".", "CredentialsSnapshotTaker", ";", "private", "Object", "writeReplace", "(", ")", "{", "if", "(", "/*", "XStream", "*", "/", "Channel", ".", "current", "(", ")", "=", "=", "null", ")", "{", "return", "this", ";", "}", "if", "(", "privateKeySource", "=", "=", "null", "|", "|", "privateKeySource", ".", "isSnapshotSource", "(", "))", "{", "return", "this", ";", "}", "return", "CredentialsProvider", ".", "snapshot", "(", "this", ")", ";", "}", "@", "DataBoundConstructor", "return", "this", ";", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Extension", "public", "static", "class", "DescriptorImpl", "extends", "PrivateKeySourceDescriptor", "{", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "Messages", ".", "BasicSSHUserPrivateKey_FileOnMasterPrivateKeySourceDisplayName", "(", ");", "}", "}", "@", "DataBoundConstructor", "public", "UsersPrivateKeySource", "(", ")", "{", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Extension", "public", "static", "class", "DescriptorImpl", "extends", "PrivateKeySourceDescriptor", "{", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "Messages", ".", "BasicSSHUserPrivateKey_UsersPrivateKeySourceDisplayName", "(", ");", "}", "/", "**", "*", "@", "since", "1", ".", "7", "*", "/", "@", "Extension", "public", "static", "class", "CredentialsSnapshotTakerImpl", "extends", "CredentialsSnapshotTaker", "<", "SSHUserPrivateKey", ">", "{", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "Class", "<", "SSHUserPrivateKey", ">", "type", "(", ")", "{", "return", "SSHUserPrivateKey", ".", "class", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "SSHUserPrivateKey", "snapshot", "(", "SSHUserPrivateKey", "credentials", ")", "{", "if", "(", "credentials", "instanceof", "BasicSSHUserPrivateKey", ")", "{", "final", "PrivateKeySource", "keySource", "=", "(", "(", "BasicSSHUserPrivateKey", ")", "credentials", ")", ".", "getPrivateKeySource", "(", ");", "if", "(", "keySource", ".", "isSnapshotSource", "(", "))", "{", "return", "credentials", ";", "}", "}", "final", "Secret", "passphrase", "=", "credentials", ".", "getPassphrase", "(", ");", "return", "new", "BasicSSHUserPrivateKey", "(", "credentials", ".", "getScope", "(", "),", "credentials", ".", "getId", "(", "),", "credentials", ".", "getUsername", "(", "),", "new", "DirectEntryPrivateKeySource", "(", "credentials", ".", "getPrivateKeys", "(", "))", ",", "passphrase", "=", "=", "null", "?", "null", ":", "passphrase", ".", "getEncryptedValue", "(", "),", "credentials", ".", "getDescription", "(", "))", ";", "BasicSSHUserPrivateKey", ".", "FileOnMasterPrivateKeySourceDisplayName", "=", "From", "a", "file", "on", "Jenkins", "master", "BasicSSHUserPrivateKey", ".", "UsersPrivateKeySourceDisplayName", "=", "From", "the", "Jenkins", "master", "~", "/.", "ssh", "BasicSSHUserPrivateKey", ".", "DisplayName", "=", "SSH", "Username", "with", "private", "key", "BasicSSHUserPrivateKey", ".", "FileOnMasterPrivateKeySourceDisplayName", "=", "Aus", "einer", "Datei", "auf", "dem", "Jenkins", "Master", "BasicSSHUserPrivateKey", ".", "UsersPrivateKeySourceDisplayName", "=", "Aus", "~", "/.", "ssh", "des", "Jenkins", "Masters", "BasicSSHUserPrivateKey", ".", "DisplayName", "=", "SSH", "Benutzername", "und", "privater", "Schl", "\\", "u00fcssel", "BasicSSHUserPrivateKey", ".", "FileOnMasterPrivateKeySourceDisplayName", "=", "Jenkins", "\\", "u30de", "\\", "u30b9", "\\", "u30bf", "\\", "u30fc", "\\", "u4e0a", "\\", "u306e", "\\", "u30d5", "\\", "u30a1", "\\", "u30a4", "\\", "u30eb", "\\", "u304b", "\\", "u3089", "BasicSSHUserPrivateKey", ".", "UsersPrivateKeySourceDisplayName", "=", "Jenkins", "\\", "u30de", "\\", "u30b9", "\\", "u30bf", "\\", "u30fc", "\\", "u4e0a", "\\", "u306e", "~", "/.", "ssh", "\\", "u304b", "\\", "u3089", "BasicSSHUserPrivateKey", ".", "DisplayName", "=", "SSH", "\\", "u30e6", "\\", "u30fc", "\\", "u30b6", "\\", "u30fc", "\\", "u540d", "\\", "u3068", "\\", "u79d8", "\\", "u5bc6", "\\", "u9375", "@", "Test", "public", "void", "masterKeysOnSlave", "(", ")", "throws", "Exception", "{", "FilePath", "keyfile", "=", "r", ".", "jenkins", ".", "getRootPath", "(", ").", "child", "(", "\"", "key", "\"", ");", "keyfile", ".", "write", "(", "\"", "stuff", "\"", ",", "null", ")", ";", "SSHUserPrivateKey", "key", "=", "new", "BasicSSHUserPrivateKey", "(", "CredentialsScope", ".", "SYSTEM", ",", "\"", "mycreds", "\"", ",", "\"", "git", "\"", ",", "new", "BasicSSHUserPrivateKey", ".", "FileOnMasterPrivateKeySource", "(", "keyfile", ".", "getRemote", "(", "))", ",", "null", ",", "null", ")", ";", "assertEquals", "(", "\"[", "stuff", "]", "\",", "key", ".", "getPrivateKeys", "(", ").", "toString", "(", "))", ";", "/", "/", "TODO", "would", "be", "more", "interesting", "to", "use", "a", "Docker", "fixture", "to", "demonstrate", "that", "the", "file", "load", "is", "happening", "only", "from", "the", "master", "side", "assertEquals", "(", "\"[", "stuff", "]", "\",", "r", ".", "createOnlineSlave", "(", ").", "getChannel", "(", ").", "call", "(", "new", "LoadPrivateKeys", "(", "key", ")", "))", ";", "}", "private", "static", "class", "LoadPrivateKeys", "extends", "MasterToSlaveCallable", "<", "String", ",", "Exception", ">", "{", "private", "final", "SSHUserPrivateKey", "key", ";", "LoadPrivateKeys", "(", "SSHUserPrivateKey", "key", ")", "{", "this", ".", "key", "=", "key", ";", "}", "@", "Override", "public", "String", "call", "(", ")", "throws", "Exception", "{", "return", "key", ".", "getPrivateKeys", "(", ").", "toString", "(", ");", "}", "}"], "docstring_tokens": ["arbitrary", "file", "read"]}
{"contents": ["CAMEL-12630:", "better", "attachment", "handling", "in", "came...", "...l-mail", "component"], "code_tokens": ["<", "dependency", ">", "<", "groupId", ">", "org", ".", "assertj", "<", "/", "groupId", ">", "<", "artifactId", ">", "assertj", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "${", "assertj", "-", "version", "}", "</", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "mail", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "javax", ".", "activation", ".", "DataSource", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "ObjectHelper", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "StringHelper", ";", "final", "class", "DelegatingDataSource", "implements", "DataSource", "{", "private", "final", "DataSource", "delegate", ";", "private", "final", "String", "name", ";", "public", "DelegatingDataSource", "(", "final", "String", "name", ",", "final", "DataSource", "delegate", ")", "{", "this", ".", "name", "=", "StringHelper", ".", "notEmpty", "(", "name", ",", "\"", "name", "\"", ");", "this", ".", "delegate", "=", "ObjectHelper", ".", "notNull", "(", "delegate", ",", "\"", "DataSource", "\"", ");", "}", "@", "Override", "public", "String", "getContentType", "(", ")", "{", "return", "delegate", ".", "getContentType", "(", ");", "}", "@", "Override", "public", "InputStream", "getInputStream", "(", ")", "throws", "IOException", "{", "return", "delegate", ".", "getInputStream", "(", ");", "}", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "@", "Override", "public", "OutputStream", "getOutputStream", "(", ")", "throws", "IOException", "{", "return", "delegate", ".", "getOutputStream", "(", ");", "}", "}", "@", "@", "-", "52", ",", "6", "+", "52", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "FileUtil", ";", "String", "fileName", "=", "FileUtil", ".", "stripPath", "(", "part", ".", "getFileName", "(", "))", ";", "final", "DataHandler", "dataHandler", "=", "part", ".", "getDataHandler", "(", ");", "final", "DataSource", "dataSource", "=", "dataHandler", ".", "getDataSource", "(", ");", "final", "DataHandler", "replacement", "=", "new", "DataHandler", "(", "new", "DelegatingDataSource", "(", "fileName", ",", "dataSource", ")", ");", "DefaultAttachment", "camelAttachment", "=", "new", "DefaultAttachment", "(", "replacement", ")", ";", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "mail", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "activation", ".", "DataHandler", ";", "import", "javax", ".", "mail", ".", "Message", ";", "import", "javax", ".", "mail", ".", "MessagingException", ";", "import", "javax", ".", "mail", ".", "Multipart", ";", "import", "javax", ".", "mail", ".", "Session", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeBodyPart", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeMessage", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeMultipart", ";", "import", "org", ".", "apache", ".", "camel", ".", "Attachment", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameter", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameters", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "@", "RunWith", "(", "Parameterized", ".", "class", ")", "public", "class", "MailBindingAttachmentFileTest", "{", "@", "Parameter", "public", "String", "name", ";", "private", "final", "MailBinding", "binding", "=", "new", "MailBinding", "(", ");", "@", "Test", "public", "void", "shouldSanitizeAttachmentFileNames", "(", ")", "throws", "MessagingException", ",", "IOException", "{", "final", "Session", "session", "=", "Session", ".", "getInstance", "(", "new", "Properties", "(", "))", ";", "final", "Message", "message", "=", "new", "MimeMessage", "(", "session", ")", ";", "final", "Multipart", "multipart", "=", "new", "MimeMultipart", "(", ");", "final", "MimeBodyPart", "part", "=", "new", "MimeBodyPart", "(", ");", "part", ".", "attachFile", "(", "name", ")", ";", "multipart", ".", "addBodyPart", "(", "part", ")", ";", "message", ".", "setContent", "(", "multipart", ")", ";", "final", "Map", "<", "String", ",", "Attachment", ">", "attachments", "=", "new", "HashMap", "<", ">(", ");", "binding", ".", "extractAttachmentsFromMail", "(", "message", ",", "attachments", ")", ";", "assertThat", "(", "attachments", ")", ".", "containsKey", "(", "\"", "file", ".", "txt", "\"", ");", "final", "Attachment", "attachment", "=", "attachments", ".", "get", "(", "\"", "file", ".", "txt", "\"", ");", "final", "DataHandler", "dataHandler", "=", "attachment", ".", "getDataHandler", "(", ");", "assertThat", "(", "dataHandler", ".", "getName", "(", "))", ".", "isEqualTo", "(", "\"", "file", ".", "txt", "\"", ");", "}", "@", "Parameters", "(", "name", "=", "\"", "{", "0", "}", "\")", "public", "static", "Iterable", "<", "String", ">", "fileNames", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "\"", "file", ".", "txt", "\"", ",", "\"", "..", "/", "file", ".", "txt", "\"", ",", "\"", "..", "\\\\", "file", ".", "txt", "\"", ",", "\"", "/", "absolute", "/", "file", ".", "txt", "\"", ",", "\"", "c", ":", "\\\\", "absolute", "\\", "\\", "file", ".", "txt", "\"", ");", "}", "}</s>String", "fileName", "=", "part", ".", "getFileName", "(", ");", "DefaultAttachment", "camelAttachment", "=", "new", "DefaultAttachment", "(", "part", ".", "getDataHandler", "(", "))", ";"], "docstring_tokens": ["path", "traversal"]}
{"contents": ["Verifies", "resources", "are", "in", "allowed", "locations"], "code_tokens": ["import", "java", ".", "util", ".", "ArrayList", ";", "ArrayList", "<", "Resource", ">", "locationResources", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "!", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "locationResources", ".", "add", "(", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ");", "}", "}", "for", "(", "Resource", "location", ":", "locationResources", ")", "{", "Resource", "file", "=", "location", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", ")", "&", "&", "PathUtils", ".", "checkResource", "(", "file", ",", "location", ",", "locationResources", ")", ")", "{", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "UrlResource", ";", "/", "**", "*", "Perform", "additional", "checks", "on", "a", "resolved", "resource", "beyond", "checking", "whether", "the", "*", "resources", "exists", "and", "is", "readable", ".", "The", "default", "implementation", "also", "verifies", "the", "*", "resource", "is", "either", "under", "the", "location", "relative", "to", "which", "it", "was", "found", "or", "is", "under", "*", "one", "of", "the", "{", "@", "link", "#", "setAllowedLocations", "allowed", "locations", "}", ".", "*", "@", "param", "resource", "the", "resource", "to", "check", "*", "@", "param", "location", "the", "location", "relative", "to", "which", "the", "resource", "was", "found", "*", "@", "param", "allowedLocations", "set", "of", "allowed", "locations", "*", "@", "return", "\"", "true", "\"", "if", "resource", "is", "in", "a", "valid", "location", ",", "\"", "false", "\"", "otherwise", ".", "*", "@", "throws", "IOException", "if", "Resource", "URLS", "fail", "to", "parse", ".", "*", "@", "since", "4", ".", "1", ".", "2", "*", "/", "public", "static", "boolean", "checkResource", "(", "Resource", "resource", ",", "Resource", "location", ",", "List", "<", "Resource", ">", "allowedLocations", ")", "throws", "IOException", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "location", ")", ")", "{", "return", "true", ";", "}", "if", "(", "allowedLocations", "!", "=", "null", ")", "{", "for", "(", "Resource", "current", ":", "allowedLocations", ")", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "current", ")", ")", "{", "return", "true", ";", "}", "}", "}", "if", "(", "logger", ".", "isWarnEnabled", "(", "))", "{", "logger", ".", "warn", "(", "\"", "Resource", "path", "\\", "\"\"", "+", "location", ".", "getURI", "(", ")", "+", "\"", "\\\"", "was", "successfully", "resolved", "\"", "+", "\"", "but", "resource", "\\", "\"\"", "+", "resource", ".", "getURL", "(", ")", "+", "\"", "\\\"", "is", "neither", "under", "the", "\"", "+", "\"", "current", "location", "\\", "\"\"", "+", "location", ".", "getURL", "(", ")", "+", "\"", "\\\"", "nor", "under", "any", "of", "the", "\"", "+", "\"", "allowed", "locations", "\"", "+", "(", "allowedLocations", "!", "=", "null", "?", "allowedLocations", ":", "\"", "[]", "\")", ");", "}", "return", "false", ";", "}", "private", "static", "boolean", "isResourceUnderLocation", "(", "Resource", "resource", ",", "Resource", "location", ")", "throws", "IOException", "{", "if", "(", "resource", ".", "getClass", "(", ")", "!", "=", "location", ".", "getClass", "(", "))", "{", "return", "false", ";", "}", "String", "resourcePath", ";", "String", "locationPath", ";", "if", "(", "resource", "instanceof", "UrlResource", ")", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "toExternalForm", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "toString", "(", "))", ";", "}", "else", "if", "(", "resource", "instanceof", "ClassPathResource", ")", "{", "resourcePath", "=", "(", "(", "ClassPathResource", ")", "resource", ")", ".", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "((", "ClassPathResource", ")", "location", ")", ".", "getPath", "(", "))", ";", "}", "else", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "getPath", "(", "))", ";", "}", "if", "(", "locationPath", ".", "equals", "(", "resourcePath", ")", ")", "{", "return", "true", ";", "}", "locationPath", "=", "(", "locationPath", ".", "endsWith", "(", "\"/", "\")", "|", "|", "locationPath", ".", "isEmpty", "(", ")", "?", "locationPath", ":", "locationPath", "+", "\"", "/\"", ");", "return", "(", "resourcePath", ".", "startsWith", "(", "locationPath", ")", "&", "&", "!", "isInvalidEncodedPath", "(", "resourcePath", ")", ");", "}", "@", "Test", "public", "void", "invalidPathEncodedSlash", "(", ")", "{", "String", "file", "=", "System", ".", "getProperty", "(", "\"", "user", ".", "dir", "\"", ");", "file", "=", "file", ".", "replaceFirst", "(", "\"\\", "\\/", "\",", "\"", "%", "2f", "\"", ");", "file", "+", "=", "\"", "/", "src", "/", "test", "/", "resources", "/", "ssh", "/", "key", "\"", ";", "this", ".", "exception", ".", "expect", "(", "NoSuchResourceException", ".", "class", ")", ";", "this", ".", "nativeRepository", ".", "setSearchLocations", "(", "\"", "file", ":", "./", "\")", ";", "this", ".", "output", ".", "expect", "(", "containsString", "(", "\"", "is", "neither", "under", "the", "current", "location", "\"", "))", ";", "this", ".", "repository", ".", "findOne", "(", "\"", "blah", "\"", ",", "\"", "local", "\"", ",", "\"", "master", "\"", ",", "file", ")", ";", "}</s>for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "continue", ";", "}", "Resource", "file", "=", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", "))", "{"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["xfs:", "prevent", "reading", "uninitialized", "stack", "memory", "The", "XFS_IOC_FSGETXATTR", "ioctl", "allows", "unprivileged", "users", "to", "read", "12", "bytes", "of", "uninitialized", "stack", "memory,", "because", "the", "fsxattr", "struct", "declared", "on", "the", "stack", "in", "xfs_ioc_fsgetxattr()", "does", "not", "alter", "(or", "zero)", "the", "12-byte", "fsx_pad", "member", "before", "copying", "it", "back", "to", "the", "user.", "This", "patch", "takes", "care", "of", "it.", "Signed-off-by:", "Dan", "Rosenberg", "<dan.j.rosenberg@gmail.com>", "Reviewed-by:", "Eric", "Sandeen", "<sandeen@redhat.com>", "Signed-off-by:", "Alex", "Elder", "<aelder@sgi.com>"], "code_tokens": ["memset", "(", "&", "fa", ",", "0", ",", "sizeof", "(", "struct", "fsxattr", ")", ");</s>"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["Stricter", "header", "value", "parsing"], "code_tokens": ["private", "boolean", "rejectIllegalHeader", "=", "false", ";", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "*", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "will", "the", "request", "be", "rejected", "*", "(", "with", "a", "400", "response", ")", "or", "will", "the", "illegal", "header", "be", "ignored", "?", "public", "boolean", "getRejectIllegalHeader", "(", ")", "{", "return", "rejectIllegalHeader", ";", "}", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "*", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "should", "the", "request", "be", "*", "rejected", "(", "with", "a", "400", "response", ")", "or", "should", "the", "illegal", "header", "be", "ignored", "?", "*", "*", "@", "param", "rejectIllegalHeader", "{", "@", "code", "true", "}", "to", "reject", "requests", "with", "illegal", "*", "header", "names", "or", "values", ",", "{", "@", "code", "false", "}", "to", "*", "ignore", "the", "header", "*", "/", "public", "void", "setRejectIllegalHeader", "(", "boolean", "rejectIllegalHeader", ")", "{", "this", ".", "rejectIllegalHeader", "=", "rejectIllegalHeader", ";", "}", "/", "**", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "*", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "will", "the", "request", "be", "rejected", "*", "(", "with", "a", "400", "response", ")", "or", "will", "the", "illegal", "header", "be", "ignored", "?", "*", "*", "@", "return", "{", "@", "code", "true", "}", "if", "the", "request", "will", "be", "rejected", "or", "{", "@", "code", "false", "}", "if", "*", "the", "header", "will", "be", "ignored", "*", "*", "@", "deprecated", "Now", "an", "alias", "for", "{", "@", "link", "#", "getRejectIllegalHeader", "(", ")}", ".", "Will", "be", "*", "removed", "in", "Tomcat", "10", "onwards", ".", "*", "/", "@", "Deprecated", "public", "boolean", "getRejectIllegalHeaderName", "(", ")", "{", "return", "rejectIllegalHeader", ";", "}", "/", "**", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "*", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "should", "the", "request", "be", "*", "rejected", "(", "with", "a", "400", "response", ")", "or", "should", "the", "illegal", "header", "be", "ignored", "?", "*", "illegal", "header", "names", "or", "values", ",", "*", "{", "@", "code", "false", "}", "to", "ignore", "the", "header", "*", "*", "@", "deprecated", "Now", "an", "alias", "for", "{", "@", "link", "#", "setRejectIllegalHeader", "(", "boolean", ")", "}.", "*", "Will", "be", "removed", "in", "Tomcat", "10", "onwards", ".", "@", "Deprecated", "this", ".", "rejectIllegalHeader", "=", "rejectIllegalHeaderName", ";", "/", "**", "*", "Do", "HTTP", "headers", "with", "illegal", "names", "and", "/", "or", "values", "cause", "the", "request", "to", "be", "*", "rejected", "?", "Note", "that", "the", "field", "name", "is", "not", "quite", "right", "but", "cannot", "be", "*", "easily", "changed", "without", "breaking", "binary", "compatibility", ".", "*", "/", "public", "Http11AprProcessor", "(", "int", "headerBufferSize", ",", "boolean", "rejectIllegalHeader", ",", "inputBuffer", "=", "new", "InternalAprInputBuffer", "(", "request", ",", "headerBufferSize", ",", "rejectIllegalHeader", ",", "proto", ".", "getMaxHttpHeaderSize", "(", "),", "proto", ".", "getRejectIllegalHeader", "(", "),", "public", "Http11NioProcessor", "(", "int", "maxHttpHeaderSize", ",", "boolean", "rejectIllegalHeader", ",", "rejectIllegalHeader", ",", "httpParser", ")", ";", "proto", ".", "getMaxHttpHeaderSize", "(", "),", "proto", ".", "getRejectIllegalHeader", "(", "),", "public", "Http11Processor", "(", "int", "headerBufferSize", ",", "boolean", "rejectIllegalHeader", ",", "inputBuffer", "=", "new", "InternalInputBuffer", "(", "request", ",", "headerBufferSize", ",", "rejectIllegalHeader", ",", "proto", ".", "getMaxHttpHeaderSize", "(", "),", "proto", ".", "getRejectIllegalHeader", "(", "),", "boolean", "rejectIllegalHeader", ",", "HttpParser", "httpParser", ")", "{", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeader", ";", "byte", "prevChr", "=", "0", ";", "prevChr", "=", "chr", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", "&", "&", "prevChr", "!", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Possible", "start", "of", "CRLF", "-", "process", "the", "next", "byte", ".", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "pos", "+", "+;", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Must", "have", "read", "two", "bytes", "(", "first", "was", "CR", ",", "second", "was", "not", "LF", ")", "pos", "-", "-;", "}", "prevChr", "=", "chr", ";", "chr", "=", "buf", "[", "pos", "]", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Possible", "start", "of", "CRLF", "-", "process", "the", "next", "byte", ".", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Invalid", "value", "/", "/", "Delete", "the", "header", "(", "it", "will", "be", "the", "most", "recent", "one", ")", "headers", ".", "removeHeader", "(", "headers", ".", "size", "(", ")", "-", "1", ")", ";", "skipLine", "(", "lineStart", ",", "start", ")", ";", "return", "true", ";", "}", "else", "if", "(", "chr", "!", "=", "Constants", ".", "HT", "&", "&", "HttpParser", ".", "isControl", "(", "chr", ")", ")", "{", "/", "/", "Invalid", "value", "/", "/", "Delete", "the", "header", "(", "it", "will", "be", "the", "most", "recent", "one", ")", "headers", ".", "removeHeader", "(", "headers", ".", "size", "(", ")", "-", "1", ")", ";", "skipLine", "(", "lineStart", ",", "start", ")", ";", "return", "true", ";", "byte", "chr", "=", "0", ";", "byte", "prevChr", "=", "0", ";", "prevChr", "=", "chr", ";", "chr", "=", "buf", "[", "pos", "]", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "boolean", "rejectIllegalHeader", ",", "HttpParser", "httpParser", ")", "{", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeader", ";", "byte", "prevChr", "=", "0", ";", "prevChr", "=", "chr", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", "&", "&", "prevChr", "!", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Possible", "start", "of", "CRLF", "-", "process", "the", "next", "byte", ".", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Must", "have", "read", "two", "bytes", "(", "first", "was", "CR", ",", "second", "was", "not", "LF", ")", "pos", "-", "-;", "}", "prevChr", "=", "chr", ";", "chr", "=", "buf", "[", "pos", "]", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Possible", "start", "of", "CRLF", "-", "process", "the", "next", "byte", ".", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Invalid", "value", "/", "/", "Delete", "the", "header", "(", "it", "will", "be", "the", "most", "recent", "one", ")", "headers", ".", "removeHeader", "(", "headers", ".", "size", "(", ")", "-", "1", ")", ";", "skipLine", "(", "lineStart", ",", "start", ")", ";", "return", "true", ";", "}", "else", "if", "(", "chr", "!", "=", "Constants", ".", "HT", "&", "&", "HttpParser", ".", "isControl", "(", "chr", ")", ")", "{", "/", "/", "Invalid", "value", "/", "/", "Delete", "the", "header", "(", "it", "will", "be", "the", "most", "recent", "one", ")", "headers", ".", "removeHeader", "(", "headers", ".", "size", "(", ")", "-", "1", ")", ";", "skipLine", "(", "lineStart", ",", "start", ")", ";", "return", "true", ";", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "SP", ")", "{", "buf", "[", "realPos", "]", "=", "chr", ";", "buf", "[", "realPos", "]", "=", "chr", ";", "byte", "chr", "=", "0", ";", "byte", "prevChr", "=", "0", ";", "prevChr", "=", "chr", ";", "chr", "=", "buf", "[", "pos", "]", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "boolean", "rejectIllegalHeader", ",", "HttpParser", "httpParser", ")", "{", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeader", ";", "byte", "prevChr", "=", "0", ";", "prevChr", "=", "chr", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", "&", "&", "prevChr", "!", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Possible", "start", "of", "CRLF", "-", "process", "the", "next", "byte", ".", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Must", "have", "read", "two", "bytes", "(", "first", "was", "CR", ",", "second", "was", "not", "LF", ")", "pos", "-", "-;", "}", "prevChr", "=", "chr", ";", "/", "/", "Possible", "start", "of", "CRLF", "-", "process", "the", "next", "byte", ".", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Invalid", "value", "/", "/", "Delete", "the", "header", "(", "it", "will", "be", "the", "most", "recent", "one", ")", "headers", ".", "removeHeader", "(", "headers", ".", "size", "(", ")", "-", "1", ")", ";", "return", "skipLine", "(", ");", "}", "else", "if", "(", "chr", "!", "=", "Constants", ".", "HT", "&", "&", "HttpParser", ".", "isControl", "(", "chr", ")", ")", "{", "/", "/", "Invalid", "value", "/", "/", "Delete", "the", "header", "(", "it", "will", "be", "the", "most", "recent", "one", ")", "headers", ".", "removeHeader", "(", "headers", ".", "size", "(", ")", "-", "1", ")", ";", "return", "skipLine", "(", ");", "byte", "chr", "=", "0", ";", "byte", "prevChr", "=", "0", ";", "prevChr", "=", "chr", ";", "chr", "=", "buf", "[", "pos", "]", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "public", "void", "removeHeader", "(", "int", "idx", ")", "{", "public", "static", "boolean", "isControl", "(", "int", "c", ")", "{", "/", "/", "Fast", "for", "valid", "control", "characters", ",", "slower", "for", "some", "incorrect", "/", "/", "ones", "try", "{", "return", "IS_CONTROL", "[", "c", "]", ";", "}", "catch", "(", "ArrayIndexOutOfBoundsException", "ex", ")", "{", "return", "false", ";", "}", "}", "public", "void", "testBug51557SeparatorsInName", "(", ")", "throws", "Exception", "{", "doTestBug51557CharInName", "(", "s", ")", ";", "public", "void", "testBug51557CtlInName", "(", ")", "throws", "Exception", "{", "doTestBug51557CharInName", "(", "(", "char", ")", "i", ")", ";", "tearDown", "(", ");", "setUp", "(", ");", "}", "doTestBug51557CharInName", "(", "(", "char", ")", "127", ")", ";", "}", "@", "Test", "public", "void", "testBug51557CtlInValue", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "31", ";", "i", "+", "+)", "{", "if", "(", "i", "=", "=", "'", "\\", "t", "'", ")", "{", "/", "/", "TAB", "is", "allowed", "continue", ";", "}", "doTestBug51557InvalidCharInValue", "(", "(", "char", ")", "i", ")", ";", "tearDown", "(", ");", "setUp", "(", ");", "}", "doTestBug51557InvalidCharInValue", "(", "(", "char", ")", "127", ")", ";", "}", "@", "Test", "public", "void", "testBug51557ObsTextInValue", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "128", ";", "i", "<", "255", ";", "i", "+", "+)", "{", "doTestBug51557ValidCharInValue", "(", "(", "char", ")", "i", ")", ";", "@", "Test", "public", "void", "testBug51557CRStartName", "(", ")", "{", "Bug51557Client", "client", "=", "new", "Bug51557Client", "(", "\"\\", "rName", "=", "\",", "\"", "invalid", "\"", ");", "client", ".", "doRequest", "(", ");", "Assert", ".", "assertTrue", "(", "client", ".", "isResponse200", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "abcd", "\"", ",", "client", ".", "getResponseBody", "(", "))", ";", "Assert", ".", "assertTrue", "(", "client", ".", "isResponseBodyOK", "(", "))", ";", "}", "@", "Test", "public", "void", "testBug51557CR2StartName", "(", ")", "{", "Bug51557Client", "client", "=", "new", "Bug51557Client", "(", "\"\\", "r", "\\", "rName", "=", "\",", "\"", "invalid", "\"", ");", "client", ".", "doRequest", "(", ");", "Assert", ".", "assertTrue", "(", "client", ".", "isResponse200", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "abcd", "\"", ",", "client", ".", "getResponseBody", "(", "))", ";", "Assert", ".", "assertTrue", "(", "client", ".", "isResponseBodyOK", "(", "))", ";", "}", "private", "void", "doTestBug51557CharInName", "(", "char", "s", ")", "{", "private", "void", "doTestBug51557InvalidCharInValue", "(", "char", "s", ")", "{", "Bug51557Client", "client", "=", "new", "Bug51557Client", "(", "\"", "X", "-", "Bug51557", "-", "Invalid", "\"", ",", "\"", "invalid", "\"", "+", "s", "+", "\"", "invalid", "\"", ");", "client", ".", "doRequest", "(", ");", "Assert", ".", "assertTrue", "(", "\"", "Testing", "[", "\"", "+", "(", "int", ")", "s", "+", "\"", "]\"", ",", "client", ".", "isResponse200", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Testing", "[", "\"", "+", "(", "int", ")", "s", "+", "\"", "]\"", ",", "\"", "abcd", "\"", ",", "client", ".", "getResponseBody", "(", "))", ";", "Assert", ".", "assertTrue", "(", "client", ".", "isResponseBodyOK", "(", "))", ";", "}", "private", "void", "doTestBug51557ValidCharInValue", "(", "char", "s", ")", "{", "Bug51557Client", "client", "=", "new", "Bug51557Client", "(", "\"", "X", "-", "Bug51557", "-", "Valid", "\"", ",", "\"", "valid", "\"", "+", "s", "+", "\"", "valid", "\"", ");", "client", ".", "doRequest", "(", ");", "Assert", ".", "assertTrue", "(", "\"", "Testing", "[", "\"", "+", "(", "int", ")", "s", "+", "\"", "]\"", ",", "client", ".", "isResponse200", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Testing", "[", "\"", "+", "(", "int", ")", "s", "+", "\"", "]\"", ",", "\"", "valid", "\"", "+", "s", "+", "\"", "validabcd", "\"", ",", "client", ".", "getResponseBody", "(", "))", ";", "Assert", ".", "assertTrue", "(", "client", ".", "isResponseBodyOK", "(", "))", ";", "}", "private", "final", "boolean", "rejectIllegalHeader", ";", "this", ".", "rejectIllegalHeader", "=", "false", ";", "boolean", "rejectIllegalHeader", ")", "{", "this", ".", "rejectIllegalHeader", "=", "rejectIllegalHeader", ";", "Assert", ".", "assertTrue", "(", "connector", ".", "setProperty", "(", "\"", "rejectIllegalHeader", "\"", ",", "Boolean", ".", "toString", "(", "rejectIllegalHeader", ")", "))", ";", "/", "**", "*", "Test", "case", "for", "https", ":", "//", "bz", ".", "apache", ".", "org", "/", "bugzilla", "/", "show_bug", ".", "cgi", "?", "id", "=", "59089", "*", "/", "@", "Test", "public", "void", "testBug59089", "(", ")", "{", "Bug59089Client", "client", "=", "new", "Bug59089Client", "(", ");", "client", ".", "doRequest", "(", ");", "Assert", ".", "assertTrue", "(", "client", ".", "isResponse200", "(", "))", ";", "Assert", ".", "assertTrue", "(", "client", ".", "isResponseBodyOK", "(", "))", ";", "}", "/", "**", "*", "Bug", "59089", "test", "client", ".", "*", "/", "private", "class", "Bug59089Client", "extends", "SimpleHttpClient", "{", "private", "Exception", "doRequest", "(", ")", "{", "/", "/", "Ensure", "body", "is", "read", "correctly", "setUseContentLength", "(", "true", ")", ";", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "Context", "root", "=", "tomcat", ".", "addContext", "(", "\"\"", ",", "TEMP_DIR", ")", ";", "Tomcat", ".", "addServlet", "(", "root", ",", "\"", "Bug59089", "\"", ",", "new", "TesterServlet", "(", "))", ";", "root", ".", "addServletMapping", "(", "\"/", "test", "\"", ",", "\"", "Bug59089", "\"", ");", "try", "{", "Connector", "connector", "=", "tomcat", ".", "getConnector", "(", ");", "Assert", ".", "assertTrue", "(", "connector", ".", "setProperty", "(", "\"", "rejectIllegalHeader", "\"", ",", "\"", "false", "\"", "))", ";", "tomcat", ".", "start", "(", ");", "setPort", "(", "connector", ".", "getLocalPort", "(", "))", ";", "/", "/", "Open", "connection", "connect", "(", ");", "String", "[", "]", "request", "=", "new", "String", "[", "1", "]", ";", "request", "[", "0", "]", "=", "\"", "GET", "http", ":", "//", "localhost", ":", "8080", "/", "test", "HTTP", "/", "1", ".", "1", "\"", "+", "CRLF", "\"", "Host", ":", "localhost", ":", "8080", "\"", "+", "CRLF", "\"", "X", "-", "Header", ":", "Ignore", "\"", "+", "CRLF", "\"", "X", "-", "Header", "\"", "+", "(", "char", ")", "130", "+", "\"", ":", "Broken", "\"", "+", "CRLF", "+", "CRLF", ";", "setRequest", "(", "request", ")", ";", "processRequest", "(", ");", "/", "/", "blocks", "until", "response", "has", "been", "read", "/", "/", "Close", "the", "connection", "disconnect", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "return", "e", ";", "}", "return", "null", ";", "}", "@", "Override", "public", "boolean", "isResponseBodyOK", "(", ")", "{", "if", "(", "getResponseBody", "(", ")", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "!", "getResponseBody", "(", ").", "contains", "(", "\"", "OK", "\"", "))", "{", "return", "false", ";", "}", "return", "true", ";", "}", "}", "<", "fix", ">", "Rename", "the", "HTTP", "Connector", "attribute", "<", "code", ">", "rejectIllegalHeaderName", "<", "/", "code", ">", "to", "<", "code", ">", "rejectIllegalHeader", "<", "/", "code", ">", "and", "expand", "the", "underlying", "implementation", "to", "include", "header", "values", "as", "well", "as", "names", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "attribute", "name", "=", "\"", "rejectIllegalHeader", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "this", "setting", "determines", "if", "the", "<", "attribute", "name", "=", "\"", "rejectIllegalHeaderName", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "This", "attribute", "is", "deprecated", ".", "It", "will", "be", "removed", "in", "Tomcat", "10", "onwards", ".", "It", "is", "now", "an", "alias", "for", "<", "strong", ">", "rejectIllegalHeader", "<", "/", "strong", ">", ".<", "/", "p", ">", "<", "/", "attribute", "></s>private", "boolean", "rejectIllegalHeaderName", "=", "false", ";", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "(", "i", ".", "e", ".", "*", "the", "header", "name", "is", "not", "a", "token", ")", "will", "the", "request", "be", "rejected", "(", "with", "a", "400", "*", "response", ")", "or", "will", "the", "illegal", "header", "be", "ignored", ".", "public", "boolean", "getRejectIllegalHeaderName", "(", ")", "{", "return", "rejectIllegalHeaderName", ";", "}", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "(", "i", ".", "e", ".", "*", "the", "header", "name", "is", "not", "a", "token", ")", "should", "the", "request", "be", "rejected", "(", "with", "a", "*", "400", "response", ")", "or", "should", "the", "illegal", "header", "be", "ignored", ".", "*", "illegal", "header", "names", ",", "{", "@", "code", "false", "}", "to", "*", "ignore", "the", "header", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeaderName", ";", "public", "Http11AprProcessor", "(", "int", "headerBufferSize", ",", "boolean", "rejectIllegalHeaderName", ",", "inputBuffer", "=", "new", "InternalAprInputBuffer", "(", "request", ",", "headerBufferSize", ",", "rejectIllegalHeaderName", ",", "proto", ".", "getMaxHttpHeaderSize", "(", "),", "proto", ".", "getRejectIllegalHeaderName", "(", "),", "public", "Http11NioProcessor", "(", "int", "maxHttpHeaderSize", ",", "boolean", "rejectIllegalHeaderName", ",", "rejectIllegalHeaderName", ",", "httpParser", ")", ";", "proto", ".", "getMaxHttpHeaderSize", "(", "),", "proto", ".", "getRejectIllegalHeaderName", "(", "),", "public", "Http11Processor", "(", "int", "headerBufferSize", ",", "boolean", "rejectIllegalHeaderName", ",", "inputBuffer", "=", "new", "InternalInputBuffer", "(", "request", ",", "headerBufferSize", ",", "rejectIllegalHeaderName", ",", "proto", ".", "getMaxHttpHeaderSize", "(", "),", "proto", ".", "getRejectIllegalHeaderName", "(", "),", "boolean", "rejectIllegalHeaderName", ",", "HttpParser", "httpParser", ")", "{", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeaderName", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "pos", "+", "+;", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "LF", ")", "{", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "CR", ")", "{", "}", "else", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "LF", ")", "{", "boolean", "rejectIllegalHeaderName", ",", "HttpParser", "httpParser", ")", "{", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeaderName", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "LF", ")", "{", "}", "else", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "SP", ")", "{", "buf", "[", "realPos", "]", "=", "buf", "[", "pos", "]", ";", "buf", "[", "realPos", "]", "=", "buf", "[", "pos", "]", ";", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "CR", ")", "{", "}", "else", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "LF", ")", "{", "boolean", "rejectIllegalHeaderName", ",", "HttpParser", "httpParser", ")", "{", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeaderName", ";", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "CR", ")", "{", "}", "else", "if", "(", "buf", "[", "pos", "]", "=", "=", "Constants", ".", "LF", ")", "{", "private", "void", "removeHeader", "(", "int", "idx", ")", "{", "public", "void", "testBug51557Separators", "(", ")", "throws", "Exception", "{", "doTestBug51557Char", "(", "s", ")", ";", "public", "void", "testBug51557Ctl", "(", ")", "throws", "Exception", "{", "doTestBug51557Char", "(", "(", "char", ")", "i", ")", ";", "doTestBug51557Char", "(", "(", "char", ")", "127", ")", ";", "private", "void", "doTestBug51557Char", "(", "char", "s", ")", "{", "private", "final", "boolean", "rejectIllegalHeaderName", ";", "this", ".", "rejectIllegalHeaderName", "=", "false", ";", "boolean", "rejectIllegalHeaderName", ")", "{", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeaderName", ";", "connector", ".", "setProperty", "(", "\"", "rejectIllegalHeaderName", "\"", ",", "Boolean", ".", "toString", "(", "rejectIllegalHeaderName", ")", ");", "<", "attribute", "name", "=", "\"", "rejectIllegalHeaderName", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "(", "i", ".", "e", ".", "the", "header", "name", "is", "not", "a", "token", ")", "this", "setting", "determines", "if", "the"], "docstring_tokens": ["http", "request", "smuggling"]}
{"contents": ["staging:", "android:", "ashmem:", "fix", "a", "race", "condition", "in", "ASHMEM_SET_SIZE", "ioctl", "A", "lock-unlock", "is", "missing", "in", "ASHMEM_SET_SIZE", "ioctl", "which", "can", "result", "in", "a", "race", "condition", "when", "mmap", "is", "called.", "After", "the", "!asma->file", "check,", "before", "setting", "asma->size,", "asma->file", "can", "be", "set", "in", "mmap.", "That", "would", "result", "in", "having", "different", "asma->size", "than", "the", "mapped", "memory", "size.", "Combined", "with", "ASHMEM_UNPIN", "ioctl", "and", "shrinker", "invocation,", "this", "can", "result", "in", "memory", "corruption.", "Signed-off-by:", "Viktor", "Slavkovic", "<viktors@google.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["mutex_lock", "(", "&", "ashmem_mutex", ")", ";", "mutex_unlock", "(", "&", "ashmem_mutex", ")", ";</s>"], "docstring_tokens": ["inter-process", "munmap"]}
{"contents": ["rds:", "Fix", "NULL", "pointer", "dereference", "in", "__rds_rdma_map", "This", "is", "a", "fix", "for", "syzkaller719569,", "where", "memory", "registration", "was", "attempted", "without", "any", "underlying", "transport", "being", "loaded.", "Analysis", "of", "the", "case", "reveals", "that", "it", "is", "the", "setsockopt()", "RDS_GET_MR", "(2)", "and", "RDS_GET_MR_FOR_DEST", "(7)", "that", "are", "vulnerable.", "Here", "is", "an", "example", "stack", "trace", "when", "the", "bug", "is", "hit:", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "00000000000000c0", "IP:", "__rds_rdma_map+0x36/0x440", "[rds]", "PGD", "2f93d03067", "P4D", "2f93d03067", "PUD", "2f93d02067", "PMD", "0", "Oops:", "0000", "[#1]", "SMP", "Modules", "linked", "in:", "bridge", "stp", "llc", "tun", "rpcsec_gss_krb5", "nfsv4", "dns_resolver", "nfs", "fscache", "rds", "binfmt_misc", "sb_edac", "intel_powerclamp", "coretemp", "kvm_intel", "kvm", "irqbypass", "crct10dif_pclmul", "c", "rc32_pclmul", "ghash_clmulni_intel", "pcbc", "aesni_intel", "crypto_simd", "glue_helper", "cryptd", "iTCO_wdt", "mei_me", "sg", "iTCO_vendor_support", "ipmi_si", "mei", "ipmi_devintf", "nfsd", "shpchp", "pcspkr", "i2c_i801", "ioatd", "ma", "ipmi_msghandler", "wmi", "lpc_ich", "mfd_core", "auth_rpcgss", "nfs_acl", "lockd", "grace", "sunrpc", "ip_tables", "ext4", "mbcache", "jbd2", "mgag200", "i2c_algo_bit", "drm_kms_helper", "ixgbe", "syscopyarea", "ahci", "sysfillrect", "sysimgblt", "libahci", "mdio", "fb_sys_fops", "ttm", "ptp", "libata", "sd_mod", "mlx4_core", "drm", "crc32c_intel", "pps_core", "megaraid_sas", "i2c_core", "dca", "dm_mirror", "dm_region_hash", "dm_log", "dm_mod", "CPU:", "48", "PID:", "45787", "Comm:", "repro_set2", "Not", "tainted", "4.14.2-3.el7uek.x86_64", "#2", "Hardware", "name:", "Oracle", "Corporation", "ORACLE", "SERVER", "X5-2L/ASM,MOBO", "TRAY,2U,", "BIOS", "31110000", "03/03/2017", "task:", "ffff882f9190db00", "task.stack:", "ffffc9002b994000", "RIP:", "0010:__rds_rdma_map+0x36/0x440", "[rds]", "RSP:", "0018:ffffc9002b997df0", "EFLAGS:", "00010202", "RAX:", "0000000000000000", "RBX:", "ffff882fa2182580", "RCX:", "0000000000000000", "RDX:", "0000000000000000", "RSI:", "ffffc9002b997e40", "RDI:", "ffff882fa2182580", "RBP:", "ffffc9002b997e30", "R08:", "0000000000000000", "R09:", "0000000000000002", "R10:", "ffff885fb29e3838", "R11:", "0000000000000000", "R12:", "ffff882fa2182580", "R13:", "ffff882fa2182580", "R14:", "0000000000000002", "R15:", "0000000020000ffc", "FS:", "00007fbffa20b700(0000)", "GS:ffff882fbfb80000(0000)", "knlGS:0000000000000000", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "CR2:", "00000000000000c0", "CR3:", "0000002f98a66006", "CR4:", "00000000001606e0", "Call", "Trace:", "rds_get_mr+0x56/0x80", "[rds]", "rds_setsockopt+0x172/0x340", "[rds]", "?", "__fget_light+0x25/0x60", "?", "__fdget+0x13/0x20", "SyS_setsockopt+0x80/0xe0", "do_syscall_64+0x67/0x1b0", "entry_SYSCALL64_slow_path+0x25/0x25", "RIP:", "0033:0x7fbff9b117f9", "RSP:", "002b:00007fbffa20aed8", "EFLAGS:", "00000293", "ORIG_RAX:", "0000000000000036", "RAX:", "ffffffffffffffda", "RBX:", "00000000000c84a4", "RCX:", "00007fbff9b117f9", "RDX:", "0000000000000002", "RSI:", "0000400000000114", "RDI:", "000000000000109b", "RBP:", "00007fbffa20af10", "R08:", "0000000000000020", "R09:", "00007fbff9dd7860", "R10:", "0000000020000ffc", "R11:", "0000000000000293", "R12:", "0000000000000000", "R13:", "00007fbffa20b9c0", "R14:", "00007fbffa20b700", "R15:", "0000000000000021", "Code:", "41", "56", "41", "55", "49", "89", "fd", "41", "54", "53", "48", "83", "ec", "18", "8b", "87", "f0", "02", "00", "00", "48", "89", "55", "d0", "48", "89", "4d", "c8", "85", "c0", "0f", "84", "2d", "03", "00", "00", "48", "8b", "87", "00", "03", "00", "00", "<48>", "83", "b8", "c0", "00", "00", "00", "00", "0f", "84", "25", "03", "00", "0", "0", "48", "8b", "06", "48", "8b", "56", "08", "The", "fix", "is", "to", "check", "the", "existence", "of", "an", "underlying", "transport", "in", "__rds_rdma_map().", "Signed-off-by:", "H\u00e5kon", "Bugge", "<haakon.bugge@oracle.com>", "Reported-by:", "syzbot", "<syzkaller@googlegroups.com>", "Acked-by:", "Santosh", "Shilimkar", "<santosh.shilimkar@oracle.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "rs", "-", ">", "rs_bound_addr", "=", "=", "0", "|", "|", "!", "rs", "-", ">", "rs_transport", ")", "{</s>if", "(", "rs", "-", ">", "rs_bound_addr", "=", "=", "0", ")", "{"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[media]", "xc2028:", "avoid", "use", "after", "free", "If", "struct", "xc2028_config", "is", "passed", "without", "a", "firmware", "name,", "the", "following", "trouble", "may", "happen:", "[11009.907205]", "xc2028", "5-0061:", "type", "set", "to", "XCeive", "xc2028/xc3028", "tuner", "[11009.907491]", "==================================================================", "[11009.907750]", "BUG:", "KASAN:", "use-after-free", "in", "strcmp+0x96/0xb0", "at", "addr", "ffff8803bd78ab40", "[11009.907992]", "Read", "of", "size", "1", "by", "task", "modprobe/28992", "[11009.907994]", "=============================================================================", "[11009.907997]", "BUG", "kmalloc-16", "(Tainted:", "G", "W", "):", "kasan:", "bad", "access", "detected", "[11009.907999]", "-----------------------------------------------------------------------------", "[11009.908008]", "INFO:", "Allocated", "in", "xhci_urb_enqueue+0x214/0x14c0", "[xhci_hcd]", "age=0", "cpu=3", "pid=28992", "[11009.908012]", "___slab_alloc+0x581/0x5b0", "[11009.908014]", "__slab_alloc+0x51/0x90", "[11009.908017]", "__kmalloc+0x27b/0x350", "[11009.908022]", "xhci_urb_enqueue+0x214/0x14c0", "[xhci_hcd]", "[11009.908026]", "usb_hcd_submit_urb+0x1e8/0x1c60", "[11009.908029]", "usb_submit_urb+0xb0e/0x1200", "[11009.908032]", "usb_serial_generic_write_start+0xb6/0x4c0", "[11009.908035]", "usb_serial_generic_write+0x92/0xc0", "[11009.908039]", "usb_console_write+0x38a/0x560", "[11009.908045]", "call_console_drivers.constprop.14+0x1ee/0x2c0", "[11009.908051]", "console_unlock+0x40d/0x900", "[11009.908056]", "vprintk_emit+0x4b4/0x830", "[11009.908061]", "vprintk_default+0x1f/0x30", "[11009.908064]", "printk+0x99/0xb5", "[11009.908067]", "kasan_report_error+0x10a/0x550", "[11009.908070]", "__asan_report_load1_noabort+0x43/0x50", "[11009.908074]", "INFO:", "Freed", "in", "xc2028_set_config+0x90/0x630", "[tuner_xc2028]", "age=1", "cpu=3", "pid=28992", "[11009.908077]", "__slab_free+0x2ec/0x460", "[11009.908080]", "kfree+0x266/0x280", "[11009.908083]", "xc2028_set_config+0x90/0x630", "[tuner_xc2028]", "[11009.908086]", "xc2028_attach+0x310/0x8a0", "[tuner_xc2028]", "[11009.908090]", "em28xx_attach_xc3028.constprop.7+0x1f9/0x30d", "[em28xx_dvb]", "[11009.908094]", "em28xx_dvb_init.part.3+0x8e4/0x5cf4", "[em28xx_dvb]", "[11009.908098]", "em28xx_dvb_init+0x81/0x8a", "[em28xx_dvb]", "[11009.908101]", "em28xx_register_extension+0xd9/0x190", "[em28xx]", "[11009.908105]", "em28xx_dvb_register+0x10/0x1000", "[em28xx_dvb]", "[11009.908108]", "do_one_initcall+0x141/0x300", "[11009.908111]", "do_init_module+0x1d0/0x5ad", "[11009.908114]", "load_module+0x6666/0x9ba0", "[11009.908117]", "SyS_finit_module+0x108/0x130", "[11009.908120]", "entry_SYSCALL_64_fastpath+0x16/0x76", "[11009.908123]", "INFO:", "Slab", "0xffffea000ef5e280", "objects=25", "used=25", "fp=0x", "(null)", "flags=0x2ffff8000004080", "[11009.908126]", "INFO:", "Object", "0xffff8803bd78ab40", "@offset=2880", "fp=0x0000000000000001", "[11009.908130]", "Bytes", "b4", "ffff8803bd78ab30:", "01", "00", "00", "00", "2a", "07", "00", "00", "9d", "28", "00", "00", "01", "00", "00", "00", "....*....(......", "[11009.908133]", "Object", "ffff8803bd78ab40:", "01", "00", "00", "00", "00", "00", "00", "00", "b0", "1d", "c3", "6a", "00", "88", "ff", "ff", "...........j....", "[11009.908137]", "CPU:", "3", "PID:", "28992", "Comm:", "modprobe", "Tainted:", "G", "B", "W", "4.5.0-rc1+", "#43", "[11009.908140]", "Hardware", "name:", "/NUC5i7RYB,", "BIOS", "RYBDWi35.86A.0350.2015.0812.1722", "08/12/2015", "[11009.908142]", "ffff8803bd78a000", "ffff8802c273f1b8", "ffffffff81932007", "ffff8803c6407a80", "[11009.908148]", "ffff8802c273f1e8", "ffffffff81556759", "ffff8803c6407a80", "ffffea000ef5e280", "[11009.908153]", "ffff8803bd78ab40", "dffffc0000000000", "ffff8802c273f210", "ffffffff8155ccb4", "[11009.908158]", "Call", "Trace:", "[11009.908162]", "[<ffffffff81932007>]", "dump_stack+0x4b/0x64", "[11009.908165]", "[<ffffffff81556759>]", "print_trailer+0xf9/0x150", "[11009.908168]", "[<ffffffff8155ccb4>]", "object_err+0x34/0x40", "[11009.908171]", "[<ffffffff8155f260>]", "kasan_report_error+0x230/0x550", "[11009.908175]", "[<ffffffff81237d71>]", "?", "trace_hardirqs_off_caller+0x21/0x290", "[11009.908179]", "[<ffffffff8155e926>]", "?", "kasan_unpoison_shadow+0x36/0x50", "[11009.908182]", "[<ffffffff8155f5c3>]", "__asan_report_load1_noabort+0x43/0x50", "[11009.908185]", "[<ffffffff8155ea00>]", "?", "__asan_register_globals+0x50/0xa0", "[11009.908189]", "[<ffffffff8194cea6>]", "?", "strcmp+0x96/0xb0", "[11009.908192]", "[<ffffffff8194cea6>]", "strcmp+0x96/0xb0", "[11009.908196]", "[<ffffffffa13ba4ac>]", "xc2028_set_config+0x15c/0x630", "[tuner_xc2028]", "[11009.908200]", "[<ffffffffa13bac90>]", "xc2028_attach+0x310/0x8a0", "[tuner_xc2028]", "[11009.908203]", "[<ffffffff8155ea78>]", "?", "memset+0x28/0x30", "[11009.908206]", "[<ffffffffa13ba980>]", "?", "xc2028_set_config+0x630/0x630", "[tuner_xc2028]", "[11009.908211]", "[<ffffffffa157a59a>]", "em28xx_attach_xc3028.constprop.7+0x1f9/0x30d", "[em28xx_dvb]", "[11009.908215]", "[<ffffffffa157aa2a>]", "?", "em28xx_dvb_init.part.3+0x37c/0x5cf4", "[em28xx_dvb]", "[11009.908219]", "[<ffffffffa157a3a1>]", "?", "hauppauge_hvr930c_init+0x487/0x487", "[em28xx_dvb]", "[11009.908222]", "[<ffffffffa01795ac>]", "?", "lgdt330x_attach+0x1cc/0x370", "[lgdt330x]", "[11009.908226]", "[<ffffffffa01793e0>]", "?", "i2c_read_demod_bytes.isra.2+0x210/0x210", "[lgdt330x]", "[11009.908230]", "[<ffffffff812e87d0>]", "?", "ref_module.part.15+0x10/0x10", "[11009.908233]", "[<ffffffff812e56e0>]", "?", "module_assert_mutex_or_preempt+0x80/0x80", "[11009.908238]", "[<ffffffffa157af92>]", "em28xx_dvb_init.part.3+0x8e4/0x5cf4", "[em28xx_dvb]", "[11009.908242]", "[<ffffffffa157a6ae>]", "?", "em28xx_attach_xc3028.constprop.7+0x30d/0x30d", "[em28xx_dvb]", "[11009.908245]", "[<ffffffff8195222d>]", "?", "string+0x14d/0x1f0", "[11009.908249]", "[<ffffffff8195381f>]", "?", "symbol_string+0xff/0x1a0", "[11009.908253]", "[<ffffffff81953720>]", "?", "uuid_string+0x6f0/0x6f0", "[11009.908257]", "[<ffffffff811a775e>]", "?", "__kernel_text_address+0x7e/0xa0", "[11009.908260]", "[<ffffffff8104b02f>]", "?", "print_context_stack+0x7f/0xf0", "[11009.908264]", "[<ffffffff812e9846>]", "?", "__module_address+0xb6/0x360", "[11009.908268]", "[<ffffffff8137fdc9>]", "?", "is_ftrace_trampoline+0x99/0xe0", "[11009.908271]", "[<ffffffff811a775e>]", "?", "__kernel_text_address+0x7e/0xa0", "[11009.908275]", "[<ffffffff81240a70>]", "?", "debug_check_no_locks_freed+0x290/0x290", "[11009.908278]", "[<ffffffff8104a24b>]", "?", "dump_trace+0x11b/0x300", "[11009.908282]", "[<ffffffffa13e8143>]", "?", "em28xx_register_extension+0x23/0x190", "[em28xx]", "[11009.908285]", "[<ffffffff81237d71>]", "?", "trace_hardirqs_off_caller+0x21/0x290", "[11009.908289]", "[<ffffffff8123ff56>]", "?", "trace_hardirqs_on_caller+0x16/0x590", "[11009.908292]", "[<ffffffff812404dd>]", "?", "trace_hardirqs_on+0xd/0x10", "[11009.908296]", "[<ffffffffa13e8143>]", "?", "em28xx_register_extension+0x23/0x190", "[em28xx]", "[11009.908299]", "[<ffffffff822dcbb0>]", "?", "mutex_trylock+0x400/0x400", "[11009.908302]", "[<ffffffff810021a1>]", "?", "do_one_initcall+0x131/0x300", "[11009.908306]", "[<ffffffff81296dc7>]", "?", "call_rcu_sched+0x17/0x20", "[11009.908309]", "[<ffffffff8159e708>]", "?", "put_object+0x48/0x70", "[11009.908314]", "[<ffffffffa1579f11>]", "em28xx_dvb_init+0x81/0x8a", "[em28xx_dvb]", "[11009.908317]", "[<ffffffffa13e81f9>]", "em28xx_register_extension+0xd9/0x190", "[em28xx]", "[11009.908320]", "[<ffffffffa0150000>]", "?", "0xffffffffa0150000", "[11009.908324]", "[<ffffffffa0150010>]", "em28xx_dvb_register+0x10/0x1000", "[em28xx_dvb]", "[11009.908327]", "[<ffffffff810021b1>]", "do_one_initcall+0x141/0x300", "[11009.908330]", "[<ffffffff81002070>]", "?", "try_to_run_init_process+0x40/0x40", "[11009.908333]", "[<ffffffff8123ff56>]", "?", "trace_hardirqs_on_caller+0x16/0x590", "[11009.908337]", "[<ffffffff8155e926>]", "?", "kasan_unpoison_shadow+0x36/0x50", "[11009.908340]", "[<ffffffff8155e926>]", "?", "kasan_unpoison_shadow+0x36/0x50", "[11009.908343]", "[<ffffffff8155e926>]", "?", "kasan_unpoison_shadow+0x36/0x50", "[11009.908346]", "[<ffffffff8155ea37>]", "?", "__asan_register_globals+0x87/0xa0", "[11009.908350]", "[<ffffffff8144da7b>]", "do_init_module+0x1d0/0x5ad", "[11009.908353]", "[<ffffffff812f2626>]", "load_module+0x6666/0x9ba0", "[11009.908356]", "[<ffffffff812e9c90>]", "?", "symbol_put_addr+0x50/0x50", "[11009.908361]", "[<ffffffffa1580037>]", "?", "em28xx_dvb_init.part.3+0x5989/0x5cf4", "[em28xx_dvb]", "[11009.908366]", "[<ffffffff812ebfc0>]", "?", "module_frob_arch_sections+0x20/0x20", "[11009.908369]", "[<ffffffff815bc940>]", "?", "open_exec+0x50/0x50", "[11009.908374]", "[<ffffffff811671bb>]", "?", "ns_capable+0x5b/0xd0", "[11009.908377]", "[<ffffffff812f5e58>]", "SyS_finit_module+0x108/0x130", "[11009.908379]", "[<ffffffff812f5d50>]", "?", "SyS_init_module+0x1f0/0x1f0", "[11009.908383]", "[<ffffffff81004044>]", "?", "lockdep_sys_exit_thunk+0x12/0x14", "[11009.908394]", "[<ffffffff822e6936>]", "entry_SYSCALL_64_fastpath+0x16/0x76", "[11009.908396]", "Memory", "state", "around", "the", "buggy", "address:", "[11009.908398]", "ffff8803bd78aa00:", "00", "00", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[11009.908401]", "ffff8803bd78aa80:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[11009.908403]", ">ffff8803bd78ab00:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "00", "00", "fc", "fc", "fc", "fc", "fc", "fc", "[11009.908405]", "^", "[11009.908407]", "ffff8803bd78ab80:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[11009.908409]", "ffff8803bd78ac00:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[11009.908411]", "==================================================================", "In", "order", "to", "avoid", "it,", "let's", "set", "the", "cached", "value", "of", "the", "firmware", "name", "to", "NULL", "after", "freeing", "it.", "While", "here,", "return", "an", "error", "if", "the", "memory", "allocation", "fails.", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@osg.samsung.com>"], "code_tokens": ["priv", "-", ">", "ctrl", ".", "fname", "=", "NULL", ";", "return", "-", "ENOMEM", ";</s>rc", "=", "-", "ENOMEM", ";"], "docstring_tokens": ["data", "structure"]}
{"contents": ["[PATCH]", "skip", "data", "conversion", "in", "compat_sys_mount", "when", "data_page", "is", "NULL", "OpenVZ", "Linux", "kernel", "team", "has", "found", "a", "problem", "with", "mounting", "in", "compat", "mode.", "Simple", "command", "\"mount", "-t", "smbfs", "...\"", "on", "Fedora", "Core", "5", "distro", "in", "32-bit", "mode", "leads", "to", "oops:", "Unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000000", "RIP:", "compat_sys_mount+0xd6/0x290", "Process", "mount", "(pid:", "14656,", "veid=300,", "threadinfo", "ffff810034d30000,", "task", "ffff810034c86bc0)", "Call", "Trace:", "ia32_sysret+0x0/0xa", "The", "problem", "is", "that", "data_page", "pointer", "can", "be", "NULL,", "so", "we", "should", "skip", "data", "conversion", "in", "this", "case.", "Signed-off-by:", "Andrey", "Mirkin", "<amirkin@openvz.org>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["if", "(", "type_page", "&", "&", "data_page", ")", "{</s>if", "(", "type_page", ")", "{"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["mac80211:", "fix", "AP", "powersave", "TX", "vs.", "wakeup", "race", "There", "is", "a", "race", "between", "the", "TX", "path", "and", "the", "STA", "wakeup:", "while", "a", "station", "is", "sleeping,", "mac80211", "buffers", "frames", "until", "it", "wakes", "up,", "then", "the", "frames", "are", "transmitted.", "However,", "the", "RX", "and", "TX", "path", "are", "concurrent,", "so", "the", "packet", "indicating", "wakeup", "can", "be", "processed", "while", "a", "packet", "is", "being", "transmitted.", "This", "can", "lead", "to", "a", "situation", "where", "the", "buffered", "frames", "list", "is", "emptied", "on", "the", "one", "side,", "while", "a", "frame", "is", "being", "added", "on", "the", "other", "side,", "as", "the", "station", "is", "still", "seen", "as", "sleeping", "in", "the", "TX", "path.", "As", "a", "result,", "the", "newly", "added", "frame", "will", "not", "be", "send", "anytime", "soon.", "It", "might", "be", "sent", "much", "later", "(and", "out", "of", "order)", "when", "the", "station", "goes", "to", "sleep", "and", "wakes", "up", "the", "next", "time.", "Additionally,", "it", "can", "lead", "to", "the", "crash", "below.", "Fix", "all", "this", "by", "synchronising", "both", "paths", "with", "a", "new", "lock.", "Both", "path", "are", "not", "fastpath", "since", "they", "handle", "PS", "situations.", "In", "a", "later", "patch", "we'll", "remove", "the", "extra", "skb", "queue", "locks", "to", "reduce", "locking", "overhead.", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "000000b0", "IP:", "[<ff6f1791>]", "ieee80211_report_used_skb+0x11/0x3e0", "[mac80211]", "*pde", "=", "00000000", "Oops:", "0000", "[#1]", "SMP", "DEBUG_PAGEALLOC", "EIP:", "0060:[<ff6f1791>]", "EFLAGS:", "00210282", "CPU:", "1", "EIP", "is", "at", "ieee80211_report_used_skb+0x11/0x3e0", "[mac80211]", "EAX:", "e5900da0", "EBX:", "00000000", "ECX:", "00000001", "EDX:", "00000000", "ESI:", "e41d00c0", "EDI:", "e5900da0", "EBP:", "ebe458e4", "ESP:", "ebe458b0", "DS:", "007b", "ES:", "007b", "FS:", "00d8", "GS:", "00e0", "SS:", "0068", "CR0:", "8005003b", "CR2:", "000000b0", "CR3:", "25a78000", "CR4:", "000407d0", "DR0:", "00000000", "DR1:", "00000000", "DR2:", "00000000", "DR3:", "00000000", "DR6:", "ffff0ff0", "DR7:", "00000400", "Process", "iperf", "(pid:", "3934,", "ti=ebe44000", "task=e757c0b0", "task.ti=ebe44000)", "iwlwifi", "0000:02:00.0:", "I", "iwl_pcie_enqueue_hcmd", "Sending", "command", "LQ_CMD", "(#4e),", "seq:", "0x0903,", "92", "bytes", "at", "3[3]:9", "Stack:", "e403b32c", "ebe458c4", "00200002", "00200286", "e403b338", "ebe458cc", "c10960bb", "e5900da0", "ff76a6ec", "ebe458d8", "00000000", "e41d00c0", "e5900da0", "ebe458f0", "ff6f1b75", "e403b210", "ebe4598c", "ff723dc1", "00000000", "ff76a6ec", "e597c978", "e403b758", "00000002", "00000002", "Call", "Trace:", "[<ff6f1b75>]", "ieee80211_free_txskb+0x15/0x20", "[mac80211]", "[<ff723dc1>]", "invoke_tx_handlers+0x1661/0x1780", "[mac80211]", "[<ff7248a5>]", "ieee80211_tx+0x75/0x100", "[mac80211]", "[<ff7249bf>]", "ieee80211_xmit+0x8f/0xc0", "[mac80211]", "[<ff72550e>]", "ieee80211_subif_start_xmit+0x4fe/0xe20", "[mac80211]", "[<c149ef70>]", "dev_hard_start_xmit+0x450/0x950", "[<c14b9aa9>]", "sch_direct_xmit+0xa9/0x250", "[<c14b9c9b>]", "__qdisc_run+0x4b/0x150", "[<c149f732>]", "dev_queue_xmit+0x2c2/0xca0", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Yaara", "Rozenblum", "<yaara.rozenblum@intel.com>", "Signed-off-by:", "Emmanuel", "Grumbach", "<emmanuel.grumbach@intel.com>", "Reviewed-by:", "Stanislaw", "Gruszka", "<sgruszka@redhat.com>", "[reword", "commit", "log,", "use", "a", "separate", "lock]", "Signed-off-by:", "Johannes", "Berg", "<johannes.berg@intel.com>"], "code_tokens": ["spin_lock_init", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "/", "*", "sync", "with", "ieee80211_tx_h_unicast_ps_buf", "*", "/", "spin_lock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "spin_unlock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "*", "@", "ps_lock", ":", "used", "for", "powersave", "(", "when", "mac80211", "is", "the", "AP", ")", "related", "locking", "/", "*", "STA", "powersave", "lock", "and", "frame", "queues", "*", "/", "spinlock_t", "ps_lock", ";", "/", "*", "sync", "with", "ieee80211_sta_ps_deliver_wakeup", "*", "/", "spin_lock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "/", "*", "*", "STA", "woke", "up", "the", "meantime", "and", "all", "the", "frames", "on", "ps_tx_buf", "have", "*", "been", "queued", "to", "pending", "queue", ".", "No", "reordering", "can", "happen", ",", "go", "*", "ahead", "and", "Tx", "the", "packet", ".", "*", "/", "if", "(", "!", "test_sta_flag", "(", "sta", ",", "WLAN_STA_PS_STA", ")", "&", "&", "!", "test_sta_flag", "(", "sta", ",", "WLAN_STA_PS_DRIVER", ")", ")", "{", "spin_unlock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "return", "TX_CONTINUE", ";", "}", "spin_unlock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";</s>/", "*", "*", "STA", "powersave", "frame", "queues", ",", "no", "more", "than", "the", "internal", "*", "locking", "required", ".", "*", "/"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["improve", "fix", "for", "Bug", "#69545"], "code_tokens": ["-", "Core", ":", ".", "Imroved", "fix", "for", "bug", "#", "69545", "(", "Integer", "overflow", "in", "ftp_genlist", "(", ")", "resulting", "in", "heap", "overflow", ")", ".", "(", "Max", "Spelsberg", ")</s>-", "Postgres", ":", "}", "else", "{", "size", "+", "+;"], "docstring_tokens": ["command", "injection"]}
{"contents": ["fix", "LOOKUP_FOLLOW", "on", "automount", "\"symlinks\"", "Make", "sure", "that", "automount", "\"symlinks\"", "are", "followed", "regardless", "of", "LOOKUP_FOLLOW;", "it", "should", "have", "no", "effect", "on", "them.", "Cc:", "stable@kernel.org", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["/", "*", "*", "This", "is", "a", "temporary", "kludge", "to", "deal", "with", "\"", "automount", "\"", "symlinks", ";", "proper", "*", "solution", "is", "to", "trigger", "them", "on", "follow_mount", "(", "),", "so", "that", "do_lookup", "(", ")", "*", "would", "DTRT", ".", "To", "be", "killed", "before", "2", ".", "6", ".", "34", "-", "final", ".", "*", "/", "static", "inline", "int", "follow_on_final", "(", "struct", "inode", "*", "inode", ",", "unsigned", "lookup_flags", ")", "{", "return", "inode", "&", "&", "unlikely", "(", "inode", "-", ">", "i_op", "-", ">", "follow_link", ")", "&", "&", "(", "(", "lookup_flags", "&", "LOOKUP_FOLLOW", ")", "|", "|", "S_ISDIR", "(", "inode", "-", ">", "i_mode", ")", ");", "}", "if", "(", "follow_on_final", "(", "inode", ",", "lookup_flags", ")", ")", "{</s>if", "(", "(", "lookup_flags", "&", "LOOKUP_FOLLOW", ")", "&", "&", "inode", "&", "&", "inode", "-", ">", "i_op", "-", ">", "follow_link", ")", "{"], "docstring_tokens": ["information", "leak"]}
{"contents": ["media:", "uvcvideo:", "Fix", "'type'", "check", "leading", "to", "overflow", "When", "initially", "testing", "the", "Camera", "Terminal", "Descriptor", "wTerminalType", "field", "(buffer[4]),", "no", "mask", "is", "used.", "Later", "in", "the", "function,", "the", "MSB", "is", "overloaded", "to", "store", "the", "descriptor", "subtype,", "and", "so", "a", "mask", "of", "0x7fff", "is", "used", "to", "check", "the", "type.", "If", "a", "descriptor", "is", "specially", "crafted", "to", "set", "this", "overloaded", "bit", "in", "the", "original", "wTerminalType", "field,", "the", "initial", "type", "check", "will", "fail", "(falling", "through,", "without", "adjusting", "the", "buffer", "size),", "but", "the", "later", "type", "checks", "will", "pass,", "assuming", "the", "buffer", "has", "been", "made", "suitably", "large,", "causing", "an", "overflow.", "Avoid", "this", "problem", "by", "checking", "for", "the", "MSB", "in", "the", "wTerminalType", "field.", "If", "the", "bit", "is", "set,", "assume", "the", "descriptor", "is", "bad,", "and", "abort", "parsing", "it.", "Originally", "reported", "here:", "https://groups.google.com/forum/#!topic/syzkaller/Ot1fOE6v1d8", "A", "similar", "(non-compiling)", "patch", "was", "provided", "at", "that", "time.", "Reported-by:", "syzbot", "<syzkaller@googlegroups.com>", "Signed-off-by:", "Alistair", "Strachan", "<astrachan@google.com>", "Signed-off-by:", "Laurent", "Pinchart", "<laurent.pinchart@ideasonboard.com>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab+samsung@kernel.org>"], "code_tokens": ["/", "*", "*", "Reject", "invalid", "terminal", "types", "that", "would", "cause", "issues", ":", "*", "*", "-", "The", "high", "byte", "must", "be", "non", "-", "zero", ",", "otherwise", "it", "would", "be", "*", "confused", "with", "a", "unit", ".", "*", "*", "-", "Bit", "15", "must", "be", "0", ",", "as", "we", "use", "it", "internally", "as", "a", "terminal", "*", "direction", "flag", ".", "*", "*", "Other", "unknown", "types", "are", "accepted", ".", "if", "(", "(", "type", "&", "0x7f00", ")", "=", "=", "0", "|", "|", "(", "type", "&", "0x8000", ")", "!", "=", "0", ")", "{</s>/", "*", "Make", "sure", "the", "terminal", "type", "MSB", "is", "not", "null", ",", "otherwise", "it", "*", "could", "be", "confused", "with", "a", "unit", ".", "if", "(", "(", "type", "&", "0xff00", ")", "=", "=", "0", ")", "{"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["Fix", "#1737"], "code_tokens": ["#", "1737", ":", "Block", "more", "JDK", "types", "from", "polymorphic", "deserialization", "/", "/", "(", "and", "wrt", "[", "databind", "#", "1599", "]", ")", "/", "/", "[", "databind", "#", "1737", "]", ";", "JDK", "provided", "s", ".", "add", "(", "\"", "java", ".", "util", ".", "logging", ".", "FileHandler", "\"", ");", "s", ".", "add", "(", "\"", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", "\"", ");", "/", "/", "[", "databind", "#", "1737", "]", ";", "3rd", "party", "s", ".", "add", "(", "\"", "org", ".", "springframework", ".", "aop", ".", "support", ".", "AbstractBeanFactoryPointcutAdvisor", "\"", ");", "s", ".", "add", "(", "\"", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "config", ".", "PropertyPathFactoryBean", "\"", ");", "s", ".", "add", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "JndiRefForwardingDataSource", "\"", ");", "s", ".", "add", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "WrapperConnectionPoolDataSource", "\"", ");", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonTypeInfo", ";", "static", "class", "PolyWrapper", "{", "@", "JsonTypeInfo", "(", "use", "=", "JsonTypeInfo", ".", "Id", ".", "CLASS", ",", "include", "=", "JsonTypeInfo", ".", "As", ".", "WRAPPER_ARRAY", ")", "public", "Object", "v", ";", "}", "/", "*", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "*", "Unit", "tests", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "private", "final", "ObjectMapper", "MAPPER", "=", "objectMapper", "(", ");", "/", "/", "/", "/", "/", "/", "Tests", "for", "[", "databind", "#", "1599", "]", "public", "void", "testXalanTypes1599", "(", ")", "throws", "Exception", "final", "String", "clsName", "=", "\"", "com", ".", "sun", ".", "org", ".", "apache", ".", "xalan", ".", "internal", ".", "xsltc", ".", "trax", ".", "TemplatesImpl", "\"", ";", "\"", "'", "obj", "'", ":[", "'", "\"+", "clsName", "+", "\"'", ",\\", "n", "\"", "+", "\"", "{", "\\", "n", "\"", "+", "\"", "'", "transletBytecodes", "'", ":", "[", "'", "AAIAZQ", "=", "='", "]", ",\\", "n", "\"", "+", "\"", "'", "transletName", "'", ":", "'", "a", ".", "b", "'", ",\\", "n", "\"", "_verifySecurityException", "(", "e", ",", "clsName", ")", ";", "}", "}", "/", "/", "/", "/", "/", "/", "Tests", "for", "[", "databind", "#", "1737", "]", "public", "void", "testJDKTypes1737", "(", ")", "throws", "Exception", "{", "_testTypes1737", "(", "java", ".", "util", ".", "logging", ".", "FileHandler", ".", "class", ")", ";", "_testTypes1737", "(", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", ".", "class", ")", ";", "}", "/", "/", "17", "-", "Aug", "-", "2017", ",", "tatu", ":", "Ideally", "would", "test", "handling", "of", "3rd", "party", "types", ",", "too", ",", "/", "/", "but", "would", "require", "adding", "dependencies", ".", "This", "may", "be", "practical", "when", "/", "/", "checking", "done", "by", "module", ",", "but", "for", "now", "let", "'", "s", "not", "do", "that", "for", "databind", ".", "/", "*", "public", "void", "testSpringTypes1737", "(", ")", "throws", "Exception", "{", "_testTypes1737", "(", "\"", "org", ".", "springframework", ".", "aop", ".", "support", ".", "AbstractBeanFactoryPointcutAdvisor", "\"", ");", "_testTypes1737", "(", "\"", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "config", ".", "PropertyPathFactoryBean", "\"", ");", "}", "public", "void", "testC3P0Types1737", "(", ")", "throws", "Exception", "{", "_testTypes1737", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "JndiRefForwardingDataSource", "\"", ");", "_testTypes1737", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "WrapperConnectionPoolDataSource", "\"", ");", "}", "*", "/", "private", "void", "_testTypes1737", "(", "Class", "<", "?>", "nasty", ")", "throws", "Exception", "{", "_testTypes1737", "(", "nasty", ".", "getName", "(", "))", ";", "}", "private", "void", "_testTypes1737", "(", "String", "clsName", ")", "throws", "Exception", "{", "/", "/", "While", "usually", "exploited", "via", "default", "typing", "let", "'", "s", "not", "require", "/", "/", "it", "here", ";", "mechanism", "still", "the", "same", "String", "json", "=", "aposToQuotes", "(", "\"", "{'", "v", "'", ":[", "'\"", "+", "clsName", "+", "\"'", ",'", "/", "tmp", "/", "foobar", ".", "txt", "'", "]}", "\"", ")", ";", "try", "{", "MAPPER", ".", "readValue", "(", "json", ",", "PolyWrapper", ".", "class", ")", ";", "fail", "(", "\"", "Should", "not", "pass", "\"", ");", "}", "catch", "(", "JsonMappingException", "e", ")", "{", "_verifySecurityException", "(", "e", ",", "clsName", ")", ";", "}", "}", "protected", "void", "_verifySecurityException", "(", "Throwable", "t", ",", "String", "clsName", ")", "throws", "Exception", "{", "/", "/", "17", "-", "Aug", "-", "2017", ",", "tatu", ":", "Expected", "type", "more", "granular", "in", "2", ".", "9", "(", "over", "2", ".", "8", ")", "_verifyException", "(", "t", ",", "JsonMappingException", ".", "class", ",", "\"", "Illegal", "type", "\"", ",", "\"", "to", "deserialize", "\"", ",", "\"", "prevented", "for", "security", "reasons", "\"", ");", "verifyException", "(", "t", ",", "clsName", ")", ";", "}", "protected", "void", "_verifyException", "(", "Throwable", "t", ",", "Class", "<", "?>", "expExcType", ",", "String", ".", "..", "patterns", ")", "throws", "Exception", "{", "Class", "<", "?>", "actExc", "=", "t", ".", "getClass", "(", ");", "if", "(", "!", "expExcType", ".", "isAssignableFrom", "(", "actExc", ")", ")", "{", "fail", "(", "\"", "Expected", "Exception", "of", "type", "'", "\"+", "expExcType", ".", "getName", "(", ")+", "\"'", ",", "got", "'", "\"", "+", "actExc", ".", "getName", "(", ")+", "\"'", ",", "message", ":", "\"", "+", "t", ".", "getMessage", "(", "))", ";", "}", "for", "(", "String", "pattern", ":", "patterns", ")", "{", "verifyException", "(", "t", ",", "pattern", ")", ";</s>/", "/", "(", "and", "wrt", "[", "databind", "#", "1599", "]", "public", "void", "testIssue1599", "(", ")", "throws", "Exception", "+", "\"", "'", "obj", "'", ":[", "'", "com", ".", "sun", ".", "org", ".", "apache", ".", "xalan", ".", "internal", ".", "xsltc", ".", "trax", ".", "TemplatesImpl", "'", ",\\", "n", "\"", "verifyException", "(", "e", ",", "\"", "Illegal", "type", "\"", ");", "verifyException", "(", "e", ",", "\"", "to", "deserialize", "\"", ");", "verifyException", "(", "e", ",", "\"", "prevented", "for", "security", "reasons", "\"", ");"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["Fix", "#76129", "-", "remove", "more", "potential", "unfiltered", "outputs", "for", "phar"], "code_tokens": ["PHPWRITE", "(", "\"", "Access", "Denied", "<", "/", "h1", ">", "\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\",", "sizeof", "(", "\"", "Access", "Denied", "<", "/", "h1", ">", "\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\")", "-", "1", ")", ";", "PHPWRITE", "(", "\"", "Not", "Found", "<", "/", "h1", ">", "\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\",", "sizeof", "(", "\"", "Not", "Found", "<", "/", "h1", ">", "\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\")", "-", "1", ")", ";", "<", "h1", ">", "403", "-", "File", "Access", "Denied", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "403", "-", "File", "Access", "Denied", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "403", "-", "File", "Access", "Denied", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "403", "-", "File", "Access", "Denied", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "Not", "Found", "<", "/", "h1", "></s>PHPWRITE", "(", "entry", ",", "entry_len", ")", ";", "PHPWRITE", "(", "\"", "Access", "Denied", "<", "/", "h1", ">", "\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\",", "sizeof", "(", "\"", "Access", "Denied", "<", "/", "h1", ">", "\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\")", "-", "1", ")", ";", "PHPWRITE", "(", "entry", ",", "entry_len", ")", ";", "PHPWRITE", "(", "\"", "Not", "Found", "<", "/", "h1", ">", "\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\",", "sizeof", "(", "\"", "Not", "Found", "<", "/", "h1", ">", "\\", "n", "<", "/", "body", ">", "\\", "n", "<", "/", "html", ">", "\")", "-", "1", ")", ";", "<", "h1", ">", "403", "-", "File", "/", "hi", "Access", "Denied", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "/", "notfound", ".", "php", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "/", "index", ".", "php", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "403", "-", "File", "/", "hi", "Access", "Denied", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "/", "notfound", ".", "php", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "/", "index", ".", "php", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "403", "-", "File", "/", "hi", "Access", "Denied", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "/", "notfound", ".", "php", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "/", "index", ".", "php", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "403", "-", "File", "/", "hi", "Access", "Denied", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "/", "notfound", ".", "php", "Not", "Found", "<", "/", "h1", ">", "<", "h1", ">", "404", "-", "File", "/", "index", ".", "php", "Not", "Found", "<", "/", "h1", ">"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["Fix", "bug", "#72093:", "bcpowmod", "accepts", "negative", "scale", "and", "corrupts", "_one_", "definition", "We", "can", "not", "modify", "result", "since", "it", "can", "be", "copy", "of", "_zero_", "or", "_one_,", "etc.", "and", "\"copy\"", "in", "bcmath", "is", "just", "bumping", "the", "refcount."], "code_tokens": ["/", "*", "{", "{{", "split_bc_num", "Convert", "to", "bc_num", "detecting", "scale", "*", "/", "static", "bc_num", "split_bc_num", "(", "bc_num", "num", ")", "{", "bc_num", "newnum", ";", "if", "(", "num", "-", ">", "n_refs", ">", "=", "1", ")", "{", "return", "num", ";", "}", "newnum", "=", "_bc_new_num_ex", "(", "0", ",", "0", ",", "0", ")", ";", "*", "newnum", "=", "*", "num", ";", "newnum", "-", ">", "n_refs", "=", "1", ";", "num", "-", ">", "n_refs", "-", "-;", "return", "newnum", ";", "}", "/", "*", "}", "}}", "*", "/", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale_int", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale_int", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "=", "split_bc_num", "(", "result", ")", ";", "-", "-", "TEST", "-", "-", "Bug", "72093", ":", "bcpowmod", "accepts", "negative", "scale", "and", "corrupts", "_one_", "definition", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "bcmath", "\"", "))", "print", "\"", "skip", "\"", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "bcpowmod", "(", "1", ",", "\"", "A", "\"", ",", "128", ",", "-", "200", ")", ");", "var_dump", "(", "bcpowmod", "(", "1", ",", "1", ".", "2", ",", "1", ",", "1", ")", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "string", "(", "1", ")", "\"", "1", "\"", "bc", "math", "warning", ":", "non", "-", "zero", "scale", "in", "exponent", "string", "(", "3", ")", "\"", "0", ".", "0", "\"", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "#", "define", "PHP_RELEASE_VERSION", "27", "#", "define", "PHP_VERSION", "\"", "5", ".", "5", ".", "27", "-", "dev", "\"", "#", "define", "PHP_VERSION_ID", "50527</s>if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "-", ">", "n_scale", "=", "scale", ";", "#", "define", "PHP_RELEASE_VERSION", "35", "#", "define", "PHP_VERSION", "\"", "5", ".", "5", ".", "35", "-", "dev", "\"", "#", "define", "PHP_VERSION_ID", "50535"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["Fix", "XSS", "on", "a", "search", "feature", "(#422)", "Motivation:", "XSS", "issue", "has", "been", "reported", "by", "LINE", "Security", "team.", "Modification:", "-", "Sanitize", "html", "on", "error", "notification", "message.", "-", "Invalid", "search", "query", "returns", "`Bad", "Request`", "instead", "of", "Internal", "Server", "Error.", "-", "Replace", "`jGitRepository`", "into", "`parent.name()", "+", "'/'", "+", "name`", "to", "prevent", "exposure", "of", "a", "full", "file", "system", "path", "on", "the", "error", "message.", "Result:", "-", "Fixes"], "code_tokens": ["}", "catch", "(", "CentralDogmaException", "|", "IllegalArgumentException", "e", ")", "{", "\"", "failed", "to", "get", "data", "from", "'", "\"", "+", "parent", ".", "name", "(", ")", "+", "'", "/'", "+", "name", "+", "\"", "'", "at", "\"", "+", "pathPattern", "\"", "for", "\"", "+", "revision", ",", "e", ")", ";", "\"", "failed", "to", "retrieve", "the", "history", ":", "\"", "+", "parent", ".", "name", "(", ")", "+", "'", "/'", "+", "name", "throw", "new", "StorageException", "(", "\"", "failed", "to", "push", "at", "'", "\"", "+", "parent", ".", "name", "(", ")", "+", "'", "/'", "+", "name", "+", "'", "\\'", "',", "e", ")", ";", "throw", "new", "StorageException", "(", "\"", "failed", "to", "determine", "the", "HEAD", ":", "\"", "+", "parent", ".", "name", "(", ")", "+", "'", "/'", "+", "name", ")", ";", "Notification", ".", "error", "(", "StringUtil", ".", "escapeHtml", "(", "arg", ".", "message", ")", ");", "}", ",", "escapeHtml", ":", "function", "(", "unsafe", ")", "{", "return", "unsafe", ".", "replace", "(", "/&", "/", "g", ",", "\"", "&", "amp", ";", "\")", ".", "replace", "(", "/<", "/", "g", ",", "\"", "&", "lt", ";", "\")", ".", "replace", "(", "/>", "/", "g", ",", "\"", "&", "gt", ";", "\")", ".", "replace", "(", "/\"", "/", "g", ",", "\"", "&", "quot", ";", "\")", ".", "replace", "(", "/'", "/", "g", ",", "\"", "&#", "039", ";", "\")", ";", "@", "Test", "public", "void", "testFind_invalidPathPattern", "(", ")", "{", "final", "String", "pattern", "=", "\"", "a", "'", "\\\"", "><", "img", "src", "=", "1", "onerror", "=", "alert", "(", "document", ".", "domain", ")", ">\"", ";", "assertThatThrownBy", "(", "()", "-", ">", "repo", ".", "find", "(", "HEAD", ",", "pattern", ")", ".", "join", "(", "))", ".", "isInstanceOf", "(", "CompletionException", ".", "class", ")", ".", "hasCauseInstanceOf", "(", "IllegalArgumentException", ".", "class", ")", ";", "}", "Previously", "known", "issues", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "DOM", "based", ",", "Cross", "-", "site", "Scripting", "(", "XSS", ")", "was", "found", "in", "Central", "Dogma", ".", "An", "attacker", "could", "exploit", "this", "by", "convincing", "an", "authenticated", "user", "to", "visit", "a", "specifically", "crafted", "URL", "on", "a", "CentralDogma", "server", ",", "allowing", "for", "the", "execution", "of", "arbitrary", "scripts", "on", "the", "client", "-", "side", "browser", ",", "resulting", "to", "perform", "unauthorized", "actions", ".", "-", "This", "issue", "affects", ":", "Central", "Dogma", "artifacts", "from", "0", ".", "17", ".", "0", "to", "0", ".", "40", ".", "1", ".", "-", "The", "impact", ":", "Attacker", "is", "able", "to", "have", "victim", "execute", "arbitrary", "JavaScript", "code", "in", "the", "browser", ".", "-", "The", "component", ":", "Notification", "feature", "-", "The", "attack", "vector", ":", "Victim", "must", "open", "a", "specifically", "crafted", "URL", ".", "-", "The", "fixed", "version", ":", "0", ".", "41", ".", "0", "and", "later", ".", "-", "Please", "check", "`", "CVE", "-", "2019", "-", "6002", "<", "https", ":", "//", "cve", ".", "mitre", ".", "org", "/", "cgi", "-", "bin", "/", "cvename", ".", "cgi", "?", "name", "=", "CVE", "-", "2019", "-", "6002", ">", "`", "_", "to", "get", "more", "information", ".", "-", "If", "you", "found", "security", "bugs", ",", "please", "let", "us", "know", "`", "dl_oss_dev", "@", "linecorp", ".", "com", "<", "mailto", ":", "dl_oss_dev", "@", "linecorp", ".", "com", ">", "`", "_", "or", "send", "`", "Slack", "DM", "<", "https", ":", "//", "join", ".", "slack", ".", "com", "/", "t", "/", "central", "-", "dogma", "/", "shared_invite", "/", "enQtNjA5NDk5MTExODQzLWRlZTZmZDljNDY3OTBmN2Y1NDAwMGUzMTMzNmFlOTYzNzYyNDNmNmM5YTk3YmExM2M4NGRkOTY2NTE1MDJhODY", ">", "`", "_", "to", "maintainer", ".</s>}", "catch", "(", "CentralDogmaException", "e", ")", "{", "\"", "failed", "to", "get", "data", "from", "\"", "+", "jGitRepository", "+", "\"", "at", "\"", "+", "pathPattern", "+", "\"", "for", "\"", "+", "revision", ",", "e", ")", ";", "\"", "failed", "to", "retrieve", "the", "history", ":", "\"", "+", "jGitRepository", "+", "throw", "new", "StorageException", "(", "\"", "failed", "to", "push", "at", "\"", "+", "jGitRepository", ",", "e", ")", ";", "throw", "new", "StorageException", "(", "\"", "failed", "to", "determine", "the", "HEAD", ":", "\"", "+", "jGitRepository", ".", "getDirectory", "(", "))", ";", "Notification", ".", "error", "(", "arg", ".", "message", ")", ";", "-", "Consider", "enforcing", "network", "-", "level", "access", "control", "over", "Thrift", "calls", ".", "-", "Note", "that", "the", "Thrift", "RPC", "layer", "is", "left", "only", "for", "backward", "compatibility", ",", "and", "will", "be", "removed", "in", "the", "future", ","], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["nfs:", "always", "make", "sure", "page", "is", "up-to-date", "before", "extending", "a", "write", "to", "cover", "the", "entire", "page", "We", "should", "always", "make", "sure", "the", "cached", "page", "is", "up-to-date", "when", "we're", "determining", "whether", "we", "can", "extend", "a", "write", "to", "cover", "the", "full", "page", "--", "even", "if", "we've", "received", "a", "write", "delegation", "from", "the", "server.", "Commit", "c7559663", "added", "logic", "to", "skip", "this", "check", "if", "we", "have", "a", "write", "delegation,", "which", "can", "lead", "to", "data", "corruption", "such", "as", "the", "following", "scenario", "if", "client", "B", "receives", "a", "write", "delegation", "from", "the", "NFS", "server:", "Client", "A:", "#", "echo", "123456789", ">", "/mnt/file", "Client", "B:", "#", "echo", "abcdefghi", ">>", "/mnt/file", "#", "cat", "/mnt/file", "0\ufffdD0\ufffdabcdefghi", "Just", "because", "we", "hold", "a", "write", "delegation", "doesn't", "mean", "that", "we've", "read", "in", "the", "entire", "page", "contents.", "Cc:", "<stable@vger.kernel.org>", "#", "v3.11+", "Signed-off-by:", "Scott", "Mayhew", "<smayhew@redhat.com>", "Signed-off-by:", "Trond", "Myklebust", "<trond.myklebust@primarydata.com>"], "code_tokens": ["*", "If", "the", "file", "is", "opened", "for", "synchronous", "writes", "then", "we", "can", "just", "skip", "the", "rest", "*", "of", "the", "checks", ".", "if", "(", "!", "nfs_write_pageuptodate", "(", "page", ",", "inode", ")", ")", "return", "0", ";", "if", "(", "inode", "-", ">", "i_flock", "=", "=", "NULL", "|", "|", "(", "inode", "-", ">", "i_flock", "-", ">", "fl_start", "=", "=", "0", "&", "&", "inode", "-", ">", "i_flock", "-", ">", "fl_type", "!", "=", "F_RDLCK", ")", ")</s>*", "If", "the", "file", "is", "opened", "for", "synchronous", "writes", "or", "if", "we", "have", "a", "write", "delegation", "*", "from", "the", "server", "then", "we", "can", "just", "skip", "the", "rest", "of", "the", "checks", ".", "if", "(", "nfs_write_pageuptodate", "(", "page", ",", "inode", ")", "&", "&", "(", "inode", "-", ">", "i_flock", "=", "=", "NULL", "|", "|", "(", "inode", "-", ">", "i_flock", "-", ">", "fl_start", "=", "=", "0", "&", "&", "inode", "-", ">", "i_flock", "-", ">", "fl_type", "!", "=", "F_RDLCK", ")", "))"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["CAMEL-13042:", "Polished"], "code_tokens": ["</s>import", "org", ".", "apache", ".", "camel", ".", "CamelExchangeException", ";"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["mm/pagewalk.c:", "report", "holes", "in", "hugetlb", "ranges", "This", "matters", "at", "least", "for", "the", "mincore", "syscall,", "which", "will", "otherwise", "copy", "uninitialized", "memory", "from", "the", "page", "allocator", "to", "userspace.", "It", "is", "probably", "also", "a", "correctness", "error", "for", "/proc/$pid/pagemap,", "but", "I", "haven't", "tested", "that.", "Removing", "the", "`walk->hugetlb_entry`", "condition", "in", "walk_hugetlb_range()", "has", "no", "effect", "because", "the", "caller", "already", "checks", "for", "that.", "This", "only", "reports", "holes", "in", "hugetlb", "ranges", "to", "callers", "who", "have", "specified", "a", "hugetlb_entry", "callback.", "This", "issue", "was", "found", "using", "an", "AFL-based", "fuzzer.", "v2:", "-", "don't", "crash", "on", "->pte_hole==NULL", "(Andrew", "Morton)", "-", "add", "Cc", "stable", "(Andrew", "Morton)", "Fixes:", "1e25a271c8ac", "(\"mincore:", "apply", "page", "table", "walker", "on", "do_mincore()\")", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "pte", ")", "else", "if", "(", "walk", "-", ">", "pte_hole", ")", "err", "=", "walk", "-", ">", "pte_hole", "(", "addr", ",", "next", ",", "walk", ")", ";</s>if", "(", "pte", "&", "&", "walk", "-", ">", "hugetlb_entry", ")"], "docstring_tokens": ["uninitialized", "kernel", "heap", "page", "disclosure"]}
{"contents": ["vfs:", "ioctl:", "prevent", "double-fetch", "in", "dedupe", "ioctl", "This", "prevents", "a", "double-fetch", "from", "user", "space", "that", "can", "lead", "to", "to", "an", "undersized", "allocation", "and", "heap", "overflow.", "Fixes:", "54dbc1517237", "(\"vfs:", "hoist", "the", "btrfs", "deduplication", "ioctl", "to", "the", "vfs\")", "Signed-off-by:", "Scott", "Bauer", "<sbauer@plzdonthack.me>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["same", "-", ">", "dest_count", "=", "count", ";</s>"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["PR:", "1930", "Submitted", "by:", "Robin", "Seggelmann", "<seggelmann@fh-muenster.de>", "Approved", "by:", "steve@openssl.org", "Limit", "size", "of", "DTLS", "record", "buffer", "queue."], "code_tokens": ["int", "pqueue_size", "(", "pqueue_s", "*", "pq", ")", "{", "pitem", "*", "item", "=", "pq", "-", ">", "items", ";", "int", "count", "=", "0", ";", "while", "(", "item", "!", "=", "NULL", ")", "{", "count", "+", "+;", "item", "=", "item", "-", ">", "next", ";", "}", "return", "count", ";", "}", "@", "@", "-", "89", ",", "5", "+", "89", ",", "6", "@", "@", "pitem", "*", "pqueue_iterator", "(", "pqueue", "pq", ")", ";", "int", "pqueue_size", "(", "pqueue", "pq", ")", ";", "/", "*", "Limit", "the", "size", "of", "the", "queue", "to", "prevent", "DOS", "attacks", "*", "/", "if", "(", "pqueue_size", "(", "queue", "-", ">", "q", ")", ">", "=", "100", ")", "return", "0", ";</s>"], "docstring_tokens": ["buffer", "limitation"]}
{"contents": ["[GFS2]", "BZ", "217008", "fsfuzzer", "fix.", "Update", "the", "quilt", "header", "comments", "to", "match", "the", "code", "changes.", "Change", "gfs2_lookup_simple", "to", "return", "an", "error", "in", "the", "case", "of", "a", "NULL", "inode.", "The", "callers", "of", "gfs2_lookup_simple", "do", "not", "check", "for", "NULL", "in", "the", "no", "entry", "case", "and", "such", "would", "end", "up", "dereferencing", "a", "NULL", "ptr.", "This", "fixes:", "http://projects.info-pull.com/mokb/MOKB-15-11-2006.html", "Signed-off-by:", "Russell", "Cattelan", "<cattelan@redhat.com>", "Signed-off-by:", "Steven", "Whitehouse", "<swhiteho@redhat.com>"], "code_tokens": ["struct", "inode", "*", "inode", ";", "inode", "=", "gfs2_lookupi", "(", "dip", ",", "&", "qstr", ",", "1", ",", "NULL", ")", ";", "/", "*", "gfs2_lookupi", "has", "inconsistent", "callers", ":", "vfs", "*", "related", "routines", "expect", "NULL", "for", "no", "entry", "found", ",", "*", "gfs2_lookup_simple", "callers", "expect", "ENOENT", "*", "and", "do", "not", "check", "for", "NULL", ".", "*", "/", "if", "(", "inode", "=", "=", "NULL", ")", "return", "ERR_PTR", "(", "-", "ENOENT", ")", ";", "else", "return", "inode", ";</s>return", "gfs2_lookupi", "(", "dip", ",", "&", "qstr", ",", "1", ",", "NULL", ")", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[NETFILTER]:", "nfnetlink_log:", "fix", "possible", "NULL", "pointer", "dereference", "Eliminate", "possible", "NULL", "pointer", "dereference", "in", "nfulnl_recv_config().", "Signed-off-by:", "Michal", "Miroslaw", "<mirq-linux@rere.qmqm.pl>", "Signed-off-by:", "Patrick", "McHardy", "<kaber@trash.net>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "!", "inst", ")", "goto", "out", ";", "out", ":</s>"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[PLXUTILS-161]", "Commandline", "shell", "injection", "problems", "Patch", "by", "Charles", "Duffy,", "applied", "unmodified"], "code_tokens": ["*", "Shell", "usage", "is", "only", "desirable", "when", "generating", "code", "for", "remote", "execution", ".", "*", "*", "*", "Shell", "usage", "is", "only", "desirable", "when", "generating", "code", "for", "remote", "execution", ".", "*", "Create", "a", "new", "command", "line", "object", ",", "given", "a", "command", "following", "POSIX", "sh", "quoting", "rules", "realPos", "=", "(", "getLiteralExecutable", "(", ")", "=", "=", "null", "?", "0", ":", "1", ")", ";", "/", "**", "*", "@", "return", "Executable", "to", "be", "run", ",", "as", "a", "literal", "string", "(", "no", "shell", "quoting", "/", "munging", ")", "*", "/", "public", "String", "getLiteralExecutable", "(", ")", "{", "return", "executable", ";", "}", "/", "**", "*", "Return", "an", "executable", "name", ",", "quoted", "for", "shell", "use", ".", "*", "*", "Shell", "usage", "is", "only", "desirable", "when", "generating", "code", "for", "remote", "execution", ".", "*", "*", "@", "return", "Executable", "to", "be", "run", ",", "quoted", "for", "shell", "interpretation", "*", "/", "String", "executable", "=", "getLiteralExecutable", "(", ");", "*", "*", "Shell", "usage", "is", "only", "desirable", "when", "generating", "code", "for", "remote", "execution", ".", "process", "=", "Runtime", ".", "getRuntime", "(", ").", "exec", "(", "getCommandline", "(", "),", "environment", ",", "workingDir", ")", ";", "+", "\"", "\\\"", "does", "not", "specify", "a", "directory", ".", "\"", ")", ";", "process", "=", "Runtime", ".", "getRuntime", "(", ").", "exec", "(", "getCommandline", "(", "),", "environment", ",", "workingDir", ")", ";", "if", "(", "shell", ".", "getOriginalExecutable", "(", ")", "=", "=", "null", ")", "*", "Shell", "usage", "is", "only", "desirable", "when", "generating", "code", "for", "remote", "execution", ".", "*", "*", "Shell", "usage", "is", "only", "desirable", "when", "generating", "code", "for", "remote", "execution", ".", "this", "(", "false", ")", ";", "setUnconditionalQuoting", "(", "true", ")", ";", "setExecutableQuoteDelimiter", "(", "'", "\\'", "'", ")", ";", "return", "quoteOneItem", "(", "super", ".", "getOriginalExecutable", "(", "),", "true", ")", ";", "sb", ".", "append", "(", "quoteOneItem", "(", "dir", ",", "false", ")", ")", ";", "*", "BourneShell", ".", "quoteOneItem", "(", "null", ")", "=", "null", "*", "BourneShell", ".", "quoteOneItem", "(", "\"\"", ")", "=", "'", "'", "*", "BourneShell", ".", "quoteOneItem", "(", "\"/", "test", "/", "quotedpath", "'", "abc", "\"", ")", "=", "'", "/", "test", "/", "quotedpath", "'", "\"'", "\"'", "abc", "'", "*", "BourneShell", ".", "quoteOneItem", "(", "\"/", "test", "/", "quoted", "path", "'", "abc", "\"", ")", "=", "'", "/", "test", "/", "quoted", "pat", "'", "\"'", "\"'", "habc", "'", "*", "BourneShell", ".", "quoteOneItem", "(", "\"/", "test", "/", "quotedpath", "\\", "\"", "abc", "\"", ")", "=", "'", "/", "test", "/", "quotedpath", "\"", "abc", "'", "*", "BourneShell", ".", "quoteOneItem", "(", "\"/", "test", "/", "quoted", "path", "\\", "\"", "abc", "\"", ")", "=", "'", "/", "test", "/", "quoted", "path", "\"", "abc", "'", "*", "BourneShell", ".", "quoteOneItem", "(", "\"/", "test", "/", "quotedpath", "\\", "\"'", "abc", "\"", ")", "=", "'", "/", "test", "/", "quotedpath", "\"", "'\"", "'\"", "'", "abc", "'", "*", "BourneShell", ".", "quoteOneItem", "(", "\"/", "test", "/", "quoted", "path", "\\", "\"'", "abc", "\"", ")", "=", "'", "/", "test", "/", "quoted", "path", "\"", "'\"", "'\"", "'", "abc", "'", "protected", "String", "quoteOneItem", "(", "String", "path", ",", "boolean", "isExecutable", ")", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "sb", ".", "append", "(", "\"", "'\"", ")", ";", "sb", ".", "append", "(", "path", ".", "replace", "(", "\"", "'\"", ",", "\"", "'\\", "\"'", "\\\"", "'\"", ")", ")", ";", "sb", ".", "append", "(", "\"", "'\"", ")", ";", "return", "sb", ".", "toString", "(", ");", "private", "boolean", "unconditionallyQuote", "=", "false", ";", "/", "**", "*", "Toggle", "unconditional", "quoting", "*", "*", "@", "param", "unconditionallyQuote", "*", "/", "public", "void", "setUnconditionalQuoting", "(", "boolean", "unconditionallyQuote", ")", "{", "this", ".", "unconditionallyQuote", "=", "unconditionallyQuote", ";", "}", "protected", "String", "quoteOneItem", "(", "String", "inputString", ",", "boolean", "isExecutable", ")", "{", "char", "[", "]", "escapeChars", "=", "getEscapeChars", "(", "isSingleQuotedExecutableEscaped", "(", "),", "isDoubleQuotedExecutableEscaped", "(", ")", ")", ";", "return", "StringUtils", ".", "quoteAndEscape", "(", "inputString", ",", "isExecutable", "?", "getExecutableQuoteDelimiter", "(", ")", ":", "getArgumentQuoteDelimiter", "(", "),", "escapeChars", ",", "getQuotingTriggerChars", "(", "),", "'", "\\\\", "',", "unconditionallyQuote", ")", ";", "}", "sb", ".", "append", "(", "quoteOneItem", "(", "getOriginalExecutable", "(", "),", "true", ")", ")", ";", "sb", ".", "append", "(", "quoteOneItem", "(", "arguments", "[", "i", "]", ",", "false", ")", ")", ";", "commandLine", ".", "addAll", "(", "getCommandLine", "(", "getOriginalExecutable", "(", "),", "arguments", ")", ")", ";", "import", "junit", ".", "framework", ".", "TestCase", ";", "import", "java", ".", "io", ".", "*;", "String", "expectedShellCmd", "=", "\"", "'/", "bin", "/", "echo", "'", "'", "hello", "world", "'", "\";", "String", "expectedShellCmd", "=", "\"", "cd", "'", "\"", "+", "root", ".", "getAbsolutePath", "(", ")", "+", "\"", "path", "with", "spaces", "'", "&", "&", "'", "/", "bin", "/", "echo", "'", "'", "hello", "world", "'", "\";", "expectedShellCmd", "=", "\"", "cd", "'", "\"", "+", "root", ".", "getAbsolutePath", "(", ")", "+", "\"", "path", "with", "spaces", "'", "&", "&", "'", "\\\\", "bin", "\\", "\\", "echo", "'", "'", "hello", "world", "'", "\";", "String", "expectedShellCmd", "=", "\"", "'/", "bin", "/", "echo", "'", "'", "'\\", "\"'", "\\\"", "'", "hello", "world", "'", "\\\"", "'\\", "\"'", "'\"", ";", "assertEquals", "(", "\"", "'/", "usr", "/", "bin", "'", "'", "a", "'", "'", "b", "'", "\",", "shellCommandline", "[", "2", "]", ")", ";", "/", "**", "*", "Test", "an", "executable", "with", "shell", "-", "expandable", "content", "in", "its", "path", ".", "*", "*", "@", "throws", "Exception", "*", "/", "public", "void", "testPathWithShellExpansionStrings", "(", ")", "throws", "Exception", "{", "File", "dir", "=", "new", "File", "(", "System", ".", "getProperty", "(", "\"", "basedir", "\"", ")", ",", "\"", "target", "/", "test", "/", "dollar", "$", "test", "\"", ")", ";", "createAndCallScript", "(", "dir", ",", "\"", "echo", "Quoted", "\"", ")", ";", "}", "import", "junit", ".", "framework", ".", "TestCase", ";", "assertEquals", "(", "\"", "/", "bin", "/", "sh", "-", "c", "cd", "'", "/", "usr", "/", "local", "/", "bin", "'", "&", "&", "'", "chmod", "'", "\",", "executable", ")", ";", "assertEquals", "(", "\"", "/", "bin", "/", "sh", "-", "c", "cd", "'", "/", "usr", "/", "local", "/", "'\\", "\"'", "\\\"", "'", "something", "else", "'", "\\\"", "'\\", "\"'", "'", "&", "&", "'", "chmod", "'", "\",", "executable", ")", ";", "assertEquals", "(", "\"", "/", "bin", "/", "sh", "-", "c", "cd", "'", "\\\\", "usr", "\\", "\\", "local", "\\", "\\\\", "'\\", "\"'", "\\\"", "'", "something", "else", "'", "\\\"", "'\\", "\"'", "'", "&", "&", "'", "chmod", "'", "\",", "executable", ")", ";", "assertTrue", "(", "cli", ".", "endsWith", "(", "\"'", "'\\", "\"'", "\\\"", "'", "some", "arg", "with", "spaces", "'", "\\\"", "'\\", "\"'", "'\"", "))", ";", "assertEquals", "(", "\"", "cd", "'", "/", "usr", "/", "bin", "'", "&", "&", "'", "chmod", "'", "'", "arg", "'", "\\\"", "'\\", "\"'", "withquote", "'", "\",", "shellCommandLine", ".", "get", "(", "shellCommandLine", ".", "size", "(", ")", "-", "1", ")", ");", "assertEquals", "(", "\"", "'", "chmod", "'", "'", "--", "password", "'", "'", ";", "password", "'", "\",", "lines", "[", "2", "]", ")", ";", "assertEquals", "(", "\"", "'", "chmod", "'", "'", "--", "password", "'", "'", ";", "password", "'", "\",", "lines", "[", "2", "]", ")", ";", "assertEquals", "(", "\"", "'", "chmod", "'", "'", "'", "'", "|'", "'", "&&", "'", "'", "||", "'", "'", ";'", "'", ";;", "'", "'", "&'", "'", "()", "'", "'", "<'", "'", "<<", "'", "'", ">'", "'", ">>", "'", "'", "*'", "'", "?'", "'", "['", "'", "]'", "'", "{'", "'", "}'", "'", "`'", "\",</s>*", "Create", "a", "new", "command", "line", "object", ".", "*", "Shell", "is", "autodetected", "from", "operating", "system", "*", "Shell", "is", "autodetected", "from", "operating", "system", "realPos", "=", "(", "getExecutable", "(", ")", "=", "=", "null", "?", "0", ":", "1", ")", ";", "String", "executable", "=", "getExecutable", "(", ");", "process", "=", "Runtime", ".", "getRuntime", "(", ").", "exec", "(", "getShellCommandline", "(", "),", "environment", ")", ";", "process", "=", "Runtime", ".", "getRuntime", "(", ").", "exec", "(", "getShellCommandline", "(", "),", "environment", ",", "workingDir", ")", ";", "if", "(", "shell", ".", "getExecutable", "(", ")", "=", "=", "null", ")", "import", "org", ".", "codehaus", ".", "plexus", ".", "util", ".", "StringUtils", ";", "private", "static", "final", "char", "[", "]", "BASH_QUOTING_TRIGGER_CHARS", "=", "{", "'", "'", ",", "'", "$'", ",", "'", ";'", ",", "'", "&'", ",", "'", "|'", ",", "'", "<'", ",", "'", ">'", ",", "'", "*'", ",", "'", "?'", ",", "'", "('", ",", "'", ")'", ",", "'", "['", ",", "'", "]'", ",", "'", "{'", ",", "'", "}'", ",", "'", "`'", "}", ";", "this", "(", "false", ")", ";", "setExecutableQuoteDelimiter", "(", "'", "\\\"", "'", ")", ";", "return", "unifyQuotes", "(", "super", ".", "getExecutable", "(", "))", ";", "sb", ".", "append", "(", "unifyQuotes", "(", "dir", ")", ")", ";", "protected", "char", "[", "]", "getQuotingTriggerChars", "(", ")", "{", "return", "BASH_QUOTING_TRIGGER_CHARS", ";", "}", "*", "BourneShell", ".", "unifyQuotes", "(", "null", ")", "=", "null", "*", "BourneShell", ".", "unifyQuotes", "(", "\"\"", ")", "=", "(", "empty", ")", "*", "BourneShell", ".", "unifyQuotes", "(", "\"/", "test", "/", "quotedpath", "'", "abc", "\"", ")", "=", "/", "test", "/", "quotedpath", "\\", "'", "abc", "*", "BourneShell", ".", "unifyQuotes", "(", "\"/", "test", "/", "quoted", "path", "'", "abc", "\"", ")", "=", "\"", "/", "test", "/", "quoted", "path", "'", "abc", "\"", "*", "BourneShell", ".", "unifyQuotes", "(", "\"/", "test", "/", "quotedpath", "\\", "\"", "abc", "\"", ")", "=", "\"", "/", "test", "/", "quotedpath", "\\", "\"", "abc", "\"", "*", "BourneShell", ".", "unifyQuotes", "(", "\"/", "test", "/", "quoted", "path", "\\", "\"", "abc", "\"", ")", "=", "\"", "/", "test", "/", "quoted", "path", "\\", "\"", "abc", "\"", "*", "BourneShell", ".", "unifyQuotes", "(", "\"/", "test", "/", "quotedpath", "\\", "\"'", "abc", "\"", ")", "=", "\"", "/", "test", "/", "quotedpath", "\\", "\"'", "abc", "\"", "*", "BourneShell", ".", "unifyQuotes", "(", "\"/", "test", "/", "quoted", "path", "\\", "\"'", "abc", "\"", ")", "=", "\"", "/", "test", "/", "quoted", "path", "\\", "\"'", "abc", "\"", "protected", "static", "String", "unifyQuotes", "(", "String", "path", ")", "if", "(", "path", ".", "indexOf", "(", "\"", "\"", ")", "=", "=", "-", "1", "&", "&", "path", ".", "indexOf", "(", "\"", "'\"", ")", "!", "=", "-", "1", "&", "&", "path", ".", "indexOf", "(", "\"", "\\\"", "\"", ")", "=", "=", "-", "1", ")", "{", "return", "StringUtils", ".", "escape", "(", "path", ")", ";", "}", "return", "StringUtils", ".", "quoteAndEscape", "(", "path", ",", "'", "\\\"", "',", "BASH_QUOTING_TRIGGER_CHARS", ")", ";", "char", "[", "]", "escapeChars", "=", "getEscapeChars", "(", "isSingleQuotedExecutableEscaped", "(", "),", "isDoubleQuotedExecutableEscaped", "(", ")", ")", ";", "sb", ".", "append", "(", "StringUtils", ".", "quoteAndEscape", "(", "getExecutable", "(", "),", "getExecutableQuoteDelimiter", "(", "),", "escapeChars", ",", "getQuotingTriggerChars", "(", "),", "'", "\\\\", "',", "false", ")", ")", ";", "char", "[", "]", "escapeChars", "=", "getEscapeChars", "(", "isSingleQuotedArgumentEscaped", "(", "),", "isDoubleQuotedArgumentEscaped", "(", ")", ")", ";", "sb", ".", "append", "(", "StringUtils", ".", "quoteAndEscape", "(", "arguments", "[", "i", "]", ",", "getArgumentQuoteDelimiter", "(", "),", "escapeChars", ",", "getQuotingTriggerChars", "(", "),", "getArgumentEscapePattern", "(", "),", "false", ")", ")", ";", "commandLine", ".", "addAll", "(", "getCommandLine", "(", "getExecutable", "(", "),", "arguments", ")", ")", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileWriter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "io", ".", "Reader", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "io", ".", "Writer", ";", "import", "junit", ".", "framework", ".", "TestCase", ";", "String", "expectedShellCmd", "=", "\"", "/", "bin", "/", "echo", "\\", "'", "hello", "world", "\\", "'\"", ";", "String", "expectedShellCmd", "=", "\"", "cd", "\\", "\"\"", "+", "root", ".", "getAbsolutePath", "(", ")", "+", "\"", "path", "with", "spaces", "\\", "\"", "&", "&", "/", "bin", "/", "echo", "\\", "'", "hello", "world", "\\", "'\"", ";", "expectedShellCmd", "=", "\"", "cd", "\\", "\"\"", "+", "root", ".", "getAbsolutePath", "(", ")", "+", "\"", "path", "with", "spaces", "\\", "\"", "&", "&", "\\", "\\", "bin", "\\", "\\", "echo", "\\", "'", "hello", "world", "\\", "'\"", ";", "String", "expectedShellCmd", "=", "\"", "/", "bin", "/", "echo", "\\", "'", "hello", "world", "\\", "'\"", ";", "assertEquals", "(", "\"", "/", "usr", "/", "bin", "a", "b", "\"", ",", "shellCommandline", "[", "2", "]", ")", ";", "import", "junit", ".", "framework", ".", "TestCase", ";", "assertEquals", "(", "\"", "/", "bin", "/", "sh", "-", "c", "cd", "/", "usr", "/", "local", "/", "bin", "&", "&", "chmod", "\"", ",", "executable", ")", ";", "assertEquals", "(", "\"", "/", "bin", "/", "sh", "-", "c", "cd", "\\", "\"/", "usr", "/", "local", "/", "\\'", "something", "else", "\\", "'\\", "\"", "&", "&", "chmod", "\"", ",", "executable", ")", ";", "assertEquals", "(", "\"", "/", "bin", "/", "sh", "-", "c", "cd", "\\", "\"\\", "\\", "usr", "\\", "\\", "local", "\\", "\\\\", "'", "something", "else", "\\", "'\\", "\"", "&", "&", "chmod", "\"", ",", "executable", ")", ";", "assertTrue", "(", "cli", ".", "endsWith", "(", "args", "[", "0", "]", ")", ")", ";", "assertEquals", "(", "\"", "cd", "/", "usr", "/", "bin", "&", "&", "chmod", "'", "arg", "'", "\\\\", "''", "withquote", "'", "\",", "shellCommandLine", ".", "get", "(", "shellCommandLine", ".", "size", "(", ")", "-", "1", ")", ");", "assertEquals", "(", "\"", "chmod", "-", "-", "password", "'", ";", "password", "'", "\",", "lines", "[", "2", "]", ")", ";", "assertEquals", "(", "\"", "chmod", "-", "-", "password", "'", ";", "password", "'", "\",", "lines", "[", "2", "]", ")", ";", "assertEquals", "(", "\"", "chmod", "'", "'", "'", "|'", "'", "&&", "'", "'", "||", "'", "'", ";'", "'", ";;", "'", "'", "&'", "'", "()", "'", "'", "<'", "'", "<<", "'", "'", ">'", "'", ">>", "'", "'", "*'", "'", "?'", "'", "['", "'", "]'", "'", "{'", "'", "}'", "'", "`'", "\","], "docstring_tokens": ["command", "injection"]}
{"contents": ["..."], "code_tokens": ["/", "*", "Verify", "that", "file", "size", "large", "enough", "to", "contain", "a", "JPEG", "datastream", ".", "*", "/", "if", "(", "GetBlobSize", "(", "image", ")", "<", "107", ")", "ThrowReaderException", "(", "CorruptImageError", ",", "\"", "InsufficientImageDataInFile", "\"", ");", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";</s>"], "docstring_tokens": ["input", "validation"]}
{"contents": ["coredump:", "fix", "race", "condition", "between", "mmget_not_zero()/get_task_mm()", "and", "core", "dumping", "The", "core", "dumping", "code", "has", "always", "run", "without", "holding", "the", "mmap_sem", "for", "writing,", "despite", "that", "is", "the", "only", "way", "to", "ensure", "that", "the", "entire", "vma", "layout", "will", "not", "change", "from", "under", "it.", "Only", "using", "some", "signal", "serialization", "on", "the", "processes", "belonging", "to", "the", "mm", "is", "not", "nearly", "enough.", "This", "was", "pointed", "out", "earlier.", "For", "example", "in", "Hugh's", "post", "from", "Jul", "2017:", "https://lkml.kernel.org/r/alpine.LSU.2.11.1707191716030.2055@eggly.anvils", "\"Not", "strictly", "relevant", "here,", "but", "a", "related", "note:", "I", "was", "very", "surprised", "to", "discover,", "only", "quite", "recently,", "how", "handle_mm_fault()", "may", "be", "called", "without", "down_read(mmap_sem)", "-", "when", "core", "dumping.", "That", "seems", "a", "misguided", "optimization", "to", "me,", "which", "would", "also", "be", "nice", "to", "correct\"", "In", "particular", "because", "the", "growsdown", "and", "growsup", "can", "move", "the", "vm_start/vm_end", "the", "various", "loops", "the", "core", "dump", "does", "around", "the", "vma", "will", "not", "be", "consistent", "if", "page", "faults", "can", "happen", "concurrently.", "Pretty", "much", "all", "users", "calling", "mmget_not_zero()/get_task_mm()", "and", "then", "taking", "the", "mmap_sem", "had", "the", "potential", "to", "introduce", "unexpected", "side", "effects", "in", "the", "core", "dumping", "code.", "Adding", "mmap_sem", "for", "writing", "around", "the", "->core_dump", "invocation", "is", "a", "viable", "long", "term", "fix,", "but", "it", "requires", "removing", "all", "copy", "user", "and", "page", "faults", "and", "to", "replace", "them", "with", "get_dump_page()", "for", "all", "binary", "formats", "which", "is", "not", "suitable", "as", "a", "short", "term", "fix.", "For", "the", "time", "being", "this", "solution", "manually", "covers", "the", "places", "that", "can", "confuse", "the", "core", "dump", "either", "by", "altering", "the", "vma", "layout", "or", "the", "vma", "flags", "while", "it", "runs.", "Once", "->core_dump", "runs", "under", "mmap_sem", "for", "writing", "the", "function", "mmget_still_valid()", "can", "be", "dropped.", "Allowing", "mmap_sem", "protected", "sections", "to", "run", "in", "parallel", "with", "the", "coredump", "provides", "some", "minor", "parallelism", "advantage", "to", "the", "swapoff", "code", "(which", "seems", "to", "be", "safe", "enough", "by", "never", "mangling", "any", "vma", "field", "and", "can", "keep", "doing", "swapins", "in", "parallel", "to", "the", "core", "dumping)", "and", "to", "some", "other", "corner", "case.", "In", "order", "to", "facilitate", "the", "backporting", "I", "added", "\"Fixes:", "86039bd3b4e6\"", "however", "the", "side", "effect", "of", "this", "same", "race", "condition", "in", "/proc/pid/mem", "should", "be", "reproducible", "since", "before", "2.6.12-rc2", "so", "I", "couldn't", "add", "any", "other", "\"Fixes:\"", "because", "there's", "no", "hash", "beyond", "the", "git", "genesis", "commit.", "Because", "find_extend_vma()", "is", "the", "only", "location", "outside", "of", "the", "process", "context", "that", "could", "modify", "the", "\"mm\"", "structures", "under", "mmap_sem", "for", "reading,", "by", "adding", "the", "mmget_still_valid()", "check", "to", "it,", "all", "other", "cases", "that", "take", "the", "mmap_sem", "for", "reading", "don't", "need", "the", "new", "check", "after", "mmget_not_zero()/get_task_mm().", "The", "expand_stack()", "in", "page", "fault", "context", "also", "doesn't", "need", "the", "new", "check,", "because", "all", "tasks", "under", "core", "dumping", "are", "frozen.", "Link:", "http://lkml.kernel.org/r/20190325224949.11068-1-aarcange@redhat.com", "Fixes:", "86039bd3b4e6", "(\"userfaultfd:", "add", "new", "syscall", "to", "provide", "memory", "externalization\")", "Signed-off-by:", "Andrea", "Arcangeli", "<aarcange@redhat.com>", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Suggested-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Acked-by:", "Peter", "Xu", "<peterx@redhat.com>", "Reviewed-by:", "Mike", "Rapoport", "<rppt@linux.ibm.com>", "Reviewed-by:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Reviewed-by:", "Jann", "Horn", "<jannh@google.com>", "Acked-by:", "Jason", "Gunthorpe", "<jgg@mellanox.com>", "Acked-by:", "Michal", "Hocko", "<mhocko@suse.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "goto", "skip_mm", ";", "skip_mm", ":", "/", "*", "*", "Avoid", "to", "modify", "vma", "-", ">", "vm_flags", "*", "without", "locked", "ops", "while", "the", "*", "coredump", "reads", "the", "vm_flags", ".", "*", "/", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "{", "/", "*", "*", "Silently", "return", "\"", "count", "\"", "*", "like", "if", "get_task_mm", "(", ")", "*", "failed", ".", "FIXME", ":", "should", "this", "*", "function", "have", "returned", "*", "-", "ESRCH", "if", "get_task_mm", "(", ")", "*", "failed", "like", "if", "*", "get_proc_task", "(", ")", "fails", "?", "*", "/", "up_write", "(", "&", "mm", "-", ">", "mmap_sem", ")", ";", "goto", "out_mm", ";", "}", "/", "*", "no", "task", "can", "run", "(", "and", "in", "turn", "coredump", ")", "yet", "*", "/", "VM_WARN_ON", "(", "!", "mmget_still_valid", "(", "mm", ")", ");", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "goto", "skip_mm", ";", "skip_mm", ":", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "goto", "out_unlock", ";", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "goto", "out_unlock", ";", "/", "*", "*", "This", "has", "to", "be", "called", "after", "a", "get_task_mm", "(", ")/", "mmget_not_zero", "(", ")", "*", "followed", "by", "taking", "the", "mmap_sem", "for", "writing", "before", "modifying", "the", "*", "vmas", "or", "anything", "the", "coredump", "pretends", "not", "to", "change", "from", "under", "it", ".", "*", "*", "NOTE", ":", "find_extend_vma", "(", ")", "called", "from", "GUP", "context", "is", "the", "only", "place", "*", "that", "can", "modify", "the", "\"", "mm", "\"", "(", "notably", "the", "vm_start", "/", "end", ")", "under", "mmap_sem", "*", "for", "reading", "and", "outside", "the", "context", "of", "the", "process", ",", "so", "it", "is", "also", "*", "the", "only", "case", "that", "holds", "the", "mmap_sem", "for", "reading", "that", "must", "call", "*", "this", "function", ".", "Generally", "if", "the", "mmap_sem", "is", "hold", "for", "reading", "*", "there", "'", "s", "no", "need", "of", "this", "check", "after", "get_task_mm", "(", ")/", "mmget_not_zero", "(", ").", "*", "*", "This", "function", "can", "be", "obsoleted", "and", "the", "check", "can", "be", "removed", ",", "after", "*", "the", "coredump", "code", "will", "hold", "the", "mmap_sem", "for", "writing", "before", "*", "invoking", "the", "-", ">", "core_dump", "methods", ".", "*", "/", "static", "inline", "bool", "mmget_still_valid", "(", "struct", "mm_struct", "*", "mm", ")", "{", "return", "likely", "(", "!", "mm", "-", ">", "core_state", ")", ";", "}", "#", "include", "<", "linux", "/", "sched", "/", "mm", ".", "h", ">", "/", "*", "don", "'", "t", "alter", "vm_end", "if", "the", "coredump", "is", "running", "*", "/", "if", "(", "!", "prev", "|", "|", "!", "mmget_still_valid", "(", "mm", ")", "|", "|", "expand_stack", "(", "prev", ",", "addr", ")", ")", "/", "*", "don", "'", "t", "alter", "vm_start", "if", "the", "coredump", "is", "running", "*", "/", "if", "(", "!", "mmget_still_valid", "(", "mm", ")", ")", "return", "NULL", ";</s>if", "(", "!", "prev", "|", "|", "expand_stack", "(", "prev", ",", "addr", ")", ")"], "docstring_tokens": ["missing", "locking"]}
{"contents": ["[media]", "dvb-usb-firmware:", "don't", "do", "DMA", "on", "stack", "The", "buffer", "allocation", "for", "the", "firmware", "data", "was", "changed", "in", "commit", "43fab9793c1f", "(\"[media]", "dvb-usb:", "don't", "use", "stack", "for", "firmware", "load\")", "but", "the", "same", "applies", "for", "the", "reset", "value.", "Fixes:", "43fab9793c1f", "(\"[media]", "dvb-usb:", "don't", "use", "stack", "for", "firmware", "load\")", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Stefan", "Br\u00fcns", "<stefan.bruens@rwth-aachen.de>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@s-opensource.com>"], "code_tokens": ["u8", "*", "buf", ";", "int", "ret", ",", "pos", "=", "0", ";", "u16", "cpu_cs_register", "=", "cypress", "[", "type", "]", ".", "cpu_cs_register", ";", "buf", "=", "kmalloc", "(", "sizeof", "(", "*", "hx", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "buf", ")", "hx", "=", "(", "struct", "hexline", "*", ")", "buf", ";", "buf", "[", "0", "]", "=", "1", ";", "if", "(", "usb_cypress_writemem", "(", "udev", ",", "cpu_cs_register", ",", "buf", ",", "1", ")", "!", "=", "1", ")", "kfree", "(", "buf", ")", ";", "buf", "[", "0", "]", "=", "0", ";", "if", "(", "usb_cypress_writemem", "(", "udev", ",", "cpu_cs_register", ",", "buf", ",", "1", ")", "!", "=", "1", ")", "{", "kfree", "(", "buf", ")", ";</s>u8", "reset", ";", "int", "ret", ",", "pos", "=", "0", ";", "hx", "=", "kmalloc", "(", "sizeof", "(", "*", "hx", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "hx", ")", "reset", "=", "1", ";", "if", "(", "(", "ret", "=", "usb_cypress_writemem", "(", "udev", ",", "cypress", "[", "type", "]", ".", "cpu_cs_register", ",", "&", "reset", ",", "1", ")", ")", "!", "=", "1", ")", "kfree", "(", "hx", ")", ";", "reset", "=", "0", ";", "if", "(", "ret", "|", "|", "usb_cypress_writemem", "(", "udev", ",", "cypress", "[", "type", "]", ".", "cpu_cs_register", ",", "&", "reset", ",", "1", ")", "!", "=", "1", ")", "{", "kfree", "(", "hx", ")", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["igb:", "only", "use", "vlan_gro_receive", "if", "vlans", "are", "registered", "This", "change", "makes", "it", "so", "that", "vlan_gro_receive", "is", "only", "used", "if", "vlans", "have", "been", "registered", "to", "the", "adapter", "structure.", "Previously", "we", "were", "just", "sending", "all", "vlan", "tagged", "frames", "in", "via", "this", "function", "but", "this", "results", "in", "a", "null", "pointer", "dereference", "when", "vlans", "are", "not", "registered.", "[", "This", "fixes", "bugzilla", "entry", "15582", "-Eric", "Dumazet]", "Signed-off-by:", "Alexander", "Duyck", "<alexander.h.duyck@intel.com>", "Signed-off-by:", "Jeff", "Kirsher", "<jeffrey.t.kirsher@intel.com>", "Acked-by:", "Eric", "Dumazet", "<eric.dumazet@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "vlan_tag", "&", "&", "adapter", "-", ">", "vlgrp", ")</s>if", "(", "vlan_tag", ")"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["target/rd:", "Refactor", "rd_build_device_space", "+", "rd_release_device_space", "This", "patch", "refactors", "rd_build_device_space()", "+", "rd_release_device_space()", "into", "rd_allocate_sgl_table()", "+", "rd_release_device_space()", "so", "that", "they", "may", "be", "used", "seperatly", "for", "setup", "+", "release", "of", "protection", "information", "scatterlists.", "Also", "add", "explicit", "memset", "of", "pages", "within", "rd_allocate_sgl_table()", "based", "upon", "passed", "'init_payload'", "value.", "v2", "changes:", "-", "Drop", "unused", "sg_table", "from", "rd_release_device_space", "(Wei)", "Cc:", "Martin", "K.", "Petersen", "<martin.petersen@oracle.com>", "Cc:", "Christoph", "Hellwig", "<hch@lst.de>", "Cc:", "Hannes", "Reinecke", "<hare@suse.de>", "Cc:", "Sagi", "Grimberg", "<sagig@mellanox.com>", "Cc:", "Or", "Gerlitz", "<ogerlitz@mellanox.com>", "Signed-off-by:", "Nicholas", "Bellinger", "<nab@linux-iscsi.org>"], "code_tokens": ["static", "u32", "rd_release_sgl_table", "(", "struct", "rd_dev", "*", "rd_dev", ",", "struct", "rd_dev_sg_table", "*", "sg_table", ",", "u32", "sg_table_count", ")", "u32", "i", ",", "j", ",", "page_count", "=", "0", ",", "sg_per_table", ";", "for", "(", "i", "=", "0", ";", "i", "<", "sg_table_count", ";", "i", "+", "+)", "{", "kfree", "(", "sg_table", ")", ";", "return", "page_count", ";", "}", "static", "void", "rd_release_device_space", "(", "struct", "rd_dev", "*", "rd_dev", ")", "{", "u32", "page_count", ";", "if", "(", "!", "rd_dev", "-", ">", "sg_table_array", "|", "|", "!", "rd_dev", "-", ">", "sg_table_count", ")", "return", ";", "page_count", "=", "rd_release_sgl_table", "(", "rd_dev", ",", "rd_dev", "-", ">", "sg_table_array", ",", "rd_dev", "-", ">", "sg_table_count", ")", ";", "static", "int", "rd_allocate_sgl_table", "(", "struct", "rd_dev", "*", "rd_dev", ",", "struct", "rd_dev_sg_table", "*", "sg_table", ",", "u32", "total_sg_needed", ",", "unsigned", "char", "init_payload", ")", "u32", "i", "=", "0", ",", "j", ",", "page_offset", "=", "0", ",", "sg_per_table", ";", "unsigned", "char", "*", "p", ";", "p", "=", "kmap", "(", "pg", ")", ";", "memset", "(", "p", ",", "init_payload", ",", "PAGE_SIZE", ")", ";", "kunmap", "(", "pg", ")", ";", "return", "0", ";", "}", "static", "int", "rd_build_device_space", "(", "struct", "rd_dev", "*", "rd_dev", ")", "{", "struct", "rd_dev_sg_table", "*", "sg_table", ";", "u32", "sg_tables", ",", "total_sg_needed", ";", "u32", "max_sg_per_table", "=", "(", "RD_MAX_ALLOCATION_SIZE", "/", "sizeof", "(", "struct", "scatterlist", ")", ");", "int", "rc", ";", "if", "(", "rd_dev", "-", ">", "rd_page_count", "<", "=", "0", ")", "{", "pr_err", "(", "\"", "Illegal", "page", "count", ":", "%", "u", "for", "Ramdisk", "device", "\\", "n", "\"", ",", "rd_dev", "-", ">", "rd_page_count", ")", ";", "return", "-", "EINVAL", ";", "}", "/", "*", "Don", "'", "t", "need", "backing", "pages", "for", "NULLIO", "*", "/", "if", "(", "rd_dev", "-", ">", "rd_flags", "&", "RDF_NULLIO", ")", "return", "0", ";", "total_sg_needed", "=", "rd_dev", "-", ">", "rd_page_count", ";", "sg_tables", "=", "(", "total_sg_needed", "/", "max_sg_per_table", ")", "+", "1", ";", "sg_table", "=", "kzalloc", "(", "sg_tables", "*", "sizeof", "(", "struct", "rd_dev_sg_table", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "sg_table", ")", "{", "pr_err", "(", "\"", "Unable", "to", "allocate", "memory", "for", "Ramdisk", "\"", "\"", "scatterlist", "tables", "\\", "n", "\"", ");", "return", "-", "ENOMEM", ";", "}", "rd_dev", "-", ">", "sg_table_array", "=", "sg_table", ";", "rd_dev", "-", ">", "sg_table_count", "=", "sg_tables", ";", "rc", "=", "rd_allocate_sgl_table", "(", "rd_dev", ",", "sg_table", ",", "total_sg_needed", ",", "0x00", ")", ";", "if", "(", "rc", ")", "return", "rc", ";", "\"", "%", "u", "pages", "in", "%", "u", "tables", "\\", "n", "\"", ",", "rd_dev", "-", ">", "rd_host", "-", ">", "rd_host_id", ",", "rd_dev", "-", ">", "rd_dev_id", ",", "rd_dev", "-", ">", "rd_page_count", ",", "rd_dev", "-", ">", "sg_table_count", ")", ";</s>/", "*", "rd_release_device_space", "(", "):", "*", "*", "*", "/", "static", "void", "rd_release_device_space", "(", "struct", "rd_dev", "*", "rd_dev", ")", "u32", "i", ",", "j", ",", "page_count", "=", "0", ",", "sg_per_table", ";", "struct", "rd_dev_sg_table", "*", "sg_table", ";", "if", "(", "!", "rd_dev", "-", ">", "sg_table_array", "|", "|", "!", "rd_dev", "-", ">", "sg_table_count", ")", "return", ";", "sg_table", "=", "rd_dev", "-", ">", "sg_table_array", ";", "for", "(", "i", "=", "0", ";", "i", "<", "rd_dev", "-", ">", "sg_table_count", ";", "i", "+", "+)", "{", "kfree", "(", "sg_table", ")", ";", "static", "int", "rd_build_device_space", "(", "struct", "rd_dev", "*", "rd_dev", ")", "u32", "i", "=", "0", ",", "j", ",", "page_offset", "=", "0", ",", "sg_per_table", ",", "sg_tables", ",", "total_sg_needed", ";", "struct", "rd_dev_sg_table", "*", "sg_table", ";", "if", "(", "rd_dev", "-", ">", "rd_page_count", "<", "=", "0", ")", "{", "pr_err", "(", "\"", "Illegal", "page", "count", ":", "%", "u", "for", "Ramdisk", "device", "\\", "n", "\"", ",", "rd_dev", "-", ">", "rd_page_count", ")", ";", "return", "-", "EINVAL", ";", "}", "/", "*", "Don", "'", "t", "need", "backing", "pages", "for", "NULLIO", "*", "/", "if", "(", "rd_dev", "-", ">", "rd_flags", "&", "RDF_NULLIO", ")", "return", "0", ";", "total_sg_needed", "=", "rd_dev", "-", ">", "rd_page_count", ";", "sg_tables", "=", "(", "total_sg_needed", "/", "max_sg_per_table", ")", "+", "1", ";", "sg_table", "=", "kzalloc", "(", "sg_tables", "*", "sizeof", "(", "struct", "rd_dev_sg_table", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "sg_table", ")", "{", "pr_err", "(", "\"", "Unable", "to", "allocate", "memory", "for", "Ramdisk", "\"", "\"", "scatterlist", "tables", "\\", "n", "\"", ");", "return", "-", "ENOMEM", ";", "}", "rd_dev", "-", ">", "sg_table_array", "=", "sg_table", ";", "rd_dev", "-", ">", "sg_table_count", "=", "sg_tables", ";", "\"", "%", "u", "pages", "in", "%", "u", "tables", "\\", "n", "\"", ",", "rd_dev", "-", ">", "rd_host", "-", ">", "rd_host_id", ",", "rd_dev", "-", ">", "rd_dev_id", ",", "rd_dev", "-", ">", "rd_page_count", ",", "rd_dev", "-", ">", "sg_table_count", ")", ";"], "docstring_tokens": ["information", "leak"]}
{"contents": ["Validate", "docker", "image", "name", "before", "launching", "container.", "(cherry", "picked", "from", "commit", "e120ee865aa78eaff4a80122c5f3207a97b4924d)", "Conflicts:", "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/linux/runtime/DockerLinuxContainerRuntime.java"], "code_tokens": ["import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "/", "This", "validates", "that", "the", "image", "is", "a", "proper", "docker", "image", "public", "static", "final", "String", "DOCKER_IMAGE_PATTERN", "=", "\"", "^(", "([", "a", "-", "zA", "-", "Z0", "-", "9", ".", "-]", "+)", "(:", "\\\\", "d", "+", ")?", "/)", "?(", "[", "a", "-", "z0", "-", "9_", ".", "/-", "]+", ")(", ":[", "\\\\", "w", ".", "-]", "+)", "?$", "\";", "private", "static", "final", "Pattern", "dockerImagePattern", "=", "Pattern", ".", "compile", "(", "DOCKER_IMAGE_PATTERN", ")", ";", "validateImageName", "(", "imageName", ")", ";", "public", "static", "void", "validateImageName", "(", "String", "imageName", ")", "throws", "ContainerExecutionException", "{", "if", "(", "imageName", "=", "=", "null", "|", "|", "imageName", ".", "isEmpty", "(", "))", "{", "throw", "new", "ContainerExecutionException", "(", "ENV_DOCKER_CONTAINER_IMAGE", "+", "\"", "not", "set", "!", "\")", ";", "}", "if", "(", "!", "dockerImagePattern", ".", "matcher", "(", "imageName", ")", ".", "matches", "(", "))", "{", "throw", "new", "ContainerExecutionException", "(", "\"", "Image", "name", "'", "\"", "+", "imageName", "+", "\"", "'", "doesn", "'", "t", "match", "docker", "image", "name", "pattern", "\"", ");", "}", "}", "@", "Test", "public", "void", "testDockerImageNamePattern", "(", ")", "throws", "Exception", "{", "String", "[", "]", "validNames", "=", "{", "\"", "ubuntu", "\"", ",", "\"", "fedora", "/", "httpd", ":", "version1", ".", "0", "\"", ",", "\"", "fedora", "/", "httpd", ":", "version1", ".", "0", ".", "test", "\"", ",", "\"", "fedora", "/", "httpd", ":", "version1", ".", "0", ".", "TEST", "\"", ",", "\"", "myregistryhost", ":", "5000", "/", "ubuntu", "\"", ",", "\"", "myregistryhost", ":", "5000", "/", "fedora", "/", "httpd", ":", "version1", ".", "0", "\"", ",", "\"", "myregistryhost", ":", "5000", "/", "fedora", "/", "httpd", ":", "version1", ".", "0", ".", "test", "\"", ",", "\"", "myregistryhost", ":", "5000", "/", "fedora", "/", "httpd", ":", "version1", ".", "0", ".", "TEST", "\"", "};", "String", "[", "]", "invalidNames", "=", "{", "\"", "Ubuntu", "\"", ",", "\"", "ubuntu", "|", "|", "fedora", "\"", ",", "\"", "ubuntu", "#", "\",", "\"", "myregistryhost", ":", "50AB0", "/", "ubuntu", "\"", ",", "\"", "myregistry", "#", "host", ":", "50AB0", "/", "ubuntu", "\"", ",", "\"", ":", "8080", "/", "ubuntu", "\"", "}", ";", "for", "(", "String", "name", ":", "validNames", ")", "{", "DockerLinuxContainerRuntime", ".", "validateImageName", "(", "name", ")", ";", "}", "for", "(", "String", "name", ":", "invalidNames", ")", "{", "try", "{", "DockerLinuxContainerRuntime", ".", "validateImageName", "(", "name", ")", ";", "Assert", ".", "fail", "(", "name", "+", "\"", "is", "an", "invalid", "name", "and", "should", "fail", "the", "regex", "\"", ");", "}", "catch", "(", "ContainerExecutionException", "ce", ")", "{", "continue", ";", "}", "}", "}</s>if", "(", "imageName", "=", "=", "null", ")", "{", "throw", "new", "ContainerExecutionException", "(", "ENV_DOCKER_CONTAINER_IMAGE", "+", "\"", "not", "set", "!", "\")", ";", "}"], "docstring_tokens": ["input", "validation"]}
{"contents": ["nl80211:", "fix", "check", "for", "valid", "SSID", "size", "in", "scan", "operations", "In", "both", "trigger_scan", "and", "sched_scan", "operations,", "we", "were", "checking", "for", "the", "SSID", "length", "before", "assigning", "the", "value", "correctly.", "Since", "the", "memory", "was", "just", "kzalloc'ed,", "the", "check", "was", "always", "failing", "and", "SSID", "with", "over", "32", "characters", "were", "allowed", "to", "go", "through.", "This", "was", "causing", "a", "buffer", "overflow", "when", "copying", "the", "actual", "SSID", "to", "the", "proper", "place.", "This", "bug", "has", "been", "there", "since", "2.6.29-rc4.", "Cc:", "stable@kernel.org", "Signed-off-by:", "Luciano", "Coelho", "<coelho@ti.com>", "Signed-off-by:", "John", "W.", "Linville", "<linville@tuxdriver.com>"], "code_tokens": ["request", "-", ">", "ssids", "[", "i", "]", ".", "ssid_len", "=", "nla_len", "(", "attr", ")", ";", "request", "-", ">", "ssids", "[", "i", "]", ".", "ssid_len", "=", "nla_len", "(", "attr", ")", ";</s>request", "-", ">", "ssids", "[", "i", "]", ".", "ssid_len", "=", "nla_len", "(", "attr", ")", ";", "request", "-", ">", "ssids", "[", "i", "]", ".", "ssid_len", "=", "nla_len", "(", "attr", ")", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["ocfs2:", "ip_alloc_sem", "should", "be", "taken", "in", "ocfs2_get_block()", "ip_alloc_sem", "should", "be", "taken", "in", "ocfs2_get_block()", "when", "reading", "file", "in", "DIRECT", "mode", "to", "prevent", "concurrent", "access", "to", "extent", "tree", "with", "ocfs2_dio_end_io_write(),", "which", "may", "cause", "BUGON", "in", "the", "following", "situation:", "read", "file", "'A'", "end_io", "of", "writing", "file", "'A'", "vfs_read", "__vfs_read", "ocfs2_file_read_iter", "generic_file_read_iter", "ocfs2_direct_IO", "__blockdev_direct_IO", "do_blockdev_direct_IO", "do_direct_IO", "get_more_blocks", "ocfs2_get_block", "ocfs2_extent_map_get_blocks", "ocfs2_get_clusters", "ocfs2_get_clusters_nocache()", "ocfs2_search_extent_list", "return", "the", "index", "of", "record", "which", "contains", "the", "v_cluster,", "that", "is", "v_cluster", ">", "rec[i]->e_cpos.", "ocfs2_dio_end_io", "ocfs2_dio_end_io_write", "down_write(&oi->ip_alloc_sem);", "ocfs2_mark_extent_written", "ocfs2_change_extent_flag", "ocfs2_split_extent", "...", "-->", "modify", "the", "rec[i]->e_cpos,", "resulting", "in", "v_cluster", "<", "rec[i]->e_cpos.", "BUG_ON(v_cluster", "<", "le32_to_cpu(rec->e_cpos))", "[alex.chen@huawei.com:", "v3]", "Link:", "http://lkml.kernel.org/r/59EF3614.6050008@huawei.com", "Link:", "http://lkml.kernel.org/r/59EF3614.6050008@huawei.com", "Fixes:", "c15471f79506", "(\"ocfs2:", "fix", "sparse", "file", "&", "data", "ordering", "issue", "in", "direct", "io\")", "Signed-off-by:", "Alex", "Chen", "<alex.chen@huawei.com>", "Reviewed-by:", "Jun", "Piao", "<piaojun@huawei.com>", "Reviewed-by:", "Joseph", "Qi", "<jiangqi903@gmail.com>", "Reviewed-by:", "Gang", "He", "<ghe@suse.com>", "Acked-by:", "Changwei", "Ge", "<ge.changwei@h3c.com>", "Cc:", "Mark", "Fasheh", "<mfasheh@versity.com>", "Cc:", "Joel", "Becker", "<jlbec@evilplan.org>", "Cc:", "Junxiao", "Bi", "<junxiao.bi@oracle.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["static", "int", "ocfs2_lock_get_block", "(", "struct", "inode", "*", "inode", ",", "sector_t", "iblock", ",", "struct", "buffer_head", "*", "bh_result", ",", "int", "create", ")", "{", "int", "ret", "=", "0", ";", "struct", "ocfs2_inode_info", "*", "oi", "=", "OCFS2_I", "(", "inode", ")", ";", "down_read", "(", "&", "oi", "-", ">", "ip_alloc_sem", ")", ";", "ret", "=", "ocfs2_get_block", "(", "inode", ",", "iblock", ",", "bh_result", ",", "create", ")", ";", "up_read", "(", "&", "oi", "-", ">", "ip_alloc_sem", ")", ";", "return", "ret", ";", "}", "static", "int", "ocfs2_dio_wr_get_block", "(", "struct", "inode", "*", "inode", ",", "sector_t", "iblock", ",", "/", "*", "This", "is", "the", "fast", "path", "for", "re", "-", "write", ".", "*", "/", "ret", "=", "ocfs2_lock_get_block", "(", "inode", ",", "iblock", ",", "bh_result", ",", "create", ")", ";", "get_block", "=", "ocfs2_lock_get_block", ";", "get_block", "=", "ocfs2_dio_wr_get_block", ";</s>static", "int", "ocfs2_dio_get_block", "(", "struct", "inode", "*", "inode", ",", "sector_t", "iblock", ",", "down_read", "(", "&", "oi", "-", ">", "ip_alloc_sem", ")", ";", "/", "*", "This", "is", "the", "fast", "path", "for", "re", "-", "write", ".", "*", "/", "ret", "=", "ocfs2_get_block", "(", "inode", ",", "iblock", ",", "bh_result", ",", "create", ")", ";", "up_read", "(", "&", "oi", "-", ">", "ip_alloc_sem", ")", ";", "get_block", "=", "ocfs2_get_block", ";", "get_block", "=", "ocfs2_dio_get_block", ";"], "docstring_tokens": ["race", "condition"]}
{"contents": [":", "avoid", "memory", "leak", "in", "SRP", "The", "SRP", "user", "database", "lookup", "method", "SRP_VBASE_get_by_user", "had", "confusing", "memory", "management", "semantics;", "the", "returned", "pointer", "was", "sometimes", "newly", "allocated,", "and", "sometimes", "owned", "by", "the", "callee.", "The", "calling", "code", "has", "no", "way", "of", "distinguishing", "these", "two", "cases.", "Specifically,", "SRP", "servers", "that", "configure", "a", "secret", "seed", "to", "hide", "valid", "login", "information", "are", "vulnerable", "to", "a", "memory", "leak:", "an", "attacker", "connecting", "with", "an", "invalid", "username", "can", "cause", "a", "memory", "leak", "of", "around", "300", "bytes", "per", "connection.", "Servers", "that", "do", "not", "configure", "SRP,", "or", "configure", "SRP", "but", "do", "not", "configure", "a", "seed", "are", "not", "vulnerable.", "In", "Apache,", "the", "seed", "directive", "is", "known", "as", "SSLSRPUnknownUserSeed.", "To", "mitigate", "the", "memory", "leak,", "the", "seed", "handling", "in", "SRP_VBASE_get_by_user", "is", "now", "disabled", "even", "if", "the", "user", "has", "configured", "a", "seed.", "Applications", "are", "advised", "to", "migrate", "to", "SRP_VBASE_get1_by_user.", "However,", "note", "that", "OpenSSL", "makes", "no", "strong", "guarantees", "about", "the", "indistinguishability", "of", "valid", "and", "invalid", "logins.", "In", "particular,", "computations", "are", "currently", "not", "carried", "out", "in", "constant", "time.", "Reviewed-by:", "Rich", "Salz", "<rsalz@openssl.org>"], "code_tokens": ["*", ")", "Disable", "SRP", "fake", "user", "seed", "to", "address", "a", "server", "memory", "leak", ".", "Add", "a", "new", "method", "SRP_VBASE_get1_by_user", "that", "handles", "the", "seed", "properly", ".", "SRP_VBASE_get_by_user", "had", "inconsistent", "memory", "management", "behaviour", ".", "In", "order", "to", "fix", "an", "unavoidable", "memory", "leak", ",", "SRP_VBASE_get_by_user", "was", "changed", "to", "ignore", "the", "\"", "fake", "user", "\"", "SRP", "seed", ",", "even", "if", "the", "seed", "is", "configured", ".", "Users", "should", "use", "SRP_VBASE_get1_by_user", "instead", ".", "Note", "that", "in", "SRP_VBASE_get1_by_user", ",", "caller", "must", "free", "the", "returned", "value", ".", "Note", "also", "that", "even", "though", "configuring", "the", "SRP", "seed", "attempts", "to", "hide", "invalid", "usernames", "by", "continuing", "the", "handshake", "with", "fake", "credentials", ",", "this", "behaviour", "is", "not", "constant", "time", "and", "no", "strong", "guarantees", "are", "made", "that", "the", "handshake", "is", "indistinguishable", "from", "that", "of", "a", "valid", "user", ".", "(", "CVE", "-", "2016", "-", "0798", ")", "[", "Emilia", "K", "\u00e4", "sper", "]", "int", "ret", "=", "SSL3_AL_FATAL", ";", "goto", "err", ";", "goto", "err", ";", "ret", "=", "SSL_ERROR_NONE", ";", "err", ":", "SRP_user_pwd_free", "(", "p", "-", ">", "user", ")", ";", "return", "ret", ";", "SRP_user_pwd_free", "(", "srp_callback_parm", ".", "user", ")", ";", "SRP_VBASE_get1_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_user_pwd_free", "(", "srp_callback_parm", ".", "user", ")", ";", "SRP_VBASE_get1_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_user_pwd_free", "(", "srp_callback_parm", ".", "user", ")", ";", "SRP_VBASE_get1_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_user_pwd_free", "(", "srp_callback_parm", ".", "user", ")", ";", "SRP_VBASE_get1_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_user_pwd_free", "(", "srp_callback_parm", ".", "user", ")", ";", "SRP_VBASE_get1_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_user_pwd_free", "(", "srp_callback_parm", ".", "user", ")", ";", "SRP_VBASE_get1_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_user_pwd_free", "(", "srp_callback_parm", ".", "user", ")", ";", "SRP_VBASE_get1_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "/", "*", "Owned", "by", "us", ".", "*", "/", "/", "*", "Not", "owned", "by", "us", ".", "*", "/", "/", "*", "Owned", "by", "us", ".", "*", "/", "void", "SRP_user_pwd_free", "(", "SRP_user_pwd", "*", "user_pwd", ")", ";", "/", "*", "This", "method", "ignores", "the", "configured", "seed", "and", "fails", "for", "an", "unknown", "user", ".", "*", "/", "/", "*", "NOTE", ":", "unlike", "in", "SRP_VBASE_get_by_user", ",", "caller", "owns", "the", "returned", "pointer", ".", "*/", "SRP_user_pwd", "*", "SRP_VBASE_get1_by_user", "(", "SRP_VBASE", "*", "vb", ",", "char", "*", "username", ")", ";", "void", "SRP_user_pwd_free", "(", "SRP_user_pwd", "*", "user_pwd", ")", "static", "SRP_user_pwd", "*", "srp_user_pwd_dup", "(", "SRP_user_pwd", "*", "src", ")", "{", "SRP_user_pwd", "*", "ret", ";", "if", "(", "src", "=", "=", "NULL", ")", "return", "NULL", ";", "if", "(", "(", "ret", "=", "SRP_user_pwd_new", "(", "))", "=", "=", "NULL", ")", "return", "NULL", ";", "SRP_user_pwd_set_gN", "(", "ret", ",", "src", "-", ">", "g", ",", "src", "-", ">", "N", ")", ";", "if", "(", "!", "SRP_user_pwd_set_ids", "(", "ret", ",", "src", "-", ">", "id", ",", "src", "-", ">", "info", ")", "|", "|", "!", "SRP_user_pwd_set_sv_BN", "(", "ret", ",", "BN_dup", "(", "src", "-", ">", "s", ")", ",", "BN_dup", "(", "src", "-", ">", "v", ")", "))", "{", "SRP_user_pwd_free", "(", "ret", ")", ";", "return", "NULL", ";", "}", "return", "ret", ";", "}", "static", "SRP_user_pwd", "*", "find_user", "(", "SRP_VBASE", "*", "vb", ",", "char", "*", "username", ")", "return", "NULL", ";", "}", "/", "*", "*", "This", "method", "ignores", "the", "configured", "seed", "and", "fails", "for", "an", "unknown", "user", ".", "*", "Ownership", "of", "the", "returned", "pointer", "is", "not", "released", "to", "the", "caller", ".", "*", "In", "other", "words", ",", "caller", "must", "not", "free", "the", "result", ".", "*", "/", "SRP_user_pwd", "*", "SRP_VBASE_get_by_user", "(", "SRP_VBASE", "*", "vb", ",", "char", "*", "username", ")", "{", "return", "find_user", "(", "vb", ",", "username", ")", ";", "}", "/", "*", "*", "Ownership", "of", "the", "returned", "pointer", "is", "released", "to", "the", "caller", ".", "*", "In", "other", "words", ",", "caller", "must", "free", "the", "result", "once", "done", ".", "*", "/", "SRP_user_pwd", "*", "SRP_VBASE_get1_by_user", "(", "SRP_VBASE", "*", "vb", ",", "char", "*", "username", ")", "{", "SRP_user_pwd", "*", "user", ";", "unsigned", "char", "digv", "[", "SHA_DIGEST_LENGTH", "]", ";", "unsigned", "char", "digs", "[", "SHA_DIGEST_LENGTH", "]", ";", "EVP_MD_CTX", "ctxt", ";", "if", "(", "vb", "=", "=", "NULL", ")", "return", "NULL", ";", "if", "(", "(", "user", "=", "find_user", "(", "vb", ",", "username", ")", ")", "!", "=", "NULL", ")", "return", "srp_user_pwd_dup", "(", "user", ")", ";", "SRP_VBASE_get1_by_user", "2393", "EXIST", ":", ":", "FUNCTION", ":", "SRP", "SRP_user_pwd_free", "2394", "EXIST", ":", ":", "FUNCTION", ":", "SRP</s>return", "SSL3_AL_FATAL", ";", "return", "SSL3_AL_FATAL", ";", "/", "*", "need", "to", "check", "whether", "there", "are", "memory", "leaks", "*", "/", "return", "SSL_ERROR_NONE", ";", "SRP_VBASE_get_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_VBASE_get_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_VBASE_get_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_VBASE_get_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_VBASE_get_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_VBASE_get_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "SRP_VBASE_get_by_user", "(", "srp_callback_parm", ".", "vb", ",", "srp_callback_parm", ".", "login", ")", ";", "static", "void", "SRP_user_pwd_free", "(", "SRP_user_pwd", "*", "user_pwd", ")", "SRP_user_pwd", "*", "SRP_VBASE_get_by_user", "(", "SRP_VBASE", "*", "vb", ",", "char", "*", "username", ")", "unsigned", "char", "digv", "[", "SHA_DIGEST_LENGTH", "]", ";", "unsigned", "char", "digs", "[", "SHA_DIGEST_LENGTH", "]", ";", "EVP_MD_CTX", "ctxt", ";"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["Internally,", "remove", "all", "references", "to", "a", "Window", "object", "that", "belongs", "to", "an", "expression", "in", "an", "ORDER", "BY", "clause", "if", "that", "expression", "is", "converted", "to", "an", "alias", "of", "a", "result-set", "expression.", "Fix", "for", "[4feb3159c6]."], "code_tokens": ["#", "ifndef", "SQLITE_OMIT_WINDOWFUNC", "/", "*", "*", "*", "Walker", "callback", "for", "resolveRemoveWindows", "(", ").", "*", "/", "static", "int", "resolveRemoveWindowsCb", "(", "Walker", "*", "pWalker", ",", "Expr", "*", "pExpr", ")", "{", "if", "(", "ExprHasProperty", "(", "pExpr", ",", "EP_WinFunc", ")", ")", "{", "Window", "*", "*", "pp", ";", "for", "(", "pp", "=", "&", "pWalker", "-", ">", "u", ".", "pSelect", "-", ">", "pWin", ";", "*", "pp", ";", "pp", "=", "&(", "*", "pp", ")", "->", "pNextWin", ")", "{", "if", "(", "*", "pp", "=", "=", "pExpr", "-", ">", "y", ".", "pWin", ")", "{", "*", "pp", "=", "(", "*", "pp", ")", "->", "pNextWin", ";", "break", ";", "}", "}", "}", "return", "WRC_Continue", ";", "}", "/", "*", "*", "*", "Remove", "any", "Window", "objects", "owned", "by", "the", "expression", "pExpr", "from", "the", "*", "*", "Select", ".", "pWin", "list", "of", "Select", "object", "pSelect", ".", "*", "/", "static", "void", "resolveRemoveWindows", "(", "Select", "*", "pSelect", ",", "Expr", "*", "pExpr", ")", "{", "Walker", "sWalker", ";", "memset", "(", "&", "sWalker", ",", "0", ",", "sizeof", "(", "Walker", ")", ");", "sWalker", ".", "xExprCallback", "=", "resolveRemoveWindowsCb", ";", "sWalker", ".", "u", ".", "pSelect", "=", "pSelect", ";", "sqlite3WalkExpr", "(", "&", "sWalker", ",", "pExpr", ")", ";", "}", "#", "else", "#", "define", "resolveRemoveWindows", "(", "x", ",", "y", ")", "#", "endif", "/", "*", "Since", "this", "expresion", "is", "being", "changed", "into", "a", "reference", "*", "*", "to", "an", "identical", "expression", "in", "the", "result", "set", ",", "remove", "all", "Window", "*", "*", "objects", "belonging", "to", "the", "expression", "from", "the", "Select", ".", "pWin", "list", ".", "*", "/", "resolveRemoveWindows", "(", "pSelect", ",", "pE", ")", ";", "#", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "do_execsql_test", "17", ".", "0", "{", "CREATE", "TABLE", "t8", "(", "a", ")", ";", "INSERT", "INTO", "t8", "VALUES", "(", "1", ")", ",", "(", "2", ")", ",", "(", "3", ")", ";", "}", "do_execsql_test", "17", ".", "1", "{", "SELECT", "+", "sum", "(", "0", ")", "OVER", "(", ")", "ORDER", "BY", "+", "sum", "(", "0", ")", "OVER", "(", ");", "}", "{", "0", "}", "do_execsql_test", "17", ".", "2", "{", "select", "+", "sum", "(", "a", ")", "OVER", "(", ")", "FROM", "t8", "ORDER", "BY", "+", "sum", "(", "a", ")", "OVER", "(", ")", "DESC", ";", "}", "{", "6", "6", "6", "}", "do_execsql_test", "17", ".", "3", "{", "SELECT", "10", "+", "sum", "(", "a", ")", "OVER", "(", "ORDER", "BY", "a", ")", "FROM", "t8", "ORDER", "BY", "10", "+", "sum", "(", "a", ")", "OVER", "(", "ORDER", "BY", "a", ")", "DESC", ";", "}", "{", "16", "13", "11", "}</s>#", "ifndef", "SQLITE_OMIT_WINDOWFUNC", "if", "(", "ExprHasProperty", "(", "pE", ",", "EP_WinFunc", ")", ")", "{", "/", "*", "Since", "this", "window", "function", "is", "being", "changed", "into", "a", "reference", "*", "*", "to", "the", "same", "window", "function", "the", "result", "set", ",", "remove", "the", "instance", "*", "*", "of", "this", "window", "function", "from", "the", "Select", ".", "pWin", "list", ".", "*", "/", "Window", "*", "*", "pp", ";", "for", "(", "pp", "=", "&", "pSelect", "-", ">", "pWin", ";", "*", "pp", ";", "pp", "=", "&(", "*", "pp", ")", "->", "pNextWin", ")", "{", "if", "(", "*", "pp", "=", "=", "pE", "-", ">", "y", ".", "pWin", ")", "{", "*", "pp", "=", "(", "*", "pp", ")", "->", "pNextWin", ";", "}", "}", "}", "#", "endif"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["f2fs:", "fix", "to", "do", "sanity", "check", "with", "extra_attr", "feature", "If", "FI_EXTRA_ATTR", "is", "set", "in", "inode", "by", "fuzzing,", "inode.i_addr[0]", "will", "be", "parsed", "as", "inode.i_extra_isize,", "then", "in", "__recover_inline_status,", "inline", "data", "address", "will", "beyond", "boundary", "of", "page,", "result", "in", "accessing", "invalid", "memory.", "So", "in", "this", "condition,", "during", "reading", "inode", "page,", "let's", "do", "sanity", "check", "with", "EXTRA_ATTR", "feature", "of", "fs", "and", "extra_attr", "bit", "of", "inode,", "if", "they're", "inconsistent,", "deny", "to", "load", "this", "inode.", "-", "Overview", "Out-of-bound", "access", "in", "f2fs_iget()", "when", "mounting", "a", "corrupted", "f2fs", "image", "-", "Reproduce", "The", "following", "message", "will", "be", "got", "in", "KASAN", "build", "of", "4.18", "upstream", "kernel.", "[", "819.392227]", "==================================================================", "[", "819.393901]", "BUG:", "KASAN:", "slab-out-of-bounds", "in", "f2fs_iget+0x736/0x1530", "[", "819.395329]", "Read", "of", "size", "4", "at", "addr", "ffff8801f099c968", "by", "task", "mount/1292", "[", "819.397079]", "CPU:", "1", "PID:", "1292", "Comm:", "mount", "Not", "tainted", "4.18.0-rc1+", "#4", "[", "819.397082]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "819.397088]", "Call", "Trace:", "[", "819.397124]", "dump_stack+0x7b/0xb5", "[", "819.397154]", "print_address_description+0x70/0x290", "[", "819.397159]", "kasan_report+0x291/0x390", "[", "819.397163]", "?", "f2fs_iget+0x736/0x1530", "[", "819.397176]", "check_memory_region+0x139/0x190", "[", "819.397182]", "__asan_loadN+0xf/0x20", "[", "819.397185]", "f2fs_iget+0x736/0x1530", "[", "819.397197]", "f2fs_fill_super+0x1b4f/0x2b40", "[", "819.397202]", "?", "f2fs_fill_super+0x1b4f/0x2b40", "[", "819.397208]", "?", "f2fs_commit_super+0x1b0/0x1b0", "[", "819.397227]", "?", "set_blocksize+0x90/0x140", "[", "819.397241]", "mount_bdev+0x1c5/0x210", "[", "819.397245]", "?", "f2fs_commit_super+0x1b0/0x1b0", "[", "819.397252]", "f2fs_mount+0x15/0x20", "[", "819.397256]", "mount_fs+0x60/0x1a0", "[", "819.397267]", "?", "alloc_vfsmnt+0x309/0x360", "[", "819.397272]", "vfs_kern_mount+0x6b/0x1a0", "[", "819.397282]", "do_mount+0x34a/0x18c0", "[", "819.397300]", "?", "lockref_put_or_lock+0xcf/0x160", "[", "819.397306]", "?", "copy_mount_string+0x20/0x20", "[", "819.397318]", "?", "memcg_kmem_put_cache+0x1b/0xa0", "[", "819.397324]", "?", "kasan_check_write+0x14/0x20", "[", "819.397334]", "?", "_copy_from_user+0x6a/0x90", "[", "819.397353]", "?", "memdup_user+0x42/0x60", "[", "819.397359]", "ksys_mount+0x83/0xd0", "[", "819.397365]", "__x64_sys_mount+0x67/0x80", "[", "819.397388]", "do_syscall_64+0x78/0x170", "[", "819.397403]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "819.397422]", "RIP:", "0033:0x7f54c667cb9a", "[", "819.397424]", "Code:", "48", "8b", "0d", "01", "c3", "2b", "00", "f7", "d8", "64", "89", "01", "48", "83", "c8", "ff", "c3", "66", "2e", "0f", "1f", "84", "00", "00", "00", "00", "00", "0f", "1f", "44", "00", "00", "49", "89", "ca", "b8", "a5", "00", "00", "00", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "ce", "c2", "2b", "00", "f7", "d8", "64", "89", "01", "48", "[", "819.397483]", "RSP:", "002b:00007ffd8f46cd08", "EFLAGS:", "00000202", "ORIG_RAX:", "00000000000000a5", "[", "819.397496]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000dfa030", "RCX:", "00007f54c667cb9a", "[", "819.397498]", "RDX:", "0000000000dfa210", "RSI:", "0000000000dfbf30", "RDI:", "0000000000e02ec0", "[", "819.397501]", "RBP:", "0000000000000000", "R08:", "0000000000000000", "R09:", "0000000000000013", "[", "819.397503]", "R10:", "00000000c0ed0000", "R11:", "0000000000000202", "R12:", "0000000000e02ec0", "[", "819.397505]", "R13:", "0000000000dfa210", "R14:", "0000000000000000", "R15:", "0000000000000003", "[", "819.397866]", "Allocated", "by", "task", "139:", "[", "819.398702]", "save_stack+0x46/0xd0", "[", "819.398705]", "kasan_kmalloc+0xad/0xe0", "[", "819.398709]", "kasan_slab_alloc+0x11/0x20", "[", "819.398713]", "kmem_cache_alloc+0xd1/0x1e0", "[", "819.398717]", "dup_fd+0x50/0x4c0", "[", "819.398740]", "copy_process.part.37+0xbed/0x32e0", "[", "819.398744]", "_do_fork+0x16e/0x590", "[", "819.398748]", "__x64_sys_clone+0x69/0x80", "[", "819.398752]", "do_syscall_64+0x78/0x170", "[", "819.398756]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "819.399097]", "Freed", "by", "task", "159:", "[", "819.399743]", "save_stack+0x46/0xd0", "[", "819.399747]", "__kasan_slab_free+0x13c/0x1a0", "[", "819.399750]", "kasan_slab_free+0xe/0x10", "[", "819.399754]", "kmem_cache_free+0x89/0x1e0", "[", "819.399757]", "put_files_struct+0x132/0x150", "[", "819.399761]", "exit_files+0x62/0x70", "[", "819.399766]", "do_exit+0x47b/0x1390", "[", "819.399770]", "do_group_exit+0x86/0x130", "[", "819.399774]", "__x64_sys_exit_group+0x2c/0x30", "[", "819.399778]", "do_syscall_64+0x78/0x170", "[", "819.399782]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "819.400115]", "The", "buggy", "address", "belongs", "to", "the", "object", "at", "ffff8801f099c680", "which", "belongs", "to", "the", "cache", "files_cache", "of", "size", "704", "[", "819.403234]", "The", "buggy", "address", "is", "located", "40", "bytes", "to", "the", "right", "of", "704-byte", "region", "[ffff8801f099c680,", "ffff8801f099c940)", "[", "819.405689]", "The", "buggy", "address", "belongs", "to", "the", "page:", "[", "819.406709]", "page:ffffea0007c26700", "count:1", "mapcount:0", "mapping:ffff8801f69a3340", "index:0xffff8801f099d380", "compound_mapcount:", "0", "[", "819.408984]", "flags:", "0x2ffff0000008100(slab|head)", "[", "819.409932]", "raw:", "02ffff0000008100", "ffffea00077fb600", "0000000200000002", "ffff8801f69a3340", "[", "819.411514]", "raw:", "ffff8801f099d380", "0000000080130000", "00000001ffffffff", "0000000000000000", "[", "819.413073]", "page", "dumped", "because:", "kasan:", "bad", "access", "detected", "[", "819.414539]", "Memory", "state", "around", "the", "buggy", "address:", "[", "819.415521]", "ffff8801f099c800:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "819.416981]", "ffff8801f099c880:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "819.418454]", ">ffff8801f099c900:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[", "819.419921]", "^", "[", "819.421265]", "ffff8801f099c980:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "819.422745]", "ffff8801f099ca00:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "819.424206]", "==================================================================", "[", "819.425668]", "Disabling", "lock", "debugging", "due", "to", "kernel", "taint", "[", "819.457463]", "F2FS-fs", "(loop0):", "Mounted", "with", "checkpoint", "version", "=", "3", "The", "kernel", "still", "mounts", "the", "image.", "If", "you", "run", "the", "following", "program", "on", "the", "mounted", "folder", "mnt,", "(poc.c)", "static", "void", "activity(char", "*mpoint)", "{", "char", "*foo_bar_baz;", "int", "err;", "static", "int", "buf[8192];", "memset(buf,", "0,", "sizeof(buf));", "err", "=", "asprintf(&foo_bar_baz,", "\"%s/foo/bar/baz\",", "mpoint);", "int", "fd", "=", "open(foo_bar_baz,", "O_RDONLY,", "0);", "if", "(fd", ">=", "0)", "{", "read(fd,", "(char", "*)buf,", "11);", "close(fd);", "}", "}", "int", "main(int", "argc,", "char", "*argv[])", "{", "activity(argv[1]);", "return", "0;", "}", "You", "can", "get", "kernel", "crash:", "[", "819.457463]", "F2FS-fs", "(loop0):", "Mounted", "with", "checkpoint", "version", "=", "3", "[", "918.028501]", "BUG:", "unable", "to", "handle", "kernel", "paging", "request", "at", "ffffed0048000d82", "[", "918.044020]", "PGD", "23ffee067", "P4D", "23ffee067", "PUD", "23fbef067", "PMD", "0", "[", "918.045207]", "Oops:", "0000", "[#1]", "SMP", "KASAN", "PTI", "[", "918.046048]", "CPU:", "0", "PID:", "1309", "Comm:", "poc", "Tainted:", "G", "B", "4.18.0-rc1+", "#4", "[", "918.047573]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "918.049552]", "RIP:", "0010:check_memory_region+0x5e/0x190", "[", "918.050565]", "Code:", "f8", "49", "c1", "e8", "03", "49", "89", "db", "49", "c1", "eb", "03", "4d", "01", "cb", "4d", "01", "c1", "4d", "8d", "63", "01", "4c", "89", "c8", "4d", "89", "e2", "4d", "29", "ca", "49", "83", "fa", "10", "7f", "3d", "4d", "85", "d2", "74", "32", "<41>", "80", "39", "00", "75", "23", "48", "b8", "01", "00", "00", "00", "00", "fc", "ff", "df", "4d", "01", "d1", "49", "01", "c0", "[", "918.054322]", "RSP:", "0018:ffff8801e3a1f258", "EFLAGS:", "00010202", "[", "918.055400]", "RAX:", "ffffed0048000d82", "RBX:", "ffff880240006c11", "RCX:", "ffffffffb8867d14", "[", "918.056832]", "RDX:", "0000000000000000", "RSI:", "0000000000000002", "RDI:", "ffff880240006c10", "[", "918.058253]", "RBP:", "ffff8801e3a1f268", "R08:", "1ffff10048000d82", "R09:", "ffffed0048000d82", "[", "918.059717]", "R10:", "0000000000000001", "R11:", "ffffed0048000d82", "R12:", "ffffed0048000d83", "[", "918.061159]", "R13:", "ffff8801e3a1f390", "R14:", "0000000000000000", "R15:", "ffff880240006c08", "[", "918.062614]", "FS:", "00007fac9732c700(0000)", "GS:ffff8801f6e00000(0000)", "knlGS:0000000000000000", "[", "918.064246]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "918.065412]", "CR2:", "ffffed0048000d82", "CR3:", "00000001df77a000", "CR4:", "00000000000006f0", "[", "918.066882]", "Call", "Trace:", "[", "918.067410]", "__asan_loadN+0xf/0x20", "[", "918.068149]", "f2fs_find_target_dentry+0xf4/0x270", "[", "918.069083]", "?", "__get_node_page+0x331/0x5b0", "[", "918.069925]", "f2fs_find_in_inline_dir+0x24b/0x310", "[", "918.070881]", "?", "f2fs_recover_inline_data+0x4c0/0x4c0", "[", "918.071905]", "?", "unwind_next_frame.part.5+0x34f/0x490", "[", "918.072901]", "?", "unwind_dump+0x290/0x290", "[", "918.073695]", "?", "is_bpf_text_address+0xe/0x20", "[", "918.074566]", "__f2fs_find_entry+0x599/0x670", "[", "918.075408]", "?", "kasan_unpoison_shadow+0x36/0x50", "[", "918.076315]", "?", "kasan_kmalloc+0xad/0xe0", "[", "918.077100]", "?", "memcg_kmem_put_cache+0x55/0xa0", "[", "918.077998]", "?", "f2fs_find_target_dentry+0x270/0x270", "[", "918.079006]", "?", "d_set_d_op+0x30/0x100", "[", "918.079749]", "?", "__d_lookup_rcu+0x69/0x2e0", "[", "918.080556]", "?", "__d_alloc+0x275/0x450", "[", "918.081297]", "?", "kasan_check_write+0x14/0x20", "[", "918.082135]", "?", "memset+0x31/0x40", "[", "918.082820]", "?", "fscrypt_setup_filename+0x1ec/0x4c0", "[", "918.083782]", "?", "d_alloc_parallel+0x5bb/0x8c0", "[", "918.084640]", "f2fs_find_entry+0xe9/0x110", "[", "918.085432]", "?", "__f2fs_find_entry+0x670/0x670", "[", "918.086308]", "?", "kasan_check_write+0x14/0x20", "[", "918.087163]", "f2fs_lookup+0x297/0x590", "[", "918.087902]", "?", "f2fs_link+0x2b0/0x2b0", "[", "918.088646]", "?", "legitimize_path.isra.29+0x61/0xa0", "[", "918.089589]", "__lookup_slow+0x12e/0x240", "[", "918.090371]", "?", "may_delete+0x2b0/0x2b0", "[", "918.091123]", "?", "__nd_alloc_stack+0xa0/0xa0", "[", "918.091944]", "lookup_slow+0x44/0x60", "[", "918.092642]", "walk_component+0x3ee/0xa40", "[", "918.093428]", "?", "is_bpf_text_address+0xe/0x20", "[", "918.094283]", "?", "pick_link+0x3e0/0x3e0", "[", "918.095047]", "?", "in_group_p+0xa5/0xe0", "[", "918.095771]", "?", "generic_permission+0x53/0x1e0", "[", "918.096666]", "?", "security_inode_permission+0x1d/0x70", "[", "918.097646]", "?", "inode_permission+0x7a/0x1f0", "[", "918.098497]", "link_path_walk+0x2a2/0x7b0", "[", "918.099298]", "?", "apparmor_capget+0x3d0/0x3d0", "[", "918.100140]", "?", "walk_component+0xa40/0xa40", "[", "918.100958]", "?", "path_init+0x2e6/0x580", "[", "918.101695]", "path_openat+0x1bb/0x2160", "[", "918.102471]", "?", "__save_stack_trace+0x92/0x100", "[", "918.103352]", "?", "save_stack+0xb5/0xd0", "[", "918.104070]", "?", "vfs_unlink+0x250/0x250", "[", "918.104822]", "?", "save_stack+0x46/0xd0", "[", "918.105538]", "?", "kasan_slab_alloc+0x11/0x20", "[", "918.106370]", "?", "kmem_cache_alloc+0xd1/0x1e0", "[", "918.107213]", "?", "getname_flags+0x76/0x2c0", "[", "918.107997]", "?", "getname+0x12/0x20", "[", "918.108677]", "?", "do_sys_open+0x14b/0x2c0", "[", "918.109450]", "?", "__x64_sys_open+0x4c/0x60", "[", "918.110255]", "?", "do_syscall_64+0x78/0x170", "[", "918.111083]", "?", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "918.112148]", "?", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "918.113204]", "?", "f2fs_empty_inline_dir+0x1e0/0x1e0", "[", "918.114150]", "?", "timespec64_trunc+0x5c/0x90", "[", "918.114993]", "?", "wb_io_lists_depopulated+0x1a/0xc0", "[", "918.115937]", "?", "inode_io_list_move_locked+0x102/0x110", "[", "918.116949]", "do_filp_open+0x12b/0x1d0", "[", "918.117709]", "?", "may_open_dev+0x50/0x50", "[", "918.118475]", "?", "kasan_kmalloc+0xad/0xe0", "[", "918.119246]", "do_sys_open+0x17c/0x2c0", "[", "918.119983]", "?", "do_sys_open+0x17c/0x2c0", "[", "918.120751]", "?", "filp_open+0x60/0x60", "[", "918.121463]", "?", "task_work_run+0x4d/0xf0", "[", "918.122237]", "__x64_sys_open+0x4c/0x60", "[", "918.123001]", "do_syscall_64+0x78/0x170", "[", "918.123759]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "918.124802]", "RIP:", "0033:0x7fac96e3e040", "[", "918.125537]", "Code:", "00", "f7", "d8", "64", "89", "01", "48", "83", "c8", "ff", "c3", "66", "2e", "0f", "1f", "84", "00", "00", "00", "00", "00", "0f", "1f", "44", "00", "00", "83", "3d", "09", "27", "2d", "00", "00", "75", "10", "b8", "02", "00", "00", "00", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "31", "c3", "48", "83", "ec", "08", "e8", "7e", "e0", "01", "00", "48", "89", "04", "24", "[", "918.129341]", "RSP:", "002b:00007fff1b37f848", "EFLAGS:", "00000246", "ORIG_RAX:", "0000000000000002", "[", "918.130870]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000000000", "RCX:", "00007fac96e3e040", "[", "918.132295]", "RDX:", "0000000000000000", "RSI:", "0000000000000000", "RDI:", "000000000122d080", "[", "918.133748]", "RBP:", "00007fff1b37f9b0", "R08:", "00007fac9710bbd8", "R09:", "0000000000000001", "[", "918.135209]", "R10:", "000000000000069d", "R11:", "0000000000000246", "R12:", "0000000000400c20", "[", "918.136650]", "R13:", "00007fff1b37fab0", "R14:", "0000000000000000", "R15:", "0000000000000000", "[", "918.138093]", "Modules", "linked", "in:", "snd_hda_codec_generic", "snd_hda_intel", "snd_hda_codec", "snd_hwdep", "snd_hda_core", "snd_pcm", "snd_timer", "snd", "mac_hid", "i2c_piix4", "soundcore", "ib_iser", "rdma_cm", "iw_cm", "ib_cm", "ib_core", "iscsi_tcp", "libiscsi_tcp", "libiscsi", "scsi_transport_iscsi", "raid10", "raid456", "async_raid6_recov", "async_memcpy", "async_pq", "async_xor", "async_tx", "raid1", "raid0", "multipath", "linear", "8139too", "crct10dif_pclmul", "crc32_pclmul", "qxl", "drm_kms_helper", "syscopyarea", "aesni_intel", "sysfillrect", "sysimgblt", "fb_sys_fops", "ttm", "drm", "aes_x86_64", "crypto_simd", "cryptd", "8139cp", "glue_helper", "mii", "pata_acpi", "floppy", "[", "918.147924]", "CR2:", "ffffed0048000d82", "[", "918.148619]", "---[", "end", "trace", "4ce02f25ff7d3df5", "]---", "[", "918.149563]", "RIP:", "0010:check_memory_region+0x5e/0x190", "[", "918.150576]", "Code:", "f8", "49", "c1", "e8", "03", "49", "89", "db", "49", "c1", "eb", "03", "4d", "01", "cb", "4d", "01", "c1", "4d", "8d", "63", "01", "4c", "89", "c8", "4d", "89", "e2", "4d", "29", "ca", "49", "83", "fa", "10", "7f", "3d", "4d", "85", "d2", "74", "32", "<41>", "80", "39", "00", "75", "23", "48", "b8", "01", "00", "00", "00", "00", "fc", "ff", "df", "4d", "01", "d1", "49", "01", "c0", "[", "918.154360]", "RSP:", "0018:ffff8801e3a1f258", "EFLAGS:", "00010202", "[", "918.155411]", "RAX:", "ffffed0048000d82", "RBX:", "ffff880240006c11", "RCX:", "ffffffffb8867d14", "[", "918.156833]", "RDX:", "0000000000000000", "RSI:", "0000000000000002", "RDI:", "ffff880240006c10", "[", "918.158257]", "RBP:", "ffff8801e3a1f268", "R08:", "1ffff10048000d82", "R09:", "ffffed0048000d82", "[", "918.159722]", "R10:", "0000000000000001", "R11:", "ffffed0048000d82", "R12:", "ffffed0048000d83", "[", "918.161149]", "R13:", "ffff8801e3a1f390", "R14:", "0000000000000000", "R15:", "ffff880240006c08", "[", "918.162587]", "FS:", "00007fac9732c700(0000)", "GS:ffff8801f6e00000(0000)", "knlGS:0000000000000000", "[", "918.164203]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "918.165356]", "CR2:", "ffffed0048000d82", "CR3:", "00000001df77a000", "CR4:", "00000000000006f0", "Reported-by:", "Wen", "Xu", "<wen.xu@gatech.edu>", "Signed-off-by:", "Chao", "Yu", "<yuchao0@huawei.com>", "Signed-off-by:", "Jaegeuk", "Kim", "<jaegeuk@kernel.org>"], "code_tokens": ["if", "(", "f2fs_has_extra_attr", "(", "inode", ")", "&", "&", "!", "f2fs_sb_has_extra_attr", "(", "sbi", "-", ">", "sb", ")", ")", "{", "set_sbi_flag", "(", "sbi", ",", "SBI_NEED_FSCK", ")", ";", "f2fs_msg", "(", "sbi", "-", ">", "sb", ",", "KERN_WARNING", ",", "\"", "%", "s", ":", "inode", "(", "ino", "=", "%", "lx", ")", "is", "with", "extra_attr", ",", "\"", "\"", "but", "extra_attr", "feature", "is", "off", "\"", ",", "__func__", ",", "inode", "-", ">", "i_ino", ")", ";", "return", "false", ";", "}", "if", "(", "!", "sanity_check_inode", "(", "inode", ")", ")", "{", "f2fs_put_page", "(", "node_page", ",", "1", ")", ";", "return", "-", "EINVAL", ";", "}</s>if", "(", "!", "sanity_check_inode", "(", "inode", ")", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "bad_inode", ";", "}"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["batman-adv:", "Only", "write", "requested", "number", "of", "byte", "to", "user", "buffer", "Don't", "write", "more", "than", "the", "requested", "number", "of", "bytes", "of", "an", "batman-adv", "icmp", "packet", "to", "the", "userspace", "buffer.", "Otherwise", "unrelated", "userspace", "memory", "might", "get", "overridden", "by", "the", "kernel.", "Signed-off-by:", "Sven", "Eckelmann", "<sven@narfation.org>", "Signed-off-by:", "Marek", "Lindner", "<lindner_marek@yahoo.de>"], "code_tokens": ["packet_len", "=", "min", "(", "count", ",", "socket_packet", "-", ">", "icmp_len", ")", ";", "error", "=", "copy_to_user", "(", "buf", ",", "&", "socket_packet", "-", ">", "icmp_packet", ",", "packet_len", ")", ";</s>error", "=", "copy_to_user", "(", "buf", ",", "&", "socket_packet", "-", ">", "icmp_packet", ",", "socket_packet", "-", ">", "icmp_len", ")", ";", "packet_len", "=", "socket_packet", "-", ">", "icmp_len", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["Escape", "<!--,", "-->", "and", "<script", "(#20)", "In", "HTML", "script", "elements,", "`</script`", "is", "not", "the", "only", "substring", "that", "switches", "the", "HTML", "parser", "state", "even", "when", "contained", "in", "a", "JS", "string", "literal.", "This", "commit", "adds", "escaping", "for", "`<!--`,", "`-->`", "and", "`<script`,", "which", "appear", "to", "be", "all", "substrings", "that", "cause", "state", "transitions", "which", "are", "not", "reset", "by", "the", "`\"`", "closing", "the", "string", "literal."], "code_tokens": ["*", "The", "output", "will", "not", "contain", "the", "substrings", "(", "case", "-", "insensitively", ")", "`", "\"<", "script", "\"", "`,", "`", "\"<", "/", "script", "\"", "`", "and", "`", "<!", "--", "`", "and", "can", "thus", "be", "embedded", "inside", "an", "HTML", "script", "element", "without", "further", "encoding", ".", "*", "The", "output", "will", "not", "contain", "the", "substring", "`", "\"]", "]>", "\"`", "and", "can", "thus", "be", "embedded", "inside", "an", "XML", "CDATA", "section", "without", "further", "encoding", ".", "/", "/", "Embedding", ".", "Disallow", "<", "script", ",", "<", "/", "script", ",", "<", "!-", "-,", "-", "->", "and", "]", "]>", "in", "string", "/", "/", "literals", "so", "that", "the", "output", "can", "be", "embedded", "in", "HTML", "script", "elements", "/", "/", "and", "in", "XML", "CDATA", "sections", "without", "affecting", "the", "parser", "state", ".", "/", "/", "References", ":", "/", "/", "https", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "html53", "/", "semantics", "-", "scripting", ".", "html", "#", "restrictions", "-", "for", "-", "contents", "-", "of", "-", "script", "-", "elements", "/", "/", "https", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "html53", "/", "syntax", ".", "html", "#", "script", "-", "data", "-", "escaped", "-", "state", "/", "/", "https", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "html53", "/", "syntax", ".", "html", "#", "script", "-", "data", "-", "double", "-", "escaped", "-", "state", "/", "/", "https", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "xml", "/", "#", "sec", "-", "cdata", "-", "sect", "case", "'", "<'", ":", "/", "/", "Disallow", "<", "!-", "-,", "which", "lets", "the", "HTML", "parser", "switch", "into", "the", "\"", "script", "/", "/", "data", "escaped", "\"", "state", ".", "/", "/", "Disallow", "<", "script", ",", "which", "followed", "by", "various", "characters", "lets", "the", "/", "/", "HTML", "parser", "switch", "into", "or", "out", "of", "the", "\"", "script", "data", "double", "escaped", "\"", "/", "/", "state", ".", "/", "/", "Disallow", "<", "/", "script", ",", "which", "ends", "a", "script", "block", ".", "if", "(", "i", "+", "3", ">", "=", "end", ")", "break", ";", "char", "c1", "=", "jsonish", ".", "charAt", "(", "i", "+", "1", ")", ";", "char", "c2", "=", "jsonish", ".", "charAt", "(", "i", "+", "2", ")", ";", "char", "c3", "=", "jsonish", ".", "charAt", "(", "i", "+", "3", ")", ";", "char", "lc1", "=", "(", "char", ")", "(", "c1", "|", "32", ")", ";", "char", "lc2", "=", "(", "char", ")", "(", "c2", "|", "32", ")", ";", "char", "lc3", "=", "(", "char", ")", "(", "c3", "|", "32", ")", ";", "if", "(", "(", "c1", "=", "=", "'", "!'", "&", "&", "c2", "=", "=", "'", "-'", "&", "&", "c3", "=", "=", "'", "-'", ")", "|", "|", "(", "lc1", "=", "=", "'", "s", "'", "&", "&", "lc2", "=", "=", "'", "c", "'", "&", "&", "lc3", "=", "=", "'", "r", "'", ")", "|", "|", "(", "c1", "=", "=", "'", "/'", "&", "&", "lc2", "=", "=", "'", "s", "'", "&", "&", "lc3", "=", "=", "'", "c", "'", "))", "{", "replace", "(", "i", ",", "i", "+", "1", ",", "\"", "\\\\", "u003c", "\"", ");", "/", "/", "Escaped", "<", "}", "break", ";", "case", "'", ">'", ":", "/", "/", "Disallow", "-", "->", ",", "which", "lets", "the", "HTML", "parser", "switch", "out", "of", "the", "\"", "script", "/", "/", "data", "escaped", "\"", "or", "\"", "script", "data", "double", "escaped", "\"", "state", ".", "if", "(", "(", "i", "-", "2", ")", ">", "=", "start", "&", "&", "'", "-'", "=", "=", "jsonish", ".", "charAt", "(", "i", "-", "2", ")", "&", "&", "'", "-'", "=", "=", "jsonish", ".", "charAt", "(", "i", "-", "1", ")", ")", "{", "replace", "(", "i", ",", "i", "+", "1", ",", "\"", "\\\\", "u003e", "\"", ");", "/", "/", "Escaped", ">", "\"", "\\\"", "\\\\", "u003cscript", ">", "foo", "(", ")\\", "\\", "u003c", "/", "script", ">", "\\\"", "\",", "\"", "\\\"", "<", "script", ">", "foo", "(", ")<", "/", "script", ">", "\\\"", "\")", ";", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003c", "/", "SCRIPT", "\\", "\\", "n", ">", "\\\"", "\",", "\"", "\\\"", "</", "SCRIPT", "\\", "n", ">", "\\\"", "\")", ";", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003c", "/", "ScRIpT", "\\", "\"\"", ",", "\"", "\\\"", "</", "ScRIpT", "\\", "\"\"", ");", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003c", "/", "ScR", "\\", "u0130pT", "\\", "\"\"", ",", "\"", "\\\"", "</", "ScR", "\\", "u0130pT", "\\", "\"\"", ");", "@", "Test", "public", "static", "final", "void", "testHtmlParserStateChanges", "(", ")", "{", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003cscript", "\\", "\"\"", ",", "\"", "\\\"", "<", "script", "\\", "\"\"", ");", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003cScript", "\\", "\"\"", ",", "\"", "\\\"", "<", "Script", "\\", "\"\"", ");", "/", "/", "\\", "u0130", "is", "a", "Turkish", "dotted", "upper", "-", "case", "'", "I", "'", "so", "the", "lower", "case", "version", "of", "/", "/", "the", "tag", "name", "is", "\"", "script", "\"", ".", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003cScR", "\\", "u0130pT", "\\", "\"\"", ",", "\"", "\\\"", "<", "ScR", "\\", "u0130pT", "\\", "\"\"", ");", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003cSCRIPT", "\\", "\\", "n", ">", "\\\"", "\",", "\"", "\\\"", "<", "SCRIPT", "\\", "n", ">", "\\\"", "\")", ";", "assertSanitized", "(", "\"\\", "\"", "script", "\\", "\"\"", ",", "\"", "<", "script", "\"", ");", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003c", "!", "--", "\\\"", "\",", "\"", "\\\"", "<!", "--", "\\\"", "\")", ";", "assertSanitized", "(", "\"-", "0", "\"", ",", "\"", "<!", "--", "\")", ";", "assertSanitized", "(", "\"\\", "\"-", "-\\", "\\", "u003e", "\\", "\"\"", ",", "\"", "\\\"", "--", ">\\", "\"\"", ");", "assertSanitized", "(", "\"-", "0", "\"", ",", "\"", "--", ">\"", ");", "assertSanitized", "(", "\"\\", "\"\\", "\\", "u003c", "!", "--", "\\\\", "u003cscript", ">", "\\\"", "\",", "\"", "\\\"", "<!", "--", "<", "script", ">", "\\\"", "\")", ";", "}</s>*", "The", "output", "will", "not", "contain", "the", "substring", "(", "case", "-", "insensitively", ")", "`", "\"<", "/", "script", "\"", "`", "so", "can", "be", "embedded", "inside", "an", "HTML", "script", "element", "without", "further", "encoding", ".", "*", "The", "output", "will", "not", "contain", "the", "substring", "`", "\"]", "]>", "\"`", "so", "can", "be", "embedded", "inside", "an", "XML", "CDATA", "section", "without", "further", "encoding", ".", "/", "/", "Embedding", ".", "Disallow", "<", "/", "script", "and", "]", "]>", "in", "string", "literals", "so", "that", "/", "/", "the", "output", "can", "be", "embedded", "in", "HTML", "script", "elements", "and", "in", "XML", "CDATA", "/", "/", "sections", ".", "case", "'", "/'", ":", "/", "/", "Don", "'", "t", "over", "escape", ".", "Many", "JSON", "bodies", "contain", "innocuous", "HTML", "/", "/", "that", "can", "be", "safely", "embedded", ".", "if", "(", "i", ">", "start", "&", "&", "i", "+", "2", "<", "end", "&", "&", "'", "<'", "=", "=", "jsonish", ".", "charAt", "(", "i", "-", "1", ")", "&", "&", "'", "s", "'", "=", "=", "(", "jsonish", ".", "charAt", "(", "i", "+", "1", ")", "|", "32", ")", "&", "&", "'", "c", "'", "=", "=", "(", "jsonish", ".", "charAt", "(", "i", "+", "2", ")", "|", "32", ")", ")", "{", "insert", "(", "i", ",", "'", "\\\\", "')", ";", "\"", "\\\"", "<", "script", ">", "foo", "(", ")<", "\\\\", "/", "script", ">", "\\\"", "\",", "\"", "\\\"", "<", "script", ">", "foo", "(", ")<", "/", "script", ">", "\\\"", "\")", ";", "assertSanitized", "(", "\"", "\\\"", "<", "script", ">", "foo", "(", ")<", "\\\\", "/", "script", ">", "\\\"", "\",", "\"", "\\\"", "<", "script", ">", "foo", "(", ")<", "/", "script", ">", "\\\"", "\")", ";", "assertSanitized", "(", "\"\\", "\"<", "\\\\", "/", "SCRIPT", "\\", "\\", "n", ">", "\\\"", "\",", "\"", "\\\"", "</", "SCRIPT", "\\", "n", ">", "\\\"", "\")", ";", "assertSanitized", "(", "\"\\", "\"<", "\\\\", "/", "ScRIpT", "\\", "\"\"", ",", "\"", "\\\"", "</", "ScRIpT", "\\", "\"\"", ");", "assertSanitized", "(", "\"\\", "\"<", "\\\\", "/", "ScR", "\\", "u0130pT", "\\", "\"\"", ",", "\"", "\\\"", "</", "ScR", "\\", "u0130pT", "\\", "\"\"", ");"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["KEYS:", "encrypted:", "fix", "buffer", "overread", "in", "valid_master_desc()", "With", "the", "'encrypted'", "key", "type", "it", "was", "possible", "for", "userspace", "to", "provide", "a", "data", "blob", "ending", "with", "a", "master", "key", "description", "shorter", "than", "expected,", "e.g.", "'keyctl", "add", "encrypted", "desc", "\"new", "x\"", "@s'.", "When", "validating", "such", "a", "master", "key", "description,", "validate_master_desc()", "could", "read", "beyond", "the", "end", "of", "the", "buffer.", "Fix", "this", "by", "using", "strncmp()", "instead", "of", "memcmp().", "[Also", "clean", "up", "the", "code", "to", "deduplicate", "some", "logic.]", "Cc:", "Mimi", "Zohar", "<zohar@linux.vnet.ibm.com>", "Signed-off-by:", "Eric", "Biggers", "<ebiggers@google.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "Signed-off-by:", "James", "Morris", "<james.l.morris@oracle.com>"], "code_tokens": ["int", "prefix_len", ";", "if", "(", "!", "strncmp", "(", "new_desc", ",", "KEY_TRUSTED_PREFIX", ",", "KEY_TRUSTED_PREFIX_LEN", ")", ")", "prefix_len", "=", "KEY_TRUSTED_PREFIX_LEN", ";", "else", "if", "(", "!", "strncmp", "(", "new_desc", ",", "KEY_USER_PREFIX", ",", "KEY_USER_PREFIX_LEN", ")", ")", "prefix_len", "=", "KEY_USER_PREFIX_LEN", ";", "else", "return", "-", "EINVAL", ";", "if", "(", "!", "new_desc", "[", "prefix_len", "]", ")", "return", "-", "EINVAL", ";", "if", "(", "orig_desc", "&", "&", "strncmp", "(", "new_desc", ",", "orig_desc", ",", "prefix_len", ")", ")", "return", "-", "EINVAL", ";</s>if", "(", "!", "memcmp", "(", "new_desc", ",", "KEY_TRUSTED_PREFIX", ",", "KEY_TRUSTED_PREFIX_LEN", ")", ")", "{", "if", "(", "strlen", "(", "new_desc", ")", "=", "=", "KEY_TRUSTED_PREFIX_LEN", ")", "goto", "out", ";", "if", "(", "orig_desc", ")", "if", "(", "memcmp", "(", "new_desc", ",", "orig_desc", ",", "KEY_TRUSTED_PREFIX_LEN", ")", ")", "goto", "out", ";", "}", "else", "if", "(", "!", "memcmp", "(", "new_desc", ",", "KEY_USER_PREFIX", ",", "KEY_USER_PREFIX_LEN", ")", ")", "{", "if", "(", "strlen", "(", "new_desc", ")", "=", "=", "KEY_USER_PREFIX_LEN", ")", "goto", "out", ";", "if", "(", "orig_desc", ")", "if", "(", "memcmp", "(", "new_desc", ",", "orig_desc", ",", "KEY_USER_PREFIX_LEN", ")", ")", "goto", "out", ";", "}", "else", "goto", "out", ";", "out", ":", "return", "-", "EINVAL", ";"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["KVM:", "Fix", "iommu", "map/unmap", "to", "handle", "memory", "slot", "moves", "The", "iommu", "integration", "into", "memory", "slots", "expects", "memory", "slots", "to", "be", "added", "or", "removed", "and", "doesn't", "handle", "the", "move", "case.", "We", "can", "unmap", "slots", "from", "the", "iommu", "after", "we", "mark", "them", "invalid", "and", "map", "them", "before", "installing", "the", "final", "memslot", "array.", "Also", "re-order", "the", "kmemdup", "vs", "map", "so", "we", "don't", "leave", "iommu", "mappings", "if", "we", "get", "ENOMEM.", "Reviewed-by:", "Gleb", "Natapov", "<gleb@redhat.com>", "Signed-off-by:", "Alex", "Williamson", "<alex.williamson@redhat.com>", "Signed-off-by:", "Marcelo", "Tosatti", "<mtosatti@redhat.com>"], "code_tokens": ["/", "*", "slot", "was", "deleted", "or", "moved", ",", "clear", "iommu", "mapping", "*", "/", "kvm_iommu_unmap_pages", "(", "kvm", ",", "&", "old", ")", ";", "/", "*", "map", "new", "memory", "slot", "into", "the", "iommu", "*", "/", "if", "(", "npages", ")", "{", "r", "=", "kvm_iommu_map_pages", "(", "kvm", ",", "&", "new", ")", ";", "if", "(", "r", ")", "goto", "out_slots", ";", "}", "out_slots", ":", "kfree", "(", "slots", ")", ";</s>/", "*", "map", "/", "unmap", "the", "pages", "in", "iommu", "page", "table", "*", "/", "if", "(", "npages", ")", "{", "r", "=", "kvm_iommu_map_pages", "(", "kvm", ",", "&", "new", ")", ";", "if", "(", "r", ")", "goto", "out_free", ";", "}", "else", "kvm_iommu_unmap_pages", "(", "kvm", ",", "&", "old", ")", ";"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["ethtool:", "Fix", "potential", "kernel", "buffer", "overflow", "in", "ETHTOOL_GRXCLSRLALL", "On", "a", "32-bit", "machine,", "info.rule_cnt", ">=", "0x40000000", "leads", "to", "integer", "overflow", "and", "the", "buffer", "may", "be", "smaller", "than", "needed.", "Since", "ETHTOOL_GRXCLSRLALL", "is", "unprivileged,", "this", "can", "presumably", "be", "used", "for", "at", "least", "denial", "of", "service.", "Signed-off-by:", "Ben", "Hutchings", "<bhutchings@solarflare.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "info", ".", "rule_cnt", "<", "=", "KMALLOC_MAX_SIZE", "/", "sizeof", "(", "u32", ")", ")", "rule_buf", "=", "kmalloc", "(", "info", ".", "rule_cnt", "*", "sizeof", "(", "u32", ")", ",", "GFP_USER", ")", ";</s>rule_buf", "=", "kmalloc", "(", "info", ".", "rule_cnt", "*", "sizeof", "(", "u32", ")", ",", "GFP_USER", ")", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["[NETLINK]:", "Missing", "padding", "fields", "in", "dumped", "structures", "Plug", "holes", "with", "padding", "fields", "and", "initialized", "them", "to", "zero.", "Signed-off-by:", "Patrick", "McHardy", "<kaber@trash.net>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["__u8", "pad", ";", "__u32", "DPs", ";", "__u32", "def_DP", ";", "__u8", "grio", ";", "__u8", "pad1", ";", "__u16", "pad2", ";", "__u16", "pad", ";", "__u8", "pad1", ";", "__u16", "pad2", ";", "unsigned", "char", "prefix_pad1", ";", "unsigned", "short", "prefix_pad2", ";", "unsigned", "char", "prefix_pad3", ";", "pmsg", "-", ">", "prefix_pad1", "=", "0", ";", "pmsg", "-", ">", "prefix_pad2", "=", "0", ";", "pmsg", "-", ">", "prefix_pad3", "=", "0", ";", "pinfo", ".", "pad", "=", "0", ";", "opt", ".", "pad", "=", "0", ";</s>__u32", "DPs", ";", "__u32", "def_DP", ";", "__u8", "grio", ";"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["DATAJPA-1519", "-", "Polishing.", "Moved", "the", "registration", "of", "the", "escape(\u2026)", "SpEL", "function", "into", "an", "EvaluationContextExtension", "to", "avoid", "the", "need", "for", "a", "dedicated", "static", "method", "on", "EscapeCharacter.", "Moved", "Escape", "Character", "in", "the", "\u2026.repository.query", "package", "to", "remove", "the", "package", "cycle."], "code_tokens": ["import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "JpaEvaluationContextExtension", ";", "private", "static", "final", "String", "ESCAPE_CHARACTER_PROPERTY", "=", "\"", "escapeCharacter", "\"", ";", "builder", ".", "addPropertyValue", "(", "ESCAPE_CHARACTER_PROPERTY", ",", "getEscapeCharacter", "(", "source", ")", ".", "orElse", "(", "'\\", "\\'", "))", ";", "*", "XML", "configurations", "do", "not", "support", "{", "@", "link", "Character", "}", "values", ".", "This", "method", "catches", "the", "exception", "thrown", "and", "returns", "an", "*", "{", "@", "link", "Optional", "#", "empty", "(", ")}", "instead", ".", "return", "source", ".", "getAttribute", "(", "ESCAPE_CHARACTER_PROPERTY", ",", "Character", ".", "class", ")", ";", "/", "/", "EvaluationContextExtension", "for", "JPA", "specific", "SpEL", "functions", "registerIfNotAlreadyRegistered", "(", "()", "-", ">", "{", "Object", "value", "=", "AnnotationRepositoryConfigurationSource", ".", "class", ".", "isInstance", "(", "config", ")", "/", "/", "?", "config", ".", "getRequiredAttribute", "(", "ESCAPE_CHARACTER_PROPERTY", ",", "Character", ".", "class", ")", "/", "/", ":", "config", ".", "getAttribute", "(", "ESCAPE_CHARACTER_PROPERTY", ")", ".", "orElse", "(", "\"\\", "\\\"", ");", "BeanDefinitionBuilder", "builder", "=", "BeanDefinitionBuilder", ".", "rootBeanDefinition", "(", "JpaEvaluationContextExtension", ".", "class", ")", ";", "builder", ".", "addConstructorArgValue", "(", "value", ")", ";", "return", "builder", ".", "getBeanDefinition", "(", ");", "}", ",", "registry", ",", "JpaEvaluationContextExtension", ".", "class", ".", "getName", "(", "),", "source", ")", ";", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "*", "A", "value", "type", "encapsulating", "an", "escape", "character", "for", "LIKE", "queries", "and", "the", "actually", "usage", "of", "it", "in", "escaping", "*", "{", "@", "link", "String", "}", "s", ".", "*", "@", "author", "Oliver", "Drotbohm", "private", "static", "final", "List", "<", "String", ">", "TO_REPLACE", "=", "Arrays", ".", "asList", "(", "\"", "_", "\"", ",", "\"", "%\"", ");", "/", "**", "*", "Escapes", "all", "special", "like", "characters", "(", "{@", "code", "_", "}", ",", "{", "@", "code", "%", "})", "using", "the", "configured", "escape", "character", ".", "*", "*", "@", "param", "value", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "/", "return", "TO_REPLACE", ".", "stream", "(", ")", "/", "/", ".", "reduce", "(", "value", ",", "(", "it", ",", "character", ")", "-", ">", "it", ".", "replace", "(", "character", ",", "this", ".", "value", "+", "character", ")", ");", "/", "*", "*", "Copyright", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "spel", ".", "spi", ".", "EvaluationContextExtension", ";", "/", "**", "*", "{", "@", "link", "EvaluationContextExtension", "}", "to", "register", "{", "@", "link", "EscapeCharacter", "}", "as", "root", "object", "to", "essentially", "expose", "an", "*", "{", "@", "code", "expose", "(", "\u2026)", "}", "function", "to", "SpEL", ".", "*", "*", "@", "author", "Oliver", "Drotbohm", "*", "/", "public", "class", "JpaEvaluationContextExtension", "implements", "EvaluationContextExtension", "{", "private", "final", "EscapeCharacter", "character", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaEvaluationContextExtension", "}", "for", "the", "given", "escape", "character", ".", "*", "*", "@", "param", "escapeCharacter", "the", "character", "to", "be", "used", "to", "escape", "parameters", "for", "LIKE", "expression", ".", "*", "/", "public", "JpaEvaluationContextExtension", "(", "char", "escapeCharacter", ")", "{", "this", ".", "character", "=", "EscapeCharacter", ".", "of", "(", "escapeCharacter", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "spel", ".", "spi", ".", "EvaluationContextExtension", "#", "getExtensionId", "(", ")", "*", "/", "@", "Override", "public", "String", "getExtensionId", "(", ")", "{", "return", "\"", "jpa", "\"", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "spel", ".", "spi", ".", "EvaluationContextExtension", "#", "getRootObject", "(", ")", "*", "/", "@", "Override", "public", "Object", "getRootObject", "(", ")", "{", "return", "character", ";", "}", "}", "@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", "-", "1", ".", "11", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "11", ".", "xsd", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "11", ".", "xsd", "@", "@", "-", "0", ",", "0", "+", "1", ",", "65", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?", ">", "<", "xsd", ":", "schema", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "\"", "xmlns", ":", "xsd", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "\"", "xmlns", ":", "tool", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "tool", "\"", "xmlns", ":", "context", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "context", "\"", "xmlns", ":", "repository", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "repository", "\"", "targetNamespace", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "\"", "elementFormDefault", "=", "\"", "qualified", "\"", "attributeFormDefault", "=", "\"", "unqualified", "\"", ">", "<", "xsd", ":", "import", "namespace", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "tool", "\"", "/", ">", "<", "xsd", ":", "import", "namespace", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "context", "\"", "/", ">", "<", "xsd", ":", "import", "namespace", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "repository", "\"", "schemaLocation", "=", "\"", "https", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "repository", "/", "spring", "-", "repository", ".", "xsd", "\"", "/", ">", "<", "xsd", ":", "element", "name", "=", "\"", "repositories", "\"", ">", "<", "xsd", ":", "complexType", ">", "<", "xsd", ":", "complexContent", ">", "<", "xsd", ":", "extension", "base", "=", "\"", "repository", ":", "repositories", "\"", ">", "<", "xsd", ":", "attributeGroup", "ref", "=", "\"", "repository", ":", "transactional", "-", "repository", "-", "attributes", "\"", "/", ">", "<", "xsd", ":", "attribute", "name", "=", "\"", "entity", "-", "manager", "-", "factory", "-", "ref", "\"", "type", "=", "\"", "entityManagerFactoryRef", "\"", "/", ">", "<", "xsd", ":", "attribute", "name", "=", "\"", "enable", "-", "default", "-", "transactions", "\"", "type", "=", "\"", "xsd", ":", "boolean", "\"", ">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "documentation", ">", "<!", "[", "CDATA", "[", "Controls", "whether", "repositories", "get", "transactions", "enabled", "by", "default", ".", "]", "]>", "</", "xsd", ":", "documentation", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "/", "xsd", ":", "attribute", ">", "<", "xsd", ":", "attribute", "name", "=", "\"", "escape", "-", "character", "\"", "type", "=", "\"", "xsd", ":", "string", "\"", "default", "=", "\"\\", "\">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "documentation", ">", "<!", "[", "CDATA", "[", "Configures", "what", "character", "is", "used", "to", "escape", "the", "LIKE", "wildcards", "_", "and", "%", "in", "derived", "queries", "with", "contains", ",", "startsWith", "or", "endsWith", "clauses", ".", "Defaults", "to", "\\", ".", "]", "]>", "</", "xsd", ":", "documentation", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "/", "xsd", ":", "attribute", ">", "<", "/", "xsd", ":", "extension", ">", "<", "/", "xsd", ":", "complexContent", ">", "<", "/", "xsd", ":", "complexType", ">", "<", "/", "xsd", ":", "element", ">", "<", "xsd", ":", "element", "name", "=", "\"", "auditing", "\"", ">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "appinfo", ">", "<", "tool", ":", "annotation", ">", "<", "tool", ":", "exports", "type", "=", "\"", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "support", ".", "AuditingEntityListener", "\"", "/", ">", "<", "tool", ":", "exports", "type", "=", "\"", "org", ".", "springframework", ".", "data", ".", "auditing", ".", "AuditingHandler", "\"", "/", ">", "<", "/", "tool", ":", "annotation", ">", "<", "/", "xsd", ":", "appinfo", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "xsd", ":", "complexType", ">", "<", "xsd", ":", "attributeGroup", "ref", "=", "\"", "repository", ":", "auditing", "-", "attributes", "\"", "/", ">", "<", "/", "xsd", ":", "complexType", ">", "<", "/", "xsd", ":", "element", ">", "<", "xsd", ":", "simpleType", "name", "=", "\"", "entityManagerFactoryRef", "\"", ">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "appinfo", ">", "<", "tool", ":", "annotation", "kind", "=", "\"", "ref", "\"", ">", "<", "tool", ":", "assignable", "-", "to", "type", "=", "\"", "org", ".", "springframework", ".", "orm", ".", "jpa", ".", "AbstractEntityManagerFactoryBean", "\"", "/", ">", "<", "/", "tool", ":", "annotation", ">", "<", "/", "xsd", ":", "appinfo", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "xsd", ":", "union", "memberTypes", "=", "\"", "xsd", ":", "string", "\"", "/", ">", "<", "/", "xsd", ":", "simpleType", ">", "<", "/", "xsd", ":", "schema", ">", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "like", "%", "?#", "{", "escape", "(", "[", "0", "]", ")}", "%", "escape", "'", "\\\\", "'\"", ")</s>builder", ".", "addPropertyValue", "(", "\"", "escapeCharacter", "\"", ",", "getEscapeCharacter", "(", "source", ")", ".", "orElse", "(", "'\\", "\\'", "))", ";", "*", "XML", "configurations", "do", "not", "support", "{", "@", "link", "Character", "}", "values", ".", "This", "method", "catches", "the", "exception", "thrown", "and", "returns", "an", "{", "@", "link", "Optional", "#", "empty", "(", ")}", "instead", ".", "return", "source", ".", "getAttribute", "(", "\"", "escapeCharacter", "\"", ",", "Character", ".", "class", ")", ";", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ";", "*", "A", "Value", "-", "class", "encapsulating", "an", "escape", "character", "for", "LIKE", "queries", "and", "the", "actually", "usage", "of", "it", "in", "escaping", "Strings", ".", "return", "value", ".", "replace", "(", "\"", "_", "\"", ",", "value", "+", "\"", "_", "\"", ").", "replace", "(", "\"%", "\",", "value", "+", "\"", "%\"", ");", "}", "/", "/", "used", "for", "SpEL", "expressions", "static", "String", "escape", "(", "String", "value", ",", "String", "escape", ")", "{", "Assert", ".", "hasText", "(", "escape", ",", "\"", "escape", "must", "be", "a", "sinlge", "character", "String", ".", "\")", ";", "char", "[", "]", "chars", "=", "escape", ".", "toCharArray", "(", ");", "Assert", ".", "isTrue", "(", "chars", ".", "length", "=", "=", "1", ",", "\"", "escape", "must", "be", "a", "single", "character", "String", ".", "\")", ";", "return", "EscapeCharacter", ".", "of", "(", "chars", "[", "0", "]", ").", "escape", "(", "value", ")", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "util", ".", "ReflectionUtils", ";", "Method", "escapeMethod", "=", "ReflectionUtils", ".", "findMethod", "(", "EscapeCharacter", ".", "class", ",", "\"", "escape", "\"", ",", "String", ".", "class", ",", "String", ".", "class", ")", ";", "Assert", ".", "notNull", "(", "escapeMethod", ",", "\"", "Escape", "method", "must", "not", "be", "null", ".", "\")", ";", "context", ".", "setVariable", "(", "\"", "escape", "\"", ",", "escapeMethod", ")", ";", "http", "\\", ":/", "/", "www", ".", "springframework", ".", "org", "/", "schema", "/", "data", "/", "jpa", "/", "spring", "-", "jpa", ".", "xsd", "=", "org", "/", "springframework", "/", "data", "/", "jpa", "/", "repository", "/", "config", "/", "spring", "-", "jpa", "-", "1", ".", "8", ".", "xsd", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "like", "%", "?#", "{#", "escape", "(", "[", "0", "]", ",'", "#'", ")}", "%", "escape", "'", "#'", "\")"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["AppArmor:", "fix", "oops", "in", "apparmor_setprocattr", "When", "invalid", "parameters", "are", "passed", "to", "apparmor_setprocattr", "a", "NULL", "deref", "oops", "occurs", "when", "it", "tries", "to", "record", "an", "audit", "message.", "This", "is", "because", "it", "is", "passing", "NULL", "for", "the", "profile", "parameter", "for", "aa_audit.", "But", "aa_audit", "now", "requires", "that", "the", "profile", "passed", "is", "not", "NULL.", "Fix", "this", "by", "passing", "the", "current", "profile", "on", "the", "task", "that", "is", "trying", "to", "setprocattr.", "Signed-off-by:", "Kees", "Cook", "<kees@ubuntu.com>", "Signed-off-by:", "John", "Johansen", "<john.johansen@canonical.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "James", "Morris", "<jmorris@namei.org>"], "code_tokens": ["return", "aa_audit", "(", "AUDIT_APPARMOR_DENIED", ",", "__aa_current_profile", "(", "),", "GFP_KERNEL", ",</s>return", "aa_audit", "(", "AUDIT_APPARMOR_DENIED", ",", "NULL", ",", "GFP_KERNEL", ","], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["https://issues.apache.org/jira/browse/APLO-366", "-", "make", "xpath", "parser", "features", "configurable"], "code_tokens": ["import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "public", "static", "final", "String", "DOCUMENT_BUILDER_FACTORY_FEATURE", "=", "\"", "org", ".", "apache", ".", "activemq", ".", "apollo", ".", "documentBuilderFactory", ".", "feature", "\"", ";", "factory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";", "factory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ",", "false", ")", ";", "factory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "setupFeatures", "(", "factory", ")", ";", "factory", ".", "setIgnoringElementContentWhitespace", "(", "true", ")", ";", "factory", ".", "setIgnoringComments", "(", "true", ")", ";", "protected", "void", "setupFeatures", "(", "DocumentBuilderFactory", "factory", ")", "{", "Properties", "properties", "=", "System", ".", "getProperties", "(", ");", "List", "<", "String", ">", "features", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "for", "(", "Map", ".", "Entry", "<", "Object", ",", "Object", ">", "prop", ":", "properties", ".", "entrySet", "(", "))", "{", "String", "key", "=", "(", "String", ")", "prop", ".", "getKey", "(", ");", "if", "(", "key", ".", "startsWith", "(", "DOCUMENT_BUILDER_FACTORY_FEATURE", ")", ")", "{", "String", "uri", "=", "key", ".", "split", "(", "DOCUMENT_BUILDER_FACTORY_FEATURE", "+", "\"", ":\"", ")[", "1", "]", ";", "Boolean", "value", "=", "Boolean", ".", "valueOf", "(", "(", "String", ")", "prop", ".", "getValue", "(", "))", ";", "try", "{", "factory", ".", "setFeature", "(", "uri", ",", "value", ")", ";", "features", ".", "add", "(", "\"", "feature", "\"", "+", "uri", "+", "\"", "value", "\"", "+", "value", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "DocumentBuilderFactory", "doesn", "'", "t", "support", "the", "feature", "\"", "+", "uri", "+", "\"", "with", "value", "\"", "+", "value", "+", "\"", ",", "due", "to", "\"", "+", "e", ")", ";", "}", "}", "}", "if", "(", "features", ".", "size", "(", ")", ">", "0", ")", "{", "StringBuffer", "featureString", "=", "new", "StringBuffer", "(", ");", "/", "/", "just", "log", "the", "configured", "feature", "for", "(", "String", "feature", ":", "features", ")", "{", "if", "(", "featureString", ".", "length", "(", ")", "!", "=", "0", ")", "{", "featureString", ".", "append", "(", "\",", "\"", ");", "}", "featureString", ".", "append", "(", "feature", ")", ";", "}", "}", "}</s>"], "docstring_tokens": ["xml", "external", "entity", "injection", "(xxe", ")"]}
{"contents": ["more", "bio_map_user_iov()", "leak", "fixes", "we", "need", "to", "take", "care", "of", "failure", "exit", "as", "well", "-", "pages", "already", "in", "bio", "should", "be", "dropped", "by", "analogue", "of", "bio_unmap_pages(),", "since", "their", "refcounts", "had", "been", "bumped", "only", "once", "per", "reference", "in", "bio.", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["struct", "bio_vec", "*", "bvec", ";", "if", "(", "unlikely", "(", "ret", "<", "local_nr_pages", ")", ")", "{", "for", "(", "j", "=", "cur_page", ";", "j", "<", "page_limit", ";", "j", "+", "+)", "{", "if", "(", "!", "pages", "[", "j", "]", ")", "break", ";", "put_page", "(", "pages", "[", "j", "]", ");", "}", "bio_for_each_segment_all", "(", "bvec", ",", "bio", ",", "j", ")", "{", "put_page", "(", "bvec", "-", ">", "bv_page", ")", ";</s>if", "(", "ret", "<", "local_nr_pages", ")", "{", "for", "(", "j", "=", "0", ";", "j", "<", "nr_pages", ";", "j", "+", "+)", "{", "if", "(", "!", "pages", "[", "j", "]", ")", "break", ";", "put_page", "(", "pages", "[", "j", "]", ");"], "docstring_tokens": ["out-of-memory", "condition"]}
{"contents": ["avcodec/vqavideo:", "Set", "video", "size", "Fixes:", "out", "of", "array", "access", "Fixes:", "15919/clusterfuzz-testcase-minimized-ffmpeg_AV_CODEC_ID_VQA_fuzzer-5657368257363968", "Found-by:", "continuous", "fuzzing", "process", "https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["if", "(", "(", "ret", "=", "ff_set_dimensions", "(", "avctx", ",", "s", "-", ">", "width", ",", "s", "-", ">", "height", ")", ")", "<", "0", ")", "{</s>if", "(", "(", "ret", "=", "av_image_check_size", "(", "s", "-", ">", "width", ",", "s", "-", ">", "height", ",", "0", ",", "avctx", ")", ")", "<", "0", ")", "{"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["Cherry", "picking", "r10458", "into", "releases/2.4", "for", "issue", "1483804", "git-svn-id:", "https://google-web-toolkit.googlecode.com/svn/releases/2.4@10498", "8db76d5a-ed1c-0410-87a9-c151d255dfc7"], "code_tokens": ["__gwt_displayGlassMessage", "(", "\"", "Plugin", "failed", "to", "connect", "to", "Development", "Mode", "server", "at", "\"", "simpleEscape", "(", "codeServer", ")", ",", "function", "simpleEscape", "(", "originalString", ")", "{", "return", "originalString", ".", "replace", "(", "\"&", "\",", "\"&", "amp", ";", "\")", ".", "replace", "(", "\"<", "\",", "\"&", "lt", ";", "\")", ".", "replace", "(", "\">", "\",", "\"&", "gt", ";", "\")", ".", "replace", "(", "\"\\", "\"\"", ",\"", "&", "quot", ";", "\")", ";", "}", "__gwt_displayGlassMessage", "(", "\"", "Plugin", "failed", "to", "connect", "to", "Development", "Mode", "server", "at", "\"", "simpleEscape", "(", "$", "hosted", ")", ",", "function", "simpleEscape", "(", "originalString", ")", "{", "return", "originalString", ".", "replace", "(", "\"&", "\",", "\"&", "amp", ";", "\")", ".", "replace", "(", "\"<", "\",", "\"&", "lt", ";", "\")", ".", "replace", "(", "\">", "\",", "\"&", "gt", ";", "\")", ".", "replace", "(", "\"\\", "\"\"", ",\"", "&", "quot", ";", "\")", ";", "}</s>__gwt_displayGlassMessage", "(", "\"", "Plugin", "failed", "to", "connect", "to", "Development", "Mode", "server", "at", "\"", "+", "codeServer", ",", "__gwt_displayGlassMessage", "(", "\"", "Plugin", "failed", "to", "connect", "to", "Development", "Mode", "server", "at", "\"", "+", "$", "hosted", ","], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["CAMEL-12630:", "better", "attachment", "handling", "in", "came...", "...l-mail", "component"], "code_tokens": ["<", "dependency", ">", "<", "groupId", ">", "org", ".", "assertj", "<", "/", "groupId", ">", "<", "artifactId", ">", "assertj", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "${", "assertj", "-", "version", "}", "</", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "mail", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "javax", ".", "activation", ".", "DataSource", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "ObjectHelper", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "StringHelper", ";", "final", "class", "DelegatingDataSource", "implements", "DataSource", "{", "private", "final", "DataSource", "delegate", ";", "private", "final", "String", "name", ";", "public", "DelegatingDataSource", "(", "final", "String", "name", ",", "final", "DataSource", "delegate", ")", "{", "this", ".", "name", "=", "StringHelper", ".", "notEmpty", "(", "name", ",", "\"", "name", "\"", ");", "this", ".", "delegate", "=", "ObjectHelper", ".", "notNull", "(", "delegate", ",", "\"", "DataSource", "\"", ");", "}", "@", "Override", "public", "String", "getContentType", "(", ")", "{", "return", "delegate", ".", "getContentType", "(", ");", "}", "@", "Override", "public", "InputStream", "getInputStream", "(", ")", "throws", "IOException", "{", "return", "delegate", ".", "getInputStream", "(", ");", "}", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "@", "Override", "public", "OutputStream", "getOutputStream", "(", ")", "throws", "IOException", "{", "return", "delegate", ".", "getOutputStream", "(", ");", "}", "}", "@", "@", "-", "52", ",", "6", "+", "52", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "FileUtil", ";", "String", "fileName", "=", "FileUtil", ".", "stripPath", "(", "part", ".", "getFileName", "(", "))", ";", "final", "DataHandler", "dataHandler", "=", "part", ".", "getDataHandler", "(", ");", "final", "DataSource", "dataSource", "=", "dataHandler", ".", "getDataSource", "(", ");", "final", "DataHandler", "replacement", "=", "new", "DataHandler", "(", "new", "DelegatingDataSource", "(", "fileName", ",", "dataSource", ")", ");", "DefaultAttachment", "camelAttachment", "=", "new", "DefaultAttachment", "(", "replacement", ")", ";", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "mail", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "activation", ".", "DataHandler", ";", "import", "javax", ".", "mail", ".", "Message", ";", "import", "javax", ".", "mail", ".", "MessagingException", ";", "import", "javax", ".", "mail", ".", "Multipart", ";", "import", "javax", ".", "mail", ".", "Session", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeBodyPart", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeMessage", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeMultipart", ";", "import", "org", ".", "apache", ".", "camel", ".", "Attachment", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameter", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameters", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "@", "RunWith", "(", "Parameterized", ".", "class", ")", "public", "class", "MailBindingAttachmentFileTest", "{", "@", "Parameter", "public", "String", "name", ";", "private", "final", "MailBinding", "binding", "=", "new", "MailBinding", "(", ");", "@", "Test", "public", "void", "shouldSanitizeAttachmentFileNames", "(", ")", "throws", "MessagingException", ",", "IOException", "{", "final", "Session", "session", "=", "Session", ".", "getInstance", "(", "new", "Properties", "(", "))", ";", "final", "Message", "message", "=", "new", "MimeMessage", "(", "session", ")", ";", "final", "Multipart", "multipart", "=", "new", "MimeMultipart", "(", ");", "final", "MimeBodyPart", "part", "=", "new", "MimeBodyPart", "(", ");", "part", ".", "attachFile", "(", "name", ")", ";", "multipart", ".", "addBodyPart", "(", "part", ")", ";", "message", ".", "setContent", "(", "multipart", ")", ";", "final", "Map", "<", "String", ",", "Attachment", ">", "attachments", "=", "new", "HashMap", "<", ">(", ");", "binding", ".", "extractAttachmentsFromMail", "(", "message", ",", "attachments", ")", ";", "assertThat", "(", "attachments", ")", ".", "containsKey", "(", "\"", "file", ".", "txt", "\"", ");", "final", "Attachment", "attachment", "=", "attachments", ".", "get", "(", "\"", "file", ".", "txt", "\"", ");", "final", "DataHandler", "dataHandler", "=", "attachment", ".", "getDataHandler", "(", ");", "assertThat", "(", "dataHandler", ".", "getName", "(", "))", ".", "isEqualTo", "(", "\"", "file", ".", "txt", "\"", ");", "}", "@", "Parameters", "(", "name", "=", "\"", "{", "0", "}", "\")", "public", "static", "Iterable", "<", "String", ">", "fileNames", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "\"", "file", ".", "txt", "\"", ",", "\"", "..", "/", "file", ".", "txt", "\"", ",", "\"", "..", "\\\\", "file", ".", "txt", "\"", ",", "\"", "/", "absolute", "/", "file", ".", "txt", "\"", ",", "\"", "c", ":", "\\\\", "absolute", "\\", "\\", "file", ".", "txt", "\"", ");", "}", "}</s>String", "fileName", "=", "part", ".", "getFileName", "(", ");", "DefaultAttachment", "camelAttachment", "=", "new", "DefaultAttachment", "(", "part", ".", "getDataHandler", "(", "))", ";"], "docstring_tokens": ["path", "traversal"]}
{"contents": ["Fix", "missing", "NULL", "checks", "in", "CKE", "processing", "Reviewed-by:", "Rich", "Salz", "<rsalz@openssl.org>"], "code_tokens": ["if", "(", "ckey", "=", "=", "NULL", ")", "{", "SSLerr", "(", "SSL_F_TLS_CONSTRUCT_CKE_DHE", ",", "ERR_R_INTERNAL_ERROR", ")", ";", "return", "0", ";", "}", "if", "(", "ckey", "=", "=", "NULL", ")", "{", "SSLerr", "(", "SSL_F_TLS_CONSTRUCT_CKE_ECDHE", ",", "ERR_R_INTERNAL_ERROR", ")", ";", "goto", "err", ";", "}</s>"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["KEYS:", "find_keyring_by_name()", "can", "gain", "access", "to", "a", "freed", "keyring", "find_keyring_by_name()", "can", "gain", "access", "to", "a", "keyring", "that", "has", "had", "its", "reference", "count", "reduced", "to", "zero,", "and", "is", "thus", "ready", "to", "be", "freed.", "This", "then", "allows", "the", "dead", "keyring", "to", "be", "brought", "back", "into", "use", "whilst", "it", "is", "being", "destroyed.", "The", "following", "timeline", "illustrates", "the", "process:", "|(cleaner)", "(user)", "|", "|", "free_user(user)", "sys_keyctl()", "|", "|", "|", "|", "key_put(user->session_keyring)", "keyctl_get_keyring_ID()", "|", "||", "//=>", "keyring->usage", "=", "0", "|", "|", "|schedule_work(&key_cleanup_task)", "lookup_user_key()", "|", "||", "|", "|", "kmem_cache_free(,user)", "|", "|", ".", "|[KEY_SPEC_USER_KEYRING]", "|", ".", "install_user_keyrings()", "|", ".", "||", "|", "key_cleanup()", "[<=", "worker_thread()]", "||", "|", "|", "||", "|", "[spin_lock(&key_serial_lock)]", "|[mutex_lock(&key_user_keyr..mutex)]", "|", "|", "||", "|", "atomic_read()", "==", "0", "||", "|", "|{", "rb_ease(&key->serial_node,)", "}", "||", "|", "|", "||", "|", "[spin_unlock(&key_serial_lock)]", "|find_keyring_by_name()", "|", "|", "|||", "|", "keyring_destroy(keyring)", "||[read_lock(&keyring_name_lock)]", "|", "||", "|||", "|", "|[write_lock(&keyring_name_lock)]", "||atomic_inc(&keyring->usage)", "|", "|.", "|||", "***", "GET", "freeing", "keyring", "***", "|", "|.", "||[read_unlock(&keyring_name_lock)]", "|", "||", "||", "|", "|list_del()", "|[mutex_unlock(&key_user_k..mutex)]", "|", "||", "|", "|", "|[write_unlock(&keyring_name_lock)]", "**", "INVALID", "keyring", "is", "returned", "**", "|", "|", ".", "|", "kmem_cache_free(,keyring)", ".", "|", ".", "|", "atomic_dec(&keyring->usage)", "v", "***", "DESTROYED", "***", "TIME", "If", "CONFIG_SLUB_DEBUG=y", "then", "we", "may", "see", "the", "following", "message", "generated:", "=============================================================================", "BUG", "key_jar:", "Poison", "overwritten", "-----------------------------------------------------------------------------", "INFO:", "0xffff880197a7e200-0xffff880197a7e200.", "First", "byte", "0x6a", "instead", "of", "0x6b", "INFO:", "Allocated", "in", "key_alloc+0x10b/0x35f", "age=25", "cpu=1", "pid=5086", "INFO:", "Freed", "in", "key_cleanup+0xd0/0xd5", "age=12", "cpu=1", "pid=10", "INFO:", "Slab", "0xffffea000592cb90", "objects=16", "used=2", "fp=0xffff880197a7e200", "flags=0x200000000000c3", "INFO:", "Object", "0xffff880197a7e200", "@offset=512", "fp=0xffff880197a7e300", "Bytes", "b4", "0xffff880197a7e1f0:", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "5a", "ZZZZZZZZZZZZZZZZ", "Object", "0xffff880197a7e200:", "6a", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "6b", "jkkkkkkkkkkkkkkk", "Alternatively,", "we", "may", "see", "a", "system", "panic", "happen,", "such", "as:", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000001", "IP:", "[<ffffffff810e61a3>]", "kmem_cache_alloc+0x5b/0xe9", "PGD", "6b2b4067", "PUD", "6a80d067", "PMD", "0", "Oops:", "0000", "[#1]", "SMP", "last", "sysfs", "file:", "/sys/kernel/kexec_crash_loaded", "CPU", "1", "...", "Pid:", "31245,", "comm:", "su", "Not", "tainted", "2.6.34-rc5-nofixed-nodebug", "#2", "D2089/PRIMERGY", "RIP:", "0010:[<ffffffff810e61a3>]", "[<ffffffff810e61a3>]", "kmem_cache_alloc+0x5b/0xe9", "RSP:", "0018:ffff88006af3bd98", "EFLAGS:", "00010002", "RAX:", "0000000000000000", "RBX:", "0000000000000001", "RCX:", "ffff88007d19900b", "RDX:", "0000000100000000", "RSI:", "00000000000080d0", "RDI:", "ffffffff81828430", "RBP:", "ffffffff81828430", "R08:", "ffff88000a293750", "R09:", "0000000000000000", "R10:", "0000000000000001", "R11:", "0000000000100000", "R12:", "00000000000080d0", "R13:", "00000000000080d0", "R14:", "0000000000000296", "R15:", "ffffffff810f20ce", "FS:", "00007f97116bc700(0000)", "GS:ffff88000a280000(0000)", "knlGS:0000000000000000", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "CR2:", "0000000000000001", "CR3:", "000000006a91c000", "CR4:", "00000000000006e0", "DR0:", "0000000000000000", "DR1:", "0000000000000000", "DR2:", "0000000000000000", "DR3:", "0000000000000000", "DR6:", "00000000ffff0ff0", "DR7:", "0000000000000400", "Process", "su", "(pid:", "31245,", "threadinfo", "ffff88006af3a000,", "task", "ffff8800374414c0)", "Stack:", "0000000512e0958e", "0000000000008000", "ffff880037f8d180", "0000000000000001", "0000000000000000", "0000000000008001", "ffff88007d199000", "ffffffff810f20ce", "0000000000008000", "ffff88006af3be48", "0000000000000024", "ffffffff810face3", "Call", "Trace:", "[<ffffffff810f20ce>]", "?", "get_empty_filp+0x70/0x12f", "[<ffffffff810face3>]", "?", "do_filp_open+0x145/0x590", "[<ffffffff810ce208>]", "?", "tlb_finish_mmu+0x2a/0x33", "[<ffffffff810ce43c>]", "?", "unmap_region+0xd3/0xe2", "[<ffffffff810e4393>]", "?", "virt_to_head_page+0x9/0x2d", "[<ffffffff81103916>]", "?", "alloc_fd+0x69/0x10e", "[<ffffffff810ef4ed>]", "?", "do_sys_open+0x56/0xfc", "[<ffffffff81008a02>]", "?", "system_call_fastpath+0x16/0x1b", "Code:", "0f", "1f", "44", "00", "00", "49", "89", "c6", "fa", "66", "0f", "1f", "44", "00", "00", "65", "4c", "8b", "04", "25", "60", "e8", "00", "00", "48", "8b", "45", "00", "49", "01", "c0", "49", "8b", "18", "48", "85", "db", "74", "0d", "48", "63", "45", "18", "<48>", "8b", "04", "03", "49", "89", "00", "eb", "14", "4c", "89", "f9", "83", "ca", "ff", "44", "89", "e6", "48", "89", "ef", "RIP", "[<ffffffff810e61a3>]", "kmem_cache_alloc+0x5b/0xe9", "This", "problem", "is", "that", "find_keyring_by_name", "does", "not", "confirm", "that", "the", "keyring", "is", "valid", "before", "accepting", "it.", "Skipping", "keyrings", "that", "have", "been", "reduced", "to", "a", "zero", "count", "seems", "the", "way", "to", "go.", "To", "this", "end,", "use", "atomic_inc_not_zero()", "to", "increment", "the", "usage", "count", "and", "skip", "the", "candidate", "keyring", "if", "that", "returns", "false.", "The", "following", "script", "_may_", "cause", "the", "bug", "to", "happen,", "but", "there's", "no", "guarantee", "as", "the", "window", "of", "opportunity", "is", "small:", "#!/bin/sh", "LOOP=100000", "USER=dummy_user", "/bin/su", "-c", "\"exit;\"", "$USER", "||", "{", "/usr/sbin/adduser", "-m", "$USER;", "add=1;", "}", "for", "((i=0;", "i<LOOP;", "i++))", "do", "/bin/su", "-c", "\"echo", "'$i'", ">", "/dev/null\"", "$USER", "done", "((", "add", "==", "1", "))", "&&", "/usr/sbin/userdel", "-r", "$USER", "exit", "Note", "that", "the", "nominated", "user", "must", "not", "be", "in", "use.", "An", "alternative", "way", "of", "testing", "this", "may", "be:", "for", "((i=0;", "i<100000;", "i++))", "do", "keyctl", "session", "foo", "/bin/true", "||", "break", "done", ">&/dev/null", "as", "that", "uses", "a", "keyring", "named", "\"foo\"", "rather", "than", "relying", "on", "the", "user", "and", "user-session", "named", "keyrings.", "Reported-by:", "Toshiyuki", "Okajima", "<toshi.okajima@jp.fujitsu.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "Tested-by:", "Toshiyuki", "Okajima", "<toshi.okajima@jp.fujitsu.com>", "Acked-by:", "Serge", "Hallyn", "<serue@us.ibm.com>", "Signed-off-by:", "James", "Morris", "<jmorris@namei.org>"], "code_tokens": ["return", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "/", "*", "we", "'", "ve", "got", "a", "match", "but", "we", "might", "end", "up", "racing", "with", "*", "key_cleanup", "(", ")", "if", "the", "keyring", "is", "currently", "'", "dead", "'", "*", "(", "ie", ".", "it", "has", "a", "zero", "usage", "count", ")", "*", "/", "if", "(", "!", "atomic_inc_not_zero", "(", "&", "keyring", "-", ">", "usage", ")", ")", "continue", ";", "goto", "out", ";", "out", ":", "read_unlock", "(", "&", "keyring_name_lock", ")", ";</s>keyring", "=", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "goto", "error", ";", "/", "*", "we", "'", "ve", "got", "a", "match", "*", "/", "atomic_inc", "(", "&", "keyring", "-", ">", "usage", ")", ";", "read_unlock", "(", "&", "keyring_name_lock", ")", ";", "goto", "error", ";", "read_unlock", "(", "&", "keyring_name_lock", ")", ";", "error", ":"], "docstring_tokens": ["local", "memory", "corruption"]}
{"contents": ["Input:", "aiptek", "-", "fix", "crash", "on", "detecting", "device", "without", "endpoints", "The", "aiptek", "driver", "crashes", "in", "aiptek_probe()", "when", "a", "specially", "crafted", "USB", "device", "without", "endpoints", "is", "detected.", "This", "fix", "adds", "a", "check", "that", "the", "device", "has", "proper", "configuration", "expected", "by", "the", "driver.", "Also", "an", "error", "return", "value", "is", "changed", "to", "more", "matching", "one", "in", "one", "of", "the", "error", "paths.", "Reported-by:", "Ralf", "Spenneberg", "<ralf@spenneberg.net>", "Signed-off-by:", "Vladis", "Dronov", "<vdronov@redhat.com>", "Signed-off-by:", "Dmitry", "Torokhov", "<dmitry.torokhov@gmail.com>"], "code_tokens": ["/", "*", "Verify", "that", "a", "device", "really", "has", "an", "endpoint", "*", "/", "if", "(", "intf", "-", ">", "altsetting", "[", "0", "]", ".", "desc", ".", "bNumEndpoints", "<", "1", ")", "{", "dev_err", "(", "&", "intf", "-", ">", "dev", ",", "\"", "interface", "has", "%", "d", "endpoints", ",", "but", "must", "have", "minimum", "1", "\\", "n", "\"", ",", "intf", "-", ">", "altsetting", "[", "0", "]", ".", "desc", ".", "bNumEndpoints", ")", ";", "err", "=", "-", "EINVAL", ";", "goto", "fail3", ";", "}", "err", "=", "-", "EINVAL", ";</s>"], "docstring_tokens": ["nullpointer", "dereference"]}
{"contents": ["kvm:", "x86:", "fix", "kvm_apic_has_events", "to", "check", "for", "NULL", "pointer", "Malicious", "(or", "egregiously", "buggy)", "userspace", "can", "trigger", "it,", "but", "it", "should", "never", "happen", "in", "normal", "operation.", "Signed-off-by:", "Paolo", "Bonzini", "<pbonzini@redhat.com>"], "code_tokens": ["return", "kvm_vcpu_has_lapic", "(", "vcpu", ")", "&", "&", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "pending_events", ";</s>return", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "pending_events", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["drivers/video/sis/sis_main.c:", "prevent", "reading", "uninitialized", "stack", "memory", "The", "FBIOGET_VBLANK", "device", "ioctl", "allows", "unprivileged", "users", "to", "read", "16", "bytes", "of", "uninitialized", "stack", "memory,", "because", "the", "\"reserved\"", "member", "of", "the", "fb_vblank", "struct", "declared", "on", "the", "stack", "is", "not", "altered", "or", "zeroed", "before", "being", "copied", "back", "to", "the", "user.", "This", "patch", "takes", "care", "of", "it.", "Signed-off-by:", "Dan", "Rosenberg", "<dan.j.rosenberg@gmail.com>", "Cc:", "Thomas", "Winischhofer", "<thomas@winischhofer.net>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["memset", "(", "&", "sisvbblank", ",", "0", ",", "sizeof", "(", "struct", "fb_vblank", ")", ");</s>"], "docstring_tokens": ["stack", "leak"]}
{"contents": ["Better", "handle", "the", "case", "of", "parsing", "malformed", "MQTT", "frames"], "code_tokens": ["if", "(", "size", "<", "0", ")", "{", "throw", "new", "ProtocolException", "(", "\"", "Invalid", "message", "encoding", "\"", ");", "}</s>"], "docstring_tokens": ["input", "validation"]}
{"contents": ["bpf/verifier:", "fix", "bounds", "calculation", "on", "BPF_RSH", "Incorrect", "signed", "bounds", "were", "being", "computed.", "If", "the", "old", "upper", "signed", "bound", "was", "positive", "and", "the", "old", "lower", "signed", "bound", "was", "negative,", "this", "could", "cause", "the", "new", "upper", "signed", "bound", "to", "be", "too", "low,", "leading", "to", "security", "issues.", "Fixes:", "b03c9f9fdc37", "(\"bpf/verifier:", "track", "signed", "and", "unsigned", "min/max", "values\")", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Edward", "Cree", "<ecree@solarflare.com>", "Acked-by:", "Alexei", "Starovoitov", "<ast@kernel.org>", "[jannh@google.com:", "changed", "description", "to", "reflect", "bug", "impact]", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Alexei", "Starovoitov", "<ast@kernel.org>", "Signed-off-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>"], "code_tokens": ["/", "*", "BPF_RSH", "is", "an", "unsigned", "shift", ".", "If", "the", "value", "in", "dst_reg", "might", "*", "be", "negative", ",", "then", "either", ":", "*", "1", ")", "src_reg", "might", "be", "zero", ",", "so", "the", "sign", "bit", "of", "the", "result", "is", "*", "unknown", ",", "so", "we", "lose", "our", "signed", "bounds", "*", "2", ")", "it", "'", "s", "known", "negative", ",", "thus", "the", "unsigned", "bounds", "capture", "the", "*", "signed", "bounds", "*", "3", ")", "the", "signed", "bounds", "cross", "zero", ",", "so", "they", "tell", "us", "nothing", "*", "about", "the", "result", "*", "If", "the", "value", "in", "dst_reg", "is", "known", "nonnegative", ",", "then", "again", "the", "*", "unsigned", "bounts", "capture", "the", "signed", "bounds", ".", "*", "Thus", ",", "in", "all", "cases", "it", "suffices", "to", "blow", "away", "our", "signed", "bounds", "*", "and", "rely", "on", "inferring", "new", "ones", "from", "the", "unsigned", "bounds", "and", "*", "var_off", "of", "the", "result", ".", "*", "/", "dst_reg", "-", ">", "smin_value", "=", "S64_MIN", ";", "dst_reg", "-", ">", "smax_value", "=", "S64_MAX", ";</s>/", "*", "BPF_RSH", "is", "an", "unsigned", "shift", ",", "so", "make", "the", "appropriate", "casts", "*", "/", "if", "(", "dst_reg", "-", ">", "smin_value", "<", "0", ")", "{", "if", "(", "umin_val", ")", "{", "/", "*", "Sign", "bit", "will", "be", "cleared", "*", "/", "dst_reg", "-", ">", "smin_value", "=", "0", ";", "}", "else", "{", "/", "*", "Lost", "sign", "bit", "information", "*", "/", "dst_reg", "-", ">", "smin_value", "=", "S64_MIN", ";", "dst_reg", "-", ">", "smax_value", "=", "S64_MAX", ";", "}", "}", "else", "{", "dst_reg", "-", ">", "smin_value", "=", "(", "u64", ")", "(", "dst_reg", "-", ">", "smin_value", ")", ">", ">", "umax_val", ";", "}"], "docstring_tokens": ["register", "truncation"]}
{"contents": ["net:", "fix", "info", "leak", "in", "compat", "dev_ifconf()", "The", "implementation", "of", "dev_ifconf()", "for", "the", "compat", "ioctl", "interface", "uses", "an", "intermediate", "ifc", "structure", "allocated", "in", "userland", "for", "the", "duration", "of", "the", "syscall.", "Though,", "it", "fails", "to", "initialize", "the", "padding", "bytes", "inserted", "for", "alignment", "and", "that", "for", "leaks", "four", "bytes", "of", "kernel", "stack.", "Add", "an", "explicit", "memset(0)", "before", "filling", "the", "structure", "to", "avoid", "the", "info", "leak.", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["memset", "(", "&", "ifc", ",", "0", ",", "sizeof", "(", "ifc", ")", ");</s>"], "docstring_tokens": ["info", "leaks"]}
{"contents": ["mac80211_hwsim:", "fix", "possible", "memory", "leak", "in", "hwsim_new_radio_nl()", "'hwname'", "is", "malloced", "in", "hwsim_new_radio_nl()", "and", "should", "be", "freed", "before", "leaving", "from", "the", "error", "handling", "cases,", "otherwise", "it", "will", "cause", "memory", "leak.", "Fixes:", "ff4dd73dd2b4", "(\"mac80211_hwsim:", "check", "HWSIM_ATTR_RADIO_NAME", "length\")", "Signed-off-by:", "Wei", "Yongjun", "<weiyongjun1@huawei.com>", "Reviewed-by:", "Ben", "Hutchings", "<ben.hutchings@codethink.co.uk>", "Signed-off-by:", "Johannes", "Berg", "<johannes.berg@intel.com>"], "code_tokens": ["if", "(", "idx", ">", "=", "ARRAY_SIZE", "(", "hwsim_world_regdom_custom", ")", ")", "{", "kfree", "(", "hwname", ")", ";", "}</s>if", "(", "idx", ">", "=", "ARRAY_SIZE", "(", "hwsim_world_regdom_custom", ")", ")"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["WW-2414:", "Applied", "James", "Mitchell's", "patch", "for", "critical", "XSS", "bug", "to", "2.0.x", "tree", "git-svn-id:", "https://svn.apache.org/repos/asf/struts/struts2/branches/STRUTS_2_0_X@630740", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["String", "result", "=", "link", ".", "toString", "(", ");", "while", "(", "result", ".", "indexOf", "(", "\"<", "script", ">", "\")", ">", "0", ")", "{", "result", "=", "result", ".", "replaceAll", "(", "\"<", "script", ">", "\",", "\"", "script", "\"", ");", "}", "result", "=", "encodeResult", "?", "response", ".", "encodeURL", "(", "result", ")", ":", "result", ";</s>String", "result", ";", "result", "=", "encodeResult", "?", "response", ".", "encodeURL", "(", "link", ".", "toString", "(", "))", ":", "link", ".", "toString", "(", ");"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["nfsd:", "stricter", "decoding", "of", "write-like", "NFSv2/v3", "ops", "The", "NFSv2/v3", "code", "does", "not", "systematically", "check", "whether", "we", "decode", "past", "the", "end", "of", "the", "buffer.", "This", "generally", "appears", "to", "be", "harmless,", "but", "there", "are", "a", "few", "places", "where", "we", "do", "arithmetic", "on", "the", "pointers", "involved", "and", "don't", "account", "for", "the", "possibility", "that", "a", "length", "could", "be", "negative.", "Add", "checks", "to", "catch", "these.", "Reported-by:", "Tuomas", "Haanp\u00e4\u00e4", "<thaan@synopsys.com>", "Reported-by:", "Ari", "Kauppi", "<ari@synopsys.com>", "Reviewed-by:", "NeilBrown", "<neilb@suse.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "J.", "Bruce", "Fields", "<bfields@redhat.com>"], "code_tokens": ["if", "(", "(", "void", "*", ")", "p", ">", "head", "-", ">", "iov_base", "+", "head", "-", ">", "iov_len", ")", "return", "0", ";", "if", "(", "(", "void", "*", ")", "old", ">", "vec", "-", ">", "iov_base", "+", "vec", "-", ">", "iov_len", ")", "return", "0", ";", "if", "(", "hdr", ">", "head", "-", ">", "iov_len", ")", "return", "0", ";</s>"], "docstring_tokens": ["memory", "read"]}
{"contents": ["Add", "unit", "test", "for", "xss", "in", "data", "target", "attribute"], "code_tokens": ["QUnit", ".", "test", "(", "'", "should", "not", "parse", "target", "as", "html", "'", ",", "function", "(", "assert", ")", "{", "assert", ".", "expect", "(", "1", ")", "var", "done", "=", "assert", ".", "async", "(", ")", "var", "$", "toggleBtn", "=", "$", "('", "<", "button", "data", "-", "toggle", "=", "\"", "modal", "\"", "data", "-", "target", "=", "\"&", "lt", ";", "div", "id", "=", "&", "quot", ";", "modal", "-", "test", "&", "quot", ";", "&", "gt", ";", "&", "lt", ";", "div", "class", "=", "&", "quot", ";", "contents", "&", "quot", ";", "&", "lt", ";", "div", "&", "lt", ";", "div", "id", "=", "&", "quot", ";", "close", "&", "quot", ";", "data", "-", "dismiss", "=", "&", "quot", ";", "modal", "&", "quot", ";", "/&", "gt", ";", "&", "lt", ";", "/", "div", "&", "gt", ";", "&", "lt", ";", "/", "div", "&", "gt", ";", "\"/", ">'", ")", ".", "appendTo", "(", "'#", "qunit", "-", "fixture", "'", ")", "$", "toggleBtn", ".", "trigger", "(", "'", "click", "'", ")", "setTimeout", "(", "function", "(", ")", "{", "assert", ".", "strictEqual", "(", "$(", "'#", "modal", "-", "test", "'", ").", "length", ",", "0", ",", "'", "target", "has", "not", "been", "parsed", "and", "added", "to", "the", "document", "'", ")", "done", "(", ")", "}", ",", "1", ")", "}", ")", "QUnit", ".", "test", "(", "'", "should", "not", "execute", "js", "from", "target", "'", ",", "function", "(", "assert", ")", "{", "assert", ".", "expect", "(", "0", ")", "var", "done", "=", "assert", ".", "async", "(", ")", "/", "/", "This", "toggle", "button", "contains", "XSS", "payload", "in", "its", "data", "-", "target", "/", "/", "Note", ":", "it", "uses", "the", "onerror", "handler", "of", "an", "img", "element", "to", "execute", "the", "js", ",", "because", "a", "simple", "script", "element", "does", "not", "work", "here", "/", "/", "a", "script", "element", "works", "in", "manual", "tests", "though", ",", "so", "here", "it", "is", "likely", "blocked", "by", "the", "qunit", "framework", "var", "$", "toggleBtn", "=", "$", "('", "<", "button", "data", "-", "toggle", "=", "\"", "modal", "\"", "data", "-", "target", "=", "\"&", "lt", ";", "div", "&", "gt", ";", "&", "lt", ";", "image", "src", "=", "&", "quot", ";", "missing", ".", "png", "&", "quot", ";", "onerror", "=", "&", "quot", ";", "$(", "&", "apos", ";", "#", "qunit", "-", "fixture", "button", ".", "control", "&", "apos", ";", ").", "trigger", "(", "&", "apos", ";", "click", "&", "apos", ";", ")&", "quot", ";", "&", "gt", ";", "&", "lt", ";", "/", "div", "&", "gt", ";", "\"/", ">'", ")", ".", "appendTo", "(", "'#", "qunit", "-", "fixture", "'", ")", "/", "/", "The", "XSS", "payload", "above", "does", "not", "have", "a", "closure", "over", "this", "function", "and", "cannot", "access", "the", "assert", "object", "directly", "/", "/", "However", ",", "it", "can", "send", "a", "click", "event", "to", "the", "following", "control", "button", ",", "which", "will", "then", "fail", "the", "assert", "$", "('", "<", "button", ">", "')", ".", "addClass", "(", "'", "control", "'", ")", ".", "on", "(", "'", "click", "'", ",", "function", "(", ")", "{", "assert", ".", "notOk", "(", "true", ",", "'", "XSS", "payload", "is", "not", "executed", "as", "js", "'", ")", "}", ")", ".", "appendTo", "(", "'#", "qunit", "-", "fixture", "'", ")", "$", "toggleBtn", ".", "trigger", "(", "'", "click", "'", ")", "setTimeout", "(", "done", ",", "500", ")", "}", ")</s>"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["WELD-1802", "RequestScopedCache", "-", "Make", "sure", "each", "request", "is", "ended", "before", "a", "new", "one", "is", "started"], "code_tokens": ["/", "/", "if", "the", "previous", "request", "was", "not", "ended", "properly", "for", "some", "reason", ",", "make", "sure", "it", "is", "ended", "now", "endRequest", "(", ");", "CACHE", ".", "remove", "(", ");</s>CACHE", ".", "remove", "(", ");"], "docstring_tokens": ["race", "condition"]}
{"contents": ["[PATCH]", "Destruction", "of", "failed", "keyring", "oopses", "The", "attached", "patch", "makes", "sure", "that", "a", "keyring", "that", "failed", "to", "instantiate", "properly", "is", "destroyed", "without", "oopsing", "[CAN-2005-2099].", "The", "problem", "occurs", "in", "three", "stages:", "(1)", "The", "key", "allocator", "initialises", "the", "type-specific", "data", "to", "all", "zeroes.", "In", "the", "case", "of", "a", "keyring,", "this", "will", "become", "a", "link", "in", "the", "keyring", "name", "list", "when", "the", "keyring", "is", "instantiated.", "(2)", "If", "a", "user", "(any", "user)", "attempts", "to", "add", "a", "keyring", "with", "anything", "other", "than", "an", "empty", "payload,", "the", "keyring", "instantiation", "function", "will", "fail", "with", "an", "error", "and", "won't", "add", "the", "keyring", "to", "the", "name", "list.", "(3)", "The", "keyring's", "destructor", "then", "sees", "that", "the", "keyring", "has", "a", "description", "(name)", "and", "tries", "to", "remove", "the", "keyring", "from", "the", "name", "list,", "which", "oopses", "because", "the", "link", "pointers", "are", "both", "zero.", "This", "bug", "permits", "any", "user", "to", "take", "down", "a", "box", "trivially.", "Signed-Off-By:", "David", "Howells", "<dhowells@redhat.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["if", "(", "keyring", "-", ">", "type_data", ".", "link", ".", "next", "!", "=", "NULL", "&", "&", "!", "list_empty", "(", "&", "keyring", "-", ">", "type_data", ".", "link", ")", ")", "list_del", "(", "&", "keyring", "-", ">", "type_data", ".", "link", ")", ";</s>list_del", "(", "&", "keyring", "-", ">", "type_data", ".", "link", ")", ";"], "docstring_tokens": ["null", "dereference"]}
{"contents": ["mm:", "pmd_read_atomic:", "fix", "32bit", "PAE", "pmd", "walk", "vs", "pmd_populate", "SMP", "race", "condition", "When", "holding", "the", "mmap_sem", "for", "reading,", "pmd_offset_map_lock", "should", "only", "run", "on", "a", "pmd_t", "that", "has", "been", "read", "atomically", "from", "the", "pmdp", "pointer,", "otherwise", "we", "may", "read", "only", "half", "of", "it", "leading", "to", "this", "crash.", "PID:", "11679", "TASK:", "f06e8000", "CPU:", "3", "COMMAND:", "\"do_race_2_panic\"", "#0", "[f06a9dd8]", "crash_kexec", "at", "c049b5ec", "#1", "[f06a9e2c]", "oops_end", "at", "c083d1c2", "#2", "[f06a9e40]", "no_context", "at", "c0433ded", "#3", "[f06a9e64]", "bad_area_nosemaphore", "at", "c043401a", "#4", "[f06a9e6c]", "__do_page_fault", "at", "c0434493", "#5", "[f06a9eec]", "do_page_fault", "at", "c083eb45", "#6", "[f06a9f04]", "error_code", "(via", "page_fault)", "at", "c083c5d5", "EAX:", "01fb470c", "EBX:", "fff35000", "ECX:", "00000003", "EDX:", "00000100", "EBP:", "00000000", "DS:", "007b", "ESI:", "9e201000", "ES:", "007b", "EDI:", "01fb4700", "GS:", "00e0", "CS:", "0060", "EIP:", "c083bc14", "ERR:", "ffffffff", "EFLAGS:", "00010246", "#7", "[f06a9f38]", "_spin_lock", "at", "c083bc14", "#8", "[f06a9f44]", "sys_mincore", "at", "c0507b7d", "#9", "[f06a9fb0]", "system_call", "at", "c083becd", "start", "len", "EAX:", "ffffffda", "EBX:", "9e200000", "ECX:", "00001000", "EDX:", "6228537f", "DS:", "007b", "ESI:", "00000000", "ES:", "007b", "EDI:", "003d0f00", "SS:", "007b", "ESP:", "62285354", "EBP:", "62285388", "GS:", "0033", "CS:", "0073", "EIP:", "00291416", "ERR:", "000000da", "EFLAGS:", "00000286", "This", "should", "be", "a", "longstanding", "bug", "affecting", "x86", "32bit", "PAE", "without", "THP.", "Only", "archs", "with", "64bit", "large", "pmd_t", "and", "32bit", "unsigned", "long", "should", "be", "affected.", "With", "THP", "enabled", "the", "barrier()", "in", "pmd_none_or_trans_huge_or_clear_bad()", "would", "partly", "hide", "the", "bug", "when", "the", "pmd", "transition", "from", "none", "to", "stable,", "by", "forcing", "a", "re-read", "of", "the", "*pmd", "in", "pmd_offset_map_lock,", "but", "when", "THP", "is", "enabled", "a", "new", "set", "of", "problem", "arises", "by", "the", "fact", "could", "then", "transition", "freely", "in", "any", "of", "the", "none,", "pmd_trans_huge", "or", "pmd_trans_stable", "states.", "So", "making", "the", "barrier", "in", "pmd_none_or_trans_huge_or_clear_bad()", "unconditional", "isn't", "good", "idea", "and", "it", "would", "be", "a", "flakey", "solution.", "This", "should", "be", "fully", "fixed", "by", "introducing", "a", "pmd_read_atomic", "that", "reads", "the", "pmd", "in", "order", "with", "THP", "disabled,", "or", "by", "reading", "the", "pmd", "atomically", "with", "cmpxchg8b", "with", "THP", "enabled.", "Luckily", "this", "new", "race", "condition", "only", "triggers", "in", "the", "places", "that", "must", "already", "be", "covered", "by", "pmd_none_or_trans_huge_or_clear_bad()", "so", "the", "fix", "is", "localized", "there", "but", "this", "bug", "is", "not", "related", "to", "THP.", "NOTE:", "this", "can", "trigger", "on", "x86", "32bit", "systems", "with", "PAE", "enabled", "with", "more", "than", "4G", "of", "ram,", "otherwise", "the", "high", "part", "of", "the", "pmd", "will", "never", "risk", "to", "be", "truncated", "because", "it", "would", "be", "zero", "at", "all", "times,", "in", "turn", "so", "hiding", "the", "SMP", "race.", "This", "bug", "was", "discovered", "and", "fully", "debugged", "by", "Ulrich,", "quote:", "----", "[..]", "pmd_none_or_trans_huge_or_clear_bad()", "loads", "the", "content", "of", "edx", "and", "eax.", "496", "static", "inline", "int", "pmd_none_or_trans_huge_or_clear_bad(pmd_t", "*pmd)", "497", "{", "498", "/*", "depend", "on", "compiler", "for", "an", "atomic", "pmd", "read", "*/", "499", "pmd_t", "pmdval", "=", "*pmd;", "//", "edi", "=", "pmd", "pointer", "0xc0507a74", "<sys_mincore+548>:", "mov", "0x8(%esp),%edi", "...", "//", "edx", "=", "PTE", "page", "table", "high", "address", "0xc0507a84", "<sys_mincore+564>:", "mov", "0x4(%edi),%edx", "...", "//", "eax", "=", "PTE", "page", "table", "low", "address", "0xc0507a8e", "<sys_mincore+574>:", "mov", "(%edi),%eax", "[..]", "Please", "note", "that", "the", "PMD", "is", "not", "read", "atomically.", "These", "are", "two", "\"mov\"", "instructions", "where", "the", "high", "order", "bits", "of", "the", "PMD", "entry", "are", "fetched", "first.", "Hence,", "the", "above", "machine", "code", "is", "prone", "to", "the", "following", "race.", "-", "The", "PMD", "entry", "{high|low}", "is", "0x0000000000000000.", "The", "\"mov\"", "at", "0xc0507a84", "loads", "0x00000000", "into", "edx.", "-", "A", "page", "fault", "(on", "another", "CPU)", "sneaks", "in", "between", "the", "two", "\"mov\"", "instructions", "and", "instantiates", "the", "PMD.", "-", "The", "PMD", "entry", "{high|low}", "is", "now", "0x00000003fda38067.", "The", "\"mov\"", "at", "0xc0507a8e", "loads", "0xfda38067", "into", "eax.", "----", "Reported-by:", "Ulrich", "Obergfell", "<uobergfe@redhat.com>", "Signed-off-by:", "Andrea", "Arcangeli", "<aarcange@redhat.com>", "Cc:", "Mel", "Gorman", "<mgorman@suse.de>", "Cc:", "Hugh", "Dickins", "<hughd@google.com>", "Cc:", "Larry", "Woodman", "<lwoodman@redhat.com>", "Cc:", "Petr", "Matousek", "<pmatouse@redhat.com>", "Cc:", "Rik", "van", "Riel", "<riel@redhat.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["#", "define", "pmd_read_atomic", "pmd_read_atomic", "/", "*", "*", "pte_offset_map_lock", "on", "32bit", "PAE", "kernels", "was", "reading", "the", "pmd_t", "with", "*", "a", "\"", "*", "pmdp", "\"", "dereference", "done", "by", "gcc", ".", "Problem", "is", ",", "in", "certain", "places", "*", "where", "pte_offset_map_lock", "is", "called", ",", "concurrent", "page", "faults", "are", "*", "allowed", ",", "if", "the", "mmap_sem", "is", "hold", "for", "reading", ".", "An", "example", "is", "mincore", "*", "vs", "page", "faults", "vs", "MADV_DONTNEED", ".", "On", "the", "page", "fault", "side", "*", "pmd_populate", "rightfully", "does", "a", "set_64bit", ",", "but", "if", "we", "'", "re", "reading", "the", "*", "pmd_t", "with", "a", "\"", "*", "pmdp", "\"", "on", "the", "mincore", "side", ",", "a", "SMP", "race", "can", "happen", "*", "because", "gcc", "will", "not", "read", "the", "64bit", "of", "the", "pmd", "atomically", ".", "To", "fix", "*", "this", "all", "places", "running", "pmd_offset_map_lock", "(", ")", "while", "holding", "the", "*", "mmap_sem", "in", "read", "mode", ",", "shall", "read", "the", "pmdp", "pointer", "using", "this", "*", "function", "to", "know", "if", "the", "pmd", "is", "null", "nor", "not", ",", "and", "in", "turn", "to", "know", "if", "*", "they", "can", "run", "pmd_offset_map_lock", "or", "pmd_trans_huge", "or", "other", "pmd", "*", "operations", ".", "*", "*", "Without", "THP", "if", "the", "mmap_sem", "is", "hold", "for", "reading", ",", "the", "*", "pmd", "can", "only", "transition", "from", "null", "to", "not", "null", "while", "pmd_read_atomic", "runs", ".", "*", "So", "there", "'", "s", "no", "need", "of", "literally", "reading", "it", "atomically", ".", "*", "*", "With", "THP", "if", "the", "mmap_sem", "is", "hold", "for", "reading", ",", "the", "pmd", "can", "become", "*", "THP", "or", "null", "or", "point", "to", "a", "pte", "(", "and", "in", "turn", "become", "\"", "stable", "\"", ")", "at", "any", "*", "time", "under", "pmd_read_atomic", ",", "so", "it", "'", "s", "mandatory", "to", "read", "it", "atomically", "*", "with", "cmpxchg8b", ".", "*", "/", "#", "ifndef", "CONFIG_TRANSPARENT_HUGEPAGE", "static", "inline", "pmd_t", "pmd_read_atomic", "(", "pmd_t", "*", "pmdp", ")", "{", "pmdval_t", "ret", ";", "u32", "*", "tmp", "=", "(", "u32", "*", ")", "pmdp", ";", "ret", "=", "(", "pmdval_t", ")", "(", "*", "tmp", ")", ";", "if", "(", "ret", ")", "{", "/", "*", "*", "If", "the", "low", "part", "is", "null", ",", "we", "must", "not", "read", "the", "high", "part", "*", "or", "we", "can", "end", "up", "with", "a", "partial", "pmd", ".", "*", "/", "smp_rmb", "(", ");", "ret", "|", "=", "(", "(", "pmdval_t", ")", "*(", "tmp", "+", "1", ")", ")", "<", "<", "32", ";", "}", "return", "(", "pmd_t", ")", "{", "ret", "}", ";", "}", "#", "else", "/", "*", "CONFIG_TRANSPARENT_HUGEPAGE", "*", "/", "static", "inline", "pmd_t", "pmd_read_atomic", "(", "pmd_t", "*", "pmdp", ")", "{", "return", "(", "pmd_t", ")", "{", "atomic64_read", "(", "(", "atomic64_t", "*", ")", "pmdp", ")", "}", ";", "}", "#", "endif", "/", "*", "CONFIG_TRANSPARENT_HUGEPAGE", "*", "/", "#", "ifndef", "pmd_read_atomic", "static", "inline", "pmd_t", "pmd_read_atomic", "(", "pmd_t", "*", "pmdp", ")", "{", "/", "*", "*", "Depend", "on", "compiler", "for", "an", "atomic", "pmd", "read", ".", "NOTE", ":", "this", "is", "*", "only", "going", "to", "work", ",", "if", "the", "pmdval_t", "isn", "'", "t", "larger", "than", "*", "an", "unsigned", "long", ".", "*", "/", "return", "*", "pmdp", ";", "}", "#", "endif", "*", "*", "For", "32bit", "kernels", "with", "a", "64bit", "large", "pmd_t", "this", "automatically", "takes", "*", "care", "of", "reading", "the", "pmd", "atomically", "to", "avoid", "SMP", "race", "conditions", "*", "against", "pmd_populate", "(", ")", "when", "the", "mmap_sem", "is", "hold", "for", "reading", "by", "the", "*", "caller", "(", "a", "special", "atomic", "read", "not", "done", "by", "\"", "gcc", "\"", "as", "in", "the", "generic", "*", "version", "above", ",", "is", "also", "needed", "when", "THP", "is", "disabled", "because", "the", "page", "*", "fault", "can", "populate", "the", "pmd", "from", "under", "us", ")", ".", "pmd_t", "pmdval", "=", "pmd_read_atomic", "(", "pmd", ")", ";</s>/", "*", "depend", "on", "compiler", "for", "an", "atomic", "pmd", "read", "*", "/", "pmd_t", "pmdval", "=", "*", "pmd", ";"], "docstring_tokens": ["race", "condition"]}
{"contents": ["net:", "bpf_jit:", "fix", "an", "off-one", "bug", "in", "x86_64", "cond", "jump", "target", "x86", "jump", "instruction", "size", "is", "2", "or", "5", "bytes", "(near/long", "jump),", "not", "2", "or", "6", "bytes.", "In", "case", "a", "conditional", "jump", "is", "followed", "by", "a", "long", "jump,", "conditional", "jump", "target", "is", "one", "byte", "past", "the", "start", "of", "target", "instruction.", "Signed-off-by:", "Markus", "K\u00f6tter", "<nepenthesdev@gmail.com>", "Signed-off-by:", "Eric", "Dumazet", "<eric.dumazet@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "filter", "[", "i", "]", ".", "jf", "&", "&", "f_offset", ")", "t_offset", "+", "=", "is_near", "(", "f_offset", ")", "?", "2", ":", "5", ";</s>if", "(", "filter", "[", "i", "]", ".", "jf", ")", "t_offset", "+", "=", "is_near", "(", "f_offset", ")", "?", "2", ":", "6", ";"], "docstring_tokens": ["off-by-one", "error"]}
{"contents": ["rose:", "Add", "length", "checks", "to", "CALL_REQUEST", "parsing", "Define", "some", "constant", "offsets", "for", "CALL_REQUEST", "based", "on", "the", "description", "at", "<http://www.techfest.com/networking/wan/x25plp.htm>", "and", "the", "definition", "of", "ROSE", "as", "using", "10-digit", "(5-byte)", "addresses.", "Use", "them", "consistently.", "Validate", "all", "implicit", "and", "explicit", "facilities", "lengths.", "Validate", "the", "address", "length", "byte", "rather", "than", "either", "trusting", "or", "assuming", "its", "value.", "Signed-off-by:", "Ben", "Hutchings", "<ben@decadent.org.uk>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["#", "define", "ROSE_CALL_REQ_ADDR_LEN_OFF", "3", "#", "define", "ROSE_CALL_REQ_ADDR_LEN_VAL", "0xAA", "/", "*", "each", "address", "is", "10", "digits", "*", "/", "#", "define", "ROSE_CALL_REQ_DEST_ADDR_OFF", "4", "#", "define", "ROSE_CALL_REQ_SRC_ADDR_OFF", "9", "#", "define", "ROSE_CALL_REQ_FACILITIES_OFF", "14", "extern", "int", "rose_parse_facilities", "(", "unsigned", "char", "*", ",", "unsigned", "int", ",", "struct", "rose_facilities_struct", "*", ");", "int", "n", ";", "if", "(", "!", "rose_parse_facilities", "(", "skb", "-", ">", "data", "+", "ROSE_CALL_REQ_FACILITIES_OFF", ",", "skb", "-", ">", "len", "-", "ROSE_CALL_REQ_FACILITIES_OFF", ",", "&", "facilities", ")", ")", "{", "if", "(", "skb", "-", ">", "len", "<", "ROSE_MIN_LEN", ")", "{", "kfree_skb", "(", "skb", ")", ";", "continue", ";", "}", "if", "(", "frametype", "=", "=", "ROSE_CALL_REQUEST", "&", "&", "(", "skb", "-", ">", "len", "<", "=", "ROSE_CALL_REQ_FACILITIES_OFF", "|", "|", "skb", "-", ">", "data", "[", "ROSE_CALL_REQ_ADDR_LEN_OFF", "]", "!", "=", "ROSE_CALL_REQ_ADDR_LEN_VAL", ")", ")", "{", "kfree_skb", "(", "skb", ")", ";", "continue", ";", "}", "dest", "=", "(", "rose_address", "*", ")(", "skb", "-", ">", "data", "+", "ROSE_CALL_REQ_DEST_ADDR_OFF", ")", ";", "int", "res", "=", "0", ";", "if", "(", "skb", "-", ">", "len", "<", "ROSE_MIN_LEN", ")", "return", "res", ";", "if", "(", "frametype", "=", "=", "ROSE_CALL_REQUEST", "&", "&", "(", "skb", "-", ">", "len", "<", "=", "ROSE_CALL_REQ_FACILITIES_OFF", "|", "|", "skb", "-", ">", "data", "[", "ROSE_CALL_REQ_ADDR_LEN_OFF", "]", "!", "=", "ROSE_CALL_REQ_ADDR_LEN_VAL", ")", ")", "return", "res", ";", "src_addr", "=", "(", "rose_address", "*", ")(", "skb", "-", ">", "data", "+", "ROSE_CALL_REQ_SRC_ADDR_OFF", ")", ";", "dest_addr", "=", "(", "rose_address", "*", ")(", "skb", "-", ">", "data", "+", "ROSE_CALL_REQ_DEST_ADDR_OFF", ")", ";", "if", "(", "!", "rose_parse_facilities", "(", "skb", "-", ">", "data", "+", "ROSE_CALL_REQ_FACILITIES_OFF", ",", "skb", "-", ">", "len", "-", "ROSE_CALL_REQ_FACILITIES_OFF", ",", "&", "facilities", ")", ")", "{", "*", "dptr", "+", "+", "=", "ROSE_CALL_REQ_ADDR_LEN_VAL", ";", "if", "(", "len", "<", "2", ")", "return", "-", "1", ";", "if", "(", "len", "<", "3", ")", "return", "-", "1", ";", "if", "(", "len", "<", "4", ")", "return", "-", "1", ";", "if", "(", "len", "<", "2", ")", "return", "-", "1", ";", "if", "(", "len", "<", "2", "+", "l", ")", "return", "-", "1", ";", "if", "(", "l", "<", "AX25_ADDR_LEN", ")", "return", "-", "1", ";", "if", "(", "l", "<", "AX25_ADDR_LEN", ")", "return", "-", "1", ";", "if", "(", "l", "<", "AX25_ADDR_LEN", ")", "return", "-", "1", ";", "if", "(", "l", "<", "1", "+", "ROSE_ADDR_LEN", ")", "return", "-", "1", ";", "if", "(", "l", "%", "AX25_ADDR_LEN", ")", "return", "-", "1", ";", "if", "(", "len", "<", "2", ")", "return", "-", "1", ";", "if", "(", "len", "<", "3", ")", "return", "-", "1", ";", "if", "(", "len", "<", "4", ")", "return", "-", "1", ";", "if", "(", "len", "<", "2", ")", "return", "-", "1", ";", "int", "rose_parse_facilities", "(", "unsigned", "char", "*", "p", ",", "unsigned", "packet_len", ",", "if", "(", "facilities_len", "=", "=", "0", "|", "|", "(", "unsigned", ")", "facilities_len", ">", "packet_len", ")", "while", "(", "facilities_len", ">", "=", "3", "&", "&", "*", "p", "=", "=", "0x00", ")", "{", "facilities_len", "-", "-;", "p", "+", "+;", "switch", "(", "*", "p", ")", "{", "case", "FAC_NATIONAL", ":", "/", "*", "National", "*", "/", "len", "=", "rose_parse_national", "(", "p", "+", "1", ",", "facilities", ",", "facilities_len", "-", "1", ")", ";", "break", ";", "case", "FAC_CCITT", ":", "/", "*", "CCITT", "*", "/", "len", "=", "rose_parse_ccitt", "(", "p", "+", "1", ",", "facilities", ",", "facilities_len", "-", "1", ")", ";", "break", ";", "default", ":", "printk", "(", "KERN_DEBUG", "\"", "ROSE", ":", "rose_parse_facilities", "-", "unknown", "facilities", "family", "%", "02X", "\\", "n", "\"", ",", "*", "p", ")", ";", "len", "=", "1", ";", "break", ";", "}", "if", "(", "len", "<", "0", ")", "return", "0", ";", "if", "(", "WARN_ON", "(", "len", ">", "=", "facilities_len", ")", ")", "return", "0", ";", "facilities_len", "-", "=", "len", "+", "1", ";", "p", "+", "=", "len", "+", "1", ";", "return", "facilities_len", "=", "=", "0", ";</s>extern", "int", "rose_parse_facilities", "(", "unsigned", "char", "*", ",", "struct", "rose_facilities_struct", "*", ");", "int", "n", ",", "len", ";", "len", "=", "(", "((", "skb", "-", ">", "data", "[", "3", "]", ">", ">", "4", ")", "&", "0x0F", ")", "+", "1", ")", ">", ">", "1", ";", "len", "+", "=", "(", "((", "skb", "-", ">", "data", "[", "3", "]", ">", ">", "0", ")", "&", "0x0F", ")", "+", "1", ")", ">", ">", "1", ";", "if", "(", "!", "rose_parse_facilities", "(", "skb", "-", ">", "data", "+", "len", "+", "4", ",", "&", "facilities", ")", ")", "{", "dest", "=", "(", "rose_address", "*", ")(", "skb", "-", ">", "data", "+", "4", ")", ";", "int", "len", ",", "res", "=", "0", ";", "src_addr", "=", "(", "rose_address", "*", ")(", "skb", "-", ">", "data", "+", "9", ")", ";", "dest_addr", "=", "(", "rose_address", "*", ")(", "skb", "-", ">", "data", "+", "4", ")", ";", "len", "=", "(", "((", "skb", "-", ">", "data", "[", "3", "]", ">", ">", "4", ")", "&", "0x0F", ")", "+", "1", ")", ">", ">", "1", ";", "len", "+", "=", "(", "((", "skb", "-", ">", "data", "[", "3", "]", ">", ">", "0", ")", "&", "0x0F", ")", "+", "1", ")", ">", ">", "1", ";", "if", "(", "!", "rose_parse_facilities", "(", "skb", "-", ">", "data", "+", "len", "+", "4", ",", "&", "facilities", ")", ")", "{", "*", "dptr", "+", "+", "=", "0xAA", ";", "int", "rose_parse_facilities", "(", "unsigned", "char", "*", "p", ",", "if", "(", "facilities_len", "=", "=", "0", ")", "while", "(", "facilities_len", ">", "0", ")", "{", "if", "(", "*", "p", "=", "=", "0x00", ")", "{", "facilities_len", "-", "-;", "p", "+", "+;", "switch", "(", "*", "p", ")", "{", "case", "FAC_NATIONAL", ":", "/", "*", "National", "*", "/", "len", "=", "rose_parse_national", "(", "p", "+", "1", ",", "facilities", ",", "facilities_len", "-", "1", ")", ";", "if", "(", "len", "<", "0", ")", "return", "0", ";", "facilities_len", "-", "=", "len", "+", "1", ";", "p", "+", "=", "len", "+", "1", ";", "break", ";", "case", "FAC_CCITT", ":", "/", "*", "CCITT", "*", "/", "len", "=", "rose_parse_ccitt", "(", "p", "+", "1", ",", "facilities", ",", "facilities_len", "-", "1", ")", ";", "if", "(", "len", "<", "0", ")", "return", "0", ";", "facilities_len", "-", "=", "len", "+", "1", ";", "p", "+", "=", "len", "+", "1", ";", "break", ";", "default", ":", "printk", "(", "KERN_DEBUG", "\"", "ROSE", ":", "rose_parse_facilities", "-", "unknown", "facilities", "family", "%", "02X", "\\", "n", "\"", ",", "*", "p", ")", ";", "facilities_len", "-", "-;", "p", "+", "+;", "break", ";", "}", "}", "else", "break", ";", "/", "*", "Error", "in", "facilities", "format", "*", "/", "return", "1", ";"], "docstring_tokens": ["buffer", "overflows"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/1201"], "code_tokens": ["{", "DestroyJNG", "(", "NULL", ",", "&", "color_image", ",", "&", "color_image_info", ",", "&", "alpha_image", ",", "&", "alpha_image_info", ")", ";", "ThrowReaderException", "(", "ResourceLimitError", ",", "\"", "MemoryAllocationFailed", "\"", ");", "}", "{", "DestroyJNG", "(", "chunk", ",", "&", "color_image", ",", "&", "color_image_info", ",", "&", "alpha_image", ",", "&", "alpha_image_info", ")", ";", "ThrowReaderException", "(", "CorruptImageError", ",", "\"", "NegativeOrZeroImageSize", "\"", ");", "}", "#", "Generated", "by", "GNU", "Autoconf", "2", ".", "69", "for", "ImageMagick", "7", ".", "0", ".", "8", "-", "6", ".", "PACKAGE_VERSION", "=", "'", "7", ".", "0", ".", "8", "-", "6", "'", "PACKAGE_STRING", "=", "'", "ImageMagick", "7", ".", "0", ".", "8", "-", "6", "'", "\\", "`", "configure", "'", "configures", "ImageMagick", "7", ".", "0", ".", "8", "-", "6", "to", "adapt", "to", "many", "kinds", "of", "systems", ".", "short", "|", "recursive", ")", "echo", "\"", "Configuration", "of", "ImageMagick", "7", ".", "0", ".", "8", "-", "6", ":", "\";", ";", "ImageMagick", "configure", "7", ".", "0", ".", "8", "-", "6", "It", "was", "created", "by", "ImageMagick", "$", "as_me", "7", ".", "0", ".", "8", "-", "6", ",", "which", "was", "VERSION", "=", "'", "7", ".", "0", ".", "8", "-", "6", "'", "MAGICK_PATCHLEVEL_VERSION", "=", "6", "MAGICK_VERSION", "=", "7", ".", "0", ".", "8", "-", "6", "MAGICK_GIT_REVISION", "=", "14516", ":", "c7537dd70", ":", "20180705", "This", "file", "was", "extended", "by", "ImageMagick", "$", "as_me", "7", ".", "0", ".", "8", "-", "6", ",", "which", "was", "ImageMagick", "config", ".", "status", "7", ".", "0", ".", "8", "-", "6</s>ThrowReaderException", "(", "ResourceLimitError", ",", "\"", "MemoryAllocationFailed", "\"", ");", "{", "DestroyJNG", "(", "chunk", ",", "&", "color_image", ",", "&", "color_image_info", ",", "&", "alpha_image", ",", "&", "alpha_image_info", ")", ";", "ThrowReaderException", "(", "CorruptImageError", ",", "\"", "NegativeOrZeroImageSize", "\"", ");", "}", "#", "Generated", "by", "GNU", "Autoconf", "2", ".", "69", "for", "ImageMagick", "7", ".", "0", ".", "8", "-", "5", ".", "PACKAGE_VERSION", "=", "'", "7", ".", "0", ".", "8", "-", "5", "'", "PACKAGE_STRING", "=", "'", "ImageMagick", "7", ".", "0", ".", "8", "-", "5", "'", "\\", "`", "configure", "'", "configures", "ImageMagick", "7", ".", "0", ".", "8", "-", "5", "to", "adapt", "to", "many", "kinds", "of", "systems", ".", "short", "|", "recursive", ")", "echo", "\"", "Configuration", "of", "ImageMagick", "7", ".", "0", ".", "8", "-", "5", ":", "\";", ";", "ImageMagick", "configure", "7", ".", "0", ".", "8", "-", "5", "It", "was", "created", "by", "ImageMagick", "$", "as_me", "7", ".", "0", ".", "8", "-", "5", ",", "which", "was", "VERSION", "=", "'", "7", ".", "0", ".", "8", "-", "5", "'", "MAGICK_PATCHLEVEL_VERSION", "=", "5", "MAGICK_VERSION", "=", "7", ".", "0", ".", "8", "-", "5", "MAGICK_GIT_REVISION", "=", "14506", ":", "0e75f0a50", ":", "20180703", "This", "file", "was", "extended", "by", "ImageMagick", "$", "as_me", "7", ".", "0", ".", "8", "-", "5", ",", "which", "was", "ImageMagick", "config", ".", "status", "7", ".", "0", ".", "8", "-", "5"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["xfs:", "More", "robust", "inode", "extent", "count", "validation", "When", "the", "inode", "is", "in", "extent", "format,", "it", "can't", "have", "more", "extents", "that", "fit", "in", "the", "inode", "fork.", "We", "don't", "currenty", "check", "this,", "and", "so", "this", "corruption", "goes", "unnoticed", "by", "the", "inode", "verifiers.", "This", "can", "lead", "to", "crashes", "operating", "on", "invalid", "in-memory", "structures.", "Attempts", "to", "access", "such", "a", "inode", "will", "now", "error", "out", "in", "the", "verifier", "rather", "than", "allowing", "modification", "operations", "to", "proceed.", "Reported-by:", "Wen", "Xu", "<wen.xu@gatech.edu>", "Signed-off-by:", "Dave", "Chinner", "<dchinner@redhat.com>", "Reviewed-by:", "Darrick", "J.", "Wong", "<darrick.wong@oracle.com>", "[darrick:", "fix", "a", "typedef,", "add", "some", "braces", "and", "breaks", "to", "shut", "up", "compiler", "warnings]", "Signed-off-by:", "Darrick", "J.", "Wong", "<darrick.wong@oracle.com>"], "code_tokens": ["#", "define", "XFS_DFORK_MAXEXT", "(", "dip", ",", "mp", ",", "w", ")", "\\", "(", "XFS_DFORK_SIZE", "(", "dip", ",", "mp", ",", "w", ")", "/", "sizeof", "(", "struct", "xfs_bmbt_rec", ")", ")", "static", "xfs_failaddr_t", "xfs_dinode_verify_fork", "(", "struct", "xfs_dinode", "*", "dip", ",", "struct", "xfs_mount", "*", "mp", ",", "int", "whichfork", ")", "{", "uint32_t", "di_nextents", "=", "XFS_DFORK_NEXTENTS", "(", "dip", ",", "whichfork", ")", ";", "switch", "(", "XFS_DFORK_FORMAT", "(", "dip", ",", "whichfork", ")", ")", "{", "case", "XFS_DINODE_FMT_LOCAL", ":", "/", "*", "*", "no", "local", "regular", "files", "yet", "*", "/", "if", "(", "whichfork", "=", "=", "XFS_DATA_FORK", ")", "{", "if", "(", "S_ISREG", "(", "be16_to_cpu", "(", "dip", "-", ">", "di_mode", ")", "))", "return", "__this_address", ";", "if", "(", "be64_to_cpu", "(", "dip", "-", ">", "di_size", ")", ">", "XFS_DFORK_SIZE", "(", "dip", ",", "mp", ",", "whichfork", ")", ")", "return", "__this_address", ";", "}", "if", "(", "di_nextents", ")", "return", "__this_address", ";", "break", ";", "case", "XFS_DINODE_FMT_EXTENTS", ":", "if", "(", "di_nextents", ">", "XFS_DFORK_MAXEXT", "(", "dip", ",", "mp", ",", "whichfork", ")", ")", "return", "__this_address", ";", "break", ";", "case", "XFS_DINODE_FMT_BTREE", ":", "if", "(", "whichfork", "=", "=", "XFS_ATTR_FORK", ")", "{", "if", "(", "di_nextents", ">", "MAXAEXTNUM", ")", "return", "__this_address", ";", "}", "else", "if", "(", "di_nextents", ">", "MAXEXTNUM", ")", "{", "return", "__this_address", ";", "}", "break", ";", "default", ":", "return", "__this_address", ";", "}", "return", "NULL", ";", "}", "fa", "=", "xfs_dinode_verify_fork", "(", "dip", ",", "mp", ",", "XFS_DATA_FORK", ")", ";", "if", "(", "fa", ")", "return", "fa", ";", "fa", "=", "xfs_dinode_verify_fork", "(", "dip", ",", "mp", ",", "XFS_ATTR_FORK", ")", ";", "if", "(", "fa", ")", "return", "fa", ";</s>switch", "(", "dip", "-", ">", "di_format", ")", "{", "case", "XFS_DINODE_FMT_LOCAL", ":", "/", "*", "*", "no", "local", "regular", "files", "yet", "*", "/", "if", "(", "S_ISREG", "(", "mode", ")", ")", "return", "__this_address", ";", "if", "(", "di_size", ">", "XFS_DFORK_DSIZE", "(", "dip", ",", "mp", ")", ")", "return", "__this_address", ";", "if", "(", "dip", "-", ">", "di_nextents", ")", "return", "__this_address", ";", "/", "*", "fall", "through", "*", "/", "case", "XFS_DINODE_FMT_EXTENTS", ":", "case", "XFS_DINODE_FMT_BTREE", ":", "break", ";", "default", ":", "return", "__this_address", ";", "}", "switch", "(", "dip", "-", ">", "di_aformat", ")", "{", "case", "XFS_DINODE_FMT_LOCAL", ":", "if", "(", "dip", "-", ">", "di_anextents", ")", "return", "__this_address", ";", "/", "*", "fall", "through", "*", "/", "case", "XFS_DINODE_FMT_EXTENTS", ":", "case", "XFS_DINODE_FMT_BTREE", ":", "break", ";", "default", ":", "return", "__this_address", ";", "}"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["[SECURITY-278]", "prevent", "information", "disclosure"], "code_tokens": ["import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "/", "**", "*", "<", "p", ">", "Retrieve", "an", "array", "with", "the", "directories", "required", "to", "go", "from", "parent", "to", "file", ".", "Like", "in", "a", "network", "where", "you", "can", "*", "trace", "for", "hops", ".", "</", "p", ">", "*", "*", "<", "p", ">", "For", "example", ",", "from", "/", "home", "/", "silb", "/", "archives", "to", "/", "home", "/", "silb", "/", "archives", "/", "images", "/", "1", ".", "png", ",", "the", "method", "will", "return", "an", "array", "*", "with", "images", "and", "1", ".", "png", ".", "</", "p", ">", "*", "@", "param", "file", "target", "file", "*", "@", "param", "parent", "parent", "file", "*", "@", "return", "an", "array", "with", "directories", "to", "go", "from", "{", "@", "code", "parent", "}", "to", "{", "@", "code", "file", "}", ".", "*", "/", "protected", "List", "<", "String", ">", "getRelativeFrom", "(", "FilePath", "file", ",", "FilePath", "parent", ")", "{", "String", "fileRemote", "=", "file", ".", "getRemote", "(", ");", "String", "parentRemote", "=", "parent", ".", "getRemote", "(", ");", "Path", "filePath", "=", "Paths", ".", "get", "(", "fileRemote", ")", ";", "Path", "parentPath", "=", "Paths", ".", "get", "(", "parentRemote", ")", ";", "Path", "relativePath", "=", "parentPath", ".", "relativize", "(", "filePath", ")", ";", "String", "[", "]", "paths", "=", "relativePath", ".", "toString", "(", ").", "split", "(", "\"/", "\")", ";", "List", "<", "String", ">", "list", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "list", ".", "add", "(", "\"/", "\")", ";", "for", "(", "String", "path", ":", "paths", ")", "{", "if", "(", "!", "path", ".", "trim", "(", ").", "equals", "(", "\"\"", "))", "{", "list", ".", "add", "(", "path", ")", ";", "}", "}", "return", "list", ";", "}", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "hudson", ".", "AbortException", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "import", "hudson", ".", "model", ".", "BuildListener", ";", "import", "hudson", ".", "model", ".", "Result", ";", "private", "static", "final", "long", "serialVersionUID", "=", "5537875107916417555L", ";", "File", "artifactsRootDir", "=", "build", ".", "getArtifactsDir", "(", ").", "getAbsoluteFile", "(", ");", "File", "artifactsDir", "=", "new", "File", "(", "artifactsRootDir", ",", "getBaseRootFolder", "(", "))", ";", "/", "/", "abort", "build", "if", "the", "gallery", "is", "using", "a", "file", "outside", "of", "the", "project", "artifacts", "directory", "if", "(", "!", "isChild", "(", "artifactsRootDir", ",", "artifactsDir", ")", ")", "{", "throw", "new", "AbortException", "(", "\"", "Invalid", "base", "root", "folder", ":", "\"", "+", "getBaseRootFolder", "(", "))", ";", "}", "FilePath", "artifactsPath", "=", "new", "FilePath", "(", "artifactsDir", ")", ";", "List", "<", "String", ">", "artifactsRelativeFile", "=", "getRelativeFrom", "(", "path", ",", "artifactsPath", ")", ";", "/", "**", "*", "Verify", "that", "the", "{", "@", "code", "child", "}", "file", "is", "a", "child", "node", "of", "the", "{", "@", "code", "parent", "}", "directory", "tree", ".", "File", "names", "are", "*", "normalised", "before", "the", "comparison", "(", "i", ".", "e", ".", ".", "./", "and", ".", "/", "are", "evaluated", ")", ".", "Uses", "Java", "8", "{", "@", "link", "java", ".", "nio", ".", "file", ".", "Path", "}", "*", "methods", ".", "*", "*", "@", "param", "parent", "parent", "file", "*", "@", "param", "child", "child", "file", "*", "@", "return", "{", "@", "code", "true", "}", "iff", "child", "is", "child", "directory", "of", "parent", "directory", "tree", "*", "/", "private", "boolean", "isChild", "(", "File", "parent", ",", "File", "child", ")", "{", "Path", "parentPath", "=", "Paths", ".", "get", "(", "parent", ".", "getAbsolutePath", "(", "))", ".", "normalize", "(", ").", "toAbsolutePath", "(", ");", "Path", "childPath", "=", "Paths", ".", "get", "(", "child", ".", "getAbsolutePath", "(", "))", ".", "normalize", "(", ").", "toAbsolutePath", "(", ");", "return", "childPath", ".", "startsWith", "(", "parentPath", ")", ";", "}", "public", "Object", "readResolve", "(", ")", "{</s>protected", "List", "<", "String", ">", "getRelativeFrom", "(", "FilePath", "file", ",", "FilePath", "parent", ")", "{", "List", "<", "String", ">", "path", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "FilePath", "temp", "=", "file", ";", "while", "(", "temp", ".", "getParent", "(", ")", "!", "=", "null", "&", "&", "!", "temp", ".", "getParent", "(", ").", "equals", "(", "parent", ")", ")", "{", "path", ".", "add", "(", "0", ",", "temp", ".", "getParent", "(", ").", "getName", "(", "))", ";", "temp", "=", "temp", ".", "getParent", "(", ");", "}", "path", ".", "add", "(", "file", ".", "getName", "(", "))", ";", "return", "path", ";", "}", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "model", ".", "BuildListener", ";", "import", "hudson", ".", "model", ".", "Result", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "private", "static", "final", "long", "serialVersionUID", "=", "5537875107916417554L", ";", "File", "artifactsDir", "=", "build", ".", "getArtifactsDir", "(", ").", "getAbsoluteFile", "(", ");", "FilePath", "artifactsPath", "=", "new", "FilePath", "(", "new", "File", "(", "artifactsDir", ".", "getAbsoluteFile", "(", "),", "getBaseRootFolder", "(", "))", ");", "List", "<", "String", ">", "artifactsRelativeFile", "=", "getRelativeFrom", "(", "path", ",", "artifactsPath", ".", "getParent", "(", "))", ";", "public", "Object", "readResolve", "(", ")", "{"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["fix", "chm", "parser"], "code_tokens": ["import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "Set", "<", "Integer", ">", "processed", "=", "new", "HashSet", "<", ">(", ");", "int", "nextBlock", "=", "PMGLheader", ".", "getBlockNext", "(", ");", "processed", ".", "add", "(", "i", ")", ";", "if", "(", "processed", ".", "contains", "(", "nextBlock", ")", ")", "{", "throw", "new", "ChmParsingException", "(", "\"", "already", "processed", "block", ";", "avoiding", "cycle", "\"", ");", "}", "i", "=", "nextBlock", ";", "System", ".", "out", ".", "println", "(", "\"", "done", "\"", ");</s>i", "=", "PMGLheader", ".", "getBlockNext", "(", ");"], "docstring_tokens": ["header", "command", "injection"]}
{"contents": ["SOLR-11971:", "Don't", "allow", "referal", "to", "external", "resources", "in", "DataImportHandler's", "dataConfig", "request", "parameter"], "code_tokens": ["Bug", "Fixes", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "*", "SOLR", "-", "11971", ":", "Don", "'", "t", "allow", "referal", "to", "external", "resources", "in", "DataImportHandler", "'", "s", "dataConfig", "request", "parameter", ".", "(", "\u9ea6", "\u9999", "\u6d53\u90c1", ",", "Uwe", "Schindler", ")", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "EmptyEntityResolver", ";", "void", "loadAndInit", "(", "String", "configStr", ")", "{", "void", "loadAndInit", "(", "InputSource", "configFile", ")", "{", "dbf", ".", "setValidating", "(", "false", ")", ";", "/", "/", "only", "enable", "xinclude", ",", "if", "XML", "is", "coming", "from", "safe", "source", "(", "local", "file", ")", "/", "/", "and", "a", "a", "SolrCore", "and", "SystemId", "is", "present", "(", "makes", "no", "sense", "otherwise", ")", ":", "/", "/", "only", "enable", "xinclude", "/", "external", "entities", ",", "if", "XML", "is", "coming", "from", "/", "/", "safe", "source", "(", "local", "file", ")", "and", "a", "a", "SolrCore", "and", "SystemId", "is", "present", ":", "if", "(", "core", "!", "=", "null", "&", "&", "configFile", ".", "getSystemId", "(", ")", "!", "=", "null", ")", "{", "}", "else", "{", "/", "/", "Don", "'", "t", "allow", "external", "entities", "without", "having", "a", "system", "ID", ":", "builder", ".", "setEntityResolver", "(", "EmptyEntityResolver", ".", "SAX_INSTANCE", ")", ";", "}", "public", "void", "testExternalEntity", "(", ")", "throws", "Exception", "{", "StringDataSource", ".", "xml", "=", "wellformedXml", ";", "/", "/", "This", "should", "not", "fail", "as", "external", "entities", "are", "replaced", "by", "an", "empty", "string", "during", "parsing", ":", "runFullImport", "(", "dataConfigWithEntity", ")", ";", "assertQ", "(", "req", "(", "\"*", ":*", "\")", ",", "\"", "//", "*[", "@", "numFound", "=", "'", "3", "'", "]\"", ");", "}", "private", "String", "dataConfigWithEntity", "=", "\"", "<!", "DOCTYPE", "dataConfig", "[", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "internalTerm", "\\", "\"", "node", "\\", "\">", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "externalTerm", "SYSTEM", "\\", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "external", "\\", "\">", "\\", "n", "\"", "+", "\"", "]>", "<", "dataConfig", ">", "\\", "n", "\"", "\"", "<", "dataSource", "name", "=", "\\\"", "str", "\\", "\"", "type", "=", "\\\"", "TestErrorHandling", "$", "StringDataSource", "\\", "\"", "/", ">\"", "\"", "<", "document", ">", "\\", "n", "\"", "\"", "<", "entity", "name", "=", "\\\"", "&", "internalTerm", ";", "\\\"", "dataSource", "=", "\\\"", "str", "\\", "\"", "processor", "=", "\\\"", "XPathEntityProcessor", "\\", "\"", "url", "=", "\\\"", "test", "\\", "\"", "forEach", "=", "\\\"", "/", "root", "/", "node", "\\", "\"", "onError", "=", "\\\"", "skip", "\\", "\">", "\\", "n", "\"", "\"", "<", "field", "column", "=", "\\\"", "id", "\\", "\"", "xpath", "=", "\\\"", "/", "root", "/", "node", "/", "id", "\\", "\">", "&", "externalTerm", ";", "</", "field", ">", "\\", "n", "\"", "\"", "<", "field", "column", "=", "\\\"", "desc", "\\", "\"", "xpath", "=", "\\\"", "/", "root", "/", "node", "/", "desc", "\\", "\"", "/", ">\\", "n", "\"", "\"", "<", "/", "entity", ">", "\\", "n", "\"", "\"", "<", "/", "document", ">", "\\", "n", "\"", "\"", "</", "dataConfig", ">", "\";</s>(", "No", "Changes", ")", "public", "void", "loadAndInit", "(", "String", "configStr", ")", "{", "public", "void", "loadAndInit", "(", "InputSource", "configFile", ")", "{", "/", "/", "only", "enable", "xinclude", ",", "if", "a", "a", "SolrCore", "and", "SystemId", "is", "present", "(", "makes", "no", "sense", "otherwise", ")", "if", "(", "core", "!", "=", "null", ")"], "docstring_tokens": ["xml", "external", "entity", "expansion", "(xxe"]}
{"contents": ["Fixed", "bug", "#66356", "(Heap", "Overflow", "Vulnerability", "in", "imagecrop())", "Initial", "fix", "was", "PHP", "stuff", "This", "one", "is", "libgd", "fix.", "-", "filter", "invalid", "crop", "size", "-", "dont", "try", "to", "copy", "on", "invalid", "position", "-", "fix", "crop", "size", "when", "out", "of", "src", "image", "-", "fix", "possible", "NULL", "deref", "-", "fix", "possible", "integer", "overfloow"], "code_tokens": [".", "Fixed", "bug", "#", "66356", "(", "Heap", "Overflow", "Vulnerability", "in", "imagecrop", "(", "))", ".", "(", "Laruence", ",", "Remi", ")", "/", "*", "check", "size", "*", "/", "if", "(", "crop", "-", ">", "width", "<", "=", "0", "|", "|", "crop", "-", ">", "height", "<", "=", "0", ")", "{", "return", "NULL", ";", "}", "/", "*", "allocate", "the", "requested", "size", "(", "could", "be", "only", "partially", "filled", ")", "*", "/", "if", "(", "dst", "=", "=", "NULL", ")", "{", "return", "NULL", ";", "}", "/", "*", "check", "position", "in", "the", "src", "image", "*", "/", "if", "(", "crop", "-", ">", "x", "<", "0", "|", "|", "crop", "-", ">", "x", ">", "=", "src", "-", ">", "sx", "|", "|", "crop", "-", ">", "y", "<", "0", "|", "|", "crop", "-", ">", "y", ">", "=", "src", "-", ">", "sy", ")", "{", "return", "dst", ";", "}", "/", "*", "reduce", "size", "if", "needed", "*", "/", "if", "(", "(", "src", "-", ">", "sx", "-", "crop", "-", ">", "width", ")", "<", "crop", "-", ">", "x", ")", "{", "crop", "-", ">", "width", "=", "src", "-", ">", "sx", "-", "crop", "-", ">", "x", ";", "if", "(", "(", "src", "-", ">", "sy", "-", "crop", "-", ">", "height", ")", "<", "crop", "-", ">", "y", ")", "{", "crop", "-", ">", "height", "=", "src", "-", ">", "sy", "-", "crop", "-", ">", "y", ";", "int", "y", "=", "crop", "-", ">", "y", ";", "if", "(", "src", "-", ">", "trueColor", ")", "{", "unsigned", "int", "dst_y", "=", "0", ";", "while", "(", "y", "<", "(", "crop", "-", ">", "y", "+", "(", "crop", "-", ">", "height", "-", "1", ")", "))", "{", "/", "*", "TODO", ":", "replace", "4", "w", "/", "byte", "per", "channel", "|", "|", "pitch", "once", "available", "*", "/", "memcpy", "(", "dst", "-", ">", "tpixels", "[", "dst_y", "+", "+]", ",", "src", "-", ">", "tpixels", "[", "y", "+", "+]", "+", "crop", "-", ">", "x", ",", "crop", "-", ">", "width", "*", "4", ")", ";", "}", "int", "x", ";", "for", "(", "y", "=", "crop", "-", ">", "y", ";", "y", "<", "(", "crop", "-", ">", "y", "+", "(", "crop", "-", ">", "height", "-", "1", ")", ");", "y", "+", "+)", "{", "for", "(", "x", "=", "crop", "-", ">", "x", ";", "x", "<", "(", "crop", "-", ">", "x", "+", "(", "crop", "-", ">", "width", "-", "1", ")", ");", "x", "+", "+)", "{", "dst", "-", ">", "pixels", "[", "y", "-", "crop", "-", ">", "y", "]", "[", "x", "-", "crop", "-", ">", "x", "]", "=", "src", "-", ">", "pixels", "[", "y", "]", "[", "x", "]", ";", "return", "dst", ";", "/", "/", "POC", "#", "1", "var_dump", "(", "imagecrop", "(", "$", "img", ",", "array", "(", "\"", "x", "\"", "=", ">", "\"", "a", "\"", ",", "\"", "y", "\"", "=", ">", "0", ",", "\"", "width", "\"", "=", ">", "10", ",", "\"", "height", "\"", "=", ">", "10", ")", "))", ";", "var_dump", "(", "imagecrop", "(", "$", "img", ",", "$", "arr", ")", ");", "/", "/", "POC", "#", "2", "var_dump", "(", "imagecrop", "(", "$", "img", ",", "array", "(", "\"", "x", "\"", "=", ">", "0", ",", "\"", "y", "\"", "=", ">", "0", ",", "\"", "width", "\"", "=", ">", "-", "1", ",", "\"", "height", "\"", "=", ">", "10", ")", "))", ";", "/", "/", "POC", "#", "3", "var_dump", "(", "imagecrop", "(", "$", "img", ",", "array", "(", "\"", "x", "\"", "=", ">", "-", "20", ",", "\"", "y", "\"", "=", ">", "-", "20", ",", "\"", "width", "\"", "=", ">", "10", ",", "\"", "height", "\"", "=", ">", "10", ")", "))", ";", "/", "/", "POC", "#", "4", "var_dump", "(", "imagecrop", "(", "$", "img", ",", "array", "(", "\"", "x", "\"", "=", ">", "0x7fffff00", ",", "\"", "y", "\"", "=", ">", "0", ",", "\"", "width", "\"", "=", ">", "10", ",", "\"", "height", "\"", "=", ">", "10", ")", "))", ";", "resource", "(", "%", "d", ")", "of", "type", "(", "gd", ")", "resource", "(", "%", "d", ")", "of", "type", "(", "gd", ")", "bool", "(", "false", ")", "resource", "(", "%", "d", ")", "of", "type", "(", "gd", ")", "resource", "(", "%", "d", ")", "of", "type", "(", "gd", ")</s>-", "GD", ":", ".", "Fixed", "bug", "#", "66356", "(", "Heap", "Overflow", "Vulnerability", "in", "imagecrop", "(", "))", ".", "(", "Laruence", ")", "if", "(", "src", "-", ">", "sx", "<", "(", "crop", "-", ">", "x", "+", "crop", "-", ">", "width", "-", "1", ")", ")", "{", "crop", "-", ">", "width", "=", "src", "-", ">", "sx", "-", "crop", "-", ">", "x", "+", "1", ";", "if", "(", "src", "-", ">", "sy", "<", "(", "crop", "-", ">", "y", "+", "crop", "-", ">", "height", "-", "1", ")", ")", "{", "crop", "-", ">", "height", "=", "src", "-", ">", "sy", "-", "crop", "-", ">", "y", "+", "1", ";", "if", "(", "dst", "=", "=", "NULL", ")", "{", "return", "NULL", ";", "int", "y", "=", "crop", "-", ">", "y", ";", "if", "(", "src", "-", ">", "trueColor", ")", "{", "unsigned", "int", "dst_y", "=", "0", ";", "while", "(", "y", "<", "(", "crop", "-", ">", "y", "+", "(", "crop", "-", ">", "height", "-", "1", ")", "))", "{", "/", "*", "TODO", ":", "replace", "4", "w", "/", "byte", "per", "channel", "|", "|", "pitch", "once", "available", "*", "/", "memcpy", "(", "dst", "-", ">", "tpixels", "[", "dst_y", "+", "+]", ",", "src", "-", ">", "tpixels", "[", "y", "+", "+]", "+", "crop", "-", ">", "x", ",", "crop", "-", ">", "width", "*", "4", ")", ";", "}", "}", "else", "{", "int", "x", ";", "for", "(", "y", "=", "crop", "-", ">", "y", ";", "y", "<", "(", "crop", "-", ">", "y", "+", "(", "crop", "-", ">", "height", "-", "1", ")", ");", "y", "+", "+)", "{", "for", "(", "x", "=", "crop", "-", ">", "x", ";", "x", "<", "(", "crop", "-", ">", "x", "+", "(", "crop", "-", ">", "width", "-", "1", ")", ");", "x", "+", "+)", "{", "dst", "-", ">", "pixels", "[", "y", "-", "crop", "-", ">", "y", "]", "[", "x", "-", "crop", "-", ">", "x", "]", "=", "src", "-", ">", "pixels", "[", "y", "]", "[", "x", "]", ";", "}", "return", "dst", ";", "-", "-", "FILE", "$", "img", "=", "imagecrop", "(", "$", "img", ",", "array", "(", "\"", "x", "\"", "=", ">", "\"", "a", "\"", ",", "\"", "y", "\"", "=", ">", "0", ",", "\"", "width", "\"", "=", ">", "10", ",", "\"", "height", "\"", "=", ">", "10", ")", ");", "$", "img", "=", "imagecrop", "(", "$", "img", ",", "$", "arr", ")", ";", "-", "-", "EXPECTF"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["RDS:", "null", "pointer", "dereference", "in", "rds_atomic_free_op", "set", "rm->atomic.op_active", "to", "0", "when", "rds_pin_pages()", "fails", "or", "the", "user", "supplied", "address", "is", "invalid,", "this", "prevents", "a", "NULL", "pointer", "usage", "in", "rds_atomic_free_op()", "Signed-off-by:", "Mohamed", "Ghannam", "<simo.ghannam@gmail.com>", "Acked-by:", "Santosh", "Shilimkar", "<santosh.shilimkar@oracle.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["rm", "-", ">", "atomic", ".", "op_active", "=", "0", ";</s>"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[SPARK-20922][CORE]", "Add", "whitelist", "of", "classes", "that", "can", "be", "deserialized", "by", "the", "launcher.", "Blindly", "deserializing", "classes", "using", "Java", "serialization", "opens", "the", "code", "up", "to", "issues", "in", "other", "libraries,", "since", "just", "deserializing", "data", "from", "a", "stream", "may", "end", "up", "execution", "code", "(think", "readObject()).", "Since", "the", "launcher", "protocol", "is", "pretty", "self-contained,", "there's", "just", "a", "handful", "of", "classes", "it", "legitimately", "needs", "to", "deserialize,", "and", "they're", "in", "just", "two", "packages,", "so", "add", "a", "filter", "that", "throws", "errors", "if", "classes", "from", "any", "other", "package", "show", "up", "in", "the", "stream.", "This", "also", "maintains", "backwards", "compatibility", "(the", "updated", "launcher", "code", "can", "still", "communicate", "with", "the", "backend", "code", "in", "older", "Spark", "releases).", "Tested", "with", "new", "and", "existing", "unit", "tests.", "Author:", "Marcelo", "Vanzin", "<vanzin@cloudera.com>", "Closes", "#18166", "from", "vanzin/SPARK-20922."], "code_tokens": ["/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "spark", ".", "launcher", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "An", "object", "input", "stream", "that", "only", "allows", "classes", "used", "by", "the", "launcher", "protocol", "to", "be", "in", "the", "*", "serialized", "stream", ".", "See", "SPARK", "-", "20922", ".", "*", "/", "class", "FilteredObjectInputStream", "extends", "ObjectInputStream", "{", "private", "static", "final", "List", "<", "String", ">", "ALLOWED_PACKAGES", "=", "Arrays", ".", "asList", "(", "\"", "org", ".", "apache", ".", "spark", ".", "launcher", ".", "\",", "\"", "java", ".", "lang", ".", "\")", ";", "FilteredObjectInputStream", "(", "InputStream", "is", ")", "throws", "IOException", "{", "super", "(", "is", ")", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "boolean", "isValid", "=", "ALLOWED_PACKAGES", ".", "stream", "(", ").", "anyMatch", "(", "p", "-", ">", "desc", ".", "getName", "(", ").", "startsWith", "(", "p", ")", ");", "if", "(", "!", "isValid", ")", "{", "throw", "new", "IllegalArgumentException", "(", "String", ".", "format", "(", "\"", "Unexpected", "class", "in", "stream", ":", "%", "s", "\"", ",", "desc", ".", "getName", "(", "))", ");", "}", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "6", "@", "@", "FilteredObjectInputStream", "in", "=", "new", "FilteredObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "@", "Test", "public", "void", "testStreamFiltering", "(", ")", "throws", "Exception", "{", "ChildProcAppHandle", "handle", "=", "LauncherServer", ".", "newAppHandle", "(", ");", "TestClient", "client", "=", "null", ";", "try", "{", "Socket", "s", "=", "new", "Socket", "(", "InetAddress", ".", "getLoopbackAddress", "(", "),", "LauncherServer", ".", "getServerInstance", "(", ").", "getPort", "(", "))", ";", "client", "=", "new", "TestClient", "(", "s", ")", ";", "client", ".", "send", "(", "new", "EvilPayload", "(", "))", ";", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "assertEquals", "(", "0", ",", "EvilPayload", ".", "EVIL_BIT", ")", ";", "}", "finally", "{", "kill", "(", "handle", ")", ";", "close", "(", "client", ")", ";", "client", ".", "clientThread", ".", "join", "(", ");", "}", "}", "/", "**", "*", "Try", "a", "few", "times", "to", "get", "a", "client", "-", "side", "error", ",", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "*", "server", "-", "side", "close", "immediately", ".", "*", "/", "private", "void", "waitForError", "(", "TestClient", "client", ",", "String", "secret", ")", "throws", "Exception", "{", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "secret", ",", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "error", "but", "message", "went", "through", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}", "}", "private", "static", "class", "EvilPayload", "extends", "LauncherProtocol", ".", "Message", "{", "static", "int", "EVIL_BIT", "=", "0", ";", "/", "/", "This", "field", "should", "cause", "the", "launcher", "server", "to", "throw", "an", "error", "and", "not", "deserialize", "the", "/", "/", "message", ".", "private", "List", "<", "String", ">", "notAllowedField", "=", "Arrays", ".", "asList", "(", "\"", "disallowed", "\"", ");", "private", "void", "readObject", "(", "ObjectInputStream", "stream", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "stream", ".", "defaultReadObject", "(", ");", "EVIL_BIT", "=", "1", ";", "}", "}</s>import", "java", ".", "io", ".", "ObjectInputStream", ";", "ObjectInputStream", "in", "=", "new", "ObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "/", "/", "Try", "a", "few", "times", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "server", "-", "side", "close", "/", "/", "immediately", ".", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "handle", ".", "getSecret", "(", "),", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "exception", "caused", "by", "connection", "timeout", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}"], "docstring_tokens": ["arbitrary", "code", "execution"]}
{"contents": ["Fix", "alternate", "chains", "certificate", "forgery", "issue", "During", "certificate", "verfification,", "OpenSSL", "will", "attempt", "to", "find", "an", "alternative", "certificate", "chain", "if", "the", "first", "attempt", "to", "build", "such", "a", "chain", "fails.", "An", "error", "in", "the", "implementation", "of", "this", "logic", "can", "mean", "that", "an", "attacker", "could", "cause", "certain", "checks", "on", "untrusted", "certificates", "to", "be", "bypassed,", "such", "as", "the", "CA", "flag,", "enabling", "them", "to", "use", "a", "valid", "leaf", "certificate", "to", "act", "as", "a", "CA", "and", "\"issue\"", "an", "invalid", "certificate.", "This", "occurs", "where", "at", "least", "one", "cert", "is", "added", "to", "the", "first", "chain", "from", "the", "trust", "store,", "but", "that", "chain", "still", "ends", "up", "being", "untrusted.", "In", "that", "case", "ctx->last_untrusted", "is", "decremented", "in", "error.", "Patch", "provided", "by", "the", "BoringSSL", "project.", "Reviewed-by:", "Stephen", "Henson", "<steve@openssl.org>"], "code_tokens": ["ctx", "-", ">", "last_untrusted", "=", "sk_X509_num", "(", "ctx", "-", ">", "chain", ")", ";</s>ctx", "-", ">", "last_untrusted", "-", "-;"], "docstring_tokens": ["alternative", "chains", "certificate", "forgery"]}
{"contents": ["perf/core:", "Fix", "the", "perf_cpu_time_max_percent", "check", "Use", "\"proc_dointvec_minmax\"", "instead", "of", "\"proc_dointvec\"", "to", "check", "the", "input", "value", "from", "user-space.", "If", "not,", "we", "can", "set", "a", "big", "value", "and", "some", "vars", "will", "overflow", "like", "\"sysctl_perf_event_sample_rate\"", "which", "will", "cause", "a", "lot", "of", "unexpected", "problems.", "Signed-off-by:", "Tan", "Xiaojun", "<tanxiaojun@huawei.com>", "Signed-off-by:", "Peter", "Zijlstra", "(Intel)", "<peterz@infradead.org>", "Cc:", "<acme@kernel.org>", "Cc:", "<alexander.shishkin@linux.intel.com>", "Cc:", "Alexander", "Shishkin", "<alexander.shishkin@linux.intel.com>", "Cc:", "Arnaldo", "Carvalho", "de", "Melo", "<acme@redhat.com>", "Cc:", "Jiri", "Olsa", "<jolsa@redhat.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Stephane", "Eranian", "<eranian@google.com>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "Vince", "Weaver", "<vincent.weaver@maine.edu>", "Link:", "http://lkml.kernel.org/r/1487829879-56237-1-git-send-email-tanxiaojun@huawei.com", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["int", "ret", "=", "proc_dointvec_minmax", "(", "table", ",", "write", ",", "buffer", ",", "lenp", ",", "ppos", ")", ";</s>int", "ret", "=", "proc_dointvec", "(", "table", ",", "write", ",", "buffer", ",", "lenp", ",", "ppos", ")", ";"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["patch", "XXE", "vulnerability"], "code_tokens": ["try", "{", "/", "/", "https", ":", "//", "www", ".", "owasp", ".", "org", "/", "index", ".", "php", "/", "XML_External_Entity_", "%", "28XXE", "%", "29_Processing", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";", "}", "/", "/", "https", ":", "//", "www", ".", "owasp", ".", "org", "/", "index", ".", "php", "/", "XML_External_Entity_", "%", "28XXE", "%", "29_Processing", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";</s>try", "{", "}"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["include/linux/poison.h:", "fix", "LIST_POISON{1,2}", "offset", "Poison", "pointer", "values", "should", "be", "small", "enough", "to", "find", "a", "room", "in", "non-mmap'able/hardly-mmap'able", "space.", "E.g.", "on", "x86", "\"poison", "pointer", "space\"", "is", "located", "starting", "from", "0x0.", "Given", "unprivileged", "users", "cannot", "mmap", "anything", "below", "mmap_min_addr,", "it", "should", "be", "safe", "to", "use", "poison", "pointers", "lower", "than", "mmap_min_addr.", "The", "current", "poison", "pointer", "values", "of", "LIST_POISON{1,2}", "might", "be", "too", "big", "for", "mmap_min_addr", "values", "equal", "or", "less", "than", "1", "MB", "(common", "case,", "e.g.", "Ubuntu", "uses", "only", "0x10000).", "There", "is", "little", "point", "to", "use", "such", "a", "big", "value", "given", "the", "\"poison", "pointer", "space\"", "below", "1", "MB", "is", "not", "yet", "exhausted.", "Changing", "it", "to", "a", "smaller", "value", "solves", "the", "problem", "for", "small", "mmap_min_addr", "setups.", "The", "values", "are", "suggested", "by", "Solar", "Designer:", "http://www.openwall.com/lists/oss-security/2015/05/02/6", "Signed-off-by:", "Vasily", "Kulikov", "<segoon@openwall.com>", "Cc:", "Solar", "Designer", "<solar@openwall.com>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "\"Kirill", "A.", "Shutemov\"", "<kirill.shutemov@linux.intel.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["#", "define", "LIST_POISON1", "(", "(", "void", "*", ")", "0x100", "+", "POISON_POINTER_DELTA", ")", "#", "define", "LIST_POISON2", "(", "(", "void", "*", ")", "0x200", "+", "POISON_POINTER_DELTA", ")</s>#", "define", "LIST_POISON1", "(", "(", "void", "*", ")", "0x00100100", "+", "POISON_POINTER_DELTA", ")", "#", "define", "LIST_POISON2", "(", "(", "void", "*", ")", "0x00200200", "+", "POISON_POINTER_DELTA", ")"], "docstring_tokens": ["kernel", "arbitrary", "execution"]}
{"contents": ["Add", "some", "sanity", "checks", "when", "checking", "CRL", "scores", "Note:", "this", "was", "accidentally", "omitted", "from", "OpenSSL", "1.0.2", "branch.", "Without", "this", "fix", "any", "attempt", "to", "use", "CRLs", "will", "crash.", "Thanks", "to", "Bruce", "Stephens", "and", "Thomas", "Jakobi", "for", "reporting", "this", "issue.", "Reviewed-by:", "Stephen", "Henson", "<steve@openssl.org>", "Reviewed-by:", "Rich", "Salz", "<rsalz@openssl.org>"], "code_tokens": ["if", "(", "crl_score", "<", "best_score", "|", "|", "crl_score", "=", "=", "0", ")", "if", "(", "crl_score", "=", "=", "best_score", "&", "&", "best_crl", "!", "=", "NULL", ")", "{</s>if", "(", "crl_score", "<", "best_score", ")", "if", "(", "crl_score", "=", "=", "best_score", ")", "{"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Simplify", "Default", "Configuration", "Switching", "off", "matchSubdomains", "by", "default", "for", "a", "simpler", "initial", "configuration."], "code_tokens": ["private", "boolean", "matchSubdomains", "=", "false", ";", "import", "org", ".", "junit", ".", "Before", ";", "private", "DefaultRedirectResolver", "resolver", ";", "@", "Before", "public", "void", "setup", "(", ")", "{", "resolver", "=", "new", "DefaultRedirectResolver", "(", ");", "}", "resolver", ".", "setMatchSubdomains", "(", "true", ")", ";", "resolver", ".", "setMatchSubdomains", "(", "true", ")", ";", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectMatchSubdomainsDefaultsFalse", "(", ")", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "https", ":", "//", "anywhere", ".", "com", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "resolver", ".", "resolveRedirect", "(", "\"", "https", ":", "//", "2", ".", "anywhere", ".", "com", "\"", ",", "client", ")", ";", "}</s>private", "boolean", "matchSubdomains", "=", "true", ";", "private", "final", "DefaultRedirectResolver", "resolver", "=", "new", "DefaultRedirectResolver", "(", ");"], "docstring_tokens": ["open", "redirector"]}
{"contents": ["smart_pkt:", "verify", "packet", "length", "exceeds", "PKT_LEN_SIZE", "Each", "packet", "line", "in", "the", "Git", "protocol", "is", "prefixed", "by", "a", "four-byte", "length", "of", "how", "much", "data", "will", "follow,", "which", "we", "parse", "in", "`git_pkt_parse_line`.", "The", "transmitted", "length", "can", "either", "be", "equal", "to", "zero", "in", "case", "of", "a", "flush", "packet", "or", "has", "to", "be", "at", "least", "of", "length", "four,", "as", "it", "also", "includes", "the", "encoded", "length", "itself.", "Not", "checking", "this", "may", "result", "in", "a", "buffer", "overflow", "as", "we", "directly", "pass", "the", "length", "to", "functions", "which", "accept", "a", "`size_t`", "length", "as", "parameter.", "Fix", "the", "issue", "by", "verifying", "that", "non-flush", "packets", "have", "at", "least", "a", "length", "of", "`PKT_LEN_SIZE`."], "code_tokens": ["/", "*", "*", "The", "length", "has", "to", "be", "exactly", "0", "in", "case", "of", "a", "flush", "*", "packet", "or", "greater", "than", "PKT_LEN_SIZE", ",", "as", "the", "decoded", "*", "length", "includes", "its", "own", "encoded", "length", "of", "four", "bytes", ".", "*", "/", "if", "(", "len", "!", "=", "0", "&", "&", "len", "<", "PKT_LEN_SIZE", ")", "return", "GIT_ERROR", ";</s>"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["Disable", "message", "interpolation", "in", "ConstraintViolations", "by", "default", "(#3208)", "Disable", "message", "interpolation", "in", "ConstraintViolations", "by", "default", "but", "allow", "enabling", "it", "explicitly", "with", "`SelfValidating#escapeExpressions()`.", "Additionally,", "`ConstraintViolations`", "now", "provides", "a", "set", "of", "methods", "which", "take", "a", "map", "of", "message", "parameters", "for", "interpolation.", "The", "message", "parameters", "will", "be", "escaped", "by", "default.", "Refs", "#3153", "Refs", "#3157"], "code_tokens": ["/", "*", "*", "Hibernate", "Validator", ",", "declare", "and", "validate", "application", "constraints", "*", "*", "License", ":", "Apache", "License", ",", "Version", "2", ".", "0", "*", "See", "the", "license", ".", "txt", "file", "in", "the", "root", "directory", "or", "<", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ">", ".", "*", "/", "package", "io", ".", "dropwizard", ".", "validation", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "*", "Utilities", "used", "for", "message", "interpolation", ".", "*", "*", "@", "author", "Guillaume", "Smet", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "final", "class", "InterpolationHelper", "{", "public", "static", "final", "char", "BEGIN_TERM", "=", "'", "{'", ";", "public", "static", "final", "char", "END_TERM", "=", "'", "}'", ";", "public", "static", "final", "char", "EL_DESIGNATOR", "=", "'", "$'", ";", "public", "static", "final", "char", "ESCAPE_CHARACTER", "=", "'", "\\\\", "';", "private", "static", "final", "Pattern", "ESCAPE_MESSAGE_PARAMETER_PATTERN", "=", "Pattern", ".", "compile", "(", "\"(", "[\\", "\\\"", "+", "ESCAPE_CHARACTER", "+", "BEGIN_TERM", "+", "END_TERM", "+", "EL_DESIGNATOR", "+", "\"", "])", "\")", ";", "private", "InterpolationHelper", "(", ")", "{", "}", "@", "Nullable", "public", "static", "String", "escapeMessageParameter", "(", "@", "Nullable", "String", "messageParameter", ")", "{", "if", "(", "messageParameter", "=", "=", "null", ")", "{", "return", "null", ";", "}", "return", "ESCAPE_MESSAGE_PARAMETER_PATTERN", ".", "matcher", "(", "messageParameter", ")", ".", "replaceAll", "(", "Matcher", ".", "quoteReplacement", "(", "String", ".", "valueOf", "(", "ESCAPE_CHARACTER", ")", ")", "+", "\"", "$", "1", "\"", ");", "}", "}", "@", "@", "-", "7", ",", "6", "+", "7", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "/", "**", "*", "Escape", "EL", "expressions", "to", "avoid", "template", "injection", "attacks", ".", "*", "<", "p", ">", "*", "This", "has", "serious", "security", "implications", "and", "you", "will", "*", "have", "to", "escape", "the", "violation", "messages", "added", "to", "{", "@", "link", "ViolationCollector", "}", "appropriately", ".", "*", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Map", ")", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "String", ",", "Map", ")", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Integer", ",", "String", ",", "Map", ")", "*", "/", "boolean", "escapeExpressions", "(", ")", "default", "true", ";", "private", "boolean", "escapeExpressions", "=", "true", ";", "escapeExpressions", "=", "constraintAnnotation", ".", "escapeExpressions", "(", ");", "final", "ViolationCollector", "collector", "=", "new", "ViolationCollector", "(", "context", ",", "escapeExpressions", ")", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "constraintvalidation", ".", "HibernateConstraintValidatorContext", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "io", ".", "dropwizard", ".", "validation", ".", "InterpolationHelper", ".", "escapeMessageParameter", ";", "private", "final", "ConstraintValidatorContext", "constraintValidatorContext", ";", "private", "final", "boolean", "escapeExpressions", ";", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "constraintValidatorContext", ")", "{", "this", "(", "constraintValidatorContext", ",", "true", ")", ";", "}", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "constraintValidatorContext", ",", "boolean", "escapeExpressions", ")", "{", "this", ".", "constraintValidatorContext", "=", "constraintValidatorContext", ";", "this", ".", "escapeExpressions", "=", "escapeExpressions", ";", "*", "<", "p", ">", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "see", "#", "addViolation", "(", "String", ",", "Map", ")", "addViolation", "(", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", "*", "<", "p", ">", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "see", "#", "addViolation", "(", "String", ",", "String", ",", "Map", ")", "addViolation", "(", "propertyName", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Integer", ",", "String", ",", "Map", ")", "addViolation", "(", "propertyName", ",", "index", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "index", "the", "index", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "Integer", "index", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "addViolation", "(", "propertyName", ",", "key", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "key", "the", "key", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "key", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "final", "String", "messageTemplate", "=", "sanitizeTemplate", "(", "message", ")", ";", "final", "HibernateConstraintValidatorContext", "context", "=", "getContextWithMessageParameters", "(", "messageParameters", ")", ";", "private", "HibernateConstraintValidatorContext", "getContextWithMessageParameters", "(", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "final", "HibernateConstraintValidatorContext", "context", "=", "constraintValidatorContext", ".", "unwrap", "(", "HibernateConstraintValidatorContext", ".", "class", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "messageParameter", ":", "messageParameters", ".", "entrySet", "(", "))", "{", "final", "Object", "value", "=", "messageParameter", ".", "getValue", "(", ");", "final", "String", "escapedValue", "=", "value", "=", "=", "null", "?", "null", ":", "escapeMessageParameter", "(", "value", ".", "toString", "(", "))", ";", "context", ".", "addMessageParameter", "(", "messageParameter", ".", "getKey", "(", "),", "escapedValue", ")", ";", "return", "context", ";", "}", "@", "Nullable", "private", "String", "sanitizeTemplate", "(", "@", "Nullable", "String", "message", ")", "{", "return", "escapeExpressions", "?", "escapeMessageParameter", "(", "message", ")", ":", "message", ";", "return", "constraintValidatorContext", ";", "import", "io", ".", "dropwizard", ".", "util", ".", "Maps", ";", "import", "java", ".", "util", ".", "Collections", ";", "col", ".", "addViolation", "(", "\"$", "\\\\", "A", "{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "TEST", "\"", "))", ";", "@", "SelfValidating", "(", "escapeExpressions", "=", "false", ")", "public", "static", "class", "EscapingDisabledExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"$", "{'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "\\\\", "A", "{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "TEST", "\"", "))", ";", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "1", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "key", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "}", "}", "@", "SelfValidating", "(", "escapeExpressions", "=", "false", ")", "public", "static", "class", "MessageParametersExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "No", "parameter", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "{", "unsetParameter", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "Mixed", "$", "{'", "value", "'", "}", "{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "Nested", "{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "${", "'", "nested", "'", "}\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "1", ",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "\"", "{", "key", "}", "\",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "key", "\"", ",", "\"", "KEY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "}", "}", "public", "void", "violationMessagesAreEscapedByDefault", "(", ")", "{", "\"", "$", "\\\\", "A", "{", "1", "+", "1", "}", "\",", "\"", "{", "value", "}", "\",", "@", "Test", "public", "void", "violationMessagesAreInterpolatedIfEscapingDisabled", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "EscapingDisabledExample", "(", "))", "))", ".", "containsExactly", "(", "\"", "A2", "\"", ",", "\"", "TEST", "\"", ",", "\"", "value", "\"", ",", "\"", "${", "'", "property", "'", "}", "value", "\"", ",", "\"", "${", "'", "property", "'", "}[", "${", "'", "key", "'", "}]", "value", "\"", ",", "\"", "${", "'", "property", "'", "}[", "1", "]", "value", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "messageParametersExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "MessageParametersExample", "(", "))", "))", ".", "containsExactly", "(", "\"", "Mixed", "value", "VALUE", "\"", ",", "\"", "Nested", "$", "{'", "nested", "'", "}\"", ",", "\"", "No", "parameter", "\"", ",", "\"", "VALUE", "\"", ",", "\"", "VALUE", "{", "unsetParameter", "}", "\",", "\"", "value", "}", "\",", "\"", "{", "value", "}", "\",", "\"", "{", "1", "+", "1", "}", "\",", "\"", "{", "value", "\"", ",", "\"", "{", "property", "}", "VALUE", "\"", ",", "\"", "{", "property", "}", "[", "1", "]", "VALUE", "\"", ",", "\"", "{", "property", "}", "[{", "key", "}", "]", "VALUE", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", "}</s>final", "ViolationCollector", "collector", "=", "new", "ViolationCollector", "(", "context", ")", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "private", "static", "final", "Pattern", "ESCAPE_PATTERN", "=", "Pattern", ".", "compile", "(", "\"\\", "\\$", "\\\\", "{\"", ");", "private", "ConstraintValidatorContext", "context", ";", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "context", ")", "{", "this", ".", "context", "=", "context", ";", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "@", "Nullable", "private", "String", "escapeEl", "(", "@", "Nullable", "String", "s", ")", "{", "if", "(", "s", "=", "=", "null", "|", "|", "s", ".", "isEmpty", "(", "))", "{", "return", "s", ";", "}", "final", "Matcher", "m", "=", "ESCAPE_PATTERN", ".", "matcher", "(", "s", ")", ";", "final", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", "s", ".", "length", "(", ")", "+", "16", ")", ";", "while", "(", "m", ".", "find", "(", "))", "{", "m", ".", "appendReplacement", "(", "sb", ",", "\"", "\\\\", "\\\\", "\\\\", "${", "\")", ";", "m", ".", "appendTail", "(", "sb", ")", ";", "return", "sb", ".", "toString", "(", ");", "return", "context", ";", "public", "void", "violationMessagesAreEscaped", "(", ")", "{"], "docstring_tokens": ["remote", "code", "execution", "(rce", ")"]}
{"contents": ["Plugins:", "Editor,", "added", "OWASP", "sanitizer"], "code_tokens": ["<", "properties", ">", "<", "bundle", ".", "namespace", ">", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "ui", ".", "plugins", "<", "/", "bundle", ".", "namespace", ">", "<", "!-", "-", "SANITIZER", "DEPENDENCIES", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "owasp", "-", "java", "-", "html", "-", "sanitizer", "<", "/", "groupId", ">", "<", "artifactId", ">", "owasp", "-", "java", "-", "html", "-", "sanitizer", "<", "/", "artifactId", ">", "<", "version", ">", "20171016", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "felix", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "bundle", "-", "plugin", "<", "/", "artifactId", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "import", "org", ".", "owasp", ".", "html", ".", "HtmlPolicyBuilder", ";", "import", "org", ".", "owasp", ".", "html", ".", "PolicyFactory", ";", "/", "**", "*", "Gets", "a", "new", "{", "@", "link", "PolicyFactory", "}", "to", "sanitize", "editor", "input", "*", "*", "@", "return", "a", "new", "{", "@", "code", "PolicyFactory", "}", "*", "/", "protected", "PolicyFactory", "newPolicyFactory", "(", ")", "{", "return", "new", "HtmlPolicyBuilder", "(", ")", "/", "/", "lf", ".", "allowCommonInlineFormattingElements", "(", ")", "/", "/", "lf", ".", "allowCommonBlockElements", "(", ")", "/", "/", "lf", ".", "allowElements", "(", "\"", "a", "\"", ").", "allowAttributes", "(", "\"", "href", "\"", ",", "\"", "target", "\"", ").", "onElements", "(", "\"", "a", "\"", ")", "/", "/", "lf", ".", "allowAttributes", "(", "\"", "size", "\"", ").", "onElements", "(", "\"", "font", "\"", ")", "/", "/", "lf", ".", "allowAttributes", "(", "\"", "class", "\"", ",", "\"", "style", "\"", ").", "globally", "(", ")", "/", "/", "lf", ".", "toFactory", "(", ");", "}", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "html", "=", "this", ".", "textarea", ".", "getConvertedInput", "(", ");", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "html", ")", ");</s><", "properties", ">", "<", "bundle", ".", "namespace", ">", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "ui", ".", "plugins", "<", "/", "bundle", ".", "namespace", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "felix", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "bundle", "-", "plugin", "<", "/", "artifactId", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "this", ".", "setConvertedInput", "(", "this", ".", "textarea", ".", "getConvertedInput", "(", "))", ";"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["Drops", "defining", "location", "via", "request"], "code_tokens": ["protected", "Templates", "getTemplates", "(", "final", "String", "path", ")", "throws", "TransformerException", ",", "IOException", "{</s>protected", "Templates", "getTemplates", "(", "String", "path", ")", "throws", "TransformerException", ",", "IOException", "{", "String", "pathFromRequest", "=", "ServletActionContext", ".", "getRequest", "(", ").", "getParameter", "(", "\"", "xslt", ".", "location", "\"", ");", "if", "(", "pathFromRequest", "!", "=", "null", ")", "path", "=", "pathFromRequest", ";"], "docstring_tokens": ["dynamic", "method", "invocation", "remote", "code", "execution"]}
{"contents": ["Fix", "issue", "occurs", "when", "updating", "EventPublishers"], "code_tokens": ["import", "org", ".", "apache", ".", "axis2", ".", "util", ".", "XMLUtils", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "java", ".", "io", ".", "StringReader", ";", "DocumentBuilderFactory", "dbf", "=", "EventPublisherUtil", ".", "getSecuredDocumentBuilder", "(", ");", "DocumentBuilder", "builder", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "Document", "document", "=", "builder", ".", "parse", "(", "new", "InputSource", "(", "new", "StringReader", "(", "eventPublisherConfigurationXml", ")", "))", ";", "OMElement", "omElement", "=", "XMLUtils", ".", "toOM", "(", "(", "document", ")", ".", "getDocumentElement", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "apache", ".", "xerces", ".", "impl", ".", "Constants", ";", "import", "org", ".", "apache", ".", "xerces", ".", "util", ".", "SecurityManager", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "private", "static", "final", "int", "ENTITY_EXPANSION_LIMIT", "=", "0", ";", "private", "static", "final", "Log", "log", "=", "LogFactory", ".", "getLog", "(", "EventPublisherUtil", ".", "class", ")", ";", "public", "static", "DocumentBuilderFactory", "getSecuredDocumentBuilder", "(", ")", "{", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setNamespaceAware", "(", "true", ")", ";", "dbf", ".", "setXIncludeAware", "(", "false", ")", ";", "dbf", ".", "setExpandEntityReferences", "(", "false", ")", ";", "try", "{", "dbf", ".", "setFeature", "(", "Constants", ".", "SAX_FEATURE_PREFIX", "+", "Constants", ".", "EXTERNAL_GENERAL_ENTITIES_FEATURE", ",", "false", ")", ";", "dbf", ".", "setFeature", "(", "Constants", ".", "SAX_FEATURE_PREFIX", "+", "Constants", ".", "EXTERNAL_PARAMETER_ENTITIES_FEATURE", ",", "false", ")", ";", "dbf", ".", "setFeature", "(", "Constants", ".", "XERCES_FEATURE_PREFIX", "+", "Constants", ".", "LOAD_EXTERNAL_DTD_FEATURE", ",", "false", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "log", ".", "error", "(", "\"", "Failed", "to", "load", "XML", "Processor", "Feature", "\"", "+", "Constants", ".", "EXTERNAL_GENERAL_ENTITIES_FEATURE", "+", "\"", "or", "\"", "Constants", ".", "EXTERNAL_PARAMETER_ENTITIES_FEATURE", "+", "\"", "or", "\"", "+", "Constants", ".", "LOAD_EXTERNAL_DTD_FEATURE", ")", ";", "}", "SecurityManager", "securityManager", "=", "new", "SecurityManager", "(", ");", "securityManager", ".", "setEntityExpansionLimit", "(", "ENTITY_EXPANSION_LIMIT", ")", ";", "dbf", ".", "setAttribute", "(", "Constants", ".", "XERCES_PROPERTY_PREFIX", "+", "Constants", ".", "SECURITY_MANAGER_PROPERTY", ",", "securityManager", ")", ";", "return", "dbf", ";", "}</s>import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "OMElement", "omElement", "=", "AXIOMUtil", ".", "stringToOM", "(", "eventPublisherConfigurationXml", ")", ";", "}", "catch", "(", "XMLStreamException", "e", ")", "{"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["Improve", "tracking", "of", "connection", "closure.", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/trunk@1833906", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["private", "volatile", "boolean", "closed", "=", "false", ";", "return", "closed", "|", "|", "!", "getSocket", "(", ").", "isOpen", "(", ");", "(", "(", "NioSocketWrapper", ")", "socket", ".", "socketWrapper", ")", ".", "closed", "=", "true", ";", "ka", ".", "closed", "=", "true", ";", "private", "volatile", "boolean", "closed", "=", "false", ";", "return", "closed", "|", "|", "!", "getSocket", "(", ").", "isOpen", "(", ");</s>private", "boolean", "closed", "=", "false", ";", "return", "!", "getSocket", "(", ").", "isOpen", "(", ");", "return", "!", "getSocket", "(", ").", "isOpen", "(", ");"], "docstring_tokens": ["race", "condition"]}
{"contents": ["Issue", "#10", "(#15)", "*", "upgraded", "batik-css", "version", "removed", "redundant", "regex", "beginning/end", "markers", "updated", "policies", "to", "contain", "new", "url", "validation", "which", "is", "sensitive", "to", "html5", "colon", "entity", "*", "removed", "test", "code"], "code_tokens": ["<", "version", ">", "1", ".", "9", ".", "1", "<", "/", "version", ">", "allowedRegExp", ".", "add", "(", "Pattern", ".", "compile", "(", "value", ")", ");", "allowedRegexps", ".", "add", "(", "Pattern", ".", "compile", "(", "value", ")", ");", "allowedRegExp", ".", "add", "(", "Pattern", ".", "compile", "(", "value", ")", ");", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"^", "(?", "![", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "(&", "amp", ";", "colon", ")", ")[", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "\"/", ">", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"^", "(?", "![", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "(&", "amp", ";", "colon", ")", ")[", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "\"/", ">", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"^", "(?", "![", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "(&", "amp", ";", "colon", ")", ")[", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "\"/", ">", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"^", "(?", "![", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "(&", "amp", ";", "colon", ")", ")[", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "\"/", ">", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"^", "(?", "![", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "(&", "amp", ";", "colon", ")", ")[", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "\"/", ">", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"^", "(?", "![", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "(&", "amp", ";", "colon", ")", ")[", "\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]*", "\"/", ">", "<", "regexp", "name", "=", "\"", "anchoredURL", "\"", "value", "=", "\"#", "(\\", "w", ")", "+\"", "/>", "<", "regexp", "name", "=", "\"", "anchoredURL", "\"", "/>", "<", "regexp", "name", "=", "\"", "anchoredURL", "\"", "/>", "@", "Test", "public", "void", "testOnsiteRegex", "(", ")", "throws", "ScanException", ",", "PolicyException", "{", "assertIsGoodOnsiteURL", "(", "\"", "foo", "\"", ");", "assertIsGoodOnsiteURL", "(", "\"/", "foo", "/", "bar", "\"", ");", "assertIsGoodOnsiteURL", "(", "\".", "./", "..", "/", "di", ".", "cgi", "?", "foo", "&", "amp", ";", "3D", "~", "\")", ";", "assertIsGoodOnsiteURL", "(", "\"/", "foo", "/", "bar", "/", "1", "/", "sdf", ";", "jsessiond", "=", "1f1f12312_123123", "\"", ");", "}", "void", "assertIsGoodOnsiteURL", "(", "String", "url", ")", "throws", "ScanException", ",", "PolicyException", "{", "String", "html", "=", "as", ".", "scan", "(", "\"<", "a", "href", "=", "\\\"", "\"", "+", "url", "+", "\"", "\\\"", ">", "X", "<", "/", "a", ">", "\",", "policy", ",", "AntiSamy", ".", "DOM", ")", ".", "getCleanHTML", "(", ");", "assertTrue", "(", "html", ".", "contains", "(", "\"", "href", "=", "\\\"", "\")", ");", "}", "@", "Test", "public", "void", "issue10", "(", ")", "throws", "ScanException", ",", "PolicyException", "{", "assertFalse", "(", "as", ".", "scan", "(", "\"<", "a", "href", "=", "\\\"", "javascript", "&", "colon", ";", "alert", "&", "lpar", ";", "1", "&", "rpar", ";", "\\\"", ">", "X", "<", "/", "a", ">", "\",", "policy", ",", "AntiSamy", ".", "DOM", ")", ".", "getCleanHTML", "(", ").", "contains", "(", "\"", "javascript", "\"", "))", ";", "assertFalse", "(", "as", ".", "scan", "(", "\"<", "a", "href", "=", "\\\"", "javascript", "&", "colon", ";", "alert", "&", "lpar", ";", "1", "&", "rpar", ";", "\\\"", ">", "X", "<", "/", "a", ">", "\",", "policy", ",", "AntiSamy", ".", "SAX", ")", ".", "getCleanHTML", "(", ").", "contains", "(", "\"", "javascript", "\"", "))", ";", "}</s><", "version", ">", "1", ".", "9", "<", "/", "version", ">", "private", "static", "char", "REGEXP_BEGIN", "=", "'", "^'", ";", "private", "static", "char", "REGEXP_END", "=", "'", "$'", ";", "allowedRegExp", ".", "add", "(", "Pattern", ".", "compile", "(", "REGEXP_BEGIN", "+", "value", "+", "REGEXP_END", ")", ");", "allowedRegexps", ".", "add", "(", "Pattern", ".", "compile", "(", "REGEXP_BEGIN", "+", "value", "+", "REGEXP_END", ")", ");", "allowedRegExp", ".", "add", "(", "Pattern", ".", "compile", "(", "REGEXP_BEGIN", "+", "value", "+", "REGEXP_END", ")", ");", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"(", "[\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]+", "|\\", "#(", "\\", "w", ")", "+)", "\"/", ">", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"(", "[\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]+", "|\\", "#(", "\\", "w", ")", "+)", "\"/", ">", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"(", "[\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]+", "|\\", "#(", "\\", "w", ")", "+)", "\"/", ">", "-", "->", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"(", "[\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "/\\", ".\\", "?=", "\\#", "&", "amp", ";", ";\\", "-", "_", "~", "]+", "|\\", "#(", "\\", "w", ")", "+)", "\"/", ">", "-", "->", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"(", "[\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\", "p", "{", "Zs", "}", "/\\", ".\\", "?=", "&", "amp", ";", "\\-", "~]", ")+", "\"", "/", ">", "-", "->", "@", "@", "-", "54", ",", "7", "+", "54", ",", "8", "@", "@", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "html401", "/", "struct", "/", "global", ".", "html", "<", "regexp", "name", "=", "\"", "onsiteURL", "\"", "value", "=", "\"(", "[\\", "p", "{", "L", "}", "\\", "p", "{", "N", "}", "\\\\", "\\.", "\\#", "@\\", "$%", "\\+", "&", "amp", ";", ";\\", "-", "_", "~", ",\\", "?=", "/!", "]+", "|\\", "#(", "\\", "w", ")", "+)", "\"/", ">"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["NIFI-4353", "-", "Added", "XmlUtils", "class.", "-", "Added", "unit", "test.", "-", "Added", "XXE", "test", "resource.", "-", "Refactored", "JAXB", "unmarshalling", "globally", "to", "prevent", "XXE", "attacks.", "-", "Refactored", "duplicated/legacy", "code.", "-", "Cleaned", "up", "commented", "code.", "-", "Switched", "from", "FileInputStream", "back", "to", "StreamSource", "in", "AuthorizerFactoryBean.", "-", "This", "closes", "#2134"], "code_tokens": ["<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "rat", "<", "/", "groupId", ">", "<", "artifactId", ">", "apache", "-", "rat", "-", "plugin", "<", "/", "artifactId", ">", "<", "configuration", ">", "<", "excludes", "combine", ".", "children", "=", "\"", "append", "\"", ">", "<", "exclude", ">", "src", "/", "test", "/", "resources", "/", "xxe_template", ".", "xml", "<", "/", "exclude", ">", "<", "/", "excludes", ">", "<", "/", "configuration", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "java", ".", "io", ".", "InputStream", ";", "public", "class", "XmlUtils", "{", "public", "static", "XMLStreamReader", "createSafeReader", "(", "InputStream", "inputStream", ")", "throws", "XMLStreamException", "{", "if", "(", "inputStream", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "The", "provided", "input", "stream", "cannot", "be", "null", "\"", ");", "}", "return", "createSafeReader", "(", "new", "StreamSource", "(", "inputStream", ")", ");", "}", "public", "static", "XMLStreamReader", "createSafeReader", "(", "StreamSource", "source", ")", "throws", "XMLStreamException", "{", "if", "(", "source", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "The", "provided", "source", "cannot", "be", "null", "\"", ");", "}", "XMLInputFactory", "xif", "=", "XMLInputFactory", ".", "newFactory", "(", ");", "xif", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "xif", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "false", ")", ";", "return", "xif", ".", "createXMLStreamReader", "(", "source", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "96", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", "import", "org", ".", "junit", ".", "After", "import", "org", ".", "junit", ".", "Before", "import", "org", ".", "junit", ".", "BeforeClass", "import", "org", ".", "junit", ".", "Test", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", "import", "org", ".", "junit", ".", "runners", ".", "JUnit4", "import", "org", ".", "slf4j", ".", "Logger", "import", "org", ".", "slf4j", ".", "LoggerFactory", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", "import", "javax", ".", "xml", ".", "bind", ".", "UnmarshalException", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessType", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessorType", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAttribute", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlRootElement", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", "import", "static", "groovy", ".", "test", ".", "GroovyAssert", ".", "shouldFail", "@", "RunWith", "(", "JUnit4", ".", "class", ")", "class", "XmlUtilsTest", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "XmlUtilsTest", ".", "class", ")", "@", "BeforeClass", "static", "void", "setUpOnce", "(", ")", "throws", "Exception", "{", "logger", ".", "metaClass", ".", "methodMissing", "=", "{", "String", "name", ",", "args", "-", ">", "logger", ".", "info", "(", "\"[", "${", "name", "?", ".", "toUpperCase", "(", ")}", "]", "$", "{(", "args", "as", "List", ")", ".", "join", "(", "\"", "\"", ")}", "\")", "}", "}", "@", "Before", "void", "setUp", "(", ")", "throws", "Exception", "{", "}", "@", "After", "void", "tearDown", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "void", "testShouldHandleXXEInUnmarshal", "(", ")", "{", "/", "/", "Arrange", "final", "String", "XXE_TEMPLATE_FILEPATH", "=", "\"", "src", "/", "test", "/", "resources", "/", "xxe_template", ".", "xml", "\"", "InputStream", "templateStream", "=", "new", "File", "(", "XXE_TEMPLATE_FILEPATH", ")", ".", "newInputStream", "(", ")", "JAXBContext", "context", "=", "JAXBContext", ".", "newInstance", "(", "XmlObject", ".", "class", ")", "/", "/", "Act", "def", "msg", "=", "shouldFail", "(", "UnmarshalException", ")", "{", "Unmarshaller", "unmarshaller", "=", "context", ".", "createUnmarshaller", "(", ")", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "templateStream", ")", "def", "parsed", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "XmlObject", ".", "class", ")", "logger", ".", "info", "(", "\"", "Unmarshalled", "$", "{", "parsed", ".", "toString", "(", ")}", "\")", "}", "/", "/", "Assert", "logger", ".", "expected", "(", "msg", ")", "assert", "msg", "=", "~", "\"", "XMLStreamException", ":", "ParseError", "\"", "}", "}", "@", "XmlAccessorType", "(", "XmlAccessType", ".", "NONE", ")", "@", "XmlRootElement", "(", "name", "=", "\"", "object", "\"", ")", "class", "XmlObject", "{", "@", "XmlAttribute", "String", "name", "@", "XmlAttribute", "String", "description", "@", "XmlAttribute", "String", "groupId", "@", "XmlAttribute", "String", "timestamp", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "7", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "standalone", "=", "\"", "yes", "\"", "?>", "<!", "DOCTYPE", "object", "[", "<!", "ENTITY", "xxe", "SYSTEM", "\"", "file", ":", "//", "/", "etc", "/", "passwd", "\"", ">", "]>", "<", "object", ">", "<", "name", ">", "&", "xxe", ";", "</", "name", ">", "<", "description", ">", "Arbitrary", "XML", "that", "has", "an", "XXE", "attack", "present", ".", "</", "description", ">", "<", "groupId", ">", "3a204982", "-", "015e", "-", "1000", "-", "eaa2", "-", "19d352ec8394", "<", "/", "groupId", ">", "<", "timestamp", ">", "09", "/", "05", "/", "2017", "14", ":", "51", ":", "01", "PDT", "<", "/", "timestamp", ">", "<", "/", "object", ">", "@", "@", "-", "19", ",", "13", "+", "19", ",", "15", "@", "@", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "try", "{", "final", "Unmarshaller", "unmarshaller", "=", "JAXB_CONTEXT", ".", "createUnmarshaller", "(", ");", "final", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "is", ")", ";", "return", "(", "ClusterNodeInformation", ")", "unmarshaller", ".", "unmarshal", "(", "xsr", ")", ";", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "throw", "new", "JAXBException", "(", "\"", "Error", "unmarshalling", "the", "cluster", "node", "information", "\"", ",", "e", ")", ";", "}", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "nifi", "<", "/", "groupId", ">", "<", "artifactId", ">", "nifi", "-", "security", "-", "utils", "<", "/", "artifactId", ">", "<", "/", "dependency", ">", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Constructor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "net", ".", "URLClassLoader", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "new", "StreamSource", "(", "authorizersConfigurationFile", ")", ");", "final", "JAXBElement", "<", "Authorizers", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "Authorizers", ".", "class", ")", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Marshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "try", "{", "final", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "new", "StreamSource", "(", "authorizationsFile", ")", ");", "final", "Unmarshaller", "unmarshaller", "=", "JAXB_AUTHORIZATIONS_CONTEXT", ".", "createUnmarshaller", "(", ");", "unmarshaller", ".", "setSchema", "(", "authorizationsSchema", ")", ";", "final", "JAXBElement", "<", "Authorizations", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "Authorizations", ".", "class", ")", ";", "return", "element", ".", "getValue", "(", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "logger", ".", "error", "(", "\"", "Encountered", "an", "error", "reading", "authorizations", "file", ":", "\"", ",", "e", ")", ";", "throw", "new", "JAXBException", "(", "\"", "Error", "reading", "authorizations", "file", "\"", ",", "e", ")", ";", "}", "final", "XMLStreamReader", "xsr", ";", "try", "{", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "new", "StreamSource", "(", "authorizedUsersFile", ")", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "logger", ".", "error", "(", "\"", "Encountered", "an", "error", "reading", "authorized", "users", "file", ":", "\"", ",", "e", ")", ";", "throw", "new", "JAXBException", "(", "\"", "Error", "reading", "authorized", "users", "file", "\"", ",", "e", ")", ";", "}", "xsr", ",", "org", ".", "apache", ".", "nifi", ".", "user", ".", "generated", ".", "Users", ".", "class", ")", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Marshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "try", "{", "final", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "new", "StreamSource", "(", "tenantsFile", ")", ");", "final", "JAXBElement", "<", "Tenants", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "Tenants", ".", "class", ")", ";", "return", "element", ".", "getValue", "(", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "throw", "new", "JAXBException", "(", "\"", "Error", "unmarshalling", "tenants", "\"", ",", "e", ")", ";", "}", "XMLStreamReader", "xsr", ";", "try", "{", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "new", "StreamSource", "(", "authorizedUsersFile", ")", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "throw", "new", "AuthorizerCreationException", "(", "\"", "Error", "converting", "the", "legacy", "authorizers", "file", "\"", ",", "e", ")", ";", "}", "xsr", ",", "org", ".", "apache", ".", "nifi", ".", "user", ".", "generated", ".", "Users", ".", "class", ")", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "is", ")", ";", "return", "(", "HeartbeatPayload", ")", "unmarshaller", ".", "unmarshal", "(", "xsr", ")", ";", "}", "catch", "(", "final", "JAXBException", "|", "XMLStreamException", "e", ")", "{", "throw", "new", "ProtocolException", "(", "e", ")", ";", "return", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", ");", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "new", "ByteArrayInputStream", "(", "msg", ")", ");", "return", "(", "T", ")", "unmarshaller", ".", "unmarshal", "(", "xsr", ")", ";", "}", "catch", "(", "final", "JAXBException", "|", "XMLStreamException", "e", ")", "{", "throw", "new", "IOException", "(", "\"", "Failed", "unmarshalling", "protocol", "message", "due", "to", ":", "\"", "+", "e", ",", "e", ")", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "java", ".", "util", ".", "function", ".", "Function", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "final", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "is", ")", ";", "return", "(", "BulletinsPayload", ")", "unmarshaller", ".", "unmarshal", "(", "xsr", ")", ";", "}", "catch", "(", "final", "JAXBException", "|", "XMLStreamException", "e", ")", "{", "throw", "new", "ProtocolException", "(", "e", ")", ";", "return", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", ");", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "final", "DOMSource", "domSource", "=", "new", "DOMSource", "(", "templateElement", ")", ";", "final", "ByteArrayOutputStream", "baos", "=", "new", "ByteArrayOutputStream", "(", ");", "final", "StreamResult", "streamResult", "=", "new", "StreamResult", "(", "baos", ")", ";", "/", "/", "need", "to", "stream", "the", "template", "element", "as", "the", "TemplateDeserializer", ".", "deserialize", "operation", "needs", "to", "re", "-", "parse", "/", "/", "in", "order", "to", "apply", "explicit", "properties", "on", "the", "XMLInputFactory", "final", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "final", "Transformer", "transformer", "=", "transformerFactory", ".", "newTransformer", "(", ");", "transformer", ".", "transform", "(", "domSource", ",", "streamResult", ")", ";", "return", "parseDto", "(", "baos", ".", "toByteArray", "(", "))", ";", "throw", "new", "RuntimeException", "(", "\"", "Could", "not", "parse", "bytes", "as", "template", "\"", ",", "ioe", ")", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "inStream", ")", ";", "JAXBElement", "<", "StandardSnippet", ">", "snippetElement", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "StandardSnippet", ".", "class", ")", ";", "}", "catch", "(", "final", "JAXBException", "|", "XMLStreamException", "e", ")", "{", "import", "org", ".", "apache", ".", "nifi", ".", "controller", ".", "serialization", ".", "FlowSerializationException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "import", "org", ".", "apache", ".", "nifi", ".", "web", ".", "api", ".", "dto", ".", "TemplateDTO", ";", "import", "java", ".", "io", ".", "InputStream", ";", "return", "deserialize", "(", "new", "StreamSource", "(", "inStream", ")", ");", "}", "public", "static", "TemplateDTO", "deserialize", "(", "final", "StreamSource", "source", ")", "{", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "source", ")", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "/", "/", "Deserialize", "Template", "into", "TemplateDTO", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "in", ")", ";", "JAXBElement", "<", "TemplateDTO", ">", "templateElement", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "TemplateDTO", ".", "class", ")", ";", "try", "(", "DiffFormatter", "diff", "=", "new", "DiffFormatter", "(", "out", ")", ")", "{", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "in", ")", ";", "JAXBElement", "<", "TemplateDTO", ">", "templateElement", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "TemplateDTO", ".", "class", ")", ";", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "nifi", "<", "/", "groupId", ">", "<", "artifactId", ">", "nifi", "-", "security", "-", "utils", "<", "/", "artifactId", ">", "<", "/", "dependency", ">", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "new", "StreamSource", "(", "loginIdentityProvidersConfigurationFile", ")", ");", "final", "JAXBElement", "<", "LoginIdentityProviders", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "LoginIdentityProviders", ".", "class", ")", ";", "<", "dependencies", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "nifi", "<", "/", "groupId", ">", "<", "artifactId", ">", "nifi", "-", "security", "-", "utils", "<", "/", "artifactId", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "nifi", ".", "security", ".", "xml", ".", "XmlUtils", ";", "XMLStreamReader", "xsr", "=", "XmlUtils", ".", "createSafeReader", "(", "new", "ByteArrayInputStream", "(", "string", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", "))", ";", "final", "JAXBElement", "<", "CriteriaBinding", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ",", "CriteriaBinding", ".", "class", ")", ";", "}", "catch", "(", "final", "JAXBException", "|", "XMLStreamException", "e", ")", "{", "throw", "new", "IllegalArgumentException", "(", "e", ")", ";</s>final", "Unmarshaller", "unmarshaller", "=", "JAXB_CONTEXT", ".", "createUnmarshaller", "(", ");", "return", "(", "ClusterNodeInformation", ")", "unmarshaller", ".", "unmarshal", "(", "is", ")", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Constructor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "net", ".", "URLClassLoader", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "final", "JAXBElement", "<", "Authorizers", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "authorizersConfigurationFile", ")", ",", "Authorizers", ".", "class", ")", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Marshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "final", "Unmarshaller", "unmarshaller", "=", "JAXB_AUTHORIZATIONS_CONTEXT", ".", "createUnmarshaller", "(", ");", "unmarshaller", ".", "setSchema", "(", "authorizationsSchema", ")", ";", "final", "JAXBElement", "<", "Authorizations", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "authorizationsFile", ")", ",", "Authorizations", ".", "class", ")", ";", "return", "element", ".", "getValue", "(", ");", "new", "StreamSource", "(", "authorizedUsersFile", ")", ",", "org", ".", "apache", ".", "nifi", ".", "user", ".", "generated", ".", "Users", ".", "class", ")", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Marshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLOutputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamWriter", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "validation", ".", "Schema", ";", "import", "javax", ".", "xml", ".", "validation", ".", "SchemaFactory", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "final", "JAXBElement", "<", "Tenants", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "tenantsFile", ")", ",", "Tenants", ".", "class", ")", ";", "return", "element", ".", "getValue", "(", ");", "new", "StreamSource", "(", "authorizedUsersFile", ")", ",", "org", ".", "apache", ".", "nifi", ".", "user", ".", "generated", ".", "Users", ".", "class", ")", ";", "return", "(", "HeartbeatPayload", ")", "unmarshaller", ".", "unmarshal", "(", "is", ")", ";", "}", "catch", "(", "final", "JAXBException", "je", ")", "{", "throw", "new", "ProtocolException", "(", "je", ")", ";", "try", "{", "final", "Unmarshaller", "unmarshaller", "=", "JAXB_CONTEXT", ".", "createUnmarshaller", "(", ");", "return", "(", "HeartbeatPayload", ")", "unmarshaller", ".", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", ");", "}", "catch", "(", "final", "JAXBException", "je", ")", "{", "throw", "new", "ProtocolException", "(", "je", ")", ";", "}", "return", "(", "T", ")", "unmarshaller", ".", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "msg", ")", ");", "}", "catch", "(", "final", "JAXBException", "je", ")", "{", "throw", "new", "IOException", "(", "\"", "Failed", "unmarshalling", "protocol", "message", "due", "to", ":", "\"", "+", "je", ",", "je", ")", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "java", ".", "util", ".", "function", ".", "Function", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "protected", "static", "final", "Unmarshaller", "nodeIdentifierUnmarshaller", ";", "static", "{", "try", "{", "final", "JAXBContext", "jaxbContext", "=", "JAXBContext", ".", "newInstance", "(", "NodeIdentifier", ".", "class", ")", ";", "nodeIdentifierUnmarshaller", "=", "jaxbContext", ".", "createUnmarshaller", "(", ");", "}", "catch", "(", "final", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "Failed", "to", "create", "an", "Unmarshaller", "for", "unmarshalling", "Node", "Identifier", "\"", ",", "e", ")", ";", "}", "}", "return", "(", "BulletinsPayload", ")", "unmarshaller", ".", "unmarshal", "(", "is", ")", ";", "}", "catch", "(", "final", "JAXBException", "je", ")", "{", "throw", "new", "ProtocolException", "(", "je", ")", ";", "try", "{", "final", "Unmarshaller", "unmarshaller", "=", "JAXB_CONTEXT", ".", "createUnmarshaller", "(", ");", "return", "(", "BulletinsPayload", ")", "unmarshaller", ".", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", ");", "}", "catch", "(", "final", "JAXBException", "je", ")", "{", "throw", "new", "ProtocolException", "(", "je", ")", ";", "}", "import", "org", ".", "apache", ".", "nifi", ".", "stream", ".", "io", ".", "StreamUtils", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "java", ".", "io", ".", "DataInputStream", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "JAXBContext", "context", "=", "JAXBContext", ".", "newInstance", "(", "TemplateDTO", ".", "class", ")", ";", "Unmarshaller", "unmarshaller", "=", "context", ".", "createUnmarshaller", "(", ");", "return", "unmarshaller", ".", "unmarshal", "(", "new", "DOMSource", "(", "templateElement", ")", ",", "TemplateDTO", ".", "class", ")", ".", "getValue", "(", ");", "throw", "new", "RuntimeException", "(", "\"", "Could", "not", "parse", "bytes", "as", "template", "\"", ",", "ioe", ")", ";", "/", "/", "won", "'", "t", "happen", "because", "of", "the", "types", "of", "streams", "being", "used", "public", "static", "List", "<", "Template", ">", "parseTemplateStream", "(", "final", "byte", "[", "]", "bytes", ")", "{", "final", "List", "<", "Template", ">", "templates", "=", "new", "ArrayList", "<", ">(", ");", "try", "(", "final", "InputStream", "rawIn", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "final", "DataInputStream", "in", "=", "new", "DataInputStream", "(", "rawIn", ")", ")", "{", "while", "(", "isMoreData", "(", "in", ")", ")", "{", "final", "int", "length", "=", "in", ".", "readInt", "(", ");", "final", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "length", "]", ";", "StreamUtils", ".", "fillBuffer", "(", "in", ",", "buffer", ",", "true", ")", ";", "final", "TemplateDTO", "dto", "=", "TemplateDeserializer", ".", "deserialize", "(", "new", "ByteArrayInputStream", "(", "buffer", ")", ");", "templates", ".", "add", "(", "new", "Template", "(", "dto", ")", ");", "}", "}", "catch", "(", "final", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "Could", "not", "parse", "bytes", "\"", ",", "e", ")", ";", "/", "/", "won", "'", "t", "happen", "because", "of", "the", "types", "of", "streams", "being", "used", "}", "return", "templates", ";", "}", "private", "static", "boolean", "isMoreData", "(", "final", "InputStream", "in", ")", "throws", "IOException", "{", "in", ".", "mark", "(", "1", ")", ";", "final", "int", "nextByte", "=", "in", ".", "read", "(", ");", "if", "(", "nextByte", "=", "=", "-", "1", ")", "{", "return", "false", ";", "}", "in", ".", "reset", "(", ");", "return", "true", ";", "}", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "JAXBElement", "<", "StandardSnippet", ">", "snippetElement", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "inStream", ")", ",", "StandardSnippet", ".", "class", ")", ";", "}", "catch", "(", "final", "JAXBException", "e", ")", "{", "import", "java", ".", "io", ".", "InputStream", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "org", ".", "apache", ".", "nifi", ".", "controller", ".", "serialization", ".", "FlowSerializationException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "web", ".", "api", ".", "dto", ".", "TemplateDTO", ";", "/", "/", "Manually", "constructing", "the", "XIF", "is", "necessary", "to", "prevent", "XXE", "attacks", "XMLInputFactory", "xif", "=", "XMLInputFactory", ".", "newFactory", "(", ");", "xif", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "xif", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "false", ")", ";", "XMLStreamReader", "xsr", "=", "xif", ".", "createXMLStreamReader", "(", "new", "StreamSource", "(", "inStream", ")", ");", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "/", "/", "Deserialize", "Template", "into", "TemplateDTP", "JAXBElement", "<", "TemplateDTO", ">", "templateElement", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "in", ")", ",", "TemplateDTO", ".", "class", ")", ";", "try", "(", "DiffFormatter", "diff", "=", "new", "DiffFormatter", "(", "out", ")", ";)", "{", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "JAXBElement", "<", "TemplateDTO", ">", "templateElement", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "in", ")", ",", "TemplateDTO", ".", "class", ")", ";", "final", "JAXBElement", "<", "LoginIdentityProviders", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "loginIdentityProvidersConfigurationFile", ")", ",", "LoginIdentityProviders", ".", "class", ")", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "final", "Source", "source", "=", "new", "StreamSource", "(", "new", "StringReader", "(", "string", ")", ");", "final", "JAXBElement", "<", "CriteriaBinding", ">", "element", "=", "unmarshaller", ".", "unmarshal", "(", "source", ",", "CriteriaBinding", ".", "class", ")", ";", "}", "catch", "(", "final", "JAXBException", "jaxbe", ")", "{", "throw", "new", "IllegalArgumentException", "(", "jaxbe", ")", ";"], "docstring_tokens": ["java", "deserialization"]}
{"contents": ["block:", "fix", "use-after-free", "in", "sys_ioprio_get()", "get_task_ioprio()", "accesses", "the", "task->io_context", "without", "holding", "the", "task", "lock", "and", "thus", "can", "race", "with", "exit_io_context(),", "leading", "to", "a", "use-after-free.", "The", "reproducer", "below", "hits", "this", "within", "a", "few", "seconds", "on", "my", "4-core", "QEMU", "VM:", "#define", "_GNU_SOURCE", "#include", "<assert.h>", "#include", "<unistd.h>", "#include", "<sys/syscall.h>", "#include", "<sys/wait.h>", "int", "main(int", "argc,", "char", "**argv)", "{", "pid_t", "pid,", "child;", "long", "nproc,", "i;", "/*", "ioprio_set(IOPRIO_WHO_PROCESS,", "0,", "IOPRIO_PRIO_VALUE(IOPRIO_CLASS_IDLE,", "0));", "*/", "syscall(SYS_ioprio_set,", "1,", "0,", "0x6000);", "nproc", "=", "sysconf(_SC_NPROCESSORS_ONLN);", "for", "(i", "=", "0;", "i", "<", "nproc;", "i++)", "{", "pid", "=", "fork();", "assert(pid", "!=", "-1);", "if", "(pid", "==", "0)", "{", "for", "(;;)", "{", "pid", "=", "fork();", "assert(pid", "!=", "-1);", "if", "(pid", "==", "0)", "{", "_exit(0);", "}", "else", "{", "child", "=", "wait(NULL);", "assert(child", "==", "pid);", "}", "}", "}", "pid", "=", "fork();", "assert(pid", "!=", "-1);", "if", "(pid", "==", "0)", "{", "for", "(;;)", "{", "/*", "ioprio_get(IOPRIO_WHO_PGRP,", "0);", "*/", "syscall(SYS_ioprio_get,", "2,", "0);", "}", "}", "}", "for", "(;;)", "{", "/*", "ioprio_get(IOPRIO_WHO_PGRP,", "0);", "*/", "syscall(SYS_ioprio_get,", "2,", "0);", "}", "return", "0;", "}", "This", "gets", "us", "KASAN", "dumps", "like", "this:", "[", "35.526914]", "==================================================================", "[", "35.530009]", "BUG:", "KASAN:", "out-of-bounds", "in", "get_task_ioprio+0x7b/0x90", "at", "addr", "ffff880066f34e6c", "[", "35.530009]", "Read", "of", "size", "2", "by", "task", "ioprio-gpf/363", "[", "35.530009]", "=============================================================================", "[", "35.530009]", "BUG", "blkdev_ioc", "(Not", "tainted):", "kasan:", "bad", "access", "detected", "[", "35.530009]", "-----------------------------------------------------------------------------", "[", "35.530009]", "Disabling", "lock", "debugging", "due", "to", "kernel", "taint", "[", "35.530009]", "INFO:", "Allocated", "in", "create_task_io_context+0x2b/0x370", "age=0", "cpu=0", "pid=360", "[", "35.530009]", "___slab_alloc+0x55d/0x5a0", "[", "35.530009]", "__slab_alloc.isra.20+0x2b/0x40", "[", "35.530009]", "kmem_cache_alloc_node+0x84/0x200", "[", "35.530009]", "create_task_io_context+0x2b/0x370", "[", "35.530009]", "get_task_io_context+0x92/0xb0", "[", "35.530009]", "copy_process.part.8+0x5029/0x5660", "[", "35.530009]", "_do_fork+0x155/0x7e0", "[", "35.530009]", "SyS_clone+0x19/0x20", "[", "35.530009]", "do_syscall_64+0x195/0x3a0", "[", "35.530009]", "return_from_SYSCALL_64+0x0/0x6a", "[", "35.530009]", "INFO:", "Freed", "in", "put_io_context+0xe7/0x120", "age=0", "cpu=0", "pid=1060", "[", "35.530009]", "__slab_free+0x27b/0x3d0", "[", "35.530009]", "kmem_cache_free+0x1fb/0x220", "[", "35.530009]", "put_io_context+0xe7/0x120", "[", "35.530009]", "put_io_context_active+0x238/0x380", "[", "35.530009]", "exit_io_context+0x66/0x80", "[", "35.530009]", "do_exit+0x158e/0x2b90", "[", "35.530009]", "do_group_exit+0xe5/0x2b0", "[", "35.530009]", "SyS_exit_group+0x1d/0x20", "[", "35.530009]", "entry_SYSCALL_64_fastpath+0x1a/0xa4", "[", "35.530009]", "INFO:", "Slab", "0xffffea00019bcd00", "objects=20", "used=4", "fp=0xffff880066f34ff0", "flags=0x1fffe0000004080", "[", "35.530009]", "INFO:", "Object", "0xffff880066f34e58", "@offset=3672", "fp=0x0000000000000001", "[", "35.530009]", "==================================================================", "Fix", "it", "by", "grabbing", "the", "task", "lock", "while", "we", "poke", "at", "the", "io_context.", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Signed-off-by:", "Omar", "Sandoval", "<osandov@fb.com>", "Signed-off-by:", "Jens", "Axboe", "<axboe@fb.com>"], "code_tokens": ["task_lock", "(", "p", ")", ";", "task_unlock", "(", "p", ")", ";</s>"], "docstring_tokens": ["race", "condition"]}
{"contents": ["do_sigaltstack:", "avoid", "copying", "'stack_t'", "as", "a", "structure", "to", "user", "space", "Ulrich", "Drepper", "correctly", "points", "out", "that", "there", "is", "generally", "padding", "in", "the", "structure", "on", "64-bit", "hosts,", "and", "that", "copying", "the", "structure", "from", "kernel", "to", "user", "space", "can", "leak", "information", "from", "the", "kernel", "stack", "in", "those", "padding", "bytes.", "Avoid", "the", "whole", "issue", "by", "just", "copying", "the", "three", "members", "one", "by", "one", "instead,", "which", "also", "means", "that", "the", "function", "also", "can", "avoid", "the", "need", "for", "a", "stack", "frame.", "This", "also", "happens", "to", "match", "how", "we", "copy", "the", "new", "structure", "from", "user", "space,", "so", "it", "all", "even", "makes", "sense.", "[", "The", "obvious", "solution", "of", "adding", "a", "memset()", "generates", "horrid", "code,", "gcc", "does", "really", "stupid", "things.", "]", "Reported-by:", "Ulrich", "Drepper", "<drepper@redhat.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["oss", ".", "ss_sp", "=", "(", "void", "__user", "*", ")", "current", "-", ">", "sas_ss_sp", ";", "oss", ".", "ss_size", "=", "current", "-", ">", "sas_ss_size", ";", "oss", ".", "ss_flags", "=", "sas_ss_flags", "(", "sp", ")", ";", "error", "=", "0", ";", "if", "(", "!", "access_ok", "(", "VERIFY_WRITE", ",", "uoss", ",", "sizeof", "(", "*", "uoss", ")", "))", "error", "=", "__put_user", "(", "oss", ".", "ss_sp", ",", "&", "uoss", "-", ">", "ss_sp", ")", "|", "__put_user", "(", "oss", ".", "ss_size", ",", "&", "uoss", "-", ">", "ss_size", ")", "|", "__put_user", "(", "oss", ".", "ss_flags", ",", "&", "uoss", "-", ">", "ss_flags", ")", ";</s>if", "(", "uoss", ")", "{", "oss", ".", "ss_sp", "=", "(", "void", "__user", "*", ")", "current", "-", ">", "sas_ss_sp", ";", "oss", ".", "ss_size", "=", "current", "-", ">", "sas_ss_size", ";", "oss", ".", "ss_flags", "=", "sas_ss_flags", "(", "sp", ")", ";", "}", "if", "(", "copy_to_user", "(", "uoss", ",", "&", "oss", ",", "sizeof", "(", "oss", ")", "))", "error", "=", "0", ";"], "docstring_tokens": ["stack", "disclosure"]}
{"contents": ["Bug", "61532:", "Fix", "setting", "values/types", "during", "formula", "evaluation", "for", "SXSSF", "git-svn-id:", "https://svn.apache.org/repos/asf/poi/trunk@1849880", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["if", "(", "_value", "instanceof", "RichTextStringFormulaValue", ")", "{", "(", "(", "RichTextStringFormulaValue", ")", "_value", ")", ".", "setPreEvaluatedValue", "(", "xvalue", ")", ";", "}", "else", "{", "(", "(", "RichTextValue", ")", "_value", ")", ".", "setValue", "(", "xvalue", ")", ";", "}", "}", "else", "if", "(", "_value", "instanceof", "RichTextStringFormulaValue", ")", "{", "(", "(", "RichTextStringFormulaValue", ")", "_value", ")", ".", "setPreEvaluatedValue", "(", "new", "XSSFRichTextString", "(", "value", ")", ");", "if", "(", "_value", "instanceof", "RichTextStringFormulaValue", ")", "{", "return", "(", "(", "RichTextStringFormulaValue", ")", "_value", ")", ".", "getPreEvaluatedValue", "(", ").", "getString", "(", ");", "}", "else", "{", "return", "(", "(", "StringFormulaValue", ")", "_value", ")", ".", "getPreEvaluatedValue", "(", ");", "}", "/", "/", "don", "'", "t", "change", "cell", "type", "for", "formulas", "if", "(", "_value", ".", "getType", "(", ")", "=", "=", "CellType", ".", "FORMULA", ")", "{", "String", "formula", "=", "(", "(", "FormulaValue", ")", "_value", ")", ".", "getValue", "(", ");", "_value", "=", "new", "RichTextStringFormulaValue", "(", ");", "(", "(", "RichTextStringFormulaValue", ")", "_value", ")", ".", "setValue", "(", "formula", ")", ";", "}", "else", "if", "(", "_value", ".", "getType", "(", ")!", "=", "CellType", ".", "STRING", "|", "|", "!", "((", "StringValue", ")", "_value", ")", ".", "isRichText", "(", "))", "{", "}", "static", "class", "RichTextStringFormulaValue", "extends", "FormulaValue", "{", "RichTextString", "_preEvaluatedValue", ";", "@", "Override", "CellType", "getFormulaType", "(", ")", "{", "return", "CellType", ".", "STRING", ";", "}", "void", "setPreEvaluatedValue", "(", "RichTextString", "value", ")", "{", "_preEvaluatedValue", "=", "value", ";", "}", "RichTextString", "getPreEvaluatedValue", "(", ")", "{", "return", "_preEvaluatedValue", ";", "}", "}", "switch", "(", "cell", ".", "getCachedFormulaResultType", "(", "))", "{", "case", "NUMERIC", ":", "writeAttribute", "(", "\"", "t", "\"", ",", "\"", "n", "\"", ");", "break", ";", "case", "STRING", ":", "writeAttribute", "(", "\"", "t", "\"", ",", "STCellType", ".", "S", ".", "toString", "(", "))", ";", "break", ";", "case", "BOOLEAN", ":", "writeAttribute", "(", "\"", "t", "\"", ",", "\"", "b", "\"", ");", "break", ";", "case", "ERROR", ":", "writeAttribute", "(", "\"", "t", "\"", ",", "\"", "e", "\"", ");", "break", ";", "}", "case", "STRING", ":", "String", "value", "=", "cell", ".", "getStringCellValue", "(", ");", "if", "(", "value", "!", "=", "null", "&", "&", "!", "value", ".", "isEmpty", "(", "))", "{", "_out", ".", "write", "(", "\"<", "v", ">", "\")", ";", "_out", ".", "write", "(", "value", ")", ";", "_out", ".", "write", "(", "\"<", "/", "v", ">", "\")", ";", "}", "break", ";", "case", "BOOLEAN", ":", "_out", ".", "write", "(", "\">", "<", "v", ">", "\")", ";", "_out", ".", "write", "(", "cell", ".", "getBooleanCellValue", "(", ")", "?", "\"", "1", "\"", ":", "\"", "0", "\"", ");", "_out", ".", "write", "(", "\"<", "/", "v", ">", "\")", ";", "case", "ERROR", ":", "{", "FormulaError", "error", "=", "FormulaError", ".", "forInt", "(", "cell", ".", "getErrorCellValue", "(", "))", ";", "_out", ".", "write", "(", "\">", "<", "v", ">", "\")", ";", "_out", ".", "write", "(", "error", ".", "getString", "(", "))", ";", "_out", ".", "write", "(", "\"<", "/", "v", ">", "\")", ";", "break", ";", "}", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "assertFalse", "(", "s", ".", "areAllRowsFlushed", "(", "))", ";", "assertFalse", "(", "s", ".", "areAllRowsFlushed", "(", "))", ";", "public", "void", "testUpdateCachedFormulaResultFromErrorToNumber_bug46479", "(", ")", "{", "/", "/", "noinspection", "ConstantConditions", "Font", "font", "=", "wb", ".", "getFontAt", "(", "cell0", ".", "getCellStyle", "(", ").", "getFontIndexAsInt", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "/", "/", "Blank", "and", "Null", "the", "same", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "\"", "can", "set", "value", "afterwards", ":", "\"", "+", "value", ",", "\"", "somevalue", "\"", ",", "value", ")", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "\"", "IF", "(", "A1", "<", ">\\", "\"\\", "\",", "MID", "(", "A1", ",", "1", ",", "2", ")", ",\\", "\"", "\\", "\")", "\",", "cell", ".", "getCellFormula", "(", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "\"", "IF", "(", "A1", "<", ">\\", "\"\\", "\",", "MID", "(", "A1", ",", "1", ",", "2", ")", ",\\", "\"", "\\", "\")", "\",", "cell", ".", "getCellFormula", "(", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "\"", "IF", "(", "B1", "<", ">\\", "\"\\", "\",", "MID", "(", "A1", ",", "1", ",", "2", ")", ",\\", "\"", "empty", "\\", "\")", "\",", "cell", ".", "getCellFormula", "(", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "\"", "IF", "(", "B1", "<", ">\\", "\"\\", "\",", "MID", "(", "A1", ",", "1", ",", "2", ")", ",\\", "\"", "empty", "\\", "\")", "\",", "cell", ".", "getCellFormula", "(", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "\"", "IF", "(", "A1", "<", ">\\", "\"\\", "\",", "IF", "(", "C1", "<", ">\\", "\"\\", "\",", "MID", "(", "A1", ",", "1", ",", "2", ")", ",\\", "\"", "c1", "\\", "\")", ",\\", "\"", "c2", "\\", "\")", "\",", "cell", ".", "getCellFormula", "(", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "\"", "IF", "(", "A1", "<", ">\\", "\"\\", "\",", "IF", "(", "C1", "<", ">\\", "\"\\", "\",", "MID", "(", "A1", ",", "1", ",", "2", ")", ",\\", "\"", "c1", "\\", "\")", ",\\", "\"", "c2", "\\", "\")", "\",", "cell", ".", "getCellFormula", "(", "))", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "GregorianCalendar", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "java", ".", "util", ".", "TimeZone", ";", "assertFalse", "(", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "\"", "B1", "value", "\"", ",", "c", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "\"", "C1", "value", "\"", ",", "c", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "\"", "B1", "value", "\"", ",", "c", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "\"", "C1", "value", "\"", ",", "c", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "\"", "Font", "Index", "Matches", "\"", ",", "f", ".", "getIndexAsInt", "(", "),", "cs", ".", "getFontIndexAsInt", "(", "))", ";", "c", ".", "set", "(", "2010", ",", "Calendar", ".", "FEBRUARY", ",", "2", ",", "0", ",", "0", ",", "0", ")", ";", "assertTrue", "(", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertFalse", "(", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cellA1", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "0", ",", "style", ".", "getFontIndexAsInt", "(", "))", ";", "assertFalse", "(", "style", ".", "getWrapText", "(", "))", ";", "@", "Test", "public", "void", "testFormulaSetValueDoesNotChangeType", "(", ")", "throws", "IOException", "{", "try", "(", "Workbook", "wb", "=", "_testDataProvider", ".", "createWorkbook", "(", "))", "{", "Sheet", "sheet", "=", "wb", ".", "createSheet", "(", ");", "Row", "row", "=", "sheet", ".", "createRow", "(", "0", ")", ";", "Cell", "cell", "=", "row", ".", "createCell", "(", "0", ")", ";", "cell", ".", "setCellFormula", "(", "\"", "SQRT", "(", "-", "1", ")", "\")", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "cell", ".", "setCellValue", "(", "new", "Date", "(", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "cell", ".", "setCellValue", "(", "GregorianCalendar", ".", "getInstance", "(", "TimeZone", ".", "getTimeZone", "(", "\"", "UTC", "\"", "),", "Locale", ".", "ROOT", ")", ");", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "cell", ".", "setCellValue", "(", "1", ".", "0", ")", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "cell", ".", "setCellValue", "(", "\"", "test", "\"", ");", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "cell", ".", "setCellValue", "(", "wb", ".", "getCreationHelper", "(", ").", "createRichTextString", "(", "\"", "test", "\"", "))", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "cell", ".", "setCellValue", "(", "false", ")", ";", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "cell", ".", "getCellType", "(", "))", ";", "}", "}", "import", "java", ".", "util", ".", "Locale", ";", "import", "org", ".", "apache", ".", "poi", ".", "ss", ".", "SpreadsheetVersion", ";", "import", "org", ".", "apache", ".", "poi", ".", "ss", ".", "util", ".", "CellRangeAddressList", ";", "@", "Test", "public", "void", "testFormulaEvaluatorEvaluateSimpleFormulaCell", "(", ")", "throws", "Exception", "{", "try", "(", "Workbook", "wb", "=", "_testDataProvider", ".", "createWorkbook", "(", "))", "{", "final", "Row", "row", "=", "wb", ".", "createSheet", "(", ").", "createRow", "(", "0", ")", ";", "final", "Cell", "a1", "=", "row", ".", "createCell", "(", "0", ",", "CellType", ".", "NUMERIC", ")", ";", "a1", ".", "setCellValue", "(", "1", ".", "0", ")", ";", "final", "Cell", "a2", "=", "row", ".", "createCell", "(", "1", ",", "CellType", ".", "NUMERIC", ")", ";", "a2", ".", "setCellValue", "(", "2", ".", "0", ")", ";", "final", "Cell", "a3", "=", "row", ".", "createCell", "(", "2", ",", "CellType", ".", "FORMULA", ")", ";", "final", "String", "formula", "=", "\"", "SUM", "(", "A1", ":", "B1", ")", "\";", "a3", ".", "setCellFormula", "(", "formula", ")", ";", "FormulaEvaluator", "evaluator", "=", "wb", ".", "getCreationHelper", "(", ").", "createFormulaEvaluator", "(", ");", "CellType", "resultType", "=", "evaluator", ".", "evaluateFormulaCell", "(", "a3", ")", ";", "assertEquals", "(", "CellType", ".", "NUMERIC", ",", "resultType", ")", ";", "double", "result", "=", "a3", ".", "getNumericCellValue", "(", ");", "/", "/", "result", "is", "correct", "assertTrue", "(", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "\"", "Expected", "%", "f", "to", "be", "greater", "than", "%", "f", "\"", ",", "result", ",", "2", ".", "0", ")", ",", "result", ">", "2", ".", "0", ")", ";", "assertTrue", "(", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "\"", "Expected", "%", "f", "to", "be", "less", "than", "%", "f", "\"", ",", "result", ",", "4", ".", "0", ")", ",", "result", "<", "4", ".", "0", ")", ";", "/", "/", "ensure", "that", "this", "works", "for", "SUM", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "a3", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "formula", ",", "a3", ".", "getCellFormula", "(", "))", ";", "}", "}", "@", "Test", "public", "void", "testFormulaEvaluatorEvaluateVlookupFormulaCell", "(", ")", "throws", "Exception", "{", "try", "(", "Workbook", "wb", "=", "_testDataProvider", ".", "createWorkbook", "(", "))", "{", "final", "Sheet", "mainSheet", "=", "wb", ".", "createSheet", "(", "\"", "main", "\"", ");", "final", "Sheet", "otherSheet", "=", "wb", ".", "createSheet", "(", "\"", "other", "\"", ");", "final", "Row", "otherRow1", "=", "otherSheet", ".", "createRow", "(", "0", ")", ";", "final", "Cell", "label1", "=", "otherRow1", ".", "createCell", "(", "0", ",", "CellType", ".", "STRING", ")", ";", "label1", ".", "setCellValue", "(", "\"", "Thing", "One", "\"", ");", "final", "Cell", "id1", "=", "otherRow1", ".", "createCell", "(", "1", ",", "CellType", ".", "STRING", ")", ";", "id1", ".", "setCellValue", "(", "\"", "1", "\"", ");", "final", "Row", "otherRow2", "=", "otherSheet", ".", "createRow", "(", "1", ")", ";", "final", "Cell", "label2", "=", "otherRow2", ".", "createCell", "(", "0", ",", "CellType", ".", "STRING", ")", ";", "label2", ".", "setCellValue", "(", "\"", "Thing", "Two", "\"", ");", "final", "Cell", "id2", "=", "otherRow2", ".", "createCell", "(", "1", ",", "CellType", ".", "STRING", ")", ";", "id2", ".", "setCellValue", "(", "\"", "2", "\"", ");", "final", "DataValidationHelper", "dvHelper", "=", "mainSheet", ".", "getDataValidationHelper", "(", ");", "final", "int", "maxRows", "=", "SpreadsheetVersion", ".", "EXCEL2007", ".", "getMaxRows", "(", ")", "-", "1", ";", "final", "CellRangeAddressList", "addressList", "=", "new", "CellRangeAddressList", "(", "0", ",", "maxRows", ",", "0", ",", "0", ")", ";", "final", "String", "constraint", "=", "\"", "'", "other", "'", "!$", "A", ":", "$", "A", "\"", ";", "final", "DataValidationConstraint", "dvConstraint", "=", "dvHelper", ".", "createFormulaListConstraint", "(", "constraint", ")", ";", "final", "DataValidation", "dataValidation", "=", "dvHelper", ".", "createValidation", "(", "dvConstraint", ",", "addressList", ")", ";", "dataValidation", ".", "setShowErrorBox", "(", "true", ")", ";", "mainSheet", ".", "addValidationData", "(", "dataValidation", ")", ";", "wb", ".", "setSheetHidden", "(", "wb", ".", "getSheetIndex", "(", "otherSheet", ")", ",", "true", ")", ";", "final", "Row", "row", "=", "mainSheet", ".", "createRow", "(", "0", ")", ";", "final", "Cell", "a1", "=", "row", ".", "createCell", "(", "0", ",", "CellType", ".", "STRING", ")", ";", "a1", ".", "setCellValue", "(", "\"", "Thing", "Two", "\"", ");", "final", "Cell", "a2", "=", "row", ".", "createCell", "(", "1", ",", "CellType", ".", "FORMULA", ")", ";", "final", "String", "formula", "=", "\"", "VLOOKUP", "(", "A1", ",", "other", "!", "A", ":", "B", ",", "2", ",", "FALSE", ")", "\";", "a2", ".", "setCellFormula", "(", "formula", ")", ";", "FormulaEvaluator", "evaluator", "=", "wb", ".", "getCreationHelper", "(", ").", "createFormulaEvaluator", "(", ");", "CellType", "resultType", "=", "evaluator", ".", "evaluateFormulaCell", "(", "a2", ")", ";", "assertEquals", "(", "CellType", ".", "STRING", ",", "resultType", ")", ";", "/", "/", "result", "is", "correct", "String", "result", "=", "a2", ".", "getStringCellValue", "(", ");", "assertEquals", "(", "\"", "2", "\"", ",", "result", ")", ";", "/", "/", "ensure", "that", "this", "works", "for", "vlookup", "as", "well", "assertEquals", "(", "CellType", ".", "FORMULA", ",", "a2", ".", "getCellType", "(", "))", ";", "assertEquals", "(", "formula", ",", "a2", ".", "getCellFormula", "(", "))", ";", "}", "}</s>private", "static", "final", "POILogger", "logger", "=", "POILogFactory", ".", "getLogger", "(", "SXSSFCell", ".", "class", ")", ";", "(", "(", "RichTextValue", ")", "_value", ")", ".", "setValue", "(", "xvalue", ")", ";", "return", "(", "(", "StringFormulaValue", ")", "_value", ")", ".", "getPreEvaluatedValue", "(", ");", "if", "(", "_value", ".", "getType", "(", ")!", "=", "CellType", ".", "STRING", "|", "|!", "((", "StringValue", ")", "_value", ")", ".", "isRichText", "(", "))", "default", ":", "assertEquals", "(", "false", ",", "s", ".", "areAllRowsFlushed", "(", "))", ";", "assertEquals", "(", "false", ",", "s", ".", "areAllRowsFlushed", "(", "))", ";", "public", "void", "testUpdateCachedFormulaResultFromErrorToNumber_bug46479", "(", ")", "throws", "IOException", "{", "Font", "font", "=", "wb", ".", "getFontAt", "(", "cell0", ".", "getCellStyle", "(", ").", "getFontIndex", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "/", "/", "Blank", "and", "Null", "the", "same", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cf", ".", "getBooleanCellValue", "(", "))", ";", "assertTrue", "(", "\"", "can", "set", "value", "afterwards", ":", "\"", "+", "value", ",", "value", ".", "equals", "(", "\"", "somevalue", "\"", "))", ";", "assertEquals", "(", "false", ",", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "\"", "B1", "value", "\"", ",", "true", ",", "c", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "\"", "C1", "value", "\"", ",", "false", ",", "c", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "\"", "B1", "value", "\"", ",", "true", ",", "c", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "\"", "C1", "value", "\"", ",", "false", ",", "c", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "\"", "Font", "Index", "Matches", "\"", ",", "f", ".", "getIndexAsInt", "(", "),", "cs", ".", "getFontIndex", "(", "))", ";", "c", ".", "set", "(", "2010", ",", "01", ",", "02", ",", "00", ",", "00", ",", "00", ")", ";", "assertEquals", "(", "true", ",", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "false", ",", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cellA1", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "true", ",", "cell", ".", "getBooleanCellValue", "(", "))", ";", "assertEquals", "(", "0", ",", "style", ".", "getFontIndex", "(", "))", ";", "assertEquals", "(", "false", ",", "style", ".", "getWrapText", "(", "))", ";"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["b43:", "stop", "format", "string", "leaking", "into", "error", "msgs", "The", "module", "parameter", "\"fwpostfix\"", "is", "userspace", "controllable,", "unfiltered,", "and", "is", "used", "to", "define", "the", "firmware", "filename.", "b43_do_request_fw()", "populates", "ctx->errors[]", "on", "error,", "containing", "the", "firmware", "filename.", "b43err()", "parses", "its", "arguments", "as", "a", "format", "string.", "For", "systems", "with", "b43", "hardware,", "this", "could", "lead", "to", "a", "uid-0", "to", "ring-0", "escalation.", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "John", "W.", "Linville", "<linville@tuxdriver.com>"], "code_tokens": ["b43err", "(", "dev", "-", ">", "wl", ",", "\"", "%", "s", "\"", ",", "errmsg", ")", ";</s>b43err", "(", "dev", "-", ">", "wl", ",", "errmsg", ")", ";"], "docstring_tokens": ["format", "string"]}
{"contents": ["[PATCH]", "readv/writev", "syscalls", "are", "not", "checked", "by", "lsm", "it", "seems", "that", "readv(2)/writev(2)", "syscalls", "do", "not", "call", "file_permission", "callback.", "Looks", "like", "this", "is", "overlook.", "I", "have", "filled", "the", "issue", "into", "redhat", "bugzilla", "as", "https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=169433", "and", "got", "the", "recommendation", "to", "post", "this", "on", "lsm", "mailing", "list.", "The", "following", "trivial", "patch", "solves", "the", "problem.", "Signed-off-by:", "Kostik", "Belousov", "<kostikbel@gmail.com>", "Signed-off-by:", "Chris", "Wright", "<chrisw@osdl.org>"], "code_tokens": ["if", "(", "ret", ")", "goto", "out", ";", "ret", "=", "security_file_permission", "(", "file", ",", "type", "=", "=", "READ", "?", "MAY_READ", ":", "MAY_WRITE", ")", ";</s>"], "docstring_tokens": ["unauthorized", "access"]}
{"contents": ["[SECURITY-1538]", "Problems", "with", "method", "and", "property", "names", "and", "increment/decrement", "operators"], "code_tokens": ["<", "version", ">", "1", ".", "23", "<", "/", "version", ">", "@", "Issue", "(", "\"", "SECURITY", "-", "1538", "\"", ")", "@", "Test", "public", "void", "blockMethodNameInMethodCalls", "(", ")", "throws", "Exception", "{", "assertRejected", "(", "new", "GenericWhitelist", "(", "),", "\"", "staticMethod", "jenkins", ".", "model", ".", "Jenkins", "getInstance", "\"", ",", "\"", "import", "jenkins", ".", "model", ".", "Jenkins", "\\", "n", "\"", "\"", "1", ".", "({", "Jenkins", ".", "getInstance", "(", ");", "'", "toString", "'", "}", "()", ")(", ")\"", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1538", "\"", ")", "@", "Test", "public", "void", "blockPropertyNameInAssignment", "(", ")", "throws", "Exception", "{", "assertRejected", "(", "new", "GenericWhitelist", "(", "),", "\"", "staticMethod", "jenkins", ".", "model", ".", "Jenkins", "getInstance", "\"", ",", "\"", "import", "jenkins", ".", "model", ".", "Jenkins", "\\", "n", "\"", "\"", "class", "Test", "{", "def", "x", "=", "0", "}", "\\", "n", "\"", "\"", "def", "t", "=", "new", "Test", "(", ")\\", "n", "\"", "\"", "t", ".", "({", "Jenkins", ".", "getInstance", "(", ");", "'", "x", "'", "}", "()", ")", "=", "1", "\\", "n", "\"", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1538", "\"", ")", "@", "Test", "public", "void", "blockPropertyNameInPrefixPostfixExpressions", "(", ")", "throws", "Exception", "{", "assertRejected", "(", "new", "GenericWhitelist", "(", "),", "\"", "staticMethod", "jenkins", ".", "model", ".", "Jenkins", "getInstance", "\"", ",", "\"", "import", "jenkins", ".", "model", ".", "Jenkins", "\\", "n", "\"", "\"", "class", "Test", "{", "def", "x", "=", "0", "}", "\\", "n", "\"", "\"", "def", "t", "=", "new", "Test", "(", ")\\", "n", "\"", "\"", "t", ".", "({", "Jenkins", ".", "getInstance", "(", ");", "'", "x", "'", "}", "()", ")+", "+\\", "n", "\"", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1538", "\"", ")", "@", "Test", "public", "void", "blockSubexpressionsInPrefixPostfixExpressions", "(", ")", "throws", "Exception", "{", "assertRejected", "(", "new", "GenericWhitelist", "(", "),", "\"", "staticMethod", "jenkins", ".", "model", ".", "Jenkins", "getInstance", "\"", ",", "\"", "import", "jenkins", ".", "model", ".", "Jenkins", "\\", "n", "\"", "\"", "++", "({", "Jenkins", ".", "getInstance", "(", ");", "1", "}", "()", ")\\", "n", "\"", ");", "assertRejected", "(", "new", "GenericWhitelist", "(", "),", "\"", "staticMethod", "jenkins", ".", "model", ".", "Jenkins", "getInstance", "\"", ",", "\"", "import", "jenkins", ".", "model", ".", "Jenkins", "\\", "n", "\"", "\"", "({", "Jenkins", ".", "getInstance", "(", ");", "1", "}", "()", ")+", "+\\", "n", "\"", ");", "}</s><", "version", ">", "1", ".", "22", "<", "/", "version", ">"], "docstring_tokens": ["sandbox", "bypass"]}
{"contents": ["Merge", "pull", "request", "#20", "from", "flypapertech/fixCommandInjection", "Fixes", "arbitrary", "command", "injection", "by", "using", "execFile", "instead", "of", "exec"], "code_tokens": ["os", ":", "-", "linux", "-", "osx", "var", "execFile", "=", "require", "(", "'", "child_process", "'", ").", "execFile", ";", "execFile", "(", "\"", "cat", "\"", ",", "[", "\"/", "sys", "/", "class", "/", "net", "/", "\"", "+", "iface", "+", "\"", "/", "address", "\"", "],", "function", "(", "err", ",", "out", ")", "{", "}", ";", "var", "execFile", "=", "require", "(", "'", "child_process", "'", ").", "execFile", ";", "execFile", "(", "\"", "ifconfig", "\"", ",", "[", "iface", "]", ",", "function", "(", "err", ",", "out", ")", "{", "var", "execFile", "=", "require", "(", "'", "child_process", "'", ").", "execFile", ";", "execFile", "(", "\"", "ipconfig", "\"", ",", "[", "\"/", "all", "\"", "],", "function", "(", "err", ",", "out", ")", "{", "\"", "version", "\"", ":", "\"", "0", ".", "2", ".", "10", "\"", ",</s>-", "stable", "-", "\"", "0", ".", "12", "\"", "@", "@", "-", "1", ",", "11", "+", "1", ",", "11", "@", "@", "var", "exec", "=", "require", "(", "'", "child_process", "'", ").", "exec", ";", "exec", "(", "\"", "cat", "/", "sys", "/", "class", "/", "net", "/", "\"", "+", "iface", "+", "\"", "/", "address", "\"", ",", "function", "(", "err", ",", "out", ")", "{", "}", ";", "var", "exec", "=", "require", "(", "'", "child_process", "'", ").", "exec", ";", "module", ".", "exports", "=", "function", "(", "iface", ",", "callback", ")", "{", "exec", "(", "\"", "networksetup", "-", "getmacaddress", "\"", "+", "iface", ",", "function", "(", "err", ",", "out", ")", "{", "if", "(", "err", ")", "{", "callback", "(", "err", ",", "null", ")", ";", "return", ";", "}", "var", "match", "=", "/", "[", "a", "-", "f0", "-", "9", "]", "{", "2", "}", "(:", "[", "a", "-", "f0", "-", "9", "]", "{", "2", "}", "){", "5", "}", "/.", "exec", "(", "out", ".", "toLowerCase", "(", "))", ";", "if", "(", "!", "match", ")", "{", "callback", "(", "\"", "did", "not", "find", "a", "mac", "address", "\"", ",", "null", ")", ";", "return", ";", "}", "callback", "(", "null", ",", "match", "[", "0", "]", ");", "}", ");", "}", ";", "@", "@", "-", "1", ",", "7", "+", "1", ",", "7", "@", "@", "var", "exec", "=", "require", "(", "'", "child_process", "'", ").", "exec", ";", "exec", "(", "\"", "ifconfig", "\"", "+", "iface", ",", "function", "(", "err", ",", "out", ")", "{", "var", "exec", "=", "require", "(", "'", "child_process", "'", ").", "exec", ";", "exec", "(", "\"", "ipconfig", "/", "all", "\"", ",", "function", "(", "err", ",", "out", ")", "{", "\"", "version", "\"", ":", "\"", "0", ".", "2", ".", "9", "\"", ","], "docstring_tokens": ["command", "injection"]}
{"contents": ["Fix", "bug", "#72606:", "heap-buffer-overflow", "(write)", "simplestring_addn", "simplestring.c"], "code_tokens": ["/", "*", "Copyright", "2000", "Epinions", ",", "Inc", ".", "Subject", "to", "the", "following", "3", "conditions", ",", "Epinions", ",", "Inc", ".", "permits", "you", ",", "free", "of", "charge", ",", "to", "(", "a", ")", "use", ",", "copy", ",", "distribute", ",", "modify", ",", "perform", "and", "display", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "and", "(", "b", ")", "permit", "others", "to", "whom", "the", "Software", "is", "furnished", "to", "do", "so", "as", "well", ".", "1", ")", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "without", "modification", "in", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "2", ")", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "ANY", "WARRANTY", "OR", "CONDITION", "OF", "ANY", "KIND", ",", "EXPRESS", ",", "IMPLIED", "OR", "STATUTORY", ",", "INCLUDING", "WITHOUT", "LIMITATION", "ANY", "IMPLIED", "WARRANTIES", "OF", "ACCURACY", ",", "MERCHANTABILITY", ",", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "OR", "NONINFRINGEMENT", ".", "3", ")", "IN", "NO", "EVENT", "SHALL", "EPINIONS", ",", "INC", ".", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "SPECIAL", ",", "INCIDENTAL", "OR", "CONSEQUENTIAL", "DAMAGES", "OR", "LOST", "PROFITS", "ARISING", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "(", "HOWEVER", "ARISING", ",", "INCLUDING", "NEGLIGENCE", ")", ",", "EVEN", "IF", "EPINIONS", ",", "INC", ".", "IS", "AWARE", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGES", ".", "*", "*", "void", "simplestring_addn", "(", "simplestring", "*", "target", ",", "const", "char", "*", "source", ",", "size_t", "add_len", ")", "{", "size_t", "newsize", "=", "target", "-", ">", "size", ",", "incr", "=", "0", ";", "if", "(", "(", "SIZE_MAX", "-", "add_len", ")", "<", "target", "-", ">", "len", "|", "|", "(", "SIZE_MAX", "-", "add_len", "-", "1", ")", "<", "target", "-", ">", "len", ")", "{", "/", "*", "check", "for", "overflows", ",", "if", "there", "'", "s", "a", "potential", "overflow", "do", "nothing", "*", "/", "return", ";", "}", "newsize", "=", "target", "-", ">", "len", "+", "add_len", "+", "1", ";", "incr", "=", "target", "-", ">", "size", "*", "2", ";", "if", "(", "incr", ")", "{", "newsize", "=", "newsize", "-", "(", "newsize", "%", "incr", ")", "+", "incr", ";", "}", "if", "(", "newsize", "<", "(", "target", "-", ">", "len", "+", "add_len", "+", "1", ")", ")", "{", "/", "*", "some", "kind", "of", "overflow", "happened", "*", "/", "return", ";", "}", "void", "simplestring_addn", "(", "simplestring", "*", "string", ",", "const", "char", "*", "add", ",", "size_t", "add_len", ")", ";</s>/", "*", "Copyright", "2000", "Epinions", ",", "Inc", ".", "Subject", "to", "the", "following", "3", "conditions", ",", "Epinions", ",", "Inc", ".", "permits", "you", ",", "free", "of", "charge", ",", "to", "(", "a", ")", "use", ",", "copy", ",", "distribute", ",", "modify", ",", "perform", "and", "display", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "and", "(", "b", ")", "permit", "others", "to", "whom", "the", "Software", "is", "furnished", "to", "do", "so", "as", "well", ".", "1", ")", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "without", "modification", "in", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "2", ")", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "ANY", "WARRANTY", "OR", "CONDITION", "OF", "ANY", "KIND", ",", "EXPRESS", ",", "IMPLIED", "OR", "STATUTORY", ",", "INCLUDING", "WITHOUT", "LIMITATION", "ANY", "IMPLIED", "WARRANTIES", "OF", "ACCURACY", ",", "MERCHANTABILITY", ",", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "OR", "NONINFRINGEMENT", ".", "3", ")", "IN", "NO", "EVENT", "SHALL", "EPINIONS", ",", "INC", ".", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "SPECIAL", ",", "INCIDENTAL", "OR", "CONSEQUENTIAL", "DAMAGES", "OR", "LOST", "PROFITS", "ARISING", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "(", "HOWEVER", "ARISING", ",", "INCLUDING", "NEGLIGENCE", ")", ",", "EVEN", "IF", "EPINIONS", ",", "INC", ".", "IS", "AWARE", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGES", ".", "*", "*", "void", "simplestring_addn", "(", "simplestring", "*", "target", ",", "const", "char", "*", "source", ",", "int", "add_len", ")", "{", "int", "newsize", "=", "target", "-", ">", "len", "+", "add_len", "+", "1", ";", "int", "incr", "=", "target", "-", ">", "size", "*", "2", ";", "newsize", "=", "newsize", "-", "(", "newsize", "%", "incr", ")", "+", "incr", ";", "void", "simplestring_addn", "(", "simplestring", "*", "string", ",", "const", "char", "*", "add", ",", "int", "add_len", ")", ";"], "docstring_tokens": ["integer", "signedness"]}
{"contents": ["net:", "phy:", "mdio-bcm-unimac:", "fix", "potential", "NULL", "dereference", "in", "unimac_mdio_probe()", "platform_get_resource()", "may", "fail", "and", "return", "NULL,", "so", "we", "should", "better", "check", "it's", "return", "value", "to", "avoid", "a", "NULL", "pointer", "dereference", "a", "bit", "later", "in", "the", "code.", "This", "is", "detected", "by", "Coccinelle", "semantic", "patch.", "@@", "expression", "pdev,", "res,", "n,", "t,", "e,", "e1,", "e2;", "@@", "res", "=", "platform_get_resource(pdev,", "t,", "n);", "+", "if", "(!res)", "+", "return", "-EINVAL;", "...", "when", "!=", "res", "==", "NULL", "e", "=", "devm_ioremap(e1,", "res->start,", "e2);", "Signed-off-by:", "Wei", "Yongjun", "<weiyongjun1@huawei.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "!", "r", ")", "return", "-", "EINVAL", ";</s>"], "docstring_tokens": ["pointer", "dereference)."]}
{"contents": ["Merge", "pull", "request", "#87", "from", "odinn1984/fix/fail_on_outside_target_files", "fix:", "fail", "when", "trying", "to", "extract", "outside", "of", "dest", "dir"], "code_tokens": ["/", "/", "Make", "sure", "that", "the", "resolved", "path", "of", "the", "extracted", "file", "doesn", "'", "t", "escape", "the", "destination", "directory", "String", "canonicalDirPath", "=", "dir", ".", "getCanonicalPath", "(", ");", "String", "canonicalDestPath", "=", "f", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "canonicalDestPath", ".", "startsWith", "(", "canonicalDirPath", ")", ")", "{", "throw", "new", "ArchiverException", "(", "\"", "Entry", "is", "outside", "of", "the", "target", "directory", "(", "\"", "+", "entryName", "+", "\"", ")\"", ")", ";", "}", "public", "void", "testExtractingZipWithEntryOutsideDestDirThrowsException", "(", ")", "throws", "Exception", "{", "Exception", "ex", "=", "null", ";", "String", "s", "=", "\"", "target", "/", "zip", "-", "unarchiver", "-", "slip", "-", "tests", "\"", ";", "File", "testZip", "=", "new", "File", "(", "getBasedir", "(", "),", "\"", "src", "/", "test", "/", "zips", "/", "zip", "-", "slip", ".", "zip", "\"", ")", ";", "File", "outputDirectory", "=", "new", "File", "(", "getBasedir", "(", "),", "s", ")", ";", "FileUtils", ".", "deleteDirectory", "(", "outputDirectory", ")", ";", "try", "{", "ZipUnArchiver", "zu", "=", "getZipUnArchiver", "(", "testZip", ")", ";", "zu", ".", "extract", "(", "\"", "\",", "outputDirectory", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "ex", "=", "e", ";", "}", "assertNotNull", "(", "ex", ")", ";", "assertTrue", "(", "ex", ".", "getMessage", "(", ").", "startsWith", "(", "\"", "Entry", "is", "outside", "of", "the", "target", "directory", "\"", ")", ")", ";", "}</s>"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["[PATCH]", "smbfs", "chroot", "issue", "(", ")", "Mark", "Moseley", "reported", "that", "a", "chroot", "environment", "on", "a", "SMB", "share", "can", "be", "left", "via", "\"cd", "..\\\\\".", "Similar", "to", "issue", "with", "cifs,", "this", "fix", "is", "for", "smbfs.", "Steven", "French", "<sfrench@us.ibm.com>", "wrote:", "Looks", "fine", "to", "me.", "This", "should", "catch", "the", "slash", "on", "lookup", "or", "equivalent,", "which", "will", "be", "all", "obvious", "paths", "of", "interest.", "Signed-off-by:", "Chris", "Wright", "<chrisw@sous-sol.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["/", "*", "Do", "not", "allow", "lookup", "of", "names", "with", "backslashes", "in", "*", "/", "error", "=", "-", "EINVAL", ";", "if", "(", "memchr", "(", "dentry", "-", ">", "d_name", ".", "name", ",", "'", "\\\\", "',", "dentry", "-", ">", "d_name", ".", "len", ")", ")", "goto", "out", ";</s>"], "docstring_tokens": ["smbfs", "chroot", "security", "restriction", "bypass"]}
{"contents": ["chore(war-agent):", "Throw", "exception", "if", "proxy", "mode", "is", "used", "but", "not", "enabled", "explicitly.", "This", "is", "to", "avoid", "confusion", "as", "it", "was", "switched", "on", "by", "default", "and", "if", "a", "proxy", "request", "would", "simply", "be", "ignored,", "then", "the", "MBeans", "from", "the", "proxy", "server", "would", "be", "silently", "returned", "without", "error."], "code_tokens": ["String", "dispatchers", "=", "pConfig", ".", "get", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ")", ";", "String", "jsr160DispatcherClass", "=", "\"", "org", ".", "jolokia", ".", "jsr160", ".", "Jsr160RequestDispatcher", "\"", ";", "if", "(", "dispatchers", "=", "=", "null", "|", "|", "!", "dispatchers", ".", "contains", "(", "jsr160DispatcherClass", ")", ")", "{", "for", "(", "String", "param", ":", "new", "String", "[", "]{", "System", ".", "getProperty", "(", "\"", "org", ".", "jolokia", ".", "jsr160ProxyEnabled", "\"", "),", "System", ".", "getenv", "(", "\"", "JOLOKIA_JSR160_PROXY_ENABLED", "\"", ")", "}", ")", "{", "if", "(", "param", "!", "=", "null", "&", "&", "(", "param", ".", "isEmpty", "(", ")", "|", "|", "Boolean", ".", "parseBoolean", "(", "param", ")", "))", "{", "{", "pConfig", ".", "updateGlobalConfiguration", "(", "Collections", ".", "singletonMap", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ".", "getKeyValue", "(", "),", "(", "dispatchers", "!", "=", "null", "?", "dispatchers", "+", "\"", ",\"", ":", "\"", "\")", "+", "jsr160DispatcherClass", ")", ");", "}", "return", ";", "}", "}", "if", "(", "dispatchers", "=", "=", "null", ")", "{", "/", "/", "We", "add", "a", "breaking", "dispatcher", "to", "avoid", "silently", "ignoring", "a", "JSR160", "proxy", "request", "/", "/", "when", "it", "is", "now", "enabled", "pConfig", ".", "updateGlobalConfiguration", "(", "Collections", ".", "singletonMap", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ".", "getKeyValue", "(", "),", "Jsr160ProxyNotEnabledByDefaultAnymoreDispatcher", ".", "class", ".", "getCanonicalName", "(", "))", ");", "package", "org", ".", "jolokia", ".", "http", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "management", ".", "AttributeNotFoundException", ";", "import", "javax", ".", "management", ".", "InstanceNotFoundException", ";", "import", "javax", ".", "management", ".", "MBeanException", ";", "import", "javax", ".", "management", ".", "ReflectionException", ";", "import", "org", ".", "jolokia", ".", "backend", ".", "RequestDispatcher", ";", "import", "org", ".", "jolokia", ".", "backend", ".", "executor", ".", "NotChangedException", ";", "import", "org", ".", "jolokia", ".", "config", ".", "Configuration", ";", "import", "org", ".", "jolokia", ".", "converter", ".", "Converters", ";", "import", "org", ".", "jolokia", ".", "detector", ".", "ServerHandle", ";", "import", "org", ".", "jolokia", ".", "handler", ".", "RequestHandlerManager", ";", "import", "org", ".", "jolokia", ".", "request", ".", "JmxRequest", ";", "import", "org", ".", "jolokia", ".", "restrictor", ".", "Restrictor", ";", "/", "**", "*", "Temporary", "dispatcher", "added", "to", "avoid", "confusion", "for", "users", "which", "use", "1", ".", "5", ".", "0", "as", "a", "drop", "in", "replacement", "*", "for", "a", "JSR", "-", "160", "proxy", "server", ".", "Otherwise", "Jolokia", "requests", "for", "a", "JSR", "-", "160", "target", "will", "be", "silently", "*", "ignored", "and", "the", "MBeans", "of", "the", "Proxy", "server", "would", "be", "queried", ".", "*", "*", "@", "author", "roland", "*", "@", "since", "08", ".", "02", ".", "18", "*", "/", "public", "class", "Jsr160ProxyNotEnabledByDefaultAnymoreDispatcher", "implements", "RequestDispatcher", "{", "/", "/", "Constructor", "required", "for", "the", "backend", "to", "be", "able", "to", "crete", "the", "constructor", "public", "Jsr160ProxyNotEnabledByDefaultAnymoreDispatcher", "(", "Converters", "pConverters", ",", "ServerHandle", "pServerInfo", ",", "Restrictor", "pRestrictor", ",", "Configuration", "pConfig", ")", "{", "}", "@", "Override", "public", "Object", "dispatchRequest", "(", "JmxRequest", "pJmxReq", ")", "throws", "InstanceNotFoundException", ",", "AttributeNotFoundException", ",", "ReflectionException", ",", "MBeanException", ",", "IOException", ",", "NotChangedException", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "No", "JSR", "-", "160", "proxy", "is", "enabled", "by", "default", "since", "Jolokia", "1", ".", "5", ".", "0", ".", "\"", "\"", "Please", "refer", "to", "the", "reference", "manual", ",", "section", "\\", "\"", "Proxy", "Mode", "\\", "\",", "\"", "\"", "for", "how", "to", "switch", "on", "JSR", "-", "160", "proxy", "mode", "again", ".", "\")", ";", "}", "@", "Override", "public", "boolean", "canHandle", "(", "JmxRequest", "pJmxRequest", ")", "{", "return", "pJmxRequest", ".", "getTargetConfig", "(", ")", "!", "=", "null", ";", "}", "@", "Override", "public", "boolean", "useReturnValueWithPath", "(", "JmxRequest", "pJmxRequest", ")", "{", "return", "false", ";", "}", "}</s>for", "(", "String", "param", ":", "new", "String", "[", "]", "{", "System", ".", "getProperty", "(", "\"", "org", ".", "jolokia", ".", "jsr160ProxyEnabled", "\"", "),", "System", ".", "getenv", "(", "\"", "JOLOKIA_JSR160_PROXY_ENABLED", "\"", ")", "}", ")", "{", "if", "(", "param", "!", "=", "null", "&", "&", "(", "param", ".", "isEmpty", "(", ")", "|", "|", "Boolean", ".", "parseBoolean", "(", "param", ")", "))", "{", "String", "dispatchers", "=", "pConfig", ".", "get", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ")", ";", "pConfig", ".", "updateGlobalConfiguration", "(", "Collections", ".", "singletonMap", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ".", "getKeyValue", "(", "),", "(", "dispatchers", "!", "=", "null", "?", "dispatchers", "+", "\"", ",\"", ":", "\"", "\")", "+", "\"", "org", ".", "jolokia", ".", "jsr160", ".", "Jsr160RequestDispatcher", "\"", "))", ";", "return", ";"], "docstring_tokens": ["jndi", "injection"]}
{"contents": ["Fix", "bug", "#69923", "-", "Buffer", "overflow", "and", "stack", "smashing", "error", "in", "phar_fix_filepath"], "code_tokens": ["char", "*", "newpath", ";", "newpath", "=", "emalloc", "(", "strlen", "(", "path", ")", "+", "newpath_len", "+", "1", ")", ";", "newpath", "=", "emalloc", "(", "strlen", "(", "path", ")", "+", "2", ")", ";", "efree", "(", "newpath", ")", ";", "efree", "(", "newpath", ")", ";", "efree", "(", "newpath", ")", ";", "newpath", "[", "newpath_len", "]", "=", "'", "\\", "0", "'", ";", "return", "erealloc", "(", "newpath", ",", "newpath_len", "+", "1", ")", ";</s>char", "newpath", "[", "MAXPATHLEN", "]", ";", "return", "estrndup", "(", "newpath", ",", "newpath_len", ")", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["Plugins:", "Editor,", "added", "OWASP", "sanitizer"], "code_tokens": ["<", "properties", ">", "<", "bundle", ".", "namespace", ">", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "ui", ".", "plugins", "<", "/", "bundle", ".", "namespace", ">", "<", "!-", "-", "SANITIZER", "DEPENDENCIES", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "owasp", "-", "java", "-", "html", "-", "sanitizer", "<", "/", "groupId", ">", "<", "artifactId", ">", "owasp", "-", "java", "-", "html", "-", "sanitizer", "<", "/", "artifactId", ">", "<", "version", ">", "20171016", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "felix", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "bundle", "-", "plugin", "<", "/", "artifactId", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "import", "org", ".", "owasp", ".", "html", ".", "HtmlPolicyBuilder", ";", "import", "org", ".", "owasp", ".", "html", ".", "PolicyFactory", ";", "/", "**", "*", "Gets", "a", "new", "{", "@", "link", "PolicyFactory", "}", "to", "sanitize", "editor", "input", "*", "*", "@", "return", "a", "new", "{", "@", "code", "PolicyFactory", "}", "*", "/", "protected", "PolicyFactory", "newPolicyFactory", "(", ")", "{", "return", "new", "HtmlPolicyBuilder", "(", ")", "/", "/", "lf", ".", "allowCommonInlineFormattingElements", "(", ")", "/", "/", "lf", ".", "allowCommonBlockElements", "(", ")", "/", "/", "lf", ".", "allowElements", "(", "\"", "a", "\"", ").", "allowAttributes", "(", "\"", "href", "\"", ",", "\"", "target", "\"", ").", "onElements", "(", "\"", "a", "\"", ")", "/", "/", "lf", ".", "allowAttributes", "(", "\"", "size", "\"", ").", "onElements", "(", "\"", "font", "\"", ")", "/", "/", "lf", ".", "allowAttributes", "(", "\"", "class", "\"", ",", "\"", "style", "\"", ").", "globally", "(", ")", "/", "/", "lf", ".", "toFactory", "(", ");", "}", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "html", "=", "this", ".", "textarea", ".", "getConvertedInput", "(", ");", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "html", ")", ");</s><", "properties", ">", "<", "bundle", ".", "namespace", ">", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "ui", ".", "plugins", "<", "/", "bundle", ".", "namespace", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "felix", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "bundle", "-", "plugin", "<", "/", "artifactId", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "this", ".", "setConvertedInput", "(", "this", ".", "textarea", ".", "getConvertedInput", "(", "))", ";"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["Add", "auth", "to", "UtilityService", "Extend", "auth", "check", "to", "UtiliyService", "endpoints:", "stats,", "config,", "subscription", "Issue:", "VRXEN-5", "Change-Id:", "I52a4b4a42731c244a97f97610dcaddb6837e67fb"], "code_tokens": ["String", "suffix", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "URI_PATH_CHAR", ",", "UriUtils", ".", "getLastPathSegment", "(", "op", ".", "getUri", "(", "))", ");", "/", "/", "allow", "access", "to", "ui", "endpoint", "if", "(", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ".", "equals", "(", "suffix", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "ServiceDocument", "doc", "=", "new", "ServiceDocument", "(", ");", "if", "(", "this", ".", "parent", ".", "getOptions", "(", ").", "contains", "(", "ServiceOption", ".", "FACTORY_ITEM", ")", ")", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "getParentPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "))", ",", "suffix", ")", ";", "}", "else", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "),", "suffix", ")", ";", "}", "doc", ".", "documentKind", "=", "Utils", ".", "buildKind", "(", "this", ".", "parent", ".", "getStateType", "(", "))", ";", "if", "(", "getHost", "(", ").", "isAuthorized", "(", "this", ".", "parent", ",", "doc", ",", "op", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "op", ".", "fail", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "OperationContext", ".", "setAuthorizationContext", "(", "this", ".", "host", ".", "getSystemAuthorizationContext", "(", "))", ";", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "OperationContext", ".", "setAuthorizationContext", "(", "this", ".", "host", ".", "getSystemAuthorizationContext", "(", "))", ";", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "stats", ",", "we", "should", "get", "403", "Operation", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "config", ",", "we", "should", "get", "403", "Operation", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "403", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "}", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "200", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "statsGet", ".", "addRequestHeader", "(", "Operation", ".", "REQUEST_AUTH_TOKEN_HEADER", ",", "authToken", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectSuccess", "(", "statsGet", ")", ";", "}", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "assumeIdentity", "(", "userPath", ")", ";", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "ServiceStat", "stats", "=", "this", ".", "host", ".", "getServiceStats", "(", "managementServiceUri", ")", "return", "stats", ";", "hostWithAuth", ".", "setSystemAuthorizationContext", "(", ");", "hostWithAuth", ".", "resetAuthorizationContext", "(", ");", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_TEMPLATE", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "AuthTestUtils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ".", "FailureResponse", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "VerificationHost", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "AuthorizationContextService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ".", "Query", ";", "@", "Test", "public", "void", "endpointAuthorization", "(", ")", "throws", "Throwable", "{", "VerificationHost", "host", "=", "VerificationHost", ".", "create", "(", "0", ")", ";", "host", ".", "setAuthorizationService", "(", "new", "AuthorizationContextService", "(", "))", ";", "host", ".", "setAuthorizationEnabled", "(", "true", ")", ";", "host", ".", "setMaintenanceIntervalMicros", "(", "TimeUnit", ".", "MILLISECONDS", ".", "toMicros", "(", "100", ")", ");", "host", ".", "start", "(", ");", "TestRequestSender", "sender", "=", "host", ".", "getTestRequestSender", "(", ");", "host", ".", "setSystemAuthorizationContext", "(", ");", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "UriUtils", ".", "buildUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ");", "String", "exampleUser", "=", "\"", "example", "@", "vmware", ".", "com", "\"", ";", "String", "examplePass", "=", "\"", "password", "\"", ";", "TestContext", "authCtx", "=", "host", ".", "testCreate", "(", "1", ")", ";", "AuthorizationSetupHelper", ".", "create", "(", ")", ".", "setHost", "(", "host", ")", ".", "setUserEmail", "(", "exampleUser", ")", ".", "setUserPassword", "(", "examplePass", ")", ".", "setResourceQuery", "(", "Query", ".", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_KIND", ",", "Utils", ".", "buildKind", "(", "ExampleServiceState", ".", "class", ")", ")", ".", "build", "(", "))", ".", "setCompletion", "(", "authCtx", ".", "getCompletion", "(", "))", ".", "start", "(", ");", "authCtx", ".", "await", "(", ");", "/", "/", "create", "a", "sample", "service", "ExampleServiceState", "doc", "=", "new", "ExampleServiceState", "(", ");", "doc", ".", "name", "=", "\"", "foo", "\"", ";", "doc", ".", "documentSelfLink", "=", "\"", "foo", "\"", ";", "Operation", "post", "=", "Operation", ".", "createPost", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ".", "setBody", "(", "doc", ")", ";", "ExampleServiceState", "postResult", "=", "sender", ".", "sendAndWait", "(", "post", ",", "ExampleServiceState", ".", "class", ")", ";", "host", ".", "resetAuthorizationContext", "(", ");", "URI", "factoryAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factorySubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "factoryUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "URI", "serviceAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceSubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "serviceUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "/", "/", "check", "non", "-", "authenticated", "user", "receives", "forbidden", "response", "FailureResponse", "failureResponse", ";", "Operation", "uiOpResult", ";", "/", "/", "check", "factory", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "authenticated", "user", "does", "NOT", "receive", "forbidden", "response", "AuthTestUtils", ".", "login", "(", "host", ",", "exampleUser", ",", "examplePass", ")", ";", "Operation", "response", ";", "/", "/", "check", "factory", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "}", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ";", "/", "/", "Create", "resource", "group", "to", "allow", "access", "on", "utility", "paths", "String", "statsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "stats", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ".", "build", "(", "))", ";", "String", "subscriptionsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "subs", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ServiceUriPaths", ".", "CORE_LOCAL_QUERY_TASKS", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_SUBSCRIPTIONS", ")", ".", "build", "(", "))", ";", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "stats", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "statsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "subscriptions", "of", "query", "tasks", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "subscriptionsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "OperationContext", ";", "AuthorizationContext", "ctx", "=", "null", ";", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "ctx", "=", "OperationContext", ".", "getAuthorizationContext", "(", ");", "this", ".", "setSystemAuthorizationContext", "(", ");", "}", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "this", ".", "setAuthorizationContext", "(", "ctx", ")", ";", "}", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";</s>op", ".", "complete", "(", ");", "URI", "usersLink", "=", "UriUtils", ".", "buildUri", "(", "hostUri", ",", "UserService", ".", "FACTORY_LINK", ")", ";", "/", "/", "wait", "for", "factory", "availability", "this", ".", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "usersLink", ")", ";", "this", ".", "host", ".", "assumeIdentity", "(", "userPath", ")", ";", "return", "this", ".", "host", ".", "getServiceStats", "(", "managementServiceUri", ")", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildStatsUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["feat:", "XML::Schema", "and", "RelaxNG", "creation", "accept", "optional", "ParseOptions", "I'm", "trying", "out", "a", "new", "pattern,", "which", "is", "that", "the", "parsed", "object", "carries", "around", "the", "ParseOptions", "it", "was", "created", "with,", "which", "should", "make", "some", "testing", "a", "bit", "easier.", "I'm", "also", "not", "implementing", "the", "\"config", "block\"", "pattern", "in", "use", "for", "Documents,", "because", "I", "think", "the", "UX", "is", "weird", "and", "I'm", "hoping", "to", "change", "everything", "to", "use", "kwargs", "in", "a", "2.0", "release,", "anyway."], "code_tokens": ["import", "org", ".", "jruby", ".", "runtime", ".", "builtin", ".", "IRubyObject", ";", "static", "XmlSchema", "createSchemaInstance", "(", "ThreadContext", "context", ",", "RubyClass", "klazz", ",", "Source", "source", ",", "IRubyObject", "parseOptions", ")", "{", "if", "(", "parseOptions", "=", "=", "null", ")", "{", "parseOptions", "=", "defaultParseOptions", "(", "context", ".", "getRuntime", "(", "))", ";", "}", "xmlRelaxng", ".", "setInstanceVariable", "(", "\"@", "parse_options", "\"", ",", "parseOptions", ")", ";", "static", "XmlSchema", "createSchemaInstance", "(", "ThreadContext", "context", ",", "RubyClass", "klazz", ",", "Source", "source", ",", "IRubyObject", "parseOptions", ")", "{", "if", "(", "parseOptions", "=", "=", "null", ")", "{", "parseOptions", "=", "defaultParseOptions", "(", "context", ".", "getRuntime", "(", "))", ";", "}", "xmlSchema", ".", "setInstanceVariable", "(", "\"@", "parse_options", "\"", ",", "parseOptions", ")", ";", "protected", "static", "IRubyObject", "defaultParseOptions", "(", "Ruby", "runtime", ")", "{", "return", "(", "(", "RubyClass", ")", "runtime", ".", "getClassFromPath", "(", "\"", "Nokogiri", ":", ":", "XML", ":", ":", "ParseOptions", "\"", "))", ".", "getConstant", "(", "\"", "DEFAULT_SCHEMA", "\"", ");", "}", "@", "JRubyMethod", "(", "meta", "=", "true", ",", "required", "=", "1", ",", "optional", "=", "1", ")", "public", "static", "IRubyObject", "from_document", "(", "ThreadContext", "context", ",", "IRubyObject", "klazz", ",", "IRubyObject", "[", "]", "args", ")", "{", "IRubyObject", "document", "=", "args", "[", "0", "]", ";", "IRubyObject", "parseOptions", "=", "null", ";", "if", "(", "args", ".", "length", ">", "1", ")", "{", "parseOptions", "=", "args", "[", "1", "]", ";", "}", "return", "getSchema", "(", "context", ",", "(", "RubyClass", ")", "klazz", ",", "source", ",", "parseOptions", ")", ";", "@", "JRubyMethod", "(", "meta", "=", "true", ",", "required", "=", "1", ",", "optional", "=", "1", ")", "public", "static", "IRubyObject", "read_memory", "(", "ThreadContext", "context", ",", "IRubyObject", "klazz", ",", "IRubyObject", "[", "]", "args", ")", "{", "IRubyObject", "content", "=", "args", "[", "0", "]", ";", "IRubyObject", "parseOptions", "=", "null", ";", "if", "(", "args", ".", "length", ">", "1", ")", "{", "parseOptions", "=", "args", "[", "1", "]", ";", "}", "String", "data", "=", "content", ".", "convertToString", "(", ").", "asJavaString", "(", ");", "return", "getSchema", "(", "context", ",", "(", "RubyClass", ")", "klazz", ",", "new", "StreamSource", "(", "new", "StringReader", "(", "data", ")", "),", "parseOptions", ")", ";", "}", "private", "static", "IRubyObject", "getSchema", "(", "ThreadContext", "context", ",", "RubyClass", "klazz", ",", "Source", "source", ",", "IRubyObject", "parseOptions", ")", "{", "return", "XmlSchema", ".", "createSchemaInstance", "(", "context", ",", "klazz", ",", "source", ",", "parseOptions", ")", ";", "return", "XmlRelaxng", ".", "createSchemaInstance", "(", "context", ",", "klazz", ",", "source", ",", "parseOptions", ")", ";</s>static", "XmlSchema", "createSchemaInstance", "(", "ThreadContext", "context", ",", "RubyClass", "klazz", ",", "Source", "source", ")", "{", "static", "XmlSchema", "createSchemaInstance", "(", "ThreadContext", "context", ",", "RubyClass", "klazz", ",", "Source", "source", ")", "{", "@", "JRubyMethod", "(", "meta", "=", "true", ")", "public", "static", "IRubyObject", "from_document", "(", "ThreadContext", "context", ",", "IRubyObject", "klazz", ",", "IRubyObject", "document", ")", "{", "return", "getSchema", "(", "context", ",", "(", "RubyClass", ")", "klazz", ",", "source", ")", ";", "private", "static", "IRubyObject", "getSchema", "(", "ThreadContext", "context", ",", "RubyClass", "klazz", ",", "Source", "source", ")", "{", "return", "XmlSchema", ".", "createSchemaInstance", "(", "context", ",", "klazz", ",", "source", ")", ";", "return", "XmlRelaxng", ".", "createSchemaInstance", "(", "context", ",", "klazz", ",", "source", ")", ";", "@", "JRubyMethod", "(", "meta", "=", "true", ")", "public", "static", "IRubyObject", "read_memory", "(", "ThreadContext", "context", ",", "IRubyObject", "klazz", ",", "IRubyObject", "content", ")", "{", "String", "data", "=", "content", ".", "convertToString", "(", ").", "asJavaString", "(", ");", "return", "getSchema", "(", "context", ",", "(", "RubyClass", ")", "klazz", ",", "new", "StreamSource", "(", "new", "StringReader", "(", "data", ")", "))", ";", "}"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["Avoid", "out-of-bounds", "read", "Fixes", "CVE", "2017-3735", "Reviewed-by:", "Kurt", "Roeckx", "<kurt@roeckx.be>", "(Merged", "from", "https://github.com/openssl/openssl/pull/4276)", "(cherry", "picked", "from", "commit", "b23171744b01e473ebbfd6edad70c1c3825ffbcd)"], "code_tokens": ["if", "(", "f", "=", "=", "NULL", "|", "|", "f", "-", ">", "addressFamily", "=", "=", "NULL", "|", "|", "f", "-", ">", "addressFamily", "-", ">", "data", "=", "=", "NULL", "|", "|", "f", "-", ">", "addressFamily", "-", ">", "length", "<", "2", ")", "return", "0", ";", "return", "(", "f", "-", ">", "addressFamily", "-", ">", "data", "[", "0", "]", "<", "<", "8", ")", "|", "f", "-", ">", "addressFamily", "-", ">", "data", "[", "1", "]", ";</s>return", "(", "(", "f", "!", "=", "NULL", "&", "&", "f", "-", ">", "addressFamily", "!", "=", "NULL", "&", "&", "f", "-", ">", "addressFamily", "-", ">", "data", "!", "=", "NULL", ")", "?", "(", "(", "f", "-", ">", "addressFamily", "-", ">", "data", "[", "0", "]", "<", "<", "8", ")", "|", "(", "f", "-", ">", "addressFamily", "-", ">", "data", "[", "1", "]", "))", ":", "0", ")", ";"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["ipv4:", "fix", "NULL", "pointer", "+", "success", "return", "in", "route", "lookup", "path", "Don't", "drop", "route", "if", "we're", "not", "caching", "I", "recently", "got", "a", "report", "of", "an", "oops", "on", "a", "route", "lookup.", "Maxime", "was", "testing", "what", "would", "happen", "if", "route", "caching", "was", "turned", "off", "(doing", "so", "by", "setting", "making", "rt_caching", "always", "return", "0),", "and", "found", "that", "it", "triggered", "an", "oops.", "I", "looked", "at", "it", "and", "found", "that", "the", "problem", "stemmed", "from", "the", "fact", "that", "the", "route", "lookup", "routines", "were", "returning", "success", "from", "their", "lookup", "paths", "(which", "is", "good),", "but", "never", "set", "the", "**rp", "pointer", "to", "anything", "(which", "is", "bad).", "This", "happens", "because", "in", "rt_intern_hash,", "if", "rt_caching", "returns", "false,", "we", "call", "rt_drop", "and", "return", "0.", "This", "almost", "emulates", "slient", "success.", "What", "we", "should", "be", "doing", "is", "assigning", "*rp", "=", "rt", "and", "_not_", "dropping", "the", "route.", "This", "way,", "during", "slow", "path", "lookups,", "when", "we", "create", "a", "new", "route", "cache", "entry,", "we", "don't", "immediately", "discard", "it,", "rather", "we", "just", "don't", "add", "it", "into", "the", "cache", "hash", "table,", "but", "we", "let", "this", "one", "lookup", "use", "it", "for", "the", "purpose", "of", "this", "route", "request.", "Maxime", "has", "tested", "and", "reports", "it", "prevents", "the", "oops.", "There", "is", "still", "a", "subsequent", "routing", "issue", "that", "I'm", "looking", "into", "further,", "but", "I'm", "confident", "that,", "even", "if", "its", "related", "to", "this", "same", "path,", "this", "patch", "makes", "sense", "to", "take.", "Signed-off-by:", "Neil", "Horman", "<nhorman@tuxdriver.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["/", "*", "*", "If", "we", "'", "re", "not", "caching", ",", "just", "tell", "the", "caller", "we", "*", "were", "successful", "and", "don", "'", "t", "touch", "the", "route", ".", "The", "*", "caller", "hold", "the", "sole", "reference", "to", "the", "cache", "entry", ",", "and", "*", "it", "will", "be", "released", "when", "the", "caller", "is", "done", "with", "it", ".", "*", "If", "we", "drop", "it", "here", ",", "the", "callers", "have", "no", "way", "to", "resolve", "routes", "*", "when", "we", "'", "re", "not", "caching", ".", "Instead", ",", "just", "point", "*", "rp", "at", "rt", ",", "so", "*", "the", "caller", "gets", "a", "single", "use", "out", "of", "the", "route", "*", "/", "goto", "report_and_exit", ";", "report_and_exit", ":</s>rt_drop", "(", "rt", ")", ";", "return", "0", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Disable", "dynamic", "scripting", "by", "default", "Closes", "#5853"], "code_tokens": ["added", "[", "1", ".", "2", ".", "0", ",", "Dynamic", "scripting", "is", "disabled", "by", "default", "since", "version", "1", ".", "2", ".", "0", "]", "To", "increase", "security", ",", "Elasticsearch", "does", "not", "allow", "you", "to", "specify", "scripts", "with", "a", "request", ".", "Instead", ",", "scripts", "must", "be", "placed", "in", "the", "`", "scripts", "`", "directory", "inside", "the", "configuration", "directory", "(", "the", "directory", "where", "elasticsearch", ".", "yml", "is", ")", ".", "Scripts", "placed", "into", "this", "directory", "will", "automatically", "be", "picked", "up", "and", "be", "available", "to", "be", "used", ".", "Once", "a", "script", "has", "been", "placed", "in", "this", "directory", ",", "it", "can", "be", "referenced", "by", "name", ".", "For", "example", ",", "a", "script", "called", "`", "calculate", "-", "score", ".", "mvel", "`", "can", "be", "referenced", "in", "a", "request", "like", "this", ":", "[", "source", "]", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "$", "tree", "config", "config", "\u251c", "\u2500\u2500", "elasticsearch", ".", "yml", "\u251c", "\u2500\u2500", "logging", ".", "yml", "\u2514", "\u2500\u2500", "scripts", "\u2514", "\u2500\u2500", "calculate", "-", "score", ".", "mvel", "$", "cat", "config", "/", "scripts", "/", "calculate", "-", "score", ".", "mvel", "Math", ".", "log", "(", "_score", "*", "2", ")", "+", "my_modifier", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "[", "source", ",", "js", "]", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "curl", "-", "XPOST", "localhost", ":", "9200", "/", "_search", "-", "d", "'", "{", "\"", "query", "\"", ":", "{", "\"", "function_score", "\"", ":", "{", "\"", "query", "\"", ":", "{", "\"", "match", "\"", ":", "{", "\"", "body", "\"", ":", "\"", "foo", "\"", "}", "}", ",", "\"", "functions", "\"", ":", "[", "{", "\"", "script_score", "\"", ":", "{", "\"", "script", "\"", ":", "\"", "calculate", "-", "score", "\"", ",", "\"", "params", "\"", ":", "{", "\"", "my_modifier", "\"", ":", "8", "}", "}", "}", "]", "}", "}", "}", "'", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "The", "name", "of", "the", "script", "is", "derived", "from", "the", "hierarchy", "of", "directories", "it", "exists", "under", ",", "and", "the", "file", "name", "without", "the", "lang", "extension", ".", "For", "example", ",", "a", "script", "placed", "under", "`", "config", "/", "scripts", "/", "group1", "/", "group2", "/", "test", ".", "py", "`", "will", "be", "named", "`", "group1_group2_test", "`", ".", "=", "==", "Enabling", "dynamic", "scripting", "running", "as", ".", "For", "this", "reason", "dynamic", "scripting", "is", "disabled", "by", "default", ".", "First", ",", "you", "should", "not", "run", "Elasticsearch", "as", "the", "`", "root", "`", "user", ",", "as", "this", "would", "allow", "a", "script", "to", "access", "or", "do", "*", "anything", "*", "on", "your", "server", ",", "without", "limitations", ".", "Second", ",", "you", "should", "not", "expose", "Elasticsearch", "directly", "to", "users", ",", "but", "instead", "have", "a", "proxy", "application", "inbetween", ".", "If", "you", "*", "do", "*", "intend", "to", "expose", "Elasticsearch", "directly", "to", "your", "users", ",", "then", "you", "have", "to", "decide", "whether", "you", "trust", "them", "enough", "to", "run", "scripts", "on", "your", "box", "or", "not", ".", "If", "you", "do", ",", "you", "can", "enable", "dynamic", "scripting", "by", "adding", "the", "following", "setting", "to", "the", "`", "config", "/", "elasticsearch", ".", "yml", "`", "file", "on", "every", "node", ":", "script", ".", "disable_dynamic", ":", "false", "While", "this", "still", "allows", "execution", "of", "named", "scripts", "provided", "in", "the", "config", ",", "or", "_native_", "Java", "scripts", "registered", "through", "plugins", ",", "it", "also", "allows", "users", "to", "run", "arbitrary", "scripts", "via", "the", "API", ".", "Instead", "of", "sending", "the", "name", "of", "the", "file", "as", "the", "script", ",", "the", "body", "of", "the", "script", "can", "be", "sent", "instead", ".", "see", "<", "<", "modules", "-", "advanced", "-", "scripting", ",", "advanced", "scripting", "documentation", ">", ">", "@", "Override", "public", "boolean", "sandboxed", "(", ")", "{", "return", "false", ";", "}", "boolean", "sandboxed", "(", ");", "this", ".", "disableDynamic", "=", "componentSettings", ".", "getAsBoolean", "(", "\"", "disable_dynamic", "\"", ",", "true", ")", ";", "if", "(", "!", "dynamicScriptEnabled", "(", "lang", ")", ")", "{", "private", "boolean", "dynamicScriptEnabled", "(", "String", "lang", ")", "{", "ScriptEngineService", "service", "=", "scriptEngines", ".", "get", "(", "lang", ")", ";", "if", "(", "service", "=", "=", "null", ")", "{", "throw", "new", "ElasticsearchIllegalArgumentException", "(", "\"", "script_lang", "not", "supported", "[", "\"", "+", "lang", "+", "\"", "]\"", ");", "}", "/", "/", "Templating", "languages", "and", "native", "scripts", "are", "always", "allowed", "/", "/", "\"", "native", "\"", "executions", "are", "registered", "through", "plugins", "if", "(", "service", ".", "sandboxed", "(", ")", "|", "|", "\"", "native", "\"", ".", "equals", "(", "lang", ")", ")", "{", "return", "true", ";", "return", "!", "disableDynamic", ";", "@", "Override", "public", "boolean", "sandboxed", "(", ")", "{", "return", "true", ";", "}", "@", "Override", "public", "boolean", "sandboxed", "(", ")", "{", "return", "false", ";", "}", "builder", ".", "put", "(", "\"", "script", ".", "disable_dynamic", "\"", ",", "false", ")", ";</s>=", "==", "Preloaded", "Scripts", "Scripts", "can", "always", "be", "provided", "as", "part", "of", "the", "relevant", "API", ",", "but", "they", "can", "also", "be", "preloaded", "by", "placing", "them", "under", "`", "config", "/", "scripts", "`", "and", "then", "referencing", "them", "by", "the", "script", "name", "(", "instead", "of", "providing", "the", "full", "script", ")", ".", "This", "helps", "reduce", "the", "amount", "of", "data", "passed", "between", "the", "client", "and", "the", "nodes", ".", "The", "name", "of", "the", "script", "is", "derived", "from", "the", "hierarchy", "of", "directories", "it", "exists", "under", ",", "and", "the", "file", "name", "without", "the", "lang", "extension", ".", "For", "example", ",", "a", "script", "placed", "under", "`", "config", "/", "scripts", "/", "group1", "/", "group2", "/", "test", ".", "py", "`", "will", "be", "named", "`", "group1_group2_test", "`", ".", "[", "float", "]", "=", "==", "Disabling", "dynamic", "scripts", "running", "as", ".", "First", ",", "you", "should", "not", "run", "Elasticsearch", "as", "the", "`", "root", "`", "user", ",", "as", "this", "would", "allow", "a", "script", "to", "access", "or", "do", "*", "anything", "*", "on", "your", "server", ",", "without", "limitations", ".", "Second", ",", "you", "should", "not", "expose", "Elasticsearch", "directly", "to", "users", ",", "but", "instead", "have", "a", "proxy", "application", "inbetween", ".", "If", "you", "*", "do", "*", "intend", "to", "expose", "Elasticsearch", "directly", "to", "your", "users", ",", "then", "you", "have", "to", "decide", "whether", "you", "trust", "them", "enough", "to", "run", "scripts", "on", "your", "box", "or", "not", ".", "If", "not", ",", "then", "even", "if", "you", "have", "a", "proxy", "which", "only", "allows", "`", "GET", "`", "requests", ",", "you", "should", "disable", "dynamic", "scripting", "by", "adding", "the", "following", "setting", "to", "the", "`", "config", "/", "elasticsearch", ".", "yml", "`", "file", "on", "every", "node", ":", "script", ".", "disable_dynamic", ":", "true", "This", "will", "still", "allow", "execution", "of", "named", "scripts", "provided", "in", "the", "config", ",", "or", "_native_", "Java", "scripts", "registered", "through", "plugins", ",", "however", "it", "will", "prevent", "users", "from", "running", "arbitrary", "scripts", "via", "the", "API", ".", "see", "<", "<", "modules", "-", "advanced", "-", "scripting", ",", "advanced", "scripting", "documentation", ">", ">", "this", ".", "disableDynamic", "=", "componentSettings", ".", "getAsBoolean", "(", "\"", "disable_dynamic", "\"", ",", "false", ")", ";", "if", "(", "dynamicScriptDisabled", "(", "lang", ")", ")", "{", "private", "boolean", "dynamicScriptDisabled", "(", "String", "lang", ")", "{", "if", "(", "!", "disableDynamic", ")", "{", "return", "false", ";", "/", "/", "we", "allow", "\"", "native", "\"", "executions", "since", "they", "register", "through", "plugins", ",", "so", "they", "are", "\"", "allowed", "\"", "return", "!", "\"", "native", "\"", ".", "equals", "(", "lang", ")", ";"], "docstring_tokens": ["arbitrary", "java", "execution"]}
{"contents": ["kernel/sys.c:", "fix", "stack", "memory", "content", "leak", "via", "UNAME26", "Calling", "uname()", "with", "the", "UNAME26", "personality", "set", "allows", "a", "leak", "of", "kernel", "stack", "contents.", "This", "fixes", "it", "by", "defensively", "calculating", "the", "length", "of", "copy_to_user()", "call,", "making", "the", "len", "argument", "unsigned,", "and", "initializing", "the", "stack", "buffer", "to", "zero", "(now", "technically", "unneeded,", "but", "hey,", "overkill).", "Reported-by:", "PaX", "Team", "<pageexec@freemail.hu>", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "Andi", "Kleen", "<ak@linux.intel.com>", "Cc:", "PaX", "Team", "<pageexec@freemail.hu>", "Cc:", "Brad", "Spengler", "<spender@grsecurity.net>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["static", "int", "override_release", "(", "char", "__user", "*", "release", ",", "size_t", "len", ")", "const", "char", "*", "rest", "=", "UTS_RELEASE", ";", "char", "buf", "[", "65", "]", "=", "{", "0", "}", ";", "size_t", "copy", ";", "copy", "=", "min", "(", "sizeof", "(", "buf", ")", ",", "max_t", "(", "size_t", ",", "1", ",", "len", ")", ");", "copy", "=", "scnprintf", "(", "buf", ",", "copy", ",", "\"", "2", ".", "6", ".", "%", "u", "%", "s", "\"", ",", "v", ",", "rest", ")", ";", "ret", "=", "copy_to_user", "(", "release", ",", "buf", ",", "copy", "+", "1", ")", ";</s>static", "int", "override_release", "(", "char", "__user", "*", "release", ",", "int", "len", ")", "char", "buf", "[", "65", "]", ";", "char", "*", "rest", "=", "UTS_RELEASE", ";", "snprintf", "(", "buf", ",", "len", ",", "\"", "2", ".", "6", ".", "%", "u", "%", "s", "\"", ",", "v", ",", "rest", ")", ";", "ret", "=", "copy_to_user", "(", "release", ",", "buf", ",", "len", ")", ";"], "docstring_tokens": ["system", "call", "local", "information", "disclosure"]}
{"contents": ["sctp:", "fix", "ASCONF", "list", "handling", "->auto_asconf_splist", "is", "per", "namespace", "and", "mangled", "by", "functions", "like", "sctp_setsockopt_auto_asconf()", "which", "doesn't", "guarantee", "any", "serialization.", "Also,", "the", "call", "to", "inet_sk_copy_descendant()", "was", "backuping", "->auto_asconf_list", "through", "the", "copy", "but", "was", "not", "honoring", "->do_auto_asconf,", "which", "could", "lead", "to", "list", "corruption", "if", "it", "was", "different", "between", "both", "sockets.", "This", "commit", "thus", "fixes", "the", "list", "handling", "by", "using", "->addr_wq_lock", "spinlock", "to", "protect", "the", "list.", "A", "special", "handling", "is", "done", "upon", "socket", "creation", "and", "destruction", "for", "that.", "Error", "handlig", "on", "sctp_init_sock()", "will", "never", "return", "an", "error", "after", "having", "initialized", "asconf,", "so", "sctp_destroy_sock()", "can", "be", "called", "without", "addrq_wq_lock.", "The", "lock", "now", "will", "be", "take", "on", "sctp_close_sock(),", "before", "locking", "the", "socket,", "so", "we", "don't", "do", "it", "in", "inverse", "order", "compared", "to", "sctp_addr_wq_timeout_handler().", "Instead", "of", "taking", "the", "lock", "on", "sctp_sock_migrate()", "for", "copying", "and", "restoring", "the", "list", "values,", "it's", "preferred", "to", "avoid", "rewritting", "it", "by", "implementing", "sctp_copy_descendant().", "Issue", "was", "found", "with", "a", "test", "application", "that", "kept", "flipping", "sysctl", "default_auto_asconf", "on", "and", "off,", "but", "one", "could", "trigger", "it", "by", "issuing", "simultaneous", "setsockopt()", "calls", "on", "multiple", "sockets", "or", "by", "creating/destroying", "sockets", "fast", "enough.", "This", "is", "only", "triggerable", "locally.", "Fixes:", "9f7d653b67ae", "(\"sctp:", "Add", "Auto-ASCONF", "support", "(core).\")", "Reported-by:", "Ji", "Jianwen", "<jiji@redhat.com>", "Suggested-by:", "Neil", "Horman", "<nhorman@tuxdriver.com>", "Suggested-by:", "Hannes", "Frederic", "Sowa", "<hannes@stressinduktion.org>", "Acked-by:", "Hannes", "Frederic", "Sowa", "<hannes@stressinduktion.org>", "Signed-off-by:", "Marcelo", "Ricardo", "Leitner", "<marcelo.leitner@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["/", "*", "Lock", "that", "protects", "both", "addr_waitq", "and", "auto_asconf_splist", "*", "/", "/", "*", "These", "must", "be", "the", "last", "fields", ",", "as", "they", "will", "skipped", "on", "copies", ",", "*", "like", "on", "accept", "and", "peeloff", "operations", "*", "/", "*", "Also", ",", "sctp_destroy_sock", "(", ")", "needs", "to", "be", "called", "with", "addr_wq_lock", "*", "held", "and", "that", "should", "be", "grabbed", "before", "socket", "lock", ".", "spin_lock_bh", "(", "&", "net", "-", ">", "sctp", ".", "addr_wq_lock", ")", ";", "spin_unlock_bh", "(", "&", "net", "-", ">", "sctp", ".", "addr_wq_lock", ")", ";", "spin_lock_bh", "(", "&", "sock_net", "(", "sk", ")", "->", "sctp", ".", "addr_wq_lock", ")", ";", "spin_unlock_bh", "(", "&", "sock_net", "(", "sk", ")", "->", "sctp", ".", "addr_wq_lock", ")", ";", "/", "*", "Nothing", "can", "fail", "after", "this", "block", ",", "otherwise", "*", "sctp_destroy_sock", "(", ")", "will", "be", "called", "without", "addr_wq_lock", "held", "*", "/", "spin_lock", "(", "&", "sock_net", "(", "sk", ")", "->", "sctp", ".", "addr_wq_lock", ")", ";", "spin_unlock", "(", "&", "sock_net", "(", "sk", ")", "->", "sctp", ".", "addr_wq_lock", ")", ";", "}", "else", "{", "}", "/", "*", "Cleanup", "any", "SCTP", "per", "socket", "resources", ".", "Must", "be", "called", "with", "*", "sock_net", "(", "sk", ")", "->", "sctp", ".", "addr_wq_lock", "held", "if", "sp", "-", ">", "do_auto_asconf", "is", "true", "*", "/", "static", "inline", "void", "sctp_copy_descendant", "(", "struct", "sock", "*", "sk_to", ",", "const", "struct", "sock", "*", "sk_from", ")", "{", "int", "ancestor_size", "=", "sizeof", "(", "struct", "inet_sock", ")", "sizeof", "(", "struct", "sctp_sock", ")", "-", "offsetof", "(", "struct", "sctp_sock", ",", "auto_asconf_list", ")", ";", "if", "(", "sk_from", "-", ">", "sk_family", "=", "=", "PF_INET6", ")", "ancestor_size", "+", "=", "sizeof", "(", "struct", "ipv6_pinfo", ")", ";", "__inet_sk_copy_descendant", "(", "sk_to", ",", "sk_from", ",", "ancestor_size", ")", ";", "}", "sctp_copy_descendant", "(", "newsk", ",", "oldsk", ")", ";</s>local_bh_disable", "(", ");", "local_bh_enable", "(", ");", "}", "else", "/", "*", "Cleanup", "any", "SCTP", "per", "socket", "resources", ".", "*", "/", "struct", "list_head", "tmplist", ";", "if", "(", "oldsp", "-", ">", "do_auto_asconf", ")", "{", "memcpy", "(", "&", "tmplist", ",", "&", "newsp", "-", ">", "auto_asconf_list", ",", "sizeof", "(", "tmplist", ")", ");", "inet_sk_copy_descendant", "(", "newsk", ",", "oldsk", ")", ";", "memcpy", "(", "&", "newsp", "-", ">", "auto_asconf_list", ",", "&", "tmplist", ",", "sizeof", "(", "tmplist", ")", ");", "}", "else", "inet_sk_copy_descendant", "(", "newsk", ",", "oldsk", ")", ";"], "docstring_tokens": ["race", "condition"]}
{"contents": ["CAMEL-10894:", "DTD", "handling", "in", "the", "XML", "Validator", "corrected"], "code_tokens": ["/", "**", "Key", "of", "the", "global", "option", "to", "switch", "either", "off", "or", "on", "the", "access", "to", "external", "DTDs", "in", "the", "XML", "Validator", "for", "StreamSources", ".", "*", "Only", "effective", ",", "if", "not", "a", "custom", "schema", "factory", "is", "used", ".", "*/", "public", "static", "final", "String", "ACCESS_EXTERNAL_DTD", "=", "\"", "CamelXmlValidatorAccessExternalDTD", "\"", ";", "}", "if", "(", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getGlobalOptions", "(", ").", "get", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "factory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "LOG", ".", "error", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "validator", ";", "import", "java", ".", "net", ".", "UnknownHostException", ";", "import", "org", ".", "apache", ".", "camel", ".", "ContextTestSupport", ";", "import", "org", ".", "apache", ".", "camel", ".", "ValidationException", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "processor", ".", "validation", ".", "SchemaReader", ";", "public", "abstract", "class", "ValidatorDtdAccessAbstractTest", "extends", "ContextTestSupport", "{", "protected", "MockEndpoint", "finallyEndpoint", ";", "protected", "MockEndpoint", "invalidEndpoint", ";", "protected", "MockEndpoint", "unknownHostExceptionEndpoint", ";", "protected", "MockEndpoint", "validEndpoint", ";", "protected", "String", "payloud", "=", "getPayloudPart", "(", "\"", "Hello", "world", "!", "\")", ";", "protected", "String", "ssrfPayloud", "=", "\"", "<!", "DOCTYPE", "roottag", "PUBLIC", "\\", "\"-", "//", "VSR", "/", "/", "PENTEST", "/", "/", "EN", "\\", "\"", "\\", "\"", "http", ":", "//", "notexisting", "/", "test", "\\", "\">", "\\", "n", "\"", "+", "payloud", ";", "protected", "String", "xxePayloud", "=", "\"", "<!", "DOCTYPE", "updateProfile", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "http", ":", "//", "notexistinghost", "/", "test", "\\", "\">", "]>", "\\", "n", "\"", "+", "getPayloudPart", "(", "\"&", "file", ";", "\")", ";", "private", "final", "boolean", "accessExternalDTD", ";", "public", "ValidatorDtdAccessAbstractTest", "(", "boolean", "accessExternalDTD", ")", "{", "this", ".", "accessExternalDTD", "=", "accessExternalDTD", ";", "}", "private", "String", "getPayloudPart", "(", "String", "bodyValue", ")", "{", "return", "\"", "<", "mail", "xmlns", "=", "'", "http", ":", "//", "foo", ".", "com", "/", "bar", "'", "><", "subject", ">", "Hey", "<", "/", "subject", ">", "<", "body", ">", "\"", "+", "bodyValue", "+", "\"", "</", "body", ">", "</", "mail", ">", "\";", "}", "@", "Override", "protected", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "validEndpoint", "=", "resolveMandatoryEndpoint", "(", "\"", "mock", ":", "valid", "\"", ",", "MockEndpoint", ".", "class", ")", ";", "invalidEndpoint", "=", "resolveMandatoryEndpoint", "(", "\"", "mock", ":", "invalid", "\"", ",", "MockEndpoint", ".", "class", ")", ";", "unknownHostExceptionEndpoint", "=", "resolveMandatoryEndpoint", "(", "\"", "mock", ":", "unknownHostException", "\"", ",", "MockEndpoint", ".", "class", ")", ";", "finallyEndpoint", "=", "resolveMandatoryEndpoint", "(", "\"", "mock", ":", "finally", "\"", ",", "MockEndpoint", ".", "class", ")", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "/", "/", "switch", "on", "DTD", "Access", "if", "(", "accessExternalDTD", ")", "{", "getContext", "(", ").", "getGlobalOptions", "(", ").", "put", "(", "SchemaReader", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "true", "\"", ");", "}", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "doTry", "(", ")", ".", "to", "(", "\"", "validator", ":", "org", "/", "apache", "/", "camel", "/", "component", "/", "validator", "/", "schema", ".", "xsd", "\"", ")", ".", "to", "(", "\"", "mock", ":", "valid", "\"", ")", ".", "doCatch", "(", "ValidationException", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "invalid", "\"", ")", ".", "doCatch", "(", "UnknownHostException", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "unknownHostException", "\"", ")", ".", "doFinally", "(", ")", ".", "to", "(", "\"", "mock", ":", "finally", "\"", ").", "end", "(", ");", "}", "}", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "validator", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "public", "class", "ValidatorDtdAccessOffTest", "extends", "ValidatorDtdAccessAbstractTest", "{", "public", "ValidatorDtdAccessOffTest", "(", ")", "{", "super", "(", "false", ")", ";", "}", "/", "**", "Tests", "that", "no", "external", "DTD", "call", "is", "executed", "for", "StringSource", ".", "*", "/", "public", "void", "testInvalidMessageWithExternalDTDStringSource", "(", ")", "throws", "Exception", "{", "invalidEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "ssrfPayloud", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "/", "**", "Tests", "that", "external", "DTD", "call", "is", "not", "executed", "for", "StreamSource", ".", "*", "/", "public", "void", "testInvalidMessageWithExternalDTDStreamSource", "(", ")", "throws", "Exception", "{", "invalidEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "InputStream", "is", "=", "new", "ByteArrayInputStream", "(", "ssrfPayloud", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "is", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "/", "**", "Tests", "that", "XXE", "is", "not", "possible", "for", "StreamSource", ".", "*", "/", "public", "void", "testInvalidMessageXXESourceStream", "(", ")", "throws", "Exception", "{", "invalidEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "InputStream", "is", "=", "new", "ByteArrayInputStream", "(", "xxePayloud", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "is", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "validator", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "public", "class", "ValidatorDtdAccessOnTest", "extends", "ValidatorDtdAccessAbstractTest", "{", "public", "ValidatorDtdAccessOnTest", "(", ")", "{", "super", "(", "true", ")", ";", "}", "/", "**", "Tests", "that", "external", "DTD", "call", "is", "executed", "for", "StringSource", "by", "expecting", "an", "UnkonwHostException", ".", "*", "/", "public", "void", "testInvalidMessageWithExternalDTDStringSource", "(", ")", "throws", "Exception", "{", "unknownHostExceptionEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "ssrfPayloud", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "/", "**", "Tests", "that", "external", "DTD", "call", "is", "executed", "for", "StreamSourceby", "expecting", "an", "UnkonwHostException", ".", "*", "/", "public", "void", "testInvalidMessageWithExternalDTDStreamSource", "(", ")", "throws", "Exception", "{", "unknownHostExceptionEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "InputStream", "is", "=", "new", "ByteArrayInputStream", "(", "ssrfPayloud", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "is", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "/", "**", "Tests", "that", "XXE", "is", "possible", "for", "StreamSource", "by", "expecting", "an", "UnkonwHostException", ".", "*", "/", "public", "void", "testInvalidMessageXXESourceStream", "(", ")", "throws", "Exception", "{", "unknownHostExceptionEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "InputStream", "is", "=", "new", "ByteArrayInputStream", "(", "xxePayloud", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "is", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "}</s>"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["KEYS:", "ensure", "we", "free", "the", "assoc", "array", "edit", "if", "edit", "is", "valid", "__key_link_end", "is", "not", "freeing", "the", "associated", "array", "edit", "structure", "and", "this", "leads", "to", "a", "512", "byte", "memory", "leak", "each", "time", "an", "identical", "existing", "key", "is", "added", "with", "add_key().", "The", "reason", "the", "add_key()", "system", "call", "returns", "okay", "is", "that", "key_create_or_update()", "calls", "__key_link_begin()", "before", "checking", "to", "see", "whether", "it", "can", "update", "a", "key", "directly", "rather", "than", "adding/replacing", "-", "which", "it", "turns", "out", "it", "can.", "Thus", "__key_link()", "is", "not", "called", "through", "__key_instantiate_and_link()", "and", "__key_link_end()", "must", "cancel", "the", "edit.", "Signed-off-by:", "Colin", "Ian", "King", "<colin.king@canonical.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "Signed-off-by:", "James", "Morris", "<james.l.morris@oracle.com>"], "code_tokens": ["if", "(", "edit", ")", "{", "if", "(", "!", "edit", "-", ">", "dead_leaf", ")", "{", "key_payload_reserve", "(", "keyring", ",", "keyring", "-", ">", "datalen", "-", "KEYQUOTA_LINK_BYTES", ")", ";", "}</s>if", "(", "edit", "&", "&", "!", "edit", "-", ">", "dead_leaf", ")", "{", "key_payload_reserve", "(", "keyring", ",", "keyring", "-", ">", "datalen", "-", "KEYQUOTA_LINK_BYTES", ")", ";"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["SOLR-11971:", "Don't", "allow", "referal", "to", "external", "resources", "in", "DataImportHandler's", "dataConfig", "request", "parameter"], "code_tokens": ["*", "SOLR", "-", "11971", ":", "Don", "'", "t", "allow", "referal", "to", "external", "resources", "in", "DataImportHandler", "'", "s", "dataConfig", "request", "parameter", ".", "(", "\u9ea6", "\u9999", "\u6d53\u90c1", ",", "Uwe", "Schindler", ")", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "EmptyEntityResolver", ";", "void", "loadAndInit", "(", "String", "configStr", ")", "{", "void", "loadAndInit", "(", "InputSource", "configFile", ")", "{", "dbf", ".", "setValidating", "(", "false", ")", ";", "/", "/", "only", "enable", "xinclude", ",", "if", "XML", "is", "coming", "from", "safe", "source", "(", "local", "file", ")", "/", "/", "and", "a", "a", "SolrCore", "and", "SystemId", "is", "present", "(", "makes", "no", "sense", "otherwise", ")", ":", "/", "/", "only", "enable", "xinclude", "/", "external", "entities", ",", "if", "XML", "is", "coming", "from", "/", "/", "safe", "source", "(", "local", "file", ")", "and", "a", "a", "SolrCore", "and", "SystemId", "is", "present", ":", "if", "(", "core", "!", "=", "null", "&", "&", "configFile", ".", "getSystemId", "(", ")", "!", "=", "null", ")", "{", "}", "else", "{", "/", "/", "Don", "'", "t", "allow", "external", "entities", "without", "having", "a", "system", "ID", ":", "builder", ".", "setEntityResolver", "(", "EmptyEntityResolver", ".", "SAX_INSTANCE", ")", ";", "}", "public", "void", "testExternalEntity", "(", ")", "throws", "Exception", "{", "StringDataSource", ".", "xml", "=", "wellformedXml", ";", "/", "/", "This", "should", "not", "fail", "as", "external", "entities", "are", "replaced", "by", "an", "empty", "string", "during", "parsing", ":", "runFullImport", "(", "dataConfigWithEntity", ")", ";", "assertQ", "(", "req", "(", "\"*", ":*", "\")", ",", "\"", "//", "*[", "@", "numFound", "=", "'", "3", "'", "]\"", ");", "}", "private", "String", "dataConfigWithEntity", "=", "\"", "<!", "DOCTYPE", "dataConfig", "[", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "internalTerm", "\\", "\"", "node", "\\", "\">", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "externalTerm", "SYSTEM", "\\", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "external", "\\", "\">", "\\", "n", "\"", "+", "\"", "]>", "<", "dataConfig", ">", "\\", "n", "\"", "\"", "<", "dataSource", "name", "=", "\\\"", "str", "\\", "\"", "type", "=", "\\\"", "TestErrorHandling", "$", "StringDataSource", "\\", "\"", "/", ">\"", "\"", "<", "document", ">", "\\", "n", "\"", "\"", "<", "entity", "name", "=", "\\\"", "&", "internalTerm", ";", "\\\"", "dataSource", "=", "\\\"", "str", "\\", "\"", "processor", "=", "\\\"", "XPathEntityProcessor", "\\", "\"", "url", "=", "\\\"", "test", "\\", "\"", "forEach", "=", "\\\"", "/", "root", "/", "node", "\\", "\"", "onError", "=", "\\\"", "skip", "\\", "\">", "\\", "n", "\"", "\"", "<", "field", "column", "=", "\\\"", "id", "\\", "\"", "xpath", "=", "\\\"", "/", "root", "/", "node", "/", "id", "\\", "\">", "&", "externalTerm", ";", "</", "field", ">", "\\", "n", "\"", "\"", "<", "field", "column", "=", "\\\"", "desc", "\\", "\"", "xpath", "=", "\\\"", "/", "root", "/", "node", "/", "desc", "\\", "\"", "/", ">\\", "n", "\"", "\"", "<", "/", "entity", ">", "\\", "n", "\"", "\"", "<", "/", "document", ">", "\\", "n", "\"", "\"", "</", "dataConfig", ">", "\";</s>public", "void", "loadAndInit", "(", "String", "configStr", ")", "{", "public", "void", "loadAndInit", "(", "InputSource", "configFile", ")", "{", "/", "/", "only", "enable", "xinclude", ",", "if", "a", "a", "SolrCore", "and", "SystemId", "is", "present", "(", "makes", "no", "sense", "otherwise", ")", "if", "(", "core", "!", "=", "null", ")"], "docstring_tokens": ["xml", "external", "entity", "expansion", "(xxe"]}
{"contents": ["Fixed", "external", "entity", "loading"], "code_tokens": ["libxml_globals", "-", ">", "entity_loader_disabled", "=", "0", ";", "TSRMLS_FETCH", "(", ");", "if", "(", "LIBXML", "(", "entity_loader_disabled", ")", ")", "{", "return", "NULL", ";", "}", "PHP_LIBXML_API", "zend_bool", "php_libxml_disable_entity_loader", "(", "zend_bool", "disable", "TSRMLS_DC", ")", "{", "zend_bool", "old", "=", "LIBXML", "(", "entity_loader_disabled", ")", ";", "LIBXML", "(", "entity_loader_disabled", ")", "=", "disable", ";", "return", "old", ";", "}", "RETURN_BOOL", "(", "php_libxml_disable_entity_loader", "(", "disable", "TSRMLS_CC", ")", ");", "zend_bool", "entity_loader_disabled", ";", "PHP_LIBXML_API", "zend_bool", "php_libxml_disable_entity_loader", "(", "zend_bool", "disable", "TSRMLS_DC", ")", ";", "#", "include", "\"", "ext", "/", "libxml", "/", "php_libxml", ".", "h", "\"", "zend_bool", "old", ";", "old", "=", "php_libxml_disable_entity_loader", "(", "1", ")", ";", "php_libxml_disable_entity_loader", "(", "old", ")", ";", "zend_bool", "old", ";", "old", "=", "php_libxml_disable_entity_loader", "(", "1", ")", ";", "php_libxml_disable_entity_loader", "(", "old", ")", ";</s>static", "xmlParserInputBufferPtr", "php_libxml_input_buffer_noload", "(", "const", "char", "*", "URI", ",", "xmlCharEncoding", "enc", ")", "{", "return", "NULL", ";", "}", "xmlParserInputBufferCreateFilenameFunc", "old", ";", "if", "(", "disable", "=", "=", "0", ")", "{", "old", "=", "xmlParserInputBufferCreateFilenameDefault", "(", "php_libxml_input_buffer_create_filename", ")", ";", "}", "else", "{", "old", "=", "xmlParserInputBufferCreateFilenameDefault", "(", "php_libxml_input_buffer_noload", ")", ";", "}", "if", "(", "old", "=", "=", "php_libxml_input_buffer_noload", ")", "{", "RETURN_TRUE", ";", "}", "RETURN_FALSE", ";", "ctxt", "-", ">", "options", "&", "=", "~", "XML_PARSE_DTDLOAD", ";", "ctxt", "-", ">", "options", "&", "=", "~", "XML_PARSE_DTDLOAD", ";"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["fix", "unbalanced", "page", "refcounting", "in", "bio_map_user_iov", "bio_map_user_iov", "and", "bio_unmap_user", "do", "unbalanced", "pages", "refcounting", "if", "IO", "vector", "has", "small", "consecutive", "buffers", "belonging", "to", "the", "same", "page.", "bio_add_pc_page", "merges", "them", "into", "one,", "but", "the", "page", "reference", "is", "never", "dropped.", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Vitaly", "Mayatskikh", "<v.mayatskih@gmail.com>", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["unsigned", "short", "prev_bi_vcnt", "=", "bio", "-", ">", "bi_vcnt", ";", "/", "*", "*", "check", "if", "vector", "was", "merged", "with", "previous", "*", "drop", "page", "reference", "if", "needed", "*", "/", "if", "(", "bio", "-", ">", "bi_vcnt", "=", "=", "prev_bi_vcnt", ")", "put_page", "(", "pages", "[", "j", "]", ");</s>"], "docstring_tokens": ["out-of-memory", "condition"]}
{"contents": ["Fixing", "issue", "#3", "and", "adding", "tests", "to", "confirm."], "code_tokens": ["/", "/", "The", "callers", "of", "this", "decode", "will", "have", "already", "handled", "'", "none", "'", "if", "it", "was", "deemed", "to", "be", "valid", "based", "upon", "/", "/", "the", "provided", "verifiers", ".", "At", "this", "point", ",", "if", "we", "have", "a", "'", "none", "'", "algorithm", "specified", "in", "the", "header", ",", "it", "is", "invalid", ".", "if", "(", "header", ".", "algorithm", "=", "=", "Algorithm", ".", "none", ")", "{", "throw", "new", "MissingVerifierException", "(", "\"", "No", "Verifier", "has", "been", "provided", "for", "verify", "a", "signature", "signed", "using", "[", "\"", "+", "header", ".", "algorithm", ".", "getName", "(", ")", "+", "\"", "]\"", ");", "}", "int", "index", "=", "encodedJWT", ".", "lastIndexOf", "(", "\".", "\")", ";", "/", "/", "The", "message", "comprises", "the", "first", "two", "segments", "of", "the", "entire", "JWT", ",", "the", "signature", "is", "the", "last", "segment", ".", "byte", "[", "]", "message", "=", "encodedJWT", ".", "substring", "(", "0", ",", "index", ")", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "expectException", "(", "InvalidJWTException", ".", "class", ",", "(", ")", "-", ">", "JWT", ".", "getDecoder", "(", ").", "decode", "(", "hackedJWT", ",", "HMACVerifier", ".", "newVerifier", "(", "\"", "secret", "\"", "))", ");", "expectException", "(", "MissingVerifierException", ".", "class", ",", "(", ")", "-", ">", "JWT", ".", "getDecoder", "(", ").", "decode", "(", "encodedJWT", ")", ");", "}", "@", "Test", "public", "void", "test_unsecuredJWT_validation", "(", ")", "throws", "Exception", "{", "JWT", "jwt", "=", "new", "JWT", "(", ").", "setSubject", "(", "\"", "123456789", "\"", ");", "Signer", "signer", "=", "new", "UnsecuredSigner", "(", ");", "Verifier", "hmacVerifier", "=", "HMACVerifier", ".", "newVerifier", "(", "\"", "too", "many", "secrets", "\"", ");", "String", "encodedUnsecuredJWT", "=", "JWTEncoder", ".", "getInstance", "(", ").", "encode", "(", "jwt", ",", "signer", ")", ";", "/", "/", "Ensure", "that", "attempting", "to", "decode", "an", "un", "-", "secured", "JWT", "fails", "when", "we", "provide", "a", "verifier", "expectException", "(", "MissingVerifierException", ".", "class", ",", "(", ")", "-", ">", "JWT", ".", "getDecoder", "(", ").", "decode", "(", "encodedUnsecuredJWT", ",", "hmacVerifier", ")", ");", "String", "encodedUnsecuredJWT_withKid", "=", "JWTEncoder", ".", "getInstance", "(", ").", "encode", "(", "jwt", ",", "signer", ",", "(", "header", ")", "-", ">", "header", ".", "set", "(", "\"", "kid", "\"", ",", "\"", "abc", "\"", "))", ";", "String", "encodedUnsecuredJWT_withoutKid", "=", "JWTEncoder", ".", "getInstance", "(", ").", "encode", "(", "jwt", ",", "signer", ")", ";", "Map", "<", "String", ",", "Verifier", ">", "verifierMap", "=", "new", "HashMap", "<", ">(", ");", "verifierMap", ".", "put", "(", "null", ",", "hmacVerifier", ")", ";", "verifierMap", ".", "put", "(", "\"", "abc", "\"", ",", "hmacVerifier", ")", ";", "/", "/", "Ensure", "that", "attempting", "to", "decode", "an", "un", "-", "secured", "JWT", "fails", "when", "we", "provide", "a", "verifier", "with", "or", "without", "using", "a", "kid", "expectException", "(", "MissingVerifierException", ".", "class", ",", "(", ")", "-", ">", "JWT", ".", "getDecoder", "(", ").", "decode", "(", "encodedUnsecuredJWT_withKid", ",", "verifierMap", ")", ");", "expectException", "(", "MissingVerifierException", ".", "class", ",", "(", ")", "-", ">", "JWT", ".", "getDecoder", "(", ").", "decode", "(", "encodedUnsecuredJWT_withoutKid", ",", "verifierMap", ")", ");</s>int", "index", "=", "encodedJWT", ".", "lastIndexOf", "(", "\".", "\")", ";", "/", "/", "The", "message", "comprises", "the", "first", "two", "segments", "of", "the", "entire", "JWT", ",", "the", "signature", "is", "the", "last", "segment", ".", "byte", "[", "]", "message", "=", "encodedJWT", ".", "substring", "(", "0", ",", "index", ")", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "expectException", "(", "InvalidJWTException", ".", "class", ",", "(", ")", "-", ">", "JWT", ".", "getDecoder", "(", ").", "decode", "(", "hackedJWT", ",", "HMACVerifier", ".", "newVerifier", "(", "\"", "secret", "\"", "))", ");", "expectException", "(", "MissingVerifierException", ".", "class", ",", "(", ")", "-", ">", "JWT", ".", "getDecoder", "(", ").", "decode", "(", "encodedJWT", ")", ");"], "docstring_tokens": ["input", "validation"]}
{"contents": ["460642", "-", "HttpParser", "error", "400", "can", "expose", "previous", "buffer", "contents", "in", "HTTP", "status", "reason", "message", "+", "Simplifying", "behavior"], "code_tokens": ["super", "(", "400", ",", "String", ".", "format", "(", "\"", "Illegal", "character", "0x", "%", "X", "\"", ",", "ch", ")", ");", "/", "/", "Bug", "#", "460642", "-", "don", "'", "t", "reveal", "buffers", "to", "end", "user", "LOG", ".", "warn", "(", "String", ".", "format", "(", "\"", "Illegal", "character", "0x", "%", "X", "in", "state", "=", "%", "s", "for", "buffer", "%", "s", "\"", ",", "ch", ",", "state", ",", "BufferUtil", ".", "toDetailString", "(", "buffer", ")", "))", ";</s>super", "(", "String", ".", "format", "(", "\"", "Illegal", "character", "0x", "%", "X", "in", "state", "=", "%", "s", "for", "buffer", "%", "s", "\"", ",", "ch", ",", "state", ",", "toDebugString", "(", "buffer", ")", "))", ";", "}", "/", "**", "*", "This", "is", "an", "HttpParser", "safe", "version", "of", "{", "@", "link", "BufferUtil", "#", "toDetailString", "(", "ByteBuffer", ")", "}.", "*", "<", "p", ">", "*", "Which", "will", "only", "show", "the", "parsing", "state", "(", "what", "has", "been", "parsed", ",", "what", "is", "being", "parsed", ",", "and", "what", "is", "coming", "up", ")", ",", "*", "while", "not", "showing", "what", "is", "past", "the", "{", "@", "link", "ByteBuffer", "#", "limit", "(", ")}", ".", "*", "*", "@", "param", "buffer", "*", "@", "return", "*", "/", "private", "static", "String", "toDebugString", "(", "ByteBuffer", "buffer", ")", "{", "if", "(", "buffer", "=", "=", "null", ")", "{", "return", "\"", "<", "null", ">", "\";", "}", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", ");", "buf", ".", "append", "(", "'\"", "')", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "buffer", ".", "position", "(", ");", "i", "+", "+)", "{", "appendContentChar", "(", "buf", ",", "buffer", ".", "get", "(", "i", ")", ");", "if", "(", "i", "=", "=", "16", "&", "&", "buffer", ".", "position", "(", ")", ">", "32", ")", "{", "buf", ".", "append", "(", "\".", "..", "\")", ";", "i", "=", "buffer", ".", "position", "(", ")", "-", "16", ";", "}", "}", "buf", ".", "append", "(", "\"<", "<<", "\")", ";", "for", "(", "int", "i", "=", "buffer", ".", "position", "(", ");", "i", "<", "buffer", ".", "limit", "(", ");", "i", "+", "+)", "{", "appendContentChar", "(", "buf", ",", "buffer", ".", "get", "(", "i", ")", ");", "if", "(", "i", "=", "=", "buffer", ".", "position", "(", ")", "+", "16", "&", "&", "buffer", ".", "limit", "(", ")", ">", "buffer", ".", "position", "(", ")", "+", "32", ")", "{", "buf", ".", "append", "(", "\".", "..", "\")", ";", "i", "=", "buffer", ".", "limit", "(", ")", "-", "16", ";", "}", "}", "buf", ".", "append", "(", "\">", ">>", "\\\"", "\")", ";", "/", "/", "ignore", "content", "beyond", "limit", "(", ")", "return", "buf", ".", "toString", "(", ");", "}", "private", "static", "void", "appendContentChar", "(", "StringBuilder", "buf", ",", "byte", "b", ")", "{", "if", "(", "b", "=", "=", "'", "\\\\", "')", "buf", ".", "append", "(", "\"\\", "\\\\", "\\\"", ");", "else", "if", "(", "b", ">", "=", "'", "'", ")", "buf", ".", "append", "(", "(", "char", ")", "b", ")", ";", "else", "if", "(", "b", "=", "=", "'", "\\", "r", "'", ")", "buf", ".", "append", "(", "\"\\", "\\", "r", "\"", ");", "else", "if", "(", "b", "=", "=", "'", "\\", "n", "'", ")", "buf", ".", "append", "(", "\"\\", "\\", "n", "\"", ");", "else", "if", "(", "b", "=", "=", "'", "\\", "t", "'", ")", "buf", ".", "append", "(", "\"\\", "\\", "t", "\"", ");", "else", "buf", ".", "append", "(", "\"\\", "\\", "x", "\"", ").", "append", "(", "TypeUtil", ".", "toHexString", "(", "b", ")", ");"], "docstring_tokens": ["remote", "leakage"]}
{"contents": ["x86/acpi:", "Prevent", "out", "of", "bound", "access", "caused", "by", "broken", "ACPI", "tables", "The", "bus_irq", "argument", "of", "mp_override_legacy_irq()", "is", "used", "as", "the", "index", "into", "the", "isa_irq_to_gsi[]", "array.", "The", "bus_irq", "argument", "originates", "from", "ACPI_MADT_TYPE_IO_APIC", "and", "ACPI_MADT_TYPE_INTERRUPT", "items", "in", "the", "ACPI", "tables,", "but", "is", "nowhere", "sanity", "checked.", "That", "allows", "broken", "or", "malicious", "ACPI", "tables", "to", "overwrite", "memory,", "which", "might", "cause", "malfunction,", "panic", "or", "arbitrary", "code", "execution.", "Add", "a", "sanity", "check", "and", "emit", "a", "warning", "when", "that", "triggers.", "[", "tglx:", "Added", "warning", "and", "rewrote", "changelog", "]", "Signed-off-by:", "Seunghun", "Han", "<kkamagui@gmail.com>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "security@kernel.org", "Cc:", "\"Rafael", "J.", "Wysocki\"", "<rjw@rjwysocki.net>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["/", "*", "*", "Check", "bus_irq", "boundary", ".", "*", "/", "if", "(", "bus_irq", ">", "=", "NR_IRQS_LEGACY", ")", "{", "pr_warn", "(", "\"", "Invalid", "bus_irq", "%", "u", "for", "legacy", "override", "\\", "n", "\"", ",", "bus_irq", ")", ";", "return", ";", "}</s>"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["xfs:", "validate", "cached", "inodes", "are", "free", "when", "allocated", "A", "recent", "fuzzed", "filesystem", "image", "cached", "random", "dcache", "corruption", "when", "the", "reproducer", "was", "run.", "This", "often", "showed", "up", "as", "panics", "in", "lookup_slow()", "on", "a", "null", "inode->i_ops", "pointer", "when", "doing", "pathwalks.", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000000", "....", "Call", "Trace:", "lookup_slow+0x44/0x60", "walk_component+0x3dd/0x9f0", "link_path_walk+0x4a7/0x830", "path_lookupat+0xc1/0x470", "filename_lookup+0x129/0x270", "user_path_at_empty+0x36/0x40", "path_listxattr+0x98/0x110", "SyS_listxattr+0x13/0x20", "do_syscall_64+0xf5/0x280", "entry_SYSCALL_64_after_hwframe+0x42/0xb7", "but", "had", "many", "different", "failure", "modes", "including", "deadlocks", "trying", "to", "lock", "the", "inode", "that", "was", "just", "allocated", "or", "KASAN", "reports", "of", "use-after-free", "violations.", "The", "cause", "of", "the", "problem", "was", "a", "corrupt", "INOBT", "on", "a", "v4", "fs", "where", "the", "root", "inode", "was", "marked", "as", "free", "in", "the", "inobt", "record.", "Hence", "when", "we", "allocated", "an", "inode,", "it", "chose", "the", "root", "inode", "to", "allocate,", "found", "it", "in", "the", "cache", "and", "re-initialised", "it.", "We", "recently", "fixed", "a", "similar", "inode", "allocation", "issue", "caused", "by", "inobt", "record", "corruption", "problem", "in", "xfs_iget_cache_miss()", "in", "commit", "ee457001ed6c", "(\"xfs:", "catch", "inode", "allocation", "state", "mismatch", "corruption\").", "This", "change", "adds", "similar", "checks", "to", "the", "cache-hit", "path", "to", "catch", "it,", "and", "turns", "the", "reproducer", "into", "a", "corruption", "shutdown", "situation.", "Reported-by:", "Wen", "Xu", "<wen.xu@gatech.edu>", "Signed-Off-By:", "Dave", "Chinner", "<dchinner@redhat.com>", "Reviewed-by:", "Christoph", "Hellwig", "<hch@lst.de>", "Reviewed-by:", "Carlos", "Maiolino", "<cmaiolino@redhat.com>", "Reviewed-by:", "Darrick", "J.", "Wong", "<darrick.wong@oracle.com>", "[darrick:", "fix", "typos", "in", "comment]", "Signed-off-by:", "Darrick", "J.", "Wong", "<darrick.wong@oracle.com>"], "code_tokens": ["/", "*", "*", "If", "we", "are", "allocating", "a", "new", "inode", ",", "then", "check", "what", "was", "returned", "is", "*", "actually", "a", "free", ",", "empty", "inode", ".", "If", "we", "are", "not", "allocating", "an", "inode", ",", "*", "then", "check", "we", "didn", "'", "t", "find", "a", "free", "inode", ".", "*", "*", "Returns", ":", "*", "0", "if", "the", "inode", "free", "state", "matches", "the", "lookup", "context", "*", "-", "ENOENT", "if", "the", "inode", "is", "free", "and", "we", "are", "not", "allocating", "*", "-", "EFSCORRUPTED", "if", "there", "is", "any", "state", "mismatch", "at", "all", "*", "/", "static", "int", "xfs_iget_check_free_state", "(", "struct", "xfs_inode", "*", "ip", ",", "int", "flags", ")", "{", "if", "(", "flags", "&", "XFS_IGET_CREATE", ")", "{", "/", "*", "should", "be", "a", "free", "inode", "*", "/", "if", "(", "VFS_I", "(", "ip", ")", "->", "i_mode", "!", "=", "0", ")", "{", "xfs_warn", "(", "ip", "-", ">", "i_mount", ",", "\"", "Corruption", "detected", "!", "Free", "inode", "0x", "%", "llx", "not", "marked", "free", "!", "(", "mode", "0x", "%", "x", ")", "\",", "ip", "-", ">", "i_ino", ",", "VFS_I", "(", "ip", ")", "->", "i_mode", ")", ";", "return", "-", "EFSCORRUPTED", ";", "}", "if", "(", "ip", "-", ">", "i_d", ".", "di_nblocks", "!", "=", "0", ")", "{", "xfs_warn", "(", "ip", "-", ">", "i_mount", ",", "\"", "Corruption", "detected", "!", "Free", "inode", "0x", "%", "llx", "has", "blocks", "allocated", "!", "\",", "ip", "-", ">", "i_ino", ")", ";", "return", "-", "EFSCORRUPTED", ";", "}", "return", "0", ";", "}", "/", "*", "should", "be", "an", "allocated", "inode", "*", "/", "if", "(", "VFS_I", "(", "ip", ")", "->", "i_mode", "=", "=", "0", ")", "return", "-", "ENOENT", ";", "return", "0", ";", "}", "*", "Check", "the", "inode", "free", "state", "is", "valid", ".", "This", "also", "detects", "lookup", "*", "racing", "with", "unlinks", ".", "error", "=", "xfs_iget_check_free_state", "(", "ip", ",", "flags", ")", ";", "if", "(", "error", ")", "*", "Check", "the", "inode", "free", "state", "is", "valid", ".", "This", "also", "detects", "lookup", "*", "racing", "with", "unlinks", ".", "error", "=", "xfs_iget_check_free_state", "(", "ip", ",", "flags", ")", ";", "if", "(", "error", ")</s>*", "If", "lookup", "is", "racing", "with", "unlink", "return", "an", "error", "immediately", ".", "if", "(", "VFS_I", "(", "ip", ")", "->", "i_mode", "=", "=", "0", "&", "&", "!", "(", "flags", "&", "XFS_IGET_CREATE", ")", ")", "{", "error", "=", "-", "ENOENT", ";", "}", "*", "If", "we", "are", "allocating", "a", "new", "inode", ",", "then", "check", "what", "was", "returned", "is", "*", "actually", "a", "free", ",", "empty", "inode", ".", "If", "we", "are", "not", "allocating", "an", "inode", ",", "*", "the", "check", "we", "didn", "'", "t", "find", "a", "free", "inode", ".", "if", "(", "flags", "&", "XFS_IGET_CREATE", ")", "{", "if", "(", "VFS_I", "(", "ip", ")", "->", "i_mode", "!", "=", "0", ")", "{", "xfs_warn", "(", "mp", ",", "\"", "Corruption", "detected", "!", "Free", "inode", "0x", "%", "llx", "not", "marked", "free", "on", "disk", "\"", ",", "ino", ")", ";", "error", "=", "-", "EFSCORRUPTED", ";", "goto", "out_destroy", ";", "}", "if", "(", "ip", "-", ">", "i_d", ".", "di_nblocks", "!", "=", "0", ")", "{", "xfs_warn", "(", "mp", ",", "\"", "Corruption", "detected", "!", "Free", "inode", "0x", "%", "llx", "has", "blocks", "allocated", "!", "\",", "ino", ")", ";", "error", "=", "-", "EFSCORRUPTED", ";", "goto", "out_destroy", ";", "}", "}", "else", "if", "(", "VFS_I", "(", "ip", ")", "->", "i_mode", "=", "=", "0", ")", "{", "error", "=", "-", "ENOENT", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["TAP5-2008:", "Implement", "HMAC", "signatures", "on", "object", "streams", "stored", "on", "the", "client"], "code_tokens": ["/", "**", "*", "A", "passphrase", "used", "as", "the", "basis", "of", "hash", "-", "based", "message", "authentication", "(", "HMAC", ")", "for", "any", "object", "stream", "data", "stored", "on", "*", "the", "client", ".", "The", "default", "phrase", "is", "the", "empty", "string", ",", "which", "will", "result", "in", "a", "logged", "runtime", "<", "em", ">", "error", "<", "/", "em", ">", ".", "*", "You", "should", "configure", "this", "to", "a", "reasonable", "value", "(", "longer", "is", "better", ")", "and", "ensure", "that", "all", "servers", "in", "your", "cluster", "*", "share", "the", "same", "value", "(", "configuring", "this", "in", "code", ",", "rather", "than", "the", "command", "line", ",", "is", "preferred", ")", ".", "*", "*", "@", "see", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "ClientDataEncoder", "*", "@", "since", "5", ".", "3", ".", "6", "*", "/", "public", "static", "final", "String", "HMAC_PASSPHRASE", "=", "\"", "tapestry", ".", "hmac", "-", "passphrase", "\"", ";", "/", "/", "Copyright", "2009", ",", "2012", "The", "Apache", "Software", "Foundation", "import", "org", ".", "apache", ".", "tapestry5", ".", "SymbolConstants", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "TapestryInternalUtils", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ".", "MacOutputStream", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "ioc", ".", "annotations", ".", "Symbol", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "javax", ".", "crypto", ".", "spec", ".", "SecretKeySpec", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "security", ".", "Key", ";", "private", "final", "Key", "hmacKey", ";", "public", "ClientDataEncoderImpl", "(", "URLEncoder", "urlEncoder", ",", "@", "Symbol", "(", "SymbolConstants", ".", "HMAC_PASSPHRASE", ")", "String", "passphrase", ",", "Logger", "logger", ")", "throws", "UnsupportedEncodingException", "if", "(", "passphrase", ".", "equals", "(", "\"\"", "))", "{", "logger", ".", "error", "(", "String", ".", "format", "(", "\"", "The", "symbol", "'", "%", "s", "'", "has", "not", "been", "configured", ".", "\"", "\"", "This", "is", "used", "to", "configure", "hash", "-", "based", "message", "authentication", "of", "Tapestry", "data", "stored", "in", "forms", ",", "or", "in", "the", "URL", ".", "\"", "\"", "You", "application", "is", "less", "secure", ",", "and", "more", "vulnerable", "to", "denial", "-", "of", "-", "service", "attacks", ",", "when", "this", "symbol", "is", "left", "unconfigured", ".", "\",", "SymbolConstants", ".", "HMAC_PASSPHRASE", ")", ");", "/", "/", "Errors", "at", "lower", "levels", "if", "the", "passphrase", "is", "empty", ",", "so", "override", "the", "parameter", "to", "set", "a", "default", "value", ".", "passphrase", "=", "\"", "DEFAULT", "\"", ";", "}", "hmacKey", "=", "new", "SecretKeySpec", "(", "passphrase", ".", "getBytes", "(", "\"", "UTF8", "\"", "),", "\"", "HmacSHA1", "\"", ");", "return", "new", "ClientDataSinkImpl", "(", "urlEncoder", ",", "hmacKey", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "/", "/", "what", "ClientDataSinkImpl", "does", ")", ".", "int", "colonx", "=", "clientData", ".", "indexOf", "(", "':", "')", ";", "if", "(", "colonx", "<", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Client", "data", "must", "be", "prefixed", "with", "its", "HMAC", "code", ".", "\")", ";", "}", "/", "/", "Extract", "the", "string", "presumably", "encoded", "by", "the", "server", "using", "the", "secret", "key", ".", "String", "storedHmacResult", "=", "clientData", ".", "substring", "(", "0", ",", "colonx", ")", ";", "String", "clientStream", "=", "clientData", ".", "substring", "(", "colonx", "+", "1", ")", ";", "Base64InputStream", "b64in", "=", "new", "Base64InputStream", "(", "clientStream", ")", ";", "validateHMAC", "(", "storedHmacResult", ",", "b64in", ")", ";", "/", "/", "After", "reading", "it", "once", "to", "validate", ",", "reset", "it", "for", "the", "actual", "read", "(", "which", "includes", "the", "GZip", "decompression", ")", ".", "b64in", ".", "reset", "(", ");", "BufferedInputStream", "buffered", "=", "new", "BufferedInputStream", "(", "new", "GZIPInputStream", "(", "b64in", ")", ");", "}", "catch", "(", "IOException", "ex", ")", "private", "void", "validateHMAC", "(", "String", "storedHmacResult", ",", "Base64InputStream", "b64in", ")", "throws", "IOException", "{", "MacOutputStream", "macOs", "=", "MacOutputStream", ".", "streamFor", "(", "hmacKey", ")", ";", "TapestryInternalUtils", ".", "copy", "(", "b64in", ",", "macOs", ")", ";", "macOs", ".", "close", "(", ");", "String", "actual", "=", "macOs", ".", "getResult", "(", ");", "if", "(", "!", "storedHmacResult", ".", "equals", "(", "actual", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "Client", "data", "associated", "with", "the", "current", "request", "appears", "to", "have", "been", "tampered", "with", "\"", "\"", "(", "the", "HMAC", "signature", "does", "not", "match", ")", ".\"", ");", "}", "}", "/", "/", "Copyright", "2009", ",", "2012", "The", "Apache", "Software", "Foundation", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ".", "MacOutputStream", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ".", "TeeOutputStream", ";", "import", "java", ".", "security", ".", "Key", ";", "private", "final", "MacOutputStream", "macOutputStream", ";", "public", "ClientDataSinkImpl", "(", "URLEncoder", "urlEncoder", ",", "Key", "hmacKey", ")", "throws", "IOException", "macOutputStream", "=", "MacOutputStream", ".", "streamFor", "(", "hmacKey", ")", ";", "final", "BufferedOutputStream", "pipeline", "=", "new", "BufferedOutputStream", "(", "new", "GZIPOutputStream", "(", "new", "TeeOutputStream", "(", "macOutputStream", ",", "base64OutputStream", ")", "))", ";", "}", "catch", "(", "IOException", "ex", ")", "return", "macOutputStream", ".", "getResult", "(", ")", "+", "\"", ":\"", "+", "base64OutputStream", ".", "toBase64", "(", ");", "/", "/", "Copyright", "2012", "The", "Apache", "Software", "Foundation", "/", "/", "/", "/", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "/", "/", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "/", "/", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "/", "/", "/", "/", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "/", "/", "/", "/", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "/", "/", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "/", "/", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "/", "/", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "/", "/", "limitations", "under", "the", "License", ".", "package", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ";", "import", "org", ".", "apache", ".", "commons", ".", "codec", ".", "binary", ".", "Base64", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "ioc", ".", "internal", ".", "util", ".", "InternalUtils", ";", "import", "javax", ".", "crypto", ".", "Mac", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "security", ".", "Key", ";", "/", "**", "*", "An", "output", "stream", "that", "wraps", "around", "a", "{", "@", "link", "Mac", "}", "(", "message", "authentication", "code", "algorithm", ")", ".", "This", "is", "currently", "*", "used", "for", "symmetric", "(", "private", ")", "keys", ",", "but", "in", "theory", "could", "be", "used", "with", "assymetric", "(", "public", "/", "private", ")", "keys", ".", "*", "*", "@", "since", "5", ".", "3", ".", "6", "*", "/", "public", "class", "MacOutputStream", "extends", "OutputStream", "{", "private", "final", "Mac", "mac", ";", "public", "static", "MacOutputStream", "streamFor", "(", "Key", "key", ")", "throws", "IOException", "{", "try", "{", "Mac", "mac", "=", "Mac", ".", "getInstance", "(", "key", ".", "getAlgorithm", "(", "))", ";", "mac", ".", "init", "(", "key", ")", ";", "return", "new", "MacOutputStream", "(", "mac", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "create", "MacOutputStream", ":", "\"", "+", "InternalUtils", ".", "toMessage", "(", "ex", ")", ",", "ex", ")", ";", "}", "}", "public", "MacOutputStream", "(", "Mac", "mac", ")", "{", "assert", "mac", "!", "=", "null", ";", "this", ".", "mac", "=", "mac", ";", "}", "/", "**", "*", "Should", "only", "be", "invoked", "once", ",", "immediately", "after", "this", "stream", "is", "closed", ";", "it", "generates", "the", "final", "MAC", "result", ",", "and", "*", "returns", "it", "as", "a", "Base64", "encoded", "string", ".", "*", "*", "@", "return", "Base64", "encoded", "MAC", "result", "*", "/", "public", "String", "getResult", "(", ")", "{", "byte", "[", "]", "result", "=", "mac", ".", "doFinal", "(", ");", "return", "new", "String", "(", "Base64", ".", "encodeBase64", "(", "result", ")", ");", "}", "@", "Override", "public", "void", "write", "(", "int", "b", ")", "throws", "IOException", "{", "mac", ".", "update", "(", "(", "byte", ")", "b", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "mac", ".", "update", "(", "b", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "mac", ".", "update", "(", "b", ",", "off", ",", "len", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "73", "@", "@", "/", "/", "Copyright", "2012", "The", "Apache", "Software", "Foundation", "/", "/", "/", "/", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "/", "/", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "/", "/", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "/", "/", "/", "/", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "/", "/", "/", "/", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "/", "/", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "/", "/", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "/", "/", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "/", "/", "limitations", "under", "the", "License", ".", "package", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "/", "**", "*", "An", "output", "stream", "that", "acts", "like", "a", "\"", "tee", "\"", ",", "copying", "all", "provided", "bytes", "to", "two", "output", "streams", ".", "This", "is", "used", ",", "for", "example", ",", "*", "to", "accumulate", "a", "hash", "of", "content", "even", "as", "it", "is", "being", "written", ".", "*", "*", "@", "since", "5", ".", "3", ".", "5", "*", "/", "public", "class", "TeeOutputStream", "extends", "OutputStream", "{", "private", "final", "OutputStream", "left", ",", "right", ";", "public", "TeeOutputStream", "(", "OutputStream", "left", ",", "OutputStream", "right", ")", "{", "assert", "left", "!", "=", "null", ";", "assert", "right", "!", "=", "null", ";", "this", ".", "left", "=", "left", ";", "this", ".", "right", "=", "right", ";", "}", "@", "Override", "public", "void", "write", "(", "int", "b", ")", "throws", "IOException", "{", "left", ".", "write", "(", "b", ")", ";", "right", ".", "write", "(", "b", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "left", ".", "write", "(", "b", ")", ";", "right", ".", "write", "(", "b", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "left", ".", "write", "(", "b", ",", "off", ",", "len", ")", ";", "right", ".", "write", "(", "b", ",", "off", ",", "len", ")", ";", "}", "@", "Override", "public", "void", "flush", "(", ")", "throws", "IOException", "{", "left", ".", "flush", "(", ");", "right", ".", "flush", "(", ");", "}", "@", "Override", "public", "void", "close", "(", ")", "throws", "IOException", "{", "left", ".", "close", "(", ");", "right", ".", "close", "(", ");", "}", "}", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "/", "Copyright", "2009", ",", "2012", "The", "Apache", "Software", "Foundation", "*", "<", "p", "/", ">", "*", "Starting", "in", "release", "5", ".", "3", ".", "6", ",", "the", "encoded", "data", "incorporates", "an", "HMAC", "(", "hash", "based", "message", "authentication", "code", ")", "signature", ",", "*", "as", "a", "prefix", ".", "HMAC", "requires", "a", "secret", "key", ",", "configured", "using", "the", "*", "{", "@", "link", "org", ".", "apache", ".", "tapestry5", ".", "SymbolConstants", "#", "HMAC_PASSPHRASE", "}", "symbol", ".", "*", "@", "param", "clientData", "*", "encoded", "client", "data", "*", "@", "throws", "IOException", "*", "if", "the", "client", "data", "has", "been", "corrupted", "(", "verified", "via", "the", "HMAC", ")", "*", "Decodes", "client", "data", "obtained", "via", "{", "@", "link", "ClientDataSink", "#", "getEncodedClientData", "(", ")}", ".", "*", "@", "param", "clientData", "*", "URLEncoded", "client", "data", "*", "if", "the", "client", "data", "has", "been", "corrupted", "(", "verified", "via", "the", "HMAC", ")", "/", "/", "Leaving", "this", "as", "the", "default", "results", "in", "a", "runtime", "error", "logged", "to", "the", "console", "(", "and", "a", "default", "password", "is", "used", ")", ";", "/", "/", "you", "are", "expected", "to", "override", "this", "symbol", ".", "configuration", ".", "add", "(", "SymbolConstants", ".", "HMAC_PASSPHRASE", ",", "\"", "\")", ";", "package", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "services", "import", "org", ".", "apache", ".", "tapestry5", ".", "ioc", ".", "test", ".", "TestBase", "import", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "ClientDataEncoder", "import", "org", ".", "easymock", ".", "EasyMock", "import", "org", ".", "slf4j", ".", "Logger", "import", "org", ".", "testng", ".", "annotations", ".", "Test", "class", "ClientDataEncoderImplTest", "extends", "TestBase", "{", "def", "tryEncodeAndDecode", "(", "ClientDataEncoder", "cde", ")", "{", "def", "now", "=", "new", "Date", "(", ")", "def", "input", "=", "\"", "The", "current", "time", "is", "$", "now", "\"", "String", "clientData", "=", "convertToClientData", "cde", ",", "input", "def", "stream", "=", "cde", ".", "decodeClientData", "clientData", "def", "output", "=", "stream", ".", "readObject", "(", ")", "assert", "!", "input", ".", "is", "(", "output", ")", "assert", "input", "=", "=", "output", "}", "def", "String", "convertToClientData", "(", "ClientDataEncoder", "cde", ",", "input", ")", "{", "def", "sink", "=", "cde", ".", "createSink", "(", ")", "sink", ".", "getObjectOutputStream", "(", ").", "with", "{", "stream", "-", ">", "stream", "<", "<", "input", "stream", ".", "close", "(", ")", "}", "sink", ".", "clientData", "}", "def", "extractData", "(", "String", "encoded", ")", "{", "def", "colonx", "=", "encoded", ".", "indexOf", "(", "':", "')", "encoded", ".", "substring", "(", "colonx", "+", "1", ")", "}", "@", "Test", "void", "blank_passphrase_works_but_logs_error", "(", ")", "{", "Logger", "logger", "=", "newMock", "Logger", "logger", ".", "error", "(", "EasyMock", ".", "isA", "(", "String", ")", ")", "replay", "(", ")", "ClientDataEncoder", "cde", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "\",", "logger", ")", "tryEncodeAndDecode", "cde", "verify", "(", ")", "}", "@", "Test", "void", "no_logged_error_with_non_blank_passphrase", "(", ")", "{", "ClientDataEncoder", "cde", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "Testing", ",", "Testing", ",", "1", ".", ".,", "2", ".", ".,", "3", ".", "..", "\",", "null", ")", "tryEncodeAndDecode", "cde", "}", "@", "Test", "void", "passphrase_affects_encoded_output", "(", ")", "{", "ClientDataEncoder", "first", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "first", "passphrase", "\"", ",", "null", ")", "ClientDataEncoder", "second", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "different", "passphrase", "\"", ",", "null", ")", "def", "input", "=", "\"", "current", "time", "millis", "is", "$", "{", "System", ".", "currentTimeMillis", "(", ")}", "ms", "\"", "def", "output1", "=", "convertToClientData", "first", ",", "input", "def", "output2", "=", "convertToClientData", "second", ",", "input", "assert", "output1", "!", "=", "output2", "assert", "extractData", "(", "output1", ")", "=", "=", "extractData", "(", "output2", ")", "}", "@", "Test", "(", "expectedExceptions", "=", "IllegalArgumentException", ")", "void", "decode_with_missing_hmac_prefix_is_a_failure", "(", ")", "{", "ClientDataEncoder", "cde", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "a", "passphrase", "\"", ",", "null", ")", "cde", ".", "decodeClientData", "(", "\"", "so", "completely", "invalid", "\"", ")", "}", "@", "Test", "void", "incorrect_hmac_is_detected", "(", ")", "{", "/", "/", "Simulate", "tampering", "by", "encoding", "with", "one", "passphrase", "and", "attempting", "to", "decode", "with", "a", "different", "/", "/", "passphrase", ".", "ClientDataEncoder", "first", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "first", "passphrase", "\"", ",", "null", ")", "ClientDataEncoder", "second", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "different", "passphrase", "\"", ",", "null", ")", "def", "input", "=", "\"", "current", "time", "millis", "is", "$", "{", "System", ".", "currentTimeMillis", "(", ")}", "ms", "\"", "def", "output", "=", "convertToClientData", "first", ",", "input", "try", "{", "second", ".", "decodeClientData", "(", "output", ")", "unreachable", "(", ")", "}", "catch", "(", "Exception", "e", ")", "{", "assert", "e", ".", "message", ".", "contains", "(", "\"", "HMAC", "signature", "does", "not", "match", "\"", ")", "}", "}", "}", "@", "@", "-", "145", ",", "6", "+", "145", ",", "8", "@", "@", "public", "static", "void", "contributeApplicationDefaults", "(", "MappedConfiguration", "<", "String", ",", "Str", "configuration", ".", "add", "(", "SymbolConstants", ".", "HMAC_PASSPHRASE", ",", "\"", "testing", ",", "testing", ",", "1", ".", "..", "2", ".", "..", "3", ".", "..", "\")", ";</s>*", "/", "/", "Copyright", "2009", "The", "Apache", "Software", "Foundation", "public", "ClientDataEncoderImpl", "(", "URLEncoder", "urlEncoder", ")", "return", "new", "ClientDataSinkImpl", "(", "urlEncoder", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "/", "/", "what", "ClientDataSinkImpl", "does", ".", "BufferedInputStream", "buffered", "=", "new", "BufferedInputStream", "(", "new", "GZIPInputStream", "(", "new", "Base64InputStream", "(", "clientData", ")", "))", ";", "}", "catch", "(", "IOException", "ex", ")", "/", "/", "Copyright", "2009", "The", "Apache", "Software", "Foundation", "public", "ClientDataSinkImpl", "(", "URLEncoder", "urlEncoder", ")", "throws", "IOException", "final", "BufferedOutputStream", "pipeline", "=", "new", "BufferedOutputStream", "(", "new", "GZIPOutputStream", "(", "base64OutputStream", ")", ");", "}", "catch", "(", "IOException", "ex", ")", "return", "base64OutputStream", ".", "toBase64", "(", ");", "/", "/", "Copyright", "2009", "The", "Apache", "Software", "Foundation", "*", "@", "param", "clientData", "encoded", "client", "data", "*", "Decoes", "client", "data", "obtained", "via", "{", "@", "link", "ClientDataSink", "#", "getEncodedClientData", "(", ")}", ".", "*", "@", "param", "clientData", "URLEncoded", "client", "data"], "docstring_tokens": ["java", "deserialization"]}
{"contents": ["WINK-291:", "disable", "support", "for", "DTD", "expansion", "in", "XML", "payloads", "git-svn-id:", "https://svn.apache.org/repos/asf/incubator/wink/trunk@952385", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["<", "!-", "-", "users", "can", "specify", "-", "Djava", ".", "util", ".", "logging", ".", "config", ".", "file", "=", "/", "full", "/", "path", "/", "to", "/", "logging", ".", "properties", "to", "turn", "on", "<", "dependency", ">", "<", "groupId", ">", "junit", "<", "/", "groupId", ">", "<", "artifactId", ">", "junit", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jmock", "<", "/", "groupId", ">", "<", "artifactId", ">", "jmock", "-", "junit3", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "5", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "/", "/", "cast", "is", "safe", "because", "we", "'", "re", "on", "the", "client", "ClientConfig", "config", "=", "(", "ClientConfig", ")", "request", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "import", "org", ".", "jmock", ".", "Expectations", ";", "import", "org", ".", "jmock", ".", "Mockery", ";", "@", "Override", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "Mockery", "mockery", "=", "new", "Mockery", "(", ");", "final", "RuntimeContext", "context", "=", "mockery", ".", "mock", "(", "RuntimeContext", ".", "class", ")", ";", "mockery", ".", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "context", ")", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "}", "})", ";", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "context", ")", ";", "}", "@", "Override", "public", "void", "tearDown", "(", ")", "{", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "}", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "public", "class", "ClientConfig", "implements", "Cloneable", ",", "WinkConfiguration", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ClientConfig", ".", "class", ")", ";", "private", "static", "final", "String", "WINK_SUPPORT_DTD_EXPANSION", "=", "\"", "wink", ".", "supportDTDEntityExpansion", "\"", ";", "private", "static", "boolean", "WINK_CLIENT_SUPPORT_DTD_EXPANSION_DEFAULT", "=", "false", ";", "private", "Properties", "properties", "=", "null", ";", "*", "Convenience", "method", "to", "get", "the", "int", "value", "of", "the", "wink", ".", "client", ".", "connectTimeout", "property", "try", "{", "return", "Integer", ".", "valueOf", "(", "getProperties", "(", ").", "getProperty", "(", "WINK_CLIENT_CONNECTTIMEOUT", ")", ").", "intValue", "(", ");", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "logger", ".", "debug", "(", "\"", "Value", "in", "properties", "for", "key", "\"", "+", "WINK_CLIENT_CONNECTTIMEOUT", "+", "\"", "is", "invalid", ".", "Reverting", "to", "default", ":", "\"", "+", "WINK_CLIENT_CONNECTTIMEOUT_DEFAULT", ")", ";", "getProperties", "(", ").", "setProperty", "(", "WINK_CLIENT_CONNECTTIMEOUT", ",", "String", ".", "valueOf", "(", "WINK_CLIENT_CONNECTTIMEOUT_DEFAULT", ")", ");", "return", "getReadTimeout", "(", ");", "/", "/", "this", "is", "safe", ",", "because", "it", "'", "s", "unit", "tested", ".", ":", ")", "}", "*", "Convenience", "method", "to", "set", "the", "wink", ".", "client", ".", "connectTimeout", "property", "getProperties", "(", ").", "setProperty", "(", "WINK_CLIENT_CONNECTTIMEOUT", ",", "String", ".", "valueOf", "(", "connectTimeout", ")", ");", "*", "Convenience", "method", "to", "get", "the", "int", "value", "of", "the", "wink", ".", "client", ".", "readTimeout", "property", "try", "{", "return", "Integer", ".", "valueOf", "(", "getProperties", "(", ").", "getProperty", "(", "WINK_CLIENT_READTIMEOUT", ")", ").", "intValue", "(", ");", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "logger", ".", "debug", "(", "\"", "Value", "in", "properties", "for", "key", "\"", "+", "WINK_CLIENT_READTIMEOUT", "+", "\"", "is", "invalid", ".", "Reverting", "to", "default", ":", "\"", "+", "WINK_CLIENT_READTIMEOUT_DEFAULT", ")", ";", "getProperties", "(", ").", "setProperty", "(", "WINK_CLIENT_READTIMEOUT", ",", "String", ".", "valueOf", "(", "WINK_CLIENT_READTIMEOUT_DEFAULT", ")", ");", "return", "getReadTimeout", "(", ");", "/", "/", "this", "is", "safe", ",", "because", "it", "'", "s", "unit", "tested", ".", ":", ")", "}", "*", "Convenience", "method", "to", "set", "the", "wink", ".", "client", ".", "readTimeout", "property", "getProperties", "(", ").", "setProperty", "(", "WINK_CLIENT_READTIMEOUT", ",", "String", ".", "valueOf", "(", "readTimeout", ")", ");", "return", "this", ";", "}", "/", "**", "*", "Convenience", "method", "to", "get", "the", "boolean", "value", "of", "the", "wink", ".", "supportDTDExpansion", "property", "*", "*", "@", "return", "boolean", "*", "/", "public", "final", "boolean", "isSupportDTDExpansion", "(", ")", "{", "/", "/", "this", "is", "safe", ".", "See", "valueOf", "javadoc", "return", "Boolean", ".", "valueOf", "(", "getProperties", "(", ").", "getProperty", "(", "WINK_SUPPORT_DTD_EXPANSION", ")", ").", "booleanValue", "(", ");", "}", "/", "**", "*", "Convenience", "method", "to", "set", "the", "wink", ".", "supportDTDExpansion", "property", "*", "*", "@", "param", "supportDTDExpansion", "boolean", "*", "@", "return", "this", "client", "configuration", "*", "@", "throws", "ClientConfigException", "*", "/", "public", "final", "ClientConfig", "supportDTDExpansion", "(", "boolean", "supportDTDExpansion", ")", "{", "if", "(", "!", "modifiable", ")", "{", "throw", "new", "ClientConfigException", "(", "Messages", ".", "getMessage", "(", "\"", "clientConfigurationUnmodifiable", "\"", "))", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "getProperties", "(", ").", "setProperty", "(", "WINK_SUPPORT_DTD_EXPANSION", ",", "String", ".", "valueOf", "(", "supportDTDExpansion", ")", ");", "/", "/", "need", "to", "deep", "copy", "the", "properties", ":", "/", "/", "TODO", ":", "thread", "safe", "?", "Remember", "there", "'", "s", "an", "Iterator", "at", "work", "under", "the", "putAll", "Properties", "props", "=", "new", "Properties", "(", ");", "props", ".", "putAll", "(", "getProperties", "(", "))", ";", "clone", ".", "setProperties", "(", "props", ")", ";", "/", "**", "*", "Convenience", "method", "for", "getting", "all", "properties", "registered", "on", "this", "instance", ".", "System", "properties", "may", "be", "changed", "between", "creation", "of", "*", "new", "instances", ".", "*", "*", "The", "following", "properties", "are", "meaningful", "to", "a", "ClientConfig", "instance", ":", "*", "wink", ".", "client", ".", "connectTimeout", "-", "value", "is", "in", "milliseconds", ",", "default", "is", "60000", "*", "wink", ".", "client", ".", "readTimeout", "-", "value", "is", "in", "milliseconds", ",", "default", "is", "60000", "*", "wink", ".", "supportDTDExpansion", "-", "value", "is", "\"", "true", "\"", "or", "\"", "false", "\"", "to", "allow", "DOCTYPE", "entity", "expansion", "when", "built", "-", "in", "providers", "parse", "XML", ",", "default", "is", "\"", "false", "\"", "*", "*", "@", "return", "properties", "on", "this", "ClientConfig", "instance", "*", "/", "public", "Properties", "getProperties", "(", ")", "{", "if", "(", "properties", "=", "=", "null", ")", "{", "properties", "=", "new", "Properties", "(", ");", "try", "{", "String", "connectTimeoutString", "=", "System", ".", "getProperty", "(", "WINK_CLIENT_CONNECTTIMEOUT", ",", "String", ".", "valueOf", "(", "WINK_CLIENT_CONNECTTIMEOUT_DEFAULT", ")", ");", "int", "toSet", "=", "Integer", ".", "parseInt", "(", "connectTimeoutString", ")", ";", "properties", ".", "put", "(", "WINK_CLIENT_CONNECTTIMEOUT", ",", "String", ".", "valueOf", "(", "toSet", ")", ");", "logger", ".", "debug", "(", "\"", "Wink", "client", "connectTimeout", "default", "value", "is", "{", "}.", "\",", "toSet", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "debug", "(", "\"", "Error", "processing", "{", "}", "system", "property", ":", "{", "}\"", ",", "WINK_CLIENT_CONNECTTIMEOUT", ",", "e", ")", ";", "}", "try", "{", "String", "readTimeoutString", "=", "System", ".", "getProperty", "(", "WINK_CLIENT_READTIMEOUT", ",", "String", ".", "valueOf", "(", "WINK_CLIENT_READTIMEOUT_DEFAULT", ")", ");", "int", "toSet", "=", "Integer", ".", "parseInt", "(", "readTimeoutString", ")", ";", "properties", ".", "put", "(", "WINK_CLIENT_READTIMEOUT", ",", "String", ".", "valueOf", "(", "toSet", ")", ");", "logger", ".", "debug", "(", "\"", "Wink", "client", "readTimeout", "default", "value", "is", "{", "}.", "\",", "toSet", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "debug", "(", "\"", "Error", "processing", "{", "}", "system", "property", ":", "{", "}\"", ",", "WINK_CLIENT_READTIMEOUT", ",", "e", ")", ";", "}", "try", "{", "String", "supportDTD", "=", "System", ".", "getProperty", "(", "WINK_SUPPORT_DTD_EXPANSION", ",", "String", ".", "valueOf", "(", "WINK_CLIENT_SUPPORT_DTD_EXPANSION_DEFAULT", ")", ");", "boolean", "toSet", "=", "Boolean", ".", "valueOf", "(", "supportDTD", ")", ";", "/", "/", "require", "\"", "true", "\"", "or", "\"", "false", "\"", ",", "not", "\"", "yes", "\"", "or", "\"", "no", "\"", "or", "other", "variants", "(", "see", "parseBoolean", "vs", ".", "valueOf", "javadoc", ")", "properties", ".", "put", "(", "WINK_SUPPORT_DTD_EXPANSION", ",", "String", ".", "valueOf", "(", "toSet", ")", ");", "logger", ".", "debug", "(", "\"", "Wink", "client", "readTimeout", "default", "value", "is", "{", "}.", "\",", "String", ".", "valueOf", "(", "toSet", ")", ");", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "debug", "(", "\"", "Error", "processing", "{", "}", "system", "property", ":", "{", "}\"", ",", "WINK_SUPPORT_DTD_EXPANSION", ",", "e", ")", ";", "}", "}", "return", "properties", ";", "}", "/", "**", "*", "Convenience", "method", "to", "set", "the", "client", "configuration", "properties", ".", "*", "*", "The", "following", "properties", "are", "meaningful", "to", "a", "ClientConfig", "instance", ":", "*", "wink", ".", "client", ".", "connectTimeout", "-", "value", "is", "in", "milliseconds", ",", "default", "is", "60000", "*", "wink", ".", "client", ".", "readTimeout", "-", "value", "is", "in", "milliseconds", ",", "default", "is", "60000", "*", "wink", ".", "supportDTDExpansion", "-", "value", "is", "\"", "true", "\"", "or", "\"", "false", "\"", "to", "allow", "DOCTYPE", "entity", "expansion", "when", "built", "-", "in", "providers", "parse", "XML", ",", "default", "is", "\"", "false", "\"", "*", "*", "@", "param", "properties", "the", "properties", "object", "to", "use", ".", "If", "properties", "parameter", "is", "null", ",", "the", "properties", "on", "this", "ClientConfig", "will", "be", "cleared", "with", "Properties", ".", "clear", "(", ")", "*", "/", "public", "void", "setProperties", "(", "Properties", "properties", ")", "{", "if", "(", "!", "modifiable", ")", "{", "throw", "new", "ClientConfigException", "(", "Messages", ".", "getMessage", "(", "\"", "clientConfigurationUnmodifiable", "\"", "))", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "if", "(", "properties", "=", "=", "null", ")", "{", "this", ".", "properties", ".", "clear", "(", ");", "return", ";", "}", "this", ".", "properties", "=", "properties", ";", "}", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "request", ".", "setAttribute", "(", "WinkConfiguration", ".", "class", ",", "config", ")", ";", "/", "/", "for", "legacy", ",", "if", "third", "-", "party", "code", "is", "calling", "getAttribute", "with", "ClientConfig", ".", "class", "as", "key", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "/", "/", "we", "'", "re", "on", "the", "client", "so", "this", "is", "a", "safe", "cast", "ClientConfig", "config", "=", "(", "ClientConfig", ")", "request", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "assertEquals", "(", "conf", ".", "isSupportDTDExpansion", "(", "),", "false", ")", ";", "/", "/", "exercise", "the", "API", "public", "void", "testAPI", "(", ")", "{", "String", "connectTimeoutKey", "=", "\"", "wink", ".", "client", ".", "connectTimeout", "\"", ";", "String", "readTimeoutKey", "=", "\"", "wink", ".", "client", ".", "readTimeout", "\"", ";", "String", "dtdKey", "=", "\"", "wink", ".", "supportDTDEntityExpansion", "\"", ";", "ClientConfig", "conf1", "=", "new", "ClientConfig", "(", ");", "System", ".", "setProperty", "(", "connectTimeoutKey", ",", "\"", "50", "\"", ");", "System", ".", "setProperty", "(", "readTimeoutKey", ",", "\"", "60", "\"", ");", "System", ".", "setProperty", "(", "dtdKey", ",", "\"", "tRUe", "\"", ");", "Properties", "props", "=", "conf1", ".", "getProperties", "(", ");", "assertEquals", "(", "\"", "50", "\"", ",", "props", ".", "getProperty", "(", "connectTimeoutKey", ")", ");", "assertEquals", "(", "\"", "60", "\"", ",", "props", ".", "getProperty", "(", "readTimeoutKey", ")", ");", "assertEquals", "(", "\"", "true", "\"", ",", "props", ".", "getProperty", "(", "dtdKey", ")", ");", "/", "/", "changing", "the", "system", "property", "should", "not", "change", "the", "props", "in", "the", "conf", "instance", "System", ".", "setProperty", "(", "connectTimeoutKey", ",", "\"", "100", "\"", ");", "props", "=", "conf1", ".", "getProperties", "(", ");", "assertEquals", "(", "\"", "50", "\"", ",", "props", ".", "getProperty", "(", "connectTimeoutKey", ")", ");", "/", "/", "setting", "through", "the", "api", "should", "set", "the", "property", "value", ":", "conf1", ".", "supportDTDExpansion", "(", "false", ")", ";", "assertEquals", "(", "\"", "false", "\"", ",", "props", ".", "getProperty", "(", "dtdKey", ")", ");", "/", "/", "setting", "new", "properties", "should", "change", "the", "value", "Properties", "changedProps", "=", "new", "Properties", "(", ");", "changedProps", ".", "put", "(", "dtdKey", ",", "\"", "true", "\"", ");", "conf1", ".", "setProperties", "(", "changedProps", ")", ";", "assertTrue", "(", "conf1", ".", "isSupportDTDExpansion", "(", "))", ";", "/", "/", "props", "are", "unique", "per", "conf", "instance", ",", "however", "ClientConfig", "conf2", "=", "new", "ClientConfig", "(", ");", "assertEquals", "(", "\"", "100", "\"", ",", "conf2", ".", "getProperties", "(", ").", "getProperty", "(", "connectTimeoutKey", ")", ");", "/", "/", "props", "are", "not", "permitted", "to", "be", "null", "conf2", ".", "setProperties", "(", "null", ")", ";", "assertNotNull", "(", "conf2", ".", "getProperties", "(", "))", ";", "/", "/", "should", "be", "cleared", ",", "however", "assertNull", "(", "conf2", ".", "getProperties", "(", ").", "getProperty", "(", "connectTimeoutKey", ")", ");", "/", "/", "bad", "data", "should", "be", "tolerated", "(", "meaning", ",", "won", "'", "t", "crash", "the", "system", ")", "conf2", ".", "supportDTDExpansion", "(", "true", ")", ";", "changedProps", ".", "put", "(", "dtdKey", ",", "\"", "some", "bad", "data", "\"", ");", "changedProps", ".", "put", "(", "connectTimeoutKey", ",", "\"", "this", "is", "not", "an", "int", "\"", ");", "changedProps", ".", "put", "(", "readTimeoutKey", ",", "\"", "this", "is", "also", "not", "an", "int", "\"", ");", "conf2", ".", "setProperties", "(", "changedProps", ")", ";", "assertFalse", "(", "conf2", ".", "isSupportDTDExpansion", "(", "))", ";", "/", "/", "any", "string", "not", "\"", "true", "\"", "is", "false", "assertEquals", "(", "60000", ",", "conf2", ".", "getReadTimeout", "(", "))", ";", "/", "/", "reverts", "to", "default", "assertEquals", "(", "60000", ",", "conf2", ".", "getConnectTimeout", "(", "))", ";", "/", "/", "reverts", "to", "default", "}", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ";", "import", "java", ".", "util", ".", "Properties", ";", "public", "interface", "WinkConfiguration", "{", "/", "**", "*", "get", "configuration", "properties", "*", "*", "@", "return", "configuration", "properties", "as", "defined", "by", "the", "server", "or", "client", "Wink", "module", "*", "/", "public", "Properties", "getProperties", "(", ");", "/", "**", "*", "@", "param", "properties", "the", "properties", "you", "intend", "to", "set", "for", "configuration", "on", "the", "server", "or", "client", "Wink", "module", "*", "/", "public", "void", "setProperties", "(", "Properties", "properties", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "83", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "properties", ";", "import", "java", ".", "security", ".", "AccessController", ";", "import", "java", ".", "security", ".", "PrivilegedAction", ";", "import", "java", ".", "util", ".", "Enumeration", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "public", "class", "WinkSystemProperties", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "WinkSystemProperties", ".", "class", ")", ";", "/", "**", "*", "Walks", "through", "each", "of", "the", "passed", "-", "in", "properties", "-", "-", "presumably", ",", "these", "are", "*", "all", "defined", "in", "a", "configuration", "file", ".", "-", "If", "the", "property", "is", "already", "set", ",", "do", "*", "nothing", ".", "-", "If", "not", ",", "read", "it", "as", "a", "JVM", "property", ";", "if", "detected", ",", "set", "the", "*", "property", "on", "systemProperties", ",", "which", "is", "returned", ".", "*", "/", "public", "static", "Properties", "loadSystemProperties", "(", "Properties", "properties", ")", "{", "String", "key", "=", "null", ";", "String", "value", "=", "null", ";", "Properties", "systemProperties", "=", "new", "Properties", "(", ");", "/", "/", "Read", "the", "properties", "contained", "in", "passed", "-", "in", "properties", "if", "(", "properties", "!", "=", "null", ")", "{", "Enumeration", "<", "?>", "keyEnum", "=", "properties", ".", "propertyNames", "(", ");", "while", "(", "keyEnum", ".", "hasMoreElements", "(", "))", "{", "key", "=", "(", "String", ")", "keyEnum", ".", "nextElement", "(", ");", "value", "=", "(", "String", ")", "properties", ".", "get", "(", "key", ")", ";", "/", "/", "If", "value", "is", "null", "or", "empty", ",", "try", "to", "read", "as", "JVM", "property", "if", "(", "value", "=", "=", "null", "|", "|", "value", ".", "length", "(", ")", "=", "=", "0", ")", "{", "value", "=", "getSystemProperty", "(", "key", ")", ";", "if", "(", "value", "!", "=", "null", ")", "{", "systemProperties", ".", "setProperty", "(", "key", ",", "value", ")", ";", "}", "}", "else", "{", "logger", ".", "debug", "(", "\"", "Property", "{", "}", "is", "already", "defined", "with", "value", "{", "}\"", ",", "key", ",", "value", ")", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "}", "}", "else", "{", "logger", ".", "debug", "(", "\"", "Properties", "are", "null", "\"", ");", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "return", "systemProperties", ";", "}", "/", "**", "*", "Reads", "the", "JVM", "property", "and", "returns", "the", "value", "(", "which", "could", "be", "null", ")", ".", "*", "/", "private", "static", "String", "getSystemProperty", "(", "final", "String", "key", ")", "{", "String", "value", "=", "AccessController", ".", "doPrivileged", "(", "new", "PrivilegedAction", "<", "String", ">", "()", "{", "public", "String", "run", "(", ")", "{", "String", "v", "=", "System", ".", "getProperty", "(", "key", ")", ";", "logger", ".", "debug", "(", "key", "+", "\"", "=", "\"", "+", "v", ")", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "return", "v", ";", "}", "}", ");", "return", "value", ";", "}", "}", "@", "@", "-", "25", ",", "15", "+", "25", ",", "19", "@", "@", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "i18n", ".", "Messages", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXParseException", ";", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "SourceProvider", ".", "class", ")", ";", "private", "void", "setupDocumentBuilderToFilterDTD", "(", "DocumentBuilder", "dbuilder", ")", "{", "/", "*", "*", "You", "might", "think", "you", "could", "just", "do", "this", "to", "prevent", "entity", "expansion", ":", "*", "documentBuilderFactory", ".", "setExpandEntityReferences", "(", "false", ")", ";", "*", "In", "fact", ",", "you", "should", "not", "do", "that", ",", "because", "it", "will", "just", "increase", "the", "size", "*", "of", "your", "DOMSource", ".", "We", "want", "to", "actively", "reject", "XML", "when", "a", "DTD", "is", "present", ",", "so", ".", "..", "*", "/", "dbuilder", ".", "setEntityResolver", "(", "new", "EntityResolver", "(", ")", "{", "public", "InputSource", "resolveEntity", "(", "String", "name", ",", "String", "baseURI", ")", "throws", "SAXException", ",", "IOException", "{", "/", "/", "we", "don", "'", "t", "support", "entity", "resolution", "here", "throw", "new", "SAXParseException", "(", "Messages", ".", "getMessage", "(", "\"", "entityRefsNotSupported", "\"", "),", "null", ",", "null", ")", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "}", ");", "try", "{", "/", "/", "important", ":", "keep", "this", "order", "documentBuilderFactory", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "/", "/", "this", "should", "never", "happen", "if", "you", "run", "the", "SourceProviderTest", "unittests", "logger", ".", "error", "(", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "/", "/", "workaround", "for", "JDK5", "bug", "that", "causes", "NPE", "in", "checking", "done", "due", "to", "above", "FEATURE_SECURE_PROCESSING", "documentBuilderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "dom", "/", "defer", "-", "node", "-", "expansion", "\"", ",", "false", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "/", "/", "possible", "if", "not", "on", "apache", "parser", "?", "ignore", ".", "..", "}", "}", "DocumentBuilder", "dbuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "RuntimeContext", "runtimeContext", "=", "RuntimeContextTLS", ".", "getRuntimeContext", "(", ");", "WinkConfiguration", "winkConfig", "=", "runtimeContext", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "if", "(", "winkConfig", "!", "=", "null", ")", "{", "Properties", "props", "=", "winkConfig", ".", "getProperties", "(", ");", "if", "(", "props", "!", "=", "null", ")", "{", "/", "/", "use", "valueOf", "method", "to", "require", "the", "word", "\"", "true", "\"", "if", "(", "!", "Boolean", ".", "valueOf", "(", "props", ".", "getProperty", "(", "\"", "wink", ".", "supportDTDEntityExpansion", "\"", "))", ")", "{", "setupDocumentBuilderToFilterDTD", "(", "dbuilder", ")", ";", "}", "}", "}", "return", "new", "DOMSource", "(", "dbuilder", ".", "parse", "(", "entityStream", ")", ");", "logger", ".", "error", "(", "Messages", ".", "getMessage", "(", "\"", "saxParseException", "\"", ",", "type", ".", "getName", "(", "))", ",", "e", ")", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "throw", "new", "WebApplicationException", "(", "e", ",", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "logger", ".", "error", "(", "Messages", ".", "getMessage", "(", "\"", "saxParserConfigurationException", "\"", "),", "e", ")", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "throw", "new", "WebApplicationException", "(", "e", ",", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "throw", "asIOException", "(", "e", ")", ";", "private", "static", "IOException", "asIOException", "(", "Exception", "e", ")", "throws", "IOException", "{", "XMLStreamReader", "xsr", "=", "null", ";", "xsr", "=", "getXMLStreamReader", "(", "entityStream", ")", ";", "int", "nextEvent", "=", "xsr", ".", "getEventType", "(", ");", "/", "/", "skip", "the", "plural", "tag", "Object", "o", "=", "unmarshaller", ".", "unmarshal", "(", "xsr", ")", ";", "if", "(", "o", "instanceof", "JAXBElement", ")", "{", "o", "=", "(", "(", "JAXBElement", ")", "o", ")", ".", "getValue", "(", ");", "}", "elementList", ".", "add", "(", "o", ")", ";", "closeXMLStreamReader", "(", "xsr", ")", ";", "closeXMLStreamReader", "(", "xsr", ")", ";", "closeXMLStreamReader", "(", "xsr", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "closeXMLStreamReader", "(", "xsr", ")", ";", "throw", "e", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "/", "/", "For", "performance", ",", "it", "might", "seem", "advantageous", "to", "use", "a", "static", "XMLInputFactory", "instance", ".", "However", ",", "this", "was", "shown", "to", "/", "/", "be", "problematic", "on", "the", "Sun", "StAX", "parser", "(", "which", "is", "a", "fork", "of", "Apache", "Xerces", ")", "under", "load", "stress", "test", ".", "So", "we", "use", "ThreadLocal", ".", "private", "static", "ThreadLocal", "<", "XMLInputFactory", ">", "xmlInputFactory", "=", "new", "ThreadLocal", "<", "XMLInputFactory", ">", "()", ";", "/", "**", "*", "skips", "START_DOCUMENT", ",", "COMMENTs", ",", "PIs", ",", "and", "checks", "for", "DTD", "*", "@", "param", "reader", "*", "@", "throws", "XMLStreamException", "*", "/", "private", "static", "void", "checkForDTD", "(", "XMLStreamReader", "reader", ")", "throws", "XMLStreamException", "{", "boolean", "supportDTD", "=", "false", ";", "int", "event", "=", "reader", ".", "getEventType", "(", ");", "if", "(", "event", "!", "=", "XMLStreamReader", ".", "START_DOCUMENT", ")", "{", "/", "/", "something", "went", "horribly", "wrong", ";", "the", "reader", "passed", "into", "us", "has", "/", "/", "already", "been", "partially", "processed", "throw", "new", "XMLStreamException", "(", "Messages", ".", "getMessage", "(", "\"", "badXMLReaderInitialStart", "\"", "))", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "while", "(", "event", "!", "=", "XMLStreamReader", ".", "START_ELEMENT", ")", "{", "/", "/", "all", "StAX", "parsers", "require", "a", "START_ELEMENT", ".", "See", "AbstractJAXBProviderTest", "class", "event", "=", "reader", ".", "next", "(", ");", "if", "(", "event", "=", "=", "XMLStreamReader", ".", "DTD", ")", "{", "RuntimeContext", "runtimeContext", "=", "RuntimeContextTLS", ".", "getRuntimeContext", "(", ");", "WinkConfiguration", "winkConfig", "=", "runtimeContext", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "if", "(", "winkConfig", "!", "=", "null", ")", "{", "Properties", "props", "=", "winkConfig", ".", "getProperties", "(", ");", "if", "(", "props", "!", "=", "null", ")", "{", "/", "/", "use", "valueOf", "method", "to", "require", "the", "word", "\"", "true", "\"", "supportDTD", "=", "Boolean", ".", "valueOf", "(", "props", ".", "getProperty", "(", "\"", "wink", ".", "supportDTDEntityExpansion", "\"", "))", ";", "}", "}", "if", "(", "!", "supportDTD", ")", "{", "throw", "new", "XMLStreamException", "(", "Messages", ".", "getMessage", "(", "\"", "entityRefsNotSupported", "\"", "))", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "else", "{", "logger", ".", "debug", "(", "\"", "DTD", "entity", "reference", "expansion", "is", "enabled", ".", "This", "may", "present", "a", "security", "risk", ".", "\")", ";", "}", "}", "}", "}", "private", "static", "XMLInputFactory", "getXMLInputFactory", "(", ")", "{", "XMLInputFactory", "factory", "=", "xmlInputFactory", ".", "get", "(", ");", "if", "(", "factory", "=", "=", "null", ")", "{", "factory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "xmlInputFactory", ".", "set", "(", "factory", ")", ";", "}", "return", "factory", ";", "}", "/", "**", "*", "A", "consistent", "place", "to", "get", "a", "properly", "configured", "XMLStreamReader", ".", "*", "*", "@", "param", "entityStream", "*", "@", "return", "*", "@", "throws", "XMLStreamException", "*", "/", "protected", "static", "XMLStreamReader", "getXMLStreamReader", "(", "InputStream", "entityStream", ")", "throws", "XMLStreamException", "{", "/", "/", "NOTE", ":", "createFilteredReader", "may", "appear", "to", "be", "more", "convenient", ",", "but", "it", "comes", "at", "the", "cost", "of", "/", "/", "performance", ".", "This", "solution", "(", "to", "use", "checkForDTD", ")", "appears", "to", "be", "the", "best", "solution", "to", "preserve", "/", "/", "performance", ",", "but", "still", "achieve", "what", "we", "need", "to", "do", ".", "XMLStreamReader", "reader", "=", "getXMLInputFactory", "(", ").", "createXMLStreamReader", "(", "entityStream", ")", ";", "checkForDTD", "(", "reader", ")", ";", "return", "reader", ";", "}", "/", "**", "*", "A", "consistent", "place", "to", "get", "a", "properly", "configured", "XMLStreamReader", ".", "*", "*", "@", "param", "entityStream", "*", "@", "return", "*", "@", "throws", "XMLStreamException", "*", "/", "protected", "static", "XMLStreamReader", "getXMLStreamReader", "(", "InputStreamReader", "entityStreamReader", ")", "throws", "XMLStreamException", "{", "/", "/", "NOTE", ":", "createFilteredReader", "may", "appear", "to", "be", "more", "convenient", ",", "but", "it", "comes", "at", "the", "cost", "of", "/", "/", "performance", ".", "This", "solution", "(", "to", "use", "checkForDTD", ")", "appears", "to", "be", "the", "best", "solution", "to", "preserve", "/", "/", "performance", ",", "but", "still", "achieve", "what", "we", "need", "to", "do", ".", "XMLStreamReader", "reader", "=", "getXMLInputFactory", "(", ").", "createXMLStreamReader", "(", "entityStreamReader", ")", ";", "checkForDTD", "(", "reader", ")", ";", "return", "reader", ";", "}", "protected", "static", "void", "closeXMLStreamReader", "(", "XMLStreamReader", "xmlStreamReader", ")", "{", "if", "(", "xmlStreamReader", "!", "=", "null", ")", "{", "try", "{", "xmlStreamReader", ".", "close", "(", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "logger", ".", "debug", "(", "\"", "XMLStreamReader", "already", "closed", ".", "\",", "e", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "logger", ".", "debug", "(", "\"", "RuntimeException", "occurred", ":", "\"", ",", "e", ")", ";", "}", "}", "}", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "XMLStreamReader", "xmlStreamReader", "=", "null", ";", "xmlStreamReader", "=", "getXMLStreamReader", "(", "entityStream", ")", ";", "unmarshaledResource", "=", "unmarshaller", ".", "unmarshal", "(", "xmlStreamReader", ",", "classToFill", ")", ";", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "xmlStreamReader", "=", "getXMLStreamReader", "(", "new", "InputStreamReader", "(", "entityStream", ",", "Charset", ".", "forName", "(", "charset", ")", "))", ";", "unmarshaledResource", "=", "unmarshaller", ".", "unmarshal", "(", "xmlStreamReader", ",", "classToFill", ")", ";", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "if", "(", "logger", ".", "isErrorEnabled", "(", "))", "{", "logger", ".", "error", "(", "Messages", ".", "getMessage", "(", "\"", "entityRefsNotSupported", "\"", "))", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "throw", "new", "WebApplicationException", "(", "e", ",", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "throw", "new", "WebApplicationException", "(", "e", ",", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "XMLStreamReader", "xmlStreamReader", "=", "null", ";", "xmlStreamReader", "=", "getXMLStreamReader", "(", "entityStream", ")", ";", "unmarshaledResource", "=", "unmarshaller", ".", "unmarshal", "(", "xmlStreamReader", ")", ";", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "unmarshaledResource", "=", "unmarshaller", ".", "unmarshal", "(", "xmlStreamReader", ",", "type", ")", ".", "getValue", "(", ");", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "if", "(", "logger", ".", "isErrorEnabled", "(", "))", "{", "logger", ".", "error", "(", "Messages", ".", "getMessage", "(", "\"", "entityRefsNotSupported", "\"", "))", ";", "/", "/$", "NON", "-", "NLS", "-", "1", "$", "}", "throw", "new", "WebApplicationException", "(", "e", ",", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "closeXMLStreamReader", "(", "xmlStreamReader", ")", ";", "throw", "e", ";", "entityRefsNotSupported", "=", "Entity", "references", "are", "not", "supported", "in", "XML", "documents", "due", "to", "possible", "security", "vulnerabilities", ".", "saxParseException", "=", "The", "system", "cannot", "parse", "the", "XML", "content", "into", "a", "{", "0", "}", "instance", ".", "Verify", "that", "the", "XML", "content", "is", "valid", ".", "saxParserConfigurationException", "=", "The", "system", "cannot", "configure", "the", "SAX", "parser", "with", "the", "given", "configuration", "parameter", ".", "badXMLReaderInitialStart", "=", "The", "XMLStreamReader", "instance", "has", "already", "been", "partially", "processed", ".", "@", "@", "-", "21", ",", "11", "+", "21", ",", "15", "@", "@", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "logging", ".", "LogRecord", ";", "import", "org", ".", "apache", ".", "wink", ".", "logging", ".", "WinkLogHandler", ";", "public", "void", "testLogging", "(", ")", "throws", "Exception", "{", "/", "/", "WinkLogHandler", ".", "turnLoggingCaptureOn", "(", ");", "/", "/", "WinkLogHandler", "imported", "from", "wink", "-", "component", "-", "test", "-", "support", "module", "ApplicationFileLoader", "applicationFileLoader", "=", "new", "ApplicationFileLoader", "(", "\"", "org", "/", "/", "apache", "/", "/", "wink", "/", "/", "common", "/", "/", "internal", "/", "/", "application", "/", "/", "custom", ".", "app", "\"", ");", "/", "/", "WinkLogHandler", ".", "turnLoggingCaptureOff", "(", ");", "/", "/", "ArrayList", "<", "LogRecord", ">", "logRecords", "=", "WinkLogHandler", ".", "getRecords", "(", ");", "/", "/", "assertEquals", "(", "13", ",", "logRecords", ".", "size", "(", "))", ";", "/", "/", "WinkLogHandler", ".", "clearRecords", "(", ");", "/", "/", "recommend", "doing", "this", "so", "static", "ArrayList", "of", "LogRecords", "is", "clear", "for", "next", "test", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "properties", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "junit", ".", "framework", ".", "TestCase", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "WinkSystemPropertiesTest", "extends", "TestCase", "{", "private", "static", "final", "String", "PROP_KEY", "=", "\"", "someSysPropKey", "\"", ";", "@", "Override", "public", "void", "setUp", "(", ")", "{", "System", ".", "clearProperty", "(", "PROP_KEY", ")", ";", "}", "@", "Test", "public", "void", "testNullToleration", "(", ")", "{", "System", ".", "setProperty", "(", "PROP_KEY", ",", "\"", "false", "\"", ");", "/", "/", "loadSystemProperties", "can", "only", "override", "an", "existing", "key", "in", "the", "properties", "bag", ".", "We", "should", "get", "an", "empty", "bag", "back", "Properties", "props", "=", "WinkSystemProperties", ".", "loadSystemProperties", "(", "null", ")", ";", "assertTrue", "(", "\"", "expected", "empty", "properties", "bag", "\"", ",", "props", ".", "isEmpty", "(", "))", ";", "}", "@", "Test", "public", "void", "testEmptyValue", "(", ")", "{", "Properties", "startProps", "=", "new", "Properties", "(", ");", "startProps", ".", "put", "(", "PROP_KEY", ",", "\"", "\")", ";", "System", ".", "setProperty", "(", "PROP_KEY", ",", "\"", "false", "\"", ");", "/", "/", "loadSystemProperties", "can", "override", "an", "existing", "key", "in", "the", "properties", "bag", "when", "the", "value", "is", "empty", "Properties", "props", "=", "WinkSystemProperties", ".", "loadSystemProperties", "(", "startProps", ")", ";", "assertEquals", "(", "\"", "expected", "non", "-", "null", "\\", "\"\"", "+", "PROP_KEY", "+", "\"\\", "\"", "property", "to", "be", "\\", "\"", "false", "\\", "\"\"", ",", "\"", "false", "\"", ",", "props", ".", "getProperty", "(", "PROP_KEY", ")", ");", "}", "@", "Test", "public", "void", "testGetSystemProperties", "(", ")", "throws", "Exception", "{", "Properties", "startProps", "=", "new", "Properties", "(", ");", "/", "/", "empty", "System", ".", "setProperty", "(", "PROP_KEY", ",", "\"", "false", "\"", ");", "/", "/", "loadSystemProperties", "can", "only", "override", "an", "existing", "key", "in", "the", "properties", "bag", ".", "We", "should", "get", "an", "empty", "bag", "back", "Properties", "props", "=", "WinkSystemProperties", ".", "loadSystemProperties", "(", "startProps", ")", ";", "assertTrue", "(", "\"", "expected", "empty", "properties", "bag", "\"", ",", "props", ".", "isEmpty", "(", "))", ";", "}", "@", "Test", "public", "void", "testPropsOverride", "(", ")", "throws", "Exception", "{", "Properties", "startProps", "=", "new", "Properties", "(", ");", "startProps", ".", "setProperty", "(", "PROP_KEY", ",", "\"", "true", "\"", ");", "System", ".", "setProperty", "(", "PROP_KEY", ",", "\"", "false", "\"", ");", "/", "/", "make", "sure", "the", "system", "property", "does", "NOT", "override", "what", "'", "s", "already", "in", "the", "bag", ".", "We", "should", "get", "an", "empty", "bag", "back", "Properties", "props", "=", "WinkSystemProperties", ".", "loadSystemProperties", "(", "startProps", ")", ";", "assertTrue", "(", "\"", "expected", "empty", "properties", "bag", "\"", ",", "props", ".", "isEmpty", "(", "))", ";", "}", "}", "@", "@", "-", "19", ",", "16", "+", "19", ",", "99", "@", "@", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "StringTokenizer", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "MessageBodyReader", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "Providers", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "contexts", ".", "MediaTypeCharsetAdjuster", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "providers", ".", "entity", ".", "SourceProvider", ".", "DOMSourceProvider", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "model", ".", "JAXBUnmarshalOptions", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "model", ".", "XmlFormattingOptions", ";", "import", "org", ".", "jmock", ".", "Expectations", ";", "import", "org", ".", "jmock", ".", "integration", ".", "junit3", ".", "MockObjectTestCase", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "public", "class", "SourceProviderTest", "extends", "MockObjectTestCase", "{", "static", "String", "path", "=", "null", ";", "static", "{", "String", "classpath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classpath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "while", "(", "tokenizer", ".", "hasMoreTokens", "(", "))", "{", "path", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "path", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "break", ";", "}", "}", "/", "/", "for", "windows", ":", "int", "driveIndex", "=", "path", ".", "indexOf", "(", "\":", "\")", ";", "if", "(", "driveIndex", "!", "=", "-", "1", ")", "{", "path", "=", "path", ".", "substring", "(", "driveIndex", "+", "1", ")", ";", "}", "}", "static", "final", "String", "xmlWithDTD", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "file", ":", "\"+", "path", "+", "\"/", "etc", "/", "SourceProviderTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "ns2", ":", "messages", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "arg0", ">", "&", "file", ";", "</", "ns2", ":", "arg0", ">", "\"", "\"", "</", "ns2", ":", "messages", ">", "\";", "private", "WinkConfiguration", "winkConfiguration", "=", "null", ";", "private", "MessageBodyReader", "sourceProviderReader", "=", "null", ";", "private", "Providers", "providers", ";", "@", "Before", "public", "void", "setUp", "(", ")", "{", "providers", "=", "mock", "(", "Providers", ".", "class", ")", ";", "final", "RuntimeContext", "runtimeContext", "=", "mock", "(", "RuntimeContext", ".", "class", ")", ";", "winkConfiguration", "=", "mock", "(", "WinkConfiguration", ".", "class", ")", ";", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "providers", ")", ".", "getContextResolver", "(", "XmlFormattingOptions", ".", "class", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "allowing", "(", "providers", ")", ".", "getContextResolver", "(", "JAXBUnmarshalOptions", ".", "class", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "allowing", "(", "runtimeContext", ")", ".", "getAttribute", "(", "MediaTypeCharsetAdjuster", ".", "class", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "allowing", "(", "runtimeContext", ")", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "winkConfiguration", ")", ");", "}", "})", ";", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "runtimeContext", ")", ";", "sourceProviderReader", "=", "new", "DOMSourceProvider", "(", ");", "}", "@", "After", "public", "void", "tearDown", "(", ")", "{", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "}", "@", "Test", "/", "**", "*", "testing", "that", "supporting", "DTD", "expansion", "is", "configurable", "*", "/", "public", "void", "testJAXBUnmarshallingWithDTDServerConfigurable", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "props", ".", "put", "(", "\"", "wink", ".", "supportDTDEntityExpansion", "\"", ",", "\"", "true", "\"", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "assertTrue", "(", "sourceProviderReader", ".", "isReadable", "(", "DOMSource", ".", "class", ",", "null", ",", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ");", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xmlWithDTD", ".", "getBytes", "(", "))", ";", "Object", "obj", "=", "sourceProviderReader", ".", "readFrom", "(", "DOMSource", ".", "class", ",", "null", ",", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ",", "null", ",", "bais", ")", ";", "assertTrue", "(", "obj", "instanceof", "DOMSource", ")", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "providers", ".", "entity", ".", "xml", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "StringTokenizer", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessType", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessorType", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlRootElement", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "import", "org", ".", "jmock", ".", "Expectations", ";", "import", "org", ".", "jmock", ".", "integration", ".", "junit3", ".", "MockObjectTestCase", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "/", "**", "*", "this", "test", "class", "is", "relatively", "new", "compared", "to", "the", "various", "*", "XML", "provider", "tests", "here", "in", "wink", "-", "common", "and", "wink", "-", "server", ".", "*", "Hence", "there", "are", "not", "as", "many", "tests", "as", "you", "might", "expect", ".", "I", "'", "m", "*", "confident", "in", "the", "amount", "of", "testing", "being", "done", "in", "other", "places", ".", "*", "*", "/", "public", "class", "AbstractJAXBProviderTest", "extends", "MockObjectTestCase", "{", "/", "*", "*", "this", "test", "class", "is", "relatively", "new", "compared", "to", "the", "various", "*", "XML", "provider", "tests", "here", "in", "wink", "-", "common", "and", "wink", "-", "server", ".", "*", "Hence", "there", "are", "not", "as", "many", "tests", "as", "you", "might", "expect", ".", "I", "'", "m", "*", "confident", "in", "the", "amount", "of", "testing", "being", "done", "in", "other", "places", ".", "*", "/", "@", "XmlAccessorType", "(", "XmlAccessType", ".", "FIELD", ")", "@", "XmlRootElement", "(", "name", "=", "\"", "message", "\"", ")", "public", "static", "class", "Message", "{", "protected", "String", "arg0", ";", "/", "**", "*", "Gets", "the", "value", "of", "the", "arg0", "property", ".", "*", "*", "/", "public", "String", "getArg0", "(", ")", "{", "return", "arg0", ";", "}", "/", "**", "*", "Sets", "the", "value", "of", "the", "arg0", "property", ".", "*", "*", "/", "public", "void", "setArg0", "(", "String", "value", ")", "{", "this", ".", "arg0", "=", "value", ";", "}", "}", "static", "String", "TEST_CLASSES_PATH", "=", "null", ";", "static", "{", "String", "classpath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classpath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "while", "(", "tokenizer", ".", "hasMoreTokens", "(", "))", "{", "TEST_CLASSES_PATH", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "TEST_CLASSES_PATH", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "break", ";", "}", "}", "/", "/", "for", "windows", ":", "int", "driveIndex", "=", "TEST_CLASSES_PATH", ".", "indexOf", "(", "\":", "\")", ";", "if", "(", "driveIndex", "!", "=", "-", "1", ")", "{", "TEST_CLASSES_PATH", "=", "TEST_CLASSES_PATH", ".", "substring", "(", "driveIndex", "+", "1", ")", ";", "}", "}", "public", "WinkConfiguration", "winkConfiguration", "=", "null", ";", "@", "Before", "public", "void", "setUp", "(", ")", "{", "winkConfiguration", "=", "mock", "(", "WinkConfiguration", ".", "class", ")", ";", "final", "RuntimeContext", "runtimeContext", "=", "mock", "(", "RuntimeContext", ".", "class", ")", ";", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "runtimeContext", ")", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "winkConfiguration", ")", ");", "}", "})", ";", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "runtimeContext", ")", ";", "}", "@", "After", "public", "void", "tearDown", "(", ")", "{", "/", "/", "clean", "up", "the", "mess", ".", ":", ")", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "}", "public", "void", "testGetXMLStreamReader1", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "/", "/", "check", "for", "infinite", "loop", ",", "empty", "document", "final", "String", "xml", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", ";", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "))", ";", "try", "{", "AbstractJAXBProvider", ".", "getXMLStreamReader", "(", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "/", "/", "any", "other", "exception", "type", "will", "cause", "test", "failure", "}", "}", "public", "void", "testGetXMLStreamReader2", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "/", "/", "check", "for", "infinite", "loop", ",", "comment", "only", "final", "String", "xml", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", "><", "!-", "-", "comment", "-", "->", "\";", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "))", ";", "try", "{", "AbstractJAXBProvider", ".", "getXMLStreamReader", "(", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "/", "/", "any", "other", "exception", "type", "will", "cause", "test", "failure", "}", "}", "public", "void", "testGetXMLStreamReader3", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "/", "/", "check", "for", "infinite", "loop", ",", "whitespace", "and", "comment", "final", "String", "xml", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">", "<", "!-", "-", "comment", "-", "->", "\";", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "))", ";", "try", "{", "AbstractJAXBProvider", ".", "getXMLStreamReader", "(", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "/", "/", "any", "other", "exception", "type", "will", "cause", "test", "failure", "}", "}", "public", "void", "testGetXMLStreamReader4", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "/", "/", "check", "for", "infinite", "loop", ",", "whitespace", ",", "comment", ",", "and", "whitespace", "final", "String", "xml", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">", "<", "!-", "-", "comment", "-", "->", "\"", ";", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "))", ";", "try", "{", "AbstractJAXBProvider", ".", "getXMLStreamReader", "(", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "/", "/", "any", "other", "exception", "type", "will", "cause", "test", "failure", "}", "}", "public", "void", "testGetXMLStreamReaderWithDTDUnsupported", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "/", "/", "check", "for", "infinite", "loop", ",", "whitespace", ",", "comment", ",", "whitespace", ",", "and", "DOCTYPE", "unsupported", "final", "String", "xml", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">", "<", "!-", "-", "comment", "-", "->", "\"", "+", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "file", ":", "\"+", "TEST_CLASSES_PATH", "+", "\"/", "etc", "/", "ProvidersJAXBTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "message", ">", "&", "file", ";", "</", "message", ">", "\";", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "))", ";", "try", "{", "AbstractJAXBProvider", ".", "getXMLStreamReader", "(", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "/", "/", "any", "other", "exception", "type", "will", "cause", "test", "failure", "}", "}", "public", "void", "testGetXMLStreamReaderWithDTDSupported", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "props", ".", "put", "(", "\"", "wink", ".", "supportDTDEntityExpansion", "\"", ",", "\"", "true", "\"", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "/", "/", "check", "for", "infinite", "loop", ",", "whitespace", ",", "comment", ",", "whitespace", ",", "and", "DOCTYPE", "supported", "final", "String", "xml", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">", "<", "!-", "-", "comment", "-", "->", "\"", "+", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "file", ":", "\"+", "TEST_CLASSES_PATH", "+", "\"/", "etc", "/", "ProvidersJAXBTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "message", ">", "<", "arg0", ">", "&", "file", ";", "</", "arg0", ">", "</", "message", ">", "\";", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "))", ";", "XMLStreamReader", "reader", "=", "AbstractJAXBProvider", ".", "getXMLStreamReader", "(", "bais", ")", ";", "assertEquals", "(", "\"", "reader", "event", "should", "be", "start", "element", "\"", ",", "XMLStreamReader", ".", "START_ELEMENT", ",", "reader", ".", "getEventType", "(", "))", ";", "JAXBContext", "context", "=", "JAXBContext", ".", "newInstance", "(", "Message", ".", "class", ")", ";", "Unmarshaller", "unmarshaller", "=", "context", ".", "createUnmarshaller", "(", ");", "Message", "message", "=", "(", "Message", ")", "unmarshaller", ".", "unmarshal", "(", "reader", ")", ";", "assertEquals", "(", "\"", "message", "object", "should", "contain", "text", "from", "ProvidersJAXBTest", ".", "txt", "file", "\"", ",", "\"", "99999999", "\"", ",", "message", ".", "getArg0", "(", ").", "trim", "(", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "261", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "providers", ".", "jaxb", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "StringTokenizer", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "GenericEntity", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MediaType", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "ContextResolver", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "MessageBodyReader", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "MessageBodyWriter", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "Providers", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBContext", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "contexts", ".", "MediaTypeCharsetAdjuster", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "providers", ".", "entity", ".", "xml", ".", "JAXBCollectionXmlProvider", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "providers", ".", "jaxb", ".", "jaxb1", ".", "AddNumbers", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "providers", ".", "jaxb", ".", "jaxb1", ".", "MyPojo", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "model", ".", "JAXBUnmarshalOptions", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "model", ".", "XmlFormattingOptions", ";", "import", "org", ".", "jmock", ".", "Expectations", ";", "import", "org", ".", "jmock", ".", "integration", ".", "junit3", ".", "MockObjectTestCase", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "public", "class", "AbstractJAXBCollectionProviderTest", "extends", "MockObjectTestCase", "{", "public", "class", "MyJAXBXmlProvider", "extends", "JAXBCollectionXmlProvider", "{", "MyJAXBXmlProvider", "(", ")", "{", "super", "(", ");", "providers", "=", "AbstractJAXBCollectionProviderTest", ".", "this", ".", "providers", ";", "}", "/", "*", "*", "simulate", "what", "would", "happen", "if", "application", "had", "supplied", "a", "JAXBContext", "provider", "*", "/", "@", "Override", "protected", "JAXBContext", "getContext", "(", "Class", "<", "?>", "type", ",", "MediaType", "mediaType", ")", "throws", "JAXBException", "{", "/", "/", "use", "JAXBContext", ".", "newInstance", "(", "String", ")", ".", "The", "default", "in", "AbstractJAXBProvider", "is", "JAXBContext", ".", "newInstance", "(", "Class", ")", "return", "JAXBContext", ".", "newInstance", "(", "type", ".", "getPackage", "(", ").", "getName", "(", "))", ";", "}", "}", "static", "String", "path", "=", "null", ";", "static", "{", "String", "classpath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classpath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "while", "(", "tokenizer", ".", "hasMoreTokens", "(", "))", "{", "path", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "path", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "break", ";", "}", "}", "/", "/", "for", "windows", ":", "int", "driveIndex", "=", "path", ".", "indexOf", "(", "\":", "\")", ";", "if", "(", "driveIndex", "!", "=", "-", "1", ")", "{", "path", "=", "path", ".", "substring", "(", "driveIndex", "+", "1", ")", ";", "}", "}", "static", "final", "String", "xml", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<", "addNumberss", ">", "\"", "\"", "<", "ns2", ":", "addNumbers", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "arg0", ">", "1", "<", "/", "ns2", ":", "arg0", ">", "\"", "\"", "<", "ns2", ":", "arg1", ">", "2", "<", "/", "ns2", ":", "arg1", ">", "\"", "\"", "</", "ns2", ":", "addNumbers", ">", "\"", "\"", "<", "ns2", ":", "addNumbers", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "arg0", ">", "1", "<", "/", "ns2", ":", "arg0", ">", "\"", "\"", "<", "ns2", ":", "arg1", ">", "3", "<", "/", "ns2", ":", "arg1", ">", "\"", "\"", "</", "ns2", ":", "addNumbers", ">", "\"", "\"", "</", "addNumberss", ">", "\";", "static", "final", "String", "xmlMyPojo", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<", "myPojos", ">", "\"", "\"", "<", "ns2", ":", "myPojo", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "stringdata", ">", "1", "<", "/", "ns2", ":", "stringdata", ">", "\"", "\"", "</", "ns2", ":", "myPojo", ">", "\"", "\"", "<", "ns2", ":", "myPojo", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "stringdata", ">", "2", "<", "/", "ns2", ":", "stringdata", ">", "\"", "\"", "</", "ns2", ":", "myPojo", ">", "\"", "\"", "</", "myPojos", ">", "\";", "static", "final", "String", "xmlWithDTD", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "file", ":", "\"+", "path", "+", "\"/", "etc", "/", "ProvidersJAXBTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "addNumberss", ">", "\"", "\"", "<", "ns2", ":", "addNumbers", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "arg0", ">", "&", "file", ";", "</", "ns2", ":", "arg0", ">", "\"", "\"", "<", "ns2", ":", "arg1", ">", "2", "<", "/", "ns2", ":", "arg1", ">", "\"", "\"", "</", "ns2", ":", "addNumbers", ">", "\"", "\"", "<", "ns2", ":", "addNumbers", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "arg0", ">", "&", "file", ";", "</", "ns2", ":", "arg0", ">", "\"", "\"", "<", "ns2", ":", "arg1", ">", "3", "<", "/", "ns2", ":", "arg1", ">", "\"", "\"", "</", "ns2", ":", "addNumbers", ">", "\"", "\"", "</", "addNumberss", ">", "\";", "static", "final", "String", "xmlMyPojoWithDTD", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "file", ":", "\"+", "path", "+", "\"/", "etc", "/", "ProvidersJAXBTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "myPojos", ">", "\"", "\"", "<", "ns2", ":", "myPojo", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "stringdata", ">", "&", "file", ";", "</", "ns2", ":", "stringdata", ">", "\"", "\"", "</", "ns2", ":", "myPojo", ">", "\"", "\"", "<", "ns2", ":", "myPojo", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "stringdata", ">", "&", "file", ";", "</", "ns2", ":", "stringdata", ">", "\"", "\"", "</", "ns2", ":", "myPojo", ">", "\"", "\"", "</", "myPojos", ">", "\";", "private", "MessageBodyReader", "jaxbProviderReader", "=", "null", ";", "private", "MessageBodyWriter", "jaxbProviderWriter", "=", "null", ";", "private", "Providers", "providers", ";", "public", "class", "MyJAXBContextResolver", "implements", "ContextResolver", "<", "JAXBContext", ">", "{", "public", "JAXBContext", "getContext", "(", "Class", "<", "?>", "arg0", ")", "{", "try", "{", "return", "JAXBContext", ".", "newInstance", "(", "arg0", ")", ";", "}", "catch", "(", "JAXBException", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "}", "@", "Before", "public", "void", "setUp", "(", ")", "{", "providers", "=", "mock", "(", "Providers", ".", "class", ")", ";", "final", "RuntimeContext", "runtimeContext", "=", "mock", "(", "RuntimeContext", ".", "class", ")", ";", "final", "WinkConfiguration", "winkConfiguration", "=", "mock", "(", "WinkConfiguration", ".", "class", ")", ";", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "providers", ")", ".", "getContextResolver", "(", "JAXBContext", ".", "class", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ";", "will", "(", "returnValue", "(", "new", "MyJAXBContextResolver", "(", "))", ");", "allowing", "(", "providers", ")", ".", "getContextResolver", "(", "XmlFormattingOptions", ".", "class", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "allowing", "(", "providers", ")", ".", "getContextResolver", "(", "JAXBUnmarshalOptions", ".", "class", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "allowing", "(", "runtimeContext", ")", ".", "getAttribute", "(", "MediaTypeCharsetAdjuster", ".", "class", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "allowing", "(", "runtimeContext", ")", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "winkConfiguration", ")", ");", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "null", ")", ");", "}", "})", ";", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "runtimeContext", ")", ";", "jaxbProviderReader", "=", "new", "MyJAXBXmlProvider", "(", ");", "jaxbProviderWriter", "=", "new", "MyJAXBXmlProvider", "(", ");", "}", "@", "After", "public", "void", "tearDown", "(", ")", "{", "/", "/", "clean", "up", "the", "mess", ".", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "}", "public", "void", "testXml", "(", ")", "throws", "Exception", "{", "GenericEntity", "<", "List", "<", "AddNumbers", ">", ">", "type1", "=", "new", "GenericEntity", "<", "List", "<", "AddNumbers", ">", ">(", "new", "ArrayList", "<", "AddNumbers", ">", "()", ")", "{", "}", ";", "assertTrue", "(", "jaxbProviderReader", ".", "isReadable", "(", "type1", ".", "getRawType", "(", "),", "type1", ".", "getType", "(", "),", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ");", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "))", ";", "Object", "obj", "=", "jaxbProviderReader", ".", "readFrom", "(", "type1", ".", "getRawType", "(", "),", "type1", ".", "getType", "(", "),", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ",", "null", ",", "bais", ")", ";", "assertTrue", "(", "obj", "instanceof", "ArrayList", ")", ";", "ArrayList", "alist", "=", "(", "ArrayList", ")", "obj", ";", "/", "/", "make", "sure", "the", "objects", "in", "the", "returned", "list", "are", "the", "actual", "jaxb", "objects", ",", "not", "JAXBElement", ",", "and", "the", "unmarshal", "worked", ":", "assertEquals", "(", "1", ",", "(", "(", "AddNumbers", ")", "alist", ".", "get", "(", "0", ")", ").", "getArg0", "(", "))", ";", "assertEquals", "(", "2", ",", "(", "(", "AddNumbers", ")", "alist", ".", "get", "(", "0", ")", ").", "getArg1", "(", "))", ";", "assertEquals", "(", "1", ",", "(", "(", "AddNumbers", ")", "alist", ".", "get", "(", "1", ")", ").", "getArg0", "(", "))", ";", "assertEquals", "(", "3", ",", "(", "(", "AddNumbers", ")", "alist", ".", "get", "(", "1", ")", ").", "getArg1", "(", "))", ";", "}", "public", "void", "testXmlWithDTD", "(", ")", "throws", "Exception", "{", "GenericEntity", "<", "List", "<", "AddNumbers", ">", ">", "type1", "=", "new", "GenericEntity", "<", "List", "<", "AddNumbers", ">", ">(", "new", "ArrayList", "<", "AddNumbers", ">", "()", ")", "{", "}", ";", "assertTrue", "(", "jaxbProviderReader", ".", "isReadable", "(", "type1", ".", "getRawType", "(", "),", "type1", ".", "getType", "(", "),", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ");", "Exception", "ex", "=", "null", ";", "try", "{", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xmlWithDTD", ".", "getBytes", "(", "))", ";", "Object", "obj", "=", "jaxbProviderReader", ".", "readFrom", "(", "type1", ".", "getRawType", "(", "),", "type1", ".", "getType", "(", "),", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ",", "null", ",", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "ex", "=", "e", ";", "}", "assertTrue", "(", "\"", "expected", "an", "XMLStreamException", "\"", ",", "ex", ".", "getCause", "(", ")", "instanceof", "XMLStreamException", ")", ";", "/", "/", "parse", "it", "just", "as", "a", "sanity", "check", "to", "make", "sure", "our", "xml", "is", "good", ".", "No", "exceptions", "means", "good", "xml", "!", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilder", "db", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "Document", "dom", "=", "db", ".", "parse", "(", "new", "ByteArrayInputStream", "(", "xmlWithDTD", ".", "getBytes", "(", "))", ");", "}", "public", "void", "testXmlMyPojo", "(", ")", "throws", "Exception", "{", "GenericEntity", "<", "List", "<", "MyPojo", ">", ">", "type1", "=", "new", "GenericEntity", "<", "List", "<", "MyPojo", ">", ">(", "new", "ArrayList", "<", "MyPojo", ">", "()", ")", "{", "}", ";", "assertTrue", "(", "jaxbProviderReader", ".", "isReadable", "(", "type1", ".", "getRawType", "(", "),", "type1", ".", "getType", "(", "),", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ");", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xmlMyPojo", ".", "getBytes", "(", "))", ";", "Object", "obj", "=", "jaxbProviderReader", ".", "readFrom", "(", "type1", ".", "getRawType", "(", "),", "type1", ".", "getType", "(", "),", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ",", "null", ",", "bais", ")", ";", "assertTrue", "(", "obj", "instanceof", "ArrayList", ")", ";", "ArrayList", "alist", "=", "(", "ArrayList", ")", "obj", ";", "/", "/", "make", "sure", "the", "objects", "in", "the", "returned", "list", "are", "the", "actual", "jaxb", "objects", ",", "not", "JAXBElement", ",", "and", "the", "unmarshal", "worked", ":", "assertEquals", "(", "\"", "1", "\"", ",", "(", "(", "MyPojo", ")", "alist", ".", "get", "(", "0", ")", ").", "getStringdata", "(", "))", ";", "assertEquals", "(", "\"", "2", "\"", ",", "(", "(", "MyPojo", ")", "alist", ".", "get", "(", "1", ")", ").", "getStringdata", "(", "))", ";", "}", "public", "void", "testXmlMyPojoWithDTD", "(", ")", "throws", "Exception", "{", "GenericEntity", "<", "List", "<", "MyPojo", ">", ">", "type1", "=", "new", "GenericEntity", "<", "List", "<", "MyPojo", ">", ">(", "new", "ArrayList", "<", "MyPojo", ">", "()", ")", "{", "}", ";", "assertTrue", "(", "jaxbProviderReader", ".", "isReadable", "(", "type1", ".", "getRawType", "(", "),", "type1", ".", "getType", "(", "),", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ");", "Exception", "ex", "=", "null", ";", "try", "{", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xmlMyPojoWithDTD", ".", "getBytes", "(", "))", ";", "Object", "obj", "=", "jaxbProviderReader", ".", "readFrom", "(", "type1", ".", "getRawType", "(", "),", "type1", ".", "getType", "(", "),", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ",", "null", ",", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "ex", "=", "e", ";", "}", "assertTrue", "(", "\"", "expected", "an", "XMLStreamException", "\"", ",", "ex", ".", "getCause", "(", ")", "instanceof", "XMLStreamException", ")", ";", "/", "/", "parse", "it", "just", "as", "a", "sanity", "check", "to", "make", "sure", "our", "xml", "is", "good", ".", "No", "exceptions", "means", "good", "xml", "!", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilder", "db", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "Document", "dom", "=", "db", ".", "parse", "(", "new", "ByteArrayInputStream", "(", "xmlMyPojoWithDTD", ".", "getBytes", "(", "))", ");", "}", "}", "@", "@", "-", "22", ",", "6", "+", "22", ",", "8", "@", "@", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "StringTokenizer", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "Unmarshaller", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "contexts", ".", "MediaTypeCharsetAdjuster", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "providers", ".", "jaxb", ".", "jaxb1", ".", "MyPojo", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "import", "org", ".", "junit", ".", "After", ";", "\"", "<", "ns2", ":", "arg0", ">", "1", "<", "/", "ns2", ":", "arg0", ">", "\"", "\"", "<", "ns2", ":", "arg1", ">", "2", "<", "/", "ns2", ":", "arg1", ">", "\"", "static", "String", "path", "=", "null", ";", "static", "{", "String", "classpath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classpath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "while", "(", "tokenizer", ".", "hasMoreTokens", "(", "))", "{", "path", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "path", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "break", ";", "}", "}", "/", "/", "for", "windows", ":", "int", "driveIndex", "=", "path", ".", "indexOf", "(", "\":", "\")", ";", "if", "(", "driveIndex", "!", "=", "-", "1", ")", "{", "path", "=", "path", ".", "substring", "(", "driveIndex", "+", "1", ")", ";", "}", "}", "static", "final", "String", "xmlWithDTD", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "file", ":", "\"+", "path", "+", "\"", "/", "etc", "/", "ProvidersJAXBTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "ns2", ":", "addNumbers", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "arg0", ">", "&", "file", ";", "</", "ns2", ":", "arg0", ">", "\"", "\"", "<", "ns2", ":", "arg1", ">", "2", "<", "/", "ns2", ":", "arg1", ">", "\"", "\"", "</", "ns2", ":", "addNumbers", ">", "\";", "static", "final", "String", "xmlMyPojoWithDTD", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "file", ":", "\"+", "path", "+", "\"/", "etc", "/", "ProvidersJAXBTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "ns2", ":", "myPojo", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\\", "\">", "\"", "\"", "<", "ns2", ":", "stringdata", ">", "&", "file", ";", "</", "ns2", ":", "stringdata", ">", "\"", "\"", "</", "ns2", ":", "myPojo", ">", "\";", "private", "WinkConfiguration", "winkConfiguration", "=", "null", ";", "public", "class", "MyJAXBContextResolver", "implements", "ContextResolver", "<", "JAXBContext", ">", "{", "public", "JAXBContext", "getContext", "(", "Class", "<", "?>", "arg0", ")", "{", "try", "{", "return", "JAXBContext", ".", "newInstance", "(", "arg0", ")", ";", "}", "catch", "(", "JAXBException", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "}", "final", "RuntimeContext", "runtimeContext", "=", "mock", "(", "RuntimeContext", ".", "class", ")", ";", "winkConfiguration", "=", "mock", "(", "WinkConfiguration", ".", "class", ")", ";", "allowing", "(", "runtimeContext", ")", ".", "getAttribute", "(", "MediaTypeCharsetAdjuster", ".", "class", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "allowing", "(", "runtimeContext", ")", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "winkConfiguration", ")", ");", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "runtimeContext", ")", ";", "}", "@", "After", "public", "void", "tearDown", "(", ")", "{", "/", "/", "clean", "up", "the", "mess", ".", ":", ")", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "/", "/", "let", "'", "s", "make", "sure", "our", "test", "string", "is", "unmarshallable", ",", "just", "for", "a", "good", "sanity", "check", "JAXBContext", "testcontext", "=", "JAXBContext", ".", "newInstance", "(", "AddNumbers", ".", "class", ")", ";", "Unmarshaller", "testunmarshaller", "=", "testcontext", ".", "createUnmarshaller", "(", ");", "AddNumbers", "testresponse", "=", "(", "AddNumbers", ")", "testunmarshaller", ".", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "xml", ".", "getBytes", "(", "))", ");", "assertEquals", "(", "\"", "we", "could", "not", "unmarshal", "the", "test", "xml", "\"", ",", "1", ",", "testresponse", ".", "getArg0", "(", "))", ";", "assertEquals", "(", "1", ",", "(", "(", "AddNumbers", ")", "obj", ")", ".", "getArg0", "(", "))", ";", "assertEquals", "(", "2", ",", "(", "(", "AddNumbers", ")", "obj", ")", ".", "getArg1", "(", "))", ";", "@", "Test", "public", "void", "testJAXBUnmarshallingWithDTD", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "Exception", "ex", "=", "null", ";", "assertTrue", "(", "jaxbProviderReader", ".", "isReadable", "(", "AddNumbers", ".", "class", ",", "null", ",", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ");", "try", "{", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xmlWithDTD", ".", "getBytes", "(", "))", ";", "Object", "obj", "=", "jaxbProviderReader", ".", "readFrom", "(", "AddNumbers", ".", "class", ",", "null", ",", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ",", "null", ",", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "ex", "=", "e", ";", "}", "assertTrue", "(", "\"", "expected", "an", "XMLStreamException", "\"", ",", "ex", ".", "getCause", "(", ")", "instanceof", "XMLStreamException", ")", ";", "/", "/", "let", "'", "s", "make", "sure", "our", "test", "string", "is", "unmarshallable", ",", "just", "for", "a", "good", "sanity", "check", "JAXBContext", "testcontext", "=", "JAXBContext", ".", "newInstance", "(", "AddNumbers", ".", "class", ")", ";", "Unmarshaller", "testunmarshaller", "=", "testcontext", ".", "createUnmarshaller", "(", ");", "AddNumbers", "testresponse", "=", "(", "AddNumbers", ")", "testunmarshaller", ".", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "xmlWithDTD", ".", "getBytes", "(", "))", ");", "assertEquals", "(", "\"", "we", "could", "not", "unmarshal", "the", "test", "xml", "\"", ",", "99999999", ",", "testresponse", ".", "getArg0", "(", "))", ";", "}", "@", "Test", "/", "**", "*", "testing", "that", "supporting", "DTD", "expansion", "is", "configurable", "*", "/", "public", "void", "testJAXBUnmarshallingWithDTDServerConfigurable", "(", ")", "throws", "Exception", "{", "/", "/", "pretend", "we", "'", "re", "on", "the", "server", ":", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "props", ".", "put", "(", "\"", "wink", ".", "supportDTDEntityExpansion", "\"", ",", "\"", "true", "\"", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "assertTrue", "(", "jaxbProviderReader", ".", "isReadable", "(", "AddNumbers", ".", "class", ",", "null", ",", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ");", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xmlWithDTD", ".", "getBytes", "(", "))", ";", "Object", "obj", "=", "jaxbProviderReader", ".", "readFrom", "(", "AddNumbers", ".", "class", ",", "null", ",", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ",", "null", ",", "bais", ")", ";", "assertTrue", "(", "obj", "instanceof", "AddNumbers", ")", ";", "assertEquals", "(", "99999999", ",", "(", "(", "AddNumbers", ")", "obj", ")", ".", "getArg0", "(", "))", ";", "assertEquals", "(", "2", ",", "(", "(", "AddNumbers", ")", "obj", ")", ".", "getArg1", "(", "))", ";", "/", "/", "let", "'", "s", "make", "sure", "our", "test", "string", "is", "unmarshallable", ",", "just", "for", "a", "good", "sanity", "check", "JAXBContext", "testcontext", "=", "JAXBContext", ".", "newInstance", "(", "AddNumbers", ".", "class", ")", ";", "Unmarshaller", "testunmarshaller", "=", "testcontext", ".", "createUnmarshaller", "(", ");", "AddNumbers", "testresponse", "=", "(", "AddNumbers", ")", "testunmarshaller", ".", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "xmlWithDTD", ".", "getBytes", "(", "))", ");", "assertEquals", "(", "\"", "we", "could", "not", "unmarshal", "the", "test", "xml", "\"", ",", "99999999", ",", "testresponse", ".", "getArg0", "(", "))", ";", "}", "@", "Test", "public", "void", "testJAXBUnmarshallingMyPojoWithDTD", "(", ")", "throws", "Exception", "{", "final", "Properties", "props", "=", "new", "Properties", "(", ");", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "winkConfiguration", ")", ".", "getProperties", "(", ");", "will", "(", "returnValue", "(", "props", ")", ");", "}", "})", ";", "Exception", "ex", "=", "null", ";", "try", "{", "assertTrue", "(", "jaxbProviderReader", ".", "isReadable", "(", "MyPojo", ".", "class", ",", "null", ",", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ")", ");", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "xmlMyPojoWithDTD", ".", "getBytes", "(", "))", ";", "Object", "obj", "=", "jaxbProviderReader", ".", "readFrom", "(", "MyPojo", ".", "class", ",", "null", ",", "null", ",", "MediaType", ".", "TEXT_XML_TYPE", ",", "null", ",", "bais", ")", ";", "fail", "(", "\"", "should", "have", "got", "an", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "ex", "=", "e", ";", "}", "assertTrue", "(", "\"", "expected", "an", "XMLStreamException", "\"", ",", "ex", ".", "getCause", "(", ")", "instanceof", "XMLStreamException", ")", ";", "/", "/", "let", "'", "s", "make", "sure", "our", "test", "string", "is", "unmarshallable", ",", "just", "for", "a", "good", "sanity", "check", "JAXBContext", "testcontext", "=", "JAXBContext", ".", "newInstance", "(", "MyPojo", ".", "class", ")", ";", "Unmarshaller", "testunmarshaller", "=", "testcontext", ".", "createUnmarshaller", "(", ");", "JAXBElement", "<", "MyPojo", ">", "testresponse", "=", "(", "JAXBElement", "<", "MyPojo", ">", ")", "testunmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "new", "ByteArrayInputStream", "(", "xmlMyPojoWithDTD", ".", "getBytes", "(", "))", "),", "MyPojo", ".", "class", ")", ";", "MyPojo", "myPojo", "=", "testresponse", ".", "getValue", "(", ");", "assertEquals", "(", "\"", "we", "could", "not", "unmarshal", "the", "test", "xml", "\"", ",", "\"", "99999999", "\"", ",", "myPojo", ".", "getStringdata", "(", ").", "trim", "(", "))", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "providers", ".", "jaxb", ".", "jaxb1", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessType", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessorType", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlType", ";", "/", "/", "do", "NOT", "annotate", "with", "@", "XmlRootElement", "@", "XmlAccessorType", "(", "XmlAccessType", ".", "FIELD", ")", "@", "XmlType", "(", "name", "=", "\"", "MyPojo", "\"", ",", "propOrder", "=", "{", "\"", "stringdata", "\"", "})", "public", "class", "MyPojo", "{", "@", "XmlElement", "(", "required", "=", "true", ")", "private", "String", "stringdata", "=", "null", ";", "public", "MyPojo", "(", ")", "{", "}", "public", "void", "setStringdata", "(", "String", "stringdata", ")", "{", "this", ".", "stringdata", "=", "stringdata", ";", "}", "public", "String", "getStringdata", "(", ")", "{", "return", "stringdata", ";", "}", "}", "@", "@", "-", "52", ",", "6", "+", "52", ",", "7", "@", "@", "private", "final", "static", "QName", "_MyPojo_QNAME", "=", "new", "QName", "(", "\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\"", ",", "\"", "myPojo", "\"", ");", "/", "**", "*", "Create", "an", "instance", "of", "{", "@", "link", "MyPojo", "}", "*", "*", "/", "public", "MyPojo", "createMyPojo", "(", ")", "{", "return", "new", "MyPojo", "(", ");", "}", "/", "**", "*", "Create", "an", "instance", "of", "{", "@", "link", "JAXBElement", "}", "{@", "code", "<", "}{", "@", "link", "MyPojo", "}", "{@", "code", ">", "}}", "*", "*", "/", "@", "XmlElementDecl", "(", "namespace", "=", "\"", "http", ":", "//", "org", "/", "apache", "/", "wink", "/", "common", "/", "internal", "/", "providers", "/", "jaxb", "/", "jaxb1", "\"", ",", "name", "=", "\"", "MyPojo", "\"", ")", "public", "JAXBElement", "<", "MyPojo", ">", "createMyPojo", "(", "MyPojo", "value", ")", "{", "return", "new", "JAXBElement", "<", "MyPojo", ">", "(", "_MyPojo_QNAME", ",", "MyPojo", ".", "class", ",", "null", ",", "value", ")", ";", "}", "import", "org", ".", "junit", ".", "After", ";", "@", "After", "public", "void", "tearDown", "(", ")", "{", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "}", "99999999", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "99999999", "@", "@", "-", "21", ",", "13", "+", "21", ",", "13", "@", "@", ".", "level", "=", "DEBUG", "java", ".", "util", ".", "logging", ".", "ConsoleHandler", ".", "level", "=", "DEBUG", "java", ".", "util", ".", "logging", ".", "FileHandler", ".", "level", "=", "DEBUG", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "public", "class", "DeploymentConfiguration", "implements", "WinkConfiguration", "{", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "/", "/", "we", "'", "re", "on", "the", "server", ",", "so", "this", "is", "a", "safe", "cast", "(", "DeploymentConfiguration", ")", "msgContext", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "/", "/", "we", "'", "re", "on", "the", "server", ",", "so", "this", "is", "a", "safe", "cast", "DeploymentConfiguration", "config", "=", "(", "DeploymentConfiguration", ")", "context", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "setAttribute", "(", "WinkConfiguration", ".", "class", ",", "configuration", ")", ";", "/", "/", "for", "legacy", ",", "if", "third", "-", "party", "code", "is", "calling", "getAttribute", "with", "DeploymentConfiguration", ".", "class", "as", "key", "/", "/", "this", "cast", "is", "safe", "because", "we", "'", "re", "on", "the", "server", "return", "(", "DeploymentConfiguration", ")", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "properties", ".", "WinkSystemProperties", ";", "/", "**", "*", "order", "of", "loading", "and", "property", "precedence", ":", "*", "*", "wink", "-", "default", ".", "properties", "*", "file", "referred", "to", "by", "propertiesLocation", "init", "param", "(", "may", "override", "and", "add", "to", "above", "set", "props", ")", "*", "JVM", "system", "properties", "(", "only", "sets", "values", "for", "key", "/", "value", "pairs", "where", "the", "value", "is", "null", "or", "empty", ")", "*", "/", "*", "loadProperties", "will", "try", "to", "load", "the", "properties", "from", "the", "resource", ",", "*", "overriding", "existing", "properties", "in", "defaultProperties", ",", "and", "adding", "*", "new", "ones", ",", "and", "return", "the", "result", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "allowing", "(", "context", ")", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "myConfig", ")", ");", "@", "Override", "public", "void", "tearDown", "(", ")", "{", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "}", "import", "java", ".", "util", ".", "StringTokenizer", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "HttpHeaders", ";", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "void", "testJAXBElementProviderInvocationDTD", "(", ")", "throws", "Exception", "{", "String", "classpath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classpath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "String", "path", "=", "null", ";", "while", "(", "tokenizer", ".", "hasMoreTokens", "(", "))", "{", "path", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "path", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "break", ";", "}", "}", "/", "*", "*", "the", "addition", "of", "the", "DOCTYPE", "tests", "a", "well", "-", "known", "XML", "parser", "exploit", "in", "which", "arbitrary", "server", "*", "filesystem", "files", "can", "be", "read", ".", "See", "JAXBElementXmlProvider", ".", "readFrom", "*", "*", "/", "final", "String", "LOCALSOURCE", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"\"", "+", "path", "+", "\"/", "etc", "/", "JAXBElementProviderTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "feed", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "a9", ".", "com", "/", "-/", "spec", "/", "opensearch", "/", "1", ".", "1", "/", "\\\"", "xmlns", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2005", "/", "Atom", "\\", "\">", "<", "id", ">", "&", "file", ";", "</", "id", ">", "</", "feed", ">", "\";", "MockHttpServletRequest", "request", "=", "MockRequestConstructor", ".", "constructMockRequest", "(", "\"", "POST", "\"", ",", "\"", "/", "jaxbresource", "/", "jaxbelement", "\"", ",", "\"", "text", "/", "xml", "\"", ",", "\"", "text", "/", "xml", "\"", ",", "LOCALSOURCE", ".", "getBytes", "(", "))", ";", "MockHttpServletResponse", "invoke", "=", "invoke", "(", "request", ")", ";", "assertEquals", "(", "400", ",", "invoke", ".", "getStatus", "(", "))", ";", "/", "/", "400", "means", "the", "unmarshaller", "could", "not", "unmarshal", "the", "xml", "/", "/", "let", "'", "s", "make", "sure", "our", "test", "string", "is", "unmarshallable", ",", "just", "for", "a", "good", "sanity", "check", "JAXBContext", "testcontext", "=", "JAXBContext", ".", "newInstance", "(", "AtomFeed", ".", "class", ")", ";", "Unmarshaller", "testunmarshaller", "=", "testcontext", ".", "createUnmarshaller", "(", ");", "JAXBElement", "<", "AtomFeed", ">", "testresponse", "=", "(", "JAXBElement", "<", "AtomFeed", ">", ")", "testunmarshaller", ".", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "LOCALSOURCE", ".", "getBytes", "(", "))", ");", "assertEquals", "(", "\"", "we", "could", "not", "unmarshal", "the", "test", "xml", "\"", ",", "\"", "YOU", "SHOULD", "NOT", "BE", "ABLE", "TO", "SEE", "THIS", "\"", ",", "testresponse", ".", "getValue", "(", ").", "getId", "(", ").", "trim", "(", "))", ";", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "void", "testJAXBElementProviderInvocationDTDWithCharset", "(", ")", "throws", "Exception", "{", "String", "classpath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classpath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "String", "path", "=", "null", ";", "while", "(", "tokenizer", ".", "hasMoreTokens", "(", "))", "{", "path", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "path", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "break", ";", "}", "}", "/", "*", "*", "the", "addition", "of", "the", "DOCTYPE", "tests", "a", "well", "-", "known", "XML", "parser", "exploit", "in", "which", "arbitrary", "server", "*", "filesystem", "files", "can", "be", "read", ".", "See", "JAXBElementXmlProvider", ".", "readFrom", "*", "*", "/", "final", "String", "LOCALSOURCE", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "standalone", "=", "\\\"", "yes", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"\"", "+", "path", "+", "\"/", "etc", "/", "JAXBElementProviderTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "feed", "xmlns", ":", "ns2", "=", "\\\"", "http", ":", "//", "a9", ".", "com", "/", "-/", "spec", "/", "opensearch", "/", "1", ".", "1", "/", "\\\"", "xmlns", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2005", "/", "Atom", "\\", "\">", "<", "id", ">", "&", "file", ";", "</", "id", ">", "</", "feed", ">", "\";", "MockHttpServletRequest", "request", "=", "MockRequestConstructor", ".", "constructMockRequest", "(", "\"", "POST", "\"", ",", "\"", "/", "jaxbresource", "/", "jaxbelement", "\"", ",", "\"", "text", "/", "xml", "\"", ",", "\"", "text", "/", "xml", ";", "charset", "=", "UTF", "-", "8", "\"", ",", "LOCALSOURCE", ".", "getBytes", "(", "))", ";", "MockHttpServletResponse", "invoke", "=", "invoke", "(", "request", ")", ";", "assertEquals", "(", "400", ",", "invoke", ".", "getStatus", "(", "))", ";", "/", "/", "400", "means", "the", "unmarshaller", "could", "not", "unmarshal", "the", "xml", ",", "this", "is", "good", "/", "/", "let", "'", "s", "make", "sure", "our", "test", "string", "is", "unmarshallable", ",", "just", "for", "a", "good", "sanity", "check", "JAXBContext", "testcontext", "=", "JAXBContext", ".", "newInstance", "(", "AtomFeed", ".", "class", ")", ";", "Unmarshaller", "testunmarshaller", "=", "testcontext", ".", "createUnmarshaller", "(", ");", "JAXBElement", "<", "AtomFeed", ">", "testresponse", "=", "(", "JAXBElement", "<", "AtomFeed", ">", ")", "testunmarshaller", ".", "unmarshal", "(", "new", "ByteArrayInputStream", "(", "LOCALSOURCE", ".", "getBytes", "(", "))", ");", "assertEquals", "(", "\"", "we", "could", "not", "unmarshal", "the", "test", "xml", "\"", ",", "\"", "YOU", "SHOULD", "NOT", "BE", "ABLE", "TO", "SEE", "THIS", "\"", ",", "testresponse", ".", "getValue", "(", ").", "getId", "(", ").", "trim", "(", "))", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "apache", ".", "wink", ".", "server", ".", "internal", ".", "providers", ".", "entity", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileWriter", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "StringTokenizer", ";", "import", "java", ".", "util", ".", "Map", ".", "Entry", ";", "import", "javax", ".", "ws", ".", "rs", ".", "POST", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Path", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "import", "org", ".", "apache", ".", "wink", ".", "server", ".", "internal", ".", "servlet", ".", "MockServletInvocationTest", ";", "import", "org", ".", "apache", ".", "wink", ".", "server", ".", "internal", ".", "servlet", ".", "RestServlet", ";", "import", "org", ".", "apache", ".", "wink", ".", "test", ".", "mock", ".", "MockRequestConstructor", ";", "import", "org", ".", "jmock", ".", "Expectations", ";", "import", "org", ".", "jmock", ".", "Mockery", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "MockHttpServletResponse", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "/", "**", "*", "intent", "of", "this", "test", "is", "to", "ensure", "the", "wink", ".", "supportDTDEntityExpansion", "property", "gets", "picked", "up", "from", "wink", "-", "default", ".", "properties", "on", "the", "server", "*", "*", "/", "public", "class", "SourceProviderDTDSupportedTest", "extends", "MockServletInvocationTest", "{", "private", "static", "String", "path", "=", "null", ";", "static", "{", "String", "classpath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classpath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "while", "(", "tokenizer", ".", "hasMoreTokens", "(", "))", "{", "path", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "path", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "break", ";", "}", "}", "}", "private", "static", "final", "String", "SOURCE", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"\"", "+", "path", "+", "\"/", "etc", "/", "SourceProviderTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "message", ">", "&", "file", ";", "</", "message", ">", "\";", "private", "static", "final", "byte", "[", "]", "SOURCE_BYTES", "=", "SOURCE", ".", "getBytes", "(", ");", "private", "File", "propFileDefault", "=", "null", ";", "@", "Override", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "createWinkDefaultPropsFile", "(", ");", "super", ".", "setUp", "(", ");", "Mockery", "mockery", "=", "new", "Mockery", "(", ");", "final", "RuntimeContext", "context", "=", "mockery", ".", "mock", "(", "RuntimeContext", ".", "class", ")", ";", "mockery", ".", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "context", ")", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "}", "})", ";", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "context", ")", ";", "}", "@", "Override", "public", "void", "tearDown", "(", ")", "{", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "deleteWinkDefaultPropsFile", "(", ");", "}", "@", "Override", "protected", "String", "getPropertiesFile", "(", ")", "{", "return", "propFileDefault", ".", "getPath", "(", ");", "}", "@", "Override", "protected", "Class", "<", "?>", "[]", "getClasses", "(", ")", "{", "return", "new", "Class", "<", "?>", "[]", "{", "SourceResource", ".", "class", "}", ";", "}", "@", "Path", "(", "\"", "source", "\"", ")", "public", "static", "class", "SourceResource", "{", "@", "POST", "@", "Path", "(", "\"", "domwithdtd", "\"", ")", "public", "String", "postDomWithDTD", "(", "DOMSource", "source", ")", "throws", "Exception", "{", "/", "*", "*", "we", "don", "'", "t", "want", "to", "trigger", "a", "parse", "in", "this", "resource", "method", ".", "We", "'", "re", "testing", "to", "see", "what", "happened", "*", "with", "the", "SAXSource", "on", "the", "way", "here", ".", "*", "/", "return", "source", ".", "getNode", "(", ").", "getFirstChild", "(", ").", "getNextSibling", "(", ").", "getTextContent", "(", ");", "}", "}", "public", "void", "testDomWithDTDSupported", "(", ")", "throws", "Exception", "{", "final", "byte", "[", "]", "SOURCE_BYTES", "=", "SOURCE", ".", "getBytes", "(", ");", "MockHttpServletRequest", "request", "=", "MockRequestConstructor", ".", "constructMockRequest", "(", "\"", "POST", "\"", ",", "\"", "/", "source", "/", "domwithdtd", "\"", ",", "\"", "application", "/", "xml", "\"", ",", "\"", "application", "/", "xml", "\"", ",", "SOURCE_BYTES", ")", ";", "MockHttpServletResponse", "response", "=", "invoke", "(", "request", ")", ";", "assertEquals", "(", "200", ",", "response", ".", "getStatus", "(", "))", ";", "assertEquals", "(", "\"", "YOU", "SHOULD", "NOT", "BE", "ABLE", "TO", "SEE", "THIS", "\"", ",", "response", ".", "getContentAsString", "(", ").", "trim", "(", "))", ";", "/", "/", "as", "a", "sanity", "check", ",", "let", "'", "s", "make", "sure", "our", "xml", "is", "good", ":", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilder", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "InputSource", "is", "=", "new", "InputSource", "(", "new", "StringReader", "(", "SOURCE", ")", ")", ";", "Document", "d", "=", "builder", ".", "parse", "(", "is", ")", ";", "assertEquals", "(", "\"", "xml", "is", "bad", "\"", ",", "\"", "YOU", "SHOULD", "NOT", "BE", "ABLE", "TO", "SEE", "THIS", "\"", ",", "d", ".", "getElementsByTagName", "(", "\"", "message", "\"", ").", "item", "(", "0", ")", ".", "getTextContent", "(", ").", "trim", "(", "))", ";", "}", "/", "/", "utility", "method", ",", "currently", "only", "for", "use", "by", "testDomWithDTDSupported", "private", "void", "createWinkDefaultPropsFile", "(", ")", "{", "try", "{", "Field", "defaultFileField", "=", "RestServlet", ".", "class", ".", "getDeclaredField", "(", "\"", "PROPERTIES_DEFAULT_FILE", "\"", ");", "defaultFileField", ".", "setAccessible", "(", "true", ")", ";", "String", "filePath", "=", "(", "String", ")", "defaultFileField", ".", "get", "(", "null", ")", ";", "if", "(", "!", "filePath", ".", "startsWith", "(", "\"/", "\")", ")", "{", "filePath", "=", "\"", "/\"", "+", "filePath", ";", "}", "/", "/", "create", "the", "default", "property", "file", "and", "write", "some", "dummy", "properties", "to", "it", "so", "it", "gets", "picked", "up", "by", "RestServlet", "Properties", "propsDefault", "=", "new", "Properties", "(", ");", "propsDefault", ".", "put", "(", "\"", "wink", ".", "supportDTDEntityExpansion", "\"", ",", "\"", "true", "\"", ");", "propFileDefault", "=", "createFileWithProperties", "(", "filePath", ",", "propsDefault", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "fail", "(", "e", ".", "getMessage", "(", "))", ";", "}", "}", "/", "/", "utility", "method", ",", "currently", "only", "for", "use", "by", "createWinkDefaultPropsFile", "private", "File", "createFileWithProperties", "(", "String", "relativeFilePath", ",", "Properties", "props", ")", "throws", "Exception", "{", "/", "/", "set", "up", "the", "default", "properties", "file", "in", "the", "location", "where", "the", "RestServlet", "will", "find", "it", "upon", "test", "execution", "String", "classPath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classPath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "String", "pathToUse", "=", "null", ";", "while", "(", "tokenizer", ".", "hasMoreElements", "(", "))", "{", "String", "temp", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "temp", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "pathToUse", "=", "temp", ";", "break", ";", "}", "}", "if", "(", "pathToUse", "=", "=", "null", ")", "{", "fail", "(", "\"", "failed", "to", "find", "test", "-", "classes", "directory", "to", "use", "for", "temporary", "creation", "of", "\"", "+", "relativeFilePath", ")", ";", "}", "File", "propFile", "=", "new", "File", "(", "pathToUse", "+", "relativeFilePath", ")", ";", "FileWriter", "fileWriter", "=", "new", "FileWriter", "(", "propFile", ")", ";", "for", "(", "Iterator", "<", "Entry", "<", "Object", ",", "Object", ">", ">", "it", "=", "props", ".", "entrySet", "(", ").", "iterator", "(", ");", "it", ".", "hasNext", "(", ");", ")", "{", "Entry", "<", "Object", ",", "Object", ">", "entry", "=", "(", "Entry", "<", "Object", ",", "Object", ">", ")", "it", ".", "next", "(", ");", "fileWriter", ".", "write", "(", "entry", ".", "getKey", "(", ")", "+", "\"", "=\"", "+", "entry", ".", "getValue", "(", "))", ";", "fileWriter", ".", "write", "(", "System", ".", "getProperty", "(", "\"", "line", ".", "separator", "\"", "))", ";", "}", "fileWriter", ".", "flush", "(", ");", "fileWriter", ".", "close", "(", ");", "return", "propFile", ";", "}", "/", "/", "utility", "method", ",", "currently", "only", "for", "use", "by", "testDomWithDTDSupported", "private", "void", "deleteWinkDefaultPropsFile", "(", ")", "{", "if", "(", "!", "propFileDefault", ".", "delete", "(", "))", "{", "fail", "(", "\"", "failed", "to", "delete", "file", "\"", "+", "propFileDefault", ".", "getPath", "(", "))", ";", "}", "propFileDefault", "=", "null", ";", "}", "}", "@", "@", "-", "20", ",", "14", "+", "20", ",", "21", "@", "@", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "util", ".", "StringTokenizer", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "RuntimeContext", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "WinkConfiguration", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "runtime", ".", "RuntimeContextTLS", ";", "import", "org", ".", "jmock", ".", "Expectations", ";", "import", "org", ".", "jmock", ".", "Mockery", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "private", "String", "TEST_CLASSES_PATH", "=", "null", ";", "@", "Override", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "Mockery", "mockery", "=", "new", "Mockery", "(", ");", "final", "RuntimeContext", "context", "=", "mockery", ".", "mock", "(", "RuntimeContext", ".", "class", ")", ";", "mockery", ".", "checking", "(", "new", "Expectations", "(", ")", "{", "{", "allowing", "(", "context", ")", ".", "getAttribute", "(", "WinkConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "null", ")", ");", "}", "})", ";", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "context", ")", ";", "}", "@", "Override", "public", "void", "tearDown", "(", ")", "{", "RuntimeContextTLS", ".", "setRuntimeContext", "(", "null", ")", ";", "}", "private", "String", "getPath", "(", ")", "{", "if", "(", "TEST_CLASSES_PATH", "=", "=", "null", ")", "{", "String", "classpath", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "class", ".", "path", "\"", ");", "StringTokenizer", "tokenizer", "=", "new", "StringTokenizer", "(", "classpath", ",", "System", ".", "getProperty", "(", "\"", "path", ".", "separator", "\"", "))", ";", "TEST_CLASSES_PATH", "=", "null", ";", "while", "(", "tokenizer", ".", "hasMoreTokens", "(", "))", "{", "TEST_CLASSES_PATH", "=", "tokenizer", ".", "nextToken", "(", ");", "if", "(", "TEST_CLASSES_PATH", ".", "endsWith", "(", "\"", "test", "-", "classes", "\"", "))", "{", "break", ";", "}", "}", "/", "/", "for", "windows", ":", "int", "driveIndex", "=", "TEST_CLASSES_PATH", ".", "indexOf", "(", "\":", "\")", ";", "if", "(", "driveIndex", "!", "=", "-", "1", ")", "{", "TEST_CLASSES_PATH", "=", "TEST_CLASSES_PATH", ".", "substring", "(", "driveIndex", "+", "1", ")", ";", "}", "}", "return", "TEST_CLASSES_PATH", ";", "}", "@", "POST", "@", "Path", "(", "\"", "saxwithdtd", "\"", ")", "public", "String", "postSaxWithDTD", "(", "SAXSource", "source", ")", "throws", "Exception", "{", "/", "*", "*", "we", "don", "'", "t", "want", "to", "trigger", "a", "parse", "in", "this", "resource", "method", ".", "We", "'", "re", "testing", "to", "see", "what", "happened", "*", "with", "the", "SAXSource", "on", "the", "way", "here", ".", "*", "/", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "String", "line", ";", "InputStream", "is", "=", "source", ".", "getInputSource", "(", ").", "getByteStream", "(", ");", "try", "{", "BufferedReader", "reader", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "is", ",", "\"", "UTF", "-", "8", "\"", "))", ";", "while", "(", "(", "line", "=", "reader", ".", "readLine", "(", "))", "!", "=", "null", ")", "{", "sb", ".", "append", "(", "line", ")", ".", "append", "(", "\"\\", "n", "\"", ");", "}", "}", "finally", "{", "is", ".", "close", "(", ");", "}", "return", "sb", ".", "toString", "(", ");", "}", "@", "POST", "@", "Path", "(", "\"", "domwithdtd", "\"", ")", "public", "String", "postDomWithDTD", "(", "DOMSource", "source", ")", "throws", "Exception", "{", "/", "*", "*", "we", "don", "'", "t", "want", "to", "trigger", "a", "parse", "in", "this", "resource", "method", ".", "We", "'", "re", "testing", "to", "see", "what", "happened", "*", "with", "the", "SAXSource", "on", "the", "way", "here", ".", "*", "/", "return", "source", ".", "getNode", "(", ").", "getFirstChild", "(", ").", "getFirstChild", "(", ").", "getTextContent", "(", ");", "}", "StringWriter", "sw", "=", "new", "StringWriter", "(", ");", "StreamResult", "sr", "=", "new", "StreamResult", "(", "sw", ")", ";", "return", "sw", ".", "toString", "(", ");", "public", "void", "testSaxWithDTD", "(", ")", "throws", "Exception", "{", "String", "path", "=", "getPath", "(", ");", "final", "String", "SOURCE", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"\"", "+", "path", "+", "\"/", "etc", "/", "SourceProviderTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "message", ">", "&", "file", ";", "</", "message", ">", "\";", "final", "byte", "[", "]", "SOURCE_BYTES", "=", "SOURCE", ".", "getBytes", "(", ");", "MockHttpServletRequest", "request", "=", "MockRequestConstructor", ".", "constructMockRequest", "(", "\"", "POST", "\"", ",", "\"", "/", "source", "/", "saxwithdtd", "\"", ",", "\"", "application", "/", "xml", "\"", ",", "\"", "application", "/", "xml", "\"", ",", "SOURCE_BYTES", ")", ";", "MockHttpServletResponse", "response", "=", "invoke", "(", "request", ")", ";", "assertEquals", "(", "200", ",", "response", ".", "getStatus", "(", "))", ";", "assertFalse", "(", "\"", "File", "content", "is", "visible", "but", "should", "not", "be", ".", "\",", "response", ".", "getContentAsString", "(", ").", "contains", "(", "\"", "YOU", "SHOULD", "NOT", "BE", "ABLE", "TO", "SEE", "THIS", "\"", "))", ";", "assertEquals", "(", "SOURCE", ",", "response", ".", "getContentAsString", "(", ").", "trim", "(", "))", ";", "}", "public", "void", "testDomWithDTD", "(", ")", "throws", "Exception", "{", "String", "path", "=", "getPath", "(", ");", "final", "String", "SOURCE", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"?", ">\"", "\"", "<!", "DOCTYPE", "data", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"\"", "+", "path", "+", "\"/", "etc", "/", "SourceProviderTest", ".", "txt", "\\", "\">", "]>", "\"", "\"", "<", "message", ">", "&", "file", ";", "</", "message", ">", "\";", "final", "byte", "[", "]", "SOURCE_BYTES", "=", "SOURCE", ".", "getBytes", "(", ");", "MockHttpServletRequest", "request", "=", "MockRequestConstructor", ".", "constructMockRequest", "(", "\"", "POST", "\"", ",", "\"", "/", "source", "/", "domwithdtd", "\"", ",", "\"", "application", "/", "xml", "\"", ",", "\"", "application", "/", "xml", "\"", ",", "SOURCE_BYTES", ")", ";", "MockHttpServletResponse", "response", "=", "invoke", "(", "request", ")", ";", "assertEquals", "(", "400", ",", "response", ".", "getStatus", "(", "))", ";", "/", "/", "as", "a", "sanity", "check", ",", "let", "'", "s", "make", "sure", "our", "xml", "is", "good", ":", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "DocumentBuilder", "builder", "=", "factory", ".", "newDocumentBuilder", "(", ");", "InputSource", "is", "=", "new", "InputSource", "(", "new", "StringReader", "(", "SOURCE", ")", ")", ";", "Document", "d", "=", "builder", ".", "parse", "(", "is", ")", ";", "assertEquals", "(", "\"", "xml", "is", "bad", "\"", ",", "\"", "YOU", "SHOULD", "NOT", "BE", "ABLE", "TO", "SEE", "THIS", "\"", ",", "d", ".", "getElementsByTagName", "(", "\"", "message", "\"", ").", "item", "(", "0", ")", ".", "getTextContent", "(", ").", "trim", "(", "))", ";", "}", "YOU", "SHOULD", "NOT", "BE", "ABLE", "TO", "SEE", "THIS", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "YOU", "SHOULD", "NOT", "BE", "ABLE", "TO", "SEE", "THIS", "@", "@", "-", "63", ",", "6", "+", "63", ",", "13", "@", "@", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "dependency", ">", "<", "groupId", ">", "woodstox", "<", "/", "groupId", ">", "<", "artifactId", ">", "wstx", "-", "asl", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "2", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", "></s><", "!-", "-", "users", "can", "specify", "-", "Dlogfile", "=", "/", "full", "/", "path", "/", "to", "/", "logging", ".", "properties", "to", "turn", "on", "ClientConfig", "config", "=", "request", ".", "getAttribute", "(", "ClientConfig", ".", "class", ")", ";", "public", "class", "ClientConfig", "implements", "Cloneable", "{", "private", "int", "connectTimeout", ";", "private", "int", "readTimeout", ";", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ClientConfig", ".", "class", ")", ";", "static", "{", "try", "{", "String", "connectTimeoutString", "=", "System", ".", "getProperty", "(", "WINK_CLIENT_CONNECTTIMEOUT", ")", ";", "if", "(", "connectTimeoutString", "!", "=", "null", ")", "WINK_CLIENT_CONNECTTIMEOUT_DEFAULT", "=", "Integer", ".", "parseInt", "(", "connectTimeoutString", ")", ";", "logger", ".", "debug", "(", "\"", "Wink", "client", "connectTimeout", "default", "value", "is", "{", "}.", "\",", "WINK_CLIENT_CONNECTTIMEOUT_DEFAULT", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "debug", "(", "\"", "Error", "processing", "{", "}", "system", "property", ":", "{", "}\"", ",", "WINK_CLIENT_CONNECTTIMEOUT", ",", "e", ")", ";", "}", "try", "{", "String", "readTimeoutString", "=", "System", ".", "getProperty", "(", "WINK_CLIENT_READTIMEOUT", ")", ";", "if", "(", "readTimeoutString", "!", "=", "null", ")", "WINK_CLIENT_READTIMEOUT_DEFAULT", "=", "Integer", ".", "parseInt", "(", "readTimeoutString", ")", ";", "logger", ".", "debug", "(", "\"", "Wink", "client", "readTimeout", "default", "value", "is", "{", "}.", "\",", "+", "WINK_CLIENT_READTIMEOUT_DEFAULT", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "debug", "(", "\"", "Error", "processing", "{", "}", "system", "property", ":", "{", "}\"", ",", "WINK_CLIENT_READTIMEOUT", ",", "e", ")", ";", "}", "}", "connectTimeout", "=", "WINK_CLIENT_CONNECTTIMEOUT_DEFAULT", ";", "readTimeout", "=", "WINK_CLIENT_READTIMEOUT_DEFAULT", ";", "*", "Get", "the", "connect", "timeout", "in", "milliseconds", "return", "connectTimeout", ";", "*", "Set", "the", "connect", "timeout", "in", "milliseconds", "this", ".", "connectTimeout", "=", "connectTimeout", ";", "*", "Get", "the", "read", "timeout", "in", "milliseconds", "return", "readTimeout", ";", "*", "Set", "the", "read", "timeout", "in", "milliseconds", "this", ".", "readTimeout", "=", "readTimeout", ";", "ClientConfig", "config", "=", "request", ".", "getAttribute", "(", "ClientConfig", ".", "class", ")", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "apache", ".", "wink", ".", "client", ".", "ClientConfig", ";", "import", "org", ".", "apache", ".", "wink", ".", "client", ".", "ClientConfigException", ";", "import", "org", ".", "apache", ".", "wink", ".", "client", ".", "ClientRuntimeException", ";", "import", "org", ".", "apache", ".", "wink", ".", "client", ".", "Resource", ";", "import", "org", ".", "apache", ".", "wink", ".", "client", ".", "RestClient", ";", "return", "new", "DOMSource", "(", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ")", ".", "parse", "(", "entityStream", ")", ");", "throw", "asIOExcpetion", "(", "e", ")", ";", "throw", "asIOExcpetion", "(", "e", ")", ";", "throw", "asIOExcpetion", "(", "e", ")", ";", "private", "static", "IOException", "asIOExcpetion", "(", "Exception", "e", ")", "throws", "IOException", "{", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "XMLInputFactory", "xmif", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLStreamReader", "xsr", "=", "xmif", ".", "createXMLStreamReader", "(", "entityStream", ")", ";", "int", "nextEvent", "=", "xsr", ".", "next", "(", ");", "elementList", ".", "add", "(", "unmarshaller", ".", "unmarshal", "(", "xsr", ")", ");", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "HttpHeaders", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "apache", ".", "wink", ".", "common", ".", "internal", ".", "model", ".", "ModelUtils", ";", "unmarshaledResource", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "entityStream", ")", ",", "classToFill", ")", ";", "ModelUtils", ".", "unmarshal", "(", "unmarshaller", ",", "new", "InputStreamReader", "(", "entityStream", ",", "Charset", ".", "forName", "(", "charset", ")", "))", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "unmarshaledResource", "=", "unmarshaller", ".", "unmarshal", "(", "entityStream", ")", ";", "unmarshaledResource", "=", "unmarshaller", ".", "unmarshal", "(", "new", "StreamSource", "(", "entityStream", ")", ",", "type", ")", ".", "getValue", "(", ");", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "public", "class", "SourceProviderTest", "{", "\"", "<", "arg0", ">", "1", "<", "/", "arg0", ">", "\"", "+", "\"", "<", "arg1", ">", "2", "<", "/", "arg1", ">", "\"", "+", "}", "public", "class", "MyJAXBContextResolver", "implements", "ContextResolver", "<", "JAXBContext", ">", "{", "public", "JAXBContext", "getContext", "(", "Class", "<", "?>", "arg0", ")", "{", "try", "{", "return", "JAXBContext", ".", "newInstance", "(", "arg0", ")", ";", "}", "catch", "(", "JAXBException", "e", ")", "{", "e", ".", "printStackTrace", "(", ");", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", ".", "level", "=", "INFO", "java", ".", "util", ".", "logging", ".", "ConsoleHandler", ".", "level", "=", "ALL", "java", ".", "util", ".", "logging", ".", "FileHandler", ".", "level", "=", "ALL", "public", "class", "DeploymentConfiguration", "{", "msgContext", ".", "getAttribute", "(", "DeploymentConfiguration", ".", "class", ")", ";", "DeploymentConfiguration", "config", "=", "context", ".", "getAttribute", "(", "DeploymentConfiguration", ".", "class", ")", ";", "return", "getAttribute", "(", "DeploymentConfiguration", ".", "class", ")", ";", "import", "org", ".", "apache", ".", "wink", ".", "server", ".", "internal", ".", "properties", ".", "WinkSystemProperties", ";", "*", "loadProperties", "will", "try", "to", "load", "the", "properties", "in", "the", "following", "order", ".", "*", "<", "ol", ">", "*", "<", "li", ">", "Custom", "configuration", "file", "(", "defined", "in", "init", "parameter", ")", "</", "li", ">", "*", "<", "li", ">", "The", "default", "properties", "file", "<", "/", "li", ">", "*", "<", "li", ">", "System", "properties", "(", "reads", "the", "keys", "defined", "in", "the", "properties", "to", "do", "the", "*", "specific", "lookups", "and", "does", "a", "lookup", "for", "properties", "that", "have", "empty", "values", ")", "*", "<", "/", "li", ">", "*", "<", "/", "ol", ">", "allowing", "(", "context", ")", ".", "getAttribute", "(", "DeploymentConfiguration", ".", "class", ")", ";", "will", "(", "returnValue", "(", "myConfig", ")", ");", "ByteArrayOutputStream", "outputStream", "=", "new", "ByteArrayOutputStream", "(", ");", "StreamResult", "sr", "=", "new", "StreamResult", "(", "outputStream", ")", ";", "return", "outputStream", ".", "toString", "(", ");"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["ALSA:", "seq/oss", "-", "Fix", "double-free", "at", "error", "path", "of", "snd_seq_oss_open()", "The", "error", "handling", "in", "snd_seq_oss_open()", "has", "several", "bad", "codes", "that", "do", "dereferecing", "released", "pointers", "and", "double-free", "of", "kmalloc'ed", "data.", "The", "object", "dp", "is", "release", "in", "free_devinfo()", "that", "is", "called", "via", "private_free", "callback.", "The", "rest", "shouldn't", "touch", "this", "object", "any", "more.", "The", "patch", "changes", "delete_port()", "to", "call", "kfree()", "in", "any", "case,", "and", "gets", "rid", "of", "unnecessary", "calls", "of", "destructors", "in", "snd_seq_oss_open().", "Fixes", ".", "Reported-and-tested-by:", "Tavis", "Ormandy", "<taviso@cmpxchg8b.com>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["delete_port", "(", "dp", ")", ";", "if", "(", "dp", "-", ">", "port", "<", "0", ")", "{", "kfree", "(", "dp", ")", ";", "}</s>snd_seq_oss_writeq_delete", "(", "dp", "-", ">", "writeq", ")", ";", "snd_seq_oss_readq_delete", "(", "dp", "-", ">", "readq", ")", ";", "delete_port", "(", "dp", ")", ";", "kfree", "(", "dp", ")", ";", "if", "(", "dp", "-", ">", "port", "<", "0", ")"], "docstring_tokens": ["pointer", "dereferencing"]}
{"contents": ["Fix", "bug", "#72681", "-", "consume", "data", "even", "if", "we're", "not", "storing", "them"], "code_tokens": ["int", "skip", "=", "0", ";", "skip", "=", "0", ";", "skip", "=", "1", ";", "if", "(", "!", "skip", ")", "{", "php_set_session_var", "(", "name", ",", "namelen", ",", "current", ",", "&", "var_hash", "TSRMLS_CC", ")", ";", "}", "if", "(", "!", "skip", ")", "{", "PS_ADD_VARL", "(", "name", ",", "namelen", ")", ";", "}", "int", "skip", "=", "0", ";", "skip", "=", "0", ";", "skip", "=", "1", ";", "if", "(", "!", "skip", ")", "{", "php_set_session_var", "(", "name", ",", "namelen", ",", "current", ",", "&", "var_hash", "TSRMLS_CC", ")", ";", "}", "if", "(", "!", "skip", ")", "{", "PS_ADD_VARL", "(", "name", ",", "namelen", ")", ";", "}", "-", "-", "TEST", "-", "-", "Bug", "#", "72681", ":", "PHP", "Session", "Data", "Injection", "Vulnerability", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "include", "(", "'", "skipif", ".", "inc", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "ini_set", "(", "'", "session", ".", "serialize_handler", "'", ",", "'", "php", "'", ");", "session_start", "(", ");", "$", "_SESSION", "[", "'", "_SESSION", "'", "]", "=", "'", "ryat", "|", "O", ":", "8", ":", "\"", "stdClass", "\"", ":", "0", ":", "{}", "';", "session_write_close", "(", ");", "session_start", "(", ");", "var_dump", "(", "$", "_SESSION", ")", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "array", "(", "0", ")", "{", "}</s>efree", "(", "name", ")", ";", "continue", ";", "php_set_session_var", "(", "name", ",", "namelen", ",", "current", ",", "&", "var_hash", "TSRMLS_CC", ")", ";", "PS_ADD_VARL", "(", "name", ",", "namelen", ")", ";", "goto", "skip", ";", "php_set_session_var", "(", "name", ",", "namelen", ",", "current", ",", "&", "var_hash", "TSRMLS_CC", ")", ";", "PS_ADD_VARL", "(", "name", ",", "namelen", ")", ";"], "docstring_tokens": ["object", "injection"]}
{"contents": ["SOLR-14561", "Followup", "-", "validate", "params", "for", "more", "core", "operations", "(#1629)", "Add", "template", "to", "solr.in", "scripts", "Also", "testes", "Windows", "paths", "Added", "RefGuide", "documentation", "to", "some", "params", "(cherry", "picked", "from", "commit", "49a3f0a11d41f7124b893a08dc9e67594c32e2ee", "and", "adapted", "to", "Java8)"], "code_tokens": ["if", "(", "pathToAssert", "=", "=", "null", ")", "return", ";", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "params", ".", "required", "(", ").", "get", "(", "NAME", ")", ";", "String", "location", "=", "params", ".", "get", "(", "CoreAdminParams", ".", "BACKUP_LOCATION", ")", ";", "core", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "location", "=", "=", "null", "?", "null", ":", "Paths", ".", "get", "(", "location", ")", ");", "SnapShooter", "snapShooter", "=", "new", "SnapShooter", "(", "core", ",", "location", ",", "params", ".", "get", "(", "NAME", ")", ");", "/", "/", "If", "location", "is", "not", "provided", "then", "assume", "that", "the", "restore", "index", "is", "present", "inside", "the", "data", "directory", ".", "if", "(", "location", "=", "=", "null", ")", "{", "location", "=", "core", ".", "getDataDir", "(", ");", "}", "if", "(", "\"", "file", "\"", ".", "equals", "(", "repo", ".", "createURI", "(", "\"", "x", "\"", ").", "getScheme", "(", "))", ")", "{", "core", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "Paths", ".", "get", "(", "location", ")", ");", "if", "(", "\"", "file", "\"", ".", "equals", "(", "repo", ".", "createURI", "(", "\"", "x", "\"", ").", "getScheme", "(", "))", ")", "{", "core", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "Paths", ".", "get", "(", "location", ")", ");", "}", "/", "/", "small", "race", "here", "before", "the", "commit", "point", "is", "saved", "if", "(", "\"", "file", "\"", ".", "equals", "(", "location", ".", "getScheme", "(", "))", ")", "{", "solrCore", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "Paths", ".", "get", "(", "location", ")", ");", "}", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "*;", "/", "/", "Validate", "each", "'", "indexDir", "'", "input", "as", "valid", "Arrays", ".", "stream", "(", "dirNames", ")", ".", "forEach", "(", "indexDir", "-", ">", "core", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "Paths", ".", "get", "(", "indexDir", ")", "))", ";", "final", "Path", "location", "=", "FilterPath", ".", "unwrap", "(", "createTempDir", "(", "))", ".", "toRealPath", "(", ");", "/", "/", "Allow", "non", "-", "standard", "location", "outside", "SOLR_HOME", "jettys", ".", "forEach", "(", "j", "-", ">", "j", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "location", ")", ");", "import", "org", ".", "junit", ".", "AfterClass", ";", "System", ".", "setProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ",", "\"", "*\"", ");", "}", "@", "AfterClass", "public", "static", "void", "afterClass", "(", ")", "throws", "Exception", "{", "System", ".", "clearProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ");", "System", ".", "setProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ",", "\"", "*\"", ");", "System", ".", "clearProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ");", "System", ".", "setProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ",", "\"", "*\"", ");", "System", ".", "clearProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ");", "import", "org", ".", "apache", ".", "lucene", ".", "index", ".", "IndexCommit", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "Arrays", ";", "public", "class", "TestCoreBackup", "extends", "SolrTestCaseJ4", "{", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "Paths", ".", "get", "(", "location", ")", ");", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "backupDir", ".", "toPath", "(", "))", ";", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "backupDir", ".", "toPath", "(", "))", ";", "masterJetty", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "backupDir", ".", "toPath", "(", "))", ";", "masterJetty", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "Paths", ".", "get", "(", "location", ")", ");", "/", "/", "Allow", "core", "to", "be", "created", "outside", "SOLR_HOME", "public", "void", "testBackupFailsMissingAllowPaths", "(", ")", "throws", "Exception", "{", "final", "String", "params", "=", "\"", "&", "location", "=", "\"", "+", "URLEncoder", ".", "encode", "(", "createTempDir", "(", ").", "toFile", "(", ").", "getAbsolutePath", "(", "),", "\"", "UTF", "-", "8", "\"", ");", "Throwable", "t", "=", "expectThrows", "(", "IOException", ".", "class", ",", "(", ")", "-", ">", "{", "TestReplicationHandlerBackup", ".", "runBackupCommand", "(", "masterJetty", ",", "ReplicationHandler", ".", "CMD_BACKUP", ",", "params", ")", ";", "}", ");", "/", "/", "The", "backup", "command", "will", "fail", "since", "the", "tmp", "dir", "is", "outside", "allowPaths", "assertTrue", "(", "t", ".", "getMessage", "(", ").", "contains", "(", "\"", "Server", "returned", "HTTP", "response", "code", ":", "400", "\"", "))", ";", "}", "masterJetty", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "Paths", ".", "get", "(", "location", ")", ");", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "cluster", ".", "getJettySolrRunners", "(", ").", "forEach", "(", "j", "-", ">", "j", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "Paths", ".", "get", "(", "tempDir", ")", "))", ";", "import", "com", ".", "carrotsearch", ".", "randomizedtesting", ".", "rules", ".", "SystemPropertiesRestoreRule", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "workDir", ".", "toPath", "(", "))", ";", "*", "`", "repository", "`", ":", "The", "name", "of", "the", "backup", "repository", "to", "use", ".", "When", "not", "specified", ",", "it", "defaults", "to", "local", "file", "system", ".", "*", "`", "location", "`", ":", "Backup", "location", ".", "Value", "depends", "on", "the", "repository", "in", "use", ".", "For", "file", "system", "repository", ",", "location", "defaults", "to", "core", "'", "s", "dataDir", ",", "and", "if", "specified", ",", "it", "needs", "to", "be", "within", "`", "SOLR_HOME", "`", ",", "`", "SOLR_DATA_HOME", "`", "or", "the", "paths", "specified", "by", "solr", ".", "xml", "`", "allowPaths", "`", ".", "`", "restore", "`", "::", "Restore", "a", "backup", "from", "a", "backup", "repository", ".", "[", "source", ",", "bash", "]", "http", ":", "//", "_master_host", ":", "port_", "/", "solr", "/", "_core_name_", "/", "replication", "?", "command", "=", "restore", "This", "command", "is", "used", "to", "restore", "a", "backup", ".", "There", "are", "several", "supported", "request", "parameters", ":", "*", "`", "name", "`", ":", "(", "optional", ")", "Backup", "name", ".", "The", "name", "of", "the", "backed", "up", "index", "snapshot", "to", "be", "restored", ".", "If", "the", "name", "is", "not", "provided", ",", "it", "looks", "for", "backups", "with", "snapshot", ".", "<", "timestamp", ">", "format", "in", "the", "location", "directory", ".", "It", "picks", "the", "latest", "timestamp", "backup", "in", "that", "case", ".", "*", "`", "repository", "`", ":", "The", "name", "of", "the", "backup", "repository", "where", "the", "backup", "resides", ".", "When", "not", "specified", ",", "it", "defaults", "to", "local", "file", "system", ".", "*", "`", "location", "`", ":", "Backup", "location", ".", "Value", "depends", "on", "the", "repository", "in", "use", ".", "For", "file", "system", "repository", ",", "location", "defaults", "to", "core", "'", "s", "dataDir", ",", "and", "if", "specified", ",", "it", "needs", "to", "be", "within", "`", "SOLR_HOME", "`", ",", "`", "SOLR_DATA_HOME", "`", "or", "the", "paths", "specified", "by", "solr", ".", "xml", "`", "allowPaths", "`", ".", "`", "restorestatus", "`", "::", "Check", "the", "status", "of", "a", "running", "restore", "operation", ".", "[", "source", ",", "bash", "]", "http", ":", "//", "_master_host", ":", "port_", "/", "solr", "/", "_core_name_", "/", "replication", "?", "command", "=", "restorestatus", "This", "command", "is", "used", "to", "check", "the", "status", "of", "a", "restore", "operation", ".", "This", "command", "takes", "no", "parameters", ".", "The", "status", "value", "can", "be", "\"", "In", "Progress", "\"", ",", "\"", "success", "\"", "or", "\"", "failed", "\"", ".", "If", "it", "failed", "then", "an", "\"", "exception", "\"", "will", "also", "be", "sent", "in", "the", "response", ".", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "dataDir1", ".", "toPath", "(", "))", ";", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "dataDir2", ".", "toPath", "(", "))", ";", "\"", "<", "str", "name", "=", "\\\"", "allowPaths", "\\", "\">", "${", "solr", ".", "allowPaths", ":", "}<", "/", "str", ">", "\\", "n", "\"</s>String", "name", "=", "params", ".", "required", "(", ").", "get", "(", "NAME", ")", ";", "SnapShooter", "snapShooter", "=", "new", "SnapShooter", "(", "core", ",", "params", ".", "get", "(", "CoreAdminParams", ".", "BACKUP_LOCATION", ")", ",", "params", ".", "get", "(", "NAME", ")", ");", "/", "/", "If", "location", "is", "not", "provided", "then", "assume", "that", "the", "restore", "index", "is", "present", "inside", "the", "data", "directory", ".", "if", "(", "location", "=", "=", "null", ")", "{", "location", "=", "core", ".", "getDataDir", "(", ");", "/", "/", "small", "race", "here", "before", "the", "commit", "point", "is", "saved", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "Path", "location", "=", "createTempDir", "(", ");", "location", "=", "FilterPath", ".", "unwrap", "(", "location", ")", ".", "toRealPath", "(", ");", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "org", ".", "apache", ".", "lucene", ".", "index", ".", "IndexCommit", ";", "public", "class", "TestCoreBackup", "extends", "SolrTestCaseJ4", "{", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "com", ".", "carrotsearch", ".", "randomizedtesting", ".", "rules", ".", "SystemPropertiesRestoreRule", ";", "*", "`", "location", "`", ":", "Backup", "location", "."], "docstring_tokens": ["input", "validation"]}
{"contents": ["tty:", "n_hdlc:", "get", "rid", "of", "racy", "n_hdlc.tbuf", "Currently", "N_HDLC", "line", "discipline", "uses", "a", "self-made", "singly", "linked", "list", "for", "data", "buffers", "and", "has", "n_hdlc.tbuf", "pointer", "for", "buffer", "retransmitting", "after", "an", "error.", "The", "commit", "be10eb7589337e5defbe214dae038a53dd21add8", "(\"tty:", "n_hdlc", "add", "buffer", "flushing\")", "introduced", "racy", "access", "to", "n_hdlc.tbuf.", "After", "tx", "error", "concurrent", "flush_tx_queue()", "and", "n_hdlc_send_frames()", "can", "put", "one", "data", "buffer", "to", "tx_free_buf_list", "twice.", "That", "causes", "double", "free", "in", "n_hdlc_release().", "Let's", "use", "standard", "kernel", "linked", "list", "and", "get", "rid", "of", "n_hdlc.tbuf:", "in", "case", "of", "tx", "error", "put", "current", "data", "buffer", "after", "the", "head", "of", "tx_buf_list.", "Signed-off-by:", "Alexander", "Popov", "<alex.popov@linux.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["struct", "list_head", "list_item", ";", "struct", "list_head", "list", ";", "static", "void", "n_hdlc_buf_return", "(", "struct", "n_hdlc_buf_list", "*", "buf_list", ",", "struct", "n_hdlc_buf", "*", "buf", ")", ";", "tbuf", "=", "n_hdlc_buf_get", "(", "&", "n_hdlc", "-", ">", "tx_buf_list", ")", ";", "n_hdlc_buf_return", "(", "&", "n_hdlc", "-", ">", "tx_buf_list", ",", "tbuf", ")", ";", "/", "*", "*", "the", "buffer", "was", "not", "accepted", "by", "driver", ",", "*", "return", "it", "back", "into", "tx", "queue", "*", "/", "n_hdlc_buf_return", "(", "&", "n_hdlc", "-", ">", "tx_buf_list", ",", "tbuf", ")", ";", "struct", "n_hdlc_buf", "*", "buf", "=", "NULL", ";", "buf", "=", "list_first_entry_or_null", "(", "&", "n_hdlc", "-", ">", "rx_buf_list", ".", "list", ",", "struct", "n_hdlc_buf", ",", "list_item", ")", ";", "if", "(", "buf", ")", "count", "=", "buf", "-", ">", "count", ";", "buf", "=", "list_first_entry_or_null", "(", "&", "n_hdlc", "-", ">", "tx_buf_list", ".", "list", ",", "struct", "n_hdlc_buf", ",", "list_item", ")", ";", "if", "(", "buf", ")", "count", "+", "=", "buf", "-", ">", "count", ";", "if", "(", "!", "list_empty", "(", "&", "n_hdlc", "-", ">", "rx_buf_list", ".", "list", ")", ")", "!", "list_empty", "(", "&", "n_hdlc", "-", ">", "tx_free_buf_list", ".", "list", ")", ")", "INIT_LIST_HEAD", "(", "&", "n_hdlc", "-", ">", "rx_free_buf_list", ".", "list", ")", ";", "INIT_LIST_HEAD", "(", "&", "n_hdlc", "-", ">", "tx_free_buf_list", ".", "list", ")", ";", "INIT_LIST_HEAD", "(", "&", "n_hdlc", "-", ">", "rx_buf_list", ".", "list", ")", ";", "INIT_LIST_HEAD", "(", "&", "n_hdlc", "-", ">", "tx_buf_list", ".", "list", ")", ";", "/", "**", "*", "n_hdlc_buf_return", "-", "put", "the", "HDLC", "buffer", "after", "the", "head", "of", "the", "specified", "list", "*", "@", "buf_list", "-", "pointer", "to", "the", "buffer", "list", "*", "@", "buf", "-", "pointer", "to", "the", "buffer", "*", "/", "static", "void", "n_hdlc_buf_return", "(", "struct", "n_hdlc_buf_list", "*", "buf_list", ",", "struct", "n_hdlc_buf", "*", "buf", ")", "{", "unsigned", "long", "flags", ";", "spin_lock_irqsave", "(", "&", "buf_list", "-", ">", "spinlock", ",", "flags", ")", ";", "list_add", "(", "&", "buf", "-", ">", "list_item", ",", "&", "buf_list", "-", ">", "list", ")", ";", "buf_list", "-", ">", "count", "+", "+;", "spin_unlock_irqrestore", "(", "&", "buf_list", "-", ">", "spinlock", ",", "flags", ")", ";", "}", "*", "@", "buf_list", "-", "pointer", "to", "buffer", "list", "static", "void", "n_hdlc_buf_put", "(", "struct", "n_hdlc_buf_list", "*", "buf_list", ",", "spin_lock_irqsave", "(", "&", "buf_list", "-", ">", "spinlock", ",", "flags", ")", ";", "list_add_tail", "(", "&", "buf", "-", ">", "list_item", ",", "&", "buf_list", "-", ">", "list", ")", ";", "buf_list", "-", ">", "count", "+", "+;", "spin_unlock_irqrestore", "(", "&", "buf_list", "-", ">", "spinlock", ",", "flags", ")", ";", "*", "@", "buf_list", "-", "pointer", "to", "HDLC", "buffer", "list", "static", "struct", "n_hdlc_buf", "*", "n_hdlc_buf_get", "(", "struct", "n_hdlc_buf_list", "*", "buf_list", ")", "spin_lock_irqsave", "(", "&", "buf_list", "-", ">", "spinlock", ",", "flags", ")", ";", "buf", "=", "list_first_entry_or_null", "(", "&", "buf_list", "-", ">", "list", ",", "struct", "n_hdlc_buf", ",", "list_item", ")", ";", "list_del", "(", "&", "buf", "-", ">", "list_item", ")", ";", "buf_list", "-", ">", "count", "-", "-;", "spin_unlock_irqrestore", "(", "&", "buf_list", "-", ">", "spinlock", ",", "flags", ")", ";</s>struct", "n_hdlc_buf", "*", "link", ";", "struct", "n_hdlc_buf", "*", "head", ";", "struct", "n_hdlc_buf", "*", "tail", ";", "*", "@", "tbuf", "-", "currently", "transmitting", "tx", "buffer", "struct", "n_hdlc_buf", "*", "tbuf", ";", "unsigned", "long", "flags", ";", "spin_lock_irqsave", "(", "&", "n_hdlc", "-", ">", "tx_buf_list", ".", "spinlock", ",", "flags", ")", ";", "if", "(", "n_hdlc", "-", ">", "tbuf", ")", "{", "n_hdlc_buf_put", "(", "&", "n_hdlc", "-", ">", "tx_free_buf_list", ",", "n_hdlc", "-", ">", "tbuf", ")", ";", "n_hdlc", "-", ">", "tbuf", "=", "NULL", ";", "}", "spin_unlock_irqrestore", "(", "&", "n_hdlc", "-", ">", "tx_buf_list", ".", "spinlock", ",", "flags", ")", ";", "kfree", "(", "n_hdlc", "-", ">", "tbuf", ")", ";", "/", "*", "get", "current", "transmit", "buffer", "or", "get", "new", "transmit", "*", "/", "/", "*", "buffer", "from", "list", "of", "pending", "transmit", "buffers", "*", "/", "tbuf", "=", "n_hdlc", "-", ">", "tbuf", ";", "if", "(", "!", "tbuf", ")", "tbuf", "=", "n_hdlc_buf_get", "(", "&", "n_hdlc", "-", ">", "tx_buf_list", ")", ";", "n_hdlc", "-", ">", "tbuf", "=", "tbuf", ";", "/", "*", "this", "tx", "buffer", "is", "done", "*", "/", "n_hdlc", "-", ">", "tbuf", "=", "NULL", ";", "/", "*", "buffer", "not", "accepted", "by", "driver", "*", "/", "/", "*", "set", "this", "buffer", "as", "pending", "buffer", "*", "/", "n_hdlc", "-", ">", "tbuf", "=", "tbuf", ";", "if", "(", "n_hdlc", "-", ">", "rx_buf_list", ".", "head", ")", "count", "=", "n_hdlc", "-", ">", "rx_buf_list", ".", "head", "-", ">", "count", ";", "if", "(", "n_hdlc", "-", ">", "tx_buf_list", ".", "head", ")", "count", "+", "=", "n_hdlc", "-", ">", "tx_buf_list", ".", "head", "-", ">", "count", ";", "if", "(", "n_hdlc", "-", ">", "rx_buf_list", ".", "head", ")", "n_hdlc", "-", ">", "tx_free_buf_list", ".", "head", ")", "*", "@", "list", "-", "pointer", "to", "buffer", "list", "static", "void", "n_hdlc_buf_put", "(", "struct", "n_hdlc_buf_list", "*", "list", ",", "spin_lock_irqsave", "(", "&", "list", "-", ">", "spinlock", ",", "flags", ")", ";", "buf", "-", ">", "link", "=", "NULL", ";", "if", "(", "list", "-", ">", "tail", ")", "list", "-", ">", "tail", "-", ">", "link", "=", "buf", ";", "else", "list", "-", ">", "head", "=", "buf", ";", "list", "-", ">", "tail", "=", "buf", ";", "(", "list", "-", ">", "count", ")", "++", ";", "spin_unlock_irqrestore", "(", "&", "list", "-", ">", "spinlock", ",", "flags", ")", ";", "*", "@", "list", "-", "pointer", "to", "HDLC", "buffer", "list", "static", "struct", "n_hdlc_buf", "*", "n_hdlc_buf_get", "(", "struct", "n_hdlc_buf_list", "*", "list", ")", "spin_lock_irqsave", "(", "&", "list", "-", ">", "spinlock", ",", "flags", ")", ";", "buf", "=", "list", "-", ">", "head", ";", "list", "-", ">", "head", "=", "buf", "-", ">", "link", ";", "(", "list", "-", ">", "count", ")", "--", ";", "if", "(", "!", "list", "-", ">", "head", ")", "list", "-", ">", "tail", "=", "NULL", ";", "spin_unlock_irqrestore", "(", "&", "list", "-", ">", "spinlock", ",", "flags", ")", ";"], "docstring_tokens": ["race", "condition"]}
{"contents": ["Fixed", "bug", "#69090", "(check", "cached", "files", "permissions)"], "code_tokens": [".", "Fixed", "bug", "#", "69090", "(", "check", "cached", "files", "permissions", ")", "opcache", ".", "validate_permission", "(", "default", "\"", "0", "\"", ")", "Leads", "OPcache", "to", "check", "file", "readability", "on", "each", "access", "to", "cached", "file", ".", "This", "directive", "should", "be", "enabled", "in", "shared", "hosting", "environment", ",", "when", "few", "users", "(", "PHP", "-", "FPM", "pools", ")", "reuse", "the", "common", "OPcache", "shared", "memory", ".", "opcache", ".", "validate_root", "(", "default", "\"", "0", "\"", ")", "This", "directive", "prevents", "file", "name", "collisions", "in", "different", "\"", "chroot", "\"", "environments", ".", "It", "should", "be", "enabled", "for", "sites", "that", "may", "serve", "requests", "in", "different", "\"", "chroot", "\"", "environments", ".", "/", "*", "Revalidate", "acessibility", "of", "cached", "file", "*", "/", "if", "(", "EXPECTED", "(", "persistent_script", "!", "=", "NULL", ")", "&", "&", "UNEXPECTED", "(", "ZCG", "(", "accel_directives", ")", ".", "validate_permission", ")", "&", "&", "file_handle", "-", ">", "type", "=", "=", "ZEND_HANDLE_FILENAME", "&", "&", "UNEXPECTED", "(", "access", "(", "file_handle", "-", ">", "filename", ",", "R_OK", ")", "!", "=", "0", ")", ")", "{", "if", "(", "type", "=", "=", "ZEND_REQUIRE", ")", "{", "#", "if", "ZEND_EXTENSION_API_NO", "<", "PHP_5_3_X_API_NO", "zend_message_dispatcher", "(", "ZMSG_FAILED_REQUIRE_FOPEN", ",", "file_handle", "-", ">", "filename", ")", ";", "#", "else", "zend_message_dispatcher", "(", "ZMSG_FAILED_REQUIRE_FOPEN", ",", "file_handle", "-", ">", "filename", "TSRMLS_CC", ")", ";", "#", "endif", "zend_bailout", "(", ");", "}", "else", "{", "#", "if", "ZEND_EXTENSION_API_NO", "<", "PHP_5_3_X_API_NO", "zend_message_dispatcher", "(", "ZMSG_FAILED_INCLUDE_FOPEN", ",", "file_handle", "-", ">", "filename", ")", ";", "#", "else", "zend_message_dispatcher", "(", "ZMSG_FAILED_INCLUDE_FOPEN", ",", "file_handle", "-", ">", "filename", "TSRMLS_CC", ")", ";", "#", "endif", "}", "return", "NULL", ";", "}", "#", "ifndef", "ZEND_WIN32", "if", "(", "ZCG", "(", "accel_directives", ")", ".", "validate_root", ")", "{", "struct", "stat", "buf", ";", "if", "(", "stat", "(", "\"/", "\",", "&", "buf", ")", "!", "=", "0", ")", "{", "ZCG", "(", "root_hash", ")", "=", "0", ";", "}", "else", "{", "unsigned", "long", "x", "=", "buf", ".", "st_ino", ";", "#", "if", "SIZEOF_LONG", "=", "=", "4", "x", "=", "(", "(", "x", ">", ">", "16", ")", "^", "x", ")", "*", "0x45d9f3b", ";", "x", "=", "(", "(", "x", ">", ">", "16", ")", "^", "x", ")", "*", "0x45d9f3b", ";", "x", "=", "(", "x", ">", ">", "16", ")", "^", "x", ";", "#", "elif", "SIZEOF_LONG", "=", "=", "8", "x", "=", "(", "x", "^", "(", "x", ">", ">", "30", ")", ")", "*", "0xbf58476d1ce4e5b9", ";", "x", "=", "(", "x", "^", "(", "x", ">", ">", "27", ")", ")", "*", "0x94d049bb133111eb", ";", "x", "=", "x", "^", "(", "x", ">", ">", "31", ")", ";", "#", "endif", "ZCG", "(", "root_hash", ")", "=", "x", ";", "}", "}", "else", "{", "ZCG", "(", "root_hash", ")", "=", "0", ";", "}", "#", "endif", "zend_bool", "validate_permission", ";", "zend_bool", "validate_root", ";", "#", "ifndef", "ZEND_WIN32", "unsigned", "long", "root_hash", ";", "#", "endif", "#", "ifndef", "ZEND_WIN32", "hash_value", "^", "=", "ZCG", "(", "root_hash", ")", ";", "#", "endif", "#", "ifndef", "ZEND_WIN32", "hash_value", "^", "=", "ZCG", "(", "root_hash", ")", ";", "#", "endif", "#", "ifndef", "ZEND_WIN32", "hash_value", "^", "=", "ZCG", "(", "root_hash", ")", ";", "#", "endif", "#", "ifndef", "ZEND_WIN32", "hash_value", "^", "=", "ZCG", "(", "root_hash", ")", ";", "#", "endif", "STD_PHP_INI_BOOLEAN", "(", "\"", "opcache", ".", "validate_permission", "\"", ",", "\"", "0", "\"", ",", "PHP_INI_SYSTEM", ",", "OnUpdateBool", ",", "accel_directives", ".", "validate_permission", ",", "zend_accel_globals", ",", "accel_globals", ")", "STD_PHP_INI_BOOLEAN", "(", "\"", "opcache", ".", "validate_root", "\"", ",", "\"", "0", "\"", ",", "PHP_INI_SYSTEM", ",", "OnUpdateBool", ",", "accel_directives", ".", "validate_root", ",", "zend_accel_globals", ",", "accel_globals", ")", "add_assoc_bool", "(", "directives", ",", "\"", "opcache", ".", "validate_permission", "\"", ",", "ZCG", "(", "accel_directives", ")", ".", "validate_permission", ")", ";", "add_assoc_bool", "(", "directives", ",", "\"", "opcache", ".", "validate_root", "\"", ",", "ZCG", "(", "accel_directives", ")", ".", "validate_root", ")", ";</s>-", "Opcache", ":", "-", "OpenSSL"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["ext4:", "Add", "sanity", "checks", "for", "the", "superblock", "before", "mounting", "the", "filesystem", "This", "avoids", "insane", "superblock", "configurations", "that", "could", "lead", "to", "kernel", "oops", "due", "to", "null", "pointer", "derefences.", "http://bugzilla.kernel.org/show_bug.cgi?id=12371", "Thanks", "to", "David", "Maciejak", "at", "Fortinet's", "FortiGuard", "Global", "Security", "Research", "Team", "who", "discovered", "this", "bug", "independently", "(but", "at", "approximately", "the", "same", "time)", "as", "Thiemo", "Nagel,", "who", "submitted", "the", "patch.", "Signed-off-by:", "Thiemo", "Nagel", "<thiemo.nagel@ph.tum.de>", "Signed-off-by:", "\"Theodore", "Ts'o\"", "<tytso@mit.edu>", "Cc:", "stable@kernel.org"], "code_tokens": ["unsigned", "int", "db_count", ";", "unsigned", "int", "i", ";", "/", "*", "*", "It", "makes", "no", "sense", "for", "the", "first", "data", "block", "to", "be", "beyond", "the", "end", "*", "of", "the", "filesystem", ".", "*", "/", "if", "(", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", ">", "=", "ext4_blocks_count", "(", "es", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "EXT4", "-", "fs", ":", "bad", "geometry", ":", "first", "data", "\"", "\"", "block", "%", "u", "is", "beyond", "end", "of", "filesystem", "(", "%", "llu", ")", "\\", "n", "\"", ",", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", ",", "ext4_blocks_count", "(", "es", ")", ");", "if", "(", "blocks_count", ">", "(", "(", "uint64_t", ")", "1", "<", "<", "32", ")", "-", "EXT4_DESC_PER_BLOCK", "(", "sb", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "EXT4", "-", "fs", ":", "groups", "count", "too", "large", ":", "%", "u", "\"", "\"", "(", "block", "count", "%", "llu", ",", "first", "data", "block", "%", "u", ",", "\"", "\"", "blocks", "per", "group", "%", "lu", ")", "\\", "n", "\"", ",", "sbi", "-", ">", "s_groups_count", ",", "ext4_blocks_count", "(", "es", ")", ",", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", ",", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", ");", "goto", "failed_mount", ";", "}</s>int", "db_count", ";", "int", "i", ";", "/", "*", "ensure", "blocks_count", "calculation", "below", "doesn", "'", "t", "sign", "-", "extend", "*", "/", "if", "(", "ext4_blocks_count", "(", "es", ")", "+", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", "<", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", "+", "1", ")", "{", "printk", "(", "KERN_WARNING", "\"", "EXT4", "-", "fs", ":", "bad", "geometry", ":", "block", "count", "%", "llu", ",", "\"", "\"", "first", "data", "block", "%", "u", ",", "blocks", "per", "group", "%", "lu", "\\", "n", "\"", ",", "ext4_blocks_count", "(", "es", ")", ",", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", ",", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", ");"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["added", "randomizer", "to", "DSA", "signature", "generation"], "code_tokens": ["/", "/", "the", "randomizer", "is", "to", "conceal", "timing", "information", "related", "to", "k", "and", "x", ".", "BigInteger", "r", "=", "params", ".", "getG", "(", ").", "modPow", "(", "k", ".", "add", "(", "getRandomizer", "(", "q", ",", "random", ")", "),", "params", ".", "getP", "(", "))", ".", "mod", "(", "q", ")", ";", "private", "BigInteger", "getRandomizer", "(", "BigInteger", "q", ",", "SecureRandom", "provided", ")", "{", "/", "/", "Calculate", "a", "random", "multiple", "of", "q", "to", "add", "to", "k", ".", "Note", "that", "g", "^", "q", "=", "1", "(", "mod", "p", ")", ",", "so", "adding", "multiple", "of", "q", "to", "k", "does", "not", "change", "r", ".", "int", "randomBits", "=", "7", ";", "return", "new", "BigInteger", "(", "randomBits", ",", "provided", "!", "=", "null", "?", "provided", ":", "new", "SecureRandom", "(", "))", ".", "add", "(", "BigInteger", ".", "valueOf", "(", "128", ")", ").", "multiply", "(", "q", ")", ";", "}", "new", "FixedSecureRandom", ".", "Source", "[", "]", "{", "new", "FixedSecureRandom", ".", "Data", "(", "keyData", ")", ",", "new", "FixedSecureRandom", ".", "Data", "(", "keyData", ")", ",", "new", "FixedSecureRandom", ".", "Data", "(", "Hex", ".", "decode", "(", "\"", "01020304", "\"", "))", "})", ";", "SecureRandom", "k", "=", "new", "FixedSecureRandom", "(", "new", "FixedSecureRandom", ".", "Source", "[", "]", "{", "new", "FixedSecureRandom", ".", "BigInteger", "(", "BigIntegers", ".", "asUnsignedByteArray", "(", "new", "BigInteger", "(", "\"", "72546832179840998877302529996971396893172522460793442785601695562409154906335", "\"", "))", "),", "new", "FixedSecureRandom", ".", "Data", "(", "Hex", ".", "decode", "(", "\"", "01020304", "\"", "))", "}", ");", "signer", ".", "init", "(", "true", ",", "new", "ParametersWithRandom", "(", "kp", ".", "getPrivate", "(", "),", "new", "FixedSecureRandom", "(", "new", "FixedSecureRandom", ".", "Source", "[", "]", "{", "new", "FixedSecureRandom", ".", "BigInteger", "(", "\"", "349C55648DCF992F3F33E8026CFAC87C1D2BA075", "\"", "),", "new", "FixedSecureRandom", ".", "Data", "(", "Hex", ".", "decode", "(", "\"", "01020304", "\"", "))", "}", "))", ");", "signer", ".", "init", "(", "true", ",", "new", "ParametersWithRandom", "(", "kp", ".", "getPrivate", "(", "),", "new", "FixedSecureRandom", "(", "new", "FixedSecureRandom", ".", "Source", "[", "]", "{", "new", "FixedSecureRandom", ".", "BigInteger", "(", "Hex", ".", "decode", "(", "\"", "735959CC4463B8B440E407EECA8A473BF6A6D1FE657546F67D401F05", "\"", "))", ",", "new", "FixedSecureRandom", ".", "Data", "(", "Hex", ".", "decode", "(", "\"", "01020304", "\"", "))", "}", "))", ");", "signer", ".", "init", "(", "true", ",", "new", "ParametersWithRandom", "(", "kp", ".", "getPrivate", "(", "),", "new", "FixedSecureRandom", "(", "new", "FixedSecureRandom", ".", "Source", "[", "]", "{", "new", "FixedSecureRandom", ".", "BigInteger", "(", "Hex", ".", "decode", "(", "\"", "0CAF2EF547EC49C4F3A6FE6DF4223A174D01F2C115D49A6F73437C29A2A8458C", "\"", "))", ",", "new", "FixedSecureRandom", ".", "Data", "(", "Hex", ".", "decode", "(", "\"", "01020304", "\"", "))", "}", "))", ");", "signer", ".", "init", "(", "true", ",", "new", "ParametersWithRandom", "(", "kp", ".", "getPrivate", "(", "),", "new", "FixedSecureRandom", "(", "new", "FixedSecureRandom", ".", "Source", "[", "]", "{", "new", "FixedSecureRandom", ".", "BigInteger", "(", "\"", "A6902C1E6E3943C5628061588A8B007BCCEA91DBF12915483F04B24AB0678BEE", "\"", "),", "new", "FixedSecureRandom", ".", "Data", "(", "Hex", ".", "decode", "(", "\"", "01020304", "\"", "))", "}", "))", ");", "SecureRandom", "k", "=", "new", "FixedSecureRandom", "(", "new", "FixedSecureRandom", ".", "Source", "[", "]", "{", "new", "FixedSecureRandom", ".", "BigInteger", "(", "BigIntegers", ".", "asUnsignedByteArray", "(", "new", "BigInteger", "(", "\"", "72546832179840998877302529996971396893172522460793442785601695562409154906335", "\"", "))", "),", "new", "FixedSecureRandom", ".", "Data", "(", "Hex", ".", "decode", "(", "\"", "01020304", "\"", "))", "}", ");</s>BigInteger", "r", "=", "params", ".", "getG", "(", ").", "modPow", "(", "k", ",", "params", ".", "getP", "(", "))", ".", "mod", "(", "q", ")", ";", "new", "FixedSecureRandom", ".", "Source", "[", "]", "{", "new", "FixedSecureRandom", ".", "Data", "(", "keyData", ")", ",", "new", "FixedSecureRandom", ".", "Data", "(", "keyData", ")", "}", ");", "SecureRandom", "k", "=", "new", "TestRandomBigInteger", "(", "\"", "72546832179840998877302529996971396893172522460793442785601695562409154906335", "\"", ");", "signer", ".", "init", "(", "true", ",", "new", "ParametersWithRandom", "(", "kp", ".", "getPrivate", "(", "),", "new", "TestRandomBigInteger", "(", "\"", "349C55648DCF992F3F33E8026CFAC87C1D2BA075", "\"", ",", "16", ")", "))", ";", "signer", ".", "init", "(", "true", ",", "new", "ParametersWithRandom", "(", "kp", ".", "getPrivate", "(", "),", "new", "TestRandomData", "(", "Hex", ".", "decode", "(", "\"", "735959CC4463B8B440E407EECA8A473BF6A6D1FE657546F67D401F05", "\"", "))", "))", ";", "signer", ".", "init", "(", "true", ",", "new", "ParametersWithRandom", "(", "kp", ".", "getPrivate", "(", "),", "new", "TestRandomData", "(", "Hex", ".", "decode", "(", "\"", "0CAF2EF547EC49C4F3A6FE6DF4223A174D01F2C115D49A6F73437C29A2A8458C", "\"", "))", "))", ";", "signer", ".", "init", "(", "true", ",", "new", "ParametersWithRandom", "(", "kp", ".", "getPrivate", "(", "),", "new", "TestRandomData", "(", "Hex", ".", "decode", "(", "\"", "A6902C1E6E3943C5628061588A8B007BCCEA91DBF12915483F04B24AB0678BEE", "\"", "))", "))", ";", "SecureRandom", "k", "=", "new", "TestRandomBigInteger", "(", "BigIntegers", ".", "asUnsignedByteArray", "(", "new", "BigInteger", "(", "\"", "72546832179840998877302529996971396893172522460793442785601695562409154906335", "\"", "))", ");"], "docstring_tokens": ["timing", "attack"]}
{"contents": ["net:", "fix", "for", "a", "race", "condition", "in", "the", "inet", "frag", "code", "I", "stumbled", "upon", "this", "very", "serious", "bug", "while", "hunting", "for", "another", "one,", "it's", "a", "very", "subtle", "race", "condition", "between", "inet_frag_evictor,", "inet_frag_intern", "and", "the", "IPv4/6", "frag_queue", "and", "expire", "functions", "(basically", "the", "users", "of", "inet_frag_kill/inet_frag_put).", "What", "happens", "is", "that", "after", "a", "fragment", "has", "been", "added", "to", "the", "hash", "chain", "but", "before", "it's", "been", "added", "to", "the", "lru_list", "(inet_frag_lru_add)", "in", "inet_frag_intern,", "it", "may", "get", "deleted", "(either", "by", "an", "expired", "timer", "if", "the", "system", "load", "is", "high", "or", "the", "timer", "sufficiently", "low,", "or", "by", "the", "fraq_queue", "function", "for", "different", "reasons)", "before", "it's", "added", "to", "the", "lru_list,", "then", "after", "it", "gets", "added", "it's", "a", "matter", "of", "time", "for", "the", "evictor", "to", "get", "to", "a", "piece", "of", "memory", "which", "has", "been", "freed", "leading", "to", "a", "number", "of", "different", "bugs", "depending", "on", "what's", "left", "there.", "I've", "been", "able", "to", "trigger", "this", "on", "both", "IPv4", "and", "IPv6", "(which", "is", "normal", "as", "the", "frag", "code", "is", "the", "same),", "but", "it's", "been", "much", "more", "difficult", "to", "trigger", "on", "IPv4", "due", "to", "the", "protocol", "differences", "about", "how", "fragments", "are", "treated.", "The", "setup", "I", "used", "to", "reproduce", "this", "is:", "2", "machines", "with", "4", "x", "10G", "bonded", "in", "a", "RR", "bond,", "so", "the", "same", "flow", "can", "be", "seen", "on", "multiple", "cards", "at", "the", "same", "time.", "Then", "I", "used", "multiple", "instances", "of", "ping/ping6", "to", "generate", "fragmented", "packets", "and", "flood", "the", "machines", "with", "them", "while", "running", "other", "processes", "to", "load", "the", "attacked", "machine.", "*It", "is", "very", "important", "to", "have", "the", "_same", "flow_", "coming", "in", "on", "multiple", "CPUs", "concurrently.", "Usually", "the", "attacked", "machine", "would", "die", "in", "less", "than", "30", "minutes,", "if", "configured", "properly", "to", "have", "many", "evictor", "calls", "and", "timeouts", "it", "could", "happen", "in", "10", "minutes", "or", "so.", "An", "important", "point", "to", "make", "is", "that", "any", "caller", "(frag_queue", "or", "timer)", "of", "inet_frag_kill", "will", "remove", "both", "the", "timer", "refcount", "and", "the", "original/guarding", "refcount", "thus", "removing", "everything", "that's", "keeping", "the", "frag", "from", "being", "freed", "at", "the", "next", "inet_frag_put.", "All", "of", "this", "could", "happen", "before", "the", "frag", "was", "ever", "added", "to", "the", "LRU", "list,", "then", "it", "gets", "added", "and", "the", "evictor", "uses", "a", "freed", "fragment.", "An", "example", "for", "IPv6", "would", "be", "if", "a", "fragment", "is", "being", "added", "and", "is", "at", "the", "stage", "of", "being", "inserted", "in", "the", "hash", "after", "the", "hash", "lock", "is", "released,", "but", "before", "inet_frag_lru_add", "executes", "(or", "is", "able", "to", "obtain", "the", "lru", "lock)", "another", "overlapping", "fragment", "for", "the", "same", "flow", "arrives", "at", "a", "different", "CPU", "which", "finds", "it", "in", "the", "hash,", "but", "since", "it's", "overlapping", "it", "drops", "it", "invoking", "inet_frag_kill", "and", "thus", "removing", "all", "guarding", "refcounts,", "and", "afterwards", "freeing", "it", "by", "invoking", "inet_frag_put", "which", "removes", "the", "last", "refcount", "added", "previously", "by", "inet_frag_find,", "then", "inet_frag_lru_add", "gets", "executed", "by", "inet_frag_intern", "and", "we", "have", "a", "freed", "fragment", "in", "the", "lru_list.", "The", "fix", "is", "simple,", "just", "move", "the", "lru_add", "under", "the", "hash", "chain", "locked", "region", "so", "when", "a", "removing", "function", "is", "called", "it'll", "have", "to", "wait", "for", "the", "fragment", "to", "be", "added", "to", "the", "lru_list,", "and", "then", "it'll", "remove", "it", "(it", "works", "because", "the", "hash", "chain", "removal", "is", "done", "before", "the", "lru_list", "one", "and", "there's", "no", "window", "between", "the", "two", "list", "adds", "when", "the", "frag", "can", "get", "dropped).", "With", "this", "fix", "applied", "I", "couldn't", "kill", "the", "same", "machine", "in", "24", "hours", "with", "the", "same", "setup.", "Fixes:", "3ef0eb0db4bf", "(\"net:", "frag,", "move", "LRU", "list", "maintenance", "outside", "of", "rwlock\")", "CC:", "Florian", "Westphal", "<fw@strlen.de>", "CC:", "Jesper", "Dangaard", "Brouer", "<brouer@redhat.com>", "CC:", "David", "S.", "Miller", "<davem@davemloft.net>", "Signed-off-by:", "Nikolay", "Aleksandrov", "<nikolay@redhat.com>", "Acked-by:", "Jesper", "Dangaard", "Brouer", "<brouer@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["inet_frag_lru_add", "(", "nf", ",", "qp", ")", ";</s>inet_frag_lru_add", "(", "nf", ",", "qp", ")", ";"], "docstring_tokens": ["race", "condition"]}
{"contents": ["ext4:", "do", "not", "allow", "external", "inodes", "for", "inline", "data", "The", "inline", "data", "feature", "was", "implemented", "before", "we", "added", "support", "for", "external", "inodes", "for", "xattrs.", "It", "makes", "no", "sense", "to", "support", "that", "combination,", "but", "the", "problem", "is", "that", "there", "are", "a", "number", "of", "extended", "attribute", "checks", "that", "are", "skipped", "if", "e_value_inum", "is", "non-zero.", "Unfortunately,", "the", "inline", "data", "code", "is", "completely", "e_value_inum", "unaware,", "and", "attempts", "to", "interpret", "the", "xattr", "fields", "as", "if", "it", "were", "an", "inline", "xattr", "---", "at", "which", "point,", "Hilarty", "Ensues.", "This", "addresses", ".", "https://bugzilla.kernel.org/show_bug.cgi?id=199803", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Reviewed-by:", "Andreas", "Dilger", "<adilger@dilger.ca>", "Signed-off-by:", "Theodore", "Ts'o", "<tytso@mit.edu>", "Fixes:", "e50e5129f384", "(\"ext4:", "xattr-in-inode", "support\")", "Cc:", "stable@kernel.org"], "code_tokens": ["if", "(", "is", ".", "s", ".", "here", "-", ">", "e_value_inum", ")", "{", "EXT4_ERROR_INODE", "(", "inode", ",", "\"", "inline", "data", "xattr", "refers", "\"", "\"", "to", "an", "external", "xattr", "inode", "\"", ");", "error", "=", "-", "EFSCORRUPTED", ";", "goto", "out", ";", "}</s>"], "docstring_tokens": ["out-of-bounds", "memcpy"]}
{"contents": ["MFH:", "-", "Merged", "fix", "from", "SF", "project", "(Import", "Jeff", "Lawsons", "patches", "for", "XML", "datetime", "bug", "fixes)", "Fixed", "bugs:", "#45226", "(xmlrpc_set_type()", "segfaults", "with", "valid", "ISO8601", "date", "string)", "#18916", "(xmlrpc_set_type()", "\"not", "working\")"], "code_tokens": ["*", "Revision", "1", ".", "8", ".", "4", ".", "3", "2007", "/", "09", "/", "18", "19", ":", "49", ":", "53", "iliaa", "*", "*", "Fixed", "bug", "#", "42189", "(", "xmlrpc_set_type", "(", ")", "crashes", "php", "on", "invalid", "datetime", "*", "values", ")", ".", "*", "static", "time_t", "mkgmtime", "(", "struct", "tm", "*", "tm", ")", "{", "static", "const", "int", "mdays", "[", "12", "]", "=", "{", "0", ",", "31", ",", "59", ",", "90", ",", "120", ",", "151", ",", "181", ",", "212", ",", "243", ",", "273", ",", "304", ",", "334", "}", ";", "return", "(", "((", "((", "(", "tm", "-", ">", "tm_year", "-", "70", ")", "*", "365", ")", "+", "mdays", "[", "tm", "-", ">", "tm_mon", "]", "+", "tm", "-", ">", "tm_mday", "-", "1", "(", "tm", "-", ">", "tm_year", "-", "68", "-", "1", "+", "(", "tm", "-", ">", "tm_mon", ">", "=", "2", ")", ")/", "4", ")", "*", "24", ")", "+", "tm", "-", ">", "tm_hour", ")", "*", "60", "tm", "-", ">", "tm_min", ")", "*", "60", "+", "tm", "-", ">", "tm_sec", ";", "}", "char", "buf", "[", "30", "]", ";", "if", "(", "p2", "-", "buf", ">", "=", "sizeof", "(", "buf", ")", ")", "{", "return", "-", "1", ";", "}", "*", "value", "=", "mkgmtime", "(", "&", "tm", ")", ";", "tm", "=", "php_gmtime_r", "(", "&", "value", ",", "&", "tmbuf", ")", ";", "return", "strftime", "(", "buf", ",", "length", ",", "\"", "%", "Y", "%", "m", "%", "dT", "%", "H", ":", "%", "M", ":", "%", "SZ", "\"", ",", "tm", ")", ";", "XMLRPC_SetValueDateTime_ISO8601", "(", "value", ",", "timeBuf", ")", ";", "value", "-", ">", "type", "=", "xmlrpc_datetime", ";", "value", "-", ">", "i", "=", "time_val", ";", "simplestring_clear", "(", "&", "value", "-", ">", "str", ")", ";", "simplestring_add", "(", "&", "value", "-", ">", "str", ",", "s", ")", ";", "-", "-", "TEST", "-", "-", "Bug", "#", "18916", "(", "xmlrpc_set_type", "(", ")", "not", "working", ")", "-", "-", "INI", "-", "-", "date", ".", "timezone", "=", "\"", "America", "/", "Sao_Paulo", "\"", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "params", "=", "date", "(", "\"", "Ymd", "\\", "TH", ":", "i", ":", "s", "\"", ",", "time", "(", "))", ";", "xmlrpc_set_type", "(", "$", "params", ",", "'", "datetime", "'", ");", "echo", "xmlrpc_encode", "(", "$", "params", ")", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "utf", "-", "8", "\"", "?>", "<", "params", ">", "<", "param", ">", "<", "value", ">", "<", "dateTime", ".", "iso8601", ">", "%", "dT", "%", "d", ":", "%", "d", ":", "%", "d", "<", "/", "dateTime", ".", "iso8601", ">", "<", "/", "value", ">", "<", "/", "param", ">", "<", "/", "params", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "53", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "45226", "(", "xmlrpc_set_type", "(", ")", "segfaults", "with", "valid", "ISO8601", "date", "string", ")", "-", "-", "INI", "-", "-", "date", ".", "timezone", "=", "\"", "America", "/", "Sao_Paulo", "\"", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "d", "=", "date", "(", "DATE_ISO8601", ")", ";", "xmlrpc_set_type", "(", "$", "d", ",", "'", "datetime", "'", ");", "echo", "xmlrpc_encode_request", "(", "'", "method", ".", "call", "'", ",", "array", "(", "'", "date", "'", "=", ">", "$", "d", ")", ");", "$", "d", "=", "'", "2008", "-", "01", "-", "01", "20", ":", "00", ":", "00", "'", ";", "xmlrpc_set_type", "(", "$", "d", ",", "'", "datetime", "'", ");", "echo", "xmlrpc_encode_request", "(", "'", "method", ".", "call", "'", ",", "array", "(", "'", "date", "'", "=", ">", "$", "d", ")", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "iso", "-", "8859", "-", "1", "\"", "?>", "<", "methodCall", ">", "<", "methodName", ">", "method", ".", "call", "<", "/", "methodName", ">", "<", "params", ">", "<", "param", ">", "<", "value", ">", "<", "struct", ">", "<", "member", ">", "<", "name", ">", "date", "<", "/", "name", ">", "<", "value", ">", "<", "dateTime", ".", "iso8601", ">", "%", "d", "-", "%", "d", "-", "%", "dT", "%", "d", ":", "%", "d", ":", "%", "d", "%", "s", "%", "d", "<", "/", "dateTime", ".", "iso8601", ">", "<", "/", "value", ">", "<", "/", "member", ">", "<", "/", "struct", ">", "<", "/", "value", ">", "<", "/", "param", ">", "<", "/", "params", ">", "<", "/", "methodCall", ">", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "iso", "-", "8859", "-", "1", "\"", "?>", "<", "methodCall", ">", "<", "methodName", ">", "method", ".", "call", "<", "/", "methodName", ">", "<", "params", ">", "<", "param", ">", "<", "value", ">", "<", "struct", ">", "<", "member", ">", "<", "name", ">", "date", "<", "/", "name", ">", "<", "value", ">", "<", "dateTime", ".", "iso8601", ">", "%", "d", "-", "%", "d", "-", "%", "d", "%", "d", ":", "%", "d", ":", "%", "d", "<", "/", "dateTime", ".", "iso8601", ">", "<", "/", "value", ">", "<", "/", "member", ">", "<", "/", "struct", ">", "<", "/", "value", ">", "<", "/", "param", ">", "<", "/", "params", ">", "<", "/", "methodCall", "></s>char", "buf", "[", "18", "]", ";", "if", "(", "strlen", "(", "text", ")", "<", "17", ")", "{", "return", "-", "1", ";", "}", "*", "value", "=", "mktime", "(", "&", "tm", ")", ";", "tm", "=", "php_localtime_r", "(", "&", "value", ",", "&", "tmbuf", ")", ";", "return", "strftime", "(", "buf", ",", "length", ",", "\"", "%", "Y", "%", "m", "%", "dT", "%", "H", ":", "%", "M", ":", "%", "S", "\"", ",", "tm", ")", ";", "simplestring_clear", "(", "&", "value", "-", ">", "str", ")", ";", "simplestring_add", "(", "&", "value", "-", ">", "str", ",", "timeBuf", ")", ";", "XMLRPC_SetValueDateTime", "(", "value", ",", "time_val", ")", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["Fix", "MSSQL", "escaping", "(#3382)"], "code_tokens": ["#", "##", "Bug", "fixes", ":", "-", "MSSQL", ":", "Escape", "column", "ids", "correctly", "in", "all", "cases", "(", "reported", "by", "Snyk", "Security", "Research", "Team", ")", "if", "(", "value", "=", "==", "'", "*'", ")", "{", "return", "'", "*'", ";", "}", "return", "`", "[$", "{", "value", ".", "replace", "(", "/[", "[\\", "]'", "]+", "/", "g", ",", "'", "')", "}]", "`;", "}", ");", "`", "${", "method", ".", "toUpperCase", "(", ")}", ".", "Undefined", "column", "(", "s", ")", ":", "[", "${", "this", ".", "undefinedBindingsInfo", ".", "join", "(", "'", ",", "'", ")", "}]", "query", ":", "$", "{", "query", ".", "sql", "}", "`", "this", ".", "undefinedBindingsInfo", ".", "push", "(", "stmt", ".", "column", ")", ";", "const", "undefinedBindingIndices", "=", "helpers", ".", "getUndefinedIndices", "(", "this", ".", "bindings", ")", ";", "return", "(", "trx", ".", "_previousSibling", "?", "trx", ".", "_previousSibling", ".", "reflect", "(", ")", ":", "Promise", ".", "resolve", "(", ")", ")", ".", "then", "(", "function", "(", ")", "{", "return", "connection", ";", "}", ");", "/", "/", "global", "it", ",", "describe", "'", "use", "strict", "'", ";", "const", "expect", "=", "require", "(", "'", "chai", "'", ").", "expect", ";", "const", "knex", "=", "require", "(", "'.", "./", "..", "/.", "./", "knex", "'", ");", "describe", "(", "'", "MSSQL", "unit", "tests", "'", ",", "(", ")", "=", ">", "{", "const", "knexInstance", "=", "knex", "(", "{", "client", ":", "'", "mssql", "'", ",", "connection", ":", "{", "port", ":", "1433", ",", "host", ":", "'", "127", ".", "0", ".", "0", ".", "1", "'", ",", "password", ":", "'", "yourStrong", "(", "!)", "Password", "'", ",", "user", ":", "'", "sa", "'", ",", "}", ",", "}", ");", "it", "(", "'", "should", "escape", "statements", "with", "[", "]", "correctly", "'", ",", "async", "(", ")", "=", ">", "{", "const", "sql", "=", "knexInstance", "(", "'", "projects", "'", ")", ".", "where", "(", "'", "id", "]", "=", "1", "UNION", "SELECT", "1", ",", "@", "@", "version", "-", "-", "-", "-'", ",", "1", ")", ".", "toSQL", "(", ");", "console", ".", "log", "(", "sql", ")", ";", "expect", "(", "sql", ".", "sql", ")", ".", "to", ".", "equal", "(", "'", "select", "*", "from", "[", "projects", "]", "where", "[", "id", "=", "1", "UNION", "SELECT", "1", ",", "@", "@", "version", "-", "-", "-", "-]", "=", "?", "'", ")", ";", "}", ");", "it", "(", "'", "should", "escape", "statements", "with", "\"", "\"", "correctly", "'", ",", "async", "(", ")", "=", ">", "{", "const", "sql", "=", "knexInstance", "(", "'", "projects", "'", ")", ".", "where", "(", "'", "id", "]", "\"", "=", "1", "UNION", "SELECT", "1", ",", "@", "@", "version", "-", "-", "-", "-'", ",", "1", ")", ".", "toSQL", "(", ");", "console", ".", "log", "(", "sql", ")", ";", "expect", "(", "sql", ".", "sql", ")", ".", "to", ".", "equal", "(", "'", "select", "*", "from", "[", "projects", "]", "where", "[", "id", "\"", "=", "1", "UNION", "SELECT", "1", ",", "@", "@", "version", "-", "-", "-", "-]", "=", "?", "'", ")", ";", "}", ");", "}", ");", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "/", "global", "it", ",", "describe", "it", "(", "'", "escape", "statements", "correctly", "'", ",", "async", "(", ")", "=", ">", "{", "const", "knexInstance", "=", "knex", "(", "{", "client", ":", "'", "postgresql", "'", ",", "version", ":", "'", "10", ".", "5", "'", ",", "connection", ":", "{", "pool", ":", "{", "},", "}", ",", "}", ");", "const", "sql", "=", "knexInstance", "(", "'", "projects", "'", ")", ".", "where", "(", "'", "id", "=", "1", "UNION", "SELECT", "1", ",", "version", "(", ");", "',", "1", ")", ".", "toSQL", "(", ");", "expect", "(", "sql", ".", "sql", ")", ".", "to", ".", "equal", "(", "'", "select", "*", "from", "\"", "projects", "\"", "where", "\"", "id", "=", "1", "UNION", "SELECT", "1", ",", "version", "(", ");", "\"", "=", "?", "'", ")", ";", "const", "sql2", "=", "knexInstance", "(", "'", "projects", "'", ")", ".", "where", "(", "'", "id", "=", "1", "\"", "UNION", "SELECT", "1", ",", "version", "(", ");", "',", "1", ")", ".", "toSQL", "(", ");", "expect", "(", "sql2", ".", "sql", ")", ".", "to", ".", "equal", "(", "'", "select", "*", "from", "\"", "projects", "\"", "where", "\"", "id", "=", "1", "\"", "\"", "UNION", "SELECT", "1", ",", "version", "(", ");", "\"", "=", "?", "'", ")", ";", "}", ");", "const", "expect", "=", "require", "(", "'", "chai", "'", ").", "expect", ";</s>return", "value", "!", "==", "'", "*'", "?", "`", "[$", "{", "value", ".", "replace", "(", "/\\", "[/", "g", ",", "'", "['", ")}", "]`", ":", "'", "*'", ";", "}", ")", "`", "${", "method", ".", "toUpperCase", "(", ")}", ".", "Undefined", "column", "(", "s", ")", ":", "[", "${", "this", ".", "undefinedBindingsInfo", ".", "join", "(", "',", "'", ")}", "]", "query", ":", "$", "{", "query", ".", "sql", "}", "`", "this", ".", "undefinedBindingsInfo", ".", "push", "(", "stmt", ".", "column", ")", "const", "undefinedBindingIndices", "=", "helpers", ".", "getUndefinedIndices", "(", "this", ".", "bindings", ")", ";", "return", "(", "trx", ".", "_previousSibling", "?", "trx", ".", "_previousSibling", ".", "reflect", "(", ")", ":", "Promise", ".", "resolve", "(", "))", ".", "then", "(", "function", "(", ")", "{", "return", "connection", ";", "}", ");", "/", "/", "global", "it", ",", "describe", ",", "expect", "/", "*", "global", "expect", "*", "/"], "docstring_tokens": ["sql", "injection"]}
{"contents": ["aio:", "check", "for", "multiplication", "overflow", "in", "do_io_submit", "Tavis", "Ormandy", "pointed", "out", "that", "do_io_submit", "does", "not", "do", "proper", "bounds", "checking", "on", "the", "passed-in", "iocb", "array:", "if", "(unlikely(nr", "<", "0))", "return", "-EINVAL;", "if", "(unlikely(!access_ok(VERIFY_READ,", "iocbpp,", "(nr*sizeof(iocbpp)))))", "return", "-EFAULT;", "^^^^^^^^^^^^^^^^^^", "The", "attached", "patch", "checks", "for", "overflow,", "and", "if", "it", "is", "detected,", "the", "number", "of", "iocbs", "submitted", "is", "scaled", "down", "to", "a", "number", "that", "will", "fit", "in", "the", "long.", "This", "is", "an", "ok", "thing", "to", "do,", "as", "sys_io_submit", "is", "documented", "as", "returning", "the", "number", "of", "iocbs", "submitted,", "so", "callers", "should", "handle", "a", "return", "value", "of", "less", "than", "the", "'nr'", "argument", "passed", "in.", "Reported-by:", "Tavis", "Ormandy", "<taviso@cmpxchg8b.com>", "Signed-off-by:", "Jeff", "Moyer", "<jmoyer@redhat.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["if", "(", "unlikely", "(", "nr", ">", "LONG_MAX", "/", "sizeof", "(", "*", "iocbpp", ")", "))", "nr", "=", "LONG_MAX", "/", "sizeof", "(", "*", "iocbpp", ")", ";</s>"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["drm/i915:", "fix", "integer", "overflow", "in", "i915_gem_do_execbuffer()", "On", "32-bit", "systems,", "a", "large", "args->num_cliprects", "from", "userspace", "via", "ioctl", "may", "overflow", "the", "allocation", "size,", "leading", "to", "out-of-bounds", "access.", "This", "vulnerability", "was", "introduced", "in", "commit", "432e58ed", "(\"drm/i915:", "Avoid", "allocation", "for", "execbuffer", "object", "list\").", "Signed-off-by:", "Xi", "Wang", "<xi.wang@gmail.com>", "Reviewed-by:", "Chris", "Wilson", "<chris@chris-wilson.co.uk>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Daniel", "Vetter", "<daniel.vetter@ffwll.ch>"], "code_tokens": ["if", "(", "args", "-", ">", "num_cliprects", ">", "UINT_MAX", "/", "sizeof", "(", "*", "cliprects", ")", ")", "{", "DRM_DEBUG", "(", "\"", "execbuf", "with", "%", "u", "cliprects", "\\", "n", "\"", ",", "args", "-", ">", "num_cliprects", ")", ";", "return", "-", "EINVAL", ";", "}</s>"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["Fixed", "issue", "#774", "-", "Removed", "default", "support", "of", "JavaBeans", "XML-serialization.", "Reported", "by", "David", "Jorm,", "Dinis", "Cruz,", "Abraham", "Kang", "and", "Alvaro", "Munoz."], "code_tokens": ["-", "Fixed", "issue", "#", "774", "-", "Removed", "default", "support", "of", "JavaBeans", "XML", "-", "serialization", ".", "Reported", "by", "David", "Jorm", ",", "Dinis", "Cruz", ",", "Abraham", "Kang", "and", "Alvaro", "Munoz", ".", "/", "**", "Indicates", "whether", "the", "JavaBeans", "XML", "deserialization", "is", "supported", "or", "not", ".", "*", "/", "private", "static", "final", "boolean", "VARIANT_OBJECT_XML_SUPPORTED", "=", "Boolean", ".", "getBoolean", "(", "\"", "org", ".", "restlet", ".", "engine", ".", "converter", ".", "DefaultConverter", ".", "VARIANT_OBJECT_XML_SUPPORTED", "\"", ");", "|", "|", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "mediaType", ")", "))", "{", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", ")", "{", "result", "=", "addVariant", "(", "result", ",", "VARIANT_OBJECT_XML", ")", ";", "}", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", ")", "{", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ",", "1", ".", "0F", ")", ";", "}", "*", "Representation", "based", "on", "a", "serializable", "Java", "object", ".", "<", "br", ">", "*", "It", "supports", "binary", "representations", "of", "JavaBeans", "using", "the", "*", "{", "@", "link", "ObjectInputStream", "}", "and", "{", "@", "link", "ObjectOutputStream", "}", "classes", ".", "In", "this", "*", "case", ",", "it", "handles", "representations", "having", "the", "following", "media", "type", ":", "*", "{", "@", "link", "MediaType", "#", "APPLICATION_JAVA_OBJECT", "}", "*", "(", "\"", "application", "/", "x", "-", "java", "-", "serialized", "-", "object", "\"", ").", "It", "also", "supports", "textual", "*", "representations", "of", "JavaBeans", "using", "the", "{", "@", "link", "XMLEncoder", "}", "and", "*", "{", "@", "link", "XMLDecoder", "}", "classes", ".", "In", "this", "case", ",", "it", "handles", "representations", "having", "*", "the", "following", "media", "type", ":", "{", "@", "link", "MediaType", "#", "APPLICATION_JAVA_OBJECT_XML", "}", "*", "(", "\"", "application", "/", "x", "-", "java", "-", "serialized", "-", "object", "+", "xml", "\"", ").", "*", "*", "SECURITY", "WARNING", ":", "The", "usage", "of", "{", "@", "link", "XMLDecoder", "}", "when", "deserializing", "XML", "*", "presentations", "from", "unstrusted", "sources", "can", "lead", "to", "malicious", "attacks", ".", "As", "*", "pointed", "<", "a", "href", "=", "*", "\"", "http", ":", "//", "blog", ".", "diniscruz", ".", "com", "/", "2013", "/", "08", "/", "using", "-", "xmldecoder", "-", "to", "-", "execute", "-", "server", "-", "side", ".", "html", "\"", "*", ">", "here", "<", "/", "a", ">", ",", "the", "{", "@", "link", "XMLDecoder", "}", "is", "able", "to", "force", "the", "JVM", "to", "execute", "*", "unwanted", "Java", "code", "described", "inside", "the", "XML", "file", ".", "Thus", ",", "the", "support", "of", "such", "*", "format", "has", "been", "disactivated", "by", "default", "inside", "the", "default", "converter", ".", "You", "can", "*", "activate", "this", "support", "by", "turning", "on", "the", "following", "system", "property", ":", "*", "org", ".", "restlet", ".", "engine", ".", "converter", ".", "DefaultConverter", ".", "VARIANT_OBJECT_XML_SUPPORTED", ".</s>-", "Fixed", "reading", "of", "Via", "header", "(", "issue", "#", "599", ")", ".", "-", "2", ".", "0", ".", "15", "(", "2012", "-", "08", "-", "23", ")", "-", "Bug", "fixed", "-", "Fixed", "bug", "in", "Reference", "#", "getParentRef", "with", "relative", "URIs", ".", "@", "@", "-", "78", ",", "6", "+", "78", ",", "10", "@", "@", "|", "|", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "mediaType", ")", ")", "{", "result", "=", "addVariant", "(", "result", ",", "VARIANT_OBJECT_XML", ")", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ",", "1", ".", "0F", ")", ";", "*", "Representation", "based", "on", "a", "serializable", "Java", "object", "."], "docstring_tokens": ["xml", "deserialization"]}
{"contents": ["sctp:", "Fix", "another", "socket", "race", "during", "accept/peeloff", "There", "is", "a", "race", "between", "sctp_rcv()", "and", "sctp_accept()", "where", "we", "have", "moved", "the", "association", "from", "the", "listening", "socket", "to", "the", "accepted", "socket,", "but", "sctp_rcv()", "processing", "cached", "the", "old", "socket", "and", "continues", "to", "use", "it.", "The", "easy", "solution", "is", "to", "check", "for", "the", "socket", "mismatch", "once", "we've", "grabed", "the", "socket", "lock.", "If", "we", "hit", "a", "mis-match,", "that", "means", "that", "were", "are", "currently", "holding", "the", "lock", "on", "the", "listening", "socket,", "but", "the", "association", "is", "refrencing", "a", "newly", "accepted", "socket.", "We", "need", "to", "drop", "the", "lock", "on", "the", "old", "socket", "and", "grab", "the", "lock", "on", "the", "new", "one.", "A", "more", "proper", "solution", "might", "be", "to", "create", "accepted", "sockets", "when", "the", "new", "association", "is", "established,", "similar", "to", "TCP.", "That", "would", "eliminate", "the", "race", "for", "1-to-1", "style", "sockets,", "but", "it", "would", "still", "existing", "for", "1-to-many", "sockets", "where", "a", "user", "wished", "to", "peeloff", "an", "association.", "For", "now,", "we'll", "live", "with", "this", "easy", "solution", "as", "it", "addresses", "the", "problem.", "Reported-by:", "Michal", "Hocko", "<mhocko@suse.cz>", "Reported-by:", "Karsten", "Keil", "<kkeil@suse.de>", "Signed-off-by:", "Vlad", "Yasevich", "<vladislav.yasevich@hp.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["if", "(", "sk", "!", "=", "rcvr", "-", ">", "sk", ")", "{", "/", "*", "Our", "cached", "sk", "is", "different", "from", "the", "rcvr", "-", ">", "sk", ".", "This", "is", "*", "because", "migrate", "(", ")/", "accept", "(", ")", "may", "have", "moved", "the", "association", "*", "to", "a", "new", "socket", "and", "released", "all", "the", "sockets", ".", "So", "now", "we", "*", "are", "holding", "a", "lock", "on", "the", "old", "socket", "while", "the", "user", "may", "*", "be", "doing", "something", "with", "the", "new", "socket", ".", "Switch", "our", "veiw", "*", "of", "the", "current", "sk", ".", "*", "/", "sctp_bh_unlock_sock", "(", "sk", ")", ";", "sk", "=", "rcvr", "-", ">", "sk", ";", "sctp_bh_lock_sock", "(", "sk", ")", ";", "}</s>"], "docstring_tokens": ["race", "condition"]}
{"contents": ["NIFI-5442", "Get", "X-ProxyContextPath", "value", "from", "request", "attributes", "rather", "than", "directly", "from", "headers.", "NIFI-5442", "Populate", "request", "contextPath", "attribute", "during", "AccessResource", "before", "displaying", "on", "message-page.jsp.", "Refactored", "shared", "code", "from", "CatchAllFilter", "to", "WebUtils.", "NIFI-5442", "Refactored", "filter", "and", "context", "path", "code", "to", "shared", "parent", "filter", "and", "subclass.", "NIFI-5442", "Removed", "unnecessary", "initParams", "from", "nifi-web-ui", "web.xml.", "NIFI-5442", "Added", "explicit", "dispatchers", "to", "nifi-web-ui", "web.xml", "and", "removed", "unnecessary", "code", "from", "AccessResource.", "This", "closes", "#2908"], "code_tokens": ["/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "nifi", ".", "web", ".", "filter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "servlet", ".", "Filter", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "FilterConfig", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "ServletRequest", ";", "import", "javax", ".", "servlet", ".", "ServletResponse", ";", "import", "org", ".", "apache", ".", "nifi", ".", "web", ".", "util", ".", "WebUtils", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "/", "**", "*", "This", "filter", "intercepts", "a", "request", "and", "populates", "the", "{", "@", "code", "contextPath", "}", "attribute", "on", "the", "request", "with", "a", "sanitized", "value", "(", "originally", ")", "retrieved", "from", "{", "@", "code", "nifi", ".", "properties", "}", ".", "*", "/", "public", "class", "SanitizeContextPathFilter", "implements", "Filter", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "SanitizeContextPathFilter", ".", "class", ")", ";", "private", "String", "whitelistedContextPaths", "=", "\"", "\";", "@", "Override", "public", "void", "init", "(", "FilterConfig", "filterConfig", ")", "throws", "ServletException", "{", "String", "providedWhitelist", "=", "filterConfig", ".", "getServletContext", "(", ").", "getInitParameter", "(", "\"", "whitelistedContextPaths", "\"", ");", "logger", ".", "debug", "(", "\"", "SanitizeContextPathFilter", "received", "provided", "whitelisted", "context", "paths", "from", "NiFi", "properties", ":", "\"", "+", "providedWhitelist", ")", ";", "if", "(", "providedWhitelist", "!", "=", "null", ")", "{", "whitelistedContextPaths", "=", "providedWhitelist", ";", "}", "}", "@", "Override", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ",", "FilterChain", "filterChain", ")", "throws", "IOException", ",", "ServletException", "{", "/", "/", "Inject", "the", "contextPath", "attribute", "into", "the", "request", "injectContextPathAttribute", "(", "request", ")", ";", "/", "/", "Pass", "execution", "to", "the", "next", "filter", "in", "the", "chain", "filterChain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "}", "/", "**", "*", "Determines", ",", "sanitizes", ",", "and", "injects", "the", "{", "@", "code", "contextPath", "}", "attribute", "into", "the", "{", "@", "code", "request", "}", ".", "If", "not", "present", ",", "an", "empty", "string", "{", "@", "code", "\"", "\"}", "is", "injected", ".", "*", "@", "param", "request", "the", "request", "*", "/", "protected", "void", "injectContextPathAttribute", "(", "ServletRequest", "request", ")", "{", "/", "/", "Capture", "the", "provided", "context", "path", "headers", "and", "sanitize", "them", "before", "using", "in", "the", "response", "String", "contextPath", "=", "WebUtils", ".", "sanitizeContextPath", "(", "request", ",", "whitelistedContextPaths", ",", "\"", "\")", ";", "request", ".", "setAttribute", "(", "\"", "contextPath", "\"", ",", "contextPath", ")", ";", "logger", ".", "debug", "(", "\"", "SanitizeContextPathFilter", "set", "contextPath", ":", "\"", "+", "contextPath", ")", ";", "}", "@", "Override", "public", "void", "destroy", "(", ")", "{", "}", "/", "**", "*", "Getter", "for", "whitelistedContextPaths", ".", "Cannot", "be", "package", "-", "private", "because", "of", "an", "issue", "where", "the", "package", "is", "scoped", "per", "classloader", ".", "*", "*", "@", "return", "the", "whitelisted", "context", "path", "(", "s", ")", "*", "/", "protected", "String", "getWhitelistedContextPaths", "(", ")", "{", "return", "whitelistedContextPaths", ";", "}", "}", "@", "@", "-", "21", ",", "13", "+", "21", ",", "12", "@", "@", "import", "javax", ".", "servlet", ".", "ServletRequest", ";", "/", "**", "*", "Returns", "a", "\"", "safe", "\"", "context", "path", "value", "from", "the", "request", "headers", "to", "use", "in", "a", "proxy", "environment", ".", "*", "This", "is", "used", "on", "the", "JSP", "to", "build", "the", "resource", "paths", "for", "the", "external", "resources", "(", "CSS", ",", "JS", ",", "etc", ".", ").", "*", "If", "no", "headers", "are", "present", "specifying", "this", "value", ",", "it", "is", "an", "empty", "string", ".", "*", "*", "@", "param", "request", "the", "HTTP", "request", "*", "@", "return", "the", "context", "path", "safe", "to", "be", "printed", "to", "the", "page", "*", "/", "public", "static", "String", "sanitizeContextPath", "(", "ServletRequest", "request", ",", "String", "whitelistedContextPaths", ",", "String", "jspDisplayName", ")", "{", "if", "(", "StringUtils", ".", "isBlank", "(", "jspDisplayName", ")", ")", "{", "jspDisplayName", "=", "\"", "JSP", "page", "\"", ";", "}", "String", "contextPath", "=", "normalizeContextPath", "(", "determineContextPath", "(", "(", "HttpServletRequest", ")", "request", ")", ");", "try", "{", "verifyContextPath", "(", "whitelistedContextPaths", ",", "contextPath", ")", ";", "return", "contextPath", ";", "}", "catch", "(", "UriBuilderException", "e", ")", "{", "logger", ".", "error", "(", "\"", "Error", "determining", "context", "path", "on", "\"", "+", "jspDisplayName", "+", "\"", ":", "\"", "+", "e", ".", "getMessage", "(", "))", ";", "return", "\"", "\";", "}", "}", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileFilter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "NetworkInterface", ";", "import", "java", ".", "net", ".", "SocketException", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "EnumSet", ";", "import", "java", ".", "util", ".", "Enumeration", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Objects", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "jar", ".", "JarEntry", ";", "import", "java", ".", "util", ".", "jar", ".", "JarFile", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "javax", ".", "servlet", ".", "DispatcherType", ";", "import", "javax", ".", "servlet", ".", "Filter", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "FilterConfig", ";", "import", "javax", ".", "servlet", ".", "ServletContext", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "ServletRequest", ";", "import", "javax", ".", "servlet", ".", "ServletResponse", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "webUiContext", ".", "getInitParams", "(", ").", "put", "(", "\"", "whitelistedContextPaths", "\"", ",", "props", ".", "getWhitelistedContextPaths", "(", "))", ";", ".", "queryParam", "(", "\"", "post_logout_redirect_uri", "\"", ",", "postLogoutRedirectUri", ")", ".", "build", "(", ");", "*", "@", "param", "name", "the", "name", "of", "the", "cookie", "final", "String", "baseUrl", "=", "StringUtils", ".", "substringBeforeLast", "(", "nifiApiUrl", ",", "\"", "/", "nifi", "-", "api", "\"", ");", "*", "This", "filter", "catches", "all", "requests", "and", "explicitly", "forwards", "them", "to", "a", "JSP", "(", "{@", "code", "index", ".", "jsp", "}", "injected", "in", "*", "the", "filter", "configuration", ".", "This", "is", "used", "to", "handle", "all", "errors", "(", "this", "module", "is", "only", "used", "for", "errors", ")", ".", "It", "*", "extends", "{", "@", "link", "SanitizeContextPathFilter", "}", "which", "sanitizes", "the", "context", "path", "and", "injects", "it", "as", "a", "request", "*", "attribute", "to", "be", "used", "on", "the", "page", "for", "linking", "resources", "without", "XSS", "vulnerabilities", ".", "public", "class", "CatchAllFilter", "extends", "SanitizeContextPathFilter", "{", "private", "String", "forwardPath", "=", "\"", "\";", "private", "String", "displayPath", "=", "\"", "\";", "/", "/", "TODO", ":", "Perform", "path", "validation", "(", "against", "what", "set", "of", "rules", ")", "?", "forwardPath", "=", "filterConfig", ".", "getInitParameter", "(", "\"", "forwardPath", "\"", ");", "displayPath", "=", "filterConfig", ".", "getInitParameter", "(", "\"", "displayPath", "\"", ");", "logger", ".", "debug", "(", "\"", "CatchAllFilter", "[", "\"", "+", "displayPath", "+", "\"", "]", "received", "provided", "whitelisted", "context", "paths", "from", "NiFi", "properties", ":", "\"", "+", "getWhitelistedContextPaths", "(", "))", ";", "/", "/", "Inject", "the", "contextPath", "attribute", "into", "the", "request", "injectContextPathAttribute", "(", "request", ")", ";", "/", "/", "Forward", "all", "requests", "to", "index", ".", "jsp", "request", ".", "getRequestDispatcher", "(", "forwardPath", ")", ".", "forward", "(", "request", ",", "response", ")", ";", "<", "init", "-", "param", ">", "<", "param", "-", "name", ">", "displayPath", "<", "/", "param", "-", "name", ">", "<", "param", "-", "value", ">", "index", ".", "jsp", "<", "/", "param", "-", "value", ">", "<", "/", "init", "-", "param", ">", "<", "init", "-", "param", ">", "<", "param", "-", "name", ">", "forwardPath", "<", "/", "param", "-", "name", ">", "<", "param", "-", "value", ">", "/", "index", ".", "jsp", "<", "/", "param", "-", "value", ">", "<", "/", "init", "-", "param", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "nifi", "<", "/", "groupId", ">", "<", "artifactId", ">", "nifi", "-", "web", "-", "utils", "<", "/", "artifactId", ">", "<", "scope", ">", "provided", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "%", "/", "/", "Sanitize", "the", "contextPath", "to", "ensure", "it", "is", "on", "this", "server", "/", "/", "rather", "than", "getting", "it", "from", "the", "header", "directly", "String", "contextPath", "=", "request", ".", "getAttribute", "(", "\"", "contextPath", "\"", ").", "toString", "(", ");", "%", ">", "<", "!-", "-", "catch", "all", "filter", "-", "->", "<", "filter", ">", "<", "filter", "-", "name", ">", "SanitizeContextPathFilter", "<", "/", "filter", "-", "name", ">", "<", "filter", "-", "class", ">", "org", ".", "apache", ".", "nifi", ".", "web", ".", "filter", ".", "SanitizeContextPathFilter", "<", "/", "filter", "-", "class", ">", "<", "/", "filter", ">", "<", "filter", "-", "mapping", ">", "<", "filter", "-", "name", ">", "SanitizeContextPathFilter", "<", "/", "filter", "-", "name", ">", "<", "url", "-", "pattern", ">", "/*", "</", "url", "-", "pattern", ">", "<", "dispatcher", ">", "REQUEST", "<", "/", "dispatcher", ">", "<", "dispatcher", ">", "FORWARD", "<", "/", "dispatcher", ">", "<", "dispatcher", ">", "INCLUDE", "<", "/", "dispatcher", ">", "<", "dispatcher", ">", "ERROR", "<", "/", "dispatcher", ">", "<", "dispatcher", ">", "ASYNC", "<", "/", "dispatcher", ">", "<", "/", "filter", "-", "mapping", "></s>import", "javax", ".", "servlet", ".", "DispatcherType", ";", "import", "javax", ".", "servlet", ".", "Filter", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "FilterConfig", ";", "import", "javax", ".", "servlet", ".", "ServletContext", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "ServletRequest", ";", "import", "javax", ".", "servlet", ".", "ServletResponse", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileFilter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "NetworkInterface", ";", "import", "java", ".", "net", ".", "SocketException", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "EnumSet", ";", "import", "java", ".", "util", ".", "Enumeration", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Objects", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "jar", ".", "JarEntry", ";", "import", "java", ".", "util", ".", "jar", ".", "JarFile", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", ".", "queryParam", "(", "\"", "post_logout_redirect_uri", "\"", ",", "postLogoutRedirectUri", ")", ".", "build", "(", ");", "*", "@", "param", "name", "the", "name", "of", "the", "cookie", "final", "String", "baseUrl", "=", "StringUtils", ".", "substringBeforeLast", "(", "nifiApiUrl", ",", "\"/", "nifi", "-", "api", "\"", ");", "import", "javax", ".", "servlet", ".", "Filter", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "UriBuilderException", ";", "import", "org", ".", "apache", ".", "nifi", ".", "web", ".", "util", ".", "WebUtils", ";", "*", "Filter", "for", "forward", "all", "requests", "to", "index", ".", "jsp", ".", "public", "class", "CatchAllFilter", "implements", "Filter", "{", "private", "static", "String", "whitelistedContextPaths", "=", "\"", "\";", "String", "providedWhitelist", "=", "filterConfig", ".", "getServletContext", "(", ").", "getInitParameter", "(", "\"", "whitelistedContextPaths", "\"", ");", "logger", ".", "debug", "(", "\"", "CatchAllFilter", "received", "provided", "whitelisted", "context", "paths", "from", "NiFi", "properties", ":", "\"", "+", "providedWhitelist", ")", ";", "if", "(", "providedWhitelist", "!", "=", "null", ")", "{", "whitelistedContextPaths", "=", "providedWhitelist", ";", "}", "/", "/", "Capture", "the", "provided", "context", "path", "headers", "and", "sanitize", "them", "before", "using", "in", "the", "response", "String", "contextPath", "=", "getSanitizedContextPath", "(", "request", ")", ";", "request", ".", "setAttribute", "(", "\"", "contextPath", "\"", ",", "contextPath", ")", ";", "/", "/", "for", "all", "requests", "to", "index", ".", "jsp", "request", ".", "getRequestDispatcher", "(", "\"/", "index", ".", "jsp", "\"", ").", "forward", "(", "request", ",", "response", ")", ";", "/", "**", "*", "Returns", "a", "\"", "safe", "\"", "context", "path", "value", "from", "the", "request", "headers", "to", "use", "in", "a", "proxy", "environment", ".", "*", "This", "is", "used", "on", "the", "JSP", "to", "build", "the", "resource", "paths", "for", "the", "external", "resources", "(", "CSS", ",", "JS", ",", "etc", ".", ").", "*", "If", "no", "headers", "are", "present", "specifying", "this", "value", ",", "it", "is", "an", "empty", "string", ".", "*", "*", "@", "param", "request", "the", "HTTP", "request", "*", "@", "return", "the", "context", "path", "safe", "to", "be", "printed", "to", "the", "page", "*", "/", "private", "String", "getSanitizedContextPath", "(", "ServletRequest", "request", ")", "{", "String", "contextPath", "=", "WebUtils", ".", "normalizeContextPath", "(", "WebUtils", ".", "determineContextPath", "(", "(", "HttpServletRequest", ")", "request", ")", ");", "try", "{", "WebUtils", ".", "verifyContextPath", "(", "whitelistedContextPaths", ",", "contextPath", ")", ";", "return", "contextPath", ";", "}", "catch", "(", "UriBuilderException", "e", ")", "{", "logger", ".", "error", "(", "\"", "Error", "determining", "context", "path", "on", "index", ".", "jsp", ":", "\"", "+", "e", ".", "getMessage", "(", "))", ";", "return", "\"", "\";", "}", "}", "<", "%", "String", "contextPath", "=", "request", ".", "getHeader", "(", "\"", "X", "-", "ProxyContextPath", "\"", ");", "if", "(", "contextPath", "=", "=", "null", ")", "{", "contextPath", "=", "request", ".", "getHeader", "(", "\"", "X", "-", "Forwarded", "-", "Context", "\"", ");", "}", "if", "(", "contextPath", "=", "=", "null", ")", "{", "contextPath", "=", "\"", "\";", "}", "if", "(", "contextPath", ".", "endsWith", "(", "\"/", "\")", ")", "{", "contextPath", "=", "contextPath", ".", "substring", "(", "0", ",", "contextPath", ".", "length", "(", ")", "-", "1", ")", ";", "}", "%", ">"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["sysctl:", "don't", "overflow", "the", "user-supplied", "buffer", "with", "'\\0'", "If", "the", "string", "was", "too", "long", "to", "fit", "in", "the", "user-supplied", "buffer,", "the", "sysctl", "layer", "would", "zero-terminate", "it", "by", "writing", "past", "the", "end", "of", "the", "buffer.", "Don't", "do", "that.", "Noticed", "by", "Yi", "Yang", "<yang.y.yi@gmail.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["l", "=", "strlen", "(", "table", "-", ">", "data", ")", "+", "1", ";</s>l", "=", "strlen", "(", "table", "-", ">", "data", ")", ";", "if", "(", "put_user", "(", "0", ",", "(", "(", "char", "__user", "*", ")", "oldval", ")", "+", "len", ")", ")", "return", "-", "EFAULT", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["uml:", "check", "length", "in", "exitcode_proc_write()", "We", "don't", "cap", "the", "size", "of", "buffer", "from", "the", "user", "so", "we", "could", "write", "past", "the", "end", "of", "the", "array", "here.", "Only", "root", "can", "write", "to", "this", "file.", "Reported-by:", "Nico", "Golde", "<nico@ngolde.de>", "Reported-by:", "Fabian", "Yamaguchi", "<fabs@goesec.de>", "Signed-off-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["size_t", "size", ";", "size", "=", "min", "(", "count", ",", "sizeof", "(", "buf", ")", ");", "if", "(", "copy_from_user", "(", "buf", ",", "buffer", ",", "size", ")", ")</s>if", "(", "copy_from_user", "(", "buf", ",", "buffer", ",", "count", ")", ")"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["Disable", "message", "interpolation", "in", "ConstraintViolations", "by", "default", "(#3208)", "Disable", "message", "interpolation", "in", "ConstraintViolations", "by", "default", "but", "allow", "enabling", "it", "explicitly", "with", "`SelfValidating#escapeExpressions()`.", "Additionally,", "`ConstraintViolations`", "now", "provides", "a", "set", "of", "methods", "which", "take", "a", "map", "of", "message", "parameters", "for", "interpolation.", "The", "message", "parameters", "will", "be", "escaped", "by", "default.", "Refs", "#3153", "Refs", "#3157"], "code_tokens": ["/", "*", "*", "Hibernate", "Validator", ",", "declare", "and", "validate", "application", "constraints", "*", "*", "License", ":", "Apache", "License", ",", "Version", "2", ".", "0", "*", "See", "the", "license", ".", "txt", "file", "in", "the", "root", "directory", "or", "<", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", ">", ".", "*", "/", "package", "io", ".", "dropwizard", ".", "validation", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "*", "Utilities", "used", "for", "message", "interpolation", ".", "*", "*", "@", "author", "Guillaume", "Smet", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "final", "class", "InterpolationHelper", "{", "public", "static", "final", "char", "BEGIN_TERM", "=", "'", "{'", ";", "public", "static", "final", "char", "END_TERM", "=", "'", "}'", ";", "public", "static", "final", "char", "EL_DESIGNATOR", "=", "'", "$'", ";", "public", "static", "final", "char", "ESCAPE_CHARACTER", "=", "'", "\\\\", "';", "private", "static", "final", "Pattern", "ESCAPE_MESSAGE_PARAMETER_PATTERN", "=", "Pattern", ".", "compile", "(", "\"(", "[\\", "\\\"", "+", "ESCAPE_CHARACTER", "+", "BEGIN_TERM", "+", "END_TERM", "+", "EL_DESIGNATOR", "+", "\"", "])", "\")", ";", "private", "InterpolationHelper", "(", ")", "{", "}", "@", "Nullable", "public", "static", "String", "escapeMessageParameter", "(", "@", "Nullable", "String", "messageParameter", ")", "{", "if", "(", "messageParameter", "=", "=", "null", ")", "{", "return", "null", ";", "}", "return", "ESCAPE_MESSAGE_PARAMETER_PATTERN", ".", "matcher", "(", "messageParameter", ")", ".", "replaceAll", "(", "Matcher", ".", "quoteReplacement", "(", "String", ".", "valueOf", "(", "ESCAPE_CHARACTER", ")", ")", "+", "\"", "$", "1", "\"", ");", "}", "}", "@", "@", "-", "7", ",", "6", "+", "7", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "/", "**", "*", "Escape", "EL", "expressions", "to", "avoid", "template", "injection", "attacks", ".", "*", "<", "p", ">", "*", "This", "has", "serious", "security", "implications", "and", "you", "will", "*", "have", "to", "escape", "the", "violation", "messages", "added", "to", "{", "@", "link", "ViolationCollector", "}", "appropriately", ".", "*", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Map", ")", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "String", ",", "Map", ")", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Integer", ",", "String", ",", "Map", ")", "*", "/", "boolean", "escapeExpressions", "(", ")", "default", "true", ";", "private", "boolean", "escapeExpressions", "=", "true", ";", "escapeExpressions", "=", "constraintAnnotation", ".", "escapeExpressions", "(", ");", "final", "ViolationCollector", "collector", "=", "new", "ViolationCollector", "(", "context", ",", "escapeExpressions", ")", ";", "import", "org", ".", "hibernate", ".", "validator", ".", "constraintvalidation", ".", "HibernateConstraintValidatorContext", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "io", ".", "dropwizard", ".", "validation", ".", "InterpolationHelper", ".", "escapeMessageParameter", ";", "private", "final", "ConstraintValidatorContext", "constraintValidatorContext", ";", "private", "final", "boolean", "escapeExpressions", ";", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "constraintValidatorContext", ")", "{", "this", "(", "constraintValidatorContext", ",", "true", ")", ";", "}", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "constraintValidatorContext", ",", "boolean", "escapeExpressions", ")", "{", "this", ".", "constraintValidatorContext", "=", "constraintValidatorContext", ";", "this", ".", "escapeExpressions", "=", "escapeExpressions", ";", "*", "<", "p", ">", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "see", "#", "addViolation", "(", "String", ",", "Map", ")", "addViolation", "(", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", "*", "<", "p", ">", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "see", "#", "addViolation", "(", "String", ",", "String", ",", "Map", ")", "addViolation", "(", "propertyName", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", "*", "Prefer", "the", "method", "with", "explicit", "message", "parameters", "if", "you", "want", "to", "interpolate", "the", "message", ".", "*", "@", "see", "ViolationCollector", "#", "addViolation", "(", "String", ",", "Integer", ",", "String", ",", "Map", ")", "addViolation", "(", "propertyName", ",", "index", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "index", "the", "index", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "Integer", "index", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "addViolation", "(", "propertyName", ",", "key", ",", "message", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "key", "the", "key", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "*", "@", "param", "messageParameters", "a", "map", "of", "message", "parameters", "which", "can", "be", "interpolated", "in", "the", "violation", "message", "*", "@", "since", "2", ".", "0", ".", "3", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "key", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "final", "String", "messageTemplate", "=", "sanitizeTemplate", "(", "message", ")", ";", "final", "HibernateConstraintValidatorContext", "context", "=", "getContextWithMessageParameters", "(", "messageParameters", ")", ";", "private", "HibernateConstraintValidatorContext", "getContextWithMessageParameters", "(", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "final", "HibernateConstraintValidatorContext", "context", "=", "constraintValidatorContext", ".", "unwrap", "(", "HibernateConstraintValidatorContext", ".", "class", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "messageParameter", ":", "messageParameters", ".", "entrySet", "(", "))", "{", "final", "Object", "value", "=", "messageParameter", ".", "getValue", "(", ");", "final", "String", "escapedValue", "=", "value", "=", "=", "null", "?", "null", ":", "escapeMessageParameter", "(", "value", ".", "toString", "(", "))", ";", "context", ".", "addMessageParameter", "(", "messageParameter", ".", "getKey", "(", "),", "escapedValue", ")", ";", "return", "context", ";", "}", "@", "Nullable", "private", "String", "sanitizeTemplate", "(", "@", "Nullable", "String", "message", ")", "{", "return", "escapeExpressions", "?", "escapeMessageParameter", "(", "message", ")", ":", "message", ";", "return", "constraintValidatorContext", ";", "import", "io", ".", "dropwizard", ".", "util", ".", "Maps", ";", "import", "java", ".", "util", ".", "Collections", ";", "col", ".", "addViolation", "(", "\"$", "\\\\", "A", "{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "TEST", "\"", "))", ";", "@", "SelfValidating", "(", "escapeExpressions", "=", "false", ")", "public", "static", "class", "EscapingDisabledExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"$", "{'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "\\\\", "A", "{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "TEST", "\"", "))", ";", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "1", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "key", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "}", "}", "@", "SelfValidating", "(", "escapeExpressions", "=", "false", ")", "public", "static", "class", "MessageParametersExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"{", "1", "+", "1", "}", "\")", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "No", "parameter", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "{", "unsetParameter", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "Mixed", "$", "{'", "value", "'", "}", "{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"", "Nested", "{", "value", "}", "\",", "Collections", ".", "singletonMap", "(", "\"", "value", "\"", ",", "\"", "${", "'", "nested", "'", "}\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "1", ",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "col", ".", "addViolation", "(", "\"{", "property", "}", "\",", "\"", "{", "key", "}", "\",", "\"", "{", "value", "}", "\",", "Maps", ".", "of", "(", "\"", "property", "\"", ",", "\"", "PROPERTY", "\"", ",", "\"", "key", "\"", ",", "\"", "KEY", "\"", ",", "\"", "value", "\"", ",", "\"", "VALUE", "\"", "))", ";", "}", "}", "public", "void", "violationMessagesAreEscapedByDefault", "(", ")", "{", "\"", "$", "\\\\", "A", "{", "1", "+", "1", "}", "\",", "\"", "{", "value", "}", "\",", "@", "Test", "public", "void", "violationMessagesAreInterpolatedIfEscapingDisabled", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "EscapingDisabledExample", "(", "))", "))", ".", "containsExactly", "(", "\"", "A2", "\"", ",", "\"", "TEST", "\"", ",", "\"", "value", "\"", ",", "\"", "${", "'", "property", "'", "}", "value", "\"", ",", "\"", "${", "'", "property", "'", "}[", "${", "'", "key", "'", "}]", "value", "\"", ",", "\"", "${", "'", "property", "'", "}[", "1", "]", "value", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "messageParametersExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "MessageParametersExample", "(", "))", "))", ".", "containsExactly", "(", "\"", "Mixed", "value", "VALUE", "\"", ",", "\"", "Nested", "$", "{'", "nested", "'", "}\"", ",", "\"", "No", "parameter", "\"", ",", "\"", "VALUE", "\"", ",", "\"", "VALUE", "{", "unsetParameter", "}", "\",", "\"", "value", "}", "\",", "\"", "{", "value", "}", "\",", "\"", "{", "1", "+", "1", "}", "\",", "\"", "{", "value", "\"", ",", "\"", "{", "property", "}", "VALUE", "\"", ",", "\"", "{", "property", "}", "[", "1", "]", "VALUE", "\"", ",", "\"", "{", "property", "}", "[{", "key", "}", "]", "VALUE", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", "}</s>final", "ViolationCollector", "collector", "=", "new", "ViolationCollector", "(", "context", ")", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "private", "static", "final", "Pattern", "ESCAPE_PATTERN", "=", "Pattern", ".", "compile", "(", "\"\\", "\\$", "\\\\", "{\"", ");", "private", "ConstraintValidatorContext", "context", ";", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "context", ")", "{", "this", ".", "context", "=", "context", ";", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "@", "Nullable", "private", "String", "escapeEl", "(", "@", "Nullable", "String", "s", ")", "{", "if", "(", "s", "=", "=", "null", "|", "|", "s", ".", "isEmpty", "(", "))", "{", "return", "s", ";", "}", "final", "Matcher", "m", "=", "ESCAPE_PATTERN", ".", "matcher", "(", "s", ")", ";", "final", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", "s", ".", "length", "(", ")", "+", "16", ")", ";", "while", "(", "m", ".", "find", "(", "))", "{", "m", ".", "appendReplacement", "(", "sb", ",", "\"", "\\\\", "\\\\", "\\\\", "${", "\")", ";", "m", ".", "appendTail", "(", "sb", ")", ";", "return", "sb", ".", "toString", "(", ");", "return", "context", ";", "public", "void", "violationMessagesAreEscaped", "(", ")", "{"], "docstring_tokens": ["remote", "code", "execution", "(rce", ")"]}
{"contents": ["crypto:", "algif", "-", "suppress", "sending", "source", "address", "information", "in", "recvmsg", "The", "current", "code", "does", "not", "set", "the", "msg_namelen", "member", "to", "0", "and", "therefore", "makes", "net/socket.c", "leak", "the", "local", "sockaddr_storage", "variable", "to", "userland", "--", "128", "bytes", "of", "kernel", "stack", "memory.", "Fix", "that.", "Cc:", "<stable@vger.kernel.org>", "#", "2.6.38", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "Herbert", "Xu", "<herbert@gondor.apana.org.au>"], "code_tokens": ["msg", "-", ">", "msg_namelen", "=", "0", ";", "msg", "-", ">", "msg_namelen", "=", "0", ";</s>"], "docstring_tokens": ["info", "leaks"]}
{"contents": ["HID:", "core:", "prevent", "out-of-bound", "readings", "Plugging", "a", "Logitech", "DJ", "receiver", "with", "KASAN", "activated", "raises", "a", "bunch", "of", "out-of-bound", "readings.", "The", "fields", "are", "allocated", "up", "to", "MAX_USAGE,", "meaning", "that", "potentially,", "we", "do", "not", "have", "enough", "fields", "to", "fit", "the", "incoming", "values.", "Add", "checks", "and", "silence", "KASAN.", "Signed-off-by:", "Benjamin", "Tissoires", "<benjamin.tissoires@redhat.com>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["value", "[", "n", "]", "-", "min", "<", "field", "-", ">", "maxusage", "&", "&", "&", "&", "field", "-", ">", "value", "[", "n", "]", "-", "min", "<", "field", "-", ">", "maxusage", "&", "&", "value", "[", "n", "]", "-", "min", "<", "field", "-", ">", "maxusage</s>"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["x86/mm/32:", "Enable", "full", "randomization", "on", "i386", "and", "X86_32", "Currently", "on", "i386", "and", "on", "X86_64", "when", "emulating", "X86_32", "in", "legacy", "mode,", "only", "the", "stack", "and", "the", "executable", "are", "randomized", "but", "not", "other", "mmapped", "files", "(libraries,", "vDSO,", "etc.).", "This", "patch", "enables", "randomization", "for", "the", "libraries,", "vDSO", "and", "mmap", "requests", "on", "i386", "and", "in", "X86_32", "in", "legacy", "mode.", "By", "default", "on", "i386", "there", "are", "8", "bits", "for", "the", "randomization", "of", "the", "libraries,", "vDSO", "and", "mmaps", "which", "only", "uses", "1MB", "of", "VA.", "This", "patch", "preserves", "the", "original", "randomness,", "using", "1MB", "of", "VA", "out", "of", "3GB", "or", "4GB.", "We", "think", "that", "1MB", "out", "of", "3GB", "is", "not", "a", "big", "cost", "for", "having", "the", "ASLR.", "The", "first", "obvious", "security", "benefit", "is", "that", "all", "objects", "are", "randomized", "(not", "only", "the", "stack", "and", "the", "executable)", "in", "legacy", "mode", "which", "highly", "increases", "the", "ASLR", "effectiveness,", "otherwise", "the", "attackers", "may", "use", "these", "non-randomized", "areas.", "But", "also", "sensitive", "setuid/setgid", "applications", "are", "more", "secure", "because", "currently,", "attackers", "can", "disable", "the", "randomization", "of", "these", "applications", "by", "setting", "the", "ulimit", "stack", "to", "\"unlimited\".", "This", "is", "a", "very", "old", "and", "widely", "known", "trick", "to", "disable", "the", "ASLR", "in", "i386", "which", "has", "been", "allowed", "for", "too", "long.", "Another", "trick", "used", "to", "disable", "the", "ASLR", "was", "to", "set", "the", "ADDR_NO_RANDOMIZE", "personality", "flag,", "but", "fortunately", "this", "doesn't", "work", "on", "setuid/setgid", "applications", "because", "there", "is", "security", "checks", "which", "clear", "Security-relevant", "flags.", "This", "patch", "always", "randomizes", "the", "mmap_legacy_base", "address,", "removing", "the", "possibility", "to", "disable", "the", "ASLR", "by", "setting", "the", "stack", "to", "\"unlimited\".", "Signed-off-by:", "Hector", "Marco-Gisbert", "<hecmargi@upv.es>", "Acked-by:", "Ismael", "Ripoll", "Ripoll", "<iripoll@upv.es>", "Acked-by:", "Kees", "Cook", "<keescook@chromium.org>", "Acked-by:", "Arjan", "van", "de", "Ven", "<arjan@linux.intel.com>", "Cc:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "akpm@linux-foundation.org", "Cc:", "kees", "Cook", "<keescook@chromium.org>", "Link:", "http://lkml.kernel.org/r/1457639460-5242-1-git-send-email-hecmargi@upv.es", "Signed-off-by:", "Ingo", "Molnar", "<mingo@kernel.org>"], "code_tokens": ["mm", "-", ">", "mmap_legacy_base", "=", "TASK_UNMAPPED_BASE", "+", "random_factor", ";</s>/", "*", "*", "Bottom", "-", "up", "(", "legacy", ")", "layout", "on", "X86_32", "did", "not", "support", "randomization", ",", "X86_64", "*", "does", ",", "but", "not", "when", "emulating", "X86_32", "*", "/", "static", "unsigned", "long", "mmap_legacy_base", "(", "unsigned", "long", "rnd", ")", "{", "if", "(", "mmap_is_ia32", "(", "))", "return", "TASK_UNMAPPED_BASE", ";", "else", "return", "TASK_UNMAPPED_BASE", "+", "rnd", ";", "}", "mm", "-", ">", "mmap_legacy_base", "=", "mmap_legacy_base", "(", "random_factor", ")", ";"], "docstring_tokens": ["disable", "aslr"]}
{"contents": ["Merge", "pull", "request", "#10496", "from", "playframework/rgc/json-fix-2.7.x", "[2.7.x]", "Fix", "Json", "issues:", "parse", "on", "form", "and", "tailrec", "deser"], "code_tokens": ["/", "*", "*", "Copyright", "(", "C", ")", "Lightbend", "Inc", ".", "<", "https", ":", "//", "www", ".", "lightbend", ".", "com", ">", "*", "/", "package", "play", ".", "it", ".", "http", ".", "parsing", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", "import", "akka", ".", "stream", ".", "Materializer", "import", "akka", ".", "stream", ".", "scaladsl", ".", "Source", "import", "akka", ".", "util", ".", "ByteString", "import", "com", ".", "fasterxml", ".", "jackson", ".", "core", ".", "JsonParser", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "JsonNode", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", "import", "org", ".", "specs2", ".", "execute", ".", "Failure", "import", "org", ".", "specs2", ".", "matcher", ".", "Matchers", "import", "play", ".", "api", ".", "Application", "import", "play", ".", "api", ".", "Configuration", "import", "play", ".", "api", ".", "test", ".", "_", "import", "play", ".", "libs", ".", "F", "import", "play", ".", "mvc", ".", "BodyParser", "import", "play", ".", "mvc", ".", "Http", "import", "play", ".", "mvc", ".", "Result", "import", "play", ".", "test", ".", "Helpers", "class", "JacksonJsonBodyParserSpec", "extends", "PlaySpecification", "with", "Matchers", "{", "/", "/", "Jackson", "Json", "support", "in", "Play", "relies", "on", "static", "/", "/", "global", "variables", "so", "these", "tests", "must", "run", "sequentially", "sequential", "private", "def", "tolerantJsonBodyParser", "(", "implicit", "app", ":", "Application", ")", ":", "BodyParser", "[", "JsonNode", "]", "=", "app", ".", "injector", ".", "instanceOf", "(", "classOf", "[", "BodyParser", ".", "TolerantJson", "]", ")", "\"", "The", "JSON", "body", "parser", "\"", "should", "{", "def", "parse", "(", "json", ":", "String", ")", "(", "implicit", "mat", ":", "Materializer", ",", "app", ":", "Application", ")", ":", "F", ".", "Either", "[", "Result", ",", "JsonNode", "]", "=", "{", "val", "encoding", ":", "String", "=", "\"", "utf", "-", "8", "\"", "val", "bodyParser", "=", "tolerantJsonBodyParser", "val", "fakeRequest", ":", "Http", ".", "RequestHeader", "=", "Helpers", ".", "fakeRequest", "(", ").", "header", "(", "CONTENT_TYPE", ",", "\"", "application", "/", "json", "\"", ").", "build", "(", ")", "await", "(", "bodyParser", "(", "fakeRequest", ")", ".", "asScala", "(", ").", "run", "(", "Source", ".", "single", "(", "ByteString", "(", "json", ".", "getBytes", "(", "encoding", ")", "))", ")", ")", "}", "\"", "uses", "JacksonJsonNodeModule", "\"", "in", "new", "WithApplication", "(", ")", "{", "private", "val", "mapper", ":", "ObjectMapper", "=", "implicitly", "[", "Application", "]", ".", "injector", ".", "instanceOf", "[", "ObjectMapper", "]", "mapper", ".", "getRegisteredModuleIds", ".", "contains", "(", "\"", "play", ".", "utils", ".", "JacksonJsonNodeModule", "\"", ")", "must_", "=", "=", "true", "}", "\"", "parse", "a", "simple", "JSON", "body", "with", "custom", "Jackson", "json", "-", "read", "-", "features", "\"", "in", "new", "WithApplication", "(", ")", "{", "val", "mapper", ":", "ObjectMapper", "=", "implicitly", "[", "Application", "]", ".", "injector", ".", "instanceOf", "[", "ObjectMapper", "]", "mapper", ".", "configure", "(", "JsonParser", ".", "Feature", ".", "ALLOW_SINGLE_QUOTES", ",", "true", ")", "val", "either", ":", "F", ".", "Either", "[", "Result", ",", "JsonNode", "]", "=", "parse", "(", "\"\"", "\"{", "'", "field1", "'", ":'", "value1", "'", "}", "\"\"", "\")", "either", ".", "left", ".", "ifPresent", "(", "verboseFailure", ")", "either", ".", "right", ".", "get", "(", ").", "get", "(", "\"", "field1", "\"", ").", "asText", "(", ")", "must_", "=", "==", "\"", "value1", "\"", "}", "\"", "parse", "very", "deep", "JSON", "bodies", "\"", "in", "new", "WithApplication", "(", ")", "{", "val", "depth", "=", "50000", "private", "val", "either", ":", "F", ".", "Either", "[", "Result", ",", "JsonNode", "]", "=", "parse", "(", "s", "\"", "\"\"", "{\"", "foo", "\"", ":", "$", "{\"", "[\"", "*", "depth", "}", "\"", "asdf", "\"", "$", "{\"", "]\"", "*", "depth", "}", "}", "\"\"", "\")", "private", "var", "node", ":", "JsonNode", "=", "either", ".", "right", ".", "get", "(", ").", "at", "(", "\"/", "foo", "\"", ")", "while", "(", "node", ".", "isArray", ")", "{", "node", "=", "node", ".", "get", "(", "0", ")", "}", "node", ".", "asText", "(", ")", "must_", "=", "=", "\"", "asdf", "\"", "}", "}", "def", "verboseFailure", "(", "result", ":", "Result", ")", "(", "implicit", "mat", ":", "Materializer", ")", ":", "Failure", "=", "{", "val", "errorMessage", "=", "s", "\"", "\"\"", "Parse", "failure", ".", "Play", "-", "produced", "error", "HTML", "page", ":", "|", "$", "{", "resultToString", "(", "result", ")", "}", "|", "\"\"", "\".", "stripMargin", "failure", "(", "errorMessage", ")", "}", "def", "resultToString", "(", "r", ":", "Result", ")", "(", "implicit", "mat", ":", "Materializer", ")", ":", "String", "=", "{", "r", ".", "body", "(", ")", ".", "consumeData", "(", "mat", ")", ".", "toCompletableFuture", ".", "get", "(", "6", ",", "TimeUnit", ".", "SECONDS", ")", ".", "utf8String", "}", "}", "@", "@", "-", "4", ",", "14", "+", "4", ",", "13", "@", "@", "import", "scala", ".", "concurrent", ".", "Future", "import", "javax", ".", "inject", ".", "_", "object", "ObjectMapperProvider", "{", "val", "BINDING_NAME", "=", "\"", "play", "\"", "}", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "*;", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "module", ".", "SimpleModule", ";", "import", "play", ".", "utils", ".", "JacksonJsonNodeModule", ";", "import", "play", ".", "utils", ".", "JsonNodeDeserializer", ";", "import", "java", ".", "io", ".", "IOException", ";", "mapper", ".", "registerModule", "(", "new", "JacksonJsonNodeModule", "(", "))", ";", "import", "akka", ".", "annotation", ".", "InternalApi", "import", "org", ".", "slf4j", ".", "Logger", "import", "org", ".", "slf4j", ".", "LoggerFactory", "import", "scala", ".", "language", ".", "existentials", "import", "play", ".", "api", ".", "data", ".", "format", ".", "_", "import", "play", ".", "api", ".", "libs", ".", "json", ".", "JsValue", "import", "scala", ".", "util", ".", "control", ".", "NoStackTrace", "private", "val", "logger", ":", "Logger", "=", "LoggerFactory", ".", "getLogger", "(", "classOf", "[", "Form", "[", "T", "]", "])", "@", "deprecated", "(", "\"", "Use", "bind", "(", "JsValue", ",", "Int", ")", "instead", "to", "specify", "the", "maximum", "chars", "that", "should", "be", "consumed", "by", "the", "flattened", "form", "representation", "of", "the", "JSON", "\"", ",", "\"", "2", ".", "8", ".", "3", "\"", ")", "def", "bind", "(", "data", ":", "JsValue", ")", ":", "Form", "[", "T", "]", "=", "{", "logger", ".", "warn", "(", "s", "\"", "Binding", "json", "field", "from", "form", "with", "a", "hardcoded", "max", "size", "of", "$", "{", "Form", ".", "FromJsonMaxChars", "}", "bytes", ".", "This", "is", "deprecated", ".", "Use", "bind", "(", "JsValue", ",", "Int", ")", "instead", ".", "\"", ")", "bind", "(", "FormUtils", ".", "fromJson", "(", "data", ",", "Form", ".", "FromJsonMaxChars", ")", ")", "}", "/", "**", "*", "Binds", "data", "to", "this", "form", ",", "i", ".", "e", ".", "handles", "form", "submission", ".", "*", "*", "@", "param", "data", "Json", "data", "to", "submit", "*", "@", "param", "maxChars", "The", "maximum", "number", "of", "chars", "allowed", "to", "be", "used", "in", "the", "intermediate", "map", "representation", "*", "of", "the", "JSON", ".", "`", "parse", ".", "DefaultMaxTextLength", "`", "is", "recommended", "to", "passed", "for", "this", "parameter", ".", "*", "@", "return", "a", "copy", "of", "this", "form", ",", "filled", "with", "the", "new", "data", "*", "/", "def", "bind", "(", "data", ":", "JsValue", ",", "maxChars", ":", "Int", ")", ":", "Form", "[", "T", "]", "=", "bind", "(", "FormUtils", ".", "fromJson", "(", "data", ",", "maxChars", ")", ")", "FormUtils", ".", "fromJson", "(", "body", ".", "asJson", ".", "get", ",", "Form", ".", "FromJsonMaxChars", ")", ".", "mapValues", "(", "Seq", "(", "_", ")", ")", "case", "body", ":", "play", ".", "api", ".", "libs", ".", "json", ".", "JsValue", "=", ">", "FormUtils", ".", "fromJson", "(", "body", ",", "Form", ".", "FromJsonMaxChars", ")", ".", "mapValues", "(", "Seq", "(", "_", ")", ")", "/", "**", "*", "INTERNAL", "API", "*", "*", "Default", "maximum", "number", "of", "chars", "allowed", "to", "be", "used", "in", "the", "intermediate", "map", "representation", "of", "the", "*", "JSON", ".", "Defaults", "to", "100k", "which", "is", "the", "default", "of", "parser", ".", "maxMemoryBuffer", "*", "/", "@", "InternalApi", "val", "FromJsonMaxChars", ":", "Long", "=", "102400", "def", "fromJson", "(", "js", ":", "JsValue", ",", "maxChars", ":", "Long", ")", ":", "Map", "[", "String", ",", "String", "]", "=", "doFromJson", "(", "FromJsonRoot", "(", "js", ")", ",", "Map", ".", "empty", ",", "0", ",", "maxChars", ")", "@", "annotation", ".", "tailrec", "private", "def", "doFromJson", "(", "context", ":", "FromJsonContext", ",", "form", ":", "Map", "[", "String", ",", "String", "]", ",", "cumulativeChars", ":", "Int", ",", "maxChars", ":", "Long", ")", ":", "Map", "[", "String", ",", "String", "]", "=", "context", "match", "{", "case", "FromJsonTerm", "=", ">", "form", "case", "ctx", ":", "FromJsonContextValue", "=", ">", "/", "/", "Ensure", "this", "contexts", "next", "is", "initialised", ",", "this", "prevents", "unbounded", "recursion", ".", "ctx", ".", "next", "ctx", ".", "value", "match", "{", "case", "obj", ":", "JsObject", "if", "obj", ".", "fields", ".", "nonEmpty", "=", ">", "doFromJson", "(", "FromJsonObject", "(", "ctx", ",", "obj", ".", "fields", ".", "toIndexedSeq", ",", "0", ")", ",", "form", ",", "cumulativeChars", ",", "maxChars", ")", "case", "JsArray", "(", "values", ")", "if", "values", ".", "nonEmpty", "=", ">", "doFromJson", "(", "FromJsonArray", "(", "ctx", ",", "values", ",", "0", ")", ",", "form", ",", "cumulativeChars", ",", "maxChars", ")", "case", "JsNull", "|", "JsArray", "(", "_", ")", "|", "JsObject", "(", "_", ")", "=", ">", "doFromJson", "(", "ctx", ".", "next", ",", "form", ",", "cumulativeChars", ",", "maxChars", ")", "case", "simple", "=", ">", "val", "value", "=", "simple", "match", "{", "case", "JsString", "(", "v", ")", "=", ">", "v", "case", "JsNumber", "(", "v", ")", "=", ">", "v", ".", "toString", "case", "JsBoolean", "(", "v", ")", "=", ">", "v", ".", "toString", "}", "val", "prefix", "=", "ctx", ".", "prefix", "val", "newCumulativeChars", "=", "cumulativeChars", "+", "prefix", ".", "length", "+", "value", ".", "length", "if", "(", "newCumulativeChars", ">", "maxChars", ")", "{", "throw", "FormJsonExpansionTooLarge", "(", "maxChars", ")", "}", "doFromJson", "(", "ctx", ".", "next", ",", "form", ".", "updated", "(", "prefix", ",", "value", ")", ",", "newCumulativeChars", ",", "maxChars", ")", "}", "}", "private", "sealed", "trait", "FromJsonContext", "private", "sealed", "trait", "FromJsonContextValue", "extends", "FromJsonContext", "{", "def", "value", ":", "JsValue", "def", "prefix", ":", "String", "def", "next", ":", "FromJsonContext", "}", "private", "case", "object", "FromJsonTerm", "extends", "FromJsonContext", "private", "case", "class", "FromJsonRoot", "(", "value", ":", "JsValue", ")", "extends", "FromJsonContextValue", "{", "override", "def", "prefix", "=", "\"", "\"", "override", "def", "next", ":", "FromJsonContext", "=", "FromJsonTerm", "}", "private", "case", "class", "FromJsonArray", "(", "parent", ":", "FromJsonContextValue", ",", "values", ":", "scala", ".", "collection", ".", "IndexedSeq", "[", "JsValue", "]", ",", "idx", ":", "Int", ")", "extends", "FromJsonContextValue", "{", "override", "def", "value", ":", "JsValue", "=", "values", "(", "idx", ")", "override", "val", "prefix", ":", "String", "=", "s", "\"", "${", "parent", ".", "prefix", "}", "[$", "idx", "]", "\"", "override", "lazy", "val", "next", ":", "FromJsonContext", "=", "if", "(", "idx", "+", "1", "<", "values", ".", "length", ")", "{", "FromJsonArray", "(", "parent", ",", "values", ",", "idx", "+", "1", ")", "}", "else", "{", "parent", ".", "next", "}", "private", "case", "class", "FromJsonObject", "(", "parent", ":", "FromJsonContextValue", ",", "fields", ":", "IndexedSeq", "[", "(", "String", ",", "JsValue", ")", "],", "idx", ":", "Int", ")", "extends", "FromJsonContextValue", "{", "override", "def", "value", ":", "JsValue", "=", "fields", "(", "idx", ")", ".", "_2", "override", "val", "prefix", ":", "String", "=", "if", "(", "parent", ".", "prefix", ".", "isEmpty", ")", "{", "fields", "(", "idx", ")", ".", "_1", "}", "else", "{", "parent", ".", "prefix", "+", "\"", ".\"", "+", "fields", "(", "idx", ")", ".", "_1", "}", "override", "lazy", "val", "next", ":", "FromJsonContext", "=", "if", "(", "idx", "+", "1", "<", "fields", ".", "length", ")", "{", "FromJsonObject", "(", "parent", ",", "fields", ",", "idx", "+", "1", ")", "}", "else", "{", "parent", ".", "next", "case", "class", "FormJsonExpansionTooLarge", "(", "limit", ":", "Long", ")", "extends", "RuntimeException", "(", "s", "\"", "Binding", "form", "from", "JSON", "exceeds", "form", "expansion", "limit", "of", "$", "limit", "\"", ")", "with", "NoStackTrace", "@", "@", "-", "0", ",", "0", "+", "1", ",", "186", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "Lightbend", "Inc", ".", "<", "https", ":", "//", "www", ".", "lightbend", ".", "com", ">", "*", "/", "package", "play", ".", "utils", "import", "java", ".", "math", ".", "MathContext", "import", "scala", ".", "annotation", ".", "switch", "import", "scala", ".", "annotation", ".", "tailrec", "import", "scala", ".", "collection", ".", "mutable", "import", "scala", ".", "collection", ".", "mutable", ".", "ArrayBuffer", "import", "scala", ".", "collection", ".", "mutable", ".", "ListBuffer", "import", "com", ".", "fasterxml", ".", "jackson", ".", "core", ".", "JsonParser", "import", "com", ".", "fasterxml", ".", "jackson", ".", "core", ".", "JsonTokenId", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", ".", "USE_BIG_INTEGER_FOR_INTS", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", ".", "USE_LONG_FOR_INTS", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "_", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "module", ".", "SimpleModule", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "node", ".", "_", "private", "sealed", "trait", "DeserializerContext", "{", "def", "addValue", "(", "value", ":", "JsonNode", ")", ":", "DeserializerContext", "}", "private", "case", "class", "ReadingList", "(", "content", ":", "mutable", ".", "ArrayBuffer", "[", "JsonNode", "]", ")", "extends", "DeserializerContext", "{", "override", "def", "addValue", "(", "value", ":", "JsonNode", ")", ":", "DeserializerContext", "=", "{", "ReadingList", "(", "content", "+", "=", "value", ")", "}", "}", "/", "/", "Context", "for", "reading", "an", "Object", "private", "case", "class", "KeyRead", "(", "content", ":", "ListBuffer", "[", "(", "String", ",", "JsonNode", ")", "],", "fieldName", ":", "String", ")", "extends", "DeserializerContext", "{", "def", "addValue", "(", "value", ":", "JsonNode", ")", ":", "DeserializerContext", "=", "ReadingMap", "(", "content", "+", "=", "(", "fieldName", "-", ">", "value", ")", ")", "}", "/", "/", "Context", "for", "reading", "one", "item", "of", "an", "Object", "(", "we", "already", "red", "fieldName", ")", "private", "case", "class", "ReadingMap", "(", "content", ":", "ListBuffer", "[", "(", "String", ",", "JsonNode", ")", "])", "extends", "DeserializerContext", "{", "def", "setField", "(", "fieldName", ":", "String", ")", "=", "KeyRead", "(", "content", ",", "fieldName", ")", "def", "addValue", "(", "value", ":", "JsonNode", ")", ":", "DeserializerContext", "=", "throw", "new", "Exception", "(", "\"", "Cannot", "add", "a", "value", "on", "an", "object", "without", "a", "key", ",", "malformed", "JSON", "object", "!", "\")", "}", "class", "JacksonJsonNodeModule", "extends", "SimpleModule", "{", "override", "def", "getModuleName", "=", "\"", "JacksonJsonNodeModule", "\"", "addDeserializer", "(", "classOf", "[", "JsonNode", "]", ",", "new", "JsonNodeDeserializer", "(", "))", "}", "object", "JacksonJsonNodeModule", "extends", "JacksonJsonNodeModule", "private", "class", "JsonNodeDeserializer", "extends", "JsonDeserializer", "[", "JsonNode", "]", "{", "override", "def", "isCachable", ":", "Boolean", "=", "true", "override", "def", "deserialize", "(", "jp", ":", "JsonParser", ",", "ctxt", ":", "DeserializationContext", ")", ":", "JsonNode", "=", "deserialize", "(", "jp", ",", "ctxt", ",", "Nil", ")", "/", "/=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "/", "/", "NOTE", ":", "the", "following", "two", "methods", "are", "re", "-", "encoding", "part", "of", "/", "/", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "deser", ".", "std", ".", "JsonNodeDeserializer", "private", "val", "F_MASK_INT_COERCIONS", ":", "Int", "=", "USE_BIG_INTEGER_FOR_INTS", ".", "getMask", "|", "USE_LONG_FOR_INTS", ".", "getMask", "/", "*", "re", "-", "encoding", "of", "part", "of", "JsonNodeDeserializer", "(", "jackson", "-", "databind", "2", ".", "10", ".", "5", ")", "*", "https", ":", "//", "github", ".", "com", "/", "FasterXML", "/", "jackson", "-", "databind", "/", "blob", "/", "jackson", "-", "databind", "-", "2", ".", "10", ".", "5", "/", "src", "/", "main", "/", "java", "/", "com", "/", "fasterxml", "/", "jackson", "/", "databind", "/", "deser", "/", "std", "/", "JsonNodeDeserializer", ".", "java", "#", "L556", "-", "L579", "*", "TODO", ":", "remove", "when", "jackson", "-", "databind", "2", ".", "12", "is", "out", "*", "/", "private", "def", "fromInt", "(", "jp", ":", "JsonParser", ",", "ctxt", ":", "DeserializationContext", ")", ":", "JsonNode", "=", "{", "val", "feats", "=", "ctxt", ".", "getDeserializationFeatures", "val", "nodeFactory", "=", "ctxt", ".", "getNodeFactory", "val", "numberType", "=", "if", "(", "(", "feats", "&", "F_MASK_INT_COERCIONS", ")", "!", "=", "0", ")", "{", "if", "(", "USE_BIG_INTEGER_FOR_INTS", ".", "enabledIn", "(", "feats", ")", ")", "JsonParser", ".", "NumberType", ".", "BIG_INTEGER", "else", "if", "(", "USE_LONG_FOR_INTS", ".", "enabledIn", "(", "feats", ")", ")", "JsonParser", ".", "NumberType", ".", "LONG", "else", "jp", ".", "getNumberType", "}", "else", "jp", ".", "getNumberType", "numberType", "match", "{", "case", "JsonParser", ".", "NumberType", ".", "INT", "=", ">", "nodeFactory", ".", "numberNode", "(", "jp", ".", "getIntValue", ")", "case", "JsonParser", ".", "NumberType", ".", "LONG", "=", ">", "nodeFactory", ".", "numberNode", "(", "jp", ".", "getLongValue", ")", "case", "_", "=", ">", "nodeFactory", ".", "numberNode", "(", "jp", ".", "getBigIntegerValue", ")", "}", "}", "/", "*", "re", "-", "encoding", "of", "part", "of", "JsonNodeDeserializer", "(", "jackson", "-", "databind", "2", ".", "10", ".", "5", ")", "*", "https", ":", "//", "github", ".", "com", "/", "FasterXML", "/", "jackson", "-", "databind", "/", "blob", "/", "jackson", "-", "databind", "-", "2", ".", "10", ".", "5", "/", "src", "/", "main", "/", "java", "/", "com", "/", "fasterxml", "/", "jackson", "/", "databind", "/", "deser", "/", "std", "/", "JsonNodeDeserializer", ".", "java", "#", "L581", "-", "L600", "*", "TODO", ":", "remove", "when", "jackson", "-", "databind", "2", ".", "12", "is", "out", "*", "/", "private", "def", "fromFloat", "(", "jp", ":", "JsonParser", ",", "ctxt", ":", "DeserializationContext", ")", ":", "JsonNode", "=", "{", "val", "nodeFactory", "=", "ctxt", ".", "getNodeFactory", "val", "nt", "=", "jp", ".", "getNumberType", "if", "(", "nt", "eq", "JsonParser", ".", "NumberType", ".", "BIG_DECIMAL", ")", "{", "nodeFactory", ".", "numberNode", "(", "jp", ".", "getDecimalValue", ")", "}", "else", "if", "(", "ctxt", ".", "isEnabled", "(", "DeserializationFeature", ".", "USE_BIG_DECIMAL_FOR_FLOATS", ")", ")", "{", "if", "(", "jp", ".", "isNaN", ")", "nodeFactory", ".", "numberNode", "(", "jp", ".", "getDoubleValue", ")", "else", "nodeFactory", ".", "numberNode", "(", "jp", ".", "getDecimalValue", ")", "}", "else", "if", "(", "nt", "eq", "JsonParser", ".", "NumberType", ".", "FLOAT", ")", "{", "nodeFactory", ".", "numberNode", "(", "jp", ".", "getFloatValue", ")", "}", "else", "{", "nodeFactory", ".", "numberNode", "(", "jp", ".", "getDoubleValue", ")", "}", "}", "/", "/=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "@", "tailrec", "final", "def", "deserialize", "(", "jp", ":", "JsonParser", ",", "ctxt", ":", "DeserializationContext", ",", "parserContext", ":", "List", "[", "DeserializerContext", "]", ")", ":", "JsonNode", "=", "{", "if", "(", "jp", ".", "getCurrentToken", "=", "=", "null", ")", "{", "jp", ".", "nextToken", "(", ")", "}", "val", "(", "maybeValue", ",", "nextContext", ")", "=", "(", "jp", ".", "getCurrentToken", ".", "id", "(", "):", "@", "switch", ")", "match", "{", "case", "JsonTokenId", ".", "ID_NUMBER_INT", "=", ">", "(", "Some", "(", "fromInt", "(", "jp", ",", "ctxt", ")", "),", "parserContext", ")", "case", "JsonTokenId", ".", "ID_NUMBER_FLOAT", "=", ">", "(", "Some", "(", "fromFloat", "(", "jp", ",", "ctxt", ")", "),", "parserContext", ")", "case", "JsonTokenId", ".", "ID_STRING", "=", ">", "(", "Some", "(", "new", "TextNode", "(", "jp", ".", "getText", ")", "),", "parserContext", ")", "case", "JsonTokenId", ".", "ID_TRUE", "=", ">", "(", "Some", "(", "BooleanNode", ".", "TRUE", ")", ",", "parserContext", ")", "case", "JsonTokenId", ".", "ID_FALSE", "=", ">", "(", "Some", "(", "BooleanNode", ".", "FALSE", ")", ",", "parserContext", ")", "case", "JsonTokenId", ".", "ID_NULL", "=", ">", "(", "Some", "(", "NullNode", ".", "instance", ")", ",", "parserContext", ")", "case", "JsonTokenId", ".", "ID_START_ARRAY", "=", ">", "(", "None", ",", "ReadingList", "(", "ArrayBuffer", "(", "))", "+", ":", "parserContext", ")", "case", "JsonTokenId", ".", "ID_END_ARRAY", "=", ">", "parserContext", "match", "{", "case", "ReadingList", "(", "content", ")", ":", ":", "stack", "=", ">", "val", "node", "=", "new", "ArrayNode", "(", "ctxt", ".", "getNodeFactory", ")", "content", ".", "foreach", "(", "node", ".", "add", ")", "(", "Some", "(", "node", ")", ",", "stack", ")", "case", "_", "=", ">", "throw", "new", "RuntimeException", "(", "\"", "We", "should", "have", "been", "reading", "list", ",", "something", "got", "wrong", "\"", ")", "}", "case", "JsonTokenId", ".", "ID_START_OBJECT", "=", ">", "(", "None", ",", "ReadingMap", "(", "ListBuffer", "(", "))", "+", ":", "parserContext", ")", "case", "JsonTokenId", ".", "ID_FIELD_NAME", "=", ">", "parserContext", "match", "{", "case", "(", "c", ":", "ReadingMap", ")", ":", ":", "stack", "=", ">", "(", "None", ",", "c", ".", "setField", "(", "jp", ".", "getCurrentName", ")", "+", ":", "stack", ")", "case", "_", "=", ">", "throw", "new", "RuntimeException", "(", "\"", "We", "should", "be", "reading", "map", ",", "something", "got", "wrong", "\"", ")", "}", "case", "JsonTokenId", ".", "ID_END_OBJECT", "=", ">", "parserContext", "match", "{", "case", "ReadingMap", "(", "content", ")", ":", ":", "stack", "=", ">", "val", "node", "=", "new", "ObjectNode", "(", "ctxt", ".", "getNodeFactory", ")", "content", ".", "foreach", "{", "case", "(", "k", ",", "v", ":", "JsonNode", ")", "=", ">", "node", ".", "set", "(", "k", ",", "v", ")", "}", "(", "Some", "(", "node", ")", ",", "stack", ")", "case", "_", "=", ">", "throw", "new", "RuntimeException", "(", "\"", "We", "should", "have", "been", "reading", "an", "object", ",", "something", "got", "wrong", "\"", ")", "}", "case", "JsonTokenId", ".", "ID_NOT_AVAILABLE", "=", ">", "throw", "new", "RuntimeException", "(", "\"", "We", "should", "have", "been", "reading", "an", "object", ",", "something", "got", "wrong", "\"", ")", "case", "JsonTokenId", ".", "ID_EMBEDDED_OBJECT", "=", ">", "throw", "new", "RuntimeException", "(", "\"", "We", "should", "have", "been", "reading", "an", "object", ",", "something", "got", "wrong", "\"", ")", "}", "/", "/", "Read", "ahead", "jp", ".", "nextToken", "(", ")", "maybeValue", "match", "{", "case", "Some", "(", "v", ")", "if", "nextContext", ".", "isEmpty", "=", ">", "/", "/", "done", ",", "no", "more", "tokens", "and", "got", "a", "value", "!", "/", "/", "note", ":", "jp", ".", "getCurrentToken", "=", "=", "null", "happens", "when", "using", "treeToValue", "(", "we", "'", "re", "not", "parsing", "tokens", ")", "v", "case", "maybeValue", "=", ">", "val", "toPass", "=", "maybeValue", ".", "map", "{", "v", "=", ">", "val", "previous", ":", ":", "stack", "=", "nextContext", "(", "previous", ".", "addValue", "(", "v", ")", ")", "+", ":", "stack", "}", ".", "getOrElse", "(", "nextContext", ")", "deserialize", "(", "jp", ",", "ctxt", ",", "toPass", ")", "}", "}", "/", "/", "This", "is", "used", "when", "the", "root", "object", "is", "null", ",", "ie", "when", "deserializing", "\"", "null", "\"", "override", "val", "getNullValue", "=", "NullNode", ".", "instance", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "55", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "Lightbend", "Inc", ".", "<", "https", ":", "//", "www", ".", "lightbend", ".", "com", ">", "*", "/", "package", "play", ".", "utils", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonCreator", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonIgnoreProperties", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonProperty", ";", "import", "java", ".", "math", ".", "BigDecimal", ";", "import", "java", ".", "math", ".", "BigInteger", ";", "import", "java", ".", "util", ".", "Objects", ";", "/", "**", "*", "/", "public", "class", "BigNumericJavaPojo", "{", "private", "final", "BigInteger", "intValue", ";", "private", "final", "BigDecimal", "floatValue", ";", "@", "JsonCreator", "public", "BigNumericJavaPojo", "(", "@", "JsonProperty", "(", "\"", "intValue", "\"", ")", "BigInteger", "intValue", ",", "@", "JsonProperty", "(", "\"", "floatValue", "\"", ")", "BigDecimal", "floatValue", ")", "{", "this", ".", "intValue", "=", "intValue", ";", "this", ".", "floatValue", "=", "floatValue", ";", "}", "public", "BigInteger", "getIntValue", "(", ")", "{", "return", "intValue", ";", "}", "public", "BigDecimal", "getFloatValue", "(", ")", "{", "return", "floatValue", ";", "}", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", "))", "return", "false", ";", "BigNumericJavaPojo", "that", "=", "(", "BigNumericJavaPojo", ")", "o", ";", "return", "Objects", ".", "equals", "(", "intValue", ",", "that", ".", "intValue", ")", "&", "&", "Objects", ".", "equals", "(", "floatValue", ",", "that", ".", "floatValue", ")", ";", "}", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "intValue", ",", "floatValue", ")", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "BigNumericJavaPojo", "{", "\"", "+", "\"", "intValue", "=", "\"", "+", "intValue", "+", "\"", ",", "floatValue", "=", "\"", "+", "floatValue", "+", "'", "}'", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "Lightbend", "Inc", ".", "<", "https", ":", "//", "www", ".", "lightbend", ".", "com", ">", "*", "/", "package", "play", ".", "utils", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonCreator", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonProperty", ";", "import", "java", ".", "util", ".", "Objects", ";", "/", "**", "*", "/", "public", "class", "PrimitiveNumericJavaPojo", "{", "private", "final", "int", "intValue", ";", "private", "final", "long", "longValue", ";", "private", "final", "float", "floatValue", ";", "private", "final", "double", "doubleValue", ";", "@", "JsonCreator", "public", "PrimitiveNumericJavaPojo", "(", "@", "JsonProperty", "(", "\"", "intValue", "\"", ")", "int", "intValue", ",", "@", "JsonProperty", "(", "\"", "longValue", "\"", ")", "long", "longValue", ",", "@", "JsonProperty", "(", "\"", "floatValue", "\"", ")", "float", "floatValue", ",", "@", "JsonProperty", "(", "\"", "doubleValue", "\"", ")", "double", "doubleValue", ")", "{", "this", ".", "intValue", "=", "intValue", ";", "this", ".", "longValue", "=", "longValue", ";", "this", ".", "floatValue", "=", "floatValue", ";", "this", ".", "doubleValue", "=", "doubleValue", ";", "}", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", "))", "return", "false", ";", "PrimitiveNumericJavaPojo", "that", "=", "(", "PrimitiveNumericJavaPojo", ")", "o", ";", "return", "intValue", "=", "=", "that", ".", "intValue", "&", "&", "longValue", "=", "=", "that", ".", "longValue", "&", "&", "Float", ".", "compare", "(", "that", ".", "floatValue", ",", "floatValue", ")", "=", "=", "0", "&", "&", "Double", ".", "compare", "(", "that", ".", "doubleValue", ",", "doubleValue", ")", "=", "=", "0", ";", "}", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "intValue", ",", "longValue", ",", "floatValue", ",", "doubleValue", ")", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "PrimitiveNumericJavaPojo", "{", "\"", "+", "\"", "intValue", "=", "\"", "+", "intValue", "+", "\"", ",", "longValue", "=", "\"", "+", "longValue", "+", "\"", ",", "floatValue", "=", "\"", "+", "floatValue", "+", "\"", ",", "doubleValue", "=", "\"", "+", "doubleValue", "+", "'", "}'", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "120", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "Lightbend", "Inc", ".", "<", "https", ":", "//", "www", ".", "lightbend", ".", "com", ">", "*", "/", "package", "play", ".", "api", ".", "data", "import", "org", ".", "specs2", ".", "mutable", ".", "Specification", "import", "play", ".", "api", ".", "libs", ".", "json", ".", "JsNull", "import", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", "class", "FormUtilsSpec", "extends", "Specification", "{", "\"", "FormUtils", ".", "fromJson", "\"", "should", "{", "\"", "convert", "a", "complex", "json", "structure", "to", "a", "map", "\"", "in", "{", "val", "json", "=", "Json", ".", "obj", "(", "\"", "arr", "\"", "-", ">", "Json", ".", "arr", "(", "Json", ".", "obj", "(", "\"", "a", "\"", "-", ">", "\"", "an", "-", "a", "\"", ",", "\"", "b", "\"", "-", ">", "true", ",", "\"", "c", "\"", "-", ">", "JsNull", ",", "\"", "d", "\"", "-", ">", "10", ")", ",", "\"", "str", "\"", ",", "20", ",", "\"", "blah", "\"", ")", ",", "\"", "e", "\"", "-", ">", "Json", ".", "obj", "(", "\"", "f", "\"", "-", ">", "\"", "an", "-", "f", "\"", ",", "\"", "g", "\"", "-", ">", "false", ")", ",", "\"", "h", "\"", "-", ">", "\"", "an", "-", "h", "\"", ",", "\"", "i", "\"", "-", ">", "30", ",", "\"", "j", "\"", "-", ">", "Json", ".", "arr", "(", "Json", ".", "arr", "(", "40", ")", ")", ")", "val", "expected", "=", "Seq", "(", "\"", "arr", "[", "0", "]", ".", "a", "\"", "-", ">", "\"", "an", "-", "a", "\"", ",", "\"", "arr", "[", "0", "]", ".", "b", "\"", "-", ">", "\"", "true", "\"", ",", "\"", "arr", "[", "0", "]", ".", "d", "\"", "-", ">", "\"", "10", "\"", ",", "\"", "arr", "[", "1", "]", "\"", "-", ">", "\"", "str", "\"", ",", "\"", "arr", "[", "2", "]", "\"", "-", ">", "\"", "20", "\"", ",", "\"", "arr", "[", "3", "]", "\"", "-", ">", "\"", "blah", "\"", ",", "\"", "e", ".", "f", "\"", "-", ">", "\"", "an", "-", "f", "\"", ",", "\"", "e", ".", "g", "\"", "-", ">", "\"", "false", "\"", ",", "\"", "h", "\"", "-", ">", "\"", "an", "-", "h", "\"", ",", "\"", "i", "\"", "-", ">", "\"", "30", "\"", ",", "\"", "j", "[", "0", "]", "[", "0", "]", "\"", "-", ">", "\"", "40", "\"", ")", "val", "map", "=", "FormUtils", ".", "fromJson", "(", "json", ",", "1000", ")", "map", ".", "toSeq", "must", "containTheSameElementsAs", "(", "expected", ")", "}", "\"", "not", "stack", "overflow", "when", "converting", "heavily", "nested", "arrays", "\"", "in", "{", "try", "{", "FormUtils", ".", "fromJson", "(", "Json", ".", "parse", "(", "\"{", "\\\"", "arr", "\\", "\":", "\"", "+", "(", "\"[", "\"", "*", "10000", ")", "+", "\"", "1", "\"", "+", "(", "\"]", "\"", "*", "10000", ")", "+", "\"", "}\"", "),", "1000000", ")", "}", "catch", "{", "case", "e", ":", "StackOverflowError", "=", ">", "ko", "(", "\"", "StackOverflowError", "thrown", "\"", ")", "}", "ok", "}", "\"", "parse", "normally", "when", "the", "input", "is", "small", "enough", "\"", "in", "{", "val", "keyLength", "=", "10", "val", "itemCount", "=", "10", "val", "maxChars", "=", "500", "*", "1000", "/", "/", "a", "limit", "we", "'", "re", "not", "reaching", "try", "{", "FormUtils", ".", "fromJson", "(", "Json", ".", "obj", "(", "\"", "a", "\"", "*", "keyLength", "-", ">", "Json", ".", "arr", "(", "0", "to", "itemCount", ")", "),", "maxChars", ")", "}", "catch", "{", "case", "_", ":", "OutOfMemoryError", "=", ">", "ko", "(", "\"", "OutOfMemoryError", "\"", ")", "}", "ok", "}", "\"", "abort", "parsing", "when", "maximum", "memory", "is", "used", "\"", "in", "{", "/", "/", "Even", "when", "the", "JSON", "is", "small", ",", "if", "the", "memory", "limit", "is", "exceed", "the", "parsing", "must", "stop", ".", "val", "keyLength", "=", "10", "val", "itemCount", "=", "10", "val", "maxChars", "=", "3", "/", "/", "yeah", ",", "maxChars", "is", "only", "3", "chars", ".", "We", "want", "to", "hit", "the", "limit", ".", "(", "try", "{", "FormUtils", ".", "fromJson", "(", "Json", ".", "obj", "(", "\"", "a", "\"", "*", "keyLength", "-", ">", "Json", ".", "arr", "(", "0", "to", "itemCount", ")", "),", "maxChars", ")", "}", "catch", "{", "case", "_", ":", "OutOfMemoryError", "=", ">", "ko", "(", "\"", "OutOfMemoryError", "\"", ")", "}", ")", "must", "throwA", "[", "FormJsonExpansionTooLarge", "]", "}", "\"", "not", "run", "out", "of", "heap", "when", "converting", "arrays", "with", "very", "long", "keys", "\"", "in", "{", "/", "/", "a", "similar", "scenario", "to", "the", "previous", "one", "but", "this", "would", "cause", "OOME", "if", "it", "weren", "'", "t", "for", "the", "limit", "val", "keyLength", "=", "10000", "val", "itemCount", "=", "100000", "val", "maxChars", "=", "keyLength", "/", "/", "some", "value", "we", "'", "re", "likely", "to", "exceed", ".", "We", "want", "this", "limit", "to", "kick", "in", ".", "(", "try", "{", "FormUtils", ".", "fromJson", "(", "/", "/", "A", "JSON", "object", "with", "a", "key", "of", "length", "10000", ",", "pointing", "to", "a", "list", "with", "100000", "elements", ".", "/", "/", "In", "memory", ",", "this", "will", "consume", "at", "most", "a", "few", "MB", "of", "space", ".", "When", "expanded", ",", "will", "consume", "/", "/", "many", "GB", "of", "space", ".", "Json", ".", "obj", "(", "\"", "a", "\"", "*", "keyLength", "-", ">", "Json", ".", "arr", "(", "0", "to", "itemCount", ")", "),", "maxChars", ")", "}", "catch", "{", "case", "_", ":", "OutOfMemoryError", "=", ">", "/", "/", "No", "guarantee", "we", "'", "ll", "be", "the", "thread", "that", "gets", "this", ",", "or", "that", "our", "handling", "will", "be", "graceful", ",", "/", "/", "but", "at", "least", "try", ".", "ko", "(", "\"", "OutOfMemoryError", "\"", ")", "}", ")", "must", "throwA", "[", "FormJsonExpansionTooLarge", "]", "}", "}", "}", "@", "@", "-", "26", ",", "7", "+", "26", ",", "9", "@", "@", "class", "JavaJsonSpec", "extends", "Specification", "{", "|", "\"", "optionalInt", "\"", ":", "12345", ",", "|", "\"", "float", "\"", ":", "2", ".", "5", ",", "|", "\"", "double", "\"", ":", "1", ".", "7976931348623157E308", ",", ".", "put", "(", "\"", "optionalInt", "\"", ",", "12345", ")", ".", "put", "(", "\"", "float", "\"", ",", "2", ".", "5", ")", ".", "put", "(", "\"", "double", "\"", ",", "1", ".", "7976931348623157e308", ")", "/", "/", "Double", ".", "MaxValue", ".", "put", "(", "\"", "copyright", "\"", ",", "\"", "\\", "u00a9", "\"", ")", "/", "/", "copyright", "symbol", "/", "*", "*", "Copyright", "(", "C", ")", "Lightbend", "Inc", ".", "<", "https", ":", "//", "www", ".", "lightbend", ".", "com", ">", "*", "/", "package", "play", ".", "utils", "import", "com", ".", "fasterxml", ".", "jackson", ".", "core", ".", "JsonParser", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", "import", "org", ".", "specs2", ".", "mutable", ".", "Specification", "class", "JsonNodeDeserializerSpec", "extends", "BaseJacksonDeserializer", "(", "\"", "JsonNodeDeserializer", "\"", ")", "{", "def", "baseMapper", "(", "):", "ObjectMapper", "=", "{", "val", "mapper", "=", "new", "ObjectMapper", "mapper", ".", "registerModule", "(", "JacksonJsonNodeModule", ")", "mapper", "}", "def", "baseMapper", "(", "feature", ":", "JsonParser", ".", "Feature", ")", ":", "ObjectMapper", "=", "baseMapper", "(", ").", "configure", "(", "feature", ",", "true", ")", "}", "class", "DefaultDeserializerSpec", "extends", "BaseJacksonDeserializer", "(", "\"", "default", "\"", ")", "{", "def", "baseMapper", "(", "):", "ObjectMapper", "=", "new", "ObjectMapper", "def", "baseMapper", "(", "feature", ":", "JsonParser", ".", "Feature", ")", ":", "ObjectMapper", "=", "{", "baseMapper", "(", ").", "configure", "(", "feature", ",", "true", ")", "}", "}", "abstract", "class", "BaseJacksonDeserializer", "(", "implementationName", ":", "String", ")", "extends", "Specification", "{", "val", "jsonStringPrimitives", ":", "String", "=", "s", "\"", "\"\"", "|", "{", "|", "\"", "intValue", "\"", ":", "23", ",", "|", "\"", "longValue", "\"", ":", "$", "{", "Long", ".", "MaxValue", "}", ",", "|", "\"", "floatValue", "\"", ":", "3", ".", "141592", ",", "|", "\"", "doubleValue", "\"", ":", "$", "{", "Double", ".", "MaxValue", "}", "|", "}", "|", "\"\"", "\".", "stripMargin", "val", "jsonStringBigNums", ":", "String", "=", "s", "\"", "\"\"", "|", "{", "|", "\"", "intValue", "\"", ":", "23", ",", "|", "\"", "floatValue", "\"", ":", "3", ".", "141592", "|", "}", "|", "\"\"", "\".", "stripMargin", "def", "baseMapper", "(", "):", "ObjectMapper", "def", "baseMapper", "(", "feature", ":", "JsonParser", ".", "Feature", ")", ":", "ObjectMapper", "s", "\"", "A", "$", "implementationName", "Jackson", "ObjectMapper", "\"", ">", ">", "{", "\"", "parse", "numbers", "as", "primitives", "\"", ">", ">", "{", "val", "mapper", ":", "ObjectMapper", "=", "baseMapper", "(", ")", "mapper", ".", "readValue", "(", "jsonStringPrimitives", ",", "classOf", "[", "PrimitiveNumericJavaPojo", "]", ")", "must", "equalTo", "(", "new", "PrimitiveNumericJavaPojo", "(", "23", ",", "Long", ".", "MaxValue", ",", "3", ".", "141592f", ",", "Double", ".", "MaxValue", ")", ")", "}", "\"", "parse", "numbers", "as", "BigDecimal", "/", "Integer", "(", "implicitly", ")", "\"", ">", ">", "{", "val", "mapper", ":", "ObjectMapper", "=", "baseMapper", "(", ")", ".", "configure", "(", "DeserializationFeature", ".", "USE_BIG_DECIMAL_FOR_FLOATS", ",", "false", ")", ".", "configure", "(", "DeserializationFeature", ".", "USE_BIG_INTEGER_FOR_INTS", ",", "false", ")", "mapper", ".", "readValue", "(", "jsonStringPrimitives", ",", "classOf", "[", "PrimitiveNumericJavaPojo", "]", ")", "must", "equalTo", "(", "new", "PrimitiveNumericJavaPojo", "(", "23", ",", "Long", ".", "MaxValue", ",", "3", ".", "141592f", ",", "Double", ".", "MaxValue", ")", ")", "mapper", ".", "readValue", "(", "jsonStringBigNums", ",", "classOf", "[", "BigNumericJavaPojo", "]", ")", "must", "equalTo", "(", "new", "BigNumericJavaPojo", "(", "java", ".", "math", ".", "BigInteger", ".", "valueOf", "(", "23", ")", ",", "java", ".", "math", ".", "BigDecimal", ".", "valueOf", "(", "3141592", ",", "6", ")", ")", ")", "}", "\"", "parse", "numbers", "as", "BigDecimal", "/", "Integer", "(", "explicitly", ")", "\"", ">", ">", "{", "val", "mapper", ":", "ObjectMapper", "=", "baseMapper", "(", ")", ".", "configure", "(", "DeserializationFeature", ".", "USE_BIG_DECIMAL_FOR_FLOATS", ",", "true", ")", ".", "configure", "(", "DeserializationFeature", ".", "USE_BIG_INTEGER_FOR_INTS", ",", "true", ")", "mapper", ".", "readValue", "(", "jsonStringBigNums", ",", "classOf", "[", "BigNumericJavaPojo", "]", ")", "must", "equalTo", "(", "new", "BigNumericJavaPojo", "(", "java", ".", "math", ".", "BigInteger", ".", "valueOf", "(", "23", ")", ",", "java", ".", "math", ".", "BigDecimal", ".", "valueOf", "(", "3141592", ",", "6", ")", ")", ")", "}", "def", "readNode", "(", "mapper", ":", "ObjectMapper", ",", "json", ":", "String", ")", "=", "mapper", ".", "readTree", "(", "json", ")", ".", "findValue", "(", "\"", "value", "\"", ")", "\"", "read", "Float", "\"", ">", ">", "{", "/", "/", "in", "both", "Jackson", "and", "in", "our", "own", "impl", ",", "Floats", "become", "a", "DoubleNode", "at", "tree", "level", "val", "json", "=", "\"", "\"\"", "{", "\"", "value", "\"", ":", "0", ".", "1", "}", "\"\"", "\"", "readNode", "(", "baseMapper", "(", "),", "json", ")", ".", "isDouble", "must", "beTrue", "}", "\"", "read", "Double", "\"", ">", ">", "{", "val", "json", "=", "\"", "\"\"", "{", "\"", "value", "\"", ":", "1", ".", "7976931348623157E308", "}", "\"\"", "\"", "readNode", "(", "baseMapper", "(", "),", "json", ")", ".", "isDouble", "must", "beTrue", "}", "\"", "read", "Double", "as", "BigDecimal", "\"", ">", ">", "{", "val", "json", "=", "\"", "\"\"", "{", "\"", "value", "\"", ":", "1", ".", "7976931348623157E308", "}", "\"\"", "\"", "val", "mapper", "=", "baseMapper", "(", ").", "configure", "(", "DeserializationFeature", ".", "USE_BIG_DECIMAL_FOR_FLOATS", ",", "true", ")", "readNode", "(", "mapper", ",", "json", ")", ".", "isBigDecimal", "must", "beTrue", "}", "\"", "read", "NaN", "as", "Double", "\"", ">", ">", "{", "val", "json", "=", "\"", "\"\"", "{", "\"", "value", "\"", ":", "NaN", "}", "\"\"", "\"", "val", "mapper", "=", "baseMapper", "(", "JsonParser", ".", "Feature", ".", "ALLOW_NON_NUMERIC_NUMBERS", ")", ".", "configure", "(", "DeserializationFeature", ".", "USE_BIG_DECIMAL_FOR_FLOATS", ",", "true", ")", "readNode", "(", "mapper", ",", "json", ")", ".", "isDouble", "must", "beTrue", "}", "\"", "read", "Int", "\"", ">", ">", "{", "val", "json", "=", "\"", "\"\"", "{", "\"", "value", "\"", ":", "10", "}", "\"\"", "\"", "readNode", "(", "baseMapper", "(", "),", "json", ")", ".", "isInt", "must", "beTrue", "}", "\"", "read", "Int", "as", "Long", "\"", ">", ">", "{", "val", "json", "=", "\"", "\"\"", "{", "\"", "value", "\"", ":", "10", "}", "\"\"", "\"", "val", "mapper", "=", "baseMapper", "(", ").", "configure", "(", "DeserializationFeature", ".", "USE_LONG_FOR_INTS", ",", "true", ")", "readNode", "(", "mapper", ",", "json", ")", ".", "isLong", "must", "beTrue", "}", "\"", "read", "Int", "as", "BigInteger", "\"", ">", ">", "{", "val", "json", "=", "\"", "\"\"", "{", "\"", "value", "\"", ":", "10", "}", "\"\"", "\"", "val", "mapper", "=", "baseMapper", "(", ").", "configure", "(", "DeserializationFeature", ".", "USE_BIG_INTEGER_FOR_INTS", ",", "true", ")", "readNode", "(", "mapper", ",", "json", ")", ".", "isBigInteger", "must", "beTrue", "}", "\"", "read", "Long", "\"", ">", ">", "{", "val", "json", "=", "s", "\"", "\"\"", "{", "\"", "value", "\"", ":", "$", "{", "Long", ".", "MaxValue", "}", "}", "\"\"", "\"", "readNode", "(", "baseMapper", "(", "),", "json", ")", ".", "isLong", "must", "beTrue", "}", "\"", "read", "BigInteger", "\"", ">", ">", "{", "val", "json", "=", "s", "\"", "\"\"", "{", "\"", "value", "\"", ":", "$", "{", "Long", ".", "MaxValue", "}", "0000", "}", "\"\"", "\"", "readNode", "(", "baseMapper", "(", "),", "json", ")", ".", "isBigInteger", "must", "beTrue", "}", "}", "}", "@", "@", "-", "224", ",", "6", "+", "224", ",", "9", "@", "@", "object", "BuildSettings", "{", "/", "/", "Limit", "JSON", "parsing", "resources", "ProblemFilters", ".", "exclude", "[", "DirectMissingMethodProblem", "]", "(\"", "play", ".", "api", ".", "data", ".", "FormUtils", ".", "fromJson", "$", "default", "$", "1", "\"", "),", "ProblemFilters", ".", "exclude", "[", "IncompatibleMethTypeProblem", "]", "(\"", "play", ".", "api", ".", "data", ".", "FormUtils", ".", "fromJson", "\"", "),", "/", "/", "is", "private", "@", "Deprecated", "logger", ".", "warn", "(", "\"", "Binding", "json", "field", "from", "form", "with", "a", "hardcoded", "max", "size", "of", "{", "}", "bytes", ".", "This", "is", "deprecated", ".", "Use", "bind", "(", "Lang", ",", "TypedMap", ",", "JsonNode", ",", "Long", ",", "String", ".", "..", ")", "instead", ".", "\",", "FROM_JSON_MAX_CHARS", ")", ";", "return", "bind", "(", "lang", ",", "attrs", ",", "data", ",", "FROM_JSON_MAX_CHARS", ",", "allowedFields", ")", ";", "}", "@", "Override", "public", "DynamicForm", "bind", "(", "Lang", "lang", ",", "TypedMap", "attrs", ",", "JsonNode", "data", ",", "long", "maxChars", ",", "String", ".", "..", "allowedFields", ")", "{", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "data", ")", "),", "maxChars", ")", "),", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "play", ".", "api", ".", "data", ".", "Form", "$", ";", "protected", "static", "final", "long", "FROM_JSON_MAX_CHARS", "=", "Form", "$", ".", "MODULE", "$", ".", "FromJsonMaxChars", "(", ");", "protected", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "getClass", "(", "))", ";", "long", "maxMemoryBuffer", "=", "config", ".", "getMemorySize", "(", "\"", "play", ".", "http", ".", "parser", ".", "maxMemoryBuffer", "\"", ").", "toBytes", "(", ");", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "request", ".", "body", "(", ").", "asJson", "(", "))", "),", "maxMemoryBuffer", ")", ");", "*", "@", "deprecated", "Deprecated", "as", "of", "2", ".", "8", ".", "3", ".", "Use", "{", "@", "link", "#", "bind", "(", "Lang", ",", "TypedMap", ",", "JsonNode", ",", "long", ",", "*", "String", ".", "..", ")}", "instead", "to", "specify", "the", "maximum", "chars", "that", "should", "be", "consumed", "by", "the", "flattened", "*", "form", "representation", "of", "the", "JSON", ".", "@", "Deprecated", "logger", ".", "warn", "(", "\"", "Binding", "json", "field", "from", "form", "with", "a", "hardcoded", "max", "size", "of", "{", "}", "bytes", ".", "This", "is", "deprecated", ".", "Use", "bind", "(", "Lang", ",", "TypedMap", ",", "JsonNode", ",", "Int", ",", "String", ".", "..", ")", "instead", ".", "\",", "FROM_JSON_MAX_CHARS", ")", ";", "return", "bind", "(", "lang", ",", "attrs", ",", "data", ",", "FROM_JSON_MAX_CHARS", ",", "allowedFields", ")", ";", "}", "/", "**", "*", "Binds", "Json", "data", "to", "this", "form", "-", "that", "is", ",", "handles", "form", "submission", ".", "*", "*", "@", "param", "lang", "used", "for", "validators", "and", "formatters", "during", "binding", "and", "is", "part", "of", "{", "@", "link", "*", "ValidationPayload", "}", ".", "Later", "also", "used", "for", "formatting", "when", "retrieving", "a", "field", "(", "via", "{", "@", "link", "*", "#", "field", "(", "String", ")", "}", "or", "{", "@", "link", "#", "apply", "(", "String", ")", "})", "and", "for", "translations", "in", "{", "@", "link", "#", "errorsAsJson", "(", ")}", ".", "*", "For", "these", "methods", "the", "lang", "can", "be", "change", "via", "{", "@", "link", "#", "withLang", "(", "Lang", ")", "}.", "*", "@", "param", "attrs", "will", "be", "passed", "to", "validators", "via", "{", "@", "link", "ValidationPayload", "}", "*", "@", "param", "data", "data", "to", "submit", "*", "@", "param", "maxChars", "The", "maximum", "number", "of", "chars", "allowed", "to", "be", "used", "in", "the", "intermediate", "map", "*", "representation", "of", "the", "JSON", ".", "`", "parse", ".", "DefaultMaxTextLength", "`", "is", "recommended", "to", "passed", "for", "this", "*", "parameter", ".", "*", "@", "param", "allowedFields", "the", "fields", "that", "should", "be", "bound", "to", "the", "form", ",", "all", "fields", "if", "not", "specified", ".", "*", "@", "return", "a", "copy", "of", "this", "form", "filled", "with", "the", "new", "data", "*", "/", "public", "Form", "<", "T", ">", "bind", "(", "Lang", "lang", ",", "TypedMap", "attrs", ",", "JsonNode", "data", ",", "long", "maxChars", ",", "String", ".", "..", "allowedFields", ")", "{", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "data", ")", "),", "maxChars", ")", "),</s>import", "javax", ".", "inject", ".", "_", "import", "scala", ".", "concurrent", ".", "Future", "import", "java", ".", "io", ".", "IOException", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "JsonNode", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectWriter", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", ";", "import", "format", ".", "_", "def", "bind", "(", "data", ":", "play", ".", "api", ".", "libs", ".", "json", ".", "JsValue", ")", ":", "Form", "[", "T", "]", "=", "bind", "(", "FormUtils", ".", "fromJson", "(", "js", "=", "data", ")", ")", "FormUtils", ".", "fromJson", "(", "js", "=", "body", ".", "asJson", ".", "get", ")", ".", "mapValues", "(", "Seq", "(", "_", ")", ")", "case", "body", ":", "play", ".", "api", ".", "libs", ".", "json", ".", "JsValue", "=", ">", "FormUtils", ".", "fromJson", "(", "js", "=", "body", ")", ".", "mapValues", "(", "Seq", "(", "_", ")", ")", "def", "fromJson", "(", "prefix", ":", "String", "=", "\"", "\",", "js", ":", "JsValue", ")", ":", "Map", "[", "String", ",", "String", "]", "=", "js", "match", "{", "case", "JsObject", "(", "fields", ")", "=", ">", "{", "fields", ".", "map", "{", "case", "(", "key", ",", "value", ")", "=", ">", "fromJson", "(", "Option", "(", "prefix", ")", ".", "filterNot", "(", "_", ".", "isEmpty", ")", ".", "map", "(", "_", "+", "\"", ".\"", ").", "getOrElse", "(", "\"\"", ")", "+", "key", ",", "value", ")", "}", ".", "foldLeft", "(", "Map", ".", "empty", "[", "String", ",", "String", "]", ")(", "_", "+", "+", "_", ")", "case", "JsArray", "(", "values", ")", "=", ">", "{", "values", ".", "zipWithIndex", ".", "map", "{", "case", "(", "value", ",", "i", ")", "=", ">", "fromJson", "(", "prefix", "+", "\"", "[\"", "+", "i", "+", "\"", "]\"", ",", "value", ")", "}", ".", "foldLeft", "(", "Map", ".", "empty", "[", "String", ",", "String", "]", ")(", "_", "+", "+", "_", ")", "case", "JsNull", "=", ">", "Map", ".", "empty", "case", "JsUndefined", "(", ")", "=", ">", "Map", ".", "empty", "case", "JsBoolean", "(", "value", ")", "=", ">", "Map", "(", "prefix", "-", ">", "value", ".", "toString", ")", "case", "JsNumber", "(", "value", ")", "=", ">", "Map", "(", "prefix", "-", ">", "value", ".", "toString", ")", "case", "JsString", "(", "value", ")", "=", ">", "Map", "(", "prefix", "-", ">", "value", ".", "toString", ")", "|", "\"", "a", "\"", ":", "2", ".", "5", ",", ".", "put", "(", "\"", "a", "\"", ",", "2", ".", "5", ")", ".", "put", "(", "\"", "copyright", "\"", ",", "\"", "\\", "u00a9", "\"", ")", "/", "/", "copyright", "symbol", "\"", "\",", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "data", ")", "))", "),", "\"", "\",", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "request", ".", "body", "(", ").", "asJson", "(", "))", "))", ");", "\"", "\",", "play", ".", "api", ".", "libs", ".", "json", ".", "Json", ".", "parse", "(", "play", ".", "libs", ".", "Json", ".", "stringify", "(", "data", ")", "))", "),"], "docstring_tokens": ["data", "amplification"]}
