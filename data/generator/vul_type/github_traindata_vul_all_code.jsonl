{"contents": ["empty"], "code_tokens": ["@", "@", "-", "783", ",", "16", "+", "783", ",", "16", "@", "@", "static", "int", "amd_gpio_probe", "(", "struct", "platform_device", "*", "pdev", ")", "gpio_dev", "-", ">", "ngroups", "=", "ARRAY_SIZE", "(", "kerncz_groups", ")", ";", "amd_pinctrl_desc", ".", "name", "=", "dev_name", "(", "&", "pdev", "-", ">", "dev", ")", ";", "gpio_dev", "-", ">", "pctrl", "=", "pinctrl_register", "(", "&", "amd_pinctrl_desc", ",", "&", "pdev", "-", ">", "dev", ",", "gpio_dev", ")", ";", "gpio_dev", "-", ">", "pctrl", "=", "devm_pinctrl_register", "(", "&", "pdev", "-", ">", "dev", ",", "&", "amd_pinctrl_desc", ",", "gpio_dev", ")", ";", "if", "(", "IS_ERR", "(", "gpio_dev", "-", ">", "pctrl", ")", ")", "{", "dev_err", "(", "&", "pdev", "-", ">", "dev", ",", "\"", "Couldn", "'", "t", "register", "pinctrl", "driver", "\\", "n", "\"", ");", "return", "PTR_ERR", "(", "gpio_dev", "-", ">", "pctrl", ")", ";", "}", "ret", "=", "gpiochip_add_data", "(", "&", "gpio_dev", "-", ">", "gc", ",", "gpio_dev", ")", ";", "if", "(", "ret", ")", "goto", "out1", ";", "return", "ret", ";", "ret", "=", "gpiochip_add_pin_range", "(", "&", "gpio_dev", "-", ">", "gc", ",", "dev_name", "(", "&", "pdev", "-", ">", "dev", ")", ",", "0", ",", "0", ",", "TOTAL_NUMBER_OF_PINS", ")", ";", "@", "@", "-", "825", ",", "8", "+", "825", ",", "6", "@", "@", "static", "int", "amd_gpio_probe", "(", "struct", "platform_device", "*", "pdev", ")", "out2", ":", "gpiochip_remove", "(", "&", "gpio_dev", "-", ">", "gc", ")", ";", "out1", ":", "pinctrl_unregister", "(", "gpio_dev", "-", ">", "pctrl", ")", ";", "return", "ret", ";", "}", "@", "@", "-", "837", ",", "7", "+", "835", ",", "6", "@", "@", "static", "int", "amd_gpio_remove", "(", "struct", "platform_device", "*", "pdev", ")", "gpio_dev", "=", "platform_get_drvdata", "(", "pdev", ")", ";", "gpiochip_remove", "(", "&", "gpio_dev", "-", ">", "gc", ")", ";", "pinctrl_unregister", "(", "gpio_dev", "-", ">", "pctrl", ")", ";", "return", "0", ";", "}"], "docstring_tokens": ["double", "free"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "3426", ",", "6", "+", "3426", ",", "7", "@", "@", "static", "void", "napi_reuse_skb", "(", "struct", "napi_struct", "*", "napi", ",", "struct", "sk_buff", "*", "skb", ")", "skb_reserve", "(", "skb", ",", "NET_IP_ALIGN", "-", "skb_headroom", "(", "skb", ")", ");", "skb", "-", ">", "vlan_tci", "=", "0", ";", "skb", "-", ">", "dev", "=", "napi", "-", ">", "dev", ";", "skb", "-", ">", "skb_iif", "=", "0", ";", "napi", "-", ">", "skb", "=", "skb", ";", "}"], "docstring_tokens": ["memory", "leaks/corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "18", ",", "28", "+", "18", ",", "28", "@", "@", "static", "struct", "ctl_table", "llc2_timeout_table", "[", "]", "=", "{", "{", ".", "procname", "=", "\"", "ack", "\"", ",", ".", "data", "=", "&", "sysctl_llc2_ack_timeout", ",", ".", "maxlen", "=", "sizeof", "(", "long", ")", ",", ".", "maxlen", "=", "sizeof", "(", "sysctl_llc2_ack_timeout", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_jiffies", ",", "}", ",", "{", ".", "procname", "=", "\"", "busy", "\"", ",", ".", "data", "=", "&", "sysctl_llc2_busy_timeout", ",", ".", "maxlen", "=", "sizeof", "(", "long", ")", ",", ".", "maxlen", "=", "sizeof", "(", "sysctl_llc2_busy_timeout", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_jiffies", ",", "}", ",", "{", ".", "procname", "=", "\"", "p", "\"", ",", ".", "data", "=", "&", "sysctl_llc2_p_timeout", ",", ".", "maxlen", "=", "sizeof", "(", "long", ")", ",", ".", "maxlen", "=", "sizeof", "(", "sysctl_llc2_p_timeout", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_jiffies", ",", "}", ",", "{", ".", "procname", "=", "\"", "rej", "\"", ",", ".", "data", "=", "&", "sysctl_llc2_rej_timeout", ",", ".", "maxlen", "=", "sizeof", "(", "long", ")", ",", ".", "maxlen", "=", "sizeof", "(", "sysctl_llc2_rej_timeout", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_jiffies", ",", "}", ","], "docstring_tokens": ["information", "leak"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "35", ",", "6", "+", "35", ",", "7", "@", "@", "<", "h1", "id", "=", "\"", "upcoming", "\"", ">", "Upcoming", "<", "/", "h1", ">", "<", "h2", ">", "Major", "changes", "<", "/", "h2", ">", "<", "ul", ">", "<", "li", ">", "Add", "security", "framework", "to", "limit", "handled", "types", "while", "unmarshalling", ".", "</", "li", ">", "<", "li", ">", "java", ".", "bean", ".", "EventHandler", "no", "longer", "handled", "automatically", "because", "of", "severe", "security", "vulnerability", ".", "</", "li", ">", "<", "li", ">", "JIRA", ":", "XSTR", "-", "751", ":", "New", "SunLimitedUnsafeReflectionProvider", "that", "uses", "undocumented", "features", "only", "to", "allocate", "new", "instances", "as", "required", "on", "Dalvik", ".", "</", "li", ">", "@", "@", "-", "54", ",", "6", "+", "55", ",", "11", "@", "@", "<", "h2", ">", "Minor", "changes", "<", "/", "h2", ">", "<", "h2", ">", "API", "changes", "<", "/", "h2", ">", "<", "ul", ">", "<", "li", ">", "Added", "package", "c", ".", "t", ".", "x", ".", "security", "with", "interface", "TypePermission", ",", "all", "its", "implementations", "and", "ForbiddenClassException", ".", "</", "li", ">", "<", "li", ">", "Added", "c", ".", "t", ".", "x", ".", "mapper", ".", "SecurityMapper", "handling", "the", "new", "type", "permissions", ".", "</", "li", ">", "<", "li", ">", "Added", "methods", "addPermission", ",", "denyPermission", ",", "allowTypesXXX", "and", "denyTypesXXX", "to", "c", ".", "t", ".", "x", ".", "XStream", "to", "setup", "security", "at", "unmarshalling", "time", ".", "</", "li", ">", "<", "li", ">", "Added", "c", ".", "t", ".", "x", ".", "converters", ".", "reflection", ".", "SunLimitedUnsafeReflectionProvider", ".", "</", "li", ">", "<", "li", ">", "Deprecated", "c", ".", "t", ".", "x", ".", "converters", ".", "reflection", ".", "Sun14ReflectionProvider", "in", "favor", "of", "new", "c", ".", "t", ".", "x", ".", "converters", ".", "reflection", ".", "SunUnsafeReflectionProvider", ".", "</", "li", ">", "@", "@", "-", "56", ",", "8", "+", "56", ",", "9", "@", "@", "<", "h2", "id", "=", "\"", "Compatibility_enhanced_mode_jvm", "\"", ">", "Which", "JVMs", "allow", "XStream", "to", "operate", "in", "undocumented", "internal", "Java", "runtime", "classes", ".", "This", "enhanced", "mode", "is", "known", "to", "be", "working", "on", "the", "Oracle", "/", "Sun", ",", "Apple", ",", "HP", ",", "IBM", "and", "Blackdown", "1", ".", "4", "JVMs", "and", "onwards", ",", "for", "IcedTea", "6", "and", "onwards", ",", "for", "Hitachi", ",", "SAP", "and", "Diablo", "from", "1", ".", "5", "and", "onwards", ",", "for", "BEA", "JRockit", "starting", "with", "R25", ".", "1", ".", "0", ".", "Generally", "it", "works", "for", "all", "modern", "Java", "runtimes", "based", "on", "OpenJDK", ".", "Android", "basically", "supports", "the", "enhanced", "mode", ",", "but", "its", "security", "model", "limits", "the", "types", "that", "can", "be", "handled", ".", "Note", ",", "that", "an", "active", "SecurityManager", "might", "prevent", "the", "usage", "of", "the", "enhanced", "mode", "also", ".", "</", "p", ">", "Android", "basically", "supports", "the", "enhanced", "mode", "as", "well", "as", "the", "Google", "ApplicationEngine", ",", "but", "the", "latter", "'", "s", "security", "model", "limits", "the", "types", "that", "can", "be", "handled", ".", "Note", ",", "that", "an", "active", "SecurityManager", "might", "prevent", "the", "usage", "of", "the", "enhanced", "mode", "also", ".", "</", "p", ">", "<", "!-", "-", ".", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", ".", "-", "->", "<", "h2", "id", "=", "\"", "Compatibility_enhanced_mode_advantage", "\"", ">", "What", "are", "the", "advantages", "of", "using", "enhanced", "mode", "over", "pure", "Java", "mode", "?", "</", "h2", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "207", "@", "@", "<", "html", ">", "<", "!-", "-", "Copyright", "(", "C", ")", "2014", "XStream", "committers", ".", "All", "rights", "reserved", ".", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "style", "license", "a", "copy", "of", "which", "has", "been", "included", "with", "this", "distribution", "in", "the", "LICENSE", ".", "txt", "file", ".", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "-", "->", "<", "head", ">", "<", "title", ">", "Security", "<", "/", "title", ">", "<", "/", "head", ">", "<", "body", ">", "<", "h1", "id", "=", "\"", "intro", "\"", ">", "Introduction", "<", "/", "h1", ">", "<", "p", ">", "XStream", "is", "designed", "as", "a", "library", ",", "that", "is", "easy", "to", "use", ".", "It", "takes", "its", "main", "task", "very", "serious", "to", "convert", "from", "Java", "objects", "to", "XML", "and", "back", ".", "As", "result", "it", "is", "possible", "that", "you", "create", "an", "instance", "of", "XStream", "with", "the", "default", "constructor", ",", "call", "a", "method", "to", "turn", "an", "object", "into", "XML", "and", "call", "another", "one", "to", "turn", "the", "XML", "back", "into", "an", "equal", "Java", "object", ".", "There", "are", "not", "a", "lot", "limits", "for", "those", "objects", ",", "XStream", "can", "handle", "nearly", "all", ".", "</", "p", ">", "<", "p", ">", "This", "flexibility", "comes", "at", "a", "price", ".", "XStream", "is", "using", "aggressive", "code", "internally", "like", "undocumented", "Java", "features", "and", "reflection", "to", "be", "able", "to", "handle", "all", "kind", "of", "unknown", "types", ".", "The", "XML", "output", "contains", "by", "default", "any", "information", "required", "to", "rebuild", "all", "these", "types", ".", "Regarding", "security", "we", "have", "now", "two", "different", "aspects", ":", "</", "p", ">", "<", "ol", ">", "<", "li", ">", "a", "Java", "runtime", "can", "have", "security", "constraints", "(", "typically", "by", "an", "active", "SecurityManager", ")", "that", "prevents", "partly", "the", "execution", "of", "such", "aggressive", "code", "<", "/", "li", ">", "<", "li", ">", "the", "input", "data", "(", "XML", ")", "can", "be", "manipulated", "to", "inject", "objects", "into", "the", "unmarshalled", "object", "graph", "that", "where", "not", "present", "at", "marshalling", "time", "and", "that", "might", "be", "used", "to", "execute", "code", "or", "even", "shell", "commands", "(", "CVE", "-", "2013", "-", "7285", ")", ".<", "/", "li", ">", "<", "/", "ol", ">", "<", "p", ">", "Always", "remember", "that", "manipulation", "of", "input", "data", "might", "happen", "on", "different", "levels", ",", "e", ".", "g", ".", "manipulation", "the", "value", "of", "objects", "(", "e", ".", "g", ".", "exchanging", "a", "price", "value", ")", "or", "breaking", "the", "format", "causing", "the", "XML", "parser", "to", "fail", ".", "The", "latter", "raises", "at", "least", "an", "error", "condition", "while", "the", "former", "must", "be", "catched", "with", "validity", "checks", "in", "case", "of", "sensitive", "data", ".", "Even", "worse", "is", "an", "unrecognized", "injection", "resulting", "in", "a", "modified", "application", "execution", "with", "the", "worst", "case", "of", "arbitrary", "command", "execution", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "external", "\"", ">", "External", "Security", "<", "/", "h2", ">", "<", "p", ">", "An", "active", "SecurityManager", "can", "prevent", "actions", "required", "by", "XStream", "components", "or", "converters", ".", "Same", "applies", "for", "an", "environment", "like", "Google", "Application", "Engine", ".", "XStream", "tries", "to", "some", "extend", "to", "check", "the", "functionality", "of", "a", "converter", "before", "it", "claims", "to", "handle", "a", "type", ".", "</", "p", ">", "<", "p", ">", "Therefore", "it", "is", "possible", "that", "XStream", "behaves", "different", "in", "such", "an", "environment", ",", "because", "a", "converter", "suddenly", "no", "longer", "handles", "a", "special", "type", "or", "any", "type", "at", "all", ".", "It", "is", "essential", "that", "an", "application", "that", "will", "have", "to", "run", "in", "such", "an", "environment", "is", "tested", "at", "an", "early", "stage", "to", "prevent", "nasty", "surprises", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "implicit", "\"", ">", "Implicit", "Security", "<", "/", "h2", ">", "<", "p", ">", "As", "already", "explained", "it", "is", "possible", "to", "inject", "other", "object", "instances", "if", "someone", "has", "the", "possibility", "to", "manipulate", "the", "data", "stream", "used", "to", "deserialize", "the", "Java", "objects", "(", "typically", "XML", ",", "but", "XStream", "supports", "other", "formats", "like", "JSON", ")", ".", "A", "known", "vulnerability", "can", "be", "created", "with", "the", "help", "of", "the", "Java", "runtime", "library", "using", "the", "Java", "Bean", "<", "a", "href", "=", "\"", "http", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "7", "/", "docs", "/", "api", "/", "java", "/", "beans", "/", "EventHandler", ".", "html", "\"", ">", "EventHandler", "<", "/", "a", ">", ".", "As", "an", "instance", "for", "the", "<", "a", "href", "=", "\"", "http", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "7", "/", "docs", "/", "api", "/", "java", "/", "lang", "/", "reflect", "/", "InvocationHandler", ".", "html", "\"", ">", "InvocationHandler", "<", "/", "a", ">", "of", "a", "dynamic", "proxy", "it", "can", "be", "used", "to", "install", "a", "redirect", "for", "an", "arbitrary", "call", "to", "the", "original", "object", "to", "the", "method", "of", "a", "completely", "different", "instance", "of", "an", "embedded", "object", "of", "the", "EventHandler", "itself", ".", "</", "p", ">", "<", "p", ">", "This", "scenario", "can", "be", "used", "perfectly", "to", "replace", "/", "inject", "a", "dynamic", "proxy", "with", "such", "an", "EventHandler", "at", "any", "location", "in", "the", "XML", "where", "its", "parent", "expects", "an", "object", "of", "such", "an", "interface", "'", "s", "type", "or", "a", "simple", "object", "instance", "(", "any", "list", "element", "will", "suffice", ")", ".", "The", "usage", "of", "a", "ProcessBuilder", "as", "embedded", "element", "and", "the", "redirection", "of", "any", "call", "to", "the", "ProcessBuilder", "'", "s", "<", "a", "href", "=", "\"", "http", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "7", "/", "docs", "/", "api", "/", "java", "/", "lang", "/", "ProcessBuilder", ".", "html", "#", "start", "(", ")\"", ">", "start", "(", ")<", "/", "a", ">", "method", "allows", "even", "the", "call", "of", "shell", "commands", ".", "All", "you", "have", "to", "know", "is", "the", "XML", "representation", "of", "such", "a", "combination", ".", "</", "p", ">", "<", "p", ">", "Starting", "with", "XStream", "1", ".", "4", ".", "7", "an", "instance", "of", "the", "EventHandler", "is", "no", "longer", "handled", "by", "default", ".", "You", "have", "to", "register", "explicitly", "a", "ReflectionConverter", "for", "the", "EventHandler", "type", ",", "if", "your", "application", "has", "the", "requirement", "to", "persist", "such", "an", "object", ".", "However", ",", "you", "have", "to", "take", "special", "care", "about", "the", "location", "of", "the", "persisted", "data", "and", "how", "you", "can", "ensure", "its", "integrity", ".", "</", "p", ">", "<", "p", "class", "=", "highlight", ">", "Note", ",", "that", "this", "vulnerability", "is", "not", "even", "a", "special", "problem", "of", "XStream", ".", "The", "XML", "acts", "here", "like", "a", "script", "and", "the", "scenario", "above", "can", "be", "created", "with", "any", "script", "that", "is", "executed", "within", "a", "Java", "runtime", "(", "e", ".", "g", ".", "using", "its", "JavaScript", "interpreter", ")", "if", "someone", "is", "able", "to", "manipulate", "it", "externally", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "explicit", "\"", ">", "Explicit", "Security", "<", "/", "h2", ">", "<", "p", ">", "While", "XStream", "implicitly", "avoids", "the", "vulnerability", "scenario", "with", "the", "EventHandler", ",", "there", "might", "be", "other", "combinations", "with", "types", "from", "well", "-", "known", "and", "often", "used", "Java", "libraries", "like", "ASM", ",", "CGLIB", ",", "Groovy", ",", "or", "even", "in", "the", "Java", "runtime", "that", "are", "currently", "simply", "unknown", ".", "</", "p", ">", "<", "p", ">", "Starting", "with", "XStream", "1", ".", "4", ".", "7", "it", "is", "possible", "to", "define", "<", "a", "href", "=", "\"#", "framework", "\"", ">", "permissions", "<", "/", "a", ">", "for", "types", "to", "check", "the", "type", "of", "an", "object", "that", "should", "be", "unmarshalled", ".", "Those", "permissions", "can", "be", "used", "to", "allow", "or", "deny", "types", "explicitly", ".", "With", "these", "permissions", "it", "is", "at", "least", "possible", "to", "inject", "types", "into", "an", "object", "graph", "that", "do", "not", "belong", "anywhere", "into", "it", ".", "Any", "application", "that", "deserializes", "data", "from", "an", "external", "source", "should", "at", "least", "use", "this", "possibility", "to", "limit", "the", "danger", "of", "arbitrary", "command", "execution", ".", "</", "p", ">", "<", "p", "class", "=", "highlight", ">", "Apart", "from", "value", "manipulations", ",", "this", "implementation", "still", "allows", "the", "injection", "of", "allowed", "objects", "at", "wrong", "locations", ".", "e", ".", "g", ".", "inserting", "an", "integer", "into", "a", "list", "of", "strings", ".", "</", "p", ">", "<", "p", ">", "Apart", "from", "the", "XStream", "security", "framework", ",", "it", "has", "always", "been", "possible", "to", "overwrite", "the", "setupConverter", "method", "of", "XStream", "to", "register", "only", "the", "required", "converters", ".", "</", "p", ">", "<", "h2", "id", "=", "\"", "validation", "\"", ">", "XML", "Validation", "<", "/", "h2", ">", "<", "p", ">", "XML", "itself", "supports", "input", "validation", "using", "a", "schema", "and", "a", "validating", "parser", ".", "With", "XStream", "you", "can", "use", "e", ".", "g", ".", "a", "StAX", "parser", "for", "validation", ",", "but", "it", "will", "take", "some", "effort", "to", "ensure", "that", "the", "XML", "read", "and", "written", "by", "XStream", "matches", "the", "schema", "in", "first", "place", ".", "Typically", "you", "will", "have", "to", "write", "some", "custom", "converters", ",", "but", "it", "can", "be", "worth", "the", "effort", "depending", "on", "the", "use", "case", ".", "</", "p", ">", "<", "h1", "id", "=", "\"", "framework", "\"", ">", "Security", "Framework", "<", "/", "h1", ">", "<", "p", ">", "As", "explained", ",", "it", "might", "be", "possible", ",", "that", "other", "combinations", "are", "found", "with", "the", "Java", "runtime", "itself", "or", "other", "often", "used", "Java", "libraries", "that", "allow", "a", "similar", "vulnerability", "like", "the", "known", "case", "using", "the", "Java", "Beans", "EventHandler", ".", "To", "prevent", "such", "a", "possibility", "at", "all", ",", "XStream", "contains", "since", "version", "1", ".", "4", ".", "7", "a", "security", "framework", ",", "where", "you", "can", "define", ",", "which", "types", "are", "allowed", "to", "be", "unmarshalled", "with", "XStream", ".", "</", "p", ">", "<", "p", ">", "Core", "interface", "is", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "TypePermission", ".", "html", "\"", ">", "TypePermission", "<", "/", "a", ">", ".", "The", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "mapper", "/", "SecurityMapper", ".", "html", "\"", ">", "SecurityMapper", "<", "/", "a", ">", "will", "evaluate", "a", "list", "of", "registered", "instances", "for", "every", "type", "that", "will", "be", "required", "while", "unmarshalling", "input", "data", ".", "The", "interface", "has", "one", "simple", "method", ":", "<", "p", ">", "<", "div", "class", "=", "\"", "Source", "Java", "\"", "><", "pre", ">", "boolean", "allow", "(", "Class", "&", "lt", ";", "?&", "gt", ";", ");", "</", "pre", ">", "</", "div", ">", "<", "p", ">", "The", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "XStream", ".", "html", "\"", ">", "XStream", "<", "/", "a", ">", "facade", "provides", "following", "methods", "to", "register", "such", "type", "permissions", "within", "the", "SecurityMapper", ":", "<", "p", ">", "<", "div", "class", "=", "\"", "Source", "Java", "\"", ">", "<", "pre", ">", "XStream", ".", "addPermission", "(", "TypePermission", ")", ";", "XStream", ".", "allowTypes", "(", "String", ".", "..", ");", "XStream", ".", "allowTypesByRegExp", "(", "String", ".", "..", ");", "XStream", ".", "allowTypesByRegExp", "(", "Pattern", ".", "..", ");", "XStream", ".", "allowTypesByWildcard", "(", "String", ".", "..", ");", "XStream", ".", "denyPermission", "(", "TypePermission", ")", ";", "XStream", ".", "denyTypes", "(", "String", ".", "..", ");", "XStream", ".", "denyTypesByRegExp", "(", "String", ".", "..", ");", "XStream", ".", "denyTypesByRegExp", "(", "Pattern", ".", "..", ");", "XStream", ".", "denyTypesByWildcard", "(", "String", ".", "..", ");", "</", "pre", ">", "</", "div", ">", "<", "p", ">", "The", "sequence", "of", "registration", "is", "essential", ".", "The", "latest", "registered", "permission", "will", "be", "evaluated", "first", ".", "</", "p", ">", "<", "p", ">", "Every", "TypePermission", "has", "three", "options", "to", "implement", "the", "allow", "method", "and", "make", "decisions", "on", "the", "provided", "type", ":", "<", "p", ">", "<", "ul", ">", "<", "li", ">", "if", "the", "method", "returns", "<", "i", ">", "true", "<", "/", "i", ">", ",", "the", "type", "is", "simply", "accepted", "and", "no", "other", "permission", "is", "evaluated", "anymore", "<", "/", "li", ">", "<", "li", ">", "if", "the", "method", "returns", "<", "i", ">", "false", "<", "/", "i", ">", ",", "the", "implementation", "cannot", "judge", "over", "the", "type", "and", "the", "SecurityMapper", "will", "continue", "with", "the", "next", "permission", "instance", "in", "its", "registration", "list", "<", "/", "li", ">", "<", "li", ">", "the", "method", "throws", "a", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "ForbiddenClassException", ".", "html", "\"", ">", "ForbiddenClassException", "<", "/", "a", ">", "to", "stop", "the", "unmarshalling", "process", "<", "/", "li", ">", "<", "/", "ul", ">", "<", "p", ">", "XStream", "provides", "some", "TypePermission", "implementations", "to", "allow", "any", "or", "no", "type", "at", "all", ",", "to", "allow", "primitive", "types", "and", "their", "counterpart", ",", "null", ",", "array", "types", ",", "implementations", "match", "the", "name", "of", "the", "type", "by", "regular", "or", "wildcard", "expression", "and", "one", "to", "invert", "a", "permission", ".", "</", "p", ">", "<", "table", "class", "=", "\"", "examplesTable", "\"", "summary", "=", "\"", "Overview", "over", "all", "Converters", "delivered", "with", "XStream", "\"", ">", "<", "!-", "-", ".", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", "..", ".", "-", "->", "<", "tr", ">", "<", "th", ">", "Permission", "<", "/", "th", ">", "<", "th", ">", "Description", "<", "/", "th", ">", "<", "th", ">", "Example", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "AnyTypePermission", ".", "html", "\"", ">", "AnyTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "any", "type", ".", "You", "may", "use", "the", "ANY", "instance", "directly", ".", "A", "registration", "of", "this", "permission", "will", "wipe", "any", "prior", "one", ".", "</", "td", ">", "<", "td", ">", "&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "ArrayTypePermission", ".", "html", "\"", ">", "ArrayTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "any", "array", "type", ".", "</", "td", ">", "<", "td", ">", "&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "CGLIBProxyTypePermission", ".", "html", "\"", ">", "CGLIBProxyTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "any", "CGLIB", "proxy", "type", ".", "</", "td", ">", "<", "td", ">", "&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "ExplicitTypePermission", ".", "html", "\"", ">", "ExplicitTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "types", "explicitly", "by", "name", ".", "</", "td", ">", "<", "td", ">", "&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "hibernate", "/", "security", "/", "HibernateProxyTypePermission", ".", "html", "\"", ">", "HibernateProxyTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "any", "Hibernate", "proxy", "type", ".", "Implementation", "is", "located", "in", "XStream", "'", "s", "Hibernate", "extension", ".", "</", "td", ">", "<", "td", ">", "&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "NoPermission", ".", "html", "\"", ">", "NoPermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Invert", "any", "other", "permission", ".", "Instances", "of", "this", "type", "are", "used", "by", "XStream", "in", "the", "deny", "methods", ".", "</", "td", ">", "<", "td", "class", "=", "\"", "example", "\"", ">&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "NullPermission", ".", "html", "\"", ">", "NullPermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "null", "as", "type", ".", "</", "td", ">", "<", "td", ">", "&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "PrimitiveTypePermission", ".", "html", "\"", ">", "PrimitiveTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "any", "primitive", "type", "and", "its", "boxed", "counterpart", ".", "</", "td", ">", "<", "td", ">", "&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "ProxyTypePermission", ".", "html", "\"", ">", "ProxyTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "any", "Java", "proxy", "type", ".", "</", "td", ">", "<", "td", ">", "&", "nbsp", ";", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "RegExpTypePermission", ".", "html", "\"", ">", "RegExpTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "any", "type", "that", "matches", "with", "its", "name", "a", "regular", "expression", ".", "</", "td", ">", "<", "td", "class", "=", "\"", "example", "\"", ">.", "*\\", "\\.", "core", "\\", "\\.", ".*", "<", "br", "/", ">[", "^$", "]+", "</", "td", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "javadoc", "/", "com", "/", "thoughtworks", "/", "xstream", "/", "security", "/", "WildcardTypePermission", ".", "html", "\"", ">", "WildcardTypePermission", "<", "/", "a", ">", "</", "td", ">", "<", "td", ">", "Allow", "any", "type", "that", "matches", "with", "its", "name", "a", "wildcard", "expression", ".", "</", "td", ">", "<", "td", "class", "=", "\"", "example", "\"", ">", "java", ".", "lang", ".", "*<", "br", "/", ">", "java", ".", "util", ".", "**", "</", "td", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "<", "/", "body", ">", "<", "/", "html", ">", "@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "<", "name", ">", "Using", "XStream", "<", "/", "name", ">", "<", "page", ">", "architecture", ".", "html", "<", "/", "page", ">", "<", "page", ">", "converters", ".", "html", "<", "/", "page", ">", "<", "page", ">", "security", ".", "html", "<", "/", "page", ">", "<", "page", ">", "faq", ".", "html", "<", "/", "page", ">", "<", "page", ">", "list", "-", "user", ".", "html", "<", "/", "page", ">", "<", "page", ">", "issues", ".", "html", "<", "/", "page", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "37", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "19", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "hibernate", ".", "security", ";", "import", "org", ".", "hibernate", ".", "proxy", ".", "HibernateProxy", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "TypePermission", ";", "/", "**", "*", "Permission", "for", "any", "array", "type", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "HibernateProxyTypePermission", "implements", "TypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "static", "final", "TypePermission", "PROXIES", "=", "new", "HibernateProxyTypePermission", "(", ");", "public", "boolean", "allows", "(", "final", "Class", "type", ")", "{", "return", "type", "!", "=", "null", "&", "&", "HibernateProxy", ".", "class", ".", "isAssignableFrom", "(", "type", ")", ";", "}", "public", "int", "hashCode", "(", ")", "{", "return", "31", ";", "}", "public", "boolean", "equals", "(", "final", "Object", "obj", ")", "{", "return", "obj", "!", "=", "null", "&", "&", "obj", ".", "getClass", "(", ")", "=", "=", "HibernateProxyTypePermission", ".", "class", ";", "}", "}", "@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2003", ",", "2004", ",", "2005", ",", "2006", "Joe", "Walnes", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2008", ",", "2009", ",", "2010", ",", "2011", ",", "2012", ",", "2013", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2008", ",", "2009", ",", "2010", ",", "2011", ",", "2012", ",", "2013", ",", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "137", ",", "8", "+", "137", ",", "16", "@", "@", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ".", "MapperWrapper", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ".", "OuterClassMapper", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ".", "PackageAliasingMapper", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ".", "SecurityMapper", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ".", "SystemAttributeAliasingMapper", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ".", "XStream11XmlFriendlyMapper", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "AnyTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "ExplicitTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "NoPermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "NoTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "RegExpTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "TypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "WildcardTypePermission", ";", "/", "**", "@", "@", "-", "274", ",", "7", "+", "282", ",", "7", "@", "@", "*", "The", "XStream", "instance", "is", "thread", "-", "safe", ".", "That", "is", ",", "once", "the", "XStream", "instance", "has", "been", "created", "and", "*", "configured", ",", "it", "may", "be", "shared", "across", "multiple", "threads", "allowing", "objects", "to", "be", "*", "serialized", "/", "deserialized", "concurrently", ".", "<", "em", ">", "Note", ",", "that", "this", "only", "applies", "if", "annotations", "are", "not", "*", "auto", "-", "detected", "on", "-", "the", "-", "fly", ".", "</", "em", ">", "*", "auto", "-", "detected", "on", "-", "the", "-", "fly", ".", "</", "em", ">", "*", "<", "/", "p", ">", "*", "<", "h3", ">", "Implicit", "collections", "<", "/", "h3", ">", "*", "@", "@", "-", "310", ",", "6", "+", "318", ",", "7", "@", "@", "private", "ImmutableTypesMapper", "immutableTypesMapper", ";", "private", "ImplicitCollectionMapper", "implicitCollectionMapper", ";", "private", "LocalConversionMapper", "localConversionMapper", ";", "private", "SecurityMapper", "securityMapper", ";", "private", "AnnotationConfiguration", "annotationConfiguration", ";", "public", "static", "final", "int", "NO_REFERENCES", "=", "1001", ";", "@", "@", "-", "558", ",", "6", "+", "567", ",", "7", "@", "@", "public", "XStream", "(", "this", ".", "mapper", "=", "mapper", "=", "=", "null", "?", "buildMapper", "(", ")", ":", "mapper", ";", "setupMappers", "(", ");", "setupSecurity", "(", ");", "setupAliases", "(", ");", "setupDefaultImplementations", "(", ");", "setupConverters", "(", ");", "@", "@", "-", "588", ",", "6", "+", "598", ",", "7", "@", "@", "private", "Mapper", "buildMapper", "(", ")", "{", "}", "mapper", "=", "new", "LocalConversionMapper", "(", "mapper", ")", ";", "mapper", "=", "new", "ImmutableTypesMapper", "(", "mapper", ")", ";", "mapper", "=", "new", "SecurityMapper", "(", "mapper", ")", ";", "if", "(", "JVM", ".", "is15", "(", "))", "{", "mapper", "=", "buildMapperDynamically", "(", "ANNOTATION_MAPPER_TYPE", ",", "new", "Class", "[", "]{", "Mapper", ".", "class", ",", "ConverterRegistry", ".", "class", ",", "ConverterLookup", ".", "class", ",", "@", "@", "-", "641", ",", "9", "+", "652", ",", "19", "@", "@", "private", "void", "setupMappers", "(", ")", "{", ".", "lookupMapperOfType", "(", "ImmutableTypesMapper", ".", "class", ")", ";", "localConversionMapper", "=", "(", "LocalConversionMapper", ")", "this", ".", "mapper", ".", "lookupMapperOfType", "(", "LocalConversionMapper", ".", "class", ")", ";", "securityMapper", "=", "(", "SecurityMapper", ")", "this", ".", "mapper", ".", "lookupMapperOfType", "(", "SecurityMapper", ".", "class", ")", ";", "annotationConfiguration", "=", "(", "AnnotationConfiguration", ")", "this", ".", "mapper", ".", "lookupMapperOfType", "(", "AnnotationConfiguration", ".", "class", ")", ";", "}", "protected", "void", "setupSecurity", "(", ")", "{", "if", "(", "securityMapper", "=", "=", "null", ")", "{", "return", ";", "}", "addPermission", "(", "AnyTypePermission", ".", "ANY", ")", ";", "}", "protected", "void", "setupAliases", "(", ")", "{", "if", "(", "classAliasingMapper", "=", "=", "null", ")", "{", "@", "@", "-", "1974", ",", "6", "+", "1995", ",", "129", "@", "@", "public", "void", "autodetectAnnotations", "(", "boolean", "mode", ")", "{", "annotationConfiguration", ".", "autodetectAnnotations", "(", "mode", ")", ";", "}", "}", "/", "**", "*", "Add", "a", "new", "security", "permission", ".", "*", "*", "<", "p", ">", "*", "Permissions", "are", "evaluated", "in", "the", "added", "sequence", ".", "An", "instance", "of", "{", "@", "link", "NoTypePermission", "}", "or", "*", "{", "@", "link", "AnyTypePermission", "}", "will", "implicitly", "wipe", "any", "existing", "permission", ".", "*", "<", "/", "p", ">", "*", "*", "@", "param", "permission", "the", "permission", "to", "add", "*", "@", "since", "upcoming", "*", "/", "public", "void", "addPermission", "(", "TypePermission", "permission", ")", "{", "if", "(", "securityMapper", "!", "=", "null", ")", "{", "securityMapper", ".", "addPermission", "(", "permission", ")", ";", "}", "}", "/", "**", "*", "Add", "security", "permission", "for", "explicit", "types", "by", "name", ".", "*", "*", "@", "param", "names", "the", "type", "names", "to", "allow", "*", "@", "since", "upcoming", "*", "/", "public", "void", "allowTypes", "(", "String", ".", "..", "names", ")", "{", "addPermission", "(", "new", "ExplicitTypePermission", "(", "names", ")", ");", "}", "/", "**", "*", "Add", "security", "permission", "for", "types", "matching", "one", "of", "the", "specified", "regular", "expressions", ".", "*", "*", "@", "param", "regexps", "the", "regular", "expressions", "to", "allow", "type", "names", "*", "@", "since", "upcoming", "*", "/", "public", "void", "allowTypesByRegExp", "(", "String", ".", "..", "regexps", ")", "{", "addPermission", "(", "new", "RegExpTypePermission", "(", "regexps", ")", ");", "}", "/", "**", "*", "Add", "security", "permission", "for", "types", "matching", "one", "of", "the", "specified", "regular", "expressions", ".", "*", "*", "@", "param", "regexps", "the", "regular", "expressions", "to", "allow", "type", "names", "*", "@", "since", "upcoming", "*", "/", "public", "void", "allowTypesByRegExp", "(", "Pattern", ".", "..", "regexps", ")", "{", "addPermission", "(", "new", "RegExpTypePermission", "(", "regexps", ")", ");", "}", "/", "**", "*", "Add", "security", "permission", "for", "types", "matching", "one", "of", "the", "specified", "wildcard", "patterns", ".", "*", "<", "p", ">", "*", "Supported", "are", "patterns", "with", "path", "expressions", "using", "dot", "as", "separator", ":", "*", "<", "/", "p", ">", "*", "<", "ul", ">", "*", "<", "li", ">", "?:", "one", "non", "-", "control", "character", "except", "separator", ",", "e", ".", "g", ".", "for", "'", "java", ".", "net", ".", "Inet", "?", "Address", "'", "</", "li", ">", "*", "<", "li", ">", "*:", "arbitrary", "number", "of", "non", "-", "control", "characters", "except", "separator", ",", "e", ".", "g", ".", "for", "types", "in", "a", "package", "like", "'", "java", ".", "lang", ".", "*'", "</", "li", ">", "*", "<", "li", ">", "**", ":", "arbitrary", "number", "of", "non", "-", "control", "characters", "including", "separator", ",", "e", ".", "g", ".", "for", "types", "in", "a", "package", "and", "subpackages", "like", "'", "java", ".", "lang", ".", "**", "'<", "/", "li", ">", "*", "<", "/", "ul", ">", "*", "*", "@", "param", "patterns", "the", "patterns", "to", "allow", "type", "names", "*", "@", "since", "upcoming", "*", "/", "public", "void", "allowTypesByWildcard", "(", "String", ".", "..", "patterns", ")", "{", "addPermission", "(", "new", "WildcardTypePermission", "(", "patterns", ")", ");", "}", "/", "**", "*", "Add", "security", "permission", "denying", "another", "one", ".", "*", "*", "@", "param", "permission", "the", "permission", "to", "deny", "*", "@", "since", "upcoming", "*", "/", "public", "void", "denyPermission", "(", "TypePermission", "permission", ")", "{", "addPermission", "(", "new", "NoPermission", "(", "permission", ")", ");", "}", "/", "**", "*", "Add", "security", "permission", "forbidding", "explicit", "types", "by", "name", ".", "*", "*", "@", "param", "names", "the", "type", "names", "to", "forbid", "*", "@", "since", "upcoming", "*", "/", "public", "void", "denyTypes", "(", "String", ".", "..", "names", ")", "{", "denyPermission", "(", "new", "ExplicitTypePermission", "(", "names", ")", ");", "}", "/", "**", "*", "Add", "security", "permission", "forbidding", "types", "matching", "one", "of", "the", "specified", "regular", "expressions", ".", "*", "*", "@", "param", "regexps", "the", "regular", "expressions", "to", "forbid", "type", "names", "*", "@", "since", "upcoming", "*", "/", "public", "void", "denyTypesByRegExp", "(", "String", ".", "..", "regexps", ")", "{", "denyPermission", "(", "new", "RegExpTypePermission", "(", "regexps", ")", ");", "}", "/", "**", "*", "Add", "security", "permission", "forbidding", "types", "matching", "one", "of", "the", "specified", "regular", "expressions", ".", "*", "*", "@", "param", "regexps", "the", "regular", "expressions", "to", "forbid", "type", "names", "*", "@", "since", "upcoming", "*", "/", "public", "void", "denyTypesByRegExp", "(", "Pattern", ".", "..", "regexps", ")", "{", "denyPermission", "(", "new", "RegExpTypePermission", "(", "regexps", ")", ");", "}", "/", "**", "*", "Add", "security", "permission", "forbidding", "types", "matching", "one", "of", "the", "specified", "wildcard", "patterns", ".", "*", "<", "p", ">", "*", "Supported", "are", "patterns", "with", "path", "expressions", "using", "dot", "as", "separator", ":", "*", "<", "/", "p", ">", "*", "<", "ul", ">", "*", "<", "li", ">", "?:", "one", "non", "-", "control", "character", "except", "separator", ",", "e", ".", "g", ".", "for", "'", "java", ".", "net", ".", "Inet", "?", "Address", "'", "</", "li", ">", "*", "<", "li", ">", "*:", "arbitrary", "number", "of", "non", "-", "control", "characters", "except", "separator", ",", "e", ".", "g", ".", "for", "types", "in", "a", "package", "like", "'", "java", ".", "lang", ".", "*'", "</", "li", ">", "*", "<", "li", ">", "**", ":", "arbitrary", "number", "of", "non", "-", "control", "characters", "including", "separator", ",", "e", ".", "g", ".", "for", "types", "in", "a", "package", "and", "subpackages", "like", "'", "java", ".", "lang", ".", "**", "'<", "/", "li", ">", "*", "<", "/", "ul", ">", "*", "*", "@", "param", "patterns", "the", "patterns", "to", "forbid", "names", "*", "@", "since", "upcoming", "*", "/", "public", "void", "denyTypesByWildcard", "(", "String", ".", "..", "patterns", ")", "{", "denyPermission", "(", "new", "WildcardTypePermission", "(", "patterns", ")", ");", "}", "/", "**", "*", "@", "deprecated", "As", "of", "1", ".", "3", ",", "use", "{", "@", "link", "com", ".", "thoughtworks", ".", "xstream", ".", "InitializationException", "}", "@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2005", "Joe", "Walnes", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2008", ",", "2009", ",", "2011", ",", "2013", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2008", ",", "2009", ",", "2011", ",", "2013", ",", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "15", ",", "7", "+", "15", ",", "9", "@", "@", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "XStreamException", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "core", ".", "Caching", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "ForbiddenClassException", ";", "/", "**", "*", "Mapper", "that", "caches", "which", "names", "map", "to", "which", "classes", ".", "Prevents", "repetitive", "searching", "and", "class", "loading", ".", "@", "@", "-", "38", ",", "13", "+", "40", ",", "16", "@", "@", "public", "Class", "realClass", "(", "String", "elementName", ")", "{", "if", "(", "cached", "instanceof", "Class", ")", "{", "return", "(", "Class", ")", "cached", ";", "}", "throw", "(", "CannotResolveClassException", ")", "cached", ";", "throw", "(", "XStreamException", ")", "cached", ";", "}", "try", "{", "Class", "result", "=", "super", ".", "realClass", "(", "elementName", ")", ";", "realClassCache", ".", "put", "(", "elementName", ",", "result", ")", ";", "return", "result", ";", "}", "catch", "(", "ForbiddenClassException", "e", ")", "{", "realClassCache", ".", "put", "(", "elementName", ",", "e", ")", ";", "throw", "e", ";", "}", "catch", "(", "CannotResolveClassException", "e", ")", "{", "realClassCache", ".", "put", "(", "elementName", ",", "e", ")", ";", "throw", "e", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "77", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "08", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "AnyTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "ForbiddenClassException", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "NoTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "TypePermission", ";", "/", "**", "*", "A", "Mapper", "implementation", "injecting", "a", "security", "layer", "based", "on", "permission", "rules", "for", "any", "type", "required", "in", "the", "*", "unmarshalling", "process", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "SecurityMapper", "extends", "MapperWrapper", "{", "private", "final", "List", "<", "TypePermission", ">", "permissions", ";", "/", "**", "*", "Construct", "a", "SecurityMapper", ".", "*", "*", "@", "param", "wrapped", "the", "mapper", "chain", "*", "@", "since", "upcoming", "*", "/", "public", "SecurityMapper", "(", "final", "Mapper", "wrapped", ")", "{", "this", "(", "wrapped", ",", "(", "TypePermission", "[", "])", "null", ")", ";", "}", "/", "**", "*", "Construct", "a", "SecurityMapper", ".", "*", "*", "@", "param", "wrapped", "the", "mapper", "chain", "*", "@", "param", "permissions", "the", "predefined", "permissions", "*", "@", "since", "upcoming", "*", "/", "public", "SecurityMapper", "(", "final", "Mapper", "wrapped", ",", "final", "TypePermission", ".", "..", "permissions", ")", "{", "super", "(", "wrapped", ")", ";", "this", ".", "permissions", "=", "permissions", "=", "=", "null", "/", "/", "?", "new", "ArrayList", "<", "TypePermission", ">", "()", ":", "new", "ArrayList", "<", "TypePermission", ">", "(", "Arrays", ".", "asList", "(", "permissions", ")", ");", "}", "/", "**", "*", "Add", "a", "new", "permission", ".", "*", "<", "p", ">", "*", "Permissions", "are", "evaluated", "in", "the", "added", "sequence", ".", "An", "instance", "of", "{", "@", "link", "NoTypePermission", "}", "or", "*", "{", "@", "link", "AnyTypePermission", "}", "will", "implicitly", "wipe", "any", "existing", "permission", ".", "*", "<", "/", "p", ">", "*", "*", "@", "param", "permission", "the", "permission", "to", "add", ".", "*", "@", "since", "upcoming", "*", "/", "public", "void", "addPermission", "(", "final", "TypePermission", "permission", ")", "{", "if", "(", "permission", ".", "equals", "(", "NoTypePermission", ".", "NONE", ")", "|", "|", "permission", ".", "equals", "(", "AnyTypePermission", ".", "ANY", ")", ")", "permissions", ".", "clear", "(", ");", "permissions", ".", "add", "(", "permission", ")", ";", "}", "public", "Class", "realClass", "(", "final", "String", "elementName", ")", "{", "final", "Class", "type", "=", "super", ".", "realClass", "(", "elementName", ")", ";", "for", "(", "final", "TypePermission", "permission", ":", "permissions", ")", "if", "(", "permission", ".", "allows", "(", "type", ")", ")", "return", "type", ";", "throw", "new", "ForbiddenClassException", "(", "type", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "32", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "08", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "/", "**", "*", "Permission", "for", "any", "type", "and", "<", "code", ">", "null", "<", "/", "code", ">", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "AnyTypePermission", "implements", "TypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "static", "final", "TypePermission", "ANY", "=", "new", "AnyTypePermission", "(", ");", "public", "boolean", "allows", "(", "Class", "type", ")", "{", "return", "true", ";", "}", "public", "int", "hashCode", "(", ")", "{", "return", "3", ";", "}", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "return", "obj", "!", "=", "null", "&", "&", "obj", ".", "getClass", "(", ")", "=", "=", "AnyTypePermission", ".", "class", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "32", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "/", "**", "*", "Permission", "for", "any", "array", "type", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "ArrayTypePermission", "implements", "TypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "static", "final", "TypePermission", "ARRAYS", "=", "new", "ArrayTypePermission", "(", ");", "public", "boolean", "allows", "(", "Class", "type", ")", "{", "return", "type", "!", "=", "null", "&", "&", "type", ".", "isArray", "(", ");", "}", "public", "int", "hashCode", "(", ")", "{", "return", "13", ";", "}", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "return", "obj", "!", "=", "null", "&", "&", "obj", ".", "getClass", "(", ")", "=", "=", "ArrayTypePermission", ".", "class", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "35", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "19", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "import", "net", ".", "sf", ".", "cglib", ".", "proxy", ".", "Proxy", ";", "/", "**", "*", "Permission", "for", "any", "array", "type", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "CGLIBProxyTypePermission", "implements", "TypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "static", "final", "TypePermission", "PROXIES", "=", "new", "CGLIBProxyTypePermission", "(", ");", "public", "boolean", "allows", "(", "final", "Class", "type", ")", "{", "return", "type", "!", "=", "null", "&", "&", "Proxy", ".", "isProxyClass", "(", "type", ")", ";", "}", "public", "int", "hashCode", "(", ")", "{", "return", "19", ";", "}", "public", "boolean", "equals", "(", "final", "Object", "obj", ")", "{", "return", "obj", "!", "=", "null", "&", "&", "obj", ".", "getClass", "(", ")", "=", "=", "CGLIBProxyTypePermission", ".", "class", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "37", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "*", "Explicit", "permission", "for", "a", "type", "with", "a", "name", "matching", "one", "in", "the", "provided", "list", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "ExplicitTypePermission", "implements", "TypePermission", "{", "final", "Set", "<", "String", ">", "names", ";", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "ExplicitTypePermission", "(", "String", ".", "..", "names", ")", "{", "this", ".", "names", "=", "names", "=", "=", "null", "?", "Collections", ".", "<", "String", ">", "emptySet", "(", ")", ":", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "names", ")", ");", "}", "public", "boolean", "allows", "(", "Class", "type", ")", "{", "if", "(", "type", "=", "=", "null", ")", "return", "false", ";", "return", "names", ".", "contains", "(", "type", ".", "getName", "(", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "08", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "XStreamException", ";", "/", "**", "*", "Exception", "thrown", "for", "a", "forbidden", "class", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "ForbiddenClassException", "extends", "XStreamException", "{", "/", "**", "*", "Construct", "a", "ForbiddenClassException", ".", "*", "@", "param", "type", "the", "forbidden", "class", "*", "@", "since", "upcoming", "*", "/", "public", "ForbiddenClassException", "(", "Class", "<", "?>", "type", ")", "{", "super", "(", "type", "=", "=", "null", "?", "\"", "null", "\"", ":", "type", ".", "getName", "(", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "39", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "/", "**", "*", "Wrapper", "to", "negate", "another", "type", "permission", ".", "*", "<", "p", ">", "*", "If", "the", "wrapped", "{", "@", "link", "TypePermission", "}", "allows", "the", "type", ",", "this", "instance", "will", "throw", "a", "{", "@", "link", "ForbiddenClassException", "}", "*", "instead", ".", "An", "instance", "of", "this", "permission", "cannot", "be", "used", "to", "allow", "a", "type", ".", "*", "<", "/", "p", ">", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "NoPermission", "implements", "TypePermission", "{", "private", "final", "TypePermission", "permission", ";", "/", "**", "*", "Construct", "a", "NoPermission", ".", "*", "*", "@", "param", "permission", "the", "permission", "to", "negate", "or", "<", "code", ">", "null", "<", "/", "code", ">", "to", "forbid", "any", "type", "*", "@", "since", "upcoming", "*", "/", "public", "NoPermission", "(", "final", "TypePermission", "permission", ")", "{", "this", ".", "permission", "=", "permission", ";", "}", "public", "boolean", "allows", "(", "final", "Class", "type", ")", "{", "if", "(", "permission", "=", "=", "null", "|", "|", "permission", ".", "allows", "(", "type", ")", ")", "{", "throw", "new", "ForbiddenClassException", "(", "type", ")", ";", "}", "return", "false", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "36", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "08", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "/", "**", "*", "No", "permission", "for", "any", "type", ".", "*", "<", "p", ">", "*", "Can", "be", "used", "to", "skip", "any", "existing", "default", "permission", ".", "*", "<", "/", "p", ">", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "NoTypePermission", "implements", "TypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "static", "final", "TypePermission", "NONE", "=", "new", "NoTypePermission", "(", ");", "public", "boolean", "allows", "(", "Class", "type", ")", "{", "throw", "new", "ForbiddenClassException", "(", "type", ")", ";", "}", "public", "int", "hashCode", "(", ")", "{", "return", "1", ";", "}", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "return", "obj", "!", "=", "null", "&", "&", "obj", ".", "getClass", "(", ")", "=", "=", "NoTypePermission", ".", "class", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "26", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ".", "Mapper", ";", "/", "**", "*", "Permission", "for", "<", "code", ">", "null", "<", "/", "code", ">", "or", "XStream", "'", "s", "null", "replacement", "type", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "NullPermission", "implements", "TypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "static", "final", "TypePermission", "NULL", "=", "new", "NullPermission", "(", ");", "public", "boolean", "allows", "(", "Class", "type", ")", "{", "return", "type", "=", "=", "null", "|", "|", "type", "=", "=", "Mapper", ".", "Null", ".", "class", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "34", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "core", ".", "util", ".", "Primitives", ";", "/", "**", "*", "Permission", "for", "any", "primitive", "type", "and", "its", "boxed", "counterpart", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "PrimitiveTypePermission", "implements", "TypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "static", "final", "TypePermission", "PRIMITIVES", "=", "new", "PrimitiveTypePermission", "(", ");", "public", "boolean", "allows", "(", "Class", "type", ")", "{", "return", "type", "!", "=", "null", "&", "&", "type", ".", "isPrimitive", "(", ")", "|", "|", "Primitives", ".", "isBoxed", "(", "type", ")", ";", "}", "public", "int", "hashCode", "(", ")", "{", "return", "7", ";", "}", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "return", "obj", "!", "=", "null", "&", "&", "obj", ".", "getClass", "(", ")", "=", "=", "PrimitiveTypePermission", ".", "class", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "35", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "19", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Proxy", ";", "/", "**", "*", "Permission", "for", "any", "array", "type", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "ProxyTypePermission", "implements", "TypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "static", "final", "TypePermission", "PROXIES", "=", "new", "ProxyTypePermission", "(", ");", "public", "boolean", "allows", "(", "final", "Class", "type", ")", "{", "return", "type", "!", "=", "null", "&", "&", "Proxy", ".", "isProxyClass", "(", "type", ")", ";", "}", "public", "int", "hashCode", "(", ")", "{", "return", "17", ";", "}", "public", "boolean", "equals", "(", "final", "Object", "obj", ")", "{", "return", "obj", "!", "=", "null", "&", "&", "obj", ".", "getClass", "(", ")", "=", "=", "ProxyTypePermission", ".", "class", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "48", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "*", "Permission", "for", "any", "type", "with", "a", "name", "matching", "one", "of", "the", "provided", "regular", "expressions", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "RegExpTypePermission", "implements", "TypePermission", "{", "private", "final", "Pattern", "[", "]", "patterns", ";", "public", "RegExpTypePermission", "(", "final", "String", ".", "..", "patterns", ")", "{", "this", "(", "getPatterns", "(", "patterns", ")", ");", "}", "public", "RegExpTypePermission", "(", "final", "Pattern", ".", "..", "patterns", ")", "{", "this", ".", "patterns", "=", "patterns", "=", "=", "null", "?", "new", "Pattern", "[", "0", "]", ":", "patterns", ";", "}", "public", "boolean", "allows", "(", "final", "Class", "type", ")", "{", "if", "(", "type", "!", "=", "null", ")", "{", "final", "String", "name", "=", "type", ".", "getName", "(", ");", "for", "(", "final", "Pattern", "pattern", ":", "patterns", ")", "if", "(", "pattern", ".", "matcher", "(", "name", ")", ".", "matches", "(", "))", "return", "true", ";", "}", "return", "false", ";", "}", "private", "static", "Pattern", "[", "]", "getPatterns", "(", "final", "String", ".", "..", "patterns", ")", "{", "if", "(", "patterns", "=", "=", "null", ")", "return", "null", ";", "final", "Pattern", "[", "]", "array", "=", "new", "Pattern", "[", "patterns", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "array", ".", "length", ";", "+", "+", "i", ")", "array", "[", "i", "]", "=", "Pattern", ".", "compile", "(", "patterns", "[", "i", "]", ");", "return", "array", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "25", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "08", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "/", "**", "*", "Definition", "of", "a", "type", "permission", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "interface", "TypePermission", "{", "/", "**", "*", "Check", "permission", "for", "a", "provided", "type", ".", "*", "*", "@", "param", "type", "the", "type", "to", "check", "*", "@", "return", "<", "code", ">", "true", "<", "/", "code", ">", "if", "provided", "type", "is", "allowed", ",", "<", "code", ">", "false", "<", "/", "code", ">", "if", "permission", "does", "not", "handle", "the", "type", "*", "@", "throws", "ForbiddenClassException", "if", "provided", "type", "is", "explicitly", "forbidden", "*", "@", "since", "upcoming", "*", "/", "boolean", "allows", "(", "Class", "type", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "84", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ";", "/", "**", "*", "Permission", "for", "any", "type", "with", "a", "name", "matching", "one", "of", "the", "provided", "wildcard", "expressions", ".", "*", "*", "<", "p", ">", "*", "Supported", "are", "patterns", "with", "path", "expressions", "using", "dot", "as", "separator", ":", "*", "<", "/", "p", ">", "*", "<", "ul", ">", "*", "<", "li", ">", "?:", "one", "non", "-", "control", "character", "except", "separator", ",", "e", ".", "g", ".", "for", "'", "java", ".", "net", ".", "Inet", "?", "Address", "'", "</", "li", ">", "*", "<", "li", ">", "*:", "arbitrary", "number", "of", "non", "-", "control", "characters", "except", "separator", ",", "e", ".", "g", ".", "for", "types", "in", "a", "package", "like", "'", "java", ".", "lang", ".", "*'", "</", "li", ">", "*", "<", "li", ">", "**", ":", "arbitrary", "number", "of", "non", "-", "control", "characters", "including", "separator", ",", "e", ".", "g", ".", "for", "types", "in", "a", "package", "and", "subpackages", "like", "'", "java", ".", "lang", ".", "**", "'<", "/", "li", ">", "*", "<", "/", "ul", ">", "*", "<", "p", ">", "*", "The", "complete", "range", "of", "UTF", "-", "8", "characters", "is", "supported", "except", "control", "characters", ".", "*", "<", "/", "p", ">", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "upcoming", "*", "/", "public", "class", "WildcardTypePermission", "extends", "RegExpTypePermission", "{", "/", "**", "*", "@", "since", "upcoming", "*", "/", "public", "WildcardTypePermission", "(", "final", "String", ".", "..", "patterns", ")", "{", "super", "(", "getRegExpPatterns", "(", "patterns", ")", ");", "}", "private", "static", "String", "[", "]", "getRegExpPatterns", "(", "final", "String", ".", "..", "wildcards", ")", "{", "if", "(", "wildcards", "=", "=", "null", ")", "return", "null", ";", "final", "String", "[", "]", "regexps", "=", "new", "String", "[", "wildcards", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "wildcards", ".", "length", ";", "+", "+", "i", ")", "{", "final", "String", "wildcardExpression", "=", "wildcards", "[", "i", "]", ";", "final", "StringBuilder", "result", "=", "new", "StringBuilder", "(", "wildcardExpression", ".", "length", "(", ")", "*", "2", ")", ";", "result", ".", "append", "(", "\"(", "?", "u", ")", "\")", ";", "final", "int", "length", "=", "wildcardExpression", ".", "length", "(", ");", "for", "(", "int", "j", "=", "0", ";", "j", "<", "length", ";", "j", "+", "+)", "{", "final", "char", "ch", "=", "wildcardExpression", ".", "charAt", "(", "j", ")", ";", "switch", "(", "ch", ")", "{", "case", "'", "\\\\", "':", "case", "'", ".'", ":", "case", "'", "+'", ":", "case", "'", "|'", ":", "case", "'", "['", ":", "case", "'", "]'", ":", "case", "'", "('", ":", "case", "'", ")'", ":", "case", "'", "^'", ":", "case", "'", "$'", ":", "result", ".", "append", "(", "'\\", "\\'", ").", "append", "(", "ch", ")", ";", "break", ";", "case", "'", "?'", ":", "result", ".", "append", "(", "'.", "')", ";", "break", ";", "case", "'", "*'", ":", "/", "/", "see", "\"", "General", "Category", "Property", "\"", "in", "http", ":", "//", "www", ".", "unicode", ".", "org", "/", "reports", "/", "tr18", "/", "if", "(", "j", "+", "1", "<", "length", "&", "&", "wildcardExpression", ".", "charAt", "(", "j", "+", "1", ")", "=", "=", "'", "*'", ")", "{", "result", ".", "append", "(", "\"[", "\\\\", "P", "{", "C", "}", "]*", "\")", ";", "j", "+", "+;", "}", "else", "{", "result", ".", "append", "(", "\"[", "\\\\", "P", "{", "C", "}", "&&", "[^", "\")", ".", "append", "(", "'.", "')", ".", "append", "(", "\"]", "]*", "\")", ";", "}", "break", ";", "default", ":", "result", ".", "append", "(", "ch", ")", ";", "break", ";", "}", "}", "regexps", "[", "i", "]", "=", "result", ".", "toString", "(", ");", "}", "return", "regexps", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "207", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2014", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "Created", "on", "09", ".", "January", "2014", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "mapper", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "core", ".", "JVM", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "core", ".", "util", ".", "QuickWriter", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "AnyTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "ArrayTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "ExplicitTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "ForbiddenClassException", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "NoTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "NullPermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "PrimitiveTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "RegExpTypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "TypePermission", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "security", ".", "WildcardTypePermission", ";", "import", "junit", ".", "framework", ".", "TestCase", ";", "/", "**", "*", "Tests", "the", "{", "@", "link", "SecurityMapper", "}", "and", "the", "{", "@", "link", "TypePermission", "}", "implementations", ".", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "/", "public", "class", "SecurityMapperTest", "extends", "TestCase", "{", "private", "SecurityMapper", "mapper", ";", "private", "Map", "<", "String", ",", "Class", "<", "?>", ">", "classMap", ";", "@", "Override", "protected", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "classMap", "=", "new", "HashMap", "<", "String", ",", "Class", "<", "?>", ">(", ");", "mapper", "=", "new", "SecurityMapper", "(", "new", "MapperWrapper", "(", "null", ")", "{", "@", "Override", "public", "Class", "realClass", "(", "final", "String", "elementName", ")", "{", "return", "classMap", ".", "get", "(", "elementName", ")", ";", "}", "}", ");", "}", "private", "void", "register", "(", "final", "Class", "<", "?>", "..", ".", "types", ")", "{", "for", "(", "final", "Class", "<", "?>", "type", ":", "types", ")", "{", "classMap", ".", "put", "(", "type", ".", "getName", "(", "),", "type", ")", ";", "}", "}", "public", "void", "testAnyType", "(", ")", "{", "register", "(", "String", ".", "class", ",", "URL", ".", "class", ",", "List", ".", "class", ")", ";", "mapper", ".", "addPermission", "(", "NoTypePermission", ".", "NONE", ")", ";", "mapper", ".", "addPermission", "(", "AnyTypePermission", ".", "ANY", ")", ";", "assertSame", "(", "String", ".", "class", ",", "mapper", ".", "realClass", "(", "String", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "List", ".", "class", ",", "mapper", ".", "realClass", "(", "List", ".", "class", ".", "getName", "(", "))", ");", "assertNull", "(", "mapper", ".", "realClass", "(", "null", ")", ");", "}", "public", "void", "testNoType", "(", ")", "{", "register", "(", "String", ".", "class", ",", "URL", ".", "class", ",", "List", ".", "class", ")", ";", "mapper", ".", "addPermission", "(", "NoTypePermission", ".", "NONE", ")", ";", "try", "{", "mapper", ".", "realClass", "(", "String", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "String", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "mapper", ".", "realClass", "(", "null", ")", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "\"", "null", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "}", "public", "void", "testNullType", "(", ")", "{", "register", "(", "String", ".", "class", ",", "Mapper", ".", "Null", ".", "class", ")", ";", "mapper", ".", "addPermission", "(", "NullPermission", ".", "NULL", ")", ";", "assertSame", "(", "Mapper", ".", "Null", ".", "class", ",", "mapper", ".", "realClass", "(", "Mapper", ".", "Null", ".", "class", ".", "getName", "(", "))", ");", "assertNull", "(", "mapper", ".", "realClass", "(", "null", ")", ");", "try", "{", "mapper", ".", "realClass", "(", "String", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "String", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "}", "public", "void", "testPrimitiveTypes", "(", ")", "{", "register", "(", "String", ".", "class", ",", "int", ".", "class", ",", "Integer", ".", "class", ",", "char", "[", "].", "class", ",", "Character", "[", "].", "class", ")", ";", "mapper", ".", "addPermission", "(", "PrimitiveTypePermission", ".", "PRIMITIVES", ")", ";", "assertSame", "(", "int", ".", "class", ",", "mapper", ".", "realClass", "(", "int", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "Integer", ".", "class", ",", "mapper", ".", "realClass", "(", "Integer", ".", "class", ".", "getName", "(", "))", ");", "try", "{", "mapper", ".", "realClass", "(", "String", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "String", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "mapper", ".", "realClass", "(", "null", ")", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "\"", "null", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "mapper", ".", "realClass", "(", "char", "[", "].", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "char", "[", "].", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "}", "public", "void", "testArrayTypes", "(", ")", "{", "register", "(", "String", ".", "class", ",", "int", ".", "class", ",", "Integer", ".", "class", ",", "char", "[", "].", "class", ",", "Character", "[", "].", "class", ")", ";", "mapper", ".", "addPermission", "(", "ArrayTypePermission", ".", "ARRAYS", ")", ";", "assertSame", "(", "char", "[", "].", "class", ",", "mapper", ".", "realClass", "(", "char", "[", "].", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "Character", "[", "].", "class", ",", "mapper", ".", "realClass", "(", "Character", "[", "].", "class", ".", "getName", "(", "))", ");", "try", "{", "mapper", ".", "realClass", "(", "String", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "String", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "mapper", ".", "realClass", "(", "null", ")", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "\"", "null", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "mapper", ".", "realClass", "(", "int", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "int", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "}", "public", "void", "testExplicitTypes", "(", ")", "{", "register", "(", "String", ".", "class", ",", "List", ".", "class", ")", ";", "mapper", ".", "addPermission", "(", "new", "ExplicitTypePermission", "(", "String", ".", "class", ".", "getName", "(", "),", "List", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "String", ".", "class", ",", "mapper", ".", "realClass", "(", "String", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "List", ".", "class", ",", "mapper", ".", "realClass", "(", "List", ".", "class", ".", "getName", "(", "))", ");", "try", "{", "mapper", ".", "realClass", "(", "null", ")", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "\"", "null", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "}", "public", "void", "testNamesWithRegExps", "(", ")", "{", "class", "Foo", "$", "_0", "{", "}", "final", "Class", "<", "?>", "anonymous", "=", "new", "Object", "(", ")", "{", "}.", "getClass", "(", ");", "register", "(", "String", ".", "class", ",", "JVM", ".", "class", ",", "QuickWriter", ".", "class", ",", "Foo", "$", "_0", ".", "class", ",", "anonymous", ",", "DefaultClassMapperTest", ".", "class", ")", ";", "mapper", ".", "addPermission", "(", "new", "RegExpTypePermission", "(", "\".", "*", "Test", "\"", ",", "\"", ".*", "\\\\", ".", "core", "\\", "\\.", ".*", "\",", "\"", ".*", "SecurityMapperTest", "\\", "\\$", ".+", "\")", ");", "assertSame", "(", "DefaultClassMapperTest", ".", "class", ",", "mapper", ".", "realClass", "(", "DefaultClassMapperTest", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "JVM", ".", "class", ",", "mapper", ".", "realClass", "(", "JVM", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "QuickWriter", ".", "class", ",", "mapper", ".", "realClass", "(", "QuickWriter", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "Foo", "$", "_0", ".", "class", ",", "mapper", ".", "realClass", "(", "Foo", "$", "_0", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "anonymous", ",", "mapper", ".", "realClass", "(", "anonymous", ".", "getName", "(", "))", ");", "try", "{", "mapper", ".", "realClass", "(", "String", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "String", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "}", "public", "void", "testNamesWithWildcardPatterns", "(", ")", "{", "class", "Foo", "$", "_0", "{", "}", "class", "Foo", "$", "_1", "{", "}", "final", "Class", "<", "?>", "anonymous", "=", "new", "Object", "(", ")", "{", "}.", "getClass", "(", ");", "register", "(", "String", ".", "class", ",", "JVM", ".", "class", ",", "QuickWriter", ".", "class", ",", "Foo", "$", "_0", ".", "class", ",", "Foo", "$", "_1", ".", "class", ",", "anonymous", ")", ";", "mapper", ".", "addPermission", "(", "new", "WildcardTypePermission", "(", "\"*", "*.", "*", "_0", "\"", ",", "\"", "**", ".", "core", ".", "*\"", ",", "\"", "**", ".", "SecurityMapperTest", "$", "?\"", "))", ";", "assertSame", "(", "JVM", ".", "class", ",", "mapper", ".", "realClass", "(", "JVM", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "Foo", "$", "_0", ".", "class", ",", "mapper", ".", "realClass", "(", "Foo", "$", "_0", ".", "class", ".", "getName", "(", "))", ");", "assertSame", "(", "anonymous", ",", "mapper", ".", "realClass", "(", "anonymous", ".", "getName", "(", "))", ");", "try", "{", "mapper", ".", "realClass", "(", "String", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "String", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "mapper", ".", "realClass", "(", "QuickWriter", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "QuickWriter", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "mapper", ".", "realClass", "(", "Foo", "$", "_1", ".", "class", ".", "getName", "(", "))", ";", "fail", "(", "\"", "Thrown", "\"", "+", "ForbiddenClassException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "ForbiddenClassException", "e", ")", "{", "assertEquals", "(", "Foo", "$", "_1", ".", "class", ".", "getName", "(", "),", "e", ".", "getMessage", "(", "))", ";", "}", "}", "}"], "docstring_tokens": ["unauthenticated", "remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "303", ",", "7", "+", "303", ",", "7", "@", "@", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "hsqldb", "<", "/", "groupId", ">", "<", "artifactId", ">", "hsqldb", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "2", ".", "8", "<", "/", "version", ">", "<", "version", ">", "2", ".", "4", ".", "1", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "@", "@", "-", "123", ",", "6", "+", "123", ",", "11", "@", "@", "This", "section", "describes", "the", "various", "ways", "to", "create", "a", "query", "with", "Spring", "Data", "JPA", ".", "The", "JPA", "module", "supports", "defining", "a", "query", "manually", "as", "a", "String", "or", "having", "it", "being", "derived", "from", "the", "method", "name", ".", "Derived", "queries", "with", "the", "predicates", "`", "IsStartingWith", "`", ",", "`", "StartingWith", "`", ",", "`", "StartsWith", "`", ",", "IsEndingWith", "\"", ",", "`", "EndingWith", "`", ",", "`", "EndsWith", "`", ",", "`", "IsNotContaining", "`", ",", "`", "NotContaining", "`", ",", "`", "NotContains", "`", ",", "`", "IsContaining", "`", ",", "`", "Containing", "`", ",", "`", "Contains", "`", "the", "respective", "arguments", "for", "these", "queries", "will", "get", "sanitized", ".", "This", "means", "if", "the", "arguments", "actually", "contain", "characters", "recognized", "by", "`", "LIKE", "`", "as", "wildcards", "these", "will", "get", "escaped", "so", "they", "match", "only", "as", "literals", ".", "Compare", "with", "<", "<", "jpa", ".", "query", ".", "spel", "-", "expressions", ">", ">.", "=", "==", "=", "Declared", "Queries", "Although", "getting", "a", "query", "derived", "from", "the", "method", "name", "is", "quite", "convenient", ",", "one", "might", "face", "the", "situation", "in", "which", "either", "the", "method", "name", "parser", "does", "not", "support", "the", "keyword", "one", "wants", "to", "use", "or", "the", "method", "name", "would", "get", "unnecessarily", "ugly", ".", "So", "you", "can", "either", "use", "JPA", "named", "queries", "through", "a", "naming", "convention", "(", "see", "<", "<", "jpa", ".", "query", "-", "methods", ".", "named", "-", "queries", ">", ">", "for", "more", "information", ")", "or", "rather", "annotate", "your", "query", "method", "with", "`", "@", "Query", "`", "(", "see", "<", "<", "jpa", ".", "query", "-", "methods", ".", "at", "-", "query", ">", ">", "for", "details", ")", ".", "@", "@", "-", "427", ",", "6", "+", "432", ",", "51", "@", "@", "public", "interface", "ConcreteRepository", "In", "the", "preceding", "example", ",", "the", "`", "MappedTypeRepository", "`", "interface", "is", "the", "common", "parent", "interface", "for", "a", "few", "domain", "types", "extending", "`", "AbstractMappedType", "`", ".", "It", "also", "defines", "the", "generic", "`", "findAllByAttribute", "(", "\u2026)", "`", "method", ",", "which", "can", "be", "used", "on", "instances", "of", "the", "specialized", "repository", "interfaces", ".", "If", "you", "now", "invoke", "`", "findByAllAttribute", "(", "\u2026)", "`", "on", "`", "ConcreteRepository", "`", ",", "the", "query", "becomes", "`", "select", "t", "from", "ConcreteType", "t", "where", "t", ".", "attribute", "=", "?", "1", "`", ".", "SpEL", "expressions", "to", "manipulate", "arguments", "may", "also", "be", "used", "to", "manipulate", "method", "arguments", ".", "In", "these", "SpEL", "expressions", "the", "entity", "name", "is", "not", "available", ",", "but", "the", "arguments", "are", ".", "They", "can", "be", "accessed", "by", "name", "or", "index", "as", "demonstrated", "in", "the", "following", "example", ".", ".", "Using", "SpEL", "expressions", "in", "repository", "query", "methods", "-", "accessing", "arguments", ".", "=", "==", "=", "[", "source", ",", "java", "]", "-", "--", "-", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "=", "?", "1", "and", "u", ".", "firstname", "=", "?#", "{[", "0", "]", "}", "and", "u", ".", "emailAddress", "=", "?", "#{", "principal", ".", "emailAddress", "}", "\")", "List", "<", "User", ">", "findByFirstnameAndCurrentUserWithCustomQuery", "(", "String", "firstname", ")", ";", "-", "--", "-", "=", "==", "=", "For", "`", "like", "`", "-", "conditions", "one", "often", "wants", "to", "appen", "`", "%`", "to", "the", "beginning", "or", "the", "end", "of", "a", "String", "valued", "parameter", ".", "This", "can", "be", "done", "by", "appending", "or", "prefixing", "a", "bind", "parameter", "marker", "or", "a", "SpEL", "expression", "with", "`", "%`", ".", "Again", "the", "following", "example", "demonstrates", "this", ".", ".", "Using", "SpEL", "expressions", "in", "repository", "query", "methods", "-", "wildcard", "shortcut", ".", "=", "==", "=", "[", "source", ",", "java", "]", "-", "--", "-", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "lastname", "like", "%", ":#", "{[", "0", "]", "}%", "and", "u", ".", "lastname", "like", "%", ":", "lastname", "%", "\")", "List", "<", "User", ">", "findByLastnameWithSpelExpression", "(", "@", "Param", "(", "\"", "lastname", "\"", ")", "String", "lastname", ")", ";", "-", "--", "-", "=", "==", "=", "When", "using", "`", "like", "`", "-", "conditions", "with", "values", "that", "are", "coming", "from", "a", "not", "secure", "source", "the", "values", "should", "be", "sanitized", "so", "they", "can", "'", "t", "contain", "any", "wildcards", "and", "thereby", "allow", "attackers", "to", "select", "more", "data", "than", "they", "should", "be", "able", "to", ".", "For", "this", "purpose", "the", "the", "`", "escape", "(", "String", ",", "String", ")", "`", "method", "is", "made", "available", "in", "the", "SpEL", "context", ".", "It", "prefixes", "all", "instances", "of", "`", "_", "`", "and", "`", "%`", "in", "the", "first", "argument", "with", "the", "single", "character", "from", "the", "second", "argument", ".", "In", "combination", "with", "the", "`", "escape", "`", "clause", "of", "the", "`", "like", "`", "expression", "available", "in", "JPQL", "and", "standard", "SQL", "this", "allows", "easy", "cleaning", "of", "bind", "parameters", ".", ".", "Using", "SpEL", "expressions", "in", "repository", "query", "methods", "-", "sanitizing", "input", "values", ".", "=", "==", "=", "[", "source", ",", "java", "]", "-", "--", "-", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "like", "%", "?#", "{#", "escape", "(", "[", "0", "]", ",'", "#'", ")}", "%", "escape", "'", "#'", "\")", "List", "<", "User", ">", "findContainingEscaped", "(", "String", "namePart", ")", ";", "-", "--", "-", "=", "==", "=", "Given", "this", "method", "declaration", "in", "an", "repository", "interface", "`", "findContainingEscaped", "(", "\"", "Peter_", "\"", ")\"", "will", "find", "`", "Peter_Parker", "`", "but", "not", "`", "Peter", "Parker", "`", ".", "Note", "that", "the", "method", "`", "escape", "(", "String", ",", "String", ")", "`", "available", "in", "the", "SpEL", "context", "will", "only", "escape", "the", "SQL", "and", "JPQL", "standard", "wildcards", "`", "_", "`", "and", "`", "%`", ".", "If", "the", "underlying", "database", "or", "the", "JPA", "implementation", "supports", "additional", "wildcards", "these", "will", "not", "get", "escaped", ".", "[", "[", "jpa", ".", "modifying", "-", "queries", "]", "]", "=", "==", "Modifying", "Queries", "@", "@", "-", "150", ",", "4", "+", "150", ",", "12", "@", "@", "*", "@", "return", "whether", "to", "enable", "default", "transactions", ",", "defaults", "to", "{", "@", "literal", "true", "}", ".", "*", "/", "boolean", "enableDefaultTransactions", "(", ")", "default", "true", ";", "/", "**", "*", "Configures", "what", "character", "is", "used", "to", "escape", "the", "wildcards", "{", "@", "literal", "_", "}", "and", "{", "@", "literal", "%", "}", "in", "derived", "queries", "with", "*", "{", "@", "literal", "contains", "}", ",", "{", "@", "literal", "startsWith", "}", "or", "{", "@", "literal", "endsWith", "}", "clauses", ".", "*", "*", "@", "return", "a", "single", "character", "used", "for", "escaping", ".", "*", "/", "char", "escapeCharacter", "(", ")", "default", "'", "\\\\", "';", "}", "@", "@", "-", "54", ",", "7", "+", "54", ",", "7", "@", "@", "*", "{", "@", "link", "PersistenceUnit", "}", "annotated", "properties", "and", "methods", ")", "as", "well", "as", "*", "{", "@", "link", "PersistenceExceptionTranslationPostProcessor", "}", "to", "enable", "exception", "translation", "of", "persistence", "specific", "*", "exceptions", "into", "Spring", "'", "s", "{", "@", "link", "DataAccessException", "}", "hierarchy", ".", "*", "*", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Eberhard", "Wolff", "*", "@", "author", "Gil", "Markham", "@", "@", "-", "66", ",", "7", "+", "66", ",", "7", "@", "@", "private", "static", "final", "String", "DEFAULT_TRANSACTION_MANAGER_BEAN_NAME", "=", "\"", "transactionManager", "\"", ";", "private", "static", "final", "String", "ENABLE_DEFAULT_TRANSACTIONS_ATTRIBUTE", "=", "\"", "enableDefaultTransactions", "\"", ";", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationExtensionSupport", "#", "getModuleName", "(", ")", "*", "/", "@", "@", "-", "75", ",", "15", "+", "75", ",", "15", "@", "@", "public", "String", "getModuleName", "(", ")", "{", "return", "\"", "JPA", "\"", ";", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config14", ".", "RepositoryConfigurationExtension", "#", "getRepositoryInterface", "(", ")", "*", "/", "public", "String", "getRepositoryFactoryClassName", "(", ")", "{", "return", "JpaRepositoryFactoryBean", ".", "class", ".", "getName", "(", ");", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config14", ".", "RepositoryConfigurationExtensionSupport", "#", "getModulePrefix", "(", ")", "*", "/", "@", "@", "-", "92", ",", "7", "+", "92", ",", "7", "@", "@", "protected", "String", "getModulePrefix", "(", ")", "{", "return", "getModuleName", "(", ").", "toLowerCase", "(", "Locale", ".", "US", ")", ";", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationExtensionSupport", "#", "getIdentifyingAnnotations", "(", ")", "*", "/", "@", "@", "-", "102", ",", "7", "+", "102", ",", "7", "@", "@", "protected", "String", "getModulePrefix", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "Entity", ".", "class", ",", "MappedSuperclass", ".", "class", ")", ";", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationExtensionSupport", "#", "getIdentifyingTypes", "(", ")", "*", "/", "@", "@", "-", "111", ",", "21", "+", "111", ",", "42", "@", "@", "protected", "String", "getModulePrefix", "(", ")", "{", "return", "Collections", ".", "<", "Class", "<", "?>", ">", "singleton", "(", "JpaRepository", ".", "class", ")", ";", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationExtensionSupport", "#", "postProcess", "(", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "support", ".", "BeanDefinitionBuilder", ",", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationSource", ")", "*", "/", "@", "Override", "public", "void", "postProcess", "(", "BeanDefinitionBuilder", "builder", ",", "RepositoryConfigurationSource", "source", ")", "{", "Character", "escapeCharacter", "=", "getEscapeCharacter", "(", "source", ")", ";", "String", "transactionManagerRef", "=", "source", ".", "getAttribute", "(", "\"", "transactionManagerRef", "\"", ");", "builder", ".", "addPropertyValue", "(", "\"", "transactionManager", "\"", ",", "transactionManagerRef", "=", "=", "null", "?", "DEFAULT_TRANSACTION_MANAGER_BEAN_NAME", ":", "transactionManagerRef", ")", ";", "builder", ".", "addPropertyValue", "(", "\"", "entityManager", "\"", ",", "getEntityManagerBeanDefinitionFor", "(", "source", ",", "source", ".", "getSource", "(", "))", ");", "builder", ".", "addPropertyValue", "(", "\"", "escapeCharacter", "\"", ",", "escapeCharacter", "=", "=", "null", "?", "'", "\\\\", "'", ":", "escapeCharacter", ")", ";", "builder", ".", "addPropertyReference", "(", "\"", "mappingContext", "\"", ",", "JPA_MAPPING_CONTEXT_BEAN_NAME", ")", ";", "}", "/", "*", "/", "**", "*", "XML", "configurations", "do", "not", "support", "{", "@", "link", "Character", "}", "values", ".", "This", "method", "catches", "the", "exception", "thrown", "and", "returns", "an", "*", "{", "@", "link", "Optional", "#", "empty", "(", ")}", "instead", ".", "*", "/", "private", "static", "Character", "getEscapeCharacter", "(", "RepositoryConfigurationSource", "source", ")", "{", "try", "{", "return", "AnnotationRepositoryConfigurationSource", ".", "class", ".", "isInstance", "(", "source", ")", "/", "/", "?", "(", "Character", ")", "AnnotationRepositoryConfigurationSource", ".", "class", ".", "cast", "(", "source", ")", ".", "getAttributes", "(", ")", ".", "get", "(", "\"", "escapeCharacter", "\"", ")", "/", "/", ":", "source", ".", "getAttribute", "(", "\"", "escapeCharacter", "\"", ").", "toCharArray", "(", ")[", "0", "]", ";", "}", "catch", "(", "IllegalArgumentException", "___", ")", "{", "return", "null", ";", "}", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationExtensionSupport", "#", "postProcess", "(", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "support", ".", "BeanDefinitionBuilder", ",", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "AnnotationRepositoryConfigurationSource", ")", "*", "/", "@", "@", "-", "138", ",", "7", "+", "159", ",", "7", "@", "@", "public", "void", "postProcess", "(", "BeanDefinitionBuilder", "builder", ",", "AnnotationRepositoryConfi", "attributes", ".", "getBoolean", "(", "ENABLE_DEFAULT_TRANSACTIONS_ATTRIBUTE", ")", ");", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationExtensionSupport", "#", "postProcess", "(", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "support", ".", "BeanDefinitionBuilder", ",", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "XmlRepositoryConfigurationSource", ")", "*", "/", "@", "@", "-", "152", ",", "7", "+", "173", ",", "7", "@", "@", "public", "void", "postProcess", "(", "BeanDefinitionBuilder", "builder", ",", "XmlRepositoryConfiguratio", "}", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationExtensionSupport", "#", "registerBeansForRoot", "(", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "support", ".", "BeanDefinitionRegistry", ",", "org", ".", "springframework", ".", "data", ".", "repository", ".", "config", ".", "RepositoryConfigurationSource", ")", "*", "/", "@", "@", "-", "183", ",", "7", "+", "204", ",", "7", "@", "@", "public", "void", "registerBeansForRoot", "(", "BeanDefinitionRegistry", "registry", ",", "RepositoryConf", "/", "**", "*", "Creates", "an", "anonymous", "factory", "to", "extract", "the", "actual", "{", "@", "link", "javax", ".", "persistence", ".", "EntityManager", "}", "from", "the", "*", "{", "@", "link", "javax", ".", "persistence", ".", "EntityManagerFactory", "}", "bean", "name", "reference", ".", "*", "*", "*", "@", "param", "entityManagerFactoryBeanName", "*", "@", "param", "source", "*", "@", "return", "@", "@", "-", "35", ",", "6", "+", "35", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "ParameterMetadataProvider", ".", "ParameterMetadata", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ReturnedType", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "parser", ".", "AbstractQueryCreator", ";", "@", "@", "-", "57", ",", "6", "+", "58", ",", "7", "@", "@", "private", "final", "ParameterMetadataProvider", "provider", ";", "private", "final", "ReturnedType", "returnedType", ";", "private", "final", "PartTree", "tree", ";", "private", "final", "EscapeCharacter", "escape", ";", "/", "**", "*", "Create", "a", "new", "{", "@", "link", "JpaQueryCreator", "}", ".", "@", "@", "-", "72", ",", "13", "+", "74", ",", "14", "@", "@", "public", "JpaQueryCreator", "(", "PartTree", "tree", ",", "ReturnedType", "type", ",", "CriteriaBuilder", "builder", "super", "(", "tree", ")", ";", "this", ".", "tree", "=", "tree", ";", "CriteriaQuery", "<", "?", "extends", "Object", ">", "criteriaQuery", "=", "createCriteriaQuery", "(", "builder", ",", "type", ")", ";", "CriteriaQuery", "<", "?>", "criteriaQuery", "=", "createCriteriaQuery", "(", "builder", ",", "type", ")", ";", "this", ".", "builder", "=", "builder", ";", "this", ".", "query", "=", "criteriaQuery", ".", "distinct", "(", "tree", ".", "isDistinct", "(", "))", ";", "this", ".", "root", "=", "query", ".", "from", "(", "type", ".", "getDomainType", "(", "))", ";", "this", ".", "provider", "=", "provider", ";", "this", ".", "returnedType", "=", "type", ";", "this", ".", "escape", "=", "provider", ".", "getEscape", "(", ");", "}", "/", "**", "@", "@", "-", "289", ",", "7", "+", "292", ",", "7", "@", "@", "public", "Predicate", "build", "(", ")", "{", "Expression", "<", "String", ">", "stringPath", "=", "getTypedPath", "(", "root", ",", "part", ")", ";", "Expression", "<", "String", ">", "propertyExpression", "=", "upperIfIgnoreCase", "(", "stringPath", ")", ";", "Expression", "<", "String", ">", "parameterExpression", "=", "upperIfIgnoreCase", "(", "provider", ".", "next", "(", "part", ",", "String", ".", "class", ")", ".", "getExpression", "(", "))", ";", "Predicate", "like", "=", "builder", ".", "like", "(", "propertyExpression", ",", "parameterExpression", ")", ";", "Predicate", "like", "=", "builder", ".", "like", "(", "propertyExpression", ",", "parameterExpression", ",", "escape", ".", "getValue", "(", "))", ";", "return", "type", ".", "equals", "(", "NOT_LIKE", ")", "|", "|", "type", ".", "equals", "(", "NOT_CONTAINING", ")", "?", "like", ".", "not", "(", ")", ":", "like", ";", "case", "TRUE", ":", "Expression", "<", "Boolean", ">", "truePath", "=", "getTypedPath", "(", "root", ",", "part", ")", ";", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "QueryExtractor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "Query", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "projection", ".", "ProjectionFactory", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "NamedQueries", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "RepositoryMetadata", ";", "@", "@", "-", "89", ",", "16", "+", "90", ",", "19", "@", "@", "public", "final", "RepositoryQuery", "resolveQuery", "(", "Method", "method", ",", "RepositoryMetadata", "meta", "private", "static", "class", "CreateQueryLookupStrategy", "extends", "AbstractQueryLookupStrategy", "{", "private", "final", "PersistenceProvider", "persistenceProvider", ";", "private", "final", "EscapeCharacter", "escape", ";", "public", "CreateQueryLookupStrategy", "(", "EntityManager", "em", ",", "QueryExtractor", "extractor", ")", "{", "public", "CreateQueryLookupStrategy", "(", "EntityManager", "em", ",", "QueryExtractor", "extractor", ",", "EscapeCharacter", "escape", ")", "{", "super", "(", "em", ",", "extractor", ")", ";", "this", ".", "persistenceProvider", "=", "PersistenceProvider", ".", "fromEntityManager", "(", "em", ")", ";", "this", ".", "escape", "=", "escape", ";", "}", "@", "Override", "protected", "RepositoryQuery", "resolveQuery", "(", "JpaQueryMethod", "method", ",", "EntityManager", "em", ",", "NamedQueries", "namedQueries", ")", "{", "return", "new", "PartTreeJpaQuery", "(", "method", ",", "em", ",", "persistenceProvider", ")", ";", "return", "new", "PartTreeJpaQuery", "(", "method", ",", "em", ",", "persistenceProvider", ",", "escape", ")", ";", "}", "}", "@", "@", "-", "216", ",", "22", "+", "220", ",", "24", "@", "@", "protected", "RepositoryQuery", "resolveQuery", "(", "JpaQueryMethod", "method", ",", "EntityManager", "em", ",", "*", "@", "param", "key", "may", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "extractor", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "evaluationContextProvider", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "escape", "*", "@", "return", "*", "/", "public", "static", "QueryLookupStrategy", "create", "(", "EntityManager", "em", ",", "Key", "key", ",", "QueryExtractor", "extractor", ",", "EvaluationContextProvider", "evaluationContextProvider", ")", "{", "EvaluationContextProvider", "evaluationContextProvider", ",", "EscapeCharacter", "escape", ")", "{", "Assert", ".", "notNull", "(", "em", ",", "\"", "EntityManager", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notNull", "(", "extractor", ",", "\"", "QueryExtractor", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notNull", "(", "evaluationContextProvider", ",", "\"", "EvaluationContextProvider", "must", "not", "be", "null", "!", "\")", ";", "switch", "(", "key", "!", "=", "null", "?", "key", ":", "Key", ".", "CREATE_IF_NOT_FOUND", ")", "{", "case", "CREATE", ":", "return", "new", "CreateQueryLookupStrategy", "(", "em", ",", "extractor", ")", ";", "return", "new", "CreateQueryLookupStrategy", "(", "em", ",", "extractor", ",", "escape", ")", ";", "case", "USE_DECLARED_QUERY", ":", "return", "new", "DeclaredQueryLookupStrategy", "(", "em", ",", "extractor", ",", "evaluationContextProvider", ")", ";", "case", "CREATE_IF_NOT_FOUND", ":", "return", "new", "CreateIfNotFoundQueryLookupStrategy", "(", "em", ",", "extractor", ",", "new", "CreateQueryLookupStrategy", "(", "em", ",", "extractor", ")", ",", "return", "new", "CreateIfNotFoundQueryLookupStrategy", "(", "em", ",", "extractor", ",", "new", "CreateQueryLookupStrategy", "(", "em", ",", "extractor", ",", "escape", ")", ",", "new", "DeclaredQueryLookupStrategy", "(", "em", ",", "extractor", ",", "evaluationContextProvider", ")", ");", "default", ":", "throw", "new", "IllegalArgumentException", "(", "String", ".", "format", "(", "\"", "Unsupported", "query", "lookup", "strategy", "%", "s", "!", "\",", "key", ")", ");", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "javax", ".", "persistence", ".", "criteria", ".", "ParameterExpression", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ParametersParameterAccessor", ";", "@", "@", "-", "50", ",", "6", "+", "51", ",", "7", "@", "@", "private", "final", "List", "<", "ParameterMetadata", "<", "?>", ">", "expressions", ";", "private", "final", "Iterator", "<", "Object", ">", "bindableParameterValues", ";", "private", "final", "PersistenceProvider", "persistenceProvider", ";", "private", "final", "EscapeCharacter", "escape", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "ParameterMetadataProvider", "}", "from", "the", "given", "{", "@", "link", "CriteriaBuilder", "}", "and", "@", "@", "-", "59", ",", "22", "+", "61", ",", "24", "@", "@", "*", "@", "param", "builder", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "accessor", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "provider", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "escape", "*", "/", "public", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "ParametersParameterAccessor", "accessor", ",", "PersistenceProvider", "provider", ")", "{", "this", "(", "builder", ",", "accessor", ".", "iterator", "(", "),", "accessor", ".", "getParameters", "(", "),", "provider", ")", ";", "PersistenceProvider", "provider", ",", "EscapeCharacter", "escape", ")", "{", "this", "(", "builder", ",", "accessor", ".", "iterator", "(", "),", "accessor", ".", "getParameters", "(", "),", "provider", ",", "escape", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "ParameterMetadataProvider", "}", "from", "the", "given", "{", "@", "link", "CriteriaBuilder", "}", "and", "{", "@", "link", "Parameters", "}", "with", "*", "support", "for", "parameter", "value", "customizations", "via", "{", "@", "link", "PersistenceProvider", "}", ".", "*", "*", "@", "param", "builder", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "builder", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "parameters", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "provider", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "escape", "*", "/", "public", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Parameters", "<", "?,", "?", ">", "parameters", ",", "PersistenceProvider", "provider", ")", "{", "this", "(", "builder", ",", "null", ",", "parameters", ",", "provider", ")", ";", "public", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Parameters", "<", "?,", "?", ">", "parameters", ",", "PersistenceProvider", "provider", ",", "EscapeCharacter", "escape", ")", "{", "this", "(", "builder", ",", "null", ",", "parameters", ",", "provider", ",", "escape", ")", ";", "}", "/", "**", "@", "@", "-", "86", ",", "9", "+", "90", ",", "10", "@", "@", "public", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Parameters", "<", "?,", "?", ">", "param", "*", "@", "param", "bindableParameterValues", "may", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "parameters", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "provider", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "escape", "*", "/", "private", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Iterator", "<", "Object", ">", "bindableParameterValues", ",", "Parameters", "<", "?,", "?", ">", "parameters", ",", "PersistenceProvider", "provider", ")", "{", "Parameters", "<", "?,", "?", ">", "parameters", ",", "PersistenceProvider", "provider", ",", "EscapeCharacter", "escape", ")", "{", "Assert", ".", "notNull", "(", "builder", ",", "\"", "CriteriaBuilder", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notNull", "(", "parameters", ",", "\"", "Parameters", "must", "not", "be", "null", "!", "\")", ";", "@", "@", "-", "99", ",", "6", "+", "104", ",", "7", "@", "@", "private", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Iterator", "<", "Object", ">", "bind", "this", ".", "expressions", "=", "new", "ArrayList", "<", "ParameterMetadata", "<", "?>", ">(", ");", "this", ".", "bindableParameterValues", "=", "bindableParameterValues", ";", "this", ".", "persistenceProvider", "=", "provider", ";", "this", ".", "escape", "=", "escape", ";", "}", "/", "**", "@", "@", "-", "165", ",", "12", "+", "171", ",", "16", "@", "@", "private", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Iterator", "<", "Object", ">", "bind", ":", "builder", ".", "parameter", "(", "reifiedType", ")", ";", "ParameterMetadata", "<", "T", ">", "value", "=", "new", "ParameterMetadata", "<", "T", ">", "(", "expression", ",", "part", ".", "getType", "(", "),", "bindableParameterValues", "=", "=", "null", "?", "ParameterMetadata", ".", "PLACEHOLDER", ":", "bindableParameterValues", ".", "next", "(", "),", "this", ".", "persistenceProvider", ")", ";", "this", ".", "persistenceProvider", ",", "escape", ")", ";", "expressions", ".", "add", "(", "value", ")", ";", "return", "value", ";", "}", "EscapeCharacter", "getEscape", "(", ")", "{", "return", "escape", ";", "}", "/", "**", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Thomas", "Darimont", "@", "@", "-", "183", ",", "6", "+", "193", ",", "7", "@", "@", "private", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Iterator", "<", "Object", ">", "bind", "private", "final", "Type", "type", ";", "private", "final", "ParameterExpression", "<", "T", ">", "expression", ";", "private", "final", "PersistenceProvider", "persistenceProvider", ";", "private", "final", "EscapeCharacter", "escape", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "ParameterMetadata", "}", ".", "@", "@", "-", "191", ",", "12", "+", "202", ",", "14", "@", "@", "private", "ParameterMetadataProvider", "(", "CriteriaBuilder", "builder", ",", "Iterator", "<", "Object", ">", "bind", "*", "@", "param", "type", "*", "@", "param", "value", "*", "@", "param", "provider", "*", "@", "param", "escape", "*", "/", "public", "ParameterMetadata", "(", "ParameterExpression", "<", "T", ">", "expression", ",", "Type", "type", ",", "Object", "value", ",", "PersistenceProvider", "provider", ")", "{", "public", "ParameterMetadata", "(", "ParameterExpression", "<", "T", ">", "expression", ",", "Type", "type", ",", "Object", "value", ",", "PersistenceProvider", "provider", ",", "EscapeCharacter", "escape", ")", "{", "this", ".", "expression", "=", "expression", ";", "this", ".", "persistenceProvider", "=", "provider", ";", "this", ".", "type", "=", "value", "=", "=", "null", "&", "&", "Type", ".", "SIMPLE_PROPERTY", ".", "equals", "(", "type", ")", "?", "Type", ".", "IS_NULL", ":", "type", ";", "this", ".", "escape", "=", "escape", ";", "}", "/", "**", "@", "@", "-", "233", ",", "12", "+", "246", ",", "12", "@", "@", "public", "Object", "prepare", "(", "Object", "value", ")", "{", "switch", "(", "type", ")", "{", "case", "STARTING_WITH", ":", "return", "String", ".", "format", "(", "\"%", "s", "%", "%\"", ",", "value", ".", "toString", "(", "))", ";", "return", "String", ".", "format", "(", "\"%", "s", "%", "%\"", ",", "escape", ".", "escape", "(", "value", ".", "toString", "(", "))", ");", "case", "ENDING_WITH", ":", "return", "String", ".", "format", "(", "\"%", "%%", "s", "\"", ",", "value", ".", "toString", "(", "))", ";", "return", "String", ".", "format", "(", "\"%", "%%", "s", "\"", ",", "escape", ".", "escape", "(", "value", ".", "toString", "(", "))", ");", "case", "CONTAINING", ":", "case", "NOT_CONTAINING", ":", "return", "String", ".", "format", "(", "\"%", "%%", "s", "%", "%\"", ",", "value", ".", "toString", "(", "))", ";", "return", "String", ".", "format", "(", "\"%", "%%", "s", "%", "%\"", ",", "escape", ".", "escape", "(", "value", ".", "toString", "(", "))", ");", "default", ":", "return", "value", ";", "}", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "JpaQueryExecution", ".", "DeleteExecution", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "JpaQueryExecution", ".", "ExistsExecution", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "ParameterMetadataProvider", ".", "ParameterMetadata", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ParametersParameterAccessor", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ResultProcessor", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "parser", ".", "PartTree", ";", "@", "@", "-", "47", ",", "19", "+", "48", ",", "23", "@", "@", "private", "final", "QueryPreparer", "query", ";", "private", "final", "QueryPreparer", "countQuery", ";", "private", "final", "EntityManager", "em", ";", "private", "final", "EscapeCharacter", "escape", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "PartTreeJpaQuery", "}", ".", "*", "*", "@", "param", "method", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "factory", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "em", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "persistenceProvider", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "escape", "*", "/", "public", "PartTreeJpaQuery", "(", "JpaQueryMethod", "method", ",", "EntityManager", "em", ",", "PersistenceProvider", "persistenceProvider", ")", "{", "public", "PartTreeJpaQuery", "(", "JpaQueryMethod", "method", ",", "EntityManager", "em", ",", "PersistenceProvider", "persistenceProvider", ",", "EscapeCharacter", "escape", ")", "{", "super", "(", "method", ",", "em", ")", ";", "this", ".", "em", "=", "em", ";", "this", ".", "escape", "=", "escape", ";", "this", ".", "domainClass", "=", "method", ".", "getEntityInformation", "(", ").", "getJavaType", "(", ");", "this", ".", "parameters", "=", "method", ".", "getParameters", "(", ");", "@", "@", "-", "216", ",", "8", "+", "221", ",", "8", "@", "@", "protected", "JpaQueryCreator", "createCreator", "(", "ParametersParameterAccessor", "accessor", ",", "CriteriaBuilder", "builder", "=", "entityManager", ".", "getCriteriaBuilder", "(", ");", "ParameterMetadataProvider", "provider", "=", "accessor", "=", "=", "null", "?", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ")", ":", "new", "ParameterMetadataProvider", "(", "builder", ",", "accessor", ",", "persistenceProvider", ")", ";", "?", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ",", "escape", ")", ":", "new", "ParameterMetadataProvider", "(", "builder", ",", "accessor", ",", "persistenceProvider", ",", "escape", ")", ";", "ResultProcessor", "resultFactory", "=", "getQueryMethod", "(", ").", "getResultProcessor", "(", ").", "withDynamicProjection", "(", "accessor", ")", ";", "@", "@", "-", "271", ",", "8", "+", "276", ",", "8", "@", "@", "protected", "JpaQueryCreator", "createCreator", "(", "ParametersParameterAccessor", "accessor", ",", "CriteriaBuilder", "builder", "=", "entityManager", ".", "getCriteriaBuilder", "(", ");", "ParameterMetadataProvider", "provider", "=", "accessor", "=", "=", "null", "?", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ")", ":", "new", "ParameterMetadataProvider", "(", "builder", ",", "accessor", ",", "persistenceProvider", ")", ";", "?", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ",", "escape", ")", ":", "new", "ParameterMetadataProvider", "(", "builder", ",", "accessor", ",", "persistenceProvider", ",", "escape", ")", ";", "return", "new", "JpaCountQueryCreator", "(", "tree", ",", "getQueryMethod", "(", ").", "getResultProcessor", "(", ").", "getReturnedType", "(", "),", "builder", ",", "provider", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "47", "@", "@", "/", "*", "*", "Copyright", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ";", "import", "lombok", ".", "Value", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "/", "**", "*", "A", "Value", "-", "class", "encapsulating", "an", "escape", "character", "for", "LIKE", "queries", "and", "the", "actually", "usage", "of", "it", "in", "escaping", "Strings", ".", "*", "*", "@", "author", "Jens", "Schauder", "*", "/", "@", "Value", "(", "staticConstructor", "=", "\"", "of", "\"", ")", "public", "class", "EscapeCharacter", "{", "char", "value", ";", "public", "String", "escape", "(", "String", "value", ")", "{", "Assert", ".", "notNull", "(", "value", ",", "\"", "Value", "must", "be", "not", "null", ".", "\")", ";", "return", "value", ".", "replace", "(", "\"", "_", "\"", ",", "value", "+", "\"", "_", "\"", ").", "replace", "(", "\"%", "\",", "value", "+", "\"", "%\"", ");", "}", "/", "/", "used", "for", "SpEL", "expressions", "static", "String", "escape", "(", "String", "value", ",", "String", "escape", ")", "{", "Assert", ".", "hasText", "(", "escape", ",", "\"", "escape", "must", "be", "a", "sinlge", "character", "String", ".", "\")", ";", "char", "[", "]", "chars", "=", "escape", ".", "toCharArray", "(", ");", "Assert", ".", "isTrue", "(", "chars", ".", "length", "=", "=", "1", ",", "\"", "escape", "must", "be", "a", "single", "character", "String", ".", "\")", ";", "return", "EscapeCharacter", ".", "of", "(", "chars", "[", "0", "]", ").", "escape", "(", "value", ")", ";", "}", "}", "@", "@", "-", "47", ",", "7", "+", "47", ",", "7", "@", "@", "/", "**", "*", "JPA", "specific", "generic", "repository", "factory", ".", "*", "*", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Mark", "Paluch", "*", "@", "author", "Jens", "Schauder", "@", "@", "-", "58", ",", "9", "+", "58", ",", "11", "@", "@", "private", "final", "QueryExtractor", "extractor", ";", "private", "final", "CrudMethodMetadataPostProcessor", "crudMethodMetadataPostProcessor", ";", "private", "EscapeCharacter", "escapeCharacter", "=", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", ");", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaRepositoryFactory", "}", ".", "*", "*", "*", "@", "param", "entityManager", "must", "not", "be", "{", "@", "literal", "null", "}", "*", "/", "public", "JpaRepositoryFactory", "(", "EntityManager", "entityManager", ")", "{", "@", "@", "-", "78", ",", "7", "+", "80", ",", "7", "@", "@", "public", "JpaRepositoryFactory", "(", "EntityManager", "entityManager", ")", "{", "}", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "RepositoryFactorySupport", "#", "setBeanClassLoader", "(", "java", ".", "lang", ".", "ClassLoader", ")", "*", "/", "@", "@", "-", "89", ",", "6", "+", "91", ",", "15", "@", "@", "public", "void", "setBeanClassLoader", "(", "ClassLoader", "classLoader", ")", "{", "this", ".", "crudMethodMetadataPostProcessor", ".", "setBeanClassLoader", "(", "classLoader", ")", ";", "}", "/", "**", "*", "Configures", "the", "escape", "character", "to", "be", "used", "for", "like", "-", "expressions", "created", "for", "derived", "queries", ".", "*", "*", "@", "param", "escapeCharacter", "a", "character", "used", "for", "escaping", "in", "certain", "like", "expressions", ".", "*", "/", "public", "void", "setEscapeCharacter", "(", "EscapeCharacter", "escapeCharacter", ")", "{", "this", ".", "escapeCharacter", "=", "escapeCharacter", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "RepositoryFactorySupport", "#", "getTargetRepository", "(", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "RepositoryMetadata", ")", "@", "@", "-", "104", ",", "7", "+", "115", ",", "7", "@", "@", "protected", "Object", "getTargetRepository", "(", "RepositoryInformation", "information", ")", "{", "/", "**", "*", "Callback", "to", "create", "a", "{", "@", "link", "JpaRepository", "}", "instance", "with", "the", "given", "{", "@", "link", "EntityManager", "}", "*", "*", "*", "@", "param", "<", "T", ">", "*", "@", "param", "<", "ID", ">", "*", "@", "param", "entityManager", "@", "@", "-", "121", ",", "7", "+", "132", ",", "7", "@", "@", "protected", "Object", "getTargetRepository", "(", "RepositoryInformation", "information", ")", "{", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "*", "*", "@", "see", "*", "org", ".", "springframework", ".", "data", ".", "repository", ".", "support", ".", "RepositoryFactorySupport", "#", "*", "getRepositoryBaseClass", "(", ")", "@", "@", "-", "152", ",", "7", "+", "163", ",", "7", "@", "@", "protected", "ProjectionFactory", "getProjectionFactory", "(", "ClassLoader", "classLoader", ",", "BeanFa", "/", "**", "*", "Returns", "whether", "the", "given", "repository", "interface", "requires", "a", "QueryDsl", "specific", "implementation", "to", "be", "chosen", ".", "*", "*", "*", "@", "param", "repositoryInterface", "*", "@", "return", "*", "/", "@", "@", "-", "161", ",", "18", "+", "172", ",", "18", "@", "@", "private", "boolean", "isQueryDslExecutor", "(", "Class", "<", "?>", "repositoryInterface", ")", "{", "return", "QUERY_DSL_PRESENT", "&", "&", "QueryDslPredicateExecutor", ".", "class", ".", "isAssignableFrom", "(", "repositoryInterface", ")", ";", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "RepositoryFactorySupport", "#", "getQueryLookupStrategy", "(", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "QueryLookupStrategy", ".", "Key", ",", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "EvaluationContextProvider", ")", "*", "/", "@", "Override", "protected", "QueryLookupStrategy", "getQueryLookupStrategy", "(", "Key", "key", ",", "EvaluationContextProvider", "evaluationContextProvider", ")", "{", "return", "JpaQueryLookupStrategy", ".", "create", "(", "entityManager", ",", "key", ",", "extractor", ",", "evaluationContextProvider", ")", ";", "return", "JpaQueryLookupStrategy", ".", "create", "(", "entityManager", ",", "key", ",", "extractor", ",", "evaluationContextProvider", ",", "escapeCharacter", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "*", "*", "@", "see", "*", "org", ".", "springframework", ".", "data", ".", "repository", ".", "support", ".", "RepositoryFactorySupport", "#", "*", "getEntityInformation", "(", "java", ".", "lang", ".", "Class", ")", "@", "@", "-", "205", ",", "7", "+", "216", ",", "7", "@", "@", "protected", "QueryLookupStrategy", "getQueryLookupStrategy", "(", "Key", "key", ",", "EvaluationContextP", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "EclipseLinkProjectionQueryCreationListener", "}", "for", "the", "given", "{", "@", "link", "EntityManager", "}", ".", "*", "*", "*", "@", "param", "em", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "public", "EclipseLinkProjectionQueryCreationListener", "(", "EntityManager", "em", ")", "{", "@", "@", "-", "215", ",", "7", "+", "226", ",", "7", "@", "@", "public", "EclipseLinkProjectionQueryCreationListener", "(", "EntityManager", "em", ")", "{", "this", ".", "metamodel", "=", "new", "JpaMetamodel", "(", "em", ".", "getMetamodel", "(", "))", ";", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "QueryCreationListener", "#", "onCreation", "(", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "RepositoryQuery", ")", "*", "/", "@", "@", "-", "29", ",", "7", "+", "29", ",", "7", "@", "@", "/", "**", "*", "Special", "adapter", "for", "Springs", "{", "@", "link", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "FactoryBean", "}", "interface", "to", "allow", "easy", "setup", "of", "*", "repository", "factories", "via", "Spring", "configuration", ".", "*", "*", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Eberhard", "Wolff", "*", "@", "param", "<", "T", ">", "the", "type", "of", "the", "repository", "@", "@", "-", "38", ",", "27", "+", "38", ",", "37", "@", "@", "extends", "TransactionalRepositoryFactoryBeanSupport", "<", "T", ",", "S", ",", "ID", ">", "{", "private", "EntityManager", "entityManager", ";", "private", "EscapeCharacter", "escapeCharacter", "=", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", ");", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaRepositoryFactoryBean", "}", "for", "the", "given", "repository", "interface", ".", "*", "*", "*", "@", "param", "repositoryInterface", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "public", "JpaRepositoryFactoryBean", "(", "Class", "<", "?", "extends", "T", ">", "repositoryInterface", ")", "{", "super", "(", "repositoryInterface", ")", ";", "}", "/", "**", "*", "Configures", "the", "escape", "character", "to", "be", "used", "to", "escape", "reserved", "characters", "for", "LIKE", "expressions", ".", "*", "*", "@", "param", "escapeCharacter", "*", "/", "public", "void", "setEscapeCharacter", "(", "char", "escapeCharacter", ")", "{", "this", ".", "escapeCharacter", "=", "EscapeCharacter", ".", "of", "(", "escapeCharacter", ")", ";", "}", "/", "**", "*", "The", "{", "@", "link", "EntityManager", "}", "to", "be", "used", ".", "*", "*", "*", "@", "param", "entityManager", "the", "entityManager", "to", "set", "*", "/", "@", "PersistenceContext", "public", "void", "setEntityManager", "(", "EntityManager", "entityManager", ")", "{", "this", ".", "entityManager", "=", "entityManager", ";", "}", "/", "*", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "RepositoryFactoryBeanSupport", "#", "setMappingContext", "(", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "context", ".", "MappingContext", ")", "*", "/", "@", "@", "-", "69", ",", "7", "+", "79", ",", "7", "@", "@", "public", "void", "setMappingContext", "(", "MappingContext", "<", "?,", "?", ">", "mappingContext", ")", "{", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "*", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "repository", ".", "support", ".", "*", "TransactionalRepositoryFactoryBeanSupport", "#", "doCreateRepositoryFactory", "(", ")", "*", "/", "@", "@", "-", "80", ",", "17", "+", "90", ",", "21", "@", "@", "protected", "RepositoryFactorySupport", "doCreateRepositoryFactory", "(", ")", "{", "/", "**", "*", "Returns", "a", "{", "@", "link", "RepositoryFactorySupport", "}", ".", "*", "*", "*", "@", "param", "entityManager", "*", "@", "return", "*", "/", "protected", "RepositoryFactorySupport", "createRepositoryFactory", "(", "EntityManager", "entityManager", ")", "{", "return", "new", "JpaRepositoryFactory", "(", "entityManager", ")", ";", "JpaRepositoryFactory", "jpaRepositoryFactory", "=", "new", "JpaRepositoryFactory", "(", "entityManager", ")", ";", "jpaRepositoryFactory", ".", "setEscapeCharacter", "(", "escapeCharacter", ")", ";", "return", "jpaRepositoryFactory", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "*", "*", "@", "see", "*", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "InitializingBean", "#", "afterPropertiesSet", "(", ")", "*", "/", "@", "@", "-", "44", ",", "7", "+", "44", ",", "7", "@", "@", "/", "**", "*", "Integration", "test", "for", "executing", "finders", ",", "thus", "testing", "various", "query", "lookup", "strategies", ".", "*", "*", "*", "@", "see", "QueryLookupStrategy", "*", "@", "author", "Oliver", "Gierke", "*", "/", "@", "@", "-", "198", ",", "6", "+", "198", ",", "16", "@", "@", "public", "void", "executesMethodWithNotContainingOnStringCorrectly", "(", ")", "{", "assertThat", "(", "userRepository", ".", "findByLastnameNotContaining", "(", "\"", "u", "\"", "),", "containsInAnyOrder", "(", "dave", ",", "oliver", ")", ");", "}", "@", "Test", "/", "/", "DATAJPA", "-", "1519", "public", "void", "parametersForContainsGetProperlyEscaped", "(", ")", "{", "assertThat", "(", "userRepository", ".", "findByFirstnameContaining", "(", "\"", "liv", "%", "\")", ",", "hasSize", "(", "0", ")", ");", "}", "@", "Test", "/", "/", "DATAJPA", "-", "1519", "public", "void", "escapingInLikeSpels", "(", ")", "{", "assertThat", "(", "userRepository", ".", "findContainingEscaped", "(", "\"", "att_", "\"", "),", "hasSize", "(", "0", ")", ");", "}", "@", "Test", "/", "/", "DATAJPA", "-", "829", "public", "void", "translatesContainsToMemberOf", "(", ")", "{", "@", "@", "-", "31", ",", "6", "+", "31", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "User", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "HibernateUtils", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "projection", ".", "SpelAwareProxyProjectionFactory", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "Repository", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "AbstractRepositoryMetadata", ";", "@", "@", "-", "60", ",", "7", "+", "61", ",", "7", "@", "@", "public", "void", "distinctFlagOnCountQueryIssuesCountDistinct", "(", ")", "throws", "Exception", "{", "PartTree", "tree", "=", "new", "PartTree", "(", "\"", "findDistinctByRolesIn", "\"", ",", "User", ".", "class", ")", ";", "ParameterMetadataProvider", "metadataProvider", "=", "new", "ParameterMetadataProvider", "(", "entityManager", ".", "getCriteriaBuilder", "(", "),", "queryMethod", ".", "getParameters", "(", "),", "provider", ")", ";", "queryMethod", ".", "getParameters", "(", "),", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "JpaCountQueryCreator", "creator", "=", "new", "JpaCountQueryCreator", "(", "tree", ",", "queryMethod", ".", "getResultProcessor", "(", ").", "getReturnedType", "(", "),", "entityManager", ".", "getCriteriaBuilder", "(", "),", "metadataProvider", ")", ";", "@", "@", "-", "38", ",", "6", "+", "38", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "User", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "QueryExtractor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "Query", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "projection", ".", "ProjectionFactory", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "Repository", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "NamedQueries", ";", "@", "@", "-", "80", ",", "7", "+", "81", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "{", "public", "void", "invalidAnnotatedQueryCausesException", "(", ")", "throws", "Exception", "{", "QueryLookupStrategy", "strategy", "=", "JpaQueryLookupStrategy", ".", "create", "(", "em", ",", "Key", ".", "CREATE_IF_NOT_FOUND", ",", "extractor", ",", "EVALUATION_CONTEXT_PROVIDER", ")", ";", "EVALUATION_CONTEXT_PROVIDER", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "Method", "method", "=", "UserRepository", ".", "class", ".", "getMethod", "(", "\"", "findByFoo", "\"", ",", "String", ".", "class", ")", ";", "RepositoryMetadata", "metadata", "=", "new", "DefaultRepositoryMetadata", "(", "UserRepository", ".", "class", ")", ";", "@", "@", "-", "99", ",", "7", "+", "100", ",", "7", "@", "@", "public", "void", "invalidAnnotatedQueryCausesException", "(", ")", "throws", "Exception", "{", "public", "void", "sholdThrowMorePreciseExceptionIfTryingToUsePaginationInNativeQueries", "(", ")", "throws", "Exception", "{", "QueryLookupStrategy", "strategy", "=", "JpaQueryLookupStrategy", ".", "create", "(", "em", ",", "Key", ".", "CREATE_IF_NOT_FOUND", ",", "extractor", ",", "EVALUATION_CONTEXT_PROVIDER", ")", ";", "EVALUATION_CONTEXT_PROVIDER", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "Method", "method", "=", "UserRepository", ".", "class", ".", "getMethod", "(", "\"", "findByInvalidNativeQuery", "\"", ",", "String", ".", "class", ",", "Pageable", ".", "class", ")", ";", "RepositoryMetadata", "metadata", "=", "new", "DefaultRepositoryMetadata", "(", "UserRepository", ".", "class", ")", ";", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "User", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "DefaultParameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "ParametersParameterAccessor", ";", "@", "@", "-", "58", ",", "7", "+", "59", ",", "7", "@", "@", "public", "void", "createsParameterExpressionWithMostConcreteType", "(", ")", "throws", "Exception", "{", "CriteriaBuilder", "builder", "=", "em", ".", "getCriteriaBuilder", "(", ");", "PersistenceProvider", "persistenceProvider", "=", "PersistenceProvider", ".", "fromEntityManager", "(", "em", ")", ";", "ParameterMetadataProvider", "provider", "=", "new", "ParameterMetadataProvider", "(", "builder", ",", "accessor", ",", "persistenceProvider", ")", ";", "ParameterMetadataProvider", "provider", "=", "new", "ParameterMetadataProvider", "(", "builder", ",", "accessor", ",", "persistenceProvider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "ParameterExpression", "<", "?", "extends", "Comparable", ">", "expression", "=", "provider", ".", "next", "(", "part", ",", "Comparable", ".", "class", ")", ".", "getExpression", "(", ");", "assertThat", "(", "expression", ".", "getParameterType", "(", "),", "is", "(", "typeCompatibleWith", "(", "int", ".", "class", ")", "))", ";", "}", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "User", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "ParameterMetadataProvider", ".", "ParameterMetadata", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Param", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "parser", ".", "Part", ";", "@", "@", "-", "81", ",", "7", "+", "82", ",", "7", "@", "@", "private", "ParameterMetadataProvider", "createProvider", "(", "Method", "method", ")", "{", "simulateDiscoveredParametername", "(", "parameters", ",", "0", ",", "\"", "name", "\"", ");", "return", "new", "ParameterMetadataProvider", "(", "em", ".", "getCriteriaBuilder", "(", "),", "parameters", ",", "PersistenceProvider", ".", "fromEntityManager", "(", "em", ")", ");", "PersistenceProvider", ".", "fromEntityManager", "(", "em", ")", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "ExpectedException", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "Parameters", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "parser", ".", "Part", ";", "@", "@", "-", "44", ",", "7", "+", "45", ",", "7", "@", "@", "public", "void", "errorMessageMentionesParametersWhenParametersAreExhausted", "(", ")", "{", "Parameters", "<", "?,", "?", ">", "parameters", "=", "mock", "(", "Parameters", ".", "class", ",", "RETURNS_DEEP_STUBS", ")", ";", "ParameterMetadataProvider", "metadataProvider", "=", "new", "ParameterMetadataProvider", "(", "builder", ",", "parameters", ",", "persistenceProvider", ")", ";", "persistenceProvider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "exception", ".", "expect", "(", "IllegalArgumentException", ".", "class", ")", ";", "exception", ".", "expectMessage", "(", "\"", "parameter", "\"", ");", "@", "@", "-", "45", ",", "6", "+", "45", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "HibernateUtils", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "Temporal", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "projection", ".", "SpelAwareProxyProjectionFactory", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "Repository", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "DefaultRepositoryMetadata", ";", "@", "@", "-", "79", ",", "7", "+", "80", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "{", "public", "void", "test", "(", ")", "throws", "Exception", "{", "JpaQueryMethod", "queryMethod", "=", "getQueryMethod", "(", "\"", "findByFirstname", "\"", ",", "String", ".", "class", ",", "Pageable", ".", "class", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "jpaQuery", ".", "createQuery", "(", "new", "Object", "[", "]", "{", "\"", "Matthews", "\"", ",", "new", "PageRequest", "(", "0", ",", "1", ")", "}", ");", "jpaQuery", ".", "createQuery", "(", "new", "Object", "[", "]", "{", "\"", "Matthews", "\"", ",", "new", "PageRequest", "(", "0", ",", "1", ")", "}", ");", "@", "@", "-", "103", ",", "7", "+", "104", ",", "7", "@", "@", "public", "void", "cannotIgnoreCaseIfNotStringUnlessIgnoringAll", "(", ")", "throws", "Exception", "{", "public", "void", "recreatesQueryIfNullValueIsGiven", "(", ")", "throws", "Exception", "{", "JpaQueryMethod", "queryMethod", "=", "getQueryMethod", "(", "\"", "findByFirstname", "\"", ",", "String", ".", "class", ",", "Pageable", ".", "class", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "Query", "query", "=", "jpaQuery", ".", "createQuery", "(", "new", "Object", "[", "]", "{", "\"", "Matthews", "\"", ",", "new", "PageRequest", "(", "0", ",", "1", ")", "}", ");", "@", "@", "-", "118", ",", "7", "+", "119", ",", "7", "@", "@", "public", "void", "recreatesQueryIfNullValueIsGiven", "(", ")", "throws", "Exception", "{", "public", "void", "shouldLimitExistsProjectionQueries", "(", ")", "throws", "Exception", "{", "JpaQueryMethod", "queryMethod", "=", "getQueryMethod", "(", "\"", "existsByFirstname", "\"", ",", "String", ".", "class", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "Query", "query", "=", "jpaQuery", ".", "createQuery", "(", "new", "Object", "[", "]", "{", "\"", "Matthews", "\"", "}", ");", "@", "@", "-", "129", ",", "7", "+", "130", ",", "7", "@", "@", "public", "void", "shouldLimitExistsProjectionQueries", "(", ")", "throws", "Exception", "{", "public", "void", "shouldSelectAliasedIdForExistsProjectionQueries", "(", ")", "throws", "Exception", "{", "JpaQueryMethod", "queryMethod", "=", "getQueryMethod", "(", "\"", "existsByFirstname", "\"", ",", "String", ".", "class", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "Query", "query", "=", "jpaQuery", ".", "createQuery", "(", "new", "Object", "[", "]", "{", "\"", "Matthews", "\"", "}", ");", "@", "@", "-", "146", ",", "7", "+", "147", ",", "7", "@", "@", "public", "void", "errorsDueToMismatchOfParametersContainNameOfMethodAndInterface", "(", ")", "thr", "thrown", ".", "expectMessage", "(", "\"", "findByFirstname", "\"", ");", "/", "/", "the", "method", "being", "analyzed", "thrown", ".", "expectMessage", "(", "\"", "firstname", "\"", ");", "/", "/", "the", "property", "we", "are", "looking", "for", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ")", ";", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "}", "@", "Test", "/", "/", "DATAJPA", "-", "863", "@", "@", "-", "159", ",", "7", "+", "160", ",", "7", "@", "@", "public", "void", "errorsDueToMissingPropertyContainNameOfMethodAndInterface", "(", ")", "throws", "E", "thrown", ".", "expectMessage", "(", "\"", "findByNoSuchProperty", "\"", ");", "/", "/", "the", "method", "being", "analyzed", "thrown", ".", "expectMessage", "(", "\"", "noSuchProperty", "\"", ");", "/", "/", "the", "property", "we", "are", "looking", "for", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ")", ";", "new", "PartTreeJpaQuery", "(", "method", ",", "entityManager", ",", "provider", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "}", "private", "void", "testIgnoreCase", "(", "String", "methodName", ",", "Object", ".", "..", "values", ")", "throws", "Exception", "{", "@", "@", "-", "172", ",", "7", "+", "173", ",", "7", "@", "@", "private", "void", "testIgnoreCase", "(", "String", "methodName", ",", "Object", ".", "..", "values", ")", "throws", "Exceptio", "JpaQueryMethod", "queryMethod", "=", "getQueryMethod", "(", "methodName", ",", "parameterTypes", ")", ";", "PartTreeJpaQuery", "jpaQuery", "=", "new", "PartTreeJpaQuery", "(", "queryMethod", ",", "entityManager", ",", "PersistenceProvider", ".", "fromEntityManager", "(", "entityManager", ")", ");", "PersistenceProvider", ".", "fromEntityManager", "(", "entityManager", ")", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "jpaQuery", ".", "createQuery", "(", "values", ")", ";", "}", "@", "@", "-", "497", ",", "6", "+", "497", ",", "10", "@", "@", "/", "/", "DATAJPA", "-", "1334", "List", "<", "NameOnlyDto", ">", "findByNamedQueryWithConstructorExpression", "(", ");", "/", "/", "DATAJPA", "-", "1519", "@", "Query", "(", "\"", "select", "u", "from", "User", "u", "where", "u", ".", "firstname", "like", "%", "?#", "{#", "escape", "(", "[", "0", "]", ",'", "#'", ")}", "%", "escape", "'", "#'", "\")", "List", "<", "User", ">", "findContainingEscaped", "(", "String", "namePart", ")", ";", "interface", "RolesAndFirstname", "{", "String", "getFirstname", "(", ");"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "130", ",", "8", "+", "130", ",", "9", "@", "@", "char", "*", "X509_NAME_oneline", "(", "X509_NAME", "*", "a", ",", "char", "*", "buf", ",", "int", "len", ")", "type", "=", "=", "V_ASN1_PRINTABLESTRING", "|", "|", "type", "=", "=", "V_ASN1_TELETEXSTRING", "|", "|", "type", "=", "=", "V_ASN1_VISIBLESTRING", "|", "|", "type", "=", "=", "V_ASN1_IA5STRING", ")", "{", "ascii2ebcdic", "(", "ebcdic_buf", ",", "q", ",", "(", "num", ">", "sizeof", "ebcdic_buf", ")", "?", "sizeof", "ebcdic_buf", ":", "num", ")", ";", "if", "(", "num", ">", "(", "int", ")", "sizeof", "(", "ebcdic_buf", ")", ")", "num", "=", "sizeof", "(", "ebcdic_buf", ")", ";", "ascii2ebcdic", "(", "ebcdic_buf", ",", "q", ",", "num", ")", ";", "q", "=", "ebcdic_buf", ";", "}", "#", "endif"], "docstring_tokens": ["a", "buffer", "underflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1692", ",", "17", "+", "1692", ",", "15", "@", "@", "static", "void", "apic_sync_pv_eoi_from_guest", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "void", "kvm_lapic_sync_from_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "u32", "data", ";", "void", "*", "vapic", ";", "if", "(", "test_bit", "(", "KVM_APIC_PV_EOI_PENDING", ",", "&", "vcpu", "-", ">", "arch", ".", "apic_attention", ")", ")", "apic_sync_pv_eoi_from_guest", "(", "vcpu", ",", "vcpu", "-", ">", "arch", ".", "apic", ")", ";", "if", "(", "!", "test_bit", "(", "KVM_APIC_CHECK_VAPIC", ",", "&", "vcpu", "-", ">", "arch", ".", "apic_attention", ")", ")", "return", ";", "vapic", "=", "kmap_atomic", "(", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_page", ")", ";", "data", "=", "*", "(", "u32", "*", ")(", "vapic", "+", "offset_in_page", "(", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_addr", ")", ");", "kunmap_atomic", "(", "vapic", ")", ";", "kvm_read_guest_cached", "(", "vcpu", "-", ">", "kvm", ",", "&", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_cache", ",", "&", "data", ",", "sizeof", "(", "u32", ")", ");", "apic_set_tpr", "(", "vcpu", "-", ">", "arch", ".", "apic", ",", "data", "&", "0xff", ")", ";", "}", "@", "@", "-", "1738", ",", "7", "+", "1736", ",", "6", "@", "@", "void", "kvm_lapic_sync_to_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "u32", "data", ",", "tpr", ";", "int", "max_irr", ",", "max_isr", ";", "struct", "kvm_lapic", "*", "apic", "=", "vcpu", "-", ">", "arch", ".", "apic", ";", "void", "*", "vapic", ";", "apic_sync_pv_eoi_to_guest", "(", "vcpu", ",", "apic", ")", ";", "@", "@", "-", "1754", ",", "18", "+", "1751", ",", "24", "@", "@", "void", "kvm_lapic_sync_to_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "max_isr", "=", "0", ";", "data", "=", "(", "tpr", "&", "0xff", ")", "|", "(", "(", "max_isr", "&", "0xf0", ")", "<", "<", "8", ")", "|", "(", "max_irr", "<", "<", "24", ")", ";", "vapic", "=", "kmap_atomic", "(", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_page", ")", ";", "*", "(", "u32", "*", ")(", "vapic", "+", "offset_in_page", "(", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_addr", ")", ")", "=", "data", ";", "kunmap_atomic", "(", "vapic", ")", ";", "kvm_write_guest_cached", "(", "vcpu", "-", ">", "kvm", ",", "&", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_cache", ",", "&", "data", ",", "sizeof", "(", "u32", ")", ");", "}", "void", "kvm_lapic_set_vapic_addr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "vapic_addr", ")", "int", "kvm_lapic_set_vapic_addr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "vapic_addr", ")", "{", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_addr", "=", "vapic_addr", ";", "if", "(", "vapic_addr", ")", "if", "(", "vapic_addr", ")", "{", "if", "(", "kvm_gfn_to_hva_cache_init", "(", "vcpu", "-", ">", "kvm", ",", "&", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_cache", ",", "vapic_addr", ",", "sizeof", "(", "u32", ")", "))", "return", "-", "EINVAL", ";", "__set_bit", "(", "KVM_APIC_CHECK_VAPIC", ",", "&", "vcpu", "-", ">", "arch", ".", "apic_attention", ")", ";", "else", "}", "else", "{", "__clear_bit", "(", "KVM_APIC_CHECK_VAPIC", ",", "&", "vcpu", "-", ">", "arch", ".", "apic_attention", ")", ";", "}", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_addr", "=", "vapic_addr", ";", "return", "0", ";", "}", "int", "kvm_x2apic_msr_write", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "u32", "msr", ",", "u64", "data", ")", "@", "@", "-", "34", ",", "7", "+", "34", ",", "7", "@", "@", "struct", "kvm_lapic", "{", "*", "/", "void", "*", "regs", ";", "gpa_t", "vapic_addr", ";", "struct", "page", "*", "vapic_page", ";", "struct", "gfn_to_hva_cache", "vapic_cache", ";", "unsigned", "long", "pending_events", ";", "unsigned", "int", "sipi_vector", ";", "}", ";", "@", "@", "-", "76", ",", "7", "+", "76", ",", "7", "@", "@", "void", "kvm_set_lapic_tscdeadline_msr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "u64", "data", ")", ";", "void", "kvm_apic_write_nodecode", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "u32", "offset", ")", ";", "void", "kvm_apic_set_eoi_accelerated", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "int", "vector", ")", ";", "void", "kvm_lapic_set_vapic_addr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "vapic_addr", ")", ";", "int", "kvm_lapic_set_vapic_addr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "vapic_addr", ")", ";", "void", "kvm_lapic_sync_from_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", ";", "void", "kvm_lapic_sync_to_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", ";", "@", "@", "-", "3214", ",", "8", "+", "3214", ",", "7", "@", "@", "long", "kvm_arch_vcpu_ioctl", "(", "struct", "file", "*", "filp", ",", "r", "=", "-", "EFAULT", ";", "if", "(", "copy_from_user", "(", "&", "va", ",", "argp", ",", "sizeof", "va", ")", ")", "goto", "out", ";", "r", "=", "0", ";", "kvm_lapic_set_vapic_addr", "(", "vcpu", ",", "va", ".", "vapic_addr", ")", ";", "r", "=", "kvm_lapic_set_vapic_addr", "(", "vcpu", ",", "va", ".", "vapic_addr", ")", ";", "break", ";", "}", "case", "KVM_X86_SETUP_MCE", ":", "{", "@", "@", "-", "5739", ",", "36", "+", "5738", ",", "6", "@", "@", "static", "void", "post_kvm_run_save", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "!", "kvm_event_needs_reinjection", "(", "vcpu", ")", ";", "}", "static", "int", "vapic_enter", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "struct", "kvm_lapic", "*", "apic", "=", "vcpu", "-", ">", "arch", ".", "apic", ";", "struct", "page", "*", "page", ";", "if", "(", "!", "apic", "|", "|", "!", "apic", "-", ">", "vapic_addr", ")", "return", "0", ";", "page", "=", "gfn_to_page", "(", "vcpu", "-", ">", "kvm", ",", "apic", "-", ">", "vapic_addr", ">", ">", "PAGE_SHIFT", ")", ";", "if", "(", "is_error_page", "(", "page", ")", ")", "return", "-", "EFAULT", ";", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_page", "=", "page", ";", "return", "0", ";", "}", "static", "void", "vapic_exit", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "struct", "kvm_lapic", "*", "apic", "=", "vcpu", "-", ">", "arch", ".", "apic", ";", "int", "idx", ";", "if", "(", "!", "apic", "|", "|", "!", "apic", "-", ">", "vapic_addr", ")", "return", ";", "idx", "=", "srcu_read_lock", "(", "&", "vcpu", "-", ">", "kvm", "-", ">", "srcu", ")", ";", "kvm_release_page_dirty", "(", "apic", "-", ">", "vapic_page", ")", ";", "mark_page_dirty", "(", "vcpu", "-", ">", "kvm", ",", "apic", "-", ">", "vapic_addr", ">", ">", "PAGE_SHIFT", ")", ";", "srcu_read_unlock", "(", "&", "vcpu", "-", ">", "kvm", "-", ">", "srcu", ",", "idx", ")", ";", "}", "static", "void", "update_cr8_intercept", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "int", "max_irr", ",", "tpr", ";", "@", "@", "-", "6069", ",", "11", "+", "6038", ",", "6", "@", "@", "static", "int", "__vcpu_run", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "struct", "kvm", "*", "kvm", "=", "vcpu", "-", ">", "kvm", ";", "vcpu", "-", ">", "srcu_idx", "=", "srcu_read_lock", "(", "&", "kvm", "-", ">", "srcu", ")", ";", "r", "=", "vapic_enter", "(", "vcpu", ")", ";", "if", "(", "r", ")", "{", "srcu_read_unlock", "(", "&", "kvm", "-", ">", "srcu", ",", "vcpu", "-", ">", "srcu_idx", ")", ";", "return", "r", ";", "}", "r", "=", "1", ";", "while", "(", "r", ">", "0", ")", "{", "@", "@", "-", "6132", ",", "8", "+", "6096", ",", "6", "@", "@", "static", "int", "__vcpu_run", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "srcu_read_unlock", "(", "&", "kvm", "-", ">", "srcu", ",", "vcpu", "-", ">", "srcu_idx", ")", ";", "vapic_exit", "(", "vcpu", ")", ";", "return", "r", ";", "}"], "docstring_tokens": ["out-of-bounds", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "977", ",", "8", "+", "977", ",", "7", "@", "@", "static", "ssize_t", "tty_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buf", ",", "size_t", "count", ",", "else", "i", "=", "-", "EIO", ";", "tty_ldisc_deref", "(", "ld", ")", ";", "if", "(", "i", ">", "0", ")", "inode", "-", ">", "i_atime", "=", "current_fs_time", "(", "inode", "-", ">", "i_sb", ")", ";", "return", "i", ";", "}", "@", "@", "-", "1079", ",", "11", "+", "1078", ",", "8", "@", "@", "static", "inline", "ssize_t", "do_tty_write", "(", "break", ";", "cond_resched", "(", ");", "}", "if", "(", "written", ")", "{", "struct", "inode", "*", "inode", "=", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ";", "inode", "-", ">", "i_mtime", "=", "current_fs_time", "(", "inode", "-", ">", "i_sb", ")", ";", "if", "(", "written", ")", "ret", "=", "written", ";", "}", "out", ":", "tty_write_unlock", "(", "tty", ")", ";", "return", "ret", ";"], "docstring_tokens": ["key", "stroke", "timing", "local", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "466", ",", "6", "+", "466", ",", "8", "@", "@", "static", "int", "ivtvfb_ioctl", "(", "struct", "fb_info", "*", "info", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "ar", "struct", "fb_vblank", "vblank", ";", "u32", "trace", ";", "memset", "(", "&", "vblank", ",", "0", ",", "sizeof", "(", "struct", "fb_vblank", ")", ");", "vblank", ".", "flags", "=", "FB_VBLANK_HAVE_COUNT", "|", "FB_VBLANK_HAVE_VCOUNT", "|", "FB_VBLANK_HAVE_VSYNC", ";", "trace", "=", "read_reg", "(", "IVTV_REG_DEC_LINE_FIELD", ")", ">", ">", "16", ";"], "docstring_tokens": ["stack", "leak"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "37", ",", "6", "+", "37", ",", "9", "@", "@", "public", "void", "setup", "(", "SourceResolver", "resolver", ",", "Map", "objectModel", ",", "String", "src", ",", "Paramete", "/", "/", "If", "the", "requested", "path", "includes", "any", "of", "the", "following", "strings", "/", "characters", "/", "/", "then", "block", "access", "and", "return", "\"", "Resource", "Not", "Found", "\"", "if", "(", "src", "!", "=", "null", "&", "&", "(", "src", ".", "toLowerCase", "(", ").", "contains", "(", "\":", "\")", "|", "|", "/", "/", "%", "3a", "=", "encoded", "colon", "(", ":)", "src", ".", "toLowerCase", "(", ").", "contains", "(", "\"%", "3a", "\"", ")", "|", "|", "/", "/", "%", "252e", "=", "double", "encoded", "dot", "(", ".)", "src", ".", "toLowerCase", "(", ").", "contains", "(", "\"%", "252e", "\"", ")", "|", "|", "/", "/", "%", "2e", "=", "encoded", "dot", "(", ".)", "@", "@", "-", "0", ",", "0", "+", "1", ",", "74", "@", "@", "/", "**", "*", "The", "contents", "of", "this", "file", "are", "subject", "to", "the", "license", "and", "copyright", "*", "detailed", "in", "the", "LICENSE", "and", "NOTICE", "files", "at", "the", "root", "of", "the", "source", "*", "tree", "and", "available", "online", "at", "*", "*", "http", ":", "//", "www", ".", "dspace", ".", "org", "/", "license", "/", "*", "/", "package", "org", ".", "dspace", ".", "app", ".", "xmlui", ".", "cocoon", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "apache", ".", "avalon", ".", "framework", ".", "configuration", ".", "Configurable", ";", "import", "org", ".", "apache", ".", "avalon", ".", "framework", ".", "parameters", ".", "Parameters", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "ProcessingException", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "ResourceNotFoundException", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "caching", ".", "CacheableProcessingComponent", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "environment", ".", "SourceResolver", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "dspace", ".", "core", ".", "ConfigurationManager", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "/", "**", "*", "An", "XMLUI", "Theme", "Resource", "Reader", ",", "which", "ONLY", "allows", "for", "certain", "types", "of", "files", "*", "to", "be", "included", "in", "a", "themes", ".", "*", "*", "@", "author", "Tim", "Donohue", "*", "@", "author", "Andrea", "Schweer", "*", "/", "public", "class", "ThemeResourceReader", "extends", "SafeResourceReader", "implements", "CacheableProcessingComponent", ",", "Configurable", "{", "/", "/", "Default", "whitelist", "of", "file", "extensions", "that", "are", "allowed", "in", "an", "XMLUI", "theme", "protected", "String", "[", "]", "DEFAULT_WHITELIST", "=", "new", "String", "[", "]{", "\"", "css", "\"", ",", "\"", "js", "\"", ",", "\"", "json", "\"", ",", "\"", "gif", "\"", ",", "\"", "jpg", "\"", ",", "\"", "jpeg", "\"", ",", "\"", "png", "\"", ",", "\"", "ico", "\"", ",", "\"", "bmp", "\"", ",", "\"", "htm", "\"", ",", "\"", "html", "\"", ",", "\"", "svg", "\"", ",", "\"", "ttf", "\"", ",", "\"", "woff", "\"", "};", "@", "Override", "public", "void", "setup", "(", "SourceResolver", "resolver", ",", "Map", "objectModel", ",", "String", "src", ",", "Parameters", "par", ")", "throws", "ProcessingException", ",", "SAXException", ",", "IOException", "{", "/", "/", "If", "our", "XMLUI", "sitemap", "has", "specified", "to", "bypass", "the", "whitelist", "for", "this", "resource", ",", "/", "/", "then", "just", "let", "this", "through", "to", "the", "SafeResourceReader", "if", "(", "par", ".", "getParameterAsBoolean", "(", "\"", "bypass", "-", "whitelist", "\"", ",", "false", ")", ")", "{", "super", ".", "setup", "(", "resolver", ",", "objectModel", ",", "src", ",", "par", ")", ";", "return", ";", "}", "/", "/", "Otherwise", ",", "we", "'", "ll", "load", "our", "configured", "file", "-", "extension", "whitelist", "String", "whitelistProp", "=", "ConfigurationManager", ".", "getProperty", "(", "\"", "xmlui", ".", "theme", ".", "whitelist", "\"", ");", "String", "[", "]", "whitelist", ";", "if", "(", "StringUtils", ".", "isEmpty", "(", "whitelistProp", ")", ")", "{", "whitelist", "=", "DEFAULT_WHITELIST", ";", "}", "else", "{", "whitelist", "=", "whitelistProp", ".", "split", "(", "\",", "\")", ";", "}", "/", "/", "Check", "resource", "suffix", "against", "our", "whitelist", "for", "(", "String", "suffix", ":", "whitelist", ")", "{", "/", "/", "If", "it", "is", "in", "our", "whitelist", ",", "let", "it", "through", "to", "the", "SafeResourceReader", "if", "(", "src", "!", "=", "null", "&", "&", "src", ".", "toLowerCase", "(", ").", "endsWith", "(", "\".", "\"", "+", "suffix", ".", "trim", "(", "))", ")", "{", "super", ".", "setup", "(", "resolver", ",", "objectModel", ",", "src", ",", "par", ")", ";", "return", ";", "}", "}", "/", "/", "Finally", ",", "if", "the", "resource", "has", "a", "suffix", "that", "is", "NOT", "in", "our", "whitelist", ",", "block", "it", "throw", "new", "ResourceNotFoundException", "(", "\"", "Resource", "not", "found", "(", "\"", "+", "src", "+", "\"", ")\"", ");", "}", "}", "@", "@", "-", "188", ",", "6", "+", "188", ",", "7", "@", "@", "logger", "=", "\"", "sitemap", ".", "reader", ".", "resource", "\"", "pool", "-", "max", "=", "\"", "32", "\"", ">", "<", "expires", ">", "3600000", "<", "/", "expires", ">", "<", "!-", "-", "1000", "*", "60", "*", "60", "=", "3600000", "=", "One", "hour", "-", "->", "<", "/", "map", ":", "reader", ">", "<", "map", ":", "reader", "name", "=", "\"", "ThemeResourceReader", "\"", "src", "=", "\"", "org", ".", "dspace", ".", "app", ".", "xmlui", ".", "cocoon", ".", "ThemeResourceReader", "\"", "/>", "<", "map", ":", "reader", "name", "=", "\"", "BitstreamReader", "\"", "src", "=", "\"", "org", ".", "dspace", ".", "app", ".", "xmlui", ".", "cocoon", ".", "BitstreamReader", "\"", "/>", "<", "map", ":", "reader", "name", "=", "\"", "ExportReader", "\"", "src", "=", "\"", "org", ".", "dspace", ".", "app", ".", "xmlui", ".", "cocoon", ".", "ItemExportDownloadReader", "\"", "/>", "<", "map", ":", "reader", "name", "=", "\"", "MetadataExportReader", "\"", "src", "=", "\"", "org", ".", "dspace", ".", "app", ".", "xmlui", ".", "cocoon", ".", "MetadataExportReader", "\"", "/>", "@", "@", "-", "620", ",", "10", "+", "621", ",", "18", "@", "@", "<", "/", "map", ":", "read", ">", "<", "/", "map", ":", "match", ">", "<", "!-", "-", "Redirect", "/", "block", "for", "DS", "-", "3094", "(", "security", "issue", ")", "for", "custom", "themes", "-", "->", "<", "!-", "-", "This", "ensures", "any", "custom", "themes", "are", "not", "affected", "by", "DS", "-", "3094", "by", "redirecting", "vulnerable", "URL", "paths", "to", "/", "error", "(", "which", "returns", "a", "404", "File", "Not", "Found", ")", ".", "Custom", "themes", "may", "still", "be", "affected", "by", "this", "issue", ",", "if", "they", "have", "not", "been", "updated", "to", "use", "ThemeResourceReader", "in", "all", "<", "map", ":", "read", ">", "settings", ".", "-", "->", "<", "map", ":", "match", "pattern", "=", "\"", "themes", "/", "**", ":*", "*\"", ">", "<", "map", ":", "redirect", "-", "to", "uri", "=", "\"{", "request", ":", "contextPath", "}", "/", "error", "\"", "permanent", "=", "\"", "yes", "\"", "/>", "<", "/", "map", ":", "match", ">", "<", "!-", "-", "handle", "common", "theme", "resources", ",", "such", "as", "dri2xhtml", "-", "->", "<", "map", ":", "match", "pattern", "=", "\"", "themes", "/", "*\"", ">", "<", "map", ":", "read", "src", "=", "\"", "themes", "/", "{", "1", "}", "\"/", ">", "<", "map", ":", "read", "type", "=", "\"", "ThemeResourceReader", "\"", "src", "=", "\"", "themes", "/", "{", "1", "}", "\"/", ">", "<", "/", "map", ":", "match", ">", "<", "!-", "-", "handle", "theme", "specific", "resources", "static", "or", "dynamic", "-", "->", "@", "@", "-", "25", ",", "7", "+", "25", ",", "7", "@", "@", "<", "!-", "-", "Static", "content", "-", "->", "<", "map", ":", "match", "pattern", "=", "\"", "themes", "/", "*/", "**", "\">", "<", "map", ":", "read", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "map", ":", "read", "type", "=", "\"", "ThemeResourceReader", "\"", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "/", "map", ":", "match", ">", "<", "/", "map", ":", "pipeline", ">", "@", "@", "-", "34", ",", "7", "+", "34", ",", "7", "@", "@", "<", "!-", "-", "Static", "content", "-", "->", "<", "map", ":", "match", "pattern", "=", "\"", "themes", "/", "*/", "**", "\">", "<", "map", ":", "read", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "map", ":", "read", "type", "=", "\"", "ThemeResourceReader", "\"", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "/", "map", ":", "match", ">", "<", "/", "map", ":", "pipeline", ">", "@", "@", "-", "58", ",", "7", "+", "58", ",", "7", "@", "@", "<", "!-", "-", "Static", "content", "-", "->", "<", "map", ":", "match", "pattern", "=", "\"", "themes", "/", "*/", "**", "\">", "<", "map", ":", "read", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "map", ":", "read", "type", "=", "\"", "ThemeResourceReader", "\"", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "/", "map", ":", "match", ">", "<", "/", "map", ":", "pipeline", ">", "@", "@", "-", "34", ",", "7", "+", "34", ",", "7", "@", "@", "<", "!-", "-", "Static", "content", "-", "->", "<", "map", ":", "match", "pattern", "=", "\"", "themes", "/", "*/", "**", "\">", "<", "map", ":", "read", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "map", ":", "read", "type", "=", "\"", "ThemeResourceReader", "\"", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "/", "map", ":", "match", ">", "<", "/", "map", ":", "pipeline", ">", "@", "@", "-", "53", ",", "7", "+", "53", ",", "7", "@", "@", "<", "!-", "-", "Static", "content", "-", "->", "<", "map", ":", "match", "pattern", "=", "\"", "themes", "/", "*/", "**", "\">", "<", "map", ":", "read", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "map", ":", "read", "type", "=", "\"", "ThemeResourceReader", "\"", "src", "=", "\"{", "2", "}", "\"/", ">", "<", "/", "map", ":", "match", ">", "<", "!-", "-", "Aspect", "content", "@", "@", "-", "1903", ",", "6", "+", "1903", ",", "11", "@", "@", "webui", ".", "suggest", ".", "enable", "=", "false", "#", "files", "before", "enabling", "this", "property", ".", "#", "xmlui", ".", "theme", ".", "enableMinification", "=", "false", "#", "Themes", "only", "allow", "specific", "file", "formats", "(", "extensions", ")", "to", "be", "accessible", ",", "for", "security", "reasons", ".", "#", "While", "the", "default", "list", "should", "work", "for", "most", "sites", ",", "you", "may", "wish", "to", "customize", "it", ".", "The", "default", "#", "list", "is", "commented", "out", "below", ".", "To", "customize", ",", "just", "uncomment", "and", "add", "more", "file", "extensions", ".", "#", "xmlui", ".", "theme", ".", "whitelist", "=", "css", ",", "js", ",", "json", ",", "gif", ",", "jpg", ",", "jpeg", ",", "png", ",", "bmp", ",", "ico", ",", "htm", ",", "html", ",", "svg", ",", "ttf", ",", "woff", "#", "##", "Settings", "for", "Item", "lists", "in", "Mirage", "theme", "#", "##", "#", "What", "should", "the", "emphasis", "be", "in", "the", "display", "of", "item", "lists", "?", "#", "Possible", "values", ":", "'", "file", "'", ",", "'", "metadata", "'", ".", "If", "your", "repository", "is"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "58", ",", "14", "+", "58", ",", "17", "@", "@", "public", "Object", "upload", "(", "@", "RequestParam", "(", "\"", "file", "\"", ")", "MultipartFile", "file", ")", "throws", "IOExceptio", "public", "ResponseEntity", "<", "Resource", ">", "fetch", "(", "@", "PathVariable", "String", "key", ")", "{", "LitemallStorage", "litemallStorage", "=", "litemallStorageService", ".", "findByKey", "(", "key", ")", ";", "if", "(", "key", "=", "=", "null", ")", "{", "ResponseEntity", ".", "notFound", "(", ");", "return", "ResponseEntity", ".", "notFound", "(", ").", "build", "(", ");", "}", "if", "(", "key", ".", "contains", "(", "\".", "./", "\")", "){", "return", "ResponseEntity", ".", "badRequest", "(", ").", "build", "(", ");", "}", "String", "type", "=", "litemallStorage", ".", "getType", "(", ");", "MediaType", "mediaType", "=", "MediaType", ".", "parseMediaType", "(", "type", ")", ";", "Resource", "file", "=", "storageService", ".", "loadAsResource", "(", "key", ")", ";", "if", "(", "file", "=", "=", "null", ")", "{", "ResponseEntity", ".", "notFound", "(", ");", "return", "ResponseEntity", ".", "notFound", "(", ").", "build", "(", ");", "}", "return", "ResponseEntity", ".", "ok", "(", ").", "contentType", "(", "mediaType", ")", ".", "body", "(", "file", ")", ";", "}", "@", "@", "-", "74", ",", "14", "+", "77", ",", "18", "@", "@", "public", "Object", "upload", "(", "@", "RequestParam", "(", "\"", "file", "\"", ")", "MultipartFile", "file", ")", "throws", "IOExceptio", "public", "ResponseEntity", "<", "Resource", ">", "download", "(", "@", "PathVariable", "String", "key", ")", "{", "LitemallStorage", "litemallStorage", "=", "litemallStorageService", ".", "findByKey", "(", "key", ")", ";", "if", "(", "key", "=", "=", "null", ")", "{", "ResponseEntity", ".", "notFound", "(", ");", "return", "ResponseEntity", ".", "notFound", "(", ").", "build", "(", ");", "}", "if", "(", "key", ".", "contains", "(", "\".", "./", "\")", "){", "return", "ResponseEntity", ".", "badRequest", "(", ").", "build", "(", ");", "}", "String", "type", "=", "litemallStorage", ".", "getType", "(", ");", "MediaType", "mediaType", "=", "MediaType", ".", "parseMediaType", "(", "type", ")", ";", "Resource", "file", "=", "storageService", ".", "loadAsResource", "(", "key", ")", ";", "if", "(", "file", "=", "=", "null", ")", "{", "ResponseEntity", ".", "notFound", "(", ");", "return", "ResponseEntity", ".", "notFound", "(", ").", "build", "(", ");", "}", "return", "ResponseEntity", ".", "ok", "(", ").", "contentType", "(", "mediaType", ")", ".", "header", "(", "HttpHeaders", ".", "CONTENT_DISPOSITION", ",", "\"", "attachment", ";", "filename", "=", "\\\"", "\"", "+", "file", ".", "getFilename", "(", ")", "+", "\"", "\\\"", "\")", ".", "body", "(", "file", ")", ";"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "3", "+", "0", ",", "0", "@", "@", "{", "\"", "directory", "\"", ":", "\"", "vendor", "/", "bower", "\"", "}", "@", "@", "-", "88", ",", "18", "+", "88", ",", "18", "@", "@", "module", ".", "exports", "=", "(", "grunt", ")", "-", ">", "objectToExport", ":", "'", "Simditor", "'", "globalAlias", ":", "'", "Simditor", "'", "deps", ":", "'", "default", "'", ":", "[", "'$", "',", "'", "SimpleModule", "'", ",", "'", "simpleHotkeys", "'", ",", "'", "simpleUploader", "'", "]", "amd", ":", "[", "'", "jquery", "'", ",", "'", "simple", "-", "module", "'", ",", "'", "simple", "-", "hotkeys", "'", ",", "'", "simple", "-", "uploader", "'", "]", "cjs", ":", "[", "'", "jquery", "'", ",", "'", "simple", "-", "module", "'", ",", "'", "simple", "-", "hotkeys", "'", ",", "'", "simple", "-", "uploader", "'", "]", "'", "default", "'", ":", "[", "'$", "',", "'", "SimpleModule", "'", ",", "'", "simpleHotkeys", "'", ",", "'", "simpleUploader", "'", ",", "'", "DOMPurify", "'", "]", "amd", ":", "[", "'", "jquery", "'", ",", "'", "simple", "-", "module", "'", ",", "'", "simple", "-", "hotkeys", "'", ",", "'", "simple", "-", "uploader", "'", ",", "'", "dompurify", "'", "]", "cjs", ":", "[", "'", "jquery", "'", ",", "'", "simple", "-", "module", "'", ",", "'", "simple", "-", "hotkeys", "'", ",", "'", "simple", "-", "uploader", "'", ",", "'", "dompurify", "'", "]", "global", ":", "items", ":", "[", "'", "jQuery", "'", ",", "'", "SimpleModule", "'", ",", "'", "simple", ".", "hotkeys", "'", ",", "'", "simple", ".", "uploader", "'", "]", "items", ":", "[", "'", "jQuery", "'", ",", "'", "SimpleModule", "'", ",", "'", "simple", ".", "hotkeys", "'", ",", "'", "simple", ".", "uploader", "'", ",", "'", "window", ".", "DOMPurify", "'", "]", "prefix", ":", "'", "'", "suffix", ":", "'", "'", "copy", ":", "vendor", ":", "files", ":", "[", "{", "src", ":", "'", "vendor", "/", "bower", "/", "jquery", "/", "dist", "/", "jquery", ".", "min", ".", "js", "'", ",", "src", ":", "'", "node_modules", "/", "jquery", "/", "dist", "/", "jquery", ".", "min", ".", "js", "'", ",", "dest", ":", "'", "site", "/", "assets", "/", "scripts", "/", "jquery", ".", "min", ".", "js", "'", "}", "]", "styles", ":", "@", "@", "-", "109", ",", "14", "+", "109", ",", "17", "@", "@", "module", ".", "exports", "=", "(", "grunt", ")", "-", ">", "}", "]", "scripts", ":", "files", ":", "[", "{", "src", ":", "'", "vendor", "/", "bower", "/", "simple", "-", "module", "/", "lib", "/", "module", ".", "js", "'", ",", "src", ":", "'", "node_modules", "/", "simple", "-", "module", "/", "lib", "/", "module", ".", "js", "'", ",", "dest", ":", "'", "site", "/", "assets", "/", "scripts", "/", "module", ".", "js", "'", "}", ",", "{", "src", ":", "'", "vendor", "/", "bower", "/", "simple", "-", "uploader", "/", "lib", "/", "uploader", ".", "js", "'", ",", "src", ":", "'", "node_modules", "/", "simple", "-", "uploader", "/", "lib", "/", "uploader", ".", "js", "'", ",", "dest", ":", "'", "site", "/", "assets", "/", "scripts", "/", "uploader", ".", "js", "'", "}", ",", "{", "src", ":", "'", "vendor", "/", "bower", "/", "simple", "-", "hotkeys", "/", "lib", "/", "hotkeys", ".", "js", "'", ",", "src", ":", "'", "node_modules", "/", "simple", "-", "hotkeys", "/", "lib", "/", "hotkeys", ".", "js", "'", ",", "dest", ":", "'", "site", "/", "assets", "/", "scripts", "/", "hotkeys", ".", "js", "'", "}", ",", "{", "src", ":", "'", "node_modules", "/", "dompurify", "/", "dist", "/", "purify", ".", "js", "'", ",", "dest", ":", "'", "site", "/", "assets", "/", "scripts", "/", "dompurify", ".", "js", "'", "}", ",", "{", "src", ":", "'", "lib", "/", "simditor", ".", "js", "'", ",", "dest", ":", "'", "site", "/", "assets", "/", "scripts", "/", "simditor", ".", "js", "'", "@", "@", "-", "129", ",", "17", "+", "132", ",", "20", "@", "@", "module", ".", "exports", "=", "(", "grunt", ")", "-", ">", "src", ":", "'", "lib", "/", "*'", ",", "dest", ":", "'", "package", "/", "scripts", "/", "'", "}", ",", "{", "src", ":", "'", "vendor", "/", "bower", "/", "jquery", "/", "dist", "/", "jquery", ".", "min", ".", "js", "'", ",", "src", ":", "'", "node_modules", "/", "jquery", "/", "dist", "/", "jquery", ".", "min", ".", "js", "'", ",", "dest", ":", "'", "package", "/", "scripts", "/", "jquery", ".", "min", ".", "js", "'", "}", ",", "{", "src", ":", "'", "vendor", "/", "bower", "/", "simple", "-", "module", "/", "lib", "/", "module", ".", "js", "'", ",", "src", ":", "'", "node_modules", "/", "simple", "-", "module", "/", "lib", "/", "module", ".", "js", "'", ",", "dest", ":", "'", "package", "/", "scripts", "/", "module", ".", "js", "'", "}", ",", "{", "src", ":", "'", "vendor", "/", "bower", "/", "simple", "-", "uploader", "/", "lib", "/", "uploader", ".", "js", "'", ",", "src", ":", "'", "node_modules", "/", "simple", "-", "uploader", "/", "lib", "/", "uploader", ".", "js", "'", ",", "dest", ":", "'", "package", "/", "scripts", "/", "uploader", ".", "js", "'", "}", ",", "{", "src", ":", "'", "vendor", "/", "bower", "/", "simple", "-", "hotkeys", "/", "lib", "/", "hotkeys", ".", "js", "'", ",", "src", ":", "'", "node_modules", "/", "simple", "-", "hotkeys", "/", "lib", "/", "hotkeys", ".", "js", "'", ",", "dest", ":", "'", "package", "/", "scripts", "/", "hotkeys", ".", "js", "'", "}", ",", "{", "src", ":", "'", "node_modules", "/", "dompurify", "/", "dist", "/", "purify", ".", "js", "'", ",", "dest", ":", "'", "package", "/", "scripts", "/", "dompurify", ".", "js", "'", "}", ",", "{", "expand", ":", "true", ",", "flatten", ":", "true", "@", "@", "-", "234", ",", "10", "+", "240", ",", "11", "@", "@", "module", ".", "exports", "=", "(", "grunt", ")", "-", ">", "'", "spec", "/", "buttons", "/", "*.", "js", "'", "]", "vendor", ":", "[", "'", "vendor", "/", "bower", "/", "jquery", "/", "dist", "/", "jquery", ".", "min", ".", "js", "'", "'", "vendor", "/", "bower", "/", "simple", "-", "module", "/", "lib", "/", "module", ".", "js", "'", "'", "vendor", "/", "bower", "/", "simple", "-", "uploader", "/", "lib", "/", "uploader", ".", "js", "'", "'", "vendor", "/", "bower", "/", "simple", "-", "hotkeys", "/", "lib", "/", "hotkeys", ".", "js", "'", "'", "node_modules", "/", "jquery", "/", "dist", "/", "jquery", ".", "min", ".", "js", "'", "'", "node_modules", "/", "simple", "-", "module", "/", "lib", "/", "module", ".", "js", "'", "'", "node_modules", "/", "simple", "-", "uploader", "/", "lib", "/", "uploader", ".", "js", "'", "'", "node_modules", "/", "simple", "-", "hotkeys", "/", "lib", "/", "hotkeys", ".", "js", "'", "'", "node_modules", "/", "dompurify", "/", "dist", "/", "purify", ".", "js", "'", "]", "curl", ":", "@", "@", "-", "9", ",", "6", "+", "9", ",", "5", "@", "@", "It", "is", "used", "by", "[", "Tower", "]", "(", "http", ":", "//", "tower", ".", "im", ")", "-", "-", "a", "popular", "project", "management", "web", "appli", "Supported", "Browsers", ":", "IE10", "+", "\u3001", "Chrome", "\u3001", "Firefox", "\u3001", "Safari", ".", "*", "[", "Download", "Zip", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simditor", "/", "releases", ")", "*", "Install", "with", "npm", ":", "$", "npm", "install", "simditor", "<", "/", "li", ">", "*", "Install", "with", "bower", ":", "$", "bower", "install", "simditor", "<", "/", "li", ">", "Demo", "and", "docs", "can", "be", "found", "[", "here", "]", "(", "http", ":", "//", "simditor", ".", "tower", ".", "im", "/", ").", "@", "@", "-", "1", ",", "40", "+", "0", ",", "0", "@", "@", "{", "\"", "name", "\"", ":", "\"", "simditor", "\"", ",", "\"", "version", "\"", ":", "\"", "2", ".", "3", ".", "21", "\"", ",", "\"", "homepage", "\"", ":", "\"", "http", ":", "//", "simditor", ".", "tower", ".", "im", "/", "\",", "\"", "authors", "\"", ":", "[", "\"", "farthinker", "<", "farthinker", "@", "gmail", ".", "com", ">", "\"", "]", ",", "\"", "description", "\"", ":", "\"", "A", "simple", "online", "editor", "\"", ",", "\"", "main", "\"", ":", "[", "\"", "lib", "/", "simditor", ".", "js", "\"", ",", "\"", "styles", "/", "simditor", ".", "css", "\"", "]", ",", "\"", "keywords", "\"", ":", "[", "\"", "editor", "\"", "]", ",", "\"", "license", "\"", ":", "\"", "MIT", "\"", ",", "\"", "ignore", "\"", ":", "[", "\"", "**", "/.", "*\"", ",", "\"", "spec", "\"", ",", "\"", "node_modules", "\"", ",", "\"", "vendor", "\"", ",", "\"", "site", "\"", ",", "\"", "_config", ".", "yml", "\"", ",", "\"", "Gemfile", "\"", ",", "\"", "Gemfile", ".", "lock", "\"", ",", "\"", "Gruntfile", ".", "coffee", "\"", ",", "\"", "package", ".", "json", "\"", ",", "\"", "server", ".", "js", "\"", ",", "\"", "README", ".", "md", "\"", ",", "\"", "umd", ".", "hbs", "\"", "]", ",", "\"", "devDependencies", "\"", ":", "{", "}", ",", "\"", "dependencies", "\"", ":", "{", "\"", "jquery", "\"", ":", "\"", "~", "2", ".", "1", ".", "4", "\"", ",", "\"", "simple", "-", "hotkeys", "\"", ":", "\"", "~", "1", ".", "0", ".", "3", "\"", ",", "\"", "simple", "-", "uploader", "\"", ":", "\"", "~", "2", ".", "0", ".", "7", "\"", ",", "\"", "simple", "-", "module", "\"", ":", "\"", "~", "2", ".", "0", ".", "6", "\"", "}", "}", "@", "@", "-", "1", ",", "7", "+", "0", ",", "0", "@", "@", "dependencies", ":", "pre", ":", "-", "npm", "install", "-", "g", "bower", "-", "bower", "install", "machine", ":", "ruby", ":", "version", ":", "2", ".", "3", ".", "1", "@", "@", "-", "1", ",", "23", "+", "1", ",", "23", "@", "@", "/", "*!", "*", "Simditor", "v2", ".", "3", ".", "21", "*", "http", ":", "//", "simditor", ".", "tower", ".", "im", "/", "*", "2018", "-", "10", "-", "17", "*", "2018", "-", "11", "-", "09", "*", "/", "(", "function", "(", "root", ",", "factory", ")", "{", "if", "(", "typeof", "define", "=", "==", "'", "function", "'", "&", "&", "define", ".", "amd", ")", "{", "/", "/", "AMD", ".", "Register", "as", "an", "anonymous", "module", "unless", "amdModuleId", "is", "set", "define", "(", "'", "simditor", "'", ",", "[", "\"", "jquery", "\"", ",\"", "simple", "-", "module", "\"", ",\"", "simple", "-", "hotkeys", "\"", ",\"", "simple", "-", "uploader", "\"", "],", "function", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ")", "{", "return", "(", "root", "[", "'", "Simditor", "'", "]", "=", "factory", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ")", ");", "define", "(", "'", "simditor", "'", ",", "[", "\"", "jquery", "\"", ",\"", "simple", "-", "module", "\"", ",\"", "simple", "-", "hotkeys", "\"", ",\"", "simple", "-", "uploader", "\"", ",\"", "dompurify", "\"", "],", "function", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ",", "DOMPurify", ")", "{", "return", "(", "root", "[", "'", "Simditor", "'", "]", "=", "factory", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ",", "DOMPurify", ")", ");", "}", ");", "}", "else", "if", "(", "typeof", "exports", "=", "==", "'", "object", "'", ")", "{", "/", "/", "Node", ".", "Does", "not", "work", "with", "strict", "CommonJS", ",", "but", "/", "/", "only", "CommonJS", "-", "like", "environments", "that", "support", "module", ".", "exports", ",", "/", "/", "like", "Node", ".", "module", ".", "exports", "=", "factory", "(", "require", "(", "\"", "jquery", "\"", "),", "require", "(", "\"", "simple", "-", "module", "\"", "),", "require", "(", "\"", "simple", "-", "hotkeys", "\"", "),", "require", "(", "\"", "simple", "-", "uploader", "\"", "))", ";", "module", ".", "exports", "=", "factory", "(", "require", "(", "\"", "jquery", "\"", "),", "require", "(", "\"", "simple", "-", "module", "\"", "),", "require", "(", "\"", "simple", "-", "hotkeys", "\"", "),", "require", "(", "\"", "simple", "-", "uploader", "\"", "),", "require", "(", "\"", "dompurify", "\"", "))", ";", "}", "else", "{", "root", "[", "'", "Simditor", "'", "]", "=", "factory", "(", "jQuery", ",", "SimpleModule", ",", "simple", ".", "hotkeys", ",", "simple", ".", "uploader", ")", ";", "root", "[", "'", "Simditor", "'", "]", "=", "factory", "(", "jQuery", ",", "SimpleModule", ",", "simple", ".", "hotkeys", ",", "simple", ".", "uploader", ",", "window", ".", "DOMPurify", ")", ";", "}", "}", "(", "this", ",", "function", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ")", "{", "}", "(", "this", ",", "function", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ",", "DOMPurify", ")", "{", "var", "AlignmentButton", ",", "BlockquoteButton", ",", "BoldButton", ",", "Button", ",", "Clipboard", ",", "CodeButton", ",", "CodePopover", ",", "ColorButton", ",", "FontScaleButton", ",", "Formatter", ",", "HrButton", ",", "ImageButton", ",", "ImagePopover", ",", "IndentButton", ",", "Indentation", ",", "InputManager", ",", "ItalicButton", ",", "Keystroke", ",", "LinkButton", ",", "LinkPopover", ",", "ListButton", ",", "OrderListButton", ",", "OutdentButton", ",", "Popover", ",", "Selection", ",", "Simditor", ",", "StrikethroughButton", ",", "TableButton", ",", "TitleButton", ",", "Toolbar", ",", "UnderlineButton", ",", "UndoManager", ",", "UnorderListButton", ",", "Util", ",", "extend", "=", "function", "(", "child", ",", "parent", ")", "{", "for", "(", "var", "key", "in", "parent", ")", "{", "if", "(", "hasProp", ".", "call", "(", "parent", ",", "key", ")", ")", "child", "[", "key", "]", "=", "parent", "[", "key", "]", ";", "}", "function", "ctor", "(", ")", "{", "this", ".", "constructor", "=", "child", ";", "}", "ctor", ".", "prototype", "=", "parent", ".", "prototype", ";", "child", ".", "prototype", "=", "new", "ctor", "(", ");", "child", ".", "__super__", "=", "parent", ".", "prototype", ";", "return", "child", ";", "}", ",", "@", "@", "-", "2342", ",", "7", "+", "2342", ",", "7", "@", "@", "Clipboard", "=", "(", "function", "(", "superClass", ")", "{", "return", "function", "(", ")", "{", "var", "pasteContent", ";", "_this", ".", "editor", ".", "hidePopover", "(", ");", "_this", ".", "editor", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "state", ".", "html", ";", "_this", ".", "editor", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "DOMPurify", "?", "DOMPurify", ".", "sanitize", "(", "state", ".", "html", ")", ":", "state", ".", "html", ";", "_this", ".", "editor", ".", "undoManager", ".", "caretPosition", "(", "state", ".", "caret", ")", ";", "_this", ".", "editor", ".", "body", ".", "focus", "(", ");", "_this", ".", "editor", ".", "selection", ".", "reset", "(", ");", "@", "@", "-", "2649", ",", "7", "+", "2649", ",", "7", "@", "@", "Simditor", "=", "(", "function", "(", "superClass", ")", "{", "Simditor", ".", "prototype", ".", "setValue", "=", "function", "(", "val", ")", "{", "this", ".", "hidePopover", "(", ");", "this", ".", "textarea", ".", "val", "(", "val", ")", ";", "this", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "val", ";", "this", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "DOMPurify", "?", "DOMPurify", ".", "sanitize", "(", "val", ")", ":", "val", ";", "this", ".", "formatter", ".", "format", "(", ");", "this", ".", "formatter", ".", "decorate", "(", ");", "this", ".", "util", ".", "reflow", "(", "this", ".", "body", ")", ";", "@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "{", "\"", "name", "\"", ":", "\"", "simditor", "\"", ",", "\"", "version", "\"", ":", "\"", "2", ".", "3", ".", "21", "\"", ",", "\"", "version", "\"", ":", "\"", "2", ".", "3", ".", "22", "\"", ",", "\"", "description", "\"", ":", "\"", "A", "simple", "online", "editor", "\"", ",", "\"", "keywords", "\"", ":", "\"", "editor", "simditor", "\"", ",", "\"", "repository", "\"", ":", "{", "@", "@", "-", "23", ",", "26", "+", "23", ",", "28", "@", "@", "]", ",", "\"", "homepage", "\"", ":", "\"", "http", ":", "//", "simditor", ".", "tower", ".", "im", "\"", ",", "\"", "dependencies", "\"", ":", "{", "\"", "dompurify", "\"", ":", "\"", "^", "1", ".", "0", ".", "8", "\"", ",", "\"", "jquery", "\"", ":", "\"", "~", "2", ".", "1", ".", "4", "\"", ",", "\"", "simple", "-", "hotkeys", "\"", ":", "\"", "~", "1", ".", "0", ".", "3", "\"", ",", "\"", "simple", "-", "uploader", "\"", ":", "\"", "~", "2", ".", "0", ".", "7", "\"", ",", "\"", "simple", "-", "module", "\"", ":", "\"", "~", "2", ".", "0", ".", "6", "\"", "\"", "simple", "-", "module", "\"", ":", "\"", "~", "2", ".", "0", ".", "6", "\"", ",", "\"", "simple", "-", "uploader", "\"", ":", "\"", "~", "2", ".", "0", ".", "7", "\"", "}", ",", "\"", "devDependencies", "\"", ":", "{", "\"", "express", "\"", ":", "\"", "~", "3", ".", "3", ".", "4", "\"", ",", "\"", "grunt", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "sass", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "watch", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "banner", "\"", ":", "\"", "0", ".", "3", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "clean", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "coffee", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "copy", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "uglify", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "compress", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "clean", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "copy", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "jasmine", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "jekyll", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "umd", "\"", ":", "\"", "2", ".", "3", ".", "x", "\"", ",", "\"", "grunt", "-", "express", "\"", ":", "\"", "1", ".", "4", ".", "0", "\"", ",", "\"", "grunt", "-", "banner", "\"", ":", "\"", "0", ".", "3", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "sass", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "uglify", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "contrib", "-", "watch", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "curl", "\"", ":", "\"", "2", ".", "1", ".", "x", "\"", ",", "\"", "express", "\"", ":", "\"", "~", "3", ".", "3", ".", "4", "\"", "\"", "grunt", "-", "express", "\"", ":", "\"", "1", ".", "4", ".", "0", "\"", ",", "\"", "grunt", "-", "jekyll", "\"", ":", "\"", "0", ".", "x", "\"", ",", "\"", "grunt", "-", "parallel", "\"", ":", "\"", "^", "0", ".", "5", ".", "1", "\"", ",", "\"", "grunt", "-", "umd", "\"", ":", "\"", "2", ".", "3", ".", "x", "\"", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "1017", "@", "@", "(", "function", "(", "global", ",", "factory", ")", "{", "typeof", "exports", "=", "==", "'", "object", "'", "&", "&", "typeof", "module", "!", "==", "'", "undefined", "'", "?", "module", ".", "exports", "=", "factory", "(", ")", ":", "typeof", "define", "=", "==", "'", "function", "'", "&", "&", "define", ".", "amd", "?", "define", "(", "factory", ")", ":", "(", "global", ".", "DOMPurify", "=", "factory", "(", "))", ";", "}", "(", "this", ",", "(", "function", "(", ")", "{", "'", "use", "strict", "'", ";", "var", "html", "=", "[", "'", "a", "'", ",", "'", "abbr", "'", ",", "'", "acronym", "'", ",", "'", "address", "'", ",", "'", "area", "'", ",", "'", "article", "'", ",", "'", "aside", "'", ",", "'", "audio", "'", ",", "'", "b", "'", ",", "'", "bdi", "'", ",", "'", "bdo", "'", ",", "'", "big", "'", ",", "'", "blink", "'", ",", "'", "blockquote", "'", ",", "'", "body", "'", ",", "'", "br", "'", ",", "'", "button", "'", ",", "'", "canvas", "'", ",", "'", "caption", "'", ",", "'", "center", "'", ",", "'", "cite", "'", ",", "'", "code", "'", ",", "'", "col", "'", ",", "'", "colgroup", "'", ",", "'", "content", "'", ",", "'", "data", "'", ",", "'", "datalist", "'", ",", "'", "dd", "'", ",", "'", "decorator", "'", ",", "'", "del", "'", ",", "'", "details", "'", ",", "'", "dfn", "'", ",", "'", "dir", "'", ",", "'", "div", "'", ",", "'", "dl", "'", ",", "'", "dt", "'", ",", "'", "element", "'", ",", "'", "em", "'", ",", "'", "fieldset", "'", ",", "'", "figcaption", "'", ",", "'", "figure", "'", ",", "'", "font", "'", ",", "'", "footer", "'", ",", "'", "form", "'", ",", "'", "h1", "'", ",", "'", "h2", "'", ",", "'", "h3", "'", ",", "'", "h4", "'", ",", "'", "h5", "'", ",", "'", "h6", "'", ",", "'", "head", "'", ",", "'", "header", "'", ",", "'", "hgroup", "'", ",", "'", "hr", "'", ",", "'", "html", "'", ",", "'", "i", "'", ",", "'", "img", "'", ",", "'", "input", "'", ",", "'", "ins", "'", ",", "'", "kbd", "'", ",", "'", "label", "'", ",", "'", "legend", "'", ",", "'", "li", "'", ",", "'", "main", "'", ",", "'", "map", "'", ",", "'", "mark", "'", ",", "'", "marquee", "'", ",", "'", "menu", "'", ",", "'", "menuitem", "'", ",", "'", "meter", "'", ",", "'", "nav", "'", ",", "'", "nobr", "'", ",", "'", "ol", "'", ",", "'", "optgroup", "'", ",", "'", "option", "'", ",", "'", "output", "'", ",", "'", "p", "'", ",", "'", "pre", "'", ",", "'", "progress", "'", ",", "'", "q", "'", ",", "'", "rp", "'", ",", "'", "rt", "'", ",", "'", "ruby", "'", ",", "'", "s", "'", ",", "'", "samp", "'", ",", "'", "section", "'", ",", "'", "select", "'", ",", "'", "shadow", "'", ",", "'", "small", "'", ",", "'", "source", "'", ",", "'", "spacer", "'", ",", "'", "span", "'", ",", "'", "strike", "'", ",", "'", "strong", "'", ",", "'", "style", "'", ",", "'", "sub", "'", ",", "'", "summary", "'", ",", "'", "sup", "'", ",", "'", "table", "'", ",", "'", "tbody", "'", ",", "'", "td", "'", ",", "'", "template", "'", ",", "'", "textarea", "'", ",", "'", "tfoot", "'", ",", "'", "th", "'", ",", "'", "thead", "'", ",", "'", "time", "'", ",", "'", "tr", "'", ",", "'", "track", "'", ",", "'", "tt", "'", ",", "'", "u", "'", ",", "'", "ul", "'", ",", "'", "var", "'", ",", "'", "video", "'", ",", "'", "wbr", "'", "];", "/", "/", "SVG", "var", "svg", "=", "[", "'", "svg", "'", ",", "'", "a", "'", ",", "'", "altglyph", "'", ",", "'", "altglyphdef", "'", ",", "'", "altglyphitem", "'", ",", "'", "animatecolor", "'", ",", "'", "animatemotion", "'", ",", "'", "animatetransform", "'", ",", "'", "audio", "'", ",", "'", "canvas", "'", ",", "'", "circle", "'", ",", "'", "clippath", "'", ",", "'", "defs", "'", ",", "'", "desc", "'", ",", "'", "ellipse", "'", ",", "'", "filter", "'", ",", "'", "font", "'", ",", "'", "g", "'", ",", "'", "glyph", "'", ",", "'", "glyphref", "'", ",", "'", "hkern", "'", ",", "'", "image", "'", ",", "'", "line", "'", ",", "'", "lineargradient", "'", ",", "'", "marker", "'", ",", "'", "mask", "'", ",", "'", "metadata", "'", ",", "'", "mpath", "'", ",", "'", "path", "'", ",", "'", "pattern", "'", ",", "'", "polygon", "'", ",", "'", "polyline", "'", ",", "'", "radialgradient", "'", ",", "'", "rect", "'", ",", "'", "stop", "'", ",", "'", "style", "'", ",", "'", "switch", "'", ",", "'", "symbol", "'", ",", "'", "text", "'", ",", "'", "textpath", "'", ",", "'", "title", "'", ",", "'", "tref", "'", ",", "'", "tspan", "'", ",", "'", "video", "'", ",", "'", "view", "'", ",", "'", "vkern", "'", "];", "var", "svgFilters", "=", "[", "'", "feBlend", "'", ",", "'", "feColorMatrix", "'", ",", "'", "feComponentTransfer", "'", ",", "'", "feComposite", "'", ",", "'", "feConvolveMatrix", "'", ",", "'", "feDiffuseLighting", "'", ",", "'", "feDisplacementMap", "'", ",", "'", "feDistantLight", "'", ",", "'", "feFlood", "'", ",", "'", "feFuncA", "'", ",", "'", "feFuncB", "'", ",", "'", "feFuncG", "'", ",", "'", "feFuncR", "'", ",", "'", "feGaussianBlur", "'", ",", "'", "feMerge", "'", ",", "'", "feMergeNode", "'", ",", "'", "feMorphology", "'", ",", "'", "feOffset", "'", ",", "'", "fePointLight", "'", ",", "'", "feSpecularLighting", "'", ",", "'", "feSpotLight", "'", ",", "'", "feTile", "'", ",", "'", "feTurbulence", "'", "];", "var", "mathMl", "=", "[", "'", "math", "'", ",", "'", "menclose", "'", ",", "'", "merror", "'", ",", "'", "mfenced", "'", ",", "'", "mfrac", "'", ",", "'", "mglyph", "'", ",", "'", "mi", "'", ",", "'", "mlabeledtr", "'", ",", "'", "mmuliscripts", "'", ",", "'", "mn", "'", ",", "'", "mo", "'", ",", "'", "mover", "'", ",", "'", "mpadded", "'", ",", "'", "mphantom", "'", ",", "'", "mroot", "'", ",", "'", "mrow", "'", ",", "'", "ms", "'", ",", "'", "mpspace", "'", ",", "'", "msqrt", "'", ",", "'", "mystyle", "'", ",", "'", "msub", "'", ",", "'", "msup", "'", ",", "'", "msubsup", "'", ",", "'", "mtable", "'", ",", "'", "mtd", "'", ",", "'", "mtext", "'", ",", "'", "mtr", "'", ",", "'", "munder", "'", ",", "'", "munderover", "'", "];", "var", "text", "=", "[", "'#", "text", "'", "];", "var", "html", "$", "1", "=", "[", "'", "accept", "'", ",", "'", "action", "'", ",", "'", "align", "'", ",", "'", "alt", "'", ",", "'", "autocomplete", "'", ",", "'", "background", "'", ",", "'", "bgcolor", "'", ",", "'", "border", "'", ",", "'", "cellpadding", "'", ",", "'", "cellspacing", "'", ",", "'", "checked", "'", ",", "'", "cite", "'", ",", "'", "class", "'", ",", "'", "clear", "'", ",", "'", "color", "'", ",", "'", "cols", "'", ",", "'", "colspan", "'", ",", "'", "coords", "'", ",", "'", "crossorigin", "'", ",", "'", "datetime", "'", ",", "'", "default", "'", ",", "'", "dir", "'", ",", "'", "disabled", "'", ",", "'", "download", "'", ",", "'", "enctype", "'", ",", "'", "face", "'", ",", "'", "for", "'", ",", "'", "headers", "'", ",", "'", "height", "'", ",", "'", "hidden", "'", ",", "'", "high", "'", ",", "'", "href", "'", ",", "'", "hreflang", "'", ",", "'", "id", "'", ",", "'", "integrity", "'", ",", "'", "ismap", "'", ",", "'", "label", "'", ",", "'", "lang", "'", ",", "'", "list", "'", ",", "'", "loop", "'", ",", "'", "low", "'", ",", "'", "max", "'", ",", "'", "maxlength", "'", ",", "'", "media", "'", ",", "'", "method", "'", ",", "'", "min", "'", ",", "'", "multiple", "'", ",", "'", "name", "'", ",", "'", "noshade", "'", ",", "'", "novalidate", "'", ",", "'", "nowrap", "'", ",", "'", "open", "'", ",", "'", "optimum", "'", ",", "'", "pattern", "'", ",", "'", "placeholder", "'", ",", "'", "poster", "'", ",", "'", "preload", "'", ",", "'", "pubdate", "'", ",", "'", "radiogroup", "'", ",", "'", "readonly", "'", ",", "'", "rel", "'", ",", "'", "required", "'", ",", "'", "rev", "'", ",", "'", "reversed", "'", ",", "'", "role", "'", ",", "'", "rows", "'", ",", "'", "rowspan", "'", ",", "'", "spellcheck", "'", ",", "'", "scope", "'", ",", "'", "selected", "'", ",", "'", "shape", "'", ",", "'", "size", "'", ",", "'", "sizes", "'", ",", "'", "span", "'", ",", "'", "srclang", "'", ",", "'", "start", "'", ",", "'", "src", "'", ",", "'", "srcset", "'", ",", "'", "step", "'", ",", "'", "style", "'", ",", "'", "summary", "'", ",", "'", "tabindex", "'", ",", "'", "title", "'", ",", "'", "type", "'", ",", "'", "usemap", "'", ",", "'", "valign", "'", ",", "'", "value", "'", ",", "'", "width", "'", ",", "'", "xmlns", "'", "];", "var", "svg", "$", "1", "=", "[", "'", "accent", "-", "height", "'", ",", "'", "accumulate", "'", ",", "'", "additivive", "'", ",", "'", "alignment", "-", "baseline", "'", ",", "'", "ascent", "'", ",", "'", "attributename", "'", ",", "'", "attributetype", "'", ",", "'", "azimuth", "'", ",", "'", "basefrequency", "'", ",", "'", "baseline", "-", "shift", "'", ",", "'", "begin", "'", ",", "'", "bias", "'", ",", "'", "by", "'", ",", "'", "class", "'", ",", "'", "clip", "'", ",", "'", "clip", "-", "path", "'", ",", "'", "clip", "-", "rule", "'", ",", "'", "color", "'", ",", "'", "color", "-", "interpolation", "'", ",", "'", "color", "-", "interpolation", "-", "filters", "'", ",", "'", "color", "-", "profile", "'", ",", "'", "color", "-", "rendering", "'", ",", "'", "cx", "'", ",", "'", "cy", "'", ",", "'", "d", "'", ",", "'", "dx", "'", ",", "'", "dy", "'", ",", "'", "diffuseconstant", "'", ",", "'", "direction", "'", ",", "'", "display", "'", ",", "'", "divisor", "'", ",", "'", "dur", "'", ",", "'", "edgemode", "'", ",", "'", "elevation", "'", ",", "'", "end", "'", ",", "'", "fill", "'", ",", "'", "fill", "-", "opacity", "'", ",", "'", "fill", "-", "rule", "'", ",", "'", "filter", "'", ",", "'", "flood", "-", "color", "'", ",", "'", "flood", "-", "opacity", "'", ",", "'", "font", "-", "family", "'", ",", "'", "font", "-", "size", "'", ",", "'", "font", "-", "size", "-", "adjust", "'", ",", "'", "font", "-", "stretch", "'", ",", "'", "font", "-", "style", "'", ",", "'", "font", "-", "variant", "'", ",", "'", "font", "-", "weight", "'", ",", "'", "fx", "'", ",", "'", "fy", "'", ",", "'", "g1", "'", ",", "'", "g2", "'", ",", "'", "glyph", "-", "name", "'", ",", "'", "glyphref", "'", ",", "'", "gradientunits", "'", ",", "'", "gradienttransform", "'", ",", "'", "height", "'", ",", "'", "href", "'", ",", "'", "id", "'", ",", "'", "image", "-", "rendering", "'", ",", "'", "in", "'", ",", "'", "in2", "'", ",", "'", "k", "'", ",", "'", "k1", "'", ",", "'", "k2", "'", ",", "'", "k3", "'", ",", "'", "k4", "'", ",", "'", "kerning", "'", ",", "'", "keypoints", "'", ",", "'", "keysplines", "'", ",", "'", "keytimes", "'", ",", "'", "lang", "'", ",", "'", "lengthadjust", "'", ",", "'", "letter", "-", "spacing", "'", ",", "'", "kernelmatrix", "'", ",", "'", "kernelunitlength", "'", ",", "'", "lighting", "-", "color", "'", ",", "'", "local", "'", ",", "'", "marker", "-", "end", "'", ",", "'", "marker", "-", "mid", "'", ",", "'", "marker", "-", "start", "'", ",", "'", "markerheight", "'", ",", "'", "markerunits", "'", ",", "'", "markerwidth", "'", ",", "'", "maskcontentunits", "'", ",", "'", "maskunits", "'", ",", "'", "max", "'", ",", "'", "mask", "'", ",", "'", "media", "'", ",", "'", "method", "'", ",", "'", "mode", "'", ",", "'", "min", "'", ",", "'", "name", "'", ",", "'", "numoctaves", "'", ",", "'", "offset", "'", ",", "'", "operator", "'", ",", "'", "opacity", "'", ",", "'", "order", "'", ",", "'", "orient", "'", ",", "'", "orientation", "'", ",", "'", "origin", "'", ",", "'", "overflow", "'", ",", "'", "paint", "-", "order", "'", ",", "'", "path", "'", ",", "'", "pathlength", "'", ",", "'", "patterncontentunits", "'", ",", "'", "patterntransform", "'", ",", "'", "patternunits", "'", ",", "'", "points", "'", ",", "'", "preservealpha", "'", ",", "'", "preserveaspectratio", "'", ",", "'", "r", "'", ",", "'", "rx", "'", ",", "'", "ry", "'", ",", "'", "radius", "'", ",", "'", "refx", "'", ",", "'", "refy", "'", ",", "'", "repeatcount", "'", ",", "'", "repeatdur", "'", ",", "'", "restart", "'", ",", "'", "result", "'", ",", "'", "rotate", "'", ",", "'", "scale", "'", ",", "'", "seed", "'", ",", "'", "shape", "-", "rendering", "'", ",", "'", "specularconstant", "'", ",", "'", "specularexponent", "'", ",", "'", "spreadmethod", "'", ",", "'", "stddeviation", "'", ",", "'", "stitchtiles", "'", ",", "'", "stop", "-", "color", "'", ",", "'", "stop", "-", "opacity", "'", ",", "'", "stroke", "-", "dasharray", "'", ",", "'", "stroke", "-", "dashoffset", "'", ",", "'", "stroke", "-", "linecap", "'", ",", "'", "stroke", "-", "linejoin", "'", ",", "'", "stroke", "-", "miterlimit", "'", ",", "'", "stroke", "-", "opacity", "'", ",", "'", "stroke", "'", ",", "'", "stroke", "-", "width", "'", ",", "'", "style", "'", ",", "'", "surfacescale", "'", ",", "'", "tabindex", "'", ",", "'", "targetx", "'", ",", "'", "targety", "'", ",", "'", "transform", "'", ",", "'", "text", "-", "anchor", "'", ",", "'", "text", "-", "decoration", "'", ",", "'", "text", "-", "rendering", "'", ",", "'", "textlength", "'", ",", "'", "type", "'", ",", "'", "u1", "'", ",", "'", "u2", "'", ",", "'", "unicode", "'", ",", "'", "values", "'", ",", "'", "viewbox", "'", ",", "'", "visibility", "'", ",", "'", "vert", "-", "adv", "-", "y", "'", ",", "'", "vert", "-", "origin", "-", "x", "'", ",", "'", "vert", "-", "origin", "-", "y", "'", ",", "'", "width", "'", ",", "'", "word", "-", "spacing", "'", ",", "'", "wrap", "'", ",", "'", "writing", "-", "mode", "'", ",", "'", "xchannelselector", "'", ",", "'", "ychannelselector", "'", ",", "'", "x", "'", ",", "'", "x1", "'", ",", "'", "x2", "'", ",", "'", "xmlns", "'", ",", "'", "y", "'", ",", "'", "y1", "'", ",", "'", "y2", "'", ",", "'", "z", "'", ",", "'", "zoomandpan", "'", "];", "var", "mathMl", "$", "1", "=", "[", "'", "accent", "'", ",", "'", "accentunder", "'", ",", "'", "align", "'", ",", "'", "bevelled", "'", ",", "'", "close", "'", ",", "'", "columnsalign", "'", ",", "'", "columnlines", "'", ",", "'", "columnspan", "'", ",", "'", "denomalign", "'", ",", "'", "depth", "'", ",", "'", "dir", "'", ",", "'", "display", "'", ",", "'", "displaystyle", "'", ",", "'", "fence", "'", ",", "'", "frame", "'", ",", "'", "height", "'", ",", "'", "href", "'", ",", "'", "id", "'", ",", "'", "largeop", "'", ",", "'", "length", "'", ",", "'", "linethickness", "'", ",", "'", "lspace", "'", ",", "'", "lquote", "'", ",", "'", "mathbackground", "'", ",", "'", "mathcolor", "'", ",", "'", "mathsize", "'", ",", "'", "mathvariant", "'", ",", "'", "maxsize", "'", ",", "'", "minsize", "'", ",", "'", "movablelimits", "'", ",", "'", "notation", "'", ",", "'", "numalign", "'", ",", "'", "open", "'", ",", "'", "rowalign", "'", ",", "'", "rowlines", "'", ",", "'", "rowspacing", "'", ",", "'", "rowspan", "'", ",", "'", "rspace", "'", ",", "'", "rquote", "'", ",", "'", "scriptlevel", "'", ",", "'", "scriptminsize", "'", ",", "'", "scriptsizemultiplier", "'", ",", "'", "selection", "'", ",", "'", "separator", "'", ",", "'", "separators", "'", ",", "'", "stretchy", "'", ",", "'", "subscriptshift", "'", ",", "'", "supscriptshift", "'", ",", "'", "symmetric", "'", ",", "'", "voffset", "'", ",", "'", "width", "'", ",", "'", "xmlns", "'", "];", "var", "xml", "=", "[", "'", "xlink", ":", "href", "'", ",", "'", "xml", ":", "id", "'", ",", "'", "xlink", ":", "title", "'", ",", "'", "xml", ":", "space", "'", ",", "'", "xmlns", ":", "xlink", "'", "];", "/", "*", "Add", "properties", "to", "a", "lookup", "table", "*", "/", "function", "addToSet", "(", "set", ",", "array", ")", "{", "var", "l", "=", "array", ".", "length", ";", "while", "(", "l", "-", "-)", "{", "if", "(", "typeof", "array", "[", "l", "]", "=", "==", "'", "string", "'", ")", "{", "array", "[", "l", "]", "=", "array", "[", "l", "]", ".", "toLowerCase", "(", ");", "}", "set", "[", "array", "[", "l", "]", "]", "=", "true", ";", "}", "return", "set", ";", "}", "/", "*", "Shallow", "clone", "an", "object", "*", "/", "function", "clone", "(", "object", ")", "{", "var", "newObject", "=", "{", "};", "var", "property", "=", "void", "0", ";", "for", "(", "property", "in", "object", ")", "{", "if", "(", "Object", ".", "prototype", ".", "hasOwnProperty", ".", "call", "(", "object", ",", "property", ")", ")", "{", "newObject", "[", "property", "]", "=", "object", "[", "property", "]", ";", "}", "}", "return", "newObject", ";", "}", "var", "MUSTACHE_EXPR", "=", "/", "\\{", "\\{", "[\\", "s", "\\", "S", "]", "*|", "[\\", "s", "\\", "S", "]", "*\\", "}\\", "}/", "gm", ";", "/", "/", "Specify", "template", "detection", "regex", "for", "SAFE_FOR_TEMPLATES", "mode", "var", "ERB_EXPR", "=", "/", "<%", "[\\", "s", "\\", "S", "]", "*|", "[\\", "s", "\\", "S", "]", "*%", ">/", "gm", ";", "var", "DATA_ATTR", "=", "/", "^", "data", "-", "[\\", "-\\", "w", ".", "\\", "u00B7", "-", "\\", "uFFFF", "]", "/;", "/", "/", "eslint", "-", "disable", "-", "line", "no", "-", "useless", "-", "escape", "var", "ARIA_ATTR", "=", "/", "^", "aria", "-", "[\\", "-\\", "w", "]", "+$", "/;", "/", "/", "eslint", "-", "disable", "-", "line", "no", "-", "useless", "-", "escape", "var", "IS_ALLOWED_URI", "=", "/", "^(", "?:", "(?", ":(", "?:", "f", "|", "ht", ")", "tps", "?", "|", "mailto", "|", "tel", "|", "callto", "|", "cid", "|", "xmpp", ")", ":|", "[^", "a", "-", "z", "]", "|[", "a", "-", "z", "+", ".\\", "-]", "+(", "?:", "[^", "a", "-", "z", "+", ".\\", "-:", "]|", "$)", ")/", "i", ";", "/", "/", "eslint", "-", "disable", "-", "line", "no", "-", "useless", "-", "escape", "var", "IS_SCRIPT_OR_DATA", "=", "/", "^(", "?:", "\\", "w", "+", "script", "|", "data", ")", ":/", "i", ";", "var", "ATTR_WHITESPACE", "=", "/", "[\\", "u0000", "-", "\\", "u0020", "\\", "u00A0", "\\", "u1680", "\\", "u180E", "\\", "u2000", "-", "\\", "u2029", "\\", "u205f", "\\", "u3000", "]", "/", "g", ";", "/", "/", "eslint", "-", "disable", "-", "line", "no", "-", "control", "-", "regex", "var", "_typeof", "=", "typeof", "Symbol", "=", "==", "\"", "function", "\"", "&", "&", "typeof", "Symbol", ".", "iterator", "=", "==", "\"", "symbol", "\"", "?", "function", "(", "obj", ")", "{", "return", "typeof", "obj", ";", "}", ":", "function", "(", "obj", ")", "{", "return", "obj", "&", "&", "typeof", "Symbol", "=", "==", "\"", "function", "\"", "&", "&", "obj", ".", "constructor", "=", "==", "Symbol", "&", "&", "obj", "!", "==", "Symbol", ".", "prototype", "?", "\"", "symbol", "\"", ":", "typeof", "obj", ";", "}", ";", "function", "_toConsumableArray", "(", "arr", ")", "{", "if", "(", "Array", ".", "isArray", "(", "arr", ")", ")", "{", "for", "(", "var", "i", "=", "0", ",", "arr2", "=", "Array", "(", "arr", ".", "length", ")", ";", "i", "<", "arr", ".", "length", ";", "i", "+", "+)", "{", "arr2", "[", "i", "]", "=", "arr", "[", "i", "]", ";", "}", "return", "arr2", ";", "}", "else", "{", "return", "Array", ".", "from", "(", "arr", ")", ";", "}", "}", "var", "getGlobal", "=", "function", "getGlobal", "(", ")", "{", "return", "typeof", "window", "=", "==", "'", "undefined", "'", "?", "null", ":", "window", ";", "}", ";", "function", "createDOMPurify", "(", ")", "{", "var", "window", "=", "arguments", ".", "length", ">", "0", "&", "&", "arguments", "[", "0", "]", "!", "==", "undefined", "?", "arguments", "[", "0", "]", ":", "getGlobal", "(", ");", "var", "DOMPurify", "=", "function", "DOMPurify", "(", "root", ")", "{", "return", "createDOMPurify", "(", "root", ")", ";", "}", ";", "/", "**", "*", "Version", "label", ",", "exposed", "for", "easier", "checks", "*", "if", "DOMPurify", "is", "up", "to", "date", "or", "not", "*", "/", "DOMPurify", ".", "version", "=", "'", "1", ".", "0", ".", "8", "'", ";", "/", "**", "*", "Array", "of", "elements", "that", "DOMPurify", "removed", "during", "sanitation", ".", "*", "Empty", "if", "nothing", "was", "removed", ".", "*", "/", "DOMPurify", ".", "removed", "=", "[", "];", "if", "(", "!", "window", "|", "|", "!", "window", ".", "document", "|", "|", "window", ".", "document", ".", "nodeType", "!", "==", "9", ")", "{", "/", "/", "Not", "running", "in", "a", "browser", ",", "provide", "a", "factory", "function", "/", "/", "so", "that", "you", "can", "pass", "your", "own", "Window", "DOMPurify", ".", "isSupported", "=", "false", ";", "return", "DOMPurify", ";", "}", "var", "originalDocument", "=", "window", ".", "document", ";", "var", "useDOMParser", "=", "false", ";", "/", "/", "See", "comment", "below", "var", "removeTitle", "=", "false", ";", "/", "/", "See", "comment", "below", "var", "document", "=", "window", ".", "document", ";", "var", "DocumentFragment", "=", "window", ".", "DocumentFragment", ",", "HTMLTemplateElement", "=", "window", ".", "HTMLTemplateElement", ",", "Node", "=", "window", ".", "Node", ",", "NodeFilter", "=", "window", ".", "NodeFilter", ",", "_window", "$", "NamedNodeMap", "=", "window", ".", "NamedNodeMap", ",", "NamedNodeMap", "=", "_window", "$", "NamedNodeMap", "=", "==", "undefined", "?", "window", ".", "NamedNodeMap", "|", "|", "window", ".", "MozNamedAttrMap", ":", "_window", "$", "NamedNodeMap", ",", "Text", "=", "window", ".", "Text", ",", "Comment", "=", "window", ".", "Comment", ",", "DOMParser", "=", "window", ".", "DOMParser", ";", "/", "/", "As", "per", "issue", "#", "47", ",", "the", "web", "-", "components", "registry", "is", "inherited", "by", "a", "/", "/", "new", "document", "created", "via", "createHTMLDocument", ".", "As", "per", "the", "spec", "/", "/", "(", "http", ":", "//", "w3c", ".", "github", ".", "io", "/", "webcomponents", "/", "spec", "/", "custom", "/", "#", "creating", "-", "and", "-", "passing", "-", "registries", ")", "/", "/", "a", "new", "empty", "registry", "is", "used", "when", "creating", "a", "template", "contents", "owner", "/", "/", "document", ",", "so", "we", "use", "that", "as", "our", "parent", "document", "to", "ensure", "nothing", "/", "/", "is", "inherited", ".", "if", "(", "typeof", "HTMLTemplateElement", "=", "==", "'", "function", "'", ")", "{", "var", "template", "=", "document", ".", "createElement", "(", "'", "template", "'", ");", "if", "(", "template", ".", "content", "&", "&", "template", ".", "content", ".", "ownerDocument", ")", "{", "document", "=", "template", ".", "content", ".", "ownerDocument", ";", "}", "}", "var", "_document", "=", "document", ",", "implementation", "=", "_document", ".", "implementation", ",", "createNodeIterator", "=", "_document", ".", "createNodeIterator", ",", "getElementsByTagName", "=", "_document", ".", "getElementsByTagName", ",", "createDocumentFragment", "=", "_document", ".", "createDocumentFragment", ";", "var", "importNode", "=", "originalDocument", ".", "importNode", ";", "var", "hooks", "=", "{", "};", "/", "**", "*", "Expose", "whether", "this", "browser", "supports", "running", "the", "full", "DOMPurify", ".", "*", "/", "DOMPurify", ".", "isSupported", "=", "implementation", "&", "&", "typeof", "implementation", ".", "createHTMLDocument", "!", "==", "'", "undefined", "'", "&", "&", "document", ".", "documentMode", "!", "==", "9", ";", "var", "MUSTACHE_EXPR", "$", "$", "1", "=", "MUSTACHE_EXPR", ",", "ERB_EXPR", "$", "$", "1", "=", "ERB_EXPR", ",", "DATA_ATTR", "$", "$", "1", "=", "DATA_ATTR", ",", "ARIA_ATTR", "$", "$", "1", "=", "ARIA_ATTR", ",", "IS_SCRIPT_OR_DATA", "$", "$", "1", "=", "IS_SCRIPT_OR_DATA", ",", "ATTR_WHITESPACE", "$", "$", "1", "=", "ATTR_WHITESPACE", ";", "var", "IS_ALLOWED_URI", "$", "$", "1", "=", "IS_ALLOWED_URI", ";", "/", "**", "*", "We", "consider", "the", "elements", "and", "attributes", "below", "to", "be", "safe", ".", "Ideally", "*", "don", "'", "t", "add", "any", "new", "ones", "but", "feel", "free", "to", "remove", "unwanted", "ones", ".", "*", "/", "/", "*", "allowed", "element", "names", "*", "/", "var", "ALLOWED_TAGS", "=", "null", ";", "var", "DEFAULT_ALLOWED_TAGS", "=", "addToSet", "(", "{}", ",", "[", "].", "concat", "(", "_toConsumableArray", "(", "html", ")", ",", "_toConsumableArray", "(", "svg", ")", ",", "_toConsumableArray", "(", "svgFilters", ")", ",", "_toConsumableArray", "(", "mathMl", ")", ",", "_toConsumableArray", "(", "text", ")", "))", ";", "/", "*", "Allowed", "attribute", "names", "*", "/", "var", "ALLOWED_ATTR", "=", "null", ";", "var", "DEFAULT_ALLOWED_ATTR", "=", "addToSet", "(", "{}", ",", "[", "].", "concat", "(", "_toConsumableArray", "(", "html", "$", "1", ")", ",", "_toConsumableArray", "(", "svg", "$", "1", ")", ",", "_toConsumableArray", "(", "mathMl", "$", "1", ")", ",", "_toConsumableArray", "(", "xml", ")", "))", ";", "/", "*", "Explicitly", "forbidden", "tags", "(", "overrides", "ALLOWED_TAGS", "/", "ADD_TAGS", ")", "*", "/", "var", "FORBID_TAGS", "=", "null", ";", "/", "*", "Explicitly", "forbidden", "attributes", "(", "overrides", "ALLOWED_ATTR", "/", "ADD_ATTR", ")", "*", "/", "var", "FORBID_ATTR", "=", "null", ";", "/", "*", "Decide", "if", "ARIA", "attributes", "are", "okay", "*", "/", "var", "ALLOW_ARIA_ATTR", "=", "true", ";", "/", "*", "Decide", "if", "custom", "data", "attributes", "are", "okay", "*", "/", "var", "ALLOW_DATA_ATTR", "=", "true", ";", "/", "*", "Decide", "if", "unknown", "protocols", "are", "okay", "*", "/", "var", "ALLOW_UNKNOWN_PROTOCOLS", "=", "false", ";", "/", "*", "Output", "should", "be", "safe", "for", "jQuery", "'", "s", "$", "()", "factory", "?", "*", "/", "var", "SAFE_FOR_JQUERY", "=", "false", ";", "/", "*", "Output", "should", "be", "safe", "for", "common", "template", "engines", ".", "*", "This", "means", ",", "DOMPurify", "removes", "data", "attributes", ",", "mustaches", "and", "ERB", "*", "/", "var", "SAFE_FOR_TEMPLATES", "=", "false", ";", "/", "*", "Decide", "if", "document", "with", "<", "html", ">", "..", ".", "should", "be", "returned", "*", "/", "var", "WHOLE_DOCUMENT", "=", "false", ";", "/", "*", "Track", "whether", "config", "is", "already", "set", "on", "this", "instance", "of", "DOMPurify", ".", "*", "/", "var", "SET_CONFIG", "=", "false", ";", "/", "*", "Decide", "if", "all", "elements", "(", "e", ".", "g", ".", "style", ",", "script", ")", "must", "be", "children", "of", "*", "document", ".", "body", ".", "By", "default", ",", "browsers", "might", "move", "them", "to", "document", ".", "head", "*", "/", "var", "FORCE_BODY", "=", "false", ";", "/", "*", "Decide", "if", "a", "DOM", "`", "HTMLBodyElement", "`", "should", "be", "returned", ",", "instead", "of", "a", "html", "string", ".", "*", "If", "`", "WHOLE_DOCUMENT", "`", "is", "enabled", "a", "`", "HTMLHtmlElement", "`", "will", "be", "returned", "instead", "*", "/", "var", "RETURN_DOM", "=", "false", ";", "/", "*", "Decide", "if", "a", "DOM", "`", "DocumentFragment", "`", "should", "be", "returned", ",", "instead", "of", "a", "html", "string", "*", "/", "var", "RETURN_DOM_FRAGMENT", "=", "false", ";", "/", "*", "If", "`", "RETURN_DOM", "`", "or", "`", "RETURN_DOM_FRAGMENT", "`", "is", "enabled", ",", "decide", "if", "the", "returned", "DOM", "*", "`", "Node", "`", "is", "imported", "into", "the", "current", "`", "Document", "`", ".", "If", "this", "flag", "is", "not", "enabled", "the", "*", "`", "Node", "`", "will", "belong", "(", "its", "ownerDocument", ")", "to", "a", "fresh", "`", "HTMLDocument", "`", ",", "created", "by", "*", "DOMPurify", ".", "*", "/", "var", "RETURN_DOM_IMPORT", "=", "false", ";", "/", "*", "Output", "should", "be", "free", "from", "DOM", "clobbering", "attacks", "?", "*", "/", "var", "SANITIZE_DOM", "=", "true", ";", "/", "*", "Keep", "element", "content", "when", "removing", "element", "?", "*", "/", "var", "KEEP_CONTENT", "=", "true", ";", "/", "*", "If", "a", "`", "Node", "`", "is", "passed", "to", "sanitize", "(", "),", "then", "performs", "sanitization", "in", "-", "place", "instead", "*", "of", "importing", "it", "into", "a", "new", "Document", "and", "returning", "a", "sanitized", "copy", "*", "/", "var", "IN_PLACE", "=", "false", ";", "/", "*", "Allow", "usage", "of", "profiles", "like", "html", ",", "svg", "and", "mathMl", "*", "/", "var", "USE_PROFILES", "=", "{", "};", "/", "*", "Tags", "to", "ignore", "content", "of", "when", "KEEP_CONTENT", "is", "true", "*", "/", "var", "FORBID_CONTENTS", "=", "addToSet", "(", "{}", ",", "[", "'", "audio", "'", ",", "'", "head", "'", ",", "'", "math", "'", ",", "'", "script", "'", ",", "'", "style", "'", ",", "'", "template", "'", ",", "'", "svg", "'", ",", "'", "video", "'", "])", ";", "/", "*", "Tags", "that", "are", "safe", "for", "data", ":", "URIs", "*", "/", "var", "DATA_URI_TAGS", "=", "addToSet", "(", "{}", ",", "[", "'", "audio", "'", ",", "'", "video", "'", ",", "'", "img", "'", ",", "'", "source", "'", ",", "'", "image", "'", "])", ";", "/", "*", "Attributes", "safe", "for", "values", "like", "\"", "javascript", ":", "\"", "*", "/", "var", "URI_SAFE_ATTRIBUTES", "=", "addToSet", "(", "{}", ",", "[", "'", "alt", "'", ",", "'", "class", "'", ",", "'", "for", "'", ",", "'", "id", "'", ",", "'", "label", "'", ",", "'", "name", "'", ",", "'", "pattern", "'", ",", "'", "placeholder", "'", ",", "'", "summary", "'", ",", "'", "title", "'", ",", "'", "value", "'", ",", "'", "style", "'", ",", "'", "xmlns", "'", "])", ";", "/", "*", "Keep", "a", "reference", "to", "config", "to", "pass", "to", "hooks", "*", "/", "var", "CONFIG", "=", "null", ";", "/", "*", "Ideally", ",", "do", "not", "touch", "anything", "below", "this", "line", "*", "/", "/", "*", "______________________________________________", "*", "/", "var", "formElement", "=", "document", ".", "createElement", "(", "'", "form", "'", ");", "/", "**", "*", "_parseConfig", "*", "*", "@", "param", "{", "Object", "}", "cfg", "optional", "config", "literal", "*", "/", "/", "/", "eslint", "-", "disable", "-", "next", "-", "line", "complexity", "var", "_parseConfig", "=", "function", "_parseConfig", "(", "cfg", ")", "{", "/", "*", "Shield", "configuration", "object", "from", "tampering", "*", "/", "if", "(", "(", "typeof", "cfg", "=", "==", "'", "undefined", "'", "?", "'", "undefined", "'", ":", "_typeof", "(", "cfg", ")", ")", "!", "==", "'", "object", "'", ")", "{", "cfg", "=", "{", "};", "}", "/", "*", "Set", "configuration", "parameters", "*", "/", "ALLOWED_TAGS", "=", "'", "ALLOWED_TAGS", "'", "in", "cfg", "?", "addToSet", "(", "{}", ",", "cfg", ".", "ALLOWED_TAGS", ")", ":", "DEFAULT_ALLOWED_TAGS", ";", "ALLOWED_ATTR", "=", "'", "ALLOWED_ATTR", "'", "in", "cfg", "?", "addToSet", "(", "{}", ",", "cfg", ".", "ALLOWED_ATTR", ")", ":", "DEFAULT_ALLOWED_ATTR", ";", "FORBID_TAGS", "=", "'", "FORBID_TAGS", "'", "in", "cfg", "?", "addToSet", "(", "{}", ",", "cfg", ".", "FORBID_TAGS", ")", ":", "{", "};", "FORBID_ATTR", "=", "'", "FORBID_ATTR", "'", "in", "cfg", "?", "addToSet", "(", "{}", ",", "cfg", ".", "FORBID_ATTR", ")", ":", "{", "};", "USE_PROFILES", "=", "'", "USE_PROFILES", "'", "in", "cfg", "?", "cfg", ".", "USE_PROFILES", ":", "false", ";", "ALLOW_ARIA_ATTR", "=", "cfg", ".", "ALLOW_ARIA_ATTR", "!", "==", "false", ";", "/", "/", "Default", "true", "ALLOW_DATA_ATTR", "=", "cfg", ".", "ALLOW_DATA_ATTR", "!", "==", "false", ";", "/", "/", "Default", "true", "ALLOW_UNKNOWN_PROTOCOLS", "=", "cfg", ".", "ALLOW_UNKNOWN_PROTOCOLS", "|", "|", "false", ";", "/", "/", "Default", "false", "SAFE_FOR_JQUERY", "=", "cfg", ".", "SAFE_FOR_JQUERY", "|", "|", "false", ";", "/", "/", "Default", "false", "SAFE_FOR_TEMPLATES", "=", "cfg", ".", "SAFE_FOR_TEMPLATES", "|", "|", "false", ";", "/", "/", "Default", "false", "WHOLE_DOCUMENT", "=", "cfg", ".", "WHOLE_DOCUMENT", "|", "|", "false", ";", "/", "/", "Default", "false", "RETURN_DOM", "=", "cfg", ".", "RETURN_DOM", "|", "|", "false", ";", "/", "/", "Default", "false", "RETURN_DOM_FRAGMENT", "=", "cfg", ".", "RETURN_DOM_FRAGMENT", "|", "|", "false", ";", "/", "/", "Default", "false", "RETURN_DOM_IMPORT", "=", "cfg", ".", "RETURN_DOM_IMPORT", "|", "|", "false", ";", "/", "/", "Default", "false", "FORCE_BODY", "=", "cfg", ".", "FORCE_BODY", "|", "|", "false", ";", "/", "/", "Default", "false", "SANITIZE_DOM", "=", "cfg", ".", "SANITIZE_DOM", "!", "==", "false", ";", "/", "/", "Default", "true", "KEEP_CONTENT", "=", "cfg", ".", "KEEP_CONTENT", "!", "==", "false", ";", "/", "/", "Default", "true", "IN_PLACE", "=", "cfg", ".", "IN_PLACE", "|", "|", "false", ";", "/", "/", "Default", "false", "IS_ALLOWED_URI", "$", "$", "1", "=", "cfg", ".", "ALLOWED_URI_REGEXP", "|", "|", "IS_ALLOWED_URI", "$", "$", "1", ";", "if", "(", "SAFE_FOR_TEMPLATES", ")", "{", "ALLOW_DATA_ATTR", "=", "false", ";", "}", "if", "(", "RETURN_DOM_FRAGMENT", ")", "{", "RETURN_DOM", "=", "true", ";", "}", "/", "*", "Parse", "profile", "info", "*", "/", "if", "(", "USE_PROFILES", ")", "{", "ALLOWED_TAGS", "=", "addToSet", "(", "{}", ",", "[", "].", "concat", "(", "_toConsumableArray", "(", "text", ")", "))", ";", "ALLOWED_ATTR", "=", "[", "];", "if", "(", "USE_PROFILES", ".", "html", "=", "==", "true", ")", "{", "addToSet", "(", "ALLOWED_TAGS", ",", "html", ")", ";", "addToSet", "(", "ALLOWED_ATTR", ",", "html", "$", "1", ")", ";", "}", "if", "(", "USE_PROFILES", ".", "svg", "=", "==", "true", ")", "{", "addToSet", "(", "ALLOWED_TAGS", ",", "svg", ")", ";", "addToSet", "(", "ALLOWED_ATTR", ",", "svg", "$", "1", ")", ";", "addToSet", "(", "ALLOWED_ATTR", ",", "xml", ")", ";", "}", "if", "(", "USE_PROFILES", ".", "svgFilters", "=", "==", "true", ")", "{", "addToSet", "(", "ALLOWED_TAGS", ",", "svgFilters", ")", ";", "addToSet", "(", "ALLOWED_ATTR", ",", "svg", "$", "1", ")", ";", "addToSet", "(", "ALLOWED_ATTR", ",", "xml", ")", ";", "}", "if", "(", "USE_PROFILES", ".", "mathMl", "=", "==", "true", ")", "{", "addToSet", "(", "ALLOWED_TAGS", ",", "mathMl", ")", ";", "addToSet", "(", "ALLOWED_ATTR", ",", "mathMl", "$", "1", ")", ";", "addToSet", "(", "ALLOWED_ATTR", ",", "xml", ")", ";", "}", "}", "/", "*", "Merge", "configuration", "parameters", "*", "/", "if", "(", "cfg", ".", "ADD_TAGS", ")", "{", "if", "(", "ALLOWED_TAGS", "=", "==", "DEFAULT_ALLOWED_TAGS", ")", "{", "ALLOWED_TAGS", "=", "clone", "(", "ALLOWED_TAGS", ")", ";", "}", "addToSet", "(", "ALLOWED_TAGS", ",", "cfg", ".", "ADD_TAGS", ")", ";", "}", "if", "(", "cfg", ".", "ADD_ATTR", ")", "{", "if", "(", "ALLOWED_ATTR", "=", "==", "DEFAULT_ALLOWED_ATTR", ")", "{", "ALLOWED_ATTR", "=", "clone", "(", "ALLOWED_ATTR", ")", ";", "}", "addToSet", "(", "ALLOWED_ATTR", ",", "cfg", ".", "ADD_ATTR", ")", ";", "}", "if", "(", "cfg", ".", "ADD_URI_SAFE_ATTR", ")", "{", "addToSet", "(", "URI_SAFE_ATTRIBUTES", ",", "cfg", ".", "ADD_URI_SAFE_ATTR", ")", ";", "}", "/", "*", "Add", "#", "text", "in", "case", "KEEP_CONTENT", "is", "set", "to", "true", "*", "/", "if", "(", "KEEP_CONTENT", ")", "{", "ALLOWED_TAGS", "[", "'#", "text", "'", "]", "=", "true", ";", "}", "/", "*", "Add", "html", ",", "head", "and", "body", "to", "ALLOWED_TAGS", "in", "case", "WHOLE_DOCUMENT", "is", "true", "*", "/", "if", "(", "WHOLE_DOCUMENT", ")", "{", "addToSet", "(", "ALLOWED_TAGS", ",", "[", "'", "html", "'", ",", "'", "head", "'", ",", "'", "body", "'", "])", ";", "}", "/", "*", "Add", "tbody", "to", "ALLOWED_TAGS", "in", "case", "tables", "are", "permitted", ",", "see", "#", "286", "*", "/", "if", "(", "ALLOWED_TAGS", ".", "table", ")", "{", "addToSet", "(", "ALLOWED_TAGS", ",", "[", "'", "tbody", "'", "])", ";", "}", "/", "/", "Prevent", "further", "manipulation", "of", "configuration", ".", "/", "/", "Not", "available", "in", "IE8", ",", "Safari", "5", ",", "etc", ".", "if", "(", "Object", "&", "&", "'", "freeze", "'", "in", "Object", ")", "{", "Object", ".", "freeze", "(", "cfg", ")", ";", "}", "CONFIG", "=", "cfg", ";", "}", ";", "/", "**", "*", "_forceRemove", "*", "*", "@", "param", "{", "Node", "}", "node", "a", "DOM", "node", "*", "/", "var", "_forceRemove", "=", "function", "_forceRemove", "(", "node", ")", "{", "DOMPurify", ".", "removed", ".", "push", "(", "{", "element", ":", "node", "}", ");", "try", "{", "node", ".", "parentNode", ".", "removeChild", "(", "node", ")", ";", "}", "catch", "(", "err", ")", "{", "node", ".", "outerHTML", "=", "'", "';", "}", "}", ";", "/", "**", "*", "_removeAttribute", "*", "*", "@", "param", "{", "String", "}", "name", "an", "Attribute", "name", "*", "@", "param", "{", "Node", "}", "node", "a", "DOM", "node", "*", "/", "var", "_removeAttribute", "=", "function", "_removeAttribute", "(", "name", ",", "node", ")", "{", "try", "{", "DOMPurify", ".", "removed", ".", "push", "(", "{", "attribute", ":", "node", ".", "getAttributeNode", "(", "name", ")", ",", "from", ":", "node", "}", ");", "}", "catch", "(", "err", ")", "{", "DOMPurify", ".", "removed", ".", "push", "(", "{", "attribute", ":", "null", ",", "from", ":", "node", "}", ");", "}", "node", ".", "removeAttribute", "(", "name", ")", ";", "}", ";", "/", "**", "*", "_initDocument", "*", "*", "@", "param", "{", "String", "}", "dirty", "a", "string", "of", "dirty", "markup", "*", "@", "return", "{", "Document", "}", "a", "DOM", ",", "filled", "with", "the", "dirty", "markup", "*", "/", "var", "_initDocument", "=", "function", "_initDocument", "(", "dirty", ")", "{", "/", "*", "Create", "a", "HTML", "document", "*", "/", "var", "doc", "=", "void", "0", ";", "if", "(", "FORCE_BODY", ")", "{", "dirty", "=", "'", "<", "remove", ">", "</", "remove", ">", "'", "+", "dirty", ";", "}", "/", "*", "Use", "DOMParser", "to", "workaround", "Firefox", "bug", "(", "see", "comment", "below", ")", "*", "/", "if", "(", "useDOMParser", ")", "{", "try", "{", "doc", "=", "new", "DOMParser", "(", ").", "parseFromString", "(", "dirty", ",", "'", "text", "/", "html", "'", ");", "}", "catch", "(", "err", ")", "{", "}", "}", "/", "*", "Remove", "title", "to", "fix", "an", "mXSS", "bug", "in", "older", "MS", "Edge", "*", "/", "if", "(", "removeTitle", ")", "{", "addToSet", "(", "FORBID_TAGS", ",", "[", "'", "title", "'", "])", ";", "}", "/", "*", "Otherwise", "use", "createHTMLDocument", ",", "because", "DOMParser", "is", "unsafe", "in", "Safari", "(", "see", "comment", "below", ")", "*", "/", "if", "(", "!", "doc", "|", "|", "!", "doc", ".", "documentElement", ")", "{", "doc", "=", "implementation", ".", "createHTMLDocument", "(", "''", ");", "var", "_doc", "=", "doc", ",", "body", "=", "_doc", ".", "body", ";", "body", ".", "parentNode", ".", "removeChild", "(", "body", ".", "parentNode", ".", "firstElementChild", ")", ";", "body", ".", "outerHTML", "=", "dirty", ";", "}", "/", "*", "Work", "on", "whole", "document", "or", "just", "its", "body", "*", "/", "return", "getElementsByTagName", ".", "call", "(", "doc", ",", "WHOLE_DOCUMENT", "?", "'", "html", "'", ":", "'", "body", "'", ")[", "0", "]", ";", "}", ";", "/", "/", "Firefox", "uses", "a", "different", "parser", "for", "innerHTML", "rather", "than", "/", "/", "DOMParser", "(", "see", "https", ":", "//", "bugzilla", ".", "mozilla", ".", "org", "/", "show_bug", ".", "cgi", "?", "id", "=", "1205631", ")", "/", "/", "which", "means", "that", "you", "*", "must", "*", "use", "DOMParser", ",", "otherwise", "the", "output", "may", "/", "/", "not", "be", "safe", "if", "used", "in", "a", "document", ".", "write", "context", "later", ".", "/", "/", "/", "/", "So", "we", "feature", "detect", "the", "Firefox", "bug", "and", "use", "the", "DOMParser", "if", "necessary", ".", "/", "/", "/", "/", "MS", "Edge", ",", "in", "older", "versions", ",", "is", "affected", "by", "an", "mXSS", "behavior", ".", "The", "second", "/", "/", "check", "tests", "for", "the", "behavior", "and", "fixes", "it", "if", "necessary", ".", "if", "(", "DOMPurify", ".", "isSupported", ")", "{", "(", "function", "(", ")", "{", "try", "{", "var", "doc", "=", "_initDocument", "(", "'<", "svg", ">", "<", "p", ">", "<", "style", ">", "<", "img", "src", "=", "\"<", "/", "style", ">", "<", "img", "src", "=", "x", "onerror", "=", "alert", "(", "1", ")", "//", "\">", "')", ";", "if", "(", "doc", ".", "querySelector", "(", "'", "svg", "img", "'", "))", "{", "useDOMParser", "=", "true", ";", "}", "}", "catch", "(", "err", ")", "{", "}", "}", ")(", ");", "(", "function", "(", ")", "{", "try", "{", "var", "doc", "=", "_initDocument", "(", "'<", "x", "/", "><", "title", ">", "&", "lt", ";", "/", "title", "&", "gt", ";", "&", "lt", ";", "img", "&", "gt", ";", "')", ";", "if", "(", "doc", ".", "querySelector", "(", "'", "title", "'", ").", "textContent", ".", "match", "(", "/<", "\\/", "title", "/", "))", "{", "removeTitle", "=", "true", ";", "}", "}", "catch", "(", "err", ")", "{", "}", "}", ")(", ");", "}", "/", "**", "*", "_createIterator", "*", "*", "@", "param", "{", "Document", "}", "root", "document", "/", "fragment", "to", "create", "iterator", "for", "*", "@", "return", "{", "Iterator", "}", "iterator", "instance", "*", "/", "var", "_createIterator", "=", "function", "_createIterator", "(", "root", ")", "{", "return", "createNodeIterator", ".", "call", "(", "root", ".", "ownerDocument", "|", "|", "root", ",", "root", ",", "NodeFilter", ".", "SHOW_ELEMENT", "|", "NodeFilter", ".", "SHOW_COMMENT", "|", "NodeFilter", ".", "SHOW_TEXT", ",", "function", "(", ")", "{", "return", "NodeFilter", ".", "FILTER_ACCEPT", ";", "}", ",", "false", ")", ";", "}", ";", "/", "**", "*", "_isClobbered", "*", "*", "@", "param", "{", "Node", "}", "elm", "element", "to", "check", "for", "clobbering", "attacks", "*", "@", "return", "{", "Boolean", "}", "true", "if", "clobbered", ",", "false", "if", "safe", "*", "/", "var", "_isClobbered", "=", "function", "_isClobbered", "(", "elm", ")", "{", "if", "(", "elm", "instanceof", "Text", "|", "|", "elm", "instanceof", "Comment", ")", "{", "return", "false", ";", "}", "if", "(", "typeof", "elm", ".", "nodeName", "!", "==", "'", "string", "'", "|", "|", "typeof", "elm", ".", "textContent", "!", "==", "'", "string", "'", "|", "|", "typeof", "elm", ".", "removeChild", "!", "==", "'", "function", "'", "|", "|", "!", "(", "elm", ".", "attributes", "instanceof", "NamedNodeMap", ")", "|", "|", "typeof", "elm", ".", "removeAttribute", "!", "==", "'", "function", "'", "|", "|", "typeof", "elm", ".", "setAttribute", "!", "==", "'", "function", "'", ")", "{", "return", "true", ";", "}", "return", "false", ";", "}", ";", "/", "**", "*", "_isNode", "*", "*", "@", "param", "{", "Node", "}", "obj", "object", "to", "check", "whether", "it", "'", "s", "a", "DOM", "node", "*", "@", "return", "{", "Boolean", "}", "true", "is", "object", "is", "a", "DOM", "node", "*", "/", "var", "_isNode", "=", "function", "_isNode", "(", "obj", ")", "{", "return", "(", "typeof", "Node", "=", "==", "'", "undefined", "'", "?", "'", "undefined", "'", ":", "_typeof", "(", "Node", ")", ")", "=", "==", "'", "object", "'", "?", "obj", "instanceof", "Node", ":", "obj", "&", "&", "(", "typeof", "obj", "=", "==", "'", "undefined", "'", "?", "'", "undefined", "'", ":", "_typeof", "(", "obj", ")", ")", "=", "==", "'", "object", "'", "&", "&", "typeof", "obj", ".", "nodeType", "=", "==", "'", "number", "'", "&", "&", "typeof", "obj", ".", "nodeName", "=", "==", "'", "string", "'", ";", "}", ";", "/", "**", "*", "_executeHook", "*", "Execute", "user", "configurable", "hooks", "*", "*", "@", "param", "{", "String", "}", "entryPoint", "Name", "of", "the", "hook", "'", "s", "entry", "point", "*", "@", "param", "{", "Node", "}", "currentNode", "node", "to", "work", "on", "with", "the", "hook", "*", "@", "param", "{", "Object", "}", "data", "additional", "hook", "parameters", "*", "/", "var", "_executeHook", "=", "function", "_executeHook", "(", "entryPoint", ",", "currentNode", ",", "data", ")", "{", "if", "(", "!", "hooks", "[", "entryPoint", "]", ")", "{", "return", ";", "}", "hooks", "[", "entryPoint", "]", ".", "forEach", "(", "function", "(", "hook", ")", "{", "hook", ".", "call", "(", "DOMPurify", ",", "currentNode", ",", "data", ",", "CONFIG", ")", ";", "}", ");", "}", ";", "/", "**", "*", "_sanitizeElements", "*", "*", "@", "protect", "nodeName", "*", "@", "protect", "textContent", "*", "@", "protect", "removeChild", "*", "*", "@", "param", "{", "Node", "}", "currentNode", "to", "check", "for", "permission", "to", "exist", "*", "@", "return", "{", "Boolean", "}", "true", "if", "node", "was", "killed", ",", "false", "if", "left", "alive", "*", "/", "var", "_sanitizeElements", "=", "function", "_sanitizeElements", "(", "currentNode", ")", "{", "var", "content", "=", "void", "0", ";", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "_executeHook", "(", "'", "beforeSanitizeElements", "'", ",", "currentNode", ",", "null", ")", ";", "/", "*", "Check", "if", "element", "is", "clobbered", "or", "can", "clobber", "*", "/", "if", "(", "_isClobbered", "(", "currentNode", ")", ")", "{", "_forceRemove", "(", "currentNode", ")", ";", "return", "true", ";", "}", "/", "*", "Now", "let", "'", "s", "check", "the", "element", "'", "s", "type", "and", "name", "*", "/", "var", "tagName", "=", "currentNode", ".", "nodeName", ".", "toLowerCase", "(", ");", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "_executeHook", "(", "'", "uponSanitizeElement", "'", ",", "currentNode", ",", "{", "tagName", ":", "tagName", ",", "allowedTags", ":", "ALLOWED_TAGS", "}", ");", "/", "*", "Remove", "element", "if", "anything", "forbids", "its", "presence", "*", "/", "if", "(", "!", "ALLOWED_TAGS", "[", "tagName", "]", "|", "|", "FORBID_TAGS", "[", "tagName", "]", ")", "{", "/", "*", "Keep", "content", "except", "for", "black", "-", "listed", "elements", "*", "/", "if", "(", "KEEP_CONTENT", "&", "&", "!", "FORBID_CONTENTS", "[", "tagName", "]", "&", "&", "typeof", "currentNode", ".", "insertAdjacentHTML", "=", "==", "'", "function", "'", ")", "{", "try", "{", "currentNode", ".", "insertAdjacentHTML", "(", "'", "AfterEnd", "'", ",", "currentNode", ".", "innerHTML", ")", ";", "}", "catch", "(", "err", ")", "{", "}", "}", "_forceRemove", "(", "currentNode", ")", ";", "return", "true", ";", "}", "/", "*", "Convert", "markup", "to", "cover", "jQuery", "behavior", "*", "/", "if", "(", "SAFE_FOR_JQUERY", "&", "&", "!", "currentNode", ".", "firstElementChild", "&", "&", "(", "!", "currentNode", ".", "content", "|", "|", "!", "currentNode", ".", "content", ".", "firstElementChild", ")", "&", "&", "/", "</", "g", ".", "test", "(", "currentNode", ".", "textContent", ")", ")", "{", "DOMPurify", ".", "removed", ".", "push", "(", "{", "element", ":", "currentNode", ".", "cloneNode", "(", ")", "}", ");", "if", "(", "currentNode", ".", "innerHTML", ")", "{", "currentNode", ".", "innerHTML", "=", "currentNode", ".", "innerHTML", ".", "replace", "(", "/<", "/", "g", ",", "'", "&", "lt", ";", "')", ";", "}", "else", "{", "currentNode", ".", "innerHTML", "=", "currentNode", ".", "textContent", ".", "replace", "(", "/<", "/", "g", ",", "'", "&", "lt", ";", "')", ";", "}", "}", "/", "*", "Sanitize", "element", "content", "to", "be", "template", "-", "safe", "*", "/", "if", "(", "SAFE_FOR_TEMPLATES", "&", "&", "currentNode", ".", "nodeType", "=", "==", "3", ")", "{", "/", "*", "Get", "the", "element", "'", "s", "text", "content", "*", "/", "content", "=", "currentNode", ".", "textContent", ";", "content", "=", "content", ".", "replace", "(", "MUSTACHE_EXPR", "$", "$", "1", ",", "'", "'", ");", "content", "=", "content", ".", "replace", "(", "ERB_EXPR", "$", "$", "1", ",", "'", "'", ");", "if", "(", "currentNode", ".", "textContent", "!", "==", "content", ")", "{", "DOMPurify", ".", "removed", ".", "push", "(", "{", "element", ":", "currentNode", ".", "cloneNode", "(", ")", "}", ");", "currentNode", ".", "textContent", "=", "content", ";", "}", "}", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "_executeHook", "(", "'", "afterSanitizeElements", "'", ",", "currentNode", ",", "null", ")", ";", "return", "false", ";", "}", ";", "/", "**", "*", "_isValidAttribute", "*", "*", "@", "param", "{", "string", "}", "lcTag", "Lowercase", "tag", "name", "of", "containing", "element", ".", "*", "@", "param", "{", "string", "}", "lcName", "Lowercase", "attribute", "name", ".", "*", "@", "param", "{", "string", "}", "value", "Attribute", "value", ".", "*", "@", "return", "{", "Boolean", "}", "Returns", "true", "if", "`", "value", "`", "is", "valid", ",", "otherwise", "false", ".", "*", "/", "var", "_isValidAttribute", "=", "function", "_isValidAttribute", "(", "lcTag", ",", "lcName", ",", "value", ")", "{", "/", "*", "Make", "sure", "attribute", "cannot", "clobber", "*", "/", "if", "(", "SANITIZE_DOM", "&", "&", "(", "lcName", "=", "==", "'", "id", "'", "|", "|", "lcName", "=", "==", "'", "name", "'", ")", "&", "&", "(", "value", "in", "document", "|", "|", "value", "in", "formElement", ")", ")", "{", "return", "false", ";", "}", "/", "*", "Sanitize", "attribute", "content", "to", "be", "template", "-", "safe", "*", "/", "if", "(", "SAFE_FOR_TEMPLATES", ")", "{", "value", "=", "value", ".", "replace", "(", "MUSTACHE_EXPR", "$", "$", "1", ",", "'", "'", ");", "value", "=", "value", ".", "replace", "(", "ERB_EXPR", "$", "$", "1", ",", "'", "'", ");", "}", "/", "*", "Allow", "valid", "data", "-", "*", "attributes", ":", "At", "least", "one", "character", "after", "\"", "-\"", "(", "https", ":", "//", "html", ".", "spec", ".", "whatwg", ".", "org", "/", "multipage", "/", "dom", ".", "html", "#", "embedding", "-", "custom", "-", "non", "-", "visible", "-", "data", "-", "with", "-", "the", "-", "data", "-", "*-", "attributes", ")", "XML", "-", "compatible", "(", "https", ":", "//", "html", ".", "spec", ".", "whatwg", ".", "org", "/", "multipage", "/", "infrastructure", ".", "html", "#", "xml", "-", "compatible", "and", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "xml", "/", "#", "d0e804", ")", "We", "don", "'", "t", "need", "to", "check", "the", "value", ";", "it", "'", "s", "always", "URI", "safe", ".", "*", "/", "if", "(", "ALLOW_DATA_ATTR", "&", "&", "DATA_ATTR", "$", "$", "1", ".", "test", "(", "lcName", ")", ")", "{", "/", "/", "This", "attribute", "is", "safe", "}", "else", "if", "(", "ALLOW_ARIA_ATTR", "&", "&", "ARIA_ATTR", "$", "$", "1", ".", "test", "(", "lcName", ")", ")", "{", "/", "/", "This", "attribute", "is", "safe", "/", "*", "Otherwise", ",", "check", "the", "name", "is", "permitted", "*", "/", "}", "else", "if", "(", "!", "ALLOWED_ATTR", "[", "lcName", "]", "|", "|", "FORBID_ATTR", "[", "lcName", "]", ")", "{", "return", "false", ";", "/", "*", "Check", "value", "is", "safe", ".", "First", ",", "is", "attr", "inert", "?", "If", "so", ",", "is", "safe", "*", "/", "}", "else", "if", "(", "URI_SAFE_ATTRIBUTES", "[", "lcName", "]", ")", "{", "/", "/", "This", "attribute", "is", "safe", "/", "*", "Check", "no", "script", ",", "data", "or", "unknown", "possibly", "unsafe", "URI", "unless", "we", "know", "URI", "values", "are", "safe", "for", "that", "attribute", "*", "/", "}", "else", "if", "(", "IS_ALLOWED_URI", "$", "$", "1", ".", "test", "(", "value", ".", "replace", "(", "ATTR_WHITESPACE", "$", "$", "1", ",", "'", "')", "))", "{", "/", "/", "This", "attribute", "is", "safe", "/", "*", "Keep", "image", "data", "URIs", "alive", "if", "src", "/", "xlink", ":", "href", "is", "allowed", "*", "/", "/", "*", "Further", "prevent", "gadget", "XSS", "for", "dynamically", "built", "script", "tags", "*", "/", "}", "else", "if", "(", "(", "lcName", "=", "==", "'", "src", "'", "|", "|", "lcName", "=", "==", "'", "xlink", ":", "href", "'", ")", "&", "&", "lcTag", "!", "==", "'", "script", "'", "&", "&", "value", ".", "indexOf", "(", "'", "data", ":", "')", "=", "==", "0", "&", "&", "DATA_URI_TAGS", "[", "lcTag", "]", ")", "{", "/", "/", "This", "attribute", "is", "safe", "/", "*", "Allow", "unknown", "protocols", ":", "This", "provides", "support", "for", "links", "that", "are", "handled", "by", "protocol", "handlers", "which", "may", "be", "unknown", "ahead", "of", "time", ",", "e", ".", "g", ".", "fb", ":", ",", "spotify", ":", "*", "/", "}", "else", "if", "(", "ALLOW_UNKNOWN_PROTOCOLS", "&", "&", "!", "IS_SCRIPT_OR_DATA", "$", "$", "1", ".", "test", "(", "value", ".", "replace", "(", "ATTR_WHITESPACE", "$", "$", "1", ",", "'", "')", "))", "{", "/", "/", "This", "attribute", "is", "safe", "/", "*", "Check", "for", "binary", "attributes", "*", "/", "/", "/", "eslint", "-", "disable", "-", "next", "-", "line", "no", "-", "negated", "-", "condition", "}", "else", "if", "(", "!", "value", ")", "{", "/", "/", "Binary", "attributes", "are", "safe", "at", "this", "point", "/", "*", "Anything", "else", ",", "presume", "unsafe", ",", "do", "not", "add", "it", "back", "*", "/", "}", "else", "{", "return", "false", ";", "}", "return", "true", ";", "}", ";", "/", "**", "*", "_sanitizeAttributes", "*", "*", "@", "protect", "attributes", "*", "@", "protect", "nodeName", "*", "@", "protect", "removeAttribute", "*", "@", "protect", "setAttribute", "*", "*", "@", "param", "{", "Node", "}", "node", "to", "sanitize", "*", "/", "/", "/", "eslint", "-", "disable", "-", "next", "-", "line", "complexity", "var", "_sanitizeAttributes", "=", "function", "_sanitizeAttributes", "(", "currentNode", ")", "{", "var", "attr", "=", "void", "0", ";", "var", "value", "=", "void", "0", ";", "var", "lcName", "=", "void", "0", ";", "var", "idAttr", "=", "void", "0", ";", "var", "l", "=", "void", "0", ";", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "_executeHook", "(", "'", "beforeSanitizeAttributes", "'", ",", "currentNode", ",", "null", ")", ";", "var", "attributes", "=", "currentNode", ".", "attributes", ";", "/", "*", "Check", "if", "we", "have", "attributes", ";", "if", "not", "we", "might", "have", "a", "text", "node", "*", "/", "if", "(", "!", "attributes", ")", "{", "return", ";", "}", "var", "hookEvent", "=", "{", "attrName", ":", "'", "',", "attrValue", ":", "'", "',", "keepAttr", ":", "true", ",", "allowedAttributes", ":", "ALLOWED_ATTR", "}", ";", "l", "=", "attributes", ".", "length", ";", "/", "*", "Go", "backwards", "over", "all", "attributes", ";", "safely", "remove", "bad", "ones", "*", "/", "while", "(", "l", "-", "-)", "{", "attr", "=", "attributes", "[", "l", "]", ";", "var", "_attr", "=", "attr", ",", "name", "=", "_attr", ".", "name", ",", "namespaceURI", "=", "_attr", ".", "namespaceURI", ";", "value", "=", "attr", ".", "value", ".", "trim", "(", ");", "lcName", "=", "name", ".", "toLowerCase", "(", ");", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "hookEvent", ".", "attrName", "=", "lcName", ";", "hookEvent", ".", "attrValue", "=", "value", ";", "hookEvent", ".", "keepAttr", "=", "true", ";", "_executeHook", "(", "'", "uponSanitizeAttribute", "'", ",", "currentNode", ",", "hookEvent", ")", ";", "value", "=", "hookEvent", ".", "attrValue", ";", "/", "*", "Remove", "attribute", "*", "/", "/", "/", "Safari", "(", "iOS", "+", "Mac", ")", ",", "last", "tested", "v8", ".", "0", ".", "5", ",", "crashes", "if", "you", "try", "to", "/", "/", "remove", "a", "\"", "name", "\"", "attribute", "from", "an", "<", "img", ">", "tag", "that", "has", "an", "\"", "id", "\"", "/", "/", "attribute", "at", "the", "time", ".", "if", "(", "lcName", "=", "==", "'", "name", "'", "&", "&", "currentNode", ".", "nodeName", "=", "==", "'", "IMG", "'", "&", "&", "attributes", ".", "id", ")", "{", "idAttr", "=", "attributes", ".", "id", ";", "attributes", "=", "Array", ".", "prototype", ".", "slice", ".", "apply", "(", "attributes", ")", ";", "_removeAttribute", "(", "'", "id", "'", ",", "currentNode", ")", ";", "_removeAttribute", "(", "name", ",", "currentNode", ")", ";", "if", "(", "attributes", ".", "indexOf", "(", "idAttr", ")", ">", "l", ")", "{", "currentNode", ".", "setAttribute", "(", "'", "id", "'", ",", "idAttr", ".", "value", ")", ";", "}", "}", "else", "if", "(", "/", "/", "This", "works", "around", "a", "bug", "in", "Safari", ",", "where", "input", "[", "type", "=", "file", "]", "/", "/", "cannot", "be", "dynamically", "set", "after", "type", "has", "been", "removed", "currentNode", ".", "nodeName", "=", "==", "'", "INPUT", "'", "&", "&", "lcName", "=", "==", "'", "type", "'", "&", "&", "value", "=", "==", "'", "file", "'", "&", "&", "(", "ALLOWED_ATTR", "[", "lcName", "]", "|", "|", "!", "FORBID_ATTR", "[", "lcName", "]", "))", "{", "continue", ";", "}", "else", "{", "/", "/", "This", "avoids", "a", "crash", "in", "Safari", "v9", ".", "0", "with", "double", "-", "ids", ".", "/", "/", "The", "trick", "is", "to", "first", "set", "the", "id", "to", "be", "empty", "and", "then", "to", "/", "/", "remove", "the", "attribute", "if", "(", "name", "=", "==", "'", "id", "'", ")", "{", "currentNode", ".", "setAttribute", "(", "name", ",", "'", "')", ";", "}", "_removeAttribute", "(", "name", ",", "currentNode", ")", ";", "}", "/", "*", "Did", "the", "hooks", "approve", "of", "the", "attribute", "?", "*", "/", "if", "(", "!", "hookEvent", ".", "keepAttr", ")", "{", "continue", ";", "}", "/", "*", "Is", "`", "value", "`", "valid", "for", "this", "attribute", "?", "*", "/", "var", "lcTag", "=", "currentNode", ".", "nodeName", ".", "toLowerCase", "(", ");", "if", "(", "!", "_isValidAttribute", "(", "lcTag", ",", "lcName", ",", "value", ")", ")", "{", "continue", ";", "}", "/", "*", "Handle", "invalid", "data", "-", "*", "attribute", "set", "by", "try", "-", "catching", "it", "*", "/", "try", "{", "if", "(", "namespaceURI", ")", "{", "currentNode", ".", "setAttributeNS", "(", "namespaceURI", ",", "name", ",", "value", ")", ";", "}", "else", "{", "/", "*", "Fallback", "to", "setAttribute", "(", ")", "for", "browser", "-", "unrecognized", "namespaces", "e", ".", "g", ".", "\"", "x", "-", "schema", "\"", ".", "*", "/", "currentNode", ".", "setAttribute", "(", "name", ",", "value", ")", ";", "}", "DOMPurify", ".", "removed", ".", "pop", "(", ");", "}", "catch", "(", "err", ")", "{", "}", "}", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "_executeHook", "(", "'", "afterSanitizeAttributes", "'", ",", "currentNode", ",", "null", ")", ";", "}", ";", "/", "**", "*", "_sanitizeShadowDOM", "*", "*", "@", "param", "{", "DocumentFragment", "}", "fragment", "to", "iterate", "over", "recursively", "*", "/", "var", "_sanitizeShadowDOM", "=", "function", "_sanitizeShadowDOM", "(", "fragment", ")", "{", "var", "shadowNode", "=", "void", "0", ";", "var", "shadowIterator", "=", "_createIterator", "(", "fragment", ")", ";", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "_executeHook", "(", "'", "beforeSanitizeShadowDOM", "'", ",", "fragment", ",", "null", ")", ";", "while", "(", "shadowNode", "=", "shadowIterator", ".", "nextNode", "(", "))", "{", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "_executeHook", "(", "'", "uponSanitizeShadowNode", "'", ",", "shadowNode", ",", "null", ")", ";", "/", "*", "Sanitize", "tags", "and", "elements", "*", "/", "if", "(", "_sanitizeElements", "(", "shadowNode", ")", ")", "{", "continue", ";", "}", "/", "*", "Deep", "shadow", "DOM", "detected", "*", "/", "if", "(", "shadowNode", ".", "content", "instanceof", "DocumentFragment", ")", "{", "_sanitizeShadowDOM", "(", "shadowNode", ".", "content", ")", ";", "}", "/", "*", "Check", "attributes", ",", "sanitize", "if", "necessary", "*", "/", "_sanitizeAttributes", "(", "shadowNode", ")", ";", "}", "/", "*", "Execute", "a", "hook", "if", "present", "*", "/", "_executeHook", "(", "'", "afterSanitizeShadowDOM", "'", ",", "fragment", ",", "null", ")", ";", "}", ";", "/", "**", "*", "Sanitize", "*", "Public", "method", "providing", "core", "sanitation", "functionality", "*", "*", "@", "param", "{", "String", "|", "Node", "}", "dirty", "string", "or", "DOM", "node", "*", "@", "param", "{", "Object", "}", "configuration", "object", "*", "/", "/", "/", "eslint", "-", "disable", "-", "next", "-", "line", "complexity", "DOMPurify", ".", "sanitize", "=", "function", "(", "dirty", ",", "cfg", ")", "{", "var", "body", "=", "void", "0", ";", "var", "importedNode", "=", "void", "0", ";", "var", "currentNode", "=", "void", "0", ";", "var", "oldNode", "=", "void", "0", ";", "var", "returnNode", "=", "void", "0", ";", "/", "*", "Make", "sure", "we", "have", "a", "string", "to", "sanitize", ".", "DO", "NOT", "return", "early", ",", "as", "this", "will", "return", "the", "wrong", "type", "if", "the", "user", "has", "requested", "a", "DOM", "object", "rather", "than", "a", "string", "*", "/", "if", "(", "!", "dirty", ")", "{", "dirty", "=", "'", "<!", "--", ">'", ";", "}", "/", "*", "Stringify", ",", "in", "case", "dirty", "is", "an", "object", "*", "/", "if", "(", "typeof", "dirty", "!", "==", "'", "string", "'", "&", "&", "!", "_isNode", "(", "dirty", ")", ")", "{", "/", "/", "eslint", "-", "disable", "-", "next", "-", "line", "no", "-", "negated", "-", "condition", "if", "(", "typeof", "dirty", ".", "toString", "!", "==", "'", "function", "'", ")", "{", "throw", "new", "TypeError", "(", "'", "toString", "is", "not", "a", "function", "'", ");", "}", "else", "{", "dirty", "=", "dirty", ".", "toString", "(", ");", "if", "(", "typeof", "dirty", "!", "==", "'", "string", "'", ")", "{", "throw", "new", "TypeError", "(", "'", "dirty", "is", "not", "a", "string", ",", "aborting", "'", ");", "}", "}", "}", "/", "*", "Check", "we", "can", "run", ".", "Otherwise", "fall", "back", "or", "ignore", "*", "/", "if", "(", "!", "DOMPurify", ".", "isSupported", ")", "{", "if", "(", "_typeof", "(", "window", ".", "toStaticHTML", ")", "=", "==", "'", "object", "'", "|", "|", "typeof", "window", ".", "toStaticHTML", "=", "==", "'", "function", "'", ")", "{", "if", "(", "typeof", "dirty", "=", "==", "'", "string", "'", ")", "{", "return", "window", ".", "toStaticHTML", "(", "dirty", ")", ";", "}", "if", "(", "_isNode", "(", "dirty", ")", ")", "{", "return", "window", ".", "toStaticHTML", "(", "dirty", ".", "outerHTML", ")", ";", "}", "}", "return", "dirty", ";", "}", "/", "*", "Assign", "config", "vars", "*", "/", "if", "(", "!", "SET_CONFIG", ")", "{", "_parseConfig", "(", "cfg", ")", ";", "}", "/", "*", "Clean", "up", "removed", "elements", "*", "/", "DOMPurify", ".", "removed", "=", "[", "];", "if", "(", "IN_PLACE", ")", "{", "/", "*", "No", "special", "handling", "necessary", "for", "in", "-", "place", "sanitization", "*", "/", "}", "else", "if", "(", "dirty", "instanceof", "Node", ")", "{", "/", "*", "If", "dirty", "is", "a", "DOM", "element", ",", "append", "to", "an", "empty", "document", "to", "avoid", "elements", "being", "stripped", "by", "the", "parser", "*", "/", "body", "=", "_initDocument", "(", "'<", "!-", "->", "')", ";", "importedNode", "=", "body", ".", "ownerDocument", ".", "importNode", "(", "dirty", ",", "true", ")", ";", "if", "(", "importedNode", ".", "nodeType", "=", "==", "1", "&", "&", "importedNode", ".", "nodeName", "=", "==", "'", "BODY", "'", ")", "{", "/", "*", "Node", "is", "already", "a", "body", ",", "use", "as", "is", "*", "/", "body", "=", "importedNode", ";", "}", "else", "{", "body", ".", "appendChild", "(", "importedNode", ")", ";", "}", "}", "else", "{", "/", "*", "Exit", "directly", "if", "we", "have", "nothing", "to", "do", "*", "/", "if", "(", "!", "RETURN_DOM", "&", "&", "!", "WHOLE_DOCUMENT", "&", "&", "dirty", ".", "indexOf", "(", "'<", "')", "=", "==", "-", "1", ")", "{", "return", "dirty", ";", "}", "/", "*", "Initialize", "the", "document", "to", "work", "on", "*", "/", "body", "=", "_initDocument", "(", "dirty", ")", ";", "/", "*", "Check", "we", "have", "a", "DOM", "node", "from", "the", "data", "*", "/", "if", "(", "!", "body", ")", "{", "return", "RETURN_DOM", "?", "null", ":", "'", "';", "}", "}", "/", "*", "Remove", "first", "element", "node", "(", "ours", ")", "if", "FORCE_BODY", "is", "set", "*", "/", "if", "(", "body", "&", "&", "FORCE_BODY", ")", "{", "_forceRemove", "(", "body", ".", "firstChild", ")", ";", "}", "/", "*", "Get", "node", "iterator", "*", "/", "var", "nodeIterator", "=", "_createIterator", "(", "IN_PLACE", "?", "dirty", ":", "body", ")", ";", "/", "*", "Now", "start", "iterating", "over", "the", "created", "document", "*", "/", "while", "(", "currentNode", "=", "nodeIterator", ".", "nextNode", "(", "))", "{", "/", "*", "Fix", "IE", "'", "s", "strange", "behavior", "with", "manipulated", "textNodes", "#", "89", "*", "/", "if", "(", "currentNode", ".", "nodeType", "=", "==", "3", "&", "&", "currentNode", "=", "==", "oldNode", ")", "{", "continue", ";", "}", "/", "*", "Sanitize", "tags", "and", "elements", "*", "/", "if", "(", "_sanitizeElements", "(", "currentNode", ")", ")", "{", "continue", ";", "}", "/", "*", "Shadow", "DOM", "detected", ",", "sanitize", "it", "*", "/", "if", "(", "currentNode", ".", "content", "instanceof", "DocumentFragment", ")", "{", "_sanitizeShadowDOM", "(", "currentNode", ".", "content", ")", ";", "}", "/", "*", "Check", "attributes", ",", "sanitize", "if", "necessary", "*", "/", "_sanitizeAttributes", "(", "currentNode", ")", ";", "oldNode", "=", "currentNode", ";", "}", "/", "*", "If", "we", "sanitized", "`", "dirty", "`", "in", "-", "place", ",", "return", "it", ".", "*", "/", "if", "(", "IN_PLACE", ")", "{", "return", "dirty", ";", "}", "/", "*", "Return", "sanitized", "string", "or", "DOM", "*", "/", "if", "(", "RETURN_DOM", ")", "{", "if", "(", "RETURN_DOM_FRAGMENT", ")", "{", "returnNode", "=", "createDocumentFragment", ".", "call", "(", "body", ".", "ownerDocument", ")", ";", "while", "(", "body", ".", "firstChild", ")", "{", "returnNode", ".", "appendChild", "(", "body", ".", "firstChild", ")", ";", "}", "}", "else", "{", "returnNode", "=", "body", ";", "}", "if", "(", "RETURN_DOM_IMPORT", ")", "{", "/", "*", "AdoptNode", "(", ")", "is", "not", "used", "because", "internal", "state", "is", "not", "reset", "(", "e", ".", "g", ".", "the", "past", "names", "map", "of", "a", "HTMLFormElement", ")", ",", "this", "is", "safe", "in", "theory", "but", "we", "would", "rather", "not", "risk", "another", "attack", "vector", ".", "The", "state", "that", "is", "cloned", "by", "importNode", "(", ")", "is", "explicitly", "defined", "by", "the", "specs", ".", "*", "/", "returnNode", "=", "importNode", ".", "call", "(", "originalDocument", ",", "returnNode", ",", "true", ")", ";", "}", "return", "returnNode", ";", "}", "return", "WHOLE_DOCUMENT", "?", "body", ".", "outerHTML", ":", "body", ".", "innerHTML", ";", "}", ";", "/", "**", "*", "Public", "method", "to", "set", "the", "configuration", "once", "*", "setConfig", "*", "*", "@", "param", "{", "Object", "}", "cfg", "configuration", "object", "*", "/", "DOMPurify", ".", "setConfig", "=", "function", "(", "cfg", ")", "{", "_parseConfig", "(", "cfg", ")", ";", "SET_CONFIG", "=", "true", ";", "}", ";", "/", "**", "*", "Public", "method", "to", "remove", "the", "configuration", "*", "clearConfig", "*", "*", "/", "DOMPurify", ".", "clearConfig", "=", "function", "(", ")", "{", "CONFIG", "=", "null", ";", "SET_CONFIG", "=", "false", ";", "}", ";", "/", "**", "*", "Public", "method", "to", "check", "if", "an", "attribute", "value", "is", "valid", ".", "*", "Uses", "last", "set", "config", ",", "if", "any", ".", "Otherwise", ",", "uses", "config", "defaults", ".", "*", "isValidAttribute", "*", "*", "@", "param", "{", "string", "}", "tag", "Tag", "name", "of", "containing", "element", ".", "*", "@", "param", "{", "string", "}", "attr", "Attribute", "name", ".", "*", "@", "param", "{", "string", "}", "value", "Attribute", "value", ".", "*", "@", "return", "{", "Boolean", "}", "Returns", "true", "if", "`", "value", "`", "is", "valid", ".", "Otherwise", ",", "returns", "false", ".", "*", "/", "DOMPurify", ".", "isValidAttribute", "=", "function", "(", "tag", ",", "attr", ",", "value", ")", "{", "/", "*", "Initialize", "shared", "config", "vars", "if", "necessary", ".", "*", "/", "if", "(", "!", "CONFIG", ")", "{", "_parseConfig", "(", "{}", ");", "}", "var", "lcTag", "=", "tag", ".", "toLowerCase", "(", ");", "var", "lcName", "=", "attr", ".", "toLowerCase", "(", ");", "return", "_isValidAttribute", "(", "lcTag", ",", "lcName", ",", "value", ")", ";", "}", ";", "/", "**", "*", "AddHook", "*", "Public", "method", "to", "add", "DOMPurify", "hooks", "*", "*", "@", "param", "{", "String", "}", "entryPoint", "entry", "point", "for", "the", "hook", "to", "add", "*", "@", "param", "{", "Function", "}", "hookFunction", "function", "to", "execute", "*", "/", "DOMPurify", ".", "addHook", "=", "function", "(", "entryPoint", ",", "hookFunction", ")", "{", "if", "(", "typeof", "hookFunction", "!", "==", "'", "function", "'", ")", "{", "return", ";", "}", "hooks", "[", "entryPoint", "]", "=", "hooks", "[", "entryPoint", "]", "|", "|", "[", "];", "hooks", "[", "entryPoint", "]", ".", "push", "(", "hookFunction", ")", ";", "}", ";", "/", "**", "*", "RemoveHook", "*", "Public", "method", "to", "remove", "a", "DOMPurify", "hook", "at", "a", "given", "entryPoint", "*", "(", "pops", "it", "from", "the", "stack", "of", "hooks", "if", "more", "are", "present", ")", "*", "*", "@", "param", "{", "String", "}", "entryPoint", "entry", "point", "for", "the", "hook", "to", "remove", "*", "/", "DOMPurify", ".", "removeHook", "=", "function", "(", "entryPoint", ")", "{", "if", "(", "hooks", "[", "entryPoint", "]", ")", "{", "hooks", "[", "entryPoint", "]", ".", "pop", "(", ");", "}", "}", ";", "/", "**", "*", "RemoveHooks", "*", "Public", "method", "to", "remove", "all", "DOMPurify", "hooks", "at", "a", "given", "entryPoint", "*", "*", "@", "param", "{", "String", "}", "entryPoint", "entry", "point", "for", "the", "hooks", "to", "remove", "*", "/", "DOMPurify", ".", "removeHooks", "=", "function", "(", "entryPoint", ")", "{", "if", "(", "hooks", "[", "entryPoint", "]", ")", "{", "hooks", "[", "entryPoint", "]", "=", "[", "];", "}", "}", ";", "/", "**", "*", "RemoveAllHooks", "*", "Public", "method", "to", "remove", "all", "DOMPurify", "hooks", "*", "*", "/", "DOMPurify", ".", "removeAllHooks", "=", "function", "(", ")", "{", "hooks", "=", "{", "};", "}", ";", "return", "DOMPurify", ";", "}", "var", "purify", "=", "createDOMPurify", "(", ");", "return", "purify", ";", "}", "))", ");", "/", "/#", "sourceMappingURL", "=", "purify", ".", "js", ".", "map", "@", "@", "-", "1", ",", "18", "+", "1", ",", "18", "@", "@", "(", "function", "(", "root", ",", "factory", ")", "{", "if", "(", "typeof", "define", "=", "==", "'", "function", "'", "&", "&", "define", ".", "amd", ")", "{", "/", "/", "AMD", ".", "Register", "as", "an", "anonymous", "module", "unless", "amdModuleId", "is", "set", "define", "(", "'", "simditor", "'", ",", "[", "\"", "jquery", "\"", ",\"", "simple", "-", "module", "\"", ",\"", "simple", "-", "hotkeys", "\"", ",\"", "simple", "-", "uploader", "\"", "],", "function", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ")", "{", "return", "(", "root", "[", "'", "Simditor", "'", "]", "=", "factory", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ")", ");", "define", "(", "'", "simditor", "'", ",", "[", "\"", "jquery", "\"", ",\"", "simple", "-", "module", "\"", ",\"", "simple", "-", "hotkeys", "\"", ",\"", "simple", "-", "uploader", "\"", ",\"", "dompurify", "\"", "],", "function", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ",", "DOMPurify", ")", "{", "return", "(", "root", "[", "'", "Simditor", "'", "]", "=", "factory", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ",", "DOMPurify", ")", ");", "}", ");", "}", "else", "if", "(", "typeof", "exports", "=", "==", "'", "object", "'", ")", "{", "/", "/", "Node", ".", "Does", "not", "work", "with", "strict", "CommonJS", ",", "but", "/", "/", "only", "CommonJS", "-", "like", "environments", "that", "support", "module", ".", "exports", ",", "/", "/", "like", "Node", ".", "module", ".", "exports", "=", "factory", "(", "require", "(", "\"", "jquery", "\"", "),", "require", "(", "\"", "simple", "-", "module", "\"", "),", "require", "(", "\"", "simple", "-", "hotkeys", "\"", "),", "require", "(", "\"", "simple", "-", "uploader", "\"", "))", ";", "module", ".", "exports", "=", "factory", "(", "require", "(", "\"", "jquery", "\"", "),", "require", "(", "\"", "simple", "-", "module", "\"", "),", "require", "(", "\"", "simple", "-", "hotkeys", "\"", "),", "require", "(", "\"", "simple", "-", "uploader", "\"", "),", "require", "(", "\"", "dompurify", "\"", "))", ";", "}", "else", "{", "root", "[", "'", "Simditor", "'", "]", "=", "factory", "(", "jQuery", ",", "SimpleModule", ",", "simple", ".", "hotkeys", ",", "simple", ".", "uploader", ")", ";", "root", "[", "'", "Simditor", "'", "]", "=", "factory", "(", "jQuery", ",", "SimpleModule", ",", "simple", ".", "hotkeys", ",", "simple", ".", "uploader", ",", "window", ".", "DOMPurify", ")", ";", "}", "}", "(", "this", ",", "function", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ")", "{", "}", "(", "this", ",", "function", "(", "$,", "SimpleModule", ",", "simpleHotkeys", ",", "simpleUploader", ",", "DOMPurify", ")", "{", "var", "AlignmentButton", ",", "BlockquoteButton", ",", "BoldButton", ",", "Button", ",", "Clipboard", ",", "CodeButton", ",", "CodePopover", ",", "ColorButton", ",", "FontScaleButton", ",", "Formatter", ",", "HrButton", ",", "ImageButton", ",", "ImagePopover", ",", "IndentButton", ",", "Indentation", ",", "InputManager", ",", "ItalicButton", ",", "Keystroke", ",", "LinkButton", ",", "LinkPopover", ",", "ListButton", ",", "OrderListButton", ",", "OutdentButton", ",", "Popover", ",", "Selection", ",", "Simditor", ",", "StrikethroughButton", ",", "TableButton", ",", "TitleButton", ",", "Toolbar", ",", "UnderlineButton", ",", "UndoManager", ",", "UnorderListButton", ",", "Util", ",", "extend", "=", "function", "(", "child", ",", "parent", ")", "{", "for", "(", "var", "key", "in", "parent", ")", "{", "if", "(", "hasProp", ".", "call", "(", "parent", ",", "key", ")", ")", "child", "[", "key", "]", "=", "parent", "[", "key", "]", ";", "}", "function", "ctor", "(", ")", "{", "this", ".", "constructor", "=", "child", ";", "}", "ctor", ".", "prototype", "=", "parent", ".", "prototype", ";", "child", ".", "prototype", "=", "new", "ctor", "(", ");", "child", ".", "__super__", "=", "parent", ".", "prototype", ";", "return", "child", ";", "}", ",", "@", "@", "-", "2337", ",", "7", "+", "2337", ",", "7", "@", "@", "Clipboard", "=", "(", "function", "(", "superClass", ")", "{", "return", "function", "(", ")", "{", "var", "pasteContent", ";", "_this", ".", "editor", ".", "hidePopover", "(", ");", "_this", ".", "editor", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "state", ".", "html", ";", "_this", ".", "editor", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "DOMPurify", "?", "DOMPurify", ".", "sanitize", "(", "state", ".", "html", ")", ":", "state", ".", "html", ";", "_this", ".", "editor", ".", "undoManager", ".", "caretPosition", "(", "state", ".", "caret", ")", ";", "_this", ".", "editor", ".", "body", ".", "focus", "(", ");", "_this", ".", "editor", ".", "selection", ".", "reset", "(", ");", "@", "@", "-", "2644", ",", "7", "+", "2644", ",", "7", "@", "@", "Simditor", "=", "(", "function", "(", "superClass", ")", "{", "Simditor", ".", "prototype", ".", "setValue", "=", "function", "(", "val", ")", "{", "this", ".", "hidePopover", "(", ");", "this", ".", "textarea", ".", "val", "(", "val", ")", ";", "this", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "val", ";", "this", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "DOMPurify", "?", "DOMPurify", ".", "sanitize", "(", "val", ")", ":", "val", ";", "this", ".", "formatter", ".", "format", "(", ");", "this", ".", "formatter", ".", "decorate", "(", ");", "this", ".", "util", ".", "reflow", "(", "this", ".", "body", ")", ";", "@", "@", "-", "44", ",", "7", "+", "44", ",", "7", "@", "@", "Uploader", "=", "(", "function", "(", "superClass", ")", "{", "_this", ".", "files", ".", "splice", "(", "$.", "inArray", "(", "file", ",", "_this", ".", "files", ")", ",", "1", ")", ";", "if", "(", "_this", ".", "queue", ".", "length", ">", "0", "&", "&", "_this", ".", "files", ".", "length", "<", "_this", ".", "opts", ".", "connectionCount", ")", "{", "return", "_this", ".", "upload", "(", "_this", ".", "queue", ".", "shift", "(", "))", ";", "}", "else", "{", "}", "else", "if", "(", "_this", ".", "files", ".", "length", "=", "==", "0", ")", "{", "return", "_this", ".", "uploading", "=", "false", ";", "}", "}", ";", "@", "@", "-", "13", ",", "5", "+", "13", ",", "6", "@", "@", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "module", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "uploader", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "hotkeys", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "dompurify", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "simditor", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "page", "-", "demo", ".", "js", "\"", "><", "/", "script", ">", "@", "@", "-", "40", ",", "7", "+", "40", ",", "7", "@", "@", "$", "bundle", "install", "`", "``", "#", "Install", "Grunt", "#", "Install", "Dependencies", "Simditor", "uses", "[", "Grunt", "]", "(", "http", ":", "//", "gruntjs", ".", "com", "/", ")", "as", "the", "task", "runner", "to", "run", "tasks", "such", "as", "auto", "-", "compiling", "and", "watching", "files", ".", "@", "@", "-", "52", ",", "30", "+", "52", ",", "12", "@", "@", "Install", "Grunt", "'", "s", "command", "line", "interface", "(", "CLI", ")", "globally", ":", "$", "sudo", "npm", "install", "-", "g", "grunt", "-", "cli", "`", "``", "Install", "grunt", ":", "Install", "grunt", "and", "other", "dependencies", ":", "`", "``", "bash", "$", "npm", "install", "$", "npm", "i", "`", "``", "#", "Install", "Bower", "Dependencies", "Simditor", "uses", "[", "Bower", "]", "(", "http", ":", "//", "bower", ".", "io", "/", ")", "to", "manage", "front", "-", "end", "libraries", ":", "Install", "bower", "\uff1a", "`", "``", "bash", "npm", "install", "-", "g", "bower", "`", "``", "Install", "bower", "dependencies", ":", "`", "``", "bash", "bower", "install", "`", "``", "#", "Run", "Project", "Run", "project", "with", "grunt", ":", "@", "@", "-", "7", ",", "10", "+", "7", ",", "9", "@", "@", "root", ":", ".", "./", "#", "Download", "Click", "[", "Here", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simditor", "/", "releases", ")", "to", "download", "the", "zip", "file", ".", "You", "can", "also", "install", "Simditor", "by", "bower", "and", "npm", ":", "Click", "[", "Here", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simditor", "/", "releases", ")", "to", "download", "the", "zip", "file", ".", "You", "can", "also", "install", "Simditor", "npm", ":", "*", "`", "$", "npm", "install", "simditor", "`", "*", "`", "$", "bower", "install", "simditor", "`", "`", "$", "npm", "install", "simditor", "`", "Import", "files", "below", "into", "your", "web", "application", "@", "@", "-", "22", ",", "13", "+", "21", ",", "15", "@", "@", "Import", "files", "below", "into", "your", "web", "application", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"[", "script", "path", "]", "/", "module", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"[", "script", "path", "]", "/", "hotkeys", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"[", "script", "path", "]", "/", "uploader", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"[", "script", "path", "]", "/", "dompurify", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"[", "script", "path", "]", "/", "simditor", ".", "js", "\"", "><", "/", "script", ">", "`", "``", "Note", "that", "*", "Simditor", "is", "based", "on", "[", "jQuery", "]", "(", "http", ":", "//", "jquery", ".", "com", ")", "and", "[", "module", ".", "js", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simple", "-", "module", ")", ".", "*", "[", "hotkeys", ".", "js", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simple", "-", "hotkeys", ")", "is", "used", "to", "bind", "hotkeys", ".", "*", "[", "uploader", ".", "js", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simple", "-", "uploader", ")", "is", "related", "to", "uploading", "files", ".", "You", "don", "'", "t", "need", "to", "import", "this", "file", "if", "you", "don", "'", "t", "want", "the", "uploading", "feature", ".", "*", "[", "dompurify", ".", "js", "]", "(", "https", ":", "//", "github", ".", "com", "/", "cure53", "/", "DOMPurify", ")", "is", "used", "to", "purify", "html", "tags", "for", "preventing", "xss", "attacks", ".", "#", "Using", "Simditor", "in", "your", "project", "@", "@", "-", "75", ",", "4", "+", "76", ",", "4", "@", "@", "Want", "some", "special", "interactions", "and", "features", "?", "have", "a", "look", "at", "[", "extension", "library", "]", "(", "Sample", "extensions", ":", "*", "a", "feature", "extension", ":", "[", "simditor", "-", "autosave", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simditor", "-", "autosave", ")", "*", "a", "button", "extension", ":", "[", "simditor", "-", "mark", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simditor", "-", "mark", ")", "\\", "No", "newline", "at", "end", "of", "file", "*", "a", "button", "extension", ":", "[", "simditor", "-", "mark", "]", "(", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simditor", "-", "mark", ")", "@", "@", "-", "12", ",", "13", "+", "12", ",", "13", "@", "@", "<", "ul", ">", "<", "li", ">", "<", "a", "href", "=", "\"", "https", ":", "//", "github", ".", "com", "/", "mycolorway", "/", "simditor", "/", "releases", "\"", "target", "=", "\"", "_blank", "\"", "class", "=", "\"\"", ">", "Download", "Zip", "<", "/", "a", ">", "</", "li", ">", "<", "li", ">", "Install", "with", "npm", ":", "$", "npm", "install", "simditor", "<", "/", "li", ">", "<", "li", ">", "Install", "with", "bower", ":", "$", "bower", "install", "simditor", "<", "/", "li", ">", "<", "/", "ul", ">", "<", "/", "textarea", ">", "<", "/", "section", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "module", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "uploader", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "hotkeys", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "dompurify", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "simditor", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\"", "assets", "/", "scripts", "/", "page", "-", "demo", ".", "js", "\"", "><", "/", "script", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "63", "@", "@", "<", "!", "doctype", "html", ">", "<", "html", ">", "<", "head", ">", "<", "meta", "charset", "=", "\"", "utf", "-", "8", "\"", ">", "<", "title", ">", "Jasmine", "Spec", "Runner", "<", "/", "title", ">", "<", "link", "rel", "=", "\"", "shortcut", "icon", "\"", "type", "=", "\"", "image", "/", "png", "\"", "href", "=", "\".", "grunt", "/", "grunt", "-", "contrib", "-", "jasmine", "/", "jasmine_favicon", ".", "png", "\"", ">", "<", "link", "rel", "=", "\"", "stylesheet", "\"", "type", "=", "\"", "text", "/", "css", "\"", "href", "=", "\".", "./", ".", "grunt", "/", "grunt", "-", "contrib", "-", "jasmine", "/", "jasmine", ".", "css", "\"", ">", "<", "link", "rel", "=", "\"", "stylesheet", "\"", "type", "=", "\"", "text", "/", "css", "\"", "href", "=", "\".", "./", "styles", "/", "simditor", ".", "css", "\"", ">", "<", "/", "head", ">", "<", "body", ">", "<", "script", "src", "=", "\".", "./", ".", "grunt", "/", "grunt", "-", "contrib", "-", "jasmine", "/", "es5", "-", "shim", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", ".", "grunt", "/", "grunt", "-", "contrib", "-", "jasmine", "/", "jasmine", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", ".", "grunt", "/", "grunt", "-", "contrib", "-", "jasmine", "/", "jasmine", "-", "html", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", ".", "grunt", "/", "grunt", "-", "contrib", "-", "jasmine", "/", "json2", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", ".", "grunt", "/", "grunt", "-", "contrib", "-", "jasmine", "/", "boot", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", "node_modules", "/", "jquery", "/", "dist", "/", "jquery", ".", "min", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", "node_modules", "/", "simple", "-", "module", "/", "lib", "/", "module", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", "node_modules", "/", "simple", "-", "uploader", "/", "lib", "/", "uploader", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", "node_modules", "/", "simple", "-", "hotkeys", "/", "lib", "/", "hotkeys", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", "node_modules", "/", "dompurify", "/", "dist", "/", "purify", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", "lib", "/", "simditor", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "core", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "formatter", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "indentation", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "util", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "buttons", "/", "alignment", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "buttons", "/", "bold", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "buttons", "/", "code", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "buttons", "/", "font", "-", "scale", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "buttons", "/", "table", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\"", "buttons", "/", "title", "-", "spec", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "src", "=", "\".", "./", ".", "grunt", "/", "grunt", "-", "contrib", "-", "jasmine", "/", "reporter", ".", "js", "\"", "><", "/", "script", ">", "<", "/", "body", ">", "<", "/", "html", ">", "@", "@", "-", "79", ",", "7", "+", "79", ",", "7", "@", "@", "class", "Clipboard", "extends", "SimpleModule", "setTimeout", "=", ">", "@", "editor", ".", "hidePopover", "(", ")", "@", "editor", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "state", ".", "html", "@", "editor", ".", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "if", "DOMPurify", "then", "DOMPurify", ".", "sanitize", "(", "state", ".", "html", ")", "else", "state", ".", "html", "@", "editor", ".", "undoManager", ".", "caretPosition", "state", ".", "caret", "@", "editor", ".", "body", ".", "focus", "(", ")", "@", "editor", ".", "selection", ".", "reset", "(", ")", "@", "@", "-", "112", ",", "7", "+", "112", ",", "7", "@", "@", "class", "Clipboard", "extends", "SimpleModule", "if", "!", "pasteContent", "return", "if", "@", "_pastePlainText", "if", "$", "blockEl", ".", "is", "(", "'", "table", "'", ")", "lines", "=", "pasteContent", ".", "split", "(", "'\\", "n", "'", ")", "@", "@", "-", "216", ",", "7", "+", "216", ",", "7", "@", "@", "class", "Clipboard", "extends", "SimpleModule", "$", "node", "=", "$", "(", "node", ")", "return", "unless", "$", "node", ".", "length", ">", "0", "sizeMap", "=", "[", "sizeMap", "=", "[", "'", "1", ".", "5em", "'", "'", "1", ".", "25em", "'", "'", "0", ".", "75em", "'", "@", "@", "-", "115", ",", "7", "+", "115", ",", "7", "@", "@", "class", "Simditor", "extends", "SimpleModule", "setValue", ":", "(", "val", ")", "-", ">", "@", "hidePopover", "(", ")", "@", "textarea", ".", "val", "val", "@", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "val", "@", "body", ".", "get", "(", "0", ")", ".", "innerHTML", "=", "if", "DOMPurify", "then", "DOMPurify", ".", "sanitize", "(", "val", ")", "else", "val", "@", "formatter", ".", "format", "(", ")", "@", "formatter", ".", "decorate", "(", ")", "@", "@", "-", "162", ",", "7", "+", "162", ",", "7", "@", "@", "class", "Formatter", "extends", "SimpleModule", "$", "node", ".", "removeAttr", "(", "attr", ".", "name", ")", "@", "_cleanNodeStyles", "$", "node", "if", "$", "node", ".", "is", "(", "'", "span", "'", ")", "if", "$", "node", "[", "0", "]", ".", "attributes", ".", "length", "=", "=", "0", "$", "node", ".", "contents", "(", ").", "first", "(", ").", "unwrap", "(", ")", "@", "@", "-", "214", ",", "7", "+", "214", ",", "7", "@", "@", "class", "Formatter", "extends", "SimpleModule", "if", "pair", "[", "0", "]", "=", "=", "'", "font", "-", "size", "'", "and", "pair", "[", "1", "]", ".", "indexOf", "(", "'", "px", "'", ")", ">", "0", "continue", "if", "parseInt", "(", "pair", "[", "1", "]", ",", "10", ")", "<", "12", "styles", "[", "$.", "trim", "(", "pair", "[", "0", "]", ")]", "=", "$", ".", "trim", "(", "pair", "[", "1", "]", ")", "if", "pair", "[", "0", "]", "in", "allowedStyles", "$", "node", ".", "css", "styles", "if", "Object", ".", "keys", "(", "styles", ")", ".", "length", ">", "0", "@", "@", "-", "1", ",", "7", "+", "1", ",", "7", "@", "@", "/", "*!", "*", "Simditor", "v2", ".", "3", ".", "21", "*", "http", ":", "//", "simditor", ".", "tower", ".", "im", "/", "*", "2018", "-", "10", "-", "17", "*", "2018", "-", "11", "-", "09", "*", "/", "@", "font", "-", "face", "{", "font", "-", "family", ":", "'", "Simditor", "'", ";"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "94", ",", "24", "+", "94", ",", "26", "@", "@", "int", "ff_mms_asf_header_parser", "(", "MMSContext", "*", "mms", ")", "}", "}", "}", "else", "if", "(", "!", "memcmp", "(", "p", ",", "ff_asf_stream_header", ",", "sizeof", "(", "ff_asf_guid", ")", "))", "{", "flags", "=", "AV_RL16", "(", "p", "+", "sizeof", "(", "ff_asf_guid", ")", "*", "3", "+", "24", ")", ";", "stream_id", "=", "flags", "&", "0x7F", ";", "/", "/", "The", "second", "condition", "is", "for", "checking", "CS_PKT_STREAM_ID_REQUEST", "packet", "size", ",", "/", "/", "we", "can", "calculate", "the", "packet", "size", "by", "stream_num", ".", "/", "/", "Please", "see", "function", "send_stream_selection_request", "(", ").", "if", "(", "mms", "-", ">", "stream_num", "<", "MMS_MAX_STREAMS", "&", "&", "46", "+", "mms", "-", ">", "stream_num", "*", "6", "<", "sizeof", "(", "mms", "-", ">", "out_buffer", ")", ")", "{", "mms", "-", ">", "streams", "=", "av_fast_realloc", "(", "mms", "-", ">", "streams", ",", "&", "mms", "-", ">", "nb_streams_allocated", ",", "(", "mms", "-", ">", "stream_num", "+", "1", ")", "*", "sizeof", "(", "MMSStream", ")", ");", "if", "(", "!", "mms", "-", ">", "streams", ")", "return", "AVERROR", "(", "ENOMEM", ")", ";", "mms", "-", ">", "streams", "[", "mms", "-", ">", "stream_num", "]", ".", "id", "=", "stream_id", ";", "mms", "-", ">", "stream_num", "+", "+;", "}", "else", "{", "av_log", "(", "NULL", ",", "AV_LOG_ERROR", ",", "\"", "Corrupt", "stream", "(", "too", "many", "A", "/", "V", "streams", ")", "\\", "n", "\"", ");", "return", "AVERROR_INVALIDDATA", ";", "if", "(", "end", "-", "p", ">", "=", "(", "sizeof", "(", "ff_asf_guid", ")", "*", "3", "+", "26", ")", ")", "{", "flags", "=", "AV_RL16", "(", "p", "+", "sizeof", "(", "ff_asf_guid", ")", "*", "3", "+", "24", ")", ";", "stream_id", "=", "flags", "&", "0x7F", ";", "/", "/", "The", "second", "condition", "is", "for", "checking", "CS_PKT_STREAM_ID_REQUEST", "packet", "size", ",", "/", "/", "we", "can", "calculate", "the", "packet", "size", "by", "stream_num", ".", "/", "/", "Please", "see", "function", "send_stream_selection_request", "(", ").", "if", "(", "mms", "-", ">", "stream_num", "<", "MMS_MAX_STREAMS", "&", "&", "46", "+", "mms", "-", ">", "stream_num", "*", "6", "<", "sizeof", "(", "mms", "-", ">", "out_buffer", ")", ")", "{", "mms", "-", ">", "streams", "=", "av_fast_realloc", "(", "mms", "-", ">", "streams", ",", "&", "mms", "-", ">", "nb_streams_allocated", ",", "(", "mms", "-", ">", "stream_num", "+", "1", ")", "*", "sizeof", "(", "MMSStream", ")", ");", "if", "(", "!", "mms", "-", ">", "streams", ")", "return", "AVERROR", "(", "ENOMEM", ")", ";", "mms", "-", ">", "streams", "[", "mms", "-", ">", "stream_num", "]", ".", "id", "=", "stream_id", ";", "mms", "-", ">", "stream_num", "+", "+;", "}", "else", "{", "av_log", "(", "NULL", ",", "AV_LOG_ERROR", ",", "\"", "Corrupt", "stream", "(", "too", "many", "A", "/", "V", "streams", ")", "\\", "n", "\"", ");", "return", "AVERROR_INVALIDDATA", ";", "}", "}", "}", "else", "if", "(", "!", "memcmp", "(", "p", ",", "ff_asf_ext_stream_header", ",", "sizeof", "(", "ff_asf_guid", ")", "))", "{", "if", "(", "end", "-", "p", ">", "=", "88", ")", "{", "@", "@", "-", "143", ",", "6", "+", "145", ",", "12", "@", "@", "int", "ff_mms_asf_header_parser", "(", "MMSContext", "*", "mms", ")", "}", "}", "else", "if", "(", "!", "memcmp", "(", "p", ",", "ff_asf_head1_guid", ",", "sizeof", "(", "ff_asf_guid", ")", "))", "{", "chunksize", "=", "46", ";", "/", "/", "see", "references", "[", "2", "]", "section", "3", ".", "4", ".", "This", "should", "be", "set", "46", ".", "if", "(", "chunksize", ">", "end", "-", "p", ")", "{", "av_log", "(", "NULL", ",", "AV_LOG_ERROR", ",", "\"", "Corrupt", "stream", "(", "header", "chunksize", "%", "\"", "PRId64", "\"", "is", "invalid", ")", "\\", "n", "\"", ",", "chunksize", ")", ";", "return", "AVERROR_INVALIDDATA", ";", "}", "}", "p", "+", "=", "chunksize", ";", "}"], "docstring_tokens": ["out", "of", "array", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "20", ",", "7", "+", "20", ",", "6", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "Lock", ";", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReentrantLock", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExchangeException", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Expression", ";", "import", "org", ".", "apache", ".", "camel", ".", "impl", ".", "DefaultExchange", ";"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "70", ",", "7", "+", "70", ",", "7", "@", "@", "@", "Inject", "public", "GroovyScriptEngineService", "(", "Settings", "settings", ")", "{", "super", "(", "settings", ")", ";", "this", ".", "sandboxed", "=", "settings", ".", "getAsBoolean", "(", "GROOVY_SCRIPT_SANDBOX_ENABLED", ",", "true", ")", ";", "this", ".", "sandboxed", "=", "settings", ".", "getAsBoolean", "(", "GROOVY_SCRIPT_SANDBOX_ENABLED", ",", "false", ")", ";", "this", ".", "blacklistAdditions", "=", "ImmutableSet", ".", "copyOf", "(", "settings", ".", "getAsArray", "(", "GROOVY_SCRIPT_BLACKLIST_PATCH", ",", "Strings", ".", "EMPTY_ARRAY", ")", ");", "reloadConfig", "(", ");", "}", "@", "@", "-", "34", ",", "11", "+", "34", ",", "18", "@", "@", "/", "**", "*", "Tests", "for", "the", "Groovy", "scripting", "sandbox", "*", "/", "@", "ElasticsearchIntegrationTest", ".", "ClusterScope", "(", "scope", "=", "ElasticsearchIntegrationTest", ".", "Scope", ".", "TEST", ")", "@", "ElasticsearchIntegrationTest", ".", "ClusterScope", "(", "scope", "=", "ElasticsearchIntegrationTest", ".", "Scope", ".", "TEST", ",", "numDataNodes", "=", "0", ")", "public", "class", "GroovySandboxScriptTests", "extends", "ElasticsearchIntegrationTest", "{", "@", "Test", "public", "void", "testSandboxedGroovyScript", "(", ")", "{", "public", "void", "testSandboxedGroovyScript", "(", ")", "throws", "Exception", "{", "int", "nodes", "=", "randomIntBetween", "(", "1", ",", "3", ")", ";", "Settings", "nodeSettings", "=", "ImmutableSettings", ".", "builder", "(", ")", ".", "put", "(", "GroovyScriptEngineService", ".", "GROOVY_SCRIPT_SANDBOX_ENABLED", ",", "true", ")", ".", "build", "(", ");", "internalCluster", "(", ").", "startNodesAsync", "(", "nodes", ",", "nodeSettings", ")", ".", "get", "(", ");", "client", "(", ").", "admin", "(", ").", "cluster", "(", ").", "prepareHealth", "(", ").", "setWaitForNodes", "(", "nodes", "+", "\"", "\")", ".", "get", "(", ");", "client", "(", ").", "prepareIndex", "(", "\"", "test", "\"", ",", "\"", "doc", "\"", ",", "\"", "1", "\"", ").", "setSource", "(", "\"", "foo", "\"", ",", "5", ")", ".", "setRefresh", "(", "true", ")", ".", "get", "(", ");", "/", "/", "Plain", "test", "@", "@", "-", "102", ",", "6", "+", "109", ",", "13", "@", "@", "public", "void", "testSandboxedGroovyScript", "(", ")", "{", "@", "Test", "public", "void", "testDynamicBlacklist", "(", ")", "throws", "Exception", "{", "int", "nodes", "=", "randomIntBetween", "(", "1", ",", "3", ")", ";", "Settings", "nodeSettings", "=", "ImmutableSettings", ".", "builder", "(", ")", ".", "put", "(", "GroovyScriptEngineService", ".", "GROOVY_SCRIPT_SANDBOX_ENABLED", ",", "true", ")", ".", "build", "(", ");", "internalCluster", "(", ").", "startNodesAsync", "(", "nodes", ",", "nodeSettings", ")", ".", "get", "(", ");", "client", "(", ").", "admin", "(", ").", "cluster", "(", ").", "prepareHealth", "(", ").", "setWaitForNodes", "(", "nodes", "+", "\"", "\")", ".", "get", "(", ");", "client", "(", ").", "prepareIndex", "(", "\"", "test", "\"", ",", "\"", "doc", "\"", ",", "\"", "1", "\"", ").", "setSource", "(", "\"", "foo", "\"", ",", "5", ")", ".", "setRefresh", "(", "true", ")", ".", "get", "(", ");", "testSuccess", "(", "\"[", "doc", "[", "'", "foo", "'", "].", "value", ",", "3", ",", "4", "]", ".", "isEmpty", "(", ")\"", ");", "@", "@", "-", "79", ",", "19", "+", "79", ",", "6", "@", "@", "public", "void", "testGroovyExceptionSerialization", "(", ")", "throws", "Exception", "{", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", ".", "contains", "(", "\"", "No", "such", "property", ":", "not_found", "\"", "),", "equalTo", "(", "true", ")", ");", "}", "try", "{", "client", "(", ").", "prepareSearch", "(", "\"", "test", "\"", ").", "setQuery", "(", "constantScoreQuery", "(", "scriptFilter", "(", "\"", "pr", "=", "Runtime", ".", "getRuntime", "(", ").", "exec", "(", "\\\"", "touch", "/", "tmp", "/", "gotcha", "\\", "\")", ";", "pr", ".", "waitFor", "(", ")\"", ").", "lang", "(", "\"", "groovy", "\"", "))", ").", "get", "(", ");", "fail", "(", "\"", "should", "have", "thrown", "an", "exception", "\"", ");", "}", "catch", "(", "SearchPhaseExecutionException", "e", ")", "{", "assertThat", "(", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", "+", "\"", "should", "not", "contained", "NotSerializableTransportException", "\"", ",", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", ".", "contains", "(", "\"", "NotSerializableTransportException", "\"", "),", "equalTo", "(", "false", ")", ");", "assertThat", "(", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", "+", "\"", "should", "have", "contained", "GroovyScriptCompilationException", "\"", ",", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", ".", "contains", "(", "\"", "GroovyScriptCompilationException", "\"", "),", "equalTo", "(", "true", ")", ");", "assertThat", "(", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", "+", "\"", "should", "have", "contained", "Method", "calls", "not", "allowed", "on", "[", "java", ".", "lang", ".", "Runtime", "]", "\",", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", ".", "contains", "(", "\"", "Method", "calls", "not", "allowed", "on", "[", "java", ".", "lang", ".", "Runtime", "]", "\")", ",", "equalTo", "(", "true", ")", ");", "}", "try", "{", "client", "(", ").", "prepareSearch", "(", "\"", "test", "\"", ").", "setQuery", "(", "constantScoreQuery", "(", "scriptFilter", "(", "\"", "assert", "false", "\"", ").", "lang", "(", "\"", "groovy", "\"", "))", ").", "get", "(", ");", "@", "@", "-", "100", ",", "6", "+", "100", ",", "7", "@", "@", "private", "static", "Node", "newNode", "(", ")", "{", ".", "put", "(", "\"", "node", ".", "name", "\"", ",", "nodeName", "(", "))", ".", "put", "(", "IndexMetaData", ".", "SETTING_NUMBER_OF_SHARDS", ",", "1", ")", ".", "put", "(", "IndexMetaData", ".", "SETTING_NUMBER_OF_REPLICAS", ",", "0", ")", ".", "put", "(", "\"", "script", ".", "disable_dynamic", "\"", ",", "false", ")", ".", "put", "(", "EsExecutors", ".", "PROCESSORS", ",", "1", ")", "/", "/", "limit", "the", "number", "of", "threads", "created", ".", "put", "(", "\"", "http", ".", "enabled", "\"", ",", "false", ")", ".", "put", "(", "\"", "index", ".", "store", ".", "type", "\"", ",", "\"", "ram", "\"", ")"], "docstring_tokens": ["search", "groovy", "sandbox", "bypass"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "506", ",", "8", "+", "506", ",", "8", "@", "@", "static", "Image", "*", "ReadVIFFImage", "(", "const", "ImageInfo", "*", "image_info", ",", "max_packets", "=", "((", "image", "-", ">", "columns", "+", "7UL", ")", ">", ">", "3UL", ")", "*", "image", "-", ">", "rows", ";", "else", "max_packets", "=", "(", "size_t", ")", "(", "number_pixels", "*", "viff_info", ".", "number_data_bands", ")", ";", "pixels", "=", "(", "unsigned", "char", "*", ")", "AcquireQuantumMemory", "(", "max_packets", ",", "bytes_per_pixel", "*", "sizeof", "(", "*", "pixels", ")", ");", "pixels", "=", "(", "unsigned", "char", "*", ")", "AcquireQuantumMemory", "(", "MagickMax", "(", "number_pixels", ",", "max_packets", ")", ",", "bytes_per_pixel", "*", "sizeof", "(", "*", "pixels", ")", ");", "if", "(", "pixels", "=", "=", "(", "unsigned", "char", "*", ")", "NULL", ")", "ThrowReaderException", "(", "ResourceLimitError", ",", "\"", "MemoryAllocationFailed", "\"", ");", "(", "void", ")", "ReadBlob", "(", "image", ",", "bytes_per_pixel", "*", "max_packets", ",", "pixels", ")", ";"], "docstring_tokens": ["out-of-bounds", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "26", ",", "6", "+", "26", ",", "8", "@", "@", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "PrintWriter", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "nio", ".", "file", ".", "Files", ";", "import", "java", ".", "nio", ".", "file", ".", "StandardCopyOption", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "@", "@", "-", "60", ",", "7", "+", "62", ",", "7", "@", "@", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "MultipartPortlet", ".", "class", ".", "getName", "(", "))", ";", "private", "static", "final", "String", "JSP", "=", "\"", "/", "WEB", "-", "INF", "/", "jsp", "/", "multipartDialog", ".", "jsp", "\"", ";", "private", "static", "final", "String", "TMP", "=", "\"", "/", "temp", "/", "\";", "private", "static", "final", "String", "TMP", "=", "\"", "/", "MultipartPortlet", "/", "temp", "/", "\";", "@", "ActionMethod", "(", "portletName", "=", "\"", "MultipartPortlet", "\"", ")", "public", "void", "handleDialog", "(", "ActionRequest", "req", ",", "ActionResponse", "resp", ")", "throws", "IOException", ",", "PortletException", "{", "@", "@", "-", "107", ",", "19", "+", "109", ",", "10", "@", "@", "public", "void", "handleDialog", "(", "ActionRequest", "req", ",", "ActionResponse", "resp", ")", "throws", "IOExcept", "/", "/", "quick", "solution", "that", "doesn", "'", "t", "require", "additional", "Tomcat", "configuration", ".", "try", "{", "String", "path", "=", "req", ".", "getPortletContext", "(", ").", "getRealPath", "(", "TMP", ")", ";", "File", "dir", "=", "new", "File", "(", "path", ")", ";", "lines", ".", "add", "(", "\"", "Temp", "path", ":", "\"", "+", "dir", ".", "getCanonicalPath", "(", "))", ";", "if", "(", "!", "dir", ".", "exists", "(", "))", "{", "lines", ".", "add", "(", "\"", "Creating", "directory", ".", "Path", ":", "\"", "+", "dir", ".", "getCanonicalPath", "(", "))", ";", "Files", ".", "createDirectories", "(", "dir", ".", "toPath", "(", "))", ";", "}", "String", "fn", "=", "TMP", "+", "part", ".", "getSubmittedFileName", "(", ");", "lines", ".", "add", "(", "\"", "Temp", "file", ":", "\"", "+", "fn", ")", ";", "path", "=", "req", ".", "getPortletContext", "(", ").", "getRealPath", "(", "fn", ")", ";", "File", "img", "=", "new", "File", "(", "path", ")", ";", "String", "fn", "=", "part", ".", "getSubmittedFileName", "(", ");", "File", "img", "=", "getFile", "(", "fn", ")", ";", "if", "(", "img", ".", "exists", "(", "))", "{", "lines", ".", "add", "(", "\"", "deleting", "existing", "temp", "file", ".", "\")", ";", "lines", ".", "add", "(", "\"", "deleting", "existing", "temp", "file", ":", "\"", "+", "img", ".", "getCanonicalPath", "(", "))", ";", "img", ".", "delete", "(", ");", "}", "InputStream", "is", "=", "part", ".", "getInputStream", "(", ");", "@", "@", "-", "130", ",", "6", "+", "123", ",", "15", "@", "@", "public", "void", "handleDialog", "(", "ActionRequest", "req", ",", "ActionResponse", "resp", ")", "throws", "IOExcept", "}", "catch", "(", "Exception", "e", ")", "{", "lines", ".", "add", "(", "\"", "Exception", "doing", "I", "/", "O", ":", "\"", "+", "e", ".", "toString", "(", "))", ";", "txt", ".", "setLength", "(", "0", ")", ";", "txt", ".", "append", "(", "\"", "Problem", "getting", "temp", "file", ":", "\"", "+", "e", ".", "getMessage", "(", ")", "+", "\"", "\\", "n", "\"", ");", "StringWriter", "sw", "=", "new", "StringWriter", "(", ");", "PrintWriter", "pw", "=", "new", "PrintWriter", "(", "sw", ")", ";", "e", ".", "printStackTrace", "(", "pw", ")", ";", "pw", ".", "flush", "(", ");", "txt", ".", "append", "(", "sw", ".", "toString", "(", "))", ";", "LOGGER", ".", "warning", "(", "txt", ".", "toString", "(", "))", ";", "}", "}", "else", "{", "lines", ".", "add", "(", "\"", "file", "part", "was", "null", "\"", ");", "@", "@", "-", "172", ",", "8", "+", "174", ",", "7", "@", "@", "public", "void", "render", "(", "RenderRequest", "req", ",", "RenderResponse", "resp", ")", "throws", "PortletExcepti", "FileInputStream", "fis", "=", "null", ";", "BufferedReader", "rdr", "=", "null", ";", "try", "{", "String", "path", "=", "req", ".", "getPortletContext", "(", ").", "getRealPath", "(", "fn", ")", ";", "File", "file", "=", "new", "File", "(", "path", ")", ";", "File", "file", "=", "getFile", "(", "fn", ")", ";", "fis", "=", "new", "FileInputStream", "(", "file", ")", ";", "if", "(", "ct", ".", "equals", "(", "\"", "text", "/", "plain", "\"", "))", "{", "@", "@", "-", "232", ",", "10", "+", "233", ",", "45", "@", "@", "public", "void", "serveImage", "(", "ResourceRequest", "req", ",", "ResourceResponse", "resp", ")", "throws", "IOExce", "resp", ".", "setContentType", "(", "ct", ")", ";", "String", "path", "=", "req", ".", "getPortletContext", "(", ").", "getRealPath", "(", "fn", ")", ";", "File", "file", "=", "new", "File", "(", "path", ")", ";", "OutputStream", "os", "=", "resp", ".", "getPortletOutputStream", "(", ");", "Files", ".", "copy", "(", "file", ".", "toPath", "(", "),", "os", ")", ";", "os", ".", "flush", "(", ");", "try", "{", "File", "file", "=", "getFile", "(", "fn", ")", ";", "OutputStream", "os", "=", "resp", ".", "getPortletOutputStream", "(", ");", "Files", ".", "copy", "(", "file", ".", "toPath", "(", "),", "os", ")", ";", "os", ".", "flush", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "StringBuilder", "txt", "=", "new", "StringBuilder", "(", "128", ")", ";", "txt", ".", "append", "(", "\"", "Problem", "retrieving", "temp", "file", ":", "\"", "+", "e", ".", "getMessage", "(", ")", "+", "\"", "\\", "n", "\"", ");", "StringWriter", "sw", "=", "new", "StringWriter", "(", ");", "PrintWriter", "pw", "=", "new", "PrintWriter", "(", "sw", ")", ";", "e", ".", "printStackTrace", "(", "pw", ")", ";", "pw", ".", "flush", "(", ");", "txt", ".", "append", "(", "sw", ".", "toString", "(", "))", ";", "LOGGER", ".", "warning", "(", "txt", ".", "toString", "(", "))", ";", "}", "}", "/", "**", "*", "Returns", "a", "File", "object", "representing", "the", "uploaded", "temporary", "file", "location", ".", "Note", "that", "the", "file", "may", "or", "may", "not", "exist", ".", "*", "The", "temp", "directories", "are", "created", "as", "necessary", ".", "*", "*", "@", "param", "fn", "*", "the", "file", "name", "*", "@", "return", "the", "File", "object", "*", "@", "throws", "IOException", "*", "/", "private", "File", "getFile", "(", "String", "fn", ")", "throws", "IOException", "{", "File", "tmp", "=", "null", ";", "String", "path", "=", "System", ".", "getProperty", "(", "\"", "java", ".", "io", ".", "tmpdir", "\"", ")", "+", "TMP", ";", "File", "dir", "=", "new", "File", "(", "path", ")", ";", "if", "(", "!", "dir", ".", "exists", "(", "))", "{", "LOGGER", ".", "fine", "(", "\"", "Creating", "directory", ".", "Path", ":", "\"", "+", "dir", ".", "getCanonicalPath", "(", "))", ";", "Files", ".", "createDirectories", "(", "dir", ".", "toPath", "(", "))", ";", "}", "tmp", "=", "new", "File", "(", "dir", ",", "fn", ")", ";", "LOGGER", ".", "fine", "(", "\"", "Temp", "file", ":", "\"", "+", "tmp", ".", "getCanonicalPath", "(", "))", ";", "return", "tmp", ";", "}", "}"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2763", ",", "14", "+", "2763", ",", "21", "@", "@", "static", "int", "inet_rtm_getroute", "(", "struct", "sk_buff", "*", "in_skb", ",", "struct", "nlmsghdr", "*", "nlh", ",", "if", "(", "rtm", "-", ">", "rtm_flags", "&", "RTM_F_LOOKUP_TABLE", ")", "table_id", "=", "rt", "-", ">", "rt_table_id", ";", "if", "(", "rtm", "-", ">", "rtm_flags", "&", "RTM_F_FIB_MATCH", ")", "if", "(", "rtm", "-", ">", "rtm_flags", "&", "RTM_F_FIB_MATCH", ")", "{", "if", "(", "!", "res", ".", "fi", ")", "{", "err", "=", "fib_props", "[", "res", ".", "type", "]", ".", "error", ";", "if", "(", "!", "err", ")", "err", "=", "-", "EHOSTUNREACH", ";", "goto", "errout_free", ";", "}", "err", "=", "fib_dump_info", "(", "skb", ",", "NETLINK_CB", "(", "in_skb", ")", ".", "portid", ",", "nlh", "-", ">", "nlmsg_seq", ",", "RTM_NEWROUTE", ",", "table_id", ",", "rt", "-", ">", "rt_type", ",", "res", ".", "prefix", ",", "res", ".", "prefixlen", ",", "fl4", ".", "flowi4_tos", ",", "res", ".", "fi", ",", "0", ")", ";", "else", "}", "else", "{", "err", "=", "rt_fill_info", "(", "net", ",", "dst", ",", "src", ",", "table_id", ",", "&", "fl4", ",", "skb", ",", "NETLINK_CB", "(", "in_skb", ")", ".", "portid", ",", "nlh", "-", ">", "nlmsg_seq", ")", ";", "}", "if", "(", "err", "<", "0", ")", "goto", "errout_free", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "64", ",", "7", "+", "64", ",", "7", "@", "@", "public", "DomDriver", "(", "final", "String", "encoding", ",", "final", "NameCoder", "nameCoder", ")", "{", "this", ".", "encoding", "=", "encoding", ";", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "try", "{", "documentBuilderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "false", ")", ";", "documentBuilderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "}", "catch", "(", "final", "ParserConfigurationException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "}", "@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2004", ",", "2005", "Joe", "Walnes", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "90", ",", "8", "+", "90", ",", "8", "@", "@", "public", "void", "testIsXXEVulnerable", "(", ")", "throws", "Exception", "{", "super", ".", "testIsXXEVulnerable", "(", ");", "fail", "(", "\"", "Thrown", "\"", "+", "XStreamException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "XStreamException", "e", ")", "{", "final", "String", "message", "=", "e", ".", "getMessage", "(", ").", "toLowerCase", "(", ");", "if", "(", "message", ".", "contains", "(", "\"", "Package", "\"", "))", "{", "final", "String", "message", "=", "e", ".", "getMessage", "(", ");", "if", "(", "!", "message", ".", "contains", "(", "\"", "DOCTYPE", "\"", "))", "{", "throw", "e", ";", "}", "}"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "122", ",", "6", "+", "122", ",", "12", "@", "@", "*", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", ".", "*", "/", "private", "String", "permissions", ";", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "*", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "*", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "private", "Boolean", "allowUnmarshallType", "=", "false", ";", "public", "String", "getObjectMapper", "(", ")", "{", "return", "objectMapper", ";", "@", "@", "-", "242", ",", "4", "+", "248", ",", "12", "@", "@", "public", "String", "getPermissions", "(", ")", "{", "public", "void", "setPermissions", "(", "String", "permissions", ")", "{", "this", ".", "permissions", "=", "permissions", ";", "}", "public", "Boolean", "getAllowUnmarshallType", "(", ")", "{", "return", "allowUnmarshallType", ";", "}", "public", "void", "setAllowUnmarshallType", "(", "Boolean", "allowUnmarshallType", ")", "{", "this", ".", "allowUnmarshallType", "=", "allowUnmarshallType", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "122", ",", "6", "+", "122", ",", "12", "@", "@", "*", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", ".", "*", "/", "private", "String", "permissions", ";", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "*", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "*", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "private", "Boolean", "allowUnmarshallType", "=", "false", ";", "public", "String", "getObjectMapper", "(", ")", "{", "return", "objectMapper", ";", "@", "@", "-", "242", ",", "4", "+", "248", ",", "12", "@", "@", "public", "String", "getPermissions", "(", ")", "{", "public", "void", "setPermissions", "(", "String", "permissions", ")", "{", "this", ".", "permissions", "=", "permissions", ";", "}", "public", "Boolean", "getAllowUnmarshallType", "(", ")", "{", "return", "allowUnmarshallType", ";", "}", "public", "void", "setAllowUnmarshallType", "(", "Boolean", "allowUnmarshallType", ")", "{", "this", ".", "allowUnmarshallType", "=", "allowUnmarshallType", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "122", ",", "6", "+", "122", ",", "12", "@", "@", "*", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", ".", "*", "/", "private", "String", "permissions", ";", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "*", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "*", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "private", "Boolean", "allowUnmarshallType", "=", "false", ";", "public", "String", "getObjectMapper", "(", ")", "{", "return", "objectMapper", ";", "@", "@", "-", "242", ",", "4", "+", "248", ",", "12", "@", "@", "public", "String", "getPermissions", "(", ")", "{", "public", "void", "setPermissions", "(", "String", "permissions", ")", "{", "this", ".", "permissions", "=", "permissions", ";", "}", "public", "Boolean", "getAllowUnmarshallType", "(", ")", "{", "return", "allowUnmarshallType", ";", "}", "public", "void", "setAllowUnmarshallType", "(", "Boolean", "allowUnmarshallType", ")", "{", "this", ".", "allowUnmarshallType", "=", "allowUnmarshallType", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "122", ",", "6", "+", "122", ",", "12", "@", "@", "*", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", ".", "*", "/", "private", "String", "permissions", ";", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "*", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "*", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "private", "Boolean", "allowUnmarshallType", "=", "false", ";", "public", "String", "getObjectMapper", "(", ")", "{", "return", "objectMapper", ";", "@", "@", "-", "242", ",", "4", "+", "248", ",", "12", "@", "@", "public", "String", "getPermissions", "(", ")", "{", "public", "void", "setPermissions", "(", "String", "permissions", ")", "{", "this", ".", "permissions", "=", "permissions", ";", "}", "public", "Boolean", "getAllowUnmarshallType", "(", ")", "{", "return", "allowUnmarshallType", ";", "}", "public", "void", "setAllowUnmarshallType", "(", "Boolean", "allowUnmarshallType", ")", "{", "this", ".", "allowUnmarshallType", "=", "allowUnmarshallType", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "Gson", "Options", "/", "/", "dataformat", "options", ":", "START", "The", "JSon", "GSon", "dataformat", "supports", "15", "options", "which", "are", "listed", "below", ".", "The", "JSon", "GSon", "dataformat", "supports", "16", "options", "which", "are", "listed", "below", ".", "@", "@", "-", "43", ",", "6", "+", "43", ",", "7", "@", "@", "The", "JSon", "GSon", "dataformat", "supports", "15", "options", "which", "are", "listed", "below", ".", "|", "enableFeatures", "|", "|", "String", "|", "Set", "of", "features", "to", "enable", "on", "the", "Jackson", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ".", "The", "features", "should", "be", "a", "name", "that", "matches", "a", "enum", "from", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "or", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "MapperFeature", "Multiple", "features", "can", "be", "separated", "by", "comma", "|", "disableFeatures", "|", "|", "String", "|", "Set", "of", "features", "to", "disable", "on", "the", "Jackson", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ".", "The", "features", "should", "be", "a", "name", "that", "matches", "a", "enum", "from", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "or", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "MapperFeature", "Multiple", "features", "can", "be", "separated", "by", "comma", "|", "permissions", "|", "|", "String", "|", "Adds", "permissions", "that", "controls", "which", "Java", "packages", "and", "classes", "XStream", "is", "allowed", "to", "use", "during", "unmarshal", "from", "xml", "/", "json", "to", "Java", "beans", ".", "A", "permission", "must", "be", "configured", "either", "here", "or", "globally", "using", "a", "JVM", "system", "property", ".", "The", "permission", "can", "be", "specified", "in", "a", "syntax", "where", "a", "plus", "sign", "is", "allow", "and", "minus", "sign", "is", "deny", ".", "Wildcards", "is", "supported", "by", "using", ".", "as", "prefix", ".", "For", "example", "to", "allow", "com", ".", "foo", "and", "all", "subpackages", "then", "specfy", "com", ".", "foo", ".", ".", "Multiple", "permissions", "can", "be", "configured", "separated", "by", "comma", "such", "as", "com", ".", "foo", ".", "-", "com", ".", "foo", ".", "bar", ".", "MySecretBean", ".", "The", "following", "default", "permission", "is", "always", "included", ":", "-", "java", ".", "lang", ".", "java", ".", "util", ".", "unless", "its", "overridden", "by", "specifying", "a", "JVM", "system", "property", "with", "they", "key", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", ".", "|", "allowUnmarshallType", "|", "false", "|", "Boolean", "|", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "|", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "{", "%", "endraw", "%", "}", "/", "/", "dataformat", "options", ":", "END", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "Jackson", "Options", "/", "/", "dataformat", "options", ":", "START", "The", "JSon", "Jackson", "dataformat", "supports", "15", "options", "which", "are", "listed", "below", ".", "The", "JSon", "Jackson", "dataformat", "supports", "16", "options", "which", "are", "listed", "below", ".", "@", "@", "-", "44", ",", "6", "+", "44", ",", "7", "@", "@", "The", "JSon", "Jackson", "dataformat", "supports", "15", "options", "which", "are", "listed", "below", ".", "|", "enableFeatures", "|", "|", "String", "|", "Set", "of", "features", "to", "enable", "on", "the", "Jackson", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ".", "The", "features", "should", "be", "a", "name", "that", "matches", "a", "enum", "from", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "or", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "MapperFeature", "Multiple", "features", "can", "be", "separated", "by", "comma", "|", "disableFeatures", "|", "|", "String", "|", "Set", "of", "features", "to", "disable", "on", "the", "Jackson", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ".", "The", "features", "should", "be", "a", "name", "that", "matches", "a", "enum", "from", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "or", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "MapperFeature", "Multiple", "features", "can", "be", "separated", "by", "comma", "|", "permissions", "|", "|", "String", "|", "Adds", "permissions", "that", "controls", "which", "Java", "packages", "and", "classes", "XStream", "is", "allowed", "to", "use", "during", "unmarshal", "from", "xml", "/", "json", "to", "Java", "beans", ".", "A", "permission", "must", "be", "configured", "either", "here", "or", "globally", "using", "a", "JVM", "system", "property", ".", "The", "permission", "can", "be", "specified", "in", "a", "syntax", "where", "a", "plus", "sign", "is", "allow", "and", "minus", "sign", "is", "deny", ".", "Wildcards", "is", "supported", "by", "using", ".", "as", "prefix", ".", "For", "example", "to", "allow", "com", ".", "foo", "and", "all", "subpackages", "then", "specfy", "com", ".", "foo", ".", ".", "Multiple", "permissions", "can", "be", "configured", "separated", "by", "comma", "such", "as", "com", ".", "foo", ".", "-", "com", ".", "foo", ".", "bar", ".", "MySecretBean", ".", "The", "following", "default", "permission", "is", "always", "included", ":", "-", "java", ".", "lang", ".", "java", ".", "util", ".", "unless", "its", "overridden", "by", "specifying", "a", "JVM", "system", "property", "with", "they", "key", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", ".", "|", "allowUnmarshallType", "|", "false", "|", "Boolean", "|", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "|", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "{", "%", "endraw", "%", "}", "/", "/", "dataformat", "options", ":", "END", "@", "@", "-", "21", ",", "7", "+", "21", ",", "7", "@", "@", "Johnzon", "Options", "/", "/", "dataformat", "options", ":", "START", "The", "JSon", "Johnzon", "dataformat", "supports", "15", "options", "which", "are", "listed", "below", ".", "The", "JSon", "Johnzon", "dataformat", "supports", "16", "options", "which", "are", "listed", "below", ".", "@", "@", "-", "44", ",", "6", "+", "44", ",", "7", "@", "@", "The", "JSon", "Johnzon", "dataformat", "supports", "15", "options", "which", "are", "listed", "below", ".", "|", "enableFeatures", "|", "|", "String", "|", "Set", "of", "features", "to", "enable", "on", "the", "Jackson", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ".", "The", "features", "should", "be", "a", "name", "that", "matches", "a", "enum", "from", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "or", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "MapperFeature", "Multiple", "features", "can", "be", "separated", "by", "comma", "|", "disableFeatures", "|", "|", "String", "|", "Set", "of", "features", "to", "disable", "on", "the", "Jackson", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ".", "The", "features", "should", "be", "a", "name", "that", "matches", "a", "enum", "from", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "or", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "MapperFeature", "Multiple", "features", "can", "be", "separated", "by", "comma", "|", "permissions", "|", "|", "String", "|", "Adds", "permissions", "that", "controls", "which", "Java", "packages", "and", "classes", "XStream", "is", "allowed", "to", "use", "during", "unmarshal", "from", "xml", "/", "json", "to", "Java", "beans", ".", "A", "permission", "must", "be", "configured", "either", "here", "or", "globally", "using", "a", "JVM", "system", "property", ".", "The", "permission", "can", "be", "specified", "in", "a", "syntax", "where", "a", "plus", "sign", "is", "allow", "and", "minus", "sign", "is", "deny", ".", "Wildcards", "is", "supported", "by", "using", ".", "as", "prefix", ".", "For", "example", "to", "allow", "com", ".", "foo", "and", "all", "subpackages", "then", "specfy", "com", ".", "foo", ".", ".", "Multiple", "permissions", "can", "be", "configured", "separated", "by", "comma", "such", "as", "com", ".", "foo", ".", "-", "com", ".", "foo", ".", "bar", ".", "MySecretBean", ".", "The", "following", "default", "permission", "is", "always", "included", ":", "-", "java", ".", "lang", ".", "java", ".", "util", ".", "unless", "its", "overridden", "by", "specifying", "a", "JVM", "system", "property", "with", "they", "key", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", ".", "|", "allowUnmarshallType", "|", "false", "|", "Boolean", "|", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "|", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "{", "%", "endraw", "%", "}", "/", "/", "dataformat", "options", ":", "END", "@", "@", "-", "27", ",", "7", "+", "27", ",", "7", "@", "@", "Options", "^", "^^", "^^", "^^", "/", "/", "dataformat", "options", ":", "START", "The", "JSon", "XStream", "dataformat", "supports", "15", "options", "which", "are", "listed", "below", ".", "The", "JSon", "XStream", "dataformat", "supports", "16", "options", "which", "are", "listed", "below", ".", "@", "@", "-", "50", ",", "6", "+", "50", ",", "7", "@", "@", "The", "JSon", "XStream", "dataformat", "supports", "15", "options", "which", "are", "listed", "below", ".", "|", "enableFeatures", "|", "|", "String", "|", "Set", "of", "features", "to", "enable", "on", "the", "Jackson", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ".", "The", "features", "should", "be", "a", "name", "that", "matches", "a", "enum", "from", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "or", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "MapperFeature", "Multiple", "features", "can", "be", "separated", "by", "comma", "|", "disableFeatures", "|", "|", "String", "|", "Set", "of", "features", "to", "disable", "on", "the", "Jackson", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ".", "The", "features", "should", "be", "a", "name", "that", "matches", "a", "enum", "from", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "SerializationFeature", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "DeserializationFeature", "or", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "MapperFeature", "Multiple", "features", "can", "be", "separated", "by", "comma", "|", "permissions", "|", "|", "String", "|", "Adds", "permissions", "that", "controls", "which", "Java", "packages", "and", "classes", "XStream", "is", "allowed", "to", "use", "during", "unmarshal", "from", "xml", "/", "json", "to", "Java", "beans", ".", "A", "permission", "must", "be", "configured", "either", "here", "or", "globally", "using", "a", "JVM", "system", "property", ".", "The", "permission", "can", "be", "specified", "in", "a", "syntax", "where", "a", "plus", "sign", "is", "allow", "and", "minus", "sign", "is", "deny", ".", "Wildcards", "is", "supported", "by", "using", ".", "as", "prefix", ".", "For", "example", "to", "allow", "com", ".", "foo", "and", "all", "subpackages", "then", "specfy", "com", ".", "foo", ".", ".", "Multiple", "permissions", "can", "be", "configured", "separated", "by", "comma", "such", "as", "com", ".", "foo", ".", "-", "com", ".", "foo", ".", "bar", ".", "MySecretBean", ".", "The", "following", "default", "permission", "is", "always", "included", ":", "-", "java", ".", "lang", ".", "java", ".", "util", ".", "unless", "its", "overridden", "by", "specifying", "a", "JVM", "system", "property", "with", "they", "key", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", ".", "|", "allowUnmarshallType", "|", "false", "|", "Boolean", "|", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "|", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "{", "%", "endraw", "%", "}", "/", "/", "dataformat", "options", ":", "END"], "docstring_tokens": ["object", "de-serialization"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "4217", ",", "6", "+", "4217", ",", "47", "@", "@", "static", "int", "truncate_space_check", "(", "struct", "btrfs_trans_handle", "*", "trans", ",", "}", "static", "int", "truncate_inline_extent", "(", "struct", "inode", "*", "inode", ",", "struct", "btrfs_path", "*", "path", ",", "struct", "btrfs_key", "*", "found_key", ",", "const", "u64", "item_end", ",", "const", "u64", "new_size", ")", "{", "struct", "extent_buffer", "*", "leaf", "=", "path", "-", ">", "nodes", "[", "0", "]", ";", "int", "slot", "=", "path", "-", ">", "slots", "[", "0", "]", ";", "struct", "btrfs_file_extent_item", "*", "fi", ";", "u32", "size", "=", "(", "u32", ")", "(", "new_size", "-", "found_key", "-", ">", "offset", ")", ";", "struct", "btrfs_root", "*", "root", "=", "BTRFS_I", "(", "inode", ")", "->", "root", ";", "fi", "=", "btrfs_item_ptr", "(", "leaf", ",", "slot", ",", "struct", "btrfs_file_extent_item", ")", ";", "if", "(", "btrfs_file_extent_compression", "(", "leaf", ",", "fi", ")", "!", "=", "BTRFS_COMPRESS_NONE", ")", "{", "loff_t", "offset", "=", "new_size", ";", "loff_t", "page_end", "=", "ALIGN", "(", "offset", ",", "PAGE_CACHE_SIZE", ")", ";", "/", "*", "*", "Zero", "out", "the", "remaining", "of", "the", "last", "page", "of", "our", "inline", "extent", ",", "*", "instead", "of", "directly", "truncating", "our", "inline", "extent", "here", "-", "that", "*", "would", "be", "much", "more", "complex", "(", "decompressing", "all", "the", "data", ",", "then", "*", "compressing", "the", "truncated", "data", ",", "which", "might", "be", "bigger", "than", "*", "the", "size", "of", "the", "inline", "extent", ",", "resize", "the", "extent", ",", "etc", ")", ".", "*", "We", "release", "the", "path", "because", "to", "get", "the", "page", "we", "might", "need", "to", "*", "read", "the", "extent", "item", "from", "disk", "(", "data", "not", "in", "the", "page", "cache", ")", ".", "*", "/", "btrfs_release_path", "(", "path", ")", ";", "return", "btrfs_truncate_page", "(", "inode", ",", "offset", ",", "page_end", "-", "offset", ",", "0", ")", ";", "}", "btrfs_set_file_extent_ram_bytes", "(", "leaf", ",", "fi", ",", "size", ")", ";", "size", "=", "btrfs_file_extent_calc_inline_size", "(", "size", ")", ";", "btrfs_truncate_item", "(", "root", ",", "path", ",", "size", ",", "1", ")", ";", "if", "(", "test_bit", "(", "BTRFS_ROOT_REF_COWS", ",", "&", "root", "-", ">", "state", ")", ")", "inode_sub_bytes", "(", "inode", ",", "item_end", "+", "1", "-", "new_size", ")", ";", "return", "0", ";", "}", "/", "*", "*", "this", "can", "truncate", "away", "extent", "items", ",", "csum", "items", "and", "directory", "items", ".", "*", "It", "starts", "at", "a", "high", "offset", "and", "removes", "keys", "until", "it", "can", "'", "t", "find", "@", "@", "-", "4411", ",", "27", "+", "4452", ",", "40", "@", "@", "int", "btrfs_truncate_inode_items", "(", "struct", "btrfs_trans_handle", "*", "trans", ",", "*", "special", "encodings", "*", "/", "if", "(", "!", "del_item", "&", "&", "btrfs_file_extent_compression", "(", "leaf", ",", "fi", ")", "=", "=", "0", "&", "&", "btrfs_file_extent_encryption", "(", "leaf", ",", "fi", ")", "=", "=", "0", "&", "&", "btrfs_file_extent_other_encoding", "(", "leaf", ",", "fi", ")", "=", "=", "0", ")", "{", "u32", "size", "=", "new_size", "-", "found_key", ".", "offset", ";", "if", "(", "test_bit", "(", "BTRFS_ROOT_REF_COWS", ",", "&", "root", "-", ">", "state", ")", ")", "inode_sub_bytes", "(", "inode", ",", "item_end", "+", "1", "new_size", ")", ";", "/", "*", "*", "update", "the", "ram", "bytes", "to", "properly", "reflect", "*", "the", "new", "size", "of", "our", "item", "*", "Need", "to", "release", "path", "in", "order", "to", "truncate", "a", "*", "compressed", "extent", ".", "So", "delete", "any", "accumulated", "*", "extent", "items", "so", "far", ".", "*", "/", "btrfs_set_file_extent_ram_bytes", "(", "leaf", ",", "fi", ",", "size", ")", ";", "size", "=", "btrfs_file_extent_calc_inline_size", "(", "size", ")", ";", "btrfs_truncate_item", "(", "root", ",", "path", ",", "size", ",", "1", ")", ";", "if", "(", "btrfs_file_extent_compression", "(", "leaf", ",", "fi", ")", "!", "=", "BTRFS_COMPRESS_NONE", "&", "&", "pending_del_nr", ")", "{", "err", "=", "btrfs_del_items", "(", "trans", ",", "root", ",", "path", ",", "pending_del_slot", ",", "pending_del_nr", ")", ";", "if", "(", "err", ")", "{", "btrfs_abort_transaction", "(", "trans", ",", "root", ",", "err", ")", ";", "goto", "error", ";", "}", "pending_del_nr", "=", "0", ";", "}", "err", "=", "truncate_inline_extent", "(", "inode", ",", "path", ",", "&", "found_key", ",", "item_end", ",", "new_size", ")", ";", "if", "(", "err", ")", "{", "btrfs_abort_transaction", "(", "trans", ",", "root", ",", "err", ")", ";", "goto", "error", ";", "}", "}", "else", "if", "(", "test_bit", "(", "BTRFS_ROOT_REF_COWS", ",", "&", "root", "-", ">", "state", ")", ")", "{", "inode_sub_bytes", "(", "inode", ",", "item_end", "+", "1", "found_key", ".", "offset", ")", ";", "inode_sub_bytes", "(", "inode", ",", "item_end", "+", "1", "-", "new_size", ")", ";", "}", "}", "delete", ":"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "910", ",", "6", "+", "910", ",", "15", "@", "@", "struct", "ext4_inode_info", "{", "*", "by", "other", "means", ",", "so", "we", "have", "i_data_sem", ".", "*", "/", "struct", "rw_semaphore", "i_data_sem", ";", "/", "*", "*", "i_mmap_sem", "is", "for", "serializing", "page", "faults", "with", "truncate", "/", "punch", "hole", "*", "operations", ".", "We", "have", "to", "make", "sure", "that", "new", "page", "cannot", "be", "faulted", "in", "*", "a", "section", "of", "the", "inode", "that", "is", "being", "punched", ".", "We", "cannot", "easily", "use", "*", "i_data_sem", "for", "this", "since", "we", "need", "protection", "for", "the", "whole", "punch", "*", "operation", "and", "i_data_sem", "ranks", "below", "transaction", "start", "so", "we", "have", "*", "to", "occasionally", "drop", "it", ".", "*", "/", "struct", "rw_semaphore", "i_mmap_sem", ";", "struct", "inode", "vfs_inode", ";", "struct", "jbd2_inode", "*", "jinode", ";", "@", "@", "-", "2484", ",", "6", "+", "2493", ",", "7", "@", "@", "extern", "int", "ext4_chunk_trans_blocks", "(", "struct", "inode", "*", ",", "int", "nrblocks", ")", ";", "extern", "int", "ext4_zero_partial_blocks", "(", "handle_t", "*", "handle", ",", "struct", "inode", "*", "inode", ",", "loff_t", "lstart", ",", "loff_t", "lend", ")", ";", "extern", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", ";", "extern", "int", "ext4_filemap_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", ";", "extern", "qsize_t", "*", "ext4_get_reserved_space", "(", "struct", "inode", "*", "inode", ")", ";", "extern", "void", "ext4_da_update_reserve_space", "(", "struct", "inode", "*", "inode", ",", "int", "used", ",", "int", "quota_claim", ")", ";", "@", "@", "-", "4770", ",", "7", "+", "4770", ",", "6", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "int", "partial_begin", ",", "partial_end", ";", "loff_t", "start", ",", "end", ";", "ext4_lblk_t", "lblk", ";", "struct", "address_space", "*", "mapping", "=", "inode", "-", ">", "i_mapping", ";", "unsigned", "int", "blkbits", "=", "inode", "-", ">", "i_blkbits", ";", "trace_ext4_zero_range", "(", "inode", ",", "offset", ",", "len", ",", "mode", ")", ";", "@", "@", "-", "4785", ",", "17", "+", "4784", ",", "6", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "return", "ret", ";", "}", "/", "*", "*", "Write", "out", "all", "dirty", "pages", "to", "avoid", "race", "conditions", "*", "Then", "release", "them", ".", "*", "/", "if", "(", "mapping", "-", ">", "nrpages", "&", "&", "mapping_tagged", "(", "mapping", ",", "PAGECACHE_TAG_DIRTY", ")", ")", "{", "ret", "=", "filemap_write_and_wait_range", "(", "mapping", ",", "offset", ",", "offset", "+", "len", "-", "1", ")", ";", "if", "(", "ret", ")", "return", "ret", ";", "}", "/", "*", "*", "Round", "up", "offset", ".", "This", "is", "not", "fallocate", ",", "we", "neet", "to", "zero", "out", "*", "blocks", ",", "so", "convert", "interior", "block", "aligned", "part", "of", "the", "range", "to", "@", "@", "-", "4856", ",", "16", "+", "4844", ",", "22", "@", "@", "static", "long", "ext4_zero_range", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "flags", "|", "=", "(", "EXT4_GET_BLOCKS_CONVERT_UNWRITTEN", "|", "EXT4_EX_NOCACHE", ")", ";", "/", "*", "Now", "release", "the", "pages", "and", "zero", "block", "aligned", "part", "of", "pages", "*", "/", "truncate_pagecache_range", "(", "inode", ",", "start", ",", "end", "-", "1", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "*", "released", "from", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "Now", "release", "the", "pages", "and", "zero", "block", "aligned", "part", "of", "pages", "*", "/", "truncate_pagecache_range", "(", "inode", ",", "start", ",", "end", "-", "1", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "ret", "=", "ext4_alloc_file_blocks", "(", "file", ",", "lblk", ",", "max_blocks", ",", "new_size", ",", "flags", ",", "mode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "ret", ")", "goto", "out_dio", ";", "}", "@", "@", "-", "5524", ",", "17", "+", "5518", ",", "22", "@", "@", "int", "ext4_collapse_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "goto", "out_mutex", ";", "}", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "/", "*", "Wait", "for", "existing", "dio", "to", "complete", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "handle", "=", "ext4_journal_start", "(", "inode", ",", "EXT4_HT_TRUNCATE", ",", "credits", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "handle", ")", ";", "goto", "out_dio", ";", "goto", "out_mmap", ";", "}", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_data_sem", ")", ";", "@", "@", "-", "5573", ",", "7", "+", "5572", ",", "8", "@", "@", "int", "ext4_collapse_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "out_mmap", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "5660", ",", "17", "+", "5660", ",", "22", "@", "@", "int", "ext4_insert_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "goto", "out_mutex", ";", "}", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "/", "*", "Wait", "for", "existing", "dio", "to", "complete", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_pagecache", "(", "inode", ",", "ioffset", ")", ";", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "handle", "=", "ext4_journal_start", "(", "inode", ",", "EXT4_HT_TRUNCATE", ",", "credits", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "handle", ")", ";", "goto", "out_dio", ";", "goto", "out_mmap", ";", "}", "/", "*", "Expand", "file", "to", "avoid", "data", "loss", "if", "there", "is", "error", "while", "shifting", "*", "/", "@", "@", "-", "5741", ",", "7", "+", "5746", ",", "8", "@", "@", "int", "ext4_insert_range", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "len", ")", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "out_mmap", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "209", ",", "15", "+", "209", ",", "18", "@", "@", "static", "int", "ext4_dax_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "int", "result", ";", "handle_t", "*", "handle", "=", "NULL", ";", "struct", "super_block", "*", "sb", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", "->", "i_sb", ";", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "struct", "super_block", "*", "sb", "=", "inode", "-", ">", "i_sb", ";", "bool", "write", "=", "vmf", "-", ">", "flags", "&", "FAULT_FLAG_WRITE", ";", "if", "(", "write", ")", "{", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "handle", "=", "ext4_journal_start_sb", "(", "sb", ",", "EXT4_HT_WRITE_PAGE", ",", "EXT4_DATA_TRANS_BLOCKS", "(", "sb", ")", ");", "}", "}", "else", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "result", "=", "VM_FAULT_SIGBUS", ";", "@", "@", "-", "228", ",", "8", "+", "231", ",", "10", "@", "@", "static", "int", "ext4_dax_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "if", "(", "write", ")", "{", "if", "(", "!", "IS_ERR", "(", "handle", ")", ")", "ext4_journal_stop", "(", "handle", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "}", "}", "else", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "result", ";", "}", "@", "@", "-", "246", ",", "10", "+", "251", ",", "12", "@", "@", "static", "int", "ext4_dax_pmd_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "addr", ",", "if", "(", "write", ")", "{", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "handle", "=", "ext4_journal_start_sb", "(", "sb", ",", "EXT4_HT_WRITE_PAGE", ",", "ext4_chunk_trans_blocks", "(", "inode", ",", "PMD_SIZE", "/", "PAGE_SIZE", ")", ");", "}", "}", "else", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "result", "=", "VM_FAULT_SIGBUS", ";", "@", "@", "-", "260", ",", "30", "+", "267", ",", "71", "@", "@", "static", "int", "ext4_dax_pmd_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "addr", ",", "if", "(", "write", ")", "{", "if", "(", "!", "IS_ERR", "(", "handle", ")", ")", "ext4_journal_stop", "(", "handle", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "}", "}", "else", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "result", ";", "}", "static", "int", "ext4_dax_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "return", "dax_mkwrite", "(", "vma", ",", "vmf", ",", "ext4_get_block_dax", ",", "ext4_end_io_unwritten", ")", ";", "int", "err", ";", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "sb_start_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "err", "=", "__dax_mkwrite", "(", "vma", ",", "vmf", ",", "ext4_get_block_dax", ",", "ext4_end_io_unwritten", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "return", "err", ";", "}", "/", "*", "*", "Handle", "write", "fault", "for", "VM_MIXEDMAP", "mappings", ".", "Similarly", "to", "ext4_dax_mkwrite", "(", ")", "*", "handler", "we", "check", "for", "races", "agaist", "truncate", ".", "Note", "that", "since", "we", "cycle", "through", "*", "i_mmap_sem", ",", "we", "are", "sure", "that", "also", "any", "hole", "punching", "that", "began", "before", "we", "*", "were", "called", "is", "finished", "by", "now", "and", "so", "if", "it", "included", "part", "of", "the", "file", "we", "*", "are", "working", "on", ",", "our", "pte", "will", "get", "unmapped", "and", "the", "check", "for", "pte_same", "(", ")", "in", "*", "wp_pfn_shared", "(", ")", "fails", ".", "Thus", "fault", "gets", "retried", "and", "things", "work", "out", "as", "*", "desired", ".", "*", "/", "static", "int", "ext4_dax_pfn_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "struct", "super_block", "*", "sb", "=", "inode", "-", ">", "i_sb", ";", "int", "ret", "=", "VM_FAULT_NOPAGE", ";", "loff_t", "size", ";", "sb_start_pagefault", "(", "sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "size", "=", "(", "i_size_read", "(", "inode", ")", "+", "PAGE_SIZE", "-", "1", ")", ">", ">", "PAGE_SHIFT", ";", "if", "(", "vmf", "-", ">", "pgoff", ">", "=", "size", ")", "ret", "=", "VM_FAULT_SIGBUS", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "sb", ")", ";", "return", "ret", ";", "}", "static", "const", "struct", "vm_operations_struct", "ext4_dax_vm_ops", "=", "{", ".", "fault", "=", "ext4_dax_fault", ",", ".", "pmd_fault", "=", "ext4_dax_pmd_fault", ",", ".", "page_mkwrite", "=", "ext4_dax_mkwrite", ",", ".", "pfn_mkwrite", "=", "dax_pfn_mkwrite", ",", ".", "pfn_mkwrite", "=", "ext4_dax_pfn_mkwrite", ",", "}", ";", "#", "else", "#", "define", "ext4_dax_vm_ops", "ext4_file_vm_ops", "#", "endif", "static", "const", "struct", "vm_operations_struct", "ext4_file_vm_ops", "=", "{", ".", "fault", "=", "filemap_fault", ",", ".", "fault", "=", "ext4_filemap_fault", ",", ".", "map_pages", "=", "filemap_map_pages", ",", ".", "page_mkwrite", "=", "ext4_page_mkwrite", ",", "}", ";", "@", "@", "-", "3623", ",", "6", "+", "3623", ",", "15", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "}", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "/", "*", "*", "Prevent", "page", "faults", "from", "reinstantiating", "pages", "we", "have", "released", "from", "*", "page", "cache", ".", "*", "/", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "first_block_offset", "=", "round_up", "(", "offset", ",", "sb", "-", ">", "s_blocksize", ")", ";", "last_block_offset", "=", "round_down", "(", "(", "offset", "+", "length", ")", ",", "sb", "-", ">", "s_blocksize", ")", "-", "1", ";", "@", "@", "-", "3631", ",", "10", "+", "3640", ",", "6", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "truncate_pagecache_range", "(", "inode", ",", "first_block_offset", ",", "last_block_offset", ")", ";", "/", "*", "Wait", "all", "existing", "dio", "workers", ",", "newcomers", "will", "block", "on", "i_mutex", "*", "/", "ext4_inode_block_unlocked_dio", "(", "inode", ")", ";", "inode_dio_wait", "(", "inode", ")", ";", "if", "(", "ext4_test_inode_flag", "(", "inode", ",", "EXT4_INODE_EXTENTS", ")", ")", "credits", "=", "ext4_writepage_trans_blocks", "(", "inode", ")", ";", "else", "@", "@", "-", "3680", ",", "16", "+", "3685", ",", "12", "@", "@", "int", "ext4_punch_hole", "(", "struct", "inode", "*", "inode", ",", "loff_t", "offset", ",", "loff_t", "length", ")", "if", "(", "IS_SYNC", "(", "inode", ")", ")", "ext4_handle_sync", "(", "handle", ")", ";", "/", "*", "Now", "release", "the", "pages", "again", "to", "reduce", "race", "window", "*", "/", "if", "(", "last_block_offset", ">", "first_block_offset", ")", "truncate_pagecache_range", "(", "inode", ",", "first_block_offset", ",", "last_block_offset", ")", ";", "inode", "-", ">", "i_mtime", "=", "inode", "-", ">", "i_ctime", "=", "ext4_current_time", "(", "inode", ")", ";", "ext4_mark_inode_dirty", "(", "handle", ",", "inode", ")", ";", "out_stop", ":", "ext4_journal_stop", "(", "handle", ")", ";", "out_dio", ":", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "ext4_inode_resume_unlocked_dio", "(", "inode", ")", ";", "out_mutex", ":", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "@", "@", "-", "4823", ",", "13", "+", "4824", ",", "15", "@", "@", "int", "ext4_setattr", "(", "struct", "dentry", "*", "dentry", ",", "struct", "iattr", "*", "attr", ")", "}", "else", "ext4_wait_for_tail_page_commit", "(", "inode", ")", ";", "}", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "*", "Truncate", "pagecache", "after", "we", "'", "ve", "waited", "for", "commit", "*", "in", "data", "=", "journal", "mode", "to", "make", "pages", "freeable", ".", "*", "/", "truncate_pagecache", "(", "inode", ",", "inode", "-", ">", "i_size", ")", ";", "if", "(", "shrink", ")", "ext4_truncate", "(", "inode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "}", "if", "(", "!", "rc", ")", "{", "@", "@", "-", "5278", ",", "6", "+", "5281", ",", "8", "@", "@", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "sb_start_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "file_update_time", "(", "vma", "-", ">", "vm_file", ")", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "/", "*", "Delalloc", "case", "is", "easy", ".", "..", "*", "/", "if", "(", "test_opt", "(", "inode", "-", ">", "i_sb", ",", "DELALLOC", ")", "&", "&", "!", "ext4_should_journal_data", "(", "inode", ")", "&", "&", "@", "@", "-", "5347", ",", "6", "+", "5352", ",", "19", "@", "@", "int", "ext4_page_mkwrite", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "out_ret", ":", "ret", "=", "block_page_mkwrite_return", "(", "ret", ")", ";", "out", ":", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "sb_end_pagefault", "(", "inode", "-", ">", "i_sb", ")", ";", "return", "ret", ";", "}", "int", "ext4_filemap_fault", "(", "struct", "vm_area_struct", "*", "vma", ",", "struct", "vm_fault", "*", "vmf", ")", "{", "struct", "inode", "*", "inode", "=", "file_inode", "(", "vma", "-", ">", "vm_file", ")", ";", "int", "err", ";", "down_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "err", "=", "filemap_fault", "(", "vma", ",", "vmf", ")", ";", "up_read", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "return", "err", ";", "}", "@", "@", "-", "958", ",", "6", "+", "958", ",", "7", "@", "@", "static", "void", "init_once", "(", "void", "*", "foo", ")", "INIT_LIST_HEAD", "(", "&", "ei", "-", ">", "i_orphan", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "xattr_sem", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "i_data_sem", ")", ";", "init_rwsem", "(", "&", "ei", "-", ">", "i_mmap_sem", ")", ";", "inode_init_once", "(", "&", "ei", "-", ">", "vfs_inode", ")", ";", "}", "@", "@", "-", "10", ",", "8", "+", "10", ",", "10", "@", "@", "*", "/", "static", "inline", "void", "ext4_truncate_failed_write", "(", "struct", "inode", "*", "inode", ")", "{", "down_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "truncate_inode_pages", "(", "inode", "-", ">", "i_mapping", ",", "inode", "-", ">", "i_size", ")", ";", "ext4_truncate", "(", "inode", ")", ";", "up_write", "(", "&", "EXT4_I", "(", "inode", ")", "->", "i_mmap_sem", ")", ";", "}", "/", "*"], "docstring_tokens": ["race", "conditions"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "90", ",", "6", "+", "90", ",", "7", "@", "@", "import", "org", ".", "jenkinsci", ".", "plugins", ".", "jobgenerator", ".", "JobGenerator", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "/", "**", "*", "Wraps", "a", "build", "with", "pre", "and", "post", "build", "steps", ".", "These", "steps", "can", "take", "@", "@", "-", "659", ",", "7", "+", "660", ",", "8", "@", "@", "public", "ParameterDefinition", "getParameterDefinition", "(", "String", "name", ")", "{", "public", "boolean", "isOverrideBuildParameters", "(", ")", "{", "return", "overrideBuildParameters", ";", "}", "@", "RequirePOST", "public", "void", "doSubmit", "(", "StaplerRequest", "req", ",", "StaplerResponse", "resp", ")", "throws", "IOException", ",", "ServletException", "{", "/", "/", "verify", "permission", "ReleaseWrapper", ".", "checkReleasePermission", "(", "project", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "87", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2017", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "plugins", ".", "release", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "FailingHttpStatusCodeException", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "HttpMethod", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "WebRequest", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlCheckBoxInput", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "hudson", ".", "model", ".", "FreeStyleProject", ";", "import", "org", ".", "apache", ".", "http", ".", "HttpStatus", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "public", "class", "TestReleaseWrapper", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "607", "\"", ")", "public", "void", "ensurePostIsRequiredForSubmit", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setCrumbIssuer", "(", "null", ")", ";", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "FreeStyleProject", "job", "=", "j", ".", "createFreeStyleProject", "(", "\"", "test", "\"", ");", "String", "submitUrl", "=", "job", ".", "getShortUrl", "(", ")", "+", "\"", "release", "/", "submit", "\"", ";", "URL", "releaseSubmitUrl", "=", "new", "URL", "(", "j", ".", "getURL", "(", ")", "+", "submitUrl", ")", ";", "/", "/", "the", "release", "plugin", "is", "not", "activated", "yet", ",", "so", "the", "page", "does", "not", "exist", "for", "the", "moment", "try", "{", "wc", ".", "getPage", "(", "new", "WebRequest", "(", "releaseSubmitUrl", ",", "HttpMethod", ".", "POST", ")", ");", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "assertEquals", "(", "HttpStatus", ".", "SC_NOT_FOUND", ",", "e", ".", "getStatusCode", "(", "))", ";", "}", "/", "/", "enable", "the", "release", "feature", "for", "that", "job", "HtmlForm", "configForm", "=", "j", ".", "createWebClient", "(", ").", "getPage", "(", "job", ",", "\"", "configure", "\"", ").", "getFormByName", "(", "\"", "config", "\"", ");", "HtmlCheckBoxInput", "releaseCheckButton", "=", "configForm", ".", "getInputByName", "(", "\"", "hudson", "-", "plugins", "-", "release", "-", "ReleaseWrapper", "\"", ");", "releaseCheckButton", ".", "setChecked", "(", "true", ")", ";", "HtmlPage", "configPageSubmit", "=", "j", ".", "submit", "(", "configForm", ")", ";", "assertEquals", "(", "HttpStatus", ".", "SC_OK", ",", "configPageSubmit", ".", "getWebResponse", "(", ").", "getStatusCode", "(", "))", ";", "/", "/", "the", "GET", "method", "is", "not", "allowed", "try", "{", "wc", ".", "goTo", "(", "submitUrl", ")", ";", "fail", "(", ");", "}", "catch", "(", "FailingHttpStatusCodeException", "e", ")", "{", "Assert", ".", "assertEquals", "(", "HttpStatus", ".", "SC_METHOD_NOT_ALLOWED", ",", "e", ".", "getStatusCode", "(", "))", ";", "}", "/", "/", "the", "POST", "method", "must", "be", "used", "to", "submit", "a", "form", "Page", "successSubmit", "=", "wc", ".", "getPage", "(", "new", "WebRequest", "(", "new", "URL", "(", "j", ".", "getURL", "(", ")", "+", "submitUrl", ")", ",", "HttpMethod", ".", "POST", ")", ");", "Assert", ".", "assertEquals", "(", "HttpStatus", ".", "SC_OK", ",", "successSubmit", ".", "getWebResponse", "(", ").", "getStatusCode", "(", "))", ";", "}", "}"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "196", ",", "6", "+", "196", ",", "7", "@", "@", "void", "f2fs_inode_chksum_set", "(", "struct", "f2fs_sb_info", "*", "sbi", ",", "struct", "page", "*", "page", ")", "static", "bool", "sanity_check_inode", "(", "struct", "inode", "*", "inode", ",", "struct", "page", "*", "node_page", ")", "{", "struct", "f2fs_sb_info", "*", "sbi", "=", "F2FS_I_SB", "(", "inode", ")", ";", "struct", "f2fs_inode_info", "*", "fi", "=", "F2FS_I", "(", "inode", ")", ";", "unsigned", "long", "long", "iblocks", ";", "iblocks", "=", "le64_to_cpu", "(", "F2FS_INODE", "(", "node_page", ")", "->", "i_blocks", ")", ";", "@", "@", "-", "237", ",", "6", "+", "238", ",", "17", "@", "@", "static", "bool", "sanity_check_inode", "(", "struct", "inode", "*", "inode", ",", "struct", "page", "*", "node_page", ")", "return", "false", ";", "}", "if", "(", "fi", "-", ">", "i_extra_isize", ">", "F2FS_TOTAL_EXTRA_ATTR_SIZE", "|", "|", "fi", "-", ">", "i_extra_isize", "%", "sizeof", "(", "__le32", ")", ")", "{", "set_sbi_flag", "(", "sbi", ",", "SBI_NEED_FSCK", ")", ";", "f2fs_msg", "(", "sbi", "-", ">", "sb", ",", "KERN_WARNING", ",", "\"", "%", "s", ":", "inode", "(", "ino", "=", "%", "lx", ")", "has", "corrupted", "i_extra_isize", ":", "%", "d", ",", "\"", "\"", "max", ":", "%", "zu", "\"", ",", "__func__", ",", "inode", "-", ">", "i_ino", ",", "fi", "-", ">", "i_extra_isize", ",", "F2FS_TOTAL_EXTRA_ATTR_SIZE", ")", ";", "return", "false", ";", "}", "if", "(", "F2FS_I", "(", "inode", ")", "->", "extent_tree", ")", "{", "struct", "extent_info", "*", "ei", "=", "&", "F2FS_I", "(", "inode", ")", "->", "extent_tree", "-", ">", "largest", ";", "@", "@", "-", "305", ",", "11", "+", "317", ",", "6", "@", "@", "static", "int", "do_read_inode", "(", "struct", "inode", "*", "inode", ")", "get_inline_info", "(", "inode", ",", "ri", ")", ";", "if", "(", "!", "sanity_check_inode", "(", "inode", ",", "node_page", ")", ")", "{", "f2fs_put_page", "(", "node_page", ",", "1", ")", ";", "return", "-", "EINVAL", ";", "}", "fi", "-", ">", "i_extra_isize", "=", "f2fs_has_extra_attr", "(", "inode", ")", "?", "le16_to_cpu", "(", "ri", "-", ">", "i_extra_isize", ")", ":", "0", ";", "@", "@", "-", "329", ",", "6", "+", "336", ",", "11", "@", "@", "static", "int", "do_read_inode", "(", "struct", "inode", "*", "inode", ")", "fi", "-", ">", "i_inline_xattr_size", "=", "0", ";", "}", "if", "(", "!", "sanity_check_inode", "(", "inode", ",", "node_page", ")", ")", "{", "f2fs_put_page", "(", "node_page", ",", "1", ")", ";", "return", "-", "EINVAL", ";", "}", "/", "*", "check", "data", "exist", "*", "/", "if", "(", "f2fs_has_inline_data", "(", "inode", ")", "&", "&", "!", "f2fs_exist_data", "(", "inode", ")", ")", "__recover_inline_status", "(", "inode", ",", "node_page", ")", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "880", ",", "7", "+", "880", ",", "7", "@", "@", "static", "void", "netbk_tx_err", "(", "struct", "xenvif", "*", "vif", ",", "do", "{", "make_tx_response", "(", "vif", ",", "txp", ",", "XEN_NETIF_RSP_ERROR", ")", ";", "if", "(", "cons", ">", "=", "end", ")", "if", "(", "cons", "=", "=", "end", ")", "break", ";", "txp", "=", "RING_GET_REQUEST", "(", "&", "vif", "-", ">", "tx", ",", "cons", "+", "+)", ";", "}", "while", "(", "1", ")", ";"], "docstring_tokens": ["pointer", "corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "277", ",", "6", "+", "277", ",", "33", "@", "@", "static", "inline", "int", "dname_external", "(", "const", "struct", "dentry", "*", "dentry", ")", "return", "dentry", "-", ">", "d_name", ".", "name", "!", "=", "dentry", "-", ">", "d_iname", ";", "}", "void", "take_dentry_name_snapshot", "(", "struct", "name_snapshot", "*", "name", ",", "struct", "dentry", "*", "dentry", ")", "{", "spin_lock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "if", "(", "unlikely", "(", "dname_external", "(", "dentry", ")", "))", "{", "struct", "external_name", "*", "p", "=", "external_name", "(", "dentry", ")", ";", "atomic_inc", "(", "&", "p", "-", ">", "u", ".", "count", ")", ";", "spin_unlock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "name", "-", ">", "name", "=", "p", "-", ">", "name", ";", "}", "else", "{", "memcpy", "(", "name", "-", ">", "inline_name", ",", "dentry", "-", ">", "d_iname", ",", "DNAME_INLINE_LEN", ")", ";", "spin_unlock", "(", "&", "dentry", "-", ">", "d_lock", ")", ";", "name", "-", ">", "name", "=", "name", "-", ">", "inline_name", ";", "}", "}", "EXPORT_SYMBOL", "(", "take_dentry_name_snapshot", ")", ";", "void", "release_dentry_name_snapshot", "(", "struct", "name_snapshot", "*", "name", ")", "{", "if", "(", "unlikely", "(", "name", "-", ">", "name", "!", "=", "name", "-", ">", "inline_name", ")", ")", "{", "struct", "external_name", "*", "p", ";", "p", "=", "container_of", "(", "name", "-", ">", "name", ",", "struct", "external_name", ",", "name", "[", "0", "]", ");", "if", "(", "unlikely", "(", "atomic_dec_and_test", "(", "&", "p", "-", ">", "u", ".", "count", ")", "))", "kfree_rcu", "(", "p", ",", "u", ".", "head", ")", ";", "}", "}", "EXPORT_SYMBOL", "(", "release_dentry_name_snapshot", ")", ";", "static", "inline", "void", "__d_set_inode_and_type", "(", "struct", "dentry", "*", "dentry", ",", "struct", "inode", "*", "inode", ",", "unsigned", "type_flags", ")", "@", "@", "-", "766", ",", "7", "+", "766", ",", "7", "@", "@", "struct", "dentry", "*", "debugfs_rename", "(", "struct", "dentry", "*", "old_dir", ",", "struct", "dentry", "*", "old_dentry", ",", "{", "int", "error", ";", "struct", "dentry", "*", "dentry", "=", "NULL", ",", "*", "trap", ";", "const", "char", "*", "old_name", ";", "struct", "name_snapshot", "old_name", ";", "trap", "=", "lock_rename", "(", "new_dir", ",", "old_dir", ")", ";", "/", "*", "Source", "or", "destination", "directories", "don", "'", "t", "exist", "?", "*", "/", "@", "@", "-", "781", ",", "19", "+", "781", ",", "19", "@", "@", "struct", "dentry", "*", "debugfs_rename", "(", "struct", "dentry", "*", "old_dir", ",", "struct", "dentry", "*", "old_dentry", ",", "if", "(", "IS_ERR", "(", "dentry", ")", "|", "|", "dentry", "=", "=", "trap", "|", "|", "d_really_is_positive", "(", "dentry", ")", ")", "goto", "exit", ";", "old_name", "=", "fsnotify_oldname_init", "(", "old_dentry", "-", ">", "d_name", ".", "name", ")", ";", "take_dentry_name_snapshot", "(", "&", "old_name", ",", "old_dentry", ")", ";", "error", "=", "simple_rename", "(", "d_inode", "(", "old_dir", ")", ",", "old_dentry", ",", "d_inode", "(", "new_dir", ")", ",", "dentry", ",", "0", ")", ";", "if", "(", "error", ")", "{", "fsnotify_oldname_free", "(", "old_name", ")", ";", "release_dentry_name_snapshot", "(", "&", "old_name", ")", ";", "goto", "exit", ";", "}", "d_move", "(", "old_dentry", ",", "dentry", ")", ";", "fsnotify_move", "(", "d_inode", "(", "old_dir", ")", ",", "d_inode", "(", "new_dir", ")", ",", "old_name", ",", "fsnotify_move", "(", "d_inode", "(", "old_dir", ")", ",", "d_inode", "(", "new_dir", ")", ",", "old_name", ".", "name", ",", "d_is_dir", "(", "old_dentry", ")", ",", "NULL", ",", "old_dentry", ")", ";", "fsnotify_oldname_free", "(", "old_name", ")", ";", "release_dentry_name_snapshot", "(", "&", "old_name", ")", ";", "unlock_rename", "(", "new_dir", ",", "old_dir", ")", ";", "dput", "(", "dentry", ")", ";", "return", "old_dentry", ";", "@", "@", "-", "4362", ",", "11", "+", "4362", ",", "11", "@", "@", "int", "vfs_rename", "(", "struct", "inode", "*", "old_dir", ",", "struct", "dentry", "*", "old_dentry", ",", "{", "int", "error", ";", "bool", "is_dir", "=", "d_is_dir", "(", "old_dentry", ")", ";", "const", "unsigned", "char", "*", "old_name", ";", "struct", "inode", "*", "source", "=", "old_dentry", "-", ">", "d_inode", ";", "struct", "inode", "*", "target", "=", "new_dentry", "-", ">", "d_inode", ";", "bool", "new_is_dir", "=", "false", ";", "unsigned", "max_links", "=", "new_dir", "-", ">", "i_sb", "-", ">", "s_max_links", ";", "struct", "name_snapshot", "old_name", ";", "if", "(", "source", "=", "=", "target", ")", "return", "0", ";", "@", "@", "-", "4413", ",", "7", "+", "4413", ",", "7", "@", "@", "int", "vfs_rename", "(", "struct", "inode", "*", "old_dir", ",", "struct", "dentry", "*", "old_dentry", ",", "if", "(", "error", ")", "return", "error", ";", "old_name", "=", "fsnotify_oldname_init", "(", "old_dentry", "-", ">", "d_name", ".", "name", ")", ";", "take_dentry_name_snapshot", "(", "&", "old_name", ",", "old_dentry", ")", ";", "dget", "(", "new_dentry", ")", ";", "if", "(", "!", "is_dir", "|", "|", "(", "flags", "&", "RENAME_EXCHANGE", ")", ")", "lock_two_nondirectories", "(", "source", ",", "target", ")", ";", "@", "@", "-", "4468", ",", "14", "+", "4468", ",", "14", "@", "@", "int", "vfs_rename", "(", "struct", "inode", "*", "old_dir", ",", "struct", "dentry", "*", "old_dentry", ",", "inode_unlock", "(", "target", ")", ";", "dput", "(", "new_dentry", ")", ";", "if", "(", "!", "error", ")", "{", "fsnotify_move", "(", "old_dir", ",", "new_dir", ",", "old_name", ",", "is_dir", ",", "fsnotify_move", "(", "old_dir", ",", "new_dir", ",", "old_name", ".", "name", ",", "is_dir", ",", "!", "(", "flags", "&", "RENAME_EXCHANGE", ")", "?", "target", ":", "NULL", ",", "old_dentry", ")", ";", "if", "(", "flags", "&", "RENAME_EXCHANGE", ")", "{", "fsnotify_move", "(", "new_dir", ",", "old_dir", ",", "old_dentry", "-", ">", "d_name", ".", "name", ",", "new_is_dir", ",", "NULL", ",", "new_dentry", ")", ";", "}", "}", "fsnotify_oldname_free", "(", "old_name", ")", ";", "release_dentry_name_snapshot", "(", "&", "old_name", ")", ";", "return", "error", ";", "}", "@", "@", "-", "161", ",", "16", "+", "161", ",", "20", "@", "@", "int", "__fsnotify_parent", "(", "const", "struct", "path", "*", "path", ",", "struct", "dentry", "*", "dentry", ",", "__u32", "mask", "if", "(", "unlikely", "(", "!", "fsnotify_inode_watches_children", "(", "p_inode", ")", "))", "__fsnotify_update_child_dentry_flags", "(", "p_inode", ")", ";", "else", "if", "(", "p_inode", "-", ">", "i_fsnotify_mask", "&", "mask", ")", "{", "struct", "name_snapshot", "name", ";", "/", "*", "we", "are", "notifying", "a", "parent", "so", "come", "up", "with", "the", "new", "mask", "which", "*", "specifies", "these", "are", "events", "which", "came", "from", "a", "child", ".", "*", "/", "mask", "|", "=", "FS_EVENT_ON_CHILD", ";", "take_dentry_name_snapshot", "(", "&", "name", ",", "dentry", ")", ";", "if", "(", "path", ")", "ret", "=", "fsnotify", "(", "p_inode", ",", "mask", ",", "path", ",", "FSNOTIFY_EVENT_PATH", ",", "dentry", "-", ">", "d_name", ".", "name", ",", "0", ")", ";", "name", ".", "name", ",", "0", ")", ";", "else", "ret", "=", "fsnotify", "(", "p_inode", ",", "mask", ",", "dentry", "-", ">", "d_inode", ",", "FSNOTIFY_EVENT_INODE", ",", "dentry", "-", ">", "d_name", ".", "name", ",", "0", ")", ";", "name", ".", "name", ",", "0", ")", ";", "release_dentry_name_snapshot", "(", "&", "name", ")", ";", "}", "dput", "(", "parent", ")", ";", "@", "@", "-", "591", ",", "5", "+", "591", ",", "11", "@", "@", "static", "inline", "struct", "inode", "*", "d_real_inode", "(", "const", "struct", "dentry", "*", "dentry", ")", "return", "d_backing_inode", "(", "d_real", "(", "(", "struct", "dentry", "*", ")", "dentry", ",", "NULL", ",", "0", ")", ");", "}", "struct", "name_snapshot", "{", "const", "char", "*", "name", ";", "char", "inline_name", "[", "DNAME_INLINE_LEN", "]", ";", "}", ";", "void", "take_dentry_name_snapshot", "(", "struct", "name_snapshot", "*", ",", "struct", "dentry", "*", ");", "void", "release_dentry_name_snapshot", "(", "struct", "name_snapshot", "*", ");", "#", "endif", "/", "*", "__LINUX_DCACHE_H", "*", "/", "@", "@", "-", "293", ",", "35", "+", "293", ",", "4", "@", "@", "static", "inline", "void", "fsnotify_change", "(", "struct", "dentry", "*", "dentry", ",", "unsigned", "int", "ia_valid", ")", "}", "}", "#", "if", "defined", "(", "CONFIG_FSNOTIFY", ")", "/", "*", "notify", "helpers", "*", "/", "/", "*", "*", "fsnotify_oldname_init", "-", "save", "off", "the", "old", "filename", "before", "we", "change", "it", "*", "/", "static", "inline", "const", "unsigned", "char", "*", "fsnotify_oldname_init", "(", "const", "unsigned", "char", "*", "name", ")", "{", "return", "kstrdup", "(", "name", ",", "GFP_KERNEL", ")", ";", "}", "/", "*", "*", "fsnotify_oldname_free", "-", "free", "the", "name", "we", "got", "from", "fsnotify_oldname_init", "*", "/", "static", "inline", "void", "fsnotify_oldname_free", "(", "const", "unsigned", "char", "*", "old_name", ")", "{", "kfree", "(", "old_name", ")", ";", "}", "#", "else", "/", "*", "CONFIG_FSNOTIFY", "*", "/", "static", "inline", "const", "char", "*", "fsnotify_oldname_init", "(", "const", "unsigned", "char", "*", "name", ")", "{", "return", "NULL", ";", "}", "static", "inline", "void", "fsnotify_oldname_free", "(", "const", "unsigned", "char", "*", "old_name", ")", "{", "}", "#", "endif", "/", "*", "CONFIG_FSNOTIFY", "*", "/", "#", "endif", "/", "*", "_LINUX_FS_NOTIFY_H", "*", "/"], "docstring_tokens": ["race", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "198", ",", "65", "+", "198", ",", "7", "@", "@", "static", "int", "proc_root_link", "(", "struct", "dentry", "*", "dentry", ",", "struct", "path", "*", "path", ")", "return", "result", ";", "}", "static", "struct", "mm_struct", "*", "__check_mem_permission", "(", "struct", "task_struct", "*", "task", ")", "{", "struct", "mm_struct", "*", "mm", ";", "mm", "=", "get_task_mm", "(", "task", ")", ";", "if", "(", "!", "mm", ")", "return", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "/", "*", "*", "A", "task", "can", "always", "look", "at", "itself", ",", "in", "case", "it", "chooses", "*", "to", "use", "system", "calls", "instead", "of", "load", "instructions", ".", "*", "/", "if", "(", "task", "=", "=", "current", ")", "return", "mm", ";", "/", "*", "*", "If", "current", "is", "actively", "ptrace", "'", "ing", ",", "and", "would", "also", "be", "*", "permitted", "to", "freshly", "attach", "with", "ptrace", "now", ",", "permit", "it", ".", "*", "/", "if", "(", "task_is_stopped_or_traced", "(", "task", ")", ")", "{", "int", "match", ";", "rcu_read_lock", "(", ");", "match", "=", "(", "ptrace_parent", "(", "task", ")", "=", "=", "current", ")", ";", "rcu_read_unlock", "(", ");", "if", "(", "match", "&", "&", "ptrace_may_access", "(", "task", ",", "PTRACE_MODE_ATTACH", ")", ")", "return", "mm", ";", "}", "/", "*", "*", "No", "one", "else", "is", "allowed", ".", "*", "/", "mmput", "(", "mm", ")", ";", "return", "ERR_PTR", "(", "-", "EPERM", ")", ";", "}", "/", "*", "*", "If", "current", "may", "access", "user", "memory", "in", "@", "task", "return", "a", "reference", "to", "the", "*", "corresponding", "mm", ",", "otherwise", "ERR_PTR", ".", "*", "/", "static", "struct", "mm_struct", "*", "check_mem_permission", "(", "struct", "task_struct", "*", "task", ")", "{", "struct", "mm_struct", "*", "mm", ";", "int", "err", ";", "/", "*", "*", "Avoid", "racing", "if", "task", "exec", "'", "s", "as", "we", "might", "get", "a", "new", "mm", "but", "validate", "*", "against", "old", "credentials", ".", "*", "/", "err", "=", "mutex_lock_killable", "(", "&", "task", "-", ">", "signal", "-", ">", "cred_guard_mutex", ")", ";", "if", "(", "err", ")", "return", "ERR_PTR", "(", "err", ")", ";", "mm", "=", "__check_mem_permission", "(", "task", ")", ";", "mutex_unlock", "(", "&", "task", "-", ">", "signal", "-", ">", "cred_guard_mutex", ")", ";", "return", "mm", ";", "}", "struct", "mm_struct", "*", "mm_for_maps", "(", "struct", "task_struct", "*", "task", ")", "static", "struct", "mm_struct", "*", "mm_access", "(", "struct", "task_struct", "*", "task", ",", "unsigned", "int", "mode", ")", "{", "struct", "mm_struct", "*", "mm", ";", "int", "err", ";", "@", "@", "-", "267", ",", "7", "+", "209", ",", "7", "@", "@", "struct", "mm_struct", "*", "mm_for_maps", "(", "struct", "task_struct", "*", "task", ")", "mm", "=", "get_task_mm", "(", "task", ")", ";", "if", "(", "mm", "&", "&", "mm", "!", "=", "current", "-", ">", "mm", "&", "&", "!", "ptrace_may_access", "(", "task", ",", "PTRACE_MODE_READ", ")", ")", "{", "!", "ptrace_may_access", "(", "task", ",", "mode", ")", ")", "{", "mmput", "(", "mm", ")", ";", "mm", "=", "ERR_PTR", "(", "-", "EACCES", ")", ";", "}", "@", "@", "-", "276", ",", "6", "+", "218", ",", "11", "@", "@", "struct", "mm_struct", "*", "mm_for_maps", "(", "struct", "task_struct", "*", "task", ")", "return", "mm", ";", "}", "struct", "mm_struct", "*", "mm_for_maps", "(", "struct", "task_struct", "*", "task", ")", "{", "return", "mm_access", "(", "task", ",", "PTRACE_MODE_READ", ")", ";", "}", "static", "int", "proc_pid_cmdline", "(", "struct", "task_struct", "*", "task", ",", "char", "*", "buffer", ")", "{", "int", "res", "=", "0", ";", "@", "@", "-", "752", ",", "38", "+", "699", ",", "39", "@", "@", "static", "const", "struct", "file_operations", "proc_single_file_operations", "=", "{", "static", "int", "mem_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")", "{", "file", "-", ">", "private_data", "=", "(", "void", "*", ")(", "(", "long", ")", "current", "-", ">", "self_exec_id", ")", ";", "struct", "task_struct", "*", "task", "=", "get_proc_task", "(", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ")", ";", "struct", "mm_struct", "*", "mm", ";", "if", "(", "!", "task", ")", "return", "-", "ESRCH", ";", "mm", "=", "mm_access", "(", "task", ",", "PTRACE_MODE_ATTACH", ")", ";", "put_task_struct", "(", "task", ")", ";", "if", "(", "IS_ERR", "(", "mm", ")", ")", "return", "PTR_ERR", "(", "mm", ")", ";", "/", "*", "OK", "to", "pass", "negative", "loff_t", ",", "we", "can", "catch", "out", "-", "of", "-", "range", "*", "/", "file", "-", ">", "f_mode", "|", "=", "FMODE_UNSIGNED_OFFSET", ";", "file", "-", ">", "private_data", "=", "mm", ";", "return", "0", ";", "}", "static", "ssize_t", "mem_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buf", ",", "size_t", "count", ",", "loff_t", "*", "ppos", ")", "{", "struct", "task_struct", "*", "task", "=", "get_proc_task", "(", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ")", ";", "int", "ret", ";", "char", "*", "page", ";", "unsigned", "long", "src", "=", "*", "ppos", ";", "int", "ret", "=", "-", "ESRCH", ";", "struct", "mm_struct", "*", "mm", ";", "struct", "mm_struct", "*", "mm", "=", "file", "-", ">", "private_data", ";", "if", "(", "!", "task", ")", "goto", "out_no_task", ";", "if", "(", "!", "mm", ")", "return", "0", ";", "ret", "=", "-", "ENOMEM", ";", "page", "=", "(", "char", "*", ")", "__get_free_page", "(", "GFP_TEMPORARY", ")", ";", "if", "(", "!", "page", ")", "goto", "out", ";", "mm", "=", "check_mem_permission", "(", "task", ")", ";", "ret", "=", "PTR_ERR", "(", "mm", ")", ";", "if", "(", "IS_ERR", "(", "mm", ")", ")", "goto", "out_free", ";", "ret", "=", "-", "EIO", ";", "if", "(", "file", "-", ">", "private_data", "!", "=", "(", "void", "*", ")(", "(", "long", ")", "current", "-", ">", "self_exec_id", ")", ")", "goto", "out_put", ";", "return", "-", "ENOMEM", ";", "ret", "=", "0", ";", "@", "@", "-", "810", ",", "13", "+", "758", ",", "7", "@", "@", "static", "ssize_t", "mem_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buf", ",", "}", "*", "ppos", "=", "src", ";", "out_put", ":", "mmput", "(", "mm", ")", ";", "out_free", ":", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "out", ":", "put_task_struct", "(", "task", ")", ";", "out_no_task", ":", "return", "ret", ";", "}", "@", "@", "-", "825", ",", "27", "+", "767", ",", "15", "@", "@", "static", "ssize_t", "mem_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "{", "int", "copied", ";", "char", "*", "page", ";", "struct", "task_struct", "*", "task", "=", "get_proc_task", "(", "file", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ")", ";", "unsigned", "long", "dst", "=", "*", "ppos", ";", "struct", "mm_struct", "*", "mm", ";", "struct", "mm_struct", "*", "mm", "=", "file", "-", ">", "private_data", ";", "copied", "=", "-", "ESRCH", ";", "if", "(", "!", "task", ")", "goto", "out_no_task", ";", "if", "(", "!", "mm", ")", "return", "0", ";", "copied", "=", "-", "ENOMEM", ";", "page", "=", "(", "char", "*", ")", "__get_free_page", "(", "GFP_TEMPORARY", ")", ";", "if", "(", "!", "page", ")", "goto", "out_task", ";", "mm", "=", "check_mem_permission", "(", "task", ")", ";", "copied", "=", "PTR_ERR", "(", "mm", ")", ";", "if", "(", "IS_ERR", "(", "mm", ")", ")", "goto", "out_free", ";", "copied", "=", "-", "EIO", ";", "if", "(", "file", "-", ">", "private_data", "!", "=", "(", "void", "*", ")(", "(", "long", ")", "current", "-", ">", "self_exec_id", ")", ")", "goto", "out_mm", ";", "return", "-", "ENOMEM", ";", "copied", "=", "0", ";", "while", "(", "count", ">", "0", ")", "{", "@", "@", "-", "869", ",", "13", "+", "799", ",", "7", "@", "@", "static", "ssize_t", "mem_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "}", "*", "ppos", "=", "dst", ";", "out_mm", ":", "mmput", "(", "mm", ")", ";", "out_free", ":", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "out_task", ":", "put_task_struct", "(", "task", ")", ";", "out_no_task", ":", "return", "copied", ";", "}", "@", "@", "-", "895", ",", "11", "+", "819", ",", "20", "@", "@", "loff_t", "mem_lseek", "(", "struct", "file", "*", "file", ",", "loff_t", "offset", ",", "int", "orig", ")", "return", "file", "-", ">", "f_pos", ";", "}", "static", "int", "mem_release", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")", "{", "struct", "mm_struct", "*", "mm", "=", "file", "-", ">", "private_data", ";", "mmput", "(", "mm", ")", ";", "return", "0", ";", "}", "static", "const", "struct", "file_operations", "proc_mem_operations", "=", "{", ".", "llseek", "=", "mem_lseek", ",", ".", "read", "=", "mem_read", ",", ".", "write", "=", "mem_write", ",", ".", "open", "=", "mem_open", ",", ".", "release", "=", "mem_release", ",", "}", ";", "static", "ssize_t", "environ_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buf", ","], "docstring_tokens": ["info", "leak"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "765", ",", "10", "+", "765", ",", "12", "@", "@", "static", "long", "ashmem_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "break", ";", "case", "ASHMEM_SET_SIZE", ":", "ret", "=", "-", "EINVAL", ";", "mutex_lock", "(", "&", "ashmem_mutex", ")", ";", "if", "(", "!", "asma", "-", ">", "file", ")", "{", "ret", "=", "0", ";", "asma", "-", ">", "size", "=", "(", "size_t", ")", "arg", ";", "}", "mutex_unlock", "(", "&", "ashmem_mutex", ")", ";", "break", ";", "case", "ASHMEM_GET_SIZE", ":", "ret", "=", "asma", "-", ">", "size", ";"], "docstring_tokens": ["inter-process", "munmap"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "68", ",", "6", "+", "68", ",", "12", "@", "@", "s", ".", "add", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "JndiRefForwardingDataSource", "\"", ");", "s", ".", "add", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "WrapperConnectionPoolDataSource", "\"", ");", "/", "/", "[", "databind", "#", "2097", "]", ":", "some", "3rd", "party", ",", "one", "JDK", "-", "bundled", "s", ".", "add", "(", "\"", "org", ".", "slf4j", ".", "ext", ".", "EventData", "\"", ");", "s", ".", "add", "(", "\"", "flex", ".", "messaging", ".", "util", ".", "concurrent", ".", "AsynchBeansWorkManagerExecutor", "\"", ");", "s", ".", "add", "(", "\"", "com", ".", "sun", ".", "deploy", ".", "security", ".", "ruleset", ".", "DRSHelper", "\"", ");", "s", ".", "add", "(", "\"", "org", ".", "apache", ".", "axis2", ".", "jaxws", ".", "spi", ".", "handler", ".", "HandlerResolverImpl", "\"", ");", "DEFAULT_NO_DESER_CLASS_NAMES", "=", "Collections", ".", "unmodifiableSet", "(", "s", ")", ";", "}"], "docstring_tokens": ["request", "forgery", "(ssrf", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "300", ",", "9", "+", "300", ",", "16", "@", "@", "public", "void", "setTomcatAuthorization", "(", "boolean", "tomcatAuthorization", ")", "{", "/", "**", "*", "Required", "secret", ".", "*", "/", "@", "Deprecated", "protected", "String", "requiredSecret", "=", "null", ";", "protected", "String", "secret", "=", "null", ";", "public", "void", "setSecret", "(", "String", "secret", ")", "{", "this", ".", "secret", "=", "secret", ";", "this", ".", "requiredSecret", "=", "secret", ";", "}", "@", "Deprecated", "public", "void", "setRequiredSecret", "(", "String", "requiredSecret", ")", "{", "this", ".", "requiredSecret", "=", "requiredSecret", ";", "setSecret", "(", "requiredSecret", ")", ";", "}", "@", "@", "-", "831", ",", "7", "+", "838", ",", "7", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "}", "/", "/", "Decode", "extra", "attributes", "boolean", "secret", "=", "false", ";", "boolean", "secretPresentInRequest", "=", "false", ";", "byte", "attributeCode", ";", "while", "(", "(", "attributeCode", "=", "requestHeaderMessage", ".", "getByte", "(", "))", "!", "=", "Constants", ".", "SC_A_ARE_DONE", ")", "{", "@", "@", "-", "934", ",", "9", "+", "941", ",", "9", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "case", "Constants", ".", "SC_A_SECRET", ":", "requestHeaderMessage", ".", "getBytes", "(", "tmpMB", ")", ";", "if", "(", "requiredSecret", "!", "=", "null", ")", "{", "secret", "=", "true", ";", "if", "(", "!", "tmpMB", ".", "equals", "(", "requiredSecret", ")", ")", "{", "if", "(", "secret", "!", "=", "null", ")", "{", "secretPresentInRequest", "=", "true", ";", "if", "(", "!", "tmpMB", ".", "equals", "(", "secret", ")", ")", "{", "response", ".", "setStatus", "(", "403", ")", ";", "setErrorState", "(", "ErrorState", ".", "CLOSE_CLEAN", ",", "null", ")", ";", "}", "@", "@", "-", "952", ",", "7", "+", "959", ",", "7", "@", "@", "protected", "void", "prepareRequest", "(", ")", "{", "}", "/", "/", "Check", "if", "secret", "was", "submitted", "if", "required", "if", "(", "(", "requiredSecret", "!", "=", "null", ")", "&", "&", "!", "secret", ")", "{", "if", "(", "(", "secret", "!", "=", "null", ")", "&", "&", "!", "secretPresentInRequest", ")", "{", "response", ".", "setStatus", "(", "403", ")", ";", "setErrorState", "(", "ErrorState", ".", "CLOSE_CLEAN", ",", "null", ")", ";", "}", "@", "@", "-", "95", ",", "13", "+", "95", ",", "49", "@", "@", "public", "void", "setTomcatAuthorization", "(", "boolean", "tomcatAuthorization", ")", "{", "protected", "String", "requiredSecret", "=", "null", ";", "private", "String", "secret", "=", "null", ";", "/", "**", "*", "Set", "the", "secret", "that", "must", "be", "included", "with", "every", "request", ".", "*", "*", "@", "param", "secret", "The", "required", "secret", "*", "/", "public", "void", "setSecret", "(", "String", "secret", ")", "{", "this", ".", "secret", "=", "secret", ";", "this", ".", "requiredSecret", "=", "secret", ";", "}", "protected", "String", "getSecret", "(", ")", "{", "return", "secret", ";", "}", "/", "**", "*", "Set", "the", "required", "secret", "that", "must", "be", "included", "with", "every", "request", ".", "*", "*", "@", "param", "requiredSecret", "The", "required", "secret", "*", "*", "@", "deprecated", "Replaced", "by", "{", "@", "link", "#", "setSecret", "(", "String", ")", "}.", "*", "Will", "be", "removed", "in", "Tomcat", "11", "onwards", "*", "/", "@", "Deprecated", "public", "void", "setRequiredSecret", "(", "String", "requiredSecret", ")", "{", "this", ".", "requiredSecret", "=", "requiredSecret", ";", "setSecret", "(", "requiredSecret", ")", ";", "}", "/", "**", "*", "@", "return", "The", "current", "secret", "*", "*", "@", "deprecated", "Replaced", "by", "{", "@", "link", "#", "getSecret", "(", ")}", ".", "*", "Will", "be", "removed", "in", "Tomcat", "11", "onwards", "*", "/", "@", "Deprecated", "protected", "String", "getRequiredSecret", "(", ")", "{", "return", "getSecret", "(", ");", "}", "private", "boolean", "secretRequired", "=", "true", ";", "public", "void", "setSecretRequired", "(", "boolean", "secretRequired", ")", "{", "this", ".", "secretRequired", "=", "secretRequired", ";", "}", "public", "boolean", "getSecretRequired", "(", ")", "{", "return", "secretRequired", ";", "}", "@", "@", "-", "151", ",", "4", "+", "187", ",", "16", "@", "@", "protected", "P", "createUpgradeProcessor", "(", "SocketWrapper", "<", "S", ">", "socket", ",", "return", "null", ";", "}", "}", "@", "Override", "public", "void", "init", "(", ")", "throws", "Exception", "{", "if", "(", "getSecretRequired", "(", "))", "{", "String", "secret", "=", "getSecret", "(", ");", "if", "(", "secret", "=", "=", "null", "|", "|", "secret", ".", "length", "(", ")", "=", "=", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "sm", ".", "getString", "(", "\"", "ajpprotocol", ".", "nosecret", "\"", "))", ";", "}", "}", "super", ".", "init", "(", ");", "}", "}", "@", "@", "-", "150", ",", "7", "+", "150", ",", "7", "@", "@", "protected", "AjpAprProcessor", "createProcessor", "(", ")", "{", "processor", ".", "setAjpFlush", "(", "proto", ".", "getAjpFlush", "(", "))", ";", "processor", ".", "setTomcatAuthentication", "(", "proto", ".", "tomcatAuthentication", ")", ";", "processor", ".", "setTomcatAuthorization", "(", "proto", ".", "getTomcatAuthorization", "(", "))", ";", "processor", ".", "setRequiredSecret", "(", "proto", ".", "requiredSecret", ")", ";", "processor", ".", "setSecret", "(", "proto", ".", "getSecret", "(", "))", ";", "processor", ".", "setKeepAliveTimeout", "(", "proto", ".", "getKeepAliveTimeout", "(", "))", ";", "processor", ".", "setClientCertProvider", "(", "proto", ".", "getClientCertProvider", "(", "))", ";", "processor", ".", "setMaxCookieCount", "(", "proto", ".", "getMaxCookieCount", "(", "))", ";", "@", "@", "-", "180", ",", "7", "+", "180", ",", "7", "@", "@", "protected", "AjpNioProcessor", "createProcessor", "(", ")", "{", "processor", ".", "setAjpFlush", "(", "proto", ".", "getAjpFlush", "(", "))", ";", "processor", ".", "setTomcatAuthentication", "(", "proto", ".", "tomcatAuthentication", ")", ";", "processor", ".", "setTomcatAuthorization", "(", "proto", ".", "getTomcatAuthorization", "(", "))", ";", "processor", ".", "setRequiredSecret", "(", "proto", ".", "requiredSecret", ")", ";", "processor", ".", "setSecret", "(", "proto", ".", "getSecret", "(", "))", ";", "processor", ".", "setKeepAliveTimeout", "(", "proto", ".", "getKeepAliveTimeout", "(", "))", ";", "processor", ".", "setClientCertProvider", "(", "proto", ".", "getClientCertProvider", "(", "))", ";", "processor", ".", "setMaxCookieCount", "(", "proto", ".", "getMaxCookieCount", "(", "))", ";", "@", "@", "-", "140", ",", "7", "+", "140", ",", "7", "@", "@", "protected", "AjpProcessor", "createProcessor", "(", ")", "{", "processor", ".", "setAjpFlush", "(", "proto", ".", "getAjpFlush", "(", "))", ";", "processor", ".", "setTomcatAuthentication", "(", "proto", ".", "tomcatAuthentication", ")", ";", "processor", ".", "setTomcatAuthorization", "(", "proto", ".", "getTomcatAuthorization", "(", "))", ";", "processor", ".", "setRequiredSecret", "(", "proto", ".", "requiredSecret", ")", ";", "processor", ".", "setSecret", "(", "proto", ".", "getSecret", "(", "))", ";", "processor", ".", "setKeepAliveTimeout", "(", "proto", ".", "getKeepAliveTimeout", "(", "))", ";", "processor", ".", "setClientCertProvider", "(", "proto", ".", "getClientCertProvider", "(", "))", ";", "processor", ".", "setMaxCookieCount", "(", "proto", ".", "getMaxCookieCount", "(", "))", ";", "@", "@", "-", "37", ",", "5", "+", "37", ",", "6", "@", "@", "ajpprocessor", ".", "ssl", ".", "notsupported", "=", "The", "SSL", "protocol", "is", "not", "supported", "by", "this", "connecto", "ajpprotocol", ".", "endpoint", ".", "starterror", "=", "Error", "starting", "endpoint", "ajpprotocol", ".", "failedwrite", "=", "Socket", "write", "failed", "ajpprotocol", ".", "init", "=", "Initializing", "Coyote", "AJP", "/", "1", ".", "3", "on", "[", "{", "0", "}", "]", "ajpprotocol", ".", "nosecret", "=", "The", "AJP", "Connector", "is", "configured", "with", "secretRequired", "=", "\"", "true", "\"", "but", "the", "secret", "attribute", "is", "either", "null", "or", "\"", "\".", "This", "combination", "is", "not", "valid", ".", "ajpprotocol", ".", "request", ".", "register", "=", "Error", "registering", "request", "processor", "in", "JMX", "ajpprotocol", ".", "start", "=", "Starting", "Coyote", "AJP", "/", "1", ".", "3", "on", "[", "{", "0", "}", "]", "@", "@", "-", "30", ",", "14", "+", "30", ",", "25", "@", "@", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "apache", ".", "catalina", ".", "Context", ";", "import", "org", ".", "apache", ".", "catalina", ".", "connector", ".", "Connector", ";", "import", "org", ".", "apache", ".", "catalina", ".", "startup", ".", "Tomcat", ";", "import", "org", ".", "apache", ".", "catalina", ".", "startup", ".", "TomcatBaseTest", ";", "public", "class", "TestAbstractAjpProcessor", "extends", "TomcatBaseTest", "{", "@", "Before", "@", "Override", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "Connector", "c", "=", "getTomcatInstance", "(", ").", "getConnector", "(", ");", "c", ".", "setProperty", "(", "\"", "secretRequired", "\"", ",", "\"", "false", "\"", ");", "}", "@", "Override", "protected", "String", "getProtocol", "(", ")", "{", "/", "*", "@", "@", "-", "147", ",", "6", "+", "147", ",", "14", "@", "@", "Change", "the", "default", "bind", "address", "for", "the", "AJP", "/", "1", ".", "3", "connector", "to", "be", "the", "loopback", "address", ".", "(", "markt", ")", "<", "/", "update", ">", "<", "add", ">", "Rename", "the", "<", "code", ">", "requiredSecret", "<", "/", "code", ">", "attribute", "of", "the", "AJP", "/", "1", ".", "3", "Connector", "to", "<", "code", ">", "secret", "<", "/", "code", ">", "and", "add", "a", "new", "attribute", "<", "code", ">", "secretRequired", "<", "/", "code", ">", "that", "defaults", "to", "<", "code", ">", "true", "<", "/", "code", ">", ".", "When", "<", "code", ">", "secretRequired", "<", "/", "code", ">", "is", "<", "code", ">", "true", "<", "/", "code", ">", "the", "AJP", "/", "1", ".", "3", "Connector", "will", "not", "start", "unless", "the", "<", "code", ">", "secret", "<", "/", "code", ">", "attribute", "is", "configured", "to", "a", "non", "-", "null", ",", "non", "-", "zero", "length", "String", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">", "@", "@", "-", "431", ",", "8", "+", "431", ",", "18", "@", "@", "expected", "concurrent", "requests", "(", "synchronous", "and", "asynchronous", ")", ".<", "/", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "requiredSecret", "\"", "required", "=", "\"", "false", "\"", ">", "<", "attribute", "name", "=", "\"", "secret", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "Only", "requests", "from", "workers", "with", "this", "secret", "keyword", "will", "be", "accepted", ".", "The", "default", "value", "is", "<", "code", ">", "null", "<", "/", "code", ">", ".", "This", "attrbute", "must", "be", "specified", "with", "a", "non", "-", "null", ",", "non", "-", "zero", "length", "value", "unless", "<", "strong", ">", "secretRequired", "<", "/", "strong", ">", "is", "explicitly", "configured", "to", "be", "<", "code", ">", "false", "<", "/", "code", ">", ".<", "/", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "secretRequired", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "If", "this", "attribute", "is", "<", "code", ">", "true", "<", "/", "code", ">", ",", "the", "AJP", "Connector", "will", "only", "start", "if", "the", "<", "strong", ">", "secret", "<", "/", "strong", ">", "attribute", "is", "configured", "with", "a", "non", "-", "null", ",", "non", "-", "zero", "length", "value", ".", "The", "default", "value", "is", "<", "code", ">", "true", "<", "/", "code", ">", ".", "<", "/", "p", ">", "<", "/", "attribute", ">"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "145", ",", "27", "+", "145", ",", "56", "@", "@", "public", "void", "setAllowHostHeaderMismatch", "(", "boolean", "allowHostHeaderMismatch", ")", "{", "}", "private", "boolean", "rejectIllegalHeaderName", "=", "false", ";", "private", "boolean", "rejectIllegalHeader", "=", "false", ";", "/", "**", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "(", "i", ".", "e", ".", "*", "the", "header", "name", "is", "not", "a", "token", ")", "will", "the", "request", "be", "rejected", "(", "with", "a", "400", "*", "response", ")", "or", "will", "the", "illegal", "header", "be", "ignored", ".", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "*", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "will", "the", "request", "be", "rejected", "*", "(", "with", "a", "400", "response", ")", "or", "will", "the", "illegal", "header", "be", "ignored", "?", "*", "*", "@", "return", "{", "@", "code", "true", "}", "if", "the", "request", "will", "be", "rejected", "or", "{", "@", "code", "false", "}", "if", "*", "the", "header", "will", "be", "ignored", "*", "/", "public", "boolean", "getRejectIllegalHeaderName", "(", ")", "{", "return", "rejectIllegalHeaderName", ";", "}", "public", "boolean", "getRejectIllegalHeader", "(", ")", "{", "return", "rejectIllegalHeader", ";", "}", "/", "**", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "(", "i", ".", "e", ".", "*", "the", "header", "name", "is", "not", "a", "token", ")", "should", "the", "request", "be", "rejected", "(", "with", "a", "*", "400", "response", ")", "or", "should", "the", "illegal", "header", "be", "ignored", ".", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "*", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "should", "the", "request", "be", "*", "rejected", "(", "with", "a", "400", "response", ")", "or", "should", "the", "illegal", "header", "be", "ignored", "?", "*", "*", "@", "param", "rejectIllegalHeader", "{", "@", "code", "true", "}", "to", "reject", "requests", "with", "illegal", "*", "header", "names", "or", "values", ",", "{", "@", "code", "false", "}", "to", "*", "ignore", "the", "header", "*", "/", "public", "void", "setRejectIllegalHeader", "(", "boolean", "rejectIllegalHeader", ")", "{", "this", ".", "rejectIllegalHeader", "=", "rejectIllegalHeader", ";", "}", "/", "**", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "*", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "will", "the", "request", "be", "rejected", "*", "(", "with", "a", "400", "response", ")", "or", "will", "the", "illegal", "header", "be", "ignored", "?", "*", "*", "@", "return", "{", "@", "code", "true", "}", "if", "the", "request", "will", "be", "rejected", "or", "{", "@", "code", "false", "}", "if", "*", "the", "header", "will", "be", "ignored", "*", "*", "@", "deprecated", "Now", "an", "alias", "for", "{", "@", "link", "#", "getRejectIllegalHeader", "(", ")}", ".", "Will", "be", "*", "removed", "in", "Tomcat", "10", "onwards", ".", "*", "/", "@", "Deprecated", "public", "boolean", "getRejectIllegalHeaderName", "(", ")", "{", "return", "rejectIllegalHeader", ";", "}", "/", "**", "*", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "*", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "should", "the", "request", "be", "*", "rejected", "(", "with", "a", "400", "response", ")", "or", "should", "the", "illegal", "header", "be", "ignored", "?", "*", "*", "@", "param", "rejectIllegalHeaderName", "{", "@", "code", "true", "}", "to", "reject", "requests", "with", "*", "illegal", "header", "names", ",", "{", "@", "code", "false", "}", "to", "*", "ignore", "the", "header", "*", "illegal", "header", "names", "or", "values", ",", "*", "{", "@", "code", "false", "}", "to", "ignore", "the", "header", "*", "*", "@", "deprecated", "Now", "an", "alias", "for", "{", "@", "link", "#", "setRejectIllegalHeader", "(", "boolean", ")", "}.", "*", "Will", "be", "removed", "in", "Tomcat", "10", "onwards", ".", "*", "/", "@", "Deprecated", "public", "void", "setRejectIllegalHeaderName", "(", "boolean", "rejectIllegalHeaderName", ")", "{", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeaderName", ";", "this", ".", "rejectIllegalHeader", "=", "rejectIllegalHeaderName", ";", "}", "@", "@", "-", "66", ",", "7", "+", "66", ",", "7", "@", "@", "private", "final", "MimeHeaders", "headers", ";", "private", "final", "boolean", "rejectIllegalHeaderName", ";", "private", "final", "boolean", "rejectIllegalHeader", ";", "/", "**", "*", "State", ".", "@", "@", "-", "152", ",", "13", "+", "152", ",", "13", "@", "@", "/", "/", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Constructors", "public", "Http11InputBuffer", "(", "Request", "request", ",", "int", "headerBufferSize", ",", "boolean", "rejectIllegalHeaderName", ",", "HttpParser", "httpParser", ")", "{", "boolean", "rejectIllegalHeader", ",", "HttpParser", "httpParser", ")", "{", "this", ".", "request", "=", "request", ";", "headers", "=", "request", ".", "getMimeHeaders", "(", ");", "this", ".", "headerBufferSize", "=", "headerBufferSize", ";", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeaderName", ";", "this", ".", "rejectIllegalHeader", "=", "rejectIllegalHeader", ";", "this", ".", "httpParser", "=", "httpParser", ";", "filterLibrary", "=", "new", "InputFilter", "[", "0", "]", ";", "@", "@", "-", "760", ",", "6", "+", "760", ",", "8", "@", "@", "private", "HeaderParseStatus", "parseHeader", "(", ")", "throws", "IOException", "{", "/", "/", "byte", "chr", "=", "0", ";", "byte", "prevChr", "=", "0", ";", "while", "(", "headerParsePos", "=", "=", "HeaderParsePosition", ".", "HEADER_START", ")", "{", "/", "/", "Read", "new", "bytes", "if", "needed", "@", "@", "-", "770", ",", "17", "+", "772", ",", "23", "@", "@", "private", "HeaderParseStatus", "parseHeader", "(", ")", "throws", "IOException", "{", "}", "}", "prevChr", "=", "chr", ";", "chr", "=", "byteBuffer", ".", "get", "(", ");", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "if", "(", "chr", "=", "=", "Constants", ".", "CR", "&", "&", "prevChr", "!", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Possible", "start", "of", "CRLF", "-", "process", "the", "next", "byte", ".", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "return", "HeaderParseStatus", ".", "DONE", ";", "}", "else", "{", "byteBuffer", ".", "position", "(", "byteBuffer", ".", "position", "(", ")", "-", "1", ")", ";", "if", "(", "prevChr", "=", "=", "0", ")", "{", "/", "/", "Must", "have", "only", "read", "one", "byte", "byteBuffer", ".", "position", "(", "byteBuffer", ".", "position", "(", ")", "-", "1", ")", ";", "}", "else", "{", "/", "/", "Must", "have", "read", "two", "bytes", "(", "first", "was", "CR", ",", "second", "was", "not", "LF", ")", "byteBuffer", ".", "position", "(", "byteBuffer", ".", "position", "(", ")", "-", "2", ")", ";", "}", "break", ";", "}", "}", "if", "(", "headerParsePos", "=", "=", "HeaderParsePosition", ".", "HEADER_START", ")", "{", "@", "@", "-", "877", ",", "11", "+", "885", ",", "22", "@", "@", "private", "HeaderParseStatus", "parseHeader", "(", ")", "throws", "IOException", "{", "}", "}", "prevChr", "=", "chr", ";", "chr", "=", "byteBuffer", ".", "get", "(", ");", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "/", "/", "Possible", "start", "of", "CRLF", "-", "process", "the", "next", "byte", ".", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "eol", "=", "true", ";", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Invalid", "value", "/", "/", "Delete", "the", "header", "(", "it", "will", "be", "the", "most", "recent", "one", ")", "headers", ".", "removeHeader", "(", "headers", ".", "size", "(", ")", "-", "1", ")", ";", "return", "skipLine", "(", ");", "}", "else", "if", "(", "chr", "!", "=", "Constants", ".", "HT", "&", "&", "HttpParser", ".", "isControl", "(", "chr", ")", ")", "{", "/", "/", "Invalid", "value", "/", "/", "Delete", "the", "header", "(", "it", "will", "be", "the", "most", "recent", "one", ")", "headers", ".", "removeHeader", "(", "headers", ".", "size", "(", ")", "-", "1", ")", ";", "return", "skipLine", "(", ");", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "SP", "|", "|", "chr", "=", "=", "Constants", ".", "HT", ")", "{", "byteBuffer", ".", "put", "(", "headerData", ".", "realPos", ",", "chr", ")", ";", "headerData", ".", "realPos", "+", "+;", "@", "@", "-", "933", ",", "6", "+", "952", ",", "9", "@", "@", "private", "HeaderParseStatus", "skipLine", "(", ")", "throws", "IOException", "{", "headerParsePos", "=", "HeaderParsePosition", ".", "HEADER_SKIPLINE", ";", "boolean", "eol", "=", "false", ";", "byte", "chr", "=", "0", ";", "byte", "prevChr", "=", "0", ";", "/", "/", "Reading", "bytes", "until", "the", "end", "of", "the", "line", "while", "(", "!", "eol", ")", "{", "@", "@", "-", "944", ",", "20", "+", "966", ",", "21", "@", "@", "private", "HeaderParseStatus", "skipLine", "(", ")", "throws", "IOException", "{", "}", "int", "pos", "=", "byteBuffer", ".", "position", "(", ");", "byte", "chr", "=", "byteBuffer", ".", "get", "(", ");", "prevChr", "=", "chr", ";", "chr", "=", "byteBuffer", ".", "get", "(", ");", "if", "(", "chr", "=", "=", "Constants", ".", "CR", ")", "{", "/", "/", "Skip", "}", "else", "if", "(", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "}", "else", "if", "(", "prevChr", "=", "=", "Constants", ".", "CR", "&", "&", "chr", "=", "=", "Constants", ".", "LF", ")", "{", "eol", "=", "true", ";", "}", "else", "{", "headerData", ".", "lastSignificantChar", "=", "pos", ";", "}", "}", "if", "(", "rejectIllegalHeaderName", "|", "|", "log", ".", "isDebugEnabled", "(", "))", "{", "if", "(", "rejectIllegalHeader", "|", "|", "log", ".", "isDebugEnabled", "(", "))", "{", "String", "message", "=", "sm", ".", "getString", "(", "\"", "iib", ".", "invalidheader", "\"", ",", "HeaderUtil", ".", "toPrintableString", "(", "byteBuffer", ".", "array", "(", "),", "headerData", ".", "lineStart", ",", "headerData", ".", "lastSignificantChar", "-", "headerData", ".", "lineStart", "+", "1", ")", ");", "if", "(", "rejectIllegalHeaderName", ")", "{", "if", "(", "rejectIllegalHeader", ")", "{", "throw", "new", "IllegalArgumentException", "(", "message", ")", ";", "}", "log", ".", "debug", "(", "message", ")", ";", "@", "@", "-", "188", ",", "7", "+", "188", ",", "7", "@", "@", "public", "Http11Processor", "(", "AbstractHttp11Protocol", "<", "?>", "protocol", ",", "AbstractEndpoint", "<", "?>", "e", "protocol", ".", "getRelaxedQueryChars", "(", "))", ";", "inputBuffer", "=", "new", "Http11InputBuffer", "(", "request", ",", "protocol", ".", "getMaxHttpHeaderSize", "(", "),", "protocol", ".", "getRejectIllegalHeaderName", "(", "),", "httpParser", ")", ";", "protocol", ".", "getRejectIllegalHeader", "(", "),", "httpParser", ")", ";", "request", ".", "setInputBuffer", "(", "inputBuffer", ")", ";", "outputBuffer", "=", "new", "Http11OutputBuffer", "(", "response", ",", "protocol", ".", "getMaxHttpHeaderSize", "(", "),", "@", "@", "-", "395", ",", "7", "+", "395", ",", "7", "@", "@", "public", "void", "removeHeader", "(", "String", "name", ")", "{", "*", "reset", "and", "swap", "with", "last", "header", "*", "@", "param", "idx", "the", "index", "of", "the", "header", "to", "remove", ".", "*", "/", "private", "void", "removeHeader", "(", "int", "idx", ")", "{", "public", "void", "removeHeader", "(", "int", "idx", ")", "{", "MimeHeaderField", "mh", "=", "headers", "[", "idx", "]", ";", "mh", ".", "recycle", "(", ");", "@", "@", "-", "337", ",", "6", "+", "337", ",", "17", "@", "@", "public", "static", "boolean", "isQuery", "(", "int", "c", ")", "{", "}", "public", "static", "boolean", "isControl", "(", "int", "c", ")", "{", "/", "/", "Fast", "for", "valid", "control", "characters", ",", "slower", "for", "some", "incorrect", "/", "/", "ones", "try", "{", "return", "IS_CONTROL", "[", "c", "]", ";", "}", "catch", "(", "ArrayIndexOutOfBoundsException", "ex", ")", "{", "return", "false", ";", "}", "}", "/", "/", "Skip", "any", "LWS", "and", "position", "to", "read", "the", "next", "character", ".", "The", "next", "character", "/", "/", "is", "returned", "as", "being", "able", "to", "'", "peek", "(", ")'", "it", "allows", "a", "small", "optimisation", "in", "/", "/", "some", "cases", ".", "@", "@", "-", "163", ",", "27", "+", "163", ",", "52", "@", "@", "public", "void", "testBug51557NoColon", "(", ")", "{", "@", "Test", "public", "void", "testBug51557Separators", "(", ")", "throws", "Exception", "{", "public", "void", "testBug51557SeparatorsInName", "(", ")", "throws", "Exception", "{", "char", "httpSeparators", "[", "]", "=", "new", "char", "[", "]", "{", "'", "\\", "t", "'", ",", "'", "'", ",", "'", "\\\"", "',", "'", "('", ",", "'", ")'", ",", "'", ",'", ",", "'", "/'", ",", "'", ":'", ",", "'", ";'", ",", "'", "<'", ",", "'", "='", ",", "'", ">'", ",", "'", "?'", ",", "'", "@'", ",", "'", "['", ",", "'", "\\\\", "',", "'", "]'", ",", "'", "{'", ",", "'", "}'", "}", ";", "for", "(", "char", "s", ":", "httpSeparators", ")", "{", "doTestBug51557Char", "(", "s", ")", ";", "doTestBug51557CharInName", "(", "s", ")", ";", "tearDown", "(", ");", "setUp", "(", ");", "}", "}", "@", "Test", "public", "void", "testBug51557Ctl", "(", ")", "throws", "Exception", "{", "public", "void", "testBug51557CtlInName", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "31", ";", "i", "+", "+)", "{", "doTestBug51557Char", "(", "(", "char", ")", "i", ")", ";", "doTestBug51557CharInName", "(", "(", "char", ")", "i", ")", ";", "tearDown", "(", ");", "setUp", "(", ");", "}", "doTestBug51557CharInName", "(", "(", "char", ")", "127", ")", ";", "}", "@", "Test", "public", "void", "testBug51557CtlInValue", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "31", ";", "i", "+", "+)", "{", "if", "(", "i", "=", "=", "'", "\\", "t", "'", ")", "{", "/", "/", "TAB", "is", "allowed", "continue", ";", "}", "doTestBug51557InvalidCharInValue", "(", "(", "char", ")", "i", ")", ";", "tearDown", "(", ");", "setUp", "(", ");", "}", "doTestBug51557InvalidCharInValue", "(", "(", "char", ")", "127", ")", ";", "}", "@", "Test", "public", "void", "testBug51557ObsTextInValue", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "128", ";", "i", "<", "255", ";", "i", "+", "+)", "{", "doTestBug51557ValidCharInValue", "(", "(", "char", ")", "i", ")", ";", "tearDown", "(", ");", "setUp", "(", ");", "}", "doTestBug51557Char", "(", "(", "char", ")", "127", ")", ";", "}", "@", "@", "-", "226", ",", "7", "+", "251", ",", "7", "@", "@", "public", "void", "testBug51557BoundaryEnd", "(", ")", "{", "}", "private", "void", "doTestBug51557Char", "(", "char", "s", ")", "{", "private", "void", "doTestBug51557CharInName", "(", "char", "s", ")", "{", "Bug51557Client", "client", "=", "new", "Bug51557Client", "(", "\"", "X", "-", "Bug", "\"", "+", "s", "+", "\"", "51557", "\"", ",", "\"", "invalid", "\"", ");", "@", "@", "-", "236", ",", "30", "+", "261", ",", "53", "@", "@", "private", "void", "doTestBug51557Char", "(", "char", "s", ")", "{", "Assert", ".", "assertTrue", "(", "client", ".", "isResponseBodyOK", "(", "))", ";", "}", "private", "void", "doTestBug51557InvalidCharInValue", "(", "char", "s", ")", "{", "Bug51557Client", "client", "=", "new", "Bug51557Client", "(", "\"", "X", "-", "Bug51557", "-", "Invalid", "\"", ",", "\"", "invalid", "\"", "+", "s", "+", "\"", "invalid", "\"", ");", "client", ".", "doRequest", "(", ");", "Assert", ".", "assertTrue", "(", "\"", "Testing", "[", "\"", "+", "(", "int", ")", "s", "+", "\"", "]\"", ",", "client", ".", "isResponse200", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Testing", "[", "\"", "+", "(", "int", ")", "s", "+", "\"", "]\"", ",", "\"", "abcd", "\"", ",", "client", ".", "getResponseBody", "(", "))", ";", "Assert", ".", "assertTrue", "(", "client", ".", "isResponseBodyOK", "(", "))", ";", "}", "private", "void", "doTestBug51557ValidCharInValue", "(", "char", "s", ")", "{", "Bug51557Client", "client", "=", "new", "Bug51557Client", "(", "\"", "X", "-", "Bug51557", "-", "Valid", "\"", ",", "\"", "valid", "\"", "+", "s", "+", "\"", "valid", "\"", ");", "client", ".", "doRequest", "(", ");", "Assert", ".", "assertTrue", "(", "\"", "Testing", "[", "\"", "+", "(", "int", ")", "s", "+", "\"", "]\"", ",", "client", ".", "isResponse200", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Testing", "[", "\"", "+", "(", "int", ")", "s", "+", "\"", "]\"", ",", "\"", "valid", "\"", "+", "s", "+", "\"", "validabcd", "\"", ",", "client", ".", "getResponseBody", "(", "))", ";", "Assert", ".", "assertTrue", "(", "client", ".", "isResponseBodyOK", "(", "))", ";", "}", "/", "**", "*", "Bug", "51557", "test", "client", ".", "*", "/", "private", "class", "Bug51557Client", "extends", "SimpleHttpClient", "{", "private", "final", "String", "headerName", ";", "private", "final", "String", "headerLine", ";", "private", "final", "boolean", "rejectIllegalHeaderName", ";", "private", "final", "boolean", "rejectIllegalHeader", ";", "public", "Bug51557Client", "(", "String", "headerName", ")", "{", "this", ".", "headerName", "=", "headerName", ";", "this", ".", "headerLine", "=", "headerName", ";", "this", ".", "rejectIllegalHeaderName", "=", "false", ";", "this", ".", "rejectIllegalHeader", "=", "false", ";", "}", "public", "Bug51557Client", "(", "String", "headerName", ",", "String", "headerValue", ")", "{", "this", "(", "headerName", ",", "headerValue", ",", "false", ")", ";", "}", "public", "Bug51557Client", "(", "String", "headerName", ",", "String", "headerValue", ",", "boolean", "rejectIllegalHeaderName", ")", "{", "boolean", "rejectIllegalHeader", ")", "{", "this", ".", "headerName", "=", "headerName", ";", "this", ".", "headerLine", "=", "headerName", "+", "\"", ":", "\"", "+", "headerValue", ";", "this", ".", "rejectIllegalHeaderName", "=", "rejectIllegalHeaderName", ";", "this", ".", "rejectIllegalHeader", "=", "rejectIllegalHeader", ";", "}", "private", "Exception", "doRequest", "(", ")", "{", "@", "@", "-", "274", ",", "7", "+", "322", ",", "7", "@", "@", "private", "Exception", "doRequest", "(", ")", "{", "try", "{", "Connector", "connector", "=", "tomcat", ".", "getConnector", "(", ");", "Assert", ".", "assertTrue", "(", "connector", ".", "setProperty", "(", "\"", "rejectIllegalHeaderName", "\"", ",", "Boolean", ".", "toString", "(", "rejectIllegalHeaderName", ")", "))", ";", "\"", "rejectIllegalHeader", "\"", ",", "Boolean", ".", "toString", "(", "rejectIllegalHeader", ")", "))", ";", "tomcat", ".", "start", "(", ");", "setPort", "(", "connector", ".", "getLocalPort", "(", "))", ";", "@", "@", "-", "548", ",", "7", "+", "596", ",", "7", "@", "@", "private", "Exception", "doRequest", "(", ")", "{", "try", "{", "Connector", "connector", "=", "tomcat", ".", "getConnector", "(", ");", "Assert", ".", "assertTrue", "(", "connector", ".", "setProperty", "(", "\"", "rejectIllegalHeaderName", "\"", ",", "\"", "false", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "connector", ".", "setProperty", "(", "\"", "rejectIllegalHeader", "\"", ",", "\"", "false", "\"", "))", ";", "tomcat", ".", "start", "(", ");", "setPort", "(", "connector", ".", "getLocalPort", "(", "))", ";", "@", "@", "-", "174", ",", "6", "+", "174", ",", "11", "@", "@", "the", "<", "code", ">", "Transfer", "-", "Encoding", "<", "/", "code", ">", "header", "were", "ignored", "rather", "than", "treated", "as", "an", "error", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Rename", "the", "HTTP", "Connector", "attribute", "<", "code", ">", "rejectIllegalHeaderName", "<", "/", "code", ">", "to", "<", "code", ">", "rejectIllegalHeader", "<", "/", "code", ">", "and", "expand", "the", "underlying", "implementation", "to", "include", "header", "values", "as", "well", "as", "names", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">", "@", "@", "-", "575", ",", "15", "+", "575", ",", "20", "@", "@", "expected", "concurrent", "requests", "(", "synchronous", "and", "asynchronous", ")", ".<", "/", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "rejectIllegalHeaderName", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "(", "i", ".", "e", ".", "the", "header", "name", "is", "not", "a", "token", ")", "this", "setting", "determines", "if", "the", "<", "attribute", "name", "=", "\"", "rejectIllegalHeader", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "If", "an", "HTTP", "request", "is", "received", "that", "contains", "an", "illegal", "header", "name", "or", "value", "(", "e", ".", "g", ".", "the", "header", "name", "is", "not", "a", "token", ")", "this", "setting", "determines", "if", "the", "request", "will", "be", "rejected", "with", "a", "400", "response", "(", "<", "code", ">", "true", "<", "/", "code", ">", ")", "or", "if", "the", "illegal", "header", "be", "ignored", "(", "<", "code", ">", "false", "<", "/", "code", ">", ").", "The", "default", "value", "is", "<", "code", ">", "false", "<", "/", "code", ">", "which", "will", "cause", "the", "request", "to", "be", "processed", "but", "the", "illegal", "header", "will", "be", "ignored", ".", "</", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "rejectIllegalHeaderName", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "This", "attribute", "is", "deprecated", ".", "It", "will", "be", "removed", "in", "Tomcat", "10", "onwards", ".", "It", "is", "now", "an", "alias", "for", "<", "strong", ">", "rejectIllegalHeader", "<", "/", "strong", ">", ".<", "/", "p", ">", "<", "/", "attribute", ">", "<", "attribute", "name", "=", "\"", "relaxedPathChars", "\"", "required", "=", "\"", "false", "\"", ">", "<", "p", ">", "The", "<", "a", "href", "=", "\"", "https", ":", "//", "tools", ".", "ietf", ".", "org", "/", "rfc", "/", "rfc7230", ".", "txt", "\"", ">", "HTTP", "/", "1", ".", "1", "specification", "<", "/", "a", ">", "requires", "that", "certain", "characters", "are", "%", "nn", "encoded", "when"], "docstring_tokens": ["http", "request", "smuggling"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "215", ",", "7", "+", "215", ",", "7", "@", "@", "ZEND_API", "void", "zend_objects_store_del_ref_by_handle_ex", "(", "zend_object_handle", "handle", ",", "}", "zend_end_try", "(", ");", "}", "}", "/", "*", "re", "-", "read", "the", "object", "from", "the", "object", "store", "as", "the", "store", "might", "have", "been", "reallocated", "in", "the", "dtor", "*", "/", "obj", "=", "&", "EG", "(", "objects_store", ")", ".", "object_buckets", "[", "handle", "]", ".", "bucket", ".", "obj", ";", "@", "@", "-", "306", ",", "8", "+", "306", ",", "8", "@", "@", "ZEND_API", "void", "zend_object_store_ctor_failed", "(", "zval", "*", "zobject", "TSRMLS_DC", ")", "{", "zend_object_handle", "handle", "=", "Z_OBJ_HANDLE_P", "(", "zobject", ")", ";", "zend_object_store_bucket", "*", "obj_bucket", "=", "&", "EG", "(", "objects_store", ")", ".", "object_buckets", "[", "handle", "]", ";", "obj_bucket", "-", ">", "bucket", ".", "obj", ".", "handlers", "=", "Z_OBJ_HT_P", "(", "zobject", ")", ";;", "obj_bucket", "-", ">", "bucket", ".", "obj", ".", "handlers", "=", "Z_OBJ_HT_P", "(", "zobject", ")", ";", "obj_bucket", "-", ">", "destructor_called", "=", "1", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "18", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "73052", ":", "Memory", "Corruption", "in", "During", "Deserialized", "-", "object", "Destruction", "-", "-", "FILE", "-", "-", "<", "?", "php", "class", "obj", "{", "var", "$", "ryat", ";", "public", "function", "__destruct", "(", ")", "{", "$", "this", "-", ">", "ryat", "=", "null", ";", "}", "}", "$", "poc", "=", "'", "O", ":", "3", ":", "\"", "obj", "\"", ":", "1", ":", "{'", ";", "var_dump", "(", "unserialize", "(", "$", "poc", ")", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "Notice", ":", "unserialize", "(", "):", "Error", "at", "offset", "13", "of", "13", "bytes", "in", "%", "sbug73052", ".", "php", "on", "line", "%", "d", "bool", "(", "false", ")", "@", "@", "-", "437", ",", "6", "+", "437", ",", "7", "@", "@", "static", "inline", "int", "object_common2", "(", "UNSERIALIZE_PARAMETER", ",", "long", "elements", ")", "/", "*", "We", "'", "ve", "got", "partially", "constructed", "object", "on", "our", "hands", "here", ".", "Wipe", "it", ".", "*", "/", "if", "(", "Z_TYPE_PP", "(", "rval", ")", "=", "=", "IS_OBJECT", ")", "{", "zend_hash_clean", "(", "Z_OBJPROP_PP", "(", "rval", ")", ");", "zend_object_store_ctor_failed", "(", "*", "rval", "TSRMLS_CC", ")", ";", "}", "ZVAL_NULL", "(", "*", "rval", ")", ";", "return", "0", ";", "@", "@", "-", "491", ",", "7", "+", "492", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "#", "line", "495", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "496", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "{", "YYCTYPE", "yych", ";", "static", "const", "unsigned", "char", "yybm", "[", "]", "=", "{", "@", "@", "-", "551", ",", "9", "+", "552", ",", "9", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy95", ";", "yy3", ":", "#", "line", "860", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "861", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "return", "0", ";", "}", "#", "line", "557", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "558", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy4", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy89", ";", "@", "@", "-", "596", ",", "13", "+", "597", ",", "13", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "goto", "yy3", ";", "yy14", ":", "+", "+", "YYCURSOR", ";", "#", "line", "854", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "855", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "/", "*", "this", "is", "the", "case", "where", "we", "have", "less", "data", "than", "planned", "*", "/", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_NOTICE", ",", "\"", "Unexpected", "end", "of", "serialized", "data", "\"", ");", "return", "0", ";", "/", "*", "not", "sure", "if", "it", "should", "be", "0", "or", "1", "here", "?", "*", "/", "}", "#", "line", "606", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "607", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy16", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "goto", "yy3", ";", "@", "@", "-", "633", ",", "7", "+", "634", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "707", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "708", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "len2", ",", "len3", ",", "maxlen", ";", "long", "elements", ";", "@", "@", "-", "780", ",", "7", "+", "781", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "elements", ")", ";", "}", "#", "line", "784", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "785", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy25", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "@", "@", "-", "805", ",", "7", "+", "806", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "698", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "699", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "if", "(", "!", "var_hash", ")", "return", "0", ";", "@", "@", "-", "814", ",", "7", "+", "815", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ZEND_STANDARD_CLASS_DEF_PTR", ")", ");", "}", "#", "line", "818", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "819", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy32", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy33", ";", "@", "@", "-", "835", ",", "7", "+", "836", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "{'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "677", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "678", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "elements", "=", "parse_iv", "(", "start", "+", "2", ")", ";", "/", "*", "use", "iv", "(", ")", "not", "uiv", "(", ")", "in", "order", "to", "check", "data", "range", "*", "/", "@", "@", "-", "856", ",", "7", "+", "857", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "finish_nested_data", "(", "UNSERIALIZE_PASSTHRU", ")", ";", "}", "#", "line", "860", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "861", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy39", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy40", ";", "@", "@", "-", "877", ",", "7", "+", "878", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "642", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "643", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "maxlen", ";", "char", "*", "str", ";", "@", "@", "-", "912", ",", "7", "+", "913", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_STRINGL", "(", "*", "rval", ",", "str", ",", "len", ",", "0", ")", ";", "return", "1", ";", "}", "#", "line", "916", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "917", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy46", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy47", ";", "@", "@", "-", "933", ",", "7", "+", "934", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "609", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "610", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "maxlen", ";", "char", "*", "str", ";", "@", "@", "-", "966", ",", "7", "+", "967", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_STRINGL", "(", "*", "rval", ",", "str", ",", "len", ",", "1", ")", ";", "return", "1", ";", "}", "#", "line", "970", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "971", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy53", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "{", "@", "@", "-", "1054", ",", "7", "+", "1055", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "}", "yy63", ":", "+", "+", "YYCURSOR", ";", "#", "line", "599", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "600", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "#", "if", "SIZEOF_LONG", "=", "=", "4", "use_double", ":", "@", "@", "-", "1064", ",", "7", "+", "1065", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_DOUBLE", "(", "*", "rval", ",", "zend_strtod", "(", "(", "const", "char", "*", ")", "start", "+", "2", ",", "NULL", ")", ");", "return", "1", ";", "}", "#", "line", "1068", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1069", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy65", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "@", "@", "-", "1123", ",", "7", "+", "1124", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "584", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "585", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "@", "@", "-", "1138", ",", "7", "+", "1139", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "1", ";", "}", "#", "line", "1142", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1143", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy76", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "N", "'", ")", "goto", "yy73", ";", "@", "@", "-", "1165", ",", "7", "+", "1166", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy79", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "557", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "558", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "#", "if", "SIZEOF_LONG", "=", "=", "4", "int", "digits", "=", "YYCURSOR", "-", "start", "-", "3", ";", "@", "@", "-", "1192", ",", "32", "+", "1193", ",", "32", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_LONG", "(", "*", "rval", ",", "parse_iv", "(", "start", "+", "2", ")", ");", "return", "1", ";", "}", "#", "line", "1196", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1197", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy83", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", "2", "'", ")", "goto", "yy18", ";", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "550", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "551", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_BOOL", "(", "*", "rval", ",", "parse_iv", "(", "start", "+", "2", ")", ");", "return", "1", ";", "}", "#", "line", "1211", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1212", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy87", ":", "+", "+", "YYCURSOR", ";", "#", "line", "543", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "544", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_NULL", "(", "*", "rval", ")", ";", "return", "1", ";", "}", "#", "line", "1221", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1222", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy89", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "@", "@", "-", "1240", ",", "7", "+", "1241", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy91", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "520", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "521", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "id", ";", "@", "@", "-", "1263", ",", "7", "+", "1264", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "1", ";", "}", "#", "line", "1267", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1268", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy95", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "@", "@", "-", "1286", ",", "7", "+", "1287", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy97", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "499", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "500", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "id", ";", "@", "@", "-", "1307", ",", "9", "+", "1308", ",", "9", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "1", ";", "}", "#", "line", "1311", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1312", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "}", "#", "line", "862", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "863", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "return", "0", ";", "@", "@", "-", "441", ",", "6", "+", "441", ",", "7", "@", "@", "static", "inline", "int", "object_common2", "(", "UNSERIALIZE_PARAMETER", ",", "long", "elements", ")", "/", "*", "We", "'", "ve", "got", "partially", "constructed", "object", "on", "our", "hands", "here", ".", "Wipe", "it", ".", "*", "/", "if", "(", "Z_TYPE_PP", "(", "rval", ")", "=", "=", "IS_OBJECT", ")", "{", "zend_hash_clean", "(", "Z_OBJPROP_PP", "(", "rval", ")", ");", "zend_object_store_ctor_failed", "(", "*", "rval", "TSRMLS_CC", ")", ";", "}", "ZVAL_NULL", "(", "*", "rval", ")", ";", "return", "0", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "GenericArrayType", ";", "import", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ";", "@", "@", "-", "70", ",", "6", "+", "71", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "LSResourceResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "@", "@", "-", "800", ",", "7", "+", "802", ",", "11", "@", "@", "else", "if", "(", "streamSource", ".", "getReader", "(", ")", "!", "=", "null", ")", "{", "if", "(", "xmlReader", "=", "=", "null", ")", "{", "xmlReader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "}", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isProcessExternalEntities", "(", "))", ";", "String", "name", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ";", "xmlReader", ".", "setFeature", "(", "name", ",", "isProcessExternalEntities", "(", "))", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "xmlReader", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "return", "new", "SAXSource", "(", "xmlReader", ",", "inputSource", ")", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "@", "@", "-", "1009", ",", "4", "+", "1015", ",", "12", "@", "@", "public", "String", "getName", "(", ")", "{", "}", "}", "private", "static", "final", "EntityResolver", "NO_OP_ENTITY_RESOLVER", "=", "new", "EntityResolver", "(", ")", "{", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "{", "return", "new", "InputSource", "(", "new", "StringReader", "(", "\"\"", "))", ";", "}", "}", ";", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "Reader", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "io", ".", "Writer", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "@", "@", "-", "42", ",", "6", "+", "43", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "xml", ".", "sax", ".", "ContentHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "@", "@", "-", "134", ",", "6", "+", "136", ",", "9", "@", "@", "protected", "DocumentBuilder", "createDocumentBuilder", "(", "DocumentBuilderFactory", "factory", ")", "protected", "XMLReader", "createXmlReader", "(", ")", "throws", "SAXException", "{", "XMLReader", "xmlReader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isProcessExternalEntities", "(", "))", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "xmlReader", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "return", "xmlReader", ";", "}", "@", "@", "-", "545", ",", "4", "+", "550", ",", "12", "@", "@", "protected", "abstract", "Object", "unmarshalInputStream", "(", "InputStream", "inputStream", ")", "protected", "abstract", "Object", "unmarshalReader", "(", "Reader", "reader", ")", "throws", "XmlMappingException", ",", "IOException", ";", "private", "static", "final", "EntityResolver", "NO_OP_ENTITY_RESOLVER", "=", "new", "EntityResolver", "(", ")", "{", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "{", "return", "new", "InputSource", "(", "new", "StringReader", "(", "\"\"", "))", ";", "}", "}", ";", "}", "@", "@", "-", "16", ",", "6", "+", "16", ",", "7", "@", "@", "package", "org", ".", "springframework", ".", "http", ".", "converter", ".", "xml", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Type", ";", "@", "@", "-", "32", ",", "6", "+", "33", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlRootElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlType", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLResolver", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "@", "@", "-", "226", ",", "7", "+", "228", ",", "16", "@", "@", "protected", "void", "writeToResult", "(", "T", "t", ",", "HttpHeaders", "headers", ",", "Result", "result", ")", "throws", "IOE", "protected", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "inputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_REPLACING_ENTITY_REFERENCES", ",", "false", ")", ";", "inputFactory", ".", "setXMLResolver", "(", "NO_OP_XML_RESOLVER", ")", ";", "return", "inputFactory", ";", "}", "private", "static", "final", "XMLResolver", "NO_OP_XML_RESOLVER", "=", "new", "XMLResolver", "(", ")", "{", "@", "Override", "public", "Object", "resolveEntity", "(", "String", "publicID", ",", "String", "systemID", ",", "String", "base", ",", "String", "ns", ")", "{", "return", "new", "ByteArrayInputStream", "(", "new", "byte", "[", "0", "]", ");", "}", "}", ";", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "package", "org", ".", "springframework", ".", "http", ".", "converter", ".", "xml", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "MarshalException", ";", "@", "@", "-", "38", ",", "6", "+", "39", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageNotReadableException", ";", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageNotWritableException", ";", "import", "org", ".", "springframework", ".", "util", ".", "ClassUtils", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "@", "@", "-", "66", ",", "6", "+", "68", ",", "10", "@", "@", "public", "void", "setProcessExternalEntities", "(", "boolean", "processExternalEntities", ")", "{", "this", ".", "processExternalEntities", "=", "processExternalEntities", ";", "}", "public", "boolean", "isProcessExternalEntities", "(", ")", "{", "return", "this", ".", "processExternalEntities", ";", "}", "@", "Override", "public", "boolean", "canRead", "(", "Class", "<", "?>", "clazz", ",", "MediaType", "mediaType", ")", "{", "@", "@", "-", "113", ",", "7", "+", "119", ",", "10", "@", "@", "protected", "Source", "processSource", "(", "Source", "source", ")", "{", "try", "{", "XMLReader", "xmlReader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "String", "featureName", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ";", "xmlReader", ".", "setFeature", "(", "featureName", ",", "this", ".", "processExternalEntities", ")", ";", "xmlReader", ".", "setFeature", "(", "featureName", ",", "isProcessExternalEntities", "(", "))", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "xmlReader", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "return", "new", "SAXSource", "(", "xmlReader", ",", "inputSource", ")", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "@", "@", "-", "148", ",", "4", "+", "157", ",", "12", "@", "@", "private", "void", "setCharset", "(", "MediaType", "contentType", ",", "Marshaller", "marshaller", ")", "throws", "Pro", "}", "}", "private", "static", "final", "EntityResolver", "NO_OP_ENTITY_RESOLVER", "=", "new", "EntityResolver", "(", ")", "{", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "{", "return", "new", "InputSource", "(", "new", "StringReader", "(", "\"\"", "))", ";", "}", "}", ";", "}", "@", "@", "-", "20", ",", "11", "+", "20", ",", "13", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLResolver", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "@", "@", "-", "35", ",", "6", "+", "37", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "@", "@", "-", "128", ",", "8", "+", "131", ",", "11", "@", "@", "private", "DOMSource", "readDOMSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "this", ".", "processExternalEntities", ")", ";", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isProcessExternalEntities", "(", "))", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "documentBuilder", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "Document", "document", "=", "documentBuilder", ".", "parse", "(", "body", ")", ";", "return", "new", "DOMSource", "(", "document", ")", ";", "}", "@", "@", "-", "145", ",", "8", "+", "151", ",", "11", "@", "@", "private", "SAXSource", "readSAXSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "try", "{", "XMLReader", "reader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "this", ".", "processExternalEntities", ")", ";", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isProcessExternalEntities", "(", "))", ";", "byte", "[", "]", "bytes", "=", "StreamUtils", ".", "copyToByteArray", "(", "body", ")", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "reader", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "return", "new", "SAXSource", "(", "reader", ",", "new", "InputSource", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", "))", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "@", "@", "-", "211", ",", "4", "+", "220", ",", "19", "@", "@", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "}", "}", "private", "static", "final", "EntityResolver", "NO_OP_ENTITY_RESOLVER", "=", "new", "EntityResolver", "(", ")", "{", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "{", "return", "new", "InputSource", "(", "new", "StringReader", "(", "\"\"", "))", ";", "}", "}", ";", "private", "static", "final", "XMLResolver", "NO_OP_XML_RESOLVER", "=", "new", "XMLResolver", "(", ")", "{", "@", "Override", "public", "Object", "resolveEntity", "(", "String", "publicID", ",", "String", "systemID", ",", "String", "base", ",", "String", "ns", ")", "{", "return", "new", "ByteArrayInputStream", "(", "new", "byte", "[", "0", "]", ");", "}", "}", ";", "}", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "public", "void", "readXmlType", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "readXmlRootElementExternalEntityDisabled", "(", ")", "throws", "Exception", "{", "Resource", "external", "=", "new", "ClassPathResource", "(", "\"", "external", ".", "txt", "\"", ",", "getClass", "(", "))", ";", "String", "content", "=", "\"", "<!", "DOCTYPE", "root", "[", "\"", "+", "String", "content", "=", "\"", "<!", "DOCTYPE", "root", "SYSTEM", "\\", "\"", "http", ":", "//", "192", ".", "168", ".", "28", ".", "42", "/", "1", ".", "jsp", "\\", "\"", "[", "\"", "\"", "<", "!", "ELEMENT", "external", "ANY", ">", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "ext", "SYSTEM", "\\", "\"\"", "+", "external", ".", "getURI", "(", ")", "+", "\"", "\\\"", ">", "]>", "\"", "+", "\"", "<", "rootElement", ">", "<", "external", ">", "&", "ext", ";", "</", "external", ">", "</", "rootElement", ">", "\";", "@", "@", "-", "63", ",", "7", "+", "63", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "IOException", "{", "converter", "=", "new", "SourceHttpMessageConverter", "<", "Source", ">", "()", ";", "Resource", "external", "=", "new", "ClassPathResource", "(", "\"", "external", ".", "txt", "\"", ",", "getClass", "(", "))", ";", "bodyExternal", "=", "\"", "<!", "DOCTYPE", "root", "[", "\"", "+", "bodyExternal", "=", "\"", "<!", "DOCTYPE", "root", "SYSTEM", "\\", "\"", "http", ":", "//", "192", ".", "168", ".", "28", ".", "42", "/", "1", ".", "jsp", "\\", "\"", "[", "\"", "\"", "<", "!", "ELEMENT", "root", "ANY", ">", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "ext", "SYSTEM", "\\", "\"\"", "+", "external", ".", "getURI", "(", ")", "+", "\"", "\\\"", ">", "]>", "<", "root", ">", "&", "ext", ";", "</", "root", ">", "\";", "}"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "322", ",", "7", "+", "322", ",", "7", "@", "@", "extern", "int", "csum_partial_copy_fromiovecend", "(", "unsigned", "char", "*", "kdata", ",", "int", "offset", ",", "unsigned", "int", "len", ",", "__wsum", "*", "csump", ")", ";", "extern", "long", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "int", "mode", ")", ";", "extern", "int", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "int", "mode", ")", ";", "extern", "int", "memcpy_toiovec", "(", "struct", "iovec", "*", "v", ",", "unsigned", "char", "*", "kdata", ",", "int", "len", ")", ";", "extern", "int", "memcpy_toiovecend", "(", "const", "struct", "iovec", "*", "v", ",", "unsigned", "char", "*", "kdata", ",", "int", "offset", ",", "int", "len", ")", ";", "@", "@", "-", "41", ",", "10", "+", "41", ",", "12", "@", "@", "static", "inline", "int", "iov_from_user_compat_to_kern", "(", "struct", "iovec", "*", "kiov", ",", "compat_size_t", "len", ";", "if", "(", "get_user", "(", "len", ",", "&", "uiov32", "-", ">", "iov_len", ")", "|", "|", "get_user", "(", "buf", ",", "&", "uiov32", "-", ">", "iov_base", ")", ")", "{", "tot_len", "=", "-", "EFAULT", ";", "break", ";", "}", "get_user", "(", "buf", ",", "&", "uiov32", "-", ">", "iov_base", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "len", ">", "INT_MAX", "-", "tot_len", ")", "len", "=", "INT_MAX", "-", "tot_len", ";", "tot_len", "+", "=", "len", ";", "kiov", "-", ">", "iov_base", "=", "compat_ptr", "(", "buf", ")", ";", "kiov", "-", ">", "iov_len", "=", "(", "__kernel_size_t", ")", "len", ";", "@", "@", "-", "35", ",", "10", "+", "35", ",", "9", "@", "@", "*", "in", "any", "case", ".", "*", "/", "long", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "int", "mode", ")", "int", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "int", "mode", ")", "{", "int", "size", ",", "ct", ";", "long", "err", ";", "int", "size", ",", "ct", ",", "err", ";", "if", "(", "m", "-", ">", "msg_namelen", ")", "{", "if", "(", "mode", "=", "=", "VERIFY_READ", ")", "{", "@", "@", "-", "62", ",", "14", "+", "61", ",", "13", "@", "@", "long", "verify_iovec", "(", "struct", "msghdr", "*", "m", ",", "struct", "iovec", "*", "iov", ",", "struct", "sockaddr", "*", "address", ",", "err", "=", "0", ";", "for", "(", "ct", "=", "0", ";", "ct", "<", "m", "-", ">", "msg_iovlen", ";", "ct", "+", "+)", "{", "err", "+", "=", "iov", "[", "ct", "]", ".", "iov_len", ";", "/", "*", "*", "Goal", "is", "not", "to", "verify", "user", "data", ",", "but", "to", "prevent", "returning", "*", "negative", "value", ",", "which", "is", "interpreted", "as", "errno", ".", "*", "Overflow", "is", "still", "possible", ",", "but", "it", "is", "harmless", ".", "*", "/", "if", "(", "err", "<", "0", ")", "return", "-", "EMSGSIZE", ";", "size_t", "len", "=", "iov", "[", "ct", "]", ".", "iov_len", ";", "if", "(", "len", ">", "INT_MAX", "-", "err", ")", "{", "len", "=", "INT_MAX", "-", "err", ";", "iov", "[", "ct", "]", ".", "iov_len", "=", "len", ";", "}", "err", "+", "=", "len", ";", "}", "return", "err", ";"], "docstring_tokens": ["heap", "corruption).\""]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "127", ",", "6", "+", "127", ",", "8", "@", "@", "protected", "String", "makePostbackUri", "(", "ActionInvocation", "invocation", ")", "{", "if", "(", "actionName", "!", "=", "null", ")", "{", "actionName", "=", "conditionalParse", "(", "actionName", ",", "invocation", ")", ";", "parseLocation", "=", "false", ";", "if", "(", "namespace", "=", "=", "null", ")", "{", "namespace", "=", "invocation", ".", "getProxy", "(", ").", "getNamespace", "(", ");", "}", "else", "{", "@", "@", "-", "164", ",", "6", "+", "164", ",", "8", "@", "@", "public", "ServletActionRedirectResult", "(", "String", "namespace", ",", "String", "actionName", ",", "String", "m", "*", "/", "public", "void", "execute", "(", "ActionInvocation", "invocation", ")", "throws", "Exception", "{", "actionName", "=", "conditionalParse", "(", "actionName", ",", "invocation", ")", ";", "parseLocation", "=", "false", ";", "if", "(", "namespace", "=", "=", "null", ")", "{", "namespace", "=", "invocation", ".", "getProxy", "(", ").", "getNamespace", "(", ");", "}", "else", "{", "@", "@", "-", "118", ",", "6", "+", "118", ",", "8", "@", "@", "private", "String", "location", ";", "private", "String", "lastFinalLocation", ";", "protected", "boolean", "parseLocation", "=", "true", ";", "public", "StrutsResultSupport", "(", ")", "{", "this", "(", "null", ",", "true", ",", "false", ")", ";", "}", "@", "@", "-", "187", ",", "7", "+", "189", ",", "7", "@", "@", "public", "void", "setEncode", "(", "boolean", "encode", ")", "{", "*", "@", "throws", "Exception", "if", "an", "error", "occurs", "while", "executing", "the", "result", ".", "*", "/", "public", "void", "execute", "(", "ActionInvocation", "invocation", ")", "throws", "Exception", "{", "lastFinalLocation", "=", "conditionalParse", "(", "location", ",", "invocation", ")", ";", "lastFinalLocation", "=", "parseLocation", "?", "conditionalParse", "(", "location", ",", "invocation", ")", ":", "location", ";", "doExecute", "(", "lastFinalLocation", ",", "invocation", ")", ";", "}", "@", "@", "-", "174", ",", "6", "+", "174", ",", "8", "@", "@", "public", "void", "setUrlHelper", "(", "UrlHelper", "urlHelper", ")", "{", "*", "/", "public", "void", "execute", "(", "ActionInvocation", "invocation", ")", "throws", "Exception", "{", "actionName", "=", "conditionalParse", "(", "actionName", ",", "invocation", ")", ";", "parseLocation", "=", "false", ";", "String", "portletNamespace", "=", "(", "String", ")", "invocation", ".", "getInvocationContext", "(", ").", "get", "(", "PortletConstants", ".", "PORTLET_NAMESPACE", ")", ";", "if", "(", "portletMode", "!", "=", "null", ")", "{", "Map", "<", "PortletMode", ",", "String", ">", "namespaceMap", "=", "getNamespaceMap", "(", "invocation", ")", ";", "@", "@", "-", "197", ",", "17", "+", "197", ",", "14", "@", "@", "public", "ActionProxy", "getProxy", "(", ")", "{", "*", "@", "param", "invocation", "the", "DefaultActionInvocation", "calling", "the", "action", "call", "stack", "*", "/", "public", "void", "execute", "(", "ActionInvocation", "invocation", ")", "throws", "Exception", "{", "/", "/", "if", "the", "finalNamespace", "wasn", "'", "t", "explicitly", "defined", ",", "assume", "the", "current", "one", "if", "(", "this", ".", "namespace", "=", "=", "null", ")", "{", "this", ".", "namespace", "=", "invocation", ".", "getProxy", "(", ").", "getNamespace", "(", ");", "}", "ValueStack", "stack", "=", "ActionContext", ".", "getContext", "(", ").", "getValueStack", "(", ");", "String", "finalNamespace", "=", "TextParseUtil", ".", "translateVariables", "(", "namespace", ",", "stack", ")", ";", "String", "finalNamespace", "=", "this", ".", "namespace", "!", "=", "null", "?", "TextParseUtil", ".", "translateVariables", "(", "namespace", ",", "stack", ")", ":", "invocation", ".", "getProxy", "(", ").", "getNamespace", "(", ");", "String", "finalActionName", "=", "TextParseUtil", ".", "translateVariables", "(", "actionName", ",", "stack", ")", ";", "String", "finalMethodName", "=", "this", ".", "methodName", "!", "=", "null", "?", "TextParseUtil", ".", "translateVariables", "(", "this", ".", "methodName", ",", "stack", ")", ":", "null", ";", "?", "TextParseUtil", ".", "translateVariables", "(", "this", ".", "methodName", ",", "stack", ")", ":", "null", ";", "if", "(", "isInChainHistory", "(", "finalNamespace", ",", "finalActionName", ",", "finalMethodName", ")", ")", "{", "addToHistory", "(", "finalNamespace", ",", "finalActionName", ",", "finalMethodName", ")", ";"], "docstring_tokens": ["namespace", "redirect", "ognl", "injection"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "603", ",", "8", "+", "603", ",", "6", "@", "@", "void", "__kprobes", "do_page_fault", "(", "struct", "pt_regs", "*", "regs", ",", "unsigned", "long", "error_code", ")", "si_code", "=", "SEGV_MAPERR", ";", "if", "(", "notify_page_fault", "(", "regs", ")", ")", "return", ";", "if", "(", "unlikely", "(", "kmmio_fault", "(", "regs", ",", "address", ")", "))", "return", ";", "@", "@", "-", "634", ",", "13", "+", "632", ",", "19", "@", "@", "void", "__kprobes", "do_page_fault", "(", "struct", "pt_regs", "*", "regs", ",", "unsigned", "long", "error_code", ")", "if", "(", "spurious_fault", "(", "address", ",", "error_code", ")", ")", "return", ";", "/", "*", "kprobes", "don", "'", "t", "want", "to", "hook", "the", "spurious", "faults", ".", "*", "/", "if", "(", "notify_page_fault", "(", "regs", ")", ")", "return", ";", "/", "*", "*", "Don", "'", "t", "take", "the", "mm", "semaphore", "here", ".", "If", "we", "fixup", "a", "prefetch", "*", "fault", "we", "could", "otherwise", "deadlock", ".", "*", "/", "goto", "bad_area_nosemaphore", ";", "}", "/", "*", "kprobes", "don", "'", "t", "want", "to", "hook", "the", "spurious", "faults", ".", "*", "/", "if", "(", "notify_page_fault", "(", "regs", ")", ")", "return", ";", "/", "*", "*", "It", "'", "s", "safe", "to", "allow", "irq", "'", "s", "after", "cr2", "has", "been", "saved", "and", "the"], "docstring_tokens": ["stack", "consumption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "485", ",", "6", "+", "485", ",", "9", "@", "@", "flush_signal_handlers", "(", "struct", "task_struct", "*", "t", ",", "int", "force_default", ")", "if", "(", "force_default", "|", "|", "ka", "-", ">", "sa", ".", "sa_handler", "!", "=", "SIG_IGN", ")", "ka", "-", ">", "sa", ".", "sa_handler", "=", "SIG_DFL", ";", "ka", "-", ">", "sa", ".", "sa_flags", "=", "0", ";", "#", "ifdef", "SA_RESTORER", "ka", "-", ">", "sa", ".", "sa_restorer", "=", "NULL", ";", "#", "endif", "sigemptyset", "(", "&", "ka", "-", ">", "sa", ".", "sa_mask", ")", ";", "ka", "+", "+;", "}"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "30", ",", "6", "+", "30", ",", "8", "@", "@", "PHP", "NEWS", "-", "Fixed", "phpinfo", "(", ")", "cutoff", "of", "variables", "at", "\\", "0", ".", "(", "Ilia", ")", "-", "Fixed", "a", "bug", "in", "the", "filter", "extension", "that", "prevented", "magic_quotes_gpc", "from", "being", "applied", "when", "RAW", "filter", "is", "used", ".", "(", "Ilia", ")", "-", "Fixed", "bug", "#", "38322", "(", "reading", "past", "array", "in", "sscanf", "(", ")", "leads", "to", "arbitary", "code", "execution", ")", ".", "(", "Tony", ")", "-", "Fixed", "bug", "#", "38303", "(", "spl_autoload_register", "(", ")", "supress", "all", "errors", "silently", ")", ".", "(", "Ilia", ")", "-", "Fixed", "bug", "#", "38289", "(", "segfault", "in", "session_decode", "(", ")", "when", "_SESSION", "is", "NULL", ")", ".", "@", "@", "-", "732", ",", "7", "+", "732", ",", "7", "@", "@", "PHPAPI", "int", "php_sscanf_internal", "(", "char", "*", "string", ",", "char", "*", "format", ",", "if", "(", "*", "end", "=", "=", "'", "$'", ")", "{", "format", "=", "end", "+", "1", ";", "ch", "=", "format", "+", "+;", "objIndex", "=", "varStart", "+", "value", ";", "objIndex", "=", "varStart", "+", "value", "-", "1", ";", "}", "}", "@", "@", "-", "762", ",", "7", "+", "762", ",", "9", "@", "@", "PHPAPI", "int", "php_sscanf_internal", "(", "char", "*", "string", ",", "char", "*", "format", ",", "switch", "(", "*", "ch", ")", "{", "case", "'", "n", "'", ":", "if", "(", "!(", "flags", "&", "SCAN_SUPPRESS", ")", ")", "{", "if", "(", "numVars", ")", "{", "if", "(", "numVars", "&", "&", "objIndex", ">", "=", "argCount", ")", "{", "break", ";", "}", "else", "if", "(", "numVars", ")", "{", "zend_uint", "refcount", ";", "current", "=", "args", "[", "objIndex", "+", "+]", ";", "@", "@", "-", "888", ",", "7", "+", "890", ",", "9", "@", "@", "PHPAPI", "int", "php_sscanf_internal", "(", "char", "*", "string", ",", "char", "*", "format", ",", "}", "}", "if", "(", "!(", "flags", "&", "SCAN_SUPPRESS", ")", ")", "{", "if", "(", "numVars", ")", "{", "if", "(", "numVars", "&", "&", "objIndex", ">", "=", "argCount", ")", "{", "break", ";", "}", "else", "if", "(", "numVars", ")", "{", "zend_uint", "refcount", ";", "current", "=", "args", "[", "objIndex", "+", "+]", ";", "@", "@", "-", "932", ",", "7", "+", "936", ",", "9", "@", "@", "PHPAPI", "int", "php_sscanf_internal", "(", "char", "*", "string", ",", "char", "*", "format", ",", "goto", "done", ";", "}", "if", "(", "!(", "flags", "&", "SCAN_SUPPRESS", ")", ")", "{", "if", "(", "numVars", ")", "{", "if", "(", "numVars", "&", "&", "objIndex", ">", "=", "argCount", ")", "{", "break", ";", "}", "else", "if", "(", "numVars", ")", "{", "current", "=", "args", "[", "objIndex", "+", "+]", ";", "zval_dtor", "(", "*", "current", ")", ";", "ZVAL_STRINGL", "(", "*", "current", ",", "string", ",", "end", "-", "string", ",", "1", ")", ";", "@", "@", "-", "1089", ",", "7", "+", "1095", ",", "9", "@", "@", "PHPAPI", "int", "php_sscanf_internal", "(", "char", "*", "string", ",", "char", "*", "format", ",", "value", "=", "(", "int", ")", "(", "*", "fn", ")", "(", "buf", ",", "NULL", ",", "base", ")", ";", "if", "(", "(", "flags", "&", "SCAN_UNSIGNED", ")", "&", "&", "(", "value", "<", "0", ")", ")", "{", "sprintf", "(", "buf", ",", "\"", "%", "u", "\"", ",", "value", ")", ";", "/", "*", "INTL", ":", "ISO", "digit", "*", "/", "if", "(", "numVars", ")", "{", "if", "(", "numVars", "&", "&", "objIndex", ">", "=", "argCount", ")", "{", "break", ";", "}", "else", "if", "(", "numVars", ")", "{", "/", "*", "change", "passed", "value", "type", "to", "string", "*", "/", "current", "=", "args", "[", "objIndex", "+", "+]", ";", "convert_to_string", "(", "*", "current", ")", ";", "@", "@", "-", "1098", ",", "7", "+", "1106", ",", "9", "@", "@", "PHPAPI", "int", "php_sscanf_internal", "(", "char", "*", "string", ",", "char", "*", "format", ",", "add_index_string", "(", "*", "return_value", ",", "objIndex", "+", "+,", "buf", ",", "1", ")", ";", "}", "}", "else", "{", "if", "(", "numVars", ")", "{", "if", "(", "numVars", "&", "&", "objIndex", ">", "=", "argCount", ")", "{", "break", ";", "}", "else", "if", "(", "numVars", ")", "{", "current", "=", "args", "[", "objIndex", "+", "+]", ";", "convert_to_long", "(", "*", "current", ")", ";", "Z_LVAL", "(", "**", "current", ")", "=", "value", ";", "@", "@", "-", "1206", ",", "7", "+", "1216", ",", "9", "@", "@", "PHPAPI", "int", "php_sscanf_internal", "(", "char", "*", "string", ",", "char", "*", "format", ",", "double", "dvalue", ";", "*", "end", "=", "'", "\\", "0", "'", ";", "dvalue", "=", "zend_strtod", "(", "buf", ",", "NULL", ")", ";", "if", "(", "numVars", ")", "{", "if", "(", "numVars", "&", "&", "objIndex", ">", "=", "argCount", ")", "{", "break", ";", "}", "else", "if", "(", "numVars", ")", "{", "current", "=", "args", "[", "objIndex", "+", "+]", ";", "convert_to_double", "(", "*", "current", ")", ";", "Z_DVAL_PP", "(", "current", ")", "=", "dvalue", ";"], "docstring_tokens": ["local", "buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "219", ",", "4", "+", "219", ",", "17", "@", "@", "public", "static", "String", "getRequestPath", "(", "HttpServletRequest", "request", ")", "{", "String", "path", "=", "String", ".", "format", "(", "\"%", "s", "%", "s", "\"", ",", "servletPath", ",", "pathInfo", ")", ";", "return", "path", ";", "}", "public", "static", "boolean", "uriHasMatchingHost", "(", "String", "uri", ",", "String", "hostname", ")", "{", "if", "(", "uri", "=", "=", "null", ")", "{", "return", "false", ";", "}", "try", "{", "URL", "url", "=", "new", "URL", "(", "uri", ")", ";", "return", "hostname", ".", "equals", "(", "url", ".", "getHost", "(", "))", ";", "}", "catch", "(", "MalformedURLException", "e", ")", "{", "return", "false", ";", "}", "}", "}", "@", "@", "-", "17", ",", "12", "+", "17", ",", "11", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "UaaUrlUtils", ";", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "authentication", ".", "SavedRequestAwareAuthenticationSuccessHandler", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "net", ".", "URL", ";", "public", "class", "UaaSavedRequestAwareAuthenticationSuccessHandler", "extends", "SavedRequestAwareAuthenticationSuccessHandler", "{", "public", "static", "final", "String", "SAVED_REQUEST_SESSION_ATTRIBUTE", "=", "\"", "SPRING_SECURITY_SAVED_REQUEST", "\"", ";", "@", "@", "-", "40", ",", "23", "+", "39", ",", "10", "@", "@", "public", "String", "determineTargetUrl", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "if", "(", "redirectAttribute", "!", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "Returning", "redirectAttribute", "saved", "URI", ":", "\"+", "redirectAttribute", ")", ";", "return", "(", "String", ")", "redirectAttribute", ";", "}", "else", "if", "(", "isApprovedFormRedirectUri", "(", "request", ",", "redirectFormParam", ")", ")", "{", "}", "else", "if", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "redirectFormParam", ",", "request", ".", "getServerName", "(", "))", ")", "{", "return", "redirectFormParam", ";", "}", "else", "{", "return", "super", ".", "determineTargetUrl", "(", "request", ",", "response", ")", ";", "}", "}", "private", "boolean", "isApprovedFormRedirectUri", "(", "HttpServletRequest", "request", ",", "String", "redirectUri", ")", "{", "if", "(", "redirectUri", "=", "=", "null", ")", "{", "return", "false", ";", "}", "try", "{", "URL", "url", "=", "new", "URL", "(", "redirectUri", ")", ";", "return", "request", ".", "getServerName", "(", ").", "equals", "(", "url", ".", "getHost", "(", "))", ";", "}", "catch", "(", "MalformedURLException", "e", ")", "{", "return", "false", ";", "}", "}", "}", "@", "@", "-", "92", ",", "7", "+", "92", ",", "9", "@", "@", "protected", "boolean", "shouldSaveFormRedirectParameter", "(", "HttpServletRequest", "request", ")", "{", "if", "(", "StringUtils", ".", "isEmpty", "(", "formRedirect", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "formRedirect", ",", "request", ".", "getServerName", "(", "))", ")", "{", "return", "false", ";", "}", "if", "(", "hasSavedRequest", "(", "request", ")", ")", "{", "return", "false", ";", "}", "@", "@", "-", "32", ",", "8", "+", "32", ",", "10", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "equalTo", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "public", "class", "UaaUrlUtilsTest", "{", "@", "@", "-", "360", ",", "6", "+", "362", ",", "19", "@", "@", "public", "void", "test_validate_invalid_redirect_uri", "(", ")", "{", "validateRedirectUri", "(", "convertToHttps", "(", "invalidHttpWildCardUrls", ")", ",", "false", ")", ";", "}", "@", "Test", "public", "void", "testUriHasMatchingHost", "(", ")", "{", "assertTrue", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "\"", "http", ":", "//", "test", ".", "com", "/", "test", "\"", ",", "\"", "test", ".", "com", "\"", "))", ";", "assertTrue", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "\"", "http", ":", "//", "subdomain", ".", "test", ".", "com", "/", "test", "\"", ",", "\"", "subdomain", ".", "test", ".", "com", "\"", "))", ";", "assertTrue", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "\"", "http", ":", "//", "1", ".", "2", ".", "3", ".", "4", "/", "test", "\"", ",", "\"", "1", ".", "2", ".", "3", ".", "4", "\"", "))", ";", "assertFalse", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "null", ",", "\"", "test", ".", "com", "\"", "))", ";", "assertFalse", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "\"", "http", ":", "//", "not", "-", "test", ".", "com", "/", "test", "\"", ",", "\"", "test", ".", "com", "\"", "))", ";", "assertFalse", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "\"", "not", "-", "valid", "-", "url", "\"", ",", "\"", "test", ".", "com", "\"", "))", ";", "assertFalse", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "\"", "http", ":", "//", "1", ".", "2", ".", "3", ".", "4", "/", "test", "\"", ",", "\"", "test", ".", "com", "\"", "))", ";", "assertFalse", "(", "UaaUrlUtils", ".", "uriHasMatchingHost", "(", "\"", "http", ":", "//", "test", ".", "com", "/", "test", "\"", ",", "\"", "1", ".", "2", ".", "3", ".", "4", "\"", "))", ";", "}", "private", "void", "validateRedirectUri", "(", "List", "<", "String", ">", "urls", ",", "boolean", "result", ")", "{", "Map", "<", "String", ",", "String", ">", "failed", "=", "getFailedUrls", "(", "urls", ",", "result", ")", ";", "if", "(", "!", "failed", ".", "isEmpty", "(", "))", "{", "@", "@", "-", "28", ",", "8", "+", "28", ",", "13", "@", "@", "import", "org", ".", "springframework", ".", "security", ".", "web", ".", "savedrequest", ".", "SavedRequest", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "ServletResponse", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpSession", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "UaaSavedRequestAwareAuthenticationSuccessHandler", ".", "FORM_REDIRECT_PARAMETER", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "web", ".", "UaaSavedRequestAwareAuthenticationSuccessHandler", ".", "SAVED_REQUEST_SESSION_ATTRIBUTE", ";", "@", "@", "-", "38", ",", "6", "+", "43", ",", "7", "@", "@", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "anyObject", ";", "import", "static", "org", ".", "mockito", ".", "Matchers", ".", "anyString", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "@", "@", "-", "103", ",", "6", "+", "109", ",", "7", "@", "@", "public", "void", "filter_saves_when_needed", "(", ")", "throws", "Exception", "{", "request", ".", "setPathInfo", "(", "\"/", "login", ".", "do", "\"", ");", "request", ".", "setRequestURI", "(", "\"/", "login", ".", "do", "\"", ");", "request", ".", "setParameter", "(", "FORM_REDIRECT_PARAMETER", ",", "redirectUri", ")", ";", "request", ".", "setServerName", "(", "new", "URL", "(", "redirectUri", ")", ".", "getHost", "(", "))", ";", "assertTrue", "(", "cache", ".", "shouldSaveFormRedirectParameter", "(", "request", ")", ");", "ServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "@", "@", "-", "145", ",", "8", "+", "152", ",", "11", "@", "@", "public", "void", "saveFormRedirectRequest_GET_Method", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "saveFormRedirectRequest", "(", ")", "throws", "Exception", "{", "String", "redirectUri", "=", "\"", "http", ":", "//", "login", "\"", ";", "request", ".", "setSession", "(", "session", ")", ";", "request", ".", "setParameter", "(", "FORM_REDIRECT_PARAMETER", ",", "\"", "http", ":", "//", "login", "\"", ");", "request", ".", "setParameter", "(", "FORM_REDIRECT_PARAMETER", ",", "redirectUri", ")", ";", "request", ".", "setServerName", "(", "new", "URL", "(", "redirectUri", ")", ".", "getHost", "(", "))", ";", "spy", ".", "saveRequest", "(", "request", ",", "new", "MockHttpServletResponse", "(", "))", ";", "verify", "(", "spy", ")", ".", "saveClientRedirect", "(", "request", ",", "request", ".", "getParameter", "(", "FORM_REDIRECT_PARAMETER", ")", ");", "}", "@", "@", "-", "169", ",", "14", "+", "179", ",", "19", "@", "@", "public", "void", "only_save_for_POST_calls", "(", ")", "{", "}", "@", "Test", "public", "void", "should_save_condition_works", "(", ")", "{", "public", "void", "should_save_condition_works", "(", ")", "throws", "MalformedURLException", "{", "assertFalse", "(", "cache", ".", "shouldSaveFormRedirectParameter", "(", "request", ")", ");", "request", ".", "setPathInfo", "(", "\"/", "login", ".", "do", "\"", ");", "assertFalse", "(", "cache", ".", "shouldSaveFormRedirectParameter", "(", "request", ")", ");", "request", ".", "setParameter", "(", "FORM_REDIRECT_PARAMETER", ",", "redirectUri", ")", ";", "request", ".", "setServerName", "(", "new", "URL", "(", "redirectUri", ")", ".", "getHost", "(", "))", ";", "assertTrue", "(", "cache", ".", "shouldSaveFormRedirectParameter", "(", "request", ")", ");", "request", ".", "setSession", "(", "session", ")", ";", "assertTrue", "(", "cache", ".", "shouldSaveFormRedirectParameter", "(", "request", ")", ");", "ClientRedirectSavedRequest", "savedRequest", "=", "new", "ClientRedirectSavedRequest", "(", "request", ",", "redirectUri", ")", ";", "session", ".", "setAttribute", "(", "SAVED_REQUEST_SESSION_ATTRIBUTE", ",", "savedRequest", ")", ";", "assertFalse", "(", "cache", ".", "shouldSaveFormRedirectParameter", "(", "request", ")", ");", "@", "@", "-", "215", ",", "5", "+", "230", ",", "16", "@", "@", "public", "void", "saved_request_matcher", "(", ")", "{", "}", "@", "Test", "public", "void", "unapprovedFormRedirectRequestDoesNotSave", "(", ")", "throws", "IOException", ",", "ServletException", "{", "request", ".", "setPathInfo", "(", "\"/", "login", ".", "do", "\"", ");", "request", ".", "setRequestURI", "(", "\"/", "login", ".", "do", "\"", ");", "request", ".", "setMethod", "(", "HttpMethod", ".", "POST", ".", "name", "(", "))", ";", "request", ".", "setParameter", "(", "FORM_REDIRECT_PARAMETER", ",", "\"", "http", ":", "//", "test", ".", "com", "\"", ");", "request", ".", "setServerName", "(", "\"", "not", "-", "test", ".", "com", "\"", ");", "spy", ".", "doFilter", "(", "request", ",", "new", "MockHttpServletResponse", "(", "),", "mock", "(", "FilterChain", ".", "class", ")", ");", "verify", "(", "spy", ",", "never", "(", "))", ".", "saveClientRedirect", "(", "any", "(", "HttpServletRequest", ".", "class", ")", ",", "anyString", "(", "))", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["open", "redirects"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "273", ",", "18", "+", "273", ",", "18", "@", "@", "private", "void", "doInclude", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ",", "if", "(", "this", ".", "contentType", "!", "=", "null", ")", "{", "response", ".", "setContentType", "(", "this", ".", "contentType", ")", ";", "}", "String", "[", "]", "resourceUrls", "=", "StringUtils", ".", "tokenizeToStringArray", "(", "resourceUrl", ",", "RESOURCE_URL_DELIMITERS", ")", ";", "for", "(", "String", "url", ":", "resourceUrls", ")", "{", "String", "path", "=", "StringUtils", ".", "cleanPath", "(", "url", ")", ";", "/", "/", "Check", "whether", "URL", "matches", "allowed", "resources", "if", "(", "this", ".", "allowedResources", "!", "=", "null", "&", "&", "!", "this", ".", "pathMatcher", ".", "match", "(", "this", ".", "allowedResources", ",", "url", ")", ")", "{", "throw", "new", "ServletException", "(", "\"", "Resource", "[", "\"", "+", "url", "+", "if", "(", "this", ".", "allowedResources", "!", "=", "null", "&", "&", "!", "this", ".", "pathMatcher", ".", "match", "(", "this", ".", "allowedResources", ",", "path", ")", ")", "{", "throw", "new", "ServletException", "(", "\"", "Resource", "[", "\"", "+", "path", "\"", "]", "does", "not", "match", "allowed", "pattern", "[", "\"", "+", "this", ".", "allowedResources", "+", "\"", "]\"", ");", "}", "if", "(", "logger", ".", "isDebugEnabled", "(", "))", "{", "logger", ".", "debug", "(", "\"", "Including", "resource", "[", "\"", "+", "url", "+", "\"", "]\"", ");", "logger", ".", "debug", "(", "\"", "Including", "resource", "[", "\"", "+", "path", "+", "\"", "]\"", ");", "}", "RequestDispatcher", "rd", "=", "request", ".", "getRequestDispatcher", "(", "url", ")", ";", "RequestDispatcher", "rd", "=", "request", ".", "getRequestDispatcher", "(", "path", ")", ";", "rd", ".", "include", "(", "request", ",", "response", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "61", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "web", ".", "servlet", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "test", ".", "MockHttpServletRequest", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "test", ".", "MockHttpServletResponse", ";", "import", "org", ".", "springframework", ".", "mock", ".", "web", ".", "test", ".", "MockServletConfig", ";", "/", "**", "*", "@", "author", "Rossen", "Stoyanchev", "*", "/", "public", "class", "ResourceServletTests", "{", "@", "Test", "(", "expected", "=", "ServletException", ".", "class", ")", "public", "void", "example1", "(", ")", "throws", "Exception", "{", "testInvalidResourceUrl", "(", "\"/", "resources", "/", "**", "\",", "\"", "/", "resources", "/", "..", "/", "WEB", "-", "INF", "/", "web", ".", "xml", "\"", ");", "}", "@", "Test", "(", "expected", "=", "ServletException", ".", "class", ")", "public", "void", "example2", "(", ")", "throws", "Exception", "{", "testInvalidResourceUrl", "(", "\"/", "resources", "/", "*\"", ",", "\"", "/", "resources", "/", "..", "\\\\", "WEB", "-", "INF", "\\", "\\", "web", ".", "xml", "\"", ");", "}", "@", "Test", "(", "expected", "=", "ServletException", ".", "class", ")", "public", "void", "example3", "(", ")", "throws", "Exception", "{", "testInvalidResourceUrl", "(", "\"/", "resources", "/", "*\"", ",", "\"", "/", "resources", "/", "..", "\\\\", "Servlet2", "?", "param", "=", "111", "\"", ");", "}", "private", "void", "testInvalidResourceUrl", "(", "String", "allowedResources", ",", "String", "resourceParam", ")", "throws", "ServletException", ",", "IOException", "{", "ResourceServlet", "servlet", "=", "new", "ResourceServlet", "(", ");", "servlet", ".", "setAllowedResources", "(", "allowedResources", ")", ";", "servlet", ".", "init", "(", "new", "MockServletConfig", "(", "))", ";", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "GET", "\"", ",", "\"", "/\"", ");", "request", ".", "addParameter", "(", "\"", "resource", "\"", ",", "resourceParam", ")", ";", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "servlet", ".", "service", "(", "request", ",", "response", ")", ";", "}", "}"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "785", ",", "7", "+", "785", ",", "7", "@", "@", "int", "snd_usb_caiaq_audio_init", "(", "struct", "snd_usb_caiaqdev", "*", "dev", ")", "}", "dev", "-", ">", "pcm", "-", ">", "private_data", "=", "dev", ";", "strcpy", "(", "dev", "-", ">", "pcm", "-", ">", "name", ",", "dev", "-", ">", "product_name", ")", ";", "strlcpy", "(", "dev", "-", ">", "pcm", "-", ">", "name", ",", "dev", "-", ">", "product_name", ",", "sizeof", "(", "dev", "-", ">", "pcm", "-", ">", "name", ")", ");", "memset", "(", "dev", "-", ">", "sub_playback", ",", "0", ",", "sizeof", "(", "dev", "-", ">", "sub_playback", ")", ");", "memset", "(", "dev", "-", ">", "sub_capture", ",", "0", ",", "sizeof", "(", "dev", "-", ">", "sub_capture", ")", ");", "@", "@", "-", "136", ",", "7", "+", "136", ",", "7", "@", "@", "int", "snd_usb_caiaq_midi_init", "(", "struct", "snd_usb_caiaqdev", "*", "device", ")", "if", "(", "ret", "<", "0", ")", "return", "ret", ";", "strcpy", "(", "rmidi", "-", ">", "name", ",", "device", "-", ">", "product_name", ")", ";", "strlcpy", "(", "rmidi", "-", ">", "name", ",", "device", "-", ">", "product_name", ",", "sizeof", "(", "rmidi", "-", ">", "name", ")", ");", "rmidi", "-", ">", "info_flags", "=", "SNDRV_RAWMIDI_INFO_DUPLEX", ";", "rmidi", "-", ">", "private_data", "=", "device", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "43", ",", "21", "+", "43", ",", "25", "@", "@", "import", "javax", ".", "management", ".", "NotCompliantMBeanException", ";", "import", "javax", ".", "management", ".", "ObjectName", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServerFactory", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXServiceURL", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIJRMPServerImpl", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "management", ".", "ManagementFactory", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "rmi", ".", "NoSuchObjectException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "import", "java", ".", "rmi", ".", "NotBoundException", ";", "import", "java", ".", "rmi", ".", "Remote", ";", "import", "java", ".", "rmi", ".", "RemoteException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "Registry", ";", "import", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Hashtable", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Optional", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "/", "**", "*", "{", "@", "link", "MetricReporter", "}", "that", "exports", "{", "@", "link", "Metric", "Metrics", "}", "via", "JMX", ".", "@", "@", "-", "474", ",", "42", "+", "478", ",", "31", "@", "@", "public", "long", "getCount", "(", ")", "{", "/", "**", "*", "JMX", "Server", "implementation", "that", "JMX", "clients", "can", "connect", "to", ".", "*", "*", "<", "p", ">", "Heavily", "based", "on", "j256", "simplejmx", "project", "*", "<", "p", ">", "Originally", "based", "on", "j256", "simplejmx", "project", "*", "*", "<", "p", ">", "https", ":", "//", "github", ".", "com", "/", "j256", "/", "simplejmx", "/", "blob", "/", "master", "/", "src", "/", "main", "/", "java", "/", "com", "/", "j256", "/", "simplejmx", "/", "server", "/", "JmxServer", ".", "java", "*", "/", "private", "static", "class", "JMXServer", "{", "private", "Registry", "rmiRegistry", ";", "private", "JMXConnectorServer", "connector", ";", "private", "int", "port", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "rmiServerReference", "=", "new", "AtomicReference", "<", ">(", ");", "public", "void", "start", "(", "int", "port", ")", "throws", "IOException", "{", "if", "(", "rmiRegistry", "!", "=", "null", "&", "&", "connector", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "JMXServer", "is", "already", "running", ".", "\")", ";", "return", ";", "}", "startRmiRegistry", "(", "port", ")", ";", "startJmxService", "(", "port", ")", ";", "internalStart", "(", "port", ")", ";", "this", ".", "port", "=", "port", ";", "}", "/", "**", "*", "Starts", "an", "RMI", "Registry", "that", "allows", "clients", "to", "lookup", "the", "JMX", "IP", "/", "port", ".", "*", "*", "@", "param", "port", "rmi", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startRmiRegistry", "(", "int", "port", ")", "throws", "IOException", "{", "rmiRegistry", "=", "LocateRegistry", ".", "createRegistry", "(", "port", ")", ";", "}", "private", "void", "internalStart", "(", "int", "port", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "/", "/", "this", "allows", "clients", "to", "lookup", "the", "JMX", "service", "rmiRegistry", "=", "new", "JmxRegistry", "(", "port", ",", "\"", "jmxrmi", "\"", ",", "rmiServerReference", ")", ";", "/", "**", "*", "Starts", "a", "JMX", "connector", "that", "allows", "(", "un", ")", "registering", "MBeans", "with", "the", "MBean", "server", "and", "RMI", "invocations", ".", "*", "*", "@", "param", "port", "jmx", "port", "to", "use", "*", "@", "throws", "IOException", "*", "/", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "String", "serviceUrl", "=", "\"", "service", ":", "jmx", ":", "rmi", ":", "//", "localhost", ":", "\"", "+", "port", "+", "\"", "/", "jndi", "/", "rmi", ":", "//", "localhost", ":", "\"", "+", "port", "+", "\"", "/", "jmxrmi", "\"", ";", "JMXServiceURL", "url", ";", "try", "{", "@", "@", "-", "518", ",", "12", "+", "511", ",", "20", "@", "@", "private", "void", "startJmxService", "(", "int", "port", ")", "throws", "IOException", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Malformed", "service", "url", "created", "\"", "+", "serviceUrl", ",", "e", ")", ";", "}", "connector", "=", "JMXConnectorServerFactory", ".", "newJMXConnectorServer", "(", "url", ",", "null", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "final", "RMIJRMPServerImpl", "rmiServer", "=", "new", "RMIJRMPServerImpl", "(", "port", ",", "null", ",", "null", ",", "null", ")", ";", "connector", "=", "new", "RMIConnectorServer", "(", "url", ",", "null", ",", "rmiServer", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "connector", ".", "start", "(", ");", "/", "/", "we", "can", "'", "t", "pass", "the", "created", "stub", "directly", "to", "the", "registry", "since", "this", "would", "form", "a", "cyclic", "dependency", ":", "/", "/", "-", "you", "can", "only", "start", "the", "connector", "after", "the", "registry", "was", "started", "/", "/", "-", "you", "can", "only", "create", "the", "stub", "after", "the", "connector", "was", "started", "/", "/", "-", "you", "can", "only", "start", "the", "registry", "after", "the", "stub", "was", "created", "rmiServerReference", ".", "set", "(", "rmiServer", ".", "toStub", "(", "))", ";", "}", "public", "void", "stop", "(", ")", "throws", "IOException", "{", "rmiServerReference", ".", "set", "(", "null", ")", ";", "if", "(", "connector", "!", "=", "null", ")", "{", "try", "{", "connector", ".", "stop", "(", ");", "@", "@", "-", "541", ",", "5", "+", "542", ",", "51", "@", "@", "public", "void", "stop", "(", ")", "throws", "IOException", "{", "}", "}", "}", "/", "**", "*", "A", "registry", "that", "only", "exposes", "a", "single", "remote", "object", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "restriction", "\"", ")", "private", "static", "class", "JmxRegistry", "extends", "sun", ".", "rmi", ".", "registry", ".", "RegistryImpl", "{", "private", "final", "String", "lookupName", ";", "private", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ";", "JmxRegistry", "(", "final", "int", "port", ",", "final", "String", "lookupName", ",", "final", "AtomicReference", "<", "Remote", ">", "remoteServerStub", ")", "throws", "RemoteException", "{", "super", "(", "port", ")", ";", "this", ".", "lookupName", "=", "lookupName", ";", "this", ".", "remoteServerStub", "=", "remoteServerStub", ";", "}", "@", "Override", "public", "Remote", "lookup", "(", "String", "s", ")", "throws", "NotBoundException", "{", "if", "(", "lookupName", ".", "equals", "(", "s", ")", ")", "{", "final", "Remote", "remote", "=", "remoteServerStub", ".", "get", "(", ");", "if", "(", "remote", "!", "=", "null", ")", "{", "return", "remote", ";", "}", "}", "throw", "new", "NotBoundException", "(", "\"", "Not", "bound", ".", "\")", ";", "}", "@", "Override", "public", "void", "bind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "start", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "unbind", "(", "String", "s", ")", "{", "/", "/", "this", "is", "called", "from", "RMIConnectorServer", "#", "stop", ";", "don", "'", "t", "throw", "a", "general", "AccessException", "}", "@", "Override", "public", "void", "rebind", "(", "String", "s", ",", "Remote", "remote", ")", "{", "/", "/", "might", "as", "well", "not", "throw", "an", "exception", "here", "given", "that", "the", "others", "don", "'", "t", "}", "@", "Override", "public", "String", "[", "]", "list", "(", ")", "{", "return", "new", "String", "[", "]{", "lookupName", "}", ";", "}", "}", "}", "}", "@", "@", "-", "951", ",", "6", "+", "951", ",", "7", "@", "@", "under", "the", "License", ".", "<", "compilerArgs", "combine", ".", "children", "=", "\"", "append", "\"", ">", "<", "arg", ">", "--", "add", "-", "exports", "=", "java", ".", "base", "/", "sun", ".", "net", ".", "util", "=", "ALL", "-", "UNNAMED", "<", "/", "arg", ">", "<", "arg", ">", "--", "add", "-", "exports", "=", "java", ".", "management", "/", "sun", ".", "management", "=", "ALL", "-", "UNNAMED", "<", "/", "arg", ">", "<", "arg", ">", "--", "add", "-", "exports", "=", "java", ".", "rmi", "/", "sun", ".", "rmi", ".", "registry", "=", "ALL", "-", "UNNAMED", "<", "/", "arg", ">", "<", "/", "compilerArgs", ">", "<", "/", "configuration", ">", "<", "/", "plugin", ">"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "822", ",", "6", "+", "822", ",", "8", "@", "@", "int", "__kvm_set_memory_region", "(", "struct", "kvm", "*", "kvm", ",", "old_memslots", "=", "kvm", "-", ">", "memslots", ";", "rcu_assign_pointer", "(", "kvm", "-", ">", "memslots", ",", "slots", ")", ";", "synchronize_srcu_expedited", "(", "&", "kvm", "-", ">", "srcu", ")", ";", "/", "*", "slot", "was", "deleted", "or", "moved", ",", "clear", "iommu", "mapping", "*", "/", "kvm_iommu_unmap_pages", "(", "kvm", ",", "&", "old", ")", ";", "/", "*", "From", "this", "point", "no", "new", "shadow", "pages", "pointing", "to", "a", "deleted", ",", "*", "or", "moved", ",", "memslot", "will", "be", "created", ".", "*", "@", "@", "-", "837", ",", "20", "+", "839", ",", "19", "@", "@", "int", "__kvm_set_memory_region", "(", "struct", "kvm", "*", "kvm", ",", "if", "(", "r", ")", "goto", "out_free", ";", "/", "*", "map", "/", "unmap", "the", "pages", "in", "iommu", "page", "table", "*", "/", "if", "(", "npages", ")", "{", "r", "=", "kvm_iommu_map_pages", "(", "kvm", ",", "&", "new", ")", ";", "if", "(", "r", ")", "goto", "out_free", ";", "}", "else", "kvm_iommu_unmap_pages", "(", "kvm", ",", "&", "old", ")", ";", "r", "=", "-", "ENOMEM", ";", "slots", "=", "kmemdup", "(", "kvm", "-", ">", "memslots", ",", "sizeof", "(", "struct", "kvm_memslots", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "slots", ")", "goto", "out_free", ";", "/", "*", "map", "new", "memory", "slot", "into", "the", "iommu", "*", "/", "if", "(", "npages", ")", "{", "r", "=", "kvm_iommu_map_pages", "(", "kvm", ",", "&", "new", ")", ";", "if", "(", "r", ")", "goto", "out_slots", ";", "}", "/", "*", "actual", "memory", "is", "freed", "via", "old", "in", "kvm_free_physmem_slot", "below", "*", "/", "if", "(", "!", "npages", ")", "{", "new", ".", "dirty_bitmap", "=", "NULL", ";", "@", "@", "-", "869", ",", "6", "+", "870", ",", "8", "@", "@", "int", "__kvm_set_memory_region", "(", "struct", "kvm", "*", "kvm", ",", "return", "0", ";", "out_slots", ":", "kfree", "(", "slots", ")", ";", "out_free", ":", "kvm_free_physmem_slot", "(", "&", "new", ",", "&", "old", ")", ";", "out", ":"], "docstring_tokens": ["memory", "leak"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2013", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2013", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "*", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "class", "JpaSort", "extends", "Sort", "{", "@", "@", "-", "83", ",", "6", "+", "84", ",", "10", "@", "@", "private", "JpaSort", "(", "List", "<", "Order", ">", "orders", ",", "Direction", "direction", ",", "List", "<", "Path", "<", "?,", "?", ">>", "paths", ")", "super", "(", "combine", "(", "orders", ",", "direction", ",", "paths", ")", ");", "}", "private", "JpaSort", "(", "List", "<", "Order", ">", "orders", ")", "{", "super", "(", "orders", ")", ";", "}", "/", "**", "*", "Returns", "a", "new", "{", "@", "link", "JpaSort", "}", "with", "the", "given", "sorting", "criteria", "added", "to", "the", "current", "one", ".", "*", "@", "@", "-", "117", ",", "6", "+", "122", ",", "30", "@", "@", "public", "JpaSort", "and", "(", "Direction", "direction", ",", "Path", "<", "?,", "?", ">.", "..", "paths", ")", "{", "return", "new", "JpaSort", "(", "existing", ",", "direction", ",", "Arrays", ".", "asList", "(", "paths", ")", ");", "}", "/", "**", "*", "Returns", "a", "new", "{", "@", "link", "JpaSort", "}", "with", "the", "given", "sorting", "criteria", "added", "to", "the", "current", "one", ".", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "JpaSort", "andUnsafe", "(", "Direction", "direction", ",", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "null", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "Order", "order", ":", "this", ")", "{", "orders", ".", "add", "(", "order", ")", ";", "}", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "direction", ",", "property", ")", ");", "}", "return", "new", "JpaSort", "(", "orders", ",", "direction", ",", "Collections", ".", "<", "Path", "<", "?,", "?", ">>", "emptyList", "(", "))", ";", "}", "/", "**", "*", "Turns", "the", "given", "{", "@", "link", "Attribute", "}", "s", "into", "{", "@", "link", "Path", "}", "s", ".", "*", "@", "@", "-", "174", ",", "6", "+", "203", ",", "51", "@", "@", "public", "JpaSort", "and", "(", "Direction", "direction", ",", "Path", "<", "?,", "?", ">.", "..", "paths", ")", "{", "return", "new", "Path", "<", "T", ",", "S", ">", "(", "Arrays", ".", "asList", "(", "attribute", ")", ");", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "properties", ".", "*", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "String", ".", "..", "properties", ")", "{", "return", "unsafe", "(", "Sort", ".", "DEFAULT_DIRECTION", ",", "properties", ")", ";", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "{", "@", "link", "Direction", "}", "and", "properties", ".", "*", "*", "@", "param", "direction", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "Direction", "direction", ",", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notNull", "(", "direction", ",", "\"", "Direction", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "Assert", ".", "noNullElements", "(", "properties", ",", "\"", "Properties", "must", "not", "contain", "null", "values", "!", "\")", ";", "return", "unsafe", "(", "direction", ",", "Arrays", ".", "asList", "(", "properties", ")", ");", "}", "/", "**", "*", "Creates", "new", "unsafe", "{", "@", "link", "JpaSort", "}", "based", "on", "given", "{", "@", "link", "Direction", "}", "and", "properties", ".", "*", "*", "@", "param", "direction", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", "or", "empty", ".", "*", "@", "return", "*", "/", "public", "static", "JpaSort", "unsafe", "(", "Direction", "direction", ",", "List", "<", "String", ">", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "direction", ",", "property", ")", ");", "}", "return", "new", "JpaSort", "(", "orders", ")", ";", "}", "/", "**", "*", "Value", "object", "to", "abstract", "a", "collection", "of", "{", "@", "link", "Attribute", "}", "s", ".", "*", "@", "@", "-", "233", ",", "4", "+", "307", ",", "131", "@", "@", "public", "String", "toString", "(", ")", "{", "return", "builder", ".", "length", "(", ")", "=", "=", "0", "?", "\"", "\"", ":", "builder", ".", "substring", "(", "0", ",", "builder", ".", "lastIndexOf", "(", "\".", "\")", ");", "}", "}", "/", "**", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "static", "class", "JpaOrder", "extends", "Order", "{", "private", "final", "boolean", "unsafe", ";", "private", "final", "boolean", "ignoreCase", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaOrder", "}", "instance", ".", "if", "order", "is", "{", "@", "literal", "null", "}", "then", "order", "defaults", "to", "*", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "@", "param", "property", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ")", "{", "this", "(", "direction", ",", "property", ",", "NullHandling", ".", "NATIVE", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "Order", "}", "instance", ".", "if", "order", "is", "{", "@", "literal", "null", "}", "then", "order", "defaults", "to", "*", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "*", "@", "param", "direction", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "Sort", "#", "DEFAULT_DIRECTION", "}", ".", "*", "@", "param", "property", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "nullHandlingHint", "can", "be", "{", "@", "literal", "null", "}", ",", "will", "default", "to", "{", "@", "link", "NullHandling", "#", "NATIVE", "}", ".", "*", "/", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ",", "NullHandling", "nullHandlingHint", ")", "{", "this", "(", "direction", ",", "property", ",", "nullHandlingHint", ",", "false", ",", "true", ")", ";", "}", "private", "JpaOrder", "(", "Direction", "direction", ",", "String", "property", ",", "NullHandling", "nullHandling", ",", "boolean", "ignoreCase", ",", "boolean", "unsafe", ")", "{", "super", "(", "direction", ",", "property", ",", "nullHandling", ")", ";", "this", ".", "ignoreCase", "=", "ignoreCase", ";", "this", ".", "unsafe", "=", "unsafe", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "with", "(", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Direction", ")", "*", "/", "@", "Override", "public", "JpaOrder", "with", "(", "Direction", "order", ")", "{", "return", "new", "JpaOrder", "(", "order", ",", "getProperty", "(", "),", "getNullHandling", "(", "),", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "with", "(", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "NullHandling", ")", "*", "/", "@", "Override", "public", "JpaOrder", "with", "(", "NullHandling", "nullHandling", ")", "{", "return", "new", "JpaOrder", "(", "getDirection", "(", "),", "getProperty", "(", "),", "nullHandling", ",", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsFirst", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "nullsFirst", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NULLS_FIRST", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsLast", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "nullsLast", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NULLS_LAST", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "nullsNative", "(", ")", "*", "/", "public", "JpaOrder", "nullsNative", "(", ")", "{", "return", "with", "(", "NullHandling", ".", "NATIVE", ")", ";", "}", "/", "**", "*", "Creates", "new", "{", "@", "link", "Sort", "}", "with", "potentially", "unsafe", "{", "@", "link", "Order", "}", "instances", ".", "*", "*", "@", "param", "properties", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "/", "public", "Sort", "withUnsafe", "(", "String", ".", "..", "properties", ")", "{", "Assert", ".", "notEmpty", "(", "properties", ",", "\"", "Properties", "must", "not", "be", "empty", "!", "\")", ";", "Assert", ".", "noNullElements", "(", "properties", ",", "\"", "Properties", "must", "not", "contain", "null", "values", "!", "\")", ";", "List", "<", "Order", ">", "orders", "=", "new", "ArrayList", "<", "Order", ">", "()", ";", "for", "(", "String", "property", ":", "properties", ")", "{", "orders", ".", "add", "(", "new", "JpaOrder", "(", "getDirection", "(", "),", "property", ",", "getNullHandling", "(", "),", "isIgnoreCase", "(", "),", "this", ".", "unsafe", ")", ");", "}", "return", "new", "Sort", "(", "orders", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "ignoreCase", "(", ")", "*", "/", "@", "Override", "public", "JpaOrder", "ignoreCase", "(", ")", "{", "return", "new", "JpaOrder", "(", "getDirection", "(", "),", "getProperty", "(", "),", "getNullHandling", "(", "),", "true", ",", "this", ".", "unsafe", ")", ";", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "@", "see", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", "#", "isIgnoreCase", "(", ")", "*", "/", "@", "Override", "public", "boolean", "isIgnoreCase", "(", ")", "{", "return", "super", ".", "isIgnoreCase", "(", ")", "|", "|", "ignoreCase", ";", "}", "/", "**", "*", "@", "return", "true", "if", "{", "@", "link", "JpaOrder", "}", "created", "{", "@", "link", "#", "withUnsafe", "(", "String", ".", "..", ")}", ".", "*", "/", "public", "boolean", "isUnsafe", "(", ")", "{", "return", "unsafe", ";", "}", "}", "}", "@", "@", "-", "53", ",", "8", "+", "53", ",", "10", "@", "@", "import", "javax", ".", "persistence", ".", "metamodel", ".", "PluralAttribute", ";", "import", "org", ".", "springframework", ".", "core", ".", "annotation", ".", "AnnotationUtils", ";", "import", "org", ".", "springframework", ".", "dao", ".", "InvalidDataAccessApiUsageException", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "JpaOrder", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "@", "@", "-", "66", ",", "6", "+", "68", ",", "7", "@", "@", "*", "@", "author", "Kevin", "Raymond", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Komi", "Innocent", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "abstract", "class", "QueryUtils", "{", "@", "@", "-", "102", ",", "6", "+", "105", ",", "10", "@", "@", "private", "static", "final", "int", "QUERY_JOIN_ALIAS_GROUP_INDEX", "=", "2", ";", "private", "static", "final", "int", "VARIABLE_NAME_GROUP_INDEX", "=", "4", ";", "private", "static", "final", "Pattern", "PUNCTATION_PATTERN", "=", "Pattern", ".", "compile", "(", "\".", "*(", "(?", "![", "\\\\", ".", "_", "]", ")[", "\\\\", "p", "{", "Punct", "}", "|\\", "\\", "s", "]", ")\"", ");", "private", "static", "final", "String", "FUNCTION_ALIAS_GROUP_NAME", "=", "\"", "alias", "\"", ";", "private", "static", "final", "Pattern", "FUNCTION_PATTERN", ";", "static", "{", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", ");", "@", "@", "-", "145", ",", "6", "+", "152", ",", "13", "@", "@", "builder", ".", "append", "(", "\"\\", "\\)", "\")", ";", "CONSTRUCTOR_EXPRESSION", "=", "compile", "(", "builder", ".", "toString", "(", "),", "CASE_INSENSITIVE", "+", "DOTALL", ")", ";", "builder", "=", "new", "StringBuilder", "(", ");", "builder", ".", "append", "(", "\"\\", "\\", "s", "+", "\")", ";", "/", "/", "at", "least", "one", "space", "builder", ".", "append", "(", "\"\\", "\\", "w", "+", "\\\\", "([", "0", "-", "9a", "-", "zA", "-", "z", "\\", "\\.", "_", ",", "\\\\", "s", "'", "]+", "\\\\", ")\"", ");", "/", "/", "any", "function", "call", "including", "parameters", "within", "the", "brackets", "builder", ".", "append", "(", "\"\\", "\\", "s", "+", "[", "as", "|", "AS", "]", "+\\", "\\", "s", "+", "(?", "<\"", "+", "FUNCTION_ALIAS_GROUP_NAME", "+", "\"", ">[", "\\\\", "w", "\\", "\\.", "]+", ")\"", ");", "/", "/", "the", "potential", "alias", "FUNCTION_PATTERN", "=", "compile", "(", "builder", ".", "toString", "(", "))", ";", "}", "/", "**", "@", "@", "-", "227", ",", "9", "+", "241", ",", "10", "@", "@", "public", "static", "String", "applySorting", "(", "String", "query", ",", "Sort", "sort", ",", "String", "alias", ")", "{", "}", "Set", "<", "String", ">", "aliases", "=", "getOuterJoinAliases", "(", "query", ")", ";", "Set", "<", "String", ">", "functionAliases", "=", "getFunctionAliases", "(", "query", ")", ";", "for", "(", "Order", "order", ":", "sort", ")", "{", "builder", ".", "append", "(", "getOrderClause", "(", "aliases", ",", "alias", ",", "order", ")", ").", "append", "(", "\",", "\"", ");", "builder", ".", "append", "(", "getOrderClause", "(", "aliases", ",", "functionAliases", ",", "alias", ",", "order", ")", ").", "append", "(", "\",", "\"", ");", "}", "builder", ".", "delete", "(", "builder", ".", "length", "(", ")", "-", "2", ",", "builder", ".", "length", "(", "))", ";", "@", "@", "-", "246", ",", "9", "+", "261", ",", "16", "@", "@", "public", "static", "String", "applySorting", "(", "String", "query", ",", "Sort", "sort", ",", "String", "alias", ")", "{", "*", "@", "param", "order", "the", "order", "object", "to", "build", "the", "clause", "for", ".", "*", "@", "return", "*", "/", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "String", "alias", ",", "Order", "order", ")", "{", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "Set", "<", "String", ">", "functionAlias", ",", "String", "alias", ",", "Order", "order", ")", "{", "String", "property", "=", "order", ".", "getProperty", "(", ");", "checkSortExpression", "(", "order", ")", ";", "if", "(", "functionAlias", ".", "contains", "(", "property", ")", ")", "{", "return", "String", ".", "format", "(", "\"%", "s", "%", "s", "\"", ",", "property", ",", "toJpaDirection", "(", "order", ")", ");", "}", "boolean", "qualifyReference", "=", "!", "property", ".", "contains", "(", "\"(", "\")", ";", "/", "/", "(", "indicates", "a", "function", "for", "(", "String", "joinAlias", ":", "joinAliases", ")", "{", "@", "@", "-", "287", ",", "6", "+", "309", ",", "28", "@", "@", "private", "static", "String", "getOrderClause", "(", "Set", "<", "String", ">", "joinAliases", ",", "String", "alias", ",", "Orde", "return", "result", ";", "}", "/", "**", "*", "Returns", "the", "aliases", "used", "for", "aggregate", "functions", "like", "{", "@", "code", "SUM", ",", "COUNT", ",", ".", "..", "}.", "*", "*", "@", "param", "query", "*", "@", "return", "*", "/", "static", "Set", "<", "String", ">", "getFunctionAliases", "(", "String", "query", ")", "{", "Set", "<", "String", ">", "result", "=", "new", "HashSet", "<", "String", ">", "()", ";", "Matcher", "matcher", "=", "FUNCTION_PATTERN", ".", "matcher", "(", "query", ")", ";", "while", "(", "matcher", ".", "find", "(", "))", "{", "String", "alias", "=", "matcher", ".", "group", "(", "FUNCTION_ALIAS_GROUP_NAME", ")", ";", "if", "(", "StringUtils", ".", "hasText", "(", "alias", ")", ")", "{", "result", ".", "add", "(", "alias", ")", ";", "}", "}", "return", "result", ";", "}", "private", "static", "String", "toJpaDirection", "(", "Order", "order", ")", "{", "return", "order", ".", "getDirection", "(", ").", "name", "(", ").", "toLowerCase", "(", "Locale", ".", "US", ")", ";", "}", "@", "@", "-", "617", ",", "4", "+", "661", ",", "23", "@", "@", "private", "static", "boolean", "isAlreadyFetched", "(", "From", "<", "?,", "?", ">", "from", ",", "String", "attribute", ")", "{", "return", "false", ";", "}", "/", "**", "*", "Check", "any", "given", "{", "@", "link", "JpaOrder", "#", "isUnsafe", "(", ")}", "order", "for", "presence", "of", "at", "least", "one", "property", "offending", "the", "*", "{", "@", "link", "#", "PUNCTATION_PATTERN", "}", "and", "throw", "an", "{", "@", "link", "Exception", "}", "indicating", "potential", "unsafe", "order", "by", "expression", ".", "*", "*", "@", "param", "order", "*", "/", "private", "static", "void", "checkSortExpression", "(", "Order", "order", ")", "{", "if", "(", "order", "instanceof", "JpaOrder", "&", "&", "(", "(", "JpaOrder", ")", "order", ")", ".", "isUnsafe", "(", "))", "{", "return", ";", "}", "if", "(", "PUNCTATION_PATTERN", ".", "matcher", "(", "order", ".", "getProperty", "(", "))", ".", "find", "(", "))", "{", "throw", "new", "InvalidDataAccessApiUsageException", "(", "String", ".", "format", "(", "\"", "Sort", "expression", "'", "%", "s", "'", "must", "not", "contain", "functions", "or", "expressions", ".", "Please", "use", "JpaSort", ".", "unsafe", ".", "\",", "order", ")", ");", "}", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2013", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2013", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "29", ",", "6", "+", "29", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Direction", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ".", "Order", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "JpaOrder", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ".", "Path", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "Address_", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "sample", ".", "MailMessage_", ";", "@", "@", "-", "47", ",", "6", "+", "48", ",", "7", "@", "@", "*", "@", "see", "DATAJPA", "-", "12", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Christoph", "Strobl", "*", "/", "@", "RunWith", "(", "SpringJUnit4ClassRunner", ".", "class", ")", "@", "ContextConfiguration", "(", "\"", "classpath", ":", "infrastructure", ".", "xml", "\"", ")", "@", "@", "-", "173", ",", "4", "+", "175", ",", "56", "@", "@", "public", "void", "buildsUpPathForPluralAttributesCorrectly", "(", ")", "{", "assertThat", "(", "new", "JpaSort", "(", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", "),", "/", "/", "hasItem", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "))", ");", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "createsUnsafeSortCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ");", "assertThat", "(", "sort", ",", "hasItem", "(", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "createsUnsafeSortWithMultiplePropertiesCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ",", "\"", "spring", ".", "data", "\"", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "spring", ".", "data", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "spring", ".", "data", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "combinesSafeAndUnsafeSortCorrectly", "(", ")", "{", "JpaSort", "sort", "=", "new", "JpaSort", "(", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", ").", "andUnsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "is", "(", "not", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "combinesUnsafeAndSafeSortCorrectly", "(", ")", "{", "Sort", "sort", "=", "JpaSort", ".", "unsafe", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", ").", "and", "(", "ASC", ",", "path", "(", "User_", ".", "colleagues", ")", ".", "dot", "(", "User_", ".", "roles", ")", ".", "dot", "(", "Role_", ".", "name", ")", ");", "assertThat", "(", "sort", ",", "hasItems", "(", "new", "Order", "(", "ASC", ",", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "new", "Order", "(", "DESC", ",", "\"", "foo", ".", "bar", "\"", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "colleagues", ".", "roles", ".", "name", "\"", "),", "is", "(", "not", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ");", "assertThat", "(", "sort", ".", "getOrderFor", "(", "\"", "foo", ".", "bar", "\"", "),", "is", "(", "instanceOf", "(", "JpaOrder", ".", "class", ")", "))", ";", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2008", "-", "2015", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2008", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "23", ",", "14", "+", "23", ",", "17", "@", "@", "import", "org", ".", "hamcrest", ".", "Matcher", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "dao", ".", "InvalidDataAccessApiUsageException", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Sort", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "JpaSort", ";", "/", "**", "*", "Unit", "test", "for", "{", "@", "link", "QueryUtils", "}", ".", "*", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Thomas", "Darimont", "*", "@", "author", "Komi", "Innocent", "*", "@", "author", "Christoph", "Strobl", "*", "/", "public", "class", "QueryUtilsUnitTests", "{", "@", "@", "-", "230", ",", "7", "+", "233", ",", "7", "@", "@", "public", "void", "projectsCOuntQueriesForQueriesWithSubselects", "(", ")", "{", "/", "**", "*", "@", "see", "DATAJPA", "-", "148", "*", "/", "@", "Test", "@", "Test", "(", "expected", "=", "InvalidDataAccessApiUsageException", ".", "class", ")", "public", "void", "doesNotPrefixSortsIfFunction", "(", ")", "{", "Sort", "sort", "=", "new", "Sort", "(", "\"", "sum", "(", "foo", ")", "\")", ";", "@", "@", "-", "361", ",", "6", "+", "364", ",", "134", "@", "@", "public", "void", "doesNotQualifySortIfNoAliasDetected", "(", ")", "{", "endsWith", "(", "\"", "order", "by", "firstname", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "(", "expected", "=", "InvalidDataAccessApiUsageException", ".", "class", ")", "public", "void", "doesNotAllowWhitespaceInSort", "(", ")", "{", "Sort", "sort", "=", "new", "Sort", "(", "\"", "case", "when", "foo", "then", "bar", "\"", ");", "applySorting", "(", "\"", "select", "p", "from", "Person", "p", "\"", ",", "sort", ",", "\"", "p", "\"", ");", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixUnsageJpaSortFunctionCalls", "(", ")", "{", "JpaSort", "sort", "=", "JpaSort", ".", "unsafe", "(", "\"", "sum", "(", "foo", ")", "\")", ";", "assertThat", "(", "applySorting", "(", "\"", "select", "p", "from", "Person", "p", "\"", ",", "sort", ",", "\"", "p", "\"", "),", "endsWith", "(", "\"", "order", "by", "sum", "(", "foo", ")", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixMultipleAliasedFunctionCalls", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", ",", "SUM", "(", "m", ".", "stocks", ")", "AS", "sumStocks", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ",", "\"", "sumStocks", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", ",", "sumStocks", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixSingleAliasedFunctionCalls", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "prefixesSingleNonAliasedFunctionCallRelatedSortProperty", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "someOtherProperty", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "someOtherProperty", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "prefixesNonAliasedFunctionCallRelatedSortPropertyWhenSelectClauseContainesAliasedFunctionForDifferentProperty", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "m", ".", "name", ",", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "name", "\"", ",", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "name", "asc", ",", "avgPrice", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithMultipleNumericParameters", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "SUBSTRING", "(", "m", ".", "name", ",", "2", ",", "5", ")", "AS", "trimmedName", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "trimmedName", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "trimmedName", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithMultipleStringParameters", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "CONCAT", "(", "m", ".", "name", ",", "'", "foo", "'", ")", "AS", "extendedName", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "extendedName", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "extendedName", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithUnderscores", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avg_price", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avg_price", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avg_price", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWithDots", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "m", ".", "avg", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "m", ".", "avg", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "m", ".", "avg", "asc", "\"", "))", ";", "}", "/", "**", "*", "@", "see", "DATAJPA", "-", "??", "?", "*", "/", "@", "Test", "public", "void", "doesNotPrefixAliasedFunctionCallNameWhenQueryStringContainsMultipleWhiteSpaces", "(", ")", "{", "String", "query", "=", "\"", "SELECT", "AVG", "(", "m", ".", "price", ")", "AS", "avgPrice", "FROM", "Magazine", "m", "\"", ";", "Sort", "sort", "=", "new", "Sort", "(", "\"", "avgPrice", "\"", ");", "assertThat", "(", "applySorting", "(", "query", ",", "sort", ",", "\"", "m", "\"", "),", "endsWith", "(", "\"", "order", "by", "avgPrice", "asc", "\"", "))", ";", "}", "private", "static", "void", "assertCountQuery", "(", "String", "originalQuery", ",", "String", "countQuery", ")", "{", "assertThat", "(", "createCountQueryFor", "(", "originalQuery", ")", ",", "is", "(", "countQuery", ")", ");", "}"], "docstring_tokens": ["sql", "injection"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1078", ",", "5", "+", "1078", ",", "22", "@", "@", "public", "int", "getPriority", "(", ")", "{", "*", "JENKINS", "-", "22346", ".", "*", "/", "public", "static", "boolean", "ALLOW_NON_EXISTENT_USER_TO_LOGIN", "=", "Boolean", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")+", "\".", "allowNonExistentUserToLogin", "\"", ");", "/", "**", "*", "Jenkins", "historically", "created", "a", "(", "usually", ")", "ephemeral", "user", "record", "when", "an", "user", "with", "Overall", "/", "Administer", "permission", "*", "accesses", "a", "/", "user", "/", "arbitraryName", "URL", ".", "*", "<", "p", ">", "*", "Unfortunately", "this", "constitutes", "a", "CSRF", "vulnerability", ",", "as", "malicious", "users", "can", "make", "admins", "create", "arbitrary", "numbers", "*", "of", "ephemeral", "user", "records", ",", "so", "the", "behavior", "was", "changed", "in", "Jenkins", "2", ".", "TODO", "/", "2", ".", "32", ".", "2", ".", "*", "<", "p", ">", "*", "As", "some", "users", "may", "be", "relying", "on", "the", "previous", "behavior", ",", "setting", "this", "to", "true", "restores", "the", "previous", "behavior", ".", "This", "*", "is", "not", "recommended", ".", "*", "*", "SECURITY", "-", "406", ".", "*", "/", "/", "/", "TODO", "2", ".", "4", "+", "SystemProperties", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "boolean", "ALLOW_USER_CREATION_VIA_URL", "=", "Boolean", ".", "getBoolean", "(", "User", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "allowUserCreationViaUrl", "\"", ");", "}", "@", "@", "-", "2485", ",", "11", "+", "2485", ",", "11", "@", "@", "private", "File", "getRootDirFor", "(", "String", "name", ")", "{", "/", "**", "*", "Gets", "the", "user", "of", "the", "given", "name", ".", "*", "*", "@", "return", "the", "user", "of", "the", "given", "name", "(", "which", "may", "or", "may", "not", "be", "an", "id", ")", ",", "if", "that", "person", "exists", "or", "the", "invoker", "{", "@", "link", "#", "hasPermission", "}", "on", "{", "@", "link", "#", "ADMINISTER", "}", ";", "else", "null", "*", "@", "return", "the", "user", "of", "the", "given", "name", "(", "which", "may", "or", "may", "not", "be", "an", "id", ")", ",", "if", "that", "person", "exists", ";", "else", "null", "*", "@", "see", "User", "#", "get", "(", "String", ",", "boolean", ")", ",", "{", "@", "link", "User", "#", "getById", "(", "String", ",", "boolean", ")", "}", "*", "/", "public", "@", "CheckForNull", "User", "getUser", "(", "String", "name", ")", "{", "return", "User", ".", "get", "(", "name", ",", "hasPermission", "(", "ADMINISTER", ")", ");", "return", "User", ".", "get", "(", "name", ",", "User", ".", "ALLOW_USER_CREATION_VIA_URL", "&", "&", "hasPermission", "(", "ADMINISTER", ")", ");", "}", "public", "synchronized", "TopLevelItem", "createProject", "(", "TopLevelItemDescriptor", "type", ",", "String", "name", ")", "throws", "IOException", "{", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "equalTo", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "@", "@", "-", "81", ",", "6", "+", "82", ",", "28", "@", "@", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Issue", "(", "\"", "SECURITY", "-", "406", "\"", ")", "@", "Test", "public", "void", "testUserCreationFromUrlForAdmins", "(", ")", "throws", "Exception", "{", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "assertNull", "(", "\"", "User", "not", "supposed", "to", "exist", "\"", ",", "User", ".", "getById", "(", "\"", "nonexistent", "\"", ",", "false", ")", ");", "wc", ".", "assertFails", "(", "\"", "user", "/", "nonexistent", "\"", ",", "404", ")", ";", "assertNull", "(", "\"", "User", "not", "supposed", "to", "exist", "\"", ",", "User", ".", "getById", "(", "\"", "nonexistent", "\"", ",", "false", ")", ");", "try", "{", "User", ".", "ALLOW_USER_CREATION_VIA_URL", "=", "true", ";", "/", "/", "expected", "to", "work", "wc", ".", "goTo", "(", "\"", "user", "/", "nonexistent2", "\"", ");", "assertNotNull", "(", "\"", "User", "supposed", "to", "exist", "\"", ",", "User", ".", "getById", "(", "\"", "nonexistent2", "\"", ",", "false", ")", ");", "}", "finally", "{", "User", ".", "ALLOW_USER_CREATION_VIA_URL", "=", "false", ";", "}", "}", "@", "Test", "public", "void", "testIsDisplayNameUniqueTrue", "(", ")", "throws", "Exception", "{", "final", "String", "curJobName", "=", "\"", "curJobName", "\"", ";"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "157", ",", "7", "+", "157", ",", "7", "@", "@", "void", "EVP_EncodeUpdate", "(", "EVP_ENCODE_CTX", "*", "ctx", ",", "unsigned", "char", "*", "out", ",", "int", "*", "outl", ",", "if", "(", "inl", "<", "=", "0", ")", "return", ";", "OPENSSL_assert", "(", "ctx", "-", ">", "length", "<", "=", "(", "int", ")", "sizeof", "(", "ctx", "-", ">", "enc_data", ")", ");", "if", "(", "(", "ctx", "-", ">", "num", "+", "inl", ")", "<", "ctx", "-", ">", "length", ")", "{", "if", "(", "ctx", "-", ">", "length", "-", "ctx", "-", ">", "num", ">", "inl", ")", "{", "memcpy", "(", "&(", "ctx", "-", ">", "enc_data", "[", "ctx", "-", ">", "num", "]", "),", "in", ",", "inl", ")", ";", "ctx", "-", ">", "num", "+", "=", "inl", ";", "return", ";"], "docstring_tokens": ["a", "buffer", "underflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "25", ",", "9", "+", "25", ",", "12", "@", "@", "package", "org", ".", "jenkinsci", ".", "plugins", ".", "scriptsecurity", ".", "sandbox", ".", "groovy", ";", "import", "edu", ".", "umd", ".", "cs", ".", "findbugs", ".", "annotations", ".", "SuppressFBWarnings", ";", "import", "groovy", ".", "grape", ".", "GrabAnnotationTransformation", ";", "import", "groovy", ".", "lang", ".", "GroovyShell", ";", "import", "groovy", ".", "lang", ".", "Script", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Callable", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "CompilerConfiguration", ";", "@", "@", "-", "58", ",", "11", "+", "61", ",", "21", "@", "@", "*", "@", "return", "a", "compiler", "configuration", "set", "up", "to", "use", "the", "sandbox", "*", "/", "public", "static", "@", "Nonnull", "CompilerConfiguration", "createSecureCompilerConfiguration", "(", ")", "{", "CompilerConfiguration", "cc", "=", "new", "CompilerConfiguration", "(", ");", "CompilerConfiguration", "cc", "=", "createBaseCompilerConfiguration", "(", ");", "cc", ".", "addCompilationCustomizers", "(", "new", "SandboxTransformer", "(", "))", ";", "return", "cc", ";", "}", "/", "**", "*", "Prepares", "a", "compiler", "configuration", "that", "rejects", "certain", "AST", "transformations", ".", "Used", "by", "{", "@", "link", "#", "createSecureCompilerConfiguration", "(", ")}", ".", "*", "/", "public", "static", "@", "Nonnull", "CompilerConfiguration", "createBaseCompilerConfiguration", "(", ")", "{", "CompilerConfiguration", "cc", "=", "new", "CompilerConfiguration", "(", ");", "cc", ".", "addCompilationCustomizers", "(", "new", "RejectASTTransformsCustomizer", "(", "))", ";", "cc", ".", "setDisabledGlobalASTTransformations", "(", "new", "HashSet", "<", ">(", "Collections", ".", "singletonList", "(", "GrabAnnotationTransformation", ".", "class", ".", "getName", "(", "))", "))", ";", "return", "cc", ";", "}", "/", "**", "*", "Prepares", "a", "classloader", "for", "Groovy", "shell", "for", "sandboxing", ".", "*", "@", "@", "-", "0", ",", "0", "+", "1", ",", "83", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "org", ".", "jenkinsci", ".", "plugins", ".", "scriptsecurity", ".", "sandbox", ".", "groovy", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "ImmutableList", ";", "import", "groovy", ".", "lang", ".", "Grab", ";", "import", "groovy", ".", "transform", ".", "ASTTest", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "ast", ".", "AnnotatedNode", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "ast", ".", "AnnotationNode", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "ast", ".", "ClassCodeVisitorSupport", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "ast", ".", "ClassNode", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "classgen", ".", "GeneratorContext", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "CompilationFailedException", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "CompilePhase", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "SourceUnit", ";", "import", "org", ".", "codehaus", ".", "groovy", ".", "control", ".", "customizers", ".", "CompilationCustomizer", ";", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "util", ".", "List", ";", "public", "class", "RejectASTTransformsCustomizer", "extends", "CompilationCustomizer", "{", "private", "static", "final", "List", "<", "Class", "<", "?", "extends", "Annotation", ">", ">", "BLOCKED_TRANSFORMS", "=", "ImmutableList", ".", "of", "(", "ASTTest", ".", "class", ",", "Grab", ".", "class", ")", ";", "public", "RejectASTTransformsCustomizer", "(", ")", "{", "super", "(", "CompilePhase", ".", "CONVERSION", ")", ";", "}", "@", "Override", "public", "void", "call", "(", "final", "SourceUnit", "source", ",", "GeneratorContext", "context", ",", "ClassNode", "classNode", ")", "throws", "CompilationFailedException", "{", "new", "RejectASTTransformsVisitor", "(", "source", ")", ".", "visitClass", "(", "classNode", ")", ";", "}", "private", "static", "class", "RejectASTTransformsVisitor", "extends", "ClassCodeVisitorSupport", "{", "private", "SourceUnit", "source", ";", "public", "RejectASTTransformsVisitor", "(", "SourceUnit", "source", ")", "{", "this", ".", "source", "=", "source", ";", "}", "@", "Override", "protected", "SourceUnit", "getSourceUnit", "(", ")", "{", "return", "source", ";", "}", "/", "**", "*", "If", "the", "node", "is", "annotated", "with", "one", "of", "the", "blocked", "transform", "annotations", ",", "throw", "a", "security", "exception", ".", "*", "*", "@", "param", "node", "the", "node", "to", "process", "*", "/", "@", "Override", "public", "void", "visitAnnotations", "(", "AnnotatedNode", "node", ")", "{", "for", "(", "AnnotationNode", "an", ":", "node", ".", "getAnnotations", "(", "))", "{", "for", "(", "Class", "<", "?", "extends", "Annotation", ">", "blockedAnnotation", ":", "BLOCKED_TRANSFORMS", ")", "{", "if", "(", "blockedAnnotation", ".", "getSimpleName", "(", ").", "equals", "(", "an", ".", "getClassNode", "(", ").", "getName", "(", "))", ")", "{", "throw", "new", "SecurityException", "(", "\"", "Annotation", "\"", "+", "blockedAnnotation", ".", "getSimpleName", "(", ")", "+", "\"", "cannot", "be", "used", "in", "the", "sandbox", ".", "\")", ";", "}", "}", "}", "}", "}", "}", "@", "@", "-", "74", ",", "12", "+", "74", ",", "15", "@", "@", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "ErrorCollector", ";", "import", "org", ".", "junit", ".", "rules", ".", "ExpectedException", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "public", "class", "SandboxInterceptorTest", "{", "@", "Rule", "public", "ErrorCollector", "errors", "=", "new", "ErrorCollector", "(", ");", "@", "Rule", "public", "ExpectedException", "thrown", "=", "ExpectedException", ".", "none", "(", ");", "@", "Test", "public", "void", "genericWhitelist", "(", ")", "throws", "Exception", "{", "assertEvaluate", "(", "new", "GenericWhitelist", "(", "),", "3", ",", "\"", "'", "foo", "bar", "baz", "'", ".", "split", "(", "'", "'", ").", "length", "\"", ");", "assertEvaluate", "(", "new", "GenericWhitelist", "(", "),", "false", ",", "\"", "def", "x", "=", "null", ";", "x", "!", "=", "null", "\"", ");", "@", "@", "-", "818", ",", "6", "+", "821", ",", "30", "@", "@", "public", "void", "explode", "(", ")", "{", "}", "assertRejected", "(", "new", "StaticWhitelist", "(", "),", "\"", "staticMethod", "hudson", ".", "model", ".", "Hudson", "getInstance", "\"", ",", "\"", "hudson", ".", "model", ".", "Hudson", ".", "instance", "\"", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1266", "\"", ")", "@", "Test", "public", "void", "blockedASTTransformsASTTest", "(", ")", "throws", "Exception", "{", "GroovyShell", "shell", "=", "new", "GroovyShell", "(", "GroovySandbox", ".", "createSecureCompilerConfiguration", "(", "))", ";", "thrown", ".", "expect", "(", "MultipleCompilationErrorsException", ".", "class", ")", ";", "thrown", ".", "expectMessage", "(", "\"", "Annotation", "ASTTest", "cannot", "be", "used", "in", "the", "sandbox", "\"", ");", "shell", ".", "parse", "(", "\"", "import", "groovy", ".", "transform", ".", "*\\", "n", "\"", "\"", "@", "ASTTest", "(", "value", "=", "{", "assert", "true", "}", ")\\", "n", "\"", "\"", "@", "Field", "int", "x", "\\", "n", "\"", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "1266", "\"", ")", "@", "Test", "public", "void", "blockedASTTransformsGrab", "(", ")", "throws", "Exception", "{", "GroovyShell", "shell", "=", "new", "GroovyShell", "(", "GroovySandbox", ".", "createSecureCompilerConfiguration", "(", "))", ";", "thrown", ".", "expect", "(", "MultipleCompilationErrorsException", ".", "class", ")", ";", "thrown", ".", "expectMessage", "(", "\"", "Annotation", "Grab", "cannot", "be", "used", "in", "the", "sandbox", "\"", ");", "shell", ".", "parse", "(", "\"@", "Grab", "(", "group", "=", "'", "foo", "'", ",", "module", "=", "'", "bar", "'", ",", "version", "=", "'", "1", ".", "0", "'", ")\\", "n", "\"", "\"", "def", "foo", "\\", "n", "\"", ");", "}", "private", "static", "Object", "evaluate", "(", "Whitelist", "whitelist", ",", "String", "script", ")", "{", "GroovyShell", "shell", "=", "new", "GroovyShell", "(", "GroovySandbox", ".", "createSecureCompilerConfiguration", "(", "))", ";", "Object", "actual", "=", "GroovySandbox", ".", "run", "(", "shell", ".", "parse", "(", "script", ")", ",", "whitelist", ")", ";"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "30", ",", "8", "+", "30", ",", "8", "@", "@", "*", "will", "be", "used", "for", "the", "destination", ".", "*", "<", "/", "li", ">", "*", "<", "li", ">", "*", "If", "a", "parameter", "matching", "the", "<", "tt", ">", "targetUrlParameter", "<", "/", "tt", ">", "has", "been", "set", "on", "the", "request", ",", "the", "value", "will", "be", "used", "as", "*", "the", "destination", ".", "*", "If", "a", "parameter", "matching", "the", "value", "of", "<", "tt", ">", "targetUrlParameter", "<", "/", "tt", ">", "has", "been", "set", "on", "the", "request", ",", "the", "value", "will", "be", "used", "*", "as", "the", "destination", ".", "By", "default", "this", "has", "the", "value", "\"", "spring", "-", "security", "-", "redirect", "\"", ".", "*", "<", "/", "li", ">", "*", "<", "li", ">", "*", "If", "the", "<", "tt", ">", "useReferer", "<", "/", "tt", ">", "property", "is", "set", ",", "the", "\"", "Referer", "\"", "HTTP", "header", "value", "will", "be", "used", ",", "if", "present", ".", "@", "@", "-", "154", ",", "7", "+", "154", ",", "9", "@", "@", "protected", "boolean", "isAlwaysUseDefaultTargetUrl", "(", ")", "{", "*", "to", "\"", "spring", "-", "security", "-", "redirect", "\"", ".", "*", "/", "public", "void", "setTargetUrlParameter", "(", "String", "targetUrlParameter", ")", "{", "Assert", ".", "hasText", "(", "targetUrlParameter", ",", "\"", "targetUrlParameter", "cannot", "be", "null", "or", "empty", "\"", ");", "if", "(", "!", "StringUtils", ".", "hasText", "(", "targetUrlParameter", ")", ")", "{", "targetUrlParameter", "=", "null", ";", "}", "this", ".", "targetUrlParameter", "=", "targetUrlParameter", ";", "}", "@", "@", "-", "19", ",", "6", "+", "19", ",", "10", "@", "@", "public", "class", "SimpleUrlLogoutSuccessHandler", "extends", "AbstractAuthenticationTargetUrlRequestHandler", "implements", "LogoutSuccessHandler", "{", "public", "SimpleUrlLogoutSuccessHandler", "(", ")", "{", "super", ".", "setTargetUrlParameter", "(", "null", ")", ";", "}", "public", "void", "onLogoutSuccess", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ",", "Authentication", "authentication", ")", "throws", "IOException", ",", "ServletException", "{", "super", ".", "handle", "(", "request", ",", "response", ",", "authentication", ")", ";"], "docstring_tokens": ["http", "header", "injection"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "344", ",", "13", "+", "344", ",", "12", "@", "@", "void", "build_ntlmssp_negotiate_blob", "(", "unsigned", "char", "*", "pbuffer", ",", "/", "*", "BB", "is", "NTLMV2", "session", "security", "format", "easier", "to", "use", "here", "?", "*", "/", "flags", "=", "NTLMSSP_NEGOTIATE_56", "|", "NTLMSSP_REQUEST_TARGET", "|", "NTLMSSP_NEGOTIATE_128", "|", "NTLMSSP_NEGOTIATE_UNICODE", "|", "NTLMSSP_NEGOTIATE_NTLM", "|", "NTLMSSP_NEGOTIATE_EXTENDED_SEC", ";", "if", "(", "ses", "-", ">", "server", "-", ">", "sign", ")", "{", "NTLMSSP_NEGOTIATE_NTLM", "|", "NTLMSSP_NEGOTIATE_EXTENDED_SEC", "|", "NTLMSSP_NEGOTIATE_SEAL", ";", "if", "(", "ses", "-", ">", "server", "-", ">", "sign", ")", "flags", "|", "=", "NTLMSSP_NEGOTIATE_SIGN", ";", "if", "(", "!", "ses", "-", ">", "server", "-", ">", "session_estab", "|", "|", "ses", "-", ">", "ntlmssp", "-", ">", "sesskey_per_smbsess", ")", "flags", "|", "=", "NTLMSSP_NEGOTIATE_KEY_XCH", ";", "}", "if", "(", "!", "ses", "-", ">", "server", "-", ">", "session_estab", "|", "|", "ses", "-", ">", "ntlmssp", "-", ">", "sesskey_per_smbsess", ")", "flags", "|", "=", "NTLMSSP_NEGOTIATE_KEY_XCH", ";", "sec_blob", "-", ">", "NegotiateFlags", "=", "cpu_to_le32", "(", "flags", ")", ";", "@", "@", "-", "407", ",", "13", "+", "406", ",", "12", "@", "@", "int", "build_ntlmssp_auth_blob", "(", "unsigned", "char", "*", "*", "pbuffer", ",", "flags", "=", "NTLMSSP_NEGOTIATE_56", "|", "NTLMSSP_REQUEST_TARGET", "|", "NTLMSSP_NEGOTIATE_TARGET_INFO", "|", "NTLMSSP_NEGOTIATE_128", "|", "NTLMSSP_NEGOTIATE_UNICODE", "|", "NTLMSSP_NEGOTIATE_NTLM", "|", "NTLMSSP_NEGOTIATE_EXTENDED_SEC", ";", "if", "(", "ses", "-", ">", "server", "-", ">", "sign", ")", "{", "NTLMSSP_NEGOTIATE_NTLM", "|", "NTLMSSP_NEGOTIATE_EXTENDED_SEC", "|", "NTLMSSP_NEGOTIATE_SEAL", ";", "if", "(", "ses", "-", ">", "server", "-", ">", "sign", ")", "flags", "|", "=", "NTLMSSP_NEGOTIATE_SIGN", ";", "if", "(", "!", "ses", "-", ">", "server", "-", ">", "session_estab", "|", "|", "ses", "-", ">", "ntlmssp", "-", ">", "sesskey_per_smbsess", ")", "flags", "|", "=", "NTLMSSP_NEGOTIATE_KEY_XCH", ";", "}", "if", "(", "!", "ses", "-", ">", "server", "-", ">", "session_estab", "|", "|", "ses", "-", ">", "ntlmssp", "-", ">", "sesskey_per_smbsess", ")", "flags", "|", "=", "NTLMSSP_NEGOTIATE_KEY_XCH", ";", "tmp", "=", "*", "pbuffer", "+", "sizeof", "(", "AUTHENTICATE_MESSAGE", ")", ";", "sec_blob", "-", ">", "NegotiateFlags", "=", "cpu_to_le32", "(", "flags", ")", ";", "@", "@", "-", "756", ",", "15", "+", "756", ",", "13", "@", "@", "SMB2_sess_establish_session", "(", "struct", "SMB2_sess_data", "*", "sess_data", ")", "struct", "cifs_ses", "*", "ses", "=", "sess_data", "-", ">", "ses", ";", "mutex_lock", "(", "&", "ses", "-", ">", "server", "-", ">", "srv_mutex", ")", ";", "if", "(", "ses", "-", ">", "server", "-", ">", "sign", "&", "&", "ses", "-", ">", "server", "-", ">", "ops", "-", ">", "generate_signingkey", ")", "{", "if", "(", "ses", "-", ">", "server", "-", ">", "ops", "-", ">", "generate_signingkey", ")", "{", "rc", "=", "ses", "-", ">", "server", "-", ">", "ops", "-", ">", "generate_signingkey", "(", "ses", ")", ";", "kfree", "(", "ses", "-", ">", "auth_key", ".", "response", ")", ";", "ses", "-", ">", "auth_key", ".", "response", "=", "NULL", ";", "if", "(", "rc", ")", "{", "cifs_dbg", "(", "FYI", ",", "\"", "SMB3", "session", "key", "generation", "failed", "\\", "n", "\"", ");", "mutex_unlock", "(", "&", "ses", "-", ">", "server", "-", ">", "srv_mutex", ")", ";", "goto", "keygen_exit", ";", "return", "rc", ";", "}", "}", "if", "(", "!", "ses", "-", ">", "server", "-", ">", "session_estab", ")", "{", "@", "@", "-", "778", ",", "12", "+", "776", ",", "6", "@", "@", "SMB2_sess_establish_session", "(", "struct", "SMB2_sess_data", "*", "sess_data", ")", "ses", "-", ">", "status", "=", "CifsGood", ";", "ses", "-", ">", "need_reconnect", "=", "false", ";", "spin_unlock", "(", "&", "GlobalMid_Lock", ")", ";", "keygen_exit", ":", "if", "(", "!", "ses", "-", ">", "server", "-", ">", "sign", ")", "{", "kfree", "(", "ses", "-", ">", "auth_key", ".", "response", ")", ";", "ses", "-", ">", "auth_key", ".", "response", "=", "NULL", ";", "}", "return", "rc", ";", "}"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "350", ",", "6", "+", "350", ",", "12", "@", "@", "static", "int", "picolcd_raw_event", "(", "struct", "hid_device", "*", "hdev", ",", "if", "(", "!", "data", ")", "return", "1", ";", "if", "(", "size", ">", "64", ")", "{", "hid_warn", "(", "hdev", ",", "\"", "invalid", "size", "value", "(", "%", "d", ")", "for", "picolcd", "raw", "event", "\\", "n", "\"", ",", "size", ")", ";", "return", "0", ";", "}", "if", "(", "report", "-", ">", "id", "=", "=", "REPORT_KEY_STATE", ")", "{", "if", "(", "data", "-", ">", "input_keys", ")", "ret", "=", "picolcd_raw_keypad", "(", "data", ",", "report", ",", "raw_data", "+", "1", ",", "size", "-", "1", ")", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "112", ",", "6", "+", "112", ",", "8", "@", "@", "static", "int", "usbtv_probe", "(", "struct", "usb_interface", "*", "intf", ",", "return", "0", ";", "usbtv_audio_fail", ":", "/", "*", "we", "must", "not", "free", "at", "this", "point", "*", "/", "usb_get_dev", "(", "usbtv", "-", ">", "udev", ")", ";", "usbtv_video_free", "(", "usbtv", ")", ";", "usbtv_video_fail", ":"], "docstring_tokens": ["data", "structure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "301", ",", "6", "+", "301", ",", "8", "@", "@", "isdn_ppp_open", "(", "int", "min", ",", "struct", "file", "*", "file", ")", "is", "-", ">", "compflags", "=", "0", ";", "is", "-", ">", "reset", "=", "isdn_ppp_ccp_reset_alloc", "(", "is", ")", ";", "if", "(", "!", "is", "-", ">", "reset", ")", "return", "-", "ENOMEM", ";", "is", "-", ">", "lp", "=", "NULL", ";", "is", "-", ">", "mp_seqno", "=", "0", ";", "/", "*", "MP", "sequence", "number", "*", "/", "@", "@", "-", "320", ",", "6", "+", "322", ",", "10", "@", "@", "isdn_ppp_open", "(", "int", "min", ",", "struct", "file", "*", "file", ")", "*", "VJ", "header", "compression", "init", "*", "/", "is", "-", ">", "slcomp", "=", "slhc_init", "(", "16", ",", "16", ")", ";", "/", "*", "not", "necessary", "for", "2", ".", "link", "in", "bundle", "*", "/", "if", "(", "!", "is", "-", ">", "slcomp", ")", "{", "isdn_ppp_ccp_reset_free", "(", "is", ")", ";", "return", "-", "ENOMEM", ";", "}", "#", "endif", "#", "ifdef", "CONFIG_IPPP_FILTER", "is", "-", ">", "pass_filter", "=", "NULL", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "214", ",", "6", "+", "214", ",", "9", "@", "@", "Bug", "Fixes", "*", "SOLR", "-", "11988", ":", "Fix", "exists", "(", ")", "method", "in", "EphemeralDirectoryFactory", "/", "MockDirectoryFactory", "to", "prevent", "false", "positives", "(", "hossman", ")", "*", "SOLR", "-", "11971", ":", "Don", "'", "t", "allow", "referal", "to", "external", "resources", "in", "DataImportHandler", "'", "s", "dataConfig", "request", "parameter", ".", "(", "\u9ea6", "\u9999", "\u6d53\u90c1", ",", "Uwe", "Schindler", ")", "Optimizations", "@", "@", "-", "16", ",", "6", "+", "16", ",", "7", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "handler", ".", "dataimport", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "EmptyEntityResolver", ";", "import", "org", ".", "apache", ".", "solr", ".", "common", ".", "SolrException", ";", "import", "org", ".", "apache", ".", "solr", ".", "core", ".", "SolrCore", ";", "import", "org", ".", "apache", ".", "solr", ".", "schema", ".", "IndexSchema", ";", "@", "@", "-", "178", ",", "11", "+", "179", ",", "11", "@", "@", "public", "IndexSchema", "getSchema", "(", ")", "{", "/", "**", "*", "Used", "by", "tests", "*", "/", "public", "void", "loadAndInit", "(", "String", "configStr", ")", "{", "void", "loadAndInit", "(", "String", "configStr", ")", "{", "config", "=", "loadDataConfig", "(", "new", "InputSource", "(", "new", "StringReader", "(", "configStr", ")", "))", ";", "}", "public", "void", "loadAndInit", "(", "InputSource", "configFile", ")", "{", "void", "loadAndInit", "(", "InputSource", "configFile", ")", "{", "config", "=", "loadDataConfig", "(", "configFile", ")", ";", "}", "@", "@", "-", "191", ",", "8", "+", "192", ",", "10", "@", "@", "public", "DIHConfiguration", "loadDataConfig", "(", "InputSource", "configFile", ")", "{", "DIHConfiguration", "dihcfg", "=", "null", ";", "try", "{", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setValidating", "(", "false", ")", ";", "/", "/", "only", "enable", "xinclude", ",", "if", "a", "a", "SolrCore", "and", "SystemId", "is", "present", "(", "makes", "no", "sense", "otherwise", ")", "/", "/", "only", "enable", "xinclude", ",", "if", "XML", "is", "coming", "from", "safe", "source", "(", "local", "file", ")", "/", "/", "and", "a", "a", "SolrCore", "and", "SystemId", "is", "present", "(", "makes", "no", "sense", "otherwise", ")", ":", "if", "(", "core", "!", "=", "null", "&", "&", "configFile", ".", "getSystemId", "(", ")", "!", "=", "null", ")", "{", "try", "{", "dbf", ".", "setXIncludeAware", "(", "true", ")", ";", "@", "@", "-", "203", ",", "8", "+", "206", ",", "14", "@", "@", "public", "DIHConfiguration", "loadDataConfig", "(", "InputSource", "configFile", ")", "{", "}", "DocumentBuilder", "builder", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "if", "(", "core", "!", "=", "null", ")", "/", "/", "only", "enable", "xinclude", "/", "external", "entities", ",", "if", "XML", "is", "coming", "from", "/", "/", "safe", "source", "(", "local", "file", ")", "and", "a", "a", "SolrCore", "and", "SystemId", "is", "present", ":", "if", "(", "core", "!", "=", "null", "&", "&", "configFile", ".", "getSystemId", "(", ")", "!", "=", "null", ")", "{", "builder", ".", "setEntityResolver", "(", "new", "SystemIdResolver", "(", "core", ".", "getResourceLoader", "(", "))", ");", "}", "else", "{", "/", "/", "Don", "'", "t", "allow", "external", "entities", "without", "having", "a", "system", "ID", ":", "builder", ".", "setEntityResolver", "(", "EmptyEntityResolver", ".", "SAX_INSTANCE", ")", ";", "}", "builder", ".", "setErrorHandler", "(", "XMLLOG", ")", ";", "Document", "document", ";", "try", "{", "@", "@", "-", "89", ",", "6", "+", "89", ",", "13", "@", "@", "public", "void", "testTransformerErrorContinue", "(", ")", "throws", "Exception", "{", "assertQ", "(", "req", "(", "\"*", ":*", "\")", ",", "\"", "//", "*[", "@", "numFound", "=", "'", "3", "'", "]\"", ");", "}", "public", "void", "testExternalEntity", "(", ")", "throws", "Exception", "{", "StringDataSource", ".", "xml", "=", "wellformedXml", ";", "/", "/", "This", "should", "not", "fail", "as", "external", "entities", "are", "replaced", "by", "an", "empty", "string", "during", "parsing", ":", "runFullImport", "(", "dataConfigWithEntity", ")", ";", "assertQ", "(", "req", "(", "\"*", ":*", "\")", ",", "\"", "//", "*[", "@", "numFound", "=", "'", "3", "'", "]\"", ");", "}", "public", "static", "class", "StringDataSource", "extends", "DataSource", "<", "Reader", ">", "{", "public", "static", "String", "xml", "=", "\"", "\";", "@", "@", "-", "157", ",", "6", "+", "164", ",", "19", "@", "@", "public", "Object", "transformRow", "(", "Map", "<", "String", ",", "Object", ">", "row", ",", "Context", "context", ")", "{", "\"", "<", "/", "document", ">", "\\", "n", "\"", "+", "\"", "</", "dataConfig", ">", "\";", "private", "String", "dataConfigWithEntity", "=", "\"", "<!", "DOCTYPE", "dataConfig", "[", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "internalTerm", "\\", "\"", "node", "\\", "\">", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "externalTerm", "SYSTEM", "\\", "\"", "foo", ":", "//", "bar", ".", "xyz", "/", "external", "\\", "\">", "\\", "n", "\"", "+", "\"", "]>", "<", "dataConfig", ">", "\\", "n", "\"", "\"", "<", "dataSource", "name", "=", "\\\"", "str", "\\", "\"", "type", "=", "\\\"", "TestErrorHandling", "$", "StringDataSource", "\\", "\"", "/", ">\"", "\"", "<", "document", ">", "\\", "n", "\"", "\"", "<", "entity", "name", "=", "\\\"", "&", "internalTerm", ";", "\\\"", "dataSource", "=", "\\\"", "str", "\\", "\"", "processor", "=", "\\\"", "XPathEntityProcessor", "\\", "\"", "url", "=", "\\\"", "test", "\\", "\"", "forEach", "=", "\\\"", "/", "root", "/", "node", "\\", "\"", "onError", "=", "\\\"", "skip", "\\", "\">", "\\", "n", "\"", "\"", "<", "field", "column", "=", "\\\"", "id", "\\", "\"", "xpath", "=", "\\\"", "/", "root", "/", "node", "/", "id", "\\", "\">", "&", "externalTerm", ";", "</", "field", ">", "\\", "n", "\"", "\"", "<", "field", "column", "=", "\\\"", "desc", "\\", "\"", "xpath", "=", "\\\"", "/", "root", "/", "node", "/", "desc", "\\", "\"", "/", ">\\", "n", "\"", "\"", "<", "/", "entity", ">", "\\", "n", "\"", "\"", "<", "/", "document", ">", "\\", "n", "\"", "\"", "</", "dataConfig", ">", "\";", "private", "String", "malformedXml", "=", "\"", "<", "root", ">", "\\", "n", "\"", "+", "\"", "<", "node", ">", "\\", "n", "\"", "+", "\"", "<", "id", ">", "1", "<", "/", "id", ">", "\\", "n", "\"", "+"], "docstring_tokens": ["xml", "external", "entity", "expansion", "(xxe"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "203", ",", "6", "+", "203", ",", "11", "@", "@", "PHP", "NEWS", ".", "Added", "SplObjectStorage", ":", ":", "getHash", "(", ")", "hook", ".", "(", "Etienne", ")", ".", "Added", "CallbackFilterIterator", "and", "RecursiveCallbackFilterIterator", "(", "Arnaud", ")", "-", "Improved", "XSL", "extension", ":", ".", "Added", "XsltProcessor", ":", ":", "setSecurityPrefs", "(", "$", "options", ")", "and", "getSecurityPrefs", "(", ")", "to", "define", "forbidden", "operations", "within", "XSLT", "stylesheets", ",", "default", "is", "not", "to", "enable", "any", "write", "operations", "from", "XSLT", "anymore", ".", "Bug", "#", "54446", "-", "Improved", "ZLIB", "extension", ":", ".", "Re", "-", "implemented", "non", "-", "file", "related", "functionality", ".", "(", "Mike", ")", "@", "@", "-", "174", ",", "6", "+", "174", ",", "9", "@", "@", "UPGRADE", "NOTES", "-", "PHP", "X", ".", "Y", "just", "the", "first", "matching", "node", ".", "-", "All", "SimpleXMLElement", "children", "are", "now", "always", "printed", "when", "using", "var_dump", "(", "),", "var_export", "(", "),", "and", "print_r", "(", ").", "-", "Write", "operations", "within", "XSLT", "(", "for", "example", "with", "the", "extension", "sax", ":", "output", ")", "are", "disabled", "by", "default", ".", "You", "can", "define", "what", "is", "forbidden", "with", "the", "method", "XsltProcess", ":", ":", "setSecurityPrefs", "(", "$", "options", ")", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "5", ".", "Changes", "made", "to", "existing", "methods", "@", "@", "-", "126", ",", "6", "+", "126", ",", "7", "@", "@", "zend_object_value", "xsl_objects_new", "(", "zend_class_entry", "*", "class_type", "TSRMLS_DC", ")", "intern", "-", ">", "node_list", "=", "NULL", ";", "intern", "-", ">", "doc", "=", "NULL", ";", "intern", "-", ">", "profiling", "=", "NULL", ";", "intern", "-", ">", "securityPrefs", "=", "XSL_SECPREF_WRITE_FILE", "|", "XSL_SECPREF_WRITE_NETWORK", "|", "XSL_SECPREF_CREATE_DIRECTORY", ";", "zend_object_std_init", "(", "&", "intern", "-", ">", "std", ",", "class_type", "TSRMLS_CC", ")", ";", "object_properties_init", "(", "&", "intern", "-", ">", "std", ",", "class_type", ")", ";", "@", "@", "-", "166", ",", "6", "+", "167", ",", "13", "@", "@", "PHP_MINIT_FUNCTION", "(", "xsl", ")", "REGISTER_LONG_CONSTANT", "(", "\"", "XSL_CLONE_NEVER", "\"", ",", "-", "1", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "XSL_CLONE_ALWAYS", "\"", ",", "1", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "XSL_SECPREF_NONE", "\"", ",", "XSL_SECPREF_NONE", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "XSL_SECPREF_READ_FILE", "\"", ",", "XSL_SECPREF_READ_FILE", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "XSL_SECPREF_WRITE_FILE", "\"", ",", "XSL_SECPREF_WRITE_FILE", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "XSL_SECPREF_CREATE_DIRECTORY", "\"", ",", "XSL_SECPREF_CREATE_DIRECTORY", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "XSL_SECPREF_READ_NETWORK", "\"", ",", "XSL_SECPREF_READ_NETWORK", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "XSL_SECPREF_WRITE_NETWORK", "\"", ",", "XSL_SECPREF_WRITE_NETWORK", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_LONG_CONSTANT", "(", "\"", "LIBXSLT_VERSION", "\"", ",", "LIBXSLT_VERSION", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "REGISTER_STRING_CONSTANT", "(", "\"", "LIBXSLT_DOTTED_VERSION", "\"", ",", "LIBXSLT_DOTTED_VERSION", ",", "CONST_CS", "|", "CONST_PERSISTENT", ")", ";", "@", "@", "-", "32", ",", "6", "+", "32", ",", "7", "@", "@", "extern", "zend_module_entry", "xsl_module_entry", ";", "#", "include", "<", "libxslt", "/", "xsltInternals", ".", "h", ">", "#", "include", "<", "libxslt", "/", "xsltutils", ".", "h", ">", "#", "include", "<", "libxslt", "/", "transform", ".", "h", ">", "#", "include", "<", "libxslt", "/", "security", ".", "h", ">", "#", "if", "HAVE_XSL_EXSLT", "#", "include", "<", "libexslt", "/", "exslt", ".", "h", ">", "#", "include", "<", "libexslt", "/", "exsltconfig", ".", "h", ">", "@", "@", "-", "43", ",", "6", "+", "44", ",", "13", "@", "@", "extern", "zend_module_entry", "xsl_module_entry", ";", "#", "include", "<", "libxslt", "/", "extensions", ".", "h", ">", "#", "include", "<", "libxml", "/", "xpathInternals", ".", "h", ">", "#", "define", "XSL_SECPREF_NONE", "0", "#", "define", "XSL_SECPREF_READ_FILE", "2", "#", "define", "XSL_SECPREF_WRITE_FILE", "4", "#", "define", "XSL_SECPREF_CREATE_DIRECTORY", "8", "#", "define", "XSL_SECPREF_READ_NETWORK", "16", "#", "define", "XSL_SECPREF_WRITE_NETWORK", "32", "typedef", "struct", "_xsl_object", "{", "zend_object", "std", ";", "void", "*", "ptr", ";", "@", "@", "-", "55", ",", "6", "+", "63", ",", "7", "@", "@", "typedef", "struct", "_xsl_object", "{", "HashTable", "*", "node_list", ";", "php_libxml_node_object", "*", "doc", ";", "char", "*", "profiling", ";", "long", "securityPrefs", ";", "}", "xsl_object", ";", "void", "php_xsl_set_object", "(", "zval", "*", "wrapper", ",", "void", "*", "obj", "TSRMLS_DC", ")", ";", "@", "@", "-", "34", ",", "6", "+", "34", ",", "9", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_remove_parameter", ")", ";", "PHP_FUNCTION", "(", "xsl_xsltprocessor_has_exslt_support", ")", ";", "PHP_FUNCTION", "(", "xsl_xsltprocessor_register_php_functions", ")", ";", "PHP_FUNCTION", "(", "xsl_xsltprocessor_set_profiling", ")", ";", "PHP_FUNCTION", "(", "xsl_xsltprocessor_set_security_prefs", ")", ";", "PHP_FUNCTION", "(", "xsl_xsltprocessor_get_security_prefs", ")", ";", "#", "endif", "/", "*", "@", "@", "-", "71", ",", "6", "+", "71", ",", "13", "@", "@", "ZEND_END_ARG_INFO", "(", ");", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_xsl_xsltprocessor_set_profiling", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "filename", ")", "ZEND_END_ARG_INFO", "(", ");", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_xsl_xsltprocessor_set_security_prefs", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "securityPrefs", ")", "ZEND_END_ARG_INFO", "(", ");", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_xsl_xsltprocessor_get_security_prefs", ",", "0", ",", "0", ",", "0", ")", "ZEND_END_ARG_INFO", "(", ");", "/", "*", "}", "}}", "*", "/", "/", "*", "@", "@", "-", "91", ",", "6", "+", "98", ",", "8", "@", "@", "const", "zend_function_entry", "php_xsl_xsltprocessor_class_functions", "[", "]", "=", "{", "PHP_FALIAS", "(", "hasExsltSupport", ",", "xsl_xsltprocessor_has_exslt_support", ",", "arginfo_xsl_xsltprocessor_has_exslt_support", ")", "PHP_FALIAS", "(", "registerPHPFunctions", ",", "xsl_xsltprocessor_register_php_functions", ",", "arginfo_xsl_xsltprocessor_register_php_functions", ")", "PHP_FALIAS", "(", "setProfiling", ",", "xsl_xsltprocessor_set_profiling", ",", "arginfo_xsl_xsltprocessor_set_profiling", ")", "PHP_FALIAS", "(", "setSecurityPrefs", ",", "xsl_xsltprocessor_set_security_prefs", ",", "arginfo_xsl_xsltprocessor_set_security_prefs", ")", "PHP_FALIAS", "(", "getSecurityPrefs", ",", "xsl_xsltprocessor_get_security_prefs", ",", "arginfo_xsl_xsltprocessor_get_security_prefs", ")", "{", "NULL", ",", "NULL", ",", "NULL", "}", "}", ";", "@", "@", "-", "531", ",", "11", "+", "540", ",", "46", "@", "@", "static", "xmlDocPtr", "php_xsl_apply_stylesheet", "(", "zval", "*", "id", ",", "xsl_object", "*", "intern", ",", "xsltStyl", "}", "efree", "(", "member", ")", ";", "/", "*", "Add", "security", "checks", "*", "/", "/", "*", "XSLT_SECPREF_READ_FILE", "and", "XSLT_SECPREF_READ_NETWORK", "aren", "'", "t", "needed", "*", "/", "xsltSecurityPrefsPtr", "secPrefs", "=", "xsltNewSecurityPrefs", "(", ");", "if", "(", "intern", "-", ">", "securityPrefs", "&", "XSL_SECPREF_READ_FILE", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_READ_FILE", ",", "xsltSecurityForbid", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Can", "'", "t", "set", "libxslt", "security", "properties", "\"", ");", "}", "}", "if", "(", "intern", "-", ">", "securityPrefs", "&", "XSL_SECPREF_WRITE_FILE", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_WRITE_FILE", ",", "xsltSecurityForbid", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Can", "'", "t", "set", "libxslt", "security", "properties", "\"", ");", "}", "}", "if", "(", "intern", "-", ">", "securityPrefs", "&", "XSL_SECPREF_CREATE_DIRECTORY", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_CREATE_DIRECTORY", ",", "xsltSecurityForbid", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Can", "'", "t", "set", "libxslt", "security", "properties", "\"", ");", "}", "}", "if", "(", "intern", "-", ">", "securityPrefs", "&", "XSL_SECPREF_READ_NETWORK", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_READ_NETWORK", ",", "xsltSecurityForbid", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Can", "'", "t", "set", "libxslt", "security", "properties", "\"", ");", "}", "}", "if", "(", "intern", "-", ">", "securityPrefs", "&", "XSL_SECPREF_WRITE_NETWORK", ")", "{", "if", "(", "0", "!", "=", "xsltSetSecurityPrefs", "(", "secPrefs", ",", "XSLT_SECPREF_WRITE_NETWORK", ",", "xsltSecurityForbid", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Can", "'", "t", "set", "libxslt", "security", "properties", "\"", ");", "}", "}", "if", "(", "0", "!", "=", "xsltSetCtxtSecurityPrefs", "(", "secPrefs", ",", "ctxt", ")", ")", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Can", "'", "t", "set", "libxslt", "security", "handler", "\"", ");", "newdocp", "=", "xsltApplyStylesheetUser", "(", "style", ",", "doc", ",", "(", "const", "char", "*", "*)", "params", ",", "NULL", ",", "f", ",", "ctxt", ")", ";", "if", "(", "f", ")", "{", "fclose", "(", "f", ")", ";", "}", "xsltFreeTransformContext", "(", "ctxt", ")", ";", "xsltFreeSecurityPrefs", "(", "secPrefs", ")", ";", "if", "(", "intern", "-", ">", "node_list", "!", "=", "NULL", ")", "{", "zend_hash_destroy", "(", "intern", "-", ">", "node_list", ")", ";", "@", "@", "-", "857", ",", "6", "+", "901", ",", "44", "@", "@", "PHP_FUNCTION", "(", "xsl_xsltprocessor_set_profiling", ")", "}", "/", "*", "}", "}}", "end", "xsl_xsltprocessor_set_profiling", "*", "/", "/", "*", "{", "{{", "proto", "long", "xsl_xsltprocessor_set_security_prefs", "(", "long", "securityPrefs", ")", "*", "/", "PHP_FUNCTION", "(", "xsl_xsltprocessor_set_security_prefs", ")", "{", "zval", "*", "id", ";", "xsl_object", "*", "intern", ";", "DOM_GET_THIS", "(", "id", ")", ";", "long", "securityPrefs", ",", "oldSecurityPrefs", ";", "if", "(", "zend_parse_parameters_ex", "(", "ZEND_PARSE_PARAMS_QUIET", ",", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "l", "\"", ",", "&", "securityPrefs", ")", "=", "=", "SUCCESS", ")", "{", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "oldSecurityPrefs", "=", "intern", "-", ">", "securityPrefs", ";", "intern", "-", ">", "securityPrefs", "=", "securityPrefs", ";", "RETURN_LONG", "(", "oldSecurityPrefs", ")", ";", "}", "else", "{", "WRONG_PARAM_COUNT", ";", "}", "}", "/", "*", "}", "}}", "end", "xsl_xsltprocessor_set_security_prefs", "*", "/", "/", "*", "{", "{{", "proto", "long", "xsl_xsltprocessor_get_security_prefs", "(", ")", "*", "/", "PHP_FUNCTION", "(", "xsl_xsltprocessor_get_security_prefs", ")", "{", "zval", "*", "id", ";", "xsl_object", "*", "intern", ";", "DOM_GET_THIS", "(", "id", ")", ";", "long", "securityPrefs", ";", "if", "(", "zend_parse_parameters_ex", "(", "ZEND_PARSE_PARAMS_QUIET", ",", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "\")", "=", "=", "SUCCESS", ")", "{", "intern", "=", "(", "xsl_object", "*", ")", "zend_object_store_get_object", "(", "id", "TSRMLS_CC", ")", ";", "RETURN_LONG", "(", "intern", "-", ">", "securityPrefs", ")", ";", "}", "else", "{", "WRONG_PARAM_COUNT", ";", "}", "}", "/", "*", "}", "}}", "end", "xsl_xsltprocessor_get_security_prefs", "*", "/", "/", "*", "{", "{{", "proto", "bool", "xsl_xsltprocessor_has_exslt_support", "(", ");", "*", "/", "PHP_FUNCTION", "(", "xsl_xsltprocessor_has_exslt_support", ")"], "docstring_tokens": ["arbitrary", "text", "output"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "52", ",", "7", "+", "52", ",", "7", "@", "@", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "offset", ",", "int", "length", ")", "throws", "IOException", "{", "throw", "new", "NullPointerException", "(", ");", "}", "if", "(", "offset", "<", "0", "|", "|", "offset", "+", "length", ">", "b", ".", "length", ")", "{", "if", "(", "offset", "<", "0", "|", "|", "length", "<", "0", "|", "|", "length", ">", "b", ".", "length", "|", "|", "offset", ">", "b", ".", "length", "-", "length", ")", "{", "throw", "new", "ArrayIndexOutOfBoundsException", "(", ");", "}"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "786", ",", "6", "+", "786", ",", "9", "@", "@", "int", "sctp_auth_ep_set_hmacs", "(", "struct", "sctp_endpoint", "*", "ep", ",", "for", "(", "i", "=", "0", ";", "i", "<", "hmacs", "-", ">", "shmac_num_idents", ";", "i", "+", "+)", "{", "id", "=", "hmacs", "-", ">", "shmac_idents", "[", "i", "]", ";", "if", "(", "id", ">", "SCTP_AUTH_HMAC_ID_MAX", ")", "return", "-", "EOPNOTSUPP", ";", "if", "(", "SCTP_AUTH_HMAC_ID_SHA1", "=", "=", "id", ")", "has_sha1", "=", "1", ";", "@", "@", "-", "3086", ",", "6", "+", "3086", ",", "7", "@", "@", "static", "int", "sctp_setsockopt_hmac_ident", "(", "struct", "sock", "*", "sk", ",", "int", "optlen", ")", "{", "struct", "sctp_hmacalgo", "*", "hmacs", ";", "u32", "idents", ";", "int", "err", ";", "if", "(", "!", "sctp_auth_enable", ")", "@", "@", "-", "3103", ",", "8", "+", "3104", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_hmac_ident", "(", "struct", "sock", "*", "sk", ",", "goto", "out", ";", "}", "if", "(", "hmacs", "-", ">", "shmac_num_idents", "=", "=", "0", "|", "|", "hmacs", "-", ">", "shmac_num_idents", ">", "SCTP_AUTH_NUM_HMACS", ")", "{", "idents", "=", "hmacs", "-", ">", "shmac_num_idents", ";", "if", "(", "idents", "=", "=", "0", "|", "|", "idents", ">", "SCTP_AUTH_NUM_HMACS", "|", "|", "(", "idents", "*", "sizeof", "(", "u16", ")", ")", ">", "(", "optlen", "-", "sizeof", "(", "struct", "sctp_hmacalgo", ")", "))", "{", "err", "=", "-", "EINVAL", ";", "goto", "out", ";", "}"], "docstring_tokens": ["sctp", "kernel", "memory", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "307", ",", "6", "+", "307", ",", "9", "@", "@", "static", "int", "powermate_probe", "(", "struct", "usb_interface", "*", "intf", ",", "const", "struct", "usb_device_i", "int", "error", "=", "-", "ENOMEM", ";", "interface", "=", "intf", "-", ">", "cur_altsetting", ";", "if", "(", "interface", "-", ">", "desc", ".", "bNumEndpoints", "<", "1", ")", "return", "-", "EINVAL", ";", "endpoint", "=", "&", "interface", "-", ">", "endpoint", "[", "0", "]", ".", "desc", ";", "if", "(", "!", "usb_endpoint_is_int_in", "(", "endpoint", ")", ")", "return", "-", "EIO", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "461", ",", "7", "+", "461", ",", "7", "@", "@", "static", "int", "logi_dj_recv_send_report", "(", "struct", "dj_receiver_dev", "*", "djrcv_dev", ",", "struct", "hid_report", "*", "report", ";", "struct", "hid_report_enum", "*", "output_report_enum", ";", "u8", "*", "data", "=", "(", "u8", "*", ")(", "&", "dj_report", "-", ">", "device_index", ")", ";", "int", "i", ";", "unsigned", "int", "i", ";", "output_report_enum", "=", "&", "hdev", "-", ">", "report_enum", "[", "HID_OUTPUT_REPORT", "]", ";", "report", "=", "output_report_enum", "-", ">", "report_id_hash", "[", "REPORT_ID_DJ_SHORT", "]", ";", "@", "@", "-", "471", ",", "7", "+", "471", ",", "7", "@", "@", "static", "int", "logi_dj_recv_send_report", "(", "struct", "dj_receiver_dev", "*", "djrcv_dev", ",", "return", "-", "ENODEV", ";", "}", "for", "(", "i", "=", "0", ";", "i", "<", "report", "-", ">", "field", "[", "0", "]", "->", "report_count", ";", "i", "+", "+)", "for", "(", "i", "=", "0", ";", "i", "<", "DJREPORT_SHORT_LENGTH", "-", "1", ";", "i", "+", "+)", "report", "-", ">", "field", "[", "0", "]", "->", "value", "[", "i", "]", "=", "data", "[", "i", "]", ";", "hid_hw_request", "(", "hdev", ",", "report", ",", "HID_REQ_SET_REPORT", ")", ";", "@", "@", "-", "791", ",", "6", "+", "791", ",", "12", "@", "@", "static", "int", "logi_dj_probe", "(", "struct", "hid_device", "*", "hdev", ",", "goto", "hid_parse_fail", ";", "}", "if", "(", "!", "hid_validate_values", "(", "hdev", ",", "HID_OUTPUT_REPORT", ",", "REPORT_ID_DJ_SHORT", ",", "0", ",", "DJREPORT_SHORT_LENGTH", "-", "1", ")", ")", "{", "retval", "=", "-", "ENODEV", ";", "goto", "hid_parse_fail", ";", "}", "/", "*", "Starts", "the", "usb", "device", "and", "connects", "to", "upper", "interfaces", "hiddev", "and", "*", "hidraw", "*", "/", "retval", "=", "hid_hw_start", "(", "hdev", ",", "HID_CONNECT_DEFAULT", ")", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "17", ",", "13", "+", "17", ",", "17", "@", "@", "package", "org", ".", "springframework", ".", "web", ".", "filter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Locale", ";", "import", "javax", ".", "servlet", ".", "FilterChain", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequestWrapper", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpMethod", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "WebUtils", ";", "@", "@", "-", "35", ",", "6", "+", "39", ",", "7", "@", "@", "*", "is", "to", "use", "a", "normal", "POST", "with", "an", "additional", "hidden", "form", "field", "(", "{@", "code", "_method", "}", ")", "*", "to", "pass", "the", "\"", "real", "\"", "HTTP", "method", "along", ".", "This", "filter", "reads", "that", "parameter", "and", "changes", "*", "the", "{", "@", "link", "HttpServletRequestWrapper", "#", "getMethod", "(", ")}", "return", "value", "accordingly", ".", "*", "Only", "{", "@", "code", "\"", "PUT", "\"", "},", "{", "@", "code", "\"", "DELETE", "\"", "}", "and", "{", "@", "code", "\"", "PATCH", "\"", "}", "HTTP", "methods", "are", "allowed", ".", "*", "*", "<", "p", ">", "The", "name", "of", "the", "request", "parameter", "defaults", "to", "{", "@", "code", "_method", "}", ",", "but", "can", "be", "*", "adapted", "via", "the", "{", "@", "link", "#", "setMethodParam", "(", "String", ")", "methodParam", "}", "property", ".", "@", "@", "-", "50", ",", "6", "+", "55", ",", "10", "@", "@", "*", "/", "public", "class", "HiddenHttpMethodFilter", "extends", "OncePerRequestFilter", "{", "private", "static", "final", "List", "<", "String", ">", "ALLOWED_METHODS", "=", "Collections", ".", "unmodifiableList", "(", "Arrays", ".", "asList", "(", "HttpMethod", ".", "PUT", ".", "name", "(", "),", "HttpMethod", ".", "DELETE", ".", "name", "(", "),", "HttpMethod", ".", "PATCH", ".", "name", "(", "))", ");", "/", "**", "Default", "method", "parameter", ":", "{", "@", "code", "_method", "}", "*", "/", "public", "static", "final", "String", "DEFAULT_METHOD_PARAM", "=", "\"", "_method", "\"", ";", "@", "@", "-", "74", ",", "7", "+", "83", ",", "10", "@", "@", "protected", "void", "doFilterInternal", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "if", "(", "\"", "POST", "\"", ".", "equals", "(", "request", ".", "getMethod", "(", "))", "&", "&", "request", ".", "getAttribute", "(", "WebUtils", ".", "ERROR_EXCEPTION_ATTRIBUTE", ")", "=", "=", "null", ")", "{", "String", "paramValue", "=", "request", ".", "getParameter", "(", "this", ".", "methodParam", ")", ";", "if", "(", "StringUtils", ".", "hasLength", "(", "paramValue", ")", ")", "{", "requestToUse", "=", "new", "HttpMethodRequestWrapper", "(", "request", ",", "paramValue", ")", ";", "String", "method", "=", "paramValue", ".", "toUpperCase", "(", "Locale", ".", "ENGLISH", ")", ";", "if", "(", "ALLOWED_METHODS", ".", "contains", "(", "method", ")", ")", "{", "requestToUse", "=", "new", "HttpMethodRequestWrapper", "(", "request", ",", "method", ")", ";", "}", "}", "}", "@", "@", "-", "92", ",", "7", "+", "104", ",", "7", "@", "@", "protected", "void", "doFilterInternal", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "public", "HttpMethodRequestWrapper", "(", "HttpServletRequest", "request", ",", "String", "method", ")", "{", "super", "(", "request", ")", ";", "this", ".", "method", "=", "method", ".", "toUpperCase", "(", "Locale", ".", "ENGLISH", ")", ";", "this", ".", "method", "=", "method", ";", "}", "@", "Override", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "31", ",", "45", "+", "31", ",", "52", "@", "@", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "*", "Tests", "for", "{", "@", "link", "HiddenHttpMethodFilter", "}", ".", "*", "*", "@", "author", "Arjen", "Poutsma", "*", "@", "author", "Brian", "Clozel", "*", "/", "public", "class", "HiddenHttpMethodFilterTests", "{", "private", "final", "HiddenHttpMethodFilter", "filter", "=", "new", "HiddenHttpMethodFilter", "(", ");", "@", "Test", "public", "void", "filterWithParameter", "(", ")", "throws", "IOException", ",", "ServletException", "{", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "POST", "\"", ",", "\"", "/", "hotels", "\"", ");", "request", ".", "addParameter", "(", "\"", "_method", "\"", ",", "\"", "delete", "\"", ");", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "FilterChain", "filterChain", "=", "new", "FilterChain", "(", ")", "{", "filterWithParameterForMethod", "(", "\"", "delete", "\"", ",", "\"", "DELETE", "\"", ");", "filterWithParameterForMethod", "(", "\"", "put", "\"", ",", "\"", "PUT", "\"", ");", "filterWithParameterForMethod", "(", "\"", "patch", "\"", ",", "\"", "PATCH", "\"", ");", "}", "@", "Override", "public", "void", "doFilter", "(", "ServletRequest", "filterRequest", ",", "ServletResponse", "filterResponse", ")", "throws", "IOException", ",", "ServletException", "{", "assertEquals", "(", "\"", "Invalid", "method", "\"", ",", "\"", "DELETE", "\"", ",", "(", "(", "HttpServletRequest", ")", "filterRequest", ")", ".", "getMethod", "(", "))", ";", "}", "}", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "@", "Test", "public", "void", "filterWithParameterDisallowedMethods", "(", ")", "throws", "IOException", ",", "ServletException", "{", "filterWithParameterForMethod", "(", "\"", "trace", "\"", ",", "\"", "POST", "\"", ");", "filterWithParameterForMethod", "(", "\"", "head", "\"", ",", "\"", "POST", "\"", ");", "filterWithParameterForMethod", "(", "\"", "options", "\"", ",", "\"", "POST", "\"", ");", "}", "@", "Test", "public", "void", "filterWithNoParameter", "(", ")", "throws", "IOException", ",", "ServletException", "{", "filterWithParameterForMethod", "(", "null", ",", "\"", "POST", "\"", ");", "}", "private", "void", "filterWithParameterForMethod", "(", "String", "methodParam", ",", "String", "expectedMethod", ")", "throws", "IOException", ",", "ServletException", "{", "MockHttpServletRequest", "request", "=", "new", "MockHttpServletRequest", "(", "\"", "POST", "\"", ",", "\"", "/", "hotels", "\"", ");", "if", "(", "methodParam", "!", "=", "null", ")", "{", "request", ".", "addParameter", "(", "\"", "_method", "\"", ",", "methodParam", ")", ";", "}", "MockHttpServletResponse", "response", "=", "new", "MockHttpServletResponse", "(", ");", "FilterChain", "filterChain", "=", "new", "FilterChain", "(", ")", "{", "@", "Override", "public", "void", "doFilter", "(", "ServletRequest", "filterRequest", ",", "ServletResponse", "filterResponse", ")", "throws", "IOException", ",", "ServletException", "{", "assertEquals", "(", "\"", "Invalid", "method", "\"", ",", "\"", "POST", "\"", ",", "assertEquals", "(", "\"", "Invalid", "method", "\"", ",", "expectedMethod", ",", "(", "(", "HttpServletRequest", ")", "filterRequest", ")", ".", "getMethod", "(", "))", ";", "}", "}", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "this", ".", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["cross-site", "tracing"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1959", ",", "6", "+", "1959", ",", "11", "@", "@", "int", "kvm_set_msr_common", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "struct", "msr_data", "*", "msr_info", ")", "/", "*", ".", "..", "but", "clean", "it", "before", "doing", "the", "actual", "write", "*", "/", "vcpu", "-", ">", "arch", ".", "time_offset", "=", "data", "&", "~", "(", "PAGE_MASK", "|", "1", ")", ";", "/", "*", "Check", "that", "the", "address", "is", "32", "-", "byte", "aligned", ".", "*", "/", "if", "(", "vcpu", "-", ">", "arch", ".", "time_offset", "&", "(", "sizeof", "(", "struct", "pvclock_vcpu_time_info", ")", "-", "1", ")", ")", "break", ";", "vcpu", "-", ">", "arch", ".", "time_page", "=", "gfn_to_page", "(", "vcpu", "-", ">", "kvm", ",", "data", ">", ">", "PAGE_SHIFT", ")", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2515", ",", "6", "+", "2515", ",", "11", "@", "@", "static", "int", "imon_probe", "(", "struct", "usb_interface", "*", "interface", ",", "mutex_lock", "(", "&", "driver_lock", ")", ";", "first_if", "=", "usb_ifnum_to_if", "(", "usbdev", ",", "0", ")", ";", "if", "(", "!", "first_if", ")", "{", "ret", "=", "-", "ENODEV", ";", "goto", "fail", ";", "}", "first_if_ctx", "=", "usb_get_intfdata", "(", "first_if", ")", ";", "if", "(", "ifnum", "=", "=", "0", ")", "{"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "57", ",", "30", "+", "57", ",", "17", "@", "@", "int", "rds_page_copy_user", "(", "struct", "page", "*", "page", ",", "unsigned", "long", "offset", ",", "unsigned", "long", "ret", ";", "void", "*", "addr", ";", "if", "(", "to_user", ")", "addr", "=", "kmap", "(", "page", ")", ";", "if", "(", "to_user", ")", "{", "rds_stats_add", "(", "s_copy_to_user", ",", "bytes", ")", ";", "else", "ret", "=", "copy_to_user", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "}", "else", "{", "rds_stats_add", "(", "s_copy_from_user", ",", "bytes", ")", ";", "addr", "=", "kmap_atomic", "(", "page", ",", "KM_USER0", ")", ";", "if", "(", "to_user", ")", "ret", "=", "__copy_to_user_inatomic", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "else", "ret", "=", "__copy_from_user_inatomic", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "kunmap_atomic", "(", "addr", ",", "KM_USER0", ")", ";", "if", "(", "ret", ")", "{", "addr", "=", "kmap", "(", "page", ")", ";", "if", "(", "to_user", ")", "ret", "=", "copy_to_user", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "else", "ret", "=", "copy_from_user", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "kunmap", "(", "page", ")", ";", "if", "(", "ret", ")", "return", "-", "EFAULT", ";", "ret", "=", "copy_from_user", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "}", "kunmap", "(", "page", ")", ";", "return", "0", ";", "return", "ret", "?", "-", "EFAULT", ":", "0", ";", "}", "EXPORT_SYMBOL_GPL", "(", "rds_page_copy_user", ")", ";"], "docstring_tokens": ["reliable", "datagram", "sockets"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "661", ",", "6", "+", "661", ",", "8", "@", "@", "static", "Image", "*", "ReadBMPImage", "(", "const", "ImageInfo", "*", "image_info", ",", "ExceptionInfo", "*", "exception", ")", "bmp_info", ".", "x_pixels", "=", "ReadBlobLSBLong", "(", "image", ")", ";", "bmp_info", ".", "y_pixels", "=", "ReadBlobLSBLong", "(", "image", ")", ";", "bmp_info", ".", "number_colors", "=", "ReadBlobLSBLong", "(", "image", ")", ";", "if", "(", "bmp_info", ".", "number_colors", ">", "GetBlobSize", "(", "image", ")", ")", "ThrowReaderException", "(", "CorruptImageError", ",", "\"", "InsufficientImageDataInFile", "\"", ");", "bmp_info", ".", "colors_important", "=", "ReadBlobLSBLong", "(", "image", ")", ";", "if", "(", "image", "-", ">", "debug", "!", "=", "MagickFalse", ")", "{"], "docstring_tokens": ["memory", "allocation"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "412", ",", "8", "+", "412", ",", "14", "@", "@", "PHP_FUNCTION", "(", "dns_check_record", ")", "#", "if", "HAVE_FULL_DNS_FUNCS", "#", "define", "CHECKCP", "(", "n", ")", "do", "{", "\\", "if", "(", "cp", "+", "n", ">", "end", ")", "{", "\\", "return", "NULL", ";", "\\", "}", "\\", "}", "while", "(", "0", ")", "/", "*", "{", "{{", "php_parserr", "*", "/", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "store", ",", "int", "raw", ",", "zval", "*", "*", "subarray", ")", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "u_char", "*", "end", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "store", ",", "int", "raw", ",", "zval", "*", "*", "subarray", ")", "{", "u_short", "type", ",", "class", ",", "dlen", ";", "u_long", "ttl", ";", "@", "@", "-", "425", ",", "16", "+", "431", ",", "18", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "*", "subarray", "=", "NULL", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "answer", "-", ">", "qb2", "+", "65536", ",", "cp", ",", "name", ",", "sizeof", "(", "name", ")", "-", "2", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "end", ",", "cp", ",", "name", ",", "sizeof", "(", "name", ")", "-", "2", ")", ";", "if", "(", "n", "<", "0", ")", "{", "return", "NULL", ";", "}", "cp", "+", "=", "n", ";", "CHECKCP", "(", "10", ")", ";", "GETSHORT", "(", "type", ",", "cp", ")", ";", "GETSHORT", "(", "class", ",", "cp", ")", ";", "GETLONG", "(", "ttl", ",", "cp", ")", ";", "GETSHORT", "(", "dlen", ",", "cp", ")", ";", "CHECKCP", "(", "dlen", ")", ";", "if", "(", "type_to_fetch", "!", "=", "T_ANY", "&", "&", "type", "!", "=", "type_to_fetch", ")", "{", "cp", "+", "=", "dlen", ";", "return", "cp", ";", "@", "@", "-", "461", ",", "12", "+", "469", ",", "14", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "switch", "(", "type", ")", "{", "case", "DNS_T_A", ":", "CHECKCP", "(", "4", ")", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "A", "\"", ",", "1", ")", ";", "snprintf", "(", "name", ",", "sizeof", "(", "name", ")", ",", "\"", "%", "d", ".", "%", "d", ".", "%", "d", ".", "%", "d", "\"", ",", "cp", "[", "0", "]", ",", "cp", "[", "1", "]", ",", "cp", "[", "2", "]", ",", "cp", "[", "3", "]", ");", "add_assoc_string", "(", "*", "subarray", ",", "\"", "ip", "\"", ",", "name", ",", "1", ")", ";", "cp", "+", "=", "dlen", ";", "break", ";", "case", "DNS_T_MX", ":", "CHECKCP", "(", "2", ")", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "MX", "\"", ",", "1", ")", ";", "GETSHORT", "(", "n", ",", "cp", ")", ";", "add_assoc_long", "(", "*", "subarray", ",", "\"", "pri", "\"", ",", "n", ")", ";", "@", "@", "-", "485", ",", "7", "+", "495", ",", "7", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "if", "(", "type", "=", "=", "DNS_T_PTR", ")", "{", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "PTR", "\"", ",", "1", ")", ";", "}", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "answer", "-", ">", "qb2", "+", "65536", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "end", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "if", "(", "n", "<", "0", ")", "{", "return", "NULL", ";", "}", "@", "@", "-", "495", ",", "18", "+", "505", ",", "22", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "case", "DNS_T_HINFO", ":", "/", "*", "See", "RFC", "1010", "for", "values", "*", "/", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "HINFO", "\"", ",", "1", ")", ";", "CHECKCP", "(", "1", ")", ";", "n", "=", "*", "cp", "&", "0xFF", ";", "cp", "+", "+;", "CHECKCP", "(", "n", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "cpu", "\"", ",", "(", "char", "*", ")", "cp", ",", "n", ",", "1", ")", ";", "cp", "+", "=", "n", ";", "CHECKCP", "(", "1", ")", ";", "n", "=", "*", "cp", "&", "0xFF", ";", "cp", "+", "+;", "CHECKCP", "(", "n", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "os", "\"", ",", "(", "char", "*", ")", "cp", ",", "n", ",", "1", ")", ";", "cp", "+", "=", "n", ";", "break", ";", "case", "DNS_T_TXT", ":", "{", "int", "ll", "=", "0", ";", "int", "l1", "=", "0", ",", "l2", "=", "0", ";", "zval", "*", "entries", "=", "NULL", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "TXT", "\"", ",", "1", ")", ";", "@", "@", "-", "515", ",", "37", "+", "529", ",", "41", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "MAKE_STD_ZVAL", "(", "entries", ")", ";", "array_init", "(", "entries", ")", ";", "while", "(", "ll", "<", "dlen", ")", "{", "n", "=", "cp", "[", "ll", "]", ";", "if", "(", "(", "ll", "+", "n", ")", ">", "=", "dlen", ")", "{", "while", "(", "l1", "<", "dlen", ")", "{", "n", "=", "cp", "[", "l1", "]", ";", "if", "(", "(", "l1", "+", "n", ")", ">", "=", "dlen", ")", "{", "/", "/", "Invalid", "chunk", "length", ",", "truncate", "n", "=", "dlen", "-", "(", "ll", "+", "1", ")", ";", "n", "=", "dlen", "-", "(", "l1", "+", "1", ")", ";", "}", "if", "(", "n", ")", "{", "memcpy", "(", "tp", "+", "l2", ",", "cp", "+", "l1", "+", "1", ",", "n", ")", ";", "add_next_index_stringl", "(", "entries", ",", "cp", "+", "l1", "+", "1", ",", "n", ",", "1", ")", ";", "}", "memcpy", "(", "tp", "+", "ll", ",", "cp", "+", "ll", "+", "1", ",", "n", ")", ";", "add_next_index_stringl", "(", "entries", ",", "cp", "+", "ll", "+", "1", ",", "n", ",", "1", ")", ";", "ll", "=", "ll", "+", "n", "+", "1", ";", "l1", "=", "l1", "+", "n", "+", "1", ";", "l2", "=", "l2", "+", "n", ";", "}", "tp", "[", "dlen", "]", "=", "'", "\\", "0", "'", ";", "tp", "[", "l2", "]", "=", "'", "\\", "0", "'", ";", "cp", "+", "=", "dlen", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "txt", "\"", ",", "tp", ",", "(", "dlen", ">", "0", ")", "?", "dlen", "-", "1", ":", "0", ",", "0", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "txt", "\"", ",", "tp", ",", "l2", ",", "0", ")", ";", "add_assoc_zval", "(", "*", "subarray", ",", "\"", "entries", "\"", ",", "entries", ")", ";", "}", "break", ";", "case", "DNS_T_SOA", ":", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "SOA", "\"", ",", "1", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "answer", "-", ">", "qb2", "+", "65536", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "end", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "if", "(", "n", "<", "0", ")", "{", "return", "NULL", ";", "}", "cp", "+", "=", "n", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "mname", "\"", ",", "name", ",", "1", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "answer", "-", ">", "qb2", "+", "65536", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "end", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "if", "(", "n", "<", "0", ")", "{", "return", "NULL", ";", "}", "cp", "+", "=", "n", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "rname", "\"", ",", "name", ",", "1", ")", ";", "CHECKCP", "(", "5", "*", "4", ")", ";", "GETLONG", "(", "n", ",", "cp", ")", ";", "add_assoc_long", "(", "*", "subarray", ",", "\"", "serial", "\"", ",", "n", ")", ";", "GETLONG", "(", "n", ",", "cp", ")", ";", "@", "@", "-", "559", ",", "6", "+", "577", ",", "7", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "break", ";", "case", "DNS_T_AAAA", ":", "tp", "=", "(", "u_char", "*", ")", "name", ";", "CHECKCP", "(", "8", "*", "2", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "8", ";", "i", "+", "+)", "{", "GETSHORT", "(", "s", ",", "cp", ")", ";", "if", "(", "s", "!", "=", "0", ")", "{", "@", "@", "-", "593", ",", "6", "+", "612", ",", "7", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "case", "DNS_T_A6", ":", "p", "=", "cp", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "A6", "\"", ",", "1", ")", ";", "CHECKCP", "(", "1", ")", ";", "n", "=", "(", "(", "int", ")", "cp", "[", "0", "]", ")", "&", "0xFF", ";", "cp", "+", "+;", "add_assoc_long", "(", "*", "subarray", ",", "\"", "masklen", "\"", ",", "n", ")", ";", "@", "@", "-", "628", ",", "6", "+", "648", ",", "7", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "cp", "+", "+;", "}", "for", "(", "i", "=", "(", "n", "+", "8", ")", "/", "16", ";", "i", "<", "8", ";", "i", "+", "+)", "{", "CHECKCP", "(", "2", ")", ";", "GETSHORT", "(", "s", ",", "cp", ")", ";", "if", "(", "s", "!", "=", "0", ")", "{", "if", "(", "tp", ">", "(", "u_char", "*", ")", "name", ")", "{", "@", "@", "-", "657", ",", "7", "+", "678", ",", "7", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "tp", "[", "0", "]", "=", "'", "\\", "0", "'", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "ipv6", "\"", ",", "name", ",", "1", ")", ";", "if", "(", "cp", "<", "p", "+", "dlen", ")", "{", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "answer", "-", ">", "qb2", "+", "65536", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "end", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "if", "(", "n", "<", "0", ")", "{", "return", "NULL", ";", "}", "@", "@", "-", "666", ",", "36", "+", "687", ",", "51", "@", "@", "static", "u_char", "*", "php_parserr", "(", "u_char", "*", "cp", ",", "querybuf", "*", "answer", ",", "int", "type_to_fetch", ",", "int", "}", "break", ";", "case", "DNS_T_SRV", ":", "CHECKCP", "(", "3", "*", "2", ")", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "SRV", "\"", ",", "1", ")", ";", "GETSHORT", "(", "n", ",", "cp", ")", ";", "add_assoc_long", "(", "*", "subarray", ",", "\"", "pri", "\"", ",", "n", ")", ";", "GETSHORT", "(", "n", ",", "cp", ")", ";", "add_assoc_long", "(", "*", "subarray", ",", "\"", "weight", "\"", ",", "n", ")", ";", "GETSHORT", "(", "n", ",", "cp", ")", ";", "add_assoc_long", "(", "*", "subarray", ",", "\"", "port", "\"", ",", "n", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "answer", "-", ">", "qb2", "+", "65536", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "end", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "if", "(", "n", "<", "0", ")", "{", "return", "NULL", ";", "}", "cp", "+", "=", "n", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "target", "\"", ",", "name", ",", "1", ")", ";", "break", ";", "case", "DNS_T_NAPTR", ":", "CHECKCP", "(", "2", "*", "2", ")", ";", "add_assoc_string", "(", "*", "subarray", ",", "\"", "type", "\"", ",", "\"", "NAPTR", "\"", ",", "1", ")", ";", "GETSHORT", "(", "n", ",", "cp", ")", ";", "add_assoc_long", "(", "*", "subarray", ",", "\"", "order", "\"", ",", "n", ")", ";", "GETSHORT", "(", "n", ",", "cp", ")", ";", "add_assoc_long", "(", "*", "subarray", ",", "\"", "pref", "\"", ",", "n", ")", ";", "CHECKCP", "(", "1", ")", ";", "n", "=", "(", "cp", "[", "0", "]", "&", "0xFF", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "flags", "\"", ",", "(", "char", "*", ")+", "+", "cp", ",", "n", ",", "1", ")", ";", "cp", "+", "+;", "CHECKCP", "(", "n", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "flags", "\"", ",", "(", "char", "*", ")", "cp", ",", "n", ",", "1", ")", ";", "cp", "+", "=", "n", ";", "CHECKCP", "(", "1", ")", ";", "n", "=", "(", "cp", "[", "0", "]", "&", "0xFF", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "services", "\"", ",", "(", "char", "*", ")+", "+", "cp", ",", "n", ",", "1", ")", ";", "cp", "+", "+;", "CHECKCP", "(", "n", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "services", "\"", ",", "(", "char", "*", ")", "cp", ",", "n", ",", "1", ")", ";", "cp", "+", "=", "n", ";", "CHECKCP", "(", "1", ")", ";", "n", "=", "(", "cp", "[", "0", "]", "&", "0xFF", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "regex", "\"", ",", "(", "char", "*", ")+", "+", "cp", ",", "n", ",", "1", ")", ";", "cp", "+", "+;", "CHECKCP", "(", "n", ")", ";", "add_assoc_stringl", "(", "*", "subarray", ",", "\"", "regex", "\"", ",", "(", "char", "*", ")", "cp", ",", "n", ",", "1", ")", ";", "cp", "+", "=", "n", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "answer", "-", ">", "qb2", "+", "65536", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "n", "=", "dn_expand", "(", "answer", "-", ">", "qb2", ",", "end", ",", "cp", ",", "name", ",", "(", "sizeof", "name", ")", "-", "2", ")", ";", "if", "(", "n", "<", "0", ")", "{", "return", "NULL", ";", "}", "@", "@", "-", "888", ",", "7", "+", "924", ",", "7", "@", "@", "PHP_FUNCTION", "(", "dns_get_record", ")", "while", "(", "an", "-", "-", "&", "&", "cp", "&", "&", "cp", "<", "end", ")", "{", "zval", "*", "retval", ";", "cp", "=", "php_parserr", "(", "cp", ",", "&", "answer", ",", "type_to_fetch", ",", "store_results", ",", "raw", ",", "&", "retval", ")", ";", "cp", "=", "php_parserr", "(", "cp", ",", "end", ",", "&", "answer", ",", "type_to_fetch", ",", "store_results", ",", "raw", ",", "&", "retval", ")", ";", "if", "(", "retval", "!", "=", "NULL", "&", "&", "store_results", ")", "{", "add_next_index_zval", "(", "return_value", ",", "retval", ")", ";", "}", "@", "@", "-", "901", ",", "7", "+", "937", ",", "7", "@", "@", "PHP_FUNCTION", "(", "dns_get_record", ")", "while", "(", "ns", "-", "-", ">", "0", "&", "&", "cp", "&", "&", "cp", "<", "end", ")", "{", "zval", "*", "retval", "=", "NULL", ";", "cp", "=", "php_parserr", "(", "cp", ",", "&", "answer", ",", "DNS_T_ANY", ",", "authns", "!", "=", "NULL", ",", "raw", ",", "&", "retval", ")", ";", "cp", "=", "php_parserr", "(", "cp", ",", "end", ",", "&", "answer", ",", "DNS_T_ANY", ",", "authns", "!", "=", "NULL", ",", "raw", ",", "&", "retval", ")", ";", "if", "(", "retval", "!", "=", "NULL", ")", "{", "add_next_index_zval", "(", "authns", ",", "retval", ")", ";", "}", "@", "@", "-", "913", ",", "7", "+", "949", ",", "7", "@", "@", "PHP_FUNCTION", "(", "dns_get_record", ")", "while", "(", "ar", "-", "-", ">", "0", "&", "&", "cp", "&", "&", "cp", "<", "end", ")", "{", "zval", "*", "retval", "=", "NULL", ";", "cp", "=", "php_parserr", "(", "cp", ",", "&", "answer", ",", "DNS_T_ANY", ",", "1", ",", "raw", ",", "&", "retval", ")", ";", "cp", "=", "php_parserr", "(", "cp", ",", "end", ",", "&", "answer", ",", "DNS_T_ANY", ",", "1", ",", "raw", ",", "&", "retval", ")", ";", "if", "(", "retval", "!", "=", "NULL", ")", "{", "add_next_index_zval", "(", "addtl", ",", "retval", ")", ";", "}"], "docstring_tokens": ["buffer", "overflows"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2009", ",", "2011", ",", "2013", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2009", ",", "2011", ",", "2013", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "58", ",", "8", "+", "58", ",", "10", "@", "@", "public", "SjsxpDriver", "(", "XmlFriendlyNameCoder", "nameCoder", ")", "{", "protected", "XMLInputFactory", "createInputFactory", "(", ")", "{", "Exception", "exception", "=", "null", ";", "try", "{", "return", "(", "XMLInputFactory", ")", "Class", ".", "forName", "(", "\"", "com", ".", "sun", ".", "xml", ".", "internal", ".", "stream", ".", "XMLInputFactoryImpl", "\"", ").", "newInstance", "(", ");", "}", "catch", "(", "InstantiationException", "e", ")", "{", "final", "XMLInputFactory", "instance", "=", "(", "XMLInputFactory", ")", "Class", ".", "forName", "(", "\"", "com", ".", "sun", ".", "xml", ".", "internal", ".", "stream", ".", "XMLInputFactoryImpl", "\"", ").", "newInstance", "(", ");", "instance", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "instance", ";", "}", "catch", "(", "final", "InstantiationException", "e", ")", "{", "exception", "=", "e", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "exception", "=", "e", ";", "@", "@", "-", "1", ",", "11", "+", "1", ",", "11", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2013", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2013", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "*", "style", "license", "a", "copy", "of", "which", "has", "been", "included", "with", "this", "distribution", "in", "*", "the", "LICENSE", ".", "txt", "file", ".", "*", "*", "*", "Created", "on", "27", ".", "July", "2013", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "xml", ";", "@", "@", "-", "28", ",", "7", "+", "28", ",", "7", "@", "@", "*", "implementations", "configured", "in", "<", "em", ">", "lib", "/", "stax", ".", "properties", "<", "/", "em", ">", "or", "registered", "with", "the", "Service", "*", "API", ".", "*", "<", "/", "p", ">", "*", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "1", ".", "4", ".", "5", "*", "/", "@", "@", "-", "75", ",", "7", "+", "75", ",", "9", "@", "@", "protected", "XMLInputFactory", "createInputFactory", "(", ")", "{", "try", "{", "Class", "staxInputFactory", "=", "JVM", ".", "getStaxInputFactory", "(", ");", "if", "(", "staxInputFactory", "!", "=", "null", ")", "{", "return", "(", "XMLInputFactory", ")", "staxInputFactory", ".", "newInstance", "(", ");", "final", "XMLInputFactory", "instance", "=", "(", "XMLInputFactory", ")", "staxInputFactory", ".", "newInstance", "(", ");", "instance", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "instance", ";", "}", "else", "{", "throw", "new", "StreamException", "(", "\"", "Java", "runtime", "has", "no", "standard", "XMLInputFactory", "implementation", ".", "\",", "exception", ")", ";", "}", "@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2004", ",", "2005", ",", "2006", "Joe", "Walnes", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2009", ",", "2011", ",", "2013", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2009", ",", "2011", ",", "2013", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "238", ",", "7", "+", "238", ",", "9", "@", "@", "protected", "XMLStreamReader", "createParser", "(", "Source", "source", ")", "throws", "XMLStreamException", "*", "@", "since", "1", ".", "4", "*", "/", "protected", "XMLInputFactory", "createInputFactory", "(", ")", "{", "return", "XMLInputFactory", ".", "newInstance", "(", ");", "final", "XMLInputFactory", "instance", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "instance", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "instance", ";", "}", "/", "**", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2009", ",", "2011", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2009", ",", "2011", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "62", ",", "7", "+", "62", ",", "9", "@", "@", "public", "WstxDriver", "(", "NameCoder", "nameCoder", ")", "{", "}", "protected", "XMLInputFactory", "createInputFactory", "(", ")", "{", "return", "new", "WstxInputFactory", "(", ");", "final", "XMLInputFactory", "instance", "=", "new", "WstxInputFactory", "(", ");", "instance", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "instance", ";", "}", "protected", "XMLOutputFactory", "createOutputFactory", "(", ")", "{"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "295", ",", "9", "+", "295", ",", "12", "@", "@", "struct", "svc_rqst", "{", "struct", "svc_cacherep", "*", "rq_cacherep", ";", "/", "*", "cache", "info", "*", "/", "struct", "task_struct", "*", "rq_task", ";", "/", "*", "service", "thread", "*", "/", "spinlock_t", "rq_lock", ";", "/", "*", "per", "-", "request", "lock", "*", "/", "struct", "net", "*", "rq_bc_net", ";", "/", "*", "pointer", "to", "backchannel", "'", "s", "*", "net", "namespace", "*", "/", "}", ";", "#", "define", "SVC_NET", "(", "svc_rqst", ")", "(", "svc_rqst", "-", ">", "rq_xprt", "-", ">", "xpt_net", ")", "#", "define", "SVC_NET", "(", "rqst", ")", "(", "rqst", "-", ">", "rq_xprt", "?", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_net", ":", "rqst", "-", ">", "rq_bc_net", ")", "/", "*", "*", "Rigorous", "type", "checking", "on", "sockaddr", "type", "conversions", "@", "@", "-", "569", ",", "15", "+", "569", ",", "17", "@", "@", "TRACE_EVENT", "(", "svc_process", ",", "__field", "(", "u32", ",", "vers", ")", "__field", "(", "u32", ",", "proc", ")", "__string", "(", "service", ",", "name", ")", "__string", "(", "addr", ",", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_remotebuf", ")", "__string", "(", "addr", ",", "rqst", "-", ">", "rq_xprt", "?", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_remotebuf", ":", "\"", "(", "null", ")", "\")", ")", ",", "TP_fast_assign", "(", "__entry", "-", ">", "xid", "=", "be32_to_cpu", "(", "rqst", "-", ">", "rq_xid", ")", ";", "__entry", "-", ">", "vers", "=", "rqst", "-", ">", "rq_vers", ";", "__entry", "-", ">", "proc", "=", "rqst", "-", ">", "rq_proc", ";", "__assign_str", "(", "service", ",", "name", ")", ";", "__assign_str", "(", "addr", ",", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_remotebuf", ")", ";", "__assign_str", "(", "addr", ",", "rqst", "-", ">", "rq_xprt", "?", "rqst", "-", ">", "rq_xprt", "-", ">", "xpt_remotebuf", ":", "\"", "(", "null", ")", "\")", ";", ")", ",", "TP_printk", "(", "\"", "addr", "=", "%", "s", "xid", "=", "0x", "%", "08x", "service", "=", "%", "s", "vers", "=", "%", "u", "proc", "=", "%", "u", "\"", ",", "@", "@", "-", "1172", ",", "7", "+", "1172", ",", "8", "@", "@", "svc_process_common", "(", "struct", "svc_rqst", "*", "rqstp", ",", "struct", "kvec", "*", "argv", ",", "struct", "kvec", "*", "resv", ")", "clear_bit", "(", "RQ_DROPME", ",", "&", "rqstp", "-", ">", "rq_flags", ")", ";", "/", "*", "Setup", "reply", "header", "*", "/", "rqstp", "-", ">", "rq_xprt", "-", ">", "xpt_ops", "-", ">", "xpo_prep_reply_hdr", "(", "rqstp", ")", ";", "if", "(", "rqstp", "-", ">", "rq_prot", "=", "=", "IPPROTO_TCP", ")", "svc_tcp_prep_reply_hdr", "(", "rqstp", ")", ";", "svc_putu32", "(", "resv", ",", "rqstp", "-", ">", "rq_xid", ")", ";", "@", "@", "-", "1244", ",", "7", "+", "1245", ",", "7", "@", "@", "svc_process_common", "(", "struct", "svc_rqst", "*", "rqstp", ",", "struct", "kvec", "*", "argv", ",", "struct", "kvec", "*", "resv", ")", "*", "for", "lower", "versions", ".", "RPC_PROG_MISMATCH", "seems", "to", "be", "the", "closest", "*", "fit", ".", "*", "/", "if", "(", "versp", "-", ">", "vs_need_cong_ctrl", "&", "&", "if", "(", "versp", "-", ">", "vs_need_cong_ctrl", "&", "&", "rqstp", "-", ">", "rq_xprt", "&", "&", "!", "test_bit", "(", "XPT_CONG_CTRL", ",", "&", "rqstp", "-", ">", "rq_xprt", "-", ">", "xpt_flags", ")", ")", "goto", "err_bad_vers", ";", "@", "@", "-", "1336", ",", "7", "+", "1337", ",", "7", "@", "@", "svc_process_common", "(", "struct", "svc_rqst", "*", "rqstp", ",", "struct", "kvec", "*", "argv", ",", "struct", "kvec", "*", "resv", ")", "return", "0", ";", "close", ":", "if", "(", "test_bit", "(", "XPT_TEMP", ",", "&", "rqstp", "-", ">", "rq_xprt", "-", ">", "xpt_flags", ")", ")", "if", "(", "rqstp", "-", ">", "rq_xprt", "&", "&", "test_bit", "(", "XPT_TEMP", ",", "&", "rqstp", "-", ">", "rq_xprt", "-", ">", "xpt_flags", ")", ")", "svc_close_xprt", "(", "rqstp", "-", ">", "rq_xprt", ")", ";", "dprintk", "(", "\"", "svc", ":", "svc_process", "close", "\\", "n", "\"", ");", "return", "0", ";", "@", "@", "-", "1459", ",", "10", "+", "1460", ",", "10", "@", "@", "bc_svc_process", "(", "struct", "svc_serv", "*", "serv", ",", "struct", "rpc_rqst", "*", "req", ",", "dprintk", "(", "\"", "svc", ":", "%", "s", "(", "%", "p", ")", "\\", "n", "\"", ",", "__func__", ",", "req", ")", ";", "/", "*", "Build", "the", "svc_rqst", "used", "by", "the", "common", "processing", "routine", "*", "/", "rqstp", "-", ">", "rq_xprt", "=", "serv", "-", ">", "sv_bc_xprt", ";", "rqstp", "-", ">", "rq_xid", "=", "req", "-", ">", "rq_xid", ";", "rqstp", "-", ">", "rq_prot", "=", "req", "-", ">", "rq_xprt", "-", ">", "prot", ";", "rqstp", "-", ">", "rq_server", "=", "serv", ";", "rqstp", "-", ">", "rq_bc_net", "=", "req", "-", ">", "rq_xprt", "-", ">", "xprt_net", ";", "rqstp", "-", ">", "rq_addrlen", "=", "sizeof", "(", "req", "-", ">", "rq_xprt", "-", ">", "addr", ")", ";", "memcpy", "(", "&", "rqstp", "-", ">", "rq_addr", ",", "&", "req", "-", ">", "rq_xprt", "-", ">", "addr", ",", "rqstp", "-", ">", "rq_addrlen", ")", ";", "@", "@", "-", "468", ",", "10", "+", "468", ",", "11", "@", "@", "static", "struct", "svc_xprt", "*", "svc_xprt_dequeue", "(", "struct", "svc_pool", "*", "pool", ")", "*", "/", "void", "svc_reserve", "(", "struct", "svc_rqst", "*", "rqstp", ",", "int", "space", ")", "{", "struct", "svc_xprt", "*", "xprt", "=", "rqstp", "-", ">", "rq_xprt", ";", "space", "+", "=", "rqstp", "-", ">", "rq_res", ".", "head", "[", "0", "]", ".", "iov_len", ";", "if", "(", "space", "<", "rqstp", "-", ">", "rq_reserved", ")", "{", "struct", "svc_xprt", "*", "xprt", "=", "rqstp", "-", ">", "rq_xprt", ";", "if", "(", "xprt", "&", "&", "space", "<", "rqstp", "-", ">", "rq_reserved", ")", "{", "atomic_sub", "(", "(", "rqstp", "-", ">", "rq_reserved", "-", "space", ")", ",", "&", "xprt", "-", ">", "xpt_reserved", ")", ";", "rqstp", "-", ">", "rq_reserved", "=", "space", ";", "@", "@", "-", "1173", ",", "7", "+", "1173", ",", "7", "@", "@", "static", "int", "svc_tcp_sendto", "(", "struct", "svc_rqst", "*", "rqstp", ")", "/", "*", "*", "Setup", "response", "header", ".", "TCP", "has", "a", "4B", "record", "length", "field", ".", "*", "/", "static", "void", "svc_tcp_prep_reply_hdr", "(", "struct", "svc_rqst", "*", "rqstp", ")", "void", "svc_tcp_prep_reply_hdr", "(", "struct", "svc_rqst", "*", "rqstp", ")", "{", "struct", "kvec", "*", "resv", "=", "&", "rqstp", "-", ">", "rq_res", ".", "head", "[", "0", "]", ";"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "43", ",", "6", "+", "43", ",", "7", "@", "@", "import", "javax", ".", "servlet", ".", "ServletContext", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "@", "@", "-", "332", ",", "27", "+", "333", ",", "34", "@", "@", "protected", "Result", "findResult", "(", "String", "path", ",", "String", "resultCode", ",", "String", "ext", ",", "ActionCo", "Map", "<", "String", ",", "ResultTypeConfig", ">", "resultsByExtension", ")", "{", "try", "{", "boolean", "traceEnabled", "=", "LOG", ".", "isTraceEnabled", "(", ");", "if", "(", "traceEnabled", ")", "if", "(", "traceEnabled", ")", "{", "LOG", ".", "trace", "(", "\"", "Checking", "ServletContext", "for", "[", "#", "0", "]", "\",", "path", ")", ";", "}", "if", "(", "servletContext", ".", "getResource", "(", "path", ")", "!", "=", "null", ")", "{", "if", "(", "traceEnabled", ")", "LOG", ".", "trace", "(", "\"", "Found", "\"", ");", "URL", "resource", "=", "servletContext", ".", "getResource", "(", "path", ")", ";", "if", "(", "resource", "!", "=", "null", "&", "&", "resource", ".", "getPath", "(", ").", "endsWith", "(", "path", ")", ")", "{", "if", "(", "traceEnabled", ")", "{", "LOG", ".", "trace", "(", "\"", "Found", "resource", "#", "0", "\"", ",", "resource", ")", ";", "}", "return", "buildResult", "(", "path", ",", "resultCode", ",", "resultsByExtension", ".", "get", "(", "ext", ")", ",", "actionContext", ")", ";", "}", "if", "(", "traceEnabled", ")", "LOG", ".", "trace", "(", "\"", "Checking", "ClasLoader", "for", "#", "0", "\"", ",", "path", ")", ";", "if", "(", "traceEnabled", ")", "{", "LOG", ".", "trace", "(", "\"", "Checking", "ClassLoader", "for", "#", "0", "\"", ",", "path", ")", ";", "}", "String", "classLoaderPath", "=", "path", ".", "startsWith", "(", "\"/", "\")", "?", "path", ".", "substring", "(", "1", ",", "path", ".", "length", "(", "))", ":", "path", ";", "if", "(", "ClassLoaderUtil", ".", "getResource", "(", "classLoaderPath", ",", "getClass", "(", "))", "!", "=", "null", ")", "{", "if", "(", "traceEnabled", ")", "LOG", ".", "trace", "(", "\"", "Found", "\"", ");", "resource", "=", "ClassLoaderUtil", ".", "getResource", "(", "classLoaderPath", ",", "getClass", "(", "))", ";", "if", "(", "resource", "!", "=", "null", "&", "&", "resource", ".", "getPath", "(", ").", "endsWith", "(", "classLoaderPath", ")", ")", "{", "if", "(", "traceEnabled", ")", "{", "LOG", ".", "trace", "(", "\"", "Found", "resource", "#", "0", "\"", ",", "resource", ")", ";", "}", "return", "buildResult", "(", "path", ",", "resultCode", ",", "resultsByExtension", ".", "get", "(", "ext", ")", ",", "actionContext", ")", ";", "}", "}", "catch", "(", "MalformedURLException", "e", ")", "{", "if", "(", "LOG", ".", "isErrorEnabled", "(", "))", "if", "(", "LOG", ".", "isErrorEnabled", "(", "))", "{", "LOG", ".", "error", "(", "\"", "Unable", "to", "parse", "template", "path", ":", "[", "#", "0", "]", "skipping", ".", "..", "\",", "path", ")", ";", "}", "}", "return", "null", ";"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "68", ",", "7", "+", "68", ",", "7", "@", "@", "private", "String", "enableFeatures", ";", "private", "String", "disableFeatures", ";", "private", "boolean", "enableJacksonTypeConverter", ";", "private", "boolean", "allowJacksonUnmarshallType", ";", "private", "boolean", "allowUnmarshallType", ";", "/", "**", "*", "Use", "the", "default", "Jackson", "{", "@", "link", "ObjectMapper", "}", "and", "{", "@", "link", "Object", "}", "@", "@", "-", "160", ",", "7", "+", "160", ",", "7", "@", "@", "public", "Object", "unmarshal", "(", "Exchange", "exchange", ",", "InputStream", "stream", ")", "throws", "Exception", "/", "/", "is", "there", "a", "header", "with", "the", "unmarshal", "type", "?", "Class", "<", "?>", "clazz", "=", "unmarshalType", ";", "String", "type", "=", "null", ";", "if", "(", "allowJacksonUnmarshallType", ")", "{", "if", "(", "allowUnmarshallType", ")", "{", "type", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "JacksonConstants", ".", "UNMARSHAL_TYPE", ",", "String", ".", "class", ")", ";", "}", "if", "(", "type", "=", "=", "null", "&", "&", "isAllowJmsType", "(", "))", "{", "@", "@", "-", "331", ",", "17", "+", "331", ",", "17", "@", "@", "public", "void", "setEnableJacksonTypeConverter", "(", "boolean", "enableJacksonTypeConverter", ")", "{", "this", ".", "enableJacksonTypeConverter", "=", "enableJacksonTypeConverter", ";", "}", "public", "boolean", "isAllowJacksonUnmarshallType", "(", ")", "{", "return", "allowJacksonUnmarshallType", ";", "public", "boolean", "isAllowUnmarshallType", "(", ")", "{", "return", "allowUnmarshallType", ";", "}", "/", "**", "*", "If", "enabled", "then", "Jackson", "is", "allowed", "to", "attempt", "to", "use", "the", "CamelJacksonUnmarshalType", "header", "during", "the", "unmarshalling", ".", "*", "<", "p", "/", ">", "*", "This", "should", "only", "be", "enabled", "when", "desired", "to", "be", "used", ".", "*", "/", "public", "void", "setAllowJacksonUnmarshallType", "(", "boolean", "allowJacksonUnmarshallType", ")", "{", "this", ".", "allowJacksonUnmarshallType", "=", "allowJacksonUnmarshallType", ";", "public", "void", "setAllowUnmarshallType", "(", "boolean", "allowJacksonUnmarshallType", ")", "{", "this", ".", "allowUnmarshallType", "=", "allowJacksonUnmarshallType", ";", "}", "public", "String", "getEnableFeatures", "(", ")", "{", "@", "@", "-", "46", ",", "7", "+", "46", ",", "7", "@", "@", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "JacksonDataFormat", "format", "=", "new", "JacksonDataFormat", "(", ");", "format", ".", "setAllowJacksonUnmarshallType", "(", "true", ")", ";", "format", ".", "setAllowUnmarshallType", "(", "true", ")", ";", "from", "(", "\"", "direct", ":", "backPojo", "\"", ").", "unmarshal", "(", "format", ")", ".", "to", "(", "\"", "mock", ":", "reversePojo", "\"", ");"], "docstring_tokens": ["object", "de-serialization"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "776", ",", "7", "+", "776", ",", "7", "@", "@", "static", "int", "catc_probe", "(", "struct", "usb_interface", "*", "intf", ",", "const", "struct", "usb_device_id", "*", "id", "struct", "net_device", "*", "netdev", ";", "struct", "catc", "*", "catc", ";", "u8", "broadcast", "[", "ETH_ALEN", "]", ";", "int", "i", ",", "pktsz", ",", "ret", ";", "int", "pktsz", ",", "ret", ";", "if", "(", "usb_set_interface", "(", "usbdev", ",", "intf", "-", ">", "altsetting", "-", ">", "desc", ".", "bInterfaceNumber", ",", "1", ")", ")", "{", "@", "@", "-", "840", ",", "15", "+", "840", ",", "24", "@", "@", "static", "int", "catc_probe", "(", "struct", "usb_interface", "*", "intf", ",", "const", "struct", "usb_device_id", "*", "id", "catc", "-", ">", "irq_buf", ",", "2", ",", "catc_irq_done", ",", "catc", ",", "1", ")", ";", "if", "(", "!", "catc", "-", ">", "is_f5u011", ")", "{", "u32", "*", "buf", ";", "int", "i", ";", "dev_dbg", "(", "dev", ",", "\"", "Checking", "memory", "size", "\\", "n", "\"", ");", "i", "=", "0x12345678", ";", "catc_write_mem", "(", "catc", ",", "0x7a80", ",", "&", "i", ",", "4", ")", ";", "i", "=", "0x87654321", ";", "catc_write_mem", "(", "catc", ",", "0xfa80", ",", "&", "i", ",", "4", ")", ";", "catc_read_mem", "(", "catc", ",", "0x7a80", ",", "&", "i", ",", "4", ")", ";", "buf", "=", "kmalloc", "(", "4", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "buf", ")", "{", "ret", "=", "-", "ENOMEM", ";", "goto", "fail_free", ";", "}", "*", "buf", "=", "0x12345678", ";", "catc_write_mem", "(", "catc", ",", "0x7a80", ",", "buf", ",", "4", ")", ";", "*", "buf", "=", "0x87654321", ";", "catc_write_mem", "(", "catc", ",", "0xfa80", ",", "buf", ",", "4", ")", ";", "catc_read_mem", "(", "catc", ",", "0x7a80", ",", "buf", ",", "4", ")", ";", "switch", "(", "i", ")", "{", "switch", "(", "*", "buf", ")", "{", "case", "0x12345678", ":", "catc_set_reg", "(", "catc", ",", "TxBufCount", ",", "8", ")", ";", "catc_set_reg", "(", "catc", ",", "RxBufCount", ",", "32", ")", ";", "@", "@", "-", "863", ",", "6", "+", "872", ",", "8", "@", "@", "static", "int", "catc_probe", "(", "struct", "usb_interface", "*", "intf", ",", "const", "struct", "usb_device_id", "*", "id", "dev_dbg", "(", "dev", ",", "\"", "32k", "Memory", "\\", "n", "\"", ");", "break", ";", "}", "kfree", "(", "buf", ")", ";", "dev_dbg", "(", "dev", ",", "\"", "Getting", "MAC", "from", "SEEROM", ".", "\\", "n", "\"", ");"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "6488", ",", "9", "+", "6488", ",", "6", "@", "@", "struct", "swevent_htable", "{", "/", "*", "Recursion", "avoidance", "in", "each", "contexts", "*", "/", "int", "recursion", "[", "PERF_NR_CONTEXTS", "]", ";", "/", "*", "Keeps", "track", "of", "cpu", "being", "initialized", "/", "exited", "*", "/", "bool", "online", ";", "}", ";", "static", "DEFINE_PER_CPU", "(", "struct", "swevent_htable", ",", "swevent_htable", ")", ";", "@", "@", "-", "6748", ",", "14", "+", "6745", ",", "8", "@", "@", "static", "int", "perf_swevent_add", "(", "struct", "perf_event", "*", "event", ",", "int", "flags", ")", "hwc", "-", ">", "state", "=", "!", "(", "flags", "&", "PERF_EF_START", ")", ";", "head", "=", "find_swevent_head", "(", "swhash", ",", "event", ")", ";", "if", "(", "!", "head", ")", "{", "/", "*", "*", "We", "can", "race", "with", "cpu", "hotplug", "code", ".", "Do", "not", "*", "WARN", "if", "the", "cpu", "just", "got", "unplugged", ".", "*", "/", "WARN_ON_ONCE", "(", "swhash", "-", ">", "online", ")", ";", "if", "(", "WARN_ON_ONCE", "(", "!", "head", ")", ")", "return", "-", "EINVAL", ";", "}", "hlist_add_head_rcu", "(", "&", "event", "-", ">", "hlist_entry", ",", "head", ")", ";", "perf_event_update_userpage", "(", "event", ")", ";", "@", "@", "-", "6823", ",", "7", "+", "6814", ",", "6", "@", "@", "static", "int", "swevent_hlist_get_cpu", "(", "struct", "perf_event", "*", "event", ",", "int", "cpu", ")", "int", "err", "=", "0", ";", "mutex_lock", "(", "&", "swhash", "-", ">", "hlist_mutex", ")", ";", "if", "(", "!", "swevent_hlist_deref", "(", "swhash", ")", "&", "&", "cpu_online", "(", "cpu", ")", ")", "{", "struct", "swevent_hlist", "*", "hlist", ";", "@", "@", "-", "9286", ",", "7", "+", "9276", ",", "6", "@", "@", "static", "void", "perf_event_init_cpu", "(", "int", "cpu", ")", "struct", "swevent_htable", "*", "swhash", "=", "&", "per_cpu", "(", "swevent_htable", ",", "cpu", ")", ";", "mutex_lock", "(", "&", "swhash", "-", ">", "hlist_mutex", ")", ";", "swhash", "-", ">", "online", "=", "true", ";", "if", "(", "swhash", "-", ">", "hlist_refcount", ">", "0", ")", "{", "struct", "swevent_hlist", "*", "hlist", ";", "@", "@", "-", "9328", ",", "14", "+", "9317", ",", "7", "@", "@", "static", "void", "perf_event_exit_cpu_context", "(", "int", "cpu", ")", "static", "void", "perf_event_exit_cpu", "(", "int", "cpu", ")", "{", "struct", "swevent_htable", "*", "swhash", "=", "&", "per_cpu", "(", "swevent_htable", ",", "cpu", ")", ";", "perf_event_exit_cpu_context", "(", "cpu", ")", ";", "mutex_lock", "(", "&", "swhash", "-", ">", "hlist_mutex", ")", ";", "swhash", "-", ">", "online", "=", "false", ";", "swevent_hlist_release", "(", "swhash", ")", ";", "mutex_unlock", "(", "&", "swhash", "-", ">", "hlist_mutex", ")", ";", "}", "#", "else", "static", "inline", "void", "perf_event_exit_cpu", "(", "int", "cpu", ")", "{", "}"], "docstring_tokens": ["data", "structure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1819", ",", "6", "+", "1819", ",", "14", "@", "@", "aiptek_probe", "(", "struct", "usb_interface", "*", "intf", ",", "const", "struct", "usb_device_id", "*", "id", ")", "input_set_abs_params", "(", "inputdev", ",", "ABS_TILT_Y", ",", "AIPTEK_TILT_MIN", ",", "AIPTEK_TILT_MAX", ",", "0", ",", "0", ")", ";", "input_set_abs_params", "(", "inputdev", ",", "ABS_WHEEL", ",", "AIPTEK_WHEEL_MIN", ",", "AIPTEK_WHEEL_MAX", "-", "1", ",", "0", ",", "0", ")", ";", "/", "*", "Verify", "that", "a", "device", "really", "has", "an", "endpoint", "*", "/", "if", "(", "intf", "-", ">", "altsetting", "[", "0", "]", ".", "desc", ".", "bNumEndpoints", "<", "1", ")", "{", "dev_err", "(", "&", "intf", "-", ">", "dev", ",", "\"", "interface", "has", "%", "d", "endpoints", ",", "but", "must", "have", "minimum", "1", "\\", "n", "\"", ",", "intf", "-", ">", "altsetting", "[", "0", "]", ".", "desc", ".", "bNumEndpoints", ")", ";", "err", "=", "-", "EINVAL", ";", "goto", "fail3", ";", "}", "endpoint", "=", "&", "intf", "-", ">", "altsetting", "[", "0", "]", ".", "endpoint", "[", "0", "]", ".", "desc", ";", "/", "*", "Go", "set", "up", "our", "URB", ",", "which", "is", "called", "when", "the", "tablet", "receives", "@", "@", "-", "1861", ",", "6", "+", "1869", ",", "7", "@", "@", "aiptek_probe", "(", "struct", "usb_interface", "*", "intf", ",", "const", "struct", "usb_device_id", "*", "id", ")", "if", "(", "i", "=", "=", "ARRAY_SIZE", "(", "speeds", ")", ")", "{", "dev_info", "(", "&", "intf", "-", ">", "dev", ",", "\"", "Aiptek", "tried", "all", "speeds", ",", "no", "sane", "response", "\\", "n", "\"", ");", "err", "=", "-", "EINVAL", ";", "goto", "fail3", ";", "}"], "docstring_tokens": ["nullpointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2369", ",", "7", "+", "2369", ",", "7", "@", "@", "static", "void", "pkt_release_dev", "(", "struct", "pktcdvd_device", "*", "pd", ",", "int", "flush", ")", "pkt_shrink_pktlist", "(", "pd", ")", ";", "}", "static", "struct", "pktcdvd_device", "*", "pkt_find_dev_from_minor", "(", "int", "dev_minor", ")", "static", "struct", "pktcdvd_device", "*", "pkt_find_dev_from_minor", "(", "unsigned", "int", "dev_minor", ")", "{", "if", "(", "dev_minor", ">", "=", "MAX_WRITERS", ")", "return", "NULL", ";"], "docstring_tokens": ["kernel", "memory", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "18", ",", "7", "+", "18", ",", "7", "@", "@", "Once", "done", ",", "just", "include", "the", "jar", "(", "s", ")", "in", "your", "project", "'", "s", "build", "path", ".", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "wicket", "-", "jquery", "-", "ui", "<", "/", "groupId", ">", "<", "artifactId", ">", "wicket", "-", "jquery", "-", "ui", "<", "/", "artifactId", ">", "<", "version", ">", "6", ".", "27", ".", "0", "<", "/", "version", ">", "<", "version", ">", "6", ".", "28", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "`", "``", "@", "@", "-", "48", ",", "6", "+", "48", ",", "7", "@", "@", "If", "the", "version", "you", "specified", "is", "*", "snapshot", "*", ",", "you", "might", "define", "this", "repository", ":", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "0", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "0", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "1", ".", "12", ".", "1", "<", "/", "td", ">", "</", "tr", ">", "@", "@", "-", "94", ",", "6", "+", "95", ",", "7", "@", "@", "If", "the", "version", "you", "specified", "is", "*", "snapshot", "*", ",", "you", "might", "define", "this", "repository", ":", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M3", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1118", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M2", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1028", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "8", ".", "0", ".", "0", "-", "M1", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "2", ".", "714", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "9", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "2", ".", "621", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "8", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "2", ".", "621", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "7", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2017", ".", "1", ".", "223", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "<", "tr", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "7", ".", "6", ".", "0", "<", "/", "td", ">", "<", "td", ">", "2016", ".", "3", ".", "1118", "(", "ASFv2", ")", "</", "td", ">", "</", "tr", ">", "@", "@", "-", "140", ",", "7", "+", "142", ",", "7", "@", "@", "To", "use", "wicket", "-", "jquery", "-", "ui", "with", "a", "standard", "theme", ",", "just", "add", "the", "corresponding", "theme", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "wicket", "-", "jquery", "-", "ui", "<", "/", "groupId", ">", "<", "artifactId", ">", "wicket", "-", "jquery", "-", "ui", "-", "theme", "-", "uilightness", "<", "/", "artifactId", ">", "<", "version", ">", "6", ".", "27", ".", "0", "<", "/", "version", ">", "<", "version", ">", "6", ".", "28", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "`", "``", "@", "@", "-", "156", ",", "7", "+", "158", ",", "7", "@", "@", "To", "use", "wicket", "-", "kendo", "-", "ui", "with", "a", "standard", "theme", ",", "just", "add", "the", "corresponding", "theme", "d", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "googlecode", ".", "wicket", "-", "jquery", "-", "ui", "<", "/", "groupId", ">", "<", "artifactId", ">", "wicket", "-", "kendo", "-", "ui", "-", "theme", "-", "default", "<", "/", "artifactId", ">", "<", "version", ">", "6", ".", "27", ".", "0", "<", "/", "version", ">", "<", "version", ">", "6", ".", "28", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "`", "``", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "/", "**", "*", "Utility", "class", "for", "handling", "feedback", "session", "messages", "and", "feedback", "ajax", "messages", ".", "<", "br", ">", "*", "The", "hosting", "page", "should", "implement", "a", "code", "like", ":", "*", "*", "<", "pre", ">", "*", "<", "code", ">", "*", "public", "void", "onEvent", "(", "IEvent", "&", "lt", ";", "?&", "gt", ";", "event", ")", "@", "@", "-", "1", ",", "7", "+", "1", ",", "6", "@", "@", "/", "/!", "moment", ".", "js", "/", "/!", "version", ":", "2", ".", "8", ".", "4", "/", "/!", "version", ":", "2", ".", "19", ".", "3", "/", "/!", "authors", ":", "Tim", "Wood", ",", "Iskren", "Chernev", ",", "Moment", ".", "js", "contributors", "/", "/!", "license", ":", "MIT", "/", "/!", "momentjs", ".", "com", "(", "function", "(", "a", ")", "{", "function", "b", "(", "a", ",", "b", ",", "c", ")", "{", "switch", "(", "arguments", ".", "length", ")", "{", "case", "2", ":", "return", "null", "!", "=", "a", "?", "a", ":", "b", ";", "case", "3", ":", "return", "null", "!", "=", "a", "?", "a", ":", "null", "!", "=", "b", "?", "b", ":", "c", ";", "default", ":", "throw", "new", "Error", "(", "\"", "Implement", "me", "\"", ")}", "}", "function", "c", "(", "a", ",", "b", ")", "{", "return", "zb", ".", "call", "(", "a", ",", "b", ")", "}", "function", "d", "(", "){", "return", "{", "empty", ":", "!", "1", ",", "unusedTokens", ":", "[]", ",", "unusedInput", ":", "[]", ",", "overflow", ":", "-", "2", ",", "charsLeftOver", ":", "0", ",", "nullInput", ":", "!", "1", ",", "invalidMonth", ":", "null", ",", "invalidFormat", ":", "!", "1", ",", "userInvalidated", ":", "!", "1", ",", "iso", ":", "!", "1", "}", "}", "function", "e", "(", "a", ")", "{", "tb", ".", "suppressDeprecationWarnings", "=", "==", "!", "1", "&", "&\"", "undefined", "\"", "!=", "typeof", "console", "&", "&", "console", ".", "warn", "&", "&", "console", ".", "warn", "(", "\"", "Deprecation", "warning", ":", "\"", "+", "a", ")", "}", "function", "f", "(", "a", ",", "b", ")", "{", "var", "c", "=", "!", "0", ";", "return", "m", "(", "function", "(", "){", "return", "c", "&", "&(", "e", "(", "a", ")", ",", "c", "=", "!", "1", ")", ",", "b", ".", "apply", "(", "this", ",", "arguments", ")", "},", "b", ")", "}", "function", "g", "(", "a", ",", "b", ")", "{", "qc", "[", "a", "]", "||", "(", "e", "(", "b", ")", ",", "qc", "[", "a", "]", "=!", "0", ")", "}", "function", "h", "(", "a", ",", "b", ")", "{", "return", "function", "(", "c", ")", "{", "return", "p", "(", "a", ".", "call", "(", "this", ",", "c", ")", ",", "b", ")", "}}", "function", "i", "(", "a", ",", "b", ")", "{", "return", "function", "(", "c", ")", "{", "return", "this", ".", "localeData", "(", ").", "ordinal", "(", "a", ".", "call", "(", "this", ",", "c", ")", ",", "b", ")", "}}", "function", "j", "(", "){", "}", "function", "k", "(", "a", ",", "b", ")", "{", "b", "!", "==", "!", "1", "&", "&", "F", "(", "a", ")", ",", "n", "(", "this", ",", "a", ")", ",", "this", ".", "_d", "=", "new", "Date", "(", "+", "a", ".", "_d", ")", "}", "function", "l", "(", "a", ")", "{", "var", "b", "=", "y", "(", "a", ")", ",", "c", "=", "b", ".", "year", "|", "|", "0", ",", "d", "=", "b", ".", "quarter", "|", "|", "0", ",", "e", "=", "b", ".", "month", "|", "|", "0", ",", "f", "=", "b", ".", "week", "|", "|", "0", ",", "g", "=", "b", ".", "day", "|", "|", "0", ",", "h", "=", "b", ".", "hour", "|", "|", "0", ",", "i", "=", "b", ".", "minute", "|", "|", "0", ",", "j", "=", "b", ".", "second", "|", "|", "0", ",", "k", "=", "b", ".", "millisecond", "|", "|", "0", ";", "this", ".", "_milliseconds", "=", "+", "k", "+", "1e3", "*", "j", "+", "6e4", "*", "i", "+", "36e5", "*", "h", ",", "this", ".", "_days", "=", "+", "g", "+", "7", "*", "f", ",", "this", ".", "_months", "=", "+", "e", "+", "3", "*", "d", "+", "12", "*", "c", ",", "this", ".", "_data", "=", "{}", ",", "this", ".", "_locale", "=", "tb", ".", "localeData", "(", "),", "this", ".", "_bubble", "(", ")}", "function", "m", "(", "a", ",", "b", ")", "{", "for", "(", "var", "d", "in", "b", ")", "c", "(", "b", ",", "d", ")", "&&", "(", "a", "[", "d", "]", "=", "b", "[", "d", "]", ");", "return", "c", "(", "b", ",", "\"", "toString", "\"", ")&", "&(", "a", ".", "toString", "=", "b", ".", "toString", ")", ",", "c", "(", "b", ",", "\"", "valueOf", "\"", ")&", "&(", "a", ".", "valueOf", "=", "b", ".", "valueOf", ")", ",", "a", "}", "function", "n", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", ",", "e", ";", "if", "(", "\"", "undefined", "\"", "!=", "typeof", "b", ".", "_isAMomentObject", "&", "&(", "a", ".", "_isAMomentObject", "=", "b", ".", "_isAMomentObject", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_i", "&", "&(", "a", ".", "_i", "=", "b", ".", "_i", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_f", "&", "&(", "a", ".", "_f", "=", "b", ".", "_f", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_l", "&", "&(", "a", ".", "_l", "=", "b", ".", "_l", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_strict", "&", "&(", "a", ".", "_strict", "=", "b", ".", "_strict", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_tzm", "&", "&(", "a", ".", "_tzm", "=", "b", ".", "_tzm", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_isUTC", "&", "&(", "a", ".", "_isUTC", "=", "b", ".", "_isUTC", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_offset", "&", "&(", "a", ".", "_offset", "=", "b", ".", "_offset", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_pf", "&", "&(", "a", ".", "_pf", "=", "b", ".", "_pf", ")", ",\"", "undefined", "\"", "!=", "typeof", "b", ".", "_locale", "&", "&(", "a", ".", "_locale", "=", "b", ".", "_locale", ")", ",", "Ib", ".", "length", ">", "0", ")", "for", "(", "c", "in", "Ib", ")", "d", "=", "Ib", "[", "c", "]", ",", "e", "=", "b", "[", "d", "]", ",\"", "undefined", "\"", "!=", "typeof", "e", "&", "&(", "a", "[", "d", "]", "=", "e", ")", ";", "return", "a", "}", "function", "o", "(", "a", ")", "{", "return", "0", ">", "a", "?", "Math", ".", "ceil", "(", "a", ")", ":", "Math", ".", "floor", "(", "a", ")", "}", "function", "p", "(", "a", ",", "b", ",", "c", ")", "{", "for", "(", "var", "d", "=", "\"\"", "+", "Math", ".", "abs", "(", "a", ")", ",", "e", "=", "a", ">", "=", "0", ";", "d", ".", "length", "<", "b", ";", ")", "d", "=", "\"", "0", "\"", "+", "d", ";", "return", "(", "e", "?", "c", "?", "\"+", "\":", "\"\"", ":\"", "-\"", ")+", "d", "}", "function", "q", "(", "a", ",", "b", ")", "{", "var", "c", "=", "{", "milliseconds", ":", "0", ",", "months", ":", "0", "}", ";", "return", "c", ".", "months", "=", "b", ".", "month", "(", ")-", "a", ".", "month", "(", ")+", "12", "*", "(", "b", ".", "year", "(", ")-", "a", ".", "year", "(", "))", ",", "a", ".", "clone", "(", ").", "add", "(", "c", ".", "months", ",", "\"", "M", "\"", ").", "isAfter", "(", "b", ")", "&&", "--", "c", ".", "months", ",", "c", ".", "milliseconds", "=", "+", "b", "-", "+", "a", ".", "clone", "(", ").", "add", "(", "c", ".", "months", ",", "\"", "M", "\"", "),", "c", "}", "function", "r", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "b", "=", "K", "(", "b", ",", "a", ")", ",", "a", ".", "isBefore", "(", "b", ")", "?", "c", "=", "q", "(", "a", ",", "b", ")", ":(", "c", "=", "q", "(", "b", ",", "a", ")", ",", "c", ".", "milliseconds", "=", "-", "c", ".", "milliseconds", ",", "c", ".", "months", "=", "-", "c", ".", "months", ")", ",", "c", "}", "function", "s", "(", "a", ",", "b", ")", "{", "return", "function", "(", "c", ",", "d", ")", "{", "var", "e", ",", "f", ";", "return", "null", "=", "==", "d", "|", "|", "isNaN", "(", "+", "d", ")", "||", "(", "g", "(", "b", ",", "\"", "moment", "(", ").", "\"+", "b", "+", "\"(", "period", ",", "number", ")", "is", "deprecated", ".", "Please", "use", "moment", "(", ").", "\"+", "b", "+", "\"(", "number", ",", "period", ")", ".\"", "),", "f", "=", "c", ",", "c", "=", "d", ",", "d", "=", "f", ")", ",", "c", "=", "\"", "string", "\"", "==", "typeof", "c", "?", "+", "c", ":", "c", ",", "e", "=", "tb", ".", "duration", "(", "c", ",", "d", ")", ",", "t", "(", "this", ",", "e", ",", "a", ")", ",", "this", "}", "}", "function", "t", "(", "a", ",", "b", ",", "c", ",", "d", ")", "{", "var", "e", "=", "b", ".", "_milliseconds", ",", "f", "=", "b", ".", "_days", ",", "g", "=", "b", ".", "_months", ";", "d", "=", "null", "=", "=", "d", "?", "!", "0", ":", "d", ",", "e", "&", "&", "a", ".", "_d", ".", "setTime", "(", "+", "a", ".", "_d", "+", "e", "*", "c", ")", ",", "f", "&", "&", "nb", "(", "a", ",", "\"", "Date", "\"", ",", "mb", "(", "a", ",", "\"", "Date", "\"", ")+", "f", "*", "c", ")", ",", "g", "&", "&", "lb", "(", "a", ",", "mb", "(", "a", ",", "\"", "Month", "\"", ")+", "g", "*", "c", ")", ",", "d", "&", "&", "tb", ".", "updateOffset", "(", "a", ",", "f", "|", "|", "g", ")", "}", "function", "u", "(", "a", ")", "{", "return", "\"", "[", "object", "Array", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "a", ")", "}", "function", "v", "(", "a", ")", "{", "return", "\"", "[", "object", "Date", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "a", ")", "||", "a", "instanceof", "Date", "}", "function", "w", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", "=", "Math", ".", "min", "(", "a", ".", "length", ",", "b", ".", "length", ")", ",", "f", "=", "Math", ".", "abs", "(", "a", ".", "length", "-", "b", ".", "length", ")", ",", "g", "=", "0", ";", "for", "(", "d", "=", "0", ";", "e", ">", "d", ";", "d", "+", "+)", "(", "c", "&", "&", "a", "[", "d", "]", "!=", "=", "b", "[", "d", "]", "||", "!", "c", "&", "&", "A", "(", "a", "[", "d", "]", ")!", "==", "A", "(", "b", "[", "d", "]", "))", "&&", "g", "+", "+;", "return", "g", "+", "f", "}", "function", "x", "(", "a", ")", "{", "if", "(", "a", ")", "{", "var", "b", "=", "a", ".", "toLowerCase", "(", ").", "replace", "(", "/(", ".)", "s", "$", "/,", "\"$", "1", "\"", ");", "a", "=", "jc", "[", "a", "]", "||", "kc", "[", "b", "]", "||", "b", "}", "return", "a", "}", "function", "y", "(", "a", ")", "{", "var", "b", ",", "d", ",", "e", "=", "{}", ";", "for", "(", "d", "in", "a", ")", "c", "(", "a", ",", "d", ")", "&&", "(", "b", "=", "x", "(", "d", ")", ",", "b", "&", "&(", "e", "[", "b", "]", "=", "a", "[", "d", "]", "))", ";", "return", "e", "}", "function", "z", "(", "b", ")", "{", "var", "c", ",", "d", ";", "if", "(", "0", "=", "==", "b", ".", "indexOf", "(", "\"", "week", "\"", "))", "c", "=", "7", ",", "d", "=", "\"", "day", "\"", ";", "else", "{", "if", "(", "0", "!", "==", "b", ".", "indexOf", "(", "\"", "month", "\"", "))", "return", ";", "c", "=", "12", ",", "d", "=", "\"", "month", "\"", "}", "tb", "[", "b", "]", "=", "function", "(", "e", ",", "f", ")", "{", "var", "g", ",", "h", ",", "i", "=", "tb", ".", "_locale", "[", "b", "]", ",", "j", "=", "[]", ";", "if", "(", "\"", "number", "\"", "==", "typeof", "e", "&", "&(", "f", "=", "e", ",", "e", "=", "a", ")", ",", "h", "=", "function", "(", "a", ")", "{", "var", "b", "=", "tb", "(", ").", "utc", "(", ").", "set", "(", "d", ",", "a", ")", ";", "return", "i", ".", "call", "(", "tb", ".", "_locale", ",", "b", ",", "e", "|", "|\"", "\")", "},", "null", "!", "=", "f", ")", "return", "h", "(", "f", ")", ";", "for", "(", "g", "=", "0", ";", "c", ">", "g", ";", "g", "+", "+)", "j", ".", "push", "(", "h", "(", "g", ")", ");", "return", "j", "}", "}", "function", "A", "(", "a", ")", "{", "var", "b", "=", "+", "a", ",", "c", "=", "0", ";", "return", "0", "!", "==", "b", "&", "&", "isFinite", "(", "b", ")", "&&", "(", "c", "=", "b", ">", "=", "0", "?", "Math", ".", "floor", "(", "b", ")", ":", "Math", ".", "ceil", "(", "b", ")", "),", "c", "}", "function", "B", "(", "a", ",", "b", ")", "{", "return", "new", "Date", "(", "Date", ".", "UTC", "(", "a", ",", "b", "+", "1", ",", "0", ")", ").", "getUTCDate", "(", ")}", "function", "C", "(", "a", ",", "b", ",", "c", ")", "{", "return", "hb", "(", "tb", "(", "[", "a", ",", "11", ",", "31", "+", "b", "-", "c", "]", "),", "b", ",", "c", ")", ".", "week", "}", "function", "D", "(", "a", ")", "{", "return", "E", "(", "a", ")", "?", "366", ":", "365", "}", "function", "E", "(", "a", ")", "{", "return", "a", "%", "4", "=", "==", "0", "&", "&", "a", "%", "100", "!", "==", "0", "|", "|", "a", "%", "400", "=", "==", "0", "}", "function", "F", "(", "a", ")", "{", "var", "b", ";", "a", ".", "_a", "&", "&-", "2", "=", "==", "a", ".", "_pf", ".", "overflow", "&", "&(", "b", "=", "a", ".", "_a", "[", "Bb", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Bb", "]", ">", "11", "?", "Bb", ":", "a", ".", "_a", "[", "Cb", "]", "<", "1", "|", "|", "a", ".", "_a", "[", "Cb", "]", ">", "B", "(", "a", ".", "_a", "[", "Ab", "]", ",", "a", ".", "_a", "[", "Bb", "]", ")?", "Cb", ":", "a", ".", "_a", "[", "Db", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Db", "]", ">", "24", "|", "|", "24", "=", "==", "a", ".", "_a", "[", "Db", "]", "&&", "(", "0", "!", "==", "a", ".", "_a", "[", "Eb", "]", "||", "0", "!", "==", "a", ".", "_a", "[", "Fb", "]", "||", "0", "!", "==", "a", ".", "_a", "[", "Gb", "]", ")?", "Db", ":", "a", ".", "_a", "[", "Eb", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Eb", "]", ">", "59", "?", "Eb", ":", "a", ".", "_a", "[", "Fb", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Fb", "]", ">", "59", "?", "Fb", ":", "a", ".", "_a", "[", "Gb", "]", "<", "0", "|", "|", "a", ".", "_a", "[", "Gb", "]", ">", "999", "?", "Gb", ":", "-", "1", ",", "a", ".", "_pf", ".", "_overflowDayOfYear", "&", "&(", "Ab", ">", "b", "|", "|", "b", ">", "Cb", ")", "&&", "(", "b", "=", "Cb", ")", ",", "a", ".", "_pf", ".", "overflow", "=", "b", ")", "}", "function", "G", "(", "b", ")", "{", "return", "null", "=", "=", "b", ".", "_isValid", "&", "&(", "b", ".", "_isValid", "=", "!", "isNaN", "(", "b", ".", "_d", ".", "getTime", "(", "))", "&&", "b", ".", "_pf", ".", "overflow", "<", "0", "&", "&!", "b", ".", "_pf", ".", "empty", "&", "&!", "b", ".", "_pf", ".", "invalidMonth", "&", "&!", "b", ".", "_pf", ".", "nullInput", "&", "&!", "b", ".", "_pf", ".", "invalidFormat", "&", "&!", "b", ".", "_pf", ".", "userInvalidated", ",", "b", ".", "_strict", "&", "&(", "b", ".", "_isValid", "=", "b", ".", "_isValid", "&", "&", "0", "=", "==", "b", ".", "_pf", ".", "charsLeftOver", "&", "&", "0", "=", "==", "b", ".", "_pf", ".", "unusedTokens", ".", "length", "&", "&", "b", ".", "_pf", ".", "bigHour", "=", "==", "a", ")", "),", "b", ".", "_isValid", "}", "function", "H", "(", "a", ")", "{", "return", "a", "?", "a", ".", "toLowerCase", "(", ").", "replace", "(", "\"", "_", "\"", ",\"", "-\"", "):", "a", "}", "function", "I", "(", "a", ")", "{", "for", "(", "var", "b", ",", "c", ",", "d", ",", "e", ",", "f", "=", "0", ";", "f", "<", "a", ".", "length", ";", "){", "for", "(", "e", "=", "H", "(", "a", "[", "f", "]", ").", "split", "(", "\"-", "\")", ",", "b", "=", "e", ".", "length", ",", "c", "=", "H", "(", "a", "[", "f", "+", "1", "]", "),", "c", "=", "c", "?", "c", ".", "split", "(", "\"-", "\")", ":", "null", ";", "b", ">", "0", ";", "){", "if", "(", "d", "=", "J", "(", "e", ".", "slice", "(", "0", ",", "b", ")", ".", "join", "(", "\"-", "\")", "))", "return", "d", ";", "if", "(", "c", "&", "&", "c", ".", "length", ">", "=", "b", "&", "&", "w", "(", "e", ",", "c", ",", "!", "0", ")", ">=", "b", "-", "1", ")", "break", ";", "b", "-", "-}", "f", "+", "+}", "return", "null", "}", "function", "J", "(", "a", ")", "{", "var", "b", "=", "null", ";", "if", "(", "!", "Hb", "[", "a", "]", "&&", "Jb", ")", "try", "{", "b", "=", "tb", ".", "locale", "(", "),", "require", "(", "\".", "/", "locale", "/", "\"+", "a", ")", ",", "tb", ".", "locale", "(", "b", ")", "}", "catch", "(", "c", ")", "{}", "return", "Hb", "[", "a", "]", "}", "function", "K", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", ";", "return", "b", ".", "_isUTC", "?", "(", "c", "=", "b", ".", "clone", "(", "),", "d", "=", "(", "tb", ".", "isMoment", "(", "a", ")", "||", "v", "(", "a", ")", "?+", "a", ":", "+", "tb", "(", "a", ")", ")-", "+", "c", ",", "c", ".", "_d", ".", "setTime", "(", "+", "c", ".", "_d", "+", "d", ")", ",", "tb", ".", "updateOffset", "(", "c", ",", "!", "1", ")", ",", "c", ")", ":", "tb", "(", "a", ")", ".", "local", "(", ")}", "function", "L", "(", "a", ")", "{", "return", "a", ".", "match", "(", "/\\", "[[", "\\", "s", "\\", "S", "]", "/)", "?", "a", ".", "replace", "(", "/^", "\\[", "|\\", "]$", "/", "g", ",", "\"\"", "):", "a", ".", "replace", "(", "/\\", "\\/", "g", ",", "\"\"", ")}", "function", "M", "(", "a", ")", "{", "var", "b", ",", "c", ",", "d", "=", "a", ".", "match", "(", "Nb", ")", ";", "for", "(", "b", "=", "0", ",", "c", "=", "d", ".", "length", ";", "c", ">", "b", ";", "b", "+", "+)", "d", "[", "b", "]", "=", "pc", "[", "d", "[", "b", "]", "]?", "pc", "[", "d", "[", "b", "]", "]:", "L", "(", "d", "[", "b", "]", ");", "return", "function", "(", "e", ")", "{", "var", "f", "=", "\"\"", ";", "for", "(", "b", "=", "0", ";", "c", ">", "b", ";", "b", "+", "+)", "f", "+", "=", "d", "[", "b", "]", "instanceof", "Function", "?", "d", "[", "b", "]", ".", "call", "(", "e", ",", "a", ")", ":", "d", "[", "b", "]", ";", "return", "f", "}", "}", "function", "N", "(", "a", ",", "b", ")", "{", "return", "a", ".", "isValid", "(", ")?", "(", "b", "=", "O", "(", "b", ",", "a", ".", "localeData", "(", "))", ",", "lc", "[", "b", "]", "||", "(", "lc", "[", "b", "]", "=", "M", "(", "b", ")", "),", "lc", "[", "b", "]", "(", "a", ")", "):", "a", ".", "localeData", "(", ").", "invalidDate", "(", ")}", "function", "O", "(", "a", ",", "b", ")", "{", "function", "c", "(", "a", ")", "{", "return", "b", ".", "longDateFormat", "(", "a", ")", "||", "a", "}", "var", "d", "=", "5", ";", "for", "(", "Ob", ".", "lastIndex", "=", "0", ";", "d", ">", "=", "0", "&", "&", "Ob", ".", "test", "(", "a", ")", ";)", "a", "=", "a", ".", "replace", "(", "Ob", ",", "c", ")", ",", "Ob", ".", "lastIndex", "=", "0", ",", "d", "-", "=", "1", ";", "return", "a", "}", "function", "P", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", "=", "b", ".", "_strict", ";", "switch", "(", "a", ")", "{", "case", "\"", "Q", "\"", ":", "return", "Zb", ";", "case", "\"", "DDDD", "\"", ":", "return", "_b", ";", "case", "\"", "YYYY", "\"", ":", "case", "\"", "GGGG", "\"", ":", "case", "\"", "gggg", "\"", ":", "return", "d", "?", "ac", ":", "Rb", ";", "case", "\"", "Y", "\"", ":", "case", "\"", "G", "\"", ":", "case", "\"", "g", "\"", ":", "return", "cc", ";", "case", "\"", "YYYYYY", "\"", ":", "case", "\"", "YYYYY", "\"", ":", "case", "\"", "GGGGG", "\"", ":", "case", "\"", "ggggg", "\"", ":", "return", "d", "?", "bc", ":", "Sb", ";", "case", "\"", "S", "\"", ":", "if", "(", "d", ")", "return", "Zb", ";", "case", "\"", "SS", "\"", ":", "if", "(", "d", ")", "return", "$", "b", ";", "case", "\"", "SSS", "\"", ":", "if", "(", "d", ")", "return", "_b", ";", "case", "\"", "DDD", "\"", ":", "return", "Qb", ";", "case", "\"", "MMM", "\"", ":", "case", "\"", "MMMM", "\"", ":", "case", "\"", "dd", "\"", ":", "case", "\"", "ddd", "\"", ":", "case", "\"", "dddd", "\"", ":", "return", "Ub", ";", "case", "\"", "a", "\"", ":", "case", "\"", "A", "\"", ":", "return", "b", ".", "_locale", ".", "_meridiemParse", ";", "case", "\"", "x", "\"", ":", "return", "Xb", ";", "case", "\"", "X", "\"", ":", "return", "Yb", ";", "case", "\"", "Z", "\"", ":", "case", "\"", "ZZ", "\"", ":", "return", "Vb", ";", "case", "\"", "T", "\"", ":", "return", "Wb", ";", "case", "\"", "SSSS", "\"", ":", "return", "Tb", ";", "case", "\"", "MM", "\"", ":", "case", "\"", "DD", "\"", ":", "case", "\"", "YY", "\"", ":", "case", "\"", "GG", "\"", ":", "case", "\"", "gg", "\"", ":", "case", "\"", "HH", "\"", ":", "case", "\"", "hh", "\"", ":", "case", "\"", "mm", "\"", ":", "case", "\"", "ss", "\"", ":", "case", "\"", "ww", "\"", ":", "case", "\"", "WW", "\"", ":", "return", "d", "?", "$", "b", ":", "Pb", ";", "case", "\"", "M", "\"", ":", "case", "\"", "D", "\"", ":", "case", "\"", "d", "\"", ":", "case", "\"", "H", "\"", ":", "case", "\"", "h", "\"", ":", "case", "\"", "m", "\"", ":", "case", "\"", "s", "\"", ":", "case", "\"", "w", "\"", ":", "case", "\"", "W", "\"", ":", "case", "\"", "e", "\"", ":", "case", "\"", "E", "\"", ":", "return", "Pb", ";", "case", "\"", "Do", "\"", ":", "return", "d", "?", "b", ".", "_locale", ".", "_ordinalParse", ":", "b", ".", "_locale", ".", "_ordinalParseLenient", ";", "default", ":", "return", "c", "=", "new", "RegExp", "(", "Y", "(", "X", "(", "a", ".", "replace", "(", "\"\\", "\\\"", ",\"", "\")", "),", "\"", "i", "\"", "))", "}}", "function", "Q", "(", "a", ")", "{", "a", "=", "a", "|", "|\"", "\";", "var", "b", "=", "a", ".", "match", "(", "Vb", ")", "||", "[]", ",", "c", "=", "b", "[", "b", ".", "length", "-", "1", "]", "||", "[]", ",", "d", "=", "(", "c", "+", "\"\"", ").", "match", "(", "hc", ")", "||", "[\"", "-\"", ",", "0", ",", "0", "]", ",", "e", "=", "+(", "60", "*", "d", "[", "1", "]", ")+", "A", "(", "d", "[", "2", "]", ");", "return", "\"", "+\"", "==", "=", "d", "[", "0", "]", "?-", "e", ":", "e", "}", "function", "R", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", "=", "c", ".", "_a", ";", "switch", "(", "a", ")", "{", "case", "\"", "Q", "\"", ":", "null", "!", "=", "b", "&", "&(", "e", "[", "Bb", "]", "=", "3", "*", "(", "A", "(", "b", ")", "-", "1", ")", ");", "break", ";", "case", "\"", "M", "\"", ":", "case", "\"", "MM", "\"", ":", "null", "!", "=", "b", "&", "&(", "e", "[", "Bb", "]", "=", "A", "(", "b", ")", "-", "1", ")", ";", "break", ";", "case", "\"", "MMM", "\"", ":", "case", "\"", "MMMM", "\"", ":", "d", "=", "c", ".", "_locale", ".", "monthsParse", "(", "b", ",", "a", ",", "c", ".", "_strict", ")", ",", "null", "!", "=", "d", "?", "e", "[", "Bb", "]", "=", "d", ":", "c", ".", "_pf", ".", "invalidMonth", "=", "b", ";", "break", ";", "case", "\"", "D", "\"", ":", "case", "\"", "DD", "\"", ":", "null", "!", "=", "b", "&", "&(", "e", "[", "Cb", "]", "=", "A", "(", "b", ")", ");", "break", ";", "case", "\"", "Do", "\"", ":", "null", "!", "=", "b", "&", "&(", "e", "[", "Cb", "]", "=", "A", "(", "parseInt", "(", "b", ".", "match", "(", "/\\", "d", "{", "1", ",", "2", "}", "/)", "[", "0", "]", ",", "10", ")", "))", ";", "break", ";", "case", "\"", "DDD", "\"", ":", "case", "\"", "DDDD", "\"", ":", "null", "!", "=", "b", "&", "&(", "c", ".", "_dayOfYear", "=", "A", "(", "b", ")", ");", "break", ";", "case", "\"", "YY", "\"", ":", "e", "[", "Ab", "]", "=", "tb", ".", "parseTwoDigitYear", "(", "b", ")", ";", "break", ";", "case", "\"", "YYYY", "\"", ":", "case", "\"", "YYYYY", "\"", ":", "case", "\"", "YYYYYY", "\"", ":", "e", "[", "Ab", "]", "=", "A", "(", "b", ")", ";", "break", ";", "case", "\"", "a", "\"", ":", "case", "\"", "A", "\"", ":", "c", ".", "_isPm", "=", "c", ".", "_locale", ".", "isPM", "(", "b", ")", ";", "break", ";", "case", "\"", "h", "\"", ":", "case", "\"", "hh", "\"", ":", "c", ".", "_pf", ".", "bigHour", "=", "!", "0", ";", "case", "\"", "H", "\"", ":", "case", "\"", "HH", "\"", ":", "e", "[", "Db", "]", "=", "A", "(", "b", ")", ";", "break", ";", "case", "\"", "m", "\"", ":", "case", "\"", "mm", "\"", ":", "e", "[", "Eb", "]", "=", "A", "(", "b", ")", ";", "break", ";", "case", "\"", "s", "\"", ":", "case", "\"", "ss", "\"", ":", "e", "[", "Fb", "]", "=", "A", "(", "b", ")", ";", "break", ";", "case", "\"", "S", "\"", ":", "case", "\"", "SS", "\"", ":", "case", "\"", "SSS", "\"", ":", "case", "\"", "SSSS", "\"", ":", "e", "[", "Gb", "]", "=", "A", "(", "1e3", "*", "(\"", "0", ".", "\"+", "b", ")", ");", "break", ";", "case", "\"", "x", "\"", ":", "c", ".", "_d", "=", "new", "Date", "(", "A", "(", "b", ")", ");", "break", ";", "case", "\"", "X", "\"", ":", "c", ".", "_d", "=", "new", "Date", "(", "1e3", "*", "parseFloat", "(", "b", ")", ");", "break", ";", "case", "\"", "Z", "\"", ":", "case", "\"", "ZZ", "\"", ":", "c", ".", "_useUTC", "=", "!", "0", ",", "c", ".", "_tzm", "=", "Q", "(", "b", ")", ";", "break", ";", "case", "\"", "dd", "\"", ":", "case", "\"", "ddd", "\"", ":", "case", "\"", "dddd", "\"", ":", "d", "=", "c", ".", "_locale", ".", "weekdaysParse", "(", "b", ")", ",", "null", "!", "=", "d", "?", "(", "c", ".", "_w", "=", "c", ".", "_w", "|", "|{", "},", "c", ".", "_w", ".", "d", "=", "d", ")", ":", "c", ".", "_pf", ".", "invalidWeekday", "=", "b", ";", "break", ";", "case", "\"", "w", "\"", ":", "case", "\"", "ww", "\"", ":", "case", "\"", "W", "\"", ":", "case", "\"", "WW", "\"", ":", "case", "\"", "d", "\"", ":", "case", "\"", "e", "\"", ":", "case", "\"", "E", "\"", ":", "a", "=", "a", ".", "substr", "(", "0", ",", "1", ")", ";", "case", "\"", "gggg", "\"", ":", "case", "\"", "GGGG", "\"", ":", "case", "\"", "GGGGG", "\"", ":", "a", "=", "a", ".", "substr", "(", "0", ",", "2", ")", ",", "b", "&", "&(", "c", ".", "_w", "=", "c", ".", "_w", "|", "|{", "},", "c", ".", "_w", "[", "a", "]", "=", "A", "(", "b", ")", ");", "break", ";", "case", "\"", "gg", "\"", ":", "case", "\"", "GG", "\"", ":", "c", ".", "_w", "=", "c", ".", "_w", "|", "|{", "},", "c", ".", "_w", "[", "a", "]", "=", "tb", ".", "parseTwoDigitYear", "(", "b", ")", "}}", "function", "S", "(", "a", ")", "{", "var", "c", ",", "d", ",", "e", ",", "f", ",", "g", ",", "h", ",", "i", ";", "c", "=", "a", ".", "_w", ",", "null", "!", "=", "c", ".", "GG", "|", "|", "null", "!", "=", "c", ".", "W", "|", "|", "null", "!", "=", "c", ".", "E", "?", "(", "g", "=", "1", ",", "h", "=", "4", ",", "d", "=", "b", "(", "c", ".", "GG", ",", "a", ".", "_a", "[", "Ab", "]", ",", "hb", "(", "tb", "(", "),", "1", ",", "4", ")", ".", "year", ")", ",", "e", "=", "b", "(", "c", ".", "W", ",", "1", ")", ",", "f", "=", "b", "(", "c", ".", "E", ",", "1", ")", "):", "(", "g", "=", "a", ".", "_locale", ".", "_week", ".", "dow", ",", "h", "=", "a", ".", "_locale", ".", "_week", ".", "doy", ",", "d", "=", "b", "(", "c", ".", "gg", ",", "a", ".", "_a", "[", "Ab", "]", ",", "hb", "(", "tb", "(", "),", "g", ",", "h", ")", ".", "year", ")", ",", "e", "=", "b", "(", "c", ".", "w", ",", "1", ")", ",", "null", "!", "=", "c", ".", "d", "?", "(", "f", "=", "c", ".", "d", ",", "g", ">", "f", "&", "&+", "+", "e", ")", ":", "f", "=", "null", "!", "=", "c", ".", "e", "?", "c", ".", "e", "+", "g", ":", "g", ")", ",", "i", "=", "ib", "(", "d", ",", "e", ",", "f", ",", "h", ",", "g", ")", ",", "a", ".", "_a", "[", "Ab", "]", "=", "i", ".", "year", ",", "a", ".", "_dayOfYear", "=", "i", ".", "dayOfYear", "}", "function", "T", "(", "a", ")", "{", "var", "c", ",", "d", ",", "e", ",", "f", ",", "g", "=", "[]", ";", "if", "(", "!", "a", ".", "_d", ")", "{", "for", "(", "e", "=", "V", "(", "a", ")", ",", "a", ".", "_w", "&", "&", "null", "=", "=", "a", ".", "_a", "[", "Cb", "]", "&&", "null", "=", "=", "a", ".", "_a", "[", "Bb", "]", "&&", "S", "(", "a", ")", ",", "a", ".", "_dayOfYear", "&", "&(", "f", "=", "b", "(", "a", ".", "_a", "[", "Ab", "]", ",", "e", "[", "Ab", "]", "),", "a", ".", "_dayOfYear", ">", "D", "(", "f", ")", "&&", "(", "a", ".", "_pf", ".", "_overflowDayOfYear", "=", "!", "0", ")", ",", "d", "=", "db", "(", "f", ",", "0", ",", "a", ".", "_dayOfYear", ")", ",", "a", ".", "_a", "[", "Bb", "]", "=", "d", ".", "getUTCMonth", "(", "),", "a", ".", "_a", "[", "Cb", "]", "=", "d", ".", "getUTCDate", "(", "))", ",", "c", "=", "0", ";", "3", ">", "c", "&", "&", "null", "=", "=", "a", ".", "_a", "[", "c", "]", ";+", "+", "c", ")", "a", ".", "_a", "[", "c", "]", "=", "g", "[", "c", "]", "=", "e", "[", "c", "]", ";", "for", "(", ";", "7", ">", "c", ";", "c", "+", "+)", "a", ".", "_a", "[", "c", "]", "=", "g", "[", "c", "]", "=", "null", "=", "=", "a", ".", "_a", "[", "c", "]", "?", "2", "=", "==", "c", "?", "1", ":", "0", ":", "a", ".", "_a", "[", "c", "]", ";", "24", "=", "==", "a", ".", "_a", "[", "Db", "]", "&&", "0", "=", "==", "a", ".", "_a", "[", "Eb", "]", "&&", "0", "=", "==", "a", ".", "_a", "[", "Fb", "]", "&&", "0", "=", "==", "a", ".", "_a", "[", "Gb", "]", "&&", "(", "a", ".", "_nextDay", "=", "!", "0", ",", "a", ".", "_a", "[", "Db", "]", "=", "0", ")", ",", "a", ".", "_d", "=", "(", "a", ".", "_useUTC", "?", "db", ":", "cb", ")", ".", "apply", "(", "null", ",", "g", ")", ",", "null", "!", "=", "a", ".", "_tzm", "&", "&", "a", ".", "_d", ".", "setUTCMinutes", "(", "a", ".", "_d", ".", "getUTCMinutes", "(", ")+", "a", ".", "_tzm", ")", ",", "a", ".", "_nextDay", "&", "&(", "a", ".", "_a", "[", "Db", "]", "=", "24", ")", "}}", "function", "U", "(", "a", ")", "{", "var", "b", ";", "a", ".", "_d", "|", "|(", "b", "=", "y", "(", "a", ".", "_i", ")", ",", "a", ".", "_a", "=", "[", "b", ".", "year", ",", "b", ".", "month", ",", "b", ".", "day", "|", "|", "b", ".", "date", ",", "b", ".", "hour", ",", "b", ".", "minute", ",", "b", ".", "second", ",", "b", ".", "millisecond", "]", ",", "T", "(", "a", ")", ")}", "function", "V", "(", "a", ")", "{", "var", "b", "=", "new", "Date", ";", "return", "a", ".", "_useUTC", "?", "[", "b", ".", "getUTCFullYear", "(", "),", "b", ".", "getUTCMonth", "(", "),", "b", ".", "getUTCDate", "(", ")]", ":[", "b", ".", "getFullYear", "(", "),", "b", ".", "getMonth", "(", "),", "b", ".", "getDate", "(", ")]", "}", "function", "W", "(", "b", ")", "{", "if", "(", "b", ".", "_f", "=", "==", "tb", ".", "ISO_8601", ")", "return", "void", "$", "(", "b", ")", ";", "b", ".", "_a", "=", "[]", ",", "b", ".", "_pf", ".", "empty", "=", "!", "0", ";", "var", "c", ",", "d", ",", "e", ",", "f", ",", "g", ",", "h", "=", "\"\"", "+", "b", ".", "_i", ",", "i", "=", "h", ".", "length", ",", "j", "=", "0", ";", "for", "(", "e", "=", "O", "(", "b", ".", "_f", ",", "b", ".", "_locale", ")", ".", "match", "(", "Nb", ")", "||", "[]", ",", "c", "=", "0", ";", "c", "<", "e", ".", "length", ";", "c", "+", "+)", "f", "=", "e", "[", "c", "]", ",", "d", "=", "(", "h", ".", "match", "(", "P", "(", "f", ",", "b", ")", ")|", "|[", "])", "[", "0", "]", ",", "d", "&", "&(", "g", "=", "h", ".", "substr", "(", "0", ",", "h", ".", "indexOf", "(", "d", ")", "),", "g", ".", "length", ">", "0", "&", "&", "b", ".", "_pf", ".", "unusedInput", ".", "push", "(", "g", ")", ",", "h", "=", "h", ".", "slice", "(", "h", ".", "indexOf", "(", "d", ")", "+", "d", ".", "length", ")", ",", "j", "+", "=", "d", ".", "length", ")", ",", "pc", "[", "f", "]", "?(", "d", "?", "b", ".", "_pf", ".", "empty", "=", "!", "1", ":", "b", ".", "_pf", ".", "unusedTokens", ".", "push", "(", "f", ")", ",", "R", "(", "f", ",", "d", ",", "b", ")", "):", "b", ".", "_strict", "&", "&!", "d", "&", "&", "b", ".", "_pf", ".", "unusedTokens", ".", "push", "(", "f", ")", ";", "b", ".", "_pf", ".", "charsLeftOver", "=", "i", "-", "j", ",", "h", ".", "length", ">", "0", "&", "&", "b", ".", "_pf", ".", "unusedInput", ".", "push", "(", "h", ")", ",", "b", ".", "_pf", ".", "bigHour", "=", "==", "!", "0", "&", "&", "b", ".", "_a", "[", "Db", "]", "<=", "12", "&", "&(", "b", ".", "_pf", ".", "bigHour", "=", "a", ")", ",", "b", ".", "_isPm", "&", "&", "b", ".", "_a", "[", "Db", "]", "<", "12", "&", "&(", "b", ".", "_a", "[", "Db", "]", "+=", "12", ")", ",", "b", ".", "_isPm", "=", "==", "!", "1", "&", "&", "12", "=", "==", "b", ".", "_a", "[", "Db", "]", "&&", "(", "b", ".", "_a", "[", "Db", "]", "=", "0", ")", ",", "T", "(", "b", ")", ",", "F", "(", "b", ")", "}", "function", "X", "(", "a", ")", "{", "return", "a", ".", "replace", "(", "/\\", "\\(", "\\[", ")|", "\\\\", "(\\", "])", "|\\", "[(", "[^", "\\]", "\\[", "]*", ")\\", "]|", "\\\\", "(.", ")/", "g", ",", "function", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ")", "{", "return", "b", "|", "|", "c", "|", "|", "d", "|", "|", "e", "}", ")}", "function", "Y", "(", "a", ")", "{", "return", "a", ".", "replace", "(", "/[", "-\\", "/\\", "\\^", "$*", "+?", ".(", ")|", "[\\", "]{", "}]", "/", "g", ",", "\"\\", "\\$", "&\"", ")}", "function", "Z", "(", "a", ")", "{", "var", "b", ",", "c", ",", "e", ",", "f", ",", "g", ";", "if", "(", "0", "=", "==", "a", ".", "_f", ".", "length", ")", "return", "a", ".", "_pf", ".", "invalidFormat", "=", "!", "0", ",", "void", "(", "a", ".", "_d", "=", "new", "Date", "(", "0", "/", "0", ")", ");", "for", "(", "f", "=", "0", ";", "f", "<", "a", ".", "_f", ".", "length", ";", "f", "+", "+)", "g", "=", "0", ",", "b", "=", "n", "(", "{}", ",", "a", ")", ",", "null", "!", "=", "a", ".", "_useUTC", "&", "&(", "b", ".", "_useUTC", "=", "a", ".", "_useUTC", ")", ",", "b", ".", "_pf", "=", "d", "(", "),", "b", ".", "_f", "=", "a", ".", "_f", "[", "f", "]", ",", "W", "(", "b", ")", ",", "G", "(", "b", ")", "&&", "(", "g", "+", "=", "b", ".", "_pf", ".", "charsLeftOver", ",", "g", "+", "=", "10", "*", "b", ".", "_pf", ".", "unusedTokens", ".", "length", ",", "b", ".", "_pf", ".", "score", "=", "g", ",", "(", "null", "=", "=", "e", "|", "|", "e", ">", "g", ")", "&&", "(", "e", "=", "g", ",", "c", "=", "b", ")", ");", "m", "(", "a", ",", "c", "|", "|", "b", ")", "}", "function", "$", "(", "a", ")", "{", "var", "b", ",", "c", ",", "d", "=", "a", ".", "_i", ",", "e", "=", "dc", ".", "exec", "(", "d", ")", ";", "if", "(", "e", ")", "{", "for", "(", "a", ".", "_pf", ".", "iso", "=", "!", "0", ",", "b", "=", "0", ",", "c", "=", "fc", ".", "length", ";", "c", ">", "b", ";", "b", "+", "+)", "if", "(", "fc", "[", "b", "]", "[", "1", "]", ".", "exec", "(", "d", ")", "){", "a", ".", "_f", "=", "fc", "[", "b", "]", "[", "0", "]", "+(", "e", "[", "6", "]", "||", "\"", "\"", ");", "break", "}", "for", "(", "b", "=", "0", ",", "c", "=", "gc", ".", "length", ";", "c", ">", "b", ";", "b", "+", "+)", "if", "(", "gc", "[", "b", "]", "[", "1", "]", ".", "exec", "(", "d", ")", "){", "a", ".", "_f", "+", "=", "gc", "[", "b", "]", "[", "0", "]", ";", "break", "}", "d", ".", "match", "(", "Vb", ")", "&&", "(", "a", ".", "_f", "+", "=\"", "Z", "\"", "),", "W", "(", "a", ")", "}", "else", "a", ".", "_isValid", "=", "!", "1", "}", "function", "_", "(", "a", ")", "{$", "(", "a", ")", ",", "a", ".", "_isValid", "=", "==", "!", "1", "&", "&(", "delete", "a", ".", "_isValid", ",", "tb", ".", "createFromInputFallback", "(", "a", ")", ")}", "function", "ab", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", "=", "[]", ";", "for", "(", "c", "=", "0", ";", "c", "<", "a", ".", "length", ";", "++", "c", ")", "d", ".", "push", "(", "b", "(", "a", "[", "c", "]", ",", "c", ")", ");", "return", "d", "}", "function", "bb", "(", "b", ")", "{", "var", "c", ",", "d", "=", "b", ".", "_i", ";", "d", "=", "==", "a", "?", "b", ".", "_d", "=", "new", "Date", ":", "v", "(", "d", ")", "?", "b", ".", "_d", "=", "new", "Date", "(", "+", "d", ")", ":", "null", "!", "==", "(", "c", "=", "Kb", ".", "exec", "(", "d", ")", ")?", "b", ".", "_d", "=", "new", "Date", "(", "+", "c", "[", "1", "]", "):", "\"", "string", "\"", "==", "typeof", "d", "?", "_", "(", "b", ")", ":", "u", "(", "d", ")", "?(", "b", ".", "_a", "=", "ab", "(", "d", ".", "slice", "(", "0", ")", ",", "function", "(", "a", ")", "{", "return", "parseInt", "(", "a", ",", "10", ")", "})", ",", "T", "(", "b", ")", "):", "\"", "object", "\"", "==", "typeof", "d", "?", "U", "(", "b", ")", ":\"", "number", "\"", "==", "typeof", "d", "?", "b", ".", "_d", "=", "new", "Date", "(", "d", ")", ":", "tb", ".", "createFromInputFallback", "(", "b", ")", "}", "function", "cb", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ",", "f", ",", "g", ")", "{", "var", "h", "=", "new", "Date", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ",", "f", ",", "g", ")", ";", "return", "1970", ">", "a", "&", "&", "h", ".", "setFullYear", "(", "a", ")", ",", "h", "}", "function", "db", "(", "a", ")", "{", "var", "b", "=", "new", "Date", "(", "Date", ".", "UTC", ".", "apply", "(", "null", ",", "arguments", ")", ");", "return", "1970", ">", "a", "&", "&", "b", ".", "setUTCFullYear", "(", "a", ")", ",", "b", "}", "function", "eb", "(", "a", ",", "b", ")", "{", "if", "(", "\"", "string", "\"", "==", "typeof", "a", ")", "if", "(", "isNaN", "(", "a", ")", "){", "if", "(", "a", "=", "b", ".", "weekdaysParse", "(", "a", ")", ",\"", "number", "\"", "!=", "typeof", "a", ")", "return", "null", "}", "else", "a", "=", "parseInt", "(", "a", ",", "10", ")", ";", "return", "a", "}", "function", "fb", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ")", "{", "return", "e", ".", "relativeTime", "(", "b", "|", "|", "1", ",", "!!", "c", ",", "a", ",", "d", ")", "}", "function", "gb", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", "=", "tb", ".", "duration", "(", "a", ")", ".", "abs", "(", "),", "e", "=", "yb", "(", "d", ".", "as", "(", "\"", "s", "\"", "))", ",", "f", "=", "yb", "(", "d", ".", "as", "(", "\"", "m", "\"", "))", ",", "g", "=", "yb", "(", "d", ".", "as", "(", "\"", "h", "\"", "))", ",", "h", "=", "yb", "(", "d", ".", "as", "(", "\"", "d", "\"", "))", ",", "i", "=", "yb", "(", "d", ".", "as", "(", "\"", "M", "\"", "))", ",", "j", "=", "yb", "(", "d", ".", "as", "(", "\"", "y", "\"", "))", ",", "k", "=", "e", "<", "mc", ".", "s", "&", "&[", "\"", "s", "\"", ",", "e", "]", "||", "1", "=", "==", "f", "&", "&[", "\"", "m", "\"", "]|", "|", "f", "<", "mc", ".", "m", "&", "&[", "\"", "mm", "\"", ",", "f", "]", "||", "1", "=", "==", "g", "&", "&[", "\"", "h", "\"", "]|", "|", "g", "<", "mc", ".", "h", "&", "&[", "\"", "hh", "\"", ",", "g", "]", "||", "1", "=", "==", "h", "&", "&[", "\"", "d", "\"", "]|", "|", "h", "<", "mc", ".", "d", "&", "&[", "\"", "dd", "\"", ",", "h", "]", "||", "1", "=", "==", "i", "&", "&[", "\"", "M", "\"", "]|", "|", "i", "<", "mc", ".", "M", "&", "&[", "\"", "MM", "\"", ",", "i", "]", "||", "1", "=", "==", "j", "&", "&[", "\"", "y", "\"", "]|", "|[", "\"", "yy", "\"", ",", "j", "]", ";", "return", "k", "[", "2", "]", "=", "b", ",", "k", "[", "3", "]", "=+", "a", ">", "0", ",", "k", "[", "4", "]", "=", "c", ",", "fb", ".", "apply", "(", "{}", ",", "k", ")", "}", "function", "hb", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", "=", "c", "-", "b", ",", "f", "=", "c", "-", "a", ".", "day", "(", ");", "return", "f", ">", "e", "&", "&(", "f", "-", "=", "7", ")", ",", "e", "-", "7", ">", "f", "&", "&(", "f", "+", "=", "7", ")", ",", "d", "=", "tb", "(", "a", ")", ".", "add", "(", "f", ",", "\"", "d", "\"", "),", "{", "week", ":", "Math", ".", "ceil", "(", "d", ".", "dayOfYear", "(", ")/", "7", ")", ",", "year", ":", "d", ".", "year", "(", ")}", "}", "function", "ib", "(", "a", ",", "b", ",", "c", ",", "d", ",", "e", ")", "{", "var", "f", ",", "g", ",", "h", "=", "db", "(", "a", ",", "0", ",", "1", ")", ".", "getUTCDay", "(", ");", "return", "h", "=", "0", "=", "==", "h", "?", "7", ":", "h", ",", "c", "=", "null", "!", "=", "c", "?", "c", ":", "e", ",", "f", "=", "e", "-", "h", "+", "(", "h", ">", "d", "?", "7", ":", "0", ")", "-(", "e", ">", "h", "?", "7", ":", "0", ")", ",", "g", "=", "7", "*", "(", "b", "-", "1", ")", "+(", "c", "-", "e", ")", "+", "f", "+", "1", ",", "{", "year", ":", "g", ">", "0", "?", "a", ":", "a", "-", "1", ",", "dayOfYear", ":", "g", ">", "0", "?", "g", ":", "D", "(", "a", "-", "1", ")", "+", "g", "}", "}", "function", "jb", "(", "b", ")", "{", "var", "c", ",", "d", "=", "b", ".", "_i", ",", "e", "=", "b", ".", "_f", ";", "return", "b", ".", "_locale", "=", "b", ".", "_locale", "|", "|", "tb", ".", "localeData", "(", "b", ".", "_l", ")", ",", "null", "=", "==", "d", "|", "|", "e", "=", "==", "a", "&", "&\"", "\"=", "==", "d", "?", "tb", ".", "invalid", "(", "{", "nullInput", ":", "!", "0", "}", "):", "(\"", "string", "\"", "==", "typeof", "d", "&", "&(", "b", ".", "_i", "=", "d", "=", "b", ".", "_locale", ".", "preparse", "(", "d", ")", "),", "tb", ".", "isMoment", "(", "d", ")", "?", "new", "k", "(", "d", ",", "!", "0", ")", ":(", "e", "?", "u", "(", "e", ")", "?", "Z", "(", "b", ")", ":", "W", "(", "b", ")", ":", "bb", "(", "b", ")", ",", "c", "=", "new", "k", "(", "b", ")", ",", "c", ".", "_nextDay", "&", "&(", "c", ".", "add", "(", "1", ",", "\"", "d", "\"", "),", "c", ".", "_nextDay", "=", "a", ")", ",", "c", ")", ")}", "function", "kb", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", ";", "if", "(", "1", "=", "==", "b", ".", "length", "&", "&", "u", "(", "b", "[", "0", "]", ")&", "&(", "b", "=", "b", "[", "0", "]", "),", "!", "b", ".", "length", ")", "return", "tb", "(", ");", "for", "(", "c", "=", "b", "[", "0", "]", ",", "d", "=", "1", ";", "d", "<", "b", ".", "length", ";", "++", "d", ")", "b", "[", "d", "]", "[", "a", "]", "(", "c", ")", "&&", "(", "c", "=", "b", "[", "d", "]", ");", "return", "c", "}", "function", "lb", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "\"", "string", "\"", "==", "typeof", "b", "&", "&(", "b", "=", "a", ".", "localeData", "(", ").", "monthsParse", "(", "b", ")", ",\"", "number", "\"", "!=", "typeof", "b", ")", "?", "a", ":", "(", "c", "=", "Math", ".", "min", "(", "a", ".", "date", "(", "),", "B", "(", "a", ".", "year", "(", "),", "b", ")", "),", "a", ".", "_d", "[", "\"", "set", "\"", "+(", "a", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+\"", "Month", "\"", "](", "b", ",", "c", ")", ",", "a", ")", "}", "function", "mb", "(", "a", ",", "b", ")", "{", "return", "a", ".", "_d", "[", "\"", "get", "\"", "+(", "a", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "b", "]", "()", "}", "function", "nb", "(", "a", ",", "b", ",", "c", ")", "{", "return", "\"", "Month", "\"", "==", "=", "b", "?", "lb", "(", "a", ",", "c", ")", ":", "a", ".", "_d", "[", "\"", "set", "\"", "+(", "a", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "b", "]", "(", "c", ")", "}", "function", "ob", "(", "a", ",", "b", ")", "{", "return", "function", "(", "c", ")", "{", "return", "null", "!", "=", "c", "?", "(", "nb", "(", "this", ",", "a", ",", "c", ")", ",", "tb", ".", "updateOffset", "(", "this", ",", "b", ")", ",", "this", ")", ":", "mb", "(", "this", ",", "a", ")", "}}", "function", "pb", "(", "a", ")", "{", "return", "400", "*", "a", "/", "146097", "}", "function", "qb", "(", "a", ")", "{", "return", "146097", "*", "a", "/", "400", "}", "function", "rb", "(", "a", ")", "{", "tb", ".", "duration", ".", "fn", "[", "a", "]", "=", "function", "(", "){", "return", "this", ".", "_data", "[", "a", "]", "}}", "function", "sb", "(", "a", ")", "{\"", "undefined", "\"", "==", "typeof", "ender", "&", "&(", "ub", "=", "xb", ".", "moment", ",", "xb", ".", "moment", "=", "a", "?", "f", "(", "\"", "Accessing", "Moment", "through", "the", "global", "scope", "is", "deprecated", ",", "and", "will", "be", "removed", "in", "an", "upcoming", "release", ".", "\",", "tb", ")", ":", "tb", ")", "}", "for", "(", "var", "tb", ",", "ub", ",", "vb", ",", "wb", "=", "\"", "2", ".", "8", ".", "4", "\"", ",", "xb", "=", "\"", "undefined", "\"", "!=", "typeof", "global", "?", "global", ":", "this", ",", "yb", "=", "Math", ".", "round", ",", "zb", "=", "Object", ".", "prototype", ".", "hasOwnProperty", ",", "Ab", "=", "0", ",", "Bb", "=", "1", ",", "Cb", "=", "2", ",", "Db", "=", "3", ",", "Eb", "=", "4", ",", "Fb", "=", "5", ",", "Gb", "=", "6", ",", "Hb", "=", "{}", ",", "Ib", "=", "[]", ",", "Jb", "=", "\"", "undefined", "\"", "!=", "typeof", "module", "&", "&", "module", "&", "&", "module", ".", "exports", ",", "Kb", "=", "/^", "\\/", "?", "Date", "\\", "((", "\\-", "?\\", "d", "+", ")/", "i", ",", "Lb", "=", "/(", "\\-", ")?", "(?", ":(", "\\", "d", "*", ")\\", ".)", "?(", "\\", "d", "+", ")\\", ":(", "\\", "d", "+", ")(", "?:", "\\:", "(\\", "d", "+", ")\\", ".?", "(\\", "d", "{", "3", "}", ")?", ")?", "/,", "Mb", "=", "/^", "(-", ")?", "P", "(", "?:", "(?", ":(", "[", "0", "-", "9", ",", ".]", "*)", "Y", ")", "?(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "M", ")", "?(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "D", ")", "?(", "?:", "T", "(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "H", ")", "?(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "M", ")", "?(", "?:", "([", "0", "-", "9", ",", ".]", "*)", "S", ")", "?)", "?|", "([", "0", "-", "9", ",", ".]", "*)", "W", ")", "$/", ",", "Nb", "=", "/(", "\\[", "[^", "\\[", "]*", "\\]", ")|", "(\\", "\\)", "?(", "Mo", "|", "MM", "?", "M", "?", "M", "?", "|", "Do", "|", "DDDo", "|", "DD", "?", "D", "?", "D", "?", "|", "ddd", "?", "d", "?", "|", "do", "?", "|", "w", "[", "o", "|", "w", "]", "?|", "W", "[", "o", "|", "W", "]", "?|", "Q", "|", "YYYYYY", "|", "YYYYY", "|", "YYYY", "|", "YY", "|", "gg", "(", "ggg", "?", ")?", "|", "GG", "(", "GGG", "?", ")?", "|", "e", "|", "E", "|", "a", "|", "A", "|", "hh", "?", "|", "HH", "?", "|", "mm", "?", "|", "ss", "?", "|", "S", "{", "1", ",", "4", "}", "|", "x", "|", "X", "|", "zz", "?", "|", "ZZ", "?", "|.", ")/", "g", ",", "Ob", "=", "/(", "\\[", "[^", "\\[", "]*", "\\]", ")|", "(\\", "\\)", "?(", "LTS", "|", "LT", "|", "LL", "?", "L", "?", "L", "?", "|", "l", "{", "1", ",", "4", "}", ")/", "g", ",", "Pb", "=", "/\\", "d", "\\", "d", "?", "/,", "Qb", "=", "/\\", "d", "{", "1", ",", "3", "}", "/,", "Rb", "=", "/\\", "d", "{", "1", ",", "4", "}", "/,", "Sb", "=", "/[", "+\\", "-]", "?\\", "d", "{", "1", ",", "6", "}", "/,", "Tb", "=", "/\\", "d", "+", "/,", "Ub", "=", "/[", "0", "-", "9", "]", "*[", "'", "a", "-", "z", "\\", "u00A0", "-", "\\", "u05FF", "\\", "u0700", "-", "\\", "uD7FF", "\\", "uF900", "-", "\\", "uFDCF", "\\", "uFDF0", "-", "\\", "uFFEF", "]", "+|", "[\\", "u0600", "-", "\\", "u06FF", "\\", "/]", "+(", "\\", "s", "*", "?[", "\\", "u0600", "-", "\\", "u06FF", "]", "+)", "{", "1", ",", "2", "}", "/", "i", ",", "Vb", "=", "/", "Z", "|", "[\\", "+\\", "-]", "\\", "d", "\\", "d", ":", "?\\", "d", "\\", "d", "/", "gi", ",", "Wb", "=", "/", "T", "/", "i", ",", "Xb", "=", "/[", "\\+", "\\-", "]?", "\\", "d", "+", "/,", "Yb", "=", "/[", "\\+", "\\-", "]?", "\\", "d", "+", "(\\", ".\\", "d", "{", "1", ",", "3", "}", ")?", "/,", "Zb", "=", "/\\", "d", "/", ",$", "b", "=", "/\\", "d", "\\", "d", "/", ",", "_b", "=", "/\\", "d", "{", "3", "}", "/,", "ac", "=", "/\\", "d", "{", "4", "}", "/,", "bc", "=", "/[", "+-", "]?", "\\", "d", "{", "6", "}", "/,", "cc", "=", "/[", "+-", "]?", "\\", "d", "+", "/,", "dc", "=", "/^", "\\", "s", "*", "(?", ":[", "+-", "]\\", "d", "{", "6", "}", "|\\", "d", "{", "4", "}", ")-", "(?", ":(", "\\", "d", "\\", "d", "-", "\\", "d", "\\", "d", ")", "|(", "W", "\\", "d", "\\", "d", "$", ")|", "(", "W", "\\", "d", "\\", "d", "-", "\\", "d", ")", "|(", "\\", "d", "\\", "d", "\\", "d", ")", ")(", "(", "T", "|", ")", "(\\", "d", "\\", "d", "(", ":\\", "d", "\\", "d", "(", ":\\", "d", "\\", "d", "(", "\\.", "\\", "d", "+", ")?", ")?", ")?", ")?", "([", "\\+", "\\-", "]\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?|", "\\", "s", "*", "Z", ")", "?)", "?$", "/,", "ec", "=", "\"", "YYYY", "-", "MM", "-", "DDTHH", ":", "mm", ":", "ssZ", "\"", ",", "fc", "=", "[[", "\"", "YYYYYY", "-", "MM", "-", "DD", "\"", ",/", "[+", "-]", "\\", "d", "{", "6", "}", "-\\", "d", "{", "2", "}", "-\\", "d", "{", "2", "}", "/]", ",[", "\"", "YYYY", "-", "MM", "-", "DD", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "{", "2", "}", "-\\", "d", "{", "2", "}", "/]", ",[", "\"", "GGGG", "-", "[", "W", "]", "WW", "-", "E", "\"", ",/", "\\", "d", "{", "4", "}", "-", "W", "\\", "d", "{", "2", "}", "-\\", "d", "/", "],", "[\"", "GGGG", "-", "[", "W", "]", "WW", "\"", ",/", "\\", "d", "{", "4", "}", "-", "W", "\\", "d", "{", "2", "}", "/]", ",[", "\"", "YYYY", "-", "DDD", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "{", "3", "}", "/]", "],", "gc", "=", "[[", "\"", "HH", ":", "mm", ":", "ss", ".", "SSSS", "\"", ",/", "(", "T", "|", ")", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "\\", ".\\", "d", "+", "/]", ",[", "\"", "HH", ":", "mm", ":", "ss", "\"", ",/", "(", "T", "|", ")", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "/", "],", "[\"", "HH", ":", "mm", "\"", ",/", "(", "T", "|", ")", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "/", "],", "[\"", "HH", "\"", ",/", "(", "T", "|", ")", "\\", "d", "\\", "d", "/", "]]", ",", "hc", "=", "/(", "[\\", "+\\", "-]", "|\\", "d", "\\", "d", ")", "/", "gi", ",", "ic", "=", "(\"", "Date", "|", "Hours", "|", "Minutes", "|", "Seconds", "|", "Milliseconds", "\"", ".", "split", "(", "\"|", "\")", ",{", "Milliseconds", ":", "1", ",", "Seconds", ":", "1e3", ",", "Minutes", ":", "6e4", ",", "Hours", ":", "36e5", ",", "Days", ":", "864e5", ",", "Months", ":", "2592e6", ",", "Years", ":", "31536e6", "}", "),", "jc", "=", "{", "ms", ":", "\"", "millisecond", "\"", ",", "s", ":", "\"", "second", "\"", ",", "m", ":", "\"", "minute", "\"", ",", "h", ":", "\"", "hour", "\"", ",", "d", ":", "\"", "day", "\"", ",", "D", ":", "\"", "date", "\"", ",", "w", ":", "\"", "week", "\"", ",", "W", ":", "\"", "isoWeek", "\"", ",", "M", ":", "\"", "month", "\"", ",", "Q", ":", "\"", "quarter", "\"", ",", "y", ":", "\"", "year", "\"", ",", "DDD", ":", "\"", "dayOfYear", "\"", ",", "e", ":", "\"", "weekday", "\"", ",", "E", ":", "\"", "isoWeekday", "\"", ",", "gg", ":", "\"", "weekYear", "\"", ",", "GG", ":", "\"", "isoWeekYear", "\"", "},", "kc", "=", "{", "dayofyear", ":", "\"", "dayOfYear", "\"", ",", "isoweekday", ":", "\"", "isoWeekday", "\"", ",", "isoweek", ":", "\"", "isoWeek", "\"", ",", "weekyear", ":", "\"", "weekYear", "\"", ",", "isoweekyear", ":", "\"", "isoWeekYear", "\"", "},", "lc", "=", "{}", ",", "mc", "=", "{", "s", ":", "45", ",", "m", ":", "45", ",", "h", ":", "22", ",", "d", ":", "26", ",", "M", ":", "11", "}", ",", "nc", "=", "\"", "DDD", "w", "W", "M", "D", "d", "\"", ".", "split", "(", "\"", "\"", "),", "oc", "=", "\"", "M", "D", "H", "h", "m", "s", "w", "W", "\"", ".", "split", "(", "\"", "\"", "),", "pc", "=", "{", "M", ":", "function", "(", "){", "return", "this", ".", "month", "(", ")+", "1", "}", ",", "MMM", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "monthsShort", "(", "this", ",", "a", ")", "},", "MMMM", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "months", "(", "this", ",", "a", ")", "},", "D", ":", "function", "(", "){", "return", "this", ".", "date", "(", ")}", ",", "DDD", ":", "function", "(", "){", "return", "this", ".", "dayOfYear", "(", ")}", ",", "d", ":", "function", "(", "){", "return", "this", ".", "day", "(", ")}", ",", "dd", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdaysMin", "(", "this", ",", "a", ")", "},", "ddd", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdaysShort", "(", "this", ",", "a", ")", "},", "dddd", ":", "function", "(", "a", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdays", "(", "this", ",", "a", ")", "},", "w", ":", "function", "(", "){", "return", "this", ".", "week", "(", ")}", ",", "W", ":", "function", "(", "){", "return", "this", ".", "isoWeek", "(", ")}", ",", "YY", ":", "function", "(", "){", "return", "p", "(", "this", ".", "year", "(", ")%", "100", ",", "2", ")", "},", "YYYY", ":", "function", "(", "){", "return", "p", "(", "this", ".", "year", "(", "),", "4", ")", "},", "YYYYY", ":", "function", "(", "){", "return", "p", "(", "this", ".", "year", "(", "),", "5", ")", "},", "YYYYYY", ":", "function", "(", "){", "var", "a", "=", "this", ".", "year", "(", "),", "b", "=", "a", ">", "=", "0", "?", "\"+", "\":", "\"-", "\";", "return", "b", "+", "p", "(", "Math", ".", "abs", "(", "a", ")", ",", "6", ")", "},", "gg", ":", "function", "(", "){", "return", "p", "(", "this", ".", "weekYear", "(", ")%", "100", ",", "2", ")", "},", "gggg", ":", "function", "(", "){", "return", "p", "(", "this", ".", "weekYear", "(", "),", "4", ")", "},", "ggggg", ":", "function", "(", "){", "return", "p", "(", "this", ".", "weekYear", "(", "),", "5", ")", "},", "GG", ":", "function", "(", "){", "return", "p", "(", "this", ".", "isoWeekYear", "(", ")%", "100", ",", "2", ")", "},", "GGGG", ":", "function", "(", "){", "return", "p", "(", "this", ".", "isoWeekYear", "(", "),", "4", ")", "},", "GGGGG", ":", "function", "(", "){", "return", "p", "(", "this", ".", "isoWeekYear", "(", "),", "5", ")", "},", "e", ":", "function", "(", "){", "return", "this", ".", "weekday", "(", ")}", ",", "E", ":", "function", "(", "){", "return", "this", ".", "isoWeekday", "(", ")}", ",", "a", ":", "function", "(", "){", "return", "this", ".", "localeData", "(", ").", "meridiem", "(", "this", ".", "hours", "(", "),", "this", ".", "minutes", "(", "),", "!", "0", ")", "},", "A", ":", "function", "(", "){", "return", "this", ".", "localeData", "(", ").", "meridiem", "(", "this", ".", "hours", "(", "),", "this", ".", "minutes", "(", "),", "!", "1", ")", "},", "H", ":", "function", "(", "){", "return", "this", ".", "hours", "(", ")}", ",", "h", ":", "function", "(", "){", "return", "this", ".", "hours", "(", ")%", "12", "|", "|", "12", "}", ",", "m", ":", "function", "(", "){", "return", "this", ".", "minutes", "(", ")}", ",", "s", ":", "function", "(", "){", "return", "this", ".", "seconds", "(", ")}", ",", "S", ":", "function", "(", "){", "return", "A", "(", "this", ".", "milliseconds", "(", ")/", "100", ")", "},", "SS", ":", "function", "(", "){", "return", "p", "(", "A", "(", "this", ".", "milliseconds", "(", ")/", "10", ")", ",", "2", ")", "},", "SSS", ":", "function", "(", "){", "return", "p", "(", "this", ".", "milliseconds", "(", "),", "3", ")", "},", "SSSS", ":", "function", "(", "){", "return", "p", "(", "this", ".", "milliseconds", "(", "),", "3", ")", "},", "Z", ":", "function", "(", "){", "var", "a", "=", "-", "this", ".", "zone", "(", "),", "b", "=", "\"+", "\";", "return", "0", ">", "a", "&", "&(", "a", "=", "-", "a", ",", "b", "=", "\"-", "\")", ",", "b", "+", "p", "(", "A", "(", "a", "/", "60", ")", ",", "2", ")", "+\"", ":\"", "+", "p", "(", "A", "(", "a", ")", "%", "60", ",", "2", ")", "},", "ZZ", ":", "function", "(", "){", "var", "a", "=", "-", "this", ".", "zone", "(", "),", "b", "=", "\"+", "\";", "return", "0", ">", "a", "&", "&(", "a", "=", "-", "a", ",", "b", "=", "\"-", "\")", ",", "b", "+", "p", "(", "A", "(", "a", "/", "60", ")", ",", "2", ")", "+", "p", "(", "A", "(", "a", ")", "%", "60", ",", "2", ")", "},", "z", ":", "function", "(", "){", "return", "this", ".", "zoneAbbr", "(", ")}", ",", "zz", ":", "function", "(", "){", "return", "this", ".", "zoneName", "(", ")}", ",", "x", ":", "function", "(", "){", "return", "this", ".", "valueOf", "(", ")}", ",", "X", ":", "function", "(", "){", "return", "this", ".", "unix", "(", ")}", ",", "Q", ":", "function", "(", "){", "return", "this", ".", "quarter", "(", ")}", "},", "qc", "=", "{}", ",", "rc", "=", "[\"", "months", "\"", ",\"", "monthsShort", "\"", ",\"", "weekdays", "\"", ",\"", "weekdaysShort", "\"", ",\"", "weekdaysMin", "\"", "];", "nc", ".", "length", ";", ")", "vb", "=", "nc", ".", "pop", "(", "),", "pc", "[", "vb", "+", "\"", "o", "\"", "]=", "i", "(", "pc", "[", "vb", "]", ",", "vb", ")", ";", "for", "(", ";", "oc", ".", "length", ";", ")", "vb", "=", "oc", ".", "pop", "(", "),", "pc", "[", "vb", "+", "vb", "]", "=", "h", "(", "pc", "[", "vb", "]", ",", "2", ")", ";", "pc", ".", "DDDD", "=", "h", "(", "pc", ".", "DDD", ",", "3", ")", ",", "m", "(", "j", ".", "prototype", ",", "{", "set", ":", "function", "(", "a", ")", "{", "var", "b", ",", "c", ";", "for", "(", "c", "in", "a", ")", "b", "=", "a", "[", "c", "]", ",\"", "function", "\"", "==", "typeof", "b", "?", "this", "[", "c", "]", "=", "b", ":", "this", "[", "\"", "_", "\"", "+", "c", "]", "=", "b", ";", "this", ".", "_ordinalParseLenient", "=", "new", "RegExp", "(", "this", ".", "_ordinalParse", ".", "source", "+", "\"|", "\"+", "/\\", "d", "{", "1", ",", "2", "}", "/.", "source", ")", "},", "_months", ":", "\"", "January_February_March_April_May_June_July_August_September_October_November_December", "\"", ".", "split", "(", "\"", "_", "\"", "),", "months", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_months", "[", "a", ".", "month", "(", ")]", "},", "_monthsShort", ":", "\"", "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec", "\"", ".", "split", "(", "\"", "_", "\"", "),", "monthsShort", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_monthsShort", "[", "a", ".", "month", "(", ")]", "},", "monthsParse", ":", "function", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", ",", "f", ";", "for", "(", "this", ".", "_monthsParse", "|", "|(", "this", ".", "_monthsParse", "=", "[]", ",", "this", ".", "_longMonthsParse", "=", "[]", ",", "this", ".", "_shortMonthsParse", "=", "[]", "),", "d", "=", "0", ";", "12", ">", "d", ";", "d", "+", "+)", "{", "if", "(", "e", "=", "tb", ".", "utc", "(", "[", "2e3", ",", "d", "]", "),", "c", "&", "&!", "this", ".", "_longMonthsParse", "[", "d", "]", "&&", "(", "this", ".", "_longMonthsParse", "[", "d", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "months", "(", "e", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\"\"", ")+", "\"$", "\",", "\"", "i", "\"", "),", "this", ".", "_shortMonthsParse", "[", "d", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "monthsShort", "(", "e", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\"\"", ")+", "\"$", "\",", "\"", "i", "\"", "))", ",", "c", "|", "|", "this", ".", "_monthsParse", "[", "d", "]", "||", "(", "f", "=", "\"^", "\"+", "this", ".", "months", "(", "e", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "monthsShort", "(", "e", ",", "\"\"", "),", "this", ".", "_monthsParse", "[", "d", "]", "=", "new", "RegExp", "(", "f", ".", "replace", "(", "\".", "\",", "\"\"", "),", "\"", "i", "\"", "))", ",", "c", "&", "&\"", "MMMM", "\"", "==", "=", "b", "&", "&", "this", ".", "_longMonthsParse", "[", "d", "]", ".", "test", "(", "a", ")", ")", "return", "d", ";", "if", "(", "c", "&", "&\"", "MMM", "\"", "==", "=", "b", "&", "&", "this", ".", "_shortMonthsParse", "[", "d", "]", ".", "test", "(", "a", ")", ")", "return", "d", ";", "if", "(", "!", "c", "&", "&", "this", ".", "_monthsParse", "[", "d", "]", ".", "test", "(", "a", ")", ")", "return", "d", "}", "},", "_weekdays", ":", "\"", "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday", "\"", ".", "split", "(", "\"", "_", "\"", "),", "weekdays", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_weekdays", "[", "a", ".", "day", "(", ")]", "},", "_weekdaysShort", ":", "\"", "Sun_Mon_Tue_Wed_Thu_Fri_Sat", "\"", ".", "split", "(", "\"", "_", "\"", "),", "weekdaysShort", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_weekdaysShort", "[", "a", ".", "day", "(", ")]", "},", "_weekdaysMin", ":", "\"", "Su_Mo_Tu_We_Th_Fr_Sa", "\"", ".", "split", "(", "\"", "_", "\"", "),", "weekdaysMin", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_weekdaysMin", "[", "a", ".", "day", "(", ")]", "},", "weekdaysParse", ":", "function", "(", "a", ")", "{", "var", "b", ",", "c", ",", "d", ";", "for", "(", "this", ".", "_weekdaysParse", "|", "|(", "this", ".", "_weekdaysParse", "=", "[]", "),", "b", "=", "0", ";", "7", ">", "b", ";", "b", "+", "+)", "if", "(", "this", ".", "_weekdaysParse", "[", "b", "]", "||", "(", "c", "=", "tb", "(", "[", "2e3", ",", "1", "]", ").", "day", "(", "b", ")", ",", "d", "=", "\"^", "\"+", "this", ".", "weekdays", "(", "c", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "weekdaysShort", "(", "c", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "weekdaysMin", "(", "c", ",", "\"\"", "),", "this", ".", "_weekdaysParse", "[", "b", "]", "=", "new", "RegExp", "(", "d", ".", "replace", "(", "\".", "\",", "\"\"", "),", "\"", "i", "\"", "))", ",", "this", ".", "_weekdaysParse", "[", "b", "]", ".", "test", "(", "a", ")", ")", "return", "b", "}", ",", "_longDateFormat", ":", "{", "LTS", ":", "\"", "h", ":", "mm", ":", "ss", "A", "\"", ",", "LT", ":", "\"", "h", ":", "mm", "A", "\"", ",", "L", ":", "\"", "MM", "/", "DD", "/", "YYYY", "\"", ",", "LL", ":", "\"", "MMMM", "D", ",", "YYYY", "\"", ",", "LLL", ":", "\"", "MMMM", "D", ",", "YYYY", "LT", "\"", ",", "LLLL", ":", "\"", "dddd", ",", "MMMM", "D", ",", "YYYY", "LT", "\"", "},", "longDateFormat", ":", "function", "(", "a", ")", "{", "var", "b", "=", "this", ".", "_longDateFormat", "[", "a", "]", ";", "return", "!", "b", "&", "&", "this", ".", "_longDateFormat", "[", "a", ".", "toUpperCase", "(", ")]", "&&", "(", "b", "=", "this", ".", "_longDateFormat", "[", "a", ".", "toUpperCase", "(", ")]", ".", "replace", "(", "/", "MMMM", "|", "MM", "|", "DD", "|", "dddd", "/", "g", ",", "function", "(", "a", ")", "{", "return", "a", ".", "slice", "(", "1", ")", "})", ",", "this", ".", "_longDateFormat", "[", "a", "]", "=", "b", ")", ",", "b", "}", ",", "isPM", ":", "function", "(", "a", ")", "{", "return", "\"", "p", "\"", "==", "=(", "a", "+", "\"\"", ").", "toLowerCase", "(", ").", "charAt", "(", "0", ")", "},", "_meridiemParse", ":", "/[", "ap", "]", "\\.", "?", "m", "?", "\\.", "?/", "i", ",", "meridiem", ":", "function", "(", "a", ",", "b", ",", "c", ")", "{", "return", "a", ">", "11", "?", "c", "?", "\"", "pm", "\"", ":\"", "PM", "\"", ":", "c", "?", "\"", "am", "\"", ":\"", "AM", "\"", "},", "_calendar", ":", "{", "sameDay", ":", "\"[", "Today", "at", "]", "LT", "\"", ",", "nextDay", ":", "\"[", "Tomorrow", "at", "]", "LT", "\"", ",", "nextWeek", ":", "\"", "dddd", "[", "at", "]", "LT", "\"", ",", "lastDay", ":", "\"[", "Yesterday", "at", "]", "LT", "\"", ",", "lastWeek", ":", "\"[", "Last", "]", "dddd", "[", "at", "]", "LT", "\"", ",", "sameElse", ":", "\"", "L", "\"", "},", "calendar", ":", "function", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", "=", "this", ".", "_calendar", "[", "a", "]", ";", "return", "\"", "function", "\"", "==", "typeof", "d", "?", "d", ".", "apply", "(", "b", ",", "[", "c", "]", "):", "d", "}", ",", "_relativeTime", ":", "{", "future", ":", "\"", "in", "%", "s", "\"", ",", "past", ":", "\"%", "s", "ago", "\"", ",", "s", ":", "\"", "a", "few", "seconds", "\"", ",", "m", ":", "\"", "a", "minute", "\"", ",", "mm", ":", "\"%", "d", "minutes", "\"", ",", "h", ":", "\"", "an", "hour", "\"", ",", "hh", ":", "\"%", "d", "hours", "\"", ",", "d", ":", "\"", "a", "day", "\"", ",", "dd", ":", "\"%", "d", "days", "\"", ",", "M", ":", "\"", "a", "month", "\"", ",", "MM", ":", "\"%", "d", "months", "\"", ",", "y", ":", "\"", "a", "year", "\"", ",", "yy", ":", "\"%", "d", "years", "\"", "},", "relativeTime", ":", "function", "(", "a", ",", "b", ",", "c", ",", "d", ")", "{", "var", "e", "=", "this", ".", "_relativeTime", "[", "c", "]", ";", "return", "\"", "function", "\"", "==", "typeof", "e", "?", "e", "(", "a", ",", "b", ",", "c", ",", "d", ")", ":", "e", ".", "replace", "(", "/%", "d", "/", "i", ",", "a", ")", "},", "pastFuture", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", "=", "this", ".", "_relativeTime", "[", "a", ">", "0", "?", "\"", "future", "\"", ":\"", "past", "\"", "];", "return", "\"", "function", "\"", "==", "typeof", "c", "?", "c", "(", "b", ")", ":", "c", ".", "replace", "(", "/%", "s", "/", "i", ",", "b", ")", "},", "ordinal", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_ordinal", ".", "replace", "(", "\"%", "d", "\"", ",", "a", ")", "},", "_ordinal", ":", "\"%", "d", "\"", ",", "_ordinalParse", ":", "/\\", "d", "{", "1", ",", "2", "}", "/,", "preparse", ":", "function", "(", "a", ")", "{", "return", "a", "}", ",", "postformat", ":", "function", "(", "a", ")", "{", "return", "a", "}", ",", "week", ":", "function", "(", "a", ")", "{", "return", "hb", "(", "a", ",", "this", ".", "_week", ".", "dow", ",", "this", ".", "_week", ".", "doy", ")", ".", "week", "}", ",", "_week", ":", "{", "dow", ":", "0", ",", "doy", ":", "6", "}", ",", "_invalidDate", ":", "\"", "Invalid", "date", "\"", ",", "invalidDate", ":", "function", "(", "){", "return", "this", ".", "_invalidDate", "}", "})", ",", "tb", "=", "function", "(", "b", ",", "c", ",", "e", ",", "f", ")", "{", "var", "g", ";", "return", "\"", "boolean", "\"", "==", "typeof", "e", "&", "&(", "f", "=", "e", ",", "e", "=", "a", ")", ",", "g", "=", "{}", ",", "g", ".", "_isAMomentObject", "=", "!", "0", ",", "g", ".", "_i", "=", "b", ",", "g", ".", "_f", "=", "c", ",", "g", ".", "_l", "=", "e", ",", "g", ".", "_strict", "=", "f", ",", "g", ".", "_isUTC", "=", "!", "1", ",", "g", ".", "_pf", "=", "d", "(", "),", "jb", "(", "g", ")", "},", "tb", ".", "suppressDeprecationWarnings", "=", "!", "1", ",", "tb", ".", "createFromInputFallback", "=", "f", "(", "\"", "moment", "construction", "falls", "back", "to", "js", "Date", ".", "This", "is", "discouraged", "and", "will", "be", "removed", "in", "upcoming", "major", "release", ".", "Please", "refer", "to", "https", ":", "//", "github", ".", "com", "/", "moment", "/", "moment", "/", "issues", "/", "1407", "for", "more", "info", ".", "\",", "function", "(", "a", ")", "{", "a", ".", "_d", "=", "new", "Date", "(", "a", ".", "_i", "+", "(", "a", ".", "_useUTC", "?", "\"", "UTC", "\"", ":\"", "\")", ")}", "),", "tb", ".", "min", "=", "function", "(", "){", "var", "a", "=", "[]", ".", "slice", ".", "call", "(", "arguments", ",", "0", ")", ";", "return", "kb", "(", "\"", "isBefore", "\"", ",", "a", ")", "},", "tb", ".", "max", "=", "function", "(", "){", "var", "a", "=", "[]", ".", "slice", ".", "call", "(", "arguments", ",", "0", ")", ";", "return", "kb", "(", "\"", "isAfter", "\"", ",", "a", ")", "},", "tb", ".", "utc", "=", "function", "(", "b", ",", "c", ",", "e", ",", "f", ")", "{", "var", "g", ";", "return", "\"", "boolean", "\"", "==", "typeof", "e", "&", "&(", "f", "=", "e", ",", "e", "=", "a", ")", ",", "g", "=", "{}", ",", "g", ".", "_isAMomentObject", "=", "!", "0", ",", "g", ".", "_useUTC", "=", "!", "0", ",", "g", ".", "_isUTC", "=", "!", "0", ",", "g", ".", "_l", "=", "e", ",", "g", ".", "_i", "=", "b", ",", "g", ".", "_f", "=", "c", ",", "g", ".", "_strict", "=", "f", ",", "g", ".", "_pf", "=", "d", "(", "),", "jb", "(", "g", ")", ".", "utc", "(", ")}", ",", "tb", ".", "unix", "=", "function", "(", "a", ")", "{", "return", "tb", "(", "1e3", "*", "a", ")", "},", "tb", ".", "duration", "=", "function", "(", "a", ",", "b", ")", "{", "var", "d", ",", "e", ",", "f", ",", "g", ",", "h", "=", "a", ",", "i", "=", "null", ";", "return", "tb", ".", "isDuration", "(", "a", ")", "?", "h", "=", "{", "ms", ":", "a", ".", "_milliseconds", ",", "d", ":", "a", ".", "_days", ",", "M", ":", "a", ".", "_months", "}", ":\"", "number", "\"", "==", "typeof", "a", "?", "(", "h", "=", "{}", ",", "b", "?", "h", "[", "b", "]", "=", "a", ":", "h", ".", "milliseconds", "=", "a", ")", ":(", "i", "=", "Lb", ".", "exec", "(", "a", ")", ")?", "(", "d", "=", "\"-", "\"=", "==", "i", "[", "1", "]", "?-", "1", ":", "1", ",", "h", "=", "{", "y", ":", "0", ",", "d", ":", "A", "(", "i", "[", "Cb", "]", ")*", "d", ",", "h", ":", "A", "(", "i", "[", "Db", "]", ")*", "d", ",", "m", ":", "A", "(", "i", "[", "Eb", "]", ")*", "d", ",", "s", ":", "A", "(", "i", "[", "Fb", "]", ")*", "d", ",", "ms", ":", "A", "(", "i", "[", "Gb", "]", ")*", "d", "}", "):", "(", "i", "=", "Mb", ".", "exec", "(", "a", ")", ")?", "(", "d", "=", "\"-", "\"=", "==", "i", "[", "1", "]", "?-", "1", ":", "1", ",", "f", "=", "function", "(", "a", ")", "{", "var", "b", "=", "a", "&", "&", "parseFloat", "(", "a", ".", "replace", "(", "\",", "\",", "\".", "\")", ");", "return", "(", "isNaN", "(", "b", ")", "?", "0", ":", "b", ")", "*", "d", "}", ",", "h", "=", "{", "y", ":", "f", "(", "i", "[", "2", "]", "),", "M", ":", "f", "(", "i", "[", "3", "]", "),", "d", ":", "f", "(", "i", "[", "4", "]", "),", "h", ":", "f", "(", "i", "[", "5", "]", "),", "m", ":", "f", "(", "i", "[", "6", "]", "),", "s", ":", "f", "(", "i", "[", "7", "]", "),", "w", ":", "f", "(", "i", "[", "8", "]", ")}", "):", "\"", "object", "\"", "==", "typeof", "h", "&", "&(", "\"", "from", "\"", "in", "h", "|", "|\"", "to", "\"", "in", "h", ")", "&&", "(", "g", "=", "r", "(", "tb", "(", "h", ".", "from", ")", ",", "tb", "(", "h", ".", "to", ")", "),", "h", "=", "{}", ",", "h", ".", "ms", "=", "g", ".", "milliseconds", ",", "h", ".", "M", "=", "g", ".", "months", ")", ",", "e", "=", "new", "l", "(", "h", ")", ",", "tb", ".", "isDuration", "(", "a", ")", "&&", "c", "(", "a", ",", "\"", "_locale", "\"", ")&", "&(", "e", ".", "_locale", "=", "a", ".", "_locale", ")", ",", "e", "}", ",", "tb", ".", "version", "=", "wb", ",", "tb", ".", "defaultFormat", "=", "ec", ",", "tb", ".", "ISO_8601", "=", "function", "(", "){", "},", "tb", ".", "momentProperties", "=", "Ib", ",", "tb", ".", "updateOffset", "=", "function", "(", "){", "},", "tb", ".", "relativeTimeThreshold", "=", "function", "(", "b", ",", "c", ")", "{", "return", "mc", "[", "b", "]", "==", "=", "a", "?", "!", "1", ":", "c", "=", "==", "a", "?", "mc", "[", "b", "]", ":(", "mc", "[", "b", "]", "=", "c", ",", "!", "0", ")", "},", "tb", ".", "lang", "=", "f", "(", "\"", "moment", ".", "lang", "is", "deprecated", ".", "Use", "moment", ".", "locale", "instead", ".", "\",", "function", "(", "a", ",", "b", ")", "{", "return", "tb", ".", "locale", "(", "a", ",", "b", ")", "})", ",", "tb", ".", "locale", "=", "function", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "a", "&", "&(", "c", "=", "\"", "undefined", "\"", "!=", "typeof", "b", "?", "tb", ".", "defineLocale", "(", "a", ",", "b", ")", ":", "tb", ".", "localeData", "(", "a", ")", ",", "c", "&", "&(", "tb", ".", "duration", ".", "_locale", "=", "tb", ".", "_locale", "=", "c", ")", "),", "tb", ".", "_locale", ".", "_abbr", "}", ",", "tb", ".", "defineLocale", "=", "function", "(", "a", ",", "b", ")", "{", "return", "null", "!", "==", "b", "?", "(", "b", ".", "abbr", "=", "a", ",", "Hb", "[", "a", "]", "||", "(", "Hb", "[", "a", "]", "=", "new", "j", ")", ",", "Hb", "[", "a", "]", ".", "set", "(", "b", ")", ",", "tb", ".", "locale", "(", "a", ")", ",", "Hb", "[", "a", "]", "):", "(", "delete", "Hb", "[", "a", "]", ",", "null", ")", "},", "tb", ".", "langData", "=", "f", "(", "\"", "moment", ".", "langData", "is", "deprecated", ".", "Use", "moment", ".", "localeData", "instead", ".", "\",", "function", "(", "a", ")", "{", "return", "tb", ".", "localeData", "(", "a", ")", "})", ",", "tb", ".", "localeData", "=", "function", "(", "a", ")", "{", "var", "b", ";", "if", "(", "a", "&", "&", "a", ".", "_locale", "&", "&", "a", ".", "_locale", ".", "_abbr", "&", "&(", "a", "=", "a", ".", "_locale", ".", "_abbr", ")", ",!", "a", ")", "return", "tb", ".", "_locale", ";", "if", "(", "!", "u", "(", "a", ")", "){", "if", "(", "b", "=", "J", "(", "a", ")", ")", "return", "b", ";", "a", "=", "[", "a", "]", "}", "return", "I", "(", "a", ")", "},", "tb", ".", "isMoment", "=", "function", "(", "a", ")", "{", "return", "a", "instanceof", "k", "|", "|", "null", "!", "=", "a", "&", "&", "c", "(", "a", ",", "\"", "_isAMomentObject", "\"", ")}", ",", "tb", ".", "isDuration", "=", "function", "(", "a", ")", "{", "return", "a", "instanceof", "l", "}", ";", "for", "(", "vb", "=", "rc", ".", "length", "-", "1", ";", "vb", ">", "=", "0", ";", "--", "vb", ")", "z", "(", "rc", "[", "vb", "]", ");", "tb", ".", "normalizeUnits", "=", "function", "(", "a", ")", "{", "return", "x", "(", "a", ")", "},", "tb", ".", "invalid", "=", "function", "(", "a", ")", "{", "var", "b", "=", "tb", ".", "utc", "(", "0", "/", "0", ")", ";", "return", "null", "!", "=", "a", "?", "m", "(", "b", ".", "_pf", ",", "a", ")", ":", "b", ".", "_pf", ".", "userInvalidated", "=", "!", "0", ",", "b", "}", ",", "tb", ".", "parseZone", "=", "function", "(", "){", "return", "tb", ".", "apply", "(", "null", ",", "arguments", ")", ".", "parseZone", "(", ")}", ",", "tb", ".", "parseTwoDigitYear", "=", "function", "(", "a", ")", "{", "return", "A", "(", "a", ")", "+(", "A", "(", "a", ")", ">", "68", "?", "1900", ":", "2e3", ")", "},", "m", "(", "tb", ".", "fn", "=", "k", ".", "prototype", ",", "{", "clone", ":", "function", "(", "){", "return", "tb", "(", "this", ")", "},", "valueOf", ":", "function", "(", "){", "return", "+", "this", ".", "_d", "+", "6e4", "*", "(", "this", ".", "_offset", "|", "|", "0", ")", "},", "unix", ":", "function", "(", "){", "return", "Math", ".", "floor", "(", "+", "this", "/", "1e3", ")", "},", "toString", ":", "function", "(", "){", "return", "this", ".", "clone", "(", ").", "locale", "(", "\"", "en", "\"", ").", "format", "(", "\"", "ddd", "MMM", "DD", "YYYY", "HH", ":", "mm", ":", "ss", "[", "GMT", "]", "ZZ", "\"", ")}", ",", "toDate", ":", "function", "(", "){", "return", "this", ".", "_offset", "?", "new", "Date", "(", "+", "this", ")", ":", "this", ".", "_d", "}", ",", "toISOString", ":", "function", "(", "){", "var", "a", "=", "tb", "(", "this", ")", ".", "utc", "(", ");", "return", "0", "<", "a", ".", "year", "(", ")&", "&", "a", ".", "year", "(", ")<", "=", "9999", "?", "\"", "function", "\"", "==", "typeof", "Date", ".", "prototype", ".", "toISOString", "?", "this", ".", "toDate", "(", ").", "toISOString", "(", "):", "N", "(", "a", ",", "\"", "YYYY", "-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "[", "Z", "]", "\")", ":", "N", "(", "a", ",", "\"", "YYYYYY", "-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "[", "Z", "]", "\")", "},", "toArray", ":", "function", "(", "){", "var", "a", "=", "this", ";", "return", "[", "a", ".", "year", "(", "),", "a", ".", "month", "(", "),", "a", ".", "date", "(", "),", "a", ".", "hours", "(", "),", "a", ".", "minutes", "(", "),", "a", ".", "seconds", "(", "),", "a", ".", "milliseconds", "(", ")]", "},", "isValid", ":", "function", "(", "){", "return", "G", "(", "this", ")", "},", "isDSTShifted", ":", "function", "(", "){", "return", "this", ".", "_a", "?", "this", ".", "isValid", "(", ")&", "&", "w", "(", "this", ".", "_a", ",", "(", "this", ".", "_isUTC", "?", "tb", ".", "utc", "(", "this", ".", "_a", ")", ":", "tb", "(", "this", ".", "_a", ")", ").", "toArray", "(", "))", ">", "0", ":", "!", "1", "}", ",", "parsingFlags", ":", "function", "(", "){", "return", "m", "(", "{}", ",", "this", ".", "_pf", ")", "},", "invalidAt", ":", "function", "(", "){", "return", "this", ".", "_pf", ".", "overflow", "}", ",", "utc", ":", "function", "(", "a", ")", "{", "return", "this", ".", "zone", "(", "0", ",", "a", ")", "},", "local", ":", "function", "(", "a", ")", "{", "return", "this", ".", "_isUTC", "&", "&(", "this", ".", "zone", "(", "0", ",", "a", ")", ",", "this", ".", "_isUTC", "=", "!", "1", ",", "a", "&", "&", "this", ".", "add", "(", "this", ".", "_dateTzOffset", "(", "),", "\"", "m", "\"", "))", ",", "this", "}", ",", "format", ":", "function", "(", "a", ")", "{", "var", "b", "=", "N", "(", "this", ",", "a", "|", "|", "tb", ".", "defaultFormat", ")", ";", "return", "this", ".", "localeData", "(", ").", "postformat", "(", "b", ")", "},", "add", ":", "s", "(", "1", ",", "\"", "add", "\"", "),", "subtract", ":", "s", "(", "-", "1", ",", "\"", "subtract", "\"", "),", "diff", ":", "function", "(", "a", ",", "b", ",", "c", ")", "{", "var", "d", ",", "e", ",", "f", ",", "g", "=", "K", "(", "a", ",", "this", ")", ",", "h", "=", "6e4", "*", "(", "this", ".", "zone", "(", ")-", "g", ".", "zone", "(", "))", ";", "return", "b", "=", "x", "(", "b", ")", ",\"", "year", "\"", "==", "=", "b", "|", "|\"", "month", "\"", "==", "=", "b", "?", "(", "d", "=", "432e5", "*", "(", "this", ".", "daysInMonth", "(", ")+", "g", ".", "daysInMonth", "(", "))", ",", "e", "=", "12", "*", "(", "this", ".", "year", "(", ")-", "g", ".", "year", "(", "))", "+(", "this", ".", "month", "(", ")-", "g", ".", "month", "(", "))", ",", "f", "=", "this", "-", "tb", "(", "this", ")", ".", "startOf", "(", "\"", "month", "\"", ")-", "(", "g", "-", "tb", "(", "g", ")", ".", "startOf", "(", "\"", "month", "\"", "))", ",", "f", "-", "=", "6e4", "*", "(", "this", ".", "zone", "(", ")-", "tb", "(", "this", ")", ".", "startOf", "(", "\"", "month", "\"", ").", "zone", "(", ")-", "(", "g", ".", "zone", "(", ")-", "tb", "(", "g", ")", ".", "startOf", "(", "\"", "month", "\"", ").", "zone", "(", "))", "),", "e", "+", "=", "f", "/", "d", ",", "\"", "year", "\"", "==", "=", "b", "&", "&(", "e", "/", "=", "12", ")", "):", "(", "d", "=", "this", "-", "g", ",", "e", "=", "\"", "second", "\"", "==", "=", "b", "?", "d", "/", "1e3", ":", "\"", "minute", "\"", "==", "=", "b", "?", "d", "/", "6e4", ":", "\"", "hour", "\"", "==", "=", "b", "?", "d", "/", "36e5", ":", "\"", "day", "\"", "==", "=", "b", "?", "(", "d", "-", "h", ")", "/", "864e5", ":", "\"", "week", "\"", "==", "=", "b", "?", "(", "d", "-", "h", ")", "/", "6048e5", ":", "d", ")", ",", "c", "?", "e", ":", "o", "(", "e", ")", "},", "from", ":", "function", "(", "a", ",", "b", ")", "{", "return", "tb", ".", "duration", "(", "{", "to", ":", "this", ",", "from", ":", "a", "}", ").", "locale", "(", "this", ".", "locale", "(", "))", ".", "humanize", "(", "!", "b", ")", "},", "fromNow", ":", "function", "(", "a", ")", "{", "return", "this", ".", "from", "(", "tb", "(", "),", "a", ")", "},", "calendar", ":", "function", "(", "a", ")", "{", "var", "b", "=", "a", "|", "|", "tb", "(", "),", "c", "=", "K", "(", "b", ",", "this", ")", ".", "startOf", "(", "\"", "day", "\"", "),", "d", "=", "this", ".", "diff", "(", "c", ",", "\"", "days", "\"", ",!", "0", ")", ",", "e", "=", "-", "6", ">", "d", "?", "\"", "sameElse", "\"", ":-", "1", ">", "d", "?", "\"", "lastWeek", "\"", ":", "0", ">", "d", "?", "\"", "lastDay", "\"", ":", "1", ">", "d", "?", "\"", "sameDay", "\"", ":", "2", ">", "d", "?", "\"", "nextDay", "\"", ":", "7", ">", "d", "?", "\"", "nextWeek", "\"", ":\"", "sameElse", "\"", ";", "return", "this", ".", "format", "(", "this", ".", "localeData", "(", ").", "calendar", "(", "e", ",", "this", ",", "tb", "(", "b", ")", "))", "},", "isLeapYear", ":", "function", "(", "){", "return", "E", "(", "this", ".", "year", "(", "))", "},", "isDST", ":", "function", "(", "){", "return", "this", ".", "zone", "(", ")<", "this", ".", "clone", "(", ").", "month", "(", "0", ")", ".", "zone", "(", ")|", "|", "this", ".", "zone", "(", ")<", "this", ".", "clone", "(", ").", "month", "(", "5", ")", ".", "zone", "(", ")}", ",", "day", ":", "function", "(", "a", ")", "{", "var", "b", "=", "this", ".", "_isUTC", "?", "this", ".", "_d", ".", "getUTCDay", "(", "):", "this", ".", "_d", ".", "getDay", "(", ");", "return", "null", "!", "=", "a", "?", "(", "a", "=", "eb", "(", "a", ",", "this", ".", "localeData", "(", "))", ",", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "d", "\"", "))", ":", "b", "}", ",", "month", ":", "ob", "(", "\"", "Month", "\"", ",!", "0", ")", ",", "startOf", ":", "function", "(", "a", ")", "{", "switch", "(", "a", "=", "x", "(", "a", ")", "){", "case", "\"", "year", "\"", ":", "this", ".", "month", "(", "0", ")", ";", "case", "\"", "quarter", "\"", ":", "case", "\"", "month", "\"", ":", "this", ".", "date", "(", "1", ")", ";", "case", "\"", "week", "\"", ":", "case", "\"", "isoWeek", "\"", ":", "case", "\"", "day", "\"", ":", "this", ".", "hours", "(", "0", ")", ";", "case", "\"", "hour", "\"", ":", "this", ".", "minutes", "(", "0", ")", ";", "case", "\"", "minute", "\"", ":", "this", ".", "seconds", "(", "0", ")", ";", "case", "\"", "second", "\"", ":", "this", ".", "milliseconds", "(", "0", ")", "}", "return", "\"", "week", "\"", "==", "=", "a", "?", "this", ".", "weekday", "(", "0", ")", ":\"", "isoWeek", "\"", "==", "=", "a", "&", "&", "this", ".", "isoWeekday", "(", "1", ")", ",\"", "quarter", "\"", "==", "=", "a", "&", "&", "this", ".", "month", "(", "3", "*", "Math", ".", "floor", "(", "this", ".", "month", "(", ")/", "3", ")", "),", "this", "}", ",", "endOf", ":", "function", "(", "b", ")", "{", "return", "b", "=", "x", "(", "b", ")", ",", "b", "=", "==", "a", "|", "|\"", "millisecond", "\"", "==", "=", "b", "?", "this", ":", "this", ".", "startOf", "(", "b", ")", ".", "add", "(", "1", ",", "\"", "isoWeek", "\"", "==", "=", "b", "?", "\"", "week", "\"", ":", "b", ")", ".", "subtract", "(", "1", ",", "\"", "ms", "\"", ")}", ",", "isAfter", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "b", "=", "x", "(", "\"", "undefined", "\"", "!=", "typeof", "b", "?", "b", ":", "\"", "millisecond", "\"", "),", "\"", "millisecond", "\"", "==", "=", "b", "?", "(", "a", "=", "tb", ".", "isMoment", "(", "a", ")", "?", "a", ":", "tb", "(", "a", ")", ",+", "this", ">", "+", "a", ")", ":(", "c", "=", "tb", ".", "isMoment", "(", "a", ")", "?+", "a", ":", "+", "tb", "(", "a", ")", ",", "c", "<", "+", "this", ".", "clone", "(", ").", "startOf", "(", "b", ")", ")}", ",", "isBefore", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "b", "=", "x", "(", "\"", "undefined", "\"", "!=", "typeof", "b", "?", "b", ":", "\"", "millisecond", "\"", "),", "\"", "millisecond", "\"", "==", "=", "b", "?", "(", "a", "=", "tb", ".", "isMoment", "(", "a", ")", "?", "a", ":", "tb", "(", "a", ")", ",+", "a", ">", "+", "this", ")", ":(", "c", "=", "tb", ".", "isMoment", "(", "a", ")", "?+", "a", ":", "+", "tb", "(", "a", ")", ",+", "this", ".", "clone", "(", ").", "endOf", "(", "b", ")", "<", "c", ")", "},", "isSame", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", ";", "return", "b", "=", "x", "(", "b", "|", "|\"", "millisecond", "\"", "),", "\"", "millisecond", "\"", "==", "=", "b", "?", "(", "a", "=", "tb", ".", "isMoment", "(", "a", ")", "?", "a", ":", "tb", "(", "a", ")", ",+", "this", "=", "==", "+", "a", ")", ":(", "c", "=", "+", "tb", "(", "a", ")", ",+", "this", ".", "clone", "(", ").", "startOf", "(", "b", ")", "<=", "c", "&", "&", "c", "<", "=+", "this", ".", "clone", "(", ").", "endOf", "(", "b", ")", ")}", ",", "min", ":", "f", "(", "\"", "moment", "(", ").", "min", "is", "deprecated", ",", "use", "moment", ".", "min", "instead", ".", "https", ":", "//", "github", ".", "com", "/", "moment", "/", "moment", "/", "issues", "/", "1548", "\"", ",", "function", "(", "a", ")", "{", "return", "a", "=", "tb", ".", "apply", "(", "null", ",", "arguments", ")", ",", "this", ">", "a", "?", "this", ":", "a", "}", "),", "max", ":", "f", "(", "\"", "moment", "(", ").", "max", "is", "deprecated", ",", "use", "moment", ".", "max", "instead", ".", "https", ":", "//", "github", ".", "com", "/", "moment", "/", "moment", "/", "issues", "/", "1548", "\"", ",", "function", "(", "a", ")", "{", "return", "a", "=", "tb", ".", "apply", "(", "null", ",", "arguments", ")", ",", "a", ">", "this", "?", "this", ":", "a", "}", "),", "zone", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", ",", "d", "=", "this", ".", "_offset", "|", "|", "0", ";", "return", "null", "=", "=", "a", "?", "this", ".", "_isUTC", "?", "d", ":", "this", ".", "_dateTzOffset", "(", "):", "(\"", "string", "\"", "==", "typeof", "a", "&", "&(", "a", "=", "Q", "(", "a", ")", "),", "Math", ".", "abs", "(", "a", ")", "<", "16", "&", "&(", "a", "=", "60", "*", "a", ")", ",!", "this", ".", "_isUTC", "&", "&", "b", "&", "&(", "c", "=", "this", ".", "_dateTzOffset", "(", "))", ",", "this", ".", "_offset", "=", "a", ",", "this", ".", "_isUTC", "=", "!", "0", ",", "null", "!", "=", "c", "&", "&", "this", ".", "subtract", "(", "c", ",", "\"", "m", "\"", "),", "d", "!", "==", "a", "&", "&(", "!", "b", "|", "|", "this", ".", "_changeInProgress", "?", "t", "(", "this", ",", "tb", ".", "duration", "(", "d", "-", "a", ",", "\"", "m", "\"", "),", "1", ",", "!", "1", ")", ":", "this", ".", "_changeInProgress", "|", "|(", "this", ".", "_changeInProgress", "=", "!", "0", ",", "tb", ".", "updateOffset", "(", "this", ",", "!", "0", ")", ",", "this", ".", "_changeInProgress", "=", "null", ")", "),", "this", ")", "},", "zoneAbbr", ":", "function", "(", "){", "return", "this", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\"}", ",", "zoneName", ":", "function", "(", "){", "return", "this", ".", "_isUTC", "?", "\"", "Coordinated", "Universal", "Time", "\"", ":\"", "\"}", ",", "parseZone", ":", "function", "(", "){", "return", "this", ".", "_tzm", "?", "this", ".", "zone", "(", "this", ".", "_tzm", ")", ":\"", "string", "\"", "==", "typeof", "this", ".", "_i", "&", "&", "this", ".", "zone", "(", "this", ".", "_i", ")", ",", "this", "}", ",", "hasAlignedHourOffset", ":", "function", "(", "a", ")", "{", "return", "a", "=", "a", "?", "tb", "(", "a", ")", ".", "zone", "(", "):", "0", ",", "(", "this", ".", "zone", "(", ")-", "a", ")", "%", "60", "=", "==", "0", "}", ",", "daysInMonth", ":", "function", "(", "){", "return", "B", "(", "this", ".", "year", "(", "),", "this", ".", "month", "(", "))", "},", "dayOfYear", ":", "function", "(", "a", ")", "{", "var", "b", "=", "yb", "(", "(", "tb", "(", "this", ")", ".", "startOf", "(", "\"", "day", "\"", ")-", "tb", "(", "this", ")", ".", "startOf", "(", "\"", "year", "\"", "))", "/", "864e5", ")", "+", "1", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "d", "\"", ")}", ",", "quarter", ":", "function", "(", "a", ")", "{", "return", "null", "=", "=", "a", "?", "Math", ".", "ceil", "(", "(", "this", ".", "month", "(", ")+", "1", ")", "/", "3", ")", ":", "this", ".", "month", "(", "3", "*", "(", "a", "-", "1", ")", "+", "this", ".", "month", "(", ")%", "3", ")", "},", "weekYear", ":", "function", "(", "a", ")", "{", "var", "b", "=", "hb", "(", "this", ",", "this", ".", "localeData", "(", ").", "_week", ".", "dow", ",", "this", ".", "localeData", "(", ").", "_week", ".", "doy", ")", ".", "year", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "y", "\"", ")}", ",", "isoWeekYear", ":", "function", "(", "a", ")", "{", "var", "b", "=", "hb", "(", "this", ",", "1", ",", "4", ")", ".", "year", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "y", "\"", ")}", ",", "week", ":", "function", "(", "a", ")", "{", "var", "b", "=", "this", ".", "localeData", "(", ").", "week", "(", "this", ")", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "7", "*", "(", "a", "-", "b", ")", ",\"", "d", "\"", ")}", ",", "isoWeek", ":", "function", "(", "a", ")", "{", "var", "b", "=", "hb", "(", "this", ",", "1", ",", "4", ")", ".", "week", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "7", "*", "(", "a", "-", "b", ")", ",\"", "d", "\"", ")}", ",", "weekday", ":", "function", "(", "a", ")", "{", "var", "b", "=", "(", "this", ".", "day", "(", ")+", "7", "-", "this", ".", "localeData", "(", ").", "_week", ".", "dow", ")", "%", "7", ";", "return", "null", "=", "=", "a", "?", "b", ":", "this", ".", "add", "(", "a", "-", "b", ",", "\"", "d", "\"", ")}", ",", "isoWeekday", ":", "function", "(", "a", ")", "{", "return", "null", "=", "=", "a", "?", "this", ".", "day", "(", ")|", "|", "7", ":", "this", ".", "day", "(", "this", ".", "day", "(", ")%", "7", "?", "a", ":", "a", "-", "7", ")", "},", "isoWeeksInYear", ":", "function", "(", "){", "return", "C", "(", "this", ".", "year", "(", "),", "1", ",", "4", ")", "},", "weeksInYear", ":", "function", "(", "){", "var", "a", "=", "this", ".", "localeData", "(", ").", "_week", ";", "return", "C", "(", "this", ".", "year", "(", "),", "a", ".", "dow", ",", "a", ".", "doy", ")", "},", "get", ":", "function", "(", "a", ")", "{", "return", "a", "=", "x", "(", "a", ")", ",", "this", "[", "a", "]", "()", "},", "set", ":", "function", "(", "a", ",", "b", ")", "{", "return", "a", "=", "x", "(", "a", ")", ",\"", "function", "\"", "==", "typeof", "this", "[", "a", "]", "&&", "this", "[", "a", "]", "(", "b", ")", ",", "this", "}", ",", "locale", ":", "function", "(", "b", ")", "{", "var", "c", ";", "return", "b", "=", "==", "a", "?", "this", ".", "_locale", ".", "_abbr", ":", "(", "c", "=", "tb", ".", "localeData", "(", "b", ")", ",", "null", "!", "=", "c", "&", "&(", "this", ".", "_locale", "=", "c", ")", ",", "this", ")", "},", "lang", ":", "f", "(", "\"", "moment", "(", ").", "lang", "(", ")", "is", "deprecated", ".", "Instead", ",", "use", "moment", "(", ").", "localeData", "(", ")", "to", "get", "the", "language", "configuration", ".", "Use", "moment", "(", ").", "locale", "(", ")", "to", "change", "languages", ".", "\",", "function", "(", "b", ")", "{", "return", "b", "=", "==", "a", "?", "this", ".", "localeData", "(", "):", "this", ".", "locale", "(", "b", ")", "})", ",", "localeData", ":", "function", "(", "){", "return", "this", ".", "_locale", "}", ",", "_dateTzOffset", ":", "function", "(", "){", "return", "15", "*", "Math", ".", "round", "(", "this", ".", "_d", ".", "getTimezoneOffset", "(", ")/", "15", ")", "}}", "),", "tb", ".", "fn", ".", "millisecond", "=", "tb", ".", "fn", ".", "milliseconds", "=", "ob", "(", "\"", "Milliseconds", "\"", ",!", "1", ")", ",", "tb", ".", "fn", ".", "second", "=", "tb", ".", "fn", ".", "seconds", "=", "ob", "(", "\"", "Seconds", "\"", ",!", "1", ")", ",", "tb", ".", "fn", ".", "minute", "=", "tb", ".", "fn", ".", "minutes", "=", "ob", "(", "\"", "Minutes", "\"", ",!", "1", ")", ",", "tb", ".", "fn", ".", "hour", "=", "tb", ".", "fn", ".", "hours", "=", "ob", "(", "\"", "Hours", "\"", ",!", "0", ")", ",", "tb", ".", "fn", ".", "date", "=", "ob", "(", "\"", "Date", "\"", ",!", "0", ")", ",", "tb", ".", "fn", ".", "dates", "=", "f", "(", "\"", "dates", "accessor", "is", "deprecated", ".", "Use", "date", "instead", ".", "\",", "ob", "(", "\"", "Date", "\"", ",!", "0", ")", "),", "tb", ".", "fn", ".", "year", "=", "ob", "(", "\"", "FullYear", "\"", ",!", "0", ")", ",", "tb", ".", "fn", ".", "years", "=", "f", "(", "\"", "years", "accessor", "is", "deprecated", ".", "Use", "year", "instead", ".", "\",", "ob", "(", "\"", "FullYear", "\"", ",!", "0", ")", "),", "tb", ".", "fn", ".", "days", "=", "tb", ".", "fn", ".", "day", ",", "tb", ".", "fn", ".", "months", "=", "tb", ".", "fn", ".", "month", ",", "tb", ".", "fn", ".", "weeks", "=", "tb", ".", "fn", ".", "week", ",", "tb", ".", "fn", ".", "isoWeeks", "=", "tb", ".", "fn", ".", "isoWeek", ",", "tb", ".", "fn", ".", "quarters", "=", "tb", ".", "fn", ".", "quarter", ",", "tb", ".", "fn", ".", "toJSON", "=", "tb", ".", "fn", ".", "toISOString", ",", "m", "(", "tb", ".", "duration", ".", "fn", "=", "l", ".", "prototype", ",", "{", "_bubble", ":", "function", "(", "){", "var", "a", ",", "b", ",", "c", ",", "d", "=", "this", ".", "_milliseconds", ",", "e", "=", "this", ".", "_days", ",", "f", "=", "this", ".", "_months", ",", "g", "=", "this", ".", "_data", ",", "h", "=", "0", ";", "g", ".", "milliseconds", "=", "d", "%", "1e3", ",", "a", "=", "o", "(", "d", "/", "1e3", ")", ",", "g", ".", "seconds", "=", "a", "%", "60", ",", "b", "=", "o", "(", "a", "/", "60", ")", ",", "g", ".", "minutes", "=", "b", "%", "60", ",", "c", "=", "o", "(", "b", "/", "60", ")", ",", "g", ".", "hours", "=", "c", "%", "24", ",", "e", "+", "=", "o", "(", "c", "/", "24", ")", ",", "h", "=", "o", "(", "pb", "(", "e", ")", "),", "e", "-", "=", "o", "(", "qb", "(", "h", ")", "),", "f", "+", "=", "o", "(", "e", "/", "30", ")", ",", "e", "%", "=", "30", ",", "h", "+", "=", "o", "(", "f", "/", "12", ")", ",", "f", "%", "=", "12", ",", "g", ".", "days", "=", "e", ",", "g", ".", "months", "=", "f", ",", "g", ".", "years", "=", "h", "}", ",", "abs", ":", "function", "(", "){", "return", "this", ".", "_milliseconds", "=", "Math", ".", "abs", "(", "this", ".", "_milliseconds", ")", ",", "this", ".", "_days", "=", "Math", ".", "abs", "(", "this", ".", "_days", ")", ",", "this", ".", "_months", "=", "Math", ".", "abs", "(", "this", ".", "_months", ")", ",", "this", ".", "_data", ".", "milliseconds", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "milliseconds", ")", ",", "this", ".", "_data", ".", "seconds", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "seconds", ")", ",", "this", ".", "_data", ".", "minutes", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "minutes", ")", ",", "this", ".", "_data", ".", "hours", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "hours", ")", ",", "this", ".", "_data", ".", "months", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "months", ")", ",", "this", ".", "_data", ".", "years", "=", "Math", ".", "abs", "(", "this", ".", "_data", ".", "years", ")", ",", "this", "}", ",", "weeks", ":", "function", "(", "){", "return", "o", "(", "this", ".", "days", "(", ")/", "7", ")", "},", "valueOf", ":", "function", "(", "){", "return", "this", ".", "_milliseconds", "+", "864e5", "*", "this", ".", "_days", "+", "this", ".", "_months", "%", "12", "*", "2592e6", "+", "31536e6", "*", "A", "(", "this", ".", "_months", "/", "12", ")", "},", "humanize", ":", "function", "(", "a", ")", "{", "var", "b", "=", "gb", "(", "this", ",", "!", "a", ",", "this", ".", "localeData", "(", "))", ";", "return", "a", "&", "&(", "b", "=", "this", ".", "localeData", "(", ").", "pastFuture", "(", "+", "this", ",", "b", ")", "),", "this", ".", "localeData", "(", ").", "postformat", "(", "b", ")", "},", "add", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", "=", "tb", ".", "duration", "(", "a", ",", "b", ")", ";", "return", "this", ".", "_milliseconds", "+", "=", "c", ".", "_milliseconds", ",", "this", ".", "_days", "+", "=", "c", ".", "_days", ",", "this", ".", "_months", "+", "=", "c", ".", "_months", ",", "this", ".", "_bubble", "(", "),", "this", "}", ",", "subtract", ":", "function", "(", "a", ",", "b", ")", "{", "var", "c", "=", "tb", ".", "duration", "(", "a", ",", "b", ")", ";", "return", "this", ".", "_milliseconds", "-", "=", "c", ".", "_milliseconds", ",", "this", ".", "_days", "-", "=", "c", ".", "_days", ",", "this", ".", "_months", "-", "=", "c", ".", "_months", ",", "this", ".", "_bubble", "(", "),", "this", "}", ",", "get", ":", "function", "(", "a", ")", "{", "return", "a", "=", "x", "(", "a", ")", ",", "this", "[", "a", ".", "toLowerCase", "(", ")+", "\"", "s", "\"", "](", ")}", ",", "as", ":", "function", "(", "a", ")", "{", "var", "b", ",", "c", ";", "if", "(", "a", "=", "x", "(", "a", ")", ",\"", "month", "\"", "==", "=", "a", "|", "|\"", "year", "\"", "==", "=", "a", ")", "return", "b", "=", "this", ".", "_days", "+", "this", ".", "_milliseconds", "/", "864e5", ",", "c", "=", "this", ".", "_months", "+", "12", "*", "pb", "(", "b", ")", ",\"", "month", "\"", "==", "=", "a", "?", "c", ":", "c", "/", "12", ";", "switch", "(", "b", "=", "this", ".", "_days", "+", "Math", ".", "round", "(", "qb", "(", "this", ".", "_months", "/", "12", ")", "),", "a", ")", "{", "case", "\"", "week", "\"", ":", "return", "b", "/", "7", "+", "this", ".", "_milliseconds", "/", "6048e5", ";", "case", "\"", "day", "\"", ":", "return", "b", "+", "this", ".", "_milliseconds", "/", "864e5", ";", "case", "\"", "hour", "\"", ":", "return", "24", "*", "b", "+", "this", ".", "_milliseconds", "/", "36e5", ";", "case", "\"", "minute", "\"", ":", "return", "24", "*", "b", "*", "60", "+", "this", ".", "_milliseconds", "/", "6e4", ";", "case", "\"", "second", "\"", ":", "return", "24", "*", "b", "*", "60", "*", "60", "+", "this", ".", "_milliseconds", "/", "1e3", ";", "case", "\"", "millisecond", "\"", ":", "return", "Math", ".", "floor", "(", "24", "*", "b", "*", "60", "*", "60", "*", "1e3", ")", "+", "this", ".", "_milliseconds", ";", "default", ":", "throw", "new", "Error", "(", "\"", "Unknown", "unit", "\"", "+", "a", ")", "}}", ",", "lang", ":", "tb", ".", "fn", ".", "lang", ",", "locale", ":", "tb", ".", "fn", ".", "locale", ",", "toIsoString", ":", "f", "(", "\"", "toIsoString", "(", ")", "is", "deprecated", ".", "Please", "use", "toISOString", "(", ")", "instead", "(", "notice", "the", "capitals", ")", "\",", "function", "(", "){", "return", "this", ".", "toISOString", "(", ")}", "),", "toISOString", ":", "function", "(", "){", "var", "a", "=", "Math", ".", "abs", "(", "this", ".", "years", "(", "))", ",", "b", "=", "Math", ".", "abs", "(", "this", ".", "months", "(", "))", ",", "c", "=", "Math", ".", "abs", "(", "this", ".", "days", "(", "))", ",", "d", "=", "Math", ".", "abs", "(", "this", ".", "hours", "(", "))", ",", "e", "=", "Math", ".", "abs", "(", "this", ".", "minutes", "(", "))", ",", "f", "=", "Math", ".", "abs", "(", "this", ".", "seconds", "(", ")+", "this", ".", "milliseconds", "(", ")/", "1e3", ")", ";", "return", "this", ".", "asSeconds", "(", ")?", "(", "this", ".", "asSeconds", "(", ")<", "0", "?", "\"-", "\":", "\"\"", ")+", "\"", "P", "\"", "+(", "a", "?", "a", "+", "\"", "Y", "\"", ":\"", "\")", "+(", "b", "?", "b", "+", "\"", "M", "\"", ":\"", "\")", "+(", "c", "?", "c", "+", "\"", "D", "\"", ":\"", "\")", "+(", "d", "|", "|", "e", "|", "|", "f", "?", "\"", "T", "\"", ":\"", "\")", "+(", "d", "?", "d", "+", "\"", "H", "\"", ":\"", "\")", "+(", "e", "?", "e", "+", "\"", "M", "\"", ":\"", "\")", "+(", "f", "?", "f", "+", "\"", "S", "\"", ":\"", "\")", ":\"", "P0D", "\"", "},", "localeData", ":", "function", "(", "){", "return", "this", ".", "_locale", "}", "})", ",", "tb", ".", "duration", ".", "fn", ".", "toString", "=", "tb", ".", "duration", ".", "fn", ".", "toISOString", ";", "for", "(", "vb", "in", "ic", ")", "c", "(", "ic", ",", "vb", ")", "&&", "rb", "(", "vb", ".", "toLowerCase", "(", "))", ";", "tb", ".", "duration", ".", "fn", ".", "asMilliseconds", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "ms", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asSeconds", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "s", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asMinutes", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "m", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asHours", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "h", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asDays", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "d", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asWeeks", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "weeks", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asMonths", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "M", "\"", ")}", ",", "tb", ".", "duration", ".", "fn", ".", "asYears", "=", "function", "(", "){", "return", "this", ".", "as", "(", "\"", "y", "\"", ")}", ",", "tb", ".", "locale", "(", "\"", "en", "\"", ",{", "ordinalParse", ":", "/\\", "d", "{", "1", ",", "2", "}", "(", "th", "|", "st", "|", "nd", "|", "rd", ")", "/,", "ordinal", ":", "function", "(", "a", ")", "{", "var", "b", "=", "a", "%", "10", ",", "c", "=", "1", "=", "==", "A", "(", "a", "%", "100", "/", "10", ")", "?\"", "th", "\"", ":", "1", "=", "==", "b", "?", "\"", "st", "\"", ":", "2", "=", "==", "b", "?", "\"", "nd", "\"", ":", "3", "=", "==", "b", "?", "\"", "rd", "\"", ":\"", "th", "\"", ";", "return", "a", "+", "c", "}", "})", ",", "Jb", "?", "module", ".", "exports", "=", "tb", ":", "\"", "function", "\"", "==", "typeof", "define", "&", "&", "define", ".", "amd", "?", "(", "define", "(", "\"", "moment", "\"", ",", "function", "(", "a", ",", "b", ",", "c", ")", "{", "return", "c", ".", "config", "&", "&", "c", ".", "config", "(", ")&", "&", "c", ".", "config", "(", ").", "noGlobal", "=", "==", "!", "0", "&", "&(", "xb", ".", "moment", "=", "ub", ")", ",", "tb", "}", "),", "sb", "(", "!", "0", ")", "):", "sb", "(", ")}", ").", "call", "(", "this", ")", ";", "\\", "No", "newline", "at", "end", "of", "file", "!", "function", "(", "e", ",", "t", ")", "{\"", "object", "\"", "==", "typeof", "exports", "&", "&\"", "undefined", "\"", "!=", "typeof", "module", "?", "module", ".", "exports", "=", "t", "(", "):", "\"", "function", "\"", "==", "typeof", "define", "&", "&", "define", ".", "amd", "?", "define", "(", "t", ")", ":", "e", ".", "moment", "=", "t", "(", ")}", "(", "this", ",", "function", "(", "){", "\"", "use", "strict", "\"", ";", "function", "e", "(", "){", "return", "Qe", ".", "apply", "(", "null", ",", "arguments", ")", "}", "function", "t", "(", "e", ")", "{", "return", "e", "instanceof", "Array", "|", "|\"", "[", "object", "Array", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "n", "(", "e", ")", "{", "return", "null", "!", "=", "e", "&", "&\"", "[", "object", "Object", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "s", "(", "e", ")", "{", "return", "void", "0", "=", "==", "e", "}", "function", "i", "(", "e", ")", "{", "return", "\"", "number", "\"", "==", "typeof", "e", "|", "|\"", "[", "object", "Number", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "r", "(", "e", ")", "{", "return", "e", "instanceof", "Date", "|", "|\"", "[", "object", "Date", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "a", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", "=", "[]", ";", "for", "(", "n", "=", "0", ";", "n", "<", "e", ".", "length", ";", "++", "n", ")", "s", ".", "push", "(", "t", "(", "e", "[", "n", "]", ",", "n", ")", ");", "return", "s", "}", "function", "o", "(", "e", ",", "t", ")", "{", "return", "Object", ".", "prototype", ".", "hasOwnProperty", ".", "call", "(", "e", ",", "t", ")", "}", "function", "u", "(", "e", ",", "t", ")", "{", "for", "(", "var", "n", "in", "t", ")", "o", "(", "t", ",", "n", ")", "&&", "(", "e", "[", "n", "]", "=", "t", "[", "n", "]", ");", "return", "o", "(", "t", ",", "\"", "toString", "\"", ")&", "&(", "e", ".", "toString", "=", "t", ".", "toString", ")", ",", "o", "(", "t", ",", "\"", "valueOf", "\"", ")&", "&(", "e", ".", "valueOf", "=", "t", ".", "valueOf", ")", ",", "e", "}", "function", "l", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "return", "ge", "(", "e", ",", "t", ",", "n", ",", "s", ",", "!", "0", ")", ".", "utc", "(", ")}", "function", "d", "(", "e", ")", "{", "return", "null", "=", "=", "e", ".", "_pf", "&", "&(", "e", ".", "_pf", "=", "{", "empty", ":", "!", "1", ",", "unusedTokens", ":", "[]", ",", "unusedInput", ":", "[]", ",", "overflow", ":", "-", "2", ",", "charsLeftOver", ":", "0", ",", "nullInput", ":", "!", "1", ",", "invalidMonth", ":", "null", ",", "invalidFormat", ":", "!", "1", ",", "userInvalidated", ":", "!", "1", ",", "iso", ":", "!", "1", ",", "parsedDateParts", ":", "[]", ",", "meridiem", ":", "null", ",", "rfc2822", ":", "!", "1", ",", "weekdayMismatch", ":", "!", "1", "}", "),", "e", ".", "_pf", "}", "function", "h", "(", "e", ")", "{", "if", "(", "null", "=", "=", "e", ".", "_isValid", ")", "{", "var", "t", "=", "d", "(", "e", ")", ",", "n", "=", "Xe", ".", "call", "(", "t", ".", "parsedDateParts", ",", "function", "(", "e", ")", "{", "return", "null", "!", "=", "e", "}", "),", "s", "=", "!", "isNaN", "(", "e", ".", "_d", ".", "getTime", "(", "))", "&&", "t", ".", "overflow", "<", "0", "&", "&!", "t", ".", "empty", "&", "&!", "t", ".", "invalidMonth", "&", "&!", "t", ".", "invalidWeekday", "&", "&!", "t", ".", "weekdayMismatch", "&", "&!", "t", ".", "nullInput", "&", "&!", "t", ".", "invalidFormat", "&", "&!", "t", ".", "userInvalidated", "&", "&(", "!", "t", ".", "meridiem", "|", "|", "t", ".", "meridiem", "&", "&", "n", ")", ";", "if", "(", "e", ".", "_strict", "&", "&(", "s", "=", "s", "&", "&", "0", "=", "==", "t", ".", "charsLeftOver", "&", "&", "0", "=", "==", "t", ".", "unusedTokens", ".", "length", "&", "&", "void", "0", "=", "==", "t", ".", "bigHour", ")", ",", "null", "!", "=", "Object", ".", "isFrozen", "&", "&", "Object", ".", "isFrozen", "(", "e", ")", ")", "return", "s", ";", "e", ".", "_isValid", "=", "s", "}", "return", "e", ".", "_isValid", "}", "function", "c", "(", "e", ")", "{", "var", "t", "=", "l", "(", "NaN", ")", ";", "return", "null", "!", "=", "e", "?", "u", "(", "d", "(", "t", ")", ",", "e", ")", ":", "d", "(", "t", ")", ".", "userInvalidated", "=", "!", "0", ",", "t", "}", "function", "f", "(", "e", ",", "t", ")", "{", "var", "n", ",", "i", ",", "r", ";", "if", "(", "s", "(", "t", ".", "_isAMomentObject", ")", "||", "(", "e", ".", "_isAMomentObject", "=", "t", ".", "_isAMomentObject", ")", ",", "s", "(", "t", ".", "_i", ")", "||", "(", "e", ".", "_i", "=", "t", ".", "_i", ")", ",", "s", "(", "t", ".", "_f", ")", "||", "(", "e", ".", "_f", "=", "t", ".", "_f", ")", ",", "s", "(", "t", ".", "_l", ")", "||", "(", "e", ".", "_l", "=", "t", ".", "_l", ")", ",", "s", "(", "t", ".", "_strict", ")", "||", "(", "e", ".", "_strict", "=", "t", ".", "_strict", ")", ",", "s", "(", "t", ".", "_tzm", ")", "||", "(", "e", ".", "_tzm", "=", "t", ".", "_tzm", ")", ",", "s", "(", "t", ".", "_isUTC", ")", "||", "(", "e", ".", "_isUTC", "=", "t", ".", "_isUTC", ")", ",", "s", "(", "t", ".", "_offset", ")", "||", "(", "e", ".", "_offset", "=", "t", ".", "_offset", ")", ",", "s", "(", "t", ".", "_pf", ")", "||", "(", "e", ".", "_pf", "=", "d", "(", "t", ")", "),", "s", "(", "t", ".", "_locale", ")", "||", "(", "e", ".", "_locale", "=", "t", ".", "_locale", ")", ",", "Ke", ".", "length", ">", "0", ")", "for", "(", "n", "=", "0", ";", "n", "<", "Ke", ".", "length", ";", "n", "+", "+)", "s", "(", "r", "=", "t", "[", "i", "=", "Ke", "[", "n", "]", "])", "||", "(", "e", "[", "i", "]", "=", "r", ")", ";", "return", "e", "}", "function", "m", "(", "t", ")", "{", "f", "(", "this", ",", "t", ")", ",", "this", ".", "_d", "=", "new", "Date", "(", "null", "!", "=", "t", ".", "_d", "?", "t", ".", "_d", ".", "getTime", "(", "):", "NaN", ")", ",", "this", ".", "isValid", "(", ")|", "|(", "this", ".", "_d", "=", "new", "Date", "(", "NaN", ")", "),", "!", "1", "=", "==", "et", "&", "&(", "et", "=", "!", "0", ",", "e", ".", "updateOffset", "(", "this", ")", ",", "et", "=", "!", "1", ")", "}", "function", "_", "(", "e", ")", "{", "return", "e", "instanceof", "m", "|", "|", "null", "!", "=", "e", "&", "&", "null", "!", "=", "e", ".", "_isAMomentObject", "}", "function", "y", "(", "e", ")", "{", "return", "e", "<", "0", "?", "Math", ".", "ceil", "(", "e", ")", "||", "0", ":", "Math", ".", "floor", "(", "e", ")", "}", "function", "g", "(", "e", ")", "{", "var", "t", "=", "+", "e", ",", "n", "=", "0", ";", "return", "0", "!", "==", "t", "&", "&", "isFinite", "(", "t", ")", "&&", "(", "n", "=", "y", "(", "t", ")", "),", "n", "}", "function", "p", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", "=", "Math", ".", "min", "(", "e", ".", "length", ",", "t", ".", "length", ")", ",", "r", "=", "Math", ".", "abs", "(", "e", ".", "length", "-", "t", ".", "length", ")", ",", "a", "=", "0", ";", "for", "(", "s", "=", "0", ";", "s", "<", "i", ";", "s", "+", "+)", "(", "n", "&", "&", "e", "[", "s", "]", "!=", "=", "t", "[", "s", "]", "||", "!", "n", "&", "&", "g", "(", "e", "[", "s", "]", ")!", "==", "g", "(", "t", "[", "s", "]", "))", "&&", "a", "+", "+;", "return", "a", "+", "r", "}", "function", "w", "(", "t", ")", "{!", "1", "=", "==", "e", ".", "suppressDeprecationWarnings", "&", "&\"", "undefined", "\"", "!=", "typeof", "console", "&", "&", "console", ".", "warn", "&", "&", "console", ".", "warn", "(", "\"", "Deprecation", "warning", ":", "\"", "+", "t", ")", "}", "function", "v", "(", "t", ",", "n", ")", "{", "var", "s", "=", "!", "0", ";", "return", "u", "(", "function", "(", "){", "if", "(", "null", "!", "=", "e", ".", "deprecationHandler", "&", "&", "e", ".", "deprecationHandler", "(", "null", ",", "t", ")", ",", "s", ")", "{", "for", "(", "var", "i", ",", "r", "=", "[]", ",", "a", "=", "0", ";", "a", "<", "arguments", ".", "length", ";", "a", "+", "+)", "{", "if", "(", "i", "=", "\"\"", ",\"", "object", "\"", "==", "typeof", "arguments", "[", "a", "]", "){", "i", "+", "=\"", "\\", "n", "[", "\"+", "a", "+", "\"]", "\"", ";", "for", "(", "var", "o", "in", "arguments", "[", "0", "]", ")", "i", "+", "=", "o", "+", "\":", "\"", "+", "arguments", "[", "0", "]", "[", "o", "]", "+\"", ",", "\"", ";", "i", "=", "i", ".", "slice", "(", "0", ",", "-", "2", ")", "}", "else", "i", "=", "arguments", "[", "a", "]", ";", "r", ".", "push", "(", "i", ")", "}", "w", "(", "t", "+", "\"\\", "nArguments", ":", "\"", "+", "Array", ".", "prototype", ".", "slice", ".", "call", "(", "r", ")", ".", "join", "(", "\"\"", ")+", "\"\\", "n", "\"", "+(", "new", "Error", ")", ".", "stack", ")", ",", "s", "=", "!", "1", "}", "return", "n", ".", "apply", "(", "this", ",", "arguments", ")", "},", "n", ")", "}", "function", "M", "(", "t", ",", "n", ")", "{", "null", "!", "=", "e", ".", "deprecationHandler", "&", "&", "e", ".", "deprecationHandler", "(", "t", ",", "n", ")", ",", "tt", "[", "t", "]", "||", "(", "w", "(", "n", ")", ",", "tt", "[", "t", "]", "=!", "0", ")", "}", "function", "k", "(", "e", ")", "{", "return", "e", "instanceof", "Function", "|", "|\"", "[", "object", "Function", "]", "\"=", "==", "Object", ".", "prototype", ".", "toString", ".", "call", "(", "e", ")", "}", "function", "S", "(", "e", ",", "t", ")", "{", "var", "s", ",", "i", "=", "u", "(", "{}", ",", "e", ")", ";", "for", "(", "s", "in", "t", ")", "o", "(", "t", ",", "s", ")", "&&", "(", "n", "(", "e", "[", "s", "]", ")&", "&", "n", "(", "t", "[", "s", "]", ")?", "(", "i", "[", "s", "]", "={", "},", "u", "(", "i", "[", "s", "]", ",", "e", "[", "s", "]", "),", "u", "(", "i", "[", "s", "]", ",", "t", "[", "s", "]", "))", ":", "null", "!", "=", "t", "[", "s", "]", "?", "i", "[", "s", "]", "=", "t", "[", "s", "]", ":", "delete", "i", "[", "s", "]", ");", "for", "(", "s", "in", "e", ")", "o", "(", "e", ",", "s", ")", "&&", "!", "o", "(", "t", ",", "s", ")", "&&", "n", "(", "e", "[", "s", "]", ")&", "&(", "i", "[", "s", "]", "=", "u", "(", "{}", ",", "i", "[", "s", "]", "))", ";", "return", "i", "}", "function", "D", "(", "e", ")", "{", "null", "!", "=", "e", "&", "&", "this", ".", "set", "(", "e", ")", "}", "function", "Y", "(", "e", ",", "t", ")", "{", "var", "n", "=", "e", ".", "toLowerCase", "(", ");", "st", "[", "n", "]", "=", "st", "[", "n", "+", "\"", "s", "\"", "]=", "st", "[", "t", "]", "=", "e", "}", "function", "O", "(", "e", ")", "{", "return", "\"", "string", "\"", "==", "typeof", "e", "?", "st", "[", "e", "]", "||", "st", "[", "e", ".", "toLowerCase", "(", ")]", ":", "void", "0", "}", "function", "x", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", "=", "{}", ";", "for", "(", "n", "in", "e", ")", "o", "(", "e", ",", "n", ")", "&&", "(", "t", "=", "O", "(", "n", ")", ")&", "&(", "s", "[", "t", "]", "=", "e", "[", "n", "]", ");", "return", "s", "}", "function", "T", "(", "e", ",", "t", ")", "{", "it", "[", "e", "]", "=", "t", "}", "function", "b", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "\"\"", "+", "Math", ".", "abs", "(", "e", ")", ",", "i", "=", "t", "-", "s", ".", "length", ";", "return", "(", "e", ">", "=", "0", "?", "n", "?", "\"+", "\":", "\"\"", ":\"", "-\"", ")+", "Math", ".", "pow", "(", "10", ",", "Math", ".", "max", "(", "0", ",", "i", ")", ").", "toString", "(", ").", "substr", "(", "1", ")", "+", "s", "}", "function", "P", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "s", ";", "\"", "string", "\"", "==", "typeof", "s", "&", "&(", "i", "=", "function", "(", "){", "return", "this", "[", "s", "]", "()", "})", ",", "e", "&", "&(", "ut", "[", "e", "]", "=", "i", ")", ",", "t", "&", "&(", "ut", "[", "t", "[", "0", "]", "]=", "function", "(", "){", "return", "b", "(", "i", ".", "apply", "(", "this", ",", "arguments", ")", ",", "t", "[", "1", "]", ",", "t", "[", "2", "]", ")}", "),", "n", "&", "&(", "ut", "[", "n", "]", "=", "function", "(", "){", "return", "this", ".", "localeData", "(", ").", "ordinal", "(", "i", ".", "apply", "(", "this", ",", "arguments", ")", ",", "e", ")", "})", "}", "function", "W", "(", "e", ")", "{", "return", "e", ".", "match", "(", "/\\", "[[", "\\", "s", "\\", "S", "]", "/)", "?", "e", ".", "replace", "(", "/^", "\\[", "|\\", "]$", "/", "g", ",", "\"\"", "):", "e", ".", "replace", "(", "/\\", "\\/", "g", ",", "\"\"", ")}", "function", "R", "(", "e", ",", "t", ")", "{", "return", "e", ".", "isValid", "(", ")?", "(", "t", "=", "C", "(", "t", ",", "e", ".", "localeData", "(", "))", ",", "ot", "[", "t", "]", "=", "ot", "[", "t", "]", "||", "function", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", "=", "e", ".", "match", "(", "rt", ")", ";", "for", "(", "t", "=", "0", ",", "n", "=", "s", ".", "length", ";", "t", "<", "n", ";", "t", "+", "+)", "ut", "[", "s", "[", "t", "]", "]?", "s", "[", "t", "]", "=", "ut", "[", "s", "[", "t", "]", "]:", "s", "[", "t", "]", "=", "W", "(", "s", "[", "t", "]", ");", "return", "function", "(", "t", ")", "{", "var", "i", ",", "r", "=", "\"\"", ";", "for", "(", "i", "=", "0", ";", "i", "<", "n", ";", "i", "+", "+)", "r", "+", "=", "k", "(", "s", "[", "i", "]", ")?", "s", "[", "i", "]", ".", "call", "(", "t", ",", "e", ")", ":", "s", "[", "i", "]", ";", "return", "r", "}", "}(", "t", ")", ",", "ot", "[", "t", "]", "(", "e", ")", "):", "e", ".", "localeData", "(", ").", "invalidDate", "(", ")}", "function", "C", "(", "e", ",", "t", ")", "{", "function", "n", "(", "e", ")", "{", "return", "t", ".", "longDateFormat", "(", "e", ")", "||", "e", "}", "var", "s", "=", "5", ";", "for", "(", "at", ".", "lastIndex", "=", "0", ";", "s", ">", "=", "0", "&", "&", "at", ".", "test", "(", "e", ")", ";)", "e", "=", "e", ".", "replace", "(", "at", ",", "n", ")", ",", "at", ".", "lastIndex", "=", "0", ",", "s", "-", "=", "1", ";", "return", "e", "}", "function", "F", "(", "e", ",", "t", ",", "n", ")", "{", "Yt", "[", "e", "]", "=", "k", "(", "t", ")", "?", "t", ":", "function", "(", "e", ",", "s", ")", "{", "return", "e", "&", "&", "n", "?", "n", ":", "t", "}", "}", "function", "U", "(", "e", ",", "t", ")", "{", "return", "o", "(", "Yt", ",", "e", ")", "?", "Yt", "[", "e", "]", "(", "t", ".", "_strict", ",", "t", ".", "_locale", ")", ":", "new", "RegExp", "(", "function", "(", "e", ")", "{", "return", "N", "(", "e", ".", "replace", "(", "\"\\", "\\\"", ",\"", "\")", ".", "replace", "(", "/\\", "\\(", "\\[", ")|", "\\\\", "(\\", "])", "|\\", "[(", "[^", "\\]", "\\[", "]*", ")\\", "]|", "\\\\", "(.", ")/", "g", ",", "function", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "return", "t", "|", "|", "n", "|", "|", "s", "|", "|", "i", "}", "))", "}(", "e", ")", ")}", "function", "N", "(", "e", ")", "{", "return", "e", ".", "replace", "(", "/[", "-\\", "/\\", "\\^", "$*", "+?", ".(", ")|", "[\\", "]{", "}]", "/", "g", ",", "\"\\", "\\$", "&\"", ")}", "function", "H", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", "=", "t", ";", "for", "(", "\"", "string", "\"", "==", "typeof", "e", "&", "&(", "e", "=", "[", "e", "]", "),", "i", "(", "t", ")", "&&", "(", "s", "=", "function", "(", "e", ",", "n", ")", "{", "n", "[", "t", "]", "=", "g", "(", "e", ")", "})", ",", "n", "=", "0", ";", "n", "<", "e", ".", "length", ";", "n", "+", "+)", "Ot", "[", "e", "[", "n", "]", "]=", "s", "}", "function", "L", "(", "e", ",", "t", ")", "{", "H", "(", "e", ",", "function", "(", "e", ",", "n", ",", "s", ",", "i", ")", "{", "s", ".", "_w", "=", "s", ".", "_w", "|", "|{", "},", "t", "(", "e", ",", "s", ".", "_w", ",", "s", ",", "i", ")", "})", "}", "function", "G", "(", "e", ",", "t", ",", "n", ")", "{", "null", "!", "=", "t", "&", "&", "o", "(", "Ot", ",", "e", ")", "&&", "Ot", "[", "e", "]", "(", "t", ",", "n", ".", "_a", ",", "n", ",", "e", ")", "}", "function", "V", "(", "e", ")", "{", "return", "j", "(", "e", ")", "?", "366", ":", "365", "}", "function", "j", "(", "e", ")", "{", "return", "e", "%", "4", "=", "=", "0", "&", "&", "e", "%", "100", "!", "=", "0", "|", "|", "e", "%", "400", "=", "=", "0", "}", "function", "I", "(", "t", ",", "n", ")", "{", "return", "function", "(", "s", ")", "{", "return", "null", "!", "=", "s", "?", "(", "A", "(", "this", ",", "t", ",", "s", ")", ",", "e", ".", "updateOffset", "(", "this", ",", "n", ")", ",", "this", ")", ":", "E", "(", "this", ",", "t", ")", "}}", "function", "E", "(", "e", ",", "t", ")", "{", "return", "e", ".", "isValid", "(", ")?", "e", ".", "_d", "[", "\"", "get", "\"", "+(", "e", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "t", "]", "()", ":", "NaN", "}", "function", "A", "(", "e", ",", "t", ",", "n", ")", "{", "e", ".", "isValid", "(", ")&", "&!", "isNaN", "(", "n", ")", "&&", "(\"", "FullYear", "\"", "==", "=", "t", "&", "&", "j", "(", "e", ".", "year", "(", "))", "&&", "1", "=", "==", "e", ".", "month", "(", ")&", "&", "29", "=", "==", "e", ".", "date", "(", ")?", "e", ".", "_d", "[", "\"", "set", "\"", "+(", "e", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "t", "]", "(", "n", ",", "e", ".", "month", "(", "),", "z", "(", "n", ",", "e", ".", "month", "(", "))", "):", "e", ".", "_d", "[", "\"", "set", "\"", "+(", "e", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+", "t", "]", "(", "n", ")", ")}", "function", "z", "(", "e", ",", "t", ")", "{", "if", "(", "isNaN", "(", "e", ")", "||", "isNaN", "(", "t", ")", ")", "return", "NaN", ";", "var", "n", "=", "function", "(", "e", ",", "t", ")", "{", "return", "(", "e", "%", "t", "+", "t", ")", "%", "t", "}", "(", "t", ",", "12", ")", ";", "return", "e", "+", "=(", "t", "-", "n", ")", "/", "12", ",", "1", "=", "==", "n", "?", "j", "(", "e", ")", "?", "29", ":", "28", ":", "31", "-", "n", "%", "7", "%", "2", "}", "function", "Z", "(", "e", ",", "t", ")", "{", "var", "n", ";", "if", "(", "!", "e", ".", "isValid", "(", "))", "return", "e", ";", "if", "(", "\"", "string", "\"", "==", "typeof", "t", ")", "if", "(", "/^", "\\", "d", "+", "$/", ".", "test", "(", "t", ")", ")", "t", "=", "g", "(", "t", ")", ";", "else", "if", "(", "t", "=", "e", ".", "localeData", "(", ").", "monthsParse", "(", "t", ")", ",!", "i", "(", "t", ")", ")", "return", "e", ";", "return", "n", "=", "Math", ".", "min", "(", "e", ".", "date", "(", "),", "z", "(", "e", ".", "year", "(", "),", "t", ")", "),", "e", ".", "_d", "[", "\"", "set", "\"", "+(", "e", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\")", "+\"", "Month", "\"", "](", "t", ",", "n", ")", ",", "e", "}", "function", "$", "(", "t", ")", "{", "return", "null", "!", "=", "t", "?", "(", "Z", "(", "this", ",", "t", ")", ",", "e", ".", "updateOffset", "(", "this", ",", "!", "0", ")", ",", "this", ")", ":", "E", "(", "this", ",", "\"", "Month", "\"", ")}", "function", "q", "(", "){", "function", "e", "(", "e", ",", "t", ")", "{", "return", "t", ".", "length", "-", "e", ".", "length", "}", "var", "t", ",", "n", ",", "s", "=", "[]", ",", "i", "=", "[]", ",", "r", "=", "[]", ";", "for", "(", "t", "=", "0", ";", "t", "<", "12", ";", "t", "+", "+)", "n", "=", "l", "(", "[", "2e3", ",", "t", "]", "),", "s", ".", "push", "(", "this", ".", "monthsShort", "(", "n", ",", "\"\"", "))", ",", "i", ".", "push", "(", "this", ".", "months", "(", "n", ",", "\"\"", "))", ",", "r", ".", "push", "(", "this", ".", "months", "(", "n", ",", "\"\"", "))", ",", "r", ".", "push", "(", "this", ".", "monthsShort", "(", "n", ",", "\"\"", "))", ";", "for", "(", "s", ".", "sort", "(", "e", ")", ",", "i", ".", "sort", "(", "e", ")", ",", "r", ".", "sort", "(", "e", ")", ",", "t", "=", "0", ";", "t", "<", "12", ";", "t", "+", "+)", "s", "[", "t", "]", "=", "N", "(", "s", "[", "t", "]", "),", "i", "[", "t", "]", "=", "N", "(", "i", "[", "t", "]", ");", "for", "(", "t", "=", "0", ";", "t", "<", "24", ";", "t", "+", "+)", "r", "[", "t", "]", "=", "N", "(", "r", "[", "t", "]", ");", "this", ".", "_monthsRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "r", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_monthsShortRegex", "=", "this", ".", "_monthsRegex", ",", "this", ".", "_monthsStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "i", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_monthsShortStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "s", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", ")}", "function", "J", "(", "e", ")", "{", "var", "t", "=", "new", "Date", "(", "Date", ".", "UTC", ".", "apply", "(", "null", ",", "arguments", ")", ");", "return", "e", "<", "100", "&", "&", "e", ">", "=", "0", "&", "&", "isFinite", "(", "t", ".", "getUTCFullYear", "(", "))", "&&", "t", ".", "setUTCFullYear", "(", "e", ")", ",", "t", "}", "function", "B", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "7", "+", "t", "-", "n", ";", "return", "-", "((", "7", "+", "J", "(", "e", ",", "0", ",", "s", ")", ".", "getUTCDay", "(", ")-", "t", ")", "%", "7", ")", "+", "s", "-", "1", "}", "function", "Q", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "var", "r", ",", "a", ",", "o", "=", "1", "+", "7", "*", "(", "t", "-", "1", ")", "+(", "7", "+", "n", "-", "s", ")", "%", "7", "+", "B", "(", "e", ",", "s", ",", "i", ")", ";", "return", "o", "<", "=", "0", "?", "a", "=", "V", "(", "r", "=", "e", "-", "1", ")", "+", "o", ":", "o", ">", "V", "(", "e", ")", "?(", "r", "=", "e", "+", "1", ",", "a", "=", "o", "-", "V", "(", "e", ")", "):", "(", "r", "=", "e", ",", "a", "=", "o", ")", ",{", "year", ":", "r", ",", "dayOfYear", ":", "a", "}", "}", "function", "X", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", "=", "B", "(", "e", ".", "year", "(", "),", "t", ",", "n", ")", ",", "a", "=", "Math", ".", "floor", "(", "(", "e", ".", "dayOfYear", "(", ")-", "r", "-", "1", ")", "/", "7", ")", "+", "1", ";", "return", "a", "<", "1", "?", "s", "=", "a", "+", "K", "(", "i", "=", "e", ".", "year", "(", ")-", "1", ",", "t", ",", "n", ")", ":", "a", ">", "K", "(", "e", ".", "year", "(", "),", "t", ",", "n", ")", "?(", "s", "=", "a", "-", "K", "(", "e", ".", "year", "(", "),", "t", ",", "n", ")", ",", "i", "=", "e", ".", "year", "(", ")+", "1", ")", ":(", "i", "=", "e", ".", "year", "(", "),", "s", "=", "a", ")", ",{", "week", ":", "s", ",", "year", ":", "i", "}", "}", "function", "K", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "B", "(", "e", ",", "t", ",", "n", ")", ",", "i", "=", "B", "(", "e", "+", "1", ",", "t", ",", "n", ")", ";", "return", "(", "V", "(", "e", ")", "-", "s", "+", "i", ")", "/", "7", "}", "function", "ee", "(", "){", "function", "e", "(", "e", ",", "t", ")", "{", "return", "t", ".", "length", "-", "e", ".", "length", "}", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", "=", "[]", ",", "o", "=", "[]", ",", "u", "=", "[]", ",", "d", "=", "[]", ";", "for", "(", "t", "=", "0", ";", "t", "<", "7", ";", "t", "+", "+)", "n", "=", "l", "(", "[", "2e3", ",", "1", "]", ").", "day", "(", "t", ")", ",", "s", "=", "this", ".", "weekdaysMin", "(", "n", ",", "\"\"", "),", "i", "=", "this", ".", "weekdaysShort", "(", "n", ",", "\"\"", "),", "r", "=", "this", ".", "weekdays", "(", "n", ",", "\"\"", "),", "a", ".", "push", "(", "s", ")", ",", "o", ".", "push", "(", "i", ")", ",", "u", ".", "push", "(", "r", ")", ",", "d", ".", "push", "(", "s", ")", ",", "d", ".", "push", "(", "i", ")", ",", "d", ".", "push", "(", "r", ")", ";", "for", "(", "a", ".", "sort", "(", "e", ")", ",", "o", ".", "sort", "(", "e", ")", ",", "u", ".", "sort", "(", "e", ")", ",", "d", ".", "sort", "(", "e", ")", ",", "t", "=", "0", ";", "t", "<", "7", ";", "t", "+", "+)", "o", "[", "t", "]", "=", "N", "(", "o", "[", "t", "]", "),", "u", "[", "t", "]", "=", "N", "(", "u", "[", "t", "]", "),", "d", "[", "t", "]", "=", "N", "(", "d", "[", "t", "]", ");", "this", ".", "_weekdaysRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "d", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_weekdaysShortRegex", "=", "this", ".", "_weekdaysRegex", ",", "this", ".", "_weekdaysMinRegex", "=", "this", ".", "_weekdaysRegex", ",", "this", ".", "_weekdaysStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "u", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_weekdaysShortStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "o", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", "),", "this", ".", "_weekdaysMinStrictRegex", "=", "new", "RegExp", "(", "\"^", "(\"", "+", "a", ".", "join", "(", "\"|", "\")", "+\"", ")\"", ",\"", "i", "\"", ")}", "function", "te", "(", "){", "return", "this", ".", "hours", "(", ")%", "12", "|", "|", "12", "}", "function", "ne", "(", "e", ",", "t", ")", "{", "P", "(", "e", ",", "0", ",", "0", ",", "function", "(", "){", "return", "this", ".", "localeData", "(", ").", "meridiem", "(", "this", ".", "hours", "(", "),", "this", ".", "minutes", "(", "),", "t", ")", "})", "}", "function", "se", "(", "e", ",", "t", ")", "{", "return", "t", ".", "_meridiemParse", "}", "function", "ie", "(", "e", ")", "{", "return", "e", "?", "e", ".", "toLowerCase", "(", ").", "replace", "(", "\"", "_", "\"", ",\"", "-\"", "):", "e", "}", "function", "re", "(", "e", ")", "{", "var", "t", "=", "null", ";", "if", "(", "!", "Xt", "[", "e", "]", "&&", "\"", "undefined", "\"", "!=", "typeof", "module", "&", "&", "module", "&", "&", "module", ".", "exports", ")", "try", "{", "t", "=", "Jt", ".", "_abbr", ";", "require", "(", "\".", "/", "locale", "/", "\"+", "e", ")", ",", "ae", "(", "t", ")", "}", "catch", "(", "e", ")", "{}", "return", "Xt", "[", "e", "]", "}", "function", "ae", "(", "e", ",", "t", ")", "{", "var", "n", ";", "return", "e", "&", "&(", "n", "=", "s", "(", "t", ")", "?", "ue", "(", "e", ")", ":", "oe", "(", "e", ",", "t", ")", ")&", "&(", "Jt", "=", "n", ")", ",", "Jt", ".", "_abbr", "}", "function", "oe", "(", "e", ",", "t", ")", "{", "if", "(", "null", "!", "==", "t", ")", "{", "var", "n", "=", "Qt", ";", "if", "(", "t", ".", "abbr", "=", "e", ",", "null", "!", "=", "Xt", "[", "e", "]", ")", "M", "(", "\"", "defineLocaleOverride", "\"", ",\"", "use", "moment", ".", "updateLocale", "(", "localeName", ",", "config", ")", "to", "change", "an", "existing", "locale", ".", "moment", ".", "defineLocale", "(", "localeName", ",", "config", ")", "should", "only", "be", "used", "for", "creating", "a", "new", "locale", "See", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "define", "-", "locale", "/", "for", "more", "info", ".", "\")", ",", "n", "=", "Xt", "[", "e", "]", ".", "_config", ";", "else", "if", "(", "null", "!", "=", "t", ".", "parentLocale", ")", "{", "if", "(", "null", "=", "=", "Xt", "[", "t", ".", "parentLocale", "]", ")", "return", "Kt", "[", "t", ".", "parentLocale", "]", "||", "(", "Kt", "[", "t", ".", "parentLocale", "]", "=[", "])", ",", "Kt", "[", "t", ".", "parentLocale", "]", ".", "push", "(", "{", "name", ":", "e", ",", "config", ":", "t", "}", "),", "null", ";", "n", "=", "Xt", "[", "t", ".", "parentLocale", "]", ".", "_config", "}", "return", "Xt", "[", "e", "]", "=", "new", "D", "(", "S", "(", "n", ",", "t", ")", "),", "Kt", "[", "e", "]", "&&", "Kt", "[", "e", "]", ".", "forEach", "(", "function", "(", "e", ")", "{", "oe", "(", "e", ".", "name", ",", "e", ".", "config", ")", "})", ",", "ae", "(", "e", ")", ",", "Xt", "[", "e", "]", "}", "return", "delete", "Xt", "[", "e", "]", ",", "null", "}", "function", "ue", "(", "e", ")", "{", "var", "n", ";", "if", "(", "e", "&", "&", "e", ".", "_locale", "&", "&", "e", ".", "_locale", ".", "_abbr", "&", "&(", "e", "=", "e", ".", "_locale", ".", "_abbr", ")", ",!", "e", ")", "return", "Jt", ";", "if", "(", "!", "t", "(", "e", ")", "){", "if", "(", "n", "=", "re", "(", "e", ")", ")", "return", "n", ";", "e", "=", "[", "e", "]", "}", "return", "function", "(", "e", ")", "{", "for", "(", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", "=", "0", ";", "r", "<", "e", ".", "length", ";", "){", "for", "(", "t", "=", "(", "i", "=", "ie", "(", "e", "[", "r", "]", ").", "split", "(", "\"-", "\")", ").", "length", ",", "n", "=", "(", "n", "=", "ie", "(", "e", "[", "r", "+", "1", "]", "))", "?", "n", ".", "split", "(", "\"-", "\")", ":", "null", ";", "t", ">", "0", ";", "){", "if", "(", "s", "=", "re", "(", "i", ".", "slice", "(", "0", ",", "t", ")", ".", "join", "(", "\"-", "\")", "))", "return", "s", ";", "if", "(", "n", "&", "&", "n", ".", "length", ">", "=", "t", "&", "&", "p", "(", "i", ",", "n", ",", "!", "0", ")", ">=", "t", "-", "1", ")", "break", ";", "t", "-", "-}", "r", "+", "+}", "return", "null", "}", "(", "e", ")", "}", "function", "le", "(", "e", ")", "{", "var", "t", ",", "n", "=", "e", ".", "_a", ";", "return", "n", "&", "&-", "2", "=", "==", "d", "(", "e", ")", ".", "overflow", "&", "&(", "t", "=", "n", "[", "Tt", "]", "<", "0", "|", "|", "n", "[", "Tt", "]", ">", "11", "?", "Tt", ":", "n", "[", "bt", "]", "<", "1", "|", "|", "n", "[", "bt", "]", ">", "z", "(", "n", "[", "xt", "]", ",", "n", "[", "Tt", "]", ")?", "bt", ":", "n", "[", "Pt", "]", "<", "0", "|", "|", "n", "[", "Pt", "]", ">", "24", "|", "|", "24", "=", "==", "n", "[", "Pt", "]", "&&", "(", "0", "!", "==", "n", "[", "Wt", "]", "||", "0", "!", "==", "n", "[", "Rt", "]", "||", "0", "!", "==", "n", "[", "Ct", "]", ")?", "Pt", ":", "n", "[", "Wt", "]", "<", "0", "|", "|", "n", "[", "Wt", "]", ">", "59", "?", "Wt", ":", "n", "[", "Rt", "]", "<", "0", "|", "|", "n", "[", "Rt", "]", ">", "59", "?", "Rt", ":", "n", "[", "Ct", "]", "<", "0", "|", "|", "n", "[", "Ct", "]", ">", "999", "?", "Ct", ":", "-", "1", ",", "d", "(", "e", ")", ".", "_overflowDayOfYear", "&", "&(", "t", "<", "xt", "|", "|", "t", ">", "bt", ")", "&&", "(", "t", "=", "bt", ")", ",", "d", "(", "e", ")", ".", "_overflowWeeks", "&", "&-", "1", "=", "==", "t", "&", "&(", "t", "=", "Ft", ")", ",", "d", "(", "e", ")", ".", "_overflowWeekday", "&", "&-", "1", "=", "==", "t", "&", "&(", "t", "=", "Ut", ")", ",", "d", "(", "e", ")", ".", "overflow", "=", "t", ")", ",", "e", "}", "function", "de", "(", "e", ",", "t", ",", "n", ")", "{", "return", "null", "!", "=", "e", "?", "e", ":", "null", "!", "=", "t", "?", "t", ":", "n", "}", "function", "he", "(", "t", ")", "{", "var", "n", ",", "s", ",", "i", ",", "r", ",", "a", "=", "[]", ";", "if", "(", "!", "t", ".", "_d", ")", "{", "for", "(", "i", "=", "function", "(", "t", ")", "{", "var", "n", "=", "new", "Date", "(", "e", ".", "now", "(", "))", ";", "return", "t", ".", "_useUTC", "?", "[", "n", ".", "getUTCFullYear", "(", "),", "n", ".", "getUTCMonth", "(", "),", "n", ".", "getUTCDate", "(", ")]", ":[", "n", ".", "getFullYear", "(", "),", "n", ".", "getMonth", "(", "),", "n", ".", "getDate", "(", ")]", "}(", "t", ")", ",", "t", ".", "_w", "&", "&", "null", "=", "=", "t", ".", "_a", "[", "bt", "]", "&&", "null", "=", "=", "t", ".", "_a", "[", "Tt", "]", "&&", "function", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", ",", "o", ",", "u", ";", "if", "(", "null", "!", "=(", "t", "=", "e", ".", "_w", ")", ".", "GG", "|", "|", "null", "!", "=", "t", ".", "W", "|", "|", "null", "!", "=", "t", ".", "E", ")", "r", "=", "1", ",", "a", "=", "4", ",", "n", "=", "de", "(", "t", ".", "GG", ",", "e", ".", "_a", "[", "xt", "]", ",", "X", "(", "pe", "(", "),", "1", ",", "4", ")", ".", "year", ")", ",", "s", "=", "de", "(", "t", ".", "W", ",", "1", ")", ",(", "(", "i", "=", "de", "(", "t", ".", "E", ",", "1", ")", ")<", "1", "|", "|", "i", ">", "7", ")", "&&", "(", "u", "=", "!", "0", ")", ";", "else", "{", "r", "=", "e", ".", "_locale", ".", "_week", ".", "dow", ",", "a", "=", "e", ".", "_locale", ".", "_week", ".", "doy", ";", "var", "l", "=", "X", "(", "pe", "(", "),", "r", ",", "a", ")", ";", "n", "=", "de", "(", "t", ".", "gg", ",", "e", ".", "_a", "[", "xt", "]", ",", "l", ".", "year", ")", ",", "s", "=", "de", "(", "t", ".", "w", ",", "l", ".", "week", ")", ",", "null", "!", "=", "t", ".", "d", "?", "((", "i", "=", "t", ".", "d", ")", "<", "0", "|", "|", "i", ">", "6", ")", "&&", "(", "u", "=", "!", "0", ")", ":", "null", "!", "=", "t", ".", "e", "?", "(", "i", "=", "t", ".", "e", "+", "r", ",", "(", "t", ".", "e", "<", "0", "|", "|", "t", ".", "e", ">", "6", ")", "&&", "(", "u", "=", "!", "0", ")", "):", "i", "=", "r", "}", "s", "<", "1", "|", "|", "s", ">", "K", "(", "n", ",", "r", ",", "a", ")", "?", "d", "(", "e", ")", ".", "_overflowWeeks", "=", "!", "0", ":", "null", "!", "=", "u", "?", "d", "(", "e", ")", ".", "_overflowWeekday", "=", "!", "0", ":", "(", "o", "=", "Q", "(", "n", ",", "s", ",", "i", ",", "r", ",", "a", ")", ",", "e", ".", "_a", "[", "xt", "]", "=", "o", ".", "year", ",", "e", ".", "_dayOfYear", "=", "o", ".", "dayOfYear", ")", "}(", "t", ")", ",", "null", "!", "=", "t", ".", "_dayOfYear", "&", "&(", "r", "=", "de", "(", "t", ".", "_a", "[", "xt", "]", ",", "i", "[", "xt", "]", "),", "(", "t", ".", "_dayOfYear", ">", "V", "(", "r", ")", "||", "0", "=", "==", "t", ".", "_dayOfYear", ")", "&&", "(", "d", "(", "t", ")", ".", "_overflowDayOfYear", "=", "!", "0", ")", ",", "s", "=", "J", "(", "r", ",", "0", ",", "t", ".", "_dayOfYear", ")", ",", "t", ".", "_a", "[", "Tt", "]", "=", "s", ".", "getUTCMonth", "(", "),", "t", ".", "_a", "[", "bt", "]", "=", "s", ".", "getUTCDate", "(", "))", ",", "n", "=", "0", ";", "n", "<", "3", "&", "&", "null", "=", "=", "t", ".", "_a", "[", "n", "]", ";+", "+", "n", ")", "t", ".", "_a", "[", "n", "]", "=", "a", "[", "n", "]", "=", "i", "[", "n", "]", ";", "for", "(", ";", "n", "<", "7", ";", "n", "+", "+)", "t", ".", "_a", "[", "n", "]", "=", "a", "[", "n", "]", "=", "null", "=", "=", "t", ".", "_a", "[", "n", "]", "?", "2", "=", "==", "n", "?", "1", ":", "0", ":", "t", ".", "_a", "[", "n", "]", ";", "24", "=", "==", "t", ".", "_a", "[", "Pt", "]", "&&", "0", "=", "==", "t", ".", "_a", "[", "Wt", "]", "&&", "0", "=", "==", "t", ".", "_a", "[", "Rt", "]", "&&", "0", "=", "==", "t", ".", "_a", "[", "Ct", "]", "&&", "(", "t", ".", "_nextDay", "=", "!", "0", ",", "t", ".", "_a", "[", "Pt", "]", "=", "0", ")", ",", "t", ".", "_d", "=", "(", "t", ".", "_useUTC", "?", "J", ":", "function", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", ")", "{", "var", "o", "=", "new", "Date", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", ")", ";", "return", "e", "<", "100", "&", "&", "e", ">", "=", "0", "&", "&", "isFinite", "(", "o", ".", "getFullYear", "(", "))", "&&", "o", ".", "setFullYear", "(", "e", ")", ",", "o", "}", ").", "apply", "(", "null", ",", "a", ")", ",", "null", "!", "=", "t", ".", "_tzm", "&", "&", "t", ".", "_d", ".", "setUTCMinutes", "(", "t", ".", "_d", ".", "getUTCMinutes", "(", ")-", "t", ".", "_tzm", ")", ",", "t", ".", "_nextDay", "&", "&(", "t", ".", "_a", "[", "Pt", "]", "=", "24", ")", ",", "t", ".", "_w", "&", "&", "void", "0", "!", "==", "t", ".", "_w", ".", "d", "&", "&", "t", ".", "_w", ".", "d", "!", "==", "t", ".", "_d", ".", "getDay", "(", ")&", "&(", "d", "(", "t", ")", ".", "weekdayMismatch", "=", "!", "0", ")", "}}", "function", "ce", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", ",", "a", ",", "o", "=", "e", ".", "_i", ",", "u", "=", "en", ".", "exec", "(", "o", ")", "||", "tn", ".", "exec", "(", "o", ")", ";", "if", "(", "u", ")", "{", "for", "(", "d", "(", "e", ")", ".", "iso", "=", "!", "0", ",", "t", "=", "0", ",", "n", "=", "sn", ".", "length", ";", "t", "<", "n", ";", "t", "+", "+)", "if", "(", "sn", "[", "t", "]", "[", "1", "]", ".", "exec", "(", "u", "[", "1", "]", "))", "{", "i", "=", "sn", "[", "t", "]", "[", "0", "]", ",", "s", "=", "!", "1", "!", "==", "sn", "[", "t", "]", "[", "2", "]", ";", "break", "}", "if", "(", "null", "=", "=", "i", ")", "return", "void", "(", "e", ".", "_isValid", "=", "!", "1", ")", ";", "if", "(", "u", "[", "3", "]", "){", "for", "(", "t", "=", "0", ",", "n", "=", "rn", ".", "length", ";", "t", "<", "n", ";", "t", "+", "+)", "if", "(", "rn", "[", "t", "]", "[", "1", "]", ".", "exec", "(", "u", "[", "3", "]", "))", "{", "r", "=", "(", "u", "[", "2", "]", "||", "\"", "\"", ")+", "rn", "[", "t", "]", "[", "0", "]", ";", "break", "}", "if", "(", "null", "=", "=", "r", ")", "return", "void", "(", "e", ".", "_isValid", "=", "!", "1", ")", "}", "if", "(", "!", "s", "&", "&", "null", "!", "=", "r", ")", "return", "void", "(", "e", ".", "_isValid", "=", "!", "1", ")", ";", "if", "(", "u", "[", "4", "]", "){", "if", "(", "!", "nn", ".", "exec", "(", "u", "[", "4", "]", "))", "return", "void", "(", "e", ".", "_isValid", "=", "!", "1", ")", ";", "a", "=", "\"", "Z", "\"", "}", "e", ".", "_f", "=", "i", "+", "(", "r", "|", "|\"", "\")", "+(", "a", "|", "|\"", "\")", ",", "_e", "(", "e", ")", "}", "else", "e", ".", "_isValid", "=", "!", "1", "}", "function", "fe", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ",", "r", ")", "{", "var", "a", "=", "[", "function", "(", "e", ")", "{", "var", "t", "=", "parseInt", "(", "e", ",", "10", ")", ";{", "if", "(", "t", "<", "=", "49", ")", "return", "2e3", "+", "t", ";", "if", "(", "t", "<", "=", "999", ")", "return", "1900", "+", "t", "}", "return", "t", "}", "(", "e", ")", ",", "Vt", ".", "indexOf", "(", "t", ")", ",", "parseInt", "(", "n", ",", "10", ")", ",", "parseInt", "(", "s", ",", "10", ")", ",", "parseInt", "(", "i", ",", "10", ")", "];", "return", "r", "&", "&", "a", ".", "push", "(", "parseInt", "(", "r", ",", "10", ")", "),", "a", "}", "function", "me", "(", "e", ")", "{", "var", "t", "=", "on", ".", "exec", "(", "function", "(", "e", ")", "{", "return", "e", ".", "replace", "(", "/\\", "([", "^)", "]*", "\\)", "|[", "\\", "n", "\\", "t", "]", "/", "g", ",", "\"", "\"", ").", "replace", "(", "/(", "\\", "s", "\\", "s", "+", ")/", "g", ",", "\"", "\"", ").", "trim", "(", ")}", "(", "e", ".", "_i", ")", ");", "if", "(", "t", ")", "{", "var", "n", "=", "fe", "(", "t", "[", "4", "]", ",", "t", "[", "3", "]", ",", "t", "[", "2", "]", ",", "t", "[", "5", "]", ",", "t", "[", "6", "]", ",", "t", "[", "7", "]", ");", "if", "(", "!", "function", "(", "e", ",", "t", ",", "n", ")", "{", "if", "(", "e", "&", "&", "At", ".", "indexOf", "(", "e", ")", "!=", "=", "new", "Date", "(", "t", "[", "0", "]", ",", "t", "[", "1", "]", ",", "t", "[", "2", "]", ").", "getDay", "(", "))", "return", "d", "(", "n", ")", ".", "weekdayMismatch", "=", "!", "0", ",", "n", ".", "_isValid", "=", "!", "1", ",", "!", "1", ";", "return", "!", "0", "}", "(", "t", "[", "1", "]", ",", "n", ",", "e", ")", ")", "return", ";", "e", ".", "_a", "=", "n", ",", "e", ".", "_tzm", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "if", "(", "e", ")", "return", "un", "[", "e", "]", ";", "if", "(", "t", ")", "return", "0", ";", "var", "s", "=", "parseInt", "(", "n", ",", "10", ")", ",", "i", "=", "s", "%", "100", ";", "return", "(", "s", "-", "i", ")", "/", "100", "*", "60", "+", "i", "}", "(", "t", "[", "8", "]", ",", "t", "[", "9", "]", ",", "t", "[", "10", "]", "),", "e", ".", "_d", "=", "J", ".", "apply", "(", "null", ",", "e", ".", "_a", ")", ",", "e", ".", "_d", ".", "setUTCMinutes", "(", "e", ".", "_d", ".", "getUTCMinutes", "(", ")-", "e", ".", "_tzm", ")", ",", "d", "(", "e", ")", ".", "rfc2822", "=", "!", "0", "}", "else", "e", ".", "_isValid", "=", "!", "1", "}", "function", "_e", "(", "t", ")", "{", "if", "(", "t", ".", "_f", "!", "==", "e", ".", "ISO_8601", ")", "if", "(", "t", ".", "_f", "!", "==", "e", ".", "RFC_2822", ")", "{", "t", ".", "_a", "=", "[]", ",", "d", "(", "t", ")", ".", "empty", "=", "!", "0", ";", "var", "n", ",", "s", ",", "i", ",", "r", ",", "a", ",", "o", "=", "\"\"", "+", "t", ".", "_i", ",", "u", "=", "o", ".", "length", ",", "l", "=", "0", ";", "for", "(", "i", "=", "C", "(", "t", ".", "_f", ",", "t", ".", "_locale", ")", ".", "match", "(", "rt", ")", "||", "[]", ",", "n", "=", "0", ";", "n", "<", "i", ".", "length", ";", "n", "+", "+)", "r", "=", "i", "[", "n", "]", ",(", "s", "=", "(", "o", ".", "match", "(", "U", "(", "r", ",", "t", ")", ")|", "|[", "])", "[", "0", "]", ")&", "&(", "(", "a", "=", "o", ".", "substr", "(", "0", ",", "o", ".", "indexOf", "(", "s", ")", "))", ".", "length", ">", "0", "&", "&", "d", "(", "t", ")", ".", "unusedInput", ".", "push", "(", "a", ")", ",", "o", "=", "o", ".", "slice", "(", "o", ".", "indexOf", "(", "s", ")", "+", "s", ".", "length", ")", ",", "l", "+", "=", "s", ".", "length", ")", ",", "ut", "[", "r", "]", "?(", "s", "?", "d", "(", "t", ")", ".", "empty", "=", "!", "1", ":", "d", "(", "t", ")", ".", "unusedTokens", ".", "push", "(", "r", ")", ",", "G", "(", "r", ",", "s", ",", "t", ")", "):", "t", ".", "_strict", "&", "&!", "s", "&", "&", "d", "(", "t", ")", ".", "unusedTokens", ".", "push", "(", "r", ")", ";", "d", "(", "t", ")", ".", "charsLeftOver", "=", "u", "-", "l", ",", "o", ".", "length", ">", "0", "&", "&", "d", "(", "t", ")", ".", "unusedInput", ".", "push", "(", "o", ")", ",", "t", ".", "_a", "[", "Pt", "]", "<=", "12", "&", "&!", "0", "=", "==", "d", "(", "t", ")", ".", "bigHour", "&", "&", "t", ".", "_a", "[", "Pt", "]", ">", "0", "&", "&(", "d", "(", "t", ")", ".", "bigHour", "=", "void", "0", ")", ",", "d", "(", "t", ")", ".", "parsedDateParts", "=", "t", ".", "_a", ".", "slice", "(", "0", ")", ",", "d", "(", "t", ")", ".", "meridiem", "=", "t", ".", "_meridiem", ",", "t", ".", "_a", "[", "Pt", "]", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ";", "if", "(", "null", "=", "=", "n", ")", "return", "t", ";", "return", "null", "!", "=", "e", ".", "meridiemHour", "?", "e", ".", "meridiemHour", "(", "t", ",", "n", ")", ":", "null", "!", "=", "e", ".", "isPM", "?", "((", "s", "=", "e", ".", "isPM", "(", "n", ")", ")&", "&", "t", "<", "12", "&", "&(", "t", "+", "=", "12", ")", ",", "s", "|", "|", "12", "!", "==", "t", "|", "|(", "t", "=", "0", ")", ",", "t", ")", ":", "t", "}", "(", "t", ".", "_locale", ",", "t", ".", "_a", "[", "Pt", "]", ",", "t", ".", "_meridiem", ")", ",", "he", "(", "t", ")", ",", "le", "(", "t", ")", "}", "else", "me", "(", "t", ")", ";", "else", "ce", "(", "t", ")", "}", "function", "ye", "(", "o", ")", "{", "var", "l", "=", "o", ".", "_i", ",", "y", "=", "o", ".", "_f", ";", "return", "o", ".", "_locale", "=", "o", ".", "_locale", "|", "|", "ue", "(", "o", ".", "_l", ")", ",", "null", "=", "==", "l", "|", "|", "void", "0", "=", "==", "y", "&", "&\"", "\"=", "==", "l", "?", "c", "(", "{", "nullInput", ":", "!", "0", "}", "):", "(\"", "string", "\"", "==", "typeof", "l", "&", "&(", "o", ".", "_i", "=", "l", "=", "o", ".", "_locale", ".", "preparse", "(", "l", ")", "),", "_", "(", "l", ")", "?", "new", "m", "(", "le", "(", "l", ")", "):", "(", "r", "(", "l", ")", "?", "o", ".", "_d", "=", "l", ":", "t", "(", "y", ")", "?", "function", "(", "e", ")", "{", "var", "t", ",", "n", ",", "s", ",", "i", ",", "r", ";", "if", "(", "0", "=", "==", "e", ".", "_f", ".", "length", ")", "return", "d", "(", "e", ")", ".", "invalidFormat", "=", "!", "0", ",", "void", "(", "e", ".", "_d", "=", "new", "Date", "(", "NaN", ")", ");", "for", "(", "i", "=", "0", ";", "i", "<", "e", ".", "_f", ".", "length", ";", "i", "+", "+)", "r", "=", "0", ",", "t", "=", "f", "(", "{}", ",", "e", ")", ",", "null", "!", "=", "e", ".", "_useUTC", "&", "&(", "t", ".", "_useUTC", "=", "e", ".", "_useUTC", ")", ",", "t", ".", "_f", "=", "e", ".", "_f", "[", "i", "]", ",", "_e", "(", "t", ")", ",", "h", "(", "t", ")", "&&", "(", "r", "+", "=", "d", "(", "t", ")", ".", "charsLeftOver", ",", "r", "+", "=", "10", "*", "d", "(", "t", ")", ".", "unusedTokens", ".", "length", ",", "d", "(", "t", ")", ".", "score", "=", "r", ",", "(", "null", "=", "=", "s", "|", "|", "r", "<", "s", ")", "&&", "(", "s", "=", "r", ",", "n", "=", "t", ")", ");", "u", "(", "e", ",", "n", "|", "|", "t", ")", "}(", "o", ")", ":", "y", "?", "_e", "(", "o", ")", ":", "function", "(", "o", ")", "{", "var", "u", "=", "o", ".", "_i", ";", "s", "(", "u", ")", "?", "o", ".", "_d", "=", "new", "Date", "(", "e", ".", "now", "(", "))", ":", "r", "(", "u", ")", "?", "o", ".", "_d", "=", "new", "Date", "(", "u", ".", "valueOf", "(", "))", ":\"", "string", "\"", "==", "typeof", "u", "?", "function", "(", "t", ")", "{", "var", "n", "=", "an", ".", "exec", "(", "t", ".", "_i", ")", ";", "null", "=", "==", "n", "?", "(", "ce", "(", "t", ")", ",!", "1", "=", "==", "t", ".", "_isValid", "&", "&(", "delete", "t", ".", "_isValid", ",", "me", "(", "t", ")", ",!", "1", "=", "==", "t", ".", "_isValid", "&", "&(", "delete", "t", ".", "_isValid", ",", "e", ".", "createFromInputFallback", "(", "t", ")", "))", "):", "t", ".", "_d", "=", "new", "Date", "(", "+", "n", "[", "1", "]", ")}", "(", "o", ")", ":", "t", "(", "u", ")", "?(", "o", ".", "_a", "=", "a", "(", "u", ".", "slice", "(", "0", ")", ",", "function", "(", "e", ")", "{", "return", "parseInt", "(", "e", ",", "10", ")", "})", ",", "he", "(", "o", ")", "):", "n", "(", "u", ")", "?", "function", "(", "e", ")", "{", "if", "(", "!", "e", ".", "_d", ")", "{", "var", "t", "=", "x", "(", "e", ".", "_i", ")", ";", "e", ".", "_a", "=", "a", "(", "[", "t", ".", "year", ",", "t", ".", "month", ",", "t", ".", "day", "|", "|", "t", ".", "date", ",", "t", ".", "hour", ",", "t", ".", "minute", ",", "t", ".", "second", ",", "t", ".", "millisecond", "]", ",", "function", "(", "e", ")", "{", "return", "e", "&", "&", "parseInt", "(", "e", ",", "10", ")", "})", ",", "he", "(", "e", ")", "}}", "(", "o", ")", ":", "i", "(", "u", ")", "?", "o", ".", "_d", "=", "new", "Date", "(", "u", ")", ":", "e", ".", "createFromInputFallback", "(", "o", ")", "}(", "o", ")", ",", "h", "(", "o", ")", "||", "(", "o", ".", "_d", "=", "null", ")", ",", "o", ")", ")}", "function", "ge", "(", "e", ",", "s", ",", "i", ",", "r", ",", "a", ")", "{", "var", "o", "=", "{}", ";", "return", "!", "0", "!", "==", "i", "&", "&!", "1", "!", "==", "i", "|", "|(", "r", "=", "i", ",", "i", "=", "void", "0", ")", ",(", "n", "(", "e", ")", "&&", "function", "(", "e", ")", "{", "if", "(", "Object", ".", "getOwnPropertyNames", ")", "return", "0", "=", "==", "Object", ".", "getOwnPropertyNames", "(", "e", ")", ".", "length", ";", "var", "t", ";", "for", "(", "t", "in", "e", ")", "if", "(", "e", ".", "hasOwnProperty", "(", "t", ")", ")", "return", "!", "1", ";", "return", "!", "0", "}", "(", "e", ")", "||", "t", "(", "e", ")", "&&", "0", "=", "==", "e", ".", "length", ")", "&&", "(", "e", "=", "void", "0", ")", ",", "o", ".", "_isAMomentObject", "=", "!", "0", ",", "o", ".", "_useUTC", "=", "o", ".", "_isUTC", "=", "a", ",", "o", ".", "_l", "=", "i", ",", "o", ".", "_i", "=", "e", ",", "o", ".", "_f", "=", "s", ",", "o", ".", "_strict", "=", "r", ",", "function", "(", "e", ")", "{", "var", "t", "=", "new", "m", "(", "le", "(", "ye", "(", "e", ")", "))", ";", "return", "t", ".", "_nextDay", "&", "&(", "t", ".", "add", "(", "1", ",", "\"", "d", "\"", "),", "t", ".", "_nextDay", "=", "void", "0", ")", ",", "t", "}", "(", "o", ")", "}", "function", "pe", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "return", "ge", "(", "e", ",", "t", ",", "n", ",", "s", ",", "!", "1", ")", "}", "function", "we", "(", "e", ",", "n", ")", "{", "var", "s", ",", "i", ";", "if", "(", "1", "=", "==", "n", ".", "length", "&", "&", "t", "(", "n", "[", "0", "]", ")&", "&(", "n", "=", "n", "[", "0", "]", "),", "!", "n", ".", "length", ")", "return", "pe", "(", ");", "for", "(", "s", "=", "n", "[", "0", "]", ",", "i", "=", "1", ";", "i", "<", "n", ".", "length", ";", "++", "i", ")", "n", "[", "i", "]", ".", "isValid", "(", ")&", "&!", "n", "[", "i", "]", "[", "e", "]", "(", "s", ")", "||", "(", "s", "=", "n", "[", "i", "]", ");", "return", "s", "}", "function", "ve", "(", "e", ")", "{", "var", "t", "=", "x", "(", "e", ")", ",", "n", "=", "t", ".", "year", "|", "|", "0", ",", "s", "=", "t", ".", "quarter", "|", "|", "0", ",", "i", "=", "t", ".", "month", "|", "|", "0", ",", "r", "=", "t", ".", "week", "|", "|", "0", ",", "a", "=", "t", ".", "day", "|", "|", "0", ",", "o", "=", "t", ".", "hour", "|", "|", "0", ",", "u", "=", "t", ".", "minute", "|", "|", "0", ",", "l", "=", "t", ".", "second", "|", "|", "0", ",", "d", "=", "t", ".", "millisecond", "|", "|", "0", ";", "this", ".", "_isValid", "=", "function", "(", "e", ")", "{", "for", "(", "var", "t", "in", "e", ")", "if", "(", "-", "1", "=", "==", "Nt", ".", "call", "(", "hn", ",", "t", ")", "||", "null", "!", "=", "e", "[", "t", "]", "&&", "isNaN", "(", "e", "[", "t", "]", "))", "return", "!", "1", ";", "for", "(", "var", "n", "=", "!", "1", ",", "s", "=", "0", ";", "s", "<", "hn", ".", "length", ";", "++", "s", ")", "if", "(", "e", "[", "hn", "[", "s", "]", "])", "{", "if", "(", "n", ")", "return", "!", "1", ";", "parseFloat", "(", "e", "[", "hn", "[", "s", "]", "])", "!=", "=", "g", "(", "e", "[", "hn", "[", "s", "]", "])", "&&", "(", "n", "=", "!", "0", ")", "}", "return", "!", "0", "}", "(", "t", ")", ",", "this", ".", "_milliseconds", "=", "+", "d", "+", "1e3", "*", "l", "+", "6e4", "*", "u", "+", "1e3", "*", "o", "*", "60", "*", "60", ",", "this", ".", "_days", "=", "+", "a", "+", "7", "*", "r", ",", "this", ".", "_months", "=", "+", "i", "+", "3", "*", "s", "+", "12", "*", "n", ",", "this", ".", "_data", "=", "{}", ",", "this", ".", "_locale", "=", "ue", "(", "),", "this", ".", "_bubble", "(", ")}", "function", "Me", "(", "e", ")", "{", "return", "e", "instanceof", "ve", "}", "function", "ke", "(", "e", ")", "{", "return", "e", "<", "0", "?", "-", "1", "*", "Math", ".", "round", "(", "-", "1", "*", "e", ")", ":", "Math", ".", "round", "(", "e", ")", "}", "function", "Se", "(", "e", ",", "t", ")", "{", "P", "(", "e", ",", "0", ",", "0", ",", "function", "(", "){", "var", "e", "=", "this", ".", "utcOffset", "(", "),", "n", "=", "\"+", "\";", "return", "e", "<", "0", "&", "&(", "e", "=", "-", "e", ",", "n", "=", "\"-", "\")", ",", "n", "+", "b", "(", "~~", "(", "e", "/", "60", ")", ",", "2", ")", "+", "t", "+", "b", "(", "~~", "e", "%", "60", ",", "2", ")", "})", "}", "function", "De", "(", "e", ",", "t", ")", "{", "var", "n", "=", "(", "t", "|", "|\"", "\")", ".", "match", "(", "e", ")", ";", "if", "(", "null", "=", "==", "n", ")", "return", "null", ";", "var", "s", "=", "((", "n", "[", "n", ".", "length", "-", "1", "]", "||", "[]", ")+", "\"\"", ").", "match", "(", "cn", ")", "||", "[\"", "-\"", ",", "0", ",", "0", "]", ",", "i", "=", "60", "*", "s", "[", "1", "]", "+", "g", "(", "s", "[", "2", "]", ");", "return", "0", "=", "==", "i", "?", "0", ":", "\"+", "\"=", "==", "s", "[", "0", "]", "?", "i", ":", "-", "i", "}", "function", "Ye", "(", "t", ",", "n", ")", "{", "var", "s", ",", "i", ";", "return", "n", ".", "_isUTC", "?", "(", "s", "=", "n", ".", "clone", "(", "),", "i", "=", "(", "_", "(", "t", ")", "||", "r", "(", "t", ")", "?", "t", ".", "valueOf", "(", "):", "pe", "(", "t", ")", ".", "valueOf", "(", "))", "-", "s", ".", "valueOf", "(", "),", "s", ".", "_d", ".", "setTime", "(", "s", ".", "_d", ".", "valueOf", "(", ")+", "i", ")", ",", "e", ".", "updateOffset", "(", "s", ",", "!", "1", ")", ",", "s", ")", ":", "pe", "(", "t", ")", ".", "local", "(", ")}", "function", "Oe", "(", "e", ")", "{", "return", "15", "*", "-", "Math", ".", "round", "(", "e", ".", "_d", ".", "getTimezoneOffset", "(", ")/", "15", ")", "}", "function", "xe", "(", "){", "return", "!", "!", "this", ".", "isValid", "(", ")&", "&(", "this", ".", "_isUTC", "&", "&", "0", "=", "==", "this", ".", "_offset", ")", "}", "function", "Te", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", ",", "r", ",", "a", "=", "e", ",", "u", "=", "null", ";", "return", "Me", "(", "e", ")", "?", "a", "=", "{", "ms", ":", "e", ".", "_milliseconds", ",", "d", ":", "e", ".", "_days", ",", "M", ":", "e", ".", "_months", "}", ":", "i", "(", "e", ")", "?(", "a", "=", "{}", ",", "t", "?", "a", "[", "t", "]", "=", "e", ":", "a", ".", "milliseconds", "=", "e", ")", ":(", "u", "=", "fn", ".", "exec", "(", "e", ")", ")?", "(", "n", "=", "\"-", "\"=", "==", "u", "[", "1", "]", "?-", "1", ":", "1", ",", "a", "=", "{", "y", ":", "0", ",", "d", ":", "g", "(", "u", "[", "bt", "]", ")*", "n", ",", "h", ":", "g", "(", "u", "[", "Pt", "]", ")*", "n", ",", "m", ":", "g", "(", "u", "[", "Wt", "]", ")*", "n", ",", "s", ":", "g", "(", "u", "[", "Rt", "]", ")*", "n", ",", "ms", ":", "g", "(", "ke", "(", "1e3", "*", "u", "[", "Ct", "]", "))", "*", "n", "}", "):", "(", "u", "=", "mn", ".", "exec", "(", "e", ")", ")?", "(", "n", "=", "\"-", "\"=", "==", "u", "[", "1", "]", "?-", "1", ":", "(", "u", "[", "1", "]", ",", "1", ")", ",", "a", "=", "{", "y", ":", "be", "(", "u", "[", "2", "]", ",", "n", ")", ",", "M", ":", "be", "(", "u", "[", "3", "]", ",", "n", ")", ",", "w", ":", "be", "(", "u", "[", "4", "]", ",", "n", ")", ",", "d", ":", "be", "(", "u", "[", "5", "]", ",", "n", ")", ",", "h", ":", "be", "(", "u", "[", "6", "]", ",", "n", ")", ",", "m", ":", "be", "(", "u", "[", "7", "]", ",", "n", ")", ",", "s", ":", "be", "(", "u", "[", "8", "]", ",", "n", ")", "})", ":", "null", "=", "=", "a", "?", "a", "=", "{}", ":\"", "object", "\"", "==", "typeof", "a", "&", "&(", "\"", "from", "\"", "in", "a", "|", "|\"", "to", "\"", "in", "a", ")", "&&", "(", "r", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", ";", "if", "(", "!", "e", ".", "isValid", "(", ")|", "|!", "t", ".", "isValid", "(", "))", "return", "{", "milliseconds", ":", "0", ",", "months", ":", "0", "}", ";", "t", "=", "Ye", "(", "t", ",", "e", ")", ",", "e", ".", "isBefore", "(", "t", ")", "?", "n", "=", "Pe", "(", "e", ",", "t", ")", ":(", "(", "n", "=", "Pe", "(", "t", ",", "e", ")", ").", "milliseconds", "=", "-", "n", ".", "milliseconds", ",", "n", ".", "months", "=", "-", "n", ".", "months", ")", ";", "return", "n", "}", "(", "pe", "(", "a", ".", "from", ")", ",", "pe", "(", "a", ".", "to", ")", "),", "(", "a", "=", "{}", ").", "ms", "=", "r", ".", "milliseconds", ",", "a", ".", "M", "=", "r", ".", "months", ")", ",", "s", "=", "new", "ve", "(", "a", ")", ",", "Me", "(", "e", ")", "&&", "o", "(", "e", ",", "\"", "_locale", "\"", ")&", "&(", "s", ".", "_locale", "=", "e", ".", "_locale", ")", ",", "s", "}", "function", "be", "(", "e", ",", "t", ")", "{", "var", "n", "=", "e", "&", "&", "parseFloat", "(", "e", ".", "replace", "(", "\",", "\",", "\".", "\")", ");", "return", "(", "isNaN", "(", "n", ")", "?", "0", ":", "n", ")", "*", "t", "}", "function", "Pe", "(", "e", ",", "t", ")", "{", "var", "n", "=", "{", "milliseconds", ":", "0", ",", "months", ":", "0", "}", ";", "return", "n", ".", "months", "=", "t", ".", "month", "(", ")-", "e", ".", "month", "(", ")+", "12", "*", "(", "t", ".", "year", "(", ")-", "e", ".", "year", "(", "))", ",", "e", ".", "clone", "(", ").", "add", "(", "n", ".", "months", ",", "\"", "M", "\"", ").", "isAfter", "(", "t", ")", "&&", "--", "n", ".", "months", ",", "n", ".", "milliseconds", "=", "+", "t", "-", "+", "e", ".", "clone", "(", ").", "add", "(", "n", ".", "months", ",", "\"", "M", "\"", "),", "n", "}", "function", "We", "(", "e", ",", "t", ")", "{", "return", "function", "(", "n", ",", "s", ")", "{", "var", "i", ",", "r", ";", "return", "null", "=", "==", "s", "|", "|", "isNaN", "(", "+", "s", ")", "||", "(", "M", "(", "t", ",", "\"", "moment", "(", ").", "\"+", "t", "+", "\"(", "period", ",", "number", ")", "is", "deprecated", ".", "Please", "use", "moment", "(", ").", "\"+", "t", "+", "\"(", "number", ",", "period", ")", ".", "See", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "add", "-", "inverted", "-", "param", "/", "for", "more", "info", ".", "\")", ",", "r", "=", "n", ",", "n", "=", "s", ",", "s", "=", "r", ")", ",", "n", "=", "\"", "string", "\"", "==", "typeof", "n", "?", "+", "n", ":", "n", ",", "i", "=", "Te", "(", "n", ",", "s", ")", ",", "Re", "(", "this", ",", "i", ",", "e", ")", ",", "this", "}", "}", "function", "Re", "(", "t", ",", "n", ",", "s", ",", "i", ")", "{", "var", "r", "=", "n", ".", "_milliseconds", ",", "a", "=", "ke", "(", "n", ".", "_days", ")", ",", "o", "=", "ke", "(", "n", ".", "_months", ")", ";", "t", ".", "isValid", "(", ")&", "&(", "i", "=", "null", "=", "=", "i", "|", "|", "i", ",", "o", "&", "&", "Z", "(", "t", ",", "E", "(", "t", ",", "\"", "Month", "\"", ")+", "o", "*", "s", ")", ",", "a", "&", "&", "A", "(", "t", ",", "\"", "Date", "\"", ",", "E", "(", "t", ",", "\"", "Date", "\"", ")+", "a", "*", "s", ")", ",", "r", "&", "&", "t", ".", "_d", ".", "setTime", "(", "t", ".", "_d", ".", "valueOf", "(", ")+", "r", "*", "s", ")", ",", "i", "&", "&", "e", ".", "updateOffset", "(", "t", ",", "a", "|", "|", "o", ")", ")}", "function", "Ce", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", "=", "12", "*", "(", "t", ".", "year", "(", ")-", "e", ".", "year", "(", "))", "+(", "t", ".", "month", "(", ")-", "e", ".", "month", "(", "))", ",", "i", "=", "e", ".", "clone", "(", ").", "add", "(", "s", ",", "\"", "months", "\"", ");", "return", "n", "=", "t", "-", "i", "<", "0", "?", "(", "t", "-", "i", ")", "/(", "i", "-", "e", ".", "clone", "(", ").", "add", "(", "s", "-", "1", ",", "\"", "months", "\"", "))", ":(", "t", "-", "i", ")", "/(", "e", ".", "clone", "(", ").", "add", "(", "s", "+", "1", ",", "\"", "months", "\"", ")-", "i", ")", ",-", "(", "s", "+", "n", ")", "||", "0", "}", "function", "Fe", "(", "e", ")", "{", "var", "t", ";", "return", "void", "0", "=", "==", "e", "?", "this", ".", "_locale", ".", "_abbr", ":", "(", "null", "!", "=(", "t", "=", "ue", "(", "e", ")", ")&", "&(", "this", ".", "_locale", "=", "t", ")", ",", "this", ")", "}", "function", "Ue", "(", "){", "return", "this", ".", "_locale", "}", "function", "Ne", "(", "e", ",", "t", ")", "{", "P", "(", "0", ",", "[", "e", ",", "e", ".", "length", "]", ",", "0", ",", "t", ")", "}", "function", "He", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "var", "r", ";", "return", "null", "=", "=", "e", "?", "X", "(", "this", ",", "s", ",", "i", ")", ".", "year", ":", "(", "r", "=", "K", "(", "e", ",", "s", ",", "i", ")", ",", "t", ">", "r", "&", "&(", "t", "=", "r", ")", ",", "function", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "var", "r", "=", "Q", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", ",", "a", "=", "J", "(", "r", ".", "year", ",", "0", ",", "r", ".", "dayOfYear", ")", ";", "return", "this", ".", "year", "(", "a", ".", "getUTCFullYear", "(", "))", ",", "this", ".", "month", "(", "a", ".", "getUTCMonth", "(", "))", ",", "this", ".", "date", "(", "a", ".", "getUTCDate", "(", "))", ",", "this", "}", ".", "call", "(", "this", ",", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", ")}", "function", "Le", "(", "e", ",", "t", ")", "{", "t", "[", "Ct", "]", "=", "g", "(", "1e3", "*", "(\"", "0", ".", "\"+", "e", ")", ")}", "function", "Ge", "(", "e", ")", "{", "return", "e", "}", "function", "Ve", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "ue", "(", "),", "r", "=", "l", "(", ").", "set", "(", "s", ",", "t", ")", ";", "return", "i", "[", "n", "]", "(", "r", ",", "e", ")", "}", "function", "je", "(", "e", ",", "t", ",", "n", ")", "{", "if", "(", "i", "(", "e", ")", "&&", "(", "t", "=", "e", ",", "e", "=", "void", "0", ")", ",", "e", "=", "e", "|", "|\"", "\",", "null", "!", "=", "t", ")", "return", "Ve", "(", "e", ",", "t", ",", "n", ",", "\"", "month", "\"", ");", "var", "s", ",", "r", "=", "[]", ";", "for", "(", "s", "=", "0", ";", "s", "<", "12", ";", "s", "+", "+)", "r", "[", "s", "]", "=", "Ve", "(", "e", ",", "s", ",", "n", ",", "\"", "month", "\"", ");", "return", "r", "}", "function", "Ie", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{\"", "boolean", "\"", "==", "typeof", "e", "?", "(", "i", "(", "t", ")", "&&", "(", "n", "=", "t", ",", "t", "=", "void", "0", ")", ",", "t", "=", "t", "|", "|\"", "\")", ":(", "n", "=", "t", "=", "e", ",", "e", "=", "!", "1", ",", "i", "(", "t", ")", "&&", "(", "n", "=", "t", ",", "t", "=", "void", "0", ")", ",", "t", "=", "t", "|", "|\"", "\")", ";", "var", "r", "=", "ue", "(", "),", "a", "=", "e", "?", "r", ".", "_week", ".", "dow", ":", "0", ";", "if", "(", "null", "!", "=", "n", ")", "return", "Ve", "(", "t", ",", "(", "n", "+", "a", ")", "%", "7", ",", "s", ",", "\"", "day", "\"", ");", "var", "o", ",", "u", "=", "[]", ";", "for", "(", "o", "=", "0", ";", "o", "<", "7", ";", "o", "+", "+)", "u", "[", "o", "]", "=", "Ve", "(", "t", ",", "(", "o", "+", "a", ")", "%", "7", ",", "s", ",", "\"", "day", "\"", ");", "return", "u", "}", "function", "Ee", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "Te", "(", "t", ",", "n", ")", ";", "return", "e", ".", "_milliseconds", "+", "=", "s", "*", "i", ".", "_milliseconds", ",", "e", ".", "_days", "+", "=", "s", "*", "i", ".", "_days", ",", "e", ".", "_months", "+", "=", "s", "*", "i", ".", "_months", ",", "e", ".", "_bubble", "(", ")}", "function", "Ae", "(", "e", ")", "{", "return", "e", "<", "0", "?", "Math", ".", "floor", "(", "e", ")", ":", "Math", ".", "ceil", "(", "e", ")", "}", "function", "ze", "(", "e", ")", "{", "return", "4800", "*", "e", "/", "146097", "}", "function", "Ze", "(", "e", ")", "{", "return", "146097", "*", "e", "/", "4800", "}", "function", "$", "e", "(", "e", ")", "{", "return", "function", "(", "){", "return", "this", ".", "as", "(", "e", ")", "}}", "function", "qe", "(", "e", ")", "{", "return", "function", "(", "){", "return", "this", ".", "isValid", "(", ")?", "this", ".", "_data", "[", "e", "]", ":", "NaN", "}", "}", "function", "Je", "(", "e", ")", "{", "return", "(", "e", ">", "0", ")", "-(", "e", "<", "0", ")", "||", "+", "e", "}", "function", "Be", "(", "){", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "this", ".", "localeData", "(", ").", "invalidDate", "(", ");", "var", "e", ",", "t", ",", "n", ",", "s", "=", "En", "(", "this", ".", "_milliseconds", ")", "/", "1e3", ",", "i", "=", "En", "(", "this", ".", "_days", ")", ",", "r", "=", "En", "(", "this", ".", "_months", ")", ";", "t", "=", "y", "(", "(", "e", "=", "y", "(", "s", "/", "60", ")", ")/", "60", ")", ",", "s", "%", "=", "60", ",", "e", "%", "=", "60", ";", "var", "a", "=", "n", "=", "y", "(", "r", "/", "12", ")", ",", "o", "=", "r", "%", "=", "12", ",", "u", "=", "i", ",", "l", "=", "t", ",", "d", "=", "e", ",", "h", "=", "s", "?", "s", ".", "toFixed", "(", "3", ")", ".", "replace", "(", "/\\", ".?", "0", "+", "$/", ",\"", "\")", ":\"", "\",", "c", "=", "this", ".", "asSeconds", "(", ");", "if", "(", "!", "c", ")", "return", "\"", "P0D", "\"", ";", "var", "f", "=", "c", "<", "0", "?", "\"-", "\":", "\"\"", ",", "m", "=", "Je", "(", "this", ".", "_months", ")", "!=", "=", "Je", "(", "c", ")", "?\"", "-\"", ":\"", "\",", "_", "=", "Je", "(", "this", ".", "_days", ")", "!=", "=", "Je", "(", "c", ")", "?\"", "-\"", ":\"", "\",", "g", "=", "Je", "(", "this", ".", "_milliseconds", ")", "!=", "=", "Je", "(", "c", ")", "?\"", "-\"", ":\"", "\";", "return", "f", "+", "\"", "P", "\"", "+(", "a", "?", "m", "+", "a", "+", "\"", "Y", "\"", ":\"", "\")", "+(", "o", "?", "m", "+", "o", "+", "\"", "M", "\"", ":\"", "\")", "+(", "u", "?", "_", "+", "u", "+", "\"", "D", "\"", ":\"", "\")", "+(", "l", "|", "|", "d", "|", "|", "h", "?", "\"", "T", "\"", ":\"", "\")", "+(", "l", "?", "g", "+", "l", "+", "\"", "H", "\"", ":\"", "\")", "+(", "d", "?", "g", "+", "d", "+", "\"", "M", "\"", ":\"", "\")", "+(", "h", "?", "g", "+", "h", "+", "\"", "S", "\"", ":\"", "\")", "}", "var", "Qe", ",", "Xe", ";", "Xe", "=", "Array", ".", "prototype", ".", "some", "?", "Array", ".", "prototype", ".", "some", ":", "function", "(", "e", ")", "{", "for", "(", "var", "t", "=", "Object", "(", "this", ")", ",", "n", "=", "t", ".", "length", ">", ">>", "0", ",", "s", "=", "0", ";", "s", "<", "n", ";", "s", "+", "+)", "if", "(", "s", "in", "t", "&", "&", "e", ".", "call", "(", "this", ",", "t", "[", "s", "]", ",", "s", ",", "t", ")", ")", "return", "!", "0", ";", "return", "!", "1", "}", ";", "var", "Ke", "=", "e", ".", "momentProperties", "=", "[]", ",", "et", "=", "!", "1", ",", "tt", "=", "{}", ";", "e", ".", "suppressDeprecationWarnings", "=", "!", "1", ",", "e", ".", "deprecationHandler", "=", "null", ";", "var", "nt", ";", "nt", "=", "Object", ".", "keys", "?", "Object", ".", "keys", ":", "function", "(", "e", ")", "{", "var", "t", ",", "n", "=", "[]", ";", "for", "(", "t", "in", "e", ")", "o", "(", "e", ",", "t", ")", "&&", "n", ".", "push", "(", "t", ")", ";", "return", "n", "}", ";", "var", "st", "=", "{}", ",", "it", "=", "{}", ",", "rt", "=", "/(", "\\[", "[^", "\\[", "]*", "\\]", ")|", "(\\", "\\)", "?(", "[", "Hh", "]", "mm", "(", "ss", ")", "?|", "Mo", "|", "MM", "?", "M", "?", "M", "?", "|", "Do", "|", "DDDo", "|", "DD", "?", "D", "?", "D", "?", "|", "ddd", "?", "d", "?", "|", "do", "?", "|", "w", "[", "o", "|", "w", "]", "?|", "W", "[", "o", "|", "W", "]", "?|", "Qo", "?", "|", "YYYYYY", "|", "YYYYY", "|", "YYYY", "|", "YY", "|", "gg", "(", "ggg", "?", ")?", "|", "GG", "(", "GGG", "?", ")?", "|", "e", "|", "E", "|", "a", "|", "A", "|", "hh", "?", "|", "HH", "?", "|", "kk", "?", "|", "mm", "?", "|", "ss", "?", "|", "S", "{", "1", ",", "9", "}", "|", "x", "|", "X", "|", "zz", "?", "|", "ZZ", "?", "|.", ")/", "g", ",", "at", "=", "/(", "\\[", "[^", "\\[", "]*", "\\]", ")|", "(\\", "\\)", "?(", "LTS", "|", "LT", "|", "LL", "?", "L", "?", "L", "?", "|", "l", "{", "1", ",", "4", "}", ")/", "g", ",", "ot", "=", "{}", ",", "ut", "=", "{}", ",", "lt", "=", "/\\", "d", "/", ",", "dt", "=", "/\\", "d", "\\", "d", "/", ",", "ht", "=", "/\\", "d", "{", "3", "}", "/,", "ct", "=", "/\\", "d", "{", "4", "}", "/,", "ft", "=", "/[", "+-", "]?", "\\", "d", "{", "6", "}", "/,", "mt", "=", "/\\", "d", "\\", "d", "?", "/,", "_t", "=", "/\\", "d", "\\", "d", "\\", "d", "\\", "d", "?", "/,", "yt", "=", "/\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "?", "/,", "gt", "=", "/\\", "d", "{", "1", ",", "3", "}", "/,", "pt", "=", "/\\", "d", "{", "1", ",", "4", "}", "/,", "wt", "=", "/[", "+-", "]?", "\\", "d", "{", "1", ",", "6", "}", "/,", "vt", "=", "/\\", "d", "+", "/,", "Mt", "=", "/[", "+-", "]?", "\\", "d", "+", "/,", "kt", "=", "/", "Z", "|", "[+", "-]", "\\", "d", "\\", "d", ":", "?\\", "d", "\\", "d", "/", "gi", ",", "St", "=", "/", "Z", "|", "[+", "-]", "\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?/", "gi", ",", "Dt", "=", "/[", "0", "-", "9", "]", "{", "0", ",", "256", "}", "['", "a", "-", "z", "\\", "u00A0", "-", "\\", "u05FF", "\\", "u0700", "-", "\\", "uD7FF", "\\", "uF900", "-", "\\", "uFDCF", "\\", "uFDF0", "-", "\\", "uFFEF", "]", "{", "1", ",", "256", "}", "|[", "\\", "u0600", "-", "\\", "u06FF", "\\", "/]", "{", "1", ",", "256", "}", "(\\", "s", "*", "?[", "\\", "u0600", "-", "\\", "u06FF", "]", "{", "1", ",", "256", "}", "){", "1", ",", "2", "}", "/", "i", ",", "Yt", "=", "{}", ",", "Ot", "=", "{}", ",", "xt", "=", "0", ",", "Tt", "=", "1", ",", "bt", "=", "2", ",", "Pt", "=", "3", ",", "Wt", "=", "4", ",", "Rt", "=", "5", ",", "Ct", "=", "6", ",", "Ft", "=", "7", ",", "Ut", "=", "8", ";", "P", "(", "\"", "Y", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "var", "e", "=", "this", ".", "year", "(", ");", "return", "e", "<", "=", "9999", "?", "\"\"", "+", "e", ":", "\"+", "\"+", "e", "}", "),", "P", "(", "0", ",", "[\"", "YY", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "this", ".", "year", "(", ")%", "100", "}", "),", "P", "(", "0", ",", "[\"", "YYYY", "\"", ",", "4", "]", ",", "0", ",", "\"", "year", "\"", "),", "P", "(", "0", ",", "[\"", "YYYYY", "\"", ",", "5", "]", ",", "0", ",", "\"", "year", "\"", "),", "P", "(", "0", ",", "[\"", "YYYYYY", "\"", ",", "6", ",", "!", "0", "]", ",", "0", ",", "\"", "year", "\"", "),", "Y", "(", "\"", "year", "\"", ",\"", "y", "\"", "),", "T", "(", "\"", "year", "\"", ",", "1", ")", ",", "F", "(", "\"", "Y", "\"", ",", "Mt", ")", ",", "F", "(", "\"", "YY", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "YYYY", "\"", ",", "pt", ",", "ct", ")", ",", "F", "(", "\"", "YYYYY", "\"", ",", "wt", ",", "ft", ")", ",", "F", "(", "\"", "YYYYYY", "\"", ",", "wt", ",", "ft", ")", ",", "H", "(", "[\"", "YYYYY", "\"", ",\"", "YYYYYY", "\"", "],", "xt", ")", ",", "H", "(", "\"", "YYYY", "\"", ",", "function", "(", "t", ",", "n", ")", "{", "n", "[", "xt", "]", "=", "2", "=", "==", "t", ".", "length", "?", "e", ".", "parseTwoDigitYear", "(", "t", ")", ":", "g", "(", "t", ")", "})", ",", "H", "(", "\"", "YY", "\"", ",", "function", "(", "t", ",", "n", ")", "{", "n", "[", "xt", "]", "=", "e", ".", "parseTwoDigitYear", "(", "t", ")", "})", ",", "H", "(", "\"", "Y", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "t", "[", "xt", "]", "=", "parseInt", "(", "e", ",", "10", ")", "})", ",", "e", ".", "parseTwoDigitYear", "=", "function", "(", "e", ")", "{", "return", "g", "(", "e", ")", "+(", "g", "(", "e", ")", ">", "68", "?", "1900", ":", "2e3", ")", "};", "var", "Nt", ",", "Ht", "=", "I", "(", "\"", "FullYear", "\"", ",!", "0", ")", ";", "Nt", "=", "Array", ".", "prototype", ".", "indexOf", "?", "Array", ".", "prototype", ".", "indexOf", ":", "function", "(", "e", ")", "{", "var", "t", ";", "for", "(", "t", "=", "0", ";", "t", "<", "this", ".", "length", ";", "++", "t", ")", "if", "(", "this", "[", "t", "]", "==", "=", "e", ")", "return", "t", ";", "return", "-", "1", "}", ",", "P", "(", "\"", "M", "\"", ",[", "\"", "MM", "\"", ",", "2", "]", ",\"", "Mo", "\"", ",", "function", "(", "){", "return", "this", ".", "month", "(", ")+", "1", "}", "),", "P", "(", "\"", "MMM", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "monthsShort", "(", "this", ",", "e", ")", "})", ",", "P", "(", "\"", "MMMM", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "months", "(", "this", ",", "e", ")", "})", ",", "Y", "(", "\"", "month", "\"", ",\"", "M", "\"", "),", "T", "(", "\"", "month", "\"", ",", "8", ")", ",", "F", "(", "\"", "M", "\"", ",", "mt", ")", ",", "F", "(", "\"", "MM", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "MMM", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "monthsShortRegex", "(", "e", ")", "})", ",", "F", "(", "\"", "MMMM", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "monthsRegex", "(", "e", ")", "})", ",", "H", "(", "[\"", "M", "\"", ",\"", "MM", "\"", "],", "function", "(", "e", ",", "t", ")", "{", "t", "[", "Tt", "]", "=", "g", "(", "e", ")", "-", "1", "}", "),", "H", "(", "[\"", "MMM", "\"", ",\"", "MMMM", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "n", ".", "_locale", ".", "monthsParse", "(", "e", ",", "s", ",", "n", ".", "_strict", ")", ";", "null", "!", "=", "i", "?", "t", "[", "Tt", "]", "=", "i", ":", "d", "(", "n", ")", ".", "invalidMonth", "=", "e", "}", ");", "var", "Lt", "=", "/", "D", "[", "oD", "]", "?(", "\\[", "[^", "\\[", "\\]", "]*", "\\]", "|\\", "s", ")", "+", "MMMM", "?", "/,", "Gt", "=", "\"", "January_February_March_April_May_June_July_August_September_October_November_December", "\"", ".", "split", "(", "\"", "_", "\"", "),", "Vt", "=", "\"", "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec", "\"", ".", "split", "(", "\"", "_", "\"", "),", "jt", "=", "Dt", ",", "It", "=", "Dt", ";", "P", "(", "\"", "w", "\"", ",[", "\"", "ww", "\"", ",", "2", "]", ",\"", "wo", "\"", ",\"", "week", "\"", "),", "P", "(", "\"", "W", "\"", ",[", "\"", "WW", "\"", ",", "2", "]", ",\"", "Wo", "\"", ",\"", "isoWeek", "\"", "),", "Y", "(", "\"", "week", "\"", ",\"", "w", "\"", "),", "Y", "(", "\"", "isoWeek", "\"", ",\"", "W", "\"", "),", "T", "(", "\"", "week", "\"", ",", "5", ")", ",", "T", "(", "\"", "isoWeek", "\"", ",", "5", ")", ",", "F", "(", "\"", "w", "\"", ",", "mt", ")", ",", "F", "(", "\"", "ww", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "W", "\"", ",", "mt", ")", ",", "F", "(", "\"", "WW", "\"", ",", "mt", ",", "dt", ")", ",", "L", "(", "[\"", "w", "\"", ",\"", "ww", "\"", ",\"", "W", "\"", ",\"", "WW", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "t", "[", "s", ".", "substr", "(", "0", ",", "1", ")", "]=", "g", "(", "e", ")", "})", ";", "P", "(", "\"", "d", "\"", ",", "0", ",", "\"", "do", "\"", ",\"", "day", "\"", "),", "P", "(", "\"", "dd", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdaysMin", "(", "this", ",", "e", ")", "})", ",", "P", "(", "\"", "ddd", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdaysShort", "(", "this", ",", "e", ")", "})", ",", "P", "(", "\"", "dddd", "\"", ",", "0", ",", "0", ",", "function", "(", "e", ")", "{", "return", "this", ".", "localeData", "(", ").", "weekdays", "(", "this", ",", "e", ")", "})", ",", "P", "(", "\"", "e", "\"", ",", "0", ",", "0", ",", "\"", "weekday", "\"", "),", "P", "(", "\"", "E", "\"", ",", "0", ",", "0", ",", "\"", "isoWeekday", "\"", "),", "Y", "(", "\"", "day", "\"", ",\"", "d", "\"", "),", "Y", "(", "\"", "weekday", "\"", ",\"", "e", "\"", "),", "Y", "(", "\"", "isoWeekday", "\"", ",\"", "E", "\"", "),", "T", "(", "\"", "day", "\"", ",", "11", ")", ",", "T", "(", "\"", "weekday", "\"", ",", "11", ")", ",", "T", "(", "\"", "isoWeekday", "\"", ",", "11", ")", ",", "F", "(", "\"", "d", "\"", ",", "mt", ")", ",", "F", "(", "\"", "e", "\"", ",", "mt", ")", ",", "F", "(", "\"", "E", "\"", ",", "mt", ")", ",", "F", "(", "\"", "dd", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "weekdaysMinRegex", "(", "e", ")", "})", ",", "F", "(", "\"", "ddd", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "weekdaysShortRegex", "(", "e", ")", "})", ",", "F", "(", "\"", "dddd", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "t", ".", "weekdaysRegex", "(", "e", ")", "})", ",", "L", "(", "[\"", "dd", "\"", ",\"", "ddd", "\"", ",\"", "dddd", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "n", ".", "_locale", ".", "weekdaysParse", "(", "e", ",", "s", ",", "n", ".", "_strict", ")", ";", "null", "!", "=", "i", "?", "t", ".", "d", "=", "i", ":", "d", "(", "n", ")", ".", "invalidWeekday", "=", "e", "}", "),", "L", "(", "[\"", "d", "\"", ",\"", "e", "\"", ",\"", "E", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "t", "[", "s", "]", "=", "g", "(", "e", ")", "})", ";", "var", "Et", "=", "\"", "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday", "\"", ".", "split", "(", "\"", "_", "\"", "),", "At", "=", "\"", "Sun_Mon_Tue_Wed_Thu_Fri_Sat", "\"", ".", "split", "(", "\"", "_", "\"", "),", "zt", "=", "\"", "Su_Mo_Tu_We_Th_Fr_Sa", "\"", ".", "split", "(", "\"", "_", "\"", "),", "Zt", "=", "Dt", ",", "$", "t", "=", "Dt", ",", "qt", "=", "Dt", ";", "P", "(", "\"", "H", "\"", ",[", "\"", "HH", "\"", ",", "2", "]", ",", "0", ",", "\"", "hour", "\"", "),", "P", "(", "\"", "h", "\"", ",[", "\"", "hh", "\"", ",", "2", "]", ",", "0", ",", "te", ")", ",", "P", "(", "\"", "k", "\"", ",[", "\"", "kk", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "this", ".", "hours", "(", ")|", "|", "24", "}", "),", "P", "(", "\"", "hmm", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "\"", "\"+", "te", ".", "apply", "(", "this", ")", "+", "b", "(", "this", ".", "minutes", "(", "),", "2", ")", "})", ",", "P", "(", "\"", "hmmss", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "\"", "\"+", "te", ".", "apply", "(", "this", ")", "+", "b", "(", "this", ".", "minutes", "(", "),", "2", ")", "+", "b", "(", "this", ".", "seconds", "(", "),", "2", ")", "})", ",", "P", "(", "\"", "Hmm", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "\"", "\"+", "this", ".", "hours", "(", ")+", "b", "(", "this", ".", "minutes", "(", "),", "2", ")", "})", ",", "P", "(", "\"", "Hmmss", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "\"", "\"+", "this", ".", "hours", "(", ")+", "b", "(", "this", ".", "minutes", "(", "),", "2", ")", "+", "b", "(", "this", ".", "seconds", "(", "),", "2", ")", "})", ",", "ne", "(", "\"", "a", "\"", ",!", "0", ")", ",", "ne", "(", "\"", "A", "\"", ",!", "1", ")", ",", "Y", "(", "\"", "hour", "\"", ",\"", "h", "\"", "),", "T", "(", "\"", "hour", "\"", ",", "13", ")", ",", "F", "(", "\"", "a", "\"", ",", "se", ")", ",", "F", "(", "\"", "A", "\"", ",", "se", ")", ",", "F", "(", "\"", "H", "\"", ",", "mt", ")", ",", "F", "(", "\"", "h", "\"", ",", "mt", ")", ",", "F", "(", "\"", "k", "\"", ",", "mt", ")", ",", "F", "(", "\"", "HH", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "hh", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "kk", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "hmm", "\"", ",", "_t", ")", ",", "F", "(", "\"", "hmmss", "\"", ",", "yt", ")", ",", "F", "(", "\"", "Hmm", "\"", ",", "_t", ")", ",", "F", "(", "\"", "Hmmss", "\"", ",", "yt", ")", ",", "H", "(", "[\"", "H", "\"", ",\"", "HH", "\"", "],", "Pt", ")", ",", "H", "(", "[\"", "k", "\"", ",\"", "kk", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "g", "(", "e", ")", ";", "t", "[", "Pt", "]", "=", "24", "=", "==", "s", "?", "0", ":", "s", "}", "),", "H", "(", "[\"", "a", "\"", ",\"", "A", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_isPm", "=", "n", ".", "_locale", ".", "isPM", "(", "e", ")", ",", "n", ".", "_meridiem", "=", "e", "}", "),", "H", "(", "[\"", "h", "\"", ",\"", "hh", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "t", "[", "Pt", "]", "=", "g", "(", "e", ")", ",", "d", "(", "n", ")", ".", "bigHour", "=", "!", "0", "}", "),", "H", "(", "\"", "hmm", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "e", ".", "length", "-", "2", ";", "t", "[", "Pt", "]", "=", "g", "(", "e", ".", "substr", "(", "0", ",", "s", ")", "),", "t", "[", "Wt", "]", "=", "g", "(", "e", ".", "substr", "(", "s", ")", "),", "d", "(", "n", ")", ".", "bigHour", "=", "!", "0", "}", "),", "H", "(", "\"", "hmmss", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "e", ".", "length", "-", "4", ",", "i", "=", "e", ".", "length", "-", "2", ";", "t", "[", "Pt", "]", "=", "g", "(", "e", ".", "substr", "(", "0", ",", "s", ")", "),", "t", "[", "Wt", "]", "=", "g", "(", "e", ".", "substr", "(", "s", ",", "2", ")", "),", "t", "[", "Rt", "]", "=", "g", "(", "e", ".", "substr", "(", "i", ")", "),", "d", "(", "n", ")", ".", "bigHour", "=", "!", "0", "}", "),", "H", "(", "\"", "Hmm", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "e", ".", "length", "-", "2", ";", "t", "[", "Pt", "]", "=", "g", "(", "e", ".", "substr", "(", "0", ",", "s", ")", "),", "t", "[", "Wt", "]", "=", "g", "(", "e", ".", "substr", "(", "s", ")", ")}", "),", "H", "(", "\"", "Hmmss", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "e", ".", "length", "-", "4", ",", "i", "=", "e", ".", "length", "-", "2", ";", "t", "[", "Pt", "]", "=", "g", "(", "e", ".", "substr", "(", "0", ",", "s", ")", "),", "t", "[", "Wt", "]", "=", "g", "(", "e", ".", "substr", "(", "s", ",", "2", ")", "),", "t", "[", "Rt", "]", "=", "g", "(", "e", ".", "substr", "(", "i", ")", ")}", ");", "var", "Jt", ",", "Bt", "=", "I", "(", "\"", "Hours", "\"", ",!", "0", ")", ",", "Qt", "=", "{", "calendar", ":", "{", "sameDay", ":", "\"[", "Today", "at", "]", "LT", "\"", ",", "nextDay", ":", "\"[", "Tomorrow", "at", "]", "LT", "\"", ",", "nextWeek", ":", "\"", "dddd", "[", "at", "]", "LT", "\"", ",", "lastDay", ":", "\"[", "Yesterday", "at", "]", "LT", "\"", ",", "lastWeek", ":", "\"[", "Last", "]", "dddd", "[", "at", "]", "LT", "\"", ",", "sameElse", ":", "\"", "L", "\"", "},", "longDateFormat", ":", "{", "LTS", ":", "\"", "h", ":", "mm", ":", "ss", "A", "\"", ",", "LT", ":", "\"", "h", ":", "mm", "A", "\"", ",", "L", ":", "\"", "MM", "/", "DD", "/", "YYYY", "\"", ",", "LL", ":", "\"", "MMMM", "D", ",", "YYYY", "\"", ",", "LLL", ":", "\"", "MMMM", "D", ",", "YYYY", "h", ":", "mm", "A", "\"", ",", "LLLL", ":", "\"", "dddd", ",", "MMMM", "D", ",", "YYYY", "h", ":", "mm", "A", "\"", "},", "invalidDate", ":", "\"", "Invalid", "date", "\"", ",", "ordinal", ":", "\"%", "d", "\"", ",", "dayOfMonthOrdinalParse", ":", "/\\", "d", "{", "1", ",", "2", "}", "/,", "relativeTime", ":", "{", "future", ":", "\"", "in", "%", "s", "\"", ",", "past", ":", "\"%", "s", "ago", "\"", ",", "s", ":", "\"", "a", "few", "seconds", "\"", ",", "ss", ":", "\"%", "d", "seconds", "\"", ",", "m", ":", "\"", "a", "minute", "\"", ",", "mm", ":", "\"%", "d", "minutes", "\"", ",", "h", ":", "\"", "an", "hour", "\"", ",", "hh", ":", "\"%", "d", "hours", "\"", ",", "d", ":", "\"", "a", "day", "\"", ",", "dd", ":", "\"%", "d", "days", "\"", ",", "M", ":", "\"", "a", "month", "\"", ",", "MM", ":", "\"%", "d", "months", "\"", ",", "y", ":", "\"", "a", "year", "\"", ",", "yy", ":", "\"%", "d", "years", "\"", "},", "months", ":", "Gt", ",", "monthsShort", ":", "Vt", ",", "week", ":", "{", "dow", ":", "0", ",", "doy", ":", "6", "}", ",", "weekdays", ":", "Et", ",", "weekdaysMin", ":", "zt", ",", "weekdaysShort", ":", "At", ",", "meridiemParse", ":", "/[", "ap", "]", "\\.", "?", "m", "?", "\\.", "?/", "i", "}", ",", "Xt", "=", "{}", ",", "Kt", "=", "{}", ",", "en", "=", "/^", "\\", "s", "*", "((", "?:", "[+", "-]", "\\", "d", "{", "6", "}", "|\\", "d", "{", "4", "}", ")-", "(?", ":\\", "d", "\\", "d", "-", "\\", "d", "\\", "d", "|", "W", "\\", "d", "\\", "d", "-", "\\", "d", "|", "W", "\\", "d", "\\", "d", "|", "\\", "d", "\\", "d", "\\", "d", "|", "\\", "d", "\\", "d", ")", ")(", "?:", "(", "T", "|", ")", "(\\", "d", "\\", "d", "(", "?:", ":\\", "d", "\\", "d", "(", "?:", ":\\", "d", "\\", "d", "(", "?:", "[.", ",]", "\\", "d", "+", ")?", ")?", ")?", ")(", "[\\", "+\\", "-]", "\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?|", "\\", "s", "*", "Z", ")", "?)", "?$", "/,", "tn", "=", "/^", "\\", "s", "*", "((", "?:", "[+", "-]", "\\", "d", "{", "6", "}", "|\\", "d", "{", "4", "}", ")(", "?:", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "|", "W", "\\", "d", "\\", "d", "\\", "d", "|", "W", "\\", "d", "\\", "d", "|", "\\", "d", "\\", "d", "\\", "d", "|", "\\", "d", "\\", "d", ")", ")(", "?:", "(", "T", "|", ")", "(\\", "d", "\\", "d", "(", "?:", "\\", "d", "\\", "d", "(", "?:", "\\", "d", "\\", "d", "(", "?:", "[.", ",]", "\\", "d", "+", ")?", ")?", ")?", ")(", "[\\", "+\\", "-]", "\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?|", "\\", "s", "*", "Z", ")", "?)", "?$", "/,", "nn", "=", "/", "Z", "|", "[+", "-]", "\\", "d", "\\", "d", "(", "?:", ":?", "\\", "d", "\\", "d", ")", "?/", ",", "sn", "=", "[[", "\"", "YYYYYY", "-", "MM", "-", "DD", "\"", ",/", "[+", "-]", "\\", "d", "{", "6", "}", "-\\", "d", "\\", "d", "-", "\\", "d", "\\", "d", "/", "],", "[\"", "YYYY", "-", "MM", "-", "DD", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "\\", "d", "-", "\\", "d", "\\", "d", "/", "],", "[\"", "GGGG", "-", "[", "W", "]", "WW", "-", "E", "\"", ",/", "\\", "d", "{", "4", "}", "-", "W", "\\", "d", "\\", "d", "-", "\\", "d", "/", "],", "[\"", "GGGG", "-", "[", "W", "]", "WW", "\"", ",/", "\\", "d", "{", "4", "}", "-", "W", "\\", "d", "\\", "d", "/", ",!", "1", "]", ",[", "\"", "YYYY", "-", "DDD", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "{", "3", "}", "/]", ",[", "\"", "YYYY", "-", "MM", "\"", ",/", "\\", "d", "{", "4", "}", "-\\", "d", "\\", "d", "/", ",!", "1", "]", ",[", "\"", "YYYYYYMMDD", "\"", ",/", "[+", "-]", "\\", "d", "{", "10", "}", "/]", ",[", "\"", "YYYYMMDD", "\"", ",/", "\\", "d", "{", "8", "}", "/]", ",[", "\"", "GGGG", "[", "W", "]", "WWE", "\"", ",/", "\\", "d", "{", "4", "}", "W", "\\", "d", "{", "3", "}", "/]", ",[", "\"", "GGGG", "[", "W", "]", "WW", "\"", ",/", "\\", "d", "{", "4", "}", "W", "\\", "d", "{", "2", "}", "/,", "!", "1", "]", ",[", "\"", "YYYYDDD", "\"", ",/", "\\", "d", "{", "7", "}", "/]", "],", "rn", "=", "[[", "\"", "HH", ":", "mm", ":", "ss", ".", "SSSS", "\"", ",/", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "\\", ".\\", "d", "+", "/]", ",[", "\"", "HH", ":", "mm", ":", "ss", ",", "SSSS", "\"", ",/", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ",", "\\", "d", "+", "/]", ",[", "\"", "HH", ":", "mm", ":", "ss", "\"", ",/", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "/", "],", "[\"", "HH", ":", "mm", "\"", ",/", "\\", "d", "\\", "d", ":", "\\", "d", "\\", "d", "/", "],", "[\"", "HHmmss", ".", "SSSS", "\"", ",/", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", ".\\", "d", "+", "/]", ",[", "\"", "HHmmss", ",", "SSSS", "\"", ",/", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", ",", "\\", "d", "+", "/]", ",[", "\"", "HHmmss", "\"", ",/", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "/", "],", "[\"", "HHmm", "\"", ",/", "\\", "d", "\\", "d", "\\", "d", "\\", "d", "/", "],", "[\"", "HH", "\"", ",/", "\\", "d", "\\", "d", "/", "]]", ",", "an", "=", "/^", "\\/", "?", "Date", "\\", "((", "\\-", "?\\", "d", "+", ")/", "i", ",", "on", "=", "/^", "(?", ":(", "Mon", "|", "Tue", "|", "Wed", "|", "Thu", "|", "Fri", "|", "Sat", "|", "Sun", ")", ",?", "\\", "s", ")", "?(", "\\", "d", "{", "1", ",", "2", "}", ")\\", "s", "(", "Jan", "|", "Feb", "|", "Mar", "|", "Apr", "|", "May", "|", "Jun", "|", "Jul", "|", "Aug", "|", "Sep", "|", "Oct", "|", "Nov", "|", "Dec", ")", "\\", "s", "(", "\\", "d", "{", "2", ",", "4", "}", ")\\", "s", "(", "\\", "d", "\\", "d", ")", ":(", "\\", "d", "\\", "d", ")", "(?", "::", "(\\", "d", "\\", "d", ")", ")?", "\\", "s", "(", "?:", "(", "UT", "|", "GMT", "|", "[", "ECMP", "]", "[", "SD", "]", "T", ")", "|(", "[", "Zz", "]", ")|", "([", "+-", "]\\", "d", "{", "4", "}", "))", "$/", ",", "un", "=", "{", "UT", ":", "0", ",", "GMT", ":", "0", ",", "EDT", ":", "-", "240", ",", "EST", ":", "-", "300", ",", "CDT", ":", "-", "300", ",", "CST", ":", "-", "360", ",", "MDT", ":", "-", "360", ",", "MST", ":", "-", "420", ",", "PDT", ":", "-", "420", ",", "PST", ":", "-", "480", "}", ";", "e", ".", "createFromInputFallback", "=", "v", "(", "\"", "value", "provided", "is", "not", "in", "a", "recognized", "RFC2822", "or", "ISO", "format", ".", "moment", "construction", "falls", "back", "to", "js", "Date", "(", "),", "which", "is", "not", "reliable", "across", "all", "browsers", "and", "versions", ".", "Non", "RFC2822", "/", "ISO", "date", "formats", "are", "discouraged", "and", "will", "be", "removed", "in", "an", "upcoming", "major", "release", ".", "Please", "refer", "to", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "js", "-", "date", "/", "for", "more", "info", ".", "\",", "function", "(", "e", ")", "{", "e", ".", "_d", "=", "new", "Date", "(", "e", ".", "_i", "+", "(", "e", ".", "_useUTC", "?", "\"", "UTC", "\"", ":\"", "\")", ")}", "),", "e", ".", "ISO_8601", "=", "function", "(", "){", "},", "e", ".", "RFC_2822", "=", "function", "(", "){", "};", "var", "ln", "=", "v", "(", "\"", "moment", "(", ").", "min", "is", "deprecated", ",", "use", "moment", ".", "max", "instead", ".", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "min", "-", "max", "/", "\",", "function", "(", "){", "var", "e", "=", "pe", ".", "apply", "(", "null", ",", "arguments", ")", ";", "return", "this", ".", "isValid", "(", ")&", "&", "e", ".", "isValid", "(", ")?", "e", "<", "this", "?", "this", ":", "e", ":", "c", "(", ")}", "),", "dn", "=", "v", "(", "\"", "moment", "(", ").", "max", "is", "deprecated", ",", "use", "moment", ".", "min", "instead", ".", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "min", "-", "max", "/", "\",", "function", "(", "){", "var", "e", "=", "pe", ".", "apply", "(", "null", ",", "arguments", ")", ";", "return", "this", ".", "isValid", "(", ")&", "&", "e", ".", "isValid", "(", ")?", "e", ">", "this", "?", "this", ":", "e", ":", "c", "(", ")}", "),", "hn", "=", "[\"", "year", "\"", ",\"", "quarter", "\"", ",\"", "month", "\"", ",\"", "week", "\"", ",\"", "day", "\"", ",\"", "hour", "\"", ",\"", "minute", "\"", ",\"", "second", "\"", ",\"", "millisecond", "\"", "];", "Se", "(", "\"", "Z", "\"", ",\"", ":\"", "),", "Se", "(", "\"", "ZZ", "\"", ",\"", "\")", ",", "F", "(", "\"", "Z", "\"", ",", "St", ")", ",", "F", "(", "\"", "ZZ", "\"", ",", "St", ")", ",", "H", "(", "[\"", "Z", "\"", ",\"", "ZZ", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_useUTC", "=", "!", "0", ",", "n", ".", "_tzm", "=", "De", "(", "St", ",", "e", ")", "})", ";", "var", "cn", "=", "/(", "[\\", "+\\", "-]", "|\\", "d", "\\", "d", ")", "/", "gi", ";", "e", ".", "updateOffset", "=", "function", "(", "){", "};", "var", "fn", "=", "/^", "(\\", "-|", "\\+", ")?", "(?", ":(", "\\", "d", "*", ")[", ".", "]", ")?", "(\\", "d", "+", ")\\", ":(", "\\", "d", "+", ")(", "?:", "\\:", "(\\", "d", "+", ")(", "\\.", "\\", "d", "*", ")?", ")?", "$/", ",", "mn", "=", "/^", "(-", "|\\", "+)", "?", "P", "(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "Y", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "M", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "W", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "D", ")", "?(", "?:", "T", "(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "H", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "M", ")", "?(", "?:", "([", "-+", "]?", "[", "0", "-", "9", ",", ".]", "*)", "S", ")", "?)", "?$", "/;", "Te", ".", "fn", "=", "ve", ".", "prototype", ",", "Te", ".", "invalid", "=", "function", "(", "){", "return", "Te", "(", "NaN", ")", "};", "var", "_n", "=", "We", "(", "1", ",", "\"", "add", "\"", "),", "yn", "=", "We", "(", "-", "1", ",", "\"", "subtract", "\"", ");", "e", ".", "defaultFormat", "=", "\"", "YYYY", "-", "MM", "-", "DDTHH", ":", "mm", ":", "ssZ", "\"", ",", "e", ".", "defaultFormatUtc", "=", "\"", "YYYY", "-", "MM", "-", "DDTHH", ":", "mm", ":", "ss", "[", "Z", "]", "\";", "var", "gn", "=", "v", "(", "\"", "moment", "(", ").", "lang", "(", ")", "is", "deprecated", ".", "Instead", ",", "use", "moment", "(", ").", "localeData", "(", ")", "to", "get", "the", "language", "configuration", ".", "Use", "moment", "(", ").", "locale", "(", ")", "to", "change", "languages", ".", "\",", "function", "(", "e", ")", "{", "return", "void", "0", "=", "==", "e", "?", "this", ".", "localeData", "(", "):", "this", ".", "locale", "(", "e", ")", "})", ";", "P", "(", "0", ",", "[\"", "gg", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "this", ".", "weekYear", "(", ")%", "100", "}", "),", "P", "(", "0", ",", "[\"", "GG", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "this", ".", "isoWeekYear", "(", ")%", "100", "}", "),", "Ne", "(", "\"", "gggg", "\"", ",\"", "weekYear", "\"", "),", "Ne", "(", "\"", "ggggg", "\"", ",\"", "weekYear", "\"", "),", "Ne", "(", "\"", "GGGG", "\"", ",\"", "isoWeekYear", "\"", "),", "Ne", "(", "\"", "GGGGG", "\"", ",\"", "isoWeekYear", "\"", "),", "Y", "(", "\"", "weekYear", "\"", ",\"", "gg", "\"", "),", "Y", "(", "\"", "isoWeekYear", "\"", ",\"", "GG", "\"", "),", "T", "(", "\"", "weekYear", "\"", ",", "1", ")", ",", "T", "(", "\"", "isoWeekYear", "\"", ",", "1", ")", ",", "F", "(", "\"", "G", "\"", ",", "Mt", ")", ",", "F", "(", "\"", "g", "\"", ",", "Mt", ")", ",", "F", "(", "\"", "GG", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "gg", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "GGGG", "\"", ",", "pt", ",", "ct", ")", ",", "F", "(", "\"", "gggg", "\"", ",", "pt", ",", "ct", ")", ",", "F", "(", "\"", "GGGGG", "\"", ",", "wt", ",", "ft", ")", ",", "F", "(", "\"", "ggggg", "\"", ",", "wt", ",", "ft", ")", ",", "L", "(", "[\"", "gggg", "\"", ",\"", "ggggg", "\"", ",\"", "GGGG", "\"", ",\"", "GGGGG", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "t", "[", "s", ".", "substr", "(", "0", ",", "2", ")", "]=", "g", "(", "e", ")", "})", ",", "L", "(", "[\"", "gg", "\"", ",\"", "GG", "\"", "],", "function", "(", "t", ",", "n", ",", "s", ",", "i", ")", "{", "n", "[", "i", "]", "=", "e", ".", "parseTwoDigitYear", "(", "t", ")", "})", ",", "P", "(", "\"", "Q", "\"", ",", "0", ",", "\"", "Qo", "\"", ",\"", "quarter", "\"", "),", "Y", "(", "\"", "quarter", "\"", ",\"", "Q", "\"", "),", "T", "(", "\"", "quarter", "\"", ",", "7", ")", ",", "F", "(", "\"", "Q", "\"", ",", "lt", ")", ",", "H", "(", "\"", "Q", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "t", "[", "Tt", "]", "=", "3", "*", "(", "g", "(", "e", ")", "-", "1", ")", "})", ",", "P", "(", "\"", "D", "\"", ",[", "\"", "DD", "\"", ",", "2", "]", ",\"", "Do", "\"", ",\"", "date", "\"", "),", "Y", "(", "\"", "date", "\"", ",\"", "D", "\"", "),", "T", "(", "\"", "date", "\"", ",", "9", ")", ",", "F", "(", "\"", "D", "\"", ",", "mt", ")", ",", "F", "(", "\"", "DD", "\"", ",", "mt", ",", "dt", ")", ",", "F", "(", "\"", "Do", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "return", "e", "?", "t", ".", "_dayOfMonthOrdinalParse", "|", "|", "t", ".", "_ordinalParse", ":", "t", ".", "_dayOfMonthOrdinalParseLenient", "}", "),", "H", "(", "[\"", "D", "\"", ",\"", "DD", "\"", "],", "bt", ")", ",", "H", "(", "\"", "Do", "\"", ",", "function", "(", "e", ",", "t", ")", "{", "t", "[", "bt", "]", "=", "g", "(", "e", ".", "match", "(", "mt", ")", "[", "0", "]", ")}", ");", "var", "pn", "=", "I", "(", "\"", "Date", "\"", ",!", "0", ")", ";", "P", "(", "\"", "DDD", "\"", ",[", "\"", "DDDD", "\"", ",", "3", "]", ",\"", "DDDo", "\"", ",\"", "dayOfYear", "\"", "),", "Y", "(", "\"", "dayOfYear", "\"", ",\"", "DDD", "\"", "),", "T", "(", "\"", "dayOfYear", "\"", ",", "4", ")", ",", "F", "(", "\"", "DDD", "\"", ",", "gt", ")", ",", "F", "(", "\"", "DDDD", "\"", ",", "ht", ")", ",", "H", "(", "[\"", "DDD", "\"", ",\"", "DDDD", "\"", "],", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_dayOfYear", "=", "g", "(", "e", ")", "})", ",", "P", "(", "\"", "m", "\"", ",[", "\"", "mm", "\"", ",", "2", "]", ",", "0", ",", "\"", "minute", "\"", "),", "Y", "(", "\"", "minute", "\"", ",\"", "m", "\"", "),", "T", "(", "\"", "minute", "\"", ",", "14", ")", ",", "F", "(", "\"", "m", "\"", ",", "mt", ")", ",", "F", "(", "\"", "mm", "\"", ",", "mt", ",", "dt", ")", ",", "H", "(", "[\"", "m", "\"", ",\"", "mm", "\"", "],", "Wt", ")", ";", "var", "wn", "=", "I", "(", "\"", "Minutes", "\"", ",!", "1", ")", ";", "P", "(", "\"", "s", "\"", ",[", "\"", "ss", "\"", ",", "2", "]", ",", "0", ",", "\"", "second", "\"", "),", "Y", "(", "\"", "second", "\"", ",\"", "s", "\"", "),", "T", "(", "\"", "second", "\"", ",", "15", ")", ",", "F", "(", "\"", "s", "\"", ",", "mt", ")", ",", "F", "(", "\"", "ss", "\"", ",", "mt", ",", "dt", ")", ",", "H", "(", "[\"", "s", "\"", ",\"", "ss", "\"", "],", "Rt", ")", ";", "var", "vn", "=", "I", "(", "\"", "Seconds", "\"", ",!", "1", ")", ";", "P", "(", "\"", "S", "\"", ",", "0", ",", "0", ",", "function", "(", "){", "return", "~", "~(", "this", ".", "millisecond", "(", ")/", "100", ")", "})", ",", "P", "(", "0", ",", "[\"", "SS", "\"", ",", "2", "]", ",", "0", ",", "function", "(", "){", "return", "~", "~(", "this", ".", "millisecond", "(", ")/", "10", ")", "})", ",", "P", "(", "0", ",", "[\"", "SSS", "\"", ",", "3", "]", ",", "0", ",", "\"", "millisecond", "\"", "),", "P", "(", "0", ",", "[\"", "SSSS", "\"", ",", "4", "]", ",", "0", ",", "function", "(", "){", "return", "10", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSS", "\"", ",", "5", "]", ",", "0", ",", "function", "(", "){", "return", "100", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSSS", "\"", ",", "6", "]", ",", "0", ",", "function", "(", "){", "return", "1e3", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSSSS", "\"", ",", "7", "]", ",", "0", ",", "function", "(", "){", "return", "1e4", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSSSSS", "\"", ",", "8", "]", ",", "0", ",", "function", "(", "){", "return", "1e5", "*", "this", ".", "millisecond", "(", ")}", "),", "P", "(", "0", ",", "[\"", "SSSSSSSSS", "\"", ",", "9", "]", ",", "0", ",", "function", "(", "){", "return", "1e6", "*", "this", ".", "millisecond", "(", ")}", "),", "Y", "(", "\"", "millisecond", "\"", ",\"", "ms", "\"", "),", "T", "(", "\"", "millisecond", "\"", ",", "16", ")", ",", "F", "(", "\"", "S", "\"", ",", "gt", ",", "lt", ")", ",", "F", "(", "\"", "SS", "\"", ",", "gt", ",", "dt", ")", ",", "F", "(", "\"", "SSS", "\"", ",", "gt", ",", "ht", ")", ";", "var", "Mn", ";", "for", "(", "Mn", "=", "\"", "SSSS", "\"", ";", "Mn", ".", "length", "<", "=", "9", ";", "Mn", "+", "=\"", "S", "\"", ")", "F", "(", "Mn", ",", "vt", ")", ";", "for", "(", "Mn", "=", "\"", "S", "\"", ";", "Mn", ".", "length", "<", "=", "9", ";", "Mn", "+", "=\"", "S", "\"", ")", "H", "(", "Mn", ",", "Le", ")", ";", "var", "kn", "=", "I", "(", "\"", "Milliseconds", "\"", ",!", "1", ")", ";", "P", "(", "\"", "z", "\"", ",", "0", ",", "0", ",", "\"", "zoneAbbr", "\"", "),", "P", "(", "\"", "zz", "\"", ",", "0", ",", "0", ",", "\"", "zoneName", "\"", ");", "var", "Sn", "=", "m", ".", "prototype", ";", "Sn", ".", "add", "=", "_n", ",", "Sn", ".", "calendar", "=", "function", "(", "t", ",", "n", ")", "{", "var", "s", "=", "t", "|", "|", "pe", "(", "),", "i", "=", "Ye", "(", "s", ",", "this", ")", ".", "startOf", "(", "\"", "day", "\"", "),", "r", "=", "e", ".", "calendarFormat", "(", "this", ",", "i", ")", "||", "\"", "sameElse", "\"", ",", "a", "=", "n", "&", "&(", "k", "(", "n", "[", "r", "]", ")?", "n", "[", "r", "]", ".", "call", "(", "this", ",", "s", ")", ":", "n", "[", "r", "]", ");", "return", "this", ".", "format", "(", "a", "|", "|", "this", ".", "localeData", "(", ").", "calendar", "(", "r", ",", "this", ",", "pe", "(", "s", ")", "))", "},", "Sn", ".", "clone", "=", "function", "(", "){", "return", "new", "m", "(", "this", ")", "},", "Sn", ".", "diff", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ";", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "NaN", ";", "if", "(", "!(", "s", "=", "Ye", "(", "e", ",", "this", ")", ").", "isValid", "(", "))", "return", "NaN", ";", "switch", "(", "i", "=", "6e4", "*", "(", "s", ".", "utcOffset", "(", ")-", "this", ".", "utcOffset", "(", "))", ",", "t", "=", "O", "(", "t", ")", "){", "case", "\"", "year", "\"", ":", "r", "=", "Ce", "(", "this", ",", "s", ")", "/", "12", ";", "break", ";", "case", "\"", "month", "\"", ":", "r", "=", "Ce", "(", "this", ",", "s", ")", ";", "break", ";", "case", "\"", "quarter", "\"", ":", "r", "=", "Ce", "(", "this", ",", "s", ")", "/", "3", ";", "break", ";", "case", "\"", "second", "\"", ":", "r", "=", "(", "this", "-", "s", ")", "/", "1e3", ";", "break", ";", "case", "\"", "minute", "\"", ":", "r", "=", "(", "this", "-", "s", ")", "/", "6e4", ";", "break", ";", "case", "\"", "hour", "\"", ":", "r", "=", "(", "this", "-", "s", ")", "/", "36e5", ";", "break", ";", "case", "\"", "day", "\"", ":", "r", "=", "(", "this", "-", "s", "-", "i", ")", "/", "864e5", ";", "break", ";", "case", "\"", "week", "\"", ":", "r", "=", "(", "this", "-", "s", "-", "i", ")", "/", "6048e5", ";", "break", ";", "default", ":", "r", "=", "this", "-", "s", "}", "return", "n", "?", "r", ":", "y", "(", "r", ")", "},", "Sn", ".", "endOf", "=", "function", "(", "e", ")", "{", "return", "void", "0", "=", "==", "(", "e", "=", "O", "(", "e", ")", ")|", "|\"", "millisecond", "\"", "==", "=", "e", "?", "this", ":", "(\"", "date", "\"", "==", "=", "e", "&", "&(", "e", "=", "\"", "day", "\"", "),", "this", ".", "startOf", "(", "e", ")", ".", "add", "(", "1", ",", "\"", "isoWeek", "\"", "==", "=", "e", "?", "\"", "week", "\"", ":", "e", ")", ".", "subtract", "(", "1", ",", "\"", "ms", "\"", "))", "},", "Sn", ".", "format", "=", "function", "(", "t", ")", "{", "t", "|", "|(", "t", "=", "this", ".", "isUtc", "(", ")?", "e", ".", "defaultFormatUtc", ":", "e", ".", "defaultFormat", ")", ";", "var", "n", "=", "R", "(", "this", ",", "t", ")", ";", "return", "this", ".", "localeData", "(", ").", "postformat", "(", "n", ")", "},", "Sn", ".", "from", "=", "function", "(", "e", ",", "t", ")", "{", "return", "this", ".", "isValid", "(", ")&", "&(", "_", "(", "e", ")", "&&", "e", ".", "isValid", "(", ")|", "|", "pe", "(", "e", ")", ".", "isValid", "(", "))", "?", "Te", "(", "{", "to", ":", "this", ",", "from", ":", "e", "}", ").", "locale", "(", "this", ".", "locale", "(", "))", ".", "humanize", "(", "!", "t", ")", ":", "this", ".", "localeData", "(", ").", "invalidDate", "(", ")}", ",", "Sn", ".", "fromNow", "=", "function", "(", "e", ")", "{", "return", "this", ".", "from", "(", "pe", "(", "),", "e", ")", "},", "Sn", ".", "to", "=", "function", "(", "e", ",", "t", ")", "{", "return", "this", ".", "isValid", "(", ")&", "&(", "_", "(", "e", ")", "&&", "e", ".", "isValid", "(", ")|", "|", "pe", "(", "e", ")", ".", "isValid", "(", "))", "?", "Te", "(", "{", "from", ":", "this", ",", "to", ":", "e", "}", ").", "locale", "(", "this", ".", "locale", "(", "))", ".", "humanize", "(", "!", "t", ")", ":", "this", ".", "localeData", "(", ").", "invalidDate", "(", ")}", ",", "Sn", ".", "toNow", "=", "function", "(", "e", ")", "{", "return", "this", ".", "to", "(", "pe", "(", "),", "e", ")", "},", "Sn", ".", "get", "=", "function", "(", "e", ")", "{", "return", "e", "=", "O", "(", "e", ")", ",", "k", "(", "this", "[", "e", "]", ")?", "this", "[", "e", "]", "()", ":", "this", "}", ",", "Sn", ".", "invalidAt", "=", "function", "(", "){", "return", "d", "(", "this", ")", ".", "overflow", "}", ",", "Sn", ".", "isAfter", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", "=", "_", "(", "e", ")", "?", "e", ":", "pe", "(", "e", ")", ";", "return", "!", "(!", "this", ".", "isValid", "(", ")|", "|!", "n", ".", "isValid", "(", "))", "&&", "(\"", "millisecond", "\"", "==", "=(", "t", "=", "O", "(", "s", "(", "t", ")", "?\"", "millisecond", "\"", ":", "t", ")", ")?", "this", ".", "valueOf", "(", ")>", "n", ".", "valueOf", "(", "):", "n", ".", "valueOf", "(", ")<", "this", ".", "clone", "(", ").", "startOf", "(", "t", ")", ".", "valueOf", "(", "))", "},", "Sn", ".", "isBefore", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", "=", "_", "(", "e", ")", "?", "e", ":", "pe", "(", "e", ")", ";", "return", "!", "(!", "this", ".", "isValid", "(", ")|", "|!", "n", ".", "isValid", "(", "))", "&&", "(\"", "millisecond", "\"", "==", "=(", "t", "=", "O", "(", "s", "(", "t", ")", "?\"", "millisecond", "\"", ":", "t", ")", ")?", "this", ".", "valueOf", "(", ")<", "n", ".", "valueOf", "(", "):", "this", ".", "clone", "(", ").", "endOf", "(", "t", ")", ".", "valueOf", "(", ")<", "n", ".", "valueOf", "(", "))", "},", "Sn", ".", "isBetween", "=", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "return", "(", "\"(", "\"=", "==", "(", "s", "=", "s", "|", "|\"", "()", "\")", "[", "0", "]", "?", "this", ".", "isAfter", "(", "e", ",", "n", ")", ":!", "this", ".", "isBefore", "(", "e", ",", "n", ")", ")&", "&(", "\")", "\"=", "==", "s", "[", "1", "]", "?", "this", ".", "isBefore", "(", "t", ",", "n", ")", ":!", "this", ".", "isAfter", "(", "t", ",", "n", ")", ")}", ",", "Sn", ".", "isSame", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", ",", "s", "=", "_", "(", "e", ")", "?", "e", ":", "pe", "(", "e", ")", ";", "return", "!", "(!", "this", ".", "isValid", "(", ")|", "|!", "s", ".", "isValid", "(", "))", "&&", "(\"", "millisecond", "\"", "==", "=(", "t", "=", "O", "(", "t", "|", "|\"", "millisecond", "\"", "))", "?", "this", ".", "valueOf", "(", ")=", "==", "s", ".", "valueOf", "(", "):", "(", "n", "=", "s", ".", "valueOf", "(", "),", "this", ".", "clone", "(", ").", "startOf", "(", "t", ")", ".", "valueOf", "(", ")<", "=", "n", "&", "&", "n", "<", "=", "this", ".", "clone", "(", ").", "endOf", "(", "t", ")", ".", "valueOf", "(", "))", ")}", ",", "Sn", ".", "isSameOrAfter", "=", "function", "(", "e", ",", "t", ")", "{", "return", "this", ".", "isSame", "(", "e", ",", "t", ")", "||", "this", ".", "isAfter", "(", "e", ",", "t", ")", "},", "Sn", ".", "isSameOrBefore", "=", "function", "(", "e", ",", "t", ")", "{", "return", "this", ".", "isSame", "(", "e", ",", "t", ")", "||", "this", ".", "isBefore", "(", "e", ",", "t", ")", "},", "Sn", ".", "isValid", "=", "function", "(", "){", "return", "h", "(", "this", ")", "},", "Sn", ".", "lang", "=", "gn", ",", "Sn", ".", "locale", "=", "Fe", ",", "Sn", ".", "localeData", "=", "Ue", ",", "Sn", ".", "max", "=", "dn", ",", "Sn", ".", "min", "=", "ln", ",", "Sn", ".", "parsingFlags", "=", "function", "(", "){", "return", "u", "(", "{}", ",", "d", "(", "this", ")", ")}", ",", "Sn", ".", "set", "=", "function", "(", "e", ",", "t", ")", "{", "if", "(", "\"", "object", "\"", "==", "typeof", "e", ")", "for", "(", "var", "n", "=", "function", "(", "e", ")", "{", "var", "t", "=", "[]", ";", "for", "(", "var", "n", "in", "e", ")", "t", ".", "push", "(", "{", "unit", ":", "n", ",", "priority", ":", "it", "[", "n", "]", "})", ";", "return", "t", ".", "sort", "(", "function", "(", "e", ",", "t", ")", "{", "return", "e", ".", "priority", "-", "t", ".", "priority", "}", "),", "t", "}", "(", "e", "=", "x", "(", "e", ")", "),", "s", "=", "0", ";", "s", "<", "n", ".", "length", ";", "s", "+", "+)", "this", "[", "n", "[", "s", "]", ".", "unit", "]", "(", "e", "[", "n", "[", "s", "]", ".", "unit", "]", ");", "else", "if", "(", "e", "=", "O", "(", "e", ")", ",", "k", "(", "this", "[", "e", "]", "))", "return", "this", "[", "e", "]", "(", "t", ")", ";", "return", "this", "}", ",", "Sn", ".", "startOf", "=", "function", "(", "e", ")", "{", "switch", "(", "e", "=", "O", "(", "e", ")", "){", "case", "\"", "year", "\"", ":", "this", ".", "month", "(", "0", ")", ";", "case", "\"", "quarter", "\"", ":", "case", "\"", "month", "\"", ":", "this", ".", "date", "(", "1", ")", ";", "case", "\"", "week", "\"", ":", "case", "\"", "isoWeek", "\"", ":", "case", "\"", "day", "\"", ":", "case", "\"", "date", "\"", ":", "this", ".", "hours", "(", "0", ")", ";", "case", "\"", "hour", "\"", ":", "this", ".", "minutes", "(", "0", ")", ";", "case", "\"", "minute", "\"", ":", "this", ".", "seconds", "(", "0", ")", ";", "case", "\"", "second", "\"", ":", "this", ".", "milliseconds", "(", "0", ")", "}", "return", "\"", "week", "\"", "==", "=", "e", "&", "&", "this", ".", "weekday", "(", "0", ")", ",\"", "isoWeek", "\"", "==", "=", "e", "&", "&", "this", ".", "isoWeekday", "(", "1", ")", ",\"", "quarter", "\"", "==", "=", "e", "&", "&", "this", ".", "month", "(", "3", "*", "Math", ".", "floor", "(", "this", ".", "month", "(", ")/", "3", ")", "),", "this", "}", ",", "Sn", ".", "subtract", "=", "yn", ",", "Sn", ".", "toArray", "=", "function", "(", "){", "return", "[", "this", ".", "year", "(", "),", "this", ".", "month", "(", "),", "this", ".", "date", "(", "),", "this", ".", "hour", "(", "),", "this", ".", "minute", "(", "),", "this", ".", "second", "(", "),", "this", ".", "millisecond", "(", ")]", "},", "Sn", ".", "toObject", "=", "function", "(", "){", "return", "{", "years", ":", "this", ".", "year", "(", "),", "months", ":", "this", ".", "month", "(", "),", "date", ":", "this", ".", "date", "(", "),", "hours", ":", "this", ".", "hours", "(", "),", "minutes", ":", "this", ".", "minutes", "(", "),", "seconds", ":", "this", ".", "seconds", "(", "),", "milliseconds", ":", "this", ".", "milliseconds", "(", ")}", "},", "Sn", ".", "toDate", "=", "function", "(", "){", "return", "new", "Date", "(", "this", ".", "valueOf", "(", "))", "},", "Sn", ".", "toISOString", "=", "function", "(", "){", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", ";", "var", "e", "=", "this", ".", "clone", "(", ").", "utc", "(", ");", "return", "e", ".", "year", "(", ")<", "0", "|", "|", "e", ".", "year", "(", ")>", "9999", "?", "R", "(", "e", ",", "\"", "YYYYYY", "-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "[", "Z", "]", "\")", ":", "k", "(", "Date", ".", "prototype", ".", "toISOString", ")", "?", "this", ".", "toDate", "(", ").", "toISOString", "(", "):", "R", "(", "e", ",", "\"", "YYYY", "-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "[", "Z", "]", "\")", "},", "Sn", ".", "inspect", "=", "function", "(", "){", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "\"", "moment", ".", "invalid", "(", "/*", "\"", "+", "this", ".", "_i", "+", "\"", "*", "/)", "\";", "var", "e", "=", "\"", "moment", "\"", ",", "t", "=", "\"\"", ";", "this", ".", "isLocal", "(", ")|", "|(", "e", "=", "0", "=", "==", "this", ".", "utcOffset", "(", ")?", "\"", "moment", ".", "utc", "\"", ":\"", "moment", ".", "parseZone", "\"", ",", "t", "=", "\"", "Z", "\"", ");", "var", "n", "=", "\"[", "\"+", "e", "+", "'(", "\"]", "',", "s", "=", "0", "<", "=", "this", ".", "year", "(", ")&", "&", "this", ".", "year", "(", ")<", "=", "9999", "?", "\"", "YYYY", "\"", ":\"", "YYYYYY", "\"", ",", "i", "=", "t", "+", "'[", "\")", "]'", ";", "return", "this", ".", "format", "(", "n", "+", "s", "+", "\"-", "MM", "-", "DD", "[", "T", "]", "HH", ":", "mm", ":", "ss", ".", "SSS", "\"", "+", "i", ")", "},", "Sn", ".", "toJSON", "=", "function", "(", "){", "return", "this", ".", "isValid", "(", ")?", "this", ".", "toISOString", "(", "):", "null", "}", ",", "Sn", ".", "toString", "=", "function", "(", "){", "return", "this", ".", "clone", "(", ").", "locale", "(", "\"", "en", "\"", ").", "format", "(", "\"", "ddd", "MMM", "DD", "YYYY", "HH", ":", "mm", ":", "ss", "[", "GMT", "]", "ZZ", "\"", ")}", ",", "Sn", ".", "unix", "=", "function", "(", "){", "return", "Math", ".", "floor", "(", "this", ".", "valueOf", "(", ")/", "1e3", ")", "},", "Sn", ".", "valueOf", "=", "function", "(", "){", "return", "this", ".", "_d", ".", "valueOf", "(", ")-", "6e4", "*", "(", "this", ".", "_offset", "|", "|", "0", ")", "},", "Sn", ".", "creationData", "=", "function", "(", "){", "return", "{", "input", ":", "this", ".", "_i", ",", "format", ":", "this", ".", "_f", ",", "locale", ":", "this", ".", "_locale", ",", "isUTC", ":", "this", ".", "_isUTC", ",", "strict", ":", "this", ".", "_strict", "}", "},", "Sn", ".", "year", "=", "Ht", ",", "Sn", ".", "isLeapYear", "=", "function", "(", "){", "return", "j", "(", "this", ".", "year", "(", "))", "},", "Sn", ".", "weekYear", "=", "function", "(", "e", ")", "{", "return", "He", ".", "call", "(", "this", ",", "e", ",", "this", ".", "week", "(", "),", "this", ".", "weekday", "(", "),", "this", ".", "localeData", "(", ").", "_week", ".", "dow", ",", "this", ".", "localeData", "(", ").", "_week", ".", "doy", ")", "},", "Sn", ".", "isoWeekYear", "=", "function", "(", "e", ")", "{", "return", "He", ".", "call", "(", "this", ",", "e", ",", "this", ".", "isoWeek", "(", "),", "this", ".", "isoWeekday", "(", "),", "1", ",", "4", ")", "},", "Sn", ".", "quarter", "=", "Sn", ".", "quarters", "=", "function", "(", "e", ")", "{", "return", "null", "=", "=", "e", "?", "Math", ".", "ceil", "(", "(", "this", ".", "month", "(", ")+", "1", ")", "/", "3", ")", ":", "this", ".", "month", "(", "3", "*", "(", "e", "-", "1", ")", "+", "this", ".", "month", "(", ")%", "3", ")", "},", "Sn", ".", "month", "=", "$,", "Sn", ".", "daysInMonth", "=", "function", "(", "){", "return", "z", "(", "this", ".", "year", "(", "),", "this", ".", "month", "(", "))", "},", "Sn", ".", "week", "=", "Sn", ".", "weeks", "=", "function", "(", "e", ")", "{", "var", "t", "=", "this", ".", "localeData", "(", ").", "week", "(", "this", ")", ";", "return", "null", "=", "=", "e", "?", "t", ":", "this", ".", "add", "(", "7", "*", "(", "e", "-", "t", ")", ",\"", "d", "\"", ")}", ",", "Sn", ".", "isoWeek", "=", "Sn", ".", "isoWeeks", "=", "function", "(", "e", ")", "{", "var", "t", "=", "X", "(", "this", ",", "1", ",", "4", ")", ".", "week", ";", "return", "null", "=", "=", "e", "?", "t", ":", "this", ".", "add", "(", "7", "*", "(", "e", "-", "t", ")", ",\"", "d", "\"", ")}", ",", "Sn", ".", "weeksInYear", "=", "function", "(", "){", "var", "e", "=", "this", ".", "localeData", "(", ").", "_week", ";", "return", "K", "(", "this", ".", "year", "(", "),", "e", ".", "dow", ",", "e", ".", "doy", ")", "},", "Sn", ".", "isoWeeksInYear", "=", "function", "(", "){", "return", "K", "(", "this", ".", "year", "(", "),", "1", ",", "4", ")", "},", "Sn", ".", "date", "=", "pn", ",", "Sn", ".", "day", "=", "Sn", ".", "days", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", "!", "=", "e", "?", "this", ":", "NaN", ";", "var", "t", "=", "this", ".", "_isUTC", "?", "this", ".", "_d", ".", "getUTCDay", "(", "):", "this", ".", "_d", ".", "getDay", "(", ");", "return", "null", "!", "=", "e", "?", "(", "e", "=", "function", "(", "e", ",", "t", ")", "{", "return", "\"", "string", "\"", "!=", "typeof", "e", "?", "e", ":", "isNaN", "(", "e", ")", "?\"", "number", "\"", "==", "typeof", "(", "e", "=", "t", ".", "weekdaysParse", "(", "e", ")", ")?", "e", ":", "null", ":", "parseInt", "(", "e", ",", "10", ")", "}(", "e", ",", "this", ".", "localeData", "(", "))", ",", "this", ".", "add", "(", "e", "-", "t", ",", "\"", "d", "\"", "))", ":", "t", "}", ",", "Sn", ".", "weekday", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", "!", "=", "e", "?", "this", ":", "NaN", ";", "var", "t", "=", "(", "this", ".", "day", "(", ")+", "7", "-", "this", ".", "localeData", "(", ").", "_week", ".", "dow", ")", "%", "7", ";", "return", "null", "=", "=", "e", "?", "t", ":", "this", ".", "add", "(", "e", "-", "t", ",", "\"", "d", "\"", ")}", ",", "Sn", ".", "isoWeekday", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", "!", "=", "e", "?", "this", ":", "NaN", ";", "if", "(", "null", "!", "=", "e", ")", "{", "var", "t", "=", "function", "(", "e", ",", "t", ")", "{", "return", "\"", "string", "\"", "==", "typeof", "e", "?", "t", ".", "weekdaysParse", "(", "e", ")", "%", "7", "|", "|", "7", ":", "isNaN", "(", "e", ")", "?", "null", ":", "e", "}", "(", "e", ",", "this", ".", "localeData", "(", "))", ";", "return", "this", ".", "day", "(", "this", ".", "day", "(", ")%", "7", "?", "t", ":", "t", "-", "7", ")", "}", "return", "this", ".", "day", "(", ")|", "|", "7", "}", ",", "Sn", ".", "dayOfYear", "=", "function", "(", "e", ")", "{", "var", "t", "=", "Math", ".", "round", "(", "(", "this", ".", "clone", "(", ").", "startOf", "(", "\"", "day", "\"", ")-", "this", ".", "clone", "(", ").", "startOf", "(", "\"", "year", "\"", "))", "/", "864e5", ")", "+", "1", ";", "return", "null", "=", "=", "e", "?", "t", ":", "this", ".", "add", "(", "e", "-", "t", ",", "\"", "d", "\"", ")}", ",", "Sn", ".", "hour", "=", "Sn", ".", "hours", "=", "Bt", ",", "Sn", ".", "minute", "=", "Sn", ".", "minutes", "=", "wn", ",", "Sn", ".", "second", "=", "Sn", ".", "seconds", "=", "vn", ",", "Sn", ".", "millisecond", "=", "Sn", ".", "milliseconds", "=", "kn", ",", "Sn", ".", "utcOffset", "=", "function", "(", "t", ",", "n", ",", "s", ")", "{", "var", "i", ",", "r", "=", "this", ".", "_offset", "|", "|", "0", ";", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "null", "!", "=", "t", "?", "this", ":", "NaN", ";", "if", "(", "null", "!", "=", "t", ")", "{", "if", "(", "\"", "string", "\"", "==", "typeof", "t", ")", "{", "if", "(", "null", "=", "==", "(", "t", "=", "De", "(", "St", ",", "t", ")", "))", "return", "this", "}", "else", "Math", ".", "abs", "(", "t", ")", "<", "16", "&", "&!", "s", "&", "&(", "t", "*", "=", "60", ")", ";", "return", "!", "this", ".", "_isUTC", "&", "&", "n", "&", "&(", "i", "=", "Oe", "(", "this", ")", "),", "this", ".", "_offset", "=", "t", ",", "this", ".", "_isUTC", "=", "!", "0", ",", "null", "!", "=", "i", "&", "&", "this", ".", "add", "(", "i", ",", "\"", "m", "\"", "),", "r", "!", "==", "t", "&", "&(", "!", "n", "|", "|", "this", ".", "_changeInProgress", "?", "Re", "(", "this", ",", "Te", "(", "t", "-", "r", ",", "\"", "m", "\"", "),", "1", ",", "!", "1", ")", ":", "this", ".", "_changeInProgress", "|", "|(", "this", ".", "_changeInProgress", "=", "!", "0", ",", "e", ".", "updateOffset", "(", "this", ",", "!", "0", ")", ",", "this", ".", "_changeInProgress", "=", "null", ")", "),", "this", "}", "return", "this", ".", "_isUTC", "?", "r", ":", "Oe", "(", "this", ")", "},", "Sn", ".", "utc", "=", "function", "(", "e", ")", "{", "return", "this", ".", "utcOffset", "(", "0", ",", "e", ")", "},", "Sn", ".", "local", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_isUTC", "&", "&(", "this", ".", "utcOffset", "(", "0", ",", "e", ")", ",", "this", ".", "_isUTC", "=", "!", "1", ",", "e", "&", "&", "this", ".", "subtract", "(", "Oe", "(", "this", ")", ",\"", "m", "\"", "))", ",", "this", "}", ",", "Sn", ".", "parseZone", "=", "function", "(", "){", "if", "(", "null", "!", "=", "this", ".", "_tzm", ")", "this", ".", "utcOffset", "(", "this", ".", "_tzm", ",", "!", "1", ",", "!", "0", ")", ";", "else", "if", "(", "\"", "string", "\"", "==", "typeof", "this", ".", "_i", ")", "{", "var", "e", "=", "De", "(", "kt", ",", "this", ".", "_i", ")", ";", "null", "!", "=", "e", "?", "this", ".", "utcOffset", "(", "e", ")", ":", "this", ".", "utcOffset", "(", "0", ",", "!", "0", ")", "}", "return", "this", "}", ",", "Sn", ".", "hasAlignedHourOffset", "=", "function", "(", "e", ")", "{", "return", "!", "!", "this", ".", "isValid", "(", ")&", "&(", "e", "=", "e", "?", "pe", "(", "e", ")", ".", "utcOffset", "(", "):", "0", ",", "(", "this", ".", "utcOffset", "(", ")-", "e", ")", "%", "60", "=", "=", "0", ")", "},", "Sn", ".", "isDST", "=", "function", "(", "){", "return", "this", ".", "utcOffset", "(", ")>", "this", ".", "clone", "(", ").", "month", "(", "0", ")", ".", "utcOffset", "(", ")|", "|", "this", ".", "utcOffset", "(", ")>", "this", ".", "clone", "(", ").", "month", "(", "5", ")", ".", "utcOffset", "(", ")}", ",", "Sn", ".", "isLocal", "=", "function", "(", "){", "return", "!", "!", "this", ".", "isValid", "(", ")&", "&!", "this", ".", "_isUTC", "}", ",", "Sn", ".", "isUtcOffset", "=", "function", "(", "){", "return", "!", "!", "this", ".", "isValid", "(", ")&", "&", "this", ".", "_isUTC", "}", ",", "Sn", ".", "isUtc", "=", "xe", ",", "Sn", ".", "isUTC", "=", "xe", ",", "Sn", ".", "zoneAbbr", "=", "function", "(", "){", "return", "this", ".", "_isUTC", "?", "\"", "UTC", "\"", ":\"", "\"}", ",", "Sn", ".", "zoneName", "=", "function", "(", "){", "return", "this", ".", "_isUTC", "?", "\"", "Coordinated", "Universal", "Time", "\"", ":\"", "\"}", ",", "Sn", ".", "dates", "=", "v", "(", "\"", "dates", "accessor", "is", "deprecated", ".", "Use", "date", "instead", ".", "\",", "pn", ")", ",", "Sn", ".", "months", "=", "v", "(", "\"", "months", "accessor", "is", "deprecated", ".", "Use", "month", "instead", "\"", ",$", "),", "Sn", ".", "years", "=", "v", "(", "\"", "years", "accessor", "is", "deprecated", ".", "Use", "year", "instead", "\"", ",", "Ht", ")", ",", "Sn", ".", "zone", "=", "v", "(", "\"", "moment", "(", ").", "zone", "is", "deprecated", ",", "use", "moment", "(", ").", "utcOffset", "instead", ".", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "zone", "/", "\",", "function", "(", "e", ",", "t", ")", "{", "return", "null", "!", "=", "e", "?", "(\"", "string", "\"", "!=", "typeof", "e", "&", "&(", "e", "=", "-", "e", ")", ",", "this", ".", "utcOffset", "(", "e", ",", "t", ")", ",", "this", ")", ":-", "this", ".", "utcOffset", "(", ")}", "),", "Sn", ".", "isDSTShifted", "=", "v", "(", "\"", "isDSTShifted", "is", "deprecated", ".", "See", "http", ":", "//", "momentjs", ".", "com", "/", "guides", "/", "#/", "warnings", "/", "dst", "-", "shifted", "/", "for", "more", "information", "\"", ",", "function", "(", "){", "if", "(", "!", "s", "(", "this", ".", "_isDSTShifted", ")", ")", "return", "this", ".", "_isDSTShifted", ";", "var", "e", "=", "{}", ";", "if", "(", "f", "(", "e", ",", "this", ")", ",(", "e", "=", "ye", "(", "e", ")", ").", "_a", ")", "{", "var", "t", "=", "e", ".", "_isUTC", "?", "l", "(", "e", ".", "_a", ")", ":", "pe", "(", "e", ".", "_a", ")", ";", "this", ".", "_isDSTShifted", "=", "this", ".", "isValid", "(", ")&", "&", "p", "(", "e", ".", "_a", ",", "t", ".", "toArray", "(", "))", ">", "0", "}", "else", "this", ".", "_isDSTShifted", "=", "!", "1", ";", "return", "this", ".", "_isDSTShifted", "}", ");", "var", "Dn", "=", "D", ".", "prototype", ";", "Dn", ".", "calendar", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "this", ".", "_calendar", "[", "e", "]", "||", "this", ".", "_calendar", ".", "sameElse", ";", "return", "k", "(", "s", ")", "?", "s", ".", "call", "(", "t", ",", "n", ")", ":", "s", "}", ",", "Dn", ".", "longDateFormat", "=", "function", "(", "e", ")", "{", "var", "t", "=", "this", ".", "_longDateFormat", "[", "e", "]", ",", "n", "=", "this", ".", "_longDateFormat", "[", "e", ".", "toUpperCase", "(", ")]", ";", "return", "t", "|", "|!", "n", "?", "t", ":", "(", "this", ".", "_longDateFormat", "[", "e", "]", "=", "n", ".", "replace", "(", "/", "MMMM", "|", "MM", "|", "DD", "|", "dddd", "/", "g", ",", "function", "(", "e", ")", "{", "return", "e", ".", "slice", "(", "1", ")", "})", ",", "this", ".", "_longDateFormat", "[", "e", "]", ")}", ",", "Dn", ".", "invalidDate", "=", "function", "(", "){", "return", "this", ".", "_invalidDate", "}", ",", "Dn", ".", "ordinal", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_ordinal", ".", "replace", "(", "\"%", "d", "\"", ",", "e", ")", "},", "Dn", ".", "preparse", "=", "Ge", ",", "Dn", ".", "postformat", "=", "Ge", ",", "Dn", ".", "relativeTime", "=", "function", "(", "e", ",", "t", ",", "n", ",", "s", ")", "{", "var", "i", "=", "this", ".", "_relativeTime", "[", "n", "]", ";", "return", "k", "(", "i", ")", "?", "i", "(", "e", ",", "t", ",", "n", ",", "s", ")", ":", "i", ".", "replace", "(", "/%", "d", "/", "i", ",", "e", ")", "},", "Dn", ".", "pastFuture", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", "=", "this", ".", "_relativeTime", "[", "e", ">", "0", "?", "\"", "future", "\"", ":\"", "past", "\"", "];", "return", "k", "(", "n", ")", "?", "n", "(", "t", ")", ":", "n", ".", "replace", "(", "/%", "s", "/", "i", ",", "t", ")", "},", "Dn", ".", "set", "=", "function", "(", "e", ")", "{", "var", "t", ",", "n", ";", "for", "(", "n", "in", "e", ")", "k", "(", "t", "=", "e", "[", "n", "]", ")?", "this", "[", "n", "]", "=", "t", ":", "this", "[", "\"", "_", "\"", "+", "n", "]", "=", "t", ";", "this", ".", "_config", "=", "e", ",", "this", ".", "_dayOfMonthOrdinalParseLenient", "=", "new", "RegExp", "(", "(", "this", ".", "_dayOfMonthOrdinalParse", ".", "source", "|", "|", "this", ".", "_ordinalParse", ".", "source", ")", "+\"", "|\"", "+/", "\\", "d", "{", "1", ",", "2", "}", "/.", "source", ")", "},", "Dn", ".", "months", "=", "function", "(", "e", ",", "n", ")", "{", "return", "e", "?", "t", "(", "this", ".", "_months", ")", "?", "this", ".", "_months", "[", "e", ".", "month", "(", ")]", ":", "this", ".", "_months", "[", "(", "this", ".", "_months", ".", "isFormat", "|", "|", "Lt", ")", ".", "test", "(", "n", ")", "?\"", "format", "\"", ":\"", "standalone", "\"", "][", "e", ".", "month", "(", ")]", ":", "t", "(", "this", ".", "_months", ")", "?", "this", ".", "_months", ":", "this", ".", "_months", ".", "standalone", "}", ",", "Dn", ".", "monthsShort", "=", "function", "(", "e", ",", "n", ")", "{", "return", "e", "?", "t", "(", "this", ".", "_monthsShort", ")", "?", "this", ".", "_monthsShort", "[", "e", ".", "month", "(", ")]", ":", "this", ".", "_monthsShort", "[", "Lt", ".", "test", "(", "n", ")", "?\"", "format", "\"", ":\"", "standalone", "\"", "][", "e", ".", "month", "(", ")]", ":", "t", "(", "this", ".", "_monthsShort", ")", "?", "this", ".", "_monthsShort", ":", "this", ".", "_monthsShort", ".", "standalone", "}", ",", "Dn", ".", "monthsParse", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ";", "if", "(", "this", ".", "_monthsParseExact", ")", "return", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ",", "a", "=", "e", ".", "toLocaleLowerCase", "(", ");", "if", "(", "!", "this", ".", "_monthsParse", ")", "for", "(", "this", ".", "_monthsParse", "=", "[]", ",", "this", ".", "_longMonthsParse", "=", "[]", ",", "this", ".", "_shortMonthsParse", "=", "[]", ",", "s", "=", "0", ";", "s", "<", "12", ";", "++", "s", ")", "r", "=", "l", "(", "[", "2e3", ",", "s", "]", "),", "this", ".", "_shortMonthsParse", "[", "s", "]", "=", "this", ".", "monthsShort", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", "),", "this", ".", "_longMonthsParse", "[", "s", "]", "=", "this", ".", "months", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", ");", "return", "n", "?", "\"", "MMM", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortMonthsParse", ",", "a", ")", ")?", "i", ":", "null", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_longMonthsParse", ",", "a", ")", ")?", "i", ":", "null", ":", "\"", "MMM", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortMonthsParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_longMonthsParse", ",", "a", ")", ")?", "i", ":", "null", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_longMonthsParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortMonthsParse", ",", "a", ")", ")?", "i", ":", "null", "}", ".", "call", "(", "this", ",", "e", ",", "t", ",", "n", ")", ";", "for", "(", "this", ".", "_monthsParse", "|", "|(", "this", ".", "_monthsParse", "=", "[]", ",", "this", ".", "_longMonthsParse", "=", "[]", ",", "this", ".", "_shortMonthsParse", "=", "[]", "),", "s", "=", "0", ";", "s", "<", "12", ";", "s", "+", "+)", "{", "if", "(", "i", "=", "l", "(", "[", "2e3", ",", "s", "]", "),", "n", "&", "&!", "this", ".", "_longMonthsParse", "[", "s", "]", "&&", "(", "this", ".", "_longMonthsParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "months", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\"\"", ")+", "\"$", "\",", "\"", "i", "\"", "),", "this", ".", "_shortMonthsParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "monthsShort", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\"\"", ")+", "\"$", "\",", "\"", "i", "\"", "))", ",", "n", "|", "|", "this", ".", "_monthsParse", "[", "s", "]", "||", "(", "r", "=", "\"^", "\"+", "this", ".", "months", "(", "i", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "monthsShort", "(", "i", ",", "\"\"", "),", "this", ".", "_monthsParse", "[", "s", "]", "=", "new", "RegExp", "(", "r", ".", "replace", "(", "\".", "\",", "\"\"", "),", "\"", "i", "\"", "))", ",", "n", "&", "&\"", "MMMM", "\"", "==", "=", "t", "&", "&", "this", ".", "_longMonthsParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "n", "&", "&\"", "MMM", "\"", "==", "=", "t", "&", "&", "this", ".", "_shortMonthsParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "!", "n", "&", "&", "this", ".", "_monthsParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", "}", "},", "Dn", ".", "monthsRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_monthsParseExact", "?", "(", "o", "(", "this", ",", "\"", "_monthsRegex", "\"", ")|", "|", "q", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_monthsStrictRegex", ":", "this", ".", "_monthsRegex", ")", ":(", "o", "(", "this", ",", "\"", "_monthsRegex", "\"", ")|", "|(", "this", ".", "_monthsRegex", "=", "It", ")", ",", "this", ".", "_monthsStrictRegex", "&", "&", "e", "?", "this", ".", "_monthsStrictRegex", ":", "this", ".", "_monthsRegex", ")", "},", "Dn", ".", "monthsShortRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_monthsParseExact", "?", "(", "o", "(", "this", ",", "\"", "_monthsRegex", "\"", ")|", "|", "q", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_monthsShortStrictRegex", ":", "this", ".", "_monthsShortRegex", ")", ":(", "o", "(", "this", ",", "\"", "_monthsShortRegex", "\"", ")|", "|(", "this", ".", "_monthsShortRegex", "=", "jt", ")", ",", "this", ".", "_monthsShortStrictRegex", "&", "&", "e", "?", "this", ".", "_monthsShortStrictRegex", ":", "this", ".", "_monthsShortRegex", ")", "},", "Dn", ".", "week", "=", "function", "(", "e", ")", "{", "return", "X", "(", "e", ",", "this", ".", "_week", ".", "dow", ",", "this", ".", "_week", ".", "doy", ")", ".", "week", "}", ",", "Dn", ".", "firstDayOfYear", "=", "function", "(", "){", "return", "this", ".", "_week", ".", "doy", "}", ",", "Dn", ".", "firstDayOfWeek", "=", "function", "(", "){", "return", "this", ".", "_week", ".", "dow", "}", ",", "Dn", ".", "weekdays", "=", "function", "(", "e", ",", "n", ")", "{", "return", "e", "?", "t", "(", "this", ".", "_weekdays", ")", "?", "this", ".", "_weekdays", "[", "e", ".", "day", "(", ")]", ":", "this", ".", "_weekdays", "[", "this", ".", "_weekdays", ".", "isFormat", ".", "test", "(", "n", ")", "?\"", "format", "\"", ":\"", "standalone", "\"", "][", "e", ".", "day", "(", ")]", ":", "t", "(", "this", ".", "_weekdays", ")", "?", "this", ".", "_weekdays", ":", "this", ".", "_weekdays", ".", "standalone", "}", ",", "Dn", ".", "weekdaysMin", "=", "function", "(", "e", ")", "{", "return", "e", "?", "this", ".", "_weekdaysMin", "[", "e", ".", "day", "(", ")]", ":", "this", ".", "_weekdaysMin", "}", ",", "Dn", ".", "weekdaysShort", "=", "function", "(", "e", ")", "{", "return", "e", "?", "this", ".", "_weekdaysShort", "[", "e", ".", "day", "(", ")]", ":", "this", ".", "_weekdaysShort", "}", ",", "Dn", ".", "weekdaysParse", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ";", "if", "(", "this", ".", "_weekdaysParseExact", ")", "return", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", ",", "i", ",", "r", ",", "a", "=", "e", ".", "toLocaleLowerCase", "(", ");", "if", "(", "!", "this", ".", "_weekdaysParse", ")", "for", "(", "this", ".", "_weekdaysParse", "=", "[]", ",", "this", ".", "_shortWeekdaysParse", "=", "[]", ",", "this", ".", "_minWeekdaysParse", "=", "[]", ",", "s", "=", "0", ";", "s", "<", "7", ";", "++", "s", ")", "r", "=", "l", "(", "[", "2e3", ",", "1", "]", ").", "day", "(", "s", ")", ",", "this", ".", "_minWeekdaysParse", "[", "s", "]", "=", "this", ".", "weekdaysMin", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", "),", "this", ".", "_shortWeekdaysParse", "[", "s", "]", "=", "this", ".", "weekdaysShort", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", "),", "this", ".", "_weekdaysParse", "[", "s", "]", "=", "this", ".", "weekdays", "(", "r", ",", "\"\"", ").", "toLocaleLowerCase", "(", ");", "return", "n", "?", "\"", "dddd", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_weekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "\"", "ddd", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_minWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "\"", "dddd", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_weekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortWeekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_minWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "\"", "ddd", "\"", "==", "=", "t", "?", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortWeekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_weekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_minWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_minWeekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_weekdaysParse", ",", "a", ")", ")?", "i", ":", "-", "1", "!", "==", "(", "i", "=", "Nt", ".", "call", "(", "this", ".", "_shortWeekdaysParse", ",", "a", ")", ")?", "i", ":", "null", "}", ".", "call", "(", "this", ",", "e", ",", "t", ",", "n", ")", ";", "for", "(", "this", ".", "_weekdaysParse", "|", "|(", "this", ".", "_weekdaysParse", "=", "[]", ",", "this", ".", "_minWeekdaysParse", "=", "[]", ",", "this", ".", "_shortWeekdaysParse", "=", "[]", ",", "this", ".", "_fullWeekdaysParse", "=", "[]", "),", "s", "=", "0", ";", "s", "<", "7", ";", "s", "+", "+)", "{", "if", "(", "i", "=", "l", "(", "[", "2e3", ",", "1", "]", ").", "day", "(", "s", ")", ",", "n", "&", "&!", "this", ".", "_fullWeekdaysParse", "[", "s", "]", "&&", "(", "this", ".", "_fullWeekdaysParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "weekdays", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\".", "?\"", ")+", "\"$", "\",", "\"", "i", "\"", "),", "this", ".", "_shortWeekdaysParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "weekdaysShort", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\".", "?\"", ")+", "\"$", "\",", "\"", "i", "\"", "),", "this", ".", "_minWeekdaysParse", "[", "s", "]", "=", "new", "RegExp", "(", "\"^", "\"+", "this", ".", "weekdaysMin", "(", "i", ",", "\"\"", ").", "replace", "(", "\".", "\",", "\".", "?\"", ")+", "\"$", "\",", "\"", "i", "\"", "))", ",", "this", ".", "_weekdaysParse", "[", "s", "]", "||", "(", "r", "=", "\"^", "\"+", "this", ".", "weekdays", "(", "i", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "weekdaysShort", "(", "i", ",", "\"\"", ")+", "\"|", "^\"", "+", "this", ".", "weekdaysMin", "(", "i", ",", "\"\"", "),", "this", ".", "_weekdaysParse", "[", "s", "]", "=", "new", "RegExp", "(", "r", ".", "replace", "(", "\".", "\",", "\"\"", "),", "\"", "i", "\"", "))", ",", "n", "&", "&\"", "dddd", "\"", "==", "=", "t", "&", "&", "this", ".", "_fullWeekdaysParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "n", "&", "&\"", "ddd", "\"", "==", "=", "t", "&", "&", "this", ".", "_shortWeekdaysParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "n", "&", "&\"", "dd", "\"", "==", "=", "t", "&", "&", "this", ".", "_minWeekdaysParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", ";", "if", "(", "!", "n", "&", "&", "this", ".", "_weekdaysParse", "[", "s", "]", ".", "test", "(", "e", ")", ")", "return", "s", "}", "},", "Dn", ".", "weekdaysRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_weekdaysParseExact", "?", "(", "o", "(", "this", ",", "\"", "_weekdaysRegex", "\"", ")|", "|", "ee", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_weekdaysStrictRegex", ":", "this", ".", "_weekdaysRegex", ")", ":(", "o", "(", "this", ",", "\"", "_weekdaysRegex", "\"", ")|", "|(", "this", ".", "_weekdaysRegex", "=", "Zt", ")", ",", "this", ".", "_weekdaysStrictRegex", "&", "&", "e", "?", "this", ".", "_weekdaysStrictRegex", ":", "this", ".", "_weekdaysRegex", ")", "},", "Dn", ".", "weekdaysShortRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_weekdaysParseExact", "?", "(", "o", "(", "this", ",", "\"", "_weekdaysRegex", "\"", ")|", "|", "ee", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_weekdaysShortStrictRegex", ":", "this", ".", "_weekdaysShortRegex", ")", ":(", "o", "(", "this", ",", "\"", "_weekdaysShortRegex", "\"", ")|", "|(", "this", ".", "_weekdaysShortRegex", "=", "$", "t", ")", ",", "this", ".", "_weekdaysShortStrictRegex", "&", "&", "e", "?", "this", ".", "_weekdaysShortStrictRegex", ":", "this", ".", "_weekdaysShortRegex", ")", "},", "Dn", ".", "weekdaysMinRegex", "=", "function", "(", "e", ")", "{", "return", "this", ".", "_weekdaysParseExact", "?", "(", "o", "(", "this", ",", "\"", "_weekdaysRegex", "\"", ")|", "|", "ee", ".", "call", "(", "this", ")", ",", "e", "?", "this", ".", "_weekdaysMinStrictRegex", ":", "this", ".", "_weekdaysMinRegex", ")", ":(", "o", "(", "this", ",", "\"", "_weekdaysMinRegex", "\"", ")|", "|(", "this", ".", "_weekdaysMinRegex", "=", "qt", ")", ",", "this", ".", "_weekdaysMinStrictRegex", "&", "&", "e", "?", "this", ".", "_weekdaysMinStrictRegex", ":", "this", ".", "_weekdaysMinRegex", ")", "},", "Dn", ".", "isPM", "=", "function", "(", "e", ")", "{", "return", "\"", "p", "\"", "==", "=(", "e", "+", "\"\"", ").", "toLowerCase", "(", ").", "charAt", "(", "0", ")", "},", "Dn", ".", "meridiem", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "return", "e", ">", "11", "?", "n", "?", "\"", "pm", "\"", ":\"", "PM", "\"", ":", "n", "?", "\"", "am", "\"", ":\"", "AM", "\"", "},", "ae", "(", "\"", "en", "\"", ",{", "dayOfMonthOrdinalParse", ":", "/\\", "d", "{", "1", ",", "2", "}", "(", "th", "|", "st", "|", "nd", "|", "rd", ")", "/,", "ordinal", ":", "function", "(", "e", ")", "{", "var", "t", "=", "e", "%", "10", ";", "return", "e", "+", "(", "1", "=", "==", "g", "(", "e", "%", "100", "/", "10", ")", "?\"", "th", "\"", ":", "1", "=", "==", "t", "?", "\"", "st", "\"", ":", "2", "=", "==", "t", "?", "\"", "nd", "\"", ":", "3", "=", "==", "t", "?", "\"", "rd", "\"", ":\"", "th", "\"", ")}", "})", ",", "e", ".", "lang", "=", "v", "(", "\"", "moment", ".", "lang", "is", "deprecated", ".", "Use", "moment", ".", "locale", "instead", ".", "\",", "ae", ")", ",", "e", ".", "langData", "=", "v", "(", "\"", "moment", ".", "langData", "is", "deprecated", ".", "Use", "moment", ".", "localeData", "instead", ".", "\",", "ue", ")", ";", "var", "Yn", "=", "Math", ".", "abs", ",", "On", "=", "$", "e", "(", "\"", "ms", "\"", "),", "xn", "=", "$", "e", "(", "\"", "s", "\"", "),", "Tn", "=", "$", "e", "(", "\"", "m", "\"", "),", "bn", "=", "$", "e", "(", "\"", "h", "\"", "),", "Pn", "=", "$", "e", "(", "\"", "d", "\"", "),", "Wn", "=", "$", "e", "(", "\"", "w", "\"", "),", "Rn", "=", "$", "e", "(", "\"", "M", "\"", "),", "Cn", "=", "$", "e", "(", "\"", "y", "\"", "),", "Fn", "=", "qe", "(", "\"", "milliseconds", "\"", "),", "Un", "=", "qe", "(", "\"", "seconds", "\"", "),", "Nn", "=", "qe", "(", "\"", "minutes", "\"", "),", "Hn", "=", "qe", "(", "\"", "hours", "\"", "),", "Ln", "=", "qe", "(", "\"", "days", "\"", "),", "Gn", "=", "qe", "(", "\"", "months", "\"", "),", "Vn", "=", "qe", "(", "\"", "years", "\"", "),", "jn", "=", "Math", ".", "round", ",", "In", "=", "{", "ss", ":", "44", ",", "s", ":", "45", ",", "m", ":", "45", ",", "h", ":", "22", ",", "d", ":", "26", ",", "M", ":", "11", "}", ",", "En", "=", "Math", ".", "abs", ",", "An", "=", "ve", ".", "prototype", ";", "return", "An", ".", "isValid", "=", "function", "(", "){", "return", "this", ".", "_isValid", "}", ",", "An", ".", "abs", "=", "function", "(", "){", "var", "e", "=", "this", ".", "_data", ";", "return", "this", ".", "_milliseconds", "=", "Yn", "(", "this", ".", "_milliseconds", ")", ",", "this", ".", "_days", "=", "Yn", "(", "this", ".", "_days", ")", ",", "this", ".", "_months", "=", "Yn", "(", "this", ".", "_months", ")", ",", "e", ".", "milliseconds", "=", "Yn", "(", "e", ".", "milliseconds", ")", ",", "e", ".", "seconds", "=", "Yn", "(", "e", ".", "seconds", ")", ",", "e", ".", "minutes", "=", "Yn", "(", "e", ".", "minutes", ")", ",", "e", ".", "hours", "=", "Yn", "(", "e", ".", "hours", ")", ",", "e", ".", "months", "=", "Yn", "(", "e", ".", "months", ")", ",", "e", ".", "years", "=", "Yn", "(", "e", ".", "years", ")", ",", "this", "}", ",", "An", ".", "add", "=", "function", "(", "e", ",", "t", ")", "{", "return", "Ee", "(", "this", ",", "e", ",", "t", ",", "1", ")", "},", "An", ".", "subtract", "=", "function", "(", "e", ",", "t", ")", "{", "return", "Ee", "(", "this", ",", "e", ",", "t", ",", "-", "1", ")", "},", "An", ".", "as", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "NaN", ";", "var", "t", ",", "n", ",", "s", "=", "this", ".", "_milliseconds", ";", "if", "(", "\"", "month", "\"", "==", "=(", "e", "=", "O", "(", "e", ")", ")|", "|\"", "year", "\"", "==", "=", "e", ")", "return", "t", "=", "this", ".", "_days", "+", "s", "/", "864e5", ",", "n", "=", "this", ".", "_months", "+", "ze", "(", "t", ")", ",\"", "month", "\"", "==", "=", "e", "?", "n", ":", "n", "/", "12", ";", "switch", "(", "t", "=", "this", ".", "_days", "+", "Math", ".", "round", "(", "Ze", "(", "this", ".", "_months", ")", "),", "e", ")", "{", "case", "\"", "week", "\"", ":", "return", "t", "/", "7", "+", "s", "/", "6048e5", ";", "case", "\"", "day", "\"", ":", "return", "t", "+", "s", "/", "864e5", ";", "case", "\"", "hour", "\"", ":", "return", "24", "*", "t", "+", "s", "/", "36e5", ";", "case", "\"", "minute", "\"", ":", "return", "1440", "*", "t", "+", "s", "/", "6e4", ";", "case", "\"", "second", "\"", ":", "return", "86400", "*", "t", "+", "s", "/", "1e3", ";", "case", "\"", "millisecond", "\"", ":", "return", "Math", ".", "floor", "(", "864e5", "*", "t", ")", "+", "s", ";", "default", ":", "throw", "new", "Error", "(", "\"", "Unknown", "unit", "\"", "+", "e", ")", "}}", ",", "An", ".", "asMilliseconds", "=", "On", ",", "An", ".", "asSeconds", "=", "xn", ",", "An", ".", "asMinutes", "=", "Tn", ",", "An", ".", "asHours", "=", "bn", ",", "An", ".", "asDays", "=", "Pn", ",", "An", ".", "asWeeks", "=", "Wn", ",", "An", ".", "asMonths", "=", "Rn", ",", "An", ".", "asYears", "=", "Cn", ",", "An", ".", "valueOf", "=", "function", "(", "){", "return", "this", ".", "isValid", "(", ")?", "this", ".", "_milliseconds", "+", "864e5", "*", "this", ".", "_days", "+", "this", ".", "_months", "%", "12", "*", "2592e6", "+", "31536e6", "*", "g", "(", "this", ".", "_months", "/", "12", ")", ":", "NaN", "}", ",", "An", ".", "_bubble", "=", "function", "(", "){", "var", "e", ",", "t", ",", "n", ",", "s", ",", "i", ",", "r", "=", "this", ".", "_milliseconds", ",", "a", "=", "this", ".", "_days", ",", "o", "=", "this", ".", "_months", ",", "u", "=", "this", ".", "_data", ";", "return", "r", ">", "=", "0", "&", "&", "a", ">", "=", "0", "&", "&", "o", ">", "=", "0", "|", "|", "r", "<", "=", "0", "&", "&", "a", "<", "=", "0", "&", "&", "o", "<", "=", "0", "|", "|(", "r", "+", "=", "864e5", "*", "Ae", "(", "Ze", "(", "o", ")", "+", "a", ")", ",", "a", "=", "0", ",", "o", "=", "0", ")", ",", "u", ".", "milliseconds", "=", "r", "%", "1e3", ",", "e", "=", "y", "(", "r", "/", "1e3", ")", ",", "u", ".", "seconds", "=", "e", "%", "60", ",", "t", "=", "y", "(", "e", "/", "60", ")", ",", "u", ".", "minutes", "=", "t", "%", "60", ",", "n", "=", "y", "(", "t", "/", "60", ")", ",", "u", ".", "hours", "=", "n", "%", "24", ",", "a", "+", "=", "y", "(", "n", "/", "24", ")", ",", "i", "=", "y", "(", "ze", "(", "a", ")", "),", "o", "+", "=", "i", ",", "a", "-", "=", "Ae", "(", "Ze", "(", "i", ")", "),", "s", "=", "y", "(", "o", "/", "12", ")", ",", "o", "%", "=", "12", ",", "u", ".", "days", "=", "a", ",", "u", ".", "months", "=", "o", ",", "u", ".", "years", "=", "s", ",", "this", "}", ",", "An", ".", "clone", "=", "function", "(", "){", "return", "Te", "(", "this", ")", "},", "An", ".", "get", "=", "function", "(", "e", ")", "{", "return", "e", "=", "O", "(", "e", ")", ",", "this", ".", "isValid", "(", ")?", "this", "[", "e", "+", "\"", "s", "\"", "](", "):", "NaN", "}", ",", "An", ".", "milliseconds", "=", "Fn", ",", "An", ".", "seconds", "=", "Un", ",", "An", ".", "minutes", "=", "Nn", ",", "An", ".", "hours", "=", "Hn", ",", "An", ".", "days", "=", "Ln", ",", "An", ".", "weeks", "=", "function", "(", "){", "return", "y", "(", "this", ".", "days", "(", ")/", "7", ")", "},", "An", ".", "months", "=", "Gn", ",", "An", ".", "years", "=", "Vn", ",", "An", ".", "humanize", "=", "function", "(", "e", ")", "{", "if", "(", "!", "this", ".", "isValid", "(", "))", "return", "this", ".", "localeData", "(", ").", "invalidDate", "(", ");", "var", "t", "=", "this", ".", "localeData", "(", "),", "n", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "var", "s", "=", "Te", "(", "e", ")", ".", "abs", "(", "),", "i", "=", "jn", "(", "s", ".", "as", "(", "\"", "s", "\"", "))", ",", "r", "=", "jn", "(", "s", ".", "as", "(", "\"", "m", "\"", "))", ",", "a", "=", "jn", "(", "s", ".", "as", "(", "\"", "h", "\"", "))", ",", "o", "=", "jn", "(", "s", ".", "as", "(", "\"", "d", "\"", "))", ",", "u", "=", "jn", "(", "s", ".", "as", "(", "\"", "M", "\"", "))", ",", "l", "=", "jn", "(", "s", ".", "as", "(", "\"", "y", "\"", "))", ",", "d", "=", "i", "<", "=", "In", ".", "ss", "&", "&[", "\"", "s", "\"", ",", "i", "]", "||", "i", "<", "In", ".", "s", "&", "&[", "\"", "ss", "\"", ",", "i", "]", "||", "r", "<", "=", "1", "&", "&[", "\"", "m", "\"", "]|", "|", "r", "<", "In", ".", "m", "&", "&[", "\"", "mm", "\"", ",", "r", "]", "||", "a", "<", "=", "1", "&", "&[", "\"", "h", "\"", "]|", "|", "a", "<", "In", ".", "h", "&", "&[", "\"", "hh", "\"", ",", "a", "]", "||", "o", "<", "=", "1", "&", "&[", "\"", "d", "\"", "]|", "|", "o", "<", "In", ".", "d", "&", "&[", "\"", "dd", "\"", ",", "o", "]", "||", "u", "<", "=", "1", "&", "&[", "\"", "M", "\"", "]|", "|", "u", "<", "In", ".", "M", "&", "&[", "\"", "MM", "\"", ",", "u", "]", "||", "l", "<", "=", "1", "&", "&[", "\"", "y", "\"", "]|", "|[", "\"", "yy", "\"", ",", "l", "]", ";", "return", "d", "[", "2", "]", "=", "t", ",", "d", "[", "3", "]", "=+", "e", ">", "0", ",", "d", "[", "4", "]", "=", "n", ",", "function", "(", "e", ",", "t", ",", "n", ",", "s", ",", "i", ")", "{", "return", "i", ".", "relativeTime", "(", "t", "|", "|", "1", ",", "!!", "n", ",", "e", ",", "s", ")", "}.", "apply", "(", "null", ",", "d", ")", "}(", "this", ",", "!", "e", ",", "t", ")", ";", "return", "e", "&", "&(", "n", "=", "t", ".", "pastFuture", "(", "+", "this", ",", "n", ")", "),", "t", ".", "postformat", "(", "n", ")", "},", "An", ".", "toISOString", "=", "Be", ",", "An", ".", "toString", "=", "Be", ",", "An", ".", "toJSON", "=", "Be", ",", "An", ".", "locale", "=", "Fe", ",", "An", ".", "localeData", "=", "Ue", ",", "An", ".", "toIsoString", "=", "v", "(", "\"", "toIsoString", "(", ")", "is", "deprecated", ".", "Please", "use", "toISOString", "(", ")", "instead", "(", "notice", "the", "capitals", ")", "\",", "Be", ")", ",", "An", ".", "lang", "=", "gn", ",", "P", "(", "\"", "X", "\"", ",", "0", ",", "0", ",", "\"", "unix", "\"", "),", "P", "(", "\"", "x", "\"", ",", "0", ",", "0", ",", "\"", "valueOf", "\"", "),", "F", "(", "\"", "x", "\"", ",", "Mt", ")", ",", "F", "(", "\"", "X", "\"", ",/", "[+", "-]", "?\\", "d", "+", "(\\", ".\\", "d", "{", "1", ",", "3", "}", ")?", "/)", ",", "H", "(", "\"", "X", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_d", "=", "new", "Date", "(", "1e3", "*", "parseFloat", "(", "e", ",", "10", ")", ")}", "),", "H", "(", "\"", "x", "\"", ",", "function", "(", "e", ",", "t", ",", "n", ")", "{", "n", ".", "_d", "=", "new", "Date", "(", "g", "(", "e", ")", ")}", "),", "e", ".", "version", "=", "\"", "2", ".", "19", ".", "3", "\"", ",", "function", "(", "e", ")", "{", "Qe", "=", "e", "}", "(", "pe", ")", ",", "e", ".", "fn", "=", "Sn", ",", "e", ".", "min", "=", "function", "(", "){", "return", "we", "(", "\"", "isBefore", "\"", ",[", "].", "slice", ".", "call", "(", "arguments", ",", "0", ")", ")}", ",", "e", ".", "max", "=", "function", "(", "){", "return", "we", "(", "\"", "isAfter", "\"", ",[", "].", "slice", ".", "call", "(", "arguments", ",", "0", ")", ")}", ",", "e", ".", "now", "=", "function", "(", "){", "return", "Date", ".", "now", "?", "Date", ".", "now", "(", "):", "+", "new", "Date", "}", ",", "e", ".", "utc", "=", "l", ",", "e", ".", "unix", "=", "function", "(", "e", ")", "{", "return", "pe", "(", "1e3", "*", "e", ")", "},", "e", ".", "months", "=", "function", "(", "e", ",", "t", ")", "{", "return", "je", "(", "e", ",", "t", ",", "\"", "months", "\"", ")}", ",", "e", ".", "isDate", "=", "r", ",", "e", ".", "locale", "=", "ae", ",", "e", ".", "invalid", "=", "c", ",", "e", ".", "duration", "=", "Te", ",", "e", ".", "isMoment", "=", "_", ",", "e", ".", "weekdays", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "return", "Ie", "(", "e", ",", "t", ",", "n", ",", "\"", "weekdays", "\"", ")}", ",", "e", ".", "parseZone", "=", "function", "(", "){", "return", "pe", ".", "apply", "(", "null", ",", "arguments", ")", ".", "parseZone", "(", ")}", ",", "e", ".", "localeData", "=", "ue", ",", "e", ".", "isDuration", "=", "Me", ",", "e", ".", "monthsShort", "=", "function", "(", "e", ",", "t", ")", "{", "return", "je", "(", "e", ",", "t", ",", "\"", "monthsShort", "\"", ")}", ",", "e", ".", "weekdaysMin", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "return", "Ie", "(", "e", ",", "t", ",", "n", ",", "\"", "weekdaysMin", "\"", ")}", ",", "e", ".", "defineLocale", "=", "oe", ",", "e", ".", "updateLocale", "=", "function", "(", "e", ",", "t", ")", "{", "if", "(", "null", "!", "=", "t", ")", "{", "var", "n", ",", "s", ",", "i", "=", "Qt", ";", "null", "!", "=(", "s", "=", "re", "(", "e", ")", ")&", "&(", "i", "=", "s", ".", "_config", ")", ",(", "n", "=", "new", "D", "(", "t", "=", "S", "(", "i", ",", "t", ")", "))", ".", "parentLocale", "=", "Xt", "[", "e", "]", ",", "Xt", "[", "e", "]", "=", "n", ",", "ae", "(", "e", ")", "}", "else", "null", "!", "=", "Xt", "[", "e", "]", "&&", "(", "null", "!", "=", "Xt", "[", "e", "]", ".", "parentLocale", "?", "Xt", "[", "e", "]", "=", "Xt", "[", "e", "]", ".", "parentLocale", ":", "null", "!", "=", "Xt", "[", "e", "]", "&&", "delete", "Xt", "[", "e", "]", ");", "return", "Xt", "[", "e", "]", "},", "e", ".", "locales", "=", "function", "(", "){", "return", "nt", "(", "Xt", ")", "},", "e", ".", "weekdaysShort", "=", "function", "(", "e", ",", "t", ",", "n", ")", "{", "return", "Ie", "(", "e", ",", "t", ",", "n", ",", "\"", "weekdaysShort", "\"", ")}", ",", "e", ".", "normalizeUnits", "=", "O", ",", "e", ".", "relativeTimeRounding", "=", "function", "(", "e", ")", "{", "return", "void", "0", "=", "==", "e", "?", "jn", ":", "\"", "function", "\"", "==", "typeof", "e", "&", "&(", "jn", "=", "e", ",", "!", "0", ")", "},", "e", ".", "relativeTimeThreshold", "=", "function", "(", "e", ",", "t", ")", "{", "return", "void", "0", "!", "==", "In", "[", "e", "]", "&&", "(", "void", "0", "=", "==", "t", "?", "In", "[", "e", "]", ":(", "In", "[", "e", "]", "=", "t", ",", "\"", "s", "\"", "==", "=", "e", "&", "&(", "In", ".", "ss", "=", "t", "-", "1", ")", ",!", "0", ")", ")}", ",", "e", ".", "calendarFormat", "=", "function", "(", "e", ",", "t", ")", "{", "var", "n", "=", "e", ".", "diff", "(", "t", ",", "\"", "days", "\"", ",!", "0", ")", ";", "return", "n", "<", "-", "6", "?", "\"", "sameElse", "\"", ":", "n", "<", "-", "1", "?", "\"", "lastWeek", "\"", ":", "n", "<", "0", "?", "\"", "lastDay", "\"", ":", "n", "<", "1", "?", "\"", "sameDay", "\"", ":", "n", "<", "2", "?", "\"", "nextDay", "\"", ":", "n", "<", "7", "?", "\"", "nextWeek", "\"", ":\"", "sameElse", "\"", "},", "e", ".", "prototype", "=", "Sn", ",", "e", "}", ");", "@", "@", "-", "117", ",", "7", "+", "117", ",", "7", "@", "@", "public", "String", "getEditorMarkupId", "(", ")", "@", "Override", "protected", "void", "convertInput", "(", ")", "{", "final", "PolicyFactory", "policy", "=", "newPolicyFactory", "(", ");", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "input", "=", "this", ".", "textarea", ".", "getConvertedInput", "(", ");", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "input", ")", ");", "@", "@", "-", "191", ",", "7", "+", "191", ",", "7", "@", "@", "protected", "void", "onComponentTag", "(", "ComponentTag", "tag", ")", "*", "*", "@", "return", "a", "new", "{", "@", "code", "PolicyFactory", "}", "*", "/", "protected", "static", "PolicyFactory", "newPolicyFactory", "(", ")", "protected", "PolicyFactory", "newPolicyFactory", "(", ")", "{", "return", "new", "HtmlPolicyBuilder", "(", ")", "/", "/", "lf", ".", "allowCommonInlineFormattingElements", "(", ")", "/", "/", "lf", "@", "@", "-", "95", ",", "7", "+", "95", ",", "7", "@", "@", "public", "void", "convertInput", "(", ")", "{", "super", ".", "convertInput", "(", ");", "final", "PolicyFactory", "policy", "=", "newPolicyFactory", "(", ");", "final", "PolicyFactory", "policy", "=", "this", ".", "newPolicyFactory", "(", ");", "final", "String", "input", "=", "this", ".", "getConvertedInput", "(", ");", "this", ".", "setConvertedInput", "(", "policy", ".", "sanitize", "(", "input", ")", ");", "@", "@", "-", "139", ",", "7", "+", "139", ",", "7", "@", "@", "public", "JQueryBehavior", "newWidgetBehavior", "(", "String", "selector", ")", "*", "*", "@", "return", "a", "new", "{", "@", "code", "PolicyFactory", "}", "*", "/", "protected", "static", "PolicyFactory", "newPolicyFactory", "(", ")", "protected", "PolicyFactory", "newPolicyFactory", "(", ")", "{", "return", "new", "HtmlPolicyBuilder", "(", ")", "/", "/", "lf", ".", "allowCommonInlineFormattingElements", "(", ")", "/", "/", "lf"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "309", ",", "7", "+", "309", ",", "6", "@", "@", "$", "(\"", ".", "js", "-", "example", "-", "data", "-", "ajax", "\"", ").", "select2", "(", "{", "cache", ":", "true", "}", ",", "placeholder", ":", "'", "Search", "for", "a", "repository", "'", ",", "escapeMarkup", ":", "function", "(", "markup", ")", "{", "return", "markup", ";", "}", ",", "/", "/", "let", "our", "custom", "formatter", "work", "minimumInputLength", ":", "1", ",", "templateResult", ":", "formatRepo", ",", "templateSelection", ":", "formatRepoSelection", "@", "@", "-", "320", ",", "23", "+", "319", ",", "28", "@", "@", "function", "formatRepo", "(", "repo", ")", "{", "return", "repo", ".", "text", ";", "}", "var", "markup", "=", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository", "clearfix", "'", ">\"", "+", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__avatar", "'", "><", "img", "src", "=", "'\"", "+", "repo", ".", "owner", ".", "avatar_url", "+", "\"", "'", "/", "><", "/", "div", ">", "\"", "+", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__meta", "'", ">\"", "+", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__title", "'", ">\"", "+", "repo", ".", "full_name", "+", "\"", "</", "div", ">", "\";", "if", "(", "repo", ".", "description", ")", "{", "markup", "+", "=", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__description", "'", ">\"", "+", "repo", ".", "description", "+", "\"", "</", "div", ">", "\";", "}", "markup", "+", "=", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__statistics", "'", ">\"", "+", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__forks", "'", "><", "i", "class", "=", "'", "fa", "fa", "-", "flash", "'", "><", "/", "i", ">", "\"", "+", "repo", ".", "forks_count", "+", "\"", "Forks", "<", "/", "div", ">", "\"", "+", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__stargazers", "'", "><", "i", "class", "=", "'", "fa", "fa", "-", "star", "'", "><", "/", "i", ">", "\"", "+", "repo", ".", "stargazers_count", "+", "\"", "Stars", "<", "/", "div", ">", "\"", "+", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__watchers", "'", "><", "i", "class", "=", "'", "fa", "fa", "-", "eye", "'", "><", "/", "i", ">", "\"", "+", "repo", ".", "watchers_count", "+", "\"", "Watchers", "<", "/", "div", ">", "\"", "+", "\"", "</", "div", ">", "\"", "+", "\"", "</", "div", ">", "</", "div", ">", "\";", "return", "markup", ";", "var", "$", "container", "=", "$", "(", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository", "clearfix", "'", ">\"", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__avatar", "'", "><", "img", "src", "=", "'\"", "+", "repo", ".", "owner", ".", "avatar_url", "+", "\"", "'", "/", "><", "/", "div", ">", "\"", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__meta", "'", ">\"", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__title", "'", "><", "/", "div", ">", "\"", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__description", "'", "><", "/", "div", ">", "\"", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__statistics", "'", ">\"", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__forks", "'", "><", "i", "class", "=", "'", "fa", "fa", "-", "flash", "'", "><", "/", "i", ">", "<", "/", "div", ">", "\"", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__stargazers", "'", "><", "i", "class", "=", "'", "fa", "fa", "-", "star", "'", "><", "/", "i", ">", "<", "/", "div", ">", "\"", "\"", "<", "div", "class", "=", "'", "select2", "-", "result", "-", "repository__watchers", "'", "><", "i", "class", "=", "'", "fa", "fa", "-", "eye", "'", "><", "/", "i", ">", "<", "/", "div", ">", "\"", "\"", "</", "div", ">", "\"", "\"", "</", "div", ">", "\"", "\"", "</", "div", ">", "\"", ")", ";", "$", "container", ".", "find", "(", "\".", "select2", "-", "result", "-", "repository__title", "\"", ").", "text", "(", "repo", ".", "full_name", ")", ";", "$", "container", ".", "find", "(", "\".", "select2", "-", "result", "-", "repository__description", "\"", ").", "text", "(", "repo", ".", "description", ")", ";", "$", "container", ".", "find", "(", "\".", "select2", "-", "result", "-", "repository__forks", "\"", ").", "append", "(", "repo", ".", "forks_count", "+", "\"", "Forks", "\"", ");", "$", "container", ".", "find", "(", "\".", "select2", "-", "result", "-", "repository__stargazers", "\"", ").", "append", "(", "repo", ".", "stargazers_count", "+", "\"", "Stars", "\"", ");", "$", "container", ".", "find", "(", "\".", "select2", "-", "result", "-", "repository__watchers", "\"", ").", "append", "(", "repo", ".", "watchers_count", "+", "\"", "Watchers", "\"", ");", "return", "$", "container", ";", "}", "function", "formatRepoSelection", "(", "repo", ")", "{"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "62", ",", "12", "+", "62", ",", "11", "@", "@", "public", "String", "getIconFileName", "(", ")", "{", "}", "public", "String", "getDisplayName", "(", ")", "{", "return", "\"", "Jenkins", "CLI", "\"", ";", "}", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "cli", "\"", ";", "return", "jenkins", ".", "CLI", ".", "DISABLED", "?", "null", ":", "\"", "cli", "\"", ";", "}", "public", "void", "doCommand", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", "{", "@", "@", "-", "32", ",", "7", "+", "32", ",", "7", "@", "@", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "\"", "CLI", "-", "connect", "\"", ";", "return", "jenkins", ".", "CLI", ".", "DISABLED", "?", "null", ":", "\"", "CLI", "-", "connect", "\"", ";", "}", "@", "Override", "@", "@", "-", "24", ",", "7", "+", "24", ",", "7", "@", "@", "public", "class", "CliProtocol2", "extends", "CliProtocol", "{", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "\"", "CLI2", "-", "connect", "\"", ";", "return", "jenkins", ".", "CLI", ".", "DISABLED", "?", "null", ":", "\"", "CLI2", "-", "connect", "\"", ";", "}", "@", "Override", "@", "@", "-", "0", ",", "0", "+", "1", ",", "17", "@", "@", "package", "jenkins", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "/", "**", "*", "Kill", "switch", "to", "disable", "the", "entire", "Jenkins", "CLI", "system", ".", "*", "*", "Marked", "as", "no", "external", "use", "because", "the", "CLI", "subsystem", "is", "nearing", "EOL", ".", "*", "*", "@", "author", "Kohsuke", "Kawaguchi", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "class", "CLI", "{", "/", "/", "non", "-", "final", "to", "allow", "setting", "from", "$", "JENKINS_HOME", "/", "init", ".", "groovy", ".", "d", "public", "static", "boolean", "DISABLED", "=", "Boolean", ".", "getBoolean", "(", "CLI", ".", "class", ".", "getName", "(", ")+", "\".", "disabled", "\"", ");", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "65", "@", "@", "package", "jenkins", ";", "import", "hudson", ".", "cli", ".", "FullDuplexHttpStream", ";", "import", "hudson", ".", "model", ".", "Computer", ";", "import", "hudson", ".", "model", ".", "Failure", ";", "import", "hudson", ".", "remoting", ".", "Channel", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "java", ".", "io", ".", "FileNotFoundException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "*", "@", "author", "Kohsuke", "Kawaguchi", "*", "/", "public", "class", "CLITest", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "/", "**", "*", "Checks", "if", "the", "kill", "switch", "works", "correctly", "*", "/", "@", "Test", "public", "void", "killSwitch", "(", ")", "throws", "Exception", "{", "/", "/", "this", "should", "succeed", ",", "as", "a", "control", "case", "makeHttpCall", "(", ");", "makeJnlpCall", "(", ");", "CLI", ".", "DISABLED", "=", "true", ";", "try", "{", "try", "{", "makeHttpCall", "(", ");", "fail", "(", "\"", "Should", "have", "been", "rejected", "\"", ");", "}", "catch", "(", "FileNotFoundException", "e", ")", "{", "/", "/", "attempt", "to", "make", "a", "call", "should", "fail", "}", "try", "{", "makeJnlpCall", "(", ");", "fail", "(", "\"", "Should", "have", "been", "rejected", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "/", "/", "attempt", "to", "make", "a", "call", "should", "fail", "e", ".", "printStackTrace", "(", ");", "/", "/", "the", "current", "expected", "failure", "mode", "is", "EOFException", ",", "though", "we", "don", "'", "t", "really", "care", "how", "it", "fails", "}", "}", "finally", "{", "CLI", ".", "DISABLED", "=", "false", ";", "}", "}", "private", "void", "makeHttpCall", "(", ")", "throws", "Exception", "{", "FullDuplexHttpStream", "con", "=", "new", "FullDuplexHttpStream", "(", "new", "URL", "(", "j", ".", "getURL", "(", "),", "\"", "cli", "\"", "))", ";", "Channel", "ch", "=", "new", "Channel", "(", "\"", "test", "connection", "\"", ",", "Computer", ".", "threadPoolForRemoting", ",", "con", ".", "getInputStream", "(", "),", "con", ".", "getOutputStream", "(", "))", ";", "ch", ".", "close", "(", ");", "}", "private", "void", "makeJnlpCall", "(", ")", "throws", "Exception", "{", "int", "r", "=", "hudson", ".", "cli", ".", "CLI", ".", "_main", "(", "new", "String", "[", "]{", "\"-", "s", "\"", ",", "j", ".", "getURL", "(", ").", "toString", "(", "),", "\"", "version", "\"", "})", ";", "if", "(", "r", "!", "=", "0", ")", "throw", "new", "Failure", "(", "\"", "CLI", "failed", "\"", ");", "}", "}"], "docstring_tokens": ["http", "java", "deserialization"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "348", ",", "6", "+", "348", ",", "12", "@", "@", "static", "int", "is_gpt_valid", "(", "struct", "parsed_partitions", "*", "state", ",", "u64", "lba", ",", "goto", "fail", ";", "}", "/", "*", "Check", "that", "sizeof_partition_entry", "has", "the", "correct", "value", "*", "/", "if", "(", "le32_to_cpu", "(", "(*", "gpt", ")", "->", "sizeof_partition_entry", ")", "!", "=", "sizeof", "(", "gpt_entry", ")", ")", "{", "pr_debug", "(", "\"", "GUID", "Partitition", "Entry", "Size", "check", "failed", ".", "\\", "n", "\"", ");", "goto", "fail", ";", "}", "if", "(", "!(", "*", "ptes", "=", "alloc_read_gpt_entries", "(", "state", ",", "*", "gpt", ")", "))", "goto", "fail", ";"], "docstring_tokens": ["input", "validation"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "543", ",", "7", "+", "543", ",", "7", "@", "@", "private", "LocalizedResource", "downloadBlob", "(", "Map", "conf", ",", "String", "key", ",", "File", "localFile", ",", "out", ".", "close", "(", ");", "in", ".", "close", "(", ");", "if", "(", "uncompress", ")", "{", "Utils", ".", "unpack", "(", "new", "File", "(", "downloadFile", ")", ",", "new", "File", "(", "localFileWithVersion", ")", ");", "Utils", ".", "unpack", "(", "new", "File", "(", "downloadFile", ")", ",", "new", "File", "(", "localFileWithVersion", ")", ",", "(", "boolean", ")", "OR", "(", "_conf", ".", "get", "(", "Config", ".", "DISABLE_SYMLINKS", ")", ",", "false", ")", ");", "LOG", ".", "debug", "(", "\"", "uncompressed", "\"", "+", "downloadFile", "+", "\"", "to", ":", "\"", "+", "localFileWithVersion", ")", ";", "}", "@", "@", "-", "861", ",", "52", "+", "861", ",", "9", "@", "@", "public", "static", "long", "secureRandomLong", "(", ")", "{", "*", "@", "param", "jarFile", "the", ".", "jar", "file", "to", "unpack", "*", "@", "param", "toDir", "the", "destination", "directory", "into", "which", "to", "unpack", "the", "jar", "*", "/", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ";", "try", "{", "Enumeration", "<", "JarEntry", ">", "entries", "=", "jar", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "final", "JarEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "jar", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "copyBytes", "(", "in", ",", "out", ",", "8192", ")", ";", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "jar", ".", "close", "(", ");", "}", "}", "/", "**", "*", "Copies", "from", "one", "stream", "to", "another", ".", "*", "*", "@", "param", "in", "InputStream", "to", "read", "from", "*", "@", "param", "out", "OutputStream", "to", "write", "to", "*", "@", "param", "buffSize", "the", "size", "of", "the", "buffer", "*", "/", "public", "static", "void", "copyBytes", "(", "InputStream", "in", ",", "OutputStream", "out", ",", "int", "buffSize", ")", "throws", "IOException", "{", "PrintStream", "ps", "=", "out", "instanceof", "PrintStream", "?", "(", "PrintStream", ")", "out", ":", "null", ";", "byte", "buf", "[", "]", "=", "new", "byte", "[", "buffSize", "]", ";", "int", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "while", "(", "bytesRead", ">", "=", "0", ")", "{", "out", ".", "write", "(", "buf", ",", "0", ",", "bytesRead", ")", ";", "if", "(", "(", "ps", "!", "=", "null", ")", "&", "&", "ps", ".", "checkError", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Unable", "to", "write", "to", "output", "stream", ".", "\")", ";", "}", "bytesRead", "=", "in", ".", "read", "(", "buf", ")", ";", "public", "static", "void", "unJar", "(", "File", "jarFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "JarFile", "jar", "=", "new", "JarFile", "(", "jarFile", ")", ")", "{", "extractZipFile", "(", "jar", ",", "toDir", ",", "null", ")", ";", "}", "}", "@", "@", "-", "930", ",", "20", "+", "887", ",", "17", "@", "@", "private", "static", "void", "ensureDirectory", "(", "File", "dir", ")", "throws", "IOException", "{", "*", "*", "@", "param", "inFile", "The", "tar", "file", "as", "input", ".", "*", "@", "param", "untarDir", "The", "untar", "directory", "where", "to", "untar", "the", "tar", "file", ".", "*", "@", "param", "symlinksDisabled", "true", "if", "symlinks", "should", "be", "disabled", ",", "else", "false", ".", "*", "@", "throws", "IOException", "*", "/", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ")", "throws", "IOException", "{", "if", "(", "!", "untarDir", ".", "mkdirs", "(", "))", "{", "if", "(", "!", "untarDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "untarDir", ")", ";", "}", "}", "public", "static", "void", "unTar", "(", "File", "inFile", ",", "File", "untarDir", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "ensureDirectory", "(", "untarDir", ")", ";", "boolean", "gzipped", "=", "inFile", ".", "toString", "(", ").", "endsWith", "(", "\"", "gz", "\"", ");", "if", "(", "isOnWindows", "(", "))", "{", "if", "(", "Utils", ".", "isOnWindows", "(", ")", "|", "|", "symlinksDisabled", ")", "{", "/", "/", "Tar", "is", "not", "native", "to", "Windows", ".", "Use", "simple", "Java", "based", "implementation", "for", "/", "/", "tests", "and", "simple", "tar", "archives", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ")", ";", "unTarUsingJava", "(", "inFile", ",", "untarDir", ",", "gzipped", ",", "symlinksDisabled", ")", ";", "}", "else", "{", "/", "/", "spawn", "tar", "utility", "to", "untar", "archive", "for", "full", "fledged", "unix", "behavior", "such", "/", "/", "as", "resolving", "symlinks", "in", "tar", "archives", "@", "@", "-", "980", ",", "7", "+", "934", ",", "9", "@", "@", "private", "static", "void", "unTarUsingTar", "(", "File", "inFile", ",", "File", "untarDir", ",", "}", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "boolean", "gzipped", ")", "throws", "IOException", "{", "boolean", "gzipped", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "final", "String", "base", "=", "untarDir", ".", "getCanonicalPath", "(", ");", "LOG", ".", "trace", "(", "\"", "java", "untar", "{", "}", "to", "{", "}\"", ",", "inFile", ",", "base", ")", ";", "InputStream", "inputStream", "=", "null", ";", "try", "{", "if", "(", "gzipped", ")", "{", "@", "@", "-", "991", ",", "7", "+", "947", ",", "7", "@", "@", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "}", "try", "(", "TarArchiveInputStream", "tis", "=", "new", "TarArchiveInputStream", "(", "inputStream", ")", ")", "{", "for", "(", "TarArchiveEntry", "entry", "=", "tis", ".", "getNextTarEntry", "(", ");", "entry", "!", "=", "null", ";", ")", "{", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ")", ";", "unpackEntries", "(", "tis", ",", "entry", ",", "untarDir", ",", "base", ",", "symlinksDisabled", ")", ";", "entry", "=", "tis", ".", "getNextTarEntry", "(", ");", "}", "}", "@", "@", "-", "1003", ",", "35", "+", "959", ",", "82", "@", "@", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "}", "private", "static", "void", "unpackEntries", "(", "TarArchiveInputStream", "tis", ",", "TarArchiveEntry", "entry", ",", "File", "outputDir", ")", "throws", "IOException", "{", "TarArchiveEntry", "entry", ",", "File", "outputDir", ",", "final", "String", "base", ",", "boolean", "symlinksDisabled", ")", "throws", "IOException", "{", "File", "target", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "target", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "return", ";", "}", "if", "(", "entry", ".", "isDirectory", "(", "))", "{", "File", "subDir", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "subDir", ".", "mkdirs", "(", ")", "&", "&", "!", "subDir", ".", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "}", "LOG", ".", "trace", "(", "\"", "Extracting", "dir", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ")", ";", "for", "(", "TarArchiveEntry", "e", ":", "entry", ".", "getDirectoryEntries", "(", "))", "{", "unpackEntries", "(", "tis", ",", "e", ",", "subDir", ")", ";", "unpackEntries", "(", "tis", ",", "e", ",", "target", ",", "base", ",", "symlinksDisabled", ")", ";", "}", "return", ";", "}", "else", "if", "(", "entry", ".", "isSymbolicLink", "(", "))", "{", "if", "(", "symlinksDisabled", ")", "{", "LOG", ".", "info", "(", "\"", "Symlinks", "disabled", "skipping", "{", "}\"", ",", "target", ")", ";", "}", "else", "{", "Path", "src", "=", "target", ".", "toPath", "(", ");", "Path", "dest", "=", "Paths", ".", "get", "(", "entry", ".", "getLinkName", "(", "))", ";", "LOG", ".", "trace", "(", "\"", "Extracting", "sym", "link", "{", "}", "to", "{", "}\"", ",", "target", ",", "dest", ")", ";", "/", "/", "Create", "symbolic", "link", "relative", "to", "tar", "parent", "dir", "Files", ".", "createSymbolicLink", "(", "src", ",", "dest", ")", ";", "}", "}", "else", "if", "(", "entry", ".", "isFile", "(", "))", "{", "LOG", ".", "trace", "(", "\"", "Extracting", "file", "{", "}\"", ",", "target", ")", ";", "ensureDirectory", "(", "target", ".", "getParentFile", "(", "))", ";", "try", "(", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "target", ")", "))", "{", "IOUtils", ".", "copy", "(", "tis", ",", "outputStream", ")", ";", "}", "}", "else", "{", "LOG", ".", "error", "(", "\"{", "}", "is", "not", "a", "currently", "supported", "tar", "entry", "type", ".", "\",", "entry", ")", ";", "}", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "exists", "(", "))", "{", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "+", "outputDir", ")", ";", "Path", "p", "=", "target", ".", "toPath", "(", ");", "if", "(", "Files", ".", "exists", "(", "p", ")", ")", "{", "try", "{", "/", "/", "We", "created", "it", "so", "lets", "chmod", "it", "properly", "int", "mode", "=", "entry", ".", "getMode", "(", ");", "Files", ".", "setPosixFilePermissions", "(", "p", ",", "parsePerms", "(", "mode", ")", ");", "}", "catch", "(", "UnsupportedOperationException", "e", ")", "{", "/", "/", "Ignored", "the", "file", "system", "we", "are", "on", "does", "not", "support", "this", ",", "so", "don", "'", "t", "do", "it", ".", "}", "}", "int", "count", ";", "byte", "data", "[", "]", "=", "new", "byte", "[", "2048", "]", ";", "BufferedOutputStream", "outputStream", "=", "new", "BufferedOutputStream", "(", "new", "FileOutputStream", "(", "outputFile", ")", ");", "}", "while", "(", "(", "count", "=", "tis", ".", "read", "(", "data", ")", ")", "!", "=", "-", "1", ")", "{", "outputStream", ".", "write", "(", "data", ",", "0", ",", "count", ")", ";", "private", "static", "Set", "<", "PosixFilePermission", ">", "parsePerms", "(", "int", "mode", ")", "{", "Set", "<", "PosixFilePermission", ">", "ret", "=", "new", "HashSet", "<", ">(", ");", "if", "(", "(", "mode", "&", "0001", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0002", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0004", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OTHERS_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0010", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0020", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_WRITE", ")", ";", "}", "outputStream", ".", "flush", "(", ");", "outputStream", ".", "close", "(", ");", "if", "(", "(", "mode", "&", "0040", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "GROUP_READ", ")", ";", "}", "if", "(", "(", "mode", "&", "0100", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_EXECUTE", ")", ";", "}", "if", "(", "(", "mode", "&", "0200", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_WRITE", ")", ";", "}", "if", "(", "(", "mode", "&", "0400", ")", ">", "0", ")", "{", "ret", ".", "add", "(", "PosixFilePermission", ".", "OWNER_READ", ")", ";", "}", "return", "ret", ";", "}", "public", "static", "boolean", "isOnWindows", "(", ")", "{", "@", "@", "-", "1045", ",", "16", "+", "1048", ",", "21", "@", "@", "public", "static", "boolean", "isAbsolutePath", "(", "String", "path", ")", "{", "return", "Paths", ".", "get", "(", "path", ")", ".", "isAbsolute", "(", ");", "}", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ")", "throws", "IOException", "{", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ",", "boolean", "symLinksDisabled", ")", "throws", "IOException", "{", "String", "lowerDst", "=", "localrsrc", ".", "getName", "(", ").", "toLowerCase", "(", ");", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", "))", "{", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "jar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_jar", "\"", "))", "{", "unJar", "(", "localrsrc", ",", "dst", ")", ";", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", "))", "{", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "zip", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_zip", "\"", "))", "{", "unZip", "(", "localrsrc", ",", "dst", ")", ";", "}", "else", "if", "(", "lowerDst", ".", "endsWith", "(", "\".", "tar", ".", "gz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ")", ";", "lowerDst", ".", "endsWith", "(", "\"", "_tar_gz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tgz", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\".", "tar", "\"", ")", "|", "|", "lowerDst", ".", "endsWith", "(", "\"", "_tar", "\"", "))", "{", "unTar", "(", "localrsrc", ",", "dst", ",", "symLinksDisabled", ")", ";", "}", "else", "{", "LOG", ".", "warn", "(", "\"", "Cannot", "unpack", "\"", "+", "localrsrc", ")", ";", "if", "(", "!", "localrsrc", ".", "renameTo", "(", "dst", ")", ")", "{", "@", "@", "-", "1067", ",", "6", "+", "1075", ",", "35", "@", "@", "public", "static", "void", "unpack", "(", "File", "localrsrc", ",", "File", "dst", ")", "throws", "IOException", "{", "}", "}", "private", "static", "void", "extractZipFile", "(", "ZipFile", "zipFile", ",", "File", "toDir", ",", "String", "prefix", ")", "throws", "IOException", "{", "ensureDirectory", "(", "toDir", ")", ";", "final", "String", "base", "=", "toDir", ".", "getCanonicalPath", "(", ");", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "if", "(", "prefix", "!", "=", "null", "&", "&", "!", "entry", ".", "getName", "(", ").", "startsWith", "(", "prefix", ")", ")", "{", "/", "/", "No", "need", "to", "extract", "it", ",", "it", "is", "not", "what", "we", "are", "looking", "for", ".", "continue", ";", "}", "File", "file", "=", "new", "File", "(", "toDir", ",", "entry", ".", "getName", "(", "))", ";", "String", "found", "=", "file", ".", "getCanonicalPath", "(", ");", "if", "(", "!", "found", ".", "startsWith", "(", "base", ")", ")", "{", "LOG", ".", "error", "(", "\"", "Invalid", "location", "{", "}", "is", "outside", "of", "{", "}\"", ",", "found", ",", "base", ")", ";", "continue", ";", "}", "try", "(", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "ensureDirectory", "(", "file", ".", "getParentFile", "(", "))", ";", "try", "(", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}", "}", "}", "public", "static", "boolean", "canUserReadBlob", "(", "ReadableBlobMeta", "meta", ",", "String", "user", ")", "{", "SettableBlobMeta", "settable", "=", "meta", ".", "get_settable", "(", ");", "for", "(", "AccessControl", "acl", ":", "settable", ".", "get_acl", "(", "))", "{", "@", "@", "-", "1398", ",", "45", "+", "1435", ",", "12", "@", "@", "public", "static", "void", "validateTopologyBlobStoreMap", "(", "Map", "<", "String", ",", "?", ">", "stormConf", ",", "Set", "<", "St", "*", "Given", "a", "File", "input", "it", "will", "unzip", "the", "file", "in", "a", "the", "unzip", "directory", "*", "passed", "as", "the", "second", "parameter", "*", "@", "param", "inFile", "The", "zip", "file", "as", "input", "*", "@", "param", "unzipDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "*", "@", "param", "toDir", "The", "unzip", "directory", "where", "to", "unzip", "the", "zip", "file", ".", "*", "@", "throws", "IOException", "*", "/", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "unzipDir", ")", "throws", "IOException", "{", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", ";", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ";", "try", "{", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "file", ".", "getParentFile", "(", ").", "toString", "(", "))", ";", "}", "}", "OutputStream", "out", "=", "new", "FileOutputStream", "(", "file", ")", ";", "try", "{", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "8192", "]", ";", "int", "i", ";", "while", "(", "(", "i", "=", "in", ".", "read", "(", "buffer", ")", ")", "!", "=", "-", "1", ")", "{", "out", ".", "write", "(", "buffer", ",", "0", ",", "i", ")", ";", "}", "}", "finally", "{", "out", ".", "close", "(", ");", "}", "}", "finally", "{", "in", ".", "close", "(", ");", "}", "}", "}", "}", "finally", "{", "zipFile", ".", "close", "(", ");", "}", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "toDir", ")", "throws", "IOException", "{", "try", "(", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ")", "{", "extractZipFile", "(", "zipFile", ",", "toDir", ",", "null", ")", ";", "}", "}", "/", "**", "@", "@", "-", "1910", ",", "21", "+", "1914", ",", "10", "@", "@", "public", "static", "int", "execCommand", "(", "String", ".", "..", "command", ")", "throws", "ExecuteException", ",", "IOExce", "public", "static", "void", "extractDirFromJar", "(", "String", "jarpath", ",", "String", "dir", ",", "File", "destdir", ")", "{", "_instance", ".", "extractDirFromJarImpl", "(", "jarpath", ",", "dir", ",", "destdir", ")", ";", "}", "public", "void", "extractDirFromJarImpl", "(", "String", "jarpath", ",", "String", "dir", ",", "File", "destdir", ")", "{", "try", "(", "JarFile", "jarFile", "=", "new", "JarFile", "(", "jarpath", ")", ")", "{", "Enumeration", "<", "JarEntry", ">", "jarEnums", "=", "jarFile", ".", "entries", "(", ");", "while", "(", "jarEnums", ".", "hasMoreElements", "(", "))", "{", "JarEntry", "entry", "=", "jarEnums", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", ")", "&", "&", "entry", ".", "getName", "(", ").", "startsWith", "(", "dir", ")", ")", "{", "File", "aFile", "=", "new", "File", "(", "destdir", ",", "entry", ".", "getName", "(", "))", ";", "aFile", ".", "getParentFile", "(", ").", "mkdirs", "(", ");", "try", "(", "FileOutputStream", "out", "=", "new", "FileOutputStream", "(", "aFile", ")", ";", "InputStream", "in", "=", "jarFile", ".", "getInputStream", "(", "entry", ")", ")", "{", "IOUtils", ".", "copy", "(", "in", ",", "out", ")", ";", "}", "}", "}", "extractZipFile", "(", "jarFile", ",", "destdir", ",", "dir", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOG", ".", "info", "(", "\"", "Could", "not", "extract", "{", "}", "from", "{", "}\"", ",", "dir", ",", "jarpath", ")", ";", "}"], "docstring_tokens": ["arbitrary", "file", "write"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "195", ",", "6", "+", "195", ",", "13", "@", "@", "static", "int", "phar_tar_process_metadata", "(", "phar_entry_info", "*", "entry", ",", "php_stream", "*", "fp", "TSRM", "}", "/", "*", "}", "}}", "*", "/", "#", "if", "!", "HAVE_STRNLEN", "static", "size_t", "strnlen", "(", "const", "char", "*", "s", ",", "size_t", "maxlen", ")", "{", "char", "*", "r", "=", "(", "char", "*", ")", "memchr", "(", "s", ",", "'", "\\", "0", "'", ",", "maxlen", ")", ";", "return", "r", "?", "r", "-", "s", ":", "maxlen", ";", "}", "#", "endif", "int", "phar_parse_tarfile", "(", "php_stream", "*", "fp", ",", "char", "*", "fname", ",", "int", "fname_len", ",", "char", "*", "alias", ",", "int", "alias_len", ",", "phar_archive_data", "*", "*", "pphar", ",", "int", "is_data", ",", "php_uint32", "compression", ",", "char", "*", "*", "error", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "char", "buf", "[", "512", "]", ",", "*", "actual_alias", "=", "NULL", ",", "*", "p", ";", "@", "@", "-", "204", ",", "6", "+", "211", ",", "7", "@", "@", "int", "phar_parse_tarfile", "(", "php_stream", "*", "fp", ",", "char", "*", "fname", ",", "int", "fname_len", ",", "char", "*", "alias", ",", "php_uint32", "sum1", ",", "sum2", ",", "size", ",", "old", ";", "phar_archive_data", "*", "myphar", ",", "*", "*", "actual", ";", "int", "last_was_longlink", "=", "0", ";", "int", "linkname_len", ";", "if", "(", "error", ")", "{", "*", "error", "=", "NULL", ";", "@", "@", "-", "264", ",", "7", "+", "272", ",", "7", "@", "@", "int", "phar_parse_tarfile", "(", "php_stream", "*", "fp", ",", "char", "*", "fname", ",", "int", "fname_len", ",", "char", "*", "alias", ",", "goto", "next", ";", "}", "if", "(", "((", "!", "old", "&", "&", "hdr", "-", ">", "prefix", "[", "0", "]", "=", "=", "0", ")", "|", "|", "old", ")", "&", "&", "strlen", "(", "hdr", "-", ">", "name", ")", "=", "=", "sizeof", "(", "\".", "phar", "/", "signature", ".", "bin", "\"", ")-", "1", "&", "&", "!", "strncmp", "(", "hdr", "-", ">", "name", ",", "\"", ".", "phar", "/", "signature", ".", "bin", "\"", ",", "sizeof", "(", "\".", "phar", "/", "signature", ".", "bin", "\"", ")-", "1", ")", ")", "{", "if", "(", "((", "!", "old", "&", "&", "hdr", "-", ">", "prefix", "[", "0", "]", "=", "=", "0", ")", "|", "|", "old", ")", "&", "&", "strnlen", "(", "hdr", "-", ">", "name", ",", "100", ")", "=", "=", "sizeof", "(", "\".", "phar", "/", "signature", ".", "bin", "\"", ")-", "1", "&", "&", "!", "strncmp", "(", "hdr", "-", ">", "name", ",", "\"", ".", "phar", "/", "signature", ".", "bin", "\"", ",", "sizeof", "(", "\".", "phar", "/", "signature", ".", "bin", "\"", ")-", "1", ")", ")", "{", "off_t", "curloc", ";", "if", "(", "size", ">", "511", ")", "{", "@", "@", "-", "474", ",", "20", "+", "482", ",", "22", "@", "@", "int", "phar_parse_tarfile", "(", "php_stream", "*", "fp", ",", "char", "*", "fname", ",", "int", "fname_len", ",", "char", "*", "alias", ",", "}", "entry", ".", "link", "=", "NULL", ";", "/", "*", "link", "field", "is", "null", "-", "terminated", "unless", "it", "has", "100", "non", "-", "null", "chars", ".", "*", "Thus", "we", "can", "not", "use", "strlen", ".", "*", "/", "linkname_len", "=", "strnlen", "(", "hdr", "-", ">", "linkname", ",", "100", ")", ";", "if", "(", "entry", ".", "tar_type", "=", "=", "TAR_LINK", ")", "{", "if", "(", "!", "zend_hash_exists", "(", "&", "myphar", "-", ">", "manifest", ",", "hdr", "-", ">", "linkname", ",", "strlen", "(", "hdr", "-", ">", "linkname", ")", "))", "{", "if", "(", "!", "zend_hash_exists", "(", "&", "myphar", "-", ">", "manifest", ",", "hdr", "-", ">", "linkname", ",", "linkname_len", ")", ")", "{", "if", "(", "error", ")", "{", "spprintf", "(", "error", ",", "4096", ",", "\"", "phar", "error", ":", "\\", "\"%", "s", "\\", "\"", "is", "a", "corrupted", "tar", "file", "-", "hard", "link", "to", "non", "-", "existent", "file", "\\", "\"%", "s", "\\", "\"\"", ",", "fname", ",", "hdr", "-", ">", "linkname", ")", ";", "spprintf", "(", "error", ",", "4096", ",", "\"", "phar", "error", ":", "\\", "\"%", "s", "\\", "\"", "is", "a", "corrupted", "tar", "file", "-", "hard", "link", "to", "non", "-", "existent", "file", "\\", "\"%", ".*", "s", "\\", "\"\"", ",", "fname", ",", "linkname_len", ",", "hdr", "-", ">", "linkname", ")", ";", "}", "pefree", "(", "entry", ".", "filename", ",", "entry", ".", "is_persistent", ")", ";", "php_stream_close", "(", "fp", ")", ";", "phar_destroy_phar_data", "(", "myphar", "TSRMLS_CC", ")", ";", "return", "FAILURE", ";", "}", "entry", ".", "link", "=", "estrdup", "(", "hdr", "-", ">", "linkname", ")", ";", "entry", ".", "link", "=", "estrndup", "(", "hdr", "-", ">", "linkname", ",", "linkname_len", ")", ";", "}", "else", "if", "(", "entry", ".", "tar_type", "=", "=", "TAR_SYMLINK", ")", "{", "entry", ".", "link", "=", "estrdup", "(", "hdr", "-", ">", "linkname", ")", ";", "entry", ".", "link", "=", "estrndup", "(", "hdr", "-", ">", "linkname", ",", "linkname_len", ")", ";", "}", "phar_set_inode", "(", "&", "entry", "TSRMLS_CC", ")", ";", "zend_hash_add", "(", "&", "myphar", "-", ">", "manifest", ",", "entry", ".", "filename", ",", "entry", ".", "filename_len", ",", "(", "void", "*", ")&", "entry", ",", "sizeof", "(", "phar_entry_info", ")", ",", "(", "void", "*", "*)", "&", "newentry", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "16", "@", "@", "-", "-", "TEST", "-", "-", "Phar", ":", "bug", "#", "71488", ":", "Stack", "overflow", "when", "decompressing", "tar", "archives", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "phar", "\"", "))", "die", "(", "\"", "skip", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "p", "=", "new", "PharData", "(", "__DIR__", ".", "\"/", "bug71488", ".", "tar", "\"", ");", "$", "newp", "=", "$", "p", "-", ">", "decompress", "(", "\"", "test", "\"", ");", "?", ">", "DONE", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "@", "unlink", "(", "__DIR__", ".", "\"/", "bug71488", ".", "test", "\"", ");", "?", ">", "-", "-", "EXPECT", "-", "-", "DONE", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "585", ",", "15", "+", "585", ",", "20", "@", "@", "public", "static", "long", "getDU", "(", "File", "dir", ")", "{", "public", "static", "void", "unZip", "(", "File", "inFile", ",", "File", "unzipDir", ")", "throws", "IOException", "{", "Enumeration", "<", "?", "extends", "ZipEntry", ">", "entries", ";", "ZipFile", "zipFile", "=", "new", "ZipFile", "(", "inFile", ")", ";", "String", "targetDirPath", "=", "unzipDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "try", "{", "entries", "=", "zipFile", ".", "entries", "(", ");", "while", "(", "entries", ".", "hasMoreElements", "(", "))", "{", "ZipEntry", "entry", "=", "entries", ".", "nextElement", "(", ");", "if", "(", "!", "entry", ".", "isDirectory", "(", "))", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "file", "outside", "of", "\"", "+", "unzipDir", ")", ";", "}", "InputStream", "in", "=", "zipFile", ".", "getInputStream", "(", "entry", ")", ";", "try", "{", "File", "file", "=", "new", "File", "(", "unzipDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "if", "(", "!", "file", ".", "getParentFile", "(", ").", "isDirectory", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "\"", "+", "@", "@", "-", "703", ",", "6", "+", "708", ",", "13", "@", "@", "private", "static", "void", "unTarUsingJava", "(", "File", "inFile", ",", "File", "untarDir", ",", "private", "static", "void", "unpackEntries", "(", "TarArchiveInputStream", "tis", ",", "TarArchiveEntry", "entry", ",", "File", "outputDir", ")", "throws", "IOException", "{", "String", "targetDirPath", "=", "outputDir", ".", "getCanonicalPath", "(", ")", "+", "File", ".", "separator", ";", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getCanonicalPath", "(", ").", "startsWith", "(", "targetDirPath", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "expanding", "\"", "+", "entry", ".", "getName", "(", ")", "+", "\"", "would", "create", "entry", "outside", "of", "\"", "+", "outputDir", ")", ";", "}", "if", "(", "entry", ".", "isDirectory", "(", "))", "{", "File", "subDir", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "subDir", ".", "mkdirs", "(", ")", "&", "&", "!", "subDir", ".", "isDirectory", "(", "))", "{", "@", "@", "-", "717", ",", "7", "+", "729", ",", "6", "@", "@", "private", "static", "void", "unpackEntries", "(", "TarArchiveInputStream", "tis", ",", "return", ";", "}", "File", "outputFile", "=", "new", "File", "(", "outputDir", ",", "entry", ".", "getName", "(", "))", ";", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "exists", "(", "))", "{", "if", "(", "!", "outputFile", ".", "getParentFile", "(", ").", "mkdirs", "(", "))", "{", "throw", "new", "IOException", "(", "\"", "Mkdirs", "failed", "to", "create", "tar", "internal", "dir", "\"", "@", "@", "-", "37", ",", "6", "+", "37", ",", "7", "@", "@", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "net", ".", "UnknownHostException", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "@", "@", "-", "679", ",", "10", "+", "680", ",", "8", "@", "@", "public", "void", "testCreateLocalTempFile", "(", ")", "throws", "IOException", "{", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "/", "/", "make", "sa", "simple", "zip", "setupDirs", "(", ");", "/", "/", "make", "a", "simple", "tar", ":", "/", "/", "make", "a", "simple", "zip", "final", "File", "simpleZip", "=", "new", "File", "(", "del", ",", "FILE", ")", ";", "OutputStream", "os", "=", "new", "FileOutputStream", "(", "simpleZip", ")", ";", "ZipOutputStream", "tos", "=", "new", "ZipOutputStream", "(", "os", ")", ";", "@", "@", "-", "699", ",", "7", "+", "698", ",", "7", "@", "@", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "tos", ".", "close", "(", ");", "}", "/", "/", "successfully", "untar", "it", "into", "an", "existing", "dir", ":", "/", "/", "successfully", "unzip", "it", "into", "an", "existing", "dir", ":", "FileUtil", ".", "unZip", "(", "simpleZip", ",", "tmp", ")", ";", "/", "/", "check", "result", ":", "assertTrue", "(", "new", "File", "(", "tmp", ",", "\"", "foo", "\"", ").", "exists", "(", "))", ";", "@", "@", "-", "714", ",", "8", "+", "713", ",", "36", "@", "@", "public", "void", "testUnZip", "(", ")", "throws", "IOException", "{", "}", "catch", "(", "IOException", "ioe", ")", "{", "/", "/", "okay", "}", "}", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "public", "void", "testUnZip2", "(", ")", "throws", "IOException", "{", "setupDirs", "(", ");", "/", "/", "make", "a", "simple", "zip", "final", "File", "simpleZip", "=", "new", "File", "(", "del", ",", "FILE", ")", ";", "OutputStream", "os", "=", "new", "FileOutputStream", "(", "simpleZip", ")", ";", "try", "(", "ZipOutputStream", "tos", "=", "new", "ZipOutputStream", "(", "os", ")", ")", "{", "/", "/", "Add", "an", "entry", "that", "contains", "invalid", "filename", "ZipEntry", "ze", "=", "new", "ZipEntry", "(", "\".", "./", "foo", "\"", ");", "byte", "[", "]", "data", "=", "\"", "some", "-", "content", "\"", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ";", "ze", ".", "setSize", "(", "data", ".", "length", ")", ";", "tos", ".", "putNextEntry", "(", "ze", ")", ";", "tos", ".", "write", "(", "data", ")", ";", "tos", ".", "closeEntry", "(", ");", "tos", ".", "flush", "(", ");", "tos", ".", "finish", "(", ");", "}", "/", "/", "Unzip", "it", "into", "an", "existing", "dir", "try", "{", "FileUtil", ".", "unZip", "(", "simpleZip", ",", "tmp", ")", ";", "Assert", ".", "fail", "(", "\"", "unZip", "should", "throw", "IOException", ".", "\")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "GenericTestUtils", ".", "assertExceptionContains", "(", "\"", "would", "create", "file", "outside", "of", "\"", ",", "e", ")", ";", "}", "}", "@", "Test", "(", "timeout", "=", "30000", ")", "/", "*", "*", "Test", "method", "copy", "(", "FileSystem", "srcFS", ",", "Path", "src", ",", "File", "dst", ",", "boolean", "deleteSource", ",", "Configuration", "conf", ")"], "docstring_tokens": ["zip", "slip"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1074", ",", "7", "+", "1074", ",", "7", "@", "@", "int", "cifs_readdir", "(", "struct", "file", "*", "file", ",", "void", "*", "direntry", ",", "filldir_t", "filldir", ")", "with", "the", "rare", "long", "characters", "alloc", "more", "to", "account", "for", "such", "multibyte", "target", "UTF", "-", "8", "characters", ".", "cifs_unicode", ".", "c", ",", "which", "actually", "does", "the", "conversion", ",", "has", "the", "same", "limit", "*", "/", "tmp_buf", "=", "kmalloc", "(", "(", "2", "*", "NAME_MAX", ")", "+", "4", ",", "GFP_KERNEL", ")", ";", "tmp_buf", "=", "kmalloc", "(", "(", "4", "*", "NAME_MAX", ")", "+", "2", ",", "GFP_KERNEL", ")", ";", "for", "(", "i", "=", "0", ";", "(", "i", "<", "num_to_fill", ")", "&", "&", "(", "rc", "=", "=", "0", ")", ";", "i", "+", "+)", "{", "if", "(", "current_entry", "=", "=", "NULL", ")", "{", "/", "*", "evaluate", "whether", "this", "case", "is", "an", "error", "*", "/"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "3082", ",", "6", "+", "3082", ",", "11", "@", "@", "PHP_FUNCTION", "(", "imagegammacorrect", ")", "return", ";", "}", "if", "(", "input", "<", "=", "0", ".", "0", "|", "|", "output", "<", "=", "0", ".", "0", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Gamma", "values", "should", "be", "positive", "\"", ");", "RETURN_FALSE", ";", "}", "ZEND_FETCH_RESOURCE", "(", "im", ",", "gdImagePtr", ",", "&", "IM", ",", "-", "1", ",", "\"", "Image", "\"", ",", "le_gd", ")", ";", "if", "(", "gdImageTrueColor", "(", "im", ")", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "15", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "72730", ":", "imagegammacorrect", "allows", "arbitrary", "write", "access", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "function_exists", "(", "\"", "imagecreatetruecolor", "\"", "))", "die", "(", "\"", "skip", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "img", "=", "imagecreatetruecolor", "(", "1", ",", "1", ")", ";", "imagegammacorrect", "(", "$", "img", ",", "-", "1", ",", "1337", ")", ";", "?", ">", "DONE", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "imagegammacorrect", "(", "):", "Gamma", "values", "should", "be", "positive", "in", "%", "sbug72730", ".", "php", "on", "line", "%", "d", "DONE", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["memory", "leakage"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1918", ",", "10", "+", "1918", ",", "15", "@", "@", "static", "void", "WriteProfile", "(", "j_compress_ptr", "jpeg_info", ",", "Image", "*", "image", ")", "profile", "=", "GetImageProfile", "(", "image", ",", "name", ")", ";", "p", "=", "GetStringInfoDatum", "(", "custom_profile", ")", ";", "if", "(", "LocaleCompare", "(", "name", ",", "\"", "EXIF", "\"", ")", "=", "=", "0", ")", "for", "(", "i", "=", "0", ";", "i", "<", "(", "ssize_t", ")", "GetStringInfoLength", "(", "profile", ")", ";", "i", "+", "=", "65533L", ")", "{", "length", "=", "MagickMin", "(", "GetStringInfoLength", "(", "profile", ")", "-", "i", ",", "65533L", ")", ";", "jpeg_write_marker", "(", "jpeg_info", ",", "XML_MARKER", ",", "GetStringInfoDatum", "(", "profile", ")", "+", "i", ",", "length", "=", "GetStringInfoLength", "(", "profile", ")", ";", "if", "(", "length", ">", "65533L", ")", "{", "(", "void", ")", "ThrowMagickException", "(", "&", "image", "-", ">", "exception", ",", "GetMagickModule", "(", "),", "CoderWarning", ",", "\"", "ExifProfileSizeExceedsLimit", "\"", ",", "image", "-", ">", "filename", ")", ";", "length", "=", "65533L", ";", "}", "jpeg_write_marker", "(", "jpeg_info", ",", "XML_MARKER", ",", "GetStringInfoDatum", "(", "profile", ")", ",", "(", "unsigned", "int", ")", "length", ")", ";", "}", "if", "(", "LocaleCompare", "(", "name", ",", "\"", "ICC", "\"", ")", "=", "=", "0", ")", "@", "@", "-", "205", ",", "6", "+", "205", ",", "9", "@", "@", "<", "/", "message", ">", "<", "/", "error", ">", "<", "warning", ">", "<", "message", "name", "=", "\"", "ExifProfileSizeExceedsLimit", "\"", ">", "exif", "profile", "size", "exceeds", "limit", "and", "will", "be", "truncated", "<", "/", "message", ">", "<", "message", "name", "=", "\"", "LosslessToLossyJPEGConversion", "\"", ">", "lossless", "to", "lossy", "JPEG", "conversion", "<", "/", "message", ">"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "349", ",", "23", "+", "349", ",", "6", "@", "@", "static", "void", "cm_init_av_for_response", "(", "struct", "cm_port", "*", "port", ",", "struct", "ib_wc", "*", "wc", ",", "grh", ",", "&", "av", "-", ">", "ah_attr", ")", ";", "}", "int", "ib_update_cm_av", "(", "struct", "ib_cm_id", "*", "id", ",", "const", "u8", "*", "smac", ",", "const", "u8", "*", "alt_smac", ")", "{", "struct", "cm_id_private", "*", "cm_id_priv", ";", "cm_id_priv", "=", "container_of", "(", "id", ",", "struct", "cm_id_private", ",", "id", ")", ";", "if", "(", "smac", "!", "=", "NULL", ")", "memcpy", "(", "cm_id_priv", "-", ">", "av", ".", "smac", ",", "smac", ",", "sizeof", "(", "cm_id_priv", "-", ">", "av", ".", "smac", ")", ");", "if", "(", "alt_smac", "!", "=", "NULL", ")", "memcpy", "(", "cm_id_priv", "-", ">", "alt_av", ".", "smac", ",", "alt_smac", ",", "sizeof", "(", "cm_id_priv", "-", ">", "alt_av", ".", "smac", ")", ");", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "ib_update_cm_av", ")", ";", "static", "int", "cm_init_av_by_path", "(", "struct", "ib_sa_path_rec", "*", "path", ",", "struct", "cm_av", "*", "av", ")", "{", "struct", "cm_device", "*", "cm_dev", ";", "@", "@", "-", "1284", ",", "15", "+", "1284", ",", "6", "@", "@", "static", "int", "cma_req_handler", "(", "struct", "ib_cm_id", "*", "cm_id", ",", "struct", "ib_cm_event", "*", "ib_event", ")", "struct", "rdma_id_private", "*", "listen_id", ",", "*", "conn_id", ";", "struct", "rdma_cm_event", "event", ";", "int", "offset", ",", "ret", ";", "u8", "smac", "[", "ETH_ALEN", "]", ";", "u8", "alt_smac", "[", "ETH_ALEN", "]", ";", "u8", "*", "psmac", "=", "smac", ";", "u8", "*", "palt_smac", "=", "alt_smac", ";", "int", "is_iboe", "=", "(", "(", "rdma_node_get_transport", "(", "cm_id", "-", ">", "device", "-", ">", "node_type", ")", "=", "=", "RDMA_TRANSPORT_IB", ")", "&", "&", "(", "rdma_port_get_link_layer", "(", "cm_id", "-", ">", "device", ",", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "port", ")", "=", "=", "IB_LINK_LAYER_ETHERNET", ")", ");", "listen_id", "=", "cm_id", "-", ">", "context", ";", "if", "(", "!", "cma_check_req_qp_type", "(", "&", "listen_id", "-", ">", "id", ",", "ib_event", ")", ")", "@", "@", "-", "1336", ",", "28", "+", "1327", ",", "11", "@", "@", "static", "int", "cma_req_handler", "(", "struct", "ib_cm_id", "*", "cm_id", ",", "struct", "ib_cm_event", "*", "ib_event", ")", "ret", "=", "conn_id", "-", ">", "id", ".", "event_handler", "(", "&", "conn_id", "-", ">", "id", ",", "&", "event", ")", ";", "if", "(", "ret", ")", "goto", "err3", ";", "if", "(", "is_iboe", ")", "{", "if", "(", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "primary_path", "!", "=", "NULL", ")", "rdma_addr_find_smac_by_sgid", "(", "&", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "primary_path", "-", ">", "sgid", ",", "psmac", ",", "NULL", ")", ";", "else", "psmac", "=", "NULL", ";", "if", "(", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "alternate_path", "!", "=", "NULL", ")", "rdma_addr_find_smac_by_sgid", "(", "&", "ib_event", "-", ">", "param", ".", "req_rcvd", ".", "alternate_path", "-", ">", "sgid", ",", "palt_smac", ",", "NULL", ")", ";", "else", "palt_smac", "=", "NULL", ";", "}", "/", "*", "*", "Acquire", "mutex", "to", "prevent", "user", "executing", "rdma_destroy_id", "(", ")", "*", "while", "we", "'", "re", "accessing", "the", "cm_id", ".", "*", "/", "mutex_lock", "(", "&", "lock", ")", ";", "if", "(", "is_iboe", ")", "ib_update_cm_av", "(", "cm_id", ",", "psmac", ",", "palt_smac", ")", ";", "if", "(", "cma_comp", "(", "conn_id", ",", "RDMA_CM_CONNECT", ")", "&", "&", "(", "conn_id", "-", ">", "id", ".", "qp_type", "!", "=", "IB_QPT_UD", ")", ")", "ib_send_cm_mra", "(", "cm_id", ",", "CMA_CM_MRA_SETTING", ",", "NULL", ",", "0", ")", ";", "@", "@", "-", "601", ",", "5", "+", "601", ",", "4", "@", "@", "struct", "ib_cm_sidr_rep_param", "{", "int", "ib_send_cm_sidr_rep", "(", "struct", "ib_cm_id", "*", "cm_id", ",", "struct", "ib_cm_sidr_rep_param", "*", "param", ")", ";", "int", "ib_update_cm_av", "(", "struct", "ib_cm_id", "*", "id", ",", "const", "u8", "*", "smac", ",", "const", "u8", "*", "alt_smac", ")", ";", "#", "endif", "/", "*", "IB_CM_H", "*", "/"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "9", "@", "@", "Changes", "log", "=", "==", "==", "==", "==", "==", "@", "version", "-", "full", "@", "(", "@", "release", "-", "date", "@", ")", "-", "Bugs", "fixed", "-", "XEE", "injection", "security", "in", "XML", "extension", ".", "Reported", "by", "Man", "Yue", "Mo", ".", "-", "2", ".", "3", ".", "11", "(", "09", "/", "28", "/", "2017", ")", "-", "Bugs", "fixed", "@", "@", "-", "370", ",", "7", "+", "370", ",", "10", "@", "@", "protected", "DocumentBuilder", "getDocumentBuilder", "(", ")", "throws", "IOException", "{", "dbf", ".", "setNamespaceAware", "(", "isNamespaceAware", "(", "))", ";", "dbf", ".", "setValidating", "(", "isValidatingDtd", "(", "))", ";", "dbf", ".", "setCoalescing", "(", "isCoalescing", "(", "))", ";", "dbf", ".", "setExpandEntityReferences", "(", "isExpandingEntityRefs", "(", "))", ";", "dbf", ".", "setExpandEntityReferences", "(", "false", ")", ";", "dbf", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ",", "isExpandingEntityRefs", "(", "))", ";", "dbf", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isExpandingEntityRefs", "(", "))", ";", "dbf", ".", "setIgnoringComments", "(", "isIgnoringComments", "(", "))", ";", "dbf", ".", "setIgnoringElementContentWhitespace", "(", "isIgnoringExtraWhitespaces", "(", "))", ";"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "453", ",", "7", "+", "453", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "*", "geneve_gro_receive", "(", "struct", "sock", "*", "sk", ",", "skb_gro_pull", "(", "skb", ",", "gh_len", ")", ";", "skb_gro_postpull_rcsum", "(", "skb", ",", "gh", ",", "gh_len", ")", ";", "pp", "=", "ptype", "-", ">", "callbacks", ".", "gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "ptype", "-", ">", "callbacks", ".", "gro_receive", ",", "head", ",", "skb", ")", ";", "flush", "=", "0", ";", "out_unlock", ":", "@", "@", "-", "583", ",", "7", "+", "583", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "*", "vxlan_gro_receive", "(", "struct", "sock", "*", "sk", ",", "}", "}", "pp", "=", "eth_gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "eth_gro_receive", ",", "head", ",", "skb", ")", ";", "flush", "=", "0", ";", "out", ":", "@", "@", "-", "2169", ",", "7", "+", "2169", ",", "10", "@", "@", "struct", "napi_gro_cb", "{", "/", "*", "Used", "to", "determine", "if", "flush_id", "can", "be", "ignored", "*", "/", "u8", "is_atomic", ":", "1", ";", "/", "*", "5", "bit", "hole", "*", "/", "/", "*", "Number", "of", "gro_receive", "callbacks", "this", "packet", "already", "went", "through", "*", "/", "u8", "recursion_counter", ":", "4", ";", "/", "*", "1", "bit", "hole", "*", "/", "/", "*", "used", "to", "support", "CHECKSUM_COMPLETE", "for", "tunneling", "protocols", "*", "/", "__wsum", "csum", ";", "@", "@", "-", "2180", ",", "6", "+", "2183", ",", "40", "@", "@", "struct", "napi_gro_cb", "{", "#", "define", "NAPI_GRO_CB", "(", "skb", ")", "(", "(", "struct", "napi_gro_cb", "*", ")(", "skb", ")", "->", "cb", ")", "#", "define", "GRO_RECURSION_LIMIT", "15", "static", "inline", "int", "gro_recursion_inc_test", "(", "struct", "sk_buff", "*", "skb", ")", "{", "return", "+", "+", "NAPI_GRO_CB", "(", "skb", ")", "->", "recursion_counter", "=", "=", "GRO_RECURSION_LIMIT", ";", "}", "typedef", "struct", "sk_buff", "*", "*(", "*", "gro_receive_t", ")", "(", "struct", "sk_buff", "*", "*,", "struct", "sk_buff", "*", ");", "static", "inline", "struct", "sk_buff", "*", "*", "call_gro_receive", "(", "gro_receive_t", "cb", ",", "struct", "sk_buff", "*", "*", "head", ",", "struct", "sk_buff", "*", "skb", ")", "{", "if", "(", "unlikely", "(", "gro_recursion_inc_test", "(", "skb", ")", "))", "{", "NAPI_GRO_CB", "(", "skb", ")", "->", "flush", "|", "=", "1", ";", "return", "NULL", ";", "}", "return", "cb", "(", "head", ",", "skb", ")", ";", "}", "typedef", "struct", "sk_buff", "*", "*(", "*", "gro_receive_sk_t", ")", "(", "struct", "sock", "*", ",", "struct", "sk_buff", "*", "*,", "struct", "sk_buff", "*", ");", "static", "inline", "struct", "sk_buff", "*", "*", "call_gro_receive_sk", "(", "gro_receive_sk_t", "cb", ",", "struct", "sock", "*", "sk", ",", "struct", "sk_buff", "*", "*", "head", ",", "struct", "sk_buff", "*", "skb", ")", "{", "if", "(", "unlikely", "(", "gro_recursion_inc_test", "(", "skb", ")", "))", "{", "NAPI_GRO_CB", "(", "skb", ")", "->", "flush", "|", "=", "1", ";", "return", "NULL", ";", "}", "return", "cb", "(", "sk", ",", "head", ",", "skb", ")", ";", "}", "struct", "packet_type", "{", "__be16", "type", ";", "/", "*", "This", "is", "really", "htons", "(", "ether_type", ")", ".", "*", "/", "struct", "net_device", "*", "dev", ";", "/", "*", "NULL", "is", "wildcarded", "here", "*", "/", "@", "@", "-", "664", ",", "7", "+", "664", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "*", "vlan_gro_receive", "(", "struct", "sk_buff", "*", "*", "head", ",", "skb_gro_pull", "(", "skb", ",", "sizeof", "(", "*", "vhdr", ")", ");", "skb_gro_postpull_rcsum", "(", "skb", ",", "vhdr", ",", "sizeof", "(", "*", "vhdr", ")", ");", "pp", "=", "ptype", "-", ">", "callbacks", ".", "gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "ptype", "-", ">", "callbacks", ".", "gro_receive", ",", "head", ",", "skb", ")", ";", "out_unlock", ":", "rcu_read_unlock", "(", ");", "@", "@", "-", "4511", ",", "6", "+", "4511", ",", "7", "@", "@", "static", "enum", "gro_result", "dev_gro_receive", "(", "struct", "napi_struct", "*", "napi", ",", "struct", "sk_buff", "NAPI_GRO_CB", "(", "skb", ")", "->", "flush", "=", "0", ";", "NAPI_GRO_CB", "(", "skb", ")", "->", "free", "=", "0", ";", "NAPI_GRO_CB", "(", "skb", ")", "->", "encap_mark", "=", "0", ";", "NAPI_GRO_CB", "(", "skb", ")", "->", "recursion_counter", "=", "0", ";", "NAPI_GRO_CB", "(", "skb", ")", "->", "is_fou", "=", "0", ";", "NAPI_GRO_CB", "(", "skb", ")", "->", "is_atomic", "=", "1", ";", "NAPI_GRO_CB", "(", "skb", ")", "->", "gro_remcsum_start", "=", "0", ";", "@", "@", "-", "439", ",", "7", "+", "439", ",", "7", "@", "@", "struct", "sk_buff", "*", "*", "eth_gro_receive", "(", "struct", "sk_buff", "*", "*", "head", ",", "skb_gro_pull", "(", "skb", ",", "sizeof", "(", "*", "eh", ")", ");", "skb_gro_postpull_rcsum", "(", "skb", ",", "eh", ",", "sizeof", "(", "*", "eh", ")", ");", "pp", "=", "ptype", "-", ">", "callbacks", ".", "gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "ptype", "-", ">", "callbacks", ".", "gro_receive", ",", "head", ",", "skb", ")", ";", "out_unlock", ":", "rcu_read_unlock", "(", ");", "@", "@", "-", "1391", ",", "7", "+", "1391", ",", "7", "@", "@", "struct", "sk_buff", "*", "*", "inet_gro_receive", "(", "struct", "sk_buff", "*", "*", "head", ",", "struct", "sk_buff", "*", "skb", ")", "skb_gro_pull", "(", "skb", ",", "sizeof", "(", "*", "iph", ")", ");", "skb_set_transport_header", "(", "skb", ",", "skb_gro_offset", "(", "skb", ")", ");", "pp", "=", "ops", "-", ">", "callbacks", ".", "gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "ops", "-", ">", "callbacks", ".", "gro_receive", ",", "head", ",", "skb", ")", ";", "out_unlock", ":", "rcu_read_unlock", "(", ");", "@", "@", "-", "249", ",", "7", "+", "249", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "*", "fou_gro_receive", "(", "struct", "sock", "*", "sk", ",", "if", "(", "!", "ops", "|", "|", "!", "ops", "-", ">", "callbacks", ".", "gro_receive", ")", "goto", "out_unlock", ";", "pp", "=", "ops", "-", ">", "callbacks", ".", "gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "ops", "-", ">", "callbacks", ".", "gro_receive", ",", "head", ",", "skb", ")", ";", "out_unlock", ":", "rcu_read_unlock", "(", ");", "@", "@", "-", "441", ",", "7", "+", "441", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "*", "gue_gro_receive", "(", "struct", "sock", "*", "sk", ",", "if", "(", "WARN_ON_ONCE", "(", "!", "ops", "|", "|", "!", "ops", "-", ">", "callbacks", ".", "gro_receive", ")", ")", "goto", "out_unlock", ";", "pp", "=", "ops", "-", ">", "callbacks", ".", "gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "ops", "-", ">", "callbacks", ".", "gro_receive", ",", "head", ",", "skb", ")", ";", "flush", "=", "0", ";", "out_unlock", ":", "@", "@", "-", "229", ",", "7", "+", "229", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "*", "gre_gro_receive", "(", "struct", "sk_buff", "*", "*", "head", ",", "/", "*", "Adjusted", "NAPI_GRO_CB", "(", "skb", ")", "->", "csum", "after", "skb_gro_pull", "(", ")*", "/", "skb_gro_postpull_rcsum", "(", "skb", ",", "greh", ",", "grehlen", ")", ";", "pp", "=", "ptype", "-", ">", "callbacks", ".", "gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "ptype", "-", ">", "callbacks", ".", "gro_receive", ",", "head", ",", "skb", ")", ";", "flush", "=", "0", ";", "out_unlock", ":", "@", "@", "-", "295", ",", "7", "+", "295", ",", "7", "@", "@", "struct", "sk_buff", "*", "*", "udp_gro_receive", "(", "struct", "sk_buff", "*", "*", "head", ",", "struct", "sk_buff", "*", "skb", ",", "skb_gro_pull", "(", "skb", ",", "sizeof", "(", "struct", "udphdr", ")", ");", "/", "*", "pull", "encapsulating", "udp", "header", "*", "/", "skb_gro_postpull_rcsum", "(", "skb", ",", "uh", ",", "sizeof", "(", "struct", "udphdr", ")", ");", "pp", "=", "udp_sk", "(", "sk", ")", "->", "gro_receive", "(", "sk", ",", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive_sk", "(", "udp_sk", "(", "sk", ")", "->", "gro_receive", ",", "sk", ",", "head", ",", "skb", ")", ";", "out_unlock", ":", "rcu_read_unlock", "(", ");", "@", "@", "-", "246", ",", "7", "+", "246", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "*", "ipv6_gro_receive", "(", "struct", "sk_buff", "*", "*", "head", ",", "skb_gro_postpull_rcsum", "(", "skb", ",", "iph", ",", "nlen", ")", ";", "pp", "=", "ops", "-", ">", "callbacks", ".", "gro_receive", "(", "head", ",", "skb", ")", ";", "pp", "=", "call_gro_receive", "(", "ops", "-", ">", "callbacks", ".", "gro_receive", ",", "head", ",", "skb", ")", ";", "out_unlock", ":", "rcu_read_unlock", "(", ");"], "docstring_tokens": ["stack", "corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "151", ",", "13", "+", "151", ",", "19", "@", "@", "static", "long", "ec_device_ioctl_xcmd", "(", "struct", "cros_ec_dev", "*", "ec", ",", "void", "__user", "*", "arg", ")", "goto", "exit", ";", "}", "if", "(", "u_cmd", ".", "outsize", "!", "=", "s_cmd", "-", ">", "outsize", "|", "|", "u_cmd", ".", "insize", "!", "=", "s_cmd", "-", ">", "insize", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "exit", ";", "}", "s_cmd", "-", ">", "command", "+", "=", "ec", "-", ">", "cmd_offset", ";", "ret", "=", "cros_ec_cmd_xfer", "(", "ec", "-", ">", "ec_dev", ",", "s_cmd", ")", ";", "/", "*", "Only", "copy", "data", "to", "userland", "if", "data", "was", "received", ".", "*", "/", "if", "(", "ret", "<", "0", ")", "goto", "exit", ";", "if", "(", "copy_to_user", "(", "arg", ",", "s_cmd", ",", "sizeof", "(", "*", "s_cmd", ")", "+", "u_cmd", ".", "insize", ")", ")", "if", "(", "copy_to_user", "(", "arg", ",", "s_cmd", ",", "sizeof", "(", "*", "s_cmd", ")", "+", "s_cmd", "-", ">", "insize", ")", ")", "ret", "=", "-", "EFAULT", ";", "exit", ":", "kfree", "(", "s_cmd", ")", ";"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "9", "@", "@", "Changes", "log", "=", "==", "==", "==", "==", "==", "@", "version", "-", "full", "@", "(", "@", "release", "-", "date", "@", ")", "-", "Bugs", "fixed", "-", "XEE", "injection", "security", "in", "XML", "extension", ".", "Reported", "by", "Man", "Yue", "Mo", ".", "-", "2", ".", "3", ".", "11", "(", "09", "/", "28", "/", "2017", ")", "-", "Bugs", "fixed", "@", "@", "-", "370", ",", "7", "+", "370", ",", "10", "@", "@", "protected", "DocumentBuilder", "getDocumentBuilder", "(", ")", "throws", "IOException", "{", "dbf", ".", "setNamespaceAware", "(", "isNamespaceAware", "(", "))", ";", "dbf", ".", "setValidating", "(", "isValidatingDtd", "(", "))", ";", "dbf", ".", "setCoalescing", "(", "isCoalescing", "(", "))", ";", "dbf", ".", "setExpandEntityReferences", "(", "isExpandingEntityRefs", "(", "))", ";", "dbf", ".", "setExpandEntityReferences", "(", "false", ")", ";", "dbf", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ",", "isExpandingEntityRefs", "(", "))", ";", "dbf", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isExpandingEntityRefs", "(", "))", ";", "dbf", ".", "setIgnoringComments", "(", "isIgnoringComments", "(", "))", ";", "dbf", ".", "setIgnoringElementContentWhitespace", "(", "isIgnoringExtraWhitespaces", "(", "))", ";"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "296", ",", "12", "+", "296", ",", "16", "@", "@", "void", "recycle", "(", ")", "{", "void", "nextRequest", "(", ")", "{", "request", ".", "recycle", "(", ");", "/", "/", "Copy", "leftover", "bytes", "to", "the", "beginning", "of", "the", "buffer", "if", "(", "byteBuffer", ".", "remaining", "(", ")", ">", "0", "&", "&", "byteBuffer", ".", "position", "(", ")", ">", "0", ")", "{", "byteBuffer", ".", "compact", "(", ");", "if", "(", "byteBuffer", ".", "position", "(", ")", ">", "0", ")", "{", "if", "(", "byteBuffer", ".", "remaining", "(", ")", ">", "0", ")", "{", "/", "/", "Copy", "leftover", "bytes", "to", "the", "beginning", "of", "the", "buffer", "byteBuffer", ".", "compact", "(", ");", "byteBuffer", ".", "flip", "(", ");", "}", "else", "{", "/", "/", "Reset", "position", "and", "limit", "to", "0", "byteBuffer", ".", "position", "(", "0", ")", ".", "limit", "(", "0", ")", ";", "}", "}", "/", "/", "Always", "reset", "pos", "to", "zero", "byteBuffer", ".", "limit", "(", "byteBuffer", ".", "limit", "(", ")", "-", "byteBuffer", ".", "position", "(", "))", ".", "position", "(", "0", ")", ";", "/", "/", "Recycle", "filters", "for", "(", "int", "i", "=", "0", ";", "i", "<", "=", "lastActiveFilter", ";", "i", "+", "+)", "{", "@", "@", "-", "83", ",", "6", "+", "83", ",", "11", "@", "@", "when", "configured", "with", "an", "address", "of", "<", "code", ">", "0", ".", "0", ".", "0", ".", "0", "<", "/", "code", ">", "or", "<", "code", ">", "::", "</", "code", ">", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Correct", "a", "regression", "in", "the", "refactoring", "to", "make", "wider", "use", "of", "<", "code", ">", "ByteBuffer", "<", "/", "code", ">", "that", "caused", "an", "intermittent", "failure", "in", "the", "unit", "tests", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Web", "Applications", "\"", ">"], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "257", ",", "6", "+", "257", ",", "7", "@", "@", "static", "unsigned", "int", "ipv6_conntrack_in", "(", "unsigned", "int", "hooknum", ",", "}", "nf_conntrack_get", "(", "reasm", "-", ">", "nfct", ")", ";", "(", "*", "pskb", ")", "->", "nfct", "=", "reasm", "-", ">", "nfct", ";", "(", "*", "pskb", ")", "->", "nfctinfo", "=", "reasm", "-", ">", "nfctinfo", ";", "return", "NF_ACCEPT", ";", "}"], "docstring_tokens": ["unauthorized", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "16", ",", "8", "+", "16", ",", "10", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "solr", ".", "request", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "java", ".", "io", ".", "Closeable", ";", "import", "java", ".", "lang", ".", "invoke", ".", "MethodHandles", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "40", ",", "6", "+", "42", ",", "7", "@", "@", "protected", "SolrQueryRequest", "req", ";", "protected", "SolrQueryResponse", "rsp", ";", "protected", "Date", "now", ";", "protected", "HttpServletRequest", "httpRequest", ";", "protected", "TimeZone", "tz", ";", "protected", "ResponseBuilder", "rb", ";", "protected", "List", "<", "Closeable", ">", "closeHooks", ";", "@", "@", "-", "83", ",", "6", "+", "86", ",", "17", "@", "@", "public", "SolrRequestInfo", "(", "SolrQueryRequest", "req", ",", "SolrQueryResponse", "rsp", ")", "{", "this", ".", "req", "=", "req", ";", "this", ".", "rsp", "=", "rsp", ";", "}", "public", "SolrRequestInfo", "(", "HttpServletRequest", "httpReq", ",", "SolrQueryResponse", "rsp", ")", "{", "this", ".", "httpRequest", "=", "httpReq", ";", "this", ".", "rsp", "=", "rsp", ";", "}", "public", "Principal", "getUserPrincipal", "(", ")", "{", "if", "(", "req", "!", "=", "null", ")", "return", "req", ".", "getUserPrincipal", "(", ");", "if", "(", "httpRequest", "!", "=", "null", ")", "return", "httpRequest", ".", "getUserPrincipal", "(", ");", "return", "null", ";", "}", "public", "Date", "getNOW", "(", ")", "{", "if", "(", "now", "!", "=", "null", ")", "return", "now", ";", "@", "@", "-", "248", ",", "7", "+", "248", ",", "7", "@", "@", "void", "setHeader", "(", "HttpRequest", "httpRequest", ")", "{", "SolrRequestInfo", "reqInfo", "=", "getRequestInfo", "(", ");", "String", "usr", ";", "if", "(", "reqInfo", "!", "=", "null", ")", "{", "Principal", "principal", "=", "reqInfo", ".", "getReq", "(", ").", "getUserPrincipal", "(", ");", "Principal", "principal", "=", "reqInfo", ".", "getUserPrincipal", "(", ");", "if", "(", "principal", "=", "=", "null", ")", "{", "/", "/", "this", "had", "a", "request", "but", "not", "authenticated", "/", "/", "so", "we", "don", "'", "t", "not", "need", "to", "set", "a", "principal", "@", "@", "-", "496", ",", "7", "+", "496", ",", "7", "@", "@", "public", "Action", "call", "(", ")", "throws", "IOException", "{", "handleAdminRequest", "(", ");", "return", "RETURN", ";", "case", "REMOTEQUERY", ":", "SolrRequestInfo", ".", "setRequestInfo", "(", "new", "SolrRequestInfo", "(", "solrReq", ",", "new", "SolrQueryResponse", "(", "))", ");", "SolrRequestInfo", ".", "setRequestInfo", "(", "new", "SolrRequestInfo", "(", "req", ",", "new", "SolrQueryResponse", "(", "))", ");", "remoteQuery", "(", "coreUrl", "+", "path", ",", "resp", ")", ";", "return", "RETURN", ";", "case", "PROCESS", ":", "@", "@", "-", "335", ",", "7", "+", "335", ",", "6", "@", "@", "public", "void", "testProxyNullProxyUser", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "@", "AwaitsFix", "(", "bugUrl", "=", "\"", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SOLR", "-", "13098", "\"", ")", "public", "void", "testForwarding", "(", ")", "throws", "Exception", "{", "String", "collectionName", "=", "\"", "forwardingCollection", "\"", ";", "miniCluster", ".", "uploadConfigSet", "(", "TEST_PATH", "(", ").", "resolve", "(", "\"", "collection1", "/", "conf", "\"", "),", "\"", "conf1", "\"", ");", "@", "@", "-", "230", ",", "12", "+", "230", ",", "11", "@", "@", "public", "void", "testBasicAuth", "(", ")", "throws", "Exception", "{", "/", "/", "Make", "a", "request", "to", "that", "jetty", "and", "it", "should", "fail", "JettySolrRunner", "aNewJetty", "=", "cluster", ".", "startJettySolrRunner", "(", ");", "SolrClient", "aNewClient", "=", "aNewJetty", ".", "newClient", "(", ");", "UpdateRequest", "delQuery", "=", "null", ";", "delQuery", "=", "new", "UpdateRequest", "(", ").", "deleteByQuery", "(", "\"*", ":*", "\")", ";", "delQuery", ".", "setBasicAuthCredentials", "(", "\"", "harry", "\"", ",\"", "HarryIsUberCool", "\"", ");", "delQuery", ".", "process", "(", "aNewClient", ",", "COLLECTION", ")", ";/", "/", "this", "should", "succeed", "try", "{", "UpdateRequest", "delQuery", "=", "null", ";", "delQuery", "=", "new", "UpdateRequest", "(", ").", "deleteByQuery", "(", "\"*", ":*", "\")", ";", "delQuery", ".", "setBasicAuthCredentials", "(", "\"", "harry", "\"", ",\"", "HarryIsUberCool", "\"", ");", "delQuery", ".", "process", "(", "aNewClient", ",", "COLLECTION", ")", ";/", "/", "this", "should", "succeed", "delQuery", "=", "new", "UpdateRequest", "(", ").", "deleteByQuery", "(", "\"*", ":*", "\")", ";", "delQuery", ".", "process", "(", "aNewClient", ",", "COLLECTION", ")", ";", "fail", "(", "\"", "This", "should", "not", "have", "succeeded", "without", "credentials", "\"", ");"], "docstring_tokens": ["bug", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "193", ",", "9", "+", "193", ",", "30", "@", "@", "void", "f2fs_inode_chksum_set", "(", "struct", "f2fs_sb_info", "*", "sbi", ",", "struct", "page", "*", "page", ")", "ri", "-", ">", "i_inode_checksum", "=", "cpu_to_le32", "(", "f2fs_inode_chksum", "(", "sbi", ",", "page", ")", ");", "}", "static", "bool", "sanity_check_inode", "(", "struct", "inode", "*", "inode", ")", "static", "bool", "sanity_check_inode", "(", "struct", "inode", "*", "inode", ",", "struct", "page", "*", "node_page", ")", "{", "struct", "f2fs_sb_info", "*", "sbi", "=", "F2FS_I_SB", "(", "inode", ")", ";", "unsigned", "long", "long", "iblocks", ";", "iblocks", "=", "le64_to_cpu", "(", "F2FS_INODE", "(", "node_page", ")", "->", "i_blocks", ")", ";", "if", "(", "!", "iblocks", ")", "{", "set_sbi_flag", "(", "sbi", ",", "SBI_NEED_FSCK", ")", ";", "f2fs_msg", "(", "sbi", "-", ">", "sb", ",", "KERN_WARNING", ",", "\"", "%", "s", ":", "corrupted", "inode", "i_blocks", "i_ino", "=", "%", "lx", "iblocks", "=", "%", "llu", ",", "\"", "\"", "run", "fsck", "to", "fix", ".", "\",", "__func__", ",", "inode", "-", ">", "i_ino", ",", "iblocks", ")", ";", "return", "false", ";", "}", "if", "(", "ino_of_node", "(", "node_page", ")", "!", "=", "nid_of_node", "(", "node_page", ")", ")", "{", "set_sbi_flag", "(", "sbi", ",", "SBI_NEED_FSCK", ")", ";", "f2fs_msg", "(", "sbi", "-", ">", "sb", ",", "KERN_WARNING", ",", "\"", "%", "s", ":", "corrupted", "inode", "footer", "i_ino", "=", "%", "lx", ",", "ino", ",", "nid", ":", "\"", "\"", "[%", "u", ",", "%", "u", "]", "run", "fsck", "to", "fix", ".", "\",", "__func__", ",", "inode", "-", ">", "i_ino", ",", "ino_of_node", "(", "node_page", ")", ",", "nid_of_node", "(", "node_page", ")", ");", "return", "false", ";", "}", "if", "(", "f2fs_sb_has_flexible_inline_xattr", "(", "sbi", "-", ">", "sb", ")", "&", "&", "!", "f2fs_has_extra_attr", "(", "inode", ")", ")", "{", "@", "@", "-", "267", ",", "7", "+", "288", ",", "7", "@", "@", "static", "int", "do_read_inode", "(", "struct", "inode", "*", "inode", ")", "get_inline_info", "(", "inode", ",", "ri", ")", ";", "if", "(", "!", "sanity_check_inode", "(", "inode", ")", ")", "{", "if", "(", "!", "sanity_check_inode", "(", "inode", ",", "node_page", ")", ")", "{", "f2fs_put_page", "(", "node_page", ",", "1", ")", ";", "return", "-", "EINVAL", ";", "}"], "docstring_tokens": ["out-of-bounds", "memory", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "162", ",", "25", "+", "162", ",", "25", "@", "@", "public", "ServiceMetadata", "buildServiceMetadata", "(", "Reader", "csdl", ")", "throws", "XMLStreamExcepti", "}", "public", "SchemaBasedEdmProvider", "buildEdmProvider", "(", "Reader", "csdl", ")", "throws", "XMLStreamException", "{", "XMLInputFactory", "xmlInputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "xmlInputFactory", "=", "createXmlInputFactory", "(", ");", "XMLEventReader", "reader", "=", "xmlInputFactory", ".", "createXMLEventReader", "(", "csdl", ")", ";", "return", "buildEdmProvider", "(", "reader", ",", "this", ".", "referenceResolver", ",", "this", ".", "implicitlyLoadCoreVocabularies", ",", "this", ".", "useLocalCoreVocabularies", ",", "true", ",", "null", ")", ";", "}", "public", "SchemaBasedEdmProvider", "addToEdmProvider", "(", "SchemaBasedEdmProvider", "existing", ",", "Reader", "csdl", ")", "throws", "XMLStreamException", "{", "XMLInputFactory", "xmlInputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "xmlInputFactory", "=", "createXmlInputFactory", "(", ");", "XMLEventReader", "reader", "=", "xmlInputFactory", ".", "createXMLEventReader", "(", "csdl", ")", ";", "return", "addToEdmProvider", "(", "existing", ",", "reader", ",", "this", ".", "referenceResolver", ",", "this", ".", "implicitlyLoadCoreVocabularies", ",", "this", ".", "useLocalCoreVocabularies", ",", "true", ",", "null", ")", ";", "}", "protected", "SchemaBasedEdmProvider", "buildEdmProvider", "(", "Reader", "csdl", ",", "ReferenceResolver", "resolver", ",", "boolean", "loadCore", ",", "boolean", "useLocal", ",", "boolean", "loadReferenceSchemas", ",", "String", "namespace", ")", "throws", "XMLStreamException", "{", "XMLInputFactory", "xmlInputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "xmlInputFactory", "=", "createXmlInputFactory", "(", ");", "XMLEventReader", "reader", "=", "xmlInputFactory", ".", "createXMLEventReader", "(", "csdl", ")", ";", "return", "buildEdmProvider", "(", "reader", ",", "resolver", ",", "loadCore", ",", "useLocal", ",", "loadReferenceSchemas", ",", "namespace", ")", ";", "}", "@", "@", "-", "189", ",", "7", "+", "189", ",", "7", "@", "@", "protected", "SchemaBasedEdmProvider", "buildEdmProvider", "(", "InputStream", "csdl", ",", "ReferenceRes", "boolean", "loadCore", ",", "boolean", "useLocal", ",", "boolean", "loadReferenceSchemas", ",", "String", "namespace", ")", "throws", "XMLStreamException", "{", "XMLInputFactory", "xmlInputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "XMLInputFactory", "xmlInputFactory", "=", "createXmlInputFactory", "(", ");", "XMLEventReader", "reader", "=", "xmlInputFactory", ".", "createXMLEventReader", "(", "csdl", ")", ";", "return", "buildEdmProvider", "(", "reader", ",", "resolver", ",", "loadCore", ",", "useLocal", ",", "loadReferenceSchemas", ",", "namespace", ")", ";", "}", "@", "@", "-", "249", ",", "8", "+", "249", ",", "15", "@", "@", "void", "build", "(", "XMLEventReader", "reader", ",", "StartElement", "element", ",", "SchemaBasedEdmProvider", "p", ":", "fixXmlBase", "(", "xmlBase", ".", "toString", "(", "))", ",", "resolver", ",", "loadCore", ",", "useLocal", ")", ";", "}", "return", "provider", ";", "}", "}", "private", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "XMLInputFactory", "factory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "factory", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "false", ")", ";", "factory", ".", "setProperty", "(", "\"", "javax", ".", "xml", ".", "stream", ".", "isSupportingExternalEntities", "\"", ",", "false", ")", ";", "return", "factory", ";", "}", "private", "void", "loadReferencesSchemas", "(", "SchemaBasedEdmProvider", "provider", ",", "String", "xmlBase", ",", "ReferenceResolver", "resolver", ",", "boolean", "loadCore", ",", "boolean", "useLocal", ")", "{", "@", "@", "-", "94", ",", "6", "+", "94", ",", "8", "@", "@", "public", "void", "setMetadata", "(", "ServiceMetadata", "metadata", ")", "{", "}", "protected", "XMLEventReader", "getReader", "(", "final", "InputStream", "input", ")", "throws", "XMLStreamException", "{", "FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "false", ")", ";", "FACTORY", ".", "setProperty", "(", "\"", "javax", ".", "xml", ".", "stream", ".", "isSupportingExternalEntities", "\"", ",", "false", ")", ";", "return", "FACTORY", ".", "createXMLEventReader", "(", "input", ")", ";", "}"], "docstring_tokens": ["xml", "external", "entity", "resolution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "100", ",", "13", "+", "100", ",", "13", "@", "@", "public", "NettyOutbound", "send", "(", "Publisher", "<", "?", "extends", "ByteBuf", ">", "source", ")", "{", "if", "(", "source", "instanceof", "Mono", ")", "{", "return", "new", "PostHeadersNettyOutbound", "(", "((", "Mono", "<", "ByteBuf", ">", ")", "source", ")", ".", "flatMap", "(", "msg", "-", ">", "{", "if", "(", "markSentHeaderAndBody", "(", "))", "{", "if", "(", "markSentHeaderAndBody", "(", "msg", ")", ")", "{", "try", "{", "preSendHeadersAndStatus", "(", ");", "afterMarkSentHeaders", "(", ");", "}", "catch", "(", "RuntimeException", "e", ")", "{", "ReferenceCountUtil", ".", "release", "(", "msg", ")", ";", "throw", "e", ";", "return", "Mono", ".", "error", "(", "e", ")", ";", "}", "if", "(", "HttpUtil", ".", "getContentLength", "(", "outboundHttpMessage", "(", "),", "-", "1", ")", "=", "=", "0", ")", "{", "log", ".", "debug", "(", "format", "(", "channel", "(", "),", "\"", "Dropped", "HTTP", "content", ",", "\"", "+", "@", "@", "-", "130", ",", "9", "+", "130", ",", "9", "@", "@", "public", "NettyOutbound", "sendObject", "(", "Object", "message", ")", "{", "}", "ByteBuf", "b", "=", "(", "ByteBuf", ")", "message", ";", "return", "new", "PostHeadersNettyOutbound", "(", "FutureMono", ".", "deferFuture", "(", "()", "-", ">", "{", "if", "(", "markSentHeaderAndBody", "(", "))", "{", "if", "(", "markSentHeaderAndBody", "(", "b", ")", ")", "{", "try", "{", "preSendHeadersAndStatus", "(", ");", "afterMarkSentHeaders", "(", ");", "}", "catch", "(", "RuntimeException", "e", ")", "{", "b", ".", "release", "(", ");", "@", "@", "-", "161", ",", "7", "+", "161", ",", "7", "@", "@", "public", "NettyOutbound", "sendObject", "(", "Object", "message", ")", "{", "}", "return", "FutureMono", ".", "deferFuture", "(", "()", "-", ">", "{", "if", "(", "markSentHeaders", "(", "))", "{", "if", "(", "markSentHeaders", "(", "outboundHttpMessage", "(", "))", ")", "{", "HttpMessage", "msg", ";", "if", "(", "HttpUtil", ".", "isContentLengthSet", "(", "outboundHttpMessage", "(", "))", ")", "{", "@", "@", "-", "180", ",", "7", "+", "180", ",", "7", "@", "@", "public", "NettyOutbound", "sendObject", "(", "Object", "message", ")", "{", "}", "try", "{", "preSendHeadersAndStatus", "(", ");", "afterMarkSentHeaders", "(", ");", "}", "catch", "(", "RuntimeException", "e", ")", "{", "ReferenceCountUtil", ".", "release", "(", "msg", ")", ";", "@", "@", "-", "195", ",", "7", "+", "195", ",", "9", "@", "@", "public", "NettyOutbound", "sendObject", "(", "Object", "message", ")", "{", "}", ");", "}", "protected", "abstract", "void", "preSendHeadersAndStatus", "(", ");", "protected", "abstract", "void", "beforeMarkSentHeaders", "(", ");", "protected", "abstract", "void", "afterMarkSentHeaders", "(", ");", "protected", "abstract", "HttpMessage", "newFullBodyMessage", "(", "ByteBuf", "body", ")", ";", "@", "@", "-", "268", ",", "7", "+", "270", ",", "23", "@", "@", "static", "void", "autoAddHttpExtractor", "(", "Connection", "c", ",", "String", "name", ",", "ChannelHandler", "handl", "*", "*", "@", "return", "true", "if", "marked", "for", "the", "first", "time", "*", "/", "protected", "final", "boolean", "markSentHeaders", "(", ")", "{", "protected", "final", "boolean", "markSentHeaders", "(", "Object", ".", "..", "objectsToRelease", ")", "{", "try", "{", "if", "(", "!", "hasSentHeaders", "(", "))", "{", "beforeMarkSentHeaders", "(", ");", "}", "}", "catch", "(", "RuntimeException", "e", ")", "{", "for", "(", "Object", "o", ":", "objectsToRelease", ")", "{", "try", "{", "ReferenceCountUtil", ".", "release", "(", "o", ")", ";", "}", "catch", "(", "Throwable", "e2", ")", "{", "/", "/", "keep", "going", "}", "}", "throw", "e", ";", "}", "return", "HTTP_STATE", ".", "compareAndSet", "(", "this", ",", "READY", ",", "HEADERS_SENT", ")", ";", "}", "@", "@", "-", "286", ",", "7", "+", "304", ",", "23", "@", "@", "protected", "final", "boolean", "markSentBody", "(", ")", "{", "*", "*", "@", "return", "true", "if", "marked", "for", "the", "first", "time", "*", "/", "protected", "final", "boolean", "markSentHeaderAndBody", "(", ")", "{", "protected", "final", "boolean", "markSentHeaderAndBody", "(", "Object", ".", "..", "objectsToRelease", ")", "{", "try", "{", "if", "(", "!", "hasSentHeaders", "(", "))", "{", "beforeMarkSentHeaders", "(", ");", "}", "}", "catch", "(", "RuntimeException", "e", ")", "{", "for", "(", "Object", "o", ":", "objectsToRelease", ")", "{", "try", "{", "ReferenceCountUtil", ".", "release", "(", "o", ")", ";", "}", "catch", "(", "Throwable", "e2", ")", "{", "/", "/", "keep", "going", "}", "}", "throw", "e", ";", "}", "return", "HTTP_STATE", ".", "compareAndSet", "(", "this", ",", "READY", ",", "BODY_SENT", ")", ";", "}", "@", "@", "-", "142", ",", "6", "+", "142", ",", "12", "@", "@", "*", "Configure", "a", "body", "to", "send", "on", "request", "using", "the", "{", "@", "link", "NettyOutbound", "}", "sending", "*", "builder", "and", "returning", "a", "{", "@", "link", "Publisher", "}", "to", "signal", "end", "of", "the", "request", ".", "*", "*", "<", "p", ">", "<", "strong", ">", "Note", ":", "</", "strong", ">", "the", "sender", "{", "@", "code", "BiFunction", "}", "passed", "in", "may", "implement", "*", "{", "@", "link", "RedirectSendHandler", "}", "to", "indicate", "explicitly", "that", "it", "has", "special", "handling", "*", "for", "redirect", "requests", ".", "This", "is", "entirely", "optional", ",", "and", "redirect", "request", "handling", "*", "may", "also", "be", "handled", "globally", "via", "{", "@", "link", "#", "followRedirect", "(", "boolean", ",", "Consumer", ")", "}", "or", "*", "{", "@", "link", "#", "followRedirect", "(", "BiPredicate", ",", "Consumer", ")", "}.", "*", "*", "@", "param", "sender", "a", "bifunction", "given", "the", "outgoing", "request", "and", "the", "sending", "*", "{", "@", "link", "NettyOutbound", "}", ",", "returns", "a", "publisher", "that", "will", "terminate", "the", "request", "*", "body", "on", "complete", "@", "@", "-", "313", ",", "6", "+", "319", ",", "20", "@", "@", "ByteBufFlux", "receive", "(", ");", "}", "/", "**", "*", "Marker", "interface", "for", "use", "with", "{", "@", "link", "RequestSender", "#", "send", "(", "BiFunction", ")", "}.", "*", "<", "p", ">", "When", "the", "{", "@", "code", "BiFunction", "}", "passed", "into", "{", "@", "code", "send", "}", "is", "an", "implementation", "of", "this", "*", "interface", ",", "it", "indicates", "it", "differentiates", "between", "original", "and", "redirect", "requests", ",", "*", "e", ".", "g", ".", "as", "a", "result", "of", "enabling", "{", "@", "link", "#", "followRedirect", "(", "boolean", ")", "},", "and", "is", "capable", "of", "*", "applying", "separate", "logic", "for", "each", "individually", ".", "Redirect", "scenarios", "may", "be", "detected", "*", "by", "checking", "{", "@", "link", "HttpClientRequest", "#", "redirectedFrom", "(", ")}", ".", "*", "<", "p", ">", "When", "the", "{", "@", "code", "BiFunction", "}", "passsed", "in", "is", "not", "an", "implementation", "of", "this", "interface", ",", "*", "it", "indicates", "it", "does", "not", "differentiate", "between", "original", "and", "redirect", "requests", ",", "and", "*", "applies", "the", "same", "initialization", "logic", ".", "*", "/", "public", "interface", "RedirectSendHandler", "extends", "BiFunction", "<", "HttpClientRequest", ",", "NettyOutbound", ",", "Publisher", "<", "Void", ">", ">", "{", "}", "/", "**", "*", "Prepare", "a", "pooled", "{", "@", "link", "HttpClient", "}", ".", "{", "@", "link", "UriConfiguration", "#", "uri", "(", "String", ")", "}", "or", "*", "{", "@", "link", "#", "baseUrl", "(", "String", ")", "}", "should", "be", "invoked", "before", "a", "verb", "@", "@", "-", "663", ",", "8", "+", "683", ",", "25", "@", "@", "public", "final", "HttpClient", "keepAlive", "(", "boolean", "keepAlive", ")", "{", "*", "@", "return", "a", "new", "{", "@", "link", "HttpClient", "}", "*", "/", "public", "final", "HttpClient", "followRedirect", "(", "boolean", "followRedirect", ")", "{", "return", "followRedirect", "(", "followRedirect", ",", "null", ")", ";", "}", "/", "**", "*", "Variant", "of", "{", "@", "link", "#", "followRedirect", "(", "boolean", ")", "}", "that", "also", "accepts", "a", "redirect", "request", "*", "processor", ".", "*", "*", "@", "param", "followRedirect", "if", "true", "HTTP", "status", "301", "|", "302", "|", "307", "|", "308", "auto", "-", "redirect", "support", "*", "is", "enabled", ",", "otherwise", "disabled", "(", "default", ":", "false", ")", ".", "*", "@", "param", "redirectRequestConsumer", "redirect", "request", "consumer", ",", "invoked", "on", "redirects", ",", "after", "*", "the", "redirect", "request", "has", "been", "initialized", ",", "in", "order", "to", "apply", "further", "changes", "such", "as", "*", "add", "/", "remove", "headers", "and", "cookies", ";", "use", "{", "@", "link", "HttpClientRequest", "#", "redirectedFrom", "(", ")}", "to", "*", "check", "the", "original", "and", "any", "number", "of", "subsequent", "redirect", "(", "s", ")", ",", "including", "the", "one", "that", "*", "is", "in", "progress", ".", "*", "@", "return", "a", "new", "{", "@", "link", "HttpClient", "}", "*", "/", "public", "final", "HttpClient", "followRedirect", "(", "boolean", "followRedirect", ",", "@", "Nullable", "Consumer", "<", "HttpClientRequest", ">", "redirectRequestConsumer", ")", "{", "if", "(", "followRedirect", ")", "{", "return", "tcpConfiguration", "(", "FOLLOW_REDIRECT_ATTR_CONFIG", ")", ";", "return", "followRedirect", "(", "HttpClientConfiguration", ".", "FOLLOW_REDIRECT_PREDICATE", ",", "redirectRequestConsumer", ")", ";", "}", "else", "{", "return", "tcpConfiguration", "(", "FOLLOW_REDIRECT_ATTR_DISABLE", ")", ";", "@", "@", "-", "683", ",", "9", "+", "720", ",", "26", "@", "@", "public", "final", "HttpClient", "followRedirect", "(", "boolean", "followRedirect", ")", "{", "*", "@", "return", "a", "new", "{", "@", "link", "HttpClient", "}", "*", "/", "public", "final", "HttpClient", "followRedirect", "(", "BiPredicate", "<", "HttpClientRequest", ",", "HttpClientResponse", ">", "predicate", ")", "{", "return", "followRedirect", "(", "predicate", ",", "null", ")", ";", "}", "/", "**", "*", "Variant", "of", "{", "@", "link", "#", "followRedirect", "(", "BiPredicate", ")", "}", "that", "also", "accepts", "a", "redirect", "request", "*", "processor", ".", "*", "*", "@", "param", "predicate", "that", "returns", "true", "to", "enable", "auto", "-", "redirect", "support", ".", "*", "@", "param", "redirectRequestConsumer", "redirect", "request", "consumer", ",", "invoked", "on", "redirects", ",", "after", "*", "the", "redirect", "request", "has", "been", "initialized", ",", "in", "order", "to", "apply", "further", "changes", "such", "as", "*", "add", "/", "remove", "headers", "and", "cookies", ";", "use", "{", "@", "link", "HttpClientRequest", "#", "redirectedFrom", "(", ")}", "to", "*", "check", "the", "original", "and", "any", "number", "of", "subsequent", "redirect", "(", "s", ")", ",", "including", "the", "one", "that", "*", "is", "in", "progress", ".", "*", "@", "return", "a", "new", "{", "@", "link", "HttpClient", "}", "*", "/", "public", "final", "HttpClient", "followRedirect", "(", "BiPredicate", "<", "HttpClientRequest", ",", "HttpClientResponse", ">", "predicate", ",", "@", "Nullable", "Consumer", "<", "HttpClientRequest", ">", "redirectRequestConsumer", ")", "{", "Objects", ".", "requireNonNull", "(", "predicate", ",", "\"", "predicate", "\"", ");", "return", "tcpConfiguration", "(", "tcp", "-", ">", "tcp", ".", "bootstrap", "(", "b", "-", ">", "HttpClientConfiguration", ".", "followRedirectPredicate", "(", "b", ",", "predicate", ")", "))", ";", "b", "-", ">", "HttpClientConfiguration", ".", "followRedirectPredicate", "(", "b", ",", "predicate", ",", "redirectRequestConsumer", ")", "))", ";", "}", "/", "**", "@", "@", "-", "952", ",", "9", "+", "1006", ",", "6", "@", "@", "static", "String", "reactorNettyVersion", "(", ")", "{", "static", "final", "Function", "<", "TcpClient", ",", "TcpClient", ">", "CHUNKED_ATTR_DISABLE", "=", "tcp", "-", ">", "tcp", ".", "bootstrap", "(", "HttpClientConfiguration", ".", "MAP_NO_CHUNKED", ")", ";", "static", "final", "Function", "<", "TcpClient", ",", "TcpClient", ">", "FOLLOW_REDIRECT_ATTR_CONFIG", "=", "tcp", "-", ">", "tcp", ".", "bootstrap", "(", "HttpClientConfiguration", ".", "MAP_REDIRECT", ")", ";", "static", "final", "Function", "<", "TcpClient", ",", "TcpClient", ">", "FOLLOW_REDIRECT_ATTR_DISABLE", "=", "tcp", "-", ">", "tcp", ".", "bootstrap", "(", "HttpClientConfiguration", ".", "MAP_NO_REDIRECT", ")", ";", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "import", "java", ".", "util", ".", "function", ".", "BiFunction", ";", "import", "java", ".", "util", ".", "function", ".", "BiPredicate", ";", "import", "java", ".", "util", ".", "function", ".", "Consumer", ";", "import", "java", ".", "util", ".", "function", ".", "Function", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "@", "@", "-", "61", ",", "6", "+", "62", ",", "7", "@", "@", "ClientCookieDecoder", "cookieDecoder", "=", "ClientCookieDecoder", ".", "STRICT", ";", "BiPredicate", "<", "HttpClientRequest", ",", "HttpClientResponse", ">", "followRedirectPredicate", "=", "null", ";", "Consumer", "<", "HttpClientRequest", ">", "redirectRequestConsumer", "=", "null", ";", "Function", "<", "Mono", "<", "HttpClientConfiguration", ">", ",", "Mono", "<", "HttpClientConfiguration", ">", ">", "deferredConf", "=", "null", ";", "@", "@", "-", "77", ",", "6", "+", "79", ",", "7", "@", "@", "this", ".", "cookieDecoder", "=", "from", ".", "cookieDecoder", ";", "this", ".", "decoder", "=", "from", ".", "decoder", ";", "this", ".", "followRedirectPredicate", "=", "from", ".", "followRedirectPredicate", ";", "this", ".", "redirectRequestConsumer", "=", "from", ".", "redirectRequestConsumer", ";", "this", ".", "chunkedTransfer", "=", "from", ".", "chunkedTransfer", ";", "this", ".", "baseUrl", "=", "from", ".", "baseUrl", ";", "this", ".", "headers", "=", "from", ".", "headers", ";", "@", "@", "-", "176", ",", "13", "+", "179", ",", "11", "@", "@", "static", "HttpClientConfiguration", "get", "(", "Bootstrap", "b", ")", "{", "(", "req", ",", "res", ")", "-", ">", "FOLLOW_REDIRECT_CODES", ".", "matcher", "(", "res", ".", "status", "(", ")", ".", "codeAsText", "(", "))", ".", "matches", "(", ");", "static", "final", "Function", "<", "Bootstrap", ",", "Bootstrap", ">", "MAP_REDIRECT", "=", "b", "-", ">", "{", "getOrCreate", "(", "b", ")", ".", "followRedirectPredicate", "=", "FOLLOW_REDIRECT_PREDICATE", ";", "return", "b", ";", "}", ";", "static", "final", "Function", "<", "Bootstrap", ",", "Bootstrap", ">", "MAP_NO_REDIRECT", "=", "b", "-", ">", "{", "getOrCreate", "(", "b", ")", ".", "followRedirectPredicate", "=", "null", ";", "HttpClientConfiguration", "conf", "=", "getOrCreate", "(", "b", ")", ";", "conf", ".", "followRedirectPredicate", "=", "null", ";", "conf", ".", "redirectRequestConsumer", "=", "null", ";", "return", "b", ";", "}", ";", "@", "@", "-", "281", ",", "8", "+", "282", ",", "11", "@", "@", "static", "Bootstrap", "cookieCodec", "(", "Bootstrap", "b", ",", "ClientCookieEncoder", "encoder", ",", "ClientCoo", "return", "b", ";", "}", "static", "Bootstrap", "followRedirectPredicate", "(", "Bootstrap", "b", ",", "BiPredicate", "<", "HttpClientRequest", ",", "HttpClientResponse", ">", "predicate", ")", "{", "getOrCreate", "(", "b", ")", ".", "followRedirectPredicate", "=", "predicate", ";", "static", "Bootstrap", "followRedirectPredicate", "(", "Bootstrap", "b", ",", "BiPredicate", "<", "HttpClientRequest", ",", "HttpClientResponse", ">", "predicate", ",", "@", "Nullable", "Consumer", "<", "HttpClientRequest", ">", "redirectRequestConsumer", ")", "{", "HttpClientConfiguration", "conf", "=", "getOrCreate", "(", "b", ")", ";", "conf", ".", "followRedirectPredicate", "=", "predicate", ";", "conf", ".", "redirectRequestConsumer", "=", "redirectRequestConsumer", ";", "return", "b", ";", "}", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "util", ".", "function", ".", "BiConsumer", ";", "import", "java", ".", "util", ".", "function", ".", "BiFunction", ";", "import", "java", ".", "util", ".", "function", ".", "BiPredicate", ";", "import", "java", ".", "util", ".", "function", ".", "Consumer", ";", "import", "java", ".", "util", ".", "function", ".", "Predicate", ";", "import", "java", ".", "util", ".", "function", ".", "Supplier", ";", "import", "javax", ".", "annotation", ".", "Nullable", ";", "@", "@", "-", "457", ",", "6", "+", "458", ",", "8", "@", "@", "public", "void", "onStateChange", "(", "Connection", "connection", ",", "State", "newState", ")", "{", "final", "ClientCookieDecoder", "cookieDecoder", ";", "final", "BiPredicate", "<", "HttpClientRequest", ",", "HttpClientResponse", ">", "followRedirectPredicate", ";", "final", "Consumer", "<", "HttpClientRequest", ">", "redirectRequestConsumer", ";", "final", "HttpResponseDecoderSpec", "decoder", ";", "final", "ProxyProvider", "proxyProvider", ";", "@", "@", "-", "471", ",", "6", "+", "474", ",", "7", "@", "@", "public", "void", "onStateChange", "(", "Connection", "connection", ",", "State", "newState", ")", "{", "this", ".", "method", "=", "configuration", ".", "method", ";", "this", ".", "compress", "=", "configuration", ".", "acceptGzip", ";", "this", ".", "followRedirectPredicate", "=", "configuration", ".", "followRedirectPredicate", ";", "this", ".", "redirectRequestConsumer", "=", "configuration", ".", "redirectRequestConsumer", ";", "this", ".", "chunkedTransfer", "=", "configuration", ".", "chunkedTransfer", ";", "this", ".", "cookieEncoder", "=", "configuration", ".", "cookieEncoder", ";", "this", ".", "cookieDecoder", "=", "configuration", ".", "cookieDecoder", ";", "@", "@", "-", "551", ",", "14", "+", "555", ",", "6", "@", "@", "public", "SocketAddress", "get", "(", ")", "{", "headers", ".", "set", "(", "HttpHeaderNames", ".", "USER_AGENT", ",", "USER_AGENT", ")", ";", "}", "if", "(", "fromURI", "!", "=", "null", "&", "&", "!", "toURI", ".", "equals", "(", "fromURI", ")", ")", "{", "headers", ".", "remove", "(", "HttpHeaderNames", ".", "HOST", ")", ".", "remove", "(", "HttpHeaderNames", ".", "EXPECT", ")", ".", "remove", "(", "HttpHeaderNames", ".", "COOKIE", ")", ".", "remove", "(", "HttpHeaderNames", ".", "AUTHORIZATION", ")", ".", "remove", "(", "HttpHeaderNames", ".", "PROXY_AUTHORIZATION", ")", ";", "}", "SocketAddress", "remoteAddress", "=", "uri", ".", "getRemoteAddress", "(", ");", "if", "(", "!", "headers", ".", "contains", "(", "HttpHeaderNames", ".", "HOST", ")", "&", "&", "remoteAddress", "instanceof", "InetSocketAddress", ")", "{", "headers", ".", "set", "(", "HttpHeaderNames", ".", "HOST", ",", "@", "@", "-", "583", ",", "23", "+", "579", ",", "38", "@", "@", "public", "SocketAddress", "get", "(", ")", "{", "ch", ".", "chunkedTransfer", "(", "chunkedTransfer", ")", ";", "}", "if", "(", "handler", "!", "=", "null", ")", "{", "if", "(", "websocketProtocols", "!", "=", "null", ")", "{", "return", "Mono", ".", "fromRunnable", "(", "()", "-", ">", "ch", ".", "withWebsocketSupport", "(", "websocketProtocols", ",", "maxFramePayloadLength", ",", "compress", ")", ")", ".", "thenEmpty", "(", "Mono", ".", "fromRunnable", "(", "()", "-", ">", "Flux", ".", "concat", "(", "handler", ".", "apply", "(", "ch", ",", "ch", ")", "))", ");", "}", "else", "{", "return", "handler", ".", "apply", "(", "ch", ",", "ch", ")", ";", "if", "(", "websocketProtocols", "!", "=", "null", ")", "{", "Mono", "<", "Void", ">", "result", "=", "Mono", ".", "fromRunnable", "(", "()", "-", ">", "ch", ".", "withWebsocketSupport", "(", "websocketProtocols", ",", "maxFramePayloadLength", ",", "compress", ")", ");", "if", "(", "handler", "!", "=", "null", ")", "{", "result", "=", "result", ".", "thenEmpty", "(", "Mono", ".", "fromRunnable", "(", "()", "-", ">", "Flux", ".", "concat", "(", "handler", ".", "apply", "(", "ch", ",", "ch", ")", "))", ");", "}", "return", "result", ";", "}", "else", "{", "if", "(", "websocketProtocols", "!", "=", "null", ")", "{", "return", "Mono", ".", "fromRunnable", "(", "()", "-", ">", "ch", ".", "withWebsocketSupport", "(", "websocketProtocols", ",", "maxFramePayloadLength", ",", "compress", ")", ");", "Consumer", "<", "HttpClientRequest", ">", "consumer", "=", "null", ";", "if", "(", "fromURI", "!", "=", "null", "&", "&", "!", "toURI", ".", "equals", "(", "fromURI", ")", ")", "{", "if", "(", "handler", "instanceof", "RedirectSendHandler", ")", "{", "headers", ".", "remove", "(", "HttpHeaderNames", ".", "EXPECT", ")", ".", "remove", "(", "HttpHeaderNames", ".", "COOKIE", ")", ".", "remove", "(", "HttpHeaderNames", ".", "AUTHORIZATION", ")", ".", "remove", "(", "HttpHeaderNames", ".", "PROXY_AUTHORIZATION", ")", ";", "}", "else", "{", "return", "ch", ".", "send", "(", ");", "consumer", "=", "request", "-", ">", "request", ".", "requestHeaders", "(", ")", ".", "remove", "(", "HttpHeaderNames", ".", "EXPECT", ")", ".", "remove", "(", "HttpHeaderNames", ".", "COOKIE", ")", ".", "remove", "(", "HttpHeaderNames", ".", "AUTHORIZATION", ")", ".", "remove", "(", "HttpHeaderNames", ".", "PROXY_AUTHORIZATION", ")", ";", "}", "}", "if", "(", "this", ".", "redirectRequestConsumer", "!", "=", "null", ")", "{", "consumer", "=", "consumer", "!", "=", "null", "?", "consumer", ".", "andThen", "(", "this", ".", "redirectRequestConsumer", ")", ":", "this", ".", "redirectRequestConsumer", ";", "}", "ch", ".", "redirectRequestConsumer", "(", "consumer", ")", ";", "return", "handler", "!", "=", "null", "?", "handler", ".", "apply", "(", "ch", ",", "ch", ")", ":", "ch", ".", "send", "(", ");", "}", "catch", "(", "Throwable", "t", ")", "{", "return", "Mono", ".", "error", "(", "t", ")", ";", "@", "@", "-", "104", ",", "6", "+", "104", ",", "7", "@", "@", "boolean", "started", ";", "BiPredicate", "<", "HttpClientRequest", ",", "HttpClientResponse", ">", "followRedirectPredicate", ";", "Consumer", "<", "HttpClientRequest", ">", "redirectRequestConsumer", ";", "HttpClientOperations", "(", "HttpClientOperations", "replaced", ")", "{", "super", "(", "replaced", ")", ";", "@", "@", "-", "234", ",", "6", "+", "235", ",", "10", "@", "@", "void", "followRedirectPredicate", "(", "BiPredicate", "<", "HttpClientRequest", ",", "HttpClientResponse", ">", "this", ".", "followRedirectPredicate", "=", "predicate", ";", "}", "void", "redirectRequestConsumer", "(", "@", "Nullable", "Consumer", "<", "HttpClientRequest", ">", "redirectRequestConsumer", ")", "{", "this", ".", "redirectRequestConsumer", "=", "redirectRequestConsumer", ";", "}", "@", "Override", "@", "SuppressWarnings", "(", "\"", "FutureReturnValueIgnored", "\"", ")", "protected", "void", "onInboundCancel", "(", ")", "{", "@", "@", "-", "353", ",", "7", "+", "358", ",", "7", "@", "@", "public", "NettyOutbound", "send", "(", "Publisher", "<", "?", "extends", "ByteBuf", ">", "source", ")", "{", ".", "collectList", "(", ")", ".", "doOnDiscard", "(", "ByteBuf", ".", "class", ",", "ByteBuf", ":", ":", "release", ")", ".", "flatMap", "(", "list", "-", ">", "{", "if", "(", "markSentHeaderAndBody", "(", "))", "{", "if", "(", "markSentHeaderAndBody", "(", "list", ".", "toArray", "(", "))", ")", "{", "if", "(", "list", ".", "isEmpty", "(", "))", "{", "return", "FutureMono", ".", "from", "(", "channel", "(", ").", "writeAndFlush", "(", "newFullBodyMessage", "(", "Unpooled", ".", "EMPTY_BUFFER", ")", "))", ";", "}", "@", "@", "-", "444", ",", "10", "+", "449", ",", "17", "@", "@", "else", "if", "(", "version", ".", "equals", "(", "HttpVersion", ".", "HTTP_1_1", ")", ")", "{", "}", "@", "Override", "protected", "void", "preSendHeadersAndStatus", "(", ")", "{", "protected", "void", "afterMarkSentHeaders", "(", ")", "{", "/", "/", "Noop", "}", "@", "Override", "protected", "void", "beforeMarkSentHeaders", "(", ")", "{", "if", "(", "redirectedFrom", ".", "length", ">", "0", "&", "&", "redirectRequestConsumer", "!", "=", "null", ")", "{", "redirectRequestConsumer", ".", "accept", "(", "this", ")", ";", "}", "}", "@", "Override", "@", "SuppressWarnings", "(", "\"", "FutureReturnValueIgnored", "\"", ")", "protected", "void", "onOutboundComplete", "(", ")", "{", "@", "@", "-", "502", ",", "7", "+", "502", ",", "7", "@", "@", "protected", "void", "onInboundNext", "(", "ChannelHandlerContext", "ctx", ",", "Object", "msg", ")", "{", "}", "@", "Override", "protected", "void", "preSendHeadersAndStatus", "(", "){", "protected", "void", "afterMarkSentHeaders", "(", "){", "if", "(", "HttpResponseStatus", ".", "NOT_MODIFIED", ".", "equals", "(", "status", "(", "))", ")", "{", "responseHeaders", ".", "remove", "(", "HttpHeaderNames", ".", "TRANSFER_ENCODING", ")", ".", "remove", "(", "HttpHeaderNames", ".", "CONTENT_LENGTH", ")", ";", "@", "@", "-", "512", ",", "6", "+", "512", ",", "11", "@", "@", "protected", "void", "preSendHeadersAndStatus", "(", "){", "}", "}", "@", "Override", "protected", "void", "beforeMarkSentHeaders", "(", ")", "{", "/", "/", "noop", "}", "@", "Override", "protected", "void", "onOutboundComplete", "(", ")", "{", "if", "(", "isWebsocket", "(", "))", "{"], "docstring_tokens": ["credentials", "leak"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "57", ",", "6", "+", "57", ",", "8", "@", "@", "USER_NOT_EXIST", "(", "4041", ")", ",/", "/\u5ba2", "\u6237\u7aef", "\u4e0d\u5b58", "\u5728", "STATE_ERROR", "(", "4042", ")", ",", "/", "/", "stat", "\u9519", "\u8bef", "ACCESS_DENIED", "(", "503", ")", ",", "/", "/\u8bbf", "\u95ee\u88ab", "\u62d2\u7edd", "OTHER", "(", "5001", ")", ",", "/", "/\u5176", "\u4ed6\u9519", "\u8bef", ";", "@", "@", "-", "20", ",", "12", "+", "20", ",", "14", "@", "@", "import", "io", ".", "swagger", ".", "annotations", ".", "Api", ";", "import", "io", ".", "swagger", ".", "annotations", ".", "ApiOperation", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "BusinessException", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "WebUtil", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "authorization", ".", "oauth2", ".", "client", ".", "OAuth2RequestService", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "authorization", ".", "oauth2", ".", "client", ".", "listener", ".", "OAuth2CodeAuthBeforeEvent", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "controller", ".", "message", ".", "ResponseMessage", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "entity", ".", "oauth2", ".", "client", ".", "OAuth2ServerConfigEntity", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "id", ".", "IDGenerator", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "oauth2", ".", "core", ".", "ErrorType", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "oauth2", ".", "core", ".", "OAuth2Constants", ";", "import", "org", ".", "hswebframework", ".", "web", ".", "service", ".", "oauth2", ".", "client", ".", "OAuth2ServerConfigService", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "@", "@", "-", "104", ",", "7", "+", "106", ",", "9", "@", "@", "public", "RedirectView", "callback", "(", "@", "RequestParam", "(", "defaultValue", "=", "\"", "/\"", ")", "String", "redirect", ",", "HttpSession", "session", ")", "throws", "UnsupportedEncodingException", "{", "try", "{", "String", "cachedState", "=", "(", "String", ")", "session", ".", "getAttribute", "(", "STATE_SESSION_KEY", ")", ";", "/", "/", "if", "(", "!", "state", ".", "equals", "(", "cachedState", ")", ")", "throw", "new", "BusinessException", "(", "\"", "state", "error", "\"", ");", "if", "(", "!", "state", ".", "equals", "(", "cachedState", ")", ")", "{", "throw", "new", "BusinessException", "(", "ErrorType", ".", "STATE_ERROR", ".", "name", "(", "))", ";", "}", "oAuth2RequestService", ".", "doEvent", "(", "serverId", ",", "new", "OAuth2CodeAuthBeforeEvent", "(", "code", ",", "state", ",", "request", ":", ":", "getParameter", ")", ");", "return", "new", "RedirectView", "(", "URLDecoder", ".", "decode", "(", "redirect", ",", "\"", "UTF", "-", "8", "\"", "))", ";", "}", "finally", "{"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "568", ",", "8", "+", "568", ",", "8", "@", "@", "cond_branch", ":", "f_offset", "=", "addrs", "[", "i", "+", "filter", "[", "i", "]", ".", "jf", "]", "-", "addrs", "[", "i", "]", ";", "break", ";", "}", "if", "(", "filter", "[", "i", "]", ".", "jt", "!", "=", "0", ")", "{", "if", "(", "filter", "[", "i", "]", ".", "jf", ")", "t_offset", "+", "=", "is_near", "(", "f_offset", ")", "?", "2", ":", "6", ";", "if", "(", "filter", "[", "i", "]", ".", "jf", "&", "&", "f_offset", ")", "t_offset", "+", "=", "is_near", "(", "f_offset", ")", "?", "2", ":", "5", ";", "EMIT_COND_JMP", "(", "t_op", ",", "t_offset", ")", ";", "if", "(", "filter", "[", "i", "]", ".", "jf", ")", "EMIT_JMP", "(", "f_offset", ")", ";"], "docstring_tokens": ["off-by-one", "error"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "230", ",", "15", "+", "230", ",", "15", "@", "@", "int", "bt_sock_recvmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "if", "(", "flags", "&", "(", "MSG_OOB", ")", ")", "return", "-", "EOPNOTSUPP", ";", "msg", "-", ">", "msg_namelen", "=", "0", ";", "skb", "=", "skb_recv_datagram", "(", "sk", ",", "flags", ",", "noblock", ",", "&", "err", ")", ";", "if", "(", "!", "skb", ")", "{", "if", "(", "sk", "-", ">", "sk_shutdown", "&", "RCV_SHUTDOWN", ")", "return", "0", ";", "return", "err", ";", "}", "msg", "-", ">", "msg_namelen", "=", "0", ";", "copied", "=", "skb", "-", ">", "len", ";", "if", "(", "len", "<", "copied", ")", "{", "msg", "-", ">", "msg_flags", "|", "=", "MSG_TRUNC", ";"], "docstring_tokens": ["info", "leaks"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2989", ",", "6", "+", "2989", ",", "7", "@", "@", "static", "int", "cm_sidr_req_handler", "(", "struct", "cm_work", "*", "work", ")", "goto", "out", ";", "/", "*", "No", "match", ".", "*", "/", "}", "atomic_inc", "(", "&", "cur_cm_id_priv", "-", ">", "refcount", ")", ";", "atomic_inc", "(", "&", "cm_id_priv", "-", ">", "refcount", ")", ";", "spin_unlock_irq", "(", "&", "cm", ".", "lock", ")", ";", "cm_id_priv", "-", ">", "id", ".", "cm_handler", "=", "cur_cm_id_priv", "-", ">", "id", ".", "cm_handler", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "173", ",", "7", "+", "173", ",", "7", "@", "@", "protected", "SchemaFactory", "createSchemaFactory", "(", ")", "{", "if", "(", "getResourceResolver", "(", ")", "!", "=", "null", ")", "{", "factory", ".", "setResourceResolver", "(", "getResourceResolver", "(", "))", ";", "}", "if", "(", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "if", "(", "camelContext", "!", "=", "null", "&", "&", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "factory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "511", ",", "7", "+", "511", ",", "7", "@", "@", "private", "void", "renderState", "(", "FacesContext", "context", ")", "throws", "IOException", "{", "if", "(", "null", "!", "=", "window", ")", "{", "String", "clientWindowId", "=", "Util", ".", "getClientWindowId", "(", "context", ")", ";", "writer", ".", "startUpdate", "(", "clientWindowId", ")", ";", "writer", ".", "write", "(", "window", ".", "getId", "(", "))", ";", "writer", ".", "writeText", "(", "window", ".", "getId", "(", "),", "null", ")", ";", "writer", ".", "endUpdate", "(", ");", "}", "}"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "119", ",", "6", "+", "119", ",", "12", "@", "@", "<", "artifactId", ">", "camel", "-", "quartz2", "<", "/", "artifactId", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "assertj", "<", "/", "groupId", ">", "<", "artifactId", ">", "assertj", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "${", "assertj", "-", "version", "}", "</", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "build", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "59", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "mail", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "javax", ".", "activation", ".", "DataSource", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "ObjectHelper", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "StringHelper", ";", "final", "class", "DelegatingDataSource", "implements", "DataSource", "{", "private", "final", "DataSource", "delegate", ";", "private", "final", "String", "name", ";", "public", "DelegatingDataSource", "(", "final", "String", "name", ",", "final", "DataSource", "delegate", ")", "{", "this", ".", "name", "=", "StringHelper", ".", "notEmpty", "(", "name", ",", "\"", "name", "\"", ");", "this", ".", "delegate", "=", "ObjectHelper", ".", "notNull", "(", "delegate", ",", "\"", "DataSource", "\"", ");", "}", "@", "Override", "public", "String", "getContentType", "(", ")", "{", "return", "delegate", ".", "getContentType", "(", ");", "}", "@", "Override", "public", "InputStream", "getInputStream", "(", ")", "throws", "IOException", "{", "return", "delegate", ".", "getInputStream", "(", ");", "}", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "@", "Override", "public", "OutputStream", "getOutputStream", "(", ")", "throws", "IOException", "{", "return", "delegate", ".", "getOutputStream", "(", ");", "}", "}", "@", "@", "-", "52", ",", "6", "+", "52", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "impl", ".", "DefaultHeaderFilterStrategy", ";", "import", "org", ".", "apache", ".", "camel", ".", "spi", ".", "HeaderFilterStrategy", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "CollectionHelper", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "FileUtil", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "IOHelper", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "ObjectHelper", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "@", "@", "-", "314", ",", "7", "+", "315", ",", "7", "@", "@", "protected", "void", "extractAttachmentsFromMultipart", "(", "Multipart", "mp", ",", "Map", "<", "String", ",", "Attachm", "extractAttachmentsFromMultipart", "(", "(", "Multipart", ")", "part", ".", "getContent", "(", "),", "map", ")", ";", "}", "else", "{", "String", "disposition", "=", "part", ".", "getDisposition", "(", ");", "String", "fileName", "=", "part", ".", "getFileName", "(", ");", "String", "fileName", "=", "FileUtil", ".", "stripPath", "(", "part", ".", "getFileName", "(", "))", ";", "if", "(", "LOG", ".", "isTraceEnabled", "(", "))", "{", "LOG", ".", "trace", "(", "\"", "Part", "#", "{}", ":", "Disposition", ":", "{", "}\"", ",", "i", ",", "disposition", ")", ";", "@", "@", "-", "330", ",", "7", "+", "331", ",", "11", "@", "@", "protected", "void", "extractAttachmentsFromMultipart", "(", "Multipart", "mp", ",", "Map", "<", "String", ",", "Attachm", "LOG", ".", "debug", "(", "\"", "Mail", "contains", "file", "attachment", ":", "{", "}\"", ",", "fileName", ")", ";", "if", "(", "!", "map", ".", "containsKey", "(", "fileName", ")", ")", "{", "/", "/", "Parts", "marked", "with", "a", "disposition", "of", "Part", ".", "ATTACHMENT", "are", "clearly", "attachments", "DefaultAttachment", "camelAttachment", "=", "new", "DefaultAttachment", "(", "part", ".", "getDataHandler", "(", "))", ";", "final", "DataHandler", "dataHandler", "=", "part", ".", "getDataHandler", "(", ");", "final", "DataSource", "dataSource", "=", "dataHandler", ".", "getDataSource", "(", ");", "final", "DataHandler", "replacement", "=", "new", "DataHandler", "(", "new", "DelegatingDataSource", "(", "fileName", ",", "dataSource", ")", ");", "DefaultAttachment", "camelAttachment", "=", "new", "DefaultAttachment", "(", "replacement", ")", ";", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Enumeration", "<", "Header", ">", "headers", "=", "part", ".", "getAllHeaders", "(", ");", "while", "(", "headers", ".", "hasMoreElements", "(", "))", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "75", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "mail", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "activation", ".", "DataHandler", ";", "import", "javax", ".", "mail", ".", "Message", ";", "import", "javax", ".", "mail", ".", "MessagingException", ";", "import", "javax", ".", "mail", ".", "Multipart", ";", "import", "javax", ".", "mail", ".", "Session", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeBodyPart", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeMessage", ";", "import", "javax", ".", "mail", ".", "internet", ".", "MimeMultipart", ";", "import", "org", ".", "apache", ".", "camel", ".", "Attachment", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameter", ";", "import", "org", ".", "junit", ".", "runners", ".", "Parameterized", ".", "Parameters", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "@", "RunWith", "(", "Parameterized", ".", "class", ")", "public", "class", "MailBindingAttachmentFileTest", "{", "@", "Parameter", "public", "String", "name", ";", "private", "final", "MailBinding", "binding", "=", "new", "MailBinding", "(", ");", "@", "Test", "public", "void", "shouldSanitizeAttachmentFileNames", "(", ")", "throws", "MessagingException", ",", "IOException", "{", "final", "Session", "session", "=", "Session", ".", "getInstance", "(", "new", "Properties", "(", "))", ";", "final", "Message", "message", "=", "new", "MimeMessage", "(", "session", ")", ";", "final", "Multipart", "multipart", "=", "new", "MimeMultipart", "(", ");", "final", "MimeBodyPart", "part", "=", "new", "MimeBodyPart", "(", ");", "part", ".", "attachFile", "(", "name", ")", ";", "multipart", ".", "addBodyPart", "(", "part", ")", ";", "message", ".", "setContent", "(", "multipart", ")", ";", "final", "Map", "<", "String", ",", "Attachment", ">", "attachments", "=", "new", "HashMap", "<", ">(", ");", "binding", ".", "extractAttachmentsFromMail", "(", "message", ",", "attachments", ")", ";", "assertThat", "(", "attachments", ")", ".", "containsKey", "(", "\"", "file", ".", "txt", "\"", ");", "final", "Attachment", "attachment", "=", "attachments", ".", "get", "(", "\"", "file", ".", "txt", "\"", ");", "final", "DataHandler", "dataHandler", "=", "attachment", ".", "getDataHandler", "(", ");", "assertThat", "(", "dataHandler", ".", "getName", "(", "))", ".", "isEqualTo", "(", "\"", "file", ".", "txt", "\"", ");", "}", "@", "Parameters", "(", "name", "=", "\"", "{", "0", "}", "\")", "public", "static", "Iterable", "<", "String", ">", "fileNames", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "\"", "file", ".", "txt", "\"", ",", "\"", "..", "/", "file", ".", "txt", "\"", ",", "\"", "..", "\\\\", "file", ".", "txt", "\"", ",", "\"", "/", "absolute", "/", "file", ".", "txt", "\"", ",", "\"", "c", ":", "\\\\", "absolute", "\\", "\\", "file", ".", "txt", "\"", ");", "}", "}"], "docstring_tokens": ["path", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "369", ",", "6", "+", "369", ",", "67", "@", "@", "public", "boolean", "hasGitRepo", "(", "String", "GIT_DIR", ")", "throws", "GitException", "{", "return", "submodules", ";", "}", "/", "**", "*", "Constant", "which", "disables", "safety", "check", "of", "remote", "URL", ".", "*", "*", "<", "code", ">", "CHECK_REMOTE_URL", "=", "Boolean", ".", "valueOf", "(", "System", ".", "getProperty", "(", "CliGitAPIImpl", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "checkRemoteURL", "\"", ",", "\"", "true", "\"", "))", "</", "code", ">", ".", "*", "*", "Refuse", "unsafe", "git", "URL", "'", "s", ",", "including", "URL", "'", "s", "that", "start", "with", "'", "-'", "*", "and", "URL", "'", "s", "that", "contain", "space", "characters", ".", "*", "*", "Use", "'", "-", "Dorg", ".", "jenkinsci", ".", "plugins", ".", "gitclient", ".", "CliGitAPIImpl", ".", "checkRemoteURL", "=", "false", "'", "*", "to", "prevent", "check", "of", "remote", "URL", ".", "*", "/", "private", "static", "final", "boolean", "CHECK_REMOTE_URL", "=", "Boolean", ".", "valueOf", "(", "System", ".", "getProperty", "(", "CliGitAPIImpl", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "checkRemoteURL", "\"", ",", "\"", "true", "\"", "))", ";", "/", "**", "*", "SECURITY", "-", "1534", "found", "that", "arguments", "*", "added", "to", "a", "git", "URL", "from", "the", "user", "interface", "can", "allow", "a", "user", "*", "with", "job", "creation", "permissions", "to", "execute", "an", "arbitrary", "program", "*", "on", "the", "git", "server", "if", "the", "git", "server", "is", "configured", "to", "allow", "*", "custom", "pack", "programs", ".", "Reject", "a", "URL", "if", "it", "includes", "invalid", "*", "content", ".", "*", "/", "private", "void", "addCheckedRemoteUrl", "(", "@", "NonNull", "ArgumentListBuilder", "args", ",", "@", "NonNull", "String", "url", ")", "{", "String", "trimmedUrl", "=", "url", ".", "trim", "(", ");", "/", "*", "Don", "'", "t", "check", "for", "invalid", "args", "if", "URL", "starts", "with", "known", "good", "cases", ".", "*", "Known", "good", "cases", "include", ":", "*", "'", "/'", "-", "Unix", "local", "file", "*", "'", "C", ":", "'", "-", "Windows", "local", "file", "*", "'", "file", ":", "',", "'", "git", ":", "',", "'", "http", ":", "',", "'", "https", ":", "',", "'", "ssh", ":", "',", "and", "'", "git", "@", "'", "-", "known", "protocols", "*", "/", "if", "(", "CHECK_REMOTE_URL", "&", "&", "!", "trimmedUrl", ".", "startsWith", "(", "\"/", "\")", "&", "&", "!", "trimmedUrl", ".", "startsWith", "(", "\"\\", "\\\\", "\\\"", ")", "&", "&", "!", "trimmedUrl", ".", "startsWith", "(", "\"", "file", ":", "\")", "&", "&", "!", "trimmedUrl", ".", "startsWith", "(", "\"", "git", ":", "\")", "&", "&", "!", "trimmedUrl", ".", "startsWith", "(", "\"", "git", "@", "\")", "&", "&", "!", "trimmedUrl", ".", "startsWith", "(", "\"", "http", ":", "\")", "&", "&", "!", "trimmedUrl", ".", "startsWith", "(", "\"", "https", ":", "\")", "&", "&", "!", "trimmedUrl", ".", "startsWith", "(", "\"", "ssh", ":", "\")", "&", "&", "!", "trimmedUrl", ".", "matches", "(", "\"^", "[", "A", "-", "Za", "-", "z", "]", ":.", "+\"", "))", "{", "/", "*", "Not", "one", "of", "the", "known", "good", "cases", ",", "check", "if", "this", "could", "be", "a", "bad", "case", "*", "Bad", "cases", "include", ":", "*", "'", "-'", "-", "starts", "with", "'", "dash", "'", "as", "possible", "argument", "*", "'", "`'", "-", "includes", "backquote", "in", "the", "string", "(", "command", "execution", ")", "*", "'", "'", "-", "includes", "a", "space", "(", "not", "guaranteed", "a", "threat", ",", "but", "threat", "risk", "increases", ")", "*", "/", "if", "(", "trimmedUrl", ".", "startsWith", "(", "\"-", "\")", "|", "|", "trimmedUrl", ".", "contains", "(", "\"`", "\")", "|", "|", "trimmedUrl", ".", "contains", "(", "\"-", "-", "upload", "-", "pack", "=", "\")", "|", "|", "trimmedUrl", ".", "matches", "(", "\".", "*\\", "\\", "s", "+", ".*", "\")", ")", "{", "throw", "new", "GitException", "(", "\"", "Invalid", "remote", "URL", ":", "\"", "+", "url", ")", ";", "}", "}", "/", "/", "Mark", "the", "end", "of", "options", "for", "git", "versions", "that", "support", "it", ".", "/", "/", "Tells", "command", "line", "git", "that", "later", "arguments", "are", "operands", ",", "not", "options", ".", "/", "/", "See", "POSIX", "1", "-", "2017", "guideline", "10", ".", "if", "(", "isAtLeastVersion", "(", "2", ",", "8", ",", "0", ",", "0", ")", ")", "{", "args", ".", "add", "(", "\"-", "-\"", ");", "/", "/", "SECURITY", "-", "1534", "-", "end", "of", "options", ",", "causes", "tests", "to", "fail", "with", "git", "2", ".", "7", ".", "4", "and", "older", "}", "args", ".", "add", "(", "trimmedUrl", ")", ";", "}", "/", "**", "*", "fetch_", ".", "*", "@", "@", "-", "497", ",", "7", "+", "558", ",", "7", "@", "@", "public", "void", "fetch", "(", "String", "remoteName", ",", "RefSpec", ".", "..", "refspec", ")", "throws", "GitException", ",", "In", "String", "url", "=", "getRemoteUrl", "(", "remoteName", ")", ";", "if", "(", "url", "=", "=", "null", ")", "throw", "new", "GitException", "(", "\"", "remote", ".", "\"", "+", "remoteName", "+", "\"", ".", "url", "not", "defined", "\"", ");", "args", ".", "add", "(", "url", ")", ";", "addCheckedRemoteUrl", "(", "args", ",", "url", ")", ";", "if", "(", "refspec", "!", "=", "null", "&", "&", "refspec", ".", "length", ">", "0", ")", "for", "(", "RefSpec", "rs", ":", "refspec", ")", "if", "(", "rs", "!", "=", "null", ")", "@", "@", "-", "2770", ",", "7", "+", "2831", ",", "10", "@", "@", "public", "FilePath", "getWorkTree", "(", ")", "{", "try", "{", "ArgumentListBuilder", "args", "=", "new", "ArgumentListBuilder", "(", ");", "args", ".", "add", "(", "\"", "ls", "-", "remote", "\"", ",", "\"", "--", "tags", "\"", ");", "args", ".", "add", "(", "getRemoteUrl", "(", "\"", "origin", "\"", "))", ";", "String", "remoteUrl", "=", "getRemoteUrl", "(", "\"", "origin", "\"", ");", "if", "(", "remoteUrl", "!", "=", "null", ")", "{", "addCheckedRemoteUrl", "(", "args", ",", "remoteUrl", ")", ";", "}", "if", "(", "tagPattern", "!", "=", "null", ")", "args", ".", "add", "(", "tagPattern", ")", ";", "String", "result", "=", "launchCommandIn", "(", "args", ",", "workspace", ")", ";", "@", "@", "-", "2872", ",", "7", "+", "2936", ",", "7", "@", "@", "public", "void", "deleteRef", "(", "String", "refName", ")", "throws", "GitException", ",", "InterruptedException", "public", "Map", "<", "String", ",", "ObjectId", ">", "getHeadRev", "(", "String", "url", ")", "throws", "GitException", ",", "InterruptedException", "{", "ArgumentListBuilder", "args", "=", "new", "ArgumentListBuilder", "(", "\"", "ls", "-", "remote", "\"", ");", "args", ".", "add", "(", "\"-", "h", "\"", ");", "args", ".", "add", "(", "url", ")", ";", "addCheckedRemoteUrl", "(", "args", ",", "url", ")", ";", "StandardCredentials", "cred", "=", "credentials", ".", "get", "(", "url", ")", ";", "if", "(", "cred", "=", "=", "null", ")", "cred", "=", "defaultCredentials", ";", "@", "@", "-", "2902", ",", "7", "+", "2966", ",", "8", "@", "@", "public", "ObjectId", "getHeadRev", "(", "String", "url", ",", "String", "branchSpec", ")", "throws", "GitException", ",", "I", "StandardCredentials", "cred", "=", "credentials", ".", "get", "(", "url", ")", ";", "if", "(", "cred", "=", "=", "null", ")", "cred", "=", "defaultCredentials", ";", "args", ".", "add", "(", "url", ")", ";", "addCheckedRemoteUrl", "(", "args", ",", "url", ")", ";", "if", "(", "branchName", ".", "startsWith", "(", "\"", "refs", "/", "tags", "/", "\")", ")", "{", "args", ".", "add", "(", "branchName", "+", "\"^", "{}", "\")", ";", "/", "/", "JENKINS", "-", "23299", "-", "tag", "SHA1", "needs", "to", "be", "converted", "to", "commit", "SHA1", "}", "else", "{", "@", "@", "-", "2922", ",", "7", "+", "2987", ",", "7", "@", "@", "public", "ObjectId", "getHeadRev", "(", "String", "url", ",", "String", "branchSpec", ")", "throws", "GitException", ",", "I", "if", "(", "tagsOnly", ")", "{", "args", ".", "add", "(", "\"-", "t", "\"", ");", "}", "args", ".", "add", "(", "url", ")", ";", "addCheckedRemoteUrl", "(", "args", ",", "url", ")", ";", "if", "(", "pattern", "!", "=", "null", ")", "{", "args", ".", "add", "(", "pattern", ")", ";", "}", "@", "@", "-", "2964", ",", "7", "+", "3029", ",", "7", "@", "@", "public", "ObjectId", "getHeadRev", "(", "String", "url", ",", "String", "branchSpec", ")", "throws", "GitException", ",", "I", "/", "/", "https", ":", "//", "github", ".", "com", "/", "git", "/", "git", "/", "blob", "/", "afd6726309", "/", "Documentation", "/", "RelNotes", "/", "2", ".", "8", ".", "0", ".", "txt", "#", "L72", "-", "L73", "ArgumentListBuilder", "args", "=", "new", "ArgumentListBuilder", "(", "\"", "ls", "-", "remote", "\"", ");", "args", ".", "add", "(", "\"-", "-", "symref", "\"", ");", "args", ".", "add", "(", "url", ")", ";", "addCheckedRemoteUrl", "(", "args", ",", "url", ")", ";", "if", "(", "pattern", "!", "=", "null", ")", "{", "args", ".", "add", "(", "pattern", ")", ";", "}", "@", "@", "-", "3013", ",", "7", "+", "3078", ",", "8", "@", "@", "public", "void", "push", "(", "RemoteConfig", "repository", ",", "String", "refspec", ")", "throws", "GitException", ",", "I", "StandardCredentials", "cred", "=", "credentials", ".", "get", "(", "url", ")", ";", "if", "(", "cred", "=", "=", "null", ")", "cred", "=", "defaultCredentials", ";", "args", ".", "add", "(", "\"", "push", "\"", ",", "url", ")", ";", "args", ".", "add", "(", "\"", "push", "\"", ");", "addCheckedRemoteUrl", "(", "args", ",", "url", ")", ";", "if", "(", "refspec", "!", "=", "null", ")", "args", ".", "add", "(", "refspec", ")", ";"], "docstring_tokens": ["command", "injection"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "817", ",", "8", "+", "817", ",", "8", "@", "@", "collect_rx_frame", "(", "usb_fifo", "*", "fifo", ",", "__u8", "*", "data", ",", "int", "len", ",", "int", "finish", ")", "}", "/", "*", "we", "have", "a", "complete", "hdlc", "packet", "*", "/", "if", "(", "finish", ")", "{", "if", "(", "(!", "fifo", "-", ">", "skbuff", "-", ">", "data", "[", "fifo", "-", ">", "skbuff", "-", ">", "len", "-", "1", "]", ")", "&", "&", "(", "fifo", "-", ">", "skbuff", "-", ">", "len", ">", "3", ")", ")", "{", "if", "(", "fifo", "-", ">", "skbuff", "-", ">", "len", ">", "3", "&", "&", "!", "fifo", "-", ">", "skbuff", "-", ">", "data", "[", "fifo", "-", ">", "skbuff", "-", ">", "len", "-", "1", "]", ")", "{", "if", "(", "fifon", "=", "=", "HFCUSB_D_RX", ")", "{", "DBG", "(", "HFCUSB_DBG_DCHANNEL", ","], "docstring_tokens": ["read", "buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "72", ",", "7", "+", "72", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "86", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "87", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "102", ",", "6", "+", "102", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "startingDirectoryMustExist", "*", "(", "consumer", ")", "|", "Whether", "the", "starting", "directory", "must", "exist", ".", "Mind", "that", "the", "autoCreate", "option", "is", "default", "enabled", ",", "which", "means", "the", "starting", "directory", "is", "normally", "auto", "created", "if", "it", "doesn", "'", "t", "exist", ".", "You", "can", "disable", "autoCreate", "and", "enable", "this", "to", "ensure", "the", "starting", "directory", "must", "exist", ".", "Will", "thrown", "an", "exception", "if", "the", "directory", "doesn", "'", "t", "exist", ".", "|", "false", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "94", ",", "6", "+", "94", ",", "8", "@", "@", "protected", "boolean", "keepLastModified", ";", "@", "UriParam", "(", "label", "=", "\"", "producer", ",", "advanced", "\"", ")", "protected", "boolean", "allowNullBody", ";", "@", "UriParam", "(", "label", "=", "\"", "producer", "\"", ",", "defaultValue", "=", "\"", "true", "\"", ")", "protected", "boolean", "jailStartingDirectory", "=", "true", ";", "/", "/", "consumer", "options", "@", "@", "-", "1251", ",", "6", "+", "1253", ",", "19", "@", "@", "public", "void", "setAllowNullBody", "(", "boolean", "allowNullBody", ")", "{", "this", ".", "allowNullBody", "=", "allowNullBody", ";", "}", "public", "boolean", "isJailStartingDirectory", "(", ")", "{", "return", "jailStartingDirectory", ";", "}", "/", "**", "*", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "*", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "*", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "*", "/", "public", "void", "setJailStartingDirectory", "(", "boolean", "jailStartingDirectory", ")", "{", "this", ".", "jailStartingDirectory", "=", "jailStartingDirectory", ";", "}", "public", "ExceptionHandler", "getOnCompletionExceptionHandler", "(", ")", "{", "return", "onCompletionExceptionHandler", ";", "}", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "Lock", ";", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReentrantLock", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExchangeException", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Expression", ";", "import", "org", ".", "apache", ".", "camel", ".", "support", ".", "DefaultExchange", ";", "@", "@", "-", "325", ",", "7", "+", "326", ",", "7", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "exchange", ".", "getIn", "(", ").", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "value", ")", ";", "}", "if", "(", "value", "!", "=", "null", "&", "&", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "if", "(", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "log", ".", "warn", "(", "\"", "Simple", "expression", ":", "{", "}", "detected", "in", "header", ":", "{", "}", "of", "type", "String", ".", "This", "feature", "has", "been", "removed", "(", "see", "CAMEL", "-", "6748", ")", ".\"", ",", "value", ",", "Exchange", ".", "FILE_NAME", ")", ";", "}", "@", "@", "-", "372", ",", "6", "+", "373", ",", "15", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "answer", "=", "baseDir", "+", "endpoint", ".", "getGeneratedFileName", "(", "exchange", ".", "getIn", "(", "))", ";", "}", "if", "(", "endpoint", ".", "isJailStartingDirectory", "(", "))", "{", "/", "/", "check", "for", "file", "must", "be", "within", "starting", "directory", "(", "need", "to", "compact", "first", "as", "the", "name", "can", "be", "using", "relative", "paths", "via", ".", "./", "etc", ")", "String", "compatchAnswer", "=", "FileUtil", ".", "compactPath", "(", "answer", ")", ";", "String", "compatchBaseDir", "=", "FileUtil", ".", "compactPath", "(", "baseDir", ")", ";", "if", "(", "!", "compatchAnswer", ".", "startsWith", "(", "compatchBaseDir", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Cannot", "write", "file", "with", "name", ":", "\"", "+", "compatchAnswer", "+", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", ":", "\"", "+", "compatchBaseDir", ")", ";", "}", "}", "if", "(", "endpoint", ".", "getConfiguration", "(", ").", "needToNormalize", "(", "))", "{", "/", "/", "must", "normalize", "path", "to", "cater", "for", "Windows", "and", "other", "OS", "answer", "=", "normalizePath", "(", "answer", ")", ";", "@", "@", "-", "81", ",", "7", "+", "81", ",", "7", "@", "@", "public", "void", "testProducerDateByExpression", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testProducerComplexByExpression", "(", ")", "throws", "Exception", "{", "String", "expression", "=", "\"", "..", "/", "filelanguageinbox", "/", "myfile", "-", "${", "bean", ":", "myguidgenerator", ".", "guid", "}", "-$", "{", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ";", "template", ".", "sendBody", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "?", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "template", ".", "sendBody", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "?", "jailStartingDirectory", "=", "false", "&", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "String", "date", "=", "new", "SimpleDateFormat", "(", "\"", "yyyyMMdd", "\"", ").", "format", "(", "new", "Date", "(", "))", ";", "assertFileExists", "(", "\"", "target", "/", "filelanguageinbox", "/", "myfile", "-", "123", "-", "\"", "+", "date", "+", "\"", ".", "txt", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "73", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ";", "import", "org", ".", "apache", ".", "camel", ".", "ContextTestSupport", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "FileProducerJailStartingDirectoryTest", "extends", "ContextTestSupport", "{", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "deleteDirectory", "(", "\"", "target", "/", "jail", "\"", ");", "super", ".", "setUp", "(", ");", "}", "@", "Test", "public", "void", "testWriteOutsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "0", ")", ";", "try", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "hello", ".", "txt", "\"", ");", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "IllegalArgumentException", "iae", "=", "assertIsInstanceOf", "(", "IllegalArgumentException", ".", "class", ",", "e", ".", "getCause", "(", "))", ";", "assertTrue", "(", "iae", ".", "getMessage", "(", ").", "contains", "(", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", "\"", "))", ";", "}", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Test", "public", "void", "testWriteInsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "outbox", "/", "bye", ".", "txt", "\"", ");", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\".", "./", "${", "file", ":", "name", "}", "\")", ")", ".", "to", "(", "\"", "file", ":", "target", "/", "jail", "/", "outbox", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "109", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "110", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "143", ",", "6", "+", "143", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "60", ",", "7", "+", "60", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "121", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "122", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "103", ",", "6", "+", "103", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "117", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "118", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "87", ",", "6", "+", "87", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "public", "void", "testProducerDateByExpression", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testProducerComplexByExpression", "(", ")", "throws", "Exception", "{", "/", "/", "need", "one", "extra", "subdirectory", "(", "=", "foo", ")", "to", "be", "able", "to", "start", "with", ".", ".", "in", "the", "fileName", "option", "String", "url", "=", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "filelanguage", "/", "foo", "?", "password", "=", "admin", "\"", ";", "String", "url", "=", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "filelanguage", "/", "foo", "?", "password", "=", "admin", "&", "jailStartingDirectory", "=", "false", "\"", ";", "String", "expression", "=", "\"", "..", "/", "filelanguageinbox", "/", "myfile", "-", "${", "bean", ":", "myguidgenerator", ".", "guid", "}", "-$", "{", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ";", "template", ".", "sendBody", "(", "url", "+", "\"", "&", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "68", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ".", "remote", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "FtpProducerJailStartingDirectoryTest", "extends", "FtpServerTestSupport", "{", "private", "String", "getFtpUrl", "(", ")", "{", "return", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "upload", "/", "jail", "?", "binary", "=", "false", "&", "password", "=", "admin", "&", "tempPrefix", "=", ".", "uploading", "\"", ";", "}", "@", "Test", "public", "void", "testWriteOutsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "0", ")", ";", "try", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "hello", ".", "txt", "\"", ");", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "IllegalArgumentException", "iae", "=", "assertIsInstanceOf", "(", "IllegalArgumentException", ".", "class", ",", "e", ".", "getCause", "(", "))", ";", "assertTrue", "(", "iae", ".", "getMessage", "(", ").", "contains", "(", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", "\"", "))", ";", "}", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Test", "public", "void", "testWriteInsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "jail", "/", "bye", ".", "txt", "\"", ");", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\".", "./", "${", "file", ":", "name", "}", "\")", ")", ".", "to", "(", "getFtpUrl", "(", "))", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "83", ",", "7", "+", "83", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "21", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "22", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "93", ",", "6", "+", "93", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "chmod", "*", "(", "producer", ")", "|", "Allows", "you", "to", "set", "chmod", "on", "the", "stored", "file", ".", "For", "example", "chmod", "=", "664", ".", "|", "664", "|", "String", "|", "*", "fileName", "*", "(", "producer", ")", "|", "Use", "Expression", "such", "as", "File", "Language", "to", "dynamically", "set", "the", "filename", ".", "For", "consumers", ",", "it", "'", "s", "used", "as", "a", "filename", "filter", ".", "For", "producers", ",", "it", "'", "s", "used", "to", "evaluate", "the", "filename", "to", "write", ".", "If", "an", "expression", "is", "set", ",", "it", "take", "precedence", "over", "the", "CamelFileName", "header", ".", "(", "Note", ":", "The", "header", "itself", "can", "also", "be", "an", "Expression", ")", ".", "The", "expression", "options", "support", "both", "String", "and", "Expression", "types", ".", "If", "the", "expression", "is", "a", "String", "type", ",", "it", "is", "always", "evaluated", "using", "the", "File", "Language", ".", "If", "the", "expression", "is", "an", "Expression", "type", ",", "the", "specified", "Expression", "type", "is", "used", "-", "this", "allows", "you", ",", "for", "instance", ",", "to", "use", "OGNL", "expressions", ".", "For", "the", "consumer", ",", "you", "can", "use", "it", "to", "filter", "filenames", ",", "so", "you", "can", "for", "instance", "consume", "today", "'", "s", "file", "using", "the", "File", "Language", "syntax", ":", "mydata", "-", "$", "date", ":", "now", ":", "yyyyMMdd", ".", "txt", ".", "The", "producers", "support", "the", "CamelOverruleFileName", "header", "which", "takes", "precedence", "over", "any", "existing", "CamelFileName", "header", ";", "the", "CamelOverruleFileName", "is", "a", "header", "that", "is", "used", "only", "once", ",", "and", "makes", "it", "easier", "as", "this", "avoids", "to", "temporary", "store", "CamelFileName", "and", "have", "to", "restore", "it", "afterwards", ".", "|", "|", "String", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "strictHostKeyChecking", "*", "(", "producer", ")", "|", "Sets", "whether", "to", "use", "strict", "host", "key", "checking", ".", "Possible", "values", "are", ":", "no", ",", "yes", "|", "no", "|", "String", "|", "*", "allowNullBody", "*", "(", "producer", ")", "|", "Used", "to", "specify", "if", "a", "null", "body", "is", "allowed", "during", "file", "writing", ".", "If", "set", "to", "true", "then", "an", "empty", "file", "will", "be", "created", ",", "when", "set", "to", "false", ",", "and", "attempting", "to", "send", "a", "null", "body", "to", "the", "file", "component", ",", "a", "GenericFileWriteException", "of", "'", "Cannot", "write", "null", "body", "to", "file", ".", "'", "will", "be", "thrown", ".", "If", "the", "fileExist", "option", "is", "set", "to", "'", "Override", "'", ",", "then", "the", "file", "will", "be", "truncated", ",", "and", "if", "set", "to", "append", "the", "file", "will", "remain", "unchanged", ".", "|", "false", "|", "boolean", "|", "*", "disconnectOnBatchComplete", "*", "(", "producer", ")", "|", "Whether", "or", "not", "to", "disconnect", "from", "remote", "FTP", "server", "right", "after", "a", "Batch", "upload", "is", "complete", ".", "disconnectOnBatchComplete", "will", "only", "disconnect", "the", "current", "connection", "to", "the", "FTP", "server", ".", "|", "false", "|", "boolean", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "109", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "110", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "143", ",", "6", "+", "143", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "60", ",", "7", "+", "60", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "121", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "122", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "103", ",", "6", "+", "103", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "83", ",", "7", "+", "83", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "21", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "22", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "93", ",", "6", "+", "93", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "chmod", "*", "(", "producer", ")", "|", "Allows", "you", "to", "set", "chmod", "on", "the", "stored", "file", ".", "For", "example", "chmod", "=", "664", ".", "|", "664", "|", "String", "|", "*", "fileName", "*", "(", "producer", ")", "|", "Use", "Expression", "such", "as", "File", "Language", "to", "dynamically", "set", "the", "filename", ".", "For", "consumers", ",", "it", "'", "s", "used", "as", "a", "filename", "filter", ".", "For", "producers", ",", "it", "'", "s", "used", "to", "evaluate", "the", "filename", "to", "write", ".", "If", "an", "expression", "is", "set", ",", "it", "take", "precedence", "over", "the", "CamelFileName", "header", ".", "(", "Note", ":", "The", "header", "itself", "can", "also", "be", "an", "Expression", ")", ".", "The", "expression", "options", "support", "both", "String", "and", "Expression", "types", ".", "If", "the", "expression", "is", "a", "String", "type", ",", "it", "is", "always", "evaluated", "using", "the", "File", "Language", ".", "If", "the", "expression", "is", "an", "Expression", "type", ",", "the", "specified", "Expression", "type", "is", "used", "-", "this", "allows", "you", ",", "for", "instance", ",", "to", "use", "OGNL", "expressions", ".", "For", "the", "consumer", ",", "you", "can", "use", "it", "to", "filter", "filenames", ",", "so", "you", "can", "for", "instance", "consume", "today", "'", "s", "file", "using", "the", "File", "Language", "syntax", ":", "mydata", "-", "$", "date", ":", "now", ":", "yyyyMMdd", ".", "txt", ".", "The", "producers", "support", "the", "CamelOverruleFileName", "header", "which", "takes", "precedence", "over", "any", "existing", "CamelFileName", "header", ";", "the", "CamelOverruleFileName", "is", "a", "header", "that", "is", "used", "only", "once", ",", "and", "makes", "it", "easier", "as", "this", "avoids", "to", "temporary", "store", "CamelFileName", "and", "have", "to", "restore", "it", "afterwards", ".", "|", "|", "String", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "strictHostKeyChecking", "*", "(", "producer", ")", "|", "Sets", "whether", "to", "use", "strict", "host", "key", "checking", ".", "Possible", "values", "are", ":", "no", ",", "yes", "|", "no", "|", "String", "|", "*", "allowNullBody", "*", "(", "producer", ")", "|", "Used", "to", "specify", "if", "a", "null", "body", "is", "allowed", "during", "file", "writing", ".", "If", "set", "to", "true", "then", "an", "empty", "file", "will", "be", "created", ",", "when", "set", "to", "false", ",", "and", "attempting", "to", "send", "a", "null", "body", "to", "the", "file", "component", ",", "a", "GenericFileWriteException", "of", "'", "Cannot", "write", "null", "body", "to", "file", ".", "'", "will", "be", "thrown", ".", "If", "the", "fileExist", "option", "is", "set", "to", "'", "Override", "'", ",", "then", "the", "file", "will", "be", "truncated", ",", "and", "if", "set", "to", "append", "the", "file", "will", "remain", "unchanged", ".", "|", "false", "|", "boolean", "|", "*", "disconnectOnBatchComplete", "*", "(", "producer", ")", "|", "Whether", "or", "not", "to", "disconnect", "from", "remote", "FTP", "server", "right", "after", "a", "Batch", "upload", "is", "complete", ".", "disconnectOnBatchComplete", "will", "only", "disconnect", "the", "current", "connection", "to", "the", "FTP", "server", ".", "|", "false", "|", "boolean", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "117", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "118", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "87", ",", "6", "+", "87", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "136", ",", "7", "+", "136", ",", "6", "@", "@", "import", "hudson", ".", "security", ".", "AuthorizationStrategy", ";", "import", "hudson", ".", "security", ".", "BasicAuthenticationFilter", ";", "import", "hudson", ".", "security", ".", "FederatedLoginService", ";", "import", "hudson", ".", "security", ".", "FullControlOnceLoggedInAuthorizationStrategy", ";", "import", "hudson", ".", "security", ".", "HudsonFilter", ";", "import", "hudson", ".", "security", ".", "LegacyAuthorizationStrategy", ";", "import", "hudson", ".", "security", ".", "LegacySecurityRealm", ";", "@", "@", "-", "1479", ",", "11", "+", "1478", ",", "6", "@", "@", "public", "String", "getFullDisplayName", "(", ")", "{", "*", "/", "@", "Exported", "(", "name", "=", "\"", "jobs", "\"", ")", "public", "List", "<", "TopLevelItem", ">", "getItems", "(", ")", "{", "if", "(", "authorizationStrategy", "instanceof", "AuthorizationStrategy", ".", "Unsecured", "|", "|", "authorizationStrategy", "instanceof", "FullControlOnceLoggedInAuthorizationStrategy", ")", "{", "return", "new", "ArrayList", "(", "items", ".", "values", "(", "))", ";", "}", "List", "<", "TopLevelItem", ">", "viewableItems", "=", "new", "ArrayList", "<", "TopLevelItem", ">", "()", ";", "for", "(", "TopLevelItem", "item", ":", "items", ".", "values", "(", "))", "{", "if", "(", "item", ".", "hasPermission", "(", "Item", ".", "READ", ")", ")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "95", "@", "@", "package", "jenkins", ".", "security", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "hudson", ".", "model", ".", "UnprotectedRootAction", ";", "import", "hudson", ".", "security", ".", "ACL", ";", "import", "hudson", ".", "security", ".", "FullControlOnceLoggedInAuthorizationStrategy", ";", "import", "hudson", ".", "util", ".", "HttpResponses", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "HttpResponse", ";", "public", "class", "Security380Test", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Issue", "(", "\"", "SECURITY", "-", "380", "\"", ")", "@", "Test", "public", "void", "testGetItemsWithoutAnonRead", "(", ")", "throws", "Exception", "{", "FullControlOnceLoggedInAuthorizationStrategy", "strategy", "=", "new", "FullControlOnceLoggedInAuthorizationStrategy", "(", ");", "strategy", ".", "setAllowAnonymousRead", "(", "false", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "strategy", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "j", ".", "createFreeStyleProject", "(", ");", "ACL", ".", "impersonate", "(", "Jenkins", ".", "ANONYMOUS", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "Assert", ".", "assertEquals", "(", "\"", "no", "items", "\"", ",", "0", ",", "Jenkins", ".", "getInstance", "(", ").", "getItems", "(", ").", "size", "(", "))", ";", "}", "}", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "380", "\"", ")", "@", "Test", "public", "void", "testGetItems", "(", ")", "throws", "Exception", "{", "FullControlOnceLoggedInAuthorizationStrategy", "strategy", "=", "new", "FullControlOnceLoggedInAuthorizationStrategy", "(", ");", "strategy", ".", "setAllowAnonymousRead", "(", "true", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "strategy", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "j", ".", "createFreeStyleProject", "(", ");", "ACL", ".", "impersonate", "(", "Jenkins", ".", "ANONYMOUS", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "Assert", ".", "assertEquals", "(", "\"", "one", "item", "\"", ",", "1", ",", "Jenkins", ".", "getInstance", "(", ").", "getItems", "(", ").", "size", "(", "))", ";", "}", "}", ");", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "380", "\"", ")", "@", "Test", "public", "void", "testWithUnprotectedRootAction", "(", ")", "throws", "Exception", "{", "FullControlOnceLoggedInAuthorizationStrategy", "strategy", "=", "new", "FullControlOnceLoggedInAuthorizationStrategy", "(", ");", "strategy", ".", "setAllowAnonymousRead", "(", "false", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "strategy", ")", ";", "Jenkins", ".", "getInstance", "(", ").", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "j", ".", "createFreeStyleProject", "(", ");", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "Page", "page", "=", "wc", ".", "goTo", "(", "\"", "listJobs", "\"", ",", "\"", "text", "/", "plain", "\"", ");", "Assert", ".", "assertEquals", "(", "\"", "expect", "0", "items", "\"", ",", "\"", "0", "\"", ",", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ").", "trim", "(", "))", ";", "}", "@", "TestExtension", "public", "static", "class", "JobListingUnprotectedRootAction", "implements", "UnprotectedRootAction", "{", "@", "Override", "public", "String", "getIconFileName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "listJobs", "\"", ";", "}", "public", "HttpResponse", "doIndex", "(", ")", "throws", "Exception", "{", "return", "HttpResponses", ".", "plainText", "(", "Integer", ".", "toString", "(", "Jenkins", ".", "getInstance", "(", ").", "getItems", "(", ").", "size", "(", "))", ");", "}", "}", "}"], "docstring_tokens": ["information", "exposure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1959", ",", "6", "+", "1959", ",", "7", "@", "@", "static", "ssize_t", "snd_timer_user_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buffer", ",", "tu", "=", "file", "-", ">", "private_data", ";", "unit", "=", "tu", "-", ">", "tread", "?", "sizeof", "(", "struct", "snd_timer_tread", ")", ":", "sizeof", "(", "struct", "snd_timer_read", ")", ";", "mutex_lock", "(", "&", "tu", "-", ">", "ioctl_lock", ")", ";", "spin_lock_irq", "(", "&", "tu", "-", ">", "qlock", ")", ";", "while", "(", "(", "long", ")", "count", "-", "result", ">", "=", "unit", ")", "{", "while", "(", "!", "tu", "-", ">", "qused", ")", "{", "@", "@", "-", "1974", ",", "7", "+", "1975", ",", "9", "@", "@", "static", "ssize_t", "snd_timer_user_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buffer", ",", "add_wait_queue", "(", "&", "tu", "-", ">", "qchange_sleep", ",", "&", "wait", ")", ";", "spin_unlock_irq", "(", "&", "tu", "-", ">", "qlock", ")", ";", "mutex_unlock", "(", "&", "tu", "-", ">", "ioctl_lock", ")", ";", "schedule", "(", ");", "mutex_lock", "(", "&", "tu", "-", ">", "ioctl_lock", ")", ";", "spin_lock_irq", "(", "&", "tu", "-", ">", "qlock", ")", ";", "remove_wait_queue", "(", "&", "tu", "-", ">", "qchange_sleep", ",", "&", "wait", ")", ";", "@", "@", "-", "1994", ",", "7", "+", "1997", ",", "6", "@", "@", "static", "ssize_t", "snd_timer_user_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buffer", ",", "tu", "-", ">", "qused", "-", "-;", "spin_unlock_irq", "(", "&", "tu", "-", ">", "qlock", ")", ";", "mutex_lock", "(", "&", "tu", "-", ">", "ioctl_lock", ")", ";", "if", "(", "tu", "-", ">", "tread", ")", "{", "if", "(", "copy_to_user", "(", "buffer", ",", "&", "tu", "-", ">", "tqueue", "[", "qhead", "]", ",", "sizeof", "(", "struct", "snd_timer_tread", ")", "))", "@", "@", "-", "2004", ",", "7", "+", "2006", ",", "6", "@", "@", "static", "ssize_t", "snd_timer_user_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buffer", ",", "sizeof", "(", "struct", "snd_timer_read", ")", "))", "err", "=", "-", "EFAULT", ";", "}", "mutex_unlock", "(", "&", "tu", "-", ">", "ioctl_lock", ")", ";", "spin_lock_irq", "(", "&", "tu", "-", ">", "qlock", ")", ";", "if", "(", "err", "<", "0", ")", "@", "@", "-", "2014", ",", "6", "+", "2015", ",", "7", "@", "@", "static", "ssize_t", "snd_timer_user_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buffer", ",", "}", "_error", ":", "spin_unlock_irq", "(", "&", "tu", "-", ">", "qlock", ")", ";", "mutex_unlock", "(", "&", "tu", "-", ">", "ioctl_lock", ")", ";", "return", "result", ">", "0", "?", "result", ":", "err", ";", "}"], "docstring_tokens": ["data", "race"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2457", ",", "7", "+", "2457", ",", "6", "@", "@", "union", "freelist_init_state", "{", "unsigned", "int", "pos", ";", "unsigned", "int", "*", "list", ";", "unsigned", "int", "count", ";", "unsigned", "int", "rand", ";", "}", ";", "struct", "rnd_state", "rnd_state", ";", "}", ";", "@", "@", "-", "2483", ",", "8", "+", "2482", ",", "7", "@", "@", "static", "bool", "freelist_state_initialize", "(", "union", "freelist_init_state", "*", "state", ",", "}", "else", "{", "state", "-", ">", "list", "=", "cachep", "-", ">", "random_seq", ";", "state", "-", ">", "count", "=", "count", ";", "state", "-", ">", "pos", "=", "0", ";", "state", "-", ">", "rand", "=", "rand", ";", "state", "-", ">", "pos", "=", "rand", "%", "count", ";", "ret", "=", "true", ";", "}", "return", "ret", ";", "@", "@", "-", "2493", ",", "7", "+", "2491", ",", "9", "@", "@", "static", "bool", "freelist_state_initialize", "(", "union", "freelist_init_state", "*", "state", ",", "/", "*", "Get", "the", "next", "entry", "on", "the", "list", "and", "randomize", "it", "using", "a", "random", "shift", "*", "/", "static", "freelist_idx_t", "next_random_slot", "(", "union", "freelist_init_state", "*", "state", ")", "{", "return", "(", "state", "-", ">", "list", "[", "state", "-", ">", "pos", "+", "+]", "+", "state", "-", ">", "rand", ")", "%", "state", "-", ">", "count", ";", "if", "(", "state", "-", ">", "pos", ">", "=", "state", "-", ">", "count", ")", "state", "-", ">", "pos", "=", "0", ";", "return", "state", "-", ">", "list", "[", "state", "-", ">", "pos", "+", "+]", ";", "}", "/", "*", "Swap", "two", "freelist", "entries", "*", "/"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "287", ",", "7", "+", "287", ",", "7", "@", "@", "public", "void", "setValue", "(", "final", "String", "name", ",", "final", "Map", "<", "String", ",", "Object", ">", "context", ",", "final", "compileAndExecute", "(", "name", ",", "context", ",", "new", "OgnlTask", "<", "Void", ">", "()", "{", "public", "Void", "execute", "(", "Object", "tree", ")", "throws", "OgnlException", "{", "if", "(", "isEvalExpression", "(", "tree", ",", "context", ")", ")", "{", "throw", "new", "OgnlException", "(", "\"", "Eval", "expression", "cannot", "be", "used", "as", "parameter", "name", "\"", ");", "throw", "new", "OgnlException", "(", "\"", "Eval", "expression", "/", "chained", "expressions", "cannot", "be", "used", "as", "parameter", "name", "\"", ");", "}", "Ognl", ".", "setValue", "(", "tree", ",", "context", ",", "root", ",", "value", ")", ";", "return", "null", ";", "@", "@", "-", "303", ",", "7", "+", "303", ",", "7", "@", "@", "private", "boolean", "isEvalExpression", "(", "Object", "tree", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", "throw", "if", "(", "context", "!", "=", "null", "&", "&", "context", "instanceof", "OgnlContext", ")", "{", "ognlContext", "=", "(", "OgnlContext", ")", "context", ";", "}", "return", "node", ".", "isEvalChain", "(", "ognlContext", ")", ";", "return", "node", ".", "isEvalChain", "(", "ognlContext", ")", "|", "|", "node", ".", "isSequence", "(", "ognlContext", ")", ";", "}", "return", "false", ";", "}", "@", "@", "-", "360", ",", "7", "+", "360", ",", "7", "@", "@", "public", "Object", "execute", "(", "Object", "tree", ")", "throws", "OgnlException", "{", "private", "void", "checkEnableEvalExpression", "(", "Object", "tree", ",", "Map", "<", "String", ",", "Object", ">", "context", ")", "throws", "OgnlException", "{", "if", "(", "!", "enableEvalExpression", "&", "&", "isEvalExpression", "(", "tree", ",", "context", ")", ")", "{", "throw", "new", "OgnlException", "(", "\"", "Eval", "expressions", "has", "been", "disabled", "!", "\")", ";", "throw", "new", "OgnlException", "(", "\"", "Eval", "expressions", "/", "chained", "expressions", "have", "been", "disabled", "!", "\")", ";", "}", "}", "@", "@", "-", "744", ",", "6", "+", "744", ",", "21", "@", "@", "public", "void", "testAvoidCallingSomeClasses", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "expected", ".", "getMessage", "(", "),", "\"", "Method", "\\", "\"", "getRuntime", "\\", "\"", "failed", "for", "object", "class", "java", ".", "lang", ".", "Runtime", "\"", ");", "}", "public", "void", "testBlockSequenceOfExpressions", "(", ")", "throws", "Exception", "{", "Foo", "foo", "=", "new", "Foo", "(", ");", "Exception", "expected", "=", "null", ";", "try", "{", "ognlUtil", ".", "setValue", "(", "\"#", "booScope", "=", "@", "myclass", "@", "DEFAULT_SCOPE", ",", "#", "bootScope", ".", "init", "(", ")\"", ",", "ognlUtil", ".", "createDefaultContext", "(", "foo", ")", ",", "foo", ",", "true", ")", ";", "fail", "(", ");", "}", "catch", "(", "OgnlException", "e", ")", "{", "expected", "=", "e", ";", "}", "assertNotNull", "(", "expected", ")", ";", "assertSame", "(", "OgnlException", ".", "class", ",", "expected", ".", "getClass", "(", "))", ";", "assertEquals", "(", "expected", ".", "getMessage", "(", "),", "\"", "Eval", "expressions", "/", "chained", "expressions", "have", "been", "disabled", "!", "\")", ";", "}", "public", "static", "class", "Email", "{", "String", "address", ";"], "docstring_tokens": ["dynamic", "method", "invocation", "remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "346", ",", "6", "+", "346", ",", "14", "@", "@", "static", "void", "__init", "mp_override_legacy_irq", "(", "u8", "bus_irq", ",", "u8", "polarity", ",", "u8", "trigger", ",", "int", "pin", ";", "struct", "mpc_intsrc", "mp_irq", ";", "/", "*", "*", "Check", "bus_irq", "boundary", ".", "*", "/", "if", "(", "bus_irq", ">", "=", "NR_IRQS_LEGACY", ")", "{", "pr_warn", "(", "\"", "Invalid", "bus_irq", "%", "u", "for", "legacy", "override", "\\", "n", "\"", ",", "bus_irq", ")", ";", "return", ";", "}", "/", "*", "*", "Convert", "'", "gsi", "'", "to", "'", "ioapic", ".", "pin", "'", ".", "*", "/"], "docstring_tokens": ["a", "buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "60", ",", "24", "+", "60", ",", "14", "@", "@", "static", "int", "proc_do_xprt", "(", "ctl_table", "*", "table", ",", "int", "write", ",", "struct", "file", "*", "file", ",", "void", "__user", "*", "buffer", ",", "size_t", "*", "lenp", ",", "loff_t", "*", "ppos", ")", "{", "char", "tmpbuf", "[", "256", "]", ";", "int", "len", ";", "size_t", "len", ";", "if", "(", "(*", "ppos", "&", "&", "!", "write", ")", "|", "|", "!", "*", "lenp", ")", "{", "*", "lenp", "=", "0", ";", "return", "0", ";", "}", "if", "(", "write", ")", "return", "-", "EINVAL", ";", "else", "{", "len", "=", "svc_print_xprts", "(", "tmpbuf", ",", "sizeof", "(", "tmpbuf", ")", ");", "if", "(", "!", "access_ok", "(", "VERIFY_WRITE", ",", "buffer", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "__copy_to_user", "(", "buffer", ",", "tmpbuf", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "}", "*", "lenp", "-", "=", "len", ";", "*", "ppos", "+", "=", "len", ";", "return", "0", ";", "len", "=", "svc_print_xprts", "(", "tmpbuf", ",", "sizeof", "(", "tmpbuf", ")", ");", "return", "simple_read_from_buffer", "(", "buffer", ",", "*", "lenp", ",", "ppos", ",", "tmpbuf", ",", "len", ")", ";", "}", "static", "int"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2004", ",", "2005", ",", "2006", "Joe", "Walnes", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2009", ",", "2011", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2009", ",", "2011", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "26", ",", "6", "+", "26", ",", "7", "@", "@", "import", "org", ".", "dom4j", ".", "io", ".", "OutputFormat", ";", "import", "org", ".", "dom4j", ".", "io", ".", "SAXReader", ";", "import", "org", ".", "dom4j", ".", "io", ".", "XMLWriter", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "HierarchicalStreamReader", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "HierarchicalStreamWriter", ";", "@", "@", "-", "89", ",", "8", "+", "90", ",", "7", "@", "@", "public", "void", "setOutputFormat", "(", "OutputFormat", "outputFormat", ")", "{", "public", "HierarchicalStreamReader", "createReader", "(", "Reader", "text", ")", "{", "try", "{", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "Document", "document", "=", "reader", ".", "read", "(", "text", ")", ";", "final", "Document", "document", "=", "createReader", "(", ").", "read", "(", "text", ")", ";", "return", "new", "Dom4JReader", "(", "document", ",", "getNameCoder", "(", "))", ";", "}", "catch", "(", "DocumentException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "@", "@", "-", "99", ",", "8", "+", "99", ",", "7", "@", "@", "public", "HierarchicalStreamReader", "createReader", "(", "Reader", "text", ")", "{", "public", "HierarchicalStreamReader", "createReader", "(", "InputStream", "in", ")", "{", "try", "{", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "Document", "document", "=", "reader", ".", "read", "(", "in", ")", ";", "final", "Document", "document", "=", "createReader", "(", ").", "read", "(", "in", ")", ";", "return", "new", "Dom4JReader", "(", "document", ",", "getNameCoder", "(", "))", ";", "}", "catch", "(", "DocumentException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "@", "@", "-", "112", ",", "8", "+", "111", ",", "7", "@", "@", "public", "HierarchicalStreamReader", "createReader", "(", "InputStream", "in", ")", "{", "*", "/", "public", "HierarchicalStreamReader", "createReader", "(", "URL", "in", ")", "{", "try", "{", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "Document", "document", "=", "reader", ".", "read", "(", "in", ")", ";", "final", "Document", "document", "=", "createReader", "(", ").", "read", "(", "in", ")", ";", "return", "new", "Dom4JReader", "(", "document", ",", "getNameCoder", "(", "))", ";", "}", "catch", "(", "DocumentException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "@", "@", "-", "125", ",", "8", "+", "123", ",", "7", "@", "@", "public", "HierarchicalStreamReader", "createReader", "(", "URL", "in", ")", "{", "*", "/", "public", "HierarchicalStreamReader", "createReader", "(", "File", "in", ")", "{", "try", "{", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "Document", "document", "=", "reader", ".", "read", "(", "in", ")", ";", "final", "Document", "document", "=", "createReader", "(", ").", "read", "(", "in", ")", ";", "return", "new", "Dom4JReader", "(", "document", ",", "getNameCoder", "(", "))", ";", "}", "catch", "(", "DocumentException", "e", ")", "{", "throw", "new", "StreamException", "(", "e", ")", ";", "@", "@", "-", "148", ",", "4", "+", "145", ",", "21", "@", "@", "public", "HierarchicalStreamWriter", "createWriter", "(", "final", "OutputStream", "out", ")", "{", "final", "Writer", "writer", "=", "new", "OutputStreamWriter", "(", "out", ")", ";", "return", "createWriter", "(", "writer", ")", ";", "}", "/", "**", "*", "Create", "and", "initialize", "the", "SAX", "reader", ".", "*", "*", "@", "return", "the", "SAX", "reader", "instance", ".", "*", "@", "throws", "DocumentException", "if", "DOCTYPE", "processing", "cannot", "be", "disabled", "*", "@", "since", "upcoming", "*", "/", "protected", "SAXReader", "createReader", "(", ")", "throws", "DocumentException", "{", "final", "SAXReader", "reader", "=", "new", "SAXReader", "(", ");", "try", "{", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "}", "catch", "(", "SAXException", "e", ")", "{", "throw", "new", "DocumentException", "(", "\"", "Cannot", "disable", "DOCTYPE", "processing", "\"", ",", "e", ")", ";", "}", "return", "reader", ";", "}", "}", "@", "@", "-", "52", ",", "7", "+", "52", ",", "7", "@", "@", "public", "void", "testIsXXEVulnerable", "(", ")", "throws", "Exception", "{", "fail", "(", "\"", "Thrown", "\"", "+", "XStreamException", ".", "class", ".", "getName", "(", ")", "+", "\"", "expected", "\"", ");", "}", "catch", "(", "final", "XStreamException", "e", ")", "{", "final", "String", "message", "=", "e", ".", "getMessage", "(", ");", "if", "(", "message", ".", "contains", "(", "\"", "Package", "\"", "))", "{", "if", "(", "!", "message", ".", "contains", "(", "\"", "DOCTYPE", "\"", "))", "{", "throw", "e", ";", "}", "}"], "docstring_tokens": ["xml", "external", "entity", "(xxe", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "108", ",", "6", "+", "108", ",", "7", "@", "@", "private", "boolean", "autoAckSettingsFrame", "=", "true", ";", "private", "boolean", "autoAckPingFrame", "=", "true", ";", "private", "int", "maxQueuedControlFrames", "=", "Http2CodecUtil", ".", "DEFAULT_MAX_QUEUED_CONTROL_FRAMES", ";", "private", "int", "maxConsecutiveEmptyFrames", "=", "2", ";", "/", "**", "*", "Sets", "the", "{", "@", "link", "Http2Settings", "}", "to", "use", "for", "the", "initial", "connection", "settings", "exchange", ".", "@", "@", "-", "407", ",", "6", "+", "408", ",", "31", "@", "@", "protected", "Http2PromisedRequestVerifier", "promisedRequestVerifier", "(", ")", "{", "return", "promisedRequestVerifier", ";", "}", "/", "**", "*", "Returns", "the", "maximum", "number", "of", "consecutive", "empty", "DATA", "frames", "(", "without", "end_of_stream", "flag", ")", "that", "are", "allowed", "before", "*", "the", "connection", "is", "closed", ".", "This", "allows", "to", "protected", "against", "the", "remote", "peer", "flooding", "us", "with", "such", "frames", "and", "*", "so", "use", "up", "a", "lot", "of", "CPU", ".", "There", "is", "no", "valid", "use", "-", "case", "for", "empty", "DATA", "frames", "without", "end_of_stream", "flag", ".", "*", "*", "{", "@", "code", "0", "}", "means", "no", "protection", "is", "in", "place", ".", "*", "/", "protected", "int", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", ")", "{", "return", "maxConsecutiveEmptyFrames", ";", "}", "/", "**", "*", "Sets", "the", "maximum", "number", "of", "consecutive", "empty", "DATA", "frames", "(", "without", "end_of_stream", "flag", ")", "that", "are", "allowed", "before", "*", "the", "connection", "is", "closed", ".", "This", "allows", "to", "protected", "against", "the", "remote", "peer", "flooding", "us", "with", "such", "frames", "and", "*", "so", "use", "up", "a", "lot", "of", "CPU", ".", "There", "is", "no", "valid", "use", "-", "case", "for", "empty", "DATA", "frames", "without", "end_of_stream", "flag", ".", "*", "*", "{", "@", "code", "0", "}", "means", "no", "protection", "should", "be", "applied", ".", "*", "/", "protected", "B", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", "int", "maxConsecutiveEmptyFrames", ")", "{", "enforceNonCodecConstraints", "(", "\"", "maxConsecutiveEmptyFrames", "\"", ");", "this", ".", "maxConsecutiveEmptyFrames", "=", "ObjectUtil", ".", "checkPositiveOrZero", "(", "maxConsecutiveEmptyFrames", ",", "\"", "maxConsecutiveEmptyFrames", "\"", ");", "return", "self", "(", ");", "}", "/", "**", "*", "Determine", "if", "settings", "frame", "should", "automatically", "be", "acknowledged", "and", "applied", ".", "*", "@", "return", "this", ".", "@", "@", "-", "515", ",", "6", "+", "541", ",", "10", "@", "@", "private", "T", "buildFromConnection", "(", "Http2Connection", "connection", ")", "{", "}", "private", "T", "buildFromCodec", "(", "Http2ConnectionDecoder", "decoder", ",", "Http2ConnectionEncoder", "encoder", ")", "{", "int", "maxConsecutiveEmptyDataFrames", "=", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", ");", "if", "(", "maxConsecutiveEmptyDataFrames", ">", "0", ")", "{", "decoder", "=", "new", "Http2EmptyDataFrameConnectionDecoder", "(", "decoder", ",", "maxConsecutiveEmptyDataFrames", ")", ";", "}", "final", "T", "handler", ";", "try", "{", "/", "/", "Call", "the", "abstract", "build", "method", "@", "@", "-", "0", ",", "0", "+", "1", ",", "41", "@", "@", "/", "*", "*", "Copyright", "2019", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "*", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "*", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "*", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "*", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http2", ";", "import", "io", ".", "netty", ".", "util", ".", "internal", ".", "ObjectUtil", ";", "/", "**", "*", "Enforce", "a", "limit", "on", "the", "maximum", "number", "of", "consecutive", "empty", "DATA", "frames", "(", "without", "end_of_stream", "flag", ")", "that", "are", "allowed", "*", "before", "the", "connection", "will", "be", "closed", ".", "*", "/", "final", "class", "Http2EmptyDataFrameConnectionDecoder", "extends", "DecoratingHttp2ConnectionDecoder", "{", "private", "final", "int", "maxConsecutiveEmptyFrames", ";", "Http2EmptyDataFrameConnectionDecoder", "(", "Http2ConnectionDecoder", "delegate", ",", "int", "maxConsecutiveEmptyFrames", ")", "{", "super", "(", "delegate", ")", ";", "this", ".", "maxConsecutiveEmptyFrames", "=", "ObjectUtil", ".", "checkPositive", "(", "maxConsecutiveEmptyFrames", ",", "\"", "maxConsecutiveEmptyFrames", "\"", ");", "}", "@", "Override", "public", "void", "frameListener", "(", "Http2FrameListener", "listener", ")", "{", "if", "(", "listener", "!", "=", "null", ")", "{", "super", ".", "frameListener", "(", "new", "Http2EmptyDataFrameListener", "(", "listener", ",", "maxConsecutiveEmptyFrames", ")", ");", "}", "else", "{", "super", ".", "frameListener", "(", "null", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "65", "@", "@", "/", "*", "*", "Copyright", "2019", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "*", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "*", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "*", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "*", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http2", ";", "import", "io", ".", "netty", ".", "buffer", ".", "ByteBuf", ";", "import", "io", ".", "netty", ".", "channel", ".", "ChannelHandlerContext", ";", "import", "io", ".", "netty", ".", "util", ".", "internal", ".", "ObjectUtil", ";", "/", "**", "*", "Enforce", "a", "limit", "on", "the", "maximum", "number", "of", "consecutive", "empty", "DATA", "frames", "(", "without", "end_of_stream", "flag", ")", "that", "are", "allowed", "*", "before", "the", "connection", "will", "be", "closed", ".", "*", "/", "final", "class", "Http2EmptyDataFrameListener", "extends", "Http2FrameListenerDecorator", "{", "private", "final", "int", "maxConsecutiveEmptyFrames", ";", "private", "boolean", "violationDetected", ";", "private", "int", "emptyDataFrames", ";", "Http2EmptyDataFrameListener", "(", "Http2FrameListener", "listener", ",", "int", "maxConsecutiveEmptyFrames", ")", "{", "super", "(", "listener", ")", ";", "this", ".", "maxConsecutiveEmptyFrames", "=", "ObjectUtil", ".", "checkPositive", "(", "maxConsecutiveEmptyFrames", ",", "\"", "maxConsecutiveEmptyFrames", "\"", ");", "}", "@", "Override", "public", "int", "onDataRead", "(", "ChannelHandlerContext", "ctx", ",", "int", "streamId", ",", "ByteBuf", "data", ",", "int", "padding", ",", "boolean", "endOfStream", ")", "throws", "Http2Exception", "{", "if", "(", "endOfStream", "|", "|", "data", ".", "isReadable", "(", "))", "{", "emptyDataFrames", "=", "0", ";", "}", "else", "if", "(", "emptyDataFrames", "+", "+", "=", "=", "maxConsecutiveEmptyFrames", "&", "&", "!", "violationDetected", ")", "{", "violationDetected", "=", "true", ";", "throw", "Http2Exception", ".", "connectionError", "(", "Http2Error", ".", "ENHANCE_YOUR_CALM", ",", "\"", "Maximum", "number", "%", "d", "of", "empty", "data", "frames", "without", "end_of_stream", "flag", "received", "\"", ",", "maxConsecutiveEmptyFrames", ")", ";", "}", "return", "super", ".", "onDataRead", "(", "ctx", ",", "streamId", ",", "data", ",", "padding", ",", "endOfStream", ")", ";", "}", "@", "Override", "public", "void", "onHeadersRead", "(", "ChannelHandlerContext", "ctx", ",", "int", "streamId", ",", "Http2Headers", "headers", ",", "int", "padding", ",", "boolean", "endStream", ")", "throws", "Http2Exception", "{", "emptyDataFrames", "=", "0", ";", "super", ".", "onHeadersRead", "(", "ctx", ",", "streamId", ",", "headers", ",", "padding", ",", "endStream", ")", ";", "}", "@", "Override", "public", "void", "onHeadersRead", "(", "ChannelHandlerContext", "ctx", ",", "int", "streamId", ",", "Http2Headers", "headers", ",", "int", "streamDependency", ",", "short", "weight", ",", "boolean", "exclusive", ",", "int", "padding", ",", "boolean", "endStream", ")", "throws", "Http2Exception", "{", "emptyDataFrames", "=", "0", ";", "super", ".", "onHeadersRead", "(", "ctx", ",", "streamId", ",", "headers", ",", "streamDependency", ",", "weight", ",", "exclusive", ",", "padding", ",", "endStream", ")", ";", "}", "}", "@", "@", "-", "167", ",", "6", "+", "167", ",", "16", "@", "@", "public", "Http2FrameCodecBuilder", "decoupleCloseAndGoAway", "(", "boolean", "decoupleCloseAndGoA", "return", "super", ".", "decoupleCloseAndGoAway", "(", "decoupleCloseAndGoAway", ")", ";", "}", "@", "Override", "public", "int", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", ")", "{", "return", "super", ".", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", ");", "}", "@", "Override", "public", "Http2FrameCodecBuilder", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", "int", "maxConsecutiveEmptyFrames", ")", "{", "return", "super", ".", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", "maxConsecutiveEmptyFrames", ")", ";", "}", "/", "**", "*", "Build", "a", "{", "@", "link", "Http2FrameCodec", "}", "object", ".", "*", "/", "@", "@", "-", "192", ",", "7", "+", "202", ",", "10", "@", "@", "public", "Http2FrameCodec", "build", "(", ")", "{", "}", "Http2ConnectionDecoder", "decoder", "=", "new", "DefaultHttp2ConnectionDecoder", "(", "connection", ",", "encoder", ",", "frameReader", ",", "promisedRequestVerifier", "(", "),", "isAutoAckSettingsFrame", "(", "),", "isAutoAckPingFrame", "(", "))", ";", "int", "maxConsecutiveEmptyDataFrames", "=", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", ");", "if", "(", "maxConsecutiveEmptyDataFrames", ">", "0", ")", "{", "decoder", "=", "new", "Http2EmptyDataFrameConnectionDecoder", "(", "decoder", ",", "maxConsecutiveEmptyDataFrames", ")", ";", "}", "return", "build", "(", "decoder", ",", "encoder", ",", "initialSettings", "(", "))", ";", "}", "return", "super", ".", "build", "(", ");", "@", "@", "-", "196", ",", "6", "+", "196", ",", "16", "@", "@", "public", "Http2MultiplexCodecBuilder", "decoupleCloseAndGoAway", "(", "boolean", "decoupleCloseAn", "return", "super", ".", "decoupleCloseAndGoAway", "(", "decoupleCloseAndGoAway", ")", ";", "}", "@", "Override", "public", "int", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", ")", "{", "return", "super", ".", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", ");", "}", "@", "Override", "public", "Http2MultiplexCodecBuilder", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", "int", "maxConsecutiveEmptyFrames", ")", "{", "return", "super", ".", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", "maxConsecutiveEmptyFrames", ")", ";", "}", "@", "Override", "public", "Http2MultiplexCodec", "build", "(", ")", "{", "Http2FrameWriter", "frameWriter", "=", "this", ".", "frameWriter", ";", "@", "@", "-", "219", ",", "6", "+", "229", ",", "11", "@", "@", "public", "Http2MultiplexCodec", "build", "(", ")", "{", "Http2ConnectionDecoder", "decoder", "=", "new", "DefaultHttp2ConnectionDecoder", "(", "connection", ",", "encoder", ",", "frameReader", ",", "promisedRequestVerifier", "(", "),", "isAutoAckSettingsFrame", "(", "),", "isAutoAckPingFrame", "(", "))", ";", "int", "maxConsecutiveEmptyDataFrames", "=", "decoderEnforceMaxConsecutiveEmptyDataFrames", "(", ");", "if", "(", "maxConsecutiveEmptyDataFrames", ">", "0", ")", "{", "decoder", "=", "new", "Http2EmptyDataFrameConnectionDecoder", "(", "decoder", ",", "maxConsecutiveEmptyDataFrames", ")", ";", "}", "return", "build", "(", "decoder", ",", "encoder", ",", "initialSettings", "(", "))", ";", "}", "return", "super", ".", "build", "(", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "58", "@", "@", "/", "*", "*", "Copyright", "2019", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "*", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "*", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "*", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "*", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http2", ";", "import", "org", ".", "hamcrest", ".", "CoreMatchers", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "mockito", ".", "ArgumentCaptor", ";", "import", "org", ".", "mockito", ".", "invocation", ".", "InvocationOnMock", ";", "import", "org", ".", "mockito", ".", "stubbing", ".", "Answer", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "public", "class", "Http2EmptyDataFrameConnectionDecoderTest", "{", "@", "Test", "public", "void", "testDecoration", "(", ")", "{", "Http2ConnectionDecoder", "delegate", "=", "mock", "(", "Http2ConnectionDecoder", ".", "class", ")", ";", "final", "ArgumentCaptor", "<", "Http2FrameListener", ">", "listenerArgumentCaptor", "=", "ArgumentCaptor", ".", "forClass", "(", "Http2FrameListener", ".", "class", ")", ";", "when", "(", "delegate", ".", "frameListener", "(", "))", ".", "then", "(", "new", "Answer", "<", "Http2FrameListener", ">", "()", "{", "@", "Override", "public", "Http2FrameListener", "answer", "(", "InvocationOnMock", "invocationOnMock", ")", "{", "return", "listenerArgumentCaptor", ".", "getValue", "(", ");", "}", "}", ");", "Http2FrameListener", "listener", "=", "mock", "(", "Http2FrameListener", ".", "class", ")", ";", "Http2EmptyDataFrameConnectionDecoder", "decoder", "=", "new", "Http2EmptyDataFrameConnectionDecoder", "(", "delegate", ",", "2", ")", ";", "decoder", ".", "frameListener", "(", "listener", ")", ";", "verify", "(", "delegate", ")", ".", "frameListener", "(", "listenerArgumentCaptor", ".", "capture", "(", "))", ";", "assertThat", "(", "decoder", ".", "frameListener", "(", "),", "CoreMatchers", ".", "instanceOf", "(", "Http2EmptyDataFrameListener", ".", "class", ")", ");", "}", "@", "Test", "public", "void", "testDecorationWithNull", "(", ")", "{", "Http2ConnectionDecoder", "delegate", "=", "mock", "(", "Http2ConnectionDecoder", ".", "class", ")", ";", "Http2EmptyDataFrameConnectionDecoder", "decoder", "=", "new", "Http2EmptyDataFrameConnectionDecoder", "(", "delegate", ",", "2", ")", ";", "decoder", ".", "frameListener", "(", "null", ")", ";", "assertNull", "(", "decoder", ".", "frameListener", "(", "))", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "142", "@", "@", "/", "*", "*", "Copyright", "2019", "The", "Netty", "Project", "*", "*", "The", "Netty", "Project", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "You", "may", "obtain", "a", "*", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "distributed", "under", "the", "License", "*", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "*", "or", "implied", ".", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "under", "*", "the", "License", ".", "*", "/", "package", "io", ".", "netty", ".", "handler", ".", "codec", ".", "http2", ";", "import", "io", ".", "netty", ".", "buffer", ".", "ByteBuf", ";", "import", "io", ".", "netty", ".", "buffer", ".", "Unpooled", ";", "import", "io", ".", "netty", ".", "channel", ".", "ChannelHandlerContext", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "import", "static", "org", ".", "mockito", ".", "MockitoAnnotations", ".", "initMocks", ";", "public", "class", "Http2EmptyDataFrameListenerTest", "{", "@", "Mock", "private", "Http2FrameListener", "frameListener", ";", "@", "Mock", "private", "ChannelHandlerContext", "ctx", ";", "@", "Mock", "private", "ByteBuf", "nonEmpty", ";", "private", "Http2EmptyDataFrameListener", "listener", ";", "@", "Before", "public", "void", "setUp", "(", ")", "{", "initMocks", "(", "this", ")", ";", "when", "(", "nonEmpty", ".", "isReadable", "(", "))", ".", "thenReturn", "(", "true", ")", ";", "listener", "=", "new", "Http2EmptyDataFrameListener", "(", "frameListener", ",", "2", ")", ";", "}", "@", "Test", "public", "void", "testEmptyDataFrames", "(", ")", "throws", "Http2Exception", "{", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "try", "{", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "fail", "(", ");", "}", "catch", "(", "Http2Exception", "expected", ")", "{", "/", "/", "expected", "}", "verify", "(", "frameListener", ",", "times", "(", "2", ")", ").", "onDataRead", "(", "eq", "(", "ctx", ")", ",", "eq", "(", "1", ")", ",", "any", "(", "ByteBuf", ".", "class", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testEmptyDataFramesWithNonEmptyInBetween", "(", ")", "throws", "Http2Exception", "{", "Http2EmptyDataFrameListener", "listener", "=", "new", "Http2EmptyDataFrameListener", "(", "frameListener", ",", "2", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "nonEmpty", ",", "0", ",", "false", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "try", "{", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "fail", "(", ");", "}", "catch", "(", "Http2Exception", "expected", ")", "{", "/", "/", "expected", "}", "verify", "(", "frameListener", ",", "times", "(", "4", ")", ").", "onDataRead", "(", "eq", "(", "ctx", ")", ",", "eq", "(", "1", ")", ",", "any", "(", "ByteBuf", ".", "class", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testEmptyDataFramesWithEndOfStreamInBetween", "(", ")", "throws", "Http2Exception", "{", "Http2EmptyDataFrameListener", "listener", "=", "new", "Http2EmptyDataFrameListener", "(", "frameListener", ",", "2", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "true", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "try", "{", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "fail", "(", ");", "}", "catch", "(", "Http2Exception", "expected", ")", "{", "/", "/", "expected", "}", "verify", "(", "frameListener", ",", "times", "(", "1", ")", ").", "onDataRead", "(", "eq", "(", "ctx", ")", ",", "eq", "(", "1", ")", ",", "any", "(", "ByteBuf", ".", "class", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "true", ")", ");", "verify", "(", "frameListener", ",", "times", "(", "3", ")", ").", "onDataRead", "(", "eq", "(", "ctx", ")", ",", "eq", "(", "1", ")", ",", "any", "(", "ByteBuf", ".", "class", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testEmptyDataFramesWithHeaderFrameInBetween", "(", ")", "throws", "Http2Exception", "{", "Http2EmptyDataFrameListener", "listener", "=", "new", "Http2EmptyDataFrameListener", "(", "frameListener", ",", "2", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onHeadersRead", "(", "ctx", ",", "1", ",", "EmptyHttp2Headers", ".", "INSTANCE", ",", "0", ",", "true", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "try", "{", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "fail", "(", ");", "}", "catch", "(", "Http2Exception", "expected", ")", "{", "/", "/", "expected", "}", "verify", "(", "frameListener", ",", "times", "(", "1", ")", ").", "onHeadersRead", "(", "eq", "(", "ctx", ")", ",", "eq", "(", "1", ")", ",", "eq", "(", "EmptyHttp2Headers", ".", "INSTANCE", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "true", ")", ");", "verify", "(", "frameListener", ",", "times", "(", "3", ")", ").", "onDataRead", "(", "eq", "(", "ctx", ")", ",", "eq", "(", "1", ")", ",", "any", "(", "ByteBuf", ".", "class", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "testEmptyDataFramesWithHeaderFrameInBetween2", "(", ")", "throws", "Http2Exception", "{", "Http2EmptyDataFrameListener", "listener", "=", "new", "Http2EmptyDataFrameListener", "(", "frameListener", ",", "2", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onHeadersRead", "(", "ctx", ",", "1", ",", "EmptyHttp2Headers", ".", "INSTANCE", ",", "0", ",", "(", "short", ")", "0", ",", "false", ",", "0", ",", "true", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "try", "{", "listener", ".", "onDataRead", "(", "ctx", ",", "1", ",", "Unpooled", ".", "EMPTY_BUFFER", ",", "0", ",", "false", ")", ";", "fail", "(", ");", "}", "catch", "(", "Http2Exception", "expected", ")", "{", "/", "/", "expected", "}", "verify", "(", "frameListener", ",", "times", "(", "1", ")", ").", "onHeadersRead", "(", "eq", "(", "ctx", ")", ",", "eq", "(", "1", ")", ",", "eq", "(", "EmptyHttp2Headers", ".", "INSTANCE", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "(", "short", ")", "0", ")", ",", "eq", "(", "false", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "true", ")", ");", "verify", "(", "frameListener", ",", "times", "(", "3", ")", ").", "onDataRead", "(", "eq", "(", "ctx", ")", ",", "eq", "(", "1", ")", ",", "any", "(", "ByteBuf", ".", "class", ")", ",", "eq", "(", "0", ")", ",", "eq", "(", "false", ")", ");", "}", "}"], "docstring_tokens": ["frame", "flooding"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "210", ",", "16", "+", "210", ",", "18", "@", "@", "static", "char", "*", "php_session_encode", "(", "int", "*", "newlen", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "}", "/", "*", "}", "}}", "*", "/", "static", "void", "php_session_decode", "(", "const", "char", "*", "val", ",", "int", "vallen", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "static", "int", "php_session_decode", "(", "const", "char", "*", "val", ",", "int", "vallen", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "if", "(", "!", "PS", "(", "serializer", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Unknown", "session", ".", "serialize_handler", ".", "Failed", "to", "decode", "session", "object", "\"", ");", "return", ";", "return", "FAILURE", ";", "}", "if", "(", "PS", "(", "serializer", ")", "->", "decode", "(", "val", ",", "vallen", "TSRMLS_CC", ")", "=", "=", "FAILURE", ")", "{", "php_session_destroy", "(", "TSRMLS_C", ")", ";", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Failed", "to", "decode", "session", "object", ".", "Session", "has", "been", "destroyed", "\"", ");", "return", "FAILURE", ";", "}", "return", "SUCCESS", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "413", ",", "7", "+", "415", ",", "7", "@", "@", "PHPAPI", "char", "*", "php_session_create_id", "(", "PS_CREATE_SID_ARGS", ")", "/", "*", "{", "{{", "*", "/", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "The", "ini", "setting", "hash_bits_per_character", "is", "out", "of", "range", "(", "should", "be", "4", ",", "5", ",", "or", "6", ")", "-", "using", "4", "for", "now", "\"", ");", "}", "outid", "=", "emalloc", "(", "(", "size_t", ")", "((", "digest_len", "+", "2", ")", "*", "(", "(", "8", ".", "0f", "/", "PS", "(", "hash_bits_per_character", ")", ")", "+", "0", ".", "5", ")", "))", ";", "j", "=", "(", "int", ")", "(", "bin_to_readable", "(", "(", "char", "*", ")", "digest", ",", "digest_len", ",", "outid", ",", "(", "char", ")", "PS", "(", "hash_bits_per_character", ")", ")", "-", "outid", ")", ";", "efree", "(", "digest", ")", ";", "@", "@", "-", "855", ",", "8", "+", "857", ",", "11", "@", "@", "PS_SERIALIZER_DECODE_FUNC", "(", "php_binary", ")", "/", "*", "{", "{{", "*", "/", "ALLOC_INIT_ZVAL", "(", "current", ")", ";", "if", "(", "php_var_unserialize", "(", "&", "current", ",", "(", "const", "unsigned", "char", "*", "*)", "&", "p", ",", "(", "const", "unsigned", "char", "*", ")", "endptr", ",", "&", "var_hash", "TSRMLS_CC", ")", ")", "{", "php_set_session_var", "(", "name", ",", "namelen", ",", "current", ",", "&", "var_hash", "TSRMLS_CC", ")", ";", "}", "else", "{", "PHP_VAR_UNSERIALIZE_DESTROY", "(", "var_hash", ")", ";", "return", "FAILURE", ";", "}", "zval_ptr_dtor", "(", "&", "current", ")", ";", "var_push_dtor_no_addref", "(", "&", "var_hash", ",", "&", "current", ")", ";", "}", "PS_ADD_VARL", "(", "name", ",", "namelen", ")", ";", "efree", "(", "name", ")", ";", "@", "@", "-", "947", ",", "8", "+", "952", ",", "13", "@", "@", "PS_SERIALIZER_DECODE_FUNC", "(", "php", ")", "/", "*", "{", "{{", "*", "/", "ALLOC_INIT_ZVAL", "(", "current", ")", ";", "if", "(", "php_var_unserialize", "(", "&", "current", ",", "(", "const", "unsigned", "char", "*", "*)", "&", "q", ",", "(", "const", "unsigned", "char", "*", ")", "endptr", ",", "&", "var_hash", "TSRMLS_CC", ")", ")", "{", "php_set_session_var", "(", "name", ",", "namelen", ",", "current", ",", "&", "var_hash", "TSRMLS_CC", ")", ";", "}", "else", "{", "var_push_dtor_no_addref", "(", "&", "var_hash", ",", "&", "current", ")", ";", "efree", "(", "name", ")", ";", "PHP_VAR_UNSERIALIZE_DESTROY", "(", "var_hash", ")", ";", "return", "FAILURE", ";", "}", "zval_ptr_dtor", "(", "&", "current", ")", ";", "var_push_dtor_no_addref", "(", "&", "var_hash", ",", "&", "current", ")", ";", "}", "PS_ADD_VARL", "(", "name", ",", "namelen", ")", ";", "skip", ":", "@", "@", "-", "1744", ",", "7", "+", "1754", ",", "7", "@", "@", "static", "PHP_FUNCTION", "(", "session_set_save_handler", ")", "}", "efree", "(", "name", ")", ";", "}", "if", "(", "PS", "(", "mod", ")", "&", "&", "PS", "(", "mod", ")", "!", "=", "&", "ps_mod_user", ")", "{", "zend_alter_ini_entry", "(", "\"", "session", ".", "save_handler", "\"", ",", "sizeof", "(", "\"", "session", ".", "save_handler", "\"", "),", "\"", "user", "\"", ",", "sizeof", "(", "\"", "user", "\"", ")-", "1", ",", "PHP_INI_USER", ",", "PHP_INI_STAGE_RUNTIME", ")", ";", "}", "@", "@", "-", "1922", ",", "9", "+", "1932", ",", "7", "@", "@", "static", "PHP_FUNCTION", "(", "session_decode", ")", "return", ";", "}", "php_session_decode", "(", "str", ",", "str_len", "TSRMLS_CC", ")", ";", "RETURN_TRUE", ";", "RETVAL_BOOL", "(", "php_session_decode", "(", "str", ",", "str_len", "TSRMLS_CC", ")", "=", "=", "SUCCESS", ")", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "2516", ",", "12", "+", "2524", ",", "12", "@", "@", "static", "int", "php_session_rfc1867_callback", "(", "unsigned", "int", "event", ",", "void", "*", "event_data", ",", "vo", "case", "MULTIPART_EVENT_FILE_START", ":", "{", "multipart_event_file_start", "*", "data", "=", "(", "multipart_event_file_start", "*", ")", "event_data", ";", "/", "*", "Do", "nothing", "when", "$", "_POST", "[", "\"", "PHP_SESSION_UPLOAD_PROGRESS", "\"", "]", "is", "not", "set", "/", "*", "Do", "nothing", "when", "$", "_POST", "[", "\"", "PHP_SESSION_UPLOAD_PROGRESS", "\"", "]", "is", "not", "set", "*", "or", "when", "we", "have", "no", "session", "id", "*", "/", "if", "(", "!", "Z_TYPE", "(", "progress", "-", ">", "sid", ")", "|", "|", "!", "progress", "-", ">", "key", ".", "c", ")", "{", "break", ";", "}", "/", "*", "First", "FILE_START", "event", ",", "initializing", "data", "*", "/", "if", "(", "!", "progress", "-", ">", "data", ")", "{", "@", "@", "-", "2571", ",", "7", "+", "2579", ",", "7", "@", "@", "static", "int", "php_session_rfc1867_callback", "(", "unsigned", "int", "event", ",", "void", "*", "event_data", ",", "vo", "add_assoc_zval_ex", "(", "progress", "-", ">", "current_file", ",", "\"", "bytes_processed", "\"", ",", "sizeof", "(", "\"", "bytes_processed", "\"", "),", "progress", "-", ">", "current_file_bytes_processed", ")", ";", "add_next_index_zval", "(", "progress", "-", ">", "files", ",", "progress", "-", ">", "current_file", ")", ";", "Z_LVAL_P", "(", "progress", "-", ">", "post_bytes_processed", ")", "=", "data", "-", ">", "post_bytes_processed", ";", "php_session_rfc1867_update", "(", "progress", ",", "0", "TSRMLS_CC", ")", ";", "@", "@", "-", "2583", ",", "7", "+", "2591", ",", "7", "@", "@", "static", "int", "php_session_rfc1867_callback", "(", "unsigned", "int", "event", ",", "void", "*", "event_data", ",", "vo", "if", "(", "!", "Z_TYPE", "(", "progress", "-", ">", "sid", ")", "|", "|", "!", "progress", "-", ">", "key", ".", "c", ")", "{", "break", ";", "}", "Z_LVAL_P", "(", "progress", "-", ">", "current_file_bytes_processed", ")", "=", "data", "-", ">", "offset", "+", "data", "-", ">", "length", ";", "Z_LVAL_P", "(", "progress", "-", ">", "post_bytes_processed", ")", "=", "data", "-", ">", "post_bytes_processed", ";", "@", "@", "-", "2596", ",", "7", "+", "2604", ",", "7", "@", "@", "static", "int", "php_session_rfc1867_callback", "(", "unsigned", "int", "event", ",", "void", "*", "event_data", ",", "vo", "if", "(", "!", "Z_TYPE", "(", "progress", "-", ">", "sid", ")", "|", "|", "!", "progress", "-", ">", "key", ".", "c", ")", "{", "break", ";", "}", "if", "(", "data", "-", ">", "temp_filename", ")", "{", "add_assoc_string_ex", "(", "progress", "-", ">", "current_file", ",", "\"", "tmp_name", "\"", ",", "sizeof", "(", "\"", "tmp_name", "\"", "),", "data", "-", ">", "temp_filename", ",", "1", ")", ";", "}", "@", "@", "-", "53", ",", "563", "+", "53", ",", "247", "@", "@", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "4", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "Warning", ":", "session_decode", "(", "):", "Failed", "to", "decode", "session", "object", ".", "Session", "has", "been", "destroyed", "in", "%", "s", "/", "session_decode_error2", ".", "php", "on", "line", "%", "d", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "5", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "6", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "7", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "8", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "9", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "10", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "11", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "12", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "13", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "14", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "15", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "16", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "17", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "18", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "19", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "20", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "21", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "22", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "23", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "24", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "25", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "26", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "27", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "28", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "29", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "30", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "31", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "32", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "33", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "34", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "35", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "36", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "37", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "38", "bool", "(", "true", ")", "array", "(", "1", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "39", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "40", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "41", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "42", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "43", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "44", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "45", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "46", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "47", "bool", "(", "true", ")", "array", "(", "2", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "48", "bool", "(", "true", ")", "array", "(", "3", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "blah", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "49", "bool", "(", "true", ")", "array", "(", "3", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "blah", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "50", "bool", "(", "true", ")", "array", "(", "3", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "blah", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "-", "-", "Iteration", "51", "bool", "(", "true", ")", "array", "(", "3", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "guff", "\"", "]=", ">", "&", "array", "(", "3", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "[", "1", "]", "=>", "int", "(", "2", ")", "[", "2", "]", "=>", "int", "(", "3", ")", "}", "[", "\"", "blah", "\"", "]=", ">", "NULL", "bool", "(", "false", ")", "array", "(", "0", ")", "{", "}", "bool", "(", "true", ")", "Done", "Warning", ":", "session_destroy", "(", "):", "Trying", "to", "destroy", "uninitialized", "session", "in", "%", "s", "/", "session_decode_error2", ".", "php", "on", "line", "%", "d", "bool", "(", "false", ")", "Done", "@", "@", "-", "49", ",", "7", "+", "49", ",", "7", "@", "@", "array", "(", "3", ")", "{", "}", "Warning", ":", "session_decode", "(", "):", "Unknown", "session", ".", "serialize_handler", ".", "Failed", "to", "decode", "session", "object", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "true", ")", "bool", "(", "false", ")", "array", "(", "3", ")", "{", "[", "\"", "foo", "\"", "]=", ">", "int", "(", "1234567890", ")", "@", "@", "-", "0", ",", "0", "+", "1", ",", "38", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "70219", "Use", "after", "free", "vulnerability", "in", "session", "deserializer", "-", "-", "FILE", "-", "-", "<", "?", "php", "class", "obj", "implements", "Serializable", "{", "var", "$", "data", ";", "function", "serialize", "(", ")", "{", "return", "serialize", "(", "$", "this", "-", ">", "data", ")", ";", "}", "function", "unserialize", "(", "$", "data", ")", "{", "session_start", "(", ");", "session_decode", "(", "$", "data", ")", ";", "}", "}", "$", "inner", "=", "'", "ryat", "|", "a", ":", "1", ":", "{", "i", ":", "0", ";", "a", ":", "1", ":", "{", "i", ":", "1", ";", "';", "$", "exploit", "=", "'", "a", ":", "2", ":", "{", "i", ":", "0", ";", "C", ":", "3", ":", "\"", "obj", "\"", ":'", ".", "strlen", "(", "$", "inner", ")", ".'", ":{", "'.", "$", "inner", ".", "'}", "i", ":", "1", ";", "R", ":", "4", ";", "}'", ";", "$", "data", "=", "unserialize", "(", "$", "exploit", ")", ";", "for", "(", "$", "i", "=", "0", ";", "$", "i", "<", "5", ";", "$", "i", "+", "+)", "{", "$", "v", "[", "$", "i", "]", "=", "'", "hi", "'", ".$", "i", ";", "}", "var_dump", "(", "$", "data", ")", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "Warning", ":", "session_decode", "(", "):", "Failed", "to", "decode", "session", "object", ".", "Session", "has", "been", "destroyed", "in", "%", "s", "on", "line", "%", "d", "array", "(", "2", ")", "{", "[", "0", "]", "=>", "object", "(", "obj", ")", "#%", "d", "(", "1", ")", "{", "[", "\"", "data", "\"", "]=", ">", "NULL", "}", "[", "1", "]", "=>", "array", "(", "0", ")", "{", "}", "}", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "7", ".", "5", "on", "Tue", "Mar", "17", "13", ":", "14", ":", "30", "2015", "*", "/", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "7", ".", "5", "on", "Sun", "Aug", "23", "19", ":", "50", ":", "03", "2015", "*", "/", "#", "line", "1", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "/", "*", "+", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "@", "@", "-", "92", ",", "7", "+", "92", ",", "13", "@", "@", "PHPAPI", "void", "var_push_dtor", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "PHPAPI", "void", "var_push_dtor_no_addref", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "{", "var_entries", "*", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "last_dtor", ";", "var_entries", "*", "var_hash", ";", "if", "(", "!", "var_hashx", "|", "|", "!", "*", "var_hashx", ")", "{", "return", ";", "}", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "last_dtor", ";", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_push_dtor_no_addref", "(", "%", "ld", ")", ":", "%", "d", "(", "%", "d", ")", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ",", "Z_TYPE_PP", "(", "rval", ")", ",", "Z_REFCOUNT_PP", "(", "rval", ")", ");", "#", "endif", "@", "@", "-", "121", ",", "7", "+", "127", ",", "7", "@", "@", "PHPAPI", "void", "var_replace", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "ozval", ",", "zval", "*", "*", "n", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_replace", "(", "%", "ld", ")", ":", "%", "d", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ",", "Z_TYPE_PP", "(", "nzval", ")", ");", "#", "endif", "while", "(", "var_hash", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "var_hash", "-", ">", "used_slots", ";", "i", "+", "+)", "{", "if", "(", "var_hash", "-", ">", "data", "[", "i", "]", "=", "=", "ozval", ")", "{", "@", "@", "-", "139", ",", "7", "+", "145", ",", "7", "@", "@", "static", "int", "var_access", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "long", "id", ",", "zval", "*", "**", "store", ")", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_access", "(", "%", "ld", ")", ":", "%", "ld", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ",", "id", ")", ";", "#", "endif", "while", "(", "id", ">", "=", "VAR_ENTRIES_MAX", "&", "&", "var_hash", "&", "&", "var_hash", "-", ">", "used_slots", "=", "=", "VAR_ENTRIES_MAX", ")", "{", "var_hash", "=", "var_hash", "-", ">", "next", ";", "id", "-", "=", "VAR_ENTRIES_MAX", ";", "@", "@", "-", "162", ",", "15", "+", "168", ",", "15", "@", "@", "PHPAPI", "void", "var_destroy", "(", "php_unserialize_data_t", "*", "var_hashx", ")", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_destroy", "(", "%", "ld", ")", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ")", ";", "#", "endif", "while", "(", "var_hash", ")", "{", "next", "=", "var_hash", "-", ">", "next", ";", "efree", "(", "var_hash", ")", ";", "var_hash", "=", "next", ";", "}", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "first_dtor", ";", "while", "(", "var_hash", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "var_hash", "-", ">", "used_slots", ";", "i", "+", "+)", "{", "zval_ptr_dtor", "(", "&", "var_hash", "-", ">", "data", "[", "i", "]", ");", "@", "@", "-", "233", ",", "7", "+", "239", ",", "7", "@", "@", "static", "char", "*", "unserialize_str", "(", "const", "unsigned", "char", "*", "*", "p", ",", "size_t", "*", "len", ",", "size_t", "maxlen", "#", "define", "YYMARKER", "marker", "#", "line", "241", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "247", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "@", "@", "-", "251", ",", "7", "+", "257", ",", "7", "@", "@", "static", "inline", "long", "parse_iv2", "(", "const", "unsigned", "char", "*", "p", ",", "const", "unsigned", "char", "*", "*", "q", ")", "case", "'", "+'", ":", "p", "+", "+;", "}", "while", "(", "1", ")", "{", "cursor", "=", "(", "char", ")", "*", "p", ";", "if", "(", "cursor", ">", "=", "'", "0", "'", "&", "&", "cursor", "<", "=", "'", "9", "'", ")", "{", "@", "@", "-", "280", ",", "7", "+", "286", ",", "7", "@", "@", "static", "inline", "size_t", "parse_uiv", "(", "const", "unsigned", "char", "*", "p", ")", "if", "(", "*", "p", "=", "=", "'", "+'", ")", "{", "p", "+", "+;", "}", "while", "(", "1", ")", "{", "cursor", "=", "*", "p", ";", "if", "(", "cursor", ">", "=", "'", "0", "'", "&", "&", "cursor", "<", "=", "'", "9", "'", ")", "{", "@", "@", "-", "304", ",", "24", "+", "310", ",", "20", "@", "@", "static", "inline", "int", "process_nested_data", "(", "UNSERIALIZE_PARAMETER", ",", "HashTable", "*", "ht", ",", "long", "ALLOC_INIT_ZVAL", "(", "key", ")", ";", "if", "(", "!", "php_var_unserialize", "(", "&", "key", ",", "p", ",", "max", ",", "NULL", "TSRMLS_CC", ")", ")", "{", "zval_dtor", "(", "key", ")", ";", "FREE_ZVAL", "(", "key", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "key", ")", ";", "return", "0", ";", "}", "if", "(", "Z_TYPE_P", "(", "key", ")", "!", "=", "IS_LONG", "&", "&", "Z_TYPE_P", "(", "key", ")", "!", "=", "IS_STRING", ")", "{", "zval_dtor", "(", "key", ")", ";", "FREE_ZVAL", "(", "key", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "key", ")", ";", "return", "0", ";", "}", "ALLOC_INIT_ZVAL", "(", "data", ")", ";", "if", "(", "!", "php_var_unserialize", "(", "&", "data", ",", "p", ",", "max", ",", "var_hash", "TSRMLS_CC", ")", ")", "{", "zval_dtor", "(", "key", ")", ";", "FREE_ZVAL", "(", "key", ")", ";", "zval_dtor", "(", "data", ")", ";", "FREE_ZVAL", "(", "data", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "key", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "data", ")", ";", "return", "0", ";", "}", "@", "@", "-", "350", ",", "9", "+", "352", ",", "7", "@", "@", "static", "inline", "int", "process_nested_data", "(", "UNSERIALIZE_PARAMETER", ",", "HashTable", "*", "ht", ",", "long", "sizeof", "data", ",", "NULL", ")", ";", "}", "var_push_dtor", "(", "var_hash", ",", "&", "data", ")", ";", "zval_dtor", "(", "key", ")", ";", "FREE_ZVAL", "(", "key", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "key", ")", ";", "if", "(", "elements", "&", "&", "*", "(*", "p", "-", "1", ")", "!", "=", "'", ";'", "&", "&", "*", "(*", "p", "-", "1", ")", "!", "=", "'", "}'", ")", "{", "(", "*", "p", ")", "--", ";", "@", "@", "-", "402", ",", "11", "+", "402", ",", "11", "@", "@", "static", "inline", "int", "object_custom", "(", "UNSERIALIZE_PARAMETER", ",", "zend_class_entry", "*", "ce", ")", "static", "inline", "long", "object_common1", "(", "UNSERIALIZE_PARAMETER", ",", "zend_class_entry", "*", "ce", ")", "{", "long", "elements", ";", "elements", "=", "parse_iv2", "(", "(*", "p", ")", "+", "2", ",", "p", ")", ";", "(", "*", "p", ")", "+", "=", "2", ";", "/", "*", "The", "internal", "class", "check", "here", "is", "a", "BC", "fix", "only", ",", "userspace", "classes", "implementing", "the", "Serializable", "interface", "have", "eventually", "an", "inconsistent", "behavior", "at", "this", "place", "when", "unserialized", "from", "a", "manipulated", "string", ".", "Additionaly", "the", "interal", "classes", "can", "possibly", "@", "@", "-", "470", ",", "19", "+", "470", ",", "19", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "limit", "=", "max", ";", "cursor", "=", "*", "p", ";", "if", "(", "YYCURSOR", ">", "=", "YYLIMIT", ")", "{", "return", "0", ";", "}", "if", "(", "var_hash", "&", "&", "cursor", "[", "0", "]", "!", "=", "'", "R", "'", ")", "{", "var_push", "(", "var_hash", ",", "rval", ")", ";", "}", "start", "=", "cursor", ";", "#", "line", "488", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "{", "@", "@", "-", "645", ",", "7", "+", "645", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "if", "(", "*", "start", "=", "=", "'", "C", "'", ")", "{", "custom_object", "=", "1", ";", "}", "INIT_PZVAL", "(", "*", "rval", ")", ";", "len2", "=", "len", "=", "parse_uiv", "(", "start", "+", "2", ")", ";", "maxlen", "=", "max", "-", "YYCURSOR", ";", "@", "@", "-", "694", ",", "14", "+", "694", ",", "14", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "efree", "(", "class_name", ")", ";", "return", "0", ";", "}", "/", "*", "Check", "for", "unserialize", "callback", "*", "/", "if", "(", "(", "PG", "(", "unserialize_callback_func", ")", "=", "=", "NULL", ")", "|", "|", "(", "PG", "(", "unserialize_callback_func", ")", "[", "0", "]", "=", "=", "'", "\\", "0", "'", "))", "{", "incomplete_class", "=", "1", ";", "ce", "=", "PHP_IC_ENTRY", ";", "break", ";", "}", "/", "*", "Call", "unserialize", "callback", "*", "/", "MAKE_STD_ZVAL", "(", "user_func", ")", ";", "ZVAL_STRING", "(", "user_func", ",", "PG", "(", "unserialize_callback_func", ")", ",", "1", ")", ";", "@", "@", "-", "734", ",", "7", "+", "734", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "return", "0", ";", "}", "/", "*", "The", "callback", "function", "may", "have", "defined", "the", "class", "*", "/", "if", "(", "zend_lookup_class", "(", "class_name", ",", "len2", ",", "&", "pce", "TSRMLS_CC", ")", "=", "=", "SUCCESS", ")", "{", "ce", "=", "*", "pce", ";", "@", "@", "-", "762", ",", "7", "+", "762", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "efree", "(", "class_name", ")", ";", "return", "ret", ";", "}", "elements", "=", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ce", ")", ";", "if", "(", "incomplete_class", ")", "{", "@", "@", "-", "801", ",", "7", "+", "801", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "{", "INIT_PZVAL", "(", "*", "rval", ")", ";", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ZEND_STANDARD_CLASS_DEF_PTR", ")", ");", "}", "@", "@", "-", "1239", ",", "7", "+", "1239", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "*", "rval", "=", "*", "rval_ref", ";", "Z_ADDREF_PP", "(", "rval", ")", ";", "Z_UNSET_ISREF_PP", "(", "rval", ")", ";", "return", "1", ";", "}", "#", "line", "1246", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "@", "@", "-", "1283", ",", "7", "+", "1283", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "*", "rval", "=", "*", "rval_ref", ";", "Z_ADDREF_PP", "(", "rval", ")", ";", "Z_SET_ISREF_PP", "(", "rval", ")", ";", "return", "1", ";", "}", "#", "line", "1290", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "@", "@", "-", "90", ",", "7", "+", "90", ",", "13", "@", "@", "PHPAPI", "void", "var_push_dtor", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "PHPAPI", "void", "var_push_dtor_no_addref", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "*", "rval", ")", "{", "var_entries", "*", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "last_dtor", ";", "var_entries", "*", "var_hash", ";", "if", "(", "!", "var_hashx", "|", "|", "!", "*", "var_hashx", ")", "{", "return", ";", "}", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "last_dtor", ";", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_push_dtor_no_addref", "(", "%", "ld", ")", ":", "%", "d", "(", "%", "d", ")", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ",", "Z_TYPE_PP", "(", "rval", ")", ",", "Z_REFCOUNT_PP", "(", "rval", ")", ");", "#", "endif", "@", "@", "-", "119", ",", "7", "+", "125", ",", "7", "@", "@", "PHPAPI", "void", "var_replace", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "zval", "*", "ozval", ",", "zval", "*", "*", "n", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_replace", "(", "%", "ld", ")", ":", "%", "d", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ",", "Z_TYPE_PP", "(", "nzval", ")", ");", "#", "endif", "while", "(", "var_hash", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "var_hash", "-", ">", "used_slots", ";", "i", "+", "+)", "{", "if", "(", "var_hash", "-", ">", "data", "[", "i", "]", "=", "=", "ozval", ")", "{", "@", "@", "-", "137", ",", "7", "+", "143", ",", "7", "@", "@", "static", "int", "var_access", "(", "php_unserialize_data_t", "*", "var_hashx", ",", "long", "id", ",", "zval", "*", "**", "store", ")", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_access", "(", "%", "ld", ")", ":", "%", "ld", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ",", "id", ")", ";", "#", "endif", "while", "(", "id", ">", "=", "VAR_ENTRIES_MAX", "&", "&", "var_hash", "&", "&", "var_hash", "-", ">", "used_slots", "=", "=", "VAR_ENTRIES_MAX", ")", "{", "var_hash", "=", "var_hash", "-", ">", "next", ";", "id", "-", "=", "VAR_ENTRIES_MAX", ";", "@", "@", "-", "160", ",", "15", "+", "166", ",", "15", "@", "@", "PHPAPI", "void", "var_destroy", "(", "php_unserialize_data_t", "*", "var_hashx", ")", "#", "if", "VAR_ENTRIES_DBG", "fprintf", "(", "stderr", ",", "\"", "var_destroy", "(", "%", "ld", ")", "\\", "n", "\"", ",", "var_hash", "?", "var_hash", "-", ">", "used_slots", ":", "-", "1L", ")", ";", "#", "endif", "while", "(", "var_hash", ")", "{", "next", "=", "var_hash", "-", ">", "next", ";", "efree", "(", "var_hash", ")", ";", "var_hash", "=", "next", ";", "}", "var_hash", "=", "(", "*", "var_hashx", ")", "->", "first_dtor", ";", "while", "(", "var_hash", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "var_hash", "-", ">", "used_slots", ";", "i", "+", "+)", "{", "zval_ptr_dtor", "(", "&", "var_hash", "-", ">", "data", "[", "i", "]", ");", "@", "@", "-", "255", ",", "7", "+", "261", ",", "7", "@", "@", "static", "inline", "long", "parse_iv2", "(", "const", "unsigned", "char", "*", "p", ",", "const", "unsigned", "char", "*", "*", "q", ")", "case", "'", "+'", ":", "p", "+", "+;", "}", "while", "(", "1", ")", "{", "cursor", "=", "(", "char", ")", "*", "p", ";", "if", "(", "cursor", ">", "=", "'", "0", "'", "&", "&", "cursor", "<", "=", "'", "9", "'", ")", "{", "@", "@", "-", "284", ",", "7", "+", "290", ",", "7", "@", "@", "static", "inline", "size_t", "parse_uiv", "(", "const", "unsigned", "char", "*", "p", ")", "if", "(", "*", "p", "=", "=", "'", "+'", ")", "{", "p", "+", "+;", "}", "while", "(", "1", ")", "{", "cursor", "=", "*", "p", ";", "if", "(", "cursor", ">", "=", "'", "0", "'", "&", "&", "cursor", "<", "=", "'", "9", "'", ")", "{", "@", "@", "-", "308", ",", "24", "+", "314", ",", "20", "@", "@", "static", "inline", "int", "process_nested_data", "(", "UNSERIALIZE_PARAMETER", ",", "HashTable", "*", "ht", ",", "long", "ALLOC_INIT_ZVAL", "(", "key", ")", ";", "if", "(", "!", "php_var_unserialize", "(", "&", "key", ",", "p", ",", "max", ",", "NULL", "TSRMLS_CC", ")", ")", "{", "zval_dtor", "(", "key", ")", ";", "FREE_ZVAL", "(", "key", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "key", ")", ";", "return", "0", ";", "}", "if", "(", "Z_TYPE_P", "(", "key", ")", "!", "=", "IS_LONG", "&", "&", "Z_TYPE_P", "(", "key", ")", "!", "=", "IS_STRING", ")", "{", "zval_dtor", "(", "key", ")", ";", "FREE_ZVAL", "(", "key", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "key", ")", ";", "return", "0", ";", "}", "ALLOC_INIT_ZVAL", "(", "data", ")", ";", "if", "(", "!", "php_var_unserialize", "(", "&", "data", ",", "p", ",", "max", ",", "var_hash", "TSRMLS_CC", ")", ")", "{", "zval_dtor", "(", "key", ")", ";", "FREE_ZVAL", "(", "key", ")", ";", "zval_dtor", "(", "data", ")", ";", "FREE_ZVAL", "(", "data", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "key", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "data", ")", ";", "return", "0", ";", "}", "@", "@", "-", "354", ",", "9", "+", "356", ",", "7", "@", "@", "static", "inline", "int", "process_nested_data", "(", "UNSERIALIZE_PARAMETER", ",", "HashTable", "*", "ht", ",", "long", "sizeof", "data", ",", "NULL", ")", ";", "}", "var_push_dtor", "(", "var_hash", ",", "&", "data", ")", ";", "zval_dtor", "(", "key", ")", ";", "FREE_ZVAL", "(", "key", ")", ";", "var_push_dtor_no_addref", "(", "var_hash", ",", "&", "key", ")", ";", "if", "(", "elements", "&", "&", "*", "(*", "p", "-", "1", ")", "!", "=", "'", ";'", "&", "&", "*", "(*", "p", "-", "1", ")", "!", "=", "'", "}'", ")", "{", "(", "*", "p", ")", "--", ";", "@", "@", "-", "406", ",", "11", "+", "406", ",", "11", "@", "@", "static", "inline", "int", "object_custom", "(", "UNSERIALIZE_PARAMETER", ",", "zend_class_entry", "*", "ce", ")", "static", "inline", "long", "object_common1", "(", "UNSERIALIZE_PARAMETER", ",", "zend_class_entry", "*", "ce", ")", "{", "long", "elements", ";", "elements", "=", "parse_iv2", "(", "(*", "p", ")", "+", "2", ",", "p", ")", ";", "(", "*", "p", ")", "+", "=", "2", ";", "/", "*", "The", "internal", "class", "check", "here", "is", "a", "BC", "fix", "only", ",", "userspace", "classes", "implementing", "the", "Serializable", "interface", "have", "eventually", "an", "inconsistent", "behavior", "at", "this", "place", "when", "unserialized", "from", "a", "manipulated", "string", ".", "Additionaly", "the", "interal", "classes", "can", "possibly", "@", "@", "-", "474", ",", "19", "+", "474", ",", "19", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "limit", "=", "max", ";", "cursor", "=", "*", "p", ";", "if", "(", "YYCURSOR", ">", "=", "YYLIMIT", ")", "{", "return", "0", ";", "}", "if", "(", "var_hash", "&", "&", "cursor", "[", "0", "]", "!", "=", "'", "R", "'", ")", "{", "var_push", "(", "var_hash", ",", "rval", ")", ";", "}", "start", "=", "cursor", ";", "/", "*!", "re2c", "\"", "R", ":", "\"", "iv", "\"", ";\"", "{", "@", "@", "-", "506", ",", "7", "+", "506", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "*", "rval", "=", "*", "rval_ref", ";", "Z_ADDREF_PP", "(", "rval", ")", ";", "Z_SET_ISREF_PP", "(", "rval", ")", ";", "return", "1", ";", "}", "@", "@", "-", "529", ",", "7", "+", "529", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "*", "rval", "=", "*", "rval_ref", ";", "Z_ADDREF_PP", "(", "rval", ")", ";", "Z_UNSET_ISREF_PP", "(", "rval", ")", ";", "return", "1", ";", "}", "@", "@", "-", "679", ",", "7", "+", "679", ",", "7", "@", "@", "use_double", ":", "\"", "o", ":", "\"", "iv", "\"", ":\"", "[", "\"]", "{", "INIT_PZVAL", "(", "*", "rval", ")", ";", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ZEND_STANDARD_CLASS_DEF_PTR", ")", ");", "}", "@", "@", "-", "702", ",", "7", "+", "702", ",", "7", "@", "@", "object", "\"", ":\"", "uiv", "\"", ":\"", "[", "\"]", "{", "if", "(", "*", "start", "=", "=", "'", "C", "'", ")", "{", "custom_object", "=", "1", ";", "}", "INIT_PZVAL", "(", "*", "rval", ")", ";", "len2", "=", "len", "=", "parse_uiv", "(", "start", "+", "2", ")", ";", "maxlen", "=", "max", "-", "YYCURSOR", ";", "@", "@", "-", "751", ",", "14", "+", "751", ",", "14", "@", "@", "object", "\"", ":\"", "uiv", "\"", ":\"", "[", "\"]", "{", "efree", "(", "class_name", ")", ";", "return", "0", ";", "}", "/", "*", "Check", "for", "unserialize", "callback", "*", "/", "if", "(", "(", "PG", "(", "unserialize_callback_func", ")", "=", "=", "NULL", ")", "|", "|", "(", "PG", "(", "unserialize_callback_func", ")", "[", "0", "]", "=", "=", "'", "\\", "0", "'", "))", "{", "incomplete_class", "=", "1", ";", "ce", "=", "PHP_IC_ENTRY", ";", "break", ";", "}", "/", "*", "Call", "unserialize", "callback", "*", "/", "MAKE_STD_ZVAL", "(", "user_func", ")", ";", "ZVAL_STRING", "(", "user_func", ",", "PG", "(", "unserialize_callback_func", ")", ",", "1", ")", ";", "@", "@", "-", "791", ",", "7", "+", "791", ",", "7", "@", "@", "object", "\"", ":\"", "uiv", "\"", ":\"", "[", "\"]", "{", "zval_ptr_dtor", "(", "&", "arg_func_name", ")", ";", "return", "0", ";", "}", "/", "*", "The", "callback", "function", "may", "have", "defined", "the", "class", "*", "/", "if", "(", "zend_lookup_class", "(", "class_name", ",", "len2", ",", "&", "pce", "TSRMLS_CC", ")", "=", "=", "SUCCESS", ")", "{", "ce", "=", "*", "pce", ";", "@", "@", "-", "819", ",", "7", "+", "819", ",", "7", "@", "@", "object", "\"", ":\"", "uiv", "\"", ":\"", "[", "\"]", "{", "efree", "(", "class_name", ")", ";", "return", "ret", ";", "}", "elements", "=", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ce", ")", ";", "if", "(", "incomplete_class", ")", "{"], "docstring_tokens": ["use-after-free", "vulnerabilities"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2", ",", "7", "+", "2", ",", "9", "@", "@", "#", "#", "1", ".", "3", ".", "0", "-", "lz4", "r102", "-", "lz4", "r119", "-", "xxhash", "r34", "-", "[", "#", "23", "]", "(", "http", ":", "//", "github", ".", "com", "/", "jpountz", "/", "lz4", "-", "java", "/", "issues", "/", "23", ")", "Added", "the", "ability", "for", "the", "decompressors", "to", "use", "preset", "dictionaries", "as", "a", "64kb", "@", "@", "-", "172", ",", "7", "+", "172", ",", "8", "@", "@", "<", "includepath", "path", "=", "\"$", "{", "java", ".", "home", "}", "/.", "./", "include", "\"", "/", ">", "<", "includepath", "path", "=", "\"$", "{", "java", ".", "home", "}", "/.", "./", "include", "/", "${", "platform", "}", "/\"", "/", ">", "<", "includepath", "path", "=", "\"$", "{", "build", "}", "/", "jni", "-", "headers", "\"", "/", ">", "<", "fileset", "dir", "=", "\"$", "{", "src", "}", "/", "lz4", "\"", "includes", "=", "\"", "lz4", ".", "c", ",", "lz4hc", ".", "c", ",", "xxhash", ".", "c", "\"", "/", ">", "<", "fileset", "dir", "=", "\"$", "{", "src", "}", "/", "lz4", "\"", "includes", "=", "\"", "lz4", ".", "c", ",", "lz4hc", ".", "c", "\"", "/", ">", "<", "fileset", "dir", "=", "\"$", "{", "src", "}", "/", "xxhash", "\"", "includes", "=", "\"", "xxhash", ".", "c", "\"", "/", ">", "<", "fileset", "dir", "=", "\"$", "{", "src", "}", "/", "jni", "\"", "includes", "=", "\"*", ".", "c", "\"", "/", ">", "<", "linker", "/", ">", "<", "/", "cpptasks", ":", "cc", ">", "@", "@", "-", "45", ",", "10", "+", "45", ",", "12", "@", "@", "final", "class", "LZ4Java", "$", "{", "type", "}", "Compressor", "extends", "LZ4Compressor", "{", "int", "forwardOff", "=", "sOff", ";", "int", "ref", ";", "int", "findMatchAttempts", "=", "(", "1", "<", "<", "SKIP_STRENGTH", ")", "+", "3", ";", "int", "step", "=", "1", ";", "int", "searchMatchNb", "=", "1", "<", "<", "SKIP_STRENGTH", ";", "do", "{", "sOff", "=", "forwardOff", ";", "forwardOff", "+", "=", "findMatchAttempts", "+", "+", ">", ">>", "SKIP_STRENGTH", ";", "forwardOff", "+", "=", "step", ";", "step", "=", "searchMatchNb", "+", "+", ">", ">>", "SKIP_STRENGTH", ";", "if", "(", "forwardOff", ">", "mflimit", ")", "{", "break", "main", ";", "@", "@", "-", "165", ",", "11", "+", "167", ",", "13", "@", "@", "final", "class", "LZ4Java", "$", "{", "type", "}", "Compressor", "extends", "LZ4Compressor", "{", "int", "forwardOff", "=", "sOff", ";", "int", "ref", ";", "int", "findMatchAttempts", "=", "(", "1", "<", "<", "SKIP_STRENGTH", ")", "+", "3", ";", "int", "step", "=", "1", ";", "int", "searchMatchNb", "=", "1", "<", "<", "SKIP_STRENGTH", ";", "int", "back", ";", "do", "{", "sOff", "=", "forwardOff", ";", "forwardOff", "+", "=", "findMatchAttempts", "+", "+", ">", ">>", "SKIP_STRENGTH", ";", "forwardOff", "+", "=", "step", ";", "step", "=", "searchMatchNb", "+", "+", ">", ">>", "SKIP_STRENGTH", ";", "if", "(", "forwardOff", ">", "mflimit", ")", "{", "break", "main", ";", "@", "@", "-", "27", ",", "9", "+", "27", ",", "13", "@", "@", "enum", "LZ4Utils", "{", ";", "static", "final", "int", "maxCompressedLength", "(", "int", "length", ")", "{", "private", "static", "final", "int", "MAX_INPUT_SIZE", "=", "0x7E000000", ";", "static", "int", "maxCompressedLength", "(", "int", "length", ")", "{", "if", "(", "length", "<", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "length", "must", "be", ">", "=", "0", ",", "got", "\"", "+", "length", ")", ";", "}", "else", "if", "(", "length", ">", "=", "MAX_INPUT_SIZE", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "length", "must", "be", "<", "\"", "+", "MAX_INPUT_SIZE", ")", ";", "}", "return", "length", "+", "length", "/", "255", "+", "16", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "24", "@", "@", "LZ4", "Library", "Copyright", "(", "c", ")", "2011", "-", "2014", ",", "Yann", "Collet", "All", "rights", "reserved", ".", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "HOLDER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "1", ",", "37", "+", "1", ",", "152", "@", "@", "CC", "=", "gcc", "CFLAGS", "=", "-", "I", ".", "-", "std", "=", "c99", "-", "Wall", "-", "W", "-", "Wundef", "-", "Wno", "-", "implicit", "-", "function", "-", "declaration", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "#", "LZ4", "library", "-", "Makefile", "#", "Copyright", "(", "C", ")", "Yann", "Collet", "2011", "-", "2014", "#", "All", "rights", "reserved", ".", "#", "#", "BSD", "license", "#", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "#", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "#", "#", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "#", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "#", "#", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "#", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "#", "other", "materials", "provided", "with", "the", "distribution", ".", "#", "#", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "#", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "#", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "#", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "HOLDER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "#", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "#", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "#", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "#", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "#", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "#", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "#", "#", "You", "can", "contact", "the", "author", "at", ":", "#", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "#", "-", "LZ4", "forum", "froup", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "#!", "forum", "/", "lz4c", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "OS", ":", "=", "$", "(", "shell", "uname", ")", "ifeq", "(", "$(", "OS", ")", ",", "Linux", ")", "#", "Version", "numbers", "export", "RELEASE", "=", "r119", "LIBVER_MAJOR", "=", "1", "LIBVER_MINOR", "=", "2", "LIBVER_PATCH", "=", "0", "LIBVER", "=", "$(", "LIBVER_MAJOR", ")", ".$", "(", "LIBVER_MINOR", ")", ".$", "(", "LIBVER_PATCH", ")", "DESTDIR", "=", "PREFIX", "=", "/", "usr", "CC", ":", "=", "$", "(", "CC", ")", "CFLAGS", "+", "=", "-", "I", ".", "-", "std", "=", "c99", "-", "O3", "-", "Wall", "-", "W", "-", "Wundef", "-", "DLZ4_VERSION", "=", "\\\"", "$(", "RELEASE", ")", "\\\"", "LIBDIR", "?", "=", "$", "(", "PREFIX", ")", "/", "lib", "INCLUDEDIR", "=", "$(", "PREFIX", ")", "/", "include", "PRGDIR", "=", "programs", "DISTRIBNAME", "=", "lz4", "-", "$(", "RELEASE", ")", ".", "tar", ".", "gz", "#", "Define", "*", ".", "exe", "as", "extension", "for", "Windows", "systems", "ifneq", "(", ",$", "(", "filter", "Windows", "%", ",$", "(", "OS", ")", "))", "EXT", "=", ".", "exe", "else", "EXT", "=", "endif", "#", "OS", "X", "linker", "doesn", "'", "t", "support", "-", "soname", ",", "and", "use", "different", "extension", "#", "see", ":", "https", ":", "//", "developer", ".", "apple", ".", "com", "/", "library", "/", "mac", "/", "documentation", "/", "DeveloperTools", "/", "Conceptual", "/", "DynamicLibraries", "/", "100", "-", "Articles", "/", "DynamicLibraryDesignGuidelines", ".", "html", "ifeq", "(", "$(", "shell", "uname", ")", ",", "Darwin", ")", "SONAME_FLAGS", "=", "SHARED_EXT", "=", "dylib", "SHARED_EXT_MAJOR", "=", "$", "(", "LIBVER_MAJOR", ")", ".$", "(", "SHARED_EXT", ")", "SHARED_EXT_VER", "=", "$", "(", "LIBVER", ")", ".$", "(", "SHARED_EXT", ")", "else", "EXT", "=", ".", "exe", "SONAME_FLAGS", "=", "-", "Wl", ",", "-", "soname", "=", "liblz4", ".", "$(", "SHARED_EXT", ")", ".$", "(", "LIBVER_MAJOR", ")", "SHARED_EXT", "=", "so", "SHARED_EXT_MAJOR", "=", "$", "(", "SHARED_EXT", ")", ".$", "(", "LIBVER_MAJOR", ")", "SHARED_EXT_VER", "=", "$", "(", "SHARED_EXT", ")", ".$", "(", "LIBVER", ")", "endif", "default", ":", "lz4c", "TEXT", "=", "lz4", ".", "c", "lz4", ".", "h", "lz4hc", ".", "c", "lz4hc", ".", "h", "\\", "lz4_format_description", ".", "txt", "Makefile", "NEWS", "LICENSE", "README", ".", "md", "\\", "cmake_unofficial", "/", "CMakeLists", ".", "txt", "\\", "$", "(", "PRGDIR", ")", "/", "fullbench", ".", "c", "$", "(", "PRGDIR", ")", "/", "fuzzer", ".", "c", "$", "(", "PRGDIR", ")", "/", "lz4cli", ".", "c", "\\", "$", "(", "PRGDIR", ")", "/", "lz4io", ".", "c", "$", "(", "PRGDIR", ")", "/", "lz4io", ".", "h", "\\", "$", "(", "PRGDIR", ")", "/", "bench", ".", "c", "$", "(", "PRGDIR", ")", "/", "bench", ".", "h", "\\", "$", "(", "PRGDIR", ")", "/", "xxhash", ".", "c", "$", "(", "PRGDIR", ")", "/", "xxhash", ".", "h", "\\", "$", "(", "PRGDIR", ")", "/", "lz4", ".", "1", "$", "(", "PRGDIR", ")", "/", "lz4c", ".", "1", "$", "(", "PRGDIR", ")", "/", "lz4cat", ".", "1", "\\", "$", "(", "PRGDIR", ")", "/", "Makefile", "$", "(", "PRGDIR", ")", "/", "COPYING", "NONTEXT", "=", "LZ4_Streaming_Format", ".", "odt", "SOURCES", "=", "$", "(", "TEXT", ")", "$", "(", "NONTEXT", ")", "all", ":", "lz4c", "lz4cs", "lz4c32", "fuzzer", "fuzzer32", "fullbench", "fullbench32", "lz4c", ":", "lz4", ".", "c", "lz4hc", ".", "c", "bench", ".", "c", "xxhash", ".", "c", "lz4c", ".", "c", "$", "(", "CC", ")", "-", "O3", "$", "(", "CFLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "default", ":", "liblz4", "@", "cd", "$", "(", "PRGDIR", ")", ";", "$", "(", "MAKE", ")", "-", "e", "lz4cs", ":", "lz4", ".", "c", "lz4hc", ".", "c", "bench", ".", "c", "xxhash", ".", "c", "lz4c", ".", "c", "$", "(", "CC", ")", "-", "Os", "$", "(", "CFLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "all", ":", "liblz4", "lz4programs", "lz4c32", ":", "lz4", ".", "c", "lz4hc", ".", "c", "bench", ".", "c", "xxhash", ".", "c", "lz4c", ".", "c", "$", "(", "CC", ")", "-", "m32", "-", "O3", "$", "(", "CFLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "lz4programs", ":", "lz4", ".", "c", "lz4hc", ".", "c", "@", "cd", "$", "(", "PRGDIR", ")", ";", "$", "(", "MAKE", ")", "-", "e", "all", "fuzzer", ":", "lz4", ".", "c", "lz4hc", ".", "c", "fuzzer", ".", "c", "$", "(", "CC", ")", "-", "O3", "$", "(", "CFLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "fuzzer32", ":", "lz4", ".", "c", "lz4hc", ".", "c", "fuzzer", ".", "c", "$", "(", "CC", ")", "-", "m32", "-", "O3", "$", "(", "CFLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "liblz4", ":", "lz4", ".", "c", "lz4hc", ".", "c", "@", "echo", "compiling", "static", "library", "@", "$(", "CC", ")", "$", "(", "CFLAGS", ")", "-", "c", "$", "^", "@", "$(", "AR", ")", "rcs", "liblz4", ".", "a", "lz4", ".", "o", "lz4hc", ".", "o", "@", "echo", "compiling", "dynamic", "library", "@", "$(", "CC", ")", "$", "(", "CFLAGS", ")", "-", "shared", "$", "^", "-", "fPIC", "$", "(", "SONAME_FLAGS", ")", "-", "o", "$", "@.", "$(", "SHARED_EXT_VER", ")", "@", "echo", "creating", "versioned", "links", "@", "ln", "-", "sf", "$", "@.", "$(", "SHARED_EXT_VER", ")", "$", "@.", "$(", "SHARED_EXT_MAJOR", ")", "@", "ln", "-", "sf", "$", "@.", "$(", "SHARED_EXT_VER", ")", "$", "@.", "$(", "SHARED_EXT", ")", "fullbench", ":", "lz4", ".", "c", "lz4hc", ".", "c", "xxhash", ".", "c", "fullbench", ".", "c", "$", "(", "CC", ")", "-", "O3", "$", "(", "CFLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "clean", ":", "@", "rm", "-", "f", "core", "*", ".", "o", "*", ".", "a", "*", ".$", "(", "SHARED_EXT", ")", "*", ".$", "(", "SHARED_EXT", ")", ".*", "$", "(", "DISTRIBNAME", ")", "*", ".", "sha1", "@", "cd", "$", "(", "PRGDIR", ")", ";", "$", "(", "MAKE", ")", "clean", "@", "echo", "Cleaning", "completed", "fullbench32", ":", "lz4", ".", "c", "lz4hc", ".", "c", "xxhash", ".", "c", "fullbench", ".", "c", "$", "(", "CC", ")", "-", "m32", "-", "O3", "$", "(", "CFLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "clean", ":", "rm", "-", "f", "core", "*", ".", "o", "lz4c", "$", "(", "EXT", ")", "lz4cs", "$", "(", "EXT", ")", "lz4c32", "$", "(", "EXT", ")", "fuzzer", "$", "(", "EXT", ")", "fullbench", "$", "(", "EXT", ")", "fullbench32", "$", "(", "EXT", ")", "#", "make", "install", "option", "is", "designed", "for", "Linux", "&", "OSX", "targets", "only", "ifneq", "(", ",$", "(", "filter", "$", "(", "shell", "uname", ")", ",", "Linux", "Darwin", ")", ")", "install", ":", "liblz4", "@", "install", "-", "d", "-", "m", "755", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "$", "(", "DESTDIR", ")", "$(", "INCLUDEDIR", ")", "/", "@", "install", "-", "m", "755", "liblz4", ".", "$(", "SHARED_EXT_VER", ")", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "liblz4", ".", "$(", "SHARED_EXT_VER", ")", "@", "cp", "-", "a", "liblz4", ".", "$(", "SHARED_EXT_MAJOR", ")", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "@", "cp", "-", "a", "liblz4", ".", "$(", "SHARED_EXT", ")", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "@", "install", "-", "m", "644", "liblz4", ".", "a", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "liblz4", ".", "a", "@", "install", "-", "m", "644", "lz4", ".", "h", "$", "(", "DESTDIR", ")", "$(", "INCLUDEDIR", ")", "/", "lz4", ".", "h", "@", "install", "-", "m", "644", "lz4hc", ".", "h", "$", "(", "DESTDIR", ")", "$(", "INCLUDEDIR", ")", "/", "lz4hc", ".", "h", "@", "echo", "lz4", "static", "and", "shared", "library", "installed", "@", "cd", "$", "(", "PRGDIR", ")", ";", "$", "(", "MAKE", ")", "-", "e", "install", "uninstall", ":", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "liblz4", ".", "$(", "SHARED_EXT", ")", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "liblz4", ".", "$(", "SHARED_EXT_MAJOR", ")", "[", "-", "x", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "liblz4", ".", "$(", "SHARED_EXT_VER", ")", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "liblz4", ".", "$(", "SHARED_EXT_VER", ")", "[", "-", "f", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "liblz4", ".", "a", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "LIBDIR", ")", "/", "liblz4", ".", "a", "[", "-", "f", "$", "(", "DESTDIR", ")", "$(", "INCLUDEDIR", ")", "/", "lz4", ".", "h", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "INCLUDEDIR", ")", "/", "lz4", ".", "h", "[", "-", "f", "$", "(", "DESTDIR", ")", "$(", "INCLUDEDIR", ")", "/", "lz4hc", ".", "h", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "INCLUDEDIR", ")", "/", "lz4hc", ".", "h", "@", "echo", "lz4", "libraries", "successfully", "uninstalled", "@", "cd", "$", "(", "PRGDIR", ")", ";", "$", "(", "MAKE", ")", "uninstall", "dist", ":", "clean", "@", "install", "-", "dD", "-", "m", "700", "lz4", "-", "$(", "RELEASE", ")", "/", "programs", "/", "@", "install", "-", "dD", "-", "m", "700", "lz4", "-", "$(", "RELEASE", ")", "/", "cmake_unofficial", "/", "@", "for", "f", "in", "$", "(", "TEXT", ")", ";", "do", "\\", "tr", "-", "d", "'", "\\", "r", "'", "<", "$", "$", "f", ">", ".", "tmp", ";", "\\", "install", "-", "m", "600", ".", "tmp", "lz4", "-", "$(", "RELEASE", ")", "/$", "$", "f", ";", "\\", "done", "@", "rm", ".", "tmp", "@", "for", "f", "in", "$", "(", "NONTEXT", ")", ";", "do", "\\", "install", "-", "m", "600", "$", "$", "f", "lz4", "-", "$(", "RELEASE", ")", "/$", "$", "f", ";", "\\", "done", "@", "tar", "-", "czf", "$", "(", "DISTRIBNAME", ")", "lz4", "-", "$(", "RELEASE", ")", "/", "@", "rm", "-", "rf", "lz4", "-", "$(", "RELEASE", ")", "@", "sha1sum", "$", "(", "DISTRIBNAME", ")", ">", "$", "(", "DISTRIBNAME", ")", ".", "sha1", "@", "echo", "Distribution", "$", "(", "DISTRIBNAME", ")", "built", "test", ":", "lz4programs", "@", "cd", "$", "(", "PRGDIR", ")", ";", "$", "(", "MAKE", ")", "-", "e", "$", "@", "endif", "@", "@", "-", "0", ",", "0", "+", "1", ",", "84", "@", "@", "r119", ":", "Fix", ":", "overflow", "address", ",", "32", "-", "bits", "mode", "(", "issue", "134", ")", "r118", ":", "New", ":", "LZ4", "Streaming", "API", "(", "Fast", "version", ")", ",", "special", "thanks", "to", "Takayuki", "Matsuoka", "New", ":", "datagen", ":", "parametrable", "synthetic", "data", "generator", "for", "tests", "Improved", ":", "fuzzer", ",", "support", "more", "test", "cases", ",", "more", "parameters", ",", "ability", "to", "jump", "to", "specific", "test", "fix", ":", "support", "ppc64le", "platform", "(", "issue", "131", ")", "fix", ":", "Issue", "52", "(", "malicious", "address", "space", "overflow", "in", "32", "-", "bits", "mode", "when", "using", "custom", "format", ")", "fix", ":", "Makefile", ":", "minor", "issue", "130", ":", "header", "files", "permissions", "r117", ":", "Added", ":", "man", "pages", "for", "lz4c", "and", "lz4cat", "Added", ":", "automated", "tests", "on", "Travis", ",", "thanks", "to", "Takayuki", "Matsuoka", "!", "fix", ":", "block", "-", "dependency", "command", "line", "(", "issue", "127", ")", "fix", ":", "lz4fullbench", "(", "issue", "128", ")", "r116", ":", "hotfix", "(", "issue", "124", "&", "125", ")", "r115", ":", "Added", ":", "lz4cat", "utility", ",", "installed", "on", "POSX", "systems", "(", "issue", "118", ")", "OS", "-", "X", "compatible", "compilation", "of", "dynamic", "library", "(", "issue", "115", ")", "r114", ":", "Makefile", ":", "library", "correctly", "compiled", "with", "-", "O3", "switch", "(", "issue", "114", ")", "Makefile", ":", "library", "compilation", "compatible", "with", "clang", "Makefile", ":", "library", "is", "versioned", "and", "linked", "(", "issue", "119", ")", "lz4", ".", "h", ":", "no", "more", "static", "inline", "prototypes", "(", "issue", "116", ")", "man", ":", "improved", "header", "/", "footer", "(", "issue", "111", ")", "Makefile", ":", "Use", "system", "default", "$", "(", "CC", ")", "&", "$", "(", "MAKE", ")", "variables", "(", "issue", "112", ")", "xxhash", ":", "updated", "to", "r34", "r113", ":", "Large", "decompression", "speed", "improvement", "for", "GCC", "32", "-", "bits", ".", "Thanks", "to", "Valery", "Croizier", "!", "LZ4HC", ":", "Compression", "Level", "is", "now", "a", "programmable", "parameter", "(", "CLI", "from", "4", "to", "9", ")", "Separated", "IO", "routines", "from", "command", "line", "(", "lz4io", ".", "c", ")", "Version", "number", "into", "lz4", ".", "h", "(", "suggested", "by", "Francesc", "Alted", ")", "r112", ":", "quickfix", "r111", ":", "Makefile", ":", "added", "capability", "to", "install", "libraries", "Modified", "Directory", "tree", ",", "to", "better", "separate", "libraries", "from", "programs", ".", "r110", ":", "lz4", "&", "lz4hc", ":", "added", "capability", "to", "allocate", "state", "&", "stream", "state", "with", "custom", "allocator", "(", "issue", "99", ")", "fuzzer", "&", "fullbench", ":", "updated", "to", "test", "new", "functions", "man", ":", "documented", "-", "l", "command", "(", "Legacy", "format", ",", "for", "Linux", "kernel", "compression", ")", "(", "issue", "102", ")", "cmake", ":", "improved", "version", "by", "Mika", "Attila", ",", "building", "programs", "and", "libraries", "(", "issue", "100", ")", "xxHash", ":", "updated", "to", "r33", "Makefile", ":", "clean", "also", "delete", "local", "package", ".", "tar", ".", "gz", "r109", ":", "lz4", ".", "c", ":", "corrected", "issue", "98", "(", "LZ4_compress_limitedOutput", "(", "))", "Makefile", ":", "can", "specify", "version", "number", "from", "makefile", "r108", ":", "lz4", ".", "c", ":", "corrected", "compression", "efficiency", "issue", "97", "in", "64", "-", "bits", "chained", "mode", "(", "-", "BD", ")", "for", "streams", ">", "4", "GB", "(", "thanks", "Roman", "Strashkin", "for", "reporting", ")", "r107", ":", "Makefile", ":", "support", "DESTDIR", "for", "staged", "installs", ".", "Thanks", "Jorge", "Aparicio", ".", "Makefile", ":", "make", "install", "installs", "both", "lz4", "and", "lz4c", "(", "Jorge", "Aparicio", ")", "Makefile", ":", "removed", "-", "Wno", "-", "implicit", "-", "declaration", "compilation", "switch", "lz4cli", ".", "c", ":", "include", "<", "stduni", ".", "h", ">", "for", "isatty", "(", ")", "(", "Luca", "Barbato", ")", "lz4", ".", "h", ":", "introduced", "LZ4_MAX_INPUT_SIZE", "constant", "(", "Shay", "Green", ")", "lz4", ".", "h", ":", "LZ4_compressBound", "(", ")", ":", "unified", "macro", "and", "inline", "definitions", "(", "Shay", "Green", ")", "lz4", ".", "h", ":", "LZ4_decompressSafe_partial", "(", ")", ":", "clarify", "comments", "(", "Shay", "Green", ")", "lz4", ".", "c", ":", "LZ4_compress", "(", ")", "verify", "input", "size", "condition", "(", "Shay", "Green", ")", "bench", ".", "c", ":", "corrected", "a", "bug", "in", "free", "memory", "size", "evaluation", "cmake", ":", "install", "into", "bin", "/", "directory", "(", "Richard", "Yao", ")", "cmake", ":", "check", "for", "just", "C", "compiler", "(", "Elan", "Ruusamae", ")", "r106", ":", "Makefile", ":", "make", "dist", "modify", "text", "files", "in", "the", "package", "to", "respect", "Unix", "EoL", "convention", "lz4cli", ".", "c", ":", "corrected", "small", "display", "bug", "in", "HC", "mode", "r105", ":", "Makefile", ":", "New", "install", "script", "and", "man", "page", ",", "contributed", "by", "Prasad", "Pandit", "lz4cli", ".", "c", ":", "Minor", "modifications", ",", "for", "easier", "extensibility", "COPYING", ":", "added", "license", "file", "LZ4_Streaming_Format", ".", "odt", ":", "modified", "file", "name", "to", "remove", "white", "space", "characters", "Makefile", ":", ".", "exe", "suffix", "now", "properly", "added", "only", "for", "Windows", "target", "@", "@", "-", "0", ",", "0", "+", "1", ",", "54", "@", "@", "LZ4", "-", "Extremely", "fast", "compression", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "LZ4", "is", "lossless", "compression", "algorithm", ",", "providing", "compression", "speed", "at", "400", "MB", "/", "s", "per", "core", ",", "scalable", "with", "multi", "-", "cores", "CPU", ".", "It", "also", "features", "an", "extremely", "fast", "decoder", ",", "with", "speed", "in", "multiple", "GB", "/", "s", "per", "core", ",", "typically", "reaching", "RAM", "speed", "limits", "on", "multi", "-", "core", "systems", ".", "A", "high", "compression", "derivative", ",", "called", "LZ4_HC", ",", "is", "also", "provided", ".", "It", "trades", "CPU", "time", "for", "compression", "ratio", ".", "|", "Branch", "|", "Status", "|", "|", "--", "--", "--", "--", "--", "--", "|-", "--", "--", "--", "--", "|", "|", "master", "|", "[", "![", "Build", "Status", "]", "(", "https", ":", "//", "travis", "-", "ci", ".", "org", "/", "Cyan4973", "/", "lz4", ".", "svg", "?", "branch", "=", "master", ")", "](", "https", ":", "//", "travis", "-", "ci", ".", "org", "/", "Cyan4973", "/", "lz4", ")", "|", "|", "dev", "|", "[", "![", "Build", "Status", "]", "(", "https", ":", "//", "travis", "-", "ci", ".", "org", "/", "Cyan4973", "/", "lz4", ".", "svg", "?", "branch", "=", "dev", ")", "](", "https", ":", "//", "travis", "-", "ci", ".", "org", "/", "Cyan4973", "/", "lz4", ")", "|", "This", "is", "an", "official", "mirror", "of", "LZ4", "project", ",", "[", "hosted", "on", "Google", "Code", "]", "(", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", ").", "The", "intention", "is", "to", "offer", "github", "'", "s", "capabilities", "to", "lz4", "users", ",", "such", "as", "cloning", ",", "branch", ",", "or", "source", "download", ".", "The", "\"", "master", "\"", "branch", "will", "reflect", ",", "the", "status", "of", "lz4", "at", "its", "official", "homepage", ".", "Other", "branches", "will", "also", "exist", ",", "typically", "to", "fix", "some", "open", "issues", "or", "new", "requirements", ",", "and", "be", "available", "for", "testing", "before", "merge", "into", "master", ".", "Benchmarks", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "The", "benchmark", "uses", "the", "[", "Open", "-", "Source", "Benchmark", "program", "by", "m", "^", "2", "(", "v0", ".", "14", ".", "2", ")", "](", "http", ":", "//", "encode", ".", "ru", "/", "threads", "/", "1371", "-", "Filesystem", "-", "benchmark", "?", "p", "=", "33548", "&", "viewfull", "=", "1", "#", "post33548", ")", "compiled", "with", "GCC", "v4", ".", "6", ".", "1", "on", "Linux", "Ubuntu", "64", "-", "bits", "v11", ".", "10", ",", "The", "reference", "system", "uses", "a", "Core", "i5", "-", "3340M", "@", "2", ".", "7GHz", ".", "Benchmark", "evaluates", "the", "compression", "of", "reference", "[", "Silesia", "Corpus", "]", "(", "http", ":", "//", "sun", ".", "aei", ".", "polsl", ".", "pl", "/", "~", "sdeor", "/", "index", ".", "php", "?", "page", "=", "silesia", ")", "in", "single", "-", "thread", "mode", ".", "<", "table", ">", "<", "tr", ">", "<", "th", ">", "Compressor", "<", "/", "th", ">", "<", "th", ">", "Ratio", "<", "/", "th", ">", "<", "th", ">", "Compression", "<", "/", "th", ">", "<", "th", ">", "Decompression", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", ">", "LZ4", "(", "r101", ")", "</", "th", ">", "<", "th", ">", "2", ".", "084", "<", "/", "th", ">", "<", "th", ">", "422", "MB", "/", "s", "<", "/", "th", ">", "<", "th", ">", "1820", "MB", "/", "s", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", ">", "LZO", "2", ".", "06", "<", "/", "th", ">", "<", "th", ">", "2", ".", "106", "<", "/", "th", ">", "<", "th", ">", "414", "MB", "/", "s", "<", "/", "th", ">", "<", "th", ">", "600", "MB", "/", "s", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", ">", "QuickLZ", "1", ".", "5", ".", "1b6", "<", "/", "th", ">", "<", "th", ">", "2", ".", "237", "<", "/", "th", ">", "<", "th", ">", "373", "MB", "/", "s", "<", "/", "th", ">", "<", "th", ">", "420", "MB", "/", "s", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", ">", "Snappy", "1", ".", "1", ".", "0", "<", "/", "th", ">", "<", "th", ">", "2", ".", "091", "<", "/", "th", ">", "<", "th", ">", "323", "MB", "/", "s", "<", "/", "th", ">", "<", "th", ">", "1070", "MB", "/", "s", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", ">", "LZF", "<", "/", "th", ">", "<", "th", ">", "2", ".", "077", "<", "/", "th", ">", "<", "th", ">", "270", "MB", "/", "s", "<", "/", "th", ">", "<", "th", ">", "570", "MB", "/", "s", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", ">", "zlib", "1", ".", "2", ".", "8", "-", "1", "<", "/", "th", ">", "<", "th", ">", "2", ".", "730", "<", "/", "th", ">", "<", "th", ">", "65", "MB", "/", "s", "<", "/", "th", ">", "<", "th", ">", "280", "MB", "/", "s", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", ">", "LZ4", "HC", "(", "r101", ")", "</", "th", ">", "<", "th", ">", "2", ".", "720", "<", "/", "th", ">", "<", "th", ">", "25", "MB", "/", "s", "<", "/", "th", ">", "<", "th", ">", "2080", "MB", "/", "s", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "tr", ">", "<", "th", ">", "zlib", "1", ".", "2", ".", "8", "-", "6", "<", "/", "th", ">", "<", "th", ">", "3", ".", "099", "<", "/", "th", ">", "<", "th", ">", "21", "MB", "/", "s", "<", "/", "th", ">", "<", "th", ">", "300", "MB", "/", "s", "<", "/", "th", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "@", "@", "-", "1", ",", "106", "+", "0", ",", "0", "@", "@", "PROJECT", "(", "LZ4", ")", "set", "(", "CPACK_PACKAGE_DESCRIPTION_SUMMARY", "\"", "ASN", ".", "1", "Compiler", "\"", ")", "set", "(", "CPACK_PACKAGE_VERSION_MAJOR", "0", ")", "set", "(", "CPACK_PACKAGE_VERSION_MINOR", "0", ")", "set", "(", "CPACK_PACKAGE_VERSION_PATCH", "r52", ")", "#", "set", "(", "CPACK_RESOURCE_FILE_LICENSE", "$", "{", "CMAKE_CURRENT_BINARY_DIR", "}", "/", "COPYING_LGPL", ")", "set", "(", "VERSION_STRING", "\"", "\\", "\"$", "{", "CPACK_PACKAGE_VERSION_MAJOR", "}", ".$", "{", "CPACK_PACKAGE_VERSION_MINOR", "}", ".$", "{", "CPACK_PACKAGE_VERSION_PATCH", "}", "\\\"", "\"", ")", "include", "(", "CPack", ")", "cmake_minimum_required", "(", "VERSION", "2", ".", "6", ")", "INCLUDE", "(", "CheckTypeSize", ")", "check_type_size", "(", "\"", "void", "*", "\"", "SIZEOF_VOID_P", ")", "IF", "(", "$", "{", "SIZEOF_VOID_P", "}", "STREQUAL", "\"", "8", "\"", ")", "set", "(", "CMAKE_SYSTEM_PROCESSOR", "\"", "64bit", "\"", ")", "MESSAGE", "(", "STATUS", "\"", "64", "bit", "architecture", "detected", "size", "of", "void", "*", "is", "\"", "$", "{", "SIZEOF_VOID_P", "}", ")", "ENDIF", "(", ")", "set", "(", "BUILD_SHARED_LIBS", "OFF", "CACHE", "BOOL", "\"", "Build", "shared", "libraries", "\"", ")", "if", "(", "BUILD_SHARED_LIBS", ")", "message", "(", "STATUS", "\"", "Enable", "shared", "library", "building", "\"", ")", "else", "(", "BUILD_SHARED_LIBS", ")", "message", "(", "STATUS", "\"", "Disable", "shared", "library", "building", "\"", ")", "endif", "(", "BUILD_SHARED_LIBS", ")", "if", "(", "UNIX", "AND", "BUILD_SHARED_LIBS", ")", "if", "(", "CMAKE_SYSTEM_PROCESSOR", "MATCHES", "\"", "x86_64", "\"", ")", "add_definitions", "(", "-", "fPIC", ")", "endif", "(", "CMAKE_SYSTEM_PROCESSOR", "MATCHES", "\"", "x86_64", "\"", ")", "endif", "(", ")", "set", "(", "SRC_DIR", ".", "./", ")", "set", "(", "LZ4_SRCS_LIB", "$", "{", "SRC_DIR", "}", "lz4", ".", "c", "$", "{", "SRC_DIR", "}", "lz4hc", ".", "c", "$", "{", "SRC_DIR", "}", "lz4", ".", "h", ")", "set", "(", "LZ4_SRCS", "$", "{", "SRC_DIR", "}", "xxhash", ".", "c", "$", "{", "SRC_DIR", "}", "bench", ".", "c", "$", "{", "SRC_DIR", "}", "lz4c", ".", "c", ")", "if", "(", "NOT", "BUILD_SHARED_LIBS", ")", "set", "(", "LZ4_SRCS", "$", "{", "LZ4_SRCS", "}", "$", "{", "LZ4_SRCS_LIB", "}", ")", "endif", "(", ")", "if", "(", "CMAKE_SYSTEM_PROCESSOR", "STREQUAL", "\"", "64bit", "\"", ")", "message", "(", "STATUS", "\"", "Build", "64bit", "executable", "binary", "\"", ")", "add_executable", "(", "lz4c64", "$", "{", "LZ4_SRCS", "}", ")", "install", "(", "TARGETS", "lz4c64", "RUNTIME", "DESTINATION", "\"", "./", "\")", "if", "(", "NOT", "BUILD_SHARED_LIBS", ")", "message", "(", "STATUS", "\"", "Build", "32bit", "executable", "binary", "\"", ")", "add_executable", "(", "lz4c32", "$", "{", "LZ4_SRCS", "}", ")", "install", "(", "TARGETS", "lz4c32", "RUNTIME", "DESTINATION", "\"", "./", "\")", "SET_TARGET_PROPERTIES", "(", "lz4c32", "PROPERTIES", "COMPILE_FLAGS", "PROPERTIES", "COMPILE_FLAGS", "\"", "-", "m32", "\"", "LINK_FLAGS", "\"", "-", "m32", "\"", ")", "endif", "(", ")", "else", "(", ")", "message", "(", "STATUS", "\"", "Build", "32bit", "executable", "binary", "\"", ")", "add_executable", "(", "lz4c32", "$", "{", "LZ4_SRCS", "}", ")", "install", "(", "TARGETS", "lz4c32", "RUNTIME", "DESTINATION", "\"", "./", "\")", "endif", "(", ")", "if", "(", "BUILD_SHARED_LIBS", ")", "set", "(", "LZ4_SOVERSION", "\"", "${", "CPACK_PACKAGE_VERSION_MAJOR", "}", ".$", "{", "CPACK_PACKAGE_VERSION_MINOR", "}", "\")", "if", "(", "CMAKE_SYSTEM_PROCESSOR", "STREQUAL", "\"", "64bit", "\"", ")", "target_link_libraries", "(", "lz4c64", "liblz4", ")", "else", "(", ")", "target_link_libraries", "(", "lz4c32", "liblz4", ")", "endif", "(", ")", "#", "for", "static", "library", "add_library", "(", "liblz4_static", "STATIC", "$", "{", "LZ4_SRCS_LIB", "}", ")", "set_target_properties", "(", "liblz4_static", "PROPERTIES", "OUTPUT_NAME", "lz4", ")", "install", "(", "TARGETS", "liblz4_static", "LIBRARY", "DESTINATION", "lib", "ARCHIVE", "DESTINATION", "lib", ")", "#", "for", "shared", "library", "o", "add_library", "(", "liblz4", "$", "{", "LZ4_SRCS_LIB", "}", ")", "set_target_properties", "(", "liblz4", "PROPERTIES", "OUTPUT_NAME", "lz4", "SOVERSION", "$", "{", "LZ4_SOVERSION", "}", ")", "install", "(", "TARGETS", "liblz4", "LIBRARY", "DESTINATION", "lib", "ARCHIVE", "DESTINATION", "lib", ")", "install", "(", "FILES", "$", "{", "SRC_DIR", "}", "/", "lz4", ".", "h", "$", "{", "SRC_DIR", "}", "/", "lz4hc", ".", "h", "DESTINATION", "include", ")", "endif", "(", "BUILD_SHARED_LIBS", ")", "#", "warnings", "ADD_DEFINITIONS", "(", "\"-", "Wall", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "W", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Wundef", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Wcast", "-", "align", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Wno", "-", "implicit", "-", "function", "-", "declaration", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Os", "-", "march", "=", "native", "-", "std", "=", "c99", "\"", ")", "INCLUDE_DIRECTORIES", "(", "${", "SRC_DIR", "}", ")", "@", "@", "-", "1", ",", "82", "+", "0", ",", "0", "@", "@", "cmake_minimum_required", "(", "VERSION", "2", ".", "8", ")", "PROJECT", "(", "LZ4", ")", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "CPACK", "set", "(", "SRC_DIR", "$", "{", "CMAKE_CURRENT_SOURCE_DIR", "}", "/.", "./", "..", "/)", "set", "(", "CPACK_PACKAGE_DESCRIPTION_SUMMARY", "\"", "LZ4", "Packer", "\"", ")", "set", "(", "CPACK_PACKAGE_VERSION_MAJOR", "0", ")", "set", "(", "CPACK_PACKAGE_VERSION_MINOR", "0", ")", "set", "(", "CPACK_PACKAGE_VERSION_PATCH", "r89", ")", "#", "set", "(", "CPACK_RESOURCE_FILE_LICENSE", "$", "{", "CMAKE_CURRENT_BINARY_DIR", "}", "/", "COPYING_LGPL", ")", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "FIND_PACKAGE", "(", "Subversion", ")", "IF", "(", "SUBVERSION_FOUND", ")", "Subversion_WC_INFO", "(", "${", "SRC_DIR", "}", "revision", ")", "set", "(", "revision_MY_WC_STATUS", "\"", "LZ4", "has", "revision", "$", "{", "revision_WC_REVISION", "}", "at", "$", "{", "revision_WC_LAST_CHANGED_DATE", "}", "\")", "message", "(", "STATUS", "$", "{", "revision_MY_WC_STATUS", "}", ")", "if", "(", "NOT", "$", "{", "revision_WC_REVISION", "}", ")", "else", "(", "NOT", "$", "{", "revision_WC_REVISION", "}", ")", "set", "(", "CPACK_PACKAGE_VERSION_PATCH", "\"", "r", "$", "{", "revision_WC_REVISION", "}", "\")", "endif", "(", "NOT", "$", "{", "revision_WC_REVISION", "}", ")", "ELSE", "(", "SUBVERSION_FOUND", ")", "message", "(", "WARNING", "\"", "NO", "Subversion", "FOUND", "!", "!!", "\")", "ENDIF", "(", "SUBVERSION_FOUND", ")", "set", "(", "VERSION_STRING", "\"", "\\", "\"$", "{", "CPACK_PACKAGE_VERSION_MAJOR", "}", ".$", "{", "CPACK_PACKAGE_VERSION_MINOR", "}", ".$", "{", "CPACK_PACKAGE_VERSION_PATCH", "}", "\\\"", "\"", ")", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "INCLUDE", "(", "CheckTypeSize", ")", "check_type_size", "(", "\"", "void", "*", "\"", "SIZEOF_VOID_P", ")", "IF", "(", "$", "{", "SIZEOF_VOID_P", "}", "STREQUAL", "\"", "8", "\"", ")", "set", "(", "CMAKE_SYSTEM_PROCESSOR", "\"", "64bit", "\"", ")", "MESSAGE", "(", "STATUS", "\"", "64", "bit", "architecture", "detected", "size", "of", "void", "*", "is", "\"", "$", "{", "SIZEOF_VOID_P", "}", ")", "ENDIF", "(", ")", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "warnings", "ADD_DEFINITIONS", "(", "\"-", "Wall", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "W", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Wundef", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Wcast", "-", "align", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Wno", "-", "implicit", "-", "function", "-", "declaration", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "O3", "-", "march", "=", "native", "-", "std", "=", "c99", "\"", ")", "INCLUDE_DIRECTORIES", "(", "${", "SRC_DIR", "}", ")", "set", "(", "LZ4_SRCS_LIB", "$", "{", "SRC_DIR", "}", "lz4", ".", "c", "$", "{", "SRC_DIR", "}", "lz4hc", ".", "c", "$", "{", "SRC_DIR", "}", "lz4", ".", "h", "$", "{", "SRC_DIR", "}", "lz4_format_description", ".", "txt", ")", "set", "(", "LZ4_SRCS", "$", "{", "LZ4_SRCS_LIB", "}", "$", "{", "SRC_DIR", "}", "xxhash", ".", "c", "$", "{", "SRC_DIR", "}", "bench", ".", "c", "$", "{", "SRC_DIR", "}", "lz4c", ".", "c", ")", "set", "(", "FUZZER_SRCS", "$", "{", "SRC_DIR", "}", "lz4", ".", "c", "$", "{", "SRC_DIR", "}", "lz4hc", ".", "c", "$", "{", "SRC_DIR", "}", "lz4", ".", "h", "$", "{", "SRC_DIR", "}", "fuzzer", ".", "c", ")", "#", "EXECUTABLES", "FOR", "32", "Bit", "and", "64", "versions", "if", "(", "CMAKE_SYSTEM_PROCESSOR", "STREQUAL", "\"", "64bit", "\"", ")", "add_executable", "(", "lz4c32", "$", "{", "LZ4_SRCS", "}", ")", "install", "(", "TARGETS", "lz4c32", "RUNTIME", "DESTINATION", "\"", "./", "\")", "SET_TARGET_PROPERTIES", "(", "lz4c32", "PROPERTIES", "COMPILE_FLAGS", "PROPERTIES", "COMPILE_FLAGS", "\"", "-", "m32", "-", "Os", "\"", "LINK_FLAGS", "\"", "-", "m32", "\"", ")", "endif", "(", ")", "add_executable", "(", "lz4c", "$", "{", "LZ4_SRCS", "}", ")", "install", "(", "TARGETS", "lz4c", "RUNTIME", "DESTINATION", "\"", "./", "\")", "add_executable", "(", "fuzzer", "$", "{", "FUZZER_SRCS", "}", ")", "install", "(", "TARGETS", "fuzzer", "RUNTIME", "DESTINATION", "\"", "./", "\")", "#", "target_link_libraries", "(", "lz4", "$", "{", "LZ4_SRCS_LIB", "}", ")", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "CPACK", "PACKAGING", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "install", "(", "FILES", "$", "{", "SRC_DIR", "}", "lz4_format_description", ".", "txt", "DESTINATION", "\"", "./", "\")", "set", "(", "CPACK_PACKAGE_NAME", "$", "{", "CMAKE_PROJECT_NAME", "}", ")", "set", "(", "CPACK_RESOURCE_FILE_LICENSE", "\"", "${", "CMAKE_CURRENT_LIST_DIR", "}", "/", "release_COPYING", ".", "txt", "\"", ")", "set", "(", "CPACK_PACKAGE_VENDOR", "\"", "Yann", "Collet", "\"", ")", "set", "(", "CPACK_WWW_SITE", "\"", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "\"", ")", "set", "(", "CPACK_NSIS_URL_INFO_ABOUT", "\"", "${", "CPACK_WWW_SITE", "}", "\")", "set", "(", "CPACK_NSIS_HELP_LINK", "\"", "${", "CPACK_WWW_SITE", "}", "\")", "set", "(", "CPACK_NSIS_DISPLAY_NAME", "$", "{", "CPACK_PACKAGE_NAME", "}", ")", "set", "(", "CPACK_NSIS_COMPRESSOR", "\"", "/", "SOLID", "lzma", "\\", "r", "\\", "n", "SetCompressorDictSize", "32", "\"", ")", "set", "(", "CPACK_NSIS_MENU_LINKS", "\"", "${", "CPACK_WWW_SITE", "}", "\"", "\"", "${", "CPACK_PACKAGE_NAME", "}", "homepage", "\"", "\"", "/", "lz4_format_description", ".", "txt", "\"", "\"", "lz4", "format", "description", "\"", "\"", "/\"", "\"", "LZ4", "directory", "\"", ")", "include", "(", "CPack", ")", "@", "@", "-", "1", ",", "21", "+", "0", ",", "0", "@", "@", "lz4demo", "and", "fuzzer", "is", "an", "open", "-", "source", "demo", "compression", "algorithm", "LZ4", "programs", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "@", "@", "-", "0", ",", "0", "+", "1", ",", "81", "@", "@", "PROJECT", "(", "LZ4", "C", ")", "set", "(", "CPACK_PACKAGE_DESCRIPTION_SUMMARY", "\"", "LZ4", "compression", "library", "\"", ")", "set", "(", "CPACK_PACKAGE_VERSION_MAJOR", "0", ")", "set", "(", "CPACK_PACKAGE_VERSION_MINOR", "0", ")", "set", "(", "CPACK_PACKAGE_VERSION_PATCH", "r111", ")", "#", "set", "(", "CPACK_RESOURCE_FILE_LICENSE", "$", "{", "CMAKE_CURRENT_BINARY_DIR", "}", "/", "COPYING_LGPL", ")", "set", "(", "VERSION_STRING", "\"", "\\", "\"$", "{", "CPACK_PACKAGE_VERSION_MAJOR", "}", ".$", "{", "CPACK_PACKAGE_VERSION_MINOR", "}", ".$", "{", "CPACK_PACKAGE_VERSION_PATCH", "}", "\\\"", "\"", ")", "include", "(", "CPack", ")", "cmake_minimum_required", "(", "VERSION", "2", ".", "6", ")", "INCLUDE", "(", "CheckTypeSize", ")", "check_type_size", "(", "\"", "void", "*", "\"", "SIZEOF_VOID_P", ")", "IF", "(", "$", "{", "SIZEOF_VOID_P", "}", "STREQUAL", "\"", "8", "\"", ")", "set", "(", "CMAKE_SYSTEM_PROCESSOR", "\"", "64bit", "\"", ")", "MESSAGE", "(", "STATUS", "\"", "64", "bit", "architecture", "detected", "size", "of", "void", "*", "is", "\"", "$", "{", "SIZEOF_VOID_P", "}", ")", "ENDIF", "(", ")", "option", "(", "BUILD_TOOLS", "\"", "Build", "the", "command", "line", "tools", "\"", "ON", ")", "option", "(", "BUILD_LIBS", "\"", "Build", "the", "libraries", "in", "addition", "to", "the", "tools", "\"", "OFF", ")", "if", "(", "UNIX", "AND", "BUILD_LIBS", ")", "if", "(", "CMAKE_SYSTEM_PROCESSOR", "MATCHES", "\"", "x86_64", "\"", ")", "add_definitions", "(", "-", "fPIC", ")", "endif", "(", "CMAKE_SYSTEM_PROCESSOR", "MATCHES", "\"", "x86_64", "\"", ")", "endif", "(", ")", "set", "(", "LZ4_DIR", ".", "./", ")", "set", "(", "PRG_DIR", ".", "./", "programs", "/", ")", "set", "(", "LZ4_SRCS_LIB", "$", "{", "LZ4_DIR", "}", "lz4", ".", "c", "$", "{", "LZ4_DIR", "}", "lz4hc", ".", "c", "$", "{", "LZ4_DIR", "}", "lz4", ".", "h", "$", "{", "LZ4_DIR", "}", "lz4hc", ".", "h", ")", "set", "(", "LZ4_SRCS", "$", "{", "PRG_DIR", "}", "xxhash", ".", "c", "$", "{", "PRG_DIR", "}", "bench", ".", "c", "$", "{", "PRG_DIR", "}", "lz4cli", ".", "c", "$", "{", "PRG_DIR", "}", "lz4io", ".", "c", ")", "if", "(", "BUILD_TOOLS", "AND", "NOT", "BUILD_LIBS", ")", "set", "(", "LZ4_SRCS", "$", "{", "LZ4_SRCS", "}", "$", "{", "LZ4_SRCS_LIB", "}", ")", "endif", "(", ")", "if", "(", "BUILD_TOOLS", ")", "add_executable", "(", "lz4", "$", "{", "LZ4_SRCS", "}", ")", "set_target_properties", "(", "lz4", "PROPERTIES", "COMPILE_DEFINITIONS", "DISABLE_LZ4C_LEGACY_OPTIONS", ")", "install", "(", "TARGETS", "lz4", "RUNTIME", "DESTINATION", "\"", "bin", "/", "\")", "add_executable", "(", "lz4c", "$", "{", "LZ4_SRCS", "}", ")", "install", "(", "TARGETS", "lz4c", "RUNTIME", "DESTINATION", "\"", "bin", "/", "\")", "endif", "(", ")", "if", "(", "BUILD_LIBS", ")", "add_library", "(", "liblz4", "$", "{", "LZ4_SRCS_LIB", "}", ")", "set_target_properties", "(", "liblz4", "PROPERTIES", "OUTPUT_NAME", "lz4", "SOVERSION", "\"", "${", "CPACK_PACKAGE_VERSION_MAJOR", "}", ".$", "{", "CPACK_PACKAGE_VERSION_MINOR", "}", "\"", ")", "install", "(", "TARGETS", "liblz4", "LIBRARY", "DESTINATION", "lib", "ARCHIVE", "DESTINATION", "lib", ")", "install", "(", "FILES", "$", "{", "LZ4_DIR", "}", "/", "lz4", ".", "h", "$", "{", "LZ4_DIR", "}", "/", "lz4hc", ".", "h", "DESTINATION", "include", ")", "if", "(", "BUILD_TOOLS", ")", "target_link_libraries", "(", "lz4", "liblz4", ")", "target_link_libraries", "(", "lz4c", "liblz4", ")", "endif", "(", ")", "endif", "(", ")", "#", "warnings", "ADD_DEFINITIONS", "(", "\"-", "Wall", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "W", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Wundef", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "Wcast", "-", "align", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "std", "=", "c99", "\"", ")", "ADD_DEFINITIONS", "(", "\"-", "DLZ4_VERSION", "=", "\\\"", "${", "CPACK_PACKAGE_VERSION_PATCH", "}", "\\\"", "\")", "INCLUDE_DIRECTORIES", "(", "${", "LZ4_DIR", "}", ")", "@", "@", "-", "1", ",", "276", "+", "0", ",", "0", "@", "@", "/", "*", "fuzzer", ".", "c", "-", "Fuzzer", "test", "tool", "for", "LZ4", "Copyright", "(", "C", ")", "Yann", "Collet", "-", "Andrew", "Mahone", "2012", "-", "2013", "Code", "started", "by", "Andrew", "Mahone", ",", "modified", "by", "Yann", "Collet", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Remove", "Visual", "warning", "messages", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "_CRT_SECURE_NO_WARNINGS", "/", "/", "fgets", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdlib", ".", "h", ">", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fgets", ",", "sscanf", "#", "include", "<", "sys", "/", "timeb", ".", "h", ">", "/", "/", "timeb", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "include", "\"", "lz4hc", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "NB_ATTEMPTS", "(", "1", "<", "<", "17", ")", "#", "define", "LEN", "(", "(", "1", "<", "<", "15", ")", ")", "#", "define", "SEQ_POW", "2", "#", "define", "NUM_SEQ", "(", "1", "<", "<", "SEQ_POW", ")", "#", "define", "SEQ_MSK", "(", "(", "NUM_SEQ", ")", "-", "1", ")", "#", "define", "MOD_SEQ", "(", "x", ")", "(", "((", "(", "x", ")", ">", ">", "8", ")", "&", "255", ")", "=", "=", "0", ")", "#", "define", "NEW_SEQ", "(", "x", ")", "(", "((", "(", "x", ")", ">", ">", "10", ")", "%", "10", ")", "=", "=", "0", ")", "#", "define", "PAGE_SIZE", "4096", "#", "define", "ROUND_PAGE", "(", "x", ")", "(", "((", "x", ")", "+", "PAGE_SIZE", "-", "1", ")", "&", "~", "(", "PAGE_SIZE", "-", "1", ")", ")", "#", "define", "PRIME1", "2654435761U", "#", "define", "PRIME2", "2246822519U", "#", "define", "PRIME3", "3266489917U", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "static", "int", "FUZ_GetMilliStart", "(", ")", "{", "struct", "timeb", "tb", ";", "int", "nCount", ";", "ftime", "(", "&", "tb", ")", ";", "nCount", "=", "(", "int", ")", "(", "tb", ".", "millitm", "+", "(", "tb", ".", "time", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "static", "int", "FUZ_GetMilliSpan", "(", "int", "nTimeStart", ")", "{", "int", "nSpan", "=", "FUZ_GetMilliStart", "(", ")", "-", "nTimeStart", ";", "if", "(", "nSpan", "<", "0", ")", "nSpan", "+", "=", "0x100000", "*", "1000", ";", "return", "nSpan", ";", "}", "unsigned", "int", "FUZ_rand", "(", "unsigned", "int", "*", "src", ")", "{", "*", "src", "=", "(", "(*", "src", ")", "*", "PRIME1", ")", "+", "PRIME2", ";", "return", "*", "src", ";", "}", "int", "test_canary", "(", "unsigned", "char", "*", "buf", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "2048", ";", "i", "+", "+)", "if", "(", "buf", "[", "i", "]", "!", "=", "buf", "[", "i", "+", "2048", "]", ")", "return", "0", ";", "return", "1", ";", "}", "int", "FUZ_SecurityTest", "(", ")", "{", "char", "*", "output", ";", "char", "*", "input", ";", "int", "i", ",", "r", ";", "printf", "(", "\"", "Overflow", "test", "(", "issue", "52", ")", "..", ".\\", "n", "\"", ");", "input", "=", "(", "char", "*", ")", "malloc", "(", "20", "<", "<", "20", ")", ";", "output", "=", "(", "char", "*", ")", "malloc", "(", "20", "<", "<", "20", ")", ";", "input", "[", "0", "]", "=", "0x0F", ";", "input", "[", "1", "]", "=", "0x00", ";", "input", "[", "2", "]", "=", "0x00", ";", "for", "(", "i", "=", "3", ";", "i", "<", "16840000", ";", "i", "+", "+)", "input", "[", "i", "]", "=", "0xff", ";", "r", "=", "LZ4_decompress_fast", "(", "input", ",", "output", ",", "20", "<", "<", "20", ")", ";", "free", "(", "input", ")", ";", "free", "(", "output", ")", ";", "printf", "(", "\"", "Passed", "(", "return", "=", "%", "i", "<", "0", ")", "\\", "n", "\"", ",", "r", ")", ";", "return", "0", ";", "}", "/", "/", "int", "main", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "int", "main", "(", ")", "{", "unsigned", "long", "long", "bytes", "=", "0", ";", "unsigned", "long", "long", "cbytes", "=", "0", ";", "unsigned", "long", "long", "hcbytes", "=", "0", ";", "unsigned", "char", "buf", "[", "LEN", "]", ";", "unsigned", "char", "testOut", "[", "LEN", "+", "1", "]", ";", "#", "define", "FUZ_max", "LZ4_COMPRESSBOUND", "(", "LEN", ")", "#", "define", "FUZ_avail", "ROUND_PAGE", "(", "FUZ_max", ")", "const", "int", "off_full", "=", "FUZ_avail", "-", "FUZ_max", ";", "unsigned", "char", "cbuf", "[", "FUZ_avail", "+", "PAGE_SIZE", "]", ";", "unsigned", "int", "seed", ",", "randState", ",", "cur_seq", "=", "PRIME3", ",", "seeds", "[", "NUM_SEQ", "]", ",", "timestamp", "=", "FUZ_GetMilliStart", "(", ");", "int", "i", ",", "j", ",", "k", ",", "ret", ",", "len", ",", "lenHC", ",", "attemptNb", ";", "char", "userInput", "[", "30", "]", "=", "{", "0", "}", ";", "#", "define", "FUZ_CHECKTEST", "(", "cond", ",", "message", ")", "if", "(", "cond", ")", "{", "printf", "(", "\"", "Test", "%", "i", ":", "%", "s", ":", "seed", "%", "u", ",", "cycle", "%", "i", "\\", "n", "\"", ",", "testNb", ",", "message", ",", "seed", ",", "attemptNb", ")", ";", "goto", "_output_error", ";", "}", "#", "define", "FUZ_DISPLAYTEST", "testNb", "+", "+;", "printf", "(", "\"%", "2i", "\\", "b", "\\", "b", "\"", ",", "testNb", ")", ";", "printf", "(", "\"", "starting", "LZ4", "fuzzer", "\\", "n", "\"", ");", "printf", "(", "\"", "Select", "an", "Initialisation", "number", "(", "default", ":", "random", ")", ":", "\"", ");", "fflush", "(", "stdout", ")", ";", "if", "(", "fgets", "(", "userInput", ",", "sizeof", "userInput", ",", "stdin", ")", ")", "{", "if", "(", "sscanf", "(", "userInput", ",", "\"", "%", "d", "\"", ",", "&", "seed", ")", "=", "=", "1", ")", "{", "}", "else", "seed", "=", "FUZ_GetMilliSpan", "(", "timestamp", ")", ";", "}", "printf", "(", "\"", "Seed", "=", "%", "u", "\\", "n", "\"", ",", "seed", ")", ";", "randState", "=", "seed", ";", "/", "/", "FUZ_SecurityTest", "(", ");", "for", "(", "i", "=", "0", ";", "i", "<", "2048", ";", "i", "+", "+)", "cbuf", "[", "FUZ_avail", "+", "i", "]", "=", "cbuf", "[", "FUZ_avail", "+", "2048", "+", "i", "]", "=", "FUZ_rand", "(", "&", "randState", ")", ">", ">", "16", ";", "for", "(", "attemptNb", "=", "0", ";", "attemptNb", "<", "NB_ATTEMPTS", ";", "attemptNb", "+", "+)", "{", "int", "testNb", "=", "0", ";", "printf", "(", "\"\\", "r", "%", "7i", "/", "%", "7i", "-", "\"", ",", "attemptNb", ",", "NB_ATTEMPTS", ")", ";", "for", "(", "j", "=", "0", ";", "j", "<", "NUM_SEQ", ";", "j", "+", "+)", "{", "seeds", "[", "j", "]", "=", "FUZ_rand", "(", "&", "randState", ")", "<", "<", "8", ";", "seeds", "[", "j", "]", "^", "=", "(", "FUZ_rand", "(", "&", "randState", ")", ">", ">", "8", ")", "&", "65535", ";", "}", "for", "(", "j", "=", "0", ";", "j", "<", "LEN", ";", "j", "+", "+)", "{", "k", "=", "FUZ_rand", "(", "&", "randState", ")", ";", "if", "(", "j", "=", "=", "0", "|", "|", "NEW_SEQ", "(", "k", ")", ")", "cur_seq", "=", "seeds", "[", "(", "FUZ_rand", "(", "&", "randState", ")", ">", ">", "16", ")", "&", "SEQ_MSK", "]", ";", "if", "(", "MOD_SEQ", "(", "k", ")", ")", "{", "k", "=", "(", "FUZ_rand", "(", "&", "randState", ")", ">", ">", "16", ")", "&", "SEQ_MSK", ";", "seeds", "[", "k", "]", "=", "FUZ_rand", "(", "&", "randState", ")", "<", "<", "8", ";", "seeds", "[", "k", "]", "^", "=", "(", "FUZ_rand", "(", "&", "randState", ")", ">", ">", "8", ")", "&", "65535", ";", "}", "buf", "[", "j", "]", "=", "FUZ_rand", "(", "&", "cur_seq", ")", ">", ">", "16", ";", "}", "/", "/", "Test", "compression", "HC", "FUZ_DISPLAYTEST", ";", "/", "/", "1", "ret", "=", "LZ4_compressHC_limitedOutput", "(", "(", "const", "char", "*", ")", "buf", ",", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "LEN", ",", "FUZ_max", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "HC", "compression", "failed", "despite", "sufficient", "space", "\"", ");", "lenHC", "=", "ret", ";", "/", "/", "Test", "compression", "FUZ_DISPLAYTEST", ";", "/", "/", "2", "ret", "=", "LZ4_compress_limitedOutput", "(", "(", "const", "char", "*", ")", "buf", ",", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "LEN", ",", "FUZ_max", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "compression", "failed", "despite", "sufficient", "space", "\"", ");", "len", "=", "ret", ";", "/", "/", "Test", "decoding", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "/", "/", "3", "ret", "=", "LZ4_decompress_fast", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "LEN", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_fast", "failed", "despite", "correct", "space", "\"", ");", "/", "/", "Test", "decoding", "with", "one", "byte", "missing", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "/", "/", "4", "ret", "=", "LZ4_decompress_fast", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "LEN", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_fast", "should", "have", "failed", ",", "due", "to", "Output", "Size", "being", "too", "small", "\"", ");", "/", "/", "Test", "decoding", "with", "one", "byte", "too", "much", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_fast", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "LEN", "+", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_fast", "should", "have", "failed", ",", "due", "to", "Output", "Size", "being", "too", "large", "\"", ");", "/", "/", "Test", "decoding", "with", "enough", "output", "size", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "len", ",", "LEN", "+", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_safe", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "decoding", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "len", ",", "LEN", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_safe", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "decoding", "with", "output", "size", "being", "one", "byte", "too", "short", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "len", ",", "LEN", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe", "should", "have", "failed", ",", "due", "to", "Output", "Size", "being", "one", "byte", "too", "short", "\"", ");", "/", "/", "Test", "decoding", "with", "input", "size", "being", "one", "byte", "too", "short", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "len", "-", "1", ",", "LEN", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe", "should", "have", "failed", ",", "due", "to", "input", "size", "being", "one", "byte", "too", "short", "\"", ");", "/", "/", "Test", "decoding", "with", "input", "size", "being", "one", "byte", "too", "large", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "len", "+", "1", ",", "LEN", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe", "should", "have", "failed", ",", "due", "to", "input", "size", "being", "too", "large", "\"", ");", "/", "/", "if", "(", "ret", ">", "=", "0", ")", "{", "printf", "(", "\"", "Test", "10", ":", "decompression", "should", "have", "failed", ",", "due", "to", "input", "size", "being", "too", "large", ":", "seed", "%", "u", ",", "len", "%", "d", "\\", "n", "\"", ",", "seed", ",", "LEN", ")", ";", "goto", "_output_error", ";", "}", "/", "/", "Test", "partial", "decoding", "with", "target", "output", "size", "being", "max", "/", "2", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe_partial", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "len", ",", "LEN", "/", "2", ",", "LEN", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_safe_partial", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "partial", "decoding", "with", "target", "output", "size", "being", "just", "below", "max", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe_partial", "(", "(", "char", "*", ")&", "cbuf", "[", "off_full", "]", ",", "(", "char", "*", ")", "testOut", ",", "len", ",", "LEN", "-", "3", ",", "LEN", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_safe_partial", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "compression", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "(", "should", "work", ")", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compress_limitedOutput", "(", "(", "const", "char", "*", ")", "buf", ",", "(", "char", "*", ")&", "cbuf", "[", "FUZ_avail", "-", "len", "]", ",", "LEN", ",", "len", ")", ";", "FUZ_CHECKTEST", "(", "!", "test_canary", "(", "&", "cbuf", "[", "FUZ_avail", "]", "),", "\"", "compression", "overran", "output", "buffer", "\"", ");", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "compression", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "HC", "compression", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "(", "should", "work", ")", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compressHC_limitedOutput", "(", "(", "const", "char", "*", ")", "buf", ",", "(", "char", "*", ")&", "cbuf", "[", "FUZ_avail", "-", "len", "]", ",", "LEN", ",", "lenHC", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "HC", "compression", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "compression", "with", "just", "one", "missing", "byte", "into", "output", "buffer", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compress_limitedOutput", "(", "(", "const", "char", "*", ")", "buf", ",", "(", "char", "*", ")&", "cbuf", "[", "FUZ_avail", "-", "(", "len", "-", "1", ")", "],", "LEN", ",", "len", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ",", "\"", "compression", "overran", "output", "buffer", "\"", ");", "FUZ_CHECKTEST", "(", "!", "test_canary", "(", "&", "cbuf", "[", "FUZ_avail", "]", "),", "\"", "compression", "overran", "output", "buffer", "\"", ");", "/", "/", "Test", "HC", "compression", "with", "just", "one", "missing", "byte", "into", "output", "buffer", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compressHC_limitedOutput", "(", "(", "const", "char", "*", ")", "buf", ",", "(", "char", "*", ")&", "cbuf", "[", "FUZ_avail", "-", "(", "len", "-", "1", ")", "],", "LEN", ",", "lenHC", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ",", "\"", "HC", "compression", "overran", "output", "buffer", "\"", ");", "bytes", "+", "=", "LEN", ";", "cbytes", "+", "=", "len", ";", "hcbytes", "+", "=", "lenHC", ";", "FUZ_rand", "(", "&", "randState", ")", ";", "}", "printf", "(", "\"", "all", "tests", "completed", "successfully", "\\", "n", "\"", ");", "printf", "(", "\"", "compression", "ratio", ":", "%", "0", ".", "3f", "%", "%\\", "n", "\"", ",", "(", "double", ")", "cbytes", "/", "bytes", "*", "100", ")", ";", "printf", "(", "\"", "HC", "compression", "ratio", ":", "%", "0", ".", "3f", "%", "%\\", "n", "\"", ",", "(", "double", ")", "hcbytes", "/", "bytes", "*", "100", ")", ";", "getchar", "(", ");", "return", "0", ";", "_output_error", ":", "getchar", "(", ");", "return", "1", ";", "}", "@", "@", "-", "1", ",", "822", "+", "1", ",", "1247", "@", "@", "/", "*", "LZ4", "-", "Fast", "LZ", "compression", "algorithm", "Copyright", "(", "C", ")", "2011", "-", "2013", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Tuning", "parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "MEMORY_USAGE", ":", "/", "/", "Memory", "usage", "formula", ":", "N", "-", ">", "2", "^", "N", "Bytes", "(", "examples", ":", "10", "-", ">", "1KB", ";", "12", "-", ">", "4KB", ";", "16", "-", ">", "64KB", ";", "20", "-", ">", "1MB", ";", "etc", ".", ")", "/", "/", "Increasing", "memory", "usage", "improves", "compression", "ratio", "/", "/", "Reduced", "memory", "usage", "can", "improve", "speed", ",", "due", "to", "cache", "effect", "/", "/", "Default", "value", "is", "14", ",", "for", "16KB", ",", "which", "nicely", "fits", "into", "Intel", "x86", "L1", "cache", "#", "define", "MEMORY_USAGE", "14", "/", "/", "HEAPMODE", ":", "/", "/", "Select", "how", "default", "compression", "functions", "will", "allocate", "memory", "for", "their", "hash", "table", ",", "/", "/", "in", "memory", "stack", "(", "0", ":", "default", ",", "fastest", ")", ",", "or", "in", "memory", "heap", "(", "1", ":", "requires", "memory", "allocation", "(", "malloc", ")", ").", "#", "define", "HEAPMODE", "0", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "CPU", "Feature", "Detection", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "32", "or", "64", "bits", "?", "#", "if", "(", "defined", "(", "__x86_64__", ")", "|", "|", "defined", "(", "_M_X64", ")", "|", "|", "defined", "(", "_WIN64", ")", "\\", "|", "|", "defined", "(", "__powerpc64__", ")", "|", "|", "defined", "(", "__ppc64__", ")", "|", "|", "defined", "(", "__PPC64__", ")", "\\", "|", "|", "defined", "(", "__64BIT__", ")", "|", "|", "defined", "(", "_LP64", ")", "|", "|", "defined", "(", "__LP64__", ")", "\\", "|", "|", "defined", "(", "__ia64", ")", "|", "|", "defined", "(", "__itanium__", ")", "|", "|", "defined", "(", "_M_IA64", ")", ")", "/", "/", "Detects", "64", "bits", "mode", "#", "define", "LZ4_ARCH64", "1", "#", "else", "#", "define", "LZ4_ARCH64", "0", "#", "endif", "/", "/", "Little", "Endian", "or", "Big", "Endian", "?", "/", "/", "Overwrite", "the", "#", "define", "below", "if", "you", "know", "your", "architecture", "endianess", "#", "if", "defined", "(", "__GLIBC__", ")", "#", "include", "<", "endian", ".", "h", ">", "#", "if", "(", "__BYTE_ORDER", "=", "=", "__BIG_ENDIAN", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "endif", "#", "elif", "(", "defined", "(", "__BIG_ENDIAN__", ")", "|", "|", "defined", "(", "__BIG_ENDIAN", ")", "|", "|", "defined", "(", "_BIG_ENDIAN", ")", ")", "&", "&", "!", "(", "defined", "(", "__LITTLE_ENDIAN__", ")", "|", "|", "defined", "(", "__LITTLE_ENDIAN", ")", "|", "|", "defined", "(", "_LITTLE_ENDIAN", ")", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "elif", "defined", "(", "__sparc", ")", "|", "|", "defined", "(", "__sparc__", ")", "\\", "|", "|", "defined", "(", "__powerpc__", ")", "|", "|", "defined", "(", "__ppc__", ")", "|", "|", "defined", "(", "__PPC__", ")", "\\", "|", "|", "defined", "(", "__hpux", ")", "|", "|", "defined", "(", "__hppa", ")", "\\", "|", "|", "defined", "(", "_MIPSEB", ")", "|", "|", "defined", "(", "__s390__", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "else", "/", "/", "Little", "Endian", "assumed", ".", "PDP", "Endian", "and", "other", "very", "rare", "endian", "format", "are", "unsupported", ".", "#", "endif", "/", "/", "Unaligned", "memory", "access", "is", "automatically", "enabled", "for", "\"", "common", "\"", "CPU", ",", "such", "as", "x86", ".", "/", "/", "For", "others", "CPU", ",", "such", "as", "ARM", ",", "the", "compiler", "may", "be", "more", "cautious", ",", "inserting", "unnecessary", "extra", "code", "to", "ensure", "aligned", "access", "property", "/", "/", "If", "you", "know", "your", "target", "CPU", "supports", "unaligned", "memory", "access", ",", "you", "want", "to", "force", "this", "option", "manually", "to", "improve", "performance", "#", "if", "defined", "(", "__ARM_FEATURE_UNALIGNED", ")", "#", "define", "LZ4_FORCE_UNALIGNED_ACCESS", "1", "#", "endif", "/", "/", "Define", "this", "parameter", "if", "your", "target", "system", "or", "compiler", "does", "not", "support", "hardware", "bit", "count", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "defined", "(", "_WIN32_WCE", ")", "/", "/", "Visual", "Studio", "for", "Windows", "CE", "does", "not", "support", "Hardware", "bit", "count", "#", "define", "LZ4_FORCE_SW_BITCOUNT", "#", "endif", "/", "/", "BIG_ENDIAN_NATIVE_BUT_INCOMPATIBLE", ":", "/", "/", "This", "option", "may", "provide", "a", "small", "boost", "to", "performance", "for", "some", "big", "endian", "cpu", ",", "although", "probably", "modest", ".", "/", "/", "You", "may", "set", "this", "option", "to", "1", "if", "data", "will", "remain", "within", "closed", "environment", ".", "/", "/", "This", "option", "is", "useless", "on", "Little_Endian", "CPU", "(", "such", "as", "x86", ")", "/", "/#", "define", "BIG_ENDIAN_NATIVE_BUT_INCOMPATIBLE", "1", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "(", "__STDC_VERSION__", ">", "=", "199901L", ")", "/", "/", "C99", "/", "*", "\"", "restrict", "\"", "is", "a", "known", "keyword", "*", "/", "#", "else", "#", "define", "restrict", "/", "/", "Disable", "restrict", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "define", "FORCE_INLINE", "static", "__forceinline", "#", "include", "<", "intrin", ".", "h", ">", "/", "/", "For", "Visual", "2005", "#", "if", "LZ4_ARCH64", "/", "/", "64", "-", "bits", "#", "pragma", "intrinsic", "(", "_BitScanForward64", ")", "/", "/", "For", "Visual", "2005", "#", "pragma", "intrinsic", "(", "_BitScanReverse64", ")", "/", "/", "For", "Visual", "2005", "#", "else", "/", "/", "32", "-", "bits", "#", "pragma", "intrinsic", "(", "_BitScanForward", ")", "/", "/", "For", "Visual", "2005", "#", "pragma", "intrinsic", "(", "_BitScanReverse", ")", "/", "/", "For", "Visual", "2005", "#", "endif", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "/", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "#", "else", "#", "ifdef", "__GNUC__", "#", "define", "FORCE_INLINE", "static", "inline", "__attribute__", "(", "(", "always_inline", ")", ")", "#", "else", "#", "define", "FORCE_INLINE", "static", "inline", "#", "endif", "#", "endif", "#", "ifdef", "_MSC_VER", "#", "define", "lz4_bswap16", "(", "x", ")", "_byteswap_ushort", "(", "x", ")", "#", "else", "#", "define", "lz4_bswap16", "(", "x", ")", "(", "(", "unsigned", "short", "int", ")", "(", "((", "(", "x", ")", ">", ">", "8", ")", "&", "0xffu", ")", "|", "(", "((", "x", ")", "&", "0xffu", ")", "<", "<", "8", ")", "))", "#", "endif", "#", "define", "GCC_VERSION", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", "#", "if", "(", "GCC_VERSION", ">", "=", "302", ")", "|", "|", "(", "__INTEL_COMPILER", ">", "=", "800", ")", "|", "|", "defined", "(", "__clang__", ")", "#", "define", "expect", "(", "expr", ",", "value", ")", "(", "__builtin_expect", "(", "(", "expr", ")", ",(", "value", ")", ")", ")", "#", "else", "#", "define", "expect", "(", "expr", ",", "value", ")", "(", "expr", ")", "#", "endif", "#", "define", "likely", "(", "expr", ")", "expect", "(", "(", "expr", ")", "!", "=", "0", ",", "1", ")", "#", "define", "unlikely", "(", "expr", ")", "expect", "(", "(", "expr", ")", "!", "=", "0", ",", "0", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Memory", "routines", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "malloc", ",", "calloc", ",", "free", "#", "define", "ALLOCATOR", "(", "n", ",", "s", ")", "calloc", "(", "n", ",", "s", ")", "#", "define", "FREEMEM", "free", "#", "include", "<", "string", ".", "h", ">", "/", "/", "memset", ",", "memcpy", "#", "define", "MEM_INIT", "memset", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "\"", "lz4", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "typedef", "const", "BYTE", "*", "Ptr", ";", "#", "if", "defined", "(", "__GNUC__", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "#", "define", "_PACKED", "__attribute__", "(", "(", "packed", ")", ")", "#", "else", "#", "define", "_PACKED", "#", "endif", "#", "if", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "ifdef", "__IBMC__", "#", "pragma", "pack", "(", "1", ")", "#", "else", "#", "pragma", "pack", "(", "push", ",", "1", ")", "#", "endif", "#", "endif", "typedef", "struct", "{", "U16", "v", ";", "}", "_PACKED", "U16_S", ";", "typedef", "struct", "{", "U32", "v", ";", "}", "_PACKED", "U32_S", ";", "typedef", "struct", "{", "U64", "v", ";", "}", "_PACKED", "U64_S", ";", "typedef", "struct", "{", "size_t", "v", ";", "}", "_PACKED", "size_t_S", ";", "#", "if", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "pragma", "pack", "(", "pop", ")", "#", "endif", "#", "define", "A16", "(", "x", ")", "(", "((", "U16_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "A32", "(", "x", ")", "(", "((", "U32_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "A64", "(", "x", ")", "(", "((", "U64_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "AARCH", "(", "x", ")", "(", "((", "size_t_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "LZ4_HASHLOG", "(", "MEMORY_USAGE", "-", "2", ")", "#", "define", "HASHTABLESIZE", "(", "1", "<", "<", "MEMORY_USAGE", ")", "#", "define", "HASHNBCELLS4", "(", "1", "<", "<", "LZ4_HASHLOG", ")", "#", "define", "MINMATCH", "4", "#", "define", "COPYLENGTH", "8", "#", "define", "LASTLITERALS", "5", "#", "define", "MFLIMIT", "(", "COPYLENGTH", "+", "MINMATCH", ")", "const", "int", "LZ4_minLength", "=", "(", "MFLIMIT", "+", "1", ")", ";", "#", "define", "LZ4_64KLIMIT", "(", "(", "1", "<", "<", "16", ")", "+", "(", "MFLIMIT", "-", "1", ")", ")", "#", "define", "SKIPSTRENGTH", "6", "/", "/", "Increasing", "this", "value", "will", "make", "the", "compression", "run", "slower", "on", "incompressible", "data", "#", "define", "MAXD_LOG", "16", "#", "define", "MAX_DISTANCE", "(", "(", "1", "<", "<", "MAXD_LOG", ")", "-", "1", ")", "#", "define", "ML_BITS", "4", "#", "define", "ML_MASK", "(", "(", "1U", "<", "<", "ML_BITS", ")", "-", "1", ")", "#", "define", "RUN_BITS", "(", "8", "-", "ML_BITS", ")", "#", "define", "RUN_MASK", "(", "(", "1U", "<", "<", "RUN_BITS", ")", "-", "1", ")", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Structures", "and", "local", "types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "struct", "{", "U32", "hashTable", "[", "HASHNBCELLS4", "]", ";", "Ptr", "bufferStart", ";", "Ptr", "base", ";", "Ptr", "nextBlock", ";", "}", "LZ4_Data_Structure", ";", "typedef", "enum", "{", "notLimited", "=", "0", ",", "limited", "=", "1", "}", "limitedOutput_directive", ";", "typedef", "enum", "{", "byPtr", ",", "byU32", ",", "byU16", "}", "tableType_t", ";", "typedef", "enum", "{", "noPrefix", "=", "0", ",", "withPrefix", "=", "1", "}", "prefix64k_directive", ";", "typedef", "enum", "{", "endOnOutputSize", "=", "0", ",", "endOnInputSize", "=", "1", "}", "endCondition_directive", ";", "typedef", "enum", "{", "full", "=", "0", ",", "partial", "=", "1", "}", "earlyEnd_directive", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Architecture", "-", "specific", "macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "STEPSIZE", "sizeof", "(", "size_t", ")", "#", "define", "LZ4_COPYSTEP", "(", "d", ",", "s", ")", "{", "AARCH", "(", "d", ")", "=", "AARCH", "(", "s", ")", ";", "d", "+", "=", "STEPSIZE", ";", "s", "+", "=", "STEPSIZE", ";", "}", "#", "define", "LZ4_COPY8", "(", "d", ",", "s", ")", "{", "LZ4_COPYSTEP", "(", "d", ",", "s", ")", ";", "if", "(", "STEPSIZE", "<", "8", ")", "LZ4_COPYSTEP", "(", "d", ",", "s", ")", ";", "}", "#", "define", "LZ4_SECURECOPY", "(", "d", ",", "s", ",", "e", ")", "{", "if", "(", "(", "STEPSIZE", "=", "=", "4", ")", "||", "(", "d", "<", "e", ")", ")", "LZ4_WILDCOPY", "(", "d", ",", "s", ",", "e", ")", ";", "}", "#", "if", "LZ4_ARCH64", "/", "/", "64", "-", "bit", "#", "define", "HTYPE", "U32", "#", "define", "INITBASE", "(", "base", ")", "Ptr", "const", "base", "=", "ip", "#", "else", "/", "/", "32", "-", "bit", "#", "define", "HTYPE", "Ptr", "#", "define", "INITBASE", "(", "base", ")", "const", "int", "base", "=", "0", "#", "endif", "#", "if", "(", "defined", "(", "LZ4_BIG_ENDIAN", ")", "&", "&", "!", "defined", "(", "BIG_ENDIAN_NATIVE_BUT_INCOMPATIBLE", ")", ")", "#", "define", "LZ4_READ_LITTLEENDIAN_16", "(", "d", ",", "s", ",", "p", ")", "{", "U16", "v", "=", "A16", "(", "p", ")", ";", "v", "=", "lz4_bswap16", "(", "v", ")", ";", "d", "=", "(", "s", ")", "-", "v", ";", "}", "#", "define", "LZ4_WRITE_LITTLEENDIAN_16", "(", "p", ",", "i", ")", "{", "U16", "v", "=", "(", "U16", ")", "(", "i", ")", ";", "v", "=", "lz4_bswap16", "(", "v", ")", ";", "A16", "(", "p", ")", "=", "v", ";", "p", "+", "=", "2", ";", "}", "#", "else", "/", "/", "Little", "Endian", "#", "define", "LZ4_READ_LITTLEENDIAN_16", "(", "d", ",", "s", ",", "p", ")", "{", "d", "=", "(", "s", ")", "-", "A16", "(", "p", ")", ";", "}", "#", "define", "LZ4_WRITE_LITTLEENDIAN_16", "(", "p", ",", "v", ")", "{", "A16", "(", "p", ")", "=", "v", ";", "p", "+", "=", "2", ";", "}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "LZ4_WILDCOPY", "(", "d", ",", "s", ",", "e", ")", "{", "do", "{", "LZ4_COPY8", "(", "d", ",", "s", ")", "}", "while", "(", "d", "<", "e", ")", ";", "}", "/", "/", "at", "the", "end", ",", "d", ">", "=", "e", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Private", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "LZ4_ARCH64", "FORCE_INLINE", "int", "LZ4_NbCommonBytes", "(", "register", "U64", "val", ")", "{", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanReverse64", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "GCC_VERSION", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_clzll", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "int", "r", ";", "if", "(", "!(", "val", ">", ">", "32", ")", ")", "{", "r", "=", "4", ";", "}", "else", "{", "r", "=", "0", ";", "val", ">", ">=", "32", ";", "}", "if", "(", "!(", "val", ">", ">", "16", ")", ")", "{", "r", "+", "=", "2", ";", "val", ">", ">=", "8", ";", "}", "else", "{", "val", ">", ">=", "24", ";", "}", "r", "+", "=", "(", "!", "val", ")", ";", "return", "r", ";", "#", "endif", "#", "else", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanForward64", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "GCC_VERSION", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_ctzll", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "static", "const", "int", "DeBruijnBytePos", "[", "64", "]", "=", "{", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", ",", "2", ",", "0", ",", "3", ",", "1", ",", "3", ",", "1", ",", "4", ",", "2", ",", "7", ",", "0", ",", "2", ",", "3", ",", "6", ",", "1", ",", "5", ",", "3", ",", "5", ",", "1", ",", "3", ",", "4", ",", "4", ",", "2", ",", "5", ",", "6", ",", "7", ",", "7", ",", "0", ",", "1", ",", "2", ",", "3", ",", "3", ",", "4", ",", "6", ",", "2", ",", "6", ",", "5", ",", "5", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", "1", ",", "2", ",", "4", ",", "6", ",", "4", ",", "4", ",", "5", ",", "7", ",", "2", ",", "6", ",", "5", ",", "7", ",", "6", ",", "7", ",", "7", "}", ";", "return", "DeBruijnBytePos", "[", "((", "U64", ")", "((", "val", "&", "-", "(", "long", "long", ")", "val", ")", "*", "0x0218A392CDABBD3FULL", ")", ")", ">", ">", "58", "]", ";", "#", "endif", "#", "endif", "}", "#", "else", "FORCE_INLINE", "int", "LZ4_NbCommonBytes", "(", "register", "U32", "val", ")", "{", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanReverse", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "GCC_VERSION", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_clz", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "int", "r", ";", "if", "(", "!(", "val", ">", ">", "16", ")", ")", "{", "r", "=", "2", ";", "val", ">", ">=", "8", ";", "}", "else", "{", "r", "=", "0", ";", "val", ">", ">=", "24", ";", "}", "r", "+", "=", "(", "!", "val", ")", ";", "return", "r", ";", "#", "endif", "#", "else", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", ";", "_BitScanForward", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "GCC_VERSION", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_ctz", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "static", "const", "int", "DeBruijnBytePos", "[", "32", "]", "=", "{", "0", ",", "0", ",", "3", ",", "0", ",", "3", ",", "1", ",", "3", ",", "0", ",", "3", ",", "2", ",", "2", ",", "1", ",", "3", ",", "2", ",", "0", ",", "1", ",", "3", ",", "3", ",", "1", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "3", ",", "1", ",", "2", ",", "0", ",", "1", ",", "0", ",", "1", ",", "1", "}", ";", "return", "DeBruijnBytePos", "[", "((", "U32", ")", "((", "val", "&", "-", "(", "S32", ")", "val", ")", "*", "0x077CB531U", ")", ")", ">", ">", "27", "]", ";", "#", "endif", "#", "endif", "}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compression", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "FORCE_INLINE", "int", "LZ4_hashSequence", "(", "U32", "sequence", ",", "tableType_t", "tableType", ")", "{", "if", "(", "tableType", "=", "=", "byU16", ")", "return", "(", "((", "sequence", ")", "*", "2654435761U", ")", ">", ">", "(", "(", "MINMATCH", "*", "8", ")", "-(", "LZ4_HASHLOG", "+", "1", ")", "))", ";", "else", "return", "(", "((", "sequence", ")", "*", "2654435761U", ")", ">", ">", "(", "(", "MINMATCH", "*", "8", ")", "-", "LZ4_HASHLOG", ")", ");", "}", "FORCE_INLINE", "int", "LZ4_hashPosition", "(", "Ptr", "p", ",", "tableType_t", "tableType", ")", "{", "return", "LZ4_hashSequence", "(", "A32", "(", "p", ")", ",", "tableType", ")", ";", "}", "FORCE_INLINE", "void", "LZ4_putPositionOnHash", "(", "Ptr", "p", ",", "U32", "h", ",", "void", "*", "tableBase", ",", "tableType_t", "tableType", ",", "Ptr", "srcBase", ")", "{", "switch", "(", "tableType", ")", "{", "case", "byPtr", ":", "{", "Ptr", "*", "hashTable", "=", "(", "Ptr", "*", ")", "tableBase", ";", "hashTable", "[", "h", "]", "=", "p", ";", "break", ";", "}", "case", "byU32", ":", "{", "U32", "*", "hashTable", "=", "(", "U32", "*", ")", "tableBase", ";", "hashTable", "[", "h", "]", "=", "p", "-", "srcBase", ";", "break", ";", "}", "case", "byU16", ":", "{", "U16", "*", "hashTable", "=", "(", "U16", "*", ")", "tableBase", ";", "hashTable", "[", "h", "]", "=", "(", "U16", ")", "(", "p", "-", "srcBase", ")", ";", "break", ";", "}", "}", "}", "FORCE_INLINE", "void", "LZ4_putPosition", "(", "Ptr", "p", ",", "void", "*", "tableBase", ",", "tableType_t", "tableType", ",", "Ptr", "srcBase", ")", "{", "U32", "h", "=", "LZ4_hashPosition", "(", "p", ",", "tableType", ")", ";", "LZ4_putPositionOnHash", "(", "p", ",", "h", ",", "tableBase", ",", "tableType", ",", "srcBase", ")", ";", "}", "FORCE_INLINE", "Ptr", "LZ4_getPositionOnHash", "(", "U32", "h", ",", "void", "*", "tableBase", ",", "tableType_t", "tableType", ",", "Ptr", "srcBase", ")", "{", "if", "(", "tableType", "=", "=", "byPtr", ")", "{", "Ptr", "*", "hashTable", "=", "(", "Ptr", "*", ")", "tableBase", ";", "return", "hashTable", "[", "h", "]", ";", "}", "if", "(", "tableType", "=", "=", "byU32", ")", "{", "U32", "*", "hashTable", "=", "(", "U32", "*", ")", "tableBase", ";", "return", "hashTable", "[", "h", "]", "+", "srcBase", ";", "}", "{", "U16", "*", "hashTable", "=", "(", "U16", "*", ")", "tableBase", ";", "return", "hashTable", "[", "h", "]", "+", "srcBase", ";", "}", "/", "/", "default", ",", "to", "ensure", "a", "return", "}", "FORCE_INLINE", "Ptr", "LZ4_getPosition", "(", "Ptr", "p", ",", "void", "*", "tableBase", ",", "tableType_t", "tableType", ",", "Ptr", "srcBase", ")", "{", "U32", "h", "=", "LZ4_hashPosition", "(", "p", ",", "tableType", ")", ";", "return", "LZ4_getPositionOnHash", "(", "h", ",", "tableBase", ",", "tableType", ",", "srcBase", ")", ";", "}", "FORCE_INLINE", "int", "LZ4_compress_generic", "(", "void", "*", "ctx", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "limitedOutput_directive", "limitedOutput", ",", "tableType_t", "tableType", ",", "prefix64k_directive", "prefix", ")", "{", "Ptr", "ip", "=", "(", "Ptr", ")", "source", ";", "Ptr", "const", "base", "=", "(", "prefix", "=", "=", "withPrefix", ")", "?", "(", "(", "LZ4_Data_Structure", "*", ")", "ctx", ")", "->", "base", ":", "(", "Ptr", ")", "source", ";", "Ptr", "const", "lowLimit", "=", "(", "(", "prefix", "=", "=", "withPrefix", ")", "?", "(", "(", "LZ4_Data_Structure", "*", ")", "ctx", ")", "->", "bufferStart", ":", "(", "Ptr", ")", "source", ")", ";", "Ptr", "anchor", "=", "(", "Ptr", ")", "source", ";", "Ptr", "const", "iend", "=", "ip", "+", "inputSize", ";", "Ptr", "const", "mflimit", "=", "iend", "-", "MFLIMIT", ";", "Ptr", "const", "matchlimit", "=", "iend", "-", "LASTLITERALS", ";", "BYTE", "*", "op", "=", "(", "BYTE", "*", ")", "dest", ";", "BYTE", "*", "const", "oend", "=", "op", "+", "maxOutputSize", ";", "int", "length", ";", "const", "int", "skipStrength", "=", "SKIPSTRENGTH", ";", "U32", "forwardH", ";", "/", "/", "Init", "conditions", "if", "(", "(", "prefix", "=", "=", "withPrefix", ")", "&", "&", "(", "ip", "!", "=", "(", "(", "LZ4_Data_Structure", "*", ")", "ctx", ")", "->", "nextBlock", ")", ")", "return", "0", ";", "/", "/", "must", "continue", "from", "end", "of", "previous", "block", "if", "(", "prefix", "=", "=", "withPrefix", ")", "(", "(", "LZ4_Data_Structure", "*", ")", "ctx", ")", "->", "nextBlock", "=", "iend", ";", "/", "/", "do", "it", "now", ",", "due", "to", "potential", "early", "exit", "if", "(", "(", "tableType", "=", "=", "byU16", ")", "&", "&", "(", "inputSize", ">", "=", "LZ4_64KLIMIT", ")", ")", "return", "0", ";", "/", "/", "Size", "too", "large", "(", "not", "within", "64K", "limit", ")", "if", "(", "inputSize", "<", "LZ4_minLength", ")", "goto", "_last_literals", ";", "/", "/", "Input", "too", "small", ",", "no", "compression", "(", "all", "literals", ")", "/", "/", "First", "Byte", "LZ4_putPosition", "(", "ip", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "ip", "+", "+;", "forwardH", "=", "LZ4_hashPosition", "(", "ip", ",", "tableType", ")", ";", "/", "/", "Main", "Loop", "for", "(", ";", ";", ")", "{", "int", "findMatchAttempts", "=", "(", "1U", "<", "<", "skipStrength", ")", "+", "3", ";", "Ptr", "forwardIp", "=", "ip", ";", "Ptr", "ref", ";", "BYTE", "*", "token", ";", "/", "/", "Find", "a", "match", "do", "{", "U32", "h", "=", "forwardH", ";", "int", "step", "=", "findMatchAttempts", "+", "+", ">", ">", "skipStrength", ";", "ip", "=", "forwardIp", ";", "forwardIp", "=", "ip", "+", "step", ";", "if", "unlikely", "(", "forwardIp", ">", "mflimit", ")", "{", "goto", "_last_literals", ";", "}", "forwardH", "=", "LZ4_hashPosition", "(", "forwardIp", ",", "tableType", ")", ";", "ref", "=", "LZ4_getPositionOnHash", "(", "h", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "LZ4_putPositionOnHash", "(", "ip", ",", "h", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "}", "while", "(", "(", "ref", "+", "MAX_DISTANCE", "<", "ip", ")", "|", "|", "(", "A32", "(", "ref", ")", "!", "=", "A32", "(", "ip", ")", "))", ";", "/", "/", "Catch", "up", "while", "(", "(", "ip", ">", "anchor", ")", "&", "&", "(", "ref", ">", "lowLimit", ")", "&", "&", "unlikely", "(", "ip", "[", "-", "1", "]", "==", "ref", "[", "-", "1", "]", "))", "{", "ip", "-", "-;", "ref", "-", "-;", "}", "/", "/", "Encode", "Literal", "length", "length", "=", "(", "int", ")", "(", "ip", "-", "anchor", ")", ";", "token", "=", "op", "+", "+;", "if", "(", "(", "limitedOutput", ")", "&", "&", "unlikely", "(", "op", "+", "length", "+", "(", "2", "+", "1", "+", "LASTLITERALS", ")", "+", "(", "length", ">", ">", "8", ")", ">", "oend", ")", ")", "return", "0", ";", "/", "/", "Check", "output", "limit", "if", "(", "length", ">", "=(", "int", ")", "RUN_MASK", ")", "{", "int", "len", "=", "length", "-", "RUN_MASK", ";", "*", "token", "=", "(", "RUN_MASK", "<", "<", "ML_BITS", ")", ";", "for", "(", ";", "len", ">", "=", "255", ";", "len", "-", "=", "255", ")", "*", "op", "+", "+", "=", "255", ";", "*", "op", "+", "+", "=", "(", "BYTE", ")", "len", ";", "}", "else", "*", "token", "=", "(", "BYTE", ")", "(", "length", "<", "<", "ML_BITS", ")", ";", "/", "/", "Copy", "Literals", "{", "BYTE", "*", "end", "=", "(", "op", ")", "+(", "length", ")", ";", "LZ4_WILDCOPY", "(", "op", ",", "anchor", ",", "end", ")", ";", "op", "=", "end", ";", "}", "_next_match", ":", "/", "/", "Encode", "Offset", "LZ4_WRITE_LITTLEENDIAN_16", "(", "op", ",", "(", "U16", ")", "(", "ip", "-", "ref", ")", ");", "/", "/", "Start", "Counting", "ip", "+", "=", "MINMATCH", ";", "ref", "+", "=", "MINMATCH", ";", "/", "/", "MinMatch", "already", "verified", "anchor", "=", "ip", ";", "while", "likely", "(", "ip", "<", "matchlimit", "-", "(", "STEPSIZE", "-", "1", ")", ")", "{", "size_t", "diff", "=", "AARCH", "(", "ref", ")", "^", "AARCH", "(", "ip", ")", ";", "if", "(", "!", "diff", ")", "{", "ip", "+", "=", "STEPSIZE", ";", "ref", "+", "=", "STEPSIZE", ";", "continue", ";", "}", "ip", "+", "=", "LZ4_NbCommonBytes", "(", "diff", ")", ";", "goto", "_endCount", ";", "}", "if", "(", "LZ4_ARCH64", ")", "if", "(", "(", "ip", "<", "(", "matchlimit", "-", "3", ")", ")", "&", "&", "(", "A32", "(", "ref", ")", "=", "=", "A32", "(", "ip", ")", "))", "{", "ip", "+", "=", "4", ";", "ref", "+", "=", "4", ";", "}", "if", "(", "(", "ip", "<", "(", "matchlimit", "-", "1", ")", ")", "&", "&", "(", "A16", "(", "ref", ")", "=", "=", "A16", "(", "ip", ")", "))", "{", "ip", "+", "=", "2", ";", "ref", "+", "=", "2", ";", "}", "if", "(", "(", "ip", "<", "matchlimit", ")", "&", "&", "(", "*", "ref", "=", "=", "*", "ip", ")", ")", "ip", "+", "+;", "_endCount", ":", "/", "/", "Encode", "MatchLength", "length", "=", "(", "int", ")", "(", "ip", "-", "anchor", ")", ";", "if", "(", "(", "limitedOutput", ")", "&", "&", "unlikely", "(", "op", "+", "(", "1", "+", "LASTLITERALS", ")", "+", "(", "length", ">", ">", "8", ")", ">", "oend", ")", ")", "return", "0", ";", "/", "/", "Check", "output", "limit", "if", "(", "length", ">", "=(", "int", ")", "ML_MASK", ")", "{", "*", "token", "+", "=", "ML_MASK", ";", "length", "-", "=", "ML_MASK", ";", "for", "(", ";", "length", ">", "509", ";", "length", "-", "=", "510", ")", "{", "*", "op", "+", "+", "=", "255", ";", "*", "op", "+", "+", "=", "255", ";", "}", "if", "(", "length", ">", "=", "255", ")", "{", "length", "-", "=", "255", ";", "*", "op", "+", "+", "=", "255", ";", "}", "*", "op", "+", "+", "=", "(", "BYTE", ")", "length", ";", "}", "else", "*", "token", "+", "=", "(", "BYTE", ")", "(", "length", ")", ";", "/", "/", "Test", "end", "of", "chunk", "if", "(", "ip", ">", "mflimit", ")", "{", "anchor", "=", "ip", ";", "break", ";", "}", "/", "/", "Fill", "table", "LZ4_putPosition", "(", "ip", "-", "2", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "/", "/", "Test", "next", "position", "ref", "=", "LZ4_getPosition", "(", "ip", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "LZ4_putPosition", "(", "ip", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "if", "(", "(", "ref", "+", "MAX_DISTANCE", ">", "=", "ip", ")", "&", "&", "(", "A32", "(", "ref", ")", "=", "=", "A32", "(", "ip", ")", "))", "{", "token", "=", "op", "+", "+;", "*", "token", "=", "0", ";", "goto", "_next_match", ";", "}", "/", "/", "Prepare", "next", "loop", "anchor", "=", "ip", "+", "+;", "forwardH", "=", "LZ4_hashPosition", "(", "ip", ",", "tableType", ")", ";", "}", "_last_literals", ":", "/", "/", "Encode", "Last", "Literals", "{", "int", "lastRun", "=", "(", "int", ")", "(", "iend", "-", "anchor", ")", ";", "if", "(", "(", "limitedOutput", ")", "&", "&", "(", "((", "char", "*", ")", "op", "-", "dest", ")", "+", "lastRun", "+", "1", "+", "(", "(", "lastRun", "+", "255", "-", "RUN_MASK", ")", "/", "255", ")", ">", "(", "U32", ")", "maxOutputSize", ")", ")", "return", "0", ";", "/", "/", "Check", "output", "limit", "if", "(", "lastRun", ">", "=(", "int", ")", "RUN_MASK", ")", "{", "*", "op", "+", "+=", "(", "RUN_MASK", "<", "<", "ML_BITS", ")", ";", "lastRun", "-", "=", "RUN_MASK", ";", "for", "(", ";", "lastRun", ">", "=", "255", ";", "lastRun", "-", "=", "255", ")", "*", "op", "+", "+", "=", "255", ";", "*", "op", "+", "+", "=", "(", "BYTE", ")", "lastRun", ";", "}", "else", "*", "op", "+", "+", "=", "(", "BYTE", ")", "(", "lastRun", "<", "<", "ML_BITS", ")", ";", "memcpy", "(", "op", ",", "anchor", ",", "iend", "-", "anchor", ")", ";", "op", "+", "=", "iend", "-", "anchor", ";", "}", "/", "/", "End", "return", "(", "int", ")", "(", "((", "char", "*", ")", "op", ")", "-", "dest", ")", ";", "}", "int", "LZ4_compress", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "#", "if", "(", "HEAPMODE", ")", "void", "*", "ctx", "=", "ALLOCATOR", "(", "HASHNBCELLS4", ",", "4", ")", ";", "/", "/", "Aligned", "on", "4", "-", "bytes", "boundaries", "#", "else", "U32", "ctx", "[", "1U", "<", "<(", "MEMORY_USAGE", "-", "2", ")", "]", "=", "{", "0", "}", ";", "/", "/", "Ensure", "data", "is", "aligned", "on", "4", "-", "bytes", "boundaries", "#", "endif", "int", "result", ";", "if", "(", "inputSize", "<", "(", "int", ")", "LZ4_64KLIMIT", ")", "result", "=", "LZ4_compress_generic", "(", "(", "void", "*", ")", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ",", "byU16", ",", "noPrefix", ")", ";", "else", "result", "=", "LZ4_compress_generic", "(", "(", "void", "*", ")", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ",", "(", "sizeof", "(", "void", "*", ")=", "=", "8", ")", "?", "byU32", ":", "byPtr", ",", "noPrefix", ")", ";", "#", "if", "(", "HEAPMODE", ")", "FREEMEM", "(", "ctx", ")", ";", "#", "endif", "return", "result", ";", "}", "int", "LZ4_compress_continue", "(", "void", "*", "LZ4_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "return", "LZ4_compress_generic", "(", "LZ4_Data", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ",", "byU32", ",", "withPrefix", ")", ";", "}", "int", "LZ4_compress_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "#", "if", "(", "HEAPMODE", ")", "void", "*", "ctx", "=", "ALLOCATOR", "(", "HASHNBCELLS4", ",", "4", ")", ";", "/", "/", "Aligned", "on", "4", "-", "bytes", "boundaries", "#", "else", "U32", "ctx", "[", "1U", "<", "<(", "MEMORY_USAGE", "-", "2", ")", "]", "=", "{", "0", "}", ";", "/", "/", "Ensure", "data", "is", "aligned", "on", "4", "-", "bytes", "boundaries", "#", "endif", "int", "result", ";", "if", "(", "inputSize", "<", "(", "int", ")", "LZ4_64KLIMIT", ")", "result", "=", "LZ4_compress_generic", "(", "(", "void", "*", ")", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limited", ",", "byU16", ",", "noPrefix", ")", ";", "else", "result", "=", "LZ4_compress_generic", "(", "(", "void", "*", ")", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limited", ",", "(", "sizeof", "(", "void", "*", ")=", "=", "8", ")", "?", "byU32", ":", "byPtr", ",", "noPrefix", ")", ";", "#", "if", "(", "HEAPMODE", ")", "FREEMEM", "(", "ctx", ")", ";", "#", "endif", "return", "result", ";", "}", "int", "LZ4_compress_limitedOutput_continue", "(", "void", "*", "LZ4_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_compress_generic", "(", "LZ4_Data", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limited", ",", "byU32", ",", "withPrefix", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Stream", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "FORCE_INLINE", "void", "LZ4_init", "(", "LZ4_Data_Structure", "*", "lz4ds", ",", "Ptr", "base", ")", "{", "MEM_INIT", "(", "lz4ds", "-", ">", "hashTable", ",", "0", ",", "sizeof", "(", "lz4ds", "-", ">", "hashTable", ")", ");", "lz4ds", "-", ">", "bufferStart", "=", "base", ";", "lz4ds", "-", ">", "base", "=", "base", ";", "lz4ds", "-", ">", "nextBlock", "=", "base", ";", "}", "void", "*", "LZ4_create", "(", "const", "char", "*", "inputBuffer", ")", "{", "void", "*", "lz4ds", "=", "ALLOCATOR", "(", "1", ",", "sizeof", "(", "LZ4_Data_Structure", ")", ");", "LZ4_init", "(", "(", "LZ4_Data_Structure", "*", ")", "lz4ds", ",", "(", "Ptr", ")", "inputBuffer", ")", ";", "return", "lz4ds", ";", "}", "int", "LZ4_free", "(", "void", "*", "LZ4_Data", ")", "{", "FREEMEM", "(", "LZ4_Data", ")", ";", "return", "(", "0", ")", ";", "}", "char", "*", "LZ4_slideInputBuffer", "(", "void", "*", "LZ4_Data", ")", "{", "LZ4_Data_Structure", "*", "lz4ds", "=", "(", "LZ4_Data_Structure", "*", ")", "LZ4_Data", ";", "size_t", "delta", "=", "lz4ds", "-", ">", "nextBlock", "-", "(", "lz4ds", "-", ">", "bufferStart", "+", "64", "KB", ")", ";", "if", "(", "lz4ds", "-", ">", "base", "-", "delta", ">", "lz4ds", "-", ">", "base", ")", "/", "/", "underflow", "control", "{", "size_t", "newBaseDelta", "=", "(", "lz4ds", "-", ">", "nextBlock", "-", "64", "KB", ")", "-", "lz4ds", "-", ">", "base", ";", "int", "nH", ";", "for", "(", "nH", "=", "0", ";", "nH", "<", "HASHNBCELLS4", ";", "nH", "+", "+)", "{", "if", "(", "lz4ds", "-", ">", "hashTable", "[", "nH", "]", "<", "(", "U32", ")", "newBaseDelta", ")", "lz4ds", "-", ">", "hashTable", "[", "nH", "]", "=", "0", ";", "else", "lz4ds", "-", ">", "hashTable", "[", "nH", "]", "-", "=", "newBaseDelta", ";", "}", "lz4ds", "-", ">", "base", "+", "=", "newBaseDelta", ";", "}", "memcpy", "(", "(", "void", "*", ")(", "lz4ds", "-", ">", "bufferStart", ")", ",", "(", "const", "void", "*", ")(", "lz4ds", "-", ">", "nextBlock", "-", "64", "KB", ")", ",", "64", "KB", ")", ";", "lz4ds", "-", ">", "nextBlock", "-", "=", "delta", ";", "lz4ds", "-", ">", "base", "-", "=", "delta", ";", "return", "(", "char", "*", ")(", "lz4ds", "-", ">", "nextBlock", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Decompression", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "This", "generic", "decompression", "function", "cover", "all", "use", "cases", ".", "/", "/", "It", "shall", "be", "instanciated", "several", "times", ",", "using", "different", "sets", "of", "directives", "/", "/", "Note", "that", "it", "is", "essential", "this", "generic", "function", "is", "really", "inlined", ",", "/", "/", "in", "order", "to", "remove", "useless", "branches", "during", "compilation", "optimisation", ".", "FORCE_INLINE", "int", "LZ4_decompress_generic", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "/", "/", "int", "outputSize", ",", "/", "/", "OutputSize", "must", "be", "!", "=", "0", ";", "if", "endOnInput", "=", "=", "endOnInputSize", ",", "this", "value", "is", "the", "max", "size", "of", "Output", "Buffer", ".", "int", "endOnInput", ",", "/", "/", "endOnOutputSize", ",", "endOnInputSize", "int", "prefix64k", ",", "/", "/", "noPrefix", ",", "withPrefix", "int", "partialDecoding", ",", "/", "/", "full", ",", "partial", "int", "targetOutputSize", "/", "/", "only", "used", "if", "partialDecoding", "=", "=", "partial", ")", "{", "/", "/", "Local", "Variables", "Ptr", "restrict", "ip", "=", "(", "Ptr", ")", "source", ";", "Ptr", "ref", ";", "Ptr", "const", "iend", "=", "ip", "+", "inputSize", ";", "BYTE", "*", "op", "=", "(", "BYTE", "*", ")", "dest", ";", "BYTE", "*", "const", "oend", "=", "op", "+", "outputSize", ";", "BYTE", "*", "cpy", ";", "BYTE", "*", "oexit", "=", "op", "+", "targetOutputSize", ";", "size_t", "dec32table", "[", "]", "=", "{", "0", ",", "3", ",", "2", ",", "3", ",", "0", ",", "0", ",", "0", ",", "0", "}", ";", "#", "if", "LZ4_ARCH64", "size_t", "dec64table", "[", "]", "=", "{", "0", ",", "0", ",", "0", ",", "(", "size_t", ")", "-", "1", ",", "0", ",", "1", ",", "2", ",", "3", "}", ";", "#", "endif", "/", "/", "Special", "cases", "if", "(", "(", "partialDecoding", ")", "&", "&", "(", "oexit", ">", "oend", "-", "MFLIMIT", ")", ")", "oexit", "=", "oend", "-", "MFLIMIT", ";", "/", "/", "targetOutputSize", "too", "high", "=", ">", "decode", "everything", "if", "(", "(", "endOnInput", ")", "&", "&", "unlikely", "(", "outputSize", "=", "=", "0", ")", ")", "return", "(", "(", "inputSize", "=", "=", "1", ")", "&", "&", "(", "*", "ip", "=", "=", "0", ")", ")", "?", "0", ":", "-", "1", ";", "/", "/", "Empty", "output", "buffer", "if", "(", "(!", "endOnInput", ")", "&", "&", "unlikely", "(", "outputSize", "=", "=", "0", ")", ")", "return", "(", "*", "ip", "=", "=", "0", "?", "1", ":", "-", "1", ")", ";", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "unsigned", "token", ";", "size_t", "length", ";", "/", "/", "get", "runlength", "token", "=", "*", "ip", "+", "+;", "if", "(", "(", "length", "=", "(", "token", ">", ">", "ML_BITS", ")", ")", "=", "=", "RUN_MASK", ")", "{", "unsigned", "s", ";", "do", "{", "s", "=", "*", "ip", "+", "+;", "length", "+", "=", "s", ";", "}", "while", "(", "likely", "(", "(", "endOnInput", ")", "?", "ip", "<", "iend", "-", "RUN_MASK", ":", "1", ")", "&", "&", "(", "s", "=", "=", "255", ")", ");", "if", "(", "(", "sizeof", "(", "void", "*", ")=", "=", "4", ")", "&", "&", "unlikely", "(", "length", ">", "LZ4_MAX_INPUT_SIZE", ")", ")", "goto", "_output_error", ";", "/", "*", "overflow", "detection", "*", "/", "}", "/", "/", "copy", "literals", "cpy", "=", "op", "+", "length", ";", "if", "(", "((", "endOnInput", ")", "&", "&", "(", "(", "cpy", ">", "(", "partialDecoding", "?", "oexit", ":", "oend", "-", "MFLIMIT", ")", ")", "|", "|", "(", "ip", "+", "length", ">", "iend", "-", "(", "2", "+", "1", "+", "LASTLITERALS", ")", "))", ")", "|", "|", "(", "(!", "endOnInput", ")", "&", "&", "(", "cpy", ">", "oend", "-", "COPYLENGTH", ")", "))", "{", "if", "(", "partialDecoding", ")", "{", "if", "(", "cpy", ">", "oend", ")", "goto", "_output_error", ";", "/", "/", "Error", ":", "write", "attempt", "beyond", "end", "of", "output", "buffer", "if", "(", "(", "endOnInput", ")", "&", "&", "(", "ip", "+", "length", ">", "iend", ")", ")", "goto", "_output_error", ";", "/", "/", "Error", ":", "read", "attempt", "beyond", "end", "of", "input", "buffer", "}", "else", "{", "if", "(", "(!", "endOnInput", ")", "&", "&", "(", "cpy", "!", "=", "oend", ")", ")", "goto", "_output_error", ";", "/", "/", "Error", ":", "block", "decoding", "must", "stop", "exactly", "there", "if", "(", "(", "endOnInput", ")", "&", "&", "(", "(", "ip", "+", "length", "!", "=", "iend", ")", "|", "|", "(", "cpy", ">", "oend", ")", "))", "goto", "_output_error", ";", "/", "/", "Error", ":", "input", "must", "be", "consumed", "}", "memcpy", "(", "op", ",", "ip", ",", "length", ")", ";", "ip", "+", "=", "length", ";", "op", "+", "=", "length", ";", "break", ";", "/", "/", "Necessarily", "EOF", ",", "due", "to", "parsing", "restrictions", "}", "LZ4_WILDCOPY", "(", "op", ",", "ip", ",", "cpy", ")", ";", "ip", "-", "=", "(", "op", "-", "cpy", ")", ";", "op", "=", "cpy", ";", "/", "/", "get", "offset", "LZ4_READ_LITTLEENDIAN_16", "(", "ref", ",", "cpy", ",", "ip", ")", ";", "ip", "+", "=", "2", ";", "if", "(", "(", "prefix64k", "=", "=", "noPrefix", ")", "&", "&", "unlikely", "(", "ref", "<", "(", "BYTE", "*", "const", ")", "dest", ")", ")", "goto", "_output_error", ";", "/", "/", "Error", ":", "offset", "outside", "destination", "buffer", "/", "/", "get", "matchlength", "if", "(", "(", "length", "=", "(", "token", "&", "ML_MASK", ")", ")", "=", "=", "ML_MASK", ")", "{", "unsigned", "s", ";", "do", "{", "if", "(", "endOnInput", "&", "&", "(", "ip", ">", "iend", "-", "LASTLITERALS", ")", ")", "goto", "_output_error", ";", "s", "=", "*", "ip", "+", "+;", "length", "+", "=", "s", ";", "}", "while", "(", "s", "=", "=", "255", ")", ";", "if", "(", "(", "sizeof", "(", "void", "*", ")=", "=", "4", ")", "&", "&", "unlikely", "(", "length", ">", "LZ4_MAX_INPUT_SIZE", ")", ")", "goto", "_output_error", ";", "/", "*", "overflow", "detection", "*", "/", "}", "/", "/", "copy", "repeated", "sequence", "if", "unlikely", "(", "(", "op", "-", "ref", ")", "<(", "int", ")", "STEPSIZE", ")", "{", "#", "if", "LZ4_ARCH64", "size_t", "dec64", "=", "dec64table", "[", "op", "-", "ref", "]", ";", "#", "else", "const", "size_t", "dec64", "=", "0", ";", "#", "endif", "op", "[", "0", "]", "=", "ref", "[", "0", "]", ";", "op", "[", "1", "]", "=", "ref", "[", "1", "]", ";", "op", "[", "2", "]", "=", "ref", "[", "2", "]", ";", "op", "[", "3", "]", "=", "ref", "[", "3", "]", ";", "op", "+", "=", "4", ",", "ref", "+", "=", "4", ";", "ref", "-", "=", "dec32table", "[", "op", "-", "ref", "]", ";", "A32", "(", "op", ")", "=", "A32", "(", "ref", ")", ";", "op", "+", "=", "STEPSIZE", "-", "4", ";", "ref", "-", "=", "dec64", ";", "}", "else", "{", "LZ4_COPYSTEP", "(", "op", ",", "ref", ")", ";", "}", "cpy", "=", "op", "+", "length", "-", "(", "STEPSIZE", "-", "4", ")", ";", "if", "unlikely", "(", "cpy", ">", "oend", "-", "COPYLENGTH", "-", "(", "STEPSIZE", "-", "4", ")", ")", "{", "if", "(", "cpy", ">", "oend", "-", "LASTLITERALS", ")", "goto", "_output_error", ";", "/", "/", "Error", ":", "last", "5", "bytes", "must", "be", "literals", "LZ4_SECURECOPY", "(", "op", ",", "ref", ",", "(", "oend", "-", "COPYLENGTH", ")", ");", "while", "(", "op", "<", "cpy", ")", "*", "op", "+", "+=", "*", "ref", "+", "+;", "op", "=", "cpy", ";", "continue", ";", "}", "LZ4_WILDCOPY", "(", "op", ",", "ref", ",", "cpy", ")", ";", "op", "=", "cpy", ";", "/", "/", "correction", "}", "/", "/", "end", "of", "decoding", "if", "(", "endOnInput", ")", "return", "(", "int", ")", "(", "((", "char", "*", ")", "op", ")", "-", "dest", ")", ";", "/", "/", "Nb", "of", "output", "bytes", "decoded", "else", "return", "(", "int", ")", "(", "((", "char", "*", ")", "ip", ")", "-", "source", ")", ";", "/", "/", "Nb", "of", "input", "bytes", "read", "/", "/", "Overflow", "error", "detected", "_output_error", ":", "return", "(", "int", ")", "(", "-(", "((", "char", "*", ")", "ip", ")", "-", "source", ")", ")-", "1", ";", "}", "int", "LZ4_decompress_safe", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "endOnInputSize", ",", "noPrefix", ",", "full", ",", "0", ")", ";", "}", "int", "LZ4_decompress_safe_withPrefix64k", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "endOnInputSize", ",", "withPrefix", ",", "full", ",", "0", ")", ";", "}", "int", "LZ4_decompress_safe_partial", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "targetOutputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "endOnInputSize", ",", "noPrefix", ",", "partial", ",", "targetOutputSize", ")", ";", "}", "int", "LZ4_decompress_fast", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "outputSize", ")", "{", "#", "ifdef", "_MSC_VER", "/", "/", "This", "version", "is", "faster", "with", "Visual", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "0", ",", "outputSize", ",", "endOnOutputSize", ",", "noPrefix", ",", "full", ",", "0", ")", ";", "#", "else", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "0", ",", "outputSize", ",", "endOnOutputSize", ",", "withPrefix", ",", "full", ",", "0", ")", ";", "#", "endif", "}", "int", "LZ4_decompress_fast_withPrefix64k", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "outputSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "0", ",", "outputSize", ",", "endOnOutputSize", ",", "withPrefix", ",", "full", ",", "0", ")", ";", "}", "/", "*", "LZ4", "-", "Fast", "LZ", "compression", "algorithm", "Copyright", "(", "C", ")", "2011", "-", "2014", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "-", "LZ4", "public", "forum", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "#!", "forum", "/", "lz4c", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Tuning", "parameters", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "*", "HEAPMODE", ":", "*", "Select", "how", "default", "compression", "functions", "will", "allocate", "memory", "for", "their", "hash", "table", ",", "*", "in", "memory", "stack", "(", "0", ":", "default", ",", "fastest", ")", ",", "or", "in", "memory", "heap", "(", "1", ":", "requires", "memory", "allocation", "(", "malloc", ")", ").", "*", "/", "#", "define", "HEAPMODE", "0", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "CPU", "Feature", "Detection", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "32", "or", "64", "bits", "?", "*", "/", "#", "if", "(", "defined", "(", "__x86_64__", ")", "|", "|", "defined", "(", "_M_X64", ")", "|", "|", "defined", "(", "_WIN64", ")", "\\", "|", "|", "defined", "(", "__powerpc64__", ")", "|", "|", "defined", "(", "__powerpc64le__", ")", "\\", "|", "|", "defined", "(", "__ppc64__", ")", "|", "|", "defined", "(", "__ppc64le__", ")", "\\", "|", "|", "defined", "(", "__PPC64__", ")", "|", "|", "defined", "(", "__PPC64LE__", ")", "\\", "|", "|", "defined", "(", "__ia64", ")", "|", "|", "defined", "(", "__itanium__", ")", "|", "|", "defined", "(", "_M_IA64", ")", ")", "/", "*", "Detects", "64", "bits", "mode", "*", "/", "#", "define", "LZ4_ARCH64", "1", "#", "else", "#", "define", "LZ4_ARCH64", "0", "#", "endif", "/", "*", "*", "Little", "Endian", "or", "Big", "Endian", "?", "*", "Overwrite", "the", "#", "define", "below", "if", "you", "know", "your", "architecture", "endianess", "*", "/", "#", "include", "<", "stdlib", ".", "h", ">", "/", "*", "Apparently", "required", "to", "detect", "endianess", "*", "/", "#", "if", "defined", "(", "__GLIBC__", ")", "#", "include", "<", "endian", ".", "h", ">", "#", "if", "(", "__BYTE_ORDER", "=", "=", "__BIG_ENDIAN", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "endif", "#", "elif", "(", "defined", "(", "__BIG_ENDIAN__", ")", "|", "|", "defined", "(", "__BIG_ENDIAN", ")", "|", "|", "defined", "(", "_BIG_ENDIAN", ")", ")", "&", "&", "!", "(", "defined", "(", "__LITTLE_ENDIAN__", ")", "|", "|", "defined", "(", "__LITTLE_ENDIAN", ")", "|", "|", "defined", "(", "_LITTLE_ENDIAN", ")", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "elif", "defined", "(", "__sparc", ")", "|", "|", "defined", "(", "__sparc__", ")", "\\", "|", "|", "defined", "(", "__powerpc__", ")", "|", "|", "defined", "(", "__ppc__", ")", "|", "|", "defined", "(", "__PPC__", ")", "\\", "|", "|", "defined", "(", "__hpux", ")", "|", "|", "defined", "(", "__hppa", ")", "\\", "|", "|", "defined", "(", "_MIPSEB", ")", "|", "|", "defined", "(", "__s390__", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "else", "/", "*", "Little", "Endian", "assumed", ".", "PDP", "Endian", "and", "other", "very", "rare", "endian", "format", "are", "unsupported", ".", "*", "/", "#", "endif", "/", "*", "*", "Unaligned", "memory", "access", "is", "automatically", "enabled", "for", "\"", "common", "\"", "CPU", ",", "such", "as", "x86", ".", "*", "For", "others", "CPU", ",", "such", "as", "ARM", ",", "the", "compiler", "may", "be", "more", "cautious", ",", "inserting", "unnecessary", "extra", "code", "to", "ensure", "aligned", "access", "property", "*", "If", "you", "know", "your", "target", "CPU", "supports", "unaligned", "memory", "access", ",", "you", "want", "to", "force", "this", "option", "manually", "to", "improve", "performance", "*", "/", "#", "if", "defined", "(", "__ARM_FEATURE_UNALIGNED", ")", "#", "define", "LZ4_FORCE_UNALIGNED_ACCESS", "1", "#", "endif", "/", "*", "Define", "this", "parameter", "if", "your", "target", "system", "or", "compiler", "does", "not", "support", "hardware", "bit", "count", "*", "/", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "defined", "(", "_WIN32_WCE", ")", "/", "*", "Visual", "Studio", "for", "Windows", "CE", "does", "not", "support", "Hardware", "bit", "count", "*", "/", "#", "define", "LZ4_FORCE_SW_BITCOUNT", "#", "endif", "/", "*", "*", "BIG_ENDIAN_NATIVE_BUT_INCOMPATIBLE", ":", "*", "This", "option", "may", "provide", "a", "small", "boost", "to", "performance", "for", "some", "big", "endian", "cpu", ",", "although", "probably", "modest", ".", "*", "You", "may", "set", "this", "option", "to", "1", "if", "data", "will", "remain", "within", "closed", "environment", ".", "*", "This", "option", "is", "useless", "on", "Little_Endian", "CPU", "(", "such", "as", "x86", ")", "*", "/", "/", "*", "#", "define", "BIG_ENDIAN_NATIVE_BUT_INCOMPATIBLE", "1", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Compiler", "Options", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "(", "__STDC_VERSION__", ">", "=", "199901L", ")", "/", "*", "C99", "*", "/", "/", "*", "\"", "restrict", "\"", "is", "a", "known", "keyword", "*", "/", "#", "else", "#", "define", "restrict", "/", "*", "Disable", "restrict", "*", "/", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "*", "Visual", "Studio", "*", "/", "#", "define", "FORCE_INLINE", "static", "__forceinline", "#", "include", "<", "intrin", ".", "h", ">", "/", "*", "For", "Visual", "2005", "*", "/", "#", "if", "LZ4_ARCH64", "/", "*", "64", "-", "bits", "*", "/", "#", "pragma", "intrinsic", "(", "_BitScanForward64", ")", "/", "*", "For", "Visual", "2005", "*", "/", "#", "pragma", "intrinsic", "(", "_BitScanReverse64", ")", "/", "*", "For", "Visual", "2005", "*", "/", "#", "else", "/", "*", "32", "-", "bits", "*", "/", "#", "pragma", "intrinsic", "(", "_BitScanForward", ")", "/", "*", "For", "Visual", "2005", "*", "/", "#", "pragma", "intrinsic", "(", "_BitScanReverse", ")", "/", "*", "For", "Visual", "2005", "*", "/", "#", "endif", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "*", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "*", "/", "#", "else", "#", "ifdef", "__GNUC__", "#", "define", "FORCE_INLINE", "static", "inline", "__attribute__", "(", "(", "always_inline", ")", ")", "#", "else", "#", "define", "FORCE_INLINE", "static", "inline", "#", "endif", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "*", "Visual", "Studio", "*", "/", "#", "define", "lz4_bswap16", "(", "x", ")", "_byteswap_ushort", "(", "x", ")", "#", "else", "#", "define", "lz4_bswap16", "(", "x", ")", "(", "(", "unsigned", "short", "int", ")", "(", "((", "(", "x", ")", ">", ">", "8", ")", "&", "0xffu", ")", "|", "(", "((", "x", ")", "&", "0xffu", ")", "<", "<", "8", ")", "))", "#", "endif", "#", "define", "GCC_VERSION", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", "#", "if", "(", "GCC_VERSION", ">", "=", "302", ")", "|", "|", "(", "__INTEL_COMPILER", ">", "=", "800", ")", "|", "|", "defined", "(", "__clang__", ")", "#", "define", "expect", "(", "expr", ",", "value", ")", "(", "__builtin_expect", "(", "(", "expr", ")", ",(", "value", ")", ")", ")", "#", "else", "#", "define", "expect", "(", "expr", ",", "value", ")", "(", "expr", ")", "#", "endif", "#", "define", "likely", "(", "expr", ")", "expect", "(", "(", "expr", ")", "!", "=", "0", ",", "1", ")", "#", "define", "unlikely", "(", "expr", ")", "expect", "(", "(", "expr", ")", "!", "=", "0", ",", "0", ")", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Memory", "routines", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "include", "<", "stdlib", ".", "h", ">", "/", "*", "malloc", ",", "calloc", ",", "free", "*", "/", "#", "define", "ALLOCATOR", "(", "n", ",", "s", ")", "calloc", "(", "n", ",", "s", ")", "#", "define", "FREEMEM", "free", "#", "include", "<", "string", ".", "h", ">", "/", "*", "memset", ",", "memcpy", "*", "/", "#", "define", "MEM_INIT", "memset", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Includes", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "include", "\"", "lz4", ".", "h", "\"", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Basic", "Types", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "(", "__STDC_VERSION__", ">", "=", "199901L", ")", "/", "*", "C99", "*", "/", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "#", "if", "defined", "(", "__GNUC__", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "#", "define", "_PACKED", "__attribute__", "(", "(", "packed", ")", ")", "#", "else", "#", "define", "_PACKED", "#", "endif", "#", "if", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "if", "defined", "(", "__IBMC__", ")", "|", "|", "defined", "(", "__SUNPRO_C", ")", "|", "|", "defined", "(", "__SUNPRO_CC", ")", "#", "pragma", "pack", "(", "1", ")", "#", "else", "#", "pragma", "pack", "(", "push", ",", "1", ")", "#", "endif", "#", "endif", "typedef", "struct", "{", "U16", "v", ";", "}", "_PACKED", "U16_S", ";", "typedef", "struct", "{", "U32", "v", ";", "}", "_PACKED", "U32_S", ";", "typedef", "struct", "{", "U64", "v", ";", "}", "_PACKED", "U64_S", ";", "typedef", "struct", "{", "size_t", "v", ";", "}", "_PACKED", "size_t_S", ";", "#", "if", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "if", "defined", "(", "__SUNPRO_C", ")", "|", "|", "defined", "(", "__SUNPRO_CC", ")", "#", "pragma", "pack", "(", "0", ")", "#", "else", "#", "pragma", "pack", "(", "pop", ")", "#", "endif", "#", "endif", "#", "define", "A16", "(", "x", ")", "(", "((", "U16_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "A32", "(", "x", ")", "(", "((", "U32_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "A64", "(", "x", ")", "(", "((", "U64_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "AARCH", "(", "x", ")", "(", "((", "size_t_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Constants", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "LZ4_HASHLOG", "(", "LZ4_MEMORY_USAGE", "-", "2", ")", "#", "define", "HASHTABLESIZE", "(", "1", "<", "<", "LZ4_MEMORY_USAGE", ")", "#", "define", "HASH_SIZE_U32", "(", "1", "<", "<", "LZ4_HASHLOG", ")", "#", "define", "MINMATCH", "4", "#", "define", "COPYLENGTH", "8", "#", "define", "LASTLITERALS", "5", "#", "define", "MFLIMIT", "(", "COPYLENGTH", "+", "MINMATCH", ")", "static", "const", "int", "LZ4_minLength", "=", "(", "MFLIMIT", "+", "1", ")", ";", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "#", "define", "LZ4_64KLIMIT", "(", "(", "64", "KB", ")", "+", "(", "MFLIMIT", "-", "1", ")", ")", "#", "define", "SKIPSTRENGTH", "6", "/", "*", "Increasing", "this", "value", "will", "make", "the", "compression", "run", "slower", "on", "incompressible", "data", "*", "/", "#", "define", "MAXD_LOG", "16", "#", "define", "MAX_DISTANCE", "(", "(", "1", "<", "<", "MAXD_LOG", ")", "-", "1", ")", "#", "define", "ML_BITS", "4", "#", "define", "ML_MASK", "(", "(", "1U", "<", "<", "ML_BITS", ")", "-", "1", ")", "#", "define", "RUN_BITS", "(", "8", "-", "ML_BITS", ")", "#", "define", "RUN_MASK", "(", "(", "1U", "<", "<", "RUN_BITS", ")", "-", "1", ")", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Structures", "and", "local", "types", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "typedef", "struct", "{", "U32", "hashTable", "[", "HASH_SIZE_U32", "]", ";", "U32", "currentOffset", ";", "U32", "initCheck", ";", "const", "BYTE", "*", "dictionary", ";", "const", "BYTE", "*", "bufferStart", ";", "U32", "dictSize", ";", "}", "LZ4_stream_t_internal", ";", "typedef", "enum", "{", "notLimited", "=", "0", ",", "limitedOutput", "=", "1", "}", "limitedOutput_directive", ";", "typedef", "enum", "{", "byPtr", ",", "byU32", ",", "byU16", "}", "tableType_t", ";", "typedef", "enum", "{", "noDict", "=", "0", ",", "withPrefix64k", ",", "usingExtDict", "}", "dict_directive", ";", "typedef", "enum", "{", "noDictIssue", "=", "0", ",", "dictSmall", "}", "dictIssue_directive", ";", "typedef", "enum", "{", "endOnOutputSize", "=", "0", ",", "endOnInputSize", "=", "1", "}", "endCondition_directive", ";", "typedef", "enum", "{", "full", "=", "0", ",", "partial", "=", "1", "}", "earlyEnd_directive", ";", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Architecture", "-", "specific", "macros", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "STEPSIZE", "sizeof", "(", "size_t", ")", "#", "define", "LZ4_COPYSTEP", "(", "d", ",", "s", ")", "{", "AARCH", "(", "d", ")", "=", "AARCH", "(", "s", ")", ";", "d", "+", "=", "STEPSIZE", ";", "s", "+", "=", "STEPSIZE", ";", "}", "#", "define", "LZ4_COPY8", "(", "d", ",", "s", ")", "{", "LZ4_COPYSTEP", "(", "d", ",", "s", ")", ";", "if", "(", "STEPSIZE", "<", "8", ")", "LZ4_COPYSTEP", "(", "d", ",", "s", ")", ";", "}", "#", "if", "(", "defined", "(", "LZ4_BIG_ENDIAN", ")", "&", "&", "!", "defined", "(", "BIG_ENDIAN_NATIVE_BUT_INCOMPATIBLE", ")", ")", "#", "define", "LZ4_READ_LITTLEENDIAN_16", "(", "d", ",", "s", ",", "p", ")", "{", "U16", "v", "=", "A16", "(", "p", ")", ";", "v", "=", "lz4_bswap16", "(", "v", ")", ";", "d", "=", "(", "s", ")", "-", "v", ";", "}", "#", "define", "LZ4_WRITE_LITTLEENDIAN_16", "(", "p", ",", "i", ")", "{", "U16", "v", "=", "(", "U16", ")", "(", "i", ")", ";", "v", "=", "lz4_bswap16", "(", "v", ")", ";", "A16", "(", "p", ")", "=", "v", ";", "p", "+", "=", "2", ";", "}", "#", "else", "/", "*", "Little", "Endian", "*", "/", "#", "define", "LZ4_READ_LITTLEENDIAN_16", "(", "d", ",", "s", ",", "p", ")", "{", "d", "=", "(", "s", ")", "-", "A16", "(", "p", ")", ";", "}", "#", "define", "LZ4_WRITE_LITTLEENDIAN_16", "(", "p", ",", "v", ")", "{", "A16", "(", "p", ")", "=", "v", ";", "p", "+", "=", "2", ";", "}", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Macros", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "LZ4_STATIC_ASSERT", "(", "c", ")", "{", "enum", "{", "LZ4_static_assert", "=", "1", "/", "(!", "!(", "c", ")", ")", "}", ";", "}", "/", "*", "use", "only", "*", "after", "*", "variable", "declarations", "*", "/", "#", "if", "LZ4_ARCH64", "|", "|", "!", "defined", "(", "__GNUC__", ")", "#", "define", "LZ4_WILDCOPY", "(", "d", ",", "s", ",", "e", ")", "{", "do", "{", "LZ4_COPY8", "(", "d", ",", "s", ")", "}", "while", "(", "d", "<", "e", ")", ";", "}", "/", "*", "at", "the", "end", ",", "d", ">", "=", "e", ";", "*", "/", "#", "else", "#", "define", "LZ4_WILDCOPY", "(", "d", ",", "s", ",", "e", ")", "{", "if", "(", "likely", "(", "e", "-", "d", "<", "=", "8", ")", ")", "LZ4_COPY8", "(", "d", ",", "s", ")", "else", "do", "{", "LZ4_COPY8", "(", "d", ",", "s", ")", "}", "while", "(", "d", "<", "e", ")", ";", "}", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Private", "local", "functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "LZ4_ARCH64", "int", "LZ4_NbCommonBytes", "(", "register", "U64", "val", ")", "{", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanReverse64", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "GCC_VERSION", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_clzll", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "int", "r", ";", "if", "(", "!(", "val", ">", ">", "32", ")", ")", "{", "r", "=", "4", ";", "}", "else", "{", "r", "=", "0", ";", "val", ">", ">=", "32", ";", "}", "if", "(", "!(", "val", ">", ">", "16", ")", ")", "{", "r", "+", "=", "2", ";", "val", ">", ">=", "8", ";", "}", "else", "{", "val", ">", ">=", "24", ";", "}", "r", "+", "=", "(", "!", "val", ")", ";", "return", "r", ";", "#", "endif", "#", "else", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanForward64", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "GCC_VERSION", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_ctzll", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "static", "const", "int", "DeBruijnBytePos", "[", "64", "]", "=", "{", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", ",", "2", ",", "0", ",", "3", ",", "1", ",", "3", ",", "1", ",", "4", ",", "2", ",", "7", ",", "0", ",", "2", ",", "3", ",", "6", ",", "1", ",", "5", ",", "3", ",", "5", ",", "1", ",", "3", ",", "4", ",", "4", ",", "2", ",", "5", ",", "6", ",", "7", ",", "7", ",", "0", ",", "1", ",", "2", ",", "3", ",", "3", ",", "4", ",", "6", ",", "2", ",", "6", ",", "5", ",", "5", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", "1", ",", "2", ",", "4", ",", "6", ",", "4", ",", "4", ",", "5", ",", "7", ",", "2", ",", "6", ",", "5", ",", "7", ",", "6", ",", "7", ",", "7", "}", ";", "return", "DeBruijnBytePos", "[", "((", "U64", ")", "((", "val", "&", "-", "(", "long", "long", ")", "val", ")", "*", "0x0218A392CDABBD3FULL", ")", ")", ">", ">", "58", "]", ";", "#", "endif", "#", "endif", "}", "#", "else", "int", "LZ4_NbCommonBytes", "(", "register", "U32", "val", ")", "{", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanReverse", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "GCC_VERSION", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_clz", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "int", "r", ";", "if", "(", "!(", "val", ">", ">", "16", ")", ")", "{", "r", "=", "2", ";", "val", ">", ">=", "8", ";", "}", "else", "{", "r", "=", "0", ";", "val", ">", ">=", "24", ";", "}", "r", "+", "=", "(", "!", "val", ")", ";", "return", "r", ";", "#", "endif", "#", "else", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", ";", "_BitScanForward", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "GCC_VERSION", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_ctz", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "static", "const", "int", "DeBruijnBytePos", "[", "32", "]", "=", "{", "0", ",", "0", ",", "3", ",", "0", ",", "3", ",", "1", ",", "3", ",", "0", ",", "3", ",", "2", ",", "2", ",", "1", ",", "3", ",", "2", ",", "0", ",", "1", ",", "3", ",", "3", ",", "1", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "3", ",", "1", ",", "2", ",", "0", ",", "1", ",", "0", ",", "1", ",", "1", "}", ";", "return", "DeBruijnBytePos", "[", "((", "U32", ")", "((", "val", "&", "-", "(", "S32", ")", "val", ")", "*", "0x077CB531U", ")", ")", ">", ">", "27", "]", ";", "#", "endif", "#", "endif", "}", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Compression", "functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "int", "LZ4_compressBound", "(", "int", "isize", ")", "{", "return", "LZ4_COMPRESSBOUND", "(", "isize", ")", ";", "}", "static", "int", "LZ4_hashSequence", "(", "U32", "sequence", ",", "tableType_t", "tableType", ")", "{", "if", "(", "tableType", "=", "=", "byU16", ")", "return", "(", "((", "sequence", ")", "*", "2654435761U", ")", ">", ">", "(", "(", "MINMATCH", "*", "8", ")", "-(", "LZ4_HASHLOG", "+", "1", ")", "))", ";", "else", "return", "(", "((", "sequence", ")", "*", "2654435761U", ")", ">", ">", "(", "(", "MINMATCH", "*", "8", ")", "-", "LZ4_HASHLOG", ")", ");", "}", "static", "int", "LZ4_hashPosition", "(", "const", "BYTE", "*", "p", ",", "tableType_t", "tableType", ")", "{", "return", "LZ4_hashSequence", "(", "A32", "(", "p", ")", ",", "tableType", ")", ";", "}", "static", "void", "LZ4_putPositionOnHash", "(", "const", "BYTE", "*", "p", ",", "U32", "h", ",", "void", "*", "tableBase", ",", "tableType_t", "tableType", ",", "const", "BYTE", "*", "srcBase", ")", "{", "switch", "(", "tableType", ")", "{", "case", "byPtr", ":", "{", "const", "BYTE", "*", "*", "hashTable", "=", "(", "const", "BYTE", "*", "*)", "tableBase", ";", "hashTable", "[", "h", "]", "=", "p", ";", "break", ";", "}", "case", "byU32", ":", "{", "U32", "*", "hashTable", "=", "(", "U32", "*", ")", "tableBase", ";", "hashTable", "[", "h", "]", "=", "(", "U32", ")", "(", "p", "-", "srcBase", ")", ";", "break", ";", "}", "case", "byU16", ":", "{", "U16", "*", "hashTable", "=", "(", "U16", "*", ")", "tableBase", ";", "hashTable", "[", "h", "]", "=", "(", "U16", ")", "(", "p", "-", "srcBase", ")", ";", "break", ";", "}", "}", "}", "static", "void", "LZ4_putPosition", "(", "const", "BYTE", "*", "p", ",", "void", "*", "tableBase", ",", "tableType_t", "tableType", ",", "const", "BYTE", "*", "srcBase", ")", "{", "U32", "h", "=", "LZ4_hashPosition", "(", "p", ",", "tableType", ")", ";", "LZ4_putPositionOnHash", "(", "p", ",", "h", ",", "tableBase", ",", "tableType", ",", "srcBase", ")", ";", "}", "static", "const", "BYTE", "*", "LZ4_getPositionOnHash", "(", "U32", "h", ",", "void", "*", "tableBase", ",", "tableType_t", "tableType", ",", "const", "BYTE", "*", "srcBase", ")", "{", "if", "(", "tableType", "=", "=", "byPtr", ")", "{", "const", "BYTE", "*", "*", "hashTable", "=", "(", "const", "BYTE", "*", "*)", "tableBase", ";", "return", "hashTable", "[", "h", "]", ";", "}", "if", "(", "tableType", "=", "=", "byU32", ")", "{", "U32", "*", "hashTable", "=", "(", "U32", "*", ")", "tableBase", ";", "return", "hashTable", "[", "h", "]", "+", "srcBase", ";", "}", "{", "U16", "*", "hashTable", "=", "(", "U16", "*", ")", "tableBase", ";", "return", "hashTable", "[", "h", "]", "+", "srcBase", ";", "}", "/", "*", "default", ",", "to", "ensure", "a", "return", "*", "/", "}", "static", "const", "BYTE", "*", "LZ4_getPosition", "(", "const", "BYTE", "*", "p", ",", "void", "*", "tableBase", ",", "tableType_t", "tableType", ",", "const", "BYTE", "*", "srcBase", ")", "{", "U32", "h", "=", "LZ4_hashPosition", "(", "p", ",", "tableType", ")", ";", "return", "LZ4_getPositionOnHash", "(", "h", ",", "tableBase", ",", "tableType", ",", "srcBase", ")", ";", "}", "static", "unsigned", "LZ4_count", "(", "const", "BYTE", "*", "pIn", ",", "const", "BYTE", "*", "pRef", ",", "const", "BYTE", "*", "pInLimit", ")", "{", "const", "BYTE", "*", "const", "pStart", "=", "pIn", ";", "while", "(", "likely", "(", "pIn", "<", "pInLimit", "-", "(", "STEPSIZE", "-", "1", ")", "))", "{", "size_t", "diff", "=", "AARCH", "(", "pRef", ")", "^", "AARCH", "(", "pIn", ")", ";", "if", "(", "!", "diff", ")", "{", "pIn", "+", "=", "STEPSIZE", ";", "pRef", "+", "=", "STEPSIZE", ";", "continue", ";", "}", "pIn", "+", "=", "LZ4_NbCommonBytes", "(", "diff", ")", ";", "return", "(", "unsigned", ")", "(", "pIn", "-", "pStart", ")", ";", "}", "if", "(", "sizeof", "(", "void", "*", ")=", "=", "8", ")", "if", "(", "(", "pIn", "<", "(", "pInLimit", "-", "3", ")", ")", "&", "&", "(", "A32", "(", "pRef", ")", "=", "=", "A32", "(", "pIn", ")", "))", "{", "pIn", "+", "=", "4", ";", "pRef", "+", "=", "4", ";", "}", "if", "(", "(", "pIn", "<", "(", "pInLimit", "-", "1", ")", ")", "&", "&", "(", "A16", "(", "pRef", ")", "=", "=", "A16", "(", "pIn", ")", "))", "{", "pIn", "+", "=", "2", ";", "pRef", "+", "=", "2", ";", "}", "if", "(", "(", "pIn", "<", "pInLimit", ")", "&", "&", "(", "*", "pRef", "=", "=", "*", "pIn", ")", ")", "pIn", "+", "+;", "return", "(", "unsigned", ")", "(", "pIn", "-", "pStart", ")", ";", "}", "static", "int", "LZ4_compress_generic", "(", "void", "*", "ctx", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "limitedOutput_directive", "outputLimited", ",", "tableType_t", "tableType", ",", "dict_directive", "dict", ",", "dictIssue_directive", "dictIssue", ")", "{", "LZ4_stream_t_internal", "*", "const", "dictPtr", "=", "(", "LZ4_stream_t_internal", "*", ")", "ctx", ";", "const", "BYTE", "*", "ip", "=", "(", "const", "BYTE", "*", ")", "source", ";", "const", "BYTE", "*", "base", ";", "const", "BYTE", "*", "lowLimit", ";", "const", "BYTE", "*", "const", "lowRefLimit", "=", "ip", "-", "dictPtr", "-", ">", "dictSize", ";", "const", "BYTE", "*", "const", "dictionary", "=", "dictPtr", "-", ">", "dictionary", ";", "const", "BYTE", "*", "const", "dictEnd", "=", "dictionary", "+", "dictPtr", "-", ">", "dictSize", ";", "const", "size_t", "dictDelta", "=", "dictEnd", "-", "(", "const", "BYTE", "*", ")", "source", ";", "const", "BYTE", "*", "anchor", "=", "(", "const", "BYTE", "*", ")", "source", ";", "const", "BYTE", "*", "const", "iend", "=", "ip", "+", "inputSize", ";", "const", "BYTE", "*", "const", "mflimit", "=", "iend", "-", "MFLIMIT", ";", "const", "BYTE", "*", "const", "matchlimit", "=", "iend", "-", "LASTLITERALS", ";", "BYTE", "*", "op", "=", "(", "BYTE", "*", ")", "dest", ";", "BYTE", "*", "const", "olimit", "=", "op", "+", "maxOutputSize", ";", "const", "int", "skipStrength", "=", "SKIPSTRENGTH", ";", "U32", "forwardH", ";", "size_t", "refDelta", "=", "0", ";", "/", "*", "Init", "conditions", "*", "/", "if", "(", "(", "U32", ")", "inputSize", ">", "(", "U32", ")", "LZ4_MAX_INPUT_SIZE", ")", "return", "0", ";", "/", "*", "Unsupported", "input", "size", ",", "too", "large", "(", "or", "negative", ")", "*", "/", "switch", "(", "dict", ")", "{", "case", "noDict", ":", "default", ":", "base", "=", "(", "const", "BYTE", "*", ")", "source", ";", "lowLimit", "=", "(", "const", "BYTE", "*", ")", "source", ";", "break", ";", "case", "withPrefix64k", ":", "base", "=", "(", "const", "BYTE", "*", ")", "source", "-", "dictPtr", "-", ">", "currentOffset", ";", "lowLimit", "=", "(", "const", "BYTE", "*", ")", "source", "-", "dictPtr", "-", ">", "dictSize", ";", "break", ";", "case", "usingExtDict", ":", "base", "=", "(", "const", "BYTE", "*", ")", "source", "-", "dictPtr", "-", ">", "currentOffset", ";", "lowLimit", "=", "(", "const", "BYTE", "*", ")", "source", ";", "break", ";", "}", "if", "(", "(", "tableType", "=", "=", "byU16", ")", "&", "&", "(", "inputSize", ">", "=(", "int", ")", "LZ4_64KLIMIT", ")", ")", "return", "0", ";", "/", "*", "Size", "too", "large", "(", "not", "within", "64K", "limit", ")", "*", "/", "if", "(", "inputSize", "<", "LZ4_minLength", ")", "goto", "_last_literals", ";", "/", "*", "Input", "too", "small", ",", "no", "compression", "(", "all", "literals", ")", "*", "/", "/", "*", "First", "Byte", "*", "/", "LZ4_putPosition", "(", "ip", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "ip", "+", "+;", "forwardH", "=", "LZ4_hashPosition", "(", "ip", ",", "tableType", ")", ";", "/", "*", "Main", "Loop", "*", "/", "for", "(", ";", ";", ")", "{", "const", "BYTE", "*", "ref", ";", "BYTE", "*", "token", ";", "{", "const", "BYTE", "*", "forwardIp", "=", "ip", ";", "unsigned", "step", "=", "1", ";", "unsigned", "searchMatchNb", "=", "(", "1U", "<", "<", "skipStrength", ")", ";", "/", "*", "Find", "a", "match", "*", "/", "do", "{", "U32", "h", "=", "forwardH", ";", "ip", "=", "forwardIp", ";", "forwardIp", "+", "=", "step", ";", "step", "=", "searchMatchNb", "+", "+", ">", ">", "skipStrength", ";", "/", "/", "if", "(", "step", ">", "8", ")", "step", "=", "8", ";", "/", "/", "required", "for", "valid", "forwardIp", ";", "slows", "down", "uncompressible", "data", "a", "bit", "if", "(", "unlikely", "(", "forwardIp", ">", "mflimit", ")", ")", "goto", "_last_literals", ";", "ref", "=", "LZ4_getPositionOnHash", "(", "h", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "if", "(", "dict", "=", "=", "usingExtDict", ")", "{", "if", "(", "ref", "<", "(", "const", "BYTE", "*", ")", "source", ")", "{", "refDelta", "=", "dictDelta", ";", "lowLimit", "=", "dictionary", ";", "}", "else", "{", "refDelta", "=", "0", ";", "lowLimit", "=", "(", "const", "BYTE", "*", ")", "source", ";", "}", "}", "forwardH", "=", "LZ4_hashPosition", "(", "forwardIp", ",", "tableType", ")", ";", "LZ4_putPositionOnHash", "(", "ip", ",", "h", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "}", "while", "(", "(", "(", "dictIssue", "=", "=", "dictSmall", ")", "?", "(", "ref", "<", "lowRefLimit", ")", ":", "0", ")", "|", "|", "(", "(", "tableType", "=", "=", "byU16", ")", "?", "0", ":", "(", "ref", "+", "MAX_DISTANCE", "<", "ip", ")", ")", "|", "|", "(", "A32", "(", "ref", "+", "refDelta", ")", "!", "=", "A32", "(", "ip", ")", ")", ")", ";", "}", "/", "*", "Catch", "up", "*", "/", "while", "(", "(", "ip", ">", "anchor", ")", "&", "&", "(", "ref", "+", "refDelta", ">", "lowLimit", ")", "&", "&", "(", "unlikely", "(", "ip", "[", "-", "1", "]", "==", "ref", "[", "refDelta", "-", "1", "]", "))", ")", "{", "ip", "-", "-;", "ref", "-", "-;", "}", "{", "/", "*", "Encode", "Literal", "length", "*", "/", "unsigned", "litLength", "=", "(", "unsigned", ")", "(", "ip", "-", "anchor", ")", ";", "token", "=", "op", "+", "+;", "if", "(", "(", "outputLimited", ")", "&", "&", "(", "unlikely", "(", "op", "+", "litLength", "+", "(", "2", "+", "1", "+", "LASTLITERALS", ")", "+", "(", "litLength", "/", "255", ")", ">", "olimit", ")", "))", "return", "0", ";", "/", "*", "Check", "output", "limit", "*", "/", "if", "(", "litLength", ">", "=", "RUN_MASK", ")", "{", "int", "len", "=", "(", "int", ")", "litLength", "-", "RUN_MASK", ";", "*", "token", "=", "(", "RUN_MASK", "<", "<", "ML_BITS", ")", ";", "for", "(", ";", "len", ">", "=", "255", ";", "len", "-", "=", "255", ")", "*", "op", "+", "+", "=", "255", ";", "*", "op", "+", "+", "=", "(", "BYTE", ")", "len", ";", "}", "else", "*", "token", "=", "(", "BYTE", ")", "(", "litLength", "<", "<", "ML_BITS", ")", ";", "/", "*", "Copy", "Literals", "*", "/", "{", "BYTE", "*", "end", "=", "op", "+", "litLength", ";", "LZ4_WILDCOPY", "(", "op", ",", "anchor", ",", "end", ")", ";", "op", "=", "end", ";", "}", "}", "_next_match", ":", "/", "*", "Encode", "Offset", "*", "/", "LZ4_WRITE_LITTLEENDIAN_16", "(", "op", ",", "(", "U16", ")", "(", "ip", "-", "ref", ")", ");", "/", "*", "Encode", "MatchLength", "*", "/", "{", "unsigned", "matchLength", ";", "if", "(", "(", "dict", "=", "=", "usingExtDict", ")", "&", "&", "(", "lowLimit", "=", "=", "dictionary", ")", ")", "{", "const", "BYTE", "*", "limit", ";", "ref", "+", "=", "refDelta", ";", "limit", "=", "ip", "+", "(", "dictEnd", "-", "ref", ")", ";", "if", "(", "limit", ">", "matchlimit", ")", "limit", "=", "matchlimit", ";", "matchLength", "=", "LZ4_count", "(", "ip", "+", "MINMATCH", ",", "ref", "+", "MINMATCH", ",", "limit", ")", ";", "ip", "+", "=", "MINMATCH", "+", "matchLength", ";", "if", "(", "ip", "=", "=", "limit", ")", "{", "unsigned", "more", "=", "LZ4_count", "(", "ip", ",", "(", "const", "BYTE", "*", ")", "source", ",", "matchlimit", ")", ";", "matchLength", "+", "=", "more", ";", "ip", "+", "=", "more", ";", "}", "}", "else", "{", "matchLength", "=", "LZ4_count", "(", "ip", "+", "MINMATCH", ",", "ref", "+", "MINMATCH", ",", "matchlimit", ")", ";", "ip", "+", "=", "MINMATCH", "+", "matchLength", ";", "}", "if", "(", "matchLength", ">", "=", "ML_MASK", ")", "{", "if", "(", "(", "outputLimited", ")", "&", "&", "(", "unlikely", "(", "op", "+", "(", "1", "+", "LASTLITERALS", ")", "+", "(", "matchLength", ">", ">", "8", ")", ">", "olimit", ")", "))", "return", "0", ";", "/", "*", "Check", "output", "limit", "*", "/", "*", "token", "+", "=", "ML_MASK", ";", "matchLength", "-", "=", "ML_MASK", ";", "for", "(", ";", "matchLength", ">", "=", "510", ";", "matchLength", "-", "=", "510", ")", "{", "*", "op", "+", "+", "=", "255", ";", "*", "op", "+", "+", "=", "255", ";", "}", "if", "(", "matchLength", ">", "=", "255", ")", "{", "matchLength", "-", "=", "255", ";", "*", "op", "+", "+", "=", "255", ";", "}", "*", "op", "+", "+", "=", "(", "BYTE", ")", "matchLength", ";", "}", "else", "*", "token", "+", "=", "(", "BYTE", ")", "(", "matchLength", ")", ";", "}", "anchor", "=", "ip", ";", "/", "*", "Test", "end", "of", "chunk", "*", "/", "if", "(", "ip", ">", "mflimit", ")", "break", ";", "/", "*", "Fill", "table", "*", "/", "LZ4_putPosition", "(", "ip", "-", "2", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "/", "*", "Test", "next", "position", "*", "/", "ref", "=", "LZ4_getPosition", "(", "ip", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "if", "(", "dict", "=", "=", "usingExtDict", ")", "{", "if", "(", "ref", "<", "(", "const", "BYTE", "*", ")", "source", ")", "{", "refDelta", "=", "dictDelta", ";", "lowLimit", "=", "dictionary", ";", "}", "else", "{", "refDelta", "=", "0", ";", "lowLimit", "=", "(", "const", "BYTE", "*", ")", "source", ";", "}", "}", "LZ4_putPosition", "(", "ip", ",", "ctx", ",", "tableType", ",", "base", ")", ";", "if", "(", "(", "(", "dictIssue", "=", "=", "dictSmall", ")", "?", "(", "ref", ">", "=", "lowRefLimit", ")", ":", "1", ")", "&", "&", "(", "ref", "+", "MAX_DISTANCE", ">", "=", "ip", ")", "&", "&", "(", "A32", "(", "ref", "+", "refDelta", ")", "==", "A32", "(", "ip", ")", ")", ")", "{", "token", "=", "op", "+", "+;", "*", "token", "=", "0", ";", "goto", "_next_match", ";", "}", "/", "*", "Prepare", "next", "loop", "*", "/", "forwardH", "=", "LZ4_hashPosition", "(", "++", "ip", ",", "tableType", ")", ";", "}", "_last_literals", ":", "/", "*", "Encode", "Last", "Literals", "*", "/", "{", "int", "lastRun", "=", "(", "int", ")", "(", "iend", "-", "anchor", ")", ";", "if", "(", "(", "outputLimited", ")", "&", "&", "(", "((", "char", "*", ")", "op", "-", "dest", ")", "+", "lastRun", "+", "1", "+", "(", "(", "lastRun", "+", "255", "-", "RUN_MASK", ")", "/", "255", ")", ">", "(", "U32", ")", "maxOutputSize", ")", ")", "return", "0", ";", "/", "*", "Check", "output", "limit", "*", "/", "if", "(", "lastRun", ">", "=(", "int", ")", "RUN_MASK", ")", "{", "*", "op", "+", "+=", "(", "RUN_MASK", "<", "<", "ML_BITS", ")", ";", "lastRun", "-", "=", "RUN_MASK", ";", "for", "(", ";", "lastRun", ">", "=", "255", ";", "lastRun", "-", "=", "255", ")", "*", "op", "+", "+", "=", "255", ";", "*", "op", "+", "+", "=", "(", "BYTE", ")", "lastRun", ";", "}", "else", "*", "op", "+", "+", "=", "(", "BYTE", ")", "(", "lastRun", "<", "<", "ML_BITS", ")", ";", "memcpy", "(", "op", ",", "anchor", ",", "iend", "-", "anchor", ")", ";", "op", "+", "=", "iend", "-", "anchor", ";", "}", "/", "*", "End", "*", "/", "return", "(", "int", ")", "(", "((", "char", "*", ")", "op", ")", "-", "dest", ")", ";", "}", "int", "LZ4_compress", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "#", "if", "(", "HEAPMODE", ")", "void", "*", "ctx", "=", "ALLOCATOR", "(", "LZ4_STREAMSIZE_U32", ",", "4", ")", ";", "/", "*", "Aligned", "on", "4", "-", "bytes", "boundaries", "*", "/", "#", "else", "U32", "ctx", "[", "LZ4_STREAMSIZE_U32", "]", "=", "{", "0", "}", ";", "/", "*", "Ensure", "data", "is", "aligned", "on", "4", "-", "bytes", "boundaries", "*", "/", "#", "endif", "int", "result", ";", "if", "(", "inputSize", "<", "(", "int", ")", "LZ4_64KLIMIT", ")", "result", "=", "LZ4_compress_generic", "(", "(", "void", "*", ")", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ",", "byU16", ",", "noDict", ",", "noDictIssue", ")", ";", "else", "result", "=", "LZ4_compress_generic", "(", "(", "void", "*", ")", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ",", "(", "sizeof", "(", "void", "*", ")=", "=", "8", ")", "?", "byU32", ":", "byPtr", ",", "noDict", ",", "noDictIssue", ")", ";", "#", "if", "(", "HEAPMODE", ")", "FREEMEM", "(", "ctx", ")", ";", "#", "endif", "return", "result", ";", "}", "int", "LZ4_compress_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "#", "if", "(", "HEAPMODE", ")", "void", "*", "ctx", "=", "ALLOCATOR", "(", "LZ4_STREAMSIZE_U32", ",", "4", ")", ";", "/", "*", "Aligned", "on", "4", "-", "bytes", "boundaries", "*", "/", "#", "else", "U32", "ctx", "[", "LZ4_STREAMSIZE_U32", "]", "=", "{", "0", "}", ";", "/", "*", "Ensure", "data", "is", "aligned", "on", "4", "-", "bytes", "boundaries", "*", "/", "#", "endif", "int", "result", ";", "if", "(", "inputSize", "<", "(", "int", ")", "LZ4_64KLIMIT", ")", "result", "=", "LZ4_compress_generic", "(", "(", "void", "*", ")", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limitedOutput", ",", "byU16", ",", "noDict", ",", "noDictIssue", ")", ";", "else", "result", "=", "LZ4_compress_generic", "(", "(", "void", "*", ")", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limitedOutput", ",", "(", "sizeof", "(", "void", "*", ")=", "=", "8", ")", "?", "byU32", ":", "byPtr", ",", "noDict", ",", "noDictIssue", ")", ";", "#", "if", "(", "HEAPMODE", ")", "FREEMEM", "(", "ctx", ")", ";", "#", "endif", "return", "result", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Experimental", ":", "Streaming", "functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "void", "*", "LZ4_createStream", "(", ")", "{", "void", "*", "lz4s", "=", "ALLOCATOR", "(", "4", ",", "LZ4_STREAMSIZE_U32", ")", ";", "MEM_INIT", "(", "lz4s", ",", "0", ",", "LZ4_STREAMSIZE", ")", ";", "return", "lz4s", ";", "}", "int", "LZ4_free", "(", "void", "*", "LZ4_stream", ")", "{", "FREEMEM", "(", "LZ4_stream", ")", ";", "return", "(", "0", ")", ";", "}", "int", "LZ4_loadDict", "(", "void", "*", "LZ4_dict", ",", "const", "char", "*", "dictionary", ",", "int", "dictSize", ")", "{", "LZ4_stream_t_internal", "*", "dict", "=", "(", "LZ4_stream_t_internal", "*", ")", "LZ4_dict", ";", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "dictionary", ";", "const", "BYTE", "*", "const", "dictEnd", "=", "p", "+", "dictSize", ";", "const", "BYTE", "*", "base", ";", "LZ4_STATIC_ASSERT", "(", "LZ4_STREAMSIZE", ">", "=", "sizeof", "(", "LZ4_stream_t_internal", ")", ");", "/", "*", "A", "compilation", "error", "here", "means", "LZ4_STREAMSIZE", "is", "not", "large", "enough", "*", "/", "if", "(", "dict", "-", ">", "initCheck", ")", "MEM_INIT", "(", "dict", ",", "0", ",", "sizeof", "(", "LZ4_stream_t_internal", ")", ");", "/", "*", "Uninitialized", "structure", "detected", "*", "/", "if", "(", "dictSize", "<", "MINMATCH", ")", "{", "dict", "-", ">", "dictionary", "=", "NULL", ";", "dict", "-", ">", "dictSize", "=", "0", ";", "return", "1", ";", "}", "if", "(", "p", "<", "=", "dictEnd", "-", "64", "KB", ")", "p", "=", "dictEnd", "-", "64", "KB", ";", "base", "=", "p", "-", "dict", "-", ">", "currentOffset", ";", "dict", "-", ">", "dictionary", "=", "p", ";", "dict", "-", ">", "dictSize", "=", "(", "U32", ")", "(", "dictEnd", "-", "p", ")", ";", "dict", "-", ">", "currentOffset", "+", "=", "dict", "-", ">", "dictSize", ";", "while", "(", "p", "<", "=", "dictEnd", "-", "MINMATCH", ")", "{", "LZ4_putPosition", "(", "p", ",", "dict", ",", "byU32", ",", "base", ")", ";", "p", "+", "=", "3", ";", "}", "return", "1", ";", "}", "void", "LZ4_renormDictT", "(", "LZ4_stream_t_internal", "*", "LZ4_dict", ",", "const", "BYTE", "*", "src", ")", "{", "if", "(", "(", "LZ4_dict", "-", ">", "currentOffset", ">", "0x80000000", ")", "|", "|", "(", "(", "size_t", ")", "LZ4_dict", "-", ">", "currentOffset", ">", "(", "size_t", ")", "src", ")", ")", "/", "*", "address", "space", "overflow", "*", "/", "{", "/", "*", "rescale", "hash", "table", "*", "/", "U32", "delta", "=", "LZ4_dict", "-", ">", "currentOffset", "-", "64", "KB", ";", "const", "BYTE", "*", "dictEnd", "=", "LZ4_dict", "-", ">", "dictionary", "+", "LZ4_dict", "-", ">", "dictSize", ";", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "HASH_SIZE_U32", ";", "i", "+", "+)", "{", "if", "(", "LZ4_dict", "-", ">", "hashTable", "[", "i", "]", "<", "delta", ")", "LZ4_dict", "-", ">", "hashTable", "[", "i", "]", "=", "0", ";", "else", "LZ4_dict", "-", ">", "hashTable", "[", "i", "]", "-", "=", "delta", ";", "}", "LZ4_dict", "-", ">", "currentOffset", "=", "64", "KB", ";", "if", "(", "LZ4_dict", "-", ">", "dictSize", ">", "64", "KB", ")", "LZ4_dict", "-", ">", "dictSize", "=", "64", "KB", ";", "LZ4_dict", "-", ">", "dictionary", "=", "dictEnd", "-", "LZ4_dict", "-", ">", "dictSize", ";", "}", "}", "FORCE_INLINE", "int", "LZ4_compress_continue_generic", "(", "void", "*", "LZ4_stream", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "limitedOutput_directive", "limit", ")", "{", "LZ4_stream_t_internal", "*", "streamPtr", "=", "(", "LZ4_stream_t_internal", "*", ")", "LZ4_stream", ";", "const", "BYTE", "*", "const", "dictEnd", "=", "streamPtr", "-", ">", "dictionary", "+", "streamPtr", "-", ">", "dictSize", ";", "const", "BYTE", "*", "smallest", "=", "(", "const", "BYTE", "*", ")", "source", ";", "if", "(", "streamPtr", "-", ">", "initCheck", ")", "return", "0", ";", "/", "*", "Uninitialized", "structure", "detected", "*", "/", "if", "(", "(", "streamPtr", "-", ">", "dictSize", ">", "0", ")", "&", "&", "(", "smallest", ">", "dictEnd", ")", ")", "smallest", "=", "dictEnd", ";", "LZ4_renormDictT", "(", "streamPtr", ",", "smallest", ")", ";", "/", "*", "Check", "overlapping", "input", "/", "dictionary", "space", "*", "/", "{", "const", "BYTE", "*", "sourceEnd", "=", "(", "const", "BYTE", "*", ")", "source", "+", "inputSize", ";", "if", "(", "(", "sourceEnd", ">", "streamPtr", "-", ">", "dictionary", ")", "&", "&", "(", "sourceEnd", "<", "dictEnd", ")", ")", "{", "streamPtr", "-", ">", "dictSize", "=", "(", "U32", ")", "(", "dictEnd", "-", "sourceEnd", ")", ";", "if", "(", "streamPtr", "-", ">", "dictSize", ">", "64", "KB", ")", "streamPtr", "-", ">", "dictSize", "=", "64", "KB", ";", "if", "(", "streamPtr", "-", ">", "dictSize", "<", "4", ")", "streamPtr", "-", ">", "dictSize", "=", "0", ";", "streamPtr", "-", ">", "dictionary", "=", "dictEnd", "-", "streamPtr", "-", ">", "dictSize", ";", "}", "}", "/", "*", "prefix", "mode", ":", "source", "data", "follows", "dictionary", "*", "/", "if", "(", "dictEnd", "=", "=", "(", "const", "BYTE", "*", ")", "source", ")", "{", "int", "result", ";", "if", "(", "(", "streamPtr", "-", ">", "dictSize", "<", "64", "KB", ")", "&", "&", "(", "streamPtr", "-", ">", "dictSize", "<", "streamPtr", "-", ">", "currentOffset", ")", ")", "result", "=", "LZ4_compress_generic", "(", "LZ4_stream", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limit", ",", "byU32", ",", "withPrefix64k", ",", "dictSmall", ")", ";", "else", "result", "=", "LZ4_compress_generic", "(", "LZ4_stream", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limit", ",", "byU32", ",", "withPrefix64k", ",", "noDictIssue", ")", ";", "streamPtr", "-", ">", "dictSize", "+", "=", "(", "U32", ")", "inputSize", ";", "streamPtr", "-", ">", "currentOffset", "+", "=", "(", "U32", ")", "inputSize", ";", "return", "result", ";", "}", "/", "*", "external", "dictionary", "mode", "*", "/", "{", "int", "result", ";", "if", "(", "(", "streamPtr", "-", ">", "dictSize", "<", "64", "KB", ")", "&", "&", "(", "streamPtr", "-", ">", "dictSize", "<", "streamPtr", "-", ">", "currentOffset", ")", ")", "result", "=", "LZ4_compress_generic", "(", "LZ4_stream", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limit", ",", "byU32", ",", "usingExtDict", ",", "dictSmall", ")", ";", "else", "result", "=", "LZ4_compress_generic", "(", "LZ4_stream", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limit", ",", "byU32", ",", "usingExtDict", ",", "noDictIssue", ")", ";", "streamPtr", "-", ">", "dictionary", "=", "(", "const", "BYTE", "*", ")", "source", ";", "streamPtr", "-", ">", "dictSize", "=", "(", "U32", ")", "inputSize", ";", "streamPtr", "-", ">", "currentOffset", "+", "=", "(", "U32", ")", "inputSize", ";", "return", "result", ";", "}", "}", "int", "LZ4_compress_continue", "(", "void", "*", "LZ4_stream", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "return", "LZ4_compress_continue_generic", "(", "LZ4_stream", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ")", ";", "}", "int", "LZ4_compress_limitedOutput_continue", "(", "void", "*", "LZ4_stream", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_compress_continue_generic", "(", "LZ4_stream", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limitedOutput", ")", ";", "}", "/", "/", "Hidden", "debug", "function", ",", "to", "force", "separate", "dictionary", "mode", "int", "LZ4_compress_forceExtDict", "(", "LZ4_stream_t", "*", "LZ4_dict", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "LZ4_stream_t_internal", "*", "streamPtr", "=", "(", "LZ4_stream_t_internal", "*", ")", "LZ4_dict", ";", "int", "result", ";", "const", "BYTE", "*", "const", "dictEnd", "=", "streamPtr", "-", ">", "dictionary", "+", "streamPtr", "-", ">", "dictSize", ";", "const", "BYTE", "*", "smallest", "=", "dictEnd", ";", "if", "(", "smallest", ">", "(", "const", "BYTE", "*", ")", "source", ")", "smallest", "=", "(", "const", "BYTE", "*", ")", "source", ";", "LZ4_renormDictT", "(", "(", "LZ4_stream_t_internal", "*", ")", "LZ4_dict", ",", "smallest", ")", ";", "result", "=", "LZ4_compress_generic", "(", "LZ4_dict", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ",", "byU32", ",", "usingExtDict", ",", "noDictIssue", ")", ";", "streamPtr", "-", ">", "dictionary", "=", "(", "const", "BYTE", "*", ")", "source", ";", "streamPtr", "-", ">", "dictSize", "=", "(", "U32", ")", "inputSize", ";", "streamPtr", "-", ">", "currentOffset", "+", "=", "(", "U32", ")", "inputSize", ";", "return", "result", ";", "}", "int", "LZ4_saveDict", "(", "void", "*", "LZ4_dict", ",", "char", "*", "safeBuffer", ",", "int", "dictSize", ")", "{", "LZ4_stream_t_internal", "*", "dict", "=", "(", "LZ4_stream_t_internal", "*", ")", "LZ4_dict", ";", "const", "BYTE", "*", "previousDictEnd", "=", "dict", "-", ">", "dictionary", "+", "dict", "-", ">", "dictSize", ";", "if", "(", "(", "U32", ")", "dictSize", ">", "64", "KB", ")", "dictSize", "=", "64", "KB", ";", "/", "*", "useless", "to", "define", "a", "dictionary", ">", "64", "KB", "*", "/", "if", "(", "(", "U32", ")", "dictSize", ">", "dict", "-", ">", "dictSize", ")", "dictSize", "=", "dict", "-", ">", "dictSize", ";", "memcpy", "(", "safeBuffer", ",", "previousDictEnd", "-", "dictSize", ",", "dictSize", ")", ";", "dict", "-", ">", "dictionary", "=", "(", "const", "BYTE", "*", ")", "safeBuffer", ";", "dict", "-", ">", "dictSize", "=", "(", "U32", ")", "dictSize", ";", "return", "1", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Decompression", "functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "*", "This", "generic", "decompression", "function", "cover", "all", "use", "cases", ".", "*", "It", "shall", "be", "instanciated", "several", "times", ",", "using", "different", "sets", "of", "directives", "*", "Note", "that", "it", "is", "essential", "this", "generic", "function", "is", "really", "inlined", ",", "*", "in", "order", "to", "remove", "useless", "branches", "during", "compilation", "optimisation", ".", "*", "/", "FORCE_INLINE", "int", "LZ4_decompress_generic", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "outputSize", ",", "/", "*", "If", "endOnInput", "=", "=", "endOnInputSize", ",", "this", "value", "is", "the", "max", "size", "of", "Output", "Buffer", ".", "*", "/", "int", "endOnInput", ",", "/", "*", "endOnOutputSize", ",", "endOnInputSize", "*", "/", "int", "partialDecoding", ",", "/", "*", "full", ",", "partial", "*", "/", "int", "targetOutputSize", ",", "/", "*", "only", "used", "if", "partialDecoding", "=", "=", "partial", "*", "/", "int", "dict", ",", "/", "*", "noDict", ",", "withPrefix64k", ",", "usingExtDict", "*", "/", "const", "char", "*", "dictStart", ",", "/", "*", "only", "if", "dict", "=", "=", "usingExtDict", "*", "/", "int", "dictSize", "/", "*", "note", ":", "=", "0", "if", "noDict", "*", "/", ")", "{", "/", "*", "Local", "Variables", "*", "/", "const", "BYTE", "*", "restrict", "ip", "=", "(", "const", "BYTE", "*", ")", "source", ";", "const", "BYTE", "*", "ref", ";", "const", "BYTE", "*", "const", "iend", "=", "ip", "+", "inputSize", ";", "BYTE", "*", "op", "=", "(", "BYTE", "*", ")", "dest", ";", "BYTE", "*", "const", "oend", "=", "op", "+", "outputSize", ";", "BYTE", "*", "cpy", ";", "BYTE", "*", "oexit", "=", "op", "+", "targetOutputSize", ";", "const", "BYTE", "*", "const", "lowLimit", "=", "(", "const", "BYTE", "*", ")", "dest", "-", "dictSize", ";", "const", "BYTE", "*", "const", "dictEnd", "=", "(", "const", "BYTE", "*", ")", "dictStart", "+", "dictSize", ";", "/", "/#", "define", "OLD", "#", "ifdef", "OLD", "const", "size_t", "dec32table", "[", "]", "=", "{", "0", ",", "3", ",", "2", ",", "3", ",", "0", ",", "0", ",", "0", ",", "0", "}", ";", "/", "*", "static", "reduces", "speed", "for", "LZ4_decompress_safe", "(", ")", "on", "GCC64", "*", "/", "#", "else", "const", "size_t", "dec32table", "[", "]", "=", "{", "4", "-", "0", ",", "4", "-", "3", ",", "4", "-", "2", ",", "4", "-", "3", ",", "4", "-", "0", ",", "4", "-", "0", ",", "4", "-", "0", ",", "4", "-", "0", "}", ";", "/", "*", "static", "reduces", "speed", "for", "LZ4_decompress_safe", "(", ")", "on", "GCC64", "*", "/", "#", "endif", "static", "const", "size_t", "dec64table", "[", "]", "=", "{", "0", ",", "0", ",", "0", ",", "(", "size_t", ")", "-", "1", ",", "0", ",", "1", ",", "2", ",", "3", "}", ";", "const", "int", "checkOffset", "=", "(", "endOnInput", ")", "&", "&", "(", "dictSize", "<", "(", "int", ")", "(", "64", "KB", ")", ");", "/", "*", "Special", "cases", "*", "/", "if", "(", "(", "partialDecoding", ")", "&", "&", "(", "oexit", ">", "oend", "-", "MFLIMIT", ")", ")", "oexit", "=", "oend", "-", "MFLIMIT", ";", "/", "*", "targetOutputSize", "too", "high", "=", ">", "decode", "everything", "*", "/", "if", "(", "(", "endOnInput", ")", "&", "&", "(", "unlikely", "(", "outputSize", "=", "=", "0", ")", "))", "return", "(", "(", "inputSize", "=", "=", "1", ")", "&", "&", "(", "*", "ip", "=", "=", "0", ")", ")", "?", "0", ":", "-", "1", ";", "/", "*", "Empty", "output", "buffer", "*", "/", "if", "(", "(!", "endOnInput", ")", "&", "&", "(", "unlikely", "(", "outputSize", "=", "=", "0", ")", "))", "return", "(", "*", "ip", "=", "=", "0", "?", "1", ":", "-", "1", ")", ";", "/", "*", "Main", "Loop", "*", "/", "while", "(", "1", ")", "{", "unsigned", "token", ";", "size_t", "length", ";", "/", "*", "get", "runlength", "*", "/", "token", "=", "*", "ip", "+", "+;", "if", "(", "(", "length", "=", "(", "token", ">", ">", "ML_BITS", ")", ")", "=", "=", "RUN_MASK", ")", "{", "unsigned", "s", ";", "do", "{", "s", "=", "*", "ip", "+", "+;", "length", "+", "=", "s", ";", "}", "while", "(", "likely", "(", "(", "endOnInput", ")", "?", "ip", "<", "iend", "-", "RUN_MASK", ":", "1", ")", "&", "&", "(", "s", "=", "=", "255", ")", ");", "/", "/", "if", "(", "(", "sizeof", "(", "void", "*", ")=", "=", "4", ")", "&", "&", "unlikely", "(", "length", ">", "LZ4_MAX_INPUT_SIZE", ")", ")", "goto", "_output_error", ";", "/", "*", "overflow", "detection", "*", "/", "if", "(", "(", "sizeof", "(", "void", "*", ")=", "=", "4", ")", "&", "&", "unlikely", "(", "(", "size_t", ")", "(", "op", "+", "length", ")", "<(", "size_t", ")", "(", "op", ")", "))", "goto", "_output_error", ";", "/", "*", "quickfix", "issue", "134", "*", "/", "if", "(", "(", "endOnInput", ")", "&", "&", "(", "sizeof", "(", "void", "*", ")=", "=", "4", ")", "&", "&", "unlikely", "(", "(", "size_t", ")", "(", "ip", "+", "length", ")", "<(", "size_t", ")", "(", "ip", ")", "))", "goto", "_output_error", ";", "/", "*", "quickfix", "issue", "134", "*", "/", "}", "/", "*", "copy", "literals", "*", "/", "cpy", "=", "op", "+", "length", ";", "if", "(", "((", "endOnInput", ")", "&", "&", "(", "(", "cpy", ">", "(", "partialDecoding", "?", "oexit", ":", "oend", "-", "MFLIMIT", ")", ")", "|", "|", "(", "ip", "+", "length", ">", "iend", "-", "(", "2", "+", "1", "+", "LASTLITERALS", ")", "))", ")", "|", "|", "(", "(!", "endOnInput", ")", "&", "&", "(", "cpy", ">", "oend", "-", "COPYLENGTH", ")", "))", "{", "if", "(", "partialDecoding", ")", "{", "if", "(", "cpy", ">", "oend", ")", "goto", "_output_error", ";", "/", "*", "Error", ":", "write", "attempt", "beyond", "end", "of", "output", "buffer", "*", "/", "if", "(", "(", "endOnInput", ")", "&", "&", "(", "ip", "+", "length", ">", "iend", ")", ")", "goto", "_output_error", ";", "/", "*", "Error", ":", "read", "attempt", "beyond", "end", "of", "input", "buffer", "*", "/", "}", "else", "{", "if", "(", "(!", "endOnInput", ")", "&", "&", "(", "cpy", "!", "=", "oend", ")", ")", "goto", "_output_error", ";", "/", "*", "Error", ":", "block", "decoding", "must", "stop", "exactly", "there", "*", "/", "if", "(", "(", "endOnInput", ")", "&", "&", "(", "(", "ip", "+", "length", "!", "=", "iend", ")", "|", "|", "(", "cpy", ">", "oend", ")", "))", "goto", "_output_error", ";", "/", "*", "Error", ":", "input", "must", "be", "consumed", "*", "/", "}", "memcpy", "(", "op", ",", "ip", ",", "length", ")", ";", "ip", "+", "=", "length", ";", "op", "+", "=", "length", ";", "break", ";", "/", "*", "Necessarily", "EOF", ",", "due", "to", "parsing", "restrictions", "*", "/", "}", "LZ4_WILDCOPY", "(", "op", ",", "ip", ",", "cpy", ")", ";", "ip", "-", "=", "(", "op", "-", "cpy", ")", ";", "op", "=", "cpy", ";", "/", "*", "get", "offset", "*", "/", "LZ4_READ_LITTLEENDIAN_16", "(", "ref", ",", "cpy", ",", "ip", ")", ";", "ip", "+", "=", "2", ";", "if", "(", "(", "checkOffset", ")", "&", "&", "(", "unlikely", "(", "ref", "<", "lowLimit", ")", "))", "goto", "_output_error", ";", "/", "*", "Error", ":", "offset", "outside", "destination", "buffer", "*", "/", "/", "*", "get", "matchlength", "*", "/", "if", "(", "(", "length", "=", "(", "token", "&", "ML_MASK", ")", ")", "=", "=", "ML_MASK", ")", "{", "unsigned", "s", ";", "do", "{", "if", "(", "(", "endOnInput", ")", "&", "&", "(", "ip", ">", "iend", "-", "LASTLITERALS", ")", ")", "goto", "_output_error", ";", "s", "=", "*", "ip", "+", "+;", "length", "+", "=", "s", ";", "}", "while", "(", "s", "=", "=", "255", ")", ";", "/", "/", "if", "(", "(", "sizeof", "(", "void", "*", ")=", "=", "4", ")", "&", "&", "unlikely", "(", "length", ">", "LZ4_MAX_INPUT_SIZE", ")", ")", "goto", "_output_error", ";", "/", "*", "overflow", "detection", "*", "/", "if", "(", "(", "sizeof", "(", "void", "*", ")=", "=", "4", ")", "&", "&", "unlikely", "(", "(", "size_t", ")", "(", "op", "+", "length", ")", "<(", "size_t", ")", "op", ")", ")", "goto", "_output_error", ";", "/", "*", "quickfix", "issue", "134", "*", "/", "}", "/", "*", "check", "external", "dictionary", "*", "/", "if", "(", "(", "dict", "=", "=", "usingExtDict", ")", "&", "&", "(", "ref", "<", "(", "BYTE", "*", "const", ")", "dest", ")", ")", "{", "if", "(", "unlikely", "(", "op", "+", "length", "+", "MINMATCH", ">", "oend", "-", "LASTLITERALS", ")", ")", "goto", "_output_error", ";", "if", "(", "length", "+", "MINMATCH", "<", "=", "(", "size_t", ")", "(", "dest", "-", "(", "char", "*", ")", "ref", ")", ")", "{", "ref", "=", "dictEnd", "-", "(", "dest", "-", "(", "char", "*", ")", "ref", ")", ";", "memcpy", "(", "op", ",", "ref", ",", "length", "+", "MINMATCH", ")", ";", "op", "+", "=", "length", "+", "MINMATCH", ";", "}", "else", "{", "size_t", "copySize", "=", "(", "size_t", ")", "(", "dest", "-", "(", "char", "*", ")", "ref", ")", ";", "memcpy", "(", "op", ",", "dictEnd", "-", "copySize", ",", "copySize", ")", ";", "op", "+", "=", "copySize", ";", "copySize", "=", "length", "+", "MINMATCH", "-", "copySize", ";", "if", "(", "copySize", ">", "(", "size_t", ")", "((", "char", "*", ")", "op", "-", "dest", ")", ")", "/", "*", "overlap", "*", "/", "{", "BYTE", "*", "const", "cpy", "=", "op", "+", "copySize", ";", "const", "BYTE", "*", "ref", "=", "(", "BYTE", "*", ")", "dest", ";", "while", "(", "op", "<", "cpy", ")", "*", "op", "+", "+", "=", "*", "ref", "+", "+;", "}", "else", "{", "memcpy", "(", "op", ",", "dest", ",", "copySize", ")", ";", "op", "+", "=", "copySize", ";", "}", "}", "continue", ";", "}", "/", "*", "copy", "repeated", "sequence", "*", "/", "if", "(", "unlikely", "(", "(", "op", "-", "ref", ")", "<(", "int", ")", "STEPSIZE", ")", ")", "{", "const", "size_t", "dec64", "=", "dec64table", "[", "(", "sizeof", "(", "void", "*", ")=", "=", "4", ")", "?", "0", ":", "op", "-", "ref", "]", ";", "op", "[", "0", "]", "=", "ref", "[", "0", "]", ";", "op", "[", "1", "]", "=", "ref", "[", "1", "]", ";", "op", "[", "2", "]", "=", "ref", "[", "2", "]", ";", "op", "[", "3", "]", "=", "ref", "[", "3", "]", ";", "#", "ifdef", "OLD", "op", "+", "=", "4", ",", "ref", "+", "=", "4", ";", "ref", "-", "=", "dec32table", "[", "op", "-", "ref", "]", ";", "A32", "(", "op", ")", "=", "A32", "(", "ref", ")", ";", "op", "+", "=", "STEPSIZE", "-", "4", ";", "ref", "-", "=", "dec64", ";", "#", "else", "ref", "+", "=", "dec32table", "[", "op", "-", "ref", "]", ";", "A32", "(", "op", "+", "4", ")", "=", "A32", "(", "ref", ")", ";", "op", "+", "=", "STEPSIZE", ";", "ref", "-", "=", "dec64", ";", "#", "endif", "}", "else", "{", "LZ4_COPYSTEP", "(", "op", ",", "ref", ")", ";", "}", "cpy", "=", "op", "+", "length", "-", "(", "STEPSIZE", "-", "4", ")", ";", "if", "(", "unlikely", "(", "cpy", ">", "oend", "-", "COPYLENGTH", "-", "(", "STEPSIZE", "-", "4", ")", "))", "{", "if", "(", "cpy", ">", "oend", "-", "LASTLITERALS", ")", "goto", "_output_error", ";", "/", "*", "Error", ":", "last", "5", "bytes", "must", "be", "literals", "*", "/", "if", "(", "op", "<", "oend", "-", "COPYLENGTH", ")", "LZ4_WILDCOPY", "(", "op", ",", "ref", ",", "(", "oend", "-", "COPYLENGTH", ")", ");", "while", "(", "op", "<", "cpy", ")", "*", "op", "+", "+=", "*", "ref", "+", "+;", "op", "=", "cpy", ";", "continue", ";", "}", "LZ4_WILDCOPY", "(", "op", ",", "ref", ",", "cpy", ")", ";", "op", "=", "cpy", ";", "/", "*", "correction", "*", "/", "}", "/", "*", "end", "of", "decoding", "*", "/", "if", "(", "endOnInput", ")", "return", "(", "int", ")", "(", "((", "char", "*", ")", "op", ")", "-", "dest", ")", ";", "/", "*", "Nb", "of", "output", "bytes", "decoded", "*", "/", "else", "return", "(", "int", ")", "(", "((", "char", "*", ")", "ip", ")", "-", "source", ")", ";", "/", "*", "Nb", "of", "input", "bytes", "read", "*", "/", "/", "*", "Overflow", "error", "detected", "*", "/", "_output_error", ":", "return", "(", "int", ")", "(", "-(", "((", "char", "*", ")", "ip", ")", "-", "source", ")", ")-", "1", ";", "}", "int", "LZ4_decompress_safe", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "compressedSize", ",", "maxOutputSize", ",", "endOnInputSize", ",", "full", ",", "0", ",", "noDict", ",", "NULL", ",", "0", ")", ";", "}", "int", "LZ4_decompress_safe_partial", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "targetOutputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "compressedSize", ",", "maxOutputSize", ",", "endOnInputSize", ",", "partial", ",", "targetOutputSize", ",", "noDict", ",", "NULL", ",", "0", ")", ";", "}", "int", "LZ4_decompress_fast", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "originalSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "0", ",", "originalSize", ",", "endOnOutputSize", ",", "full", ",", "0", ",", "withPrefix64k", ",", "NULL", ",", "0", ")", ";", "}", "/", "*", "streaming", "decompression", "functions", "*", "/", "/", "/#", "define", "LZ4_STREAMDECODESIZE_U32", "4", "/", "/#", "define", "LZ4_STREAMDECODESIZE", "(", "LZ4_STREAMDECODESIZE_U32", "*", "sizeof", "(", "unsigned", "int", ")", ")", "/", "/", "typedef", "struct", "{", "unsigned", "int", "table", "[", "LZ4_STREAMDECODESIZE_U32", "]", ";", "}", "LZ4_streamDecode_t", ";", "typedef", "struct", "{", "const", "char", "*", "dictionary", ";", "int", "dictSize", ";", "}", "LZ4_streamDecode_t_internal", ";", "/", "*", "*", "If", "you", "prefer", "dynamic", "allocation", "methods", ",", "*", "LZ4_createStreamDecode", "(", ")", "*", "provides", "a", "pointer", "(", "void", "*", ")", "towards", "an", "initialized", "LZ4_streamDecode_t", "structure", ".", "*", "/", "void", "*", "LZ4_createStreamDecode", "(", ")", "{", "void", "*", "lz4s", "=", "ALLOCATOR", "(", "sizeof", "(", "U32", ")", ",", "LZ4_STREAMDECODESIZE_U32", ")", ";", "MEM_INIT", "(", "lz4s", ",", "0", ",", "LZ4_STREAMDECODESIZE", ")", ";", "return", "lz4s", ";", "}", "/", "*", "*", "LZ4_setDictDecode", "*", "Use", "this", "function", "to", "instruct", "where", "to", "find", "the", "dictionary", "*", "This", "function", "is", "not", "necessary", "if", "previous", "data", "is", "still", "available", "where", "it", "was", "decoded", ".", "*", "Loading", "a", "size", "of", "0", "is", "allowed", "(", "same", "effect", "as", "no", "dictionary", ")", ".", "*", "Return", ":", "1", "if", "OK", ",", "0", "if", "error", "*", "/", "int", "LZ4_setDictDecode", "(", "void", "*", "LZ4_streamDecode", ",", "const", "char", "*", "dictionary", ",", "int", "dictSize", ")", "{", "LZ4_streamDecode_t_internal", "*", "lz4sd", "=", "(", "LZ4_streamDecode_t_internal", "*", ")", "LZ4_streamDecode", ";", "lz4sd", "-", ">", "dictionary", "=", "dictionary", ";", "lz4sd", "-", ">", "dictSize", "=", "dictSize", ";", "return", "1", ";", "}", "/", "*", "*", "_continue", "(", ")", ":", "These", "decoding", "functions", "allow", "decompression", "of", "multiple", "blocks", "in", "\"", "streaming", "\"", "mode", ".", "Previously", "decoded", "blocks", "must", "still", "be", "available", "at", "the", "memory", "position", "where", "they", "were", "decoded", ".", "If", "it", "'", "s", "not", "possible", ",", "save", "the", "relevant", "part", "of", "decoded", "data", "into", "a", "safe", "buffer", ",", "and", "indicate", "where", "it", "stands", "using", "LZ4_setDictDecode", "(", ")", "*", "/", "int", "LZ4_decompress_safe_continue", "(", "void", "*", "LZ4_streamDecode", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "maxOutputSize", ")", "{", "LZ4_streamDecode_t_internal", "*", "lz4sd", "=", "(", "LZ4_streamDecode_t_internal", "*", ")", "LZ4_streamDecode", ";", "int", "result", ";", "result", "=", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "compressedSize", ",", "maxOutputSize", ",", "endOnInputSize", ",", "full", ",", "0", ",", "usingExtDict", ",", "lz4sd", "-", ">", "dictionary", ",", "lz4sd", "-", ">", "dictSize", ")", ";", "if", "(", "result", "<", "=", "0", ")", "return", "result", ";", "if", "(", "lz4sd", "-", ">", "dictionary", "+", "lz4sd", "-", ">", "dictSize", "=", "=", "dest", ")", "{", "lz4sd", "-", ">", "dictSize", "+", "=", "result", ";", "}", "else", "{", "lz4sd", "-", ">", "dictionary", "=", "dest", ";", "lz4sd", "-", ">", "dictSize", "=", "result", ";", "}", "return", "result", ";", "}", "int", "LZ4_decompress_fast_continue", "(", "void", "*", "LZ4_streamDecode", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "originalSize", ")", "{", "LZ4_streamDecode_t_internal", "*", "lz4sd", "=", "(", "LZ4_streamDecode_t_internal", "*", ")", "LZ4_streamDecode", ";", "int", "result", ";", "result", "=", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "0", ",", "originalSize", ",", "endOnOutputSize", ",", "full", ",", "0", ",", "usingExtDict", ",", "lz4sd", "-", ">", "dictionary", ",", "lz4sd", "-", ">", "dictSize", ")", ";", "if", "(", "result", "<", "=", "0", ")", "return", "result", ";", "if", "(", "lz4sd", "-", ">", "dictionary", "+", "lz4sd", "-", ">", "dictSize", "=", "=", "dest", ")", "{", "lz4sd", "-", ">", "dictSize", "+", "=", "result", ";", "}", "else", "{", "lz4sd", "-", ">", "dictionary", "=", "dest", ";", "lz4sd", "-", ">", "dictSize", "=", "result", ";", "}", "return", "result", ";", "}", "/", "*", "Advanced", "decoding", "functions", ":", "*", "_usingDict", "(", ")", ":", "These", "decoding", "functions", "work", "the", "same", "as", "\"", "_continue", "\"", "ones", ",", "the", "dictionary", "must", "be", "explicitly", "provided", "within", "parameters", "*", "/", "int", "LZ4_decompress_safe_usingDict", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "maxOutputSize", ",", "const", "char", "*", "dictStart", ",", "int", "dictSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "compressedSize", ",", "maxOutputSize", ",", "endOnInputSize", ",", "full", ",", "0", ",", "usingExtDict", ",", "dictStart", ",", "dictSize", ")", ";", "}", "int", "LZ4_decompress_fast_usingDict", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "originalSize", ",", "const", "char", "*", "dictStart", ",", "int", "dictSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "0", ",", "originalSize", ",", "endOnOutputSize", ",", "full", ",", "0", ",", "usingExtDict", ",", "dictStart", ",", "dictSize", ")", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Obsolete", "Functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "*", "These", "function", "names", "are", "deprecated", "and", "should", "no", "longer", "be", "used", ".", "They", "are", "only", "provided", "here", "for", "compatibility", "with", "older", "user", "programs", ".", "-", "LZ4_uncompress", "is", "totally", "equivalent", "to", "LZ4_decompress_fast", "-", "LZ4_uncompress_unknownOutputSize", "is", "totally", "equivalent", "to", "LZ4_decompress_safe", "*", "/", "int", "LZ4_uncompress", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "outputSize", ")", "{", "return", "LZ4_decompress_fast", "(", "source", ",", "dest", ",", "outputSize", ")", ";", "}", "int", "LZ4_uncompress_unknownOutputSize", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "isize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_decompress_safe", "(", "source", ",", "dest", ",", "isize", ",", "maxOutputSize", ")", ";", "}", "/", "*", "Obsolete", "Streaming", "functions", "*", "/", "int", "LZ4_sizeofStreamState", "(", ")", "{", "return", "LZ4_STREAMSIZE", ";", "}", "void", "LZ4_init", "(", "LZ4_stream_t_internal", "*", "lz4ds", ",", "const", "BYTE", "*", "base", ")", "{", "MEM_INIT", "(", "lz4ds", ",", "0", ",", "LZ4_STREAMSIZE", ")", ";", "lz4ds", "-", ">", "bufferStart", "=", "base", ";", "}", "int", "LZ4_resetStreamState", "(", "void", "*", "state", ",", "const", "char", "*", "inputBuffer", ")", "{", "if", "(", "((", "(", "size_t", ")", "state", ")", "&", "3", ")", "!", "=", "0", ")", "return", "1", ";", "/", "*", "Error", ":", "pointer", "is", "not", "aligned", "on", "4", "-", "bytes", "boundary", "*", "/", "LZ4_init", "(", "(", "LZ4_stream_t_internal", "*", ")", "state", ",", "(", "const", "BYTE", "*", ")", "inputBuffer", ")", ";", "return", "0", ";", "}", "void", "*", "LZ4_create", "(", "const", "char", "*", "inputBuffer", ")", "{", "void", "*", "lz4ds", "=", "ALLOCATOR", "(", "4", ",", "LZ4_STREAMSIZE_U32", ")", ";", "LZ4_init", "(", "(", "LZ4_stream_t_internal", "*", ")", "lz4ds", ",", "(", "const", "BYTE", "*", ")", "inputBuffer", ")", ";", "return", "lz4ds", ";", "}", "char", "*", "LZ4_slideInputBuffer", "(", "void", "*", "LZ4_Data", ")", "{", "LZ4_stream_t_internal", "*", "lz4ds", "=", "(", "LZ4_stream_t_internal", "*", ")", "LZ4_Data", ";", "LZ4_saveDict", "(", "(", "LZ4_stream_t", "*", ")", "LZ4_Data", ",", "(", "char", "*", ")", "lz4ds", "-", ">", "bufferStart", ",", "64", "KB", ")", ";", "return", "(", "char", "*", ")(", "lz4ds", "-", ">", "bufferStart", "+", "64", "KB", ")", ";", "}", "/", "*", "Obsolete", "compresson", "functions", "using", "User", "-", "allocated", "state", "*", "/", "int", "LZ4_sizeofState", "(", ")", "{", "return", "LZ4_STREAMSIZE", ";", "}", "int", "LZ4_compress_withState", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "if", "(", "((", "size_t", ")", "(", "state", ")", "&", "3", ")", "!", "=", "0", ")", "return", "0", ";", "/", "*", "Error", ":", "state", "is", "not", "aligned", "on", "4", "-", "bytes", "boundary", "*", "/", "MEM_INIT", "(", "state", ",", "0", ",", "LZ4_STREAMSIZE", ")", ";", "if", "(", "inputSize", "<", "(", "int", ")", "LZ4_64KLIMIT", ")", "return", "LZ4_compress_generic", "(", "state", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ",", "byU16", ",", "noDict", ",", "noDictIssue", ")", ";", "else", "return", "LZ4_compress_generic", "(", "state", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "notLimited", ",", "(", "sizeof", "(", "void", "*", ")=", "=", "8", ")", "?", "byU32", ":", "byPtr", ",", "noDict", ",", "noDictIssue", ")", ";", "}", "int", "LZ4_compress_limitedOutput_withState", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "if", "(", "((", "size_t", ")", "(", "state", ")", "&", "3", ")", "!", "=", "0", ")", "return", "0", ";", "/", "*", "Error", ":", "state", "is", "not", "aligned", "on", "4", "-", "bytes", "boundary", "*", "/", "MEM_INIT", "(", "state", ",", "0", ",", "LZ4_STREAMSIZE", ")", ";", "if", "(", "inputSize", "<", "(", "int", ")", "LZ4_64KLIMIT", ")", "return", "LZ4_compress_generic", "(", "state", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limitedOutput", ",", "byU16", ",", "noDict", ",", "noDictIssue", ")", ";", "else", "return", "LZ4_compress_generic", "(", "state", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limitedOutput", ",", "(", "sizeof", "(", "void", "*", ")=", "=", "8", ")", "?", "byU32", ":", "byPtr", ",", "noDict", ",", "noDictIssue", ")", ";", "}", "/", "*", "Obsolete", "streaming", "decompression", "functions", "*", "/", "int", "LZ4_decompress_safe_withPrefix64k", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "compressedSize", ",", "maxOutputSize", ",", "endOnInputSize", ",", "full", ",", "0", ",", "withPrefix64k", ",", "NULL", ",", "64", "KB", ")", ";", "}", "int", "LZ4_decompress_fast_withPrefix64k", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "originalSize", ")", "{", "return", "LZ4_decompress_generic", "(", "source", ",", "dest", ",", "0", ",", "originalSize", ",", "endOnOutputSize", ",", "full", ",", "0", ",", "withPrefix64k", ",", "NULL", ",", "64", "KB", ")", ";", "}", "@", "@", "-", "1", ",", "206", "+", "1", ",", "306", "@", "@", "/", "*", "LZ4", "-", "Fast", "LZ", "compression", "algorithm", "Header", "File", "Copyright", "(", "C", ")", "2011", "-", "2013", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "#", "pragma", "once", "#", "if", "defined", "(", "__cplusplus", ")", "extern", "\"", "C", "\"", "{", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "__cplusplus", ")", "/", "/", "Visual", "Studio", "#", "define", "inline", "__inline", "/", "/", "Visual", "C", "is", "not", "C99", ",", "but", "supports", "some", "kind", "of", "inline", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Simple", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "int", "LZ4_compress", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "int", "LZ4_decompress_safe", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "LZ4_compress", "(", ")", ":", "Compresses", "'", "inputSize", "'", "bytes", "from", "'", "source", "'", "into", "'", "dest", "'", ".", "Destination", "buffer", "must", "be", "already", "allocated", ",", "and", "must", "be", "sized", "to", "handle", "worst", "cases", "situations", "(", "input", "data", "not", "compressible", ")", "Worst", "case", "size", "evaluation", "is", "provided", "by", "function", "LZ4_compressBound", "(", ")", "inputSize", ":", "Max", "supported", "value", "is", "~", "1", ".", "9GB", "return", ":", "the", "number", "of", "bytes", "written", "in", "buffer", "dest", "or", "0", "if", "the", "compression", "fails", "LZ4_decompress_safe", "(", ")", ":", "maxOutputSize", ":", "is", "the", "size", "of", "the", "destination", "buffer", "(", "which", "must", "be", "already", "allocated", ")", "return", ":", "the", "number", "of", "bytes", "decoded", "in", "the", "destination", "buffer", "(", "necessarily", "<", "=", "maxOutputSize", ")", "If", "the", "source", "stream", "is", "detected", "malformed", ",", "the", "function", "will", "stop", "decoding", "and", "return", "a", "negative", "result", ".", "This", "function", "is", "protected", "against", "buffer", "overflow", "exploits", "(", "never", "writes", "outside", "of", "output", "buffer", ",", "and", "never", "reads", "outside", "of", "input", "buffer", ")", ".", "Therefore", ",", "it", "is", "protected", "against", "malicious", "data", "packets", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Advanced", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "LZ4_MAX_INPUT_SIZE", "0x7E000000", "/", "*", "2", "113", "929", "216", "bytes", "*", "/", "static", "inline", "int", "LZ4_compressBound", "(", "int", "isize", ")", "{", "return", "(", "(", "unsigned", "int", ")", "(", "isize", ")", ">", "(", "unsigned", "int", ")", "LZ4_MAX_INPUT_SIZE", "?", "0", ":", "(", "isize", ")", "+", "(", "(", "isize", ")", "/", "255", ")", "+", "16", ")", ";", "}", "#", "define", "LZ4_COMPRESSBOUND", "(", "isize", ")", "(", "(", "unsigned", "int", ")", "(", "isize", ")", ">", "(", "unsigned", "int", ")", "LZ4_MAX_INPUT_SIZE", "?", "0", ":", "(", "isize", ")", "+", "(", "(", "isize", ")", "/", "255", ")", "+", "16", ")", "/", "*", "LZ4_compressBound", "(", ")", ":", "Provides", "the", "maximum", "size", "that", "LZ4", "may", "output", "in", "a", "\"", "worst", "case", "\"", "scenario", "(", "input", "data", "not", "compressible", ")", "primarily", "useful", "for", "memory", "allocation", "of", "output", "buffer", ".", "inline", "function", "is", "recommended", "for", "the", "general", "case", ",", "macro", "is", "also", "provided", "when", "result", "needs", "to", "be", "evaluated", "at", "compilation", "(", "such", "as", "table", "size", "allocation", ")", ".", "isize", ":", "is", "the", "input", "size", ".", "Max", "supported", "value", "is", "~", "1", ".", "9GB", "return", ":", "maximum", "output", "size", "in", "a", "\"", "worst", "case", "\"", "scenario", "note", ":", "this", "function", "is", "limited", "by", "\"", "int", "\"", "range", "(", "2", "^", "31", "-", "1", ")", "*", "/", "int", "LZ4_compress_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "LZ4_compress_limitedOutput", "(", ")", ":", "Compress", "'", "inputSize", "'", "bytes", "from", "'", "source", "'", "into", "an", "output", "buffer", "'", "dest", "'", "of", "maximum", "size", "'", "maxOutputSize", "'", ".", "If", "it", "cannot", "achieve", "it", ",", "compression", "will", "stop", ",", "and", "result", "of", "the", "function", "will", "be", "zero", ".", "This", "function", "never", "writes", "outside", "of", "provided", "output", "buffer", ".", "inputSize", ":", "Max", "supported", "value", "is", "~", "1", ".", "9GB", "maxOutputSize", ":", "is", "the", "size", "of", "the", "destination", "buffer", "(", "which", "must", "be", "already", "allocated", ")", "return", ":", "the", "number", "of", "bytes", "written", "in", "buffer", "'", "dest", "'", "or", "0", "if", "the", "compression", "fails", "*", "/", "int", "LZ4_decompress_fast", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "outputSize", ")", ";", "/", "*", "LZ4_decompress_fast", "(", ")", ":", "outputSize", ":", "is", "the", "original", "(", "uncompressed", ")", "size", "return", ":", "the", "number", "of", "bytes", "read", "from", "the", "source", "buffer", "(", "in", "other", "words", ",", "the", "compressed", "size", ")", "If", "the", "source", "stream", "is", "malformed", ",", "the", "function", "will", "stop", "decoding", "and", "return", "a", "negative", "result", ".", "note", ":", "This", "function", "is", "a", "bit", "faster", "than", "LZ4_decompress_safe", "(", ")", "This", "function", "never", "writes", "outside", "of", "output", "buffers", ",", "but", "may", "read", "beyond", "input", "buffer", "in", "case", "of", "malicious", "data", "packet", ".", "Use", "this", "function", "preferably", "into", "a", "trusted", "environment", "(", "data", "to", "decode", "comes", "from", "a", "trusted", "source", ")", ".", "Destination", "buffer", "must", "be", "already", "allocated", ".", "Its", "size", "must", "be", "a", "minimum", "of", "'", "outputSize", "'", "bytes", ".", "*", "/", "int", "LZ4_decompress_safe_partial", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "targetOutputSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "LZ4_decompress_safe_partial", "(", ")", ":", "This", "function", "decompress", "a", "compressed", "block", "of", "size", "'", "inputSize", "'", "at", "position", "'", "source", "'", "into", "output", "buffer", "'", "dest", "'", "of", "size", "'", "maxOutputSize", "'", ".", "The", "function", "stops", "decompressing", "operation", "as", "soon", "as", "'", "targetOutputSize", "'", "has", "been", "reached", ",", "reducing", "decompression", "time", ".", "return", ":", "the", "number", "of", "bytes", "decoded", "in", "the", "destination", "buffer", "(", "necessarily", "<", "=", "maxOutputSize", ")", "Note", ":", "this", "number", "can", "be", "<", "'", "targetOutputSize", "'", "should", "the", "compressed", "block", "to", "decode", "be", "smaller", ".", "Always", "control", "how", "many", "bytes", "were", "decoded", ".", "If", "the", "source", "stream", "is", "malformed", ",", "the", "function", "will", "stop", "decoding", "and", "return", "a", "negative", "result", ".", "This", "function", "never", "writes", "outside", "of", "output", "buffer", ",", "and", "never", "reads", "outside", "of", "input", "buffer", ".", "It", "is", "therefore", "protected", "against", "malicious", "data", "packets", "*", "/", "int", "LZ4_decompress_safe_withPrefix64k", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "int", "LZ4_decompress_fast_withPrefix64k", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "outputSize", ")", ";", "/", "*", "*", "_withPrefix64k", "(", ")", ":", "These", "decoding", "functions", "work", "the", "same", "as", "their", "\"", "normal", "name", "\"", "versions", ",", "but", "will", "potentially", "use", "up", "to", "64KB", "of", "data", "in", "front", "of", "'", "char", "*", "dest", "'", ".", "These", "functions", "are", "used", "for", "decoding", "inter", "-", "dependant", "blocks", ".", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Stream", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "void", "*", "LZ4_create", "(", "const", "char", "*", "inputBuffer", ")", ";", "int", "LZ4_compress_continue", "(", "void", "*", "LZ4_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "int", "LZ4_compress_limitedOutput_continue", "(", "void", "*", "LZ4_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "char", "*", "LZ4_slideInputBuffer", "(", "void", "*", "LZ4_Data", ")", ";", "int", "LZ4_free", "(", "void", "*", "LZ4_Data", ")", ";", "/", "*", "These", "functions", "allow", "the", "compression", "of", "dependent", "blocks", ",", "where", "each", "block", "benefits", "from", "prior", "64", "KB", "within", "preceding", "blocks", ".", "In", "order", "to", "achieve", "this", ",", "it", "is", "necessary", "to", "start", "creating", "the", "LZ4", "Data", "Structure", ",", "thanks", "to", "the", "function", ":", "void", "*", "LZ4_create", "(", "const", "char", "*", "inputBuffer", ")", ";", "The", "result", "of", "the", "function", "is", "the", "(", "void", "*", ")", "pointer", "on", "the", "LZ4", "Data", "Structure", ".", "This", "pointer", "will", "be", "needed", "in", "all", "other", "functions", ".", "If", "the", "pointer", "returned", "is", "NULL", ",", "then", "the", "allocation", "has", "failed", ",", "and", "compression", "must", "be", "aborted", ".", "The", "only", "parameter", "'", "const", "char", "*", "inputBuffer", "'", "must", ",", "obviously", ",", "point", "at", "the", "beginning", "of", "input", "buffer", ".", "The", "input", "buffer", "must", "be", "already", "allocated", ",", "and", "size", "at", "least", "192KB", ".", "'", "inputBuffer", "'", "will", "also", "be", "the", "'", "const", "char", "*", "source", "'", "of", "the", "first", "block", ".", "All", "blocks", "are", "expected", "to", "lay", "next", "to", "each", "other", "within", "the", "input", "buffer", ",", "starting", "from", "'", "inputBuffer", "'", ".", "To", "compress", "each", "block", ",", "use", "either", "LZ4_compress_continue", "(", ")", "or", "LZ4_compress_limitedOutput_continue", "(", ").", "Their", "behavior", "are", "identical", "to", "LZ4_compress", "(", ")", "or", "LZ4_compress_limitedOutput", "(", "),", "but", "require", "the", "LZ4", "Data", "Structure", "as", "their", "first", "argument", ",", "and", "check", "that", "each", "block", "starts", "right", "after", "the", "previous", "one", ".", "If", "next", "block", "does", "not", "begin", "immediately", "after", "the", "previous", "one", ",", "the", "compression", "will", "fail", "(", "return", "0", ")", ".", "When", "it", "'", "s", "no", "longer", "possible", "to", "lay", "the", "next", "block", "after", "the", "previous", "one", "(", "not", "enough", "space", "left", "into", "input", "buffer", ")", ",", "a", "call", "to", ":", "char", "*", "LZ4_slideInputBuffer", "(", "void", "*", "LZ4_Data", ")", ";", "must", "be", "performed", ".", "It", "will", "typically", "copy", "the", "latest", "64KB", "of", "input", "at", "the", "beginning", "of", "input", "buffer", ".", "Note", "that", ",", "for", "this", "function", "to", "work", "properly", ",", "minimum", "size", "of", "an", "input", "buffer", "must", "be", "192KB", ".", "=", "=>", "The", "memory", "position", "where", "the", "next", "input", "data", "block", "must", "start", "is", "provided", "as", "the", "result", "of", "the", "function", ".", "Compression", "can", "then", "resume", ",", "using", "LZ4_compress_continue", "(", ")", "or", "LZ4_compress_limitedOutput_continue", "(", "),", "as", "usual", ".", "When", "compression", "is", "completed", ",", "a", "call", "to", "LZ4_free", "(", ")", "will", "release", "the", "memory", "used", "by", "the", "LZ4", "Data", "Structure", ".", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Obsolete", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "inline", "int", "LZ4_uncompress", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "outputSize", ")", "{", "return", "LZ4_decompress_fast", "(", "source", ",", "dest", ",", "outputSize", ")", ";", "}", "static", "inline", "int", "LZ4_uncompress_unknownOutputSize", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "isize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_decompress_safe", "(", "source", ",", "dest", ",", "isize", ",", "maxOutputSize", ")", ";", "}", "/", "*", "These", "functions", "are", "deprecated", "and", "should", "no", "longer", "be", "used", ".", "They", "are", "provided", "here", "for", "compatibility", "with", "existing", "user", "programs", ".", "*", "/", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif", "/", "*", "LZ4", "-", "Fast", "LZ", "compression", "algorithm", "Header", "File", "Copyright", "(", "C", ")", "2011", "-", "2014", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "-", "LZ4", "public", "forum", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "#!", "forum", "/", "lz4c", "*", "/", "#", "pragma", "once", "#", "if", "defined", "(", "__cplusplus", ")", "extern", "\"", "C", "\"", "{", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Version", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "LZ4_VERSION_MAJOR", "1", "/", "*", "for", "major", "interface", "/", "format", "changes", "*", "/", "#", "define", "LZ4_VERSION_MINOR", "2", "/", "*", "for", "minor", "interface", "/", "format", "changes", "*", "/", "#", "define", "LZ4_VERSION_RELEASE", "0", "/", "*", "for", "tweaks", ",", "bug", "-", "fixes", ",", "or", "development", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Tuning", "parameter", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "*", "LZ4_MEMORY_USAGE", ":", "*", "Memory", "usage", "formula", ":", "N", "-", ">", "2", "^", "N", "Bytes", "(", "examples", ":", "10", "-", ">", "1KB", ";", "12", "-", ">", "4KB", ";", "16", "-", ">", "64KB", ";", "20", "-", ">", "1MB", ";", "etc", ".", ")", "*", "Increasing", "memory", "usage", "improves", "compression", "ratio", "*", "Reduced", "memory", "usage", "can", "improve", "speed", ",", "due", "to", "cache", "effect", "*", "Default", "value", "is", "14", ",", "for", "16KB", ",", "which", "nicely", "fits", "into", "Intel", "x86", "L1", "cache", "*", "/", "#", "define", "LZ4_MEMORY_USAGE", "14", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Simple", "Functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "int", "LZ4_compress", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "int", "LZ4_decompress_safe", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "LZ4_compress", "(", ")", ":", "Compresses", "'", "inputSize", "'", "bytes", "from", "'", "source", "'", "into", "'", "dest", "'", ".", "Destination", "buffer", "must", "be", "already", "allocated", ",", "and", "must", "be", "sized", "to", "handle", "worst", "cases", "situations", "(", "input", "data", "not", "compressible", ")", "Worst", "case", "size", "evaluation", "is", "provided", "by", "function", "LZ4_compressBound", "(", ")", "inputSize", ":", "Max", "supported", "value", "is", "LZ4_MAX_INPUT_VALUE", "return", ":", "the", "number", "of", "bytes", "written", "in", "buffer", "dest", "or", "0", "if", "the", "compression", "fails", "LZ4_decompress_safe", "(", ")", ":", "compressedSize", ":", "is", "obviously", "the", "source", "size", "maxOutputSize", ":", "is", "the", "size", "of", "the", "destination", "buffer", ",", "which", "must", "be", "already", "allocated", ".", "return", ":", "the", "number", "of", "bytes", "decoded", "in", "the", "destination", "buffer", "(", "necessarily", "<", "=", "maxOutputSize", ")", "If", "the", "destination", "buffer", "is", "not", "large", "enough", ",", "decoding", "will", "stop", "and", "output", "an", "error", "code", "(", "<", "0", ")", ".", "If", "the", "source", "stream", "is", "detected", "malformed", ",", "the", "function", "will", "stop", "decoding", "and", "return", "a", "negative", "result", ".", "This", "function", "is", "protected", "against", "buffer", "overflow", "exploits", ":", "it", "never", "writes", "outside", "of", "output", "buffer", ",", "and", "never", "reads", "outside", "of", "input", "buffer", ".", "Therefore", ",", "it", "is", "protected", "against", "malicious", "data", "packets", ".", "*", "/", "/", "*", "Note", ":", "Should", "you", "prefer", "to", "explicitly", "allocate", "compression", "-", "table", "memory", "using", "your", "own", "allocation", "method", ",", "use", "the", "streaming", "functions", "provided", "below", ",", "simply", "reset", "the", "memory", "area", "between", "each", "call", "to", "LZ4_compress_continue", "(", ")", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Advanced", "Functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "LZ4_MAX_INPUT_SIZE", "0x7E000000", "/", "*", "2", "113", "929", "216", "bytes", "*", "/", "#", "define", "LZ4_COMPRESSBOUND", "(", "isize", ")", "(", "(", "unsigned", "int", ")", "(", "isize", ")", ">", "(", "unsigned", "int", ")", "LZ4_MAX_INPUT_SIZE", "?", "0", ":", "(", "isize", ")", "+", "(", "(", "isize", ")", "/", "255", ")", "+", "16", ")", "/", "*", "LZ4_compressBound", "(", ")", ":", "Provides", "the", "maximum", "size", "that", "LZ4", "may", "output", "in", "a", "\"", "worst", "case", "\"", "scenario", "(", "input", "data", "not", "compressible", ")", "primarily", "useful", "for", "memory", "allocation", "of", "output", "buffer", ".", "macro", "is", "also", "provided", "when", "result", "needs", "to", "be", "evaluated", "at", "compilation", "(", "such", "as", "stack", "memory", "allocation", ")", ".", "isize", ":", "is", "the", "input", "size", ".", "Max", "supported", "value", "is", "LZ4_MAX_INPUT_SIZE", "return", ":", "maximum", "output", "size", "in", "a", "\"", "worst", "case", "\"", "scenario", "or", "0", ",", "if", "input", "size", "is", "too", "large", "(", ">", "LZ4_MAX_INPUT_SIZE", ")", "*", "/", "int", "LZ4_compressBound", "(", "int", "isize", ")", ";", "/", "*", "LZ4_compress_limitedOutput", "(", ")", ":", "Compress", "'", "inputSize", "'", "bytes", "from", "'", "source", "'", "into", "an", "output", "buffer", "'", "dest", "'", "of", "maximum", "size", "'", "maxOutputSize", "'", ".", "If", "it", "cannot", "achieve", "it", ",", "compression", "will", "stop", ",", "and", "result", "of", "the", "function", "will", "be", "zero", ".", "This", "function", "never", "writes", "outside", "of", "provided", "output", "buffer", ".", "inputSize", ":", "Max", "supported", "value", "is", "LZ4_MAX_INPUT_VALUE", "maxOutputSize", ":", "is", "the", "size", "of", "the", "destination", "buffer", "(", "which", "must", "be", "already", "allocated", ")", "return", ":", "the", "number", "of", "bytes", "written", "in", "buffer", "'", "dest", "'", "or", "0", "if", "the", "compression", "fails", "*", "/", "int", "LZ4_compress_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "LZ4_decompress_fast", "(", ")", ":", "originalSize", ":", "is", "the", "original", "and", "therefore", "uncompressed", "size", "return", ":", "the", "number", "of", "bytes", "read", "from", "the", "source", "buffer", "(", "in", "other", "words", ",", "the", "compressed", "size", ")", "If", "the", "source", "stream", "is", "malformed", ",", "the", "function", "will", "stop", "decoding", "and", "return", "a", "negative", "result", ".", "Destination", "buffer", "must", "be", "already", "allocated", ".", "Its", "size", "must", "be", "a", "minimum", "of", "'", "originalSize", "'", "bytes", ".", "note", ":", "This", "function", "is", "a", "bit", "faster", "than", "LZ4_decompress_safe", "(", ")", "It", "provides", "fast", "decompression", "and", "fully", "respect", "memory", "boundaries", "for", "properly", "formed", "compressed", "data", ".", "It", "does", "not", "provide", "full", "protection", "against", "intentionnally", "modified", "data", "stream", ".", "Use", "this", "function", "in", "a", "trusted", "environment", "(", "data", "to", "decode", "comes", "from", "a", "trusted", "source", ")", ".", "*", "/", "int", "LZ4_decompress_fast", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "originalSize", ")", ";", "/", "*", "LZ4_decompress_safe_partial", "(", ")", ":", "This", "function", "decompress", "a", "compressed", "block", "of", "size", "'", "compressedSize", "'", "at", "position", "'", "source", "'", "into", "output", "buffer", "'", "dest", "'", "of", "size", "'", "maxOutputSize", "'", ".", "The", "function", "tries", "to", "stop", "decompressing", "operation", "as", "soon", "as", "'", "targetOutputSize", "'", "has", "been", "reached", ",", "reducing", "decompression", "time", ".", "return", ":", "the", "number", "of", "bytes", "decoded", "in", "the", "destination", "buffer", "(", "necessarily", "<", "=", "maxOutputSize", ")", "Note", ":", "this", "number", "can", "be", "<", "'", "targetOutputSize", "'", "should", "the", "compressed", "block", "to", "decode", "be", "smaller", ".", "Always", "control", "how", "many", "bytes", "were", "decoded", ".", "If", "the", "source", "stream", "is", "detected", "malformed", ",", "the", "function", "will", "stop", "decoding", "and", "return", "a", "negative", "result", ".", "This", "function", "never", "writes", "outside", "of", "output", "buffer", ",", "and", "never", "reads", "outside", "of", "input", "buffer", ".", "It", "is", "therefore", "protected", "against", "malicious", "data", "packets", "*", "/", "int", "LZ4_decompress_safe_partial", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "targetOutputSize", ",", "int", "maxOutputSize", ")", ";", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Experimental", "Streaming", "Compression", "Functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "#", "define", "LZ4_STREAMSIZE_U32", "(", "(", "1", "<", "<", "(", "LZ4_MEMORY_USAGE", "-", "2", ")", ")", "+", "8", ")", "#", "define", "LZ4_STREAMSIZE", "(", "LZ4_STREAMSIZE_U32", "*", "sizeof", "(", "unsigned", "int", ")", ")", "/", "*", "*", "LZ4_stream_t", "*", "information", "structure", "to", "track", "an", "LZ4", "stream", ".", "*", "important", ":", "set", "this", "structure", "content", "to", "zero", "before", "first", "use", "!", "*", "/", "typedef", "struct", "{", "unsigned", "int", "table", "[", "LZ4_STREAMSIZE_U32", "]", ";", "}", "LZ4_stream_t", ";", "/", "*", "*", "If", "you", "prefer", "dynamic", "allocation", "methods", ",", "*", "LZ4_createStream", "*", "provides", "a", "pointer", "(", "void", "*", ")", "towards", "an", "initialized", "LZ4_stream_t", "structure", ".", "*", "LZ4_free", "just", "frees", "it", ".", "*", "/", "void", "*", "LZ4_createStream", "(", ");", "int", "LZ4_free", "(", "void", "*", "LZ4_stream", ")", ";", "/", "*", "*", "LZ4_loadDict", "*", "Use", "this", "function", "to", "load", "a", "static", "dictionary", "into", "LZ4_stream", ".", "*", "Any", "previous", "data", "will", "be", "forgotten", ",", "only", "'", "dictionary", "'", "will", "remain", "in", "memory", ".", "*", "Loading", "a", "size", "of", "0", "is", "allowed", "(", "same", "effect", "as", "init", ")", ".", "*", "Return", ":", "1", "if", "OK", ",", "0", "if", "error", "*", "/", "int", "LZ4_loadDict", "(", "void", "*", "LZ4_stream", ",", "const", "char", "*", "dictionary", ",", "int", "dictSize", ")", ";", "/", "*", "*", "LZ4_compress_continue", "*", "Compress", "data", "block", "'", "source", "'", ",", "using", "blocks", "compressed", "before", "as", "dictionary", "to", "improve", "compression", "ratio", "*", "Previous", "data", "blocks", "are", "assumed", "to", "still", "be", "present", "at", "their", "previous", "location", ".", "*", "/", "int", "LZ4_compress_continue", "(", "void", "*", "LZ4_stream", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "/", "*", "*", "LZ4_compress_limitedOutput_continue", "*", "Same", "as", "before", ",", "but", "also", "specify", "a", "maximum", "target", "compressed", "size", "(", "maxOutputSize", ")", "*", "If", "objective", "cannot", "be", "met", ",", "compression", "exits", ",", "and", "returns", "a", "zero", ".", "*", "/", "int", "LZ4_compress_limitedOutput_continue", "(", "void", "*", "LZ4_stream", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "*", "LZ4_saveDict", "*", "If", "previously", "compressed", "data", "block", "is", "not", "guaranteed", "to", "remain", "at", "its", "previous", "memory", "location", "*", "save", "it", "into", "a", "safe", "place", "(", "char", "*", "safeBuffer", ")", "*", "Note", ":", "you", "don", "'", "t", "need", "to", "call", "LZ4_loadDict", "(", ")", "afterwards", ",", "*", "dictionary", "is", "immediately", "usable", ",", "you", "can", "therefore", "call", "again", "LZ4_compress_continue", "(", ")", "*", "Return", ":", "1", "if", "OK", ",", "0", "if", "error", "*", "Note", ":", "any", "dictSize", ">", "64", "KB", "will", "be", "interpreted", "as", "64KB", ".", "*", "/", "int", "LZ4_saveDict", "(", "void", "*", "LZ4_stream", ",", "char", "*", "safeBuffer", ",", "int", "dictSize", ")", ";", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Experimental", "Streaming", "Decompression", "Functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "LZ4_STREAMDECODESIZE_U32", "4", "#", "define", "LZ4_STREAMDECODESIZE", "(", "LZ4_STREAMDECODESIZE_U32", "*", "sizeof", "(", "unsigned", "int", ")", ")", "/", "*", "*", "LZ4_streamDecode_t", "*", "information", "structure", "to", "track", "an", "LZ4", "stream", ".", "*", "important", ":", "set", "this", "structure", "content", "to", "zero", "before", "first", "use", "!", "*", "/", "typedef", "struct", "{", "unsigned", "int", "table", "[", "LZ4_STREAMDECODESIZE_U32", "]", ";", "}", "LZ4_streamDecode_t", ";", "/", "*", "*", "If", "you", "prefer", "dynamic", "allocation", "methods", ",", "*", "LZ4_createStreamDecode", "(", ")", "*", "provides", "a", "pointer", "(", "void", "*", ")", "towards", "an", "initialized", "LZ4_streamDecode_t", "structure", ".", "*", "LZ4_free", "just", "frees", "it", ".", "*", "/", "void", "*", "LZ4_createStreamDecode", "(", ");", "int", "LZ4_free", "(", "void", "*", "LZ4_stream", ")", ";", "/", "*", "yes", ",", "it", "'", "s", "the", "same", "one", "as", "for", "compression", "*", "/", "/", "*", "*", "_continue", "(", ")", ":", "These", "decoding", "functions", "allow", "decompression", "of", "multiple", "blocks", "in", "\"", "streaming", "\"", "mode", ".", "Previously", "decoded", "blocks", "must", "still", "be", "available", "at", "the", "memory", "position", "where", "they", "were", "decoded", ".", "If", "it", "'", "s", "not", "possible", ",", "save", "the", "relevant", "part", "of", "decoded", "data", "into", "a", "safe", "buffer", ",", "and", "indicate", "where", "it", "stands", "using", "LZ4_setDictDecode", "(", ")", "*", "/", "int", "LZ4_decompress_safe_continue", "(", "void", "*", "LZ4_streamDecode", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "maxOutputSize", ")", ";", "int", "LZ4_decompress_fast_continue", "(", "void", "*", "LZ4_streamDecode", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "originalSize", ")", ";", "/", "*", "*", "LZ4_setDictDecode", "*", "Use", "this", "function", "to", "instruct", "where", "to", "find", "the", "dictionary", ".", "*", "This", "function", "can", "be", "used", "to", "specify", "a", "static", "dictionary", ",", "*", "or", "to", "instruct", "where", "to", "find", "some", "previously", "decoded", "data", "saved", "into", "a", "different", "memory", "space", ".", "*", "Setting", "a", "size", "of", "0", "is", "allowed", "(", "same", "effect", "as", "no", "dictionary", ")", ".", "*", "Return", ":", "1", "if", "OK", ",", "0", "if", "error", "*", "/", "int", "LZ4_setDictDecode", "(", "void", "*", "LZ4_streamDecode", ",", "const", "char", "*", "dictionary", ",", "int", "dictSize", ")", ";", "/", "*", "Advanced", "decoding", "functions", ":", "*", "_usingDict", "(", ")", ":", "These", "decoding", "functions", "work", "the", "same", "as", "a", "combination", "of", "LZ4_setDictDecode", "(", ")", "followed", "by", "LZ4_decompress_x_continue", "(", ")", "all", "together", "into", "a", "single", "function", "call", ".", "It", "doesn", "'", "t", "use", "nor", "update", "an", "LZ4_streamDecode_t", "structure", ".", "*", "/", "int", "LZ4_decompress_safe_usingDict", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "maxOutputSize", ",", "const", "char", "*", "dictStart", ",", "int", "dictSize", ")", ";", "int", "LZ4_decompress_fast_usingDict", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "originalSize", ",", "const", "char", "*", "dictStart", ",", "int", "dictSize", ")", ";", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Obsolete", "Functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "Obsolete", "decompression", "functions", "These", "function", "names", "are", "deprecated", "and", "should", "no", "longer", "be", "used", ".", "They", "are", "only", "provided", "here", "for", "compatibility", "with", "older", "user", "programs", ".", "-", "LZ4_uncompress", "is", "the", "same", "as", "LZ4_decompress_fast", "-", "LZ4_uncompress_unknownOutputSize", "is", "the", "same", "as", "LZ4_decompress_safe", "*", "/", "int", "LZ4_uncompress", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "outputSize", ")", ";", "int", "LZ4_uncompress_unknownOutputSize", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "isize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "Obsolete", "functions", "for", "externally", "allocated", "state", ";", "use", "streaming", "interface", "instead", "*", "/", "int", "LZ4_sizeofState", "(", "void", ")", ";", "int", "LZ4_compress_withState", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "int", "LZ4_compress_limitedOutput_withState", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "Obsolete", "streaming", "functions", ";", "use", "new", "streaming", "interface", "whenever", "possible", "*", "/", "void", "*", "LZ4_create", "(", "const", "char", "*", "inputBuffer", ")", ";", "int", "LZ4_sizeofStreamState", "(", "void", ")", ";", "int", "LZ4_resetStreamState", "(", "void", "*", "state", ",", "const", "char", "*", "inputBuffer", ")", ";", "char", "*", "LZ4_slideInputBuffer", "(", "void", "*", "state", ")", ";", "/", "*", "Obsolete", "streaming", "decoding", "functions", "*", "/", "int", "LZ4_decompress_safe_withPrefix64k", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "compressedSize", ",", "int", "maxOutputSize", ")", ";", "int", "LZ4_decompress_fast_withPrefix64k", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "originalSize", ")", ";", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif", "@", "@", "-", "1", ",", "120", "+", "1", ",", "120", "@", "@", "LZ4", "Format", "Description", "Last", "revised", ":", "2012", "-", "02", "-", "27", "Author", ":", "Y", ".", "Collet", "This", "small", "specification", "intents", "to", "provide", "enough", "information", "to", "anyone", "willing", "to", "produce", "LZ4", "-", "compatible", "compressed", "data", "blocks", "using", "any", "programming", "language", ".", "LZ4", "is", "an", "LZ77", "-", "type", "compressor", "with", "a", "fixed", ",", "byte", "-", "oriented", "encoding", ".", "The", "most", "important", "design", "principle", "behind", "LZ4", "is", "simplicity", ".", "It", "helps", "to", "create", "an", "easy", "to", "read", "and", "maintain", "source", "code", ".", "It", "also", "helps", "later", "on", "for", "optimisations", ",", "compactness", ",", "and", "speed", ".", "There", "is", "no", "entropy", "encoder", "backend", "nor", "framing", "layer", ".", "The", "latter", "is", "assumed", "to", "be", "handled", "by", "other", "parts", "of", "the", "system", ".", "This", "document", "only", "describes", "the", "format", ",", "not", "how", "the", "LZ4", "compressor", "nor", "decompressor", "actually", "work", ".", "The", "correctness", "of", "the", "decompressor", "should", "not", "depend", "on", "implementation", "details", "of", "the", "compressor", ",", "and", "vice", "versa", ".", "Compressed", "block", "format", "-", "-", "An", "LZ4", "compressed", "block", "is", "composed", "of", "sequences", ".", "Schematically", ",", "a", "sequence", "is", "a", "suite", "of", "literals", ",", "followed", "by", "a", "match", "copy", ".", "Each", "sequence", "starts", "with", "a", "token", ".", "The", "token", "is", "a", "one", "byte", "value", ",", "separated", "into", "two", "4", "-", "bits", "fields", ".", "Therefore", "each", "field", "ranges", "from", "0", "to", "15", ".", "The", "first", "field", "uses", "the", "4", "high", "-", "bits", "of", "the", "token", ".", "It", "provides", "the", "length", "of", "literals", "to", "follow", ".", "(", "Note", ":", "a", "literal", "is", "a", "not", "-", "compressed", "byte", ")", ".", "If", "the", "field", "value", "is", "0", ",", "then", "there", "is", "no", "literal", ".", "If", "it", "is", "15", ",", "then", "we", "need", "to", "add", "some", "more", "bytes", "to", "indicate", "the", "full", "length", ".", "Each", "additionnal", "byte", "then", "represent", "a", "value", "from", "0", "to", "255", ",", "which", "is", "added", "to", "the", "previous", "value", "to", "produce", "a", "total", "length", ".", "When", "the", "byte", "value", "is", "255", ",", "another", "byte", "is", "output", ".", "There", "can", "be", "any", "number", "of", "bytes", "following", "the", "token", ".", "There", "is", "no", "\"", "size", "limit", "\"", ".", "(", "Sidenote", "this", "is", "why", "a", "not", "-", "compressible", "input", "block", "is", "expanded", "by", "0", ".", "4", "%", ").", "Example", "1", ":", "A", "length", "of", "48", "will", "be", "represented", "as", ":", "15", ":", "value", "for", "the", "4", "-", "bits", "High", "field", "33", ":", "(", "=", "48", "-", "15", ")", "remaining", "length", "to", "reach", "48", "Example", "2", ":", "A", "length", "of", "280", "will", "be", "represented", "as", ":", "15", ":", "value", "for", "the", "4", "-", "bits", "High", "field", "255", ":", "following", "byte", "is", "maxed", ",", "since", "280", "-", "15", ">", "=", "255", "10", ":", "(", "=", "280", "-", "15", "-", "255", ")", ")", "remaining", "length", "to", "reach", "280", "Example", "3", ":", "A", "length", "of", "15", "will", "be", "represented", "as", ":", "15", ":", "value", "for", "the", "4", "-", "bits", "High", "field", "0", ":", "(", "=", "15", "-", "15", ")", "yes", ",", "the", "zero", "must", "be", "output", "Following", "the", "token", "and", "optional", "length", "bytes", ",", "are", "the", "literals", "themselves", ".", "They", "are", "exactly", "as", "numerous", "as", "previously", "decoded", "(", "length", "of", "literals", ")", ".", "It", "'", "s", "possible", "that", "there", "are", "zero", "literal", ".", "Following", "the", "literals", "is", "the", "match", "copy", "operation", ".", "It", "starts", "by", "the", "offset", ".", "This", "is", "a", "2", "bytes", "value", ",", "in", "little", "endian", "format", ".", "The", "offset", "represents", "the", "position", "of", "the", "match", "to", "be", "copied", "from", ".", "1", "means", "\"", "current", "position", "-", "1", "byte", "\"", ".", "The", "maximum", "offset", "value", "is", "65535", ",", "65536", "cannot", "be", "coded", ".", "Note", "that", "0", "is", "an", "invalid", "value", ",", "not", "used", ".", "Then", "we", "need", "to", "extract", "the", "match", "length", ".", "For", "this", ",", "we", "use", "the", "second", "token", "field", ",", "the", "low", "4", "-", "bits", ".", "Value", ",", "obviously", ",", "ranges", "from", "0", "to", "15", ".", "However", "here", ",", "0", "means", "that", "the", "copy", "operation", "will", "be", "minimal", ".", "The", "minimum", "length", "of", "a", "match", ",", "called", "minmatch", ",", "is", "4", ".", "As", "a", "consequence", ",", "a", "0", "value", "means", "4", "bytes", ",", "and", "a", "value", "of", "15", "means", "19", "+", "bytes", ".", "Similar", "to", "literal", "length", ",", "on", "reaching", "the", "highest", "possible", "value", "(", "15", ")", ",", "we", "output", "additional", "bytes", ",", "one", "at", "a", "time", ",", "with", "values", "ranging", "from", "0", "to", "255", ".", "They", "are", "added", "to", "total", "to", "provide", "the", "final", "match", "length", ".", "A", "255", "value", "means", "there", "is", "another", "byte", "to", "read", "and", "add", ".", "There", "is", "no", "limit", "to", "the", "number", "of", "optional", "bytes", "that", "can", "be", "output", "this", "way", ".", "(", "This", "points", "towards", "a", "maximum", "achievable", "compression", "ratio", "of", "~", "250", ")", ".", "With", "the", "offset", "and", "the", "matchlength", ",", "the", "decoder", "can", "now", "proceed", "to", "copy", "the", "data", "from", "the", "already", "decoded", "buffer", ".", "On", "decoding", "the", "matchlength", ",", "we", "reach", "the", "end", "of", "the", "compressed", "sequence", ",", "and", "therefore", "start", "another", "one", ".", "Parsing", "restrictions", "-", "-", "There", "are", "specific", "parsing", "rules", "to", "respect", "in", "order", "to", "remain", "compatible", "with", "assumptions", "made", "by", "the", "decoder", ":", "1", ")", "The", "last", "5", "bytes", "are", "always", "literals", "2", ")", "The", "last", "match", "must", "start", "at", "least", "12", "bytes", "before", "end", "of", "block", "Consequently", ",", "a", "block", "with", "less", "than", "13", "bytes", "cannot", "be", "compressed", ".", "These", "rules", "are", "in", "place", "to", "ensure", "that", "the", "decoder", "will", "never", "read", "beyond", "the", "input", "buffer", ",", "nor", "write", "beyond", "the", "output", "buffer", ".", "Note", "that", "the", "last", "sequence", "is", "also", "incomplete", ",", "and", "stops", "right", "after", "literals", ".", "Additional", "notes", "-", "-", "There", "is", "no", "assumption", "nor", "limits", "to", "the", "way", "the", "compressor", "searches", "and", "selects", "matches", "within", "the", "source", "data", "block", ".", "It", "could", "be", "a", "fast", "scan", ",", "a", "multi", "-", "probe", ",", "a", "full", "search", "using", "BST", ",", "standard", "hash", "chains", "or", "MMC", ",", "well", "whatever", ".", "Advanced", "parsing", "strategies", "can", "also", "be", "implemented", ",", "such", "as", "lazy", "match", ",", "or", "full", "optimal", "parsing", ".", "All", "these", "trade", "-", "off", "offer", "distinctive", "speed", "/", "memory", "/", "compression", "advantages", ".", "Whatever", "the", "method", "used", "by", "the", "compressor", ",", "its", "result", "will", "be", "decodable", "by", "any", "LZ4", "decoder", "if", "it", "follows", "the", "format", "specification", "described", "above", ".", "LZ4", "Format", "Description", "Last", "revised", ":", "2012", "-", "02", "-", "27", "Author", ":", "Y", ".", "Collet", "This", "small", "specification", "intents", "to", "provide", "enough", "information", "to", "anyone", "willing", "to", "produce", "LZ4", "-", "compatible", "compressed", "data", "blocks", "using", "any", "programming", "language", ".", "LZ4", "is", "an", "LZ77", "-", "type", "compressor", "with", "a", "fixed", ",", "byte", "-", "oriented", "encoding", ".", "The", "most", "important", "design", "principle", "behind", "LZ4", "is", "simplicity", ".", "It", "helps", "to", "create", "an", "easy", "to", "read", "and", "maintain", "source", "code", ".", "It", "also", "helps", "later", "on", "for", "optimisations", ",", "compactness", ",", "and", "speed", ".", "There", "is", "no", "entropy", "encoder", "backend", "nor", "framing", "layer", ".", "The", "latter", "is", "assumed", "to", "be", "handled", "by", "other", "parts", "of", "the", "system", ".", "This", "document", "only", "describes", "the", "format", ",", "not", "how", "the", "LZ4", "compressor", "nor", "decompressor", "actually", "work", ".", "The", "correctness", "of", "the", "decompressor", "should", "not", "depend", "on", "implementation", "details", "of", "the", "compressor", ",", "and", "vice", "versa", ".", "-", "-", "Compressed", "block", "format", "-", "-", "An", "LZ4", "compressed", "block", "is", "composed", "of", "sequences", ".", "Schematically", ",", "a", "sequence", "is", "a", "suite", "of", "literals", ",", "followed", "by", "a", "match", "copy", ".", "Each", "sequence", "starts", "with", "a", "token", ".", "The", "token", "is", "a", "one", "byte", "value", ",", "separated", "into", "two", "4", "-", "bits", "fields", ".", "Therefore", "each", "field", "ranges", "from", "0", "to", "15", ".", "The", "first", "field", "uses", "the", "4", "high", "-", "bits", "of", "the", "token", ".", "It", "provides", "the", "length", "of", "literals", "to", "follow", ".", "(", "Note", ":", "a", "literal", "is", "a", "not", "-", "compressed", "byte", ")", ".", "If", "the", "field", "value", "is", "0", ",", "then", "there", "is", "no", "literal", ".", "If", "it", "is", "15", ",", "then", "we", "need", "to", "add", "some", "more", "bytes", "to", "indicate", "the", "full", "length", ".", "Each", "additionnal", "byte", "then", "represent", "a", "value", "from", "0", "to", "255", ",", "which", "is", "added", "to", "the", "previous", "value", "to", "produce", "a", "total", "length", ".", "When", "the", "byte", "value", "is", "255", ",", "another", "byte", "is", "output", ".", "There", "can", "be", "any", "number", "of", "bytes", "following", "the", "token", ".", "There", "is", "no", "\"", "size", "limit", "\"", ".", "(", "Sidenote", "this", "is", "why", "a", "not", "-", "compressible", "input", "block", "is", "expanded", "by", "0", ".", "4", "%", ").", "Example", "1", ":", "A", "length", "of", "48", "will", "be", "represented", "as", ":", "-", "15", ":", "value", "for", "the", "4", "-", "bits", "High", "field", "-", "33", ":", "(", "=", "48", "-", "15", ")", "remaining", "length", "to", "reach", "48", "Example", "2", ":", "A", "length", "of", "280", "will", "be", "represented", "as", ":", "-", "15", ":", "value", "for", "the", "4", "-", "bits", "High", "field", "-", "255", ":", "following", "byte", "is", "maxed", ",", "since", "280", "-", "15", ">", "=", "255", "-", "10", ":", "(", "=", "280", "-", "15", "-", "255", ")", ")", "remaining", "length", "to", "reach", "280", "Example", "3", ":", "A", "length", "of", "15", "will", "be", "represented", "as", ":", "-", "15", ":", "value", "for", "the", "4", "-", "bits", "High", "field", "-", "0", ":", "(", "=", "15", "-", "15", ")", "yes", ",", "the", "zero", "must", "be", "output", "Following", "the", "token", "and", "optional", "length", "bytes", ",", "are", "the", "literals", "themselves", ".", "They", "are", "exactly", "as", "numerous", "as", "previously", "decoded", "(", "length", "of", "literals", ")", ".", "It", "'", "s", "possible", "that", "there", "are", "zero", "literal", ".", "Following", "the", "literals", "is", "the", "match", "copy", "operation", ".", "It", "starts", "by", "the", "offset", ".", "This", "is", "a", "2", "bytes", "value", ",", "in", "little", "endian", "format", ".", "The", "offset", "represents", "the", "position", "of", "the", "match", "to", "be", "copied", "from", ".", "1", "means", "\"", "current", "position", "-", "1", "byte", "\"", ".", "The", "maximum", "offset", "value", "is", "65535", ",", "65536", "cannot", "be", "coded", ".", "Note", "that", "0", "is", "an", "invalid", "value", ",", "not", "used", ".", "Then", "we", "need", "to", "extract", "the", "match", "length", ".", "For", "this", ",", "we", "use", "the", "second", "token", "field", ",", "the", "low", "4", "-", "bits", ".", "Value", ",", "obviously", ",", "ranges", "from", "0", "to", "15", ".", "However", "here", ",", "0", "means", "that", "the", "copy", "operation", "will", "be", "minimal", ".", "The", "minimum", "length", "of", "a", "match", ",", "called", "minmatch", ",", "is", "4", ".", "As", "a", "consequence", ",", "a", "0", "value", "means", "4", "bytes", ",", "and", "a", "value", "of", "15", "means", "19", "+", "bytes", ".", "Similar", "to", "literal", "length", ",", "on", "reaching", "the", "highest", "possible", "value", "(", "15", ")", ",", "we", "output", "additional", "bytes", ",", "one", "at", "a", "time", ",", "with", "values", "ranging", "from", "0", "to", "255", ".", "They", "are", "added", "to", "total", "to", "provide", "the", "final", "match", "length", ".", "A", "255", "value", "means", "there", "is", "another", "byte", "to", "read", "and", "add", ".", "There", "is", "no", "limit", "to", "the", "number", "of", "optional", "bytes", "that", "can", "be", "output", "this", "way", ".", "(", "This", "points", "towards", "a", "maximum", "achievable", "compression", "ratio", "of", "~", "250", ")", ".", "With", "the", "offset", "and", "the", "matchlength", ",", "the", "decoder", "can", "now", "proceed", "to", "copy", "the", "data", "from", "the", "already", "decoded", "buffer", ".", "On", "decoding", "the", "matchlength", ",", "we", "reach", "the", "end", "of", "the", "compressed", "sequence", ",", "and", "therefore", "start", "another", "one", ".", "-", "-", "Parsing", "restrictions", "-", "-", "There", "are", "specific", "parsing", "rules", "to", "respect", "in", "order", "to", "remain", "compatible", "with", "assumptions", "made", "by", "the", "decoder", ":", "1", ")", "The", "last", "5", "bytes", "are", "always", "literals", "2", ")", "The", "last", "match", "must", "start", "at", "least", "12", "bytes", "before", "end", "of", "block", "Consequently", ",", "a", "block", "with", "less", "than", "13", "bytes", "cannot", "be", "compressed", ".", "These", "rules", "are", "in", "place", "to", "ensure", "that", "the", "decoder", "will", "never", "read", "beyond", "the", "input", "buffer", ",", "nor", "write", "beyond", "the", "output", "buffer", ".", "Note", "that", "the", "last", "sequence", "is", "also", "incomplete", ",", "and", "stops", "right", "after", "literals", ".", "-", "-", "Additional", "notes", "-", "-", "There", "is", "no", "assumption", "nor", "limits", "to", "the", "way", "the", "compressor", "searches", "and", "selects", "matches", "within", "the", "source", "data", "block", ".", "It", "could", "be", "a", "fast", "scan", ",", "a", "multi", "-", "probe", ",", "a", "full", "search", "using", "BST", ",", "standard", "hash", "chains", "or", "MMC", ",", "well", "whatever", ".", "Advanced", "parsing", "strategies", "can", "also", "be", "implemented", ",", "such", "as", "lazy", "match", ",", "or", "full", "optimal", "parsing", ".", "All", "these", "trade", "-", "off", "offer", "distinctive", "speed", "/", "memory", "/", "compression", "advantages", ".", "Whatever", "the", "method", "used", "by", "the", "compressor", ",", "its", "result", "will", "be", "decodable", "by", "any", "LZ4", "decoder", "if", "it", "follows", "the", "format", "specification", "described", "above", ".", "@", "@", "-", "1", ",", "817", "+", "1", ",", "892", "@", "@", "/", "*", "LZ4", "HC", "-", "High", "Compression", "Mode", "of", "LZ4", "Copyright", "(", "C", ")", "2011", "-", "2013", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Memory", "routines", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "calloc", ",", "free", "#", "define", "ALLOCATOR", "(", "s", ")", "calloc", "(", "1", ",", "s", ")", "#", "define", "FREEMEM", "free", "#", "include", "<", "string", ".", "h", ">", "/", "/", "memset", ",", "memcpy", "#", "define", "MEM_INIT", "memset", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "CPU", "Feature", "Detection", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "32", "or", "64", "bits", "?", "#", "if", "(", "defined", "(", "__x86_64__", ")", "|", "|", "defined", "(", "_M_X64", ")", "|", "|", "defined", "(", "_WIN64", ")", "\\", "|", "|", "defined", "(", "__powerpc64__", ")", "|", "|", "defined", "(", "__ppc64__", ")", "|", "|", "defined", "(", "__PPC64__", ")", "\\", "|", "|", "defined", "(", "__64BIT__", ")", "|", "|", "defined", "(", "_LP64", ")", "|", "|", "defined", "(", "__LP64__", ")", "\\", "|", "|", "defined", "(", "__ia64", ")", "|", "|", "defined", "(", "__itanium__", ")", "|", "|", "defined", "(", "_M_IA64", ")", ")", "/", "/", "Detects", "64", "bits", "mode", "#", "define", "LZ4_ARCH64", "1", "#", "else", "#", "define", "LZ4_ARCH64", "0", "#", "endif", "/", "/", "Little", "Endian", "or", "Big", "Endian", "?", "/", "/", "Overwrite", "the", "#", "define", "below", "if", "you", "know", "your", "architecture", "endianess", "#", "if", "defined", "(", "__GLIBC__", ")", "#", "include", "<", "endian", ".", "h", ">", "#", "if", "(", "__BYTE_ORDER", "=", "=", "__BIG_ENDIAN", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "endif", "#", "elif", "(", "defined", "(", "__BIG_ENDIAN__", ")", "|", "|", "defined", "(", "__BIG_ENDIAN", ")", "|", "|", "defined", "(", "_BIG_ENDIAN", ")", ")", "&", "&", "!", "(", "defined", "(", "__LITTLE_ENDIAN__", ")", "|", "|", "defined", "(", "__LITTLE_ENDIAN", ")", "|", "|", "defined", "(", "_LITTLE_ENDIAN", ")", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "elif", "defined", "(", "__sparc", ")", "|", "|", "defined", "(", "__sparc__", ")", "\\", "|", "|", "defined", "(", "__powerpc__", ")", "|", "|", "defined", "(", "__ppc__", ")", "|", "|", "defined", "(", "__PPC__", ")", "\\", "|", "|", "defined", "(", "__hpux", ")", "|", "|", "defined", "(", "__hppa", ")", "\\", "|", "|", "defined", "(", "_MIPSEB", ")", "|", "|", "defined", "(", "__s390__", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "else", "/", "/", "Little", "Endian", "assumed", ".", "PDP", "Endian", "and", "other", "very", "rare", "endian", "format", "are", "unsupported", ".", "#", "endif", "/", "/", "Unaligned", "memory", "access", "is", "automatically", "enabled", "for", "\"", "common", "\"", "CPU", ",", "such", "as", "x86", ".", "/", "/", "For", "others", "CPU", ",", "the", "compiler", "will", "be", "more", "cautious", ",", "and", "insert", "extra", "code", "to", "ensure", "aligned", "access", "is", "respected", "/", "/", "If", "you", "know", "your", "target", "CPU", "supports", "unaligned", "memory", "access", ",", "you", "want", "to", "force", "this", "option", "manually", "to", "improve", "performance", "#", "if", "defined", "(", "__ARM_FEATURE_UNALIGNED", ")", "#", "define", "LZ4_FORCE_UNALIGNED_ACCESS", "1", "#", "endif", "/", "/", "Define", "this", "parameter", "if", "your", "target", "system", "or", "compiler", "does", "not", "support", "hardware", "bit", "count", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "defined", "(", "_WIN32_WCE", ")", "/", "/", "Visual", "Studio", "for", "Windows", "CE", "does", "not", "support", "Hardware", "bit", "count", "#", "define", "LZ4_FORCE_SW_BITCOUNT", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "/", "*", "\"", "restrict", "\"", "is", "a", "known", "keyword", "*", "/", "#", "else", "#", "define", "restrict", "/", "/", "Disable", "restrict", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "define", "FORCE_INLINE", "static", "__forceinline", "#", "include", "<", "intrin", ".", "h", ">", "/", "/", "For", "Visual", "2005", "#", "if", "LZ4_ARCH64", "/", "/", "64", "-", "bits", "#", "pragma", "intrinsic", "(", "_BitScanForward64", ")", "/", "/", "For", "Visual", "2005", "#", "pragma", "intrinsic", "(", "_BitScanReverse64", ")", "/", "/", "For", "Visual", "2005", "#", "else", "/", "/", "32", "-", "bits", "#", "pragma", "intrinsic", "(", "_BitScanForward", ")", "/", "/", "For", "Visual", "2005", "#", "pragma", "intrinsic", "(", "_BitScanReverse", ")", "/", "/", "For", "Visual", "2005", "#", "endif", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "/", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "#", "pragma", "warning", "(", "disable", ":", "4701", ")", "/", "/", "disable", ":", "C4701", ":", "potentially", "uninitialized", "local", "variable", "used", "#", "else", "#", "ifdef", "__GNUC__", "#", "define", "FORCE_INLINE", "static", "inline", "__attribute__", "(", "(", "always_inline", ")", ")", "#", "else", "#", "define", "FORCE_INLINE", "static", "inline", "#", "endif", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "define", "lz4_bswap16", "(", "x", ")", "_byteswap_ushort", "(", "x", ")", "#", "else", "#", "define", "lz4_bswap16", "(", "x", ")", "(", "(", "unsigned", "short", "int", ")", "(", "((", "(", "x", ")", ">", ">", "8", ")", "&", "0xffu", ")", "|", "(", "((", "x", ")", "&", "0xffu", ")", "<", "<", "8", ")", "))", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "include", "\"", "lz4", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "#", "if", "defined", "(", "__GNUC__", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "#", "define", "_PACKED", "__attribute__", "(", "(", "packed", ")", ")", "#", "else", "#", "define", "_PACKED", "#", "endif", "#", "if", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "ifdef", "__IBMC__", "#", "pragma", "pack", "(", "1", ")", "#", "else", "#", "pragma", "pack", "(", "push", ",", "1", ")", "#", "endif", "#", "endif", "typedef", "struct", "_U16_S", "{", "U16", "v", ";", "}", "_PACKED", "U16_S", ";", "typedef", "struct", "_U32_S", "{", "U32", "v", ";", "}", "_PACKED", "U32_S", ";", "typedef", "struct", "_U64_S", "{", "U64", "v", ";", "}", "_PACKED", "U64_S", ";", "#", "if", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "pragma", "pack", "(", "pop", ")", "#", "endif", "#", "define", "A64", "(", "x", ")", "(", "((", "U64_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "A32", "(", "x", ")", "(", "((", "U32_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "A16", "(", "x", ")", "(", "((", "U16_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "MINMATCH", "4", "#", "define", "DICTIONARY_LOGSIZE", "16", "#", "define", "MAXD", "(", "1", "<", "<", "DICTIONARY_LOGSIZE", ")", "#", "define", "MAXD_MASK", "(", "(", "U32", ")", "(", "MAXD", "-", "1", ")", ")", "#", "define", "MAX_DISTANCE", "(", "MAXD", "-", "1", ")", "#", "define", "HASH_LOG", "(", "DICTIONARY_LOGSIZE", "-", "1", ")", "#", "define", "HASHTABLESIZE", "(", "1", "<", "<", "HASH_LOG", ")", "#", "define", "HASH_MASK", "(", "HASHTABLESIZE", "-", "1", ")", "#", "define", "MAX_NB_ATTEMPTS", "256", "#", "define", "ML_BITS", "4", "#", "define", "ML_MASK", "(", "size_t", ")", "((", "1U", "<", "<", "ML_BITS", ")", "-", "1", ")", "#", "define", "RUN_BITS", "(", "8", "-", "ML_BITS", ")", "#", "define", "RUN_MASK", "(", "(", "1U", "<", "<", "RUN_BITS", ")", "-", "1", ")", "#", "define", "COPYLENGTH", "8", "#", "define", "LASTLITERALS", "5", "#", "define", "MFLIMIT", "(", "COPYLENGTH", "+", "MINMATCH", ")", "#", "define", "MINLENGTH", "(", "MFLIMIT", "+", "1", ")", "#", "define", "OPTIMAL_ML", "(", "int", ")", "((", "ML_MASK", "-", "1", ")", "+", "MINMATCH", ")", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Architecture", "-", "specific", "macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "LZ4_ARCH64", "/", "/", "64", "-", "bit", "#", "define", "STEPSIZE", "8", "#", "define", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", "A64", "(", "d", ")", "=", "A64", "(", "s", ")", ";", "d", "+", "=", "8", ";", "s", "+", "=", "8", ";", "#", "define", "LZ4_COPYPACKET", "(", "s", ",", "d", ")", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", "#", "define", "UARCH", "U64", "#", "define", "AARCH", "A64", "#", "define", "HTYPE", "U32", "#", "define", "INITBASE", "(", "b", ",", "s", ")", "const", "BYTE", "*", "const", "b", "=", "s", "#", "else", "/", "/", "32", "-", "bit", "#", "define", "STEPSIZE", "4", "#", "define", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", "A32", "(", "d", ")", "=", "A32", "(", "s", ")", ";", "d", "+", "=", "4", ";", "s", "+", "=", "4", ";", "#", "define", "LZ4_COPYPACKET", "(", "s", ",", "d", ")", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", ";", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", ";", "#", "define", "UARCH", "U32", "#", "define", "AARCH", "A32", "/", "/#", "define", "HTYPE", "const", "BYTE", "*", "/", "/#", "define", "INITBASE", "(", "b", ",", "s", ")", "const", "int", "b", "=", "0", "#", "define", "HTYPE", "U32", "#", "define", "INITBASE", "(", "b", ",", "s", ")", "const", "BYTE", "*", "const", "b", "=", "s", "#", "endif", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "define", "LZ4_READ_LITTLEENDIAN_16", "(", "d", ",", "s", ",", "p", ")", "{", "U16", "v", "=", "A16", "(", "p", ")", ";", "v", "=", "lz4_bswap16", "(", "v", ")", ";", "d", "=", "(", "s", ")", "-", "v", ";", "}", "#", "define", "LZ4_WRITE_LITTLEENDIAN_16", "(", "p", ",", "i", ")", "{", "U16", "v", "=", "(", "U16", ")", "(", "i", ")", ";", "v", "=", "lz4_bswap16", "(", "v", ")", ";", "A16", "(", "p", ")", "=", "v", ";", "p", "+", "=", "2", ";", "}", "#", "else", "/", "/", "Little", "Endian", "#", "define", "LZ4_READ_LITTLEENDIAN_16", "(", "d", ",", "s", ",", "p", ")", "{", "d", "=", "(", "s", ")", "-", "A16", "(", "p", ")", ";", "}", "#", "define", "LZ4_WRITE_LITTLEENDIAN_16", "(", "p", ",", "v", ")", "{", "A16", "(", "p", ")", "=", "v", ";", "p", "+", "=", "2", ";", "}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "struct", "{", "const", "BYTE", "*", "inputBuffer", ";", "const", "BYTE", "*", "base", ";", "const", "BYTE", "*", "end", ";", "HTYPE", "hashTable", "[", "HASHTABLESIZE", "]", ";", "U16", "chainTable", "[", "MAXD", "]", ";", "const", "BYTE", "*", "nextToUpdate", ";", "}", "LZ4HC_Data_Structure", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "LZ4_WILDCOPY", "(", "s", ",", "d", ",", "e", ")", "do", "{", "LZ4_COPYPACKET", "(", "s", ",", "d", ")", "}", "while", "(", "d", "<", "e", ")", ";", "#", "define", "LZ4_BLINDCOPY", "(", "s", ",", "d", ",", "l", ")", "{", "BYTE", "*", "e", "=", "d", "+", "l", ";", "LZ4_WILDCOPY", "(", "s", ",", "d", ",", "e", ")", ";", "d", "=", "e", ";", "}", "#", "define", "HASH_FUNCTION", "(", "i", ")", "(", "((", "i", ")", "*", "2654435761U", ")", ">", ">", "(", "(", "MINMATCH", "*", "8", ")", "-", "HASH_LOG", ")", ")", "#", "define", "HASH_VALUE", "(", "p", ")", "HASH_FUNCTION", "(", "A32", "(", "p", ")", ")", "#", "define", "HASH_POINTER", "(", "p", ")", "(", "HashTable", "[", "HASH_VALUE", "(", "p", ")", "]", "+", "base", ")", "#", "define", "DELTANEXT", "(", "p", ")", "chainTable", "[", "(", "size_t", ")", "(", "p", ")", "&", "MAXD_MASK", "]", "#", "define", "GETNEXT", "(", "p", ")", "(", "(", "p", ")", "-", "(", "size_t", ")", "DELTANEXT", "(", "p", ")", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Private", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "LZ4_ARCH64", "FORCE_INLINE", "int", "LZ4_NbCommonBytes", "(", "register", "U64", "val", ")", "{", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanReverse64", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_clzll", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "int", "r", ";", "if", "(", "!(", "val", ">", ">", "32", ")", ")", "{", "r", "=", "4", ";", "}", "else", "{", "r", "=", "0", ";", "val", ">", ">=", "32", ";", "}", "if", "(", "!(", "val", ">", ">", "16", ")", ")", "{", "r", "+", "=", "2", ";", "val", ">", ">=", "8", ";", "}", "else", "{", "val", ">", ">=", "24", ";", "}", "r", "+", "=", "(", "!", "val", ")", ";", "return", "r", ";", "#", "endif", "#", "else", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanForward64", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_ctzll", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "static", "const", "int", "DeBruijnBytePos", "[", "64", "]", "=", "{", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", ",", "2", ",", "0", ",", "3", ",", "1", ",", "3", ",", "1", ",", "4", ",", "2", ",", "7", ",", "0", ",", "2", ",", "3", ",", "6", ",", "1", ",", "5", ",", "3", ",", "5", ",", "1", ",", "3", ",", "4", ",", "4", ",", "2", ",", "5", ",", "6", ",", "7", ",", "7", ",", "0", ",", "1", ",", "2", ",", "3", ",", "3", ",", "4", ",", "6", ",", "2", ",", "6", ",", "5", ",", "5", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", "1", ",", "2", ",", "4", ",", "6", ",", "4", ",", "4", ",", "5", ",", "7", ",", "2", ",", "6", ",", "5", ",", "7", ",", "6", ",", "7", ",", "7", "}", ";", "return", "DeBruijnBytePos", "[", "((", "U64", ")", "((", "val", "&", "-", "val", ")", "*", "0x0218A392CDABBD3F", ")", ")", ">", ">", "58", "]", ";", "#", "endif", "#", "endif", "}", "#", "else", "FORCE_INLINE", "int", "LZ4_NbCommonBytes", "(", "register", "U32", "val", ")", "{", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", ";", "_BitScanReverse", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_clz", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "int", "r", ";", "if", "(", "!(", "val", ">", ">", "16", ")", ")", "{", "r", "=", "2", ";", "val", ">", ">=", "8", ";", "}", "else", "{", "r", "=", "0", ";", "val", ">", ">=", "24", ";", "}", "r", "+", "=", "(", "!", "val", ")", ";", "return", "r", ";", "#", "endif", "#", "else", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", ";", "_BitScanForward", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_ctz", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "static", "const", "int", "DeBruijnBytePos", "[", "32", "]", "=", "{", "0", ",", "0", ",", "3", ",", "0", ",", "3", ",", "1", ",", "3", ",", "0", ",", "3", ",", "2", ",", "2", ",", "1", ",", "3", ",", "2", ",", "0", ",", "1", ",", "3", ",", "3", ",", "1", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "3", ",", "1", ",", "2", ",", "0", ",", "1", ",", "0", ",", "1", ",", "1", "}", ";", "return", "DeBruijnBytePos", "[", "((", "U32", ")", "((", "val", "&", "-", "(", "S32", ")", "val", ")", "*", "0x077CB531U", ")", ")", ">", ">", "27", "]", ";", "#", "endif", "#", "endif", "}", "#", "endif", "FORCE_INLINE", "void", "LZ4_initHC", "(", "LZ4HC_Data_Structure", "*", "hc4", ",", "const", "BYTE", "*", "base", ")", "{", "MEM_INIT", "(", "(", "void", "*", ")", "hc4", "-", ">", "hashTable", ",", "0", ",", "sizeof", "(", "hc4", "-", ">", "hashTable", ")", ");", "MEM_INIT", "(", "hc4", "-", ">", "chainTable", ",", "0xFF", ",", "sizeof", "(", "hc4", "-", ">", "chainTable", ")", ");", "hc4", "-", ">", "nextToUpdate", "=", "base", "+", "1", ";", "hc4", "-", ">", "base", "=", "base", ";", "hc4", "-", ">", "inputBuffer", "=", "base", ";", "hc4", "-", ">", "end", "=", "base", ";", "}", "void", "*", "LZ4_createHC", "(", "const", "char", "*", "inputBuffer", ")", "{", "void", "*", "hc4", "=", "ALLOCATOR", "(", "sizeof", "(", "LZ4HC_Data_Structure", ")", ");", "LZ4_initHC", "(", "(", "LZ4HC_Data_Structure", "*", ")", "hc4", ",", "(", "const", "BYTE", "*", ")", "inputBuffer", ")", ";", "return", "hc4", ";", "}", "int", "LZ4_freeHC", "(", "void", "*", "LZ4HC_Data", ")", "{", "FREEMEM", "(", "LZ4HC_Data", ")", ";", "return", "(", "0", ")", ";", "}", "/", "/", "Update", "chains", "up", "to", "ip", "(", "excluded", ")", "FORCE_INLINE", "void", "LZ4HC_Insert", "(", "LZ4HC_Data_Structure", "*", "hc4", ",", "const", "BYTE", "*", "ip", ")", "{", "U16", "*", "chainTable", "=", "hc4", "-", ">", "chainTable", ";", "HTYPE", "*", "HashTable", "=", "hc4", "-", ">", "hashTable", ";", "INITBASE", "(", "base", ",", "hc4", "-", ">", "base", ")", ";", "while", "(", "hc4", "-", ">", "nextToUpdate", "<", "ip", ")", "{", "const", "BYTE", "*", "const", "p", "=", "hc4", "-", ">", "nextToUpdate", ";", "size_t", "delta", "=", "(", "p", ")", "-", "HASH_POINTER", "(", "p", ")", ";", "if", "(", "delta", ">", "MAX_DISTANCE", ")", "delta", "=", "MAX_DISTANCE", ";", "DELTANEXT", "(", "p", ")", "=", "(", "U16", ")", "delta", ";", "HashTable", "[", "HASH_VALUE", "(", "p", ")", "]", "=", "(", "HTYPE", ")", "((", "p", ")", "-", "base", ")", ";", "hc4", "-", ">", "nextToUpdate", "+", "+;", "}", "}", "char", "*", "LZ4_slideInputBufferHC", "(", "void", "*", "LZ4HC_Data", ")", "{", "LZ4HC_Data_Structure", "*", "hc4", "=", "(", "LZ4HC_Data_Structure", "*", ")", "LZ4HC_Data", ";", "U32", "distance", "=", "(", "U32", ")", "(", "hc4", "-", ">", "end", "-", "hc4", "-", ">", "inputBuffer", ")", "-", "64", "KB", ";", "distance", "=", "(", "distance", ">", ">", "16", ")", "<", "<", "16", ";", "/", "/", "Must", "be", "a", "multiple", "of", "64", "KB", "LZ4HC_Insert", "(", "hc4", ",", "hc4", "-", ">", "end", "-", "MINMATCH", ")", ";", "memcpy", "(", "(", "void", "*", ")(", "hc4", "-", ">", "end", "-", "64", "KB", "-", "distance", ")", ",", "(", "const", "void", "*", ")(", "hc4", "-", ">", "end", "-", "64", "KB", ")", ",", "64", "KB", ")", ";", "hc4", "-", ">", "nextToUpdate", "-", "=", "distance", ";", "hc4", "-", ">", "base", "-", "=", "distance", ";", "if", "(", "(", "U32", ")", "(", "hc4", "-", ">", "inputBuffer", "-", "hc4", "-", ">", "base", ")", ">", "1", "GB", "+", "64", "KB", ")", "/", "/", "Avoid", "overflow", "{", "int", "i", ";", "hc4", "-", ">", "base", "+", "=", "1", "GB", ";", "for", "(", "i", "=", "0", ";", "i", "<", "HASHTABLESIZE", ";", "i", "+", "+)", "hc4", "-", ">", "hashTable", "[", "i", "]", "-", "=", "1", "GB", ";", "}", "hc4", "-", ">", "end", "-", "=", "distance", ";", "return", "(", "char", "*", ")(", "hc4", "-", ">", "end", ")", ";", "}", "FORCE_INLINE", "size_t", "LZ4HC_CommonLength", "(", "const", "BYTE", "*", "p1", ",", "const", "BYTE", "*", "p2", ",", "const", "BYTE", "*", "const", "matchlimit", ")", "{", "const", "BYTE", "*", "p1t", "=", "p1", ";", "while", "(", "p1t", "<", "matchlimit", "-", "(", "STEPSIZE", "-", "1", ")", ")", "{", "UARCH", "diff", "=", "AARCH", "(", "p2", ")", "^", "AARCH", "(", "p1t", ")", ";", "if", "(", "!", "diff", ")", "{", "p1t", "+", "=", "STEPSIZE", ";", "p2", "+", "=", "STEPSIZE", ";", "continue", ";", "}", "p1t", "+", "=", "LZ4_NbCommonBytes", "(", "diff", ")", ";", "return", "(", "p1t", "-", "p1", ")", ";", "}", "if", "(", "LZ4_ARCH64", ")", "if", "(", "(", "p1t", "<", "(", "matchlimit", "-", "3", ")", ")", "&", "&", "(", "A32", "(", "p2", ")", "=", "=", "A32", "(", "p1t", ")", "))", "{", "p1t", "+", "=", "4", ";", "p2", "+", "=", "4", ";", "}", "if", "(", "(", "p1t", "<", "(", "matchlimit", "-", "1", ")", ")", "&", "&", "(", "A16", "(", "p2", ")", "=", "=", "A16", "(", "p1t", ")", "))", "{", "p1t", "+", "=", "2", ";", "p2", "+", "=", "2", ";", "}", "if", "(", "(", "p1t", "<", "matchlimit", ")", "&", "&", "(", "*", "p2", "=", "=", "*", "p1t", ")", ")", "p1t", "+", "+;", "return", "(", "p1t", "-", "p1", ")", ";", "}", "FORCE_INLINE", "int", "LZ4HC_InsertAndFindBestMatch", "(", "LZ4HC_Data_Structure", "*", "hc4", ",", "const", "BYTE", "*", "ip", ",", "const", "BYTE", "*", "const", "matchlimit", ",", "const", "BYTE", "*", "*", "matchpos", ")", "{", "U16", "*", "const", "chainTable", "=", "hc4", "-", ">", "chainTable", ";", "HTYPE", "*", "const", "HashTable", "=", "hc4", "-", ">", "hashTable", ";", "const", "BYTE", "*", "ref", ";", "INITBASE", "(", "base", ",", "hc4", "-", ">", "base", ")", ";", "int", "nbAttempts", "=", "MAX_NB_ATTEMPTS", ";", "size_t", "repl", "=", "0", ",", "ml", "=", "0", ";", "U16", "delta", "=", "0", ";", "/", "/", "useless", "assignment", ",", "to", "remove", "an", "uninitialization", "warning", "/", "/", "HC4", "match", "finder", "LZ4HC_Insert", "(", "hc4", ",", "ip", ")", ";", "ref", "=", "HASH_POINTER", "(", "ip", ")", ";", "#", "define", "REPEAT_OPTIMIZATION", "#", "ifdef", "REPEAT_OPTIMIZATION", "/", "/", "Detect", "repetitive", "sequences", "of", "length", "<", "=", "4", "if", "(", "(", "U32", ")", "(", "ip", "-", "ref", ")", "<", "=", "4", ")", "/", "/", "potential", "repetition", "{", "if", "(", "A32", "(", "ref", ")", "=", "=", "A32", "(", "ip", ")", ")", "/", "/", "confirmed", "{", "delta", "=", "(", "U16", ")", "(", "ip", "-", "ref", ")", ";", "repl", "=", "ml", "=", "LZ4HC_CommonLength", "(", "ip", "+", "MINMATCH", ",", "ref", "+", "MINMATCH", ",", "matchlimit", ")", "+", "MINMATCH", ";", "*", "matchpos", "=", "ref", ";", "}", "ref", "=", "GETNEXT", "(", "ref", ")", ";", "}", "#", "endif", "while", "(", "((", "U32", ")", "(", "ip", "-", "ref", ")", "<", "=", "MAX_DISTANCE", ")", "&", "&", "(", "nbAttempts", ")", ")", "{", "nbAttempts", "-", "-;", "if", "(", "*(", "ref", "+", "ml", ")", "=", "=", "*", "(", "ip", "+", "ml", ")", ")", "if", "(", "A32", "(", "ref", ")", "=", "=", "A32", "(", "ip", ")", ")", "{", "size_t", "mlt", "=", "LZ4HC_CommonLength", "(", "ip", "+", "MINMATCH", ",", "ref", "+", "MINMATCH", ",", "matchlimit", ")", "+", "MINMATCH", ";", "if", "(", "mlt", ">", "ml", ")", "{", "ml", "=", "mlt", ";", "*", "matchpos", "=", "ref", ";", "}", "}", "ref", "=", "GETNEXT", "(", "ref", ")", ";", "}", "#", "ifdef", "REPEAT_OPTIMIZATION", "/", "/", "Complete", "table", "if", "(", "repl", ")", "{", "const", "BYTE", "*", "ptr", "=", "ip", ";", "const", "BYTE", "*", "end", ";", "end", "=", "ip", "+", "repl", "-", "(", "MINMATCH", "-", "1", ")", ";", "while", "(", "ptr", "<", "end", "-", "delta", ")", "{", "DELTANEXT", "(", "ptr", ")", "=", "delta", ";", "/", "/", "Pre", "-", "Load", "ptr", "+", "+;", "}", "do", "{", "DELTANEXT", "(", "ptr", ")", "=", "delta", ";", "HashTable", "[", "HASH_VALUE", "(", "ptr", ")", "]", "=", "(", "HTYPE", ")", "((", "ptr", ")", "-", "base", ")", ";", "/", "/", "Head", "of", "chain", "ptr", "+", "+;", "}", "while", "(", "ptr", "<", "end", ")", ";", "hc4", "-", ">", "nextToUpdate", "=", "end", ";", "}", "#", "endif", "return", "(", "int", ")", "ml", ";", "}", "FORCE_INLINE", "int", "LZ4HC_InsertAndGetWiderMatch", "(", "LZ4HC_Data_Structure", "*", "hc4", ",", "const", "BYTE", "*", "ip", ",", "const", "BYTE", "*", "startLimit", ",", "const", "BYTE", "*", "matchlimit", ",", "int", "longest", ",", "const", "BYTE", "*", "*", "matchpos", ",", "const", "BYTE", "*", "*", "startpos", ")", "{", "U16", "*", "const", "chainTable", "=", "hc4", "-", ">", "chainTable", ";", "HTYPE", "*", "const", "HashTable", "=", "hc4", "-", ">", "hashTable", ";", "INITBASE", "(", "base", ",", "hc4", "-", ">", "base", ")", ";", "const", "BYTE", "*", "ref", ";", "int", "nbAttempts", "=", "MAX_NB_ATTEMPTS", ";", "int", "delta", "=", "(", "int", ")", "(", "ip", "-", "startLimit", ")", ";", "/", "/", "First", "Match", "LZ4HC_Insert", "(", "hc4", ",", "ip", ")", ";", "ref", "=", "HASH_POINTER", "(", "ip", ")", ";", "while", "(", "((", "U32", ")", "(", "ip", "-", "ref", ")", "<", "=", "MAX_DISTANCE", ")", "&", "&", "(", "nbAttempts", ")", ")", "{", "nbAttempts", "-", "-;", "if", "(", "*(", "startLimit", "+", "longest", ")", "=", "=", "*", "(", "ref", "-", "delta", "+", "longest", ")", ")", "if", "(", "A32", "(", "ref", ")", "=", "=", "A32", "(", "ip", ")", ")", "{", "#", "if", "1", "const", "BYTE", "*", "reft", "=", "ref", "+", "MINMATCH", ";", "const", "BYTE", "*", "ipt", "=", "ip", "+", "MINMATCH", ";", "const", "BYTE", "*", "startt", "=", "ip", ";", "while", "(", "ipt", "<", "matchlimit", "-", "(", "STEPSIZE", "-", "1", ")", ")", "{", "UARCH", "diff", "=", "AARCH", "(", "reft", ")", "^", "AARCH", "(", "ipt", ")", ";", "if", "(", "!", "diff", ")", "{", "ipt", "+", "=", "STEPSIZE", ";", "reft", "+", "=", "STEPSIZE", ";", "continue", ";", "}", "ipt", "+", "=", "LZ4_NbCommonBytes", "(", "diff", ")", ";", "goto", "_endCount", ";", "}", "if", "(", "LZ4_ARCH64", ")", "if", "(", "(", "ipt", "<", "(", "matchlimit", "-", "3", ")", ")", "&", "&", "(", "A32", "(", "reft", ")", "=", "=", "A32", "(", "ipt", ")", "))", "{", "ipt", "+", "=", "4", ";", "reft", "+", "=", "4", ";", "}", "if", "(", "(", "ipt", "<", "(", "matchlimit", "-", "1", ")", ")", "&", "&", "(", "A16", "(", "reft", ")", "=", "=", "A16", "(", "ipt", ")", "))", "{", "ipt", "+", "=", "2", ";", "reft", "+", "=", "2", ";", "}", "if", "(", "(", "ipt", "<", "matchlimit", ")", "&", "&", "(", "*", "reft", "=", "=", "*", "ipt", ")", ")", "ipt", "+", "+;", "_endCount", ":", "reft", "=", "ref", ";", "#", "else", "/", "/", "Easier", "for", "code", "maintenance", ",", "but", "unfortunately", "slower", "too", "const", "BYTE", "*", "startt", "=", "ip", ";", "const", "BYTE", "*", "reft", "=", "ref", ";", "const", "BYTE", "*", "ipt", "=", "ip", "+", "MINMATCH", "+", "LZ4HC_CommonLength", "(", "ip", "+", "MINMATCH", ",", "ref", "+", "MINMATCH", ",", "matchlimit", ")", ";", "#", "endif", "while", "(", "(", "startt", ">", "startLimit", ")", "&", "&", "(", "reft", ">", "hc4", "-", ">", "inputBuffer", ")", "&", "&", "(", "startt", "[", "-", "1", "]", "=", "=", "reft", "[", "-", "1", "]", "))", "{", "startt", "-", "-;", "reft", "-", "-;", "}", "if", "(", "(", "ipt", "-", "startt", ")", ">", "longest", ")", "{", "longest", "=", "(", "int", ")", "(", "ipt", "-", "startt", ")", ";", "*", "matchpos", "=", "reft", ";", "*", "startpos", "=", "startt", ";", "}", "}", "ref", "=", "GETNEXT", "(", "ref", ")", ";", "}", "return", "longest", ";", "}", "typedef", "enum", "{", "noLimit", "=", "0", ",", "limitedOutput", "=", "1", "}", "limitedOutput_directive", ";", "FORCE_INLINE", "int", "LZ4HC_encodeSequence", "(", "const", "BYTE", "*", "*", "ip", ",", "BYTE", "*", "*", "op", ",", "const", "BYTE", "*", "*", "anchor", ",", "int", "matchLength", ",", "const", "BYTE", "*", "ref", ",", "limitedOutput_directive", "limitedOutputBuffer", ",", "BYTE", "*", "oend", ")", "{", "int", "length", ";", "BYTE", "*", "token", ";", "/", "/", "Encode", "Literal", "length", "length", "=", "(", "int", ")", "(*", "ip", "-", "*", "anchor", ")", ";", "token", "=", "(", "*", "op", ")", "++", ";", "if", "(", "(", "limitedOutputBuffer", ")", "&", "&", "(", "(*", "op", "+", "length", "+", "(", "2", "+", "1", "+", "LASTLITERALS", ")", "+", "(", "length", ">", ">", "8", ")", ")", ">", "oend", ")", ")", "return", "1", ";", "/", "/", "Check", "output", "limit", "if", "(", "length", ">", "=(", "int", ")", "RUN_MASK", ")", "{", "int", "len", ";", "*", "token", "=", "(", "RUN_MASK", "<", "<", "ML_BITS", ")", ";", "len", "=", "length", "-", "RUN_MASK", ";", "for", "(", ";", "len", ">", "254", ";", "len", "-", "=", "255", ")", "*", "(*", "op", ")", "++", "=", "255", ";", "*", "(*", "op", ")", "++", "=", "(", "BYTE", ")", "len", ";", "}", "else", "*", "token", "=", "(", "BYTE", ")", "(", "length", "<", "<", "ML_BITS", ")", ";", "/", "/", "Copy", "Literals", "LZ4_BLINDCOPY", "(", "*", "anchor", ",", "*", "op", ",", "length", ")", ";", "/", "/", "Encode", "Offset", "LZ4_WRITE_LITTLEENDIAN_16", "(", "*", "op", ",", "(", "U16", ")", "(*", "ip", "-", "ref", ")", ");", "/", "/", "Encode", "MatchLength", "length", "=", "(", "int", ")", "(", "matchLength", "-", "MINMATCH", ")", ";", "if", "(", "(", "limitedOutputBuffer", ")", "&", "&", "(", "*", "op", "+", "(", "1", "+", "LASTLITERALS", ")", "+", "(", "length", ">", ">", "8", ")", ">", "oend", ")", ")", "return", "1", ";", "/", "/", "Check", "output", "limit", "if", "(", "length", ">", "=(", "int", ")", "ML_MASK", ")", "{", "*", "token", "+", "=", "ML_MASK", ";", "length", "-", "=", "ML_MASK", ";", "for", "(", ";", "length", ">", "509", ";", "length", "-", "=", "510", ")", "{", "*", "(*", "op", ")", "++", "=", "255", ";", "*", "(*", "op", ")", "++", "=", "255", ";", "}", "if", "(", "length", ">", "254", ")", "{", "length", "-", "=", "255", ";", "*", "(*", "op", ")", "++", "=", "255", ";", "}", "*", "(*", "op", ")", "++", "=", "(", "BYTE", ")", "length", ";", "}", "else", "*", "token", "+", "=", "(", "BYTE", ")", "(", "length", ")", ";", "/", "/", "Prepare", "next", "loop", "*", "ip", "+", "=", "matchLength", ";", "*", "anchor", "=", "*", "ip", ";", "return", "0", ";", "}", "static", "int", "LZ4HC_compress_generic", "(", "void", "*", "ctxvoid", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "limitedOutput_directive", "limit", ")", "{", "LZ4HC_Data_Structure", "*", "ctx", "=", "(", "LZ4HC_Data_Structure", "*", ")", "ctxvoid", ";", "const", "BYTE", "*", "ip", "=", "(", "const", "BYTE", "*", ")", "source", ";", "const", "BYTE", "*", "anchor", "=", "ip", ";", "const", "BYTE", "*", "const", "iend", "=", "ip", "+", "inputSize", ";", "const", "BYTE", "*", "const", "mflimit", "=", "iend", "-", "MFLIMIT", ";", "const", "BYTE", "*", "const", "matchlimit", "=", "(", "iend", "-", "LASTLITERALS", ")", ";", "BYTE", "*", "op", "=", "(", "BYTE", "*", ")", "dest", ";", "BYTE", "*", "const", "oend", "=", "op", "+", "maxOutputSize", ";", "int", "ml", ",", "ml2", ",", "ml3", ",", "ml0", ";", "const", "BYTE", "*", "ref", "=", "NULL", ";", "const", "BYTE", "*", "start2", "=", "NULL", ";", "const", "BYTE", "*", "ref2", "=", "NULL", ";", "const", "BYTE", "*", "start3", "=", "NULL", ";", "const", "BYTE", "*", "ref3", "=", "NULL", ";", "const", "BYTE", "*", "start0", ";", "const", "BYTE", "*", "ref0", ";", "/", "/", "Ensure", "blocks", "follow", "each", "other", "if", "(", "ip", "!", "=", "ctx", "-", ">", "end", ")", "return", "0", ";", "ctx", "-", ">", "end", "+", "=", "inputSize", ";", "ip", "+", "+;", "/", "/", "Main", "Loop", "while", "(", "ip", "<", "mflimit", ")", "{", "ml", "=", "LZ4HC_InsertAndFindBestMatch", "(", "ctx", ",", "ip", ",", "matchlimit", ",", "(", "&", "ref", ")", ");", "if", "(", "!", "ml", ")", "{", "ip", "+", "+;", "continue", ";", "}", "/", "/", "saved", ",", "in", "case", "we", "would", "skip", "too", "much", "start0", "=", "ip", ";", "ref0", "=", "ref", ";", "ml0", "=", "ml", ";", "_Search2", ":", "if", "(", "ip", "+", "ml", "<", "mflimit", ")", "ml2", "=", "LZ4HC_InsertAndGetWiderMatch", "(", "ctx", ",", "ip", "+", "ml", "-", "2", ",", "ip", "+", "1", ",", "matchlimit", ",", "ml", ",", "&", "ref2", ",", "&", "start2", ")", ";", "else", "ml2", "=", "ml", ";", "if", "(", "ml2", "=", "=", "ml", ")", "/", "/", "No", "better", "match", "{", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml", ",", "ref", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "continue", ";", "}", "if", "(", "start0", "<", "ip", ")", "{", "if", "(", "start2", "<", "ip", "+", "ml0", ")", "/", "/", "empirical", "{", "ip", "=", "start0", ";", "ref", "=", "ref0", ";", "ml", "=", "ml0", ";", "}", "}", "/", "/", "Here", ",", "start0", "=", "=", "ip", "if", "(", "(", "start2", "-", "ip", ")", "<", "3", ")", "/", "/", "First", "Match", "too", "small", ":", "removed", "{", "ml", "=", "ml2", ";", "ip", "=", "start2", ";", "ref", "=", "ref2", ";", "goto", "_Search2", ";", "}", "_Search3", ":", "/", "/", "Currently", "we", "have", ":", "/", "/", "ml2", ">", "ml1", ",", "and", "/", "/", "ip1", "+", "3", "<", "=", "ip2", "(", "usually", "<", "ip1", "+", "ml1", ")", "if", "(", "(", "start2", "-", "ip", ")", "<", "OPTIMAL_ML", ")", "{", "int", "correction", ";", "int", "new_ml", "=", "ml", ";", "if", "(", "new_ml", ">", "OPTIMAL_ML", ")", "new_ml", "=", "OPTIMAL_ML", ";", "if", "(", "ip", "+", "new_ml", ">", "start2", "+", "ml2", "-", "MINMATCH", ")", "new_ml", "=", "(", "int", ")", "(", "start2", "-", "ip", ")", "+", "ml2", "-", "MINMATCH", ";", "correction", "=", "new_ml", "-", "(", "int", ")", "(", "start2", "-", "ip", ")", ";", "if", "(", "correction", ">", "0", ")", "{", "start2", "+", "=", "correction", ";", "ref2", "+", "=", "correction", ";", "ml2", "-", "=", "correction", ";", "}", "}", "/", "/", "Now", ",", "we", "have", "start2", "=", "ip", "+", "new_ml", ",", "with", "new_ml", "=", "min", "(", "ml", ",", "OPTIMAL_ML", "=", "18", ")", "if", "(", "start2", "+", "ml2", "<", "mflimit", ")", "ml3", "=", "LZ4HC_InsertAndGetWiderMatch", "(", "ctx", ",", "start2", "+", "ml2", "-", "3", ",", "start2", ",", "matchlimit", ",", "ml2", ",", "&", "ref3", ",", "&", "start3", ")", ";", "else", "ml3", "=", "ml2", ";", "if", "(", "ml3", "=", "=", "ml2", ")", "/", "/", "No", "better", "match", ":", "2", "sequences", "to", "encode", "{", "/", "/", "ip", "&", "ref", "are", "known", ";", "Now", "for", "ml", "if", "(", "start2", "<", "ip", "+", "ml", ")", "ml", "=", "(", "int", ")", "(", "start2", "-", "ip", ")", ";", "/", "/", "Now", ",", "encode", "2", "sequences", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml", ",", "ref", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "ip", "=", "start2", ";", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml2", ",", "ref2", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "continue", ";", "}", "if", "(", "start3", "<", "ip", "+", "ml", "+", "3", ")", "/", "/", "Not", "enough", "space", "for", "match", "2", ":", "remove", "it", "{", "if", "(", "start3", ">", "=", "(", "ip", "+", "ml", ")", ")", "/", "/", "can", "write", "Seq1", "immediately", "=", "=>", "Seq2", "is", "removed", ",", "so", "Seq3", "becomes", "Seq1", "{", "if", "(", "start2", "<", "ip", "+", "ml", ")", "{", "int", "correction", "=", "(", "int", ")", "(", "ip", "+", "ml", "-", "start2", ")", ";", "start2", "+", "=", "correction", ";", "ref2", "+", "=", "correction", ";", "ml2", "-", "=", "correction", ";", "if", "(", "ml2", "<", "MINMATCH", ")", "{", "start2", "=", "start3", ";", "ref2", "=", "ref3", ";", "ml2", "=", "ml3", ";", "}", "}", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml", ",", "ref", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "ip", "=", "start3", ";", "ref", "=", "ref3", ";", "ml", "=", "ml3", ";", "start0", "=", "start2", ";", "ref0", "=", "ref2", ";", "ml0", "=", "ml2", ";", "goto", "_Search2", ";", "}", "start2", "=", "start3", ";", "ref2", "=", "ref3", ";", "ml2", "=", "ml3", ";", "goto", "_Search3", ";", "}", "/", "/", "OK", ",", "now", "we", "have", "3", "ascending", "matches", ";", "let", "'", "s", "write", "at", "least", "the", "first", "one", "/", "/", "ip", "&", "ref", "are", "known", ";", "Now", "for", "ml", "if", "(", "start2", "<", "ip", "+", "ml", ")", "{", "if", "(", "(", "start2", "-", "ip", ")", "<", "(", "int", ")", "ML_MASK", ")", "{", "int", "correction", ";", "if", "(", "ml", ">", "OPTIMAL_ML", ")", "ml", "=", "OPTIMAL_ML", ";", "if", "(", "ip", "+", "ml", ">", "start2", "+", "ml2", "-", "MINMATCH", ")", "ml", "=", "(", "int", ")", "(", "start2", "-", "ip", ")", "+", "ml2", "-", "MINMATCH", ";", "correction", "=", "ml", "-", "(", "int", ")", "(", "start2", "-", "ip", ")", ";", "if", "(", "correction", ">", "0", ")", "{", "start2", "+", "=", "correction", ";", "ref2", "+", "=", "correction", ";", "ml2", "-", "=", "correction", ";", "}", "}", "else", "{", "ml", "=", "(", "int", ")", "(", "start2", "-", "ip", ")", ";", "}", "}", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml", ",", "ref", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "ip", "=", "start2", ";", "ref", "=", "ref2", ";", "ml", "=", "ml2", ";", "start2", "=", "start3", ";", "ref2", "=", "ref3", ";", "ml2", "=", "ml3", ";", "goto", "_Search3", ";", "}", "/", "/", "Encode", "Last", "Literals", "{", "int", "lastRun", "=", "(", "int", ")", "(", "iend", "-", "anchor", ")", ";", "if", "(", "(", "limit", ")", "&", "&", "(", "((", "char", "*", ")", "op", "-", "dest", ")", "+", "lastRun", "+", "1", "+", "(", "(", "lastRun", "+", "255", "-", "RUN_MASK", ")", "/", "255", ")", ">", "(", "U32", ")", "maxOutputSize", ")", ")", "return", "0", ";", "/", "/", "Check", "output", "limit", "if", "(", "lastRun", ">", "=(", "int", ")", "RUN_MASK", ")", "{", "*", "op", "+", "+=", "(", "RUN_MASK", "<", "<", "ML_BITS", ")", ";", "lastRun", "-", "=", "RUN_MASK", ";", "for", "(", ";", "lastRun", ">", "254", ";", "lastRun", "-", "=", "255", ")", "*", "op", "+", "+", "=", "255", ";", "*", "op", "+", "+", "=", "(", "BYTE", ")", "lastRun", ";", "}", "else", "*", "op", "+", "+", "=", "(", "BYTE", ")", "(", "lastRun", "<", "<", "ML_BITS", ")", ";", "memcpy", "(", "op", ",", "anchor", ",", "iend", "-", "anchor", ")", ";", "op", "+", "=", "iend", "-", "anchor", ";", "}", "/", "/", "End", "return", "(", "int", ")", "(", "((", "char", "*", ")", "op", ")", "-", "dest", ")", ";", "}", "int", "LZ4_compressHC", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "void", "*", "ctx", "=", "LZ4_createHC", "(", "source", ")", ";", "int", "result", ";", "if", "(", "ctx", "=", "=", "NULL", ")", "return", "0", ";", "result", "=", "LZ4HC_compress_generic", "(", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "noLimit", ")", ";", "LZ4_freeHC", "(", "ctx", ")", ";", "return", "result", ";", "}", "int", "LZ4_compressHC_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "return", "LZ4HC_compress_generic", "(", "LZ4HC_Data", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "noLimit", ")", ";", "}", "int", "LZ4_compressHC_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "void", "*", "ctx", "=", "LZ4_createHC", "(", "source", ")", ";", "int", "result", ";", "if", "(", "ctx", "=", "=", "NULL", ")", "return", "0", ";", "result", "=", "LZ4HC_compress_generic", "(", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limitedOutput", ")", ";", "LZ4_freeHC", "(", "ctx", ")", ";", "return", "result", ";", "}", "int", "LZ4_compressHC_limitedOutput_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4HC_compress_generic", "(", "LZ4HC_Data", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "limitedOutput", ")", ";", "}", "/", "*", "LZ4", "HC", "-", "High", "Compression", "Mode", "of", "LZ4", "Copyright", "(", "C", ")", "2011", "-", "2014", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Tuning", "Parameter", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "LZ4HC_DEFAULT_COMPRESSIONLEVEL", "8", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Memory", "routines", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "include", "<", "stdlib", ".", "h", ">", "/", "*", "calloc", ",", "free", "*", "/", "#", "define", "ALLOCATOR", "(", "s", ")", "calloc", "(", "1", ",", "s", ")", "#", "define", "FREEMEM", "free", "#", "include", "<", "string", ".", "h", ">", "/", "*", "memset", ",", "memcpy", "*", "/", "#", "define", "MEM_INIT", "memset", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "CPU", "Feature", "Detection", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "32", "or", "64", "bits", "?", "*", "/", "#", "if", "(", "defined", "(", "__x86_64__", ")", "|", "|", "defined", "(", "_M_X64", ")", "|", "|", "defined", "(", "_WIN64", ")", "\\", "|", "|", "defined", "(", "__powerpc64__", ")", "|", "|", "defined", "(", "__powerpc64le__", ")", "\\", "|", "|", "defined", "(", "__ppc64__", ")", "|", "|", "defined", "(", "__ppc64le__", ")", "\\", "|", "|", "defined", "(", "__PPC64__", ")", "|", "|", "defined", "(", "__PPC64LE__", ")", "\\", "|", "|", "defined", "(", "__ia64", ")", "|", "|", "defined", "(", "__itanium__", ")", "|", "|", "defined", "(", "_M_IA64", ")", ")", "/", "*", "Detects", "64", "bits", "mode", "*", "/", "#", "define", "LZ4_ARCH64", "1", "#", "else", "#", "define", "LZ4_ARCH64", "0", "#", "endif", "/", "*", "*", "Little", "Endian", "or", "Big", "Endian", "?", "*", "Overwrite", "the", "#", "define", "below", "if", "you", "know", "your", "architecture", "endianess", "*", "/", "#", "include", "<", "stdlib", ".", "h", ">", "/", "*", "Apparently", "required", "to", "detect", "endianess", "*", "/", "#", "if", "defined", "(", "__GLIBC__", ")", "#", "include", "<", "endian", ".", "h", ">", "#", "if", "(", "__BYTE_ORDER", "=", "=", "__BIG_ENDIAN", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "endif", "#", "elif", "(", "defined", "(", "__BIG_ENDIAN__", ")", "|", "|", "defined", "(", "__BIG_ENDIAN", ")", "|", "|", "defined", "(", "_BIG_ENDIAN", ")", ")", "&", "&", "!", "(", "defined", "(", "__LITTLE_ENDIAN__", ")", "|", "|", "defined", "(", "__LITTLE_ENDIAN", ")", "|", "|", "defined", "(", "_LITTLE_ENDIAN", ")", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "elif", "defined", "(", "__sparc", ")", "|", "|", "defined", "(", "__sparc__", ")", "\\", "|", "|", "defined", "(", "__powerpc__", ")", "|", "|", "defined", "(", "__ppc__", ")", "|", "|", "defined", "(", "__PPC__", ")", "\\", "|", "|", "defined", "(", "__hpux", ")", "|", "|", "defined", "(", "__hppa", ")", "\\", "|", "|", "defined", "(", "_MIPSEB", ")", "|", "|", "defined", "(", "__s390__", ")", "#", "define", "LZ4_BIG_ENDIAN", "1", "#", "else", "/", "*", "Little", "Endian", "assumed", ".", "PDP", "Endian", "and", "other", "very", "rare", "endian", "format", "are", "unsupported", ".", "*", "/", "#", "endif", "/", "*", "*", "Unaligned", "memory", "access", "is", "automatically", "enabled", "for", "\"", "common", "\"", "CPU", ",", "such", "as", "x86", ".", "*", "For", "others", "CPU", ",", "the", "compiler", "will", "be", "more", "cautious", ",", "and", "insert", "extra", "code", "to", "ensure", "aligned", "access", "is", "respected", "*", "If", "you", "know", "your", "target", "CPU", "supports", "unaligned", "memory", "access", ",", "you", "want", "to", "force", "this", "option", "manually", "to", "improve", "performance", "*", "/", "#", "if", "defined", "(", "__ARM_FEATURE_UNALIGNED", ")", "#", "define", "LZ4_FORCE_UNALIGNED_ACCESS", "1", "#", "endif", "/", "*", "Define", "this", "parameter", "if", "your", "target", "system", "or", "compiler", "does", "not", "support", "hardware", "bit", "count", "*", "/", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "defined", "(", "_WIN32_WCE", ")", "/", "*", "Visual", "Studio", "for", "Windows", "CE", "does", "not", "support", "Hardware", "bit", "count", "*", "/", "#", "define", "LZ4_FORCE_SW_BITCOUNT", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Compiler", "Options", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "(", "__STDC_VERSION__", ">", "=", "199901L", ")", "/", "*", "C99", "*", "/", "/", "*", "\"", "restrict", "\"", "is", "a", "known", "keyword", "*", "/", "#", "else", "#", "define", "restrict", "/", "*", "Disable", "restrict", "*", "/", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "*", "Visual", "Studio", "*", "/", "#", "define", "FORCE_INLINE", "static", "__forceinline", "#", "include", "<", "intrin", ".", "h", ">", "/", "*", "For", "Visual", "2005", "*", "/", "#", "if", "LZ4_ARCH64", "/", "*", "64", "-", "bits", "*", "/", "#", "pragma", "intrinsic", "(", "_BitScanForward64", ")", "/", "*", "For", "Visual", "2005", "*", "/", "#", "pragma", "intrinsic", "(", "_BitScanReverse64", ")", "/", "*", "For", "Visual", "2005", "*", "/", "#", "else", "/", "*", "32", "-", "bits", "*", "/", "#", "pragma", "intrinsic", "(", "_BitScanForward", ")", "/", "*", "For", "Visual", "2005", "*", "/", "#", "pragma", "intrinsic", "(", "_BitScanReverse", ")", "/", "*", "For", "Visual", "2005", "*", "/", "#", "endif", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "*", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "*", "/", "#", "pragma", "warning", "(", "disable", ":", "4701", ")", "/", "*", "disable", ":", "C4701", ":", "potentially", "uninitialized", "local", "variable", "used", "*", "/", "#", "else", "#", "ifdef", "__GNUC__", "#", "define", "FORCE_INLINE", "static", "inline", "__attribute__", "(", "(", "always_inline", ")", ")", "#", "else", "#", "define", "FORCE_INLINE", "static", "inline", "#", "endif", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "*", "Visual", "Studio", "*", "/", "#", "define", "lz4_bswap16", "(", "x", ")", "_byteswap_ushort", "(", "x", ")", "#", "else", "#", "define", "lz4_bswap16", "(", "x", ")", "(", "(", "unsigned", "short", "int", ")", "(", "((", "(", "x", ")", ">", ">", "8", ")", "&", "0xffu", ")", "|", "(", "((", "x", ")", "&", "0xffu", ")", "<", "<", "8", ")", "))", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Includes", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "include", "\"", "lz4", ".", "h", "\"", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Basic", "Types", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "(", "__STDC_VERSION__", ">", "=", "199901L", ")", "/", "*", "C99", "*", "/", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "#", "if", "defined", "(", "__GNUC__", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "#", "define", "_PACKED", "__attribute__", "(", "(", "packed", ")", ")", "#", "else", "#", "define", "_PACKED", "#", "endif", "#", "if", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "ifdef", "__IBMC__", "#", "pragma", "pack", "(", "1", ")", "#", "else", "#", "pragma", "pack", "(", "push", ",", "1", ")", "#", "endif", "#", "endif", "typedef", "struct", "_U16_S", "{", "U16", "v", ";", "}", "_PACKED", "U16_S", ";", "typedef", "struct", "_U32_S", "{", "U32", "v", ";", "}", "_PACKED", "U32_S", ";", "typedef", "struct", "_U64_S", "{", "U64", "v", ";", "}", "_PACKED", "U64_S", ";", "#", "if", "!", "defined", "(", "LZ4_FORCE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "pragma", "pack", "(", "pop", ")", "#", "endif", "#", "define", "A64", "(", "x", ")", "(", "((", "U64_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "A32", "(", "x", ")", "(", "((", "U32_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "#", "define", "A16", "(", "x", ")", "(", "((", "U16_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Constants", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "MINMATCH", "4", "#", "define", "DICTIONARY_LOGSIZE", "16", "#", "define", "MAXD", "(", "1", "<", "<", "DICTIONARY_LOGSIZE", ")", "#", "define", "MAXD_MASK", "(", "(", "U32", ")", "(", "MAXD", "-", "1", ")", ")", "#", "define", "MAX_DISTANCE", "(", "MAXD", "-", "1", ")", "#", "define", "HASH_LOG", "(", "DICTIONARY_LOGSIZE", "-", "1", ")", "#", "define", "HASHTABLESIZE", "(", "1", "<", "<", "HASH_LOG", ")", "#", "define", "HASH_MASK", "(", "HASHTABLESIZE", "-", "1", ")", "#", "define", "ML_BITS", "4", "#", "define", "ML_MASK", "(", "size_t", ")", "((", "1U", "<", "<", "ML_BITS", ")", "-", "1", ")", "#", "define", "RUN_BITS", "(", "8", "-", "ML_BITS", ")", "#", "define", "RUN_MASK", "(", "(", "1U", "<", "<", "RUN_BITS", ")", "-", "1", ")", "#", "define", "COPYLENGTH", "8", "#", "define", "LASTLITERALS", "5", "#", "define", "MFLIMIT", "(", "COPYLENGTH", "+", "MINMATCH", ")", "#", "define", "MINLENGTH", "(", "MFLIMIT", "+", "1", ")", "#", "define", "OPTIMAL_ML", "(", "int", ")", "((", "ML_MASK", "-", "1", ")", "+", "MINMATCH", ")", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Architecture", "-", "specific", "macros", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "LZ4_ARCH64", "/", "*", "64", "-", "bit", "*", "/", "#", "define", "STEPSIZE", "8", "#", "define", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", "A64", "(", "d", ")", "=", "A64", "(", "s", ")", ";", "d", "+", "=", "8", ";", "s", "+", "=", "8", ";", "#", "define", "LZ4_COPYPACKET", "(", "s", ",", "d", ")", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", "#", "define", "AARCH", "A64", "#", "define", "HTYPE", "U32", "#", "define", "INITBASE", "(", "b", ",", "s", ")", "const", "BYTE", "*", "const", "b", "=", "s", "#", "else", "/", "*", "32", "-", "bit", "*", "/", "#", "define", "STEPSIZE", "4", "#", "define", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", "A32", "(", "d", ")", "=", "A32", "(", "s", ")", ";", "d", "+", "=", "4", ";", "s", "+", "=", "4", ";", "#", "define", "LZ4_COPYPACKET", "(", "s", ",", "d", ")", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", ";", "LZ4_COPYSTEP", "(", "s", ",", "d", ")", ";", "#", "define", "AARCH", "A32", "#", "define", "HTYPE", "U32", "#", "define", "INITBASE", "(", "b", ",", "s", ")", "const", "BYTE", "*", "const", "b", "=", "s", "#", "endif", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "define", "LZ4_READ_LITTLEENDIAN_16", "(", "d", ",", "s", ",", "p", ")", "{", "U16", "v", "=", "A16", "(", "p", ")", ";", "v", "=", "lz4_bswap16", "(", "v", ")", ";", "d", "=", "(", "s", ")", "-", "v", ";", "}", "#", "define", "LZ4_WRITE_LITTLEENDIAN_16", "(", "p", ",", "i", ")", "{", "U16", "v", "=", "(", "U16", ")", "(", "i", ")", ";", "v", "=", "lz4_bswap16", "(", "v", ")", ";", "A16", "(", "p", ")", "=", "v", ";", "p", "+", "=", "2", ";", "}", "#", "else", "/", "*", "Little", "Endian", "*", "/", "#", "define", "LZ4_READ_LITTLEENDIAN_16", "(", "d", ",", "s", ",", "p", ")", "{", "d", "=", "(", "s", ")", "-", "A16", "(", "p", ")", ";", "}", "#", "define", "LZ4_WRITE_LITTLEENDIAN_16", "(", "p", ",", "v", ")", "{", "A16", "(", "p", ")", "=", "v", ";", "p", "+", "=", "2", ";", "}", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Local", "Types", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "typedef", "struct", "{", "const", "BYTE", "*", "inputBuffer", ";", "const", "BYTE", "*", "base", ";", "const", "BYTE", "*", "end", ";", "HTYPE", "hashTable", "[", "HASHTABLESIZE", "]", ";", "U16", "chainTable", "[", "MAXD", "]", ";", "const", "BYTE", "*", "nextToUpdate", ";", "}", "LZ4HC_Data_Structure", ";", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Macros", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "LZ4_WILDCOPY", "(", "s", ",", "d", ",", "e", ")", "do", "{", "LZ4_COPYPACKET", "(", "s", ",", "d", ")", "}", "while", "(", "d", "<", "e", ")", ";", "#", "define", "LZ4_BLINDCOPY", "(", "s", ",", "d", ",", "l", ")", "{", "BYTE", "*", "e", "=", "d", "+", "l", ";", "LZ4_WILDCOPY", "(", "s", ",", "d", ",", "e", ")", ";", "d", "=", "e", ";", "}", "#", "define", "HASH_FUNCTION", "(", "i", ")", "(", "((", "i", ")", "*", "2654435761U", ")", ">", ">", "(", "(", "MINMATCH", "*", "8", ")", "-", "HASH_LOG", ")", ")", "#", "define", "HASH_VALUE", "(", "p", ")", "HASH_FUNCTION", "(", "A32", "(", "p", ")", ")", "#", "define", "HASH_POINTER", "(", "p", ")", "(", "HashTable", "[", "HASH_VALUE", "(", "p", ")", "]", "+", "base", ")", "#", "define", "DELTANEXT", "(", "p", ")", "chainTable", "[", "(", "size_t", ")", "(", "p", ")", "&", "MAXD_MASK", "]", "#", "define", "GETNEXT", "(", "p", ")", "(", "(", "p", ")", "-", "(", "size_t", ")", "DELTANEXT", "(", "p", ")", ")", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Private", "functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "LZ4_ARCH64", "FORCE_INLINE", "int", "LZ4_NbCommonBytes", "(", "register", "U64", "val", ")", "{", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanReverse64", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_clzll", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "int", "r", ";", "if", "(", "!(", "val", ">", ">", "32", ")", ")", "{", "r", "=", "4", ";", "}", "else", "{", "r", "=", "0", ";", "val", ">", ">=", "32", ";", "}", "if", "(", "!(", "val", ">", ">", "16", ")", ")", "{", "r", "+", "=", "2", ";", "val", ">", ">=", "8", ";", "}", "else", "{", "val", ">", ">=", "24", ";", "}", "r", "+", "=", "(", "!", "val", ")", ";", "return", "r", ";", "#", "endif", "#", "else", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", "=", "0", ";", "_BitScanForward64", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_ctzll", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "static", "const", "int", "DeBruijnBytePos", "[", "64", "]", "=", "{", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", ",", "2", ",", "0", ",", "3", ",", "1", ",", "3", ",", "1", ",", "4", ",", "2", ",", "7", ",", "0", ",", "2", ",", "3", ",", "6", ",", "1", ",", "5", ",", "3", ",", "5", ",", "1", ",", "3", ",", "4", ",", "4", ",", "2", ",", "5", ",", "6", ",", "7", ",", "7", ",", "0", ",", "1", ",", "2", ",", "3", ",", "3", ",", "4", ",", "6", ",", "2", ",", "6", ",", "5", ",", "5", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", "1", ",", "2", ",", "4", ",", "6", ",", "4", ",", "4", ",", "5", ",", "7", ",", "2", ",", "6", ",", "5", ",", "7", ",", "6", ",", "7", ",", "7", "}", ";", "return", "DeBruijnBytePos", "[", "((", "U64", ")", "((", "val", "&", "-", "val", ")", "*", "0x0218A392CDABBD3F", ")", ")", ">", ">", "58", "]", ";", "#", "endif", "#", "endif", "}", "#", "else", "FORCE_INLINE", "int", "LZ4_NbCommonBytes", "(", "register", "U32", "val", ")", "{", "#", "if", "defined", "(", "LZ4_BIG_ENDIAN", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", ";", "_BitScanReverse", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_clz", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "int", "r", ";", "if", "(", "!(", "val", ">", ">", "16", ")", ")", "{", "r", "=", "2", ";", "val", ">", ">=", "8", ";", "}", "else", "{", "r", "=", "0", ";", "val", ">", ">=", "24", ";", "}", "r", "+", "=", "(", "!", "val", ")", ";", "return", "r", ";", "#", "endif", "#", "else", "#", "if", "defined", "(", "_MSC_VER", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "unsigned", "long", "r", ";", "_BitScanForward", "(", "&", "r", ",", "val", ")", ";", "return", "(", "int", ")", "(", "r", ">", ">", "3", ")", ";", "#", "elif", "defined", "(", "__GNUC__", ")", "&", "&", "(", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", ">", "=", "304", ")", "&", "&", "!", "defined", "(", "LZ4_FORCE_SW_BITCOUNT", ")", "return", "(", "__builtin_ctz", "(", "val", ")", ">", ">", "3", ")", ";", "#", "else", "static", "const", "int", "DeBruijnBytePos", "[", "32", "]", "=", "{", "0", ",", "0", ",", "3", ",", "0", ",", "3", ",", "1", ",", "3", ",", "0", ",", "3", ",", "2", ",", "2", ",", "1", ",", "3", ",", "2", ",", "0", ",", "1", ",", "3", ",", "3", ",", "1", ",", "2", ",", "2", ",", "2", ",", "2", ",", "0", ",", "3", ",", "1", ",", "2", ",", "0", ",", "1", ",", "0", ",", "1", ",", "1", "}", ";", "return", "DeBruijnBytePos", "[", "((", "U32", ")", "((", "val", "&", "-", "(", "S32", ")", "val", ")", "*", "0x077CB531U", ")", ")", ">", ">", "27", "]", ";", "#", "endif", "#", "endif", "}", "#", "endif", "int", "LZ4_sizeofStreamStateHC", "(", ")", "{", "return", "sizeof", "(", "LZ4HC_Data_Structure", ")", ";", "}", "FORCE_INLINE", "void", "LZ4_initHC", "(", "LZ4HC_Data_Structure", "*", "hc4", ",", "const", "BYTE", "*", "base", ")", "{", "MEM_INIT", "(", "(", "void", "*", ")", "hc4", "-", ">", "hashTable", ",", "0", ",", "sizeof", "(", "hc4", "-", ">", "hashTable", ")", ");", "MEM_INIT", "(", "hc4", "-", ">", "chainTable", ",", "0xFF", ",", "sizeof", "(", "hc4", "-", ">", "chainTable", ")", ");", "hc4", "-", ">", "nextToUpdate", "=", "base", "+", "1", ";", "hc4", "-", ">", "base", "=", "base", ";", "hc4", "-", ">", "inputBuffer", "=", "base", ";", "hc4", "-", ">", "end", "=", "base", ";", "}", "int", "LZ4_resetStreamStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "inputBuffer", ")", "{", "if", "(", "((", "(", "size_t", ")", "state", ")", "&", "(", "sizeof", "(", "void", "*", ")-", "1", ")", ")", "!", "=", "0", ")", "return", "1", ";", "/", "*", "Error", ":", "pointer", "is", "not", "aligned", "for", "pointer", "(", "32", "or", "64", "bits", ")", "*", "/", "LZ4_initHC", "(", "(", "LZ4HC_Data_Structure", "*", ")", "state", ",", "(", "const", "BYTE", "*", ")", "inputBuffer", ")", ";", "return", "0", ";", "}", "void", "*", "LZ4_createHC", "(", "const", "char", "*", "inputBuffer", ")", "{", "void", "*", "hc4", "=", "ALLOCATOR", "(", "sizeof", "(", "LZ4HC_Data_Structure", ")", ");", "LZ4_initHC", "(", "(", "LZ4HC_Data_Structure", "*", ")", "hc4", ",", "(", "const", "BYTE", "*", ")", "inputBuffer", ")", ";", "return", "hc4", ";", "}", "int", "LZ4_freeHC", "(", "void", "*", "LZ4HC_Data", ")", "{", "FREEMEM", "(", "LZ4HC_Data", ")", ";", "return", "(", "0", ")", ";", "}", "/", "*", "Update", "chains", "up", "to", "ip", "(", "excluded", ")", "*", "/", "FORCE_INLINE", "void", "LZ4HC_Insert", "(", "LZ4HC_Data_Structure", "*", "hc4", ",", "const", "BYTE", "*", "ip", ")", "{", "U16", "*", "chainTable", "=", "hc4", "-", ">", "chainTable", ";", "HTYPE", "*", "HashTable", "=", "hc4", "-", ">", "hashTable", ";", "INITBASE", "(", "base", ",", "hc4", "-", ">", "base", ")", ";", "while", "(", "hc4", "-", ">", "nextToUpdate", "<", "ip", ")", "{", "const", "BYTE", "*", "const", "p", "=", "hc4", "-", ">", "nextToUpdate", ";", "size_t", "delta", "=", "(", "p", ")", "-", "HASH_POINTER", "(", "p", ")", ";", "if", "(", "delta", ">", "MAX_DISTANCE", ")", "delta", "=", "MAX_DISTANCE", ";", "DELTANEXT", "(", "p", ")", "=", "(", "U16", ")", "delta", ";", "HashTable", "[", "HASH_VALUE", "(", "p", ")", "]", "=", "(", "HTYPE", ")", "((", "p", ")", "-", "base", ")", ";", "hc4", "-", ">", "nextToUpdate", "+", "+;", "}", "}", "char", "*", "LZ4_slideInputBufferHC", "(", "void", "*", "LZ4HC_Data", ")", "{", "LZ4HC_Data_Structure", "*", "hc4", "=", "(", "LZ4HC_Data_Structure", "*", ")", "LZ4HC_Data", ";", "U32", "distance", "=", "(", "U32", ")", "(", "hc4", "-", ">", "end", "-", "hc4", "-", ">", "inputBuffer", ")", "-", "64", "KB", ";", "distance", "=", "(", "distance", ">", ">", "16", ")", "<", "<", "16", ";", "/", "*", "Must", "be", "a", "multiple", "of", "64", "KB", "*", "/", "LZ4HC_Insert", "(", "hc4", ",", "hc4", "-", ">", "end", "-", "MINMATCH", ")", ";", "memcpy", "(", "(", "void", "*", ")(", "hc4", "-", ">", "end", "-", "64", "KB", "-", "distance", ")", ",", "(", "const", "void", "*", ")(", "hc4", "-", ">", "end", "-", "64", "KB", ")", ",", "64", "KB", ")", ";", "hc4", "-", ">", "nextToUpdate", "-", "=", "distance", ";", "hc4", "-", ">", "base", "-", "=", "distance", ";", "if", "(", "(", "U32", ")", "(", "hc4", "-", ">", "inputBuffer", "-", "hc4", "-", ">", "base", ")", ">", "1", "GB", "+", "64", "KB", ")", "/", "*", "Avoid", "overflow", "*", "/", "{", "int", "i", ";", "hc4", "-", ">", "base", "+", "=", "1", "GB", ";", "for", "(", "i", "=", "0", ";", "i", "<", "HASHTABLESIZE", ";", "i", "+", "+)", "hc4", "-", ">", "hashTable", "[", "i", "]", "-", "=", "1", "GB", ";", "}", "hc4", "-", ">", "end", "-", "=", "distance", ";", "return", "(", "char", "*", ")(", "hc4", "-", ">", "end", ")", ";", "}", "FORCE_INLINE", "size_t", "LZ4HC_CommonLength", "(", "const", "BYTE", "*", "p1", ",", "const", "BYTE", "*", "p2", ",", "const", "BYTE", "*", "const", "matchlimit", ")", "{", "const", "BYTE", "*", "p1t", "=", "p1", ";", "while", "(", "p1t", "<", "matchlimit", "-", "(", "STEPSIZE", "-", "1", ")", ")", "{", "size_t", "diff", "=", "AARCH", "(", "p2", ")", "^", "AARCH", "(", "p1t", ")", ";", "if", "(", "!", "diff", ")", "{", "p1t", "+", "=", "STEPSIZE", ";", "p2", "+", "=", "STEPSIZE", ";", "continue", ";", "}", "p1t", "+", "=", "LZ4_NbCommonBytes", "(", "diff", ")", ";", "return", "(", "p1t", "-", "p1", ")", ";", "}", "if", "(", "LZ4_ARCH64", ")", "if", "(", "(", "p1t", "<", "(", "matchlimit", "-", "3", ")", ")", "&", "&", "(", "A32", "(", "p2", ")", "=", "=", "A32", "(", "p1t", ")", "))", "{", "p1t", "+", "=", "4", ";", "p2", "+", "=", "4", ";", "}", "if", "(", "(", "p1t", "<", "(", "matchlimit", "-", "1", ")", ")", "&", "&", "(", "A16", "(", "p2", ")", "=", "=", "A16", "(", "p1t", ")", "))", "{", "p1t", "+", "=", "2", ";", "p2", "+", "=", "2", ";", "}", "if", "(", "(", "p1t", "<", "matchlimit", ")", "&", "&", "(", "*", "p2", "=", "=", "*", "p1t", ")", ")", "p1t", "+", "+;", "return", "(", "p1t", "-", "p1", ")", ";", "}", "FORCE_INLINE", "int", "LZ4HC_InsertAndFindBestMatch", "(", "LZ4HC_Data_Structure", "*", "hc4", ",", "const", "BYTE", "*", "ip", ",", "const", "BYTE", "*", "const", "matchlimit", ",", "const", "BYTE", "*", "*", "matchpos", ",", "const", "int", "maxNbAttempts", ")", "{", "U16", "*", "const", "chainTable", "=", "hc4", "-", ">", "chainTable", ";", "HTYPE", "*", "const", "HashTable", "=", "hc4", "-", ">", "hashTable", ";", "const", "BYTE", "*", "ref", ";", "INITBASE", "(", "base", ",", "hc4", "-", ">", "base", ")", ";", "int", "nbAttempts", "=", "maxNbAttempts", ";", "size_t", "repl", "=", "0", ",", "ml", "=", "0", ";", "U16", "delta", "=", "0", ";", "/", "*", "useless", "assignment", ",", "to", "remove", "an", "uninitialization", "warning", "*", "/", "/", "*", "HC4", "match", "finder", "*", "/", "LZ4HC_Insert", "(", "hc4", ",", "ip", ")", ";", "ref", "=", "HASH_POINTER", "(", "ip", ")", ";", "#", "define", "REPEAT_OPTIMIZATION", "#", "ifdef", "REPEAT_OPTIMIZATION", "/", "*", "Detect", "repetitive", "sequences", "of", "length", "<", "=", "4", "*", "/", "if", "(", "(", "U32", ")", "(", "ip", "-", "ref", ")", "<", "=", "4", ")", "/", "*", "potential", "repetition", "*", "/", "{", "if", "(", "A32", "(", "ref", ")", "=", "=", "A32", "(", "ip", ")", ")", "/", "*", "confirmed", "*", "/", "{", "delta", "=", "(", "U16", ")", "(", "ip", "-", "ref", ")", ";", "repl", "=", "ml", "=", "LZ4HC_CommonLength", "(", "ip", "+", "MINMATCH", ",", "ref", "+", "MINMATCH", ",", "matchlimit", ")", "+", "MINMATCH", ";", "*", "matchpos", "=", "ref", ";", "}", "ref", "=", "GETNEXT", "(", "ref", ")", ";", "}", "#", "endif", "while", "(", "((", "U32", ")", "(", "ip", "-", "ref", ")", "<", "=", "MAX_DISTANCE", ")", "&", "&", "(", "nbAttempts", ")", ")", "{", "nbAttempts", "-", "-;", "if", "(", "*(", "ref", "+", "ml", ")", "=", "=", "*", "(", "ip", "+", "ml", ")", ")", "if", "(", "A32", "(", "ref", ")", "=", "=", "A32", "(", "ip", ")", ")", "{", "size_t", "mlt", "=", "LZ4HC_CommonLength", "(", "ip", "+", "MINMATCH", ",", "ref", "+", "MINMATCH", ",", "matchlimit", ")", "+", "MINMATCH", ";", "if", "(", "mlt", ">", "ml", ")", "{", "ml", "=", "mlt", ";", "*", "matchpos", "=", "ref", ";", "}", "}", "ref", "=", "GETNEXT", "(", "ref", ")", ";", "}", "#", "ifdef", "REPEAT_OPTIMIZATION", "/", "*", "Complete", "table", "*", "/", "if", "(", "repl", ")", "{", "const", "BYTE", "*", "ptr", "=", "ip", ";", "const", "BYTE", "*", "end", ";", "end", "=", "ip", "+", "repl", "-", "(", "MINMATCH", "-", "1", ")", ";", "while", "(", "ptr", "<", "end", "-", "delta", ")", "{", "DELTANEXT", "(", "ptr", ")", "=", "delta", ";", "/", "*", "Pre", "-", "Load", "*", "/", "ptr", "+", "+;", "}", "do", "{", "DELTANEXT", "(", "ptr", ")", "=", "delta", ";", "HashTable", "[", "HASH_VALUE", "(", "ptr", ")", "]", "=", "(", "HTYPE", ")", "((", "ptr", ")", "-", "base", ")", ";", "/", "*", "Head", "of", "chain", "*", "/", "ptr", "+", "+;", "}", "while", "(", "ptr", "<", "end", ")", ";", "hc4", "-", ">", "nextToUpdate", "=", "end", ";", "}", "#", "endif", "return", "(", "int", ")", "ml", ";", "}", "FORCE_INLINE", "int", "LZ4HC_InsertAndGetWiderMatch", "(", "LZ4HC_Data_Structure", "*", "hc4", ",", "const", "BYTE", "*", "ip", ",", "const", "BYTE", "*", "startLimit", ",", "const", "BYTE", "*", "matchlimit", ",", "int", "longest", ",", "const", "BYTE", "*", "*", "matchpos", ",", "const", "BYTE", "*", "*", "startpos", ",", "const", "int", "maxNbAttempts", ")", "{", "U16", "*", "const", "chainTable", "=", "hc4", "-", ">", "chainTable", ";", "HTYPE", "*", "const", "HashTable", "=", "hc4", "-", ">", "hashTable", ";", "INITBASE", "(", "base", ",", "hc4", "-", ">", "base", ")", ";", "const", "BYTE", "*", "ref", ";", "int", "nbAttempts", "=", "maxNbAttempts", ";", "int", "delta", "=", "(", "int", ")", "(", "ip", "-", "startLimit", ")", ";", "/", "*", "First", "Match", "*", "/", "LZ4HC_Insert", "(", "hc4", ",", "ip", ")", ";", "ref", "=", "HASH_POINTER", "(", "ip", ")", ";", "while", "(", "((", "U32", ")", "(", "ip", "-", "ref", ")", "<", "=", "MAX_DISTANCE", ")", "&", "&", "(", "nbAttempts", ")", ")", "{", "nbAttempts", "-", "-;", "if", "(", "*(", "startLimit", "+", "longest", ")", "=", "=", "*", "(", "ref", "-", "delta", "+", "longest", ")", ")", "if", "(", "A32", "(", "ref", ")", "=", "=", "A32", "(", "ip", ")", ")", "{", "#", "if", "1", "const", "BYTE", "*", "reft", "=", "ref", "+", "MINMATCH", ";", "const", "BYTE", "*", "ipt", "=", "ip", "+", "MINMATCH", ";", "const", "BYTE", "*", "startt", "=", "ip", ";", "while", "(", "ipt", "<", "matchlimit", "-", "(", "STEPSIZE", "-", "1", ")", ")", "{", "size_t", "diff", "=", "AARCH", "(", "reft", ")", "^", "AARCH", "(", "ipt", ")", ";", "if", "(", "!", "diff", ")", "{", "ipt", "+", "=", "STEPSIZE", ";", "reft", "+", "=", "STEPSIZE", ";", "continue", ";", "}", "ipt", "+", "=", "LZ4_NbCommonBytes", "(", "diff", ")", ";", "goto", "_endCount", ";", "}", "if", "(", "LZ4_ARCH64", ")", "if", "(", "(", "ipt", "<", "(", "matchlimit", "-", "3", ")", ")", "&", "&", "(", "A32", "(", "reft", ")", "=", "=", "A32", "(", "ipt", ")", "))", "{", "ipt", "+", "=", "4", ";", "reft", "+", "=", "4", ";", "}", "if", "(", "(", "ipt", "<", "(", "matchlimit", "-", "1", ")", ")", "&", "&", "(", "A16", "(", "reft", ")", "=", "=", "A16", "(", "ipt", ")", "))", "{", "ipt", "+", "=", "2", ";", "reft", "+", "=", "2", ";", "}", "if", "(", "(", "ipt", "<", "matchlimit", ")", "&", "&", "(", "*", "reft", "=", "=", "*", "ipt", ")", ")", "ipt", "+", "+;", "_endCount", ":", "reft", "=", "ref", ";", "#", "else", "/", "*", "Easier", "for", "code", "maintenance", ",", "but", "unfortunately", "slower", "too", "*", "/", "const", "BYTE", "*", "startt", "=", "ip", ";", "const", "BYTE", "*", "reft", "=", "ref", ";", "const", "BYTE", "*", "ipt", "=", "ip", "+", "MINMATCH", "+", "LZ4HC_CommonLength", "(", "ip", "+", "MINMATCH", ",", "ref", "+", "MINMATCH", ",", "matchlimit", ")", ";", "#", "endif", "while", "(", "(", "startt", ">", "startLimit", ")", "&", "&", "(", "reft", ">", "hc4", "-", ">", "inputBuffer", ")", "&", "&", "(", "startt", "[", "-", "1", "]", "=", "=", "reft", "[", "-", "1", "]", "))", "{", "startt", "-", "-;", "reft", "-", "-;", "}", "if", "(", "(", "ipt", "-", "startt", ")", ">", "longest", ")", "{", "longest", "=", "(", "int", ")", "(", "ipt", "-", "startt", ")", ";", "*", "matchpos", "=", "reft", ";", "*", "startpos", "=", "startt", ";", "}", "}", "ref", "=", "GETNEXT", "(", "ref", ")", ";", "}", "return", "longest", ";", "}", "typedef", "enum", "{", "noLimit", "=", "0", ",", "limitedOutput", "=", "1", "}", "limitedOutput_directive", ";", "FORCE_INLINE", "int", "LZ4HC_encodeSequence", "(", "const", "BYTE", "*", "*", "ip", ",", "BYTE", "*", "*", "op", ",", "const", "BYTE", "*", "*", "anchor", ",", "int", "matchLength", ",", "const", "BYTE", "*", "ref", ",", "limitedOutput_directive", "limitedOutputBuffer", ",", "BYTE", "*", "oend", ")", "{", "int", "length", ";", "BYTE", "*", "token", ";", "/", "*", "Encode", "Literal", "length", "*", "/", "length", "=", "(", "int", ")", "(*", "ip", "-", "*", "anchor", ")", ";", "token", "=", "(", "*", "op", ")", "++", ";", "if", "(", "(", "limitedOutputBuffer", ")", "&", "&", "(", "(*", "op", "+", "length", "+", "(", "2", "+", "1", "+", "LASTLITERALS", ")", "+", "(", "length", ">", ">", "8", ")", ")", ">", "oend", ")", ")", "return", "1", ";", "/", "*", "Check", "output", "limit", "*", "/", "if", "(", "length", ">", "=(", "int", ")", "RUN_MASK", ")", "{", "int", "len", ";", "*", "token", "=", "(", "RUN_MASK", "<", "<", "ML_BITS", ")", ";", "len", "=", "length", "-", "RUN_MASK", ";", "for", "(", ";", "len", ">", "254", ";", "len", "-", "=", "255", ")", "*", "(*", "op", ")", "++", "=", "255", ";", "*", "(*", "op", ")", "++", "=", "(", "BYTE", ")", "len", ";", "}", "else", "*", "token", "=", "(", "BYTE", ")", "(", "length", "<", "<", "ML_BITS", ")", ";", "/", "*", "Copy", "Literals", "*", "/", "LZ4_BLINDCOPY", "(", "*", "anchor", ",", "*", "op", ",", "length", ")", ";", "/", "*", "Encode", "Offset", "*", "/", "LZ4_WRITE_LITTLEENDIAN_16", "(", "*", "op", ",", "(", "U16", ")", "(*", "ip", "-", "ref", ")", ");", "/", "*", "Encode", "MatchLength", "*", "/", "length", "=", "(", "int", ")", "(", "matchLength", "-", "MINMATCH", ")", ";", "if", "(", "(", "limitedOutputBuffer", ")", "&", "&", "(", "*", "op", "+", "(", "1", "+", "LASTLITERALS", ")", "+", "(", "length", ">", ">", "8", ")", ">", "oend", ")", ")", "return", "1", ";", "/", "*", "Check", "output", "limit", "*", "/", "if", "(", "length", ">", "=(", "int", ")", "ML_MASK", ")", "{", "*", "token", "+", "=", "ML_MASK", ";", "length", "-", "=", "ML_MASK", ";", "for", "(", ";", "length", ">", "509", ";", "length", "-", "=", "510", ")", "{", "*", "(*", "op", ")", "++", "=", "255", ";", "*", "(*", "op", ")", "++", "=", "255", ";", "}", "if", "(", "length", ">", "254", ")", "{", "length", "-", "=", "255", ";", "*", "(*", "op", ")", "++", "=", "255", ";", "}", "*", "(*", "op", ")", "++", "=", "(", "BYTE", ")", "length", ";", "}", "else", "*", "token", "+", "=", "(", "BYTE", ")", "(", "length", ")", ";", "/", "*", "Prepare", "next", "loop", "*", "/", "*", "ip", "+", "=", "matchLength", ";", "*", "anchor", "=", "*", "ip", ";", "return", "0", ";", "}", "#", "define", "MAX_COMPRESSION_LEVEL", "16", "static", "int", "LZ4HC_compress_generic", "(", "void", "*", "ctxvoid", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "int", "compressionLevel", ",", "limitedOutput_directive", "limit", ")", "{", "LZ4HC_Data_Structure", "*", "ctx", "=", "(", "LZ4HC_Data_Structure", "*", ")", "ctxvoid", ";", "const", "BYTE", "*", "ip", "=", "(", "const", "BYTE", "*", ")", "source", ";", "const", "BYTE", "*", "anchor", "=", "ip", ";", "const", "BYTE", "*", "const", "iend", "=", "ip", "+", "inputSize", ";", "const", "BYTE", "*", "const", "mflimit", "=", "iend", "-", "MFLIMIT", ";", "const", "BYTE", "*", "const", "matchlimit", "=", "(", "iend", "-", "LASTLITERALS", ")", ";", "BYTE", "*", "op", "=", "(", "BYTE", "*", ")", "dest", ";", "BYTE", "*", "const", "oend", "=", "op", "+", "maxOutputSize", ";", "const", "int", "maxNbAttempts", "=", "compressionLevel", ">", "MAX_COMPRESSION_LEVEL", "?", "1", "<", "<", "MAX_COMPRESSION_LEVEL", ":", "compressionLevel", "?", "1", "<", "<(", "compressionLevel", "-", "1", ")", ":", "1", "<", "<", "LZ4HC_DEFAULT_COMPRESSIONLEVEL", ";", "int", "ml", ",", "ml2", ",", "ml3", ",", "ml0", ";", "const", "BYTE", "*", "ref", "=", "NULL", ";", "const", "BYTE", "*", "start2", "=", "NULL", ";", "const", "BYTE", "*", "ref2", "=", "NULL", ";", "const", "BYTE", "*", "start3", "=", "NULL", ";", "const", "BYTE", "*", "ref3", "=", "NULL", ";", "const", "BYTE", "*", "start0", ";", "const", "BYTE", "*", "ref0", ";", "/", "*", "Ensure", "blocks", "follow", "each", "other", "*", "/", "if", "(", "ip", "!", "=", "ctx", "-", ">", "end", ")", "return", "0", ";", "ctx", "-", ">", "end", "+", "=", "inputSize", ";", "ip", "+", "+;", "/", "*", "Main", "Loop", "*", "/", "while", "(", "ip", "<", "mflimit", ")", "{", "ml", "=", "LZ4HC_InsertAndFindBestMatch", "(", "ctx", ",", "ip", ",", "matchlimit", ",", "(", "&", "ref", ")", ",", "maxNbAttempts", ")", ";", "if", "(", "!", "ml", ")", "{", "ip", "+", "+;", "continue", ";", "}", "/", "*", "saved", ",", "in", "case", "we", "would", "skip", "too", "much", "*", "/", "start0", "=", "ip", ";", "ref0", "=", "ref", ";", "ml0", "=", "ml", ";", "_Search2", ":", "if", "(", "ip", "+", "ml", "<", "mflimit", ")", "ml2", "=", "LZ4HC_InsertAndGetWiderMatch", "(", "ctx", ",", "ip", "+", "ml", "-", "2", ",", "ip", "+", "1", ",", "matchlimit", ",", "ml", ",", "&", "ref2", ",", "&", "start2", ",", "maxNbAttempts", ")", ";", "else", "ml2", "=", "ml", ";", "if", "(", "ml2", "=", "=", "ml", ")", "/", "*", "No", "better", "match", "*", "/", "{", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml", ",", "ref", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "continue", ";", "}", "if", "(", "start0", "<", "ip", ")", "{", "if", "(", "start2", "<", "ip", "+", "ml0", ")", "/", "*", "empirical", "*", "/", "{", "ip", "=", "start0", ";", "ref", "=", "ref0", ";", "ml", "=", "ml0", ";", "}", "}", "/", "*", "Here", ",", "start0", "=", "=", "ip", "*", "/", "if", "(", "(", "start2", "-", "ip", ")", "<", "3", ")", "/", "*", "First", "Match", "too", "small", ":", "removed", "*", "/", "{", "ml", "=", "ml2", ";", "ip", "=", "start2", ";", "ref", "=", "ref2", ";", "goto", "_Search2", ";", "}", "_Search3", ":", "/", "*", "*", "Currently", "we", "have", ":", "*", "ml2", ">", "ml1", ",", "and", "*", "ip1", "+", "3", "<", "=", "ip2", "(", "usually", "<", "ip1", "+", "ml1", ")", "*", "/", "if", "(", "(", "start2", "-", "ip", ")", "<", "OPTIMAL_ML", ")", "{", "int", "correction", ";", "int", "new_ml", "=", "ml", ";", "if", "(", "new_ml", ">", "OPTIMAL_ML", ")", "new_ml", "=", "OPTIMAL_ML", ";", "if", "(", "ip", "+", "new_ml", ">", "start2", "+", "ml2", "-", "MINMATCH", ")", "new_ml", "=", "(", "int", ")", "(", "start2", "-", "ip", ")", "+", "ml2", "-", "MINMATCH", ";", "correction", "=", "new_ml", "-", "(", "int", ")", "(", "start2", "-", "ip", ")", ";", "if", "(", "correction", ">", "0", ")", "{", "start2", "+", "=", "correction", ";", "ref2", "+", "=", "correction", ";", "ml2", "-", "=", "correction", ";", "}", "}", "/", "*", "Now", ",", "we", "have", "start2", "=", "ip", "+", "new_ml", ",", "with", "new_ml", "=", "min", "(", "ml", ",", "OPTIMAL_ML", "=", "18", ")", "*", "/", "if", "(", "start2", "+", "ml2", "<", "mflimit", ")", "ml3", "=", "LZ4HC_InsertAndGetWiderMatch", "(", "ctx", ",", "start2", "+", "ml2", "-", "3", ",", "start2", ",", "matchlimit", ",", "ml2", ",", "&", "ref3", ",", "&", "start3", ",", "maxNbAttempts", ")", ";", "else", "ml3", "=", "ml2", ";", "if", "(", "ml3", "=", "=", "ml2", ")", "/", "*", "No", "better", "match", ":", "2", "sequences", "to", "encode", "*", "/", "{", "/", "*", "ip", "&", "ref", "are", "known", ";", "Now", "for", "ml", "*", "/", "if", "(", "start2", "<", "ip", "+", "ml", ")", "ml", "=", "(", "int", ")", "(", "start2", "-", "ip", ")", ";", "/", "*", "Now", ",", "encode", "2", "sequences", "*", "/", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml", ",", "ref", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "ip", "=", "start2", ";", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml2", ",", "ref2", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "continue", ";", "}", "if", "(", "start3", "<", "ip", "+", "ml", "+", "3", ")", "/", "*", "Not", "enough", "space", "for", "match", "2", ":", "remove", "it", "*", "/", "{", "if", "(", "start3", ">", "=", "(", "ip", "+", "ml", ")", ")", "/", "*", "can", "write", "Seq1", "immediately", "=", "=>", "Seq2", "is", "removed", ",", "so", "Seq3", "becomes", "Seq1", "*", "/", "{", "if", "(", "start2", "<", "ip", "+", "ml", ")", "{", "int", "correction", "=", "(", "int", ")", "(", "ip", "+", "ml", "-", "start2", ")", ";", "start2", "+", "=", "correction", ";", "ref2", "+", "=", "correction", ";", "ml2", "-", "=", "correction", ";", "if", "(", "ml2", "<", "MINMATCH", ")", "{", "start2", "=", "start3", ";", "ref2", "=", "ref3", ";", "ml2", "=", "ml3", ";", "}", "}", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml", ",", "ref", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "ip", "=", "start3", ";", "ref", "=", "ref3", ";", "ml", "=", "ml3", ";", "start0", "=", "start2", ";", "ref0", "=", "ref2", ";", "ml0", "=", "ml2", ";", "goto", "_Search2", ";", "}", "start2", "=", "start3", ";", "ref2", "=", "ref3", ";", "ml2", "=", "ml3", ";", "goto", "_Search3", ";", "}", "/", "*", "*", "OK", ",", "now", "we", "have", "3", "ascending", "matches", ";", "let", "'", "s", "write", "at", "least", "the", "first", "one", "*", "ip", "&", "ref", "are", "known", ";", "Now", "for", "ml", "*", "/", "if", "(", "start2", "<", "ip", "+", "ml", ")", "{", "if", "(", "(", "start2", "-", "ip", ")", "<", "(", "int", ")", "ML_MASK", ")", "{", "int", "correction", ";", "if", "(", "ml", ">", "OPTIMAL_ML", ")", "ml", "=", "OPTIMAL_ML", ";", "if", "(", "ip", "+", "ml", ">", "start2", "+", "ml2", "-", "MINMATCH", ")", "ml", "=", "(", "int", ")", "(", "start2", "-", "ip", ")", "+", "ml2", "-", "MINMATCH", ";", "correction", "=", "ml", "-", "(", "int", ")", "(", "start2", "-", "ip", ")", ";", "if", "(", "correction", ">", "0", ")", "{", "start2", "+", "=", "correction", ";", "ref2", "+", "=", "correction", ";", "ml2", "-", "=", "correction", ";", "}", "}", "else", "{", "ml", "=", "(", "int", ")", "(", "start2", "-", "ip", ")", ";", "}", "}", "if", "(", "LZ4HC_encodeSequence", "(", "&", "ip", ",", "&", "op", ",", "&", "anchor", ",", "ml", ",", "ref", ",", "limit", ",", "oend", ")", ")", "return", "0", ";", "ip", "=", "start2", ";", "ref", "=", "ref2", ";", "ml", "=", "ml2", ";", "start2", "=", "start3", ";", "ref2", "=", "ref3", ";", "ml2", "=", "ml3", ";", "goto", "_Search3", ";", "}", "/", "*", "Encode", "Last", "Literals", "*", "/", "{", "int", "lastRun", "=", "(", "int", ")", "(", "iend", "-", "anchor", ")", ";", "if", "(", "(", "limit", ")", "&", "&", "(", "((", "char", "*", ")", "op", "-", "dest", ")", "+", "lastRun", "+", "1", "+", "(", "(", "lastRun", "+", "255", "-", "RUN_MASK", ")", "/", "255", ")", ">", "(", "U32", ")", "maxOutputSize", ")", ")", "return", "0", ";", "/", "*", "Check", "output", "limit", "*", "/", "if", "(", "lastRun", ">", "=(", "int", ")", "RUN_MASK", ")", "{", "*", "op", "+", "+=", "(", "RUN_MASK", "<", "<", "ML_BITS", ")", ";", "lastRun", "-", "=", "RUN_MASK", ";", "for", "(", ";", "lastRun", ">", "254", ";", "lastRun", "-", "=", "255", ")", "*", "op", "+", "+", "=", "255", ";", "*", "op", "+", "+", "=", "(", "BYTE", ")", "lastRun", ";", "}", "else", "*", "op", "+", "+", "=", "(", "BYTE", ")", "(", "lastRun", "<", "<", "ML_BITS", ")", ";", "memcpy", "(", "op", ",", "anchor", ",", "iend", "-", "anchor", ")", ";", "op", "+", "=", "iend", "-", "anchor", ";", "}", "/", "*", "End", "*", "/", "return", "(", "int", ")", "(", "((", "char", "*", ")", "op", ")", "-", "dest", ")", ";", "}", "int", "LZ4_compressHC2", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "compressionLevel", ")", "{", "void", "*", "ctx", "=", "LZ4_createHC", "(", "source", ")", ";", "int", "result", ";", "if", "(", "ctx", "=", "=", "NULL", ")", "return", "0", ";", "result", "=", "LZ4HC_compress_generic", "(", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "compressionLevel", ",", "noLimit", ")", ";", "LZ4_freeHC", "(", "ctx", ")", ";", "return", "result", ";", "}", "int", "LZ4_compressHC", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "return", "LZ4_compressHC2", "(", "source", ",", "dest", ",", "inputSize", ",", "0", ")", ";", "}", "int", "LZ4_compressHC2_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "int", "compressionLevel", ")", "{", "void", "*", "ctx", "=", "LZ4_createHC", "(", "source", ")", ";", "int", "result", ";", "if", "(", "ctx", "=", "=", "NULL", ")", "return", "0", ";", "result", "=", "LZ4HC_compress_generic", "(", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "compressionLevel", ",", "limitedOutput", ")", ";", "LZ4_freeHC", "(", "ctx", ")", ";", "return", "result", ";", "}", "int", "LZ4_compressHC_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_compressHC2_limitedOutput", "(", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "0", ")", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Using", "external", "allocation", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "int", "LZ4_sizeofStateHC", "(", ")", "{", "return", "sizeof", "(", "LZ4HC_Data_Structure", ")", ";", "}", "int", "LZ4_compressHC2_withStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "compressionLevel", ")", "{", "if", "(", "((", "size_t", ")", "(", "state", ")", "&(", "sizeof", "(", "void", "*", ")-", "1", ")", ")", "!", "=", "0", ")", "return", "0", ";", "/", "*", "Error", ":", "state", "is", "not", "aligned", "for", "pointers", "(", "32", "or", "64", "bits", ")", "*", "/", "LZ4_initHC", "(", "(", "LZ4HC_Data_Structure", "*", ")", "state", ",", "(", "const", "BYTE", "*", ")", "source", ")", ";", "return", "LZ4HC_compress_generic", "(", "state", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "compressionLevel", ",", "noLimit", ")", ";", "}", "int", "LZ4_compressHC_withStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "return", "LZ4_compressHC2_withStateHC", "(", "state", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ")", ";", "}", "int", "LZ4_compressHC2_limitedOutput_withStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "int", "compressionLevel", ")", "{", "if", "(", "((", "size_t", ")", "(", "state", ")", "&(", "sizeof", "(", "void", "*", ")-", "1", ")", ")", "!", "=", "0", ")", "return", "0", ";", "/", "*", "Error", ":", "state", "is", "not", "aligned", "for", "pointers", "(", "32", "or", "64", "bits", ")", "*", "/", "LZ4_initHC", "(", "(", "LZ4HC_Data_Structure", "*", ")", "state", ",", "(", "const", "BYTE", "*", ")", "source", ")", ";", "return", "LZ4HC_compress_generic", "(", "state", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "compressionLevel", ",", "limitedOutput", ")", ";", "}", "int", "LZ4_compressHC_limitedOutput_withStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4_compressHC2_limitedOutput_withStateHC", "(", "state", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "0", ")", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Stream", "functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "int", "LZ4_compressHC_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", "{", "return", "LZ4HC_compress_generic", "(", "LZ4HC_Data", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "0", ",", "noLimit", ")", ";", "}", "int", "LZ4_compressHC2_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "compressionLevel", ")", "{", "return", "LZ4HC_compress_generic", "(", "LZ4HC_Data", ",", "source", ",", "dest", ",", "inputSize", ",", "0", ",", "compressionLevel", ",", "noLimit", ")", ";", "}", "int", "LZ4_compressHC_limitedOutput_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", "{", "return", "LZ4HC_compress_generic", "(", "LZ4HC_Data", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "0", ",", "limitedOutput", ")", ";", "}", "int", "LZ4_compressHC2_limitedOutput_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "int", "compressionLevel", ")", "{", "return", "LZ4HC_compress_generic", "(", "LZ4HC_Data", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ",", "compressionLevel", ",", "limitedOutput", ")", ";", "}", "@", "@", "-", "1", ",", "111", "+", "1", ",", "173", "@", "@", "/", "*", "LZ4", "HC", "-", "High", "Compression", "Mode", "of", "LZ4", "Header", "File", "Copyright", "(", "C", ")", "2011", "-", "2013", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "#", "pragma", "once", "#", "if", "defined", "(", "__cplusplus", ")", "extern", "\"", "C", "\"", "{", "#", "endif", "int", "LZ4_compressHC", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "/", "*", "LZ4_compressHC", ":", "return", ":", "the", "number", "of", "bytes", "in", "compressed", "buffer", "dest", "or", "0", "if", "compression", "fails", ".", "note", ":", "destination", "buffer", "must", "be", "already", "allocated", ".", "To", "avoid", "any", "problem", ",", "size", "it", "to", "handle", "worst", "cases", "situations", "(", "input", "data", "not", "compressible", ")", "Worst", "case", "size", "evaluation", "is", "provided", "by", "function", "LZ4_compressBound", "(", ")", "(", "see", "\"", "lz4", ".", "h", "\"", ")", "*", "/", "int", "LZ4_compressHC_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "LZ4_compress_limitedOutput", "(", ")", ":", "Compress", "'", "inputSize", "'", "bytes", "from", "'", "source", "'", "into", "an", "output", "buffer", "'", "dest", "'", "of", "maximum", "size", "'", "maxOutputSize", "'", ".", "If", "it", "cannot", "achieve", "it", ",", "compression", "will", "stop", ",", "and", "result", "of", "the", "function", "will", "be", "zero", ".", "This", "function", "never", "writes", "outside", "of", "provided", "output", "buffer", ".", "inputSize", ":", "Max", "supported", "value", "is", "1", "GB", "maxOutputSize", ":", "is", "maximum", "allowed", "size", "into", "the", "destination", "buffer", "(", "which", "must", "be", "already", "allocated", ")", "return", ":", "the", "number", "of", "output", "bytes", "written", "in", "buffer", "'", "dest", "'", "or", "0", "if", "compression", "fails", ".", "*", "/", "/", "*", "Note", ":", "Decompression", "functions", "are", "provided", "within", "LZ4", "source", "code", "(", "see", "\"", "lz4", ".", "h", "\"", ")", "(", "BSD", "license", ")", "*", "/", "/", "*", "Advanced", "Functions", "*", "/", "void", "*", "LZ4_createHC", "(", "const", "char", "*", "inputBuffer", ")", ";", "int", "LZ4_compressHC_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "int", "LZ4_compressHC_limitedOutput_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "char", "*", "LZ4_slideInputBufferHC", "(", "void", "*", "LZ4HC_Data", ")", ";", "int", "LZ4_freeHC", "(", "void", "*", "LZ4HC_Data", ")", ";", "/", "*", "These", "functions", "allow", "the", "compression", "of", "dependent", "blocks", ",", "where", "each", "block", "benefits", "from", "prior", "64", "KB", "within", "preceding", "blocks", ".", "In", "order", "to", "achieve", "this", ",", "it", "is", "necessary", "to", "start", "creating", "the", "LZ4HC", "Data", "Structure", ",", "thanks", "to", "the", "function", ":", "void", "*", "LZ4_createHC", "(", "const", "char", "*", "inputBuffer", ")", ";", "The", "result", "of", "the", "function", "is", "the", "(", "void", "*", ")", "pointer", "on", "the", "LZ4HC", "Data", "Structure", ".", "This", "pointer", "will", "be", "needed", "in", "all", "other", "functions", ".", "If", "the", "pointer", "returned", "is", "NULL", ",", "then", "the", "allocation", "has", "failed", ",", "and", "compression", "must", "be", "aborted", ".", "The", "only", "parameter", "'", "const", "char", "*", "inputBuffer", "'", "must", ",", "obviously", ",", "point", "at", "the", "beginning", "of", "input", "buffer", ".", "The", "input", "buffer", "must", "be", "already", "allocated", ",", "and", "size", "at", "least", "192KB", ".", "'", "inputBuffer", "'", "will", "also", "be", "the", "'", "const", "char", "*", "source", "'", "of", "the", "first", "block", ".", "All", "blocks", "are", "expected", "to", "lay", "next", "to", "each", "other", "within", "the", "input", "buffer", ",", "starting", "from", "'", "inputBuffer", "'", ".", "To", "compress", "each", "block", ",", "use", "either", "LZ4_compressHC_continue", "(", ")", "or", "LZ4_compressHC_limitedOutput_continue", "(", ").", "Their", "behavior", "are", "identical", "to", "LZ4_compressHC", "(", ")", "or", "LZ4_compressHC_limitedOutput", "(", "),", "but", "require", "the", "LZ4HC", "Data", "Structure", "as", "their", "first", "argument", ",", "and", "check", "that", "each", "block", "starts", "right", "after", "the", "previous", "one", ".", "If", "next", "block", "does", "not", "begin", "immediately", "after", "the", "previous", "one", ",", "the", "compression", "will", "fail", "(", "return", "0", ")", ".", "When", "it", "'", "s", "no", "longer", "possible", "to", "lay", "the", "next", "block", "after", "the", "previous", "one", "(", "not", "enough", "space", "left", "into", "input", "buffer", ")", ",", "a", "call", "to", ":", "char", "*", "LZ4_slideInputBufferHC", "(", "void", "*", "LZ4HC_Data", ")", ";", "must", "be", "performed", ".", "It", "will", "typically", "copy", "the", "latest", "64KB", "of", "input", "at", "the", "beginning", "of", "input", "buffer", ".", "Note", "that", ",", "for", "this", "function", "to", "work", "properly", ",", "minimum", "size", "of", "an", "input", "buffer", "must", "be", "192KB", ".", "=", "=>", "The", "memory", "position", "where", "the", "next", "input", "data", "block", "must", "start", "is", "provided", "as", "the", "result", "of", "the", "function", ".", "Compression", "can", "then", "resume", ",", "using", "LZ4_compressHC_continue", "(", ")", "or", "LZ4_compressHC_limitedOutput_continue", "(", "),", "as", "usual", ".", "When", "compression", "is", "completed", ",", "a", "call", "to", "LZ4_freeHC", "(", ")", "will", "release", "the", "memory", "used", "by", "the", "LZ4HC", "Data", "Structure", ".", "*", "/", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif", "/", "*", "LZ4", "HC", "-", "High", "Compression", "Mode", "of", "LZ4", "Header", "File", "Copyright", "(", "C", ")", "2011", "-", "2014", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "#", "pragma", "once", "#", "if", "defined", "(", "__cplusplus", ")", "extern", "\"", "C", "\"", "{", "#", "endif", "int", "LZ4_compressHC", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "/", "*", "LZ4_compressHC", ":", "return", ":", "the", "number", "of", "bytes", "in", "compressed", "buffer", "dest", "or", "0", "if", "compression", "fails", ".", "note", ":", "destination", "buffer", "must", "be", "already", "allocated", ".", "To", "avoid", "any", "problem", ",", "size", "it", "to", "handle", "worst", "cases", "situations", "(", "input", "data", "not", "compressible", ")", "Worst", "case", "size", "evaluation", "is", "provided", "by", "function", "LZ4_compressBound", "(", ")", "(", "see", "\"", "lz4", ".", "h", "\"", ")", "*", "/", "int", "LZ4_compressHC_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "/", "*", "LZ4_compress_limitedOutput", "(", ")", ":", "Compress", "'", "inputSize", "'", "bytes", "from", "'", "source", "'", "into", "an", "output", "buffer", "'", "dest", "'", "of", "maximum", "size", "'", "maxOutputSize", "'", ".", "If", "it", "cannot", "achieve", "it", ",", "compression", "will", "stop", ",", "and", "result", "of", "the", "function", "will", "be", "zero", ".", "This", "function", "never", "writes", "outside", "of", "provided", "output", "buffer", ".", "inputSize", ":", "Max", "supported", "value", "is", "1", "GB", "maxOutputSize", ":", "is", "maximum", "allowed", "size", "into", "the", "destination", "buffer", "(", "which", "must", "be", "already", "allocated", ")", "return", ":", "the", "number", "of", "output", "bytes", "written", "in", "buffer", "'", "dest", "'", "or", "0", "if", "compression", "fails", ".", "*", "/", "int", "LZ4_compressHC2", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "compressionLevel", ")", ";", "int", "LZ4_compressHC2_limitedOutput", "(", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "int", "compressionLevel", ")", ";", "/", "*", "Same", "functions", "as", "above", ",", "but", "with", "programmable", "'", "compressionLevel", "'", ".", "Recommended", "values", "are", "between", "4", "and", "9", ",", "although", "any", "value", "between", "0", "and", "16", "will", "work", ".", "'", "compressionLevel", "'", "==", "0", "means", "use", "default", "'", "compressionLevel", "'", "value", ".", "Values", "above", "16", "behave", "the", "same", "as", "16", ".", "Equivalent", "variants", "exist", "for", "all", "other", "compression", "functions", "below", ".", "*", "/", "/", "*", "Note", ":", "Decompression", "functions", "are", "provided", "within", "LZ4", "source", "code", "(", "see", "\"", "lz4", ".", "h", "\"", ")", "(", "BSD", "license", ")", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Using", "an", "external", "allocation", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "int", "LZ4_sizeofStateHC", "(", "void", ")", ";", "int", "LZ4_compressHC_withStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "int", "LZ4_compressHC_limitedOutput_withStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "int", "LZ4_compressHC2_withStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "compressionLevel", ")", ";", "int", "LZ4_compressHC2_limitedOutput_withStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "int", "compressionLevel", ")", ";", "/", "*", "These", "functions", "are", "provided", "should", "you", "prefer", "to", "allocate", "memory", "for", "compression", "tables", "with", "your", "own", "allocation", "methods", ".", "To", "know", "how", "much", "memory", "must", "be", "allocated", "for", "the", "compression", "tables", ",", "use", ":", "int", "LZ4_sizeofStateHC", "(", ");", "Note", "that", "tables", "must", "be", "aligned", "for", "pointer", "(", "32", "or", "64", "bits", ")", ",", "otherwise", "compression", "will", "fail", "(", "return", "code", "0", ")", ".", "The", "allocated", "memory", "can", "be", "provided", "to", "the", "compressions", "functions", "using", "'", "void", "*", "state", "'", "parameter", ".", "LZ4_compress_withStateHC", "(", ")", "and", "LZ4_compress_limitedOutput_withStateHC", "(", ")", "are", "equivalent", "to", "previously", "described", "functions", ".", "They", "just", "use", "the", "externally", "allocated", "memory", "area", "instead", "of", "allocating", "their", "own", "(", "on", "stack", ",", "or", "on", "heap", ")", ".", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Streaming", "Functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "*", "Note", ":", "these", "streaming", "functions", "still", "follows", "the", "older", "model", "*", "/", "void", "*", "LZ4_createHC", "(", "const", "char", "*", "inputBuffer", ")", ";", "int", "LZ4_compressHC_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "int", "LZ4_compressHC_limitedOutput_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ")", ";", "char", "*", "LZ4_slideInputBufferHC", "(", "void", "*", "LZ4HC_Data", ")", ";", "int", "LZ4_freeHC", "(", "void", "*", "LZ4HC_Data", ")", ";", "int", "LZ4_compressHC2_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "compressionLevel", ")", ";", "int", "LZ4_compressHC2_limitedOutput_continue", "(", "void", "*", "LZ4HC_Data", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "int", "compressionLevel", ")", ";", "/", "*", "These", "functions", "allow", "the", "compression", "of", "dependent", "blocks", ",", "where", "each", "block", "benefits", "from", "prior", "64", "KB", "within", "preceding", "blocks", ".", "In", "order", "to", "achieve", "this", ",", "it", "is", "necessary", "to", "start", "creating", "the", "LZ4HC", "Data", "Structure", ",", "thanks", "to", "the", "function", ":", "void", "*", "LZ4_createHC", "(", "const", "char", "*", "inputBuffer", ")", ";", "The", "result", "of", "the", "function", "is", "the", "(", "void", "*", ")", "pointer", "on", "the", "LZ4HC", "Data", "Structure", ".", "This", "pointer", "will", "be", "needed", "in", "all", "other", "functions", ".", "If", "the", "pointer", "returned", "is", "NULL", ",", "then", "the", "allocation", "has", "failed", ",", "and", "compression", "must", "be", "aborted", ".", "The", "only", "parameter", "'", "const", "char", "*", "inputBuffer", "'", "must", ",", "obviously", ",", "point", "at", "the", "beginning", "of", "input", "buffer", ".", "The", "input", "buffer", "must", "be", "already", "allocated", ",", "and", "size", "at", "least", "192KB", ".", "'", "inputBuffer", "'", "will", "also", "be", "the", "'", "const", "char", "*", "source", "'", "of", "the", "first", "block", ".", "All", "blocks", "are", "expected", "to", "lay", "next", "to", "each", "other", "within", "the", "input", "buffer", ",", "starting", "from", "'", "inputBuffer", "'", ".", "To", "compress", "each", "block", ",", "use", "either", "LZ4_compressHC_continue", "(", ")", "or", "LZ4_compressHC_limitedOutput_continue", "(", ").", "Their", "behavior", "are", "identical", "to", "LZ4_compressHC", "(", ")", "or", "LZ4_compressHC_limitedOutput", "(", "),", "but", "require", "the", "LZ4HC", "Data", "Structure", "as", "their", "first", "argument", ",", "and", "check", "that", "each", "block", "starts", "right", "after", "the", "previous", "one", ".", "If", "next", "block", "does", "not", "begin", "immediately", "after", "the", "previous", "one", ",", "the", "compression", "will", "fail", "(", "return", "0", ")", ".", "When", "it", "'", "s", "no", "longer", "possible", "to", "lay", "the", "next", "block", "after", "the", "previous", "one", "(", "not", "enough", "space", "left", "into", "input", "buffer", ")", ",", "a", "call", "to", ":", "char", "*", "LZ4_slideInputBufferHC", "(", "void", "*", "LZ4HC_Data", ")", ";", "must", "be", "performed", ".", "It", "will", "typically", "copy", "the", "latest", "64KB", "of", "input", "at", "the", "beginning", "of", "input", "buffer", ".", "Note", "that", ",", "for", "this", "function", "to", "work", "properly", ",", "minimum", "size", "of", "an", "input", "buffer", "must", "be", "192KB", ".", "=", "=>", "The", "memory", "position", "where", "the", "next", "input", "data", "block", "must", "start", "is", "provided", "as", "the", "result", "of", "the", "function", ".", "Compression", "can", "then", "resume", ",", "using", "LZ4_compressHC_continue", "(", ")", "or", "LZ4_compressHC_limitedOutput_continue", "(", "),", "as", "usual", ".", "When", "compression", "is", "completed", ",", "a", "call", "to", "LZ4_freeHC", "(", ")", "will", "release", "the", "memory", "used", "by", "the", "LZ4HC", "Data", "Structure", ".", "*", "/", "int", "LZ4_sizeofStreamStateHC", "(", "void", ")", ";", "int", "LZ4_resetStreamStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "inputBuffer", ")", ";", "/", "*", "These", "functions", "achieve", "the", "same", "result", "as", ":", "void", "*", "LZ4_createHC", "(", "const", "char", "*", "inputBuffer", ")", ";", "They", "are", "provided", "here", "to", "allow", "the", "user", "program", "to", "allocate", "memory", "using", "its", "own", "routines", ".", "To", "know", "how", "much", "space", "must", "be", "allocated", ",", "use", "LZ4_sizeofStreamStateHC", "(", ");", "Note", "also", "that", "space", "must", "be", "aligned", "for", "pointers", "(", "32", "or", "64", "bits", ")", ".", "Once", "space", "is", "allocated", ",", "you", "must", "initialize", "it", "using", ":", "LZ4_resetStreamStateHC", "(", "void", "*", "state", ",", "const", "char", "*", "inputBuffer", ")", ";", "void", "*", "state", "is", "a", "pointer", "to", "the", "space", "allocated", ".", "It", "must", "be", "aligned", "for", "pointers", "(", "32", "or", "64", "bits", ")", ",", "and", "be", "large", "enough", ".", "The", "parameter", "'", "const", "char", "*", "inputBuffer", "'", "must", ",", "obviously", ",", "point", "at", "the", "beginning", "of", "input", "buffer", ".", "The", "input", "buffer", "must", "be", "already", "allocated", ",", "and", "size", "at", "least", "192KB", ".", "'", "inputBuffer", "'", "will", "also", "be", "the", "'", "const", "char", "*", "source", "'", "of", "the", "first", "block", ".", "The", "same", "space", "can", "be", "re", "-", "used", "multiple", "times", ",", "just", "by", "initializing", "it", "each", "time", "with", "LZ4_resetStreamState", "(", ").", "return", "value", "of", "LZ4_resetStreamStateHC", "(", ")", "must", "be", "0", "is", "OK", ".", "Any", "other", "value", "means", "there", "was", "an", "error", "(", "typically", ",", "state", "is", "not", "aligned", "for", "pointers", "(", "32", "or", "64", "bits", ")", ").", "*", "/", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif", "@", "@", "-", "0", ",", "0", "+", "1", ",", "339", "@", "@", "GNU", "GENERAL", "PUBLIC", "LICENSE", "Version", "2", ",", "June", "1991", "Copyright", "(", "C", ")", "1989", ",", "1991", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", "Everyone", "is", "permitted", "to", "copy", "and", "distribute", "verbatim", "copies", "of", "this", "license", "document", ",", "but", "changing", "it", "is", "not", "allowed", ".", "Preamble", "The", "licenses", "for", "most", "software", "are", "designed", "to", "take", "away", "your", "freedom", "to", "share", "and", "change", "it", ".", "By", "contrast", ",", "the", "GNU", "General", "Public", "License", "is", "intended", "to", "guarantee", "your", "freedom", "to", "share", "and", "change", "free", "software", "-", "-", "to", "make", "sure", "the", "software", "is", "free", "for", "all", "its", "users", ".", "This", "General", "Public", "License", "applies", "to", "most", "of", "the", "Free", "Software", "Foundation", "'", "s", "software", "and", "to", "any", "other", "program", "whose", "authors", "commit", "to", "using", "it", ".", "(", "Some", "other", "Free", "Software", "Foundation", "software", "is", "covered", "by", "the", "GNU", "Lesser", "General", "Public", "License", "instead", ".", ")", "You", "can", "apply", "it", "to", "your", "programs", ",", "too", ".", "When", "we", "speak", "of", "free", "software", ",", "we", "are", "referring", "to", "freedom", ",", "not", "price", ".", "Our", "General", "Public", "Licenses", "are", "designed", "to", "make", "sure", "that", "you", "have", "the", "freedom", "to", "distribute", "copies", "of", "free", "software", "(", "and", "charge", "for", "this", "service", "if", "you", "wish", ")", ",", "that", "you", "receive", "source", "code", "or", "can", "get", "it", "if", "you", "want", "it", ",", "that", "you", "can", "change", "the", "software", "or", "use", "pieces", "of", "it", "in", "new", "free", "programs", ";", "and", "that", "you", "know", "you", "can", "do", "these", "things", ".", "To", "protect", "your", "rights", ",", "we", "need", "to", "make", "restrictions", "that", "forbid", "anyone", "to", "deny", "you", "these", "rights", "or", "to", "ask", "you", "to", "surrender", "the", "rights", ".", "These", "restrictions", "translate", "to", "certain", "responsibilities", "for", "you", "if", "you", "distribute", "copies", "of", "the", "software", ",", "or", "if", "you", "modify", "it", ".", "For", "example", ",", "if", "you", "distribute", "copies", "of", "such", "a", "program", ",", "whether", "gratis", "or", "for", "a", "fee", ",", "you", "must", "give", "the", "recipients", "all", "the", "rights", "that", "you", "have", ".", "You", "must", "make", "sure", "that", "they", ",", "too", ",", "receive", "or", "can", "get", "the", "source", "code", ".", "And", "you", "must", "show", "them", "these", "terms", "so", "they", "know", "their", "rights", ".", "We", "protect", "your", "rights", "with", "two", "steps", ":", "(", "1", ")", "copyright", "the", "software", ",", "and", "(", "2", ")", "offer", "you", "this", "license", "which", "gives", "you", "legal", "permission", "to", "copy", ",", "distribute", "and", "/", "or", "modify", "the", "software", ".", "Also", ",", "for", "each", "author", "'", "s", "protection", "and", "ours", ",", "we", "want", "to", "make", "certain", "that", "everyone", "understands", "that", "there", "is", "no", "warranty", "for", "this", "free", "software", ".", "If", "the", "software", "is", "modified", "by", "someone", "else", "and", "passed", "on", ",", "we", "want", "its", "recipients", "to", "know", "that", "what", "they", "have", "is", "not", "the", "original", ",", "so", "that", "any", "problems", "introduced", "by", "others", "will", "not", "reflect", "on", "the", "original", "authors", "'", "reputations", ".", "Finally", ",", "any", "free", "program", "is", "threatened", "constantly", "by", "software", "patents", ".", "We", "wish", "to", "avoid", "the", "danger", "that", "redistributors", "of", "a", "free", "program", "will", "individually", "obtain", "patent", "licenses", ",", "in", "effect", "making", "the", "program", "proprietary", ".", "To", "prevent", "this", ",", "we", "have", "made", "it", "clear", "that", "any", "patent", "must", "be", "licensed", "for", "everyone", "'", "s", "free", "use", "or", "not", "licensed", "at", "all", ".", "The", "precise", "terms", "and", "conditions", "for", "copying", ",", "distribution", "and", "modification", "follow", ".", "GNU", "GENERAL", "PUBLIC", "LICENSE", "TERMS", "AND", "CONDITIONS", "FOR", "COPYING", ",", "DISTRIBUTION", "AND", "MODIFICATION", "0", ".", "This", "License", "applies", "to", "any", "program", "or", "other", "work", "which", "contains", "a", "notice", "placed", "by", "the", "copyright", "holder", "saying", "it", "may", "be", "distributed", "under", "the", "terms", "of", "this", "General", "Public", "License", ".", "The", "\"", "Program", "\"", ",", "below", ",", "refers", "to", "any", "such", "program", "or", "work", ",", "and", "a", "\"", "work", "based", "on", "the", "Program", "\"", "means", "either", "the", "Program", "or", "any", "derivative", "work", "under", "copyright", "law", ":", "that", "is", "to", "say", ",", "a", "work", "containing", "the", "Program", "or", "a", "portion", "of", "it", ",", "either", "verbatim", "or", "with", "modifications", "and", "/", "or", "translated", "into", "another", "language", ".", "(", "Hereinafter", ",", "translation", "is", "included", "without", "limitation", "in", "the", "term", "\"", "modification", "\"", ".)", "Each", "licensee", "is", "addressed", "as", "\"", "you", "\"", ".", "Activities", "other", "than", "copying", ",", "distribution", "and", "modification", "are", "not", "covered", "by", "this", "License", ";", "they", "are", "outside", "its", "scope", ".", "The", "act", "of", "running", "the", "Program", "is", "not", "restricted", ",", "and", "the", "output", "from", "the", "Program", "is", "covered", "only", "if", "its", "contents", "constitute", "a", "work", "based", "on", "the", "Program", "(", "independent", "of", "having", "been", "made", "by", "running", "the", "Program", ")", ".", "Whether", "that", "is", "true", "depends", "on", "what", "the", "Program", "does", ".", "1", ".", "You", "may", "copy", "and", "distribute", "verbatim", "copies", "of", "the", "Program", "'", "s", "source", "code", "as", "you", "receive", "it", ",", "in", "any", "medium", ",", "provided", "that", "you", "conspicuously", "and", "appropriately", "publish", "on", "each", "copy", "an", "appropriate", "copyright", "notice", "and", "disclaimer", "of", "warranty", ";", "keep", "intact", "all", "the", "notices", "that", "refer", "to", "this", "License", "and", "to", "the", "absence", "of", "any", "warranty", ";", "and", "give", "any", "other", "recipients", "of", "the", "Program", "a", "copy", "of", "this", "License", "along", "with", "the", "Program", ".", "You", "may", "charge", "a", "fee", "for", "the", "physical", "act", "of", "transferring", "a", "copy", ",", "and", "you", "may", "at", "your", "option", "offer", "warranty", "protection", "in", "exchange", "for", "a", "fee", ".", "2", ".", "You", "may", "modify", "your", "copy", "or", "copies", "of", "the", "Program", "or", "any", "portion", "of", "it", ",", "thus", "forming", "a", "work", "based", "on", "the", "Program", ",", "and", "copy", "and", "distribute", "such", "modifications", "or", "work", "under", "the", "terms", "of", "Section", "1", "above", ",", "provided", "that", "you", "also", "meet", "all", "of", "these", "conditions", ":", "a", ")", "You", "must", "cause", "the", "modified", "files", "to", "carry", "prominent", "notices", "stating", "that", "you", "changed", "the", "files", "and", "the", "date", "of", "any", "change", ".", "b", ")", "You", "must", "cause", "any", "work", "that", "you", "distribute", "or", "publish", ",", "that", "in", "whole", "or", "in", "part", "contains", "or", "is", "derived", "from", "the", "Program", "or", "any", "part", "thereof", ",", "to", "be", "licensed", "as", "a", "whole", "at", "no", "charge", "to", "all", "third", "parties", "under", "the", "terms", "of", "this", "License", ".", "c", ")", "If", "the", "modified", "program", "normally", "reads", "commands", "interactively", "when", "run", ",", "you", "must", "cause", "it", ",", "when", "started", "running", "for", "such", "interactive", "use", "in", "the", "most", "ordinary", "way", ",", "to", "print", "or", "display", "an", "announcement", "including", "an", "appropriate", "copyright", "notice", "and", "a", "notice", "that", "there", "is", "no", "warranty", "(", "or", "else", ",", "saying", "that", "you", "provide", "a", "warranty", ")", "and", "that", "users", "may", "redistribute", "the", "program", "under", "these", "conditions", ",", "and", "telling", "the", "user", "how", "to", "view", "a", "copy", "of", "this", "License", ".", "(", "Exception", ":", "if", "the", "Program", "itself", "is", "interactive", "but", "does", "not", "normally", "print", "such", "an", "announcement", ",", "your", "work", "based", "on", "the", "Program", "is", "not", "required", "to", "print", "an", "announcement", ".", ")", "These", "requirements", "apply", "to", "the", "modified", "work", "as", "a", "whole", ".", "If", "identifiable", "sections", "of", "that", "work", "are", "not", "derived", "from", "the", "Program", ",", "and", "can", "be", "reasonably", "considered", "independent", "and", "separate", "works", "in", "themselves", ",", "then", "this", "License", ",", "and", "its", "terms", ",", "do", "not", "apply", "to", "those", "sections", "when", "you", "distribute", "them", "as", "separate", "works", ".", "But", "when", "you", "distribute", "the", "same", "sections", "as", "part", "of", "a", "whole", "which", "is", "a", "work", "based", "on", "the", "Program", ",", "the", "distribution", "of", "the", "whole", "must", "be", "on", "the", "terms", "of", "this", "License", ",", "whose", "permissions", "for", "other", "licensees", "extend", "to", "the", "entire", "whole", ",", "and", "thus", "to", "each", "and", "every", "part", "regardless", "of", "who", "wrote", "it", ".", "Thus", ",", "it", "is", "not", "the", "intent", "of", "this", "section", "to", "claim", "rights", "or", "contest", "your", "rights", "to", "work", "written", "entirely", "by", "you", ";", "rather", ",", "the", "intent", "is", "to", "exercise", "the", "right", "to", "control", "the", "distribution", "of", "derivative", "or", "collective", "works", "based", "on", "the", "Program", ".", "In", "addition", ",", "mere", "aggregation", "of", "another", "work", "not", "based", "on", "the", "Program", "with", "the", "Program", "(", "or", "with", "a", "work", "based", "on", "the", "Program", ")", "on", "a", "volume", "of", "a", "storage", "or", "distribution", "medium", "does", "not", "bring", "the", "other", "work", "under", "the", "scope", "of", "this", "License", ".", "3", ".", "You", "may", "copy", "and", "distribute", "the", "Program", "(", "or", "a", "work", "based", "on", "it", ",", "under", "Section", "2", ")", "in", "object", "code", "or", "executable", "form", "under", "the", "terms", "of", "Sections", "1", "and", "2", "above", "provided", "that", "you", "also", "do", "one", "of", "the", "following", ":", "a", ")", "Accompany", "it", "with", "the", "complete", "corresponding", "machine", "-", "readable", "source", "code", ",", "which", "must", "be", "distributed", "under", "the", "terms", "of", "Sections", "1", "and", "2", "above", "on", "a", "medium", "customarily", "used", "for", "software", "interchange", ";", "or", ",", "b", ")", "Accompany", "it", "with", "a", "written", "offer", ",", "valid", "for", "at", "least", "three", "years", ",", "to", "give", "any", "third", "party", ",", "for", "a", "charge", "no", "more", "than", "your", "cost", "of", "physically", "performing", "source", "distribution", ",", "a", "complete", "machine", "-", "readable", "copy", "of", "the", "corresponding", "source", "code", ",", "to", "be", "distributed", "under", "the", "terms", "of", "Sections", "1", "and", "2", "above", "on", "a", "medium", "customarily", "used", "for", "software", "interchange", ";", "or", ",", "c", ")", "Accompany", "it", "with", "the", "information", "you", "received", "as", "to", "the", "offer", "to", "distribute", "corresponding", "source", "code", ".", "(", "This", "alternative", "is", "allowed", "only", "for", "noncommercial", "distribution", "and", "only", "if", "you", "received", "the", "program", "in", "object", "code", "or", "executable", "form", "with", "such", "an", "offer", ",", "in", "accord", "with", "Subsection", "b", "above", ".", ")", "The", "source", "code", "for", "a", "work", "means", "the", "preferred", "form", "of", "the", "work", "for", "making", "modifications", "to", "it", ".", "For", "an", "executable", "work", ",", "complete", "source", "code", "means", "all", "the", "source", "code", "for", "all", "modules", "it", "contains", ",", "plus", "any", "associated", "interface", "definition", "files", ",", "plus", "the", "scripts", "used", "to", "control", "compilation", "and", "installation", "of", "the", "executable", ".", "However", ",", "as", "a", "special", "exception", ",", "the", "source", "code", "distributed", "need", "not", "include", "anything", "that", "is", "normally", "distributed", "(", "in", "either", "source", "or", "binary", "form", ")", "with", "the", "major", "components", "(", "compiler", ",", "kernel", ",", "and", "so", "on", ")", "of", "the", "operating", "system", "on", "which", "the", "executable", "runs", ",", "unless", "that", "component", "itself", "accompanies", "the", "executable", ".", "If", "distribution", "of", "executable", "or", "object", "code", "is", "made", "by", "offering", "access", "to", "copy", "from", "a", "designated", "place", ",", "then", "offering", "equivalent", "access", "to", "copy", "the", "source", "code", "from", "the", "same", "place", "counts", "as", "distribution", "of", "the", "source", "code", ",", "even", "though", "third", "parties", "are", "not", "compelled", "to", "copy", "the", "source", "along", "with", "the", "object", "code", ".", "4", ".", "You", "may", "not", "copy", ",", "modify", ",", "sublicense", ",", "or", "distribute", "the", "Program", "except", "as", "expressly", "provided", "under", "this", "License", ".", "Any", "attempt", "otherwise", "to", "copy", ",", "modify", ",", "sublicense", "or", "distribute", "the", "Program", "is", "void", ",", "and", "will", "automatically", "terminate", "your", "rights", "under", "this", "License", ".", "However", ",", "parties", "who", "have", "received", "copies", ",", "or", "rights", ",", "from", "you", "under", "this", "License", "will", "not", "have", "their", "licenses", "terminated", "so", "long", "as", "such", "parties", "remain", "in", "full", "compliance", ".", "5", ".", "You", "are", "not", "required", "to", "accept", "this", "License", ",", "since", "you", "have", "not", "signed", "it", ".", "However", ",", "nothing", "else", "grants", "you", "permission", "to", "modify", "or", "distribute", "the", "Program", "or", "its", "derivative", "works", ".", "These", "actions", "are", "prohibited", "by", "law", "if", "you", "do", "not", "accept", "this", "License", ".", "Therefore", ",", "by", "modifying", "or", "distributing", "the", "Program", "(", "or", "any", "work", "based", "on", "the", "Program", ")", ",", "you", "indicate", "your", "acceptance", "of", "this", "License", "to", "do", "so", ",", "and", "all", "its", "terms", "and", "conditions", "for", "copying", ",", "distributing", "or", "modifying", "the", "Program", "or", "works", "based", "on", "it", ".", "6", ".", "Each", "time", "you", "redistribute", "the", "Program", "(", "or", "any", "work", "based", "on", "the", "Program", ")", ",", "the", "recipient", "automatically", "receives", "a", "license", "from", "the", "original", "licensor", "to", "copy", ",", "distribute", "or", "modify", "the", "Program", "subject", "to", "these", "terms", "and", "conditions", ".", "You", "may", "not", "impose", "any", "further", "restrictions", "on", "the", "recipients", "'", "exercise", "of", "the", "rights", "granted", "herein", ".", "You", "are", "not", "responsible", "for", "enforcing", "compliance", "by", "third", "parties", "to", "this", "License", ".", "7", ".", "If", ",", "as", "a", "consequence", "of", "a", "court", "judgment", "or", "allegation", "of", "patent", "infringement", "or", "for", "any", "other", "reason", "(", "not", "limited", "to", "patent", "issues", ")", ",", "conditions", "are", "imposed", "on", "you", "(", "whether", "by", "court", "order", ",", "agreement", "or", "otherwise", ")", "that", "contradict", "the", "conditions", "of", "this", "License", ",", "they", "do", "not", "excuse", "you", "from", "the", "conditions", "of", "this", "License", ".", "If", "you", "cannot", "distribute", "so", "as", "to", "satisfy", "simultaneously", "your", "obligations", "under", "this", "License", "and", "any", "other", "pertinent", "obligations", ",", "then", "as", "a", "consequence", "you", "may", "not", "distribute", "the", "Program", "at", "all", ".", "For", "example", ",", "if", "a", "patent", "license", "would", "not", "permit", "royalty", "-", "free", "redistribution", "of", "the", "Program", "by", "all", "those", "who", "receive", "copies", "directly", "or", "indirectly", "through", "you", ",", "then", "the", "only", "way", "you", "could", "satisfy", "both", "it", "and", "this", "License", "would", "be", "to", "refrain", "entirely", "from", "distribution", "of", "the", "Program", ".", "If", "any", "portion", "of", "this", "section", "is", "held", "invalid", "or", "unenforceable", "under", "any", "particular", "circumstance", ",", "the", "balance", "of", "the", "section", "is", "intended", "to", "apply", "and", "the", "section", "as", "a", "whole", "is", "intended", "to", "apply", "in", "other", "circumstances", ".", "It", "is", "not", "the", "purpose", "of", "this", "section", "to", "induce", "you", "to", "infringe", "any", "patents", "or", "other", "property", "right", "claims", "or", "to", "contest", "validity", "of", "any", "such", "claims", ";", "this", "section", "has", "the", "sole", "purpose", "of", "protecting", "the", "integrity", "of", "the", "free", "software", "distribution", "system", ",", "which", "is", "implemented", "by", "public", "license", "practices", ".", "Many", "people", "have", "made", "generous", "contributions", "to", "the", "wide", "range", "of", "software", "distributed", "through", "that", "system", "in", "reliance", "on", "consistent", "application", "of", "that", "system", ";", "it", "is", "up", "to", "the", "author", "/", "donor", "to", "decide", "if", "he", "or", "she", "is", "willing", "to", "distribute", "software", "through", "any", "other", "system", "and", "a", "licensee", "cannot", "impose", "that", "choice", ".", "This", "section", "is", "intended", "to", "make", "thoroughly", "clear", "what", "is", "believed", "to", "be", "a", "consequence", "of", "the", "rest", "of", "this", "License", ".", "8", ".", "If", "the", "distribution", "and", "/", "or", "use", "of", "the", "Program", "is", "restricted", "in", "certain", "countries", "either", "by", "patents", "or", "by", "copyrighted", "interfaces", ",", "the", "original", "copyright", "holder", "who", "places", "the", "Program", "under", "this", "License", "may", "add", "an", "explicit", "geographical", "distribution", "limitation", "excluding", "those", "countries", ",", "so", "that", "distribution", "is", "permitted", "only", "in", "or", "among", "countries", "not", "thus", "excluded", ".", "In", "such", "case", ",", "this", "License", "incorporates", "the", "limitation", "as", "if", "written", "in", "the", "body", "of", "this", "License", ".", "9", ".", "The", "Free", "Software", "Foundation", "may", "publish", "revised", "and", "/", "or", "new", "versions", "of", "the", "General", "Public", "License", "from", "time", "to", "time", ".", "Such", "new", "versions", "will", "be", "similar", "in", "spirit", "to", "the", "present", "version", ",", "but", "may", "differ", "in", "detail", "to", "address", "new", "problems", "or", "concerns", ".", "Each", "version", "is", "given", "a", "distinguishing", "version", "number", ".", "If", "the", "Program", "specifies", "a", "version", "number", "of", "this", "License", "which", "applies", "to", "it", "and", "\"", "any", "later", "version", "\"", ",", "you", "have", "the", "option", "of", "following", "the", "terms", "and", "conditions", "either", "of", "that", "version", "or", "of", "any", "later", "version", "published", "by", "the", "Free", "Software", "Foundation", ".", "If", "the", "Program", "does", "not", "specify", "a", "version", "number", "of", "this", "License", ",", "you", "may", "choose", "any", "version", "ever", "published", "by", "the", "Free", "Software", "Foundation", ".", "10", ".", "If", "you", "wish", "to", "incorporate", "parts", "of", "the", "Program", "into", "other", "free", "programs", "whose", "distribution", "conditions", "are", "different", ",", "write", "to", "the", "author", "to", "ask", "for", "permission", ".", "For", "software", "which", "is", "copyrighted", "by", "the", "Free", "Software", "Foundation", ",", "write", "to", "the", "Free", "Software", "Foundation", ";", "we", "sometimes", "make", "exceptions", "for", "this", ".", "Our", "decision", "will", "be", "guided", "by", "the", "two", "goals", "of", "preserving", "the", "free", "status", "of", "all", "derivatives", "of", "our", "free", "software", "and", "of", "promoting", "the", "sharing", "and", "reuse", "of", "software", "generally", ".", "NO", "WARRANTY", "11", ".", "BECAUSE", "THE", "PROGRAM", "IS", "LICENSED", "FREE", "OF", "CHARGE", ",", "THERE", "IS", "NO", "WARRANTY", "FOR", "THE", "PROGRAM", ",", "TO", "THE", "EXTENT", "PERMITTED", "BY", "APPLICABLE", "LAW", ".", "EXCEPT", "WHEN", "OTHERWISE", "STATED", "IN", "WRITING", "THE", "COPYRIGHT", "HOLDERS", "AND", "/", "OR", "OTHER", "PARTIES", "PROVIDE", "THE", "PROGRAM", "\"", "AS", "IS", "\"", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EITHER", "EXPRESSED", "OR", "IMPLIED", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "THE", "ENTIRE", "RISK", "AS", "TO", "THE", "QUALITY", "AND", "PERFORMANCE", "OF", "THE", "PROGRAM", "IS", "WITH", "YOU", ".", "SHOULD", "THE", "PROGRAM", "PROVE", "DEFECTIVE", ",", "YOU", "ASSUME", "THE", "COST", "OF", "ALL", "NECESSARY", "SERVICING", ",", "REPAIR", "OR", "CORRECTION", ".", "12", ".", "IN", "NO", "EVENT", "UNLESS", "REQUIRED", "BY", "APPLICABLE", "LAW", "OR", "AGREED", "TO", "IN", "WRITING", "WILL", "ANY", "COPYRIGHT", "HOLDER", ",", "OR", "ANY", "OTHER", "PARTY", "WHO", "MAY", "MODIFY", "AND", "/", "OR", "REDISTRIBUTE", "THE", "PROGRAM", "AS", "PERMITTED", "ABOVE", ",", "BE", "LIABLE", "TO", "YOU", "FOR", "DAMAGES", ",", "INCLUDING", "ANY", "GENERAL", ",", "SPECIAL", ",", "INCIDENTAL", "OR", "CONSEQUENTIAL", "DAMAGES", "ARISING", "OUT", "OF", "THE", "USE", "OR", "INABILITY", "TO", "USE", "THE", "PROGRAM", "(", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "LOSS", "OF", "DATA", "OR", "DATA", "BEING", "RENDERED", "INACCURATE", "OR", "LOSSES", "SUSTAINED", "BY", "YOU", "OR", "THIRD", "PARTIES", "OR", "A", "FAILURE", "OF", "THE", "PROGRAM", "TO", "OPERATE", "WITH", "ANY", "OTHER", "PROGRAMS", ")", ",", "EVEN", "IF", "SUCH", "HOLDER", "OR", "OTHER", "PARTY", "HAS", "BEEN", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGES", ".", "END", "OF", "TERMS", "AND", "CONDITIONS", "How", "to", "Apply", "These", "Terms", "to", "Your", "New", "Programs", "If", "you", "develop", "a", "new", "program", ",", "and", "you", "want", "it", "to", "be", "of", "the", "greatest", "possible", "use", "to", "the", "public", ",", "the", "best", "way", "to", "achieve", "this", "is", "to", "make", "it", "free", "software", "which", "everyone", "can", "redistribute", "and", "change", "under", "these", "terms", ".", "To", "do", "so", ",", "attach", "the", "following", "notices", "to", "the", "program", ".", "It", "is", "safest", "to", "attach", "them", "to", "the", "start", "of", "each", "source", "file", "to", "most", "effectively", "convey", "the", "exclusion", "of", "warranty", ";", "and", "each", "file", "should", "have", "at", "least", "the", "\"", "copyright", "\"", "line", "and", "a", "pointer", "to", "where", "the", "full", "notice", "is", "found", ".", "<", "one", "line", "to", "give", "the", "program", "'", "s", "name", "and", "a", "brief", "idea", "of", "what", "it", "does", ".", ">", "Copyright", "(", "C", ")", "<", "year", ">", "<", "name", "of", "author", ">", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "Also", "add", "information", "on", "how", "to", "contact", "you", "by", "electronic", "and", "paper", "mail", ".", "If", "the", "program", "is", "interactive", ",", "make", "it", "output", "a", "short", "notice", "like", "this", "when", "it", "starts", "in", "an", "interactive", "mode", ":", "Gnomovision", "version", "69", ",", "Copyright", "(", "C", ")", "year", "name", "of", "author", "Gnomovision", "comes", "with", "ABSOLUTELY", "NO", "WARRANTY", ";", "for", "details", "type", "`", "show", "w", "'", ".", "This", "is", "free", "software", ",", "and", "you", "are", "welcome", "to", "redistribute", "it", "under", "certain", "conditions", ";", "type", "`", "show", "c", "'", "for", "details", ".", "The", "hypothetical", "commands", "`", "show", "w", "'", "and", "`", "show", "c", "'", "should", "show", "the", "appropriate", "parts", "of", "the", "General", "Public", "License", ".", "Of", "course", ",", "the", "commands", "you", "use", "may", "be", "called", "something", "other", "than", "`", "show", "w", "'", "and", "`", "show", "c", "'", ";", "they", "could", "even", "be", "mouse", "-", "clicks", "or", "menu", "items", "-", "-", "whatever", "suits", "your", "program", ".", "You", "should", "also", "get", "your", "employer", "(", "if", "you", "work", "as", "a", "programmer", ")", "or", "your", "school", ",", "if", "any", ",", "to", "sign", "a", "\"", "copyright", "disclaimer", "\"", "for", "the", "program", ",", "if", "necessary", ".", "Here", "is", "a", "sample", ";", "alter", "the", "names", ":", "Yoyodyne", ",", "Inc", ".", ",", "hereby", "disclaims", "all", "copyright", "interest", "in", "the", "program", "`", "Gnomovision", "'", "(", "which", "makes", "passes", "at", "compilers", ")", "written", "by", "James", "Hacker", ".", "<", "signature", "of", "Ty", "Coon", ">", ",", "1", "April", "1989", "Ty", "Coon", ",", "President", "of", "Vice", "This", "General", "Public", "License", "does", "not", "permit", "incorporating", "your", "program", "into", "proprietary", "programs", ".", "If", "your", "program", "is", "a", "subroutine", "library", ",", "you", "may", "consider", "it", "more", "useful", "to", "permit", "linking", "proprietary", "applications", "with", "the", "library", ".", "If", "this", "is", "what", "you", "want", "to", "do", ",", "use", "the", "GNU", "Lesser", "General", "Public", "License", "instead", "of", "this", "License", ".", "@", "@", "-", "0", ",", "0", "+", "1", ",", "170", "@", "@", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "#", "LZ4", "programs", "-", "Makefile", "#", "Copyright", "(", "C", ")", "Yann", "Collet", "2011", "-", "2014", "#", "GPL", "v2", "License", "#", "#", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "#", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "#", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "#", "(", "at", "your", "option", ")", "any", "later", "version", ".", "#", "#", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "#", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "#", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "#", "GNU", "General", "Public", "License", "for", "more", "details", ".", "#", "#", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "#", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "#", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "#", "#", "You", "can", "contact", "the", "author", "at", ":", "#", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "#", "-", "LZ4", "forum", "froup", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "#!", "forum", "/", "lz4c", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "#", "lz4", ":", "Command", "Line", "Utility", ",", "supporting", "gzip", "-", "like", "arguments", "#", "lz4c", ":", "CLU", ",", "supporting", "also", "legacy", "lz4demo", "arguments", "#", "lz4c32", ":", "Same", "as", "lz4c", ",", "but", "forced", "to", "compile", "in", "32", "-", "bits", "mode", "#", "fuzzer", ":", "Test", "tool", ",", "to", "check", "lz4", "integrity", "on", "target", "platform", "#", "fuzzer32", ":", "Same", "as", "fuzzer", ",", "but", "forced", "to", "compile", "in", "32", "-", "bits", "mode", "#", "fullbench", ":", "Precisely", "measure", "speed", "for", "each", "LZ4", "function", "variant", "#", "fullbench32", ":", "Same", "as", "fullbench", ",", "but", "forced", "to", "compile", "in", "32", "-", "bits", "mode", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "RELEASE", "=", "r119", "DESTDIR", "=", "PREFIX", "=", "/", "usr", "CC", ":", "=$", "(", "CC", ")", "CFLAGS", "+", "=", "-", "std", "=", "c99", "-", "O3", "-", "Wall", "-", "W", "-", "Wundef", "-", "DLZ4_VERSION", "=", "\\\"", "$(", "RELEASE", ")", "\\\"", "FLAGS", "=", "-", "I", ".", ".", "$", "(", "CFLAGS", ")", "BINDIR", "=", "$(", "PREFIX", ")", "/", "bin", "MANDIR", "=", "$(", "PREFIX", ")", "/", "share", "/", "man", "/", "man1", "LZ4DIR", "=", "..", "TEST_FILES", "=", "COPYING", "TEST_TARGETS", "=", "test", "-", "64", "test", "-", "32", "BENCH_NB", "=", "-", "i5", "#", "Minimize", "test", "target", "for", "Travis", "CI", "'", "s", "Build", "Matrix", "ifeq", "(", "$(", "LZ4_TRAVIS_CI_ENV", ")", ",-", "m32", ")", "TEST_TARGETS", "=", "test", "-", "32", "BENCH_NB", "=", "-", "i1", "else", "ifeq", "(", "$(", "LZ4_TRAVIS_CI_ENV", ")", ",-", "m64", ")", "TEST_TARGETS", "=", "test", "-", "64", "BENCH_NB", "=", "-", "i1", "endif", "#", "Define", "*", ".", "exe", "as", "extension", "for", "Windows", "systems", "ifneq", "(", ",$", "(", "filter", "Windows", "%", ",$", "(", "OS", ")", "))", "EXT", "=", ".", "exe", "VOID", "=", "nul", "else", "EXT", "=", "VOID", "=", "/", "dev", "/", "null", "endif", "default", ":", "lz4", "lz4c", "all", ":", "lz4", "lz4c", "lz4c32", "fullbench", "fullbench32", "fuzzer", "fuzzer32", "datagen", "lz4", ":", "$", "(", "LZ4DIR", ")", "/", "lz4", ".", "c", "$", "(", "LZ4DIR", ")", "/", "lz4hc", ".", "c", "bench", ".", "c", "xxhash", ".", "c", "lz4io", ".", "c", "lz4cli", ".", "c", "$", "(", "CC", ")", "$", "(", "FLAGS", ")", "-", "DDISABLE_LZ4C_LEGACY_OPTIONS", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "lz4c", ":", "$", "(", "LZ4DIR", ")", "/", "lz4", ".", "c", "$", "(", "LZ4DIR", ")", "/", "lz4hc", ".", "c", "bench", ".", "c", "xxhash", ".", "c", "lz4io", ".", "c", "lz4cli", ".", "c", "$", "(", "CC", ")", "$", "(", "FLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "lz4c32", ":", "$", "(", "LZ4DIR", ")", "/", "lz4", ".", "c", "$", "(", "LZ4DIR", ")", "/", "lz4hc", ".", "c", "bench", ".", "c", "xxhash", ".", "c", "lz4io", ".", "c", "lz4cli", ".", "c", "$", "(", "CC", ")", "-", "m32", "$", "(", "FLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "fullbench", ":", "$", "(", "LZ4DIR", ")", "/", "lz4", ".", "c", "$", "(", "LZ4DIR", ")", "/", "lz4hc", ".", "c", "xxhash", ".", "c", "fullbench", ".", "c", "$", "(", "CC", ")", "$", "(", "FLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "fullbench32", ":", "$", "(", "LZ4DIR", ")", "/", "lz4", ".", "c", "$", "(", "LZ4DIR", ")", "/", "lz4hc", ".", "c", "xxhash", ".", "c", "fullbench", ".", "c", "$", "(", "CC", ")", "-", "m32", "$", "(", "FLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "fuzzer", ":", "$", "(", "LZ4DIR", ")", "/", "lz4", ".", "c", "$", "(", "LZ4DIR", ")", "/", "lz4hc", ".", "c", "xxhash", ".", "c", "fuzzer", ".", "c", "$", "(", "CC", ")", "$", "(", "FLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "fuzzer32", ":", "$", "(", "LZ4DIR", ")", "/", "lz4", ".", "c", "$", "(", "LZ4DIR", ")", "/", "lz4hc", ".", "c", "xxhash", ".", "c", "fuzzer", ".", "c", "$", "(", "CC", ")", "-", "m32", "$", "(", "FLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "datagen", ":", "datagen", ".", "c", "$", "(", "CC", ")", "$", "(", "FLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "clean", ":", "@", "rm", "-", "f", "core", "*", ".", "o", "\\", "lz4", "$", "(", "EXT", ")", "lz4c", "$", "(", "EXT", ")", "lz4c32", "$", "(", "EXT", ")", "\\", "fullbench", "$", "(", "EXT", ")", "fullbench32", "$", "(", "EXT", ")", "\\", "fuzzer", "$", "(", "EXT", ")", "fuzzer32", "$", "(", "EXT", ")", "datagen", "$", "(", "EXT", ")", "@", "echo", "Cleaning", "completed", "ifneq", "(", ",$", "(", "filter", "$", "(", "shell", "uname", ")", ",", "Linux", "Darwin", ")", ")", "install", ":", "lz4", "lz4c", "@", "echo", "Installing", "binaries", "@", "install", "-", "d", "-", "m", "755", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "@", "install", "-", "m", "755", "lz4", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "lz4", "@", "ln", "-", "sf", "lz4", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "lz4cat", "@", "install", "-", "m", "755", "lz4c", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "lz4c", "@", "echo", "Installing", "man", "pages", "@", "install", "-", "m", "644", "lz4", ".", "1", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4", ".", "1", "@", "install", "-", "m", "644", "lz4c", ".", "1", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4c", ".", "1", "@", "install", "-", "m", "644", "lz4cat", ".", "1", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4cat", ".", "1", "@", "echo", "lz4", "installation", "completed", "uninstall", ":", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "lz4cat", "[", "-", "x", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "lz4", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "lz4", "[", "-", "x", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "lz4c", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "BINDIR", ")", "/", "lz4c", "[", "-", "f", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4", ".", "1", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4", ".", "1", "[", "-", "f", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4c", ".", "1", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4c", ".", "1", "[", "-", "f", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4cat", ".", "1", "]", "&", "&", "rm", "-", "f", "$", "(", "DESTDIR", ")", "$(", "MANDIR", ")", "/", "lz4cat", ".", "1", "@", "echo", "lz4", "successfully", "uninstalled", "test", ":", "$", "(", "TEST_TARGETS", ")", "test", "-", "64", ":", "test", "-", "lz4", "test", "-", "lz4c", "test", "-", "fullbench", "test", "-", "fuzzer", "test", "-", "mem", "test", "-", "32", ":", "test", "-", "lz4", "test", "-", "lz4c32", "test", "-", "fullbench32", "test", "-", "fuzzer32", "test", "-", "mem32", "test", "-", "lz4", ":", "lz4", "datagen", ".", "/", "datagen", "|", ".", "/", "lz4", "|", ".", "/", "lz4", "-", "vdq", ">", "$", "(", "VOID", ")", ".", "/", "datagen", "-", "g256MB", "|", ".", "/", "lz4", "-", "vqB4D", "|", ".", "/", "lz4", "-", "vdq", ">", "$", "(", "VOID", ")", ".", "/", "datagen", "-", "g6GB", "|", ".", "/", "lz4", "-", "vqB5D", "|", ".", "/", "lz4", "-", "vdq", ">", "$", "(", "VOID", ")", "test", "-", "lz4c", ":", "lz4c", "datagen", "test", "-", "lz4c32", ":", "lz4c32", "lz4", "datagen", ".", "/", "datagen", "|", ".", "/", "lz4c32", "|", ".", "/", "lz4c32", "-", "vdq", ">", "$", "(", "VOID", ")", ".", "/", "datagen", "|", ".", "/", "lz4c32", "|", ".", "/", "lz4", "-", "vdq", ">", "$", "(", "VOID", ")", ".", "/", "datagen", "-", "g256MB", "|", ".", "/", "lz4c32", "-", "vqB4D", "|", ".", "/", "lz4c32", "-", "vdq", ">", "$", "(", "VOID", ")", ".", "/", "datagen", "-", "g256MB", "|", ".", "/", "lz4c32", "-", "vqB4D", "|", ".", "/", "lz4", "-", "vdq", ">", "$", "(", "VOID", ")", ".", "/", "datagen", "-", "g6GB", "|", ".", "/", "lz4c32", "-", "vqB5D", "|", ".", "/", "lz4c32", "-", "vdq", ">", "$", "(", "VOID", ")", "test", "-", "fullbench", ":", "fullbench", ".", "/", "fullbench", "-", "-", "no", "-", "prompt", "$", "(", "BENCH_NB", ")", "$", "(", "TEST_FILES", ")", "test", "-", "fullbench32", ":", "fullbench32", ".", "/", "fullbench32", "-", "-", "no", "-", "prompt", "$", "(", "BENCH_NB", ")", "$", "(", "TEST_FILES", ")", "test", "-", "fuzzer", ":", "fuzzer", ".", "/", "fuzzer", "-", "-", "no", "-", "prompt", "test", "-", "fuzzer32", ":", "fuzzer32", ".", "/", "fuzzer32", "-", "-", "no", "-", "prompt", "test", "-", "mem", ":", "lz4", "datagen", ".", "/", "datagen", "-", "g256MB", ">", "tmp", "valgrind", ".", "/", "lz4", "-", "B4D", "-", "f", "tmp", "/", "dev", "/", "null", ".", "/", "datagen", "-", "g16MB", ">", "tmp", "valgrind", ".", "/", "lz4", "-", "9", "-", "B5D", "-", "f", "tmp", "/", "dev", "/", "null", "rm", "tmp", "test", "-", "mem32", ":", "lz4c32", "datagen", "#", "unfortunately", ",", "valgrind", "doesn", "'", "t", "seem", "to", "work", "with", "non", "-", "native", "binary", ".", "If", "someone", "knows", "how", "to", "do", "a", "valgrind", "-", "test", "on", "a", "32", "-", "bits", "exe", "with", "a", "64", "-", "bits", "system", ".", "..", "endif", "@", "@", "-", "1", ",", "448", "+", "1", ",", "441", "@", "@", "/", "*", "bench", ".", "c", "-", "Demo", "program", "to", "benchmark", "open", "-", "source", "compression", "algorithm", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2013", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "define", "_CRT_SECURE_NO_WARNINGS", "#", "define", "_CRT_SECURE_NO_DEPRECATE", "/", "/", "VS2005", "/", "/", "Unix", "Large", "Files", "support", "(", ">", "4GB", ")", "#", "define", "_FILE_OFFSET_BITS", "64", "#", "if", "(", "defined", "(", "__sun__", ")", "&", "&", "(", "!", "defined", "(", "__LP64__", ")", "))", "/", "/", "Sun", "Solaris", "32", "-", "bits", "requires", "specific", "definitions", "#", "define", "_LARGEFILE_SOURCE", "#", "elif", "!", "defined", "(", "__LP64__", ")", "/", "/", "No", "point", "defining", "Large", "file", "for", "64", "bit", "#", "define", "_LARGEFILE64_SOURCE", "#", "endif", "/", "/", "S_ISREG", "&", "gettimeofday", "(", ")", "are", "not", "supported", "by", "MSVC", "#", "if", "defined", "(", "_MSC_VER", ")", "|", "|", "defined", "(", "_WIN32", ")", "#", "define", "BMK_LEGACY_TIMER", "1", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "malloc", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fprintf", ",", "fopen", ",", "ftello64", "#", "include", "<", "sys", "/", "types", ".", "h", ">", "/", "/", "stat64", "#", "include", "<", "sys", "/", "stat", ".", "h", ">", "/", "/", "stat64", "/", "/", "Use", "ftime", "(", ")", "if", "gettimeofday", "(", ")", "is", "not", "available", "on", "your", "target", "#", "if", "defined", "(", "BMK_LEGACY_TIMER", ")", "#", "include", "<", "sys", "/", "timeb", ".", "h", ">", "/", "/", "timeb", ",", "ftime", "#", "else", "#", "include", "<", "sys", "/", "time", ".", "h", ">", "/", "/", "gettimeofday", "#", "endif", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "define", "COMPRESSOR0", "LZ4_compress", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "define", "COMPRESSOR1", "LZ4_compressHC", "#", "define", "DEFAULTCOMPRESSOR", "COMPRESSOR0", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "specifics", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "!", "defined", "(", "S_ISREG", ")", "#", "define", "S_ISREG", "(", "x", ")", "(", "((", "x", ")", "&", "S_IFMT", ")", "=", "=", "S_IFREG", ")", "#", "endif", "/", "/", "GCC", "does", "not", "support", "_rotl", "outside", "of", "Windows", "#", "if", "!", "defined", "(", "_WIN32", ")", "#", "define", "_rotl", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "NBLOOPS", "3", "#", "define", "TIMELOOP", "2000", "#", "define", "KNUTH", "2654435761U", "#", "define", "MAX_MEM", "(", "1984", "<", "<", "20", ")", "#", "define", "DEFAULT_CHUNKSIZE", "(", "4", "<", "<", "20", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "structures", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "struct", "chunkParameters", "{", "U32", "id", ";", "char", "*", "origBuffer", ";", "char", "*", "compressedBuffer", ";", "int", "origSize", ";", "int", "compressedSize", ";", "}", ";", "struct", "compressionParameters", "{", "int", "(", "*", "compressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ")", ";", "int", "(", "*", "decompressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ")", ";", "}", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "MACRO", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Benchmark", "Parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "int", "chunkSize", "=", "DEFAULT_CHUNKSIZE", ";", "static", "int", "nbIterations", "=", "NBLOOPS", ";", "static", "int", "BMK_pause", "=", "0", ";", "void", "BMK_SetBlocksize", "(", "int", "bsize", ")", "{", "chunkSize", "=", "bsize", ";", "DISPLAY", "(", "\"-", "Using", "Block", "Size", "of", "%", "i", "KB", "-", "\\", "n", "\"", ",", "chunkSize", ">", ">", "10", ")", ";", "}", "void", "BMK_SetNbIterations", "(", "int", "nbLoops", ")", "{", "nbIterations", "=", "nbLoops", ";", "DISPLAY", "(", "\"-", "%", "i", "iterations", "-", "\\", "n", "\"", ",", "nbIterations", ")", ";", "}", "void", "BMK_SetPause", "(", ")", "{", "BMK_pause", "=", "1", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Private", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "#", "if", "defined", "(", "BMK_LEGACY_TIMER", ")", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Based", "on", "Legacy", "ftime", "(", ")", "/", "/", "Rolls", "over", "every", "~", "12", ".", "1", "days", "(", "0x100000", "/", "24", "/", "60", "/", "60", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeb", "tb", ";", "int", "nCount", ";", "ftime", "(", "&", "tb", ")", ";", "nCount", "=", "(", "int", ")", "(", "tb", ".", "millitm", "+", "(", "tb", ".", "time", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "#", "else", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Based", "on", "newer", "gettimeofday", "(", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeval", "tv", ";", "int", "nCount", ";", "gettimeofday", "(", "&", "tv", ",", "NULL", ")", ";", "nCount", "=", "(", "int", ")", "(", "tv", ".", "tv_usec", "/", "1000", "+", "(", "tv", ".", "tv_sec", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "#", "endif", "static", "int", "BMK_GetMilliSpan", "(", "int", "nTimeStart", ")", "{", "int", "nSpan", "=", "BMK_GetMilliStart", "(", ")", "-", "nTimeStart", ";", "if", "(", "nSpan", "<", "0", ")", "nSpan", "+", "=", "0x100000", "*", "1000", ";", "return", "nSpan", ";", "}", "static", "size_t", "BMK_findMaxMem", "(", "U64", "requiredMem", ")", "{", "size_t", "step", "=", "(", "64U", "<", "<", "20", ")", ";", "/", "/", "64", "MB", "BYTE", "*", "testmem", "=", "NULL", ";", "requiredMem", "=", "(", "((", "requiredMem", ">", ">", "25", ")", "+", "1", ")", "<", "<", "26", ")", ";", "if", "(", "requiredMem", ">", "MAX_MEM", ")", "requiredMem", "=", "MAX_MEM", ";", "requiredMem", "+", "=", "2", "*", "step", ";", "while", "(", "!", "testmem", ")", "{", "requiredMem", "-", "=", "step", ";", "testmem", "=", "(", "BYTE", "*", ")", "malloc", "(", "(", "size_t", ")", "requiredMem", ")", ";", "}", "free", "(", "testmem", ")", ";", "return", "(", "size_t", ")", "(", "requiredMem", "-", "step", ")", ";", "}", "static", "U64", "BMK_GetFileSize", "(", "char", "*", "infilename", ")", "{", "int", "r", ";", "#", "if", "defined", "(", "_MSC_VER", ")", "struct", "_stat64", "statbuf", ";", "r", "=", "_stat64", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "else", "struct", "stat", "statbuf", ";", "r", "=", "stat", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "endif", "if", "(", "r", "|", "|", "!", "S_ISREG", "(", "statbuf", ".", "st_mode", ")", ")", "return", "0", ";", "/", "/", "No", "good", ".", "..", "return", "(", "U64", ")", "statbuf", ".", "st_size", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Public", "function", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "int", "BMK_benchFile", "(", "char", "*", "*", "fileNamesTable", ",", "int", "nbFiles", ",", "int", "cLevel", ")", "{", "int", "fileIdx", "=", "0", ";", "char", "*", "orig_buff", ";", "struct", "compressionParameters", "compP", ";", "U64", "totals", "=", "0", ";", "U64", "totalz", "=", "0", ";", "double", "totalc", "=", "0", ".", ";", "double", "totald", "=", "0", ".", ";", "/", "/", "Init", "switch", "(", "cLevel", ")", "{", "#", "ifdef", "COMPRESSOR0", "case", "0", ":", "compP", ".", "compressionFunction", "=", "COMPRESSOR0", ";", "break", ";", "#", "endif", "#", "ifdef", "COMPRESSOR1", "case", "1", ":", "compP", ".", "compressionFunction", "=", "COMPRESSOR1", ";", "break", ";", "#", "endif", "default", ":", "compP", ".", "compressionFunction", "=", "DEFAULTCOMPRESSOR", ";", "}", "compP", ".", "decompressionFunction", "=", "LZ4_decompress_fast", ";", "/", "/", "Loop", "for", "each", "file", "while", "(", "fileIdx", "<", "nbFiles", ")", "{", "FILE", "*", "inFile", ";", "char", "*", "inFileName", ";", "U64", "inFileSize", ";", "size_t", "benchedSize", ";", "int", "nbChunks", ";", "int", "maxCompressedChunkSize", ";", "size_t", "readSize", ";", "char", "*", "compressedBuffer", ";", "int", "compressedBuffSize", ";", "struct", "chunkParameters", "*", "chunkP", ";", "U32", "crcOrig", ";", "/", "/", "Check", "file", "existence", "inFileName", "=", "fileNamesTable", "[", "fileIdx", "+", "+]", ";", "inFile", "=", "fopen", "(", "inFileName", ",", "\"", "rb", "\"", ")", ";", "if", "(", "inFile", "=", "=", "NULL", ")", "{", "DISPLAY", "(", "\"", "Pb", "opening", "%", "s", "\\", "n", "\"", ",", "inFileName", ")", ";", "return", "11", ";", "}", "/", "/", "Memory", "allocation", "&", "restrictions", "inFileSize", "=", "BMK_GetFileSize", "(", "inFileName", ")", ";", "benchedSize", "=", "(", "size_t", ")", "BMK_findMaxMem", "(", "inFileSize", ")", "/", "2", ";", "if", "(", "(", "U64", ")", "benchedSize", ">", "inFileSize", ")", "benchedSize", "=", "(", "size_t", ")", "inFileSize", ";", "if", "(", "benchedSize", "<", "inFileSize", ")", "{", "DISPLAY", "(", "\"", "Not", "enough", "memory", "for", "'", "%", "s", "'", "full", "size", ";", "testing", "%", "i", "MB", "only", ".", "..", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "(", "benchedSize", ">", ">", "20", ")", ");", "}", "/", "/", "Alloc", "chunkP", "=", "(", "struct", "chunkParameters", "*", ")", "malloc", "(", "((", "benchedSize", "/", "chunkSize", ")", "+", "1", ")", "*", "sizeof", "(", "struct", "chunkParameters", ")", ");", "orig_buff", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "benchedSize", ")", ";", "nbChunks", "=", "(", "int", ")", "(", "benchedSize", "/", "chunkSize", ")", "+", "1", ";", "maxCompressedChunkSize", "=", "LZ4_compressBound", "(", "chunkSize", ")", ";", "compressedBuffSize", "=", "nbChunks", "*", "maxCompressedChunkSize", ";", "compressedBuffer", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "compressedBuffSize", ")", ";", "if", "(", "!", "orig_buff", "|", "|", "!", "compressedBuffer", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "not", "enough", "memory", "!", "\\", "n", "\"", ");", "free", "(", "orig_buff", ")", ";", "free", "(", "compressedBuffer", ")", ";", "free", "(", "chunkP", ")", ";", "fclose", "(", "inFile", ")", ";", "return", "12", ";", "}", "/", "/", "Init", "chunks", "data", "{", "int", "i", ";", "size_t", "remaining", "=", "benchedSize", ";", "char", "*", "in", "=", "orig_buff", ";", "char", "*", "out", "=", "compressedBuffer", ";", "for", "(", "i", "=", "0", ";", "i", "<", "nbChunks", ";", "i", "+", "+)", "{", "chunkP", "[", "i", "]", ".", "id", "=", "i", ";", "chunkP", "[", "i", "]", ".", "origBuffer", "=", "in", ";", "in", "+", "=", "chunkSize", ";", "if", "(", "(", "int", ")", "remaining", ">", "chunkSize", ")", "{", "chunkP", "[", "i", "]", ".", "origSize", "=", "chunkSize", ";", "remaining", "-", "=", "chunkSize", ";", "}", "else", "{", "chunkP", "[", "i", "]", ".", "origSize", "=", "(", "int", ")", "remaining", ";", "remaining", "=", "0", ";", "}", "chunkP", "[", "i", "]", ".", "compressedBuffer", "=", "out", ";", "out", "+", "=", "maxCompressedChunkSize", ";", "chunkP", "[", "i", "]", ".", "compressedSize", "=", "0", ";", "}", "}", "/", "/", "Fill", "input", "buffer", "DISPLAY", "(", "\"", "Loading", "%", "s", ".", "..", "\\", "r", "\"", ",", "inFileName", ")", ";", "readSize", "=", "fread", "(", "orig_buff", ",", "1", ",", "benchedSize", ",", "inFile", ")", ";", "fclose", "(", "inFile", ")", ";", "if", "(", "readSize", "!", "=", "benchedSize", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "problem", "reading", "file", "'", "%", "s", "'", "!", "!", "\\", "n", "\"", ",", "inFileName", ")", ";", "free", "(", "orig_buff", ")", ";", "free", "(", "compressedBuffer", ")", ";", "free", "(", "chunkP", ")", ";", "return", "13", ";", "}", "/", "/", "Calculating", "input", "Checksum", "crcOrig", "=", "XXH32", "(", "orig_buff", ",", "(", "unsigned", "int", ")", "benchedSize", ",", "0", ")", ";", "/", "/", "Bench", "{", "int", "loopNb", ",", "chunkNb", ";", "size_t", "cSize", "=", "0", ";", "double", "fastestC", "=", "100000000", ".", ",", "fastestD", "=", "100000000", ".", ";", "double", "ratio", "=", "0", ".", ";", "U32", "crcCheck", "=", "0", ";", "DISPLAY", "(", "\"\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "for", "(", "loopNb", "=", "1", ";", "loopNb", "<", "=", "nbIterations", ";", "loopNb", "+", "+)", "{", "int", "nbLoops", ";", "int", "milliTime", ";", "/", "/", "Compression", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "9i", "-", ">\\", "r", "\"", ",", "loopNb", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ")", ";", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "benchedSize", ";", "i", "+", "+)", "compressedBuffer", "[", "i", "]", "=(", "char", ")", "i", ";", "}", "/", "/", "warmimg", "up", "memory", "nbLoops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "compP", ".", "compressionFunction", "(", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "nbLoops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "if", "(", "(", "double", ")", "milliTime", "<", "fastestC", "*", "nbLoops", ")", "fastestC", "=", "(", "double", ")", "milliTime", "/", "nbLoops", ";", "cSize", "=", "0", ";", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "cSize", "+", "=", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ";", "ratio", "=", "(", "double", ")", "cSize", "/", "(", "double", ")", "benchedSize", "*", "100", ".", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ");", "/", "/", "Decompression", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "benchedSize", ";", "i", "+", "+)", "orig_buff", "[", "i", "]", "=", "0", ";", "}", "/", "/", "zeroing", "area", ",", "for", "CRC", "checking", "nbLoops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "/", "/", "chunkP", "[", "chunkNb", "]", ".", "origSize", "=", "LZ4_decompress_safe", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ",", "chunkSize", ")", ";", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "LZ4_decompress_fast", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "/", "/", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "LZ4_decompress_fast_withPrefix64k", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "/", "/", "chunkP", "[", "chunkNb", "]", ".", "origSize", "=", "LZ4_decompress_safe_withPrefix64k", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ",", "chunkSize", ")", ";", "/", "/", "chunkP", "[", "chunkNb", "]", ".", "origSize", "=", "LZ4_decompress_safe_partial", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ",", "chunkSize", "-", "5", ",", "chunkSize", ")", ";", "/", "/", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "LZ4_uncompress", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "/", "/", "chunkP", "[", "chunkNb", "]", ".", "origSize", "=", "LZ4_uncompress_unknownOutputSize", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ",", "chunkSize", ")", ";", "nbLoops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "if", "(", "(", "double", ")", "milliTime", "<", "fastestD", "*", "nbLoops", ")", "fastestD", "=", "(", "double", ")", "milliTime", "/", "nbLoops", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", ",", "%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ",", "(", "double", ")", "benchedSize", "/", "fastestD", "/", "1000", ".", ");", "/", "/", "CRC", "Checking", "crcCheck", "=", "XXH32", "(", "orig_buff", ",", "(", "unsigned", "int", ")", "benchedSize", ",", "0", ")", ";", "if", "(", "crcOrig", "!", "=", "crcCheck", ")", "{", "DISPLAY", "(", "\"\\", "n", "!", "!!", "WARNING", "!", "!!", "%", "14s", ":", "Invalid", "Checksum", ":", "%", "x", "!", "=", "%", "x", "\\", "n", "\"", ",", "inFileName", ",", "(", "unsigned", ")", "crcOrig", ",", "(", "unsigned", ")", "crcCheck", ")", ";", "break", ";", "}", "}", "if", "(", "crcOrig", "=", "=", "crcCheck", ")", "{", "if", "(", "ratio", "<", "100", ".", ")", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", ",", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ",", "(", "double", ")", "benchedSize", "/", "fastestD", "/", "1000", ".", ");", "else", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "1f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", ",", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ",", "(", "double", ")", "benchedSize", "/", "fastestD", "/", "1000", ".", ");", "}", "totals", "+", "=", "benchedSize", ";", "totalz", "+", "=", "cSize", ";", "totalc", "+", "=", "fastestC", ";", "totald", "+", "=", "fastestD", ";", "}", "free", "(", "orig_buff", ")", ";", "free", "(", "compressedBuffer", ")", ";", "free", "(", "chunkP", ")", ";", "}", "if", "(", "nbFiles", ">", "1", ")", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "10llu", "-", ">%", "10llu", "(", "%", "5", ".", "2f", "%", "%)", ",", "%", "6", ".", "1f", "MB", "/", "s", ",", "%", "6", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "\"", "TOTAL", "\"", ",", "(", "long", "long", "unsigned", "int", ")", "totals", ",", "(", "long", "long", "unsigned", "int", ")", "totalz", ",", "(", "double", ")", "totalz", "/", "(", "double", ")", "totals", "*", "100", ".", ",", "(", "double", ")", "totals", "/", "totalc", "/", "1000", ".", ",", "(", "double", ")", "totals", "/", "totald", "/", "1000", ".", ");", "if", "(", "BMK_pause", ")", "{", "DISPLAY", "(", "\"", "press", "enter", ".", "..", "\\", "n", "\"", ");", "getchar", "(", ");", "}", "return", "0", ";", "}", "/", "*", "bench", ".", "c", "-", "Demo", "program", "to", "benchmark", "open", "-", "source", "compression", "algorithm", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2014", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "define", "_CRT_SECURE_NO_WARNINGS", "#", "define", "_CRT_SECURE_NO_DEPRECATE", "/", "/", "VS2005", "/", "/", "Unix", "Large", "Files", "support", "(", ">", "4GB", ")", "#", "define", "_FILE_OFFSET_BITS", "64", "#", "if", "(", "defined", "(", "__sun__", ")", "&", "&", "(", "!", "defined", "(", "__LP64__", ")", "))", "/", "/", "Sun", "Solaris", "32", "-", "bits", "requires", "specific", "definitions", "#", "define", "_LARGEFILE_SOURCE", "#", "elif", "!", "defined", "(", "__LP64__", ")", "/", "/", "No", "point", "defining", "Large", "file", "for", "64", "bit", "#", "define", "_LARGEFILE64_SOURCE", "#", "endif", "/", "/", "S_ISREG", "&", "gettimeofday", "(", ")", "are", "not", "supported", "by", "MSVC", "#", "if", "defined", "(", "_MSC_VER", ")", "|", "|", "defined", "(", "_WIN32", ")", "#", "define", "BMK_LEGACY_TIMER", "1", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "malloc", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fprintf", ",", "fopen", ",", "ftello64", "#", "include", "<", "sys", "/", "types", ".", "h", ">", "/", "/", "stat64", "#", "include", "<", "sys", "/", "stat", ".", "h", ">", "/", "/", "stat64", "/", "/", "Use", "ftime", "(", ")", "if", "gettimeofday", "(", ")", "is", "not", "available", "on", "your", "target", "#", "if", "defined", "(", "BMK_LEGACY_TIMER", ")", "#", "include", "<", "sys", "/", "timeb", ".", "h", ">", "/", "/", "timeb", ",", "ftime", "#", "else", "#", "include", "<", "sys", "/", "time", ".", "h", ">", "/", "/", "gettimeofday", "#", "endif", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "define", "COMPRESSOR0", "LZ4_compress_local", "static", "int", "LZ4_compress_local", "(", "const", "char", "*", "src", ",", "char", "*", "dst", ",", "int", "size", ",", "int", "clevel", ")", "{", "(", "void", ")", "clevel", ";", "return", "LZ4_compress", "(", "src", ",", "dst", ",", "size", ")", ";", "}", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "define", "COMPRESSOR1", "LZ4_compressHC2", "#", "define", "DEFAULTCOMPRESSOR", "COMPRESSOR0", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "specifics", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "!", "defined", "(", "S_ISREG", ")", "#", "define", "S_ISREG", "(", "x", ")", "(", "((", "x", ")", "&", "S_IFMT", ")", "=", "=", "S_IFREG", ")", "#", "endif", "/", "/", "GCC", "does", "not", "support", "_rotl", "outside", "of", "Windows", "#", "if", "!", "defined", "(", "_WIN32", ")", "#", "define", "_rotl", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "NBLOOPS", "3", "#", "define", "TIMELOOP", "2000", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "#", "define", "KNUTH", "2654435761U", "#", "define", "MAX_MEM", "(", "2", "GB", "-", "64", "MB", ")", "#", "define", "DEFAULT_CHUNKSIZE", "(", "4", "MB", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "structures", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "struct", "chunkParameters", "{", "U32", "id", ";", "char", "*", "origBuffer", ";", "char", "*", "compressedBuffer", ";", "int", "origSize", ";", "int", "compressedSize", ";", "}", ";", "struct", "compressionParameters", "{", "int", "(", "*", "compressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ",", "int", ")", ";", "int", "(", "*", "decompressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ")", ";", "}", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "MACRO", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Benchmark", "Parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "int", "chunkSize", "=", "DEFAULT_CHUNKSIZE", ";", "static", "int", "nbIterations", "=", "NBLOOPS", ";", "static", "int", "BMK_pause", "=", "0", ";", "void", "BMK_SetBlocksize", "(", "int", "bsize", ")", "{", "chunkSize", "=", "bsize", ";", "}", "void", "BMK_SetNbIterations", "(", "int", "nbLoops", ")", "{", "nbIterations", "=", "nbLoops", ";", "DISPLAY", "(", "\"-", "%", "i", "iterations", "-", "\\", "n", "\"", ",", "nbIterations", ")", ";", "}", "void", "BMK_SetPause", "(", ")", "{", "BMK_pause", "=", "1", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Private", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "#", "if", "defined", "(", "BMK_LEGACY_TIMER", ")", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Based", "on", "Legacy", "ftime", "(", ")", "/", "/", "Rolls", "over", "every", "~", "12", ".", "1", "days", "(", "0x100000", "/", "24", "/", "60", "/", "60", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeb", "tb", ";", "int", "nCount", ";", "ftime", "(", "&", "tb", ")", ";", "nCount", "=", "(", "int", ")", "(", "tb", ".", "millitm", "+", "(", "tb", ".", "time", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "#", "else", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Based", "on", "newer", "gettimeofday", "(", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeval", "tv", ";", "int", "nCount", ";", "gettimeofday", "(", "&", "tv", ",", "NULL", ")", ";", "nCount", "=", "(", "int", ")", "(", "tv", ".", "tv_usec", "/", "1000", "+", "(", "tv", ".", "tv_sec", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "#", "endif", "static", "int", "BMK_GetMilliSpan", "(", "int", "nTimeStart", ")", "{", "int", "nSpan", "=", "BMK_GetMilliStart", "(", ")", "-", "nTimeStart", ";", "if", "(", "nSpan", "<", "0", ")", "nSpan", "+", "=", "0x100000", "*", "1000", ";", "return", "nSpan", ";", "}", "static", "size_t", "BMK_findMaxMem", "(", "U64", "requiredMem", ")", "{", "size_t", "step", "=", "(", "64", "MB", ")", ";", "BYTE", "*", "testmem", "=", "NULL", ";", "requiredMem", "=", "(", "((", "requiredMem", ">", ">", "26", ")", "+", "1", ")", "<", "<", "26", ")", ";", "requiredMem", "+", "=", "2", "*", "step", ";", "if", "(", "requiredMem", ">", "MAX_MEM", ")", "requiredMem", "=", "MAX_MEM", ";", "while", "(", "!", "testmem", ")", "{", "requiredMem", "-", "=", "step", ";", "testmem", "=", "(", "BYTE", "*", ")", "malloc", "(", "(", "size_t", ")", "requiredMem", ")", ";", "}", "free", "(", "testmem", ")", ";", "return", "(", "size_t", ")", "(", "requiredMem", "-", "step", ")", ";", "}", "static", "U64", "BMK_GetFileSize", "(", "char", "*", "infilename", ")", "{", "int", "r", ";", "#", "if", "defined", "(", "_MSC_VER", ")", "struct", "_stat64", "statbuf", ";", "r", "=", "_stat64", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "else", "struct", "stat", "statbuf", ";", "r", "=", "stat", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "endif", "if", "(", "r", "|", "|", "!", "S_ISREG", "(", "statbuf", ".", "st_mode", ")", ")", "return", "0", ";", "/", "/", "No", "good", ".", "..", "return", "(", "U64", ")", "statbuf", ".", "st_size", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Public", "function", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "int", "BMK_benchFile", "(", "char", "*", "*", "fileNamesTable", ",", "int", "nbFiles", ",", "int", "cLevel", ")", "{", "int", "fileIdx", "=", "0", ";", "char", "*", "orig_buff", ";", "struct", "compressionParameters", "compP", ";", "int", "cfunctionId", ";", "U64", "totals", "=", "0", ";", "U64", "totalz", "=", "0", ";", "double", "totalc", "=", "0", ".", ";", "double", "totald", "=", "0", ".", ";", "/", "/", "Init", "if", "(", "cLevel", "<", "=", "3", ")", "cfunctionId", "=", "0", ";", "else", "cfunctionId", "=", "1", ";", "switch", "(", "cfunctionId", ")", "{", "#", "ifdef", "COMPRESSOR0", "case", "0", ":", "compP", ".", "compressionFunction", "=", "COMPRESSOR0", ";", "break", ";", "#", "endif", "#", "ifdef", "COMPRESSOR1", "case", "1", ":", "compP", ".", "compressionFunction", "=", "COMPRESSOR1", ";", "break", ";", "#", "endif", "default", ":", "compP", ".", "compressionFunction", "=", "DEFAULTCOMPRESSOR", ";", "}", "compP", ".", "decompressionFunction", "=", "LZ4_decompress_fast", ";", "/", "/", "Loop", "for", "each", "file", "while", "(", "fileIdx", "<", "nbFiles", ")", "{", "FILE", "*", "inFile", ";", "char", "*", "inFileName", ";", "U64", "inFileSize", ";", "size_t", "benchedSize", ";", "int", "nbChunks", ";", "int", "maxCompressedChunkSize", ";", "size_t", "readSize", ";", "char", "*", "compressedBuffer", ";", "int", "compressedBuffSize", ";", "struct", "chunkParameters", "*", "chunkP", ";", "U32", "crcOrig", ";", "/", "/", "Check", "file", "existence", "inFileName", "=", "fileNamesTable", "[", "fileIdx", "+", "+]", ";", "inFile", "=", "fopen", "(", "inFileName", ",", "\"", "rb", "\"", ")", ";", "if", "(", "inFile", "=", "=", "NULL", ")", "{", "DISPLAY", "(", "\"", "Pb", "opening", "%", "s", "\\", "n", "\"", ",", "inFileName", ")", ";", "return", "11", ";", "}", "/", "/", "Memory", "allocation", "&", "restrictions", "inFileSize", "=", "BMK_GetFileSize", "(", "inFileName", ")", ";", "benchedSize", "=", "(", "size_t", ")", "BMK_findMaxMem", "(", "inFileSize", "*", "2", ")", "/", "2", ";", "if", "(", "(", "U64", ")", "benchedSize", ">", "inFileSize", ")", "benchedSize", "=", "(", "size_t", ")", "inFileSize", ";", "if", "(", "benchedSize", "<", "inFileSize", ")", "{", "DISPLAY", "(", "\"", "Not", "enough", "memory", "for", "'", "%", "s", "'", "full", "size", ";", "testing", "%", "i", "MB", "only", ".", "..", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "(", "benchedSize", ">", ">", "20", ")", ");", "}", "/", "/", "Alloc", "chunkP", "=", "(", "struct", "chunkParameters", "*", ")", "malloc", "(", "((", "benchedSize", "/", "(", "size_t", ")", "chunkSize", ")", "+", "1", ")", "*", "sizeof", "(", "struct", "chunkParameters", ")", ");", "orig_buff", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "benchedSize", ")", ";", "nbChunks", "=", "(", "int", ")", "(", "(", "int", ")", "benchedSize", "/", "chunkSize", ")", "+", "1", ";", "maxCompressedChunkSize", "=", "LZ4_compressBound", "(", "chunkSize", ")", ";", "compressedBuffSize", "=", "nbChunks", "*", "maxCompressedChunkSize", ";", "compressedBuffer", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "compressedBuffSize", ")", ";", "if", "(", "!", "orig_buff", "|", "|", "!", "compressedBuffer", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "not", "enough", "memory", "!", "\\", "n", "\"", ");", "free", "(", "orig_buff", ")", ";", "free", "(", "compressedBuffer", ")", ";", "free", "(", "chunkP", ")", ";", "fclose", "(", "inFile", ")", ";", "return", "12", ";", "}", "/", "/", "Init", "chunks", "data", "{", "int", "i", ";", "size_t", "remaining", "=", "benchedSize", ";", "char", "*", "in", "=", "orig_buff", ";", "char", "*", "out", "=", "compressedBuffer", ";", "for", "(", "i", "=", "0", ";", "i", "<", "nbChunks", ";", "i", "+", "+)", "{", "chunkP", "[", "i", "]", ".", "id", "=", "i", ";", "chunkP", "[", "i", "]", ".", "origBuffer", "=", "in", ";", "in", "+", "=", "chunkSize", ";", "if", "(", "(", "int", ")", "remaining", ">", "chunkSize", ")", "{", "chunkP", "[", "i", "]", ".", "origSize", "=", "chunkSize", ";", "remaining", "-", "=", "chunkSize", ";", "}", "else", "{", "chunkP", "[", "i", "]", ".", "origSize", "=", "(", "int", ")", "remaining", ";", "remaining", "=", "0", ";", "}", "chunkP", "[", "i", "]", ".", "compressedBuffer", "=", "out", ";", "out", "+", "=", "maxCompressedChunkSize", ";", "chunkP", "[", "i", "]", ".", "compressedSize", "=", "0", ";", "}", "}", "/", "/", "Fill", "input", "buffer", "DISPLAY", "(", "\"", "Loading", "%", "s", ".", "..", "\\", "r", "\"", ",", "inFileName", ")", ";", "readSize", "=", "fread", "(", "orig_buff", ",", "1", ",", "benchedSize", ",", "inFile", ")", ";", "fclose", "(", "inFile", ")", ";", "if", "(", "readSize", "!", "=", "benchedSize", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "problem", "reading", "file", "'", "%", "s", "'", "!", "!", "\\", "n", "\"", ",", "inFileName", ")", ";", "free", "(", "orig_buff", ")", ";", "free", "(", "compressedBuffer", ")", ";", "free", "(", "chunkP", ")", ";", "return", "13", ";", "}", "/", "/", "Calculating", "input", "Checksum", "crcOrig", "=", "XXH32", "(", "orig_buff", ",", "(", "unsigned", "int", ")", "benchedSize", ",", "0", ")", ";", "/", "/", "Bench", "{", "int", "loopNb", ",", "chunkNb", ";", "size_t", "cSize", "=", "0", ";", "double", "fastestC", "=", "100000000", ".", ",", "fastestD", "=", "100000000", ".", ";", "double", "ratio", "=", "0", ".", ";", "U32", "crcCheck", "=", "0", ";", "DISPLAY", "(", "\"\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "for", "(", "loopNb", "=", "1", ";", "loopNb", "<", "=", "nbIterations", ";", "loopNb", "+", "+)", "{", "int", "nbLoops", ";", "int", "milliTime", ";", "/", "/", "Compression", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "9i", "-", ">\\", "r", "\"", ",", "loopNb", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ")", ";", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "benchedSize", ";", "i", "+", "+)", "compressedBuffer", "[", "i", "]", "=(", "char", ")", "i", ";", "}", "/", "/", "warmimg", "up", "memory", "nbLoops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "compP", ".", "compressionFunction", "(", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ",", "cLevel", ")", ";", "nbLoops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "if", "(", "(", "double", ")", "milliTime", "<", "fastestC", "*", "nbLoops", ")", "fastestC", "=", "(", "double", ")", "milliTime", "/", "nbLoops", ";", "cSize", "=", "0", ";", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "cSize", "+", "=", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ";", "ratio", "=", "(", "double", ")", "cSize", "/", "(", "double", ")", "benchedSize", "*", "100", ".", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ");", "/", "/", "Decompression", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "benchedSize", ";", "i", "+", "+)", "orig_buff", "[", "i", "]", "=", "0", ";", "}", "/", "/", "zeroing", "area", ",", "for", "CRC", "checking", "nbLoops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "LZ4_decompress_fast", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "nbLoops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "if", "(", "(", "double", ")", "milliTime", "<", "fastestD", "*", "nbLoops", ")", "fastestD", "=", "(", "double", ")", "milliTime", "/", "nbLoops", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", ",", "%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ",", "(", "double", ")", "benchedSize", "/", "fastestD", "/", "1000", ".", ");", "/", "/", "CRC", "Checking", "crcCheck", "=", "XXH32", "(", "orig_buff", ",", "(", "unsigned", "int", ")", "benchedSize", ",", "0", ")", ";", "if", "(", "crcOrig", "!", "=", "crcCheck", ")", "{", "DISPLAY", "(", "\"\\", "n", "!", "!!", "WARNING", "!", "!!", "%", "14s", ":", "Invalid", "Checksum", ":", "%", "x", "!", "=", "%", "x", "\\", "n", "\"", ",", "inFileName", ",", "(", "unsigned", ")", "crcOrig", ",", "(", "unsigned", ")", "crcCheck", ")", ";", "break", ";", "}", "}", "if", "(", "crcOrig", "=", "=", "crcCheck", ")", "{", "if", "(", "ratio", "<", "100", ".", ")", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", ",", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ",", "(", "double", ")", "benchedSize", "/", "fastestD", "/", "1000", ".", ");", "else", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "1f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", ",", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ",", "(", "double", ")", "benchedSize", "/", "fastestD", "/", "1000", ".", ");", "}", "totals", "+", "=", "benchedSize", ";", "totalz", "+", "=", "cSize", ";", "totalc", "+", "=", "fastestC", ";", "totald", "+", "=", "fastestD", ";", "}", "free", "(", "orig_buff", ")", ";", "free", "(", "compressedBuffer", ")", ";", "free", "(", "chunkP", ")", ";", "}", "if", "(", "nbFiles", ">", "1", ")", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "10llu", "-", ">%", "10llu", "(", "%", "5", ".", "2f", "%", "%)", ",", "%", "6", ".", "1f", "MB", "/", "s", ",", "%", "6", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "\"", "TOTAL", "\"", ",", "(", "long", "long", "unsigned", "int", ")", "totals", ",", "(", "long", "long", "unsigned", "int", ")", "totalz", ",", "(", "double", ")", "totalz", "/", "(", "double", ")", "totals", "*", "100", ".", ",", "(", "double", ")", "totals", "/", "totalc", "/", "1000", ".", ",", "(", "double", ")", "totals", "/", "totald", "/", "1000", ".", ");", "if", "(", "BMK_pause", ")", "{", "DISPLAY", "(", "\"\\", "npress", "enter", ".", "..", "\\", "n", "\"", ");", "getchar", "(", ");", "}", "return", "0", ";", "}", "@", "@", "-", "1", ",", "41", "+", "1", ",", "41", "@", "@", "/", "*", "bench", ".", "h", "-", "Demo", "program", "to", "benchmark", "open", "-", "source", "compression", "algorithm", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2013", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "#", "pragma", "once", "#", "if", "defined", "(", "__cplusplus", ")", "extern", "\"", "C", "\"", "{", "#", "endif", "int", "BMK_benchFile", "(", "char", "*", "*", "fileNamesTable", ",", "int", "nbFiles", ",", "int", "cLevel", ")", ";", "/", "/", "Parameters", "void", "BMK_SetBlocksize", "(", "int", "bsize", ")", ";", "void", "BMK_SetNbIterations", "(", "int", "nbLoops", ")", ";", "void", "BMK_SetPause", "(", ");", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif", "/", "*", "bench", ".", "h", "-", "Demo", "program", "to", "benchmark", "open", "-", "source", "compression", "algorithm", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2014", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "#", "pragma", "once", "#", "if", "defined", "(", "__cplusplus", ")", "extern", "\"", "C", "\"", "{", "#", "endif", "int", "BMK_benchFile", "(", "char", "*", "*", "fileNamesTable", ",", "int", "nbFiles", ",", "int", "cLevel", ")", ";", "/", "/", "Parameters", "void", "BMK_SetBlocksize", "(", "int", "bsize", ")", ";", "void", "BMK_SetNbIterations", "(", "int", "nbLoops", ")", ";", "void", "BMK_SetPause", "(", ");", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif", "@", "@", "-", "0", ",", "0", "+", "1", ",", "283", "@", "@", "/", "*", "datagen", ".", "c", "-", "compressible", "data", "generator", "test", "tool", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2014", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Remove", "Visual", "warning", "messages", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "_CRT_SECURE_NO_WARNINGS", "/", "/", "fgets", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Includes", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "/#", "include", "<", "stdlib", ".", "h", ">", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fgets", ",", "sscanf", "#", "include", "<", "string", ".", "h", ">", "/", "/", "strcmp", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Basic", "Types", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "(", "__STDC_VERSION__", ">", "=", "199901L", ")", "/", "*", "C99", "*", "/", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Constants", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "ifndef", "LZ4_VERSION", "#", "define", "LZ4_VERSION", "\"", "rc118", "\"", "#", "endif", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "#", "define", "CDG_SIZE_DEFAULT", "(", "64", "KB", ")", "#", "define", "CDG_SEED_DEFAULT", "0", "#", "define", "CDG_COMPRESSIBILITY_DEFAULT", "50", "#", "define", "PRIME1", "2654435761U", "#", "define", "PRIME2", "2246822519U", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Macros", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "#", "define", "DISPLAYLEVEL", "(", "l", ",", ".", "..", ")", "if", "(", "displayLevel", ">", "=", "l", ")", "{", "DISPLAY", "(", "__VA_ARGS__", ")", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Local", "Parameters", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "static", "int", "no_prompt", "=", "0", ";", "static", "char", "*", "programName", ";", "static", "int", "displayLevel", "=", "2", ";", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Fuzzer", "functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "#", "define", "CDG_rotl32", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "static", "unsigned", "int", "CDG_rand", "(", "U32", "*", "src", ")", "{", "U32", "rand32", "=", "*", "src", ";", "rand32", "*", "=", "PRIME1", ";", "rand32", "+", "=", "PRIME2", ";", "rand32", "=", "CDG_rotl32", "(", "rand32", ",", "13", ")", ";", "*", "src", "=", "rand32", ";", "return", "rand32", ";", "}", "#", "define", "CDG_RAND15BITS", "(", "(", "CDG_rand", "(", "seed", ")", ">", ">", "3", ")", "&", "32767", ")", "#", "define", "CDG_RANDLENGTH", "(", "(", "(", "CDG_rand", "(", "seed", ")", ">", ">", "7", ")", "&", "3", ")", "?", "(", "CDG_rand", "(", "seed", ")", "%", "14", ")", ":", "(", "CDG_rand", "(", "seed", ")", "&", "511", ")", "+", "15", ")", "#", "define", "CDG_RANDCHAR", "(", "((", "CDG_rand", "(", "seed", ")", ">", ">", "9", ")", "&", "63", ")", "+", "'", "0", "'", ")", "static", "void", "CDG_generate", "(", "U64", "size", ",", "U32", "*", "seed", ",", "double", "proba", ")", "{", "BYTE", "fullbuff", "[", "32", "KB", "+", "128", "KB", "+", "1", "]", ";", "BYTE", "*", "buff", "=", "fullbuff", "+", "32", "KB", ";", "U64", "total", "=", "0", ";", "U32", "P32", "=", "(", "U32", ")", "(", "32768", "*", "proba", ")", ";", "U32", "pos", "=", "0", ";", "U32", "genBlockSize", "=", "128", "KB", ";", "/", "/", "Build", "initial", "prefix", "while", "(", "pos", "<", "32", "KB", ")", "{", "/", "/", "Select", ":", "Literal", "(", "char", ")", "or", "Match", "(", "within", "32K", ")", "if", "(", "CDG_RAND15BITS", "<", "P32", ")", "{", "/", "/", "Copy", "(", "within", "64K", ")", "U32", "d", ";", "int", "ref", ";", "int", "length", "=", "CDG_RANDLENGTH", "+", "4", ";", "U32", "offset", "=", "CDG_RAND15BITS", "+", "1", ";", "if", "(", "offset", ">", "pos", ")", "offset", "=", "pos", ";", "ref", "=", "pos", "-", "offset", ";", "d", "=", "pos", "+", "length", ";", "while", "(", "pos", "<", "d", ")", "fullbuff", "[", "pos", "+", "+]", "=", "fullbuff", "[", "ref", "+", "+]", ";", "}", "else", "{", "/", "/", "Literal", "(", "noise", ")", "U32", "d", ";", "int", "length", "=", "CDG_RANDLENGTH", ";", "d", "=", "pos", "+", "length", ";", "while", "(", "pos", "<", "d", ")", "fullbuff", "[", "pos", "+", "+]", "=", "CDG_RANDCHAR", ";", "}", "}", "/", "/", "Generate", "compressible", "data", "pos", "=", "0", ";", "while", "(", "total", "<", "size", ")", "{", "if", "(", "size", "-", "total", "<", "128", "KB", ")", "genBlockSize", "=", "(", "U32", ")", "(", "size", "-", "total", ")", ";", "total", "+", "=", "genBlockSize", ";", "buff", "[", "genBlockSize", "]", "=", "0", ";", "pos", "=", "0", ";", "while", "(", "pos", "<", "genBlockSize", ")", "{", "/", "/", "Select", ":", "Literal", "(", "char", ")", "or", "Match", "(", "within", "32K", ")", "if", "(", "CDG_RAND15BITS", "<", "P32", ")", "{", "/", "/", "Copy", "(", "within", "64K", ")", "int", "ref", ";", "U32", "d", ";", "int", "length", "=", "CDG_RANDLENGTH", "+", "4", ";", "U32", "offset", "=", "CDG_RAND15BITS", "+", "1", ";", "if", "(", "pos", "+", "length", ">", "genBlockSize", ")", "length", "=", "genBlockSize", "-", "pos", ";", "ref", "=", "pos", "-", "offset", ";", "d", "=", "pos", "+", "length", ";", "while", "(", "pos", "<", "d", ")", "buff", "[", "pos", "+", "+]", "=", "buff", "[", "ref", "+", "+]", ";", "}", "else", "{", "/", "/", "Literal", "(", "noise", ")", "U32", "d", ";", "int", "length", "=", "CDG_RANDLENGTH", ";", "if", "(", "pos", "+", "length", ">", "genBlockSize", ")", "length", "=", "genBlockSize", "-", "pos", ";", "d", "=", "pos", "+", "length", ";", "while", "(", "pos", "<", "d", ")", "buff", "[", "pos", "+", "+]", "=", "CDG_RANDCHAR", ";", "}", "}", "pos", "=", "0", ";", "for", "(", ";", "pos", "+", "512", "<", "=", "genBlockSize", ";", "pos", "+", "=", "512", ")", "printf", "(", "\"%", "512", ".", "512s", "\"", ",", "buff", "+", "pos", ")", ";", "for", "(", ";", "pos", "<", "genBlockSize", ";", "pos", "+", "+)", "printf", "(", "\"%", "c", "\"", ",", "buff", "[", "pos", "]", ");", "/", "/", "Regenerate", "prefix", "memcpy", "(", "fullbuff", ",", "buff", "+", "96", "KB", ",", "32", "KB", ")", ";", "}", "}", "int", "CDG_usage", "(", ")", "{", "DISPLAY", "(", "\"", "Compressible", "data", "generator", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Usage", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "[", "size", "]", "[", "args", "]", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "g", "#", ":", "generate", "#", "data", "(", "default", ":", "%", "i", ")", "\\", "n", "\"", ",", "CDG_SIZE_DEFAULT", ")", ";", "DISPLAY", "(", "\"", "-", "s", "#", ":", "Select", "seed", "(", "default", ":", "%", "i", ")", "\\", "n", "\"", ",", "CDG_SEED_DEFAULT", ")", ";", "DISPLAY", "(", "\"", "-", "p", "#", ":", "Select", "compressibility", "in", "%", "%", "(", "default", ":", "%", "i", "%", "%)", "\\", "n", "\"", ",", "CDG_COMPRESSIBILITY_DEFAULT", ")", ";", "DISPLAY", "(", "\"", "-", "h", ":", "display", "help", "and", "exit", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "main", "(", "int", "argc", ",", "char", "*", "*", "argv", ")", "{", "int", "argNb", ";", "int", "proba", "=", "CDG_COMPRESSIBILITY_DEFAULT", ";", "U64", "size", "=", "CDG_SIZE_DEFAULT", ";", "U32", "seed", "=", "CDG_SEED_DEFAULT", ";", "/", "/", "Check", "command", "line", "programName", "=", "argv", "[", "0", "]", ";", "for", "(", "argNb", "=", "1", ";", "argNb", "<", "argc", ";", "argNb", "+", "+)", "{", "char", "*", "argument", "=", "argv", "[", "argNb", "]", ";", "if", "(", "!", "argument", ")", "continue", ";", "/", "/", "Protection", "if", "argument", "empty", "/", "/", "Decode", "command", "(", "note", ":", "aggregated", "commands", "are", "allowed", ")", "if", "(", "argument", "[", "0", "]", "==", "'-", "')", "{", "if", "(", "!", "strcmp", "(", "argument", ",", "\"", "--", "no", "-", "prompt", "\"", "))", "{", "no_prompt", "=", "1", ";", "continue", ";", "}", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "{", "argument", "+", "+;", "switch", "(", "*", "argument", ")", "{", "case", "'", "h", "'", ":", "return", "CDG_usage", "(", ");", "case", "'", "g", "'", ":", "argument", "+", "+;", "size", "=", "0", ";", "while", "(", "(*", "argument", ">", "='", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "='", "9", "'", "))", "{", "size", "*", "=", "10", ";", "size", "+", "=", "*", "argument", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "if", "(", "*", "argument", "=", "='", "K", "'", ")", "{", "size", "<", "<=", "10", ";", "argument", "+", "+;", "}", "if", "(", "*", "argument", "=", "='", "M", "'", ")", "{", "size", "<", "<=", "20", ";", "argument", "+", "+;", "}", "if", "(", "*", "argument", "=", "='", "G", "'", ")", "{", "size", "<", "<=", "30", ";", "argument", "+", "+;", "}", "if", "(", "*", "argument", "=", "='", "B", "'", ")", "{", "argument", "+", "+;", "}", "break", ";", "case", "'", "s", "'", ":", "argument", "+", "+;", "seed", "=", "0", ";", "while", "(", "(*", "argument", ">", "='", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "='", "9", "'", "))", "{", "seed", "*", "=", "10", ";", "seed", "+", "=", "*", "argument", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "break", ";", "case", "'", "p", "'", ":", "argument", "+", "+;", "proba", "=", "0", ";", "while", "(", "(*", "argument", ">", "='", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "='", "9", "'", "))", "{", "proba", "*", "=", "10", ";", "proba", "+", "=", "*", "argument", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "if", "(", "proba", "<", "0", ")", "proba", "=", "0", ";", "if", "(", "proba", ">", "100", ")", "proba", "=", "100", ";", "break", ";", "case", "'", "v", "'", ":", "displayLevel", "=", "4", ";", "break", ";", "default", ":", ";", "}", "}", "}", "}", "/", "/", "Get", "Seed", "DISPLAYLEVEL", "(", "4", ",", "\"", "Data", "Generator", "%", "s", "\\", "n", "\"", ",", "LZ4_VERSION", ")", ";", "DISPLAYLEVEL", "(", "3", ",", "\"", "Seed", "=", "%", "u", "\\", "n", "\"", ",", "seed", ")", ";", "if", "(", "proba", "!", "=", "CDG_COMPRESSIBILITY_DEFAULT", ")", "DISPLAYLEVEL", "(", "3", ",", "\"", "Compressibility", ":", "%", "i", "%", "%\\", "n", "\"", ",", "proba", ")", ";", "CDG_generate", "(", "size", ",", "&", "seed", ",", "(", "(", "double", ")", "proba", ")", "/", "100", ")", ";", "return", "0", ";", "}", "@", "@", "-", "1", ",", "705", "+", "1", ",", "763", "@", "@", "/", "*", "bench", ".", "c", "-", "Demo", "program", "to", "benchmark", "open", "-", "source", "compression", "algorithm", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2013", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "define", "_CRT_SECURE_NO_WARNINGS", "#", "define", "_CRT_SECURE_NO_DEPRECATE", "/", "/", "VS2005", "/", "/", "Unix", "Large", "Files", "support", "(", ">", "4GB", ")", "#", "if", "(", "defined", "(", "__sun__", ")", "&", "&", "(", "!", "defined", "(", "__LP64__", ")", "))", "/", "/", "Sun", "Solaris", "32", "-", "bits", "requires", "specific", "definitions", "#", "define", "_LARGEFILE_SOURCE", "#", "define", "_FILE_OFFSET_BITS", "64", "#", "elif", "!", "defined", "(", "__LP64__", ")", "/", "/", "No", "point", "defining", "Large", "file", "for", "64", "bit", "#", "define", "_LARGEFILE64_SOURCE", "#", "endif", "/", "/", "S_ISREG", "&", "gettimeofday", "(", ")", "are", "not", "supported", "by", "MSVC", "#", "if", "defined", "(", "_MSC_VER", ")", "|", "|", "defined", "(", "_WIN32", ")", "#", "define", "BMK_LEGACY_TIMER", "1", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "malloc", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fprintf", ",", "fopen", ",", "ftello64", "#", "include", "<", "sys", "/", "types", ".", "h", ">", "/", "/", "stat64", "#", "include", "<", "sys", "/", "stat", ".", "h", ">", "/", "/", "stat64", "/", "/", "Use", "ftime", "(", ")", "if", "gettimeofday", "(", ")", "is", "not", "available", "on", "your", "target", "#", "if", "defined", "(", "BMK_LEGACY_TIMER", ")", "#", "include", "<", "sys", "/", "timeb", ".", "h", ">", "/", "/", "timeb", ",", "ftime", "#", "else", "#", "include", "<", "sys", "/", "time", ".", "h", ">", "/", "/", "gettimeofday", "#", "endif", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "define", "COMPRESSOR0", "LZ4_compress", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "define", "COMPRESSOR1", "LZ4_compressHC", "#", "define", "DEFAULTCOMPRESSOR", "COMPRESSOR0", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "S_ISREG", "&", "gettimeofday", "(", ")", "are", "not", "supported", "by", "MSVC", "#", "if", "!", "defined", "(", "S_ISREG", ")", "#", "define", "S_ISREG", "(", "x", ")", "(", "((", "x", ")", "&", "S_IFMT", ")", "=", "=", "S_IFREG", ")", "#", "endif", "/", "/", "GCC", "does", "not", "support", "_rotl", "outside", "of", "Windows", "#", "if", "!", "defined", "(", "_WIN32", ")", "#", "define", "_rotl", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "COMPRESSOR_NAME", "\"", "Full", "LZ4", "speed", "analyzer", "\"", "#", "define", "COMPRESSOR_VERSION", "\"", "\"", "#", "define", "COMPILED", "__DATE__", "#", "define", "AUTHOR", "\"", "Yann", "Collet", "\"", "#", "define", "WELCOME_MESSAGE", "\"", "**", "*", "%", "s", "%", "s", ",", "by", "%", "s", "(", "%", "s", ")", "*", "**", "\\", "n", "\"", ",", "COMPRESSOR_NAME", ",", "COMPRESSOR_VERSION", ",", "AUTHOR", ",", "COMPILED", "#", "define", "NBLOOPS", "6", "#", "define", "TIMELOOP", "2500", "#", "define", "KNUTH", "2654435761U", "#", "define", "MAX_MEM", "(", "1984", "<", "<", "20", ")", "#", "define", "DEFAULT_CHUNKSIZE", "(", "4", "<", "<", "20", ")", "#", "define", "ALL_COMPRESSORS", "-", "1", "#", "define", "ALL_DECOMPRESSORS", "-", "1", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "structures", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "struct", "chunkParameters", "{", "U32", "id", ";", "char", "*", "origBuffer", ";", "char", "*", "compressedBuffer", ";", "int", "origSize", ";", "int", "compressedSize", ";", "}", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "MACRO", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Benchmark", "Parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "int", "chunkSize", "=", "DEFAULT_CHUNKSIZE", ";", "static", "int", "nbIterations", "=", "NBLOOPS", ";", "static", "int", "BMK_pause", "=", "0", ";", "static", "int", "compressionTest", "=", "1", ";", "static", "int", "decompressionTest", "=", "1", ";", "static", "int", "compressionAlgo", "=", "ALL_COMPRESSORS", ";", "static", "int", "decompressionAlgo", "=", "ALL_DECOMPRESSORS", ";", "void", "BMK_SetBlocksize", "(", "int", "bsize", ")", "{", "chunkSize", "=", "bsize", ";", "DISPLAY", "(", "\"-", "Using", "Block", "Size", "of", "%", "i", "KB", "-", "\\", "n", "\"", ",", "chunkSize", ">", ">", "10", ")", ";", "}", "void", "BMK_SetNbIterations", "(", "int", "nbLoops", ")", "{", "nbIterations", "=", "nbLoops", ";", "DISPLAY", "(", "\"-", "%", "i", "iterations", "-", "\\", "n", "\"", ",", "nbIterations", ")", ";", "}", "void", "BMK_SetPause", "(", ")", "{", "BMK_pause", "=", "1", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Private", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "#", "if", "defined", "(", "BMK_LEGACY_TIMER", ")", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Based", "on", "Legacy", "ftime", "(", ")", "/", "/", "Rolls", "over", "every", "~", "12", ".", "1", "days", "(", "0x100000", "/", "24", "/", "60", "/", "60", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeb", "tb", ";", "int", "nCount", ";", "ftime", "(", "&", "tb", ")", ";", "nCount", "=", "(", "int", ")", "(", "tb", ".", "millitm", "+", "(", "tb", ".", "time", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "#", "else", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Based", "on", "newer", "gettimeofday", "(", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeval", "tv", ";", "int", "nCount", ";", "gettimeofday", "(", "&", "tv", ",", "NULL", ")", ";", "nCount", "=", "(", "int", ")", "(", "tv", ".", "tv_usec", "/", "1000", "+", "(", "tv", ".", "tv_sec", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "#", "endif", "static", "int", "BMK_GetMilliSpan", "(", "int", "nTimeStart", ")", "{", "int", "nSpan", "=", "BMK_GetMilliStart", "(", ")", "-", "nTimeStart", ";", "if", "(", "nSpan", "<", "0", ")", "nSpan", "+", "=", "0x100000", "*", "1000", ";", "return", "nSpan", ";", "}", "static", "size_t", "BMK_findMaxMem", "(", "U64", "requiredMem", ")", "{", "size_t", "step", "=", "(", "64U", "<", "<", "20", ")", ";", "/", "/", "64", "MB", "BYTE", "*", "testmem", "=", "NULL", ";", "requiredMem", "=", "(", "((", "requiredMem", ">", ">", "25", ")", "+", "1", ")", "<", "<", "26", ")", ";", "if", "(", "requiredMem", ">", "MAX_MEM", ")", "requiredMem", "=", "MAX_MEM", ";", "requiredMem", "+", "=", "2", "*", "step", ";", "while", "(", "!", "testmem", ")", "{", "requiredMem", "-", "=", "step", ";", "testmem", "=", "(", "BYTE", "*", ")", "malloc", "(", "(", "size_t", ")", "requiredMem", ")", ";", "}", "free", "(", "testmem", ")", ";", "return", "(", "size_t", ")", "(", "requiredMem", "-", "step", ")", ";", "}", "static", "U64", "BMK_GetFileSize", "(", "char", "*", "infilename", ")", "{", "int", "r", ";", "#", "if", "defined", "(", "_MSC_VER", ")", "struct", "_stat64", "statbuf", ";", "r", "=", "_stat64", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "else", "struct", "stat", "statbuf", ";", "r", "=", "stat", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "endif", "if", "(", "r", "|", "|", "!", "S_ISREG", "(", "statbuf", ".", "st_mode", ")", ")", "return", "0", ";", "/", "/", "No", "good", ".", "..", "return", "(", "U64", ")", "statbuf", ".", "st_size", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Public", "function", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "static", "inline", "int", "local_LZ4_compress_limitedOutput", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_limitedOutput", "(", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "void", "*", "ctx", ";", "static", "inline", "int", "local_LZ4_compress_continue", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_continue", "(", "ctx", ",", "in", ",", "out", ",", "inSize", ")", ";", "}", "static", "inline", "int", "local_LZ4_compress_limitedOutput_continue", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_limitedOutput_continue", "(", "ctx", ",", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "inline", "int", "local_LZ4_compressHC_limitedOutput", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compressHC_limitedOutput", "(", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "inline", "int", "local_LZ4_compressHC_continue", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compressHC_continue", "(", "ctx", ",", "in", ",", "out", ",", "inSize", ")", ";", "}", "static", "inline", "int", "local_LZ4_compressHC_limitedOutput_continue", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compressHC_limitedOutput_continue", "(", "ctx", ",", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "inline", "int", "local_LZ4_decompress_fast", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ",", "int", "outSize", ")", "{", "(", "void", ")", "inSize", ";", "LZ4_decompress_fast", "(", "in", ",", "out", ",", "outSize", ")", ";", "return", "outSize", ";", "}", "static", "inline", "int", "local_LZ4_decompress_fast_withPrefix64k", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ",", "int", "outSize", ")", "{", "(", "void", ")", "inSize", ";", "LZ4_decompress_fast_withPrefix64k", "(", "in", ",", "out", ",", "outSize", ")", ";", "return", "outSize", ";", "}", "static", "inline", "int", "local_LZ4_decompress_safe_partial", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ",", "int", "outSize", ")", "{", "return", "LZ4_decompress_safe_partial", "(", "in", ",", "out", ",", "inSize", ",", "outSize", "-", "5", ",", "outSize", ")", ";", "}", "int", "fullSpeedBench", "(", "char", "*", "*", "fileNamesTable", ",", "int", "nbFiles", ")", "{", "int", "fileIdx", "=", "0", ";", "char", "*", "orig_buff", ";", "#", "define", "NB_COMPRESSION_ALGORITHMS", "8", "#", "define", "MINCOMPRESSIONCHAR", "'", "0", "'", "#", "define", "MAXCOMPRESSIONCHAR", "(", "MINCOMPRESSIONCHAR", "+", "NB_COMPRESSION_ALGORITHMS", ")", "static", "char", "*", "compressionNames", "[", "]", "=", "{", "\"", "LZ4_compress", "\"", ",", "\"", "LZ4_compress_limitedOutput", "\"", ",", "\"", "LZ4_compress_continue", "\"", ",", "\"", "LZ4_compress_limitedOutput_continue", "\"", ",", "\"", "LZ4_compressHC", "\"", ",", "\"", "LZ4_compressHC_limitedOutput", "\"", ",", "\"", "LZ4_compressHC_continue", "\"", ",", "\"", "LZ4_compressHC_limitedOutput_continue", "\"", "}", ";", "double", "totalCTime", "[", "NB_COMPRESSION_ALGORITHMS", "]", "=", "{", "0", "}", ";", "double", "totalCSize", "[", "NB_COMPRESSION_ALGORITHMS", "]", "=", "{", "0", "}", ";", "#", "define", "NB_DECOMPRESSION_ALGORITHMS", "5", "#", "define", "MINDECOMPRESSIONCHAR", "'", "0", "'", "#", "define", "MAXDECOMPRESSIONCHAR", "(", "MINDECOMPRESSIONCHAR", "+", "NB_DECOMPRESSION_ALGORITHMS", ")", "static", "char", "*", "decompressionNames", "[", "]", "=", "{", "\"", "LZ4_decompress_fast", "\"", ",", "\"", "LZ4_decompress_fast_withPrefix64k", "\"", ",", "\"", "LZ4_decompress_safe", "\"", ",", "\"", "LZ4_decompress_safe_withPrefix64k", "\"", ",", "\"", "LZ4_decompress_safe_partial", "\"", "}", ";", "double", "totalDTime", "[", "NB_DECOMPRESSION_ALGORITHMS", "]", "=", "{", "0", "}", ";", "U64", "totals", "=", "0", ";", "/", "/", "Loop", "for", "each", "file", "while", "(", "fileIdx", "<", "nbFiles", ")", "{", "FILE", "*", "inFile", ";", "char", "*", "inFileName", ";", "U64", "inFileSize", ";", "size_t", "benchedSize", ";", "int", "nbChunks", ";", "int", "maxCompressedChunkSize", ";", "struct", "chunkParameters", "*", "chunkP", ";", "size_t", "readSize", ";", "char", "*", "compressed_buff", ";", "int", "compressedBuffSize", ";", "U32", "crcOriginal", ";", "/", "/", "Check", "file", "existence", "inFileName", "=", "fileNamesTable", "[", "fileIdx", "+", "+]", ";", "inFile", "=", "fopen", "(", "inFileName", ",", "\"", "rb", "\"", ")", ";", "if", "(", "inFile", "=", "=", "NULL", ")", "{", "DISPLAY", "(", "\"", "Pb", "opening", "%", "s", "\\", "n", "\"", ",", "inFileName", ")", ";", "return", "11", ";", "}", "/", "/", "Memory", "allocation", "&", "restrictions", "inFileSize", "=", "BMK_GetFileSize", "(", "inFileName", ")", ";", "benchedSize", "=", "(", "size_t", ")", "BMK_findMaxMem", "(", "inFileSize", ")", "/", "2", ";", "if", "(", "(", "U64", ")", "benchedSize", ">", "inFileSize", ")", "benchedSize", "=", "(", "size_t", ")", "inFileSize", ";", "if", "(", "benchedSize", "<", "inFileSize", ")", "{", "DISPLAY", "(", "\"", "Not", "enough", "memory", "for", "'", "%", "s", "'", "full", "size", ";", "testing", "%", "i", "MB", "only", ".", "..", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "(", "benchedSize", ">", ">", "20", ")", ");", "}", "/", "/", "Alloc", "chunkP", "=", "(", "struct", "chunkParameters", "*", ")", "malloc", "(", "((", "benchedSize", "/", "chunkSize", ")", "+", "1", ")", "*", "sizeof", "(", "struct", "chunkParameters", ")", ");", "orig_buff", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "benchedSize", ")", ";", "nbChunks", "=", "(", "int", ")", "(", "benchedSize", "/", "chunkSize", ")", "+", "1", ";", "maxCompressedChunkSize", "=", "LZ4_compressBound", "(", "chunkSize", ")", ";", "compressedBuffSize", "=", "nbChunks", "*", "maxCompressedChunkSize", ";", "compressed_buff", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "compressedBuffSize", ")", ";", "if", "(", "!", "orig_buff", "|", "|", "!", "compressed_buff", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "not", "enough", "memory", "!", "\\", "n", "\"", ");", "free", "(", "orig_buff", ")", ";", "free", "(", "compressed_buff", ")", ";", "free", "(", "chunkP", ")", ";", "fclose", "(", "inFile", ")", ";", "return", "12", ";", "}", "/", "/", "Init", "chunks", "data", "{", "int", "i", ";", "size_t", "remaining", "=", "benchedSize", ";", "char", "*", "in", "=", "orig_buff", ";", "char", "*", "out", "=", "compressed_buff", ";", "for", "(", "i", "=", "0", ";", "i", "<", "nbChunks", ";", "i", "+", "+)", "{", "chunkP", "[", "i", "]", ".", "id", "=", "i", ";", "chunkP", "[", "i", "]", ".", "origBuffer", "=", "in", ";", "in", "+", "=", "chunkSize", ";", "if", "(", "(", "int", ")", "remaining", ">", "chunkSize", ")", "{", "chunkP", "[", "i", "]", ".", "origSize", "=", "chunkSize", ";", "remaining", "-", "=", "chunkSize", ";", "}", "else", "{", "chunkP", "[", "i", "]", ".", "origSize", "=", "(", "int", ")", "remaining", ";", "remaining", "=", "0", ";", "}", "chunkP", "[", "i", "]", ".", "compressedBuffer", "=", "out", ";", "out", "+", "=", "maxCompressedChunkSize", ";", "chunkP", "[", "i", "]", ".", "compressedSize", "=", "0", ";", "}", "}", "/", "/", "Fill", "input", "buffer", "DISPLAY", "(", "\"", "Loading", "%", "s", ".", "..", "\\", "r", "\"", ",", "inFileName", ")", ";", "readSize", "=", "fread", "(", "orig_buff", ",", "1", ",", "benchedSize", ",", "inFile", ")", ";", "fclose", "(", "inFile", ")", ";", "if", "(", "readSize", "!", "=", "benchedSize", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "problem", "reading", "file", "'", "%", "s", "'", "!", "!", "\\", "n", "\"", ",", "inFileName", ")", ";", "free", "(", "orig_buff", ")", ";", "free", "(", "compressed_buff", ")", ";", "free", "(", "chunkP", ")", ";", "return", "13", ";", "}", "/", "/", "Calculating", "input", "Checksum", "crcOriginal", "=", "XXH32", "(", "orig_buff", ",", "(", "unsigned", "int", ")", "benchedSize", ",", "0", ")", ";", "/", "/", "Bench", "{", "int", "loopNb", ",", "nb_loops", ",", "chunkNb", ",", "cAlgNb", ",", "dAlgNb", ";", "size_t", "cSize", "=", "0", ";", "double", "ratio", "=", "0", ".", ";", "DISPLAY", "(", "\"\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "DISPLAY", "(", "\"", "%", "s", ":", "\\", "n", "\"", ",", "inFileName", ")", ";", "/", "/", "Compression", "Algorithms", "for", "(", "cAlgNb", "=", "0", ";", "(", "cAlgNb", "<", "NB_COMPRESSION_ALGORITHMS", ")", "&", "&", "(", "compressionTest", ")", ";", "cAlgNb", "+", "+)", "{", "char", "*", "cName", "=", "compressionNames", "[", "cAlgNb", "]", ";", "int", "(", "*", "compressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ")", ";", "void", "*", "(", "*", "initFunction", ")", "(", "const", "char", "*", ")", "=", "NULL", ";", "double", "bestTime", "=", "100000000", ".", ";", "if", "(", "(", "compressionAlgo", "!", "=", "ALL_COMPRESSORS", ")", "&", "&", "(", "compressionAlgo", "!", "=", "cAlgNb", ")", ")", "continue", ";", "switch", "(", "cAlgNb", ")", "{", "case", "0", ":", "compressionFunction", "=", "LZ4_compress", ";", "break", ";", "case", "1", ":", "compressionFunction", "=", "local_LZ4_compress_limitedOutput", ";", "break", ";", "case", "2", ":", "compressionFunction", "=", "local_LZ4_compress_continue", ";", "initFunction", "=", "LZ4_create", ";", "break", ";", "case", "3", ":", "compressionFunction", "=", "local_LZ4_compress_limitedOutput_continue", ";", "initFunction", "=", "LZ4_create", ";", "break", ";", "case", "4", ":", "compressionFunction", "=", "LZ4_compressHC", ";", "break", ";", "case", "5", ":", "compressionFunction", "=", "local_LZ4_compressHC_limitedOutput", ";", "break", ";", "case", "6", ":", "compressionFunction", "=", "local_LZ4_compressHC_continue", ";", "initFunction", "=", "LZ4_createHC", ";", "break", ";", "case", "7", ":", "compressionFunction", "=", "local_LZ4_compressHC_limitedOutput_continue", ";", "initFunction", "=", "LZ4_createHC", ";", "break", ";", "default", ":", "DISPLAY", "(", "\"", "ERROR", "!", "Bad", "algorithm", "Id", "!", "!", "\\", "n", "\"", ");", "free", "(", "chunkP", ")", ";", "return", "1", ";", "}", "for", "(", "loopNb", "=", "1", ";", "loopNb", "<", "=", "nbIterations", ";", "loopNb", "+", "+)", "{", "double", "averageTime", ";", "int", "milliTime", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "19", ".", "19s", ":", "%", "9i", "-", ">\\", "r", "\"", ",", "loopNb", ",", "cName", ",", "(", "int", ")", "benchedSize", ")", ";", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "benchedSize", ";", "i", "+", "+)", "compressed_buff", "[", "i", "]", "=(", "char", ")", "i", ";", "}", "/", "/", "warmimg", "up", "memory", "nb_loops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "if", "(", "initFunction", "!", "=", "NULL", ")", "ctx", "=", "initFunction", "(", "chunkP", "[", "0", "]", ".", "origBuffer", ")", ";", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "{", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "compressionFunction", "(", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "if", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "=", "0", ")", "DISPLAY", "(", "\"", "ERROR", "!", "%", "s", "(", ")", "=", "0", "!", "!", "\\", "n", "\"", ",", "cName", ")", ",", "exit", "(", "1", ")", ";", "}", "if", "(", "initFunction", "!", "=", "NULL", ")", "free", "(", "ctx", ")", ";", "nb_loops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "averageTime", "=", "(", "double", ")", "milliTime", "/", "nb_loops", ";", "if", "(", "averageTime", "<", "bestTime", ")", "bestTime", "=", "averageTime", ";", "cSize", "=", "0", ";", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "cSize", "+", "=", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ";", "ratio", "=", "(", "double", ")", "cSize", "/", "(", "double", ")", "benchedSize", "*", "100", ".", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "19", ".", "19s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "cName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "}", "if", "(", "ratio", "<", "100", ".", ")", "DISPLAY", "(", "\"%", "-", "21", ".", "21s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "cName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "else", "DISPLAY", "(", "\"%", "-", "21", ".", "21s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "1f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "cName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "totalCTime", "[", "cAlgNb", "]", "+", "=", "bestTime", ";", "totalCSize", "[", "cAlgNb", "]", "+", "=", "cSize", ";", "}", "/", "/", "Prepare", "layout", "for", "decompression", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "{", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "LZ4_compress", "(", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "if", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "=", "0", ")", "DISPLAY", "(", "\"", "ERROR", "!", "%", "s", "(", ")", "=", "0", "!", "!", "\\", "n", "\"", ",", "compressionNames", "[", "0", "]", "),", "exit", "(", "1", ")", ";", "}", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "benchedSize", ";", "i", "+", "+)", "orig_buff", "[", "i", "]", "=", "0", ";", "}", "/", "/", "zeroing", "source", "area", ",", "for", "CRC", "checking", "/", "/", "Decompression", "Algorithms", "for", "(", "dAlgNb", "=", "0", ";", "(", "dAlgNb", "<", "NB_DECOMPRESSION_ALGORITHMS", ")", "&", "&", "(", "decompressionTest", ")", ";", "dAlgNb", "+", "+)", "{", "char", "*", "dName", "=", "decompressionNames", "[", "dAlgNb", "]", ";", "int", "(", "*", "decompressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ",", "int", ")", ";", "double", "bestTime", "=", "100000000", ".", ";", "if", "(", "(", "decompressionAlgo", "!", "=", "ALL_DECOMPRESSORS", ")", "&", "&", "(", "decompressionAlgo", "!", "=", "dAlgNb", ")", ")", "continue", ";", "switch", "(", "dAlgNb", ")", "{", "case", "0", ":", "decompressionFunction", "=", "local_LZ4_decompress_fast", ";", "break", ";", "case", "1", ":", "decompressionFunction", "=", "local_LZ4_decompress_fast_withPrefix64k", ";", "break", ";", "case", "2", ":", "decompressionFunction", "=", "LZ4_decompress_safe", ";", "break", ";", "case", "3", ":", "decompressionFunction", "=", "LZ4_decompress_safe_withPrefix64k", ";", "break", ";", "case", "4", ":", "decompressionFunction", "=", "local_LZ4_decompress_safe_partial", ";", "break", ";", "default", ":", "DISPLAY", "(", "\"", "ERROR", "!", "Bad", "algorithm", "Id", "!", "!", "\\", "n", "\"", ");", "free", "(", "chunkP", ")", ";", "return", "1", ";", "}", "for", "(", "loopNb", "=", "1", ";", "loopNb", "<", "=", "nbIterations", ";", "loopNb", "+", "+)", "{", "double", "averageTime", ";", "int", "milliTime", ";", "U32", "crcDecoded", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "24", ".", "24s", ":", "%", "10i", "-", ">\\", "r", "\"", ",", "loopNb", ",", "dName", ",", "(", "int", ")", "benchedSize", ")", ";", "nb_loops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "{", "int", "decodedSize", "=", "decompressionFunction", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "if", "(", "chunkP", "[", "chunkNb", "]", ".", "origSize", "!", "=", "decodedSize", ")", "DISPLAY", "(", "\"", "ERROR", "!", "%", "s", "(", ")", "=", "=", "%", "i", "!", "=", "%", "i", "!", "!", "\\", "n", "\"", ",", "dName", ",", "decodedSize", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ",", "exit", "(", "1", ")", ";", "}", "nb_loops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "averageTime", "=", "(", "double", ")", "milliTime", "/", "nb_loops", ";", "if", "(", "averageTime", "<", "bestTime", ")", "bestTime", "=", "averageTime", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "24", ".", "24s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "dName", ",", "(", "int", ")", "benchedSize", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "/", "/", "CRC", "Checking", "crcDecoded", "=", "XXH32", "(", "orig_buff", ",", "(", "int", ")", "benchedSize", ",", "0", ")", ";", "if", "(", "crcOriginal", "!", "=", "crcDecoded", ")", "{", "DISPLAY", "(", "\"\\", "n", "!", "!!", "WARNING", "!", "!!", "%", "14s", ":", "Invalid", "Checksum", ":", "%", "x", "!", "=", "%", "x", "\\", "n", "\"", ",", "inFileName", ",", "(", "unsigned", ")", "crcOriginal", ",", "(", "unsigned", ")", "crcDecoded", ")", ";", "exit", "(", "1", ")", ";", "}", "}", "DISPLAY", "(", "\"%", "-", "26", ".", "26s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "dName", ",", "(", "int", ")", "benchedSize", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "totalDTime", "[", "dAlgNb", "]", "+", "=", "bestTime", ";", "}", "totals", "+", "=", "benchedSize", ";", "}", "free", "(", "orig_buff", ")", ";", "free", "(", "compressed_buff", ")", ";", "free", "(", "chunkP", ")", ";", "}", "if", "(", "nbFiles", ">", "1", ")", "{", "int", "AlgNb", ";", "DISPLAY", "(", "\"", "*", "*", "TOTAL", "*", "*", ":", "\\", "n", "\"", ");", "for", "(", "AlgNb", "=", "0", ";", "(", "AlgNb", "<", "NB_COMPRESSION_ALGORITHMS", ")", "&", "&", "(", "compressionTest", ")", ";", "AlgNb", "+", "+)", "{", "char", "*", "cName", "=", "compressionNames", "[", "AlgNb", "]", ";", "if", "(", "(", "compressionAlgo", "!", "=", "ALL_COMPRESSORS", ")", "&", "&", "(", "compressionAlgo", "!", "=", "AlgNb", ")", ")", "continue", ";", "DISPLAY", "(", "\"%", "-", "21", ".", "21s", ":", "%", "10llu", "-", ">%", "10llu", "(", "%", "5", ".", "2f", "%", "%)", ",", "%", "6", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "cName", ",", "(", "long", "long", "unsigned", "int", ")", "totals", ",", "(", "long", "long", "unsigned", "int", ")", "totalCSize", "[", "AlgNb", "]", ",", "(", "double", ")", "totalCSize", "[", "AlgNb", "]", "/(", "double", ")", "totals", "*", "100", ".", ",", "(", "double", ")", "totals", "/", "totalCTime", "[", "AlgNb", "]", "/", "1000", ".", ");", "}", "for", "(", "AlgNb", "=", "0", ";", "(", "AlgNb", "<", "NB_DECOMPRESSION_ALGORITHMS", ")", "&", "&", "(", "decompressionTest", ")", ";", "AlgNb", "+", "+)", "{", "char", "*", "dName", "=", "decompressionNames", "[", "AlgNb", "]", ";", "if", "(", "(", "decompressionAlgo", "!", "=", "ALL_DECOMPRESSORS", ")", "&", "&", "(", "decompressionAlgo", "!", "=", "AlgNb", ")", ")", "continue", ";", "DISPLAY", "(", "\"%", "-", "21", ".", "21s", ":", "%", "10llu", "-", ">", "%", "6", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "dName", ",", "(", "long", "long", "unsigned", "int", ")", "totals", ",", "(", "double", ")", "totals", "/", "totalDTime", "[", "AlgNb", "]", "/", "1000", ".", ");", "}", "}", "if", "(", "BMK_pause", ")", "{", "printf", "(", "\"", "press", "enter", ".", "..", "\\", "n", "\"", ");", "getchar", "(", ");", "}", "return", "0", ";", "}", "int", "usage", "(", "char", "*", "exename", ")", "{", "DISPLAY", "(", "\"", "Usage", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "[", "arg", "]", "file1", "file2", ".", "..", "fileX", "\\", "n", "\"", ",", "exename", ")", ";", "DISPLAY", "(", "\"", "Arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c", ":", "compression", "tests", "only", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "d", ":", "decompression", "tests", "only", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "H", "/", "-", "h", ":", "Help", "(", "this", "text", "+", "advanced", "options", ")", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "usage_advanced", "(", ")", "{", "DISPLAY", "(", "\"", "\\", "nAdvanced", "options", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c", "#", ":", "test", "only", "compression", "function", "#", "[", "%", "c", "-", "%", "c", "]", "\\", "n", "\"", ",", "MINCOMPRESSIONCHAR", ",", "MAXCOMPRESSIONCHAR", ")", ";", "DISPLAY", "(", "\"", "-", "d", "#", ":", "test", "only", "compression", "function", "#", "[", "%", "c", "-", "%", "c", "]", "\\", "n", "\"", ",", "MINDECOMPRESSIONCHAR", ",", "MAXDECOMPRESSIONCHAR", ")", ";", "DISPLAY", "(", "\"", "-", "i", "#", ":", "iteration", "loops", "[", "1", "-", "9", "]", "(", "default", ":", "%", "i", ")", "\\", "n", "\"", ",", "NBLOOPS", ")", ";", "DISPLAY", "(", "\"", "-", "B", "#", ":", "Block", "size", "[", "4", "-", "7", "]", "(", "default", ":", "7", ")", "\\", "n", "\"", ");", "/", "/", "DISPLAY", "(", "\"", "-", "BD", ":", "Block", "dependency", "(", "improve", "compression", "ratio", ")", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "badusage", "(", "char", "*", "exename", ")", "{", "DISPLAY", "(", "\"", "Wrong", "parameters", "\\", "n", "\"", ");", "usage", "(", "exename", ")", ";", "return", "0", ";", "}", "int", "main", "(", "int", "argc", ",", "char", "*", "*", "argv", ")", "{", "int", "i", ",", "filenamesStart", "=", "2", ";", "char", "*", "exename", "=", "argv", "[", "0", "]", ";", "char", "*", "input_filename", "=", "0", ";", "/", "/", "Welcome", "message", "DISPLAY", "(", "WELCOME_MESSAGE", ")", ";", "if", "(", "argc", "<", "2", ")", "{", "badusage", "(", "exename", ")", ";", "return", "1", ";", "}", "for", "(", "i", "=", "1", ";", "i", "<", "argc", ";", "i", "+", "+)", "{", "char", "*", "argument", "=", "argv", "[", "i", "]", ";", "if", "(", "!", "argument", ")", "continue", ";", "/", "/", "Protection", "if", "argument", "empty", "/", "/", "Decode", "command", "(", "note", ":", "aggregated", "commands", "are", "allowed", ")", "if", "(", "argument", "[", "0", "]", "==", "'-", "')", "{", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "{", "argument", "+", "+;", "switch", "(", "argument", "[", "0", "]", ")", "{", "/", "/", "Select", "compression", "algorithm", "only", "case", "'", "c", "'", ":", "decompressionTest", "=", "0", ";", "if", "(", "(", "argument", "[", "1", "]", ">=", "MINCOMPRESSIONCHAR", ")", "&", "&", "(", "argument", "[", "1", "]", "<=", "MAXCOMPRESSIONCHAR", ")", ")", "compressionAlgo", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ",", "argument", "+", "+;", "break", ";", "/", "/", "Select", "decompression", "algorithm", "only", "case", "'", "d", "'", ":", "compressionTest", "=", "0", ";", "if", "(", "(", "argument", "[", "1", "]", ">=", "MINDECOMPRESSIONCHAR", ")", "&", "&", "(", "argument", "[", "1", "]", "<=", "MAXDECOMPRESSIONCHAR", ")", ")", "decompressionAlgo", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ",", "argument", "+", "+;", "break", ";", "/", "/", "Display", "help", "on", "usage", "case", "'", "h", "'", ":", "case", "'", "H", "'", ":", "usage", "(", "exename", ")", ";", "usage_advanced", "(", ");", "return", "0", ";", "/", "/", "Modify", "Block", "Properties", "case", "'", "B", "'", ":", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "switch", "(", "argument", "[", "1", "]", ")", "{", "case", "'", "4", "'", ":", "case", "'", "5", "'", ":", "case", "'", "6", "'", ":", "case", "'", "7", "'", ":", "{", "int", "B", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "int", "S", "=", "1", "<", "<", "(", "8", "+", "2", "*", "B", ")", ";", "BMK_SetBlocksize", "(", "S", ")", ";", "argument", "+", "+;", "break", ";", "}", "case", "'", "D", "'", ":", "argument", "+", "+;", "break", ";", "default", ":", "goto", "_exit_blockProperties", ";", "}", "_exit_blockProperties", ":", "break", ";", "/", "/", "Modify", "Nb", "Iterations", "case", "'", "i", "'", ":", "if", "(", "(", "argument", "[", "1", "]", ">", "='", "1", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "<", "='", "9", "'", "))", "{", "int", "iters", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "BMK_SetNbIterations", "(", "iters", ")", ";", "argument", "+", "+;", "}", "break", ";", "/", "/", "Pause", "at", "the", "end", "(", "hidden", "option", ")", "case", "'", "p", "'", ":", "BMK_SetPause", "(", ");", "break", ";", "/", "/", "Unrecognised", "command", "default", ":", "badusage", "(", "exename", ")", ";", "return", "1", ";", "}", "}", "continue", ";", "}", "/", "/", "first", "provided", "filename", "is", "input", "if", "(", "!", "input_filename", ")", "{", "input_filename", "=", "argument", ";", "filenamesStart", "=", "i", ";", "continue", ";", "}", "}", "/", "/", "No", "input", "filename", "=", "=>", "Error", "if", "(", "!", "input_filename", ")", "{", "badusage", "(", "exename", ")", ";", "return", "1", ";", "}", "return", "fullSpeedBench", "(", "argv", "+", "filenamesStart", ",", "argc", "-", "filenamesStart", ")", ";", "}", "/", "*", "bench", ".", "c", "-", "Demo", "program", "to", "benchmark", "open", "-", "source", "compression", "algorithm", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2014", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "define", "_CRT_SECURE_NO_WARNINGS", "#", "define", "_CRT_SECURE_NO_DEPRECATE", "/", "/", "VS2005", "/", "/", "Unix", "Large", "Files", "support", "(", ">", "4GB", ")", "#", "if", "(", "defined", "(", "__sun__", ")", "&", "&", "(", "!", "defined", "(", "__LP64__", ")", "))", "/", "/", "Sun", "Solaris", "32", "-", "bits", "requires", "specific", "definitions", "#", "define", "_LARGEFILE_SOURCE", "#", "define", "_FILE_OFFSET_BITS", "64", "#", "elif", "!", "defined", "(", "__LP64__", ")", "/", "/", "No", "point", "defining", "Large", "file", "for", "64", "bit", "#", "define", "_LARGEFILE64_SOURCE", "#", "endif", "/", "/", "S_ISREG", "&", "gettimeofday", "(", ")", "are", "not", "supported", "by", "MSVC", "#", "if", "defined", "(", "_MSC_VER", ")", "|", "|", "defined", "(", "_WIN32", ")", "#", "define", "BMK_LEGACY_TIMER", "1", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "malloc", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fprintf", ",", "fopen", ",", "ftello64", "#", "include", "<", "sys", "/", "types", ".", "h", ">", "/", "/", "stat64", "#", "include", "<", "sys", "/", "stat", ".", "h", ">", "/", "/", "stat64", "#", "include", "<", "string", ".", "h", ">", "/", "/", "strcmp", "/", "/", "Use", "ftime", "(", ")", "if", "gettimeofday", "(", ")", "is", "not", "available", "on", "your", "target", "#", "if", "defined", "(", "BMK_LEGACY_TIMER", ")", "#", "include", "<", "sys", "/", "timeb", ".", "h", ">", "/", "/", "timeb", ",", "ftime", "#", "else", "#", "include", "<", "sys", "/", "time", ".", "h", ">", "/", "/", "gettimeofday", "#", "endif", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "define", "COMPRESSOR0", "LZ4_compress", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "define", "COMPRESSOR1", "LZ4_compressHC", "#", "define", "DEFAULTCOMPRESSOR", "COMPRESSOR0", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "S_ISREG", "&", "gettimeofday", "(", ")", "are", "not", "supported", "by", "MSVC", "#", "if", "!", "defined", "(", "S_ISREG", ")", "#", "define", "S_ISREG", "(", "x", ")", "(", "((", "x", ")", "&", "S_IFMT", ")", "=", "=", "S_IFREG", ")", "#", "endif", "/", "/", "GCC", "does", "not", "support", "_rotl", "outside", "of", "Windows", "#", "if", "!", "defined", "(", "_WIN32", ")", "#", "define", "_rotl", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "PROGRAM_DESCRIPTION", "\"", "LZ4", "speed", "analyzer", "\"", "#", "ifndef", "LZ4_VERSION", "#", "define", "LZ4_VERSION", "\"", "\"", "#", "endif", "#", "define", "AUTHOR", "\"", "Yann", "Collet", "\"", "#", "define", "WELCOME_MESSAGE", "\"", "**", "*", "%", "s", "%", "s", "%", "i", "-", "bits", ",", "by", "%", "s", "(", "%", "s", ")", "*", "**", "\\", "n", "\"", ",", "PROGRAM_DESCRIPTION", ",", "LZ4_VERSION", ",", "(", "int", ")", "(", "sizeof", "(", "void", "*", ")*", "8", ")", ",", "AUTHOR", ",", "__DATE__", "#", "define", "NBLOOPS", "6", "#", "define", "TIMELOOP", "2500", "#", "define", "KNUTH", "2654435761U", "#", "define", "MAX_MEM", "(", "1984", "<", "<", "20", ")", "#", "define", "DEFAULT_CHUNKSIZE", "(", "4", "<", "<", "20", ")", "#", "define", "ALL_COMPRESSORS", "0", "#", "define", "ALL_DECOMPRESSORS", "0", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "structures", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "struct", "chunkParameters", "{", "U32", "id", ";", "char", "*", "origBuffer", ";", "char", "*", "compressedBuffer", ";", "int", "origSize", ";", "int", "compressedSize", ";", "}", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "MACRO", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "#", "define", "PROGRESS", "(", "..", ".)", "no_prompt", "?", "0", ":", "DISPLAY", "(", "__VA_ARGS__", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Benchmark", "Parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "int", "chunkSize", "=", "DEFAULT_CHUNKSIZE", ";", "static", "int", "nbIterations", "=", "NBLOOPS", ";", "static", "int", "BMK_pause", "=", "0", ";", "static", "int", "compressionTest", "=", "1", ";", "static", "int", "decompressionTest", "=", "1", ";", "static", "int", "compressionAlgo", "=", "ALL_COMPRESSORS", ";", "static", "int", "decompressionAlgo", "=", "ALL_DECOMPRESSORS", ";", "static", "int", "no_prompt", "=", "0", ";", "void", "BMK_SetBlocksize", "(", "int", "bsize", ")", "{", "chunkSize", "=", "bsize", ";", "DISPLAY", "(", "\"-", "Using", "Block", "Size", "of", "%", "i", "KB", "-", "\\", "n", "\"", ",", "chunkSize", ">", ">", "10", ")", ";", "}", "void", "BMK_SetNbIterations", "(", "int", "nbLoops", ")", "{", "nbIterations", "=", "nbLoops", ";", "DISPLAY", "(", "\"-", "%", "i", "iterations", "-", "\\", "n", "\"", ",", "nbIterations", ")", ";", "}", "void", "BMK_SetPause", "(", ")", "{", "BMK_pause", "=", "1", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Private", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "#", "if", "defined", "(", "BMK_LEGACY_TIMER", ")", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Based", "on", "Legacy", "ftime", "(", ")", "/", "/", "Rolls", "over", "every", "~", "12", ".", "1", "days", "(", "0x100000", "/", "24", "/", "60", "/", "60", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeb", "tb", ";", "int", "nCount", ";", "ftime", "(", "&", "tb", ")", ";", "nCount", "=", "(", "int", ")", "(", "tb", ".", "millitm", "+", "(", "tb", ".", "time", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "#", "else", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Based", "on", "newer", "gettimeofday", "(", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeval", "tv", ";", "int", "nCount", ";", "gettimeofday", "(", "&", "tv", ",", "NULL", ")", ";", "nCount", "=", "(", "int", ")", "(", "tv", ".", "tv_usec", "/", "1000", "+", "(", "tv", ".", "tv_sec", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "#", "endif", "static", "int", "BMK_GetMilliSpan", "(", "int", "nTimeStart", ")", "{", "int", "nSpan", "=", "BMK_GetMilliStart", "(", ")", "-", "nTimeStart", ";", "if", "(", "nSpan", "<", "0", ")", "nSpan", "+", "=", "0x100000", "*", "1000", ";", "return", "nSpan", ";", "}", "static", "size_t", "BMK_findMaxMem", "(", "U64", "requiredMem", ")", "{", "size_t", "step", "=", "(", "64U", "<", "<", "20", ")", ";", "/", "/", "64", "MB", "BYTE", "*", "testmem", "=", "NULL", ";", "requiredMem", "=", "(", "((", "requiredMem", ">", ">", "25", ")", "+", "1", ")", "<", "<", "26", ")", ";", "if", "(", "requiredMem", ">", "MAX_MEM", ")", "requiredMem", "=", "MAX_MEM", ";", "requiredMem", "+", "=", "2", "*", "step", ";", "while", "(", "!", "testmem", ")", "{", "requiredMem", "-", "=", "step", ";", "testmem", "=", "(", "BYTE", "*", ")", "malloc", "(", "(", "size_t", ")", "requiredMem", ")", ";", "}", "free", "(", "testmem", ")", ";", "return", "(", "size_t", ")", "(", "requiredMem", "-", "step", ")", ";", "}", "static", "U64", "BMK_GetFileSize", "(", "char", "*", "infilename", ")", "{", "int", "r", ";", "#", "if", "defined", "(", "_MSC_VER", ")", "struct", "_stat64", "statbuf", ";", "r", "=", "_stat64", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "else", "struct", "stat", "statbuf", ";", "r", "=", "stat", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "endif", "if", "(", "r", "|", "|", "!", "S_ISREG", "(", "statbuf", ".", "st_mode", ")", ")", "return", "0", ";", "/", "/", "No", "good", ".", "..", "return", "(", "U64", ")", "statbuf", ".", "st_size", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Benchmark", "function", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "static", "int", "local_LZ4_compress_limitedOutput", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_limitedOutput", "(", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "void", "*", "stateLZ4", ";", "static", "int", "local_LZ4_compress_withState", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_withState", "(", "stateLZ4", ",", "in", ",", "out", ",", "inSize", ")", ";", "}", "static", "int", "local_LZ4_compress_limitedOutput_withState", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_limitedOutput_withState", "(", "stateLZ4", ",", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "void", "*", "ctx", ";", "static", "int", "local_LZ4_compress_continue", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_continue", "(", "ctx", ",", "in", ",", "out", ",", "inSize", ")", ";", "}", "static", "int", "local_LZ4_compress_limitedOutput_continue", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_limitedOutput_continue", "(", "ctx", ",", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "LZ4_stream_t", "LZ4_dict", ";", "static", "void", "*", "local_LZ4_resetDictT", "(", "const", "char", "*", "fake", ")", "{", "(", "void", ")", "fake", ";", "memset", "(", "&", "LZ4_dict", ",", "0", ",", "sizeof", "(", "LZ4_stream_t", ")", ");", "return", "NULL", ";", "}", "int", "LZ4_compress_forceExtDict", "(", "LZ4_stream_t", "*", "LZ4_dict", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ")", ";", "static", "int", "local_LZ4_compress_forceDict", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compress_forceExtDict", "(", "&", "LZ4_dict", ",", "in", ",", "out", ",", "inSize", ")", ";", "}", "static", "void", "*", "stateLZ4HC", ";", "static", "int", "local_LZ4_compressHC_withStateHC", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compressHC_withStateHC", "(", "stateLZ4HC", ",", "in", ",", "out", ",", "inSize", ")", ";", "}", "static", "int", "local_LZ4_compressHC_limitedOutput_withStateHC", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compressHC_limitedOutput_withStateHC", "(", "stateLZ4HC", ",", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "int", "local_LZ4_compressHC_limitedOutput", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compressHC_limitedOutput", "(", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "int", "local_LZ4_compressHC_continue", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compressHC_continue", "(", "ctx", ",", "in", ",", "out", ",", "inSize", ")", ";", "}", "static", "int", "local_LZ4_compressHC_limitedOutput_continue", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ")", "{", "return", "LZ4_compressHC_limitedOutput_continue", "(", "ctx", ",", "in", ",", "out", ",", "inSize", ",", "LZ4_compressBound", "(", "inSize", ")", ");", "}", "static", "int", "local_LZ4_decompress_fast", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ",", "int", "outSize", ")", "{", "(", "void", ")", "inSize", ";", "LZ4_decompress_fast", "(", "in", ",", "out", ",", "outSize", ")", ";", "return", "outSize", ";", "}", "static", "int", "local_LZ4_decompress_fast_withPrefix64k", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ",", "int", "outSize", ")", "{", "(", "void", ")", "inSize", ";", "LZ4_decompress_fast_withPrefix64k", "(", "in", ",", "out", ",", "outSize", ")", ";", "return", "outSize", ";", "}", "static", "int", "local_LZ4_decompress_fast_usingDict", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ",", "int", "outSize", ")", "{", "(", "void", ")", "inSize", ";", "LZ4_decompress_fast_usingDict", "(", "in", ",", "out", ",", "outSize", ",", "in", "-", "65536", ",", "65536", ")", ";", "return", "outSize", ";", "}", "static", "int", "local_LZ4_decompress_safe_usingDict", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ",", "int", "outSize", ")", "{", "(", "void", ")", "inSize", ";", "LZ4_decompress_safe_usingDict", "(", "in", ",", "out", ",", "inSize", ",", "outSize", ",", "in", "-", "65536", ",", "65536", ")", ";", "return", "outSize", ";", "}", "static", "int", "local_LZ4_decompress_safe_partial", "(", "const", "char", "*", "in", ",", "char", "*", "out", ",", "int", "inSize", ",", "int", "outSize", ")", "{", "return", "LZ4_decompress_safe_partial", "(", "in", ",", "out", ",", "inSize", ",", "outSize", "-", "5", ",", "outSize", ")", ";", "}", "int", "fullSpeedBench", "(", "char", "*", "*", "fileNamesTable", ",", "int", "nbFiles", ")", "{", "int", "fileIdx", "=", "0", ";", "char", "*", "orig_buff", ";", "#", "define", "NB_COMPRESSION_ALGORITHMS", "13", "#", "define", "MINCOMPRESSIONCHAR", "'", "0", "'", "double", "totalCTime", "[", "NB_COMPRESSION_ALGORITHMS", "+", "1", "]", "=", "{", "0", "}", ";", "double", "totalCSize", "[", "NB_COMPRESSION_ALGORITHMS", "+", "1", "]", "=", "{", "0", "}", ";", "#", "define", "NB_DECOMPRESSION_ALGORITHMS", "7", "#", "define", "MINDECOMPRESSIONCHAR", "'", "0", "'", "#", "define", "MAXDECOMPRESSIONCHAR", "(", "MINDECOMPRESSIONCHAR", "+", "NB_DECOMPRESSION_ALGORITHMS", ")", "static", "char", "*", "decompressionNames", "[", "]", "=", "{", "\"", "LZ4_decompress_fast", "\"", ",", "\"", "LZ4_decompress_fast_withPrefix64k", "\"", ",", "\"", "LZ4_decompress_fast_usingDict", "\"", ",", "\"", "LZ4_decompress_safe", "\"", ",", "\"", "LZ4_decompress_safe_withPrefix64k", "\"", ",", "\"", "LZ4_decompress_safe_usingDict", "\"", ",", "\"", "LZ4_decompress_safe_partial", "\"", "}", ";", "double", "totalDTime", "[", "NB_DECOMPRESSION_ALGORITHMS", "+", "1", "]", "=", "{", "0", "}", ";", "/", "/", "Loop", "for", "each", "file", "while", "(", "fileIdx", "<", "nbFiles", ")", "{", "FILE", "*", "inFile", ";", "char", "*", "inFileName", ";", "U64", "inFileSize", ";", "size_t", "benchedSize", ";", "int", "nbChunks", ";", "int", "maxCompressedChunkSize", ";", "struct", "chunkParameters", "*", "chunkP", ";", "size_t", "readSize", ";", "char", "*", "compressed_buff", ";", "int", "compressedBuffSize", ";", "U32", "crcOriginal", ";", "/", "/", "Init", "stateLZ4", "=", "malloc", "(", "LZ4_sizeofState", "(", "))", ";", "stateLZ4HC", "=", "malloc", "(", "LZ4_sizeofStateHC", "(", "))", ";", "/", "/", "Check", "file", "existence", "inFileName", "=", "fileNamesTable", "[", "fileIdx", "+", "+]", ";", "inFile", "=", "fopen", "(", "inFileName", ",", "\"", "rb", "\"", ")", ";", "if", "(", "inFile", "=", "=", "NULL", ")", "{", "DISPLAY", "(", "\"", "Pb", "opening", "%", "s", "\\", "n", "\"", ",", "inFileName", ")", ";", "return", "11", ";", "}", "/", "/", "Memory", "allocation", "&", "restrictions", "inFileSize", "=", "BMK_GetFileSize", "(", "inFileName", ")", ";", "benchedSize", "=", "(", "size_t", ")", "BMK_findMaxMem", "(", "inFileSize", ")", "/", "2", ";", "if", "(", "(", "U64", ")", "benchedSize", ">", "inFileSize", ")", "benchedSize", "=", "(", "size_t", ")", "inFileSize", ";", "if", "(", "benchedSize", "<", "inFileSize", ")", "{", "DISPLAY", "(", "\"", "Not", "enough", "memory", "for", "'", "%", "s", "'", "full", "size", ";", "testing", "%", "i", "MB", "only", ".", "..", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "(", "benchedSize", ">", ">", "20", ")", ");", "}", "/", "/", "Alloc", "chunkP", "=", "(", "struct", "chunkParameters", "*", ")", "malloc", "(", "((", "benchedSize", "/", "(", "size_t", ")", "chunkSize", ")", "+", "1", ")", "*", "sizeof", "(", "struct", "chunkParameters", ")", ");", "orig_buff", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "benchedSize", ")", ";", "nbChunks", "=", "(", "int", ")", "(", "(", "int", ")", "benchedSize", "/", "chunkSize", ")", "+", "1", ";", "maxCompressedChunkSize", "=", "LZ4_compressBound", "(", "chunkSize", ")", ";", "compressedBuffSize", "=", "nbChunks", "*", "maxCompressedChunkSize", ";", "compressed_buff", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "compressedBuffSize", ")", ";", "if", "(", "!", "orig_buff", "|", "|", "!", "compressed_buff", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "not", "enough", "memory", "!", "\\", "n", "\"", ");", "free", "(", "orig_buff", ")", ";", "free", "(", "compressed_buff", ")", ";", "free", "(", "chunkP", ")", ";", "fclose", "(", "inFile", ")", ";", "return", "12", ";", "}", "/", "/", "Init", "chunks", "data", "{", "int", "i", ";", "size_t", "remaining", "=", "benchedSize", ";", "char", "*", "in", "=", "orig_buff", ";", "char", "*", "out", "=", "compressed_buff", ";", "for", "(", "i", "=", "0", ";", "i", "<", "nbChunks", ";", "i", "+", "+)", "{", "chunkP", "[", "i", "]", ".", "id", "=", "i", ";", "chunkP", "[", "i", "]", ".", "origBuffer", "=", "in", ";", "in", "+", "=", "chunkSize", ";", "if", "(", "(", "int", ")", "remaining", ">", "chunkSize", ")", "{", "chunkP", "[", "i", "]", ".", "origSize", "=", "chunkSize", ";", "remaining", "-", "=", "chunkSize", ";", "}", "else", "{", "chunkP", "[", "i", "]", ".", "origSize", "=", "(", "int", ")", "remaining", ";", "remaining", "=", "0", ";", "}", "chunkP", "[", "i", "]", ".", "compressedBuffer", "=", "out", ";", "out", "+", "=", "maxCompressedChunkSize", ";", "chunkP", "[", "i", "]", ".", "compressedSize", "=", "0", ";", "}", "}", "/", "/", "Fill", "input", "buffer", "DISPLAY", "(", "\"", "Loading", "%", "s", ".", "..", "\\", "r", "\"", ",", "inFileName", ")", ";", "readSize", "=", "fread", "(", "orig_buff", ",", "1", ",", "benchedSize", ",", "inFile", ")", ";", "fclose", "(", "inFile", ")", ";", "if", "(", "readSize", "!", "=", "benchedSize", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "problem", "reading", "file", "'", "%", "s", "'", "!", "!", "\\", "n", "\"", ",", "inFileName", ")", ";", "free", "(", "orig_buff", ")", ";", "free", "(", "compressed_buff", ")", ";", "free", "(", "chunkP", ")", ";", "return", "13", ";", "}", "/", "/", "Calculating", "input", "Checksum", "crcOriginal", "=", "XXH32", "(", "orig_buff", ",", "(", "unsigned", "int", ")", "benchedSize", ",", "0", ")", ";", "/", "/", "Bench", "{", "int", "loopNb", ",", "nb_loops", ",", "chunkNb", ",", "cAlgNb", ",", "dAlgNb", ";", "size_t", "cSize", "=", "0", ";", "double", "ratio", "=", "0", ".", ";", "DISPLAY", "(", "\"\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "DISPLAY", "(", "\"", "%", "s", ":", "\\", "n", "\"", ",", "inFileName", ")", ";", "/", "/", "Compression", "Algorithms", "for", "(", "cAlgNb", "=", "1", ";", "(", "cAlgNb", "<", "=", "NB_COMPRESSION_ALGORITHMS", ")", "&", "&", "(", "compressionTest", ")", ";", "cAlgNb", "+", "+)", "{", "char", "*", "compressorName", ";", "int", "(", "*", "compressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ")", ";", "void", "*", "(", "*", "initFunction", ")", "(", "const", "char", "*", ")", "=", "NULL", ";", "double", "bestTime", "=", "100000000", ".", ";", "if", "(", "(", "compressionAlgo", "!", "=", "ALL_COMPRESSORS", ")", "&", "&", "(", "compressionAlgo", "!", "=", "cAlgNb", ")", ")", "continue", ";", "switch", "(", "cAlgNb", ")", "{", "case", "1", ":", "compressionFunction", "=", "LZ4_compress", ";", "compressorName", "=", "\"", "LZ4_compress", "\"", ";", "break", ";", "case", "2", ":", "compressionFunction", "=", "local_LZ4_compress_limitedOutput", ";", "compressorName", "=", "\"", "LZ4_compress_limitedOutput", "\"", ";", "break", ";", "case", "3", ":", "compressionFunction", "=", "local_LZ4_compress_withState", ";", "compressorName", "=", "\"", "LZ4_compress_withState", "\"", ";", "break", ";", "case", "4", ":", "compressionFunction", "=", "local_LZ4_compress_limitedOutput_withState", ";", "compressorName", "=", "\"", "LZ4_compress_limitedOutput_withState", "\"", ";", "break", ";", "case", "5", ":", "compressionFunction", "=", "local_LZ4_compress_continue", ";", "initFunction", "=", "LZ4_create", ";", "compressorName", "=", "\"", "LZ4_compress_continue", "\"", ";", "break", ";", "case", "6", ":", "compressionFunction", "=", "local_LZ4_compress_limitedOutput_continue", ";", "initFunction", "=", "LZ4_create", ";", "compressorName", "=", "\"", "LZ4_compress_limitedOutput_continue", "\"", ";", "break", ";", "case", "7", ":", "compressionFunction", "=", "LZ4_compressHC", ";", "compressorName", "=", "\"", "LZ4_compressHC", "\"", ";", "break", ";", "case", "8", ":", "compressionFunction", "=", "local_LZ4_compressHC_limitedOutput", ";", "compressorName", "=", "\"", "LZ4_compressHC_limitedOutput", "\"", ";", "break", ";", "case", "9", ":", "compressionFunction", "=", "local_LZ4_compressHC_withStateHC", ";", "compressorName", "=", "\"", "LZ4_compressHC_withStateHC", "\"", ";", "break", ";", "case", "10", ":", "compressionFunction", "=", "local_LZ4_compressHC_limitedOutput_withStateHC", ";", "compressorName", "=", "\"", "LZ4_compressHC_limitedOutput_withStateHC", "\"", ";", "break", ";", "case", "11", ":", "compressionFunction", "=", "local_LZ4_compressHC_continue", ";", "initFunction", "=", "LZ4_createHC", ";", "compressorName", "=", "\"", "LZ4_compressHC_continue", "\"", ";", "break", ";", "case", "12", ":", "compressionFunction", "=", "local_LZ4_compressHC_limitedOutput_continue", ";", "initFunction", "=", "LZ4_createHC", ";", "compressorName", "=", "\"", "LZ4_compressHC_limitedOutput_continue", "\"", ";", "break", ";", "case", "13", ":", "compressionFunction", "=", "local_LZ4_compress_forceDict", ";", "initFunction", "=", "local_LZ4_resetDictT", ";", "compressorName", "=", "\"", "LZ4_compress_forceDict", "\"", ";", "break", ";", "default", ":", "DISPLAY", "(", "\"", "ERROR", "!", "Bad", "algorithm", "Id", "!", "!", "\\", "n", "\"", ");", "free", "(", "chunkP", ")", ";", "return", "1", ";", "}", "for", "(", "loopNb", "=", "1", ";", "loopNb", "<", "=", "nbIterations", ";", "loopNb", "+", "+)", "{", "double", "averageTime", ";", "int", "milliTime", ";", "PROGRESS", "(", "\"%", "1i", "-", "%-", "26", ".", "26s", ":", "%", "9i", "-", ">\\", "r", "\"", ",", "loopNb", ",", "compressorName", ",", "(", "int", ")", "benchedSize", ")", ";", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "benchedSize", ";", "i", "+", "+)", "compressed_buff", "[", "i", "]", "=(", "char", ")", "i", ";", "}", "/", "/", "warmimg", "up", "memory", "nb_loops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "if", "(", "initFunction", "!", "=", "NULL", ")", "ctx", "=", "initFunction", "(", "chunkP", "[", "0", "]", ".", "origBuffer", ")", ";", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "{", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "compressionFunction", "(", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "if", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "=", "0", ")", "DISPLAY", "(", "\"", "ERROR", "!", "%", "s", "(", ")", "=", "0", "!", "!", "\\", "n", "\"", ",", "compressorName", ")", ",", "exit", "(", "1", ")", ";", "}", "if", "(", "initFunction", "!", "=", "NULL", ")", "free", "(", "ctx", ")", ";", "nb_loops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "averageTime", "=", "(", "double", ")", "milliTime", "/", "nb_loops", ";", "if", "(", "averageTime", "<", "bestTime", ")", "bestTime", "=", "averageTime", ";", "cSize", "=", "0", ";", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "cSize", "+", "=", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ";", "ratio", "=", "(", "double", ")", "cSize", "/", "(", "double", ")", "benchedSize", "*", "100", ".", ";", "PROGRESS", "(", "\"%", "1i", "-", "%-", "26", ".", "26s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "compressorName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "}", "if", "(", "ratio", "<", "100", ".", ")", "DISPLAY", "(", "\"%", "-", "28", ".", "28s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "2f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "compressorName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "else", "DISPLAY", "(", "\"%", "-", "28", ".", "28s", ":", "%", "9i", "-", ">", "%", "9i", "(", "%", "5", ".", "1f", "%", "%)", ",%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "compressorName", ",", "(", "int", ")", "benchedSize", ",", "(", "int", ")", "cSize", ",", "ratio", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "totalCTime", "[", "cAlgNb", "]", "+", "=", "bestTime", ";", "totalCSize", "[", "cAlgNb", "]", "+", "=", "cSize", ";", "}", "/", "/", "Prepare", "layout", "for", "decompression", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "{", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "LZ4_compress", "(", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "if", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", "=", "=", "0", ")", "DISPLAY", "(", "\"", "ERROR", "!", "%", "s", "(", ")", "=", "0", "!", "!", "\\", "n", "\"", ",", "\"", "LZ4_compress", "\"", "),", "exit", "(", "1", ")", ";", "}", "{", "size_t", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "benchedSize", ";", "i", "+", "+)", "orig_buff", "[", "i", "]", "=", "0", ";", "}", "/", "/", "zeroing", "source", "area", ",", "for", "CRC", "checking", "/", "/", "Decompression", "Algorithms", "for", "(", "dAlgNb", "=", "0", ";", "(", "dAlgNb", "<", "NB_DECOMPRESSION_ALGORITHMS", ")", "&", "&", "(", "decompressionTest", ")", ";", "dAlgNb", "+", "+)", "{", "char", "*", "dName", "=", "decompressionNames", "[", "dAlgNb", "]", ";", "int", "(", "*", "decompressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ",", "int", ")", ";", "double", "bestTime", "=", "100000000", ".", ";", "if", "(", "(", "decompressionAlgo", "!", "=", "ALL_DECOMPRESSORS", ")", "&", "&", "(", "decompressionAlgo", "!", "=", "dAlgNb", "+", "1", ")", ")", "continue", ";", "switch", "(", "dAlgNb", ")", "{", "case", "0", ":", "decompressionFunction", "=", "local_LZ4_decompress_fast", ";", "break", ";", "case", "1", ":", "decompressionFunction", "=", "local_LZ4_decompress_fast_withPrefix64k", ";", "break", ";", "case", "2", ":", "decompressionFunction", "=", "local_LZ4_decompress_fast_usingDict", ";", "break", ";", "case", "3", ":", "decompressionFunction", "=", "LZ4_decompress_safe", ";", "break", ";", "case", "4", ":", "decompressionFunction", "=", "LZ4_decompress_safe_withPrefix64k", ";", "break", ";", "case", "5", ":", "decompressionFunction", "=", "local_LZ4_decompress_safe_usingDict", ";", "break", ";", "case", "6", ":", "decompressionFunction", "=", "local_LZ4_decompress_safe_partial", ";", "break", ";", "default", ":", "DISPLAY", "(", "\"", "ERROR", "!", "Bad", "decompression", "algorithm", "Id", "!", "!", "\\", "n", "\"", ");", "free", "(", "chunkP", ")", ";", "return", "1", ";", "}", "for", "(", "loopNb", "=", "1", ";", "loopNb", "<", "=", "nbIterations", ";", "loopNb", "+", "+)", "{", "double", "averageTime", ";", "int", "milliTime", ";", "U32", "crcDecoded", ";", "PROGRESS", "(", "\"%", "1i", "-", "%-", "29", ".", "29s", ":", "%", "10i", "-", ">\\", "r", "\"", ",", "loopNb", ",", "dName", ",", "(", "int", ")", "benchedSize", ")", ";", "nb_loops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "for", "(", "chunkNb", "=", "0", ";", "chunkNb", "<", "nbChunks", ";", "chunkNb", "+", "+)", "{", "int", "decodedSize", "=", "decompressionFunction", "(", "chunkP", "[", "chunkNb", "]", ".", "compressedBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "origBuffer", ",", "chunkP", "[", "chunkNb", "]", ".", "compressedSize", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ";", "if", "(", "chunkP", "[", "chunkNb", "]", ".", "origSize", "!", "=", "decodedSize", ")", "DISPLAY", "(", "\"", "ERROR", "!", "%", "s", "(", ")", "=", "=", "%", "i", "!", "=", "%", "i", "!", "!", "\\", "n", "\"", ",", "dName", ",", "decodedSize", ",", "chunkP", "[", "chunkNb", "]", ".", "origSize", ")", ",", "exit", "(", "1", ")", ";", "}", "nb_loops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "averageTime", "=", "(", "double", ")", "milliTime", "/", "nb_loops", ";", "if", "(", "averageTime", "<", "bestTime", ")", "bestTime", "=", "averageTime", ";", "PROGRESS", "(", "\"%", "1i", "-", "%-", "29", ".", "29s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "dName", ",", "(", "int", ")", "benchedSize", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "/", "/", "CRC", "Checking", "crcDecoded", "=", "XXH32", "(", "orig_buff", ",", "(", "int", ")", "benchedSize", ",", "0", ")", ";", "if", "(", "crcOriginal", "!", "=", "crcDecoded", ")", "{", "DISPLAY", "(", "\"\\", "n", "!", "!!", "WARNING", "!", "!!", "%", "14s", ":", "Invalid", "Checksum", ":", "%", "x", "!", "=", "%", "x", "\\", "n", "\"", ",", "inFileName", ",", "(", "unsigned", ")", "crcOriginal", ",", "(", "unsigned", ")", "crcDecoded", ")", ";", "exit", "(", "1", ")", ";", "}", "}", "DISPLAY", "(", "\"%", "-", "31", ".", "31s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "dName", ",", "(", "int", ")", "benchedSize", ",", "(", "double", ")", "benchedSize", "/", "bestTime", "/", "1000", ".", ");", "totalDTime", "[", "dAlgNb", "]", "+", "=", "bestTime", ";", "}", "}", "free", "(", "orig_buff", ")", ";", "free", "(", "compressed_buff", ")", ";", "free", "(", "chunkP", ")", ";", "}", "if", "(", "BMK_pause", ")", "{", "printf", "(", "\"", "press", "enter", ".", "..", "\\", "n", "\"", ");", "getchar", "(", ");", "}", "return", "0", ";", "}", "int", "usage", "(", "char", "*", "exename", ")", "{", "DISPLAY", "(", "\"", "Usage", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "[", "arg", "]", "file1", "file2", ".", "..", "fileX", "\\", "n", "\"", ",", "exename", ")", ";", "DISPLAY", "(", "\"", "Arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c", ":", "compression", "tests", "only", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "d", ":", "decompression", "tests", "only", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "H", "/", "-", "h", ":", "Help", "(", "this", "text", "+", "advanced", "options", ")", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "usage_advanced", "(", ")", "{", "DISPLAY", "(", "\"", "\\", "nAdvanced", "options", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c", "#", ":", "test", "only", "compression", "function", "#", "[", "1", "-", "%", "i", "]", "\\", "n", "\"", ",", "NB_COMPRESSION_ALGORITHMS", ")", ";", "DISPLAY", "(", "\"", "-", "d", "#", ":", "test", "only", "decompression", "function", "#", "[", "1", "-", "%", "i", "]", "\\", "n", "\"", ",", "NB_DECOMPRESSION_ALGORITHMS", ")", ";", "DISPLAY", "(", "\"", "-", "i", "#", ":", "iteration", "loops", "[", "1", "-", "9", "]", "(", "default", ":", "%", "i", ")", "\\", "n", "\"", ",", "NBLOOPS", ")", ";", "DISPLAY", "(", "\"", "-", "B", "#", ":", "Block", "size", "[", "4", "-", "7", "]", "(", "default", ":", "7", ")", "\\", "n", "\"", ");", "/", "/", "DISPLAY", "(", "\"", "-", "BD", ":", "Block", "dependency", "(", "improve", "compression", "ratio", ")", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "badusage", "(", "char", "*", "exename", ")", "{", "DISPLAY", "(", "\"", "Wrong", "parameters", "\\", "n", "\"", ");", "usage", "(", "exename", ")", ";", "return", "0", ";", "}", "int", "main", "(", "int", "argc", ",", "char", "*", "*", "argv", ")", "{", "int", "i", ",", "filenamesStart", "=", "2", ";", "char", "*", "exename", "=", "argv", "[", "0", "]", ";", "char", "*", "input_filename", "=", "0", ";", "/", "/", "Welcome", "message", "DISPLAY", "(", "WELCOME_MESSAGE", ")", ";", "if", "(", "argc", "<", "2", ")", "{", "badusage", "(", "exename", ")", ";", "return", "1", ";", "}", "for", "(", "i", "=", "1", ";", "i", "<", "argc", ";", "i", "+", "+)", "{", "char", "*", "argument", "=", "argv", "[", "i", "]", ";", "if", "(", "!", "argument", ")", "continue", ";", "/", "/", "Protection", "if", "argument", "empty", "if", "(", "!", "strcmp", "(", "argument", ",", "\"", "--", "no", "-", "prompt", "\"", "))", "{", "no_prompt", "=", "1", ";", "continue", ";", "}", "/", "/", "Decode", "command", "(", "note", ":", "aggregated", "commands", "are", "allowed", ")", "if", "(", "argument", "[", "0", "]", "==", "'-", "')", "{", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "{", "argument", "+", "+;", "switch", "(", "argument", "[", "0", "]", ")", "{", "/", "/", "Select", "compression", "algorithm", "only", "case", "'", "c", "'", ":", "decompressionTest", "=", "0", ";", "while", "(", "(", "argument", "[", "1", "]", ">=", "'", "0", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "<=", "'", "9", "'", "))", "{", "compressionAlgo", "*", "=", "10", ";", "compressionAlgo", "+", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "break", ";", "/", "/", "Select", "decompression", "algorithm", "only", "case", "'", "d", "'", ":", "compressionTest", "=", "0", ";", "while", "(", "(", "argument", "[", "1", "]", ">=", "'", "0", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "<=", "'", "9", "'", "))", "{", "decompressionAlgo", "*", "=", "10", ";", "decompressionAlgo", "+", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "break", ";", "/", "/", "Display", "help", "on", "usage", "case", "'", "h", "'", ":", "case", "'", "H", "'", ":", "usage", "(", "exename", ")", ";", "usage_advanced", "(", ");", "return", "0", ";", "/", "/", "Modify", "Block", "Properties", "case", "'", "B", "'", ":", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "switch", "(", "argument", "[", "1", "]", ")", "{", "case", "'", "4", "'", ":", "case", "'", "5", "'", ":", "case", "'", "6", "'", ":", "case", "'", "7", "'", ":", "{", "int", "B", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "int", "S", "=", "1", "<", "<", "(", "8", "+", "2", "*", "B", ")", ";", "BMK_SetBlocksize", "(", "S", ")", ";", "argument", "+", "+;", "break", ";", "}", "case", "'", "D", "'", ":", "argument", "+", "+;", "break", ";", "default", ":", "goto", "_exit_blockProperties", ";", "}", "_exit_blockProperties", ":", "break", ";", "/", "/", "Modify", "Nb", "Iterations", "case", "'", "i", "'", ":", "if", "(", "(", "argument", "[", "1", "]", ">", "='", "1", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "<", "='", "9", "'", "))", "{", "int", "iters", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "BMK_SetNbIterations", "(", "iters", ")", ";", "argument", "+", "+;", "}", "break", ";", "/", "/", "Pause", "at", "the", "end", "(", "hidden", "option", ")", "case", "'", "p", "'", ":", "BMK_SetPause", "(", ");", "break", ";", "/", "/", "Unrecognised", "command", "default", ":", "badusage", "(", "exename", ")", ";", "return", "1", ";", "}", "}", "continue", ";", "}", "/", "/", "first", "provided", "filename", "is", "input", "if", "(", "!", "input_filename", ")", "{", "input_filename", "=", "argument", ";", "filenamesStart", "=", "i", ";", "continue", ";", "}", "}", "/", "/", "No", "input", "filename", "=", "=>", "Error", "if", "(", "!", "input_filename", ")", "{", "badusage", "(", "exename", ")", ";", "return", "1", ";", "}", "return", "fullSpeedBench", "(", "argv", "+", "filenamesStart", ",", "argc", "-", "filenamesStart", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "766", "@", "@", "/", "*", "fuzzer", ".", "c", "-", "Fuzzer", "test", "tool", "for", "LZ4", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2014", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Remove", "Visual", "warning", "messages", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "define", "_CRT_SECURE_NO_WARNINGS", "/", "/", "fgets", "#", "ifdef", "_MSC_VER", "/", "*", "Visual", "Studio", "*", "/", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "*", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "*", "/", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Includes", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "include", "<", "stdlib", ".", "h", ">", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fgets", ",", "sscanf", "#", "include", "<", "sys", "/", "timeb", ".", "h", ">", "/", "/", "timeb", "#", "include", "<", "string", ".", "h", ">", "/", "/", "strcmp", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Basic", "Types", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "(", "__STDC_VERSION__", ">", "=", "199901L", ")", "/", "*", "C99", "*", "/", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "Constants", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "ifndef", "LZ4_VERSION", "#", "define", "LZ4_VERSION", "\"", "rc118", "\"", "#", "endif", "#", "define", "NB_ATTEMPTS", "(", "1", "<", "<", "16", ")", "#", "define", "COMPRESSIBLE_NOISE_LENGTH", "(", "1", "<", "<", "21", ")", "#", "define", "FUZ_MAX_BLOCK_SIZE", "(", "1", "<", "<", "17", ")", "#", "define", "FUZ_MAX_DICT_SIZE", "(", "1", "<", "<", "15", ")", "#", "define", "FUZ_COMPRESSIBILITY_DEFAULT", "50", "#", "define", "PRIME1", "2654435761U", "#", "define", "PRIME2", "2246822519U", "#", "define", "PRIME3", "3266489917U", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "#", "define", "DISPLAYLEVEL", "(", "l", ",", ".", "..", ")", "if", "(", "displayLevel", ">", "=", "l", ")", "{", "DISPLAY", "(", "__VA_ARGS__", ")", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Local", "Parameters", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "static", "int", "no_prompt", "=", "0", ";", "static", "char", "*", "programName", ";", "static", "int", "displayLevel", "=", "2", ";", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Fuzzer", "functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "static", "int", "FUZ_GetMilliStart", "(", ")", "{", "struct", "timeb", "tb", ";", "int", "nCount", ";", "ftime", "(", "&", "tb", ")", ";", "nCount", "=", "(", "int", ")", "(", "tb", ".", "millitm", "+", "(", "tb", ".", "time", "&", "0xfffff", ")", "*", "1000", ")", ";", "return", "nCount", ";", "}", "static", "int", "FUZ_GetMilliSpan", "(", "int", "nTimeStart", ")", "{", "int", "nSpan", "=", "FUZ_GetMilliStart", "(", ")", "-", "nTimeStart", ";", "if", "(", "nSpan", "<", "0", ")", "nSpan", "+", "=", "0x100000", "*", "1000", ";", "return", "nSpan", ";", "}", "#", "define", "FUZ_rotl32", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "unsigned", "int", "FUZ_rand", "(", "unsigned", "int", "*", "src", ")", "{", "U32", "rand32", "=", "*", "src", ";", "rand32", "*", "=", "PRIME1", ";", "rand32", "+", "=", "PRIME2", ";", "rand32", "=", "FUZ_rotl32", "(", "rand32", ",", "13", ")", ";", "*", "src", "=", "rand32", ";", "return", "rand32", ">", ">", "3", ";", "}", "#", "define", "FUZ_RAND15BITS", "(", "(", "FUZ_rand", "(", "seed", ")", ">", ">", "3", ")", "&", "32767", ")", "#", "define", "FUZ_RANDLENGTH", "(", "(", "(", "FUZ_rand", "(", "seed", ")", ">", ">", "7", ")", "&", "3", ")", "?", "(", "FUZ_rand", "(", "seed", ")", "%", "14", ")", ":", "(", "FUZ_rand", "(", "seed", ")", "&", "511", ")", "+", "15", ")", "void", "FUZ_fillCompressibleNoiseBuffer", "(", "void", "*", "buffer", ",", "int", "bufferSize", ",", "double", "proba", ",", "U32", "*", "seed", ")", "{", "BYTE", "*", "BBuffer", "=", "(", "BYTE", "*", ")", "buffer", ";", "int", "pos", "=", "0", ";", "U32", "P32", "=", "(", "U32", ")", "(", "32768", "*", "proba", ")", ";", "/", "/", "First", "Byte", "BBuffer", "[", "pos", "+", "+]", "=", "(", "BYTE", ")", "(", "FUZ_rand", "(", "seed", ")", ");", "while", "(", "pos", "<", "bufferSize", ")", "{", "/", "/", "Select", ":", "Literal", "(", "noise", ")", "or", "copy", "(", "within", "64K", ")", "if", "(", "FUZ_RAND15BITS", "<", "P32", ")", "{", "/", "/", "Copy", "(", "within", "64K", ")", "int", "ref", ",", "d", ";", "int", "length", "=", "FUZ_RANDLENGTH", "+", "4", ";", "int", "offset", "=", "FUZ_RAND15BITS", "+", "1", ";", "if", "(", "offset", ">", "pos", ")", "offset", "=", "pos", ";", "if", "(", "pos", "+", "length", ">", "bufferSize", ")", "length", "=", "bufferSize", "-", "pos", ";", "ref", "=", "pos", "-", "offset", ";", "d", "=", "pos", "+", "length", ";", "while", "(", "pos", "<", "d", ")", "BBuffer", "[", "pos", "+", "+]", "=", "BBuffer", "[", "ref", "+", "+]", ";", "}", "else", "{", "/", "/", "Literal", "(", "noise", ")", "int", "d", ";", "int", "length", "=", "FUZ_RANDLENGTH", ";", "if", "(", "pos", "+", "length", ">", "bufferSize", ")", "length", "=", "bufferSize", "-", "pos", ";", "d", "=", "pos", "+", "length", ";", "while", "(", "pos", "<", "d", ")", "BBuffer", "[", "pos", "+", "+]", "=", "(", "BYTE", ")", "(", "FUZ_rand", "(", "seed", ")", ">", ">", "5", ")", ";", "}", "}", "}", "int", "FUZ_Issue52", "(", ")", "{", "char", "*", "output", ";", "char", "*", "input", ";", "int", "i", ",", "r", ";", "/", "/", "Overflow", "test", ",", "by", "Ludwig", "Strigeus", "printf", "(", "\"", "Overflow", "test", "(", "issue", "52", ")", "..", ".\"", ");", "input", "=", "(", "char", "*", ")", "malloc", "(", "20", "<", "<", "20", ")", ";", "output", "=", "(", "char", "*", ")", "malloc", "(", "20", "<", "<", "20", ")", ";", "input", "[", "0", "]", "=", "0x0F", ";", "input", "[", "1", "]", "=", "0x00", ";", "input", "[", "2", "]", "=", "0x00", ";", "for", "(", "i", "=", "3", ";", "i", "<", "16840000", ";", "i", "+", "+)", "input", "[", "i", "]", "=", "0xff", ";", "r", "=", "LZ4_decompress_safe", "(", "input", ",", "output", ",", "20", "<", "<", "20", ",", "20", "<", "<", "20", ")", ";", "free", "(", "input", ")", ";", "free", "(", "output", ")", ";", "printf", "(", "\"", "Passed", "(", "return", "=", "%", "i", "<", "0", ")", "\\", "n", "\"", ",", "r", ")", ";", "return", "0", ";", "}", "#", "define", "MAX_NB_BUFF_I134", "150", "#", "define", "BLOCKSIZE_I134", "64", "MB", "int", "FUZ_Issue134", "(", ")", "{", "char", "*", "buffers", "[", "MAX_NB_BUFF_I134", "+", "1", "]", "=", "{", "0", "}", ";", "int", "i", ",", "nbBuff", ";", "printf", "(", "\"", "Overflow", "test", "issue", "134", ":", "\"", ");", "/", "/", "Only", "possible", "in", "32", "-", "bits", "if", "(", "sizeof", "(", "void", "*", ")=", "=", "8", ")", "{", "printf", "(", "\"", "64", "bits", "mode", ":", "not", "applicable", "\\", "n", "\"", ");", "return", "0", ";", "}", "printf", "(", "\"", "\"", ");", "for", "(", "nbBuff", "=", "0", ";", "nbBuff", "<", "MAX_NB_BUFF_I134", ";", "nbBuff", "+", "+)", "{", "printf", "(", "\"\\", "b", "\\", "b", "\\", "b", "\\", "b", "%", "3i", "\"", ",", "nbBuff", ")", ";", "buffers", "[", "nbBuff", "]", "=", "(", "char", "*", ")", "malloc", "(", "BLOCKSIZE_I134", ")", ";", "if", "(", "buffers", "[", "nbBuff", "]", "==", "NULL", ")", "{", "printf", "(", "\"", ":", "unable", "to", "allocate", "more", "memory", "\\", "n", "\"", ");", "for", "(", "i", "=", "0", ";", "i", "<", "nbBuff", ";", "i", "+", "+)", "free", "(", "buffers", "[", "i", "]", ");", "return", "0", ";", "}", "if", "(", "(", "size_t", ")", "buffers", "[", "nbBuff", "]", ">", "0", ")", "/", "/", "(", "size_t", ")", "0x80000000", ")", "{", "printf", "(", "\"", "Testing", "memory", "buffer", "address", "%", "X", ",", "\"", ",", "(", "U32", ")", "(", "size_t", ")", "(", "buffers", "[", "nbBuff", "]", "))", ";", "printf", "(", "\"", "Creating", "a", "payload", "designed", "to", "fail", "\\", "n", "\"", ");", "buffers", "[", "++", "nbBuff", "]", "=", "(", "char", "*", ")", "malloc", "(", "BLOCKSIZE_I134", ")", ";", "if", "(", "buffers", "[", "nbBuff", "]", "==", "NULL", ")", "{", "printf", "(", "\"", "failed", "to", "test", "(", "no", "more", "memory", ")", "\\", "n", "\"", ");", "for", "(", "i", "=", "0", ";", "i", "<", "nbBuff", ";", "i", "+", "+)", "free", "(", "buffers", "[", "i", "]", ");", "return", "0", ";", "}", "{", "size_t", "sizeToGenerateOverflow", "=", "(", "size_t", ")", "(-", "(", "(", "size_t", ")", "buffers", "[", "nbBuff", "-", "1", "]", ")", "+", "512", ")", ";", "size_t", "nbOf255", "=", "(", "sizeToGenerateOverflow", "/", "255", ")", "+", "1", ";", "char", "*", "input", "=", "buffers", "[", "nbBuff", "-", "1", "]", ";", "char", "*", "output", "=", "buffers", "[", "nbBuff", "]", ";", "int", "r", ";", "input", "[", "0", "]", "=", "0xF0", ";", "/", "/", "Literal", "length", "overflow", "input", "[", "1", "]", "=", "0xFF", ";", "input", "[", "2", "]", "=", "0xFF", ";", "input", "[", "3", "]", "=", "0xFF", ";", "for", "(", "i", "=", "3", ";", "(", "size_t", ")", "i", "<", "=", "nbOf255", "+", "4", ";", "i", "+", "+)", "input", "[", "i", "]", "=", "0xff", ";", "r", "=", "LZ4_decompress_safe", "(", "input", ",", "output", ",", "nbOf255", "+", "64", ",", "BLOCKSIZE_I134", ")", ";", "printf", "(", "\"", "Literal", "overflow", "detected", "(", "return", "=", "%", "i", "<", "0", ")", "\\", "n", "\"", ",", "r", ")", ";", "input", "[", "0", "]", "=", "0x1F", ";", "/", "/", "Match", "length", "overflow", "input", "[", "1", "]", "=", "0x01", ";", "input", "[", "2", "]", "=", "0x01", ";", "input", "[", "3", "]", "=", "0x00", ";", "r", "=", "LZ4_decompress_safe", "(", "input", ",", "output", ",", "nbOf255", "+", "64", ",", "BLOCKSIZE_I134", ")", ";", "printf", "(", "\"", "Match", "overflow", "detected", "(", "return", "=", "%", "i", "<", "0", ")", "\\", "n", "\"", ",", "r", ")", ";", "if", "(", "nbBuff", ">", "=", "2", ")", "{", "output", "=", "buffers", "[", "nbBuff", "-", "2", "]", ";", "memset", "(", "input", ",", "0", ",", "BLOCKSIZE_I134", ")", ";", "input", "[", "0", "]", "=", "0xF0", ";", "/", "/", "Literal", "length", "overflow", "input", "[", "1", "]", "=", "0xFF", ";", "input", "[", "2", "]", "=", "0xFF", ";", "input", "[", "3", "]", "=", "0xFF", ";", "r", "=", "LZ4_decompress_safe", "(", "input", ",", "output", ",", "nbOf255", "+", "64", ",", "BLOCKSIZE_I134", ")", ";", "printf", "(", "\"", "Literal", "overflow", "detected", "(", "return", "=", "%", "i", "<", "0", ")", "\\", "n", "\"", ",", "r", ")", ";", "input", "[", "0", "]", "=", "0x1F", ";", "/", "/", "Match", "length", "overflow", "input", "[", "1", "]", "=", "0x01", ";", "input", "[", "2", "]", "=", "0x01", ";", "input", "[", "3", "]", "=", "0x00", ";", "r", "=", "LZ4_decompress_safe", "(", "input", ",", "output", ",", "nbOf255", "+", "64", ",", "BLOCKSIZE_I134", ")", ";", "printf", "(", "\"", "Match", "overflow", "detected", "(", "return", "=", "%", "i", "<", "0", ")", "\\", "n", "\"", ",", "r", ")", ";", "}", "}", "free", "(", "buffers", "[", "nbBuff", "]", ");", "nbBuff", "-", "-;", "}", "}", "for", "(", "i", "=", "0", ";", "i", "<", "nbBuff", ";", "i", "+", "+)", "free", "(", "buffers", "[", "i", "]", ");", "printf", "(", "\"\\", "n", "\"", ");", "return", "0", ";", "}", "#", "define", "FUZ_MAX", "(", "a", ",", "b", ")", "(", "a", ">", "b", "?", "a", ":", "b", ")", "int", "FUZ_test", "(", "U32", "seed", ",", "int", "nbCycles", ",", "int", "startCycle", ",", "double", "compressibility", ")", "{", "unsigned", "long", "long", "bytes", "=", "0", ";", "unsigned", "long", "long", "cbytes", "=", "0", ";", "unsigned", "long", "long", "hcbytes", "=", "0", ";", "unsigned", "long", "long", "ccbytes", "=", "0", ";", "void", "*", "CNBuffer", ";", "char", "*", "compressedBuffer", ";", "char", "*", "decodedBuffer", ";", "#", "define", "FUZ_max", "LZ4_COMPRESSBOUND", "(", "LEN", ")", "unsigned", "int", "randState", "=", "seed", ";", "int", "ret", ",", "cycleNb", ";", "#", "define", "FUZ_CHECKTEST", "(", "cond", ",", ".", "..", ")", "if", "(", "cond", ")", "{", "printf", "(", "\"", "Test", "%", "i", ":", "\"", ",", "testNb", ")", ";", "printf", "(", "__VA_ARGS__", ")", ";", "\\", "printf", "(", "\"", "(", "seed", "%", "u", ",", "cycle", "%", "i", ")", "\\", "n", "\"", ",", "seed", ",", "cycleNb", ")", ";", "goto", "_output_error", ";", "}", "#", "define", "FUZ_DISPLAYTEST", "{", "testNb", "+", "+;", "(", "(", "displayLevel", "<", "3", ")", "|", "|", "no_prompt", ")", "?", "0", ":", "printf", "(", "\"%", "2i", "\\", "b", "\\", "b", "\"", ",", "testNb", ")", ";", "if", "(", "displayLevel", "=", "=", "4", ")", "fflush", "(", "stdout", ")", ";", "}", "void", "*", "stateLZ4", "=", "malloc", "(", "LZ4_sizeofState", "(", "))", ";", "void", "*", "stateLZ4HC", "=", "malloc", "(", "LZ4_sizeofStateHC", "(", "))", ";", "void", "*", "LZ4continue", ";", "LZ4_stream_t", "LZ4dict", ";", "U32", "crcOrig", ",", "crcCheck", ";", "int", "displayRefresh", ";", "/", "/", "init", "memset", "(", "&", "LZ4dict", ",", "0", ",", "sizeof", "(", "LZ4dict", ")", ");", "/", "/", "Create", "compressible", "test", "buffer", "CNBuffer", "=", "malloc", "(", "COMPRESSIBLE_NOISE_LENGTH", ")", ";", "FUZ_fillCompressibleNoiseBuffer", "(", "CNBuffer", ",", "COMPRESSIBLE_NOISE_LENGTH", ",", "compressibility", ",", "&", "randState", ")", ";", "compressedBuffer", "=", "malloc", "(", "LZ4_compressBound", "(", "FUZ_MAX_BLOCK_SIZE", ")", ");", "decodedBuffer", "=", "malloc", "(", "FUZ_MAX_DICT_SIZE", "+", "FUZ_MAX_BLOCK_SIZE", ")", ";", "/", "/", "display", "refresh", "rate", "switch", "(", "displayLevel", ")", "{", "case", "0", ":", "displayRefresh", "=", "nbCycles", "+", "1", ";", "break", ";", "case", "1", ":", "displayRefresh", "=", "FUZ_MAX", "(", "1", ",", "nbCycles", "/", "100", ")", ";", "break", ";", "case", "2", ":", "displayRefresh", "=", "89", ";", "break", ";", "default", ":", "displayRefresh", "=", "1", ";", "}", "/", "/", "move", "to", "startCycle", "for", "(", "cycleNb", "=", "0", ";", "cycleNb", "<", "startCycle", ";", "cycleNb", "+", "+)", "{", "/", "/", "synd", "rand", "&", "dict", "int", "dictSize", ",", "blockSize", ",", "blockStart", ";", "char", "*", "dict", ";", "char", "*", "block", ";", "blockSize", "=", "FUZ_rand", "(", "&", "randState", ")", "%", "FUZ_MAX_BLOCK_SIZE", ";", "blockStart", "=", "FUZ_rand", "(", "&", "randState", ")", "%", "(", "COMPRESSIBLE_NOISE_LENGTH", "-", "blockSize", ")", ";", "dictSize", "=", "FUZ_rand", "(", "&", "randState", ")", "%", "FUZ_MAX_DICT_SIZE", ";", "if", "(", "dictSize", ">", "blockStart", ")", "dictSize", "=", "blockStart", ";", "block", "=", "(", "(", "char", "*", ")", "CNBuffer", ")", "+", "blockStart", ";", "dict", "=", "block", "-", "dictSize", ";", "LZ4_loadDict", "(", "&", "LZ4dict", ",", "dict", ",", "dictSize", ")", ";", "LZ4_compress_continue", "(", "&", "LZ4dict", ",", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "LZ4_loadDict", "(", "&", "LZ4dict", ",", "dict", ",", "dictSize", ")", ";", "LZ4_compress_continue", "(", "&", "LZ4dict", ",", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "LZ4_loadDict", "(", "&", "LZ4dict", ",", "dict", ",", "dictSize", ")", ";", "LZ4_compress_continue", "(", "&", "LZ4dict", ",", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "}", "/", "/", "Test", "loop", "for", "(", "cycleNb", "=", "startCycle", ";", "cycleNb", "<", "nbCycles", ";", "cycleNb", "+", "+)", "{", "int", "testNb", "=", "0", ";", "char", "*", "dict", ";", "char", "*", "block", ";", "int", "dictSize", ",", "blockSize", ",", "blockStart", ",", "compressedSize", ",", "HCcompressedSize", ";", "int", "blockContinueCompressedSize", ";", "if", "(", "(", "cycleNb", "%", "displayRefresh", ")", "=", "=", "0", ")", "{", "printf", "(", "\"\\", "r", "%", "7i", "/", "%", "7i", "-", "\"", ",", "cycleNb", ",", "nbCycles", ")", ";", "fflush", "(", "stdout", ")", ";", "}", "/", "/", "Select", "block", "to", "test", "blockSize", "=", "FUZ_rand", "(", "&", "randState", ")", "%", "FUZ_MAX_BLOCK_SIZE", ";", "blockStart", "=", "FUZ_rand", "(", "&", "randState", ")", "%", "(", "COMPRESSIBLE_NOISE_LENGTH", "-", "blockSize", ")", ";", "dictSize", "=", "FUZ_rand", "(", "&", "randState", ")", "%", "FUZ_MAX_DICT_SIZE", ";", "if", "(", "dictSize", ">", "blockStart", ")", "dictSize", "=", "blockStart", ";", "block", "=", "(", "(", "char", "*", ")", "CNBuffer", ")", "+", "blockStart", ";", "dict", "=", "block", "-", "dictSize", ";", "/", "*", "Compression", "tests", "*", "/", "/", "/", "Test", "compression", "HC", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compressHC", "(", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "LZ4_compressHC", "(", ")", "failed", "\"", ");", "HCcompressedSize", "=", "ret", ";", "/", "/", "Test", "compression", "HC", "using", "external", "state", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compressHC_withStateHC", "(", "stateLZ4HC", ",", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "LZ4_compressHC_withStateHC", "(", ")", "failed", "\"", ");", "/", "/", "Test", "compression", "using", "external", "state", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compress_withState", "(", "stateLZ4", ",", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "LZ4_compress_withState", "(", ")", "failed", "\"", ");", "/", "/", "Test", "compression", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compress", "(", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "LZ4_compress", "(", ")", "failed", "\"", ");", "compressedSize", "=", "ret", ";", "/", "*", "Decompression", "tests", "*", "/", "crcOrig", "=", "XXH32", "(", "block", ",", "blockSize", ",", "0", ")", ";", "/", "/", "Test", "decoding", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_fast", "(", "compressedBuffer", ",", "decodedBuffer", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_fast", "failed", "despite", "correct", "space", "\"", ");", "FUZ_CHECKTEST", "(", "ret", "!", "=", "compressedSize", ",", "\"", "LZ4_decompress_fast", "failed", ":", "did", "not", "fully", "read", "compressed", "data", "\"", ");", "crcCheck", "=", "XXH32", "(", "decodedBuffer", ",", "blockSize", ",", "0", ")", ";", "FUZ_CHECKTEST", "(", "crcCheck", "!", "=", "crcOrig", ",", "\"", "LZ4_decompress_fast", "corrupted", "decoded", "data", "\"", ");", "/", "/", "Test", "decoding", "with", "one", "byte", "missing", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "-", "1", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_fast", "(", "compressedBuffer", ",", "decodedBuffer", ",", "blockSize", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_fast", "should", "have", "failed", ",", "due", "to", "Output", "Size", "being", "too", "small", "\"", ");", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "-", "1", "]", ",", "\"", "LZ4_decompress_fast", "overrun", "specified", "output", "buffer", "\"", ");", "/", "/", "Test", "decoding", "with", "one", "byte", "too", "much", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_fast", "(", "compressedBuffer", ",", "decodedBuffer", ",", "blockSize", "+", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_fast", "should", "have", "failed", ",", "due", "to", "Output", "Size", "being", "too", "large", "\"", ");", "/", "/", "Test", "decoding", "with", "output", "size", "exactly", "what", "'", "s", "necessary", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_safe", "(", "compressedBuffer", ",", "decodedBuffer", ",", "compressedSize", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_safe", "failed", "despite", "sufficient", "space", "\"", ");", "FUZ_CHECKTEST", "(", "ret", "!", "=", "blockSize", ",", "\"", "LZ4_decompress_safe", "did", "not", "regenerate", "original", "data", "\"", ");", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "]", ",", "\"", "LZ4_decompress_safe", "overrun", "specified", "output", "buffer", "size", "\"", ");", "crcCheck", "=", "XXH32", "(", "decodedBuffer", ",", "blockSize", ",", "0", ")", ";", "FUZ_CHECKTEST", "(", "crcCheck", "!", "=", "crcOrig", ",", "\"", "LZ4_decompress_safe", "corrupted", "decoded", "data", "\"", ");", "/", "/", "Test", "decoding", "with", "more", "than", "enough", "output", "size", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "]", "=", "0", ";", "decodedBuffer", "[", "blockSize", "+", "1", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_safe", "(", "compressedBuffer", ",", "decodedBuffer", ",", "compressedSize", ",", "blockSize", "+", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_safe", "failed", "despite", "amply", "sufficient", "space", "\"", ");", "FUZ_CHECKTEST", "(", "ret", "!", "=", "blockSize", ",", "\"", "LZ4_decompress_safe", "did", "not", "regenerate", "original", "data", "\"", ");", "/", "/", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "]", ",", "\"", "LZ4_decompress_safe", "wrote", "more", "than", "(", "unknown", ")", "target", "size", "\"", ");", "/", "/", "well", ",", "is", "that", "an", "issue", "?", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "+", "1", "]", ",", "\"", "LZ4_decompress_safe", "overrun", "specified", "output", "buffer", "size", "\"", ");", "crcCheck", "=", "XXH32", "(", "decodedBuffer", ",", "blockSize", ",", "0", ")", ";", "FUZ_CHECKTEST", "(", "crcCheck", "!", "=", "crcOrig", ",", "\"", "LZ4_decompress_safe", "corrupted", "decoded", "data", "\"", ");", "/", "/", "Test", "decoding", "with", "output", "size", "being", "one", "byte", "too", "short", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "-", "1", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_safe", "(", "compressedBuffer", ",", "decodedBuffer", ",", "compressedSize", ",", "blockSize", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe", "should", "have", "failed", ",", "due", "to", "Output", "Size", "being", "one", "byte", "too", "short", "\"", ");", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "-", "1", "]", ",", "\"", "LZ4_decompress_safe", "overrun", "specified", "output", "buffer", "size", "\"", ");", "/", "/", "Test", "decoding", "with", "output", "size", "being", "10", "bytes", "too", "short", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "if", "(", "blockSize", ">", "10", ")", "{", "decodedBuffer", "[", "blockSize", "-", "10", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_safe", "(", "compressedBuffer", ",", "decodedBuffer", ",", "compressedSize", ",", "blockSize", "-", "10", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe", "should", "have", "failed", ",", "due", "to", "Output", "Size", "being", "10", "bytes", "too", "short", "\"", ");", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "-", "10", "]", ",", "\"", "LZ4_decompress_safe", "overrun", "specified", "output", "buffer", "size", "\"", ");", "}", "/", "/", "Test", "decoding", "with", "input", "size", "being", "one", "byte", "too", "short", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe", "(", "compressedBuffer", ",", "decodedBuffer", ",", "compressedSize", "-", "1", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe", "should", "have", "failed", ",", "due", "to", "input", "size", "being", "one", "byte", "too", "short", "(", "blockSize", "=", "%", "i", ",", "ret", "=", "%", "i", ",", "compressedSize", "=", "%", "i", ")", "\",", "blockSize", ",", "ret", ",", "compressedSize", ")", ";", "/", "/", "Test", "decoding", "with", "input", "size", "being", "one", "byte", "too", "large", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_safe", "(", "compressedBuffer", ",", "decodedBuffer", ",", "compressedSize", "+", "1", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe", "should", "have", "failed", ",", "due", "to", "input", "size", "being", "too", "large", "\"", ");", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "]", ",", "\"", "LZ4_decompress_safe", "overrun", "specified", "output", "buffer", "size", "\"", ");", "/", "/", "Test", "partial", "decoding", "with", "target", "output", "size", "being", "max", "/", "2", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe_partial", "(", "compressedBuffer", ",", "decodedBuffer", ",", "compressedSize", ",", "blockSize", "/", "2", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_safe_partial", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "partial", "decoding", "with", "target", "output", "size", "being", "just", "below", "max", "=", ">", "must", "work", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe_partial", "(", "compressedBuffer", ",", "decodedBuffer", ",", "compressedSize", ",", "blockSize", "-", "3", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "0", ",", "\"", "LZ4_decompress_safe_partial", "failed", "despite", "sufficient", "space", "\"", ");", "/", "*", "Test", "Compression", "with", "limited", "output", "size", "*", "/", "/", "/", "Test", "compression", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "(", "should", "work", ")", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compress_limitedOutput", "(", "block", ",", "compressedBuffer", ",", "blockSize", ",", "compressedSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "LZ4_compress_limitedOutput", "(", ")", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "compression", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "and", "external", "state", "(", "should", "work", ")", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compress_limitedOutput_withState", "(", "stateLZ4", ",", "block", ",", "compressedBuffer", ",", "blockSize", ",", "compressedSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "LZ4_compress_limitedOutput_withState", "(", ")", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "HC", "compression", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "(", "should", "work", ")", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compressHC_limitedOutput", "(", "block", ",", "compressedBuffer", ",", "blockSize", ",", "HCcompressedSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "LZ4_compressHC_limitedOutput", "(", ")", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "HC", "compression", "with", "output", "size", "being", "exactly", "what", "'", "s", "necessary", "(", "should", "work", ")", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_compressHC_limitedOutput_withStateHC", "(", "stateLZ4HC", ",", "block", ",", "compressedBuffer", ",", "blockSize", ",", "HCcompressedSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "=", "=", "0", ",", "\"", "LZ4_compressHC_limitedOutput_withStateHC", "(", ")", "failed", "despite", "sufficient", "space", "\"", ");", "/", "/", "Test", "compression", "with", "just", "one", "missing", "byte", "into", "output", "buffer", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "compressedBuffer", "[", "compressedSize", "-", "1", "]", "=", "0", ";", "ret", "=", "LZ4_compress_limitedOutput", "(", "block", ",", "compressedBuffer", ",", "blockSize", ",", "compressedSize", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ",", "\"", "LZ4_compress_limitedOutput", "should", "have", "failed", "(", "output", "buffer", "too", "small", "by", "1", "byte", ")", "\")", ";", "FUZ_CHECKTEST", "(", "compressedBuffer", "[", "compressedSize", "-", "1", "]", ",", "\"", "LZ4_compress_limitedOutput", "overran", "output", "buffer", "\"", ")", "/", "/", "Test", "HC", "compression", "with", "just", "one", "missing", "byte", "into", "output", "buffer", "=", ">", "must", "fail", "FUZ_DISPLAYTEST", ";", "compressedBuffer", "[", "compressedSize", "-", "1", "]", "=", "0", ";", "ret", "=", "LZ4_compressHC_limitedOutput", "(", "block", ",", "compressedBuffer", ",", "blockSize", ",", "HCcompressedSize", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ",", "\"", "LZ4_compressHC_limitedOutput", "should", "have", "failed", "(", "output", "buffer", "too", "small", "by", "1", "byte", ")", "\")", ";", "FUZ_CHECKTEST", "(", "compressedBuffer", "[", "compressedSize", "-", "1", "]", ",", "\"", "LZ4_compressHC_limitedOutput", "overran", "output", "buffer", "\"", ")", "/", "*", "Dictionary", "tests", "*", "/", "/", "/", "Compress", "using", "dictionary", "FUZ_DISPLAYTEST", ";", "LZ4continue", "=", "LZ4_create", "(", "dict", ")", ";", "LZ4_compress_continue", "(", "LZ4continue", ",", "dict", ",", "compressedBuffer", ",", "dictSize", ")", ";", "/", "/", "Just", "to", "fill", "hash", "tables", "blockContinueCompressedSize", "=", "LZ4_compress_continue", "(", "LZ4continue", ",", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "blockContinueCompressedSize", "=", "=", "0", ",", "\"", "LZ4_compress_continue", "failed", "\"", ");", "LZ4_free", "(", "LZ4continue", ")", ";", "/", "/", "Decompress", "with", "dictionary", "as", "prefix", "FUZ_DISPLAYTEST", ";", "memcpy", "(", "decodedBuffer", ",", "dict", ",", "dictSize", ")", ";", "ret", "=", "LZ4_decompress_fast_withPrefix64k", "(", "compressedBuffer", ",", "decodedBuffer", "+", "dictSize", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "!", "=", "blockContinueCompressedSize", ",", "\"", "LZ4_decompress_fast_withPrefix64k", "did", "not", "read", "all", "compressed", "block", "input", "\"", ");", "crcCheck", "=", "XXH32", "(", "decodedBuffer", "+", "dictSize", ",", "blockSize", ",", "0", ")", ";", "if", "(", "crcCheck", "!", "=", "crcOrig", ")", "{", "int", "i", "=", "0", ";", "while", "(", "block", "[", "i", "]", "==", "decodedBuffer", "[", "i", "]", ")", "i", "+", "+;", "printf", "(", "\"", "Wrong", "Byte", "at", "position", "%", "i", "/", "%", "i", "\\", "n", "\"", ",", "i", ",", "blockSize", ")", ";", "}", "FUZ_CHECKTEST", "(", "crcCheck", "!", "=", "crcOrig", ",", "\"", "LZ4_decompress_fast_withPrefix64k", "corrupted", "decoded", "data", "(", "dict", "%", "i", ")", "\",", "dictSize", ")", ";", "FUZ_DISPLAYTEST", ";", "ret", "=", "LZ4_decompress_safe_withPrefix64k", "(", "compressedBuffer", ",", "decodedBuffer", "+", "dictSize", ",", "blockContinueCompressedSize", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "!", "=", "blockSize", ",", "\"", "LZ4_decompress_safe_withPrefix64k", "did", "not", "regenerate", "original", "data", "\"", ");", "crcCheck", "=", "XXH32", "(", "decodedBuffer", "+", "dictSize", ",", "blockSize", ",", "0", ")", ";", "FUZ_CHECKTEST", "(", "crcCheck", "!", "=", "crcOrig", ",", "\"", "LZ4_decompress_safe_withPrefix64k", "corrupted", "decoded", "data", "\"", ");", "/", "/", "Compress", "using", "External", "dictionary", "FUZ_DISPLAYTEST", ";", "dict", "-", "=", "9", ";", "/", "/", "Separation", ",", "so", "it", "is", "an", "ExtDict", "if", "(", "dict", "<", "(", "char", "*", ")", "CNBuffer", ")", "dict", "=", "(", "char", "*", ")", "CNBuffer", ";", "LZ4_loadDict", "(", "&", "LZ4dict", ",", "dict", ",", "dictSize", ")", ";", "blockContinueCompressedSize", "=", "LZ4_compress_continue", "(", "&", "LZ4dict", ",", "block", ",", "compressedBuffer", ",", "blockSize", ")", ";", "FUZ_CHECKTEST", "(", "blockContinueCompressedSize", "=", "=", "0", ",", "\"", "LZ4_compress_continue", "failed", "\"", ");", "FUZ_DISPLAYTEST", ";", "LZ4_loadDict", "(", "&", "LZ4dict", ",", "dict", ",", "dictSize", ")", ";", "ret", "=", "LZ4_compress_limitedOutput_continue", "(", "&", "LZ4dict", ",", "block", ",", "compressedBuffer", ",", "blockSize", ",", "blockContinueCompressedSize", "-", "1", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "0", ",", "\"", "LZ4_compress_limitedOutput_continue", "using", "ExtDict", "should", "fail", ":", "one", "missing", "byte", "for", "output", "buffer", "\"", ");", "FUZ_DISPLAYTEST", ";", "LZ4_loadDict", "(", "&", "LZ4dict", ",", "dict", ",", "dictSize", ")", ";", "ret", "=", "LZ4_compress_limitedOutput_continue", "(", "&", "LZ4dict", ",", "block", ",", "compressedBuffer", ",", "blockSize", ",", "blockContinueCompressedSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "!", "=", "blockContinueCompressedSize", ",", "\"", "LZ4_compress_limitedOutput_compressed", "size", "is", "different", "(", "%", "i", "!", "=", "%", "i", ")", "\",", "ret", ",", "blockContinueCompressedSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "<", "=", "0", ",", "\"", "LZ4_compress_limitedOutput_continue", "should", "work", ":", "enough", "size", "available", "within", "output", "buffer", "\"", ");", "/", "/", "Decompress", "with", "dictionary", "as", "external", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_fast_usingDict", "(", "compressedBuffer", ",", "decodedBuffer", ",", "blockSize", ",", "dict", ",", "dictSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "!", "=", "blockContinueCompressedSize", ",", "\"", "LZ4_decompress_fast_usingDict", "did", "not", "read", "all", "compressed", "block", "input", "\"", ");", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "]", ",", "\"", "LZ4_decompress_fast_usingDict", "overrun", "specified", "output", "buffer", "size", "\"", ")", "crcCheck", "=", "XXH32", "(", "decodedBuffer", ",", "blockSize", ",", "0", ")", ";", "if", "(", "crcCheck", "!", "=", "crcOrig", ")", "{", "int", "i", "=", "0", ";", "while", "(", "block", "[", "i", "]", "==", "decodedBuffer", "[", "i", "]", ")", "i", "+", "+;", "printf", "(", "\"", "Wrong", "Byte", "at", "position", "%", "i", "/", "%", "i", "\\", "n", "\"", ",", "i", ",", "blockSize", ")", ";", "}", "FUZ_CHECKTEST", "(", "crcCheck", "!", "=", "crcOrig", ",", "\"", "LZ4_decompress_fast_usingDict", "corrupted", "decoded", "data", "(", "dict", "%", "i", ")", "\",", "dictSize", ")", ";", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_safe_usingDict", "(", "compressedBuffer", ",", "decodedBuffer", ",", "blockContinueCompressedSize", ",", "blockSize", ",", "dict", ",", "dictSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", "!", "=", "blockSize", ",", "\"", "LZ4_decompress_safe_usingDict", "did", "not", "regenerate", "original", "data", "\"", ");", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "]", ",", "\"", "LZ4_decompress_safe_usingDict", "overrun", "specified", "output", "buffer", "size", "\"", ")", "crcCheck", "=", "XXH32", "(", "decodedBuffer", ",", "blockSize", ",", "0", ")", ";", "FUZ_CHECKTEST", "(", "crcCheck", "!", "=", "crcOrig", ",", "\"", "LZ4_decompress_safe_usingDict", "corrupted", "decoded", "data", "\"", ");", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "-", "1", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_fast_usingDict", "(", "compressedBuffer", ",", "decodedBuffer", ",", "blockSize", "-", "1", ",", "dict", ",", "dictSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_fast_withDict", "should", "have", "failed", ":", "wrong", "original", "size", "(", "-", "1", "byte", ")", "\")", ";", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "-", "1", "]", ",", "\"", "LZ4_decompress_fast_usingDict", "overrun", "specified", "output", "buffer", "size", "\"", ");", "FUZ_DISPLAYTEST", ";", "decodedBuffer", "[", "blockSize", "-", "1", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_safe_usingDict", "(", "compressedBuffer", ",", "decodedBuffer", ",", "blockContinueCompressedSize", ",", "blockSize", "-", "1", ",", "dict", ",", "dictSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe_usingDict", "should", "have", "failed", ":", "not", "enough", "output", "size", "(", "-", "1", "byte", ")", "\")", ";", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "-", "1", "]", ",", "\"", "LZ4_decompress_safe_usingDict", "overrun", "specified", "output", "buffer", "size", "\"", ");", "FUZ_DISPLAYTEST", ";", "if", "(", "blockSize", ">", "10", ")", "{", "decodedBuffer", "[", "blockSize", "-", "10", "]", "=", "0", ";", "ret", "=", "LZ4_decompress_safe_usingDict", "(", "compressedBuffer", ",", "decodedBuffer", ",", "blockContinueCompressedSize", ",", "blockSize", "-", "10", ",", "dict", ",", "dictSize", ")", ";", "FUZ_CHECKTEST", "(", "ret", ">", "=", "0", ",", "\"", "LZ4_decompress_safe_usingDict", "should", "have", "failed", ":", "output", "buffer", "too", "small", "(", "-", "10", "byte", ")", "\")", ";", "FUZ_CHECKTEST", "(", "decodedBuffer", "[", "blockSize", "-", "10", "]", ",", "\"", "LZ4_decompress_safe_usingDict", "overrun", "specified", "output", "buffer", "size", "(", "-", "10", "byte", ")", "(", "blockSize", "=", "%", "i", ")", "\",", "blockSize", ")", ";", "}", "/", "/", "Fill", "stats", "bytes", "+", "=", "blockSize", ";", "cbytes", "+", "=", "compressedSize", ";", "hcbytes", "+", "=", "HCcompressedSize", ";", "ccbytes", "+", "=", "blockContinueCompressedSize", ";", "}", "printf", "(", "\"\\", "r", "%", "7i", "/", "%", "7i", "-", "\"", ",", "cycleNb", ",", "nbCycles", ")", ";", "printf", "(", "\"", "all", "tests", "completed", "successfully", "\\", "n", "\"", ");", "printf", "(", "\"", "compression", "ratio", ":", "%", "0", ".", "3f", "%", "%\\", "n", "\"", ",", "(", "double", ")", "cbytes", "/", "bytes", "*", "100", ")", ";", "printf", "(", "\"", "HC", "compression", "ratio", ":", "%", "0", ".", "3f", "%", "%\\", "n", "\"", ",", "(", "double", ")", "hcbytes", "/", "bytes", "*", "100", ")", ";", "printf", "(", "\"", "ratio", "with", "dict", ":", "%", "0", ".", "3f", "%", "%\\", "n", "\"", ",", "(", "double", ")", "ccbytes", "/", "bytes", "*", "100", ")", ";", "/", "/", "unalloc", "if", "(", "!", "no_prompt", ")", "getchar", "(", ");", "free", "(", "CNBuffer", ")", ";", "free", "(", "compressedBuffer", ")", ";", "free", "(", "decodedBuffer", ")", ";", "free", "(", "stateLZ4", ")", ";", "free", "(", "stateLZ4HC", ")", ";", "return", "0", ";", "_output_error", ":", "if", "(", "!", "no_prompt", ")", "getchar", "(", ");", "free", "(", "CNBuffer", ")", ";", "free", "(", "compressedBuffer", ")", ";", "free", "(", "decodedBuffer", ")", ";", "free", "(", "stateLZ4", ")", ";", "free", "(", "stateLZ4HC", ")", ";", "return", "1", ";", "}", "int", "FUZ_usage", "(", ")", "{", "DISPLAY", "(", "\"", "Usage", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "[", "args", "]", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "i", "#", ":", "Nb", "of", "tests", "(", "default", ":", "%", "i", ")", "\\", "n", "\"", ",", "NB_ATTEMPTS", ")", ";", "DISPLAY", "(", "\"", "-", "s", "#", ":", "Select", "seed", "(", "default", ":", "prompt", "user", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "t", "#", ":", "Select", "starting", "test", "number", "(", "default", ":", "0", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "p", "#", ":", "Select", "compressibility", "in", "%", "%", "(", "default", ":", "%", "i", "%", "%)", "\\", "n", "\"", ",", "FUZ_COMPRESSIBILITY_DEFAULT", ")", ";", "DISPLAY", "(", "\"", "-", "v", ":", "verbose", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "h", ":", "display", "help", "and", "exit", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "main", "(", "int", "argc", ",", "char", "*", "*", "argv", ")", "{", "U32", "timestamp", "=", "FUZ_GetMilliStart", "(", ");", "U32", "seed", "=", "0", ";", "int", "seedset", "=", "0", ";", "int", "argNb", ";", "int", "nbTests", "=", "NB_ATTEMPTS", ";", "int", "testNb", "=", "0", ";", "int", "proba", "=", "FUZ_COMPRESSIBILITY_DEFAULT", ";", "/", "/", "Check", "command", "line", "programName", "=", "argv", "[", "0", "]", ";", "for", "(", "argNb", "=", "1", ";", "argNb", "<", "argc", ";", "argNb", "+", "+)", "{", "char", "*", "argument", "=", "argv", "[", "argNb", "]", ";", "if", "(", "!", "argument", ")", "continue", ";", "/", "/", "Protection", "if", "argument", "empty", "/", "/", "Decode", "command", "(", "note", ":", "aggregated", "commands", "are", "allowed", ")", "if", "(", "argument", "[", "0", "]", "==", "'-", "')", "{", "if", "(", "!", "strcmp", "(", "argument", ",", "\"", "--", "no", "-", "prompt", "\"", "))", "{", "no_prompt", "=", "1", ";", "seedset", "=", "1", ";", "displayLevel", "=", "1", ";", "continue", ";", "}", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "{", "argument", "+", "+;", "switch", "(", "*", "argument", ")", "{", "case", "'", "h", "'", ":", "return", "FUZ_usage", "(", ");", "case", "'", "v", "'", ":", "argument", "+", "+;", "displayLevel", "=", "4", ";", "break", ";", "case", "'", "i", "'", ":", "argument", "+", "+;", "nbTests", "=", "0", ";", "while", "(", "(*", "argument", ">", "='", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "='", "9", "'", "))", "{", "nbTests", "*", "=", "10", ";", "nbTests", "+", "=", "*", "argument", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "break", ";", "case", "'", "s", "'", ":", "argument", "+", "+;", "seed", "=", "0", ";", "seedset", "=", "1", ";", "while", "(", "(*", "argument", ">", "='", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "='", "9", "'", "))", "{", "seed", "*", "=", "10", ";", "seed", "+", "=", "*", "argument", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "break", ";", "case", "'", "t", "'", ":", "argument", "+", "+;", "testNb", "=", "0", ";", "while", "(", "(*", "argument", ">", "='", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "='", "9", "'", "))", "{", "testNb", "*", "=", "10", ";", "testNb", "+", "=", "*", "argument", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "break", ";", "case", "'", "p", "'", ":", "argument", "+", "+;", "proba", "=", "0", ";", "while", "(", "(*", "argument", ">", "='", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "='", "9", "'", "))", "{", "proba", "*", "=", "10", ";", "proba", "+", "=", "*", "argument", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "if", "(", "proba", "<", "0", ")", "proba", "=", "0", ";", "if", "(", "proba", ">", "100", ")", "proba", "=", "100", ";", "break", ";", "default", ":", ";", "}", "}", "}", "}", "/", "/", "Get", "Seed", "printf", "(", "\"", "Starting", "LZ4", "fuzzer", "(", "%", "i", "-", "bits", ",", "%", "s", ")", "\\", "n", "\"", ",", "(", "int", ")", "(", "sizeof", "(", "size_t", ")", "*", "8", ")", ",", "LZ4_VERSION", ")", ";", "if", "(", "!", "seedset", ")", "{", "char", "userInput", "[", "50", "]", "=", "{", "0", "}", ";", "printf", "(", "\"", "Select", "an", "Initialisation", "number", "(", "default", ":", "random", ")", ":", "\"", ");", "fflush", "(", "stdout", ")", ";", "if", "(", "no_prompt", "|", "|", "fgets", "(", "userInput", ",", "sizeof", "userInput", ",", "stdin", ")", ")", "{", "if", "(", "sscanf", "(", "userInput", ",", "\"", "%", "u", "\"", ",", "&", "seed", ")", "=", "=", "1", ")", "{", "}", "else", "seed", "=", "FUZ_GetMilliSpan", "(", "timestamp", ")", ";", "}", "}", "printf", "(", "\"", "Seed", "=", "%", "u", "\\", "n", "\"", ",", "seed", ")", ";", "if", "(", "proba", "!", "=", "FUZ_COMPRESSIBILITY_DEFAULT", ")", "printf", "(", "\"", "Compressibility", ":", "%", "i", "%", "%\\", "n", "\"", ",", "proba", ")", ";", "FUZ_Issue52", "(", ");", "FUZ_Issue134", "(", ");", "if", "(", "nbTests", "<", "=", "0", ")", "nbTests", "=", "1", ";", "return", "FUZ_test", "(", "seed", ",", "nbTests", ",", "testNb", ",", "(", "(", "double", ")", "proba", ")", "/", "100", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "88", "@", "@", "\\", "\"", "\\", "\"", "lz4", ".", "1", ":", "This", "is", "a", "manual", "page", "for", "'", "lz4", "'", "program", ".", "This", "file", "is", "part", "of", "the", "\\", "\"", "lz4", "<", "https", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", ">", "project", ".", "\\", "\"", "\\", "\"", "No", "hyphenation", ".", "hy", "0", ".", "nr", "HY", "0", ".", "TH", "lz4", "\"", "1", "\"", "\"", "2014", "-", "02", "-", "27", "\"", "\"", "lz4", "\"", "\"", "User", "Commands", "\"", ".", "SH", "NAME", "\\", "fBlz4", "\\", "fR", "-", "Extremely", "fast", "compression", "algorithm", ".", "SH", "SYNOPSIS", ".", "TP", "5", "\\", "fBlz4", "\\", "fR", "[", "\\", "fBOPTIONS", "\\", "fR", "]", "[", "-|", "INPUT", "-", "FILE", "]", "<", "OUTPUT", "-", "FILE", ">", ".", "SH", "DESCRIPTION", ".", "PP", "\\", "fBlz4", "\\", "fR", "is", "an", "extremely", "fast", "lossless", "compression", "algorithm", ".", "It", "is", "based", "on", "the", "\\", "fBLZ77", "\\", "fR", "family", "of", "compression", "scheme", ".", "At", "the", "compression", "speed", "of", "400", "MB", "/", "s", "per", "core", ",", "\\", "fBlz4", "\\", "fR", "is", "also", "scalable", "with", "multi", "-", "core", "CPUs", ".", "It", "features", "an", "extremely", "fast", "decoder", ",", "with", "speed", "in", "multiple", "GB", "/", "s", "per", "core", ",", "typically", "reaching", "the", "RAM", "speed", "limits", "on", "multi", "-", "core", "systems", ".", "\\", "fBlz4", "\\", "fR", "supports", "following", "options", ".", "SH", "OPTIONS", ".", "TP", ".", "B", "\\", "-", "1", "fast", "compression", "(", "default", ")", ".", "TP", ".", "B", "\\", "-", "9", "high", "compression", ".", "TP", ".", "B", "\\", "-", "d", "decompression", ".", "TP", ".", "B", "\\", "-", "f", "overwrite", "output", "without", "prompting", ".", "TP", ".", "B", "\\", "-", "h", "/", "\\-", "H", "display", "help", "/", "long", "help", "and", "exit", ".", "TP", ".", "B", "\\", "-", "V", "display", "Version", "number", "and", "exit", ".", "TP", ".", "B", "\\", "-", "v", "verbose", "mode", ".", "TP", ".", "B", "\\", "-", "q", "suppress", "warnings", ";", "specify", "twice", "to", "suppress", "errors", "too", ".", "TP", ".", "B", "\\", "-", "c", "force", "write", "to", "standard", "output", ",", "even", "if", "it", "is", "the", "console", ".", "TP", ".", "B", "\\", "-", "t", "test", "compressed", "file", "integrity", ".", "TP", ".", "B", "\\", "-", "z", "force", "compression", ".", "TP", ".", "B", "\\", "-", "l", "use", "Legacy", "format", "(", "useful", "for", "Linux", "Kernel", "compression", ")", ".", "TP", ".", "B", "\\", "-", "B", "#", "block", "size", "[", "4", "-", "7", "]", "(", "default", ":", "7", ")", "B4", "=", "64KB", ";", "B5", "=", "256KB", ";", "B6", "=", "1MB", ";", "B7", "=", "4MB", ".", "TP", ".", "B", "\\", "-", "BD", "block", "dependency", "(", "improve", "compression", "ratio", ")", ".", "TP", ".", "B", "\\", "-", "BX", "enable", "block", "checksum", "(", "default", ":", "disabled", ")", ".", "TP", ".", "B", "\\", "-", "Sx", "disable", "stream", "checksum", "(", "default", ":", "enabled", ")", ".", "TP", ".", "B", "\\", "-", "b", "benchmark", "file", "(", "s", ")", ".", "TP", ".", "B", "\\", "-", "i", "#", "iteration", "loops", "[", "1", "-", "9", "]", "(", "default", ":", "3", ")", ",", "benchmark", "mode", "only", ".", "SH", "BUGS", "Report", "bugs", "at", ":", "-", "https", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", ".", "SH", "AUTHOR", "Yann", "Collet", "@", "@", "-", "0", ",", "0", "+", "1", ",", "33", "@", "@", "\\", "\"", "\\", "\"", "lz4c", ".", "1", ":", "This", "is", "a", "manual", "page", "for", "'", "lz4c", "'", "program", ".", "This", "file", "is", "part", "of", "the", "\\", "\"", "lz4", "<", "https", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", ">", "project", ".", "\\", "\"", "\\", "\"", "No", "hyphenation", ".", "hy", "0", ".", "nr", "HY", "0", ".", "TH", "lz4c", "\"", "1", "\"", "\"", "2014", "-", "04", "-", "15", "\"", "\"", "lz4c", "\"", "\"", "User", "Commands", "\"", ".", "SH", "NAME", "\\", "fBlz4", "\\", "fR", "-", "Extremely", "fast", "compression", "algorithm", ".", "SH", "SYNOPSIS", ".", "TP", "5", "\\", "fBlz4c", "\\", "fR", "[", "\\", "fBOPTIONS", "\\", "fR", "]", "[", "-|", "INPUT", "-", "FILE", "]", "<", "OUTPUT", "-", "FILE", ">", ".", "SH", "DESCRIPTION", ".", "PP", "\\", "fBlz4c", "\\", "fR", "is", "the", "legacy", "version", "of", "\\", "fBlz4", "\\", "fR", ".", "As", "such", ",", "it", "supports", "older", "supplementary", "legacy", "commands", ".", "\\", "fBlz4c", "\\", "fR", "is", "now", "deprecated", ".", "It", "is", "recommended", "to", "use", "\\", "fBlz4", "\\", "fR", "instead", "whenever", "possible", ".", "To", "get", "a", "list", "of", "commands", "specific", "to", "lz4c", ",", "do", ":", "lz4c", "-", "h", ".", "SH", "BUGS", "Report", "bugs", "at", ":", "-", "https", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", ".", "SH", "AUTHOR", "Yann", "Collet", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "32", "@", "@", "\\", "\"", "\\", "\"", "lz4cat", ".", "1", ":", "This", "is", "a", "manual", "page", "for", "'", "lz4cat", "'", "program", ".", "This", "file", "is", "part", "of", "\\", "\"", "the", "lz4", "<", "https", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", ">", "project", ".", "\\", "\"", "\\", "\"", "No", "hyphenation", ".", "hy", "0", ".", "nr", "HY", "0", ".", "TH", "lz4cat", "\"", "1", "\"", "\"", "2014", "-", "06", "-", "20", "\"", "\"", "lz4cat", "\"", "\"", "User", "Commands", "\"", ".", "SH", "NAME", "\\", "fBlz4cat", "\\", "fR", "-", "Utility", "based", "on", "LZ4", ".", "SH", "SYNOPSIS", ".", "TP", "5", "\\", "fBlz4cat", "\\", "fR", "[", "\\", "fBOPTIONS", "\\", "fR", "]", "[", "-|", "INPUT", "-", "FILE", "]", ".", "SH", "DESCRIPTION", ".", "PP", "\\", "fBlz4cat", "\\", "fR", "is", "an", "utility", "based", "on", "\\", "fBlz4", "\\", "fR", ",", "an", "extremely", "fast", "lossless", "compression", "algorithm", ".", "\\", "fBlz4cat", "\\", "fR", "decompress", "input", "file", "or", "stream", ",", "redirecting", "its", "output", "to", "the", "console", ".", "It", "is", "equivalent", "to", "\\", "fBlz4", "-", "cd", "\\", "fR", ",", "Available", "options", "are", "the", "same", "as", "\\", "fBlz4", "\\", "fR", "ones", "(", "man", "lz4", ")", ".", ".", "SH", "BUGS", "Report", "bugs", "at", ":", "-", "https", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", ".", "SH", "AUTHOR", "Yann", "Collet", "@", "@", "-", "0", ",", "0", "+", "1", ",", "533", "@", "@", "/", "*", "LZ4cli", ".", "c", "-", "LZ4", "Command", "Line", "Interface", "Copyright", "(", "C", ")", "Yann", "Collet", "2011", "-", "2014", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "-", "LZ4", "public", "forum", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "#!", "forum", "/", "lz4c", "*", "/", "/", "*", "Note", ":", "this", "is", "stand", "-", "alone", "program", ".", "It", "is", "not", "part", "of", "LZ4", "compression", "library", ",", "it", "is", "a", "user", "program", "of", "the", "LZ4", "library", ".", "The", "license", "of", "LZ4", "library", "is", "BSD", ".", "The", "license", "of", "xxHash", "library", "is", "BSD", ".", "The", "license", "of", "this", "compression", "CLI", "program", "is", "GPLv2", ".", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Tuning", "parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "DISABLE_LZ4C_LEGACY_OPTIONS", ":", "/", "/", "Control", "the", "availability", "of", "-", "c0", ",", "-", "c1", "and", "-", "hc", "legacy", "arguments", "/", "/", "Default", ":", "Legacy", "options", "are", "enabled", "/", "/", "#", "define", "DISABLE_LZ4C_LEGACY_OPTIONS", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "define", "_CRT_SECURE_NO_WARNINGS", "#", "define", "_CRT_SECURE_NO_DEPRECATE", "/", "/", "VS2005", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "/", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "#", "endif", "#", "define", "_FILE_OFFSET_BITS", "64", "/", "/", "Large", "file", "support", "on", "32", "-", "bits", "unix", "#", "define", "_POSIX_SOURCE", "1", "/", "/", "for", "fileno", "(", ")", "within", "<", "stdio", ".", "h", ">", "on", "unix", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fprintf", ",", "fopen", ",", "fread", ",", "_fileno", ",", "stdin", ",", "stdout", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "malloc", "#", "include", "<", "string", ".", "h", ">", "/", "/", "strcmp", ",", "strlen", "#", "include", "<", "time", ".", "h", ">", "/", "/", "clock", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "include", "\"", "xxhash", ".", "h", "\"", "#", "include", "\"", "bench", ".", "h", "\"", "#", "include", "\"", "lz4io", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "OS", "-", "specific", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "MSDOS", ")", "|", "|", "defined", "(", "OS2", ")", "|", "|", "defined", "(", "WIN32", ")", "|", "|", "defined", "(", "_WIN32", ")", "|", "|", "defined", "(", "__CYGWIN__", ")", "#", "include", "<", "fcntl", ".", "h", ">", "/", "/", "_O_BINARY", "#", "include", "<", "io", ".", "h", ">", "/", "/", "_setmode", ",", "_isatty", "#", "ifdef", "__MINGW32__", "int", "_fileno", "(", "FILE", "*", "stream", ")", ";", "/", "/", "MINGW", "somehow", "forgets", "to", "include", "this", "windows", "declaration", "into", "<", "stdio", ".", "h", ">", "#", "endif", "#", "define", "SET_BINARY_MODE", "(", "file", ")", "_setmode", "(", "_fileno", "(", "file", ")", ",", "_O_BINARY", ")", "#", "define", "IS_CONSOLE", "(", "stdStream", ")", "_isatty", "(", "_fileno", "(", "stdStream", ")", ")", "#", "else", "#", "include", "<", "unistd", ".", "h", ">", "/", "/", "isatty", "#", "define", "SET_BINARY_MODE", "(", "file", ")", "#", "define", "IS_CONSOLE", "(", "stdStream", ")", "isatty", "(", "fileno", "(", "stdStream", ")", ")", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "-", "specific", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "GCC_VERSION", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "/", "/", "Visual", "Studio", "#", "define", "swap32", "_byteswap_ulong", "#", "elif", "GCC_VERSION", ">", "=", "403", "#", "define", "swap32", "__builtin_bswap32", "#", "else", "static", "inline", "unsigned", "int", "swap32", "(", "unsigned", "int", "x", ")", "{", "return", "(", "(", "x", "<", "<", "24", ")", "&", "0xff000000", ")", "|", "(", "(", "x", "<", "<", "8", ")", "&", "0x00ff0000", ")", "|", "(", "(", "x", ">", ">", "8", ")", "&", "0x0000ff00", ")", "|", "(", "(", "x", ">", ">", "24", ")", "&", "0x000000ff", ")", ";", "}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "COMPRESSOR_NAME", "\"", "LZ4", "Compression", "CLI", "\"", "#", "ifndef", "LZ4_VERSION", "#", "define", "LZ4_VERSION", "\"", "v1", ".", "2", ".", "0", "\"", "#", "endif", "#", "define", "AUTHOR", "\"", "Yann", "Collet", "\"", "#", "define", "WELCOME_MESSAGE", "\"", "**", "*", "%", "s", "%", "i", "-", "bits", "%", "s", ",", "by", "%", "s", "(", "%", "s", ")", "*", "**", "\\", "n", "\"", ",", "COMPRESSOR_NAME", ",", "(", "int", ")", "(", "sizeof", "(", "void", "*", ")*", "8", ")", ",", "LZ4_VERSION", ",", "AUTHOR", ",", "__DATE__", "#", "define", "LZ4_EXTENSION", "\"", ".", "lz4", "\"", "#", "define", "LZ4_CAT", "\"", "lz4cat", "\"", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "#", "define", "LZ4_BLOCKSIZEID_DEFAULT", "7", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Architecture", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "const", "int", "one", "=", "1", ";", "#", "define", "CPU_LITTLE_ENDIAN", "(", "*(", "char", "*", ")(", "&", "one", ")", ")", "#", "define", "CPU_BIG_ENDIAN", "(", "!", "CPU_LITTLE_ENDIAN", ")", "#", "define", "LITTLE_ENDIAN_32", "(", "i", ")", "(", "CPU_LITTLE_ENDIAN", "?", "(", "i", ")", ":", "swap32", "(", "i", ")", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "#", "define", "DISPLAYLEVEL", "(", "l", ",", ".", "..", ")", "if", "(", "displayLevel", ">", "=", "l", ")", "{", "DISPLAY", "(", "__VA_ARGS__", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "Parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "char", "*", "programName", ";", "static", "int", "displayLevel", "=", "2", ";", "/", "/", "0", ":", "no", "display", "/", "/", "1", ":", "errors", "/", "/", "2", ":", "+", "result", "+", "interaction", "+", "warnings", ";", "/", "/", "3", ":", "+", "progression", ";", "/", "/", "4", ":", "+", "information", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Exceptions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DEBUG", "0", "#", "define", "DEBUGOUTPUT", "(", "..", ".)", "if", "(", "DEBUG", ")", "DISPLAY", "(", "__VA_ARGS__", ")", ";", "#", "define", "EXM_THROW", "(", "error", ",", ".", "..", ")", "\\", "{", "\\", "DEBUGOUTPUT", "(", "\"", "Error", "defined", "at", "%", "s", ",", "line", "%", "i", ":", "\\", "n", "\"", ",", "__FILE__", ",", "__LINE__", ")", ";", "\\", "DISPLAYLEVEL", "(", "1", ",", "\"", "Error", "%", "i", ":", "\"", ",", "error", ")", ";", "\\", "DISPLAYLEVEL", "(", "1", ",", "__VA_ARGS__", ")", ";", "\\", "DISPLAYLEVEL", "(", "1", ",", "\"", "\\", "n", "\"", ");", "\\", "exit", "(", "error", ")", ";", "\\", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Version", "modifiers", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "EXTENDED_ARGUMENTS", "#", "define", "EXTENDED_HELP", "#", "define", "EXTENDED_FORMAT", "#", "define", "DEFAULT_COMPRESSOR", "LZ4IO_compressFilename", "#", "define", "DEFAULT_DECOMPRESSOR", "LZ4IO_decompressFilename", "int", "LZ4IO_compressFilename_Legacy", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "int", "compressionlevel", ")", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "int", "usage", "(", ")", "{", "DISPLAY", "(", "\"", "Usage", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "[", "arg", "]", "[", "input", "]", "[", "output", "]", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "input", ":", "a", "filename", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "with", "no", "FILE", ",", "or", "when", "FILE", "is", "-", "or", "%", "s", ",", "read", "standard", "input", "\\", "n", "\"", ",", "stdinmark", ")", ";", "DISPLAY", "(", "\"", "Arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "1", ":", "Fast", "compression", "(", "default", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "9", ":", "High", "compression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "d", ":", "decompression", "(", "default", "for", "%", "s", "extension", ")", "\\", "n", "\"", ",", "LZ4_EXTENSION", ")", ";", "DISPLAY", "(", "\"", "-", "z", ":", "force", "compression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "f", ":", "overwrite", "output", "without", "prompting", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "h", "/", "-", "H", ":", "display", "help", "/", "long", "help", "and", "exit", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "usage_advanced", "(", ")", "{", "DISPLAY", "(", "WELCOME_MESSAGE", ")", ";", "usage", "(", ");", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Advanced", "arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "V", ":", "display", "Version", "number", "and", "exit", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "v", ":", "verbose", "mode", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "q", ":", "suppress", "warnings", ";", "specify", "twice", "to", "suppress", "errors", "too", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c", ":", "force", "write", "to", "standard", "output", ",", "even", "if", "it", "is", "the", "console", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "t", ":", "test", "compressed", "file", "integrity", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "l", ":", "compress", "using", "Legacy", "format", "(", "Linux", "kernel", "compression", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "B", "#", ":", "Block", "size", "[", "4", "-", "7", "]", "(", "default", ":", "7", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "BD", ":", "Block", "dependency", "(", "improve", "compression", "ratio", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "BX", ":", "enable", "block", "checksum", "(", "default", ":", "disabled", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "Sx", ":", "disable", "stream", "checksum", "(", "default", ":", "enabled", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Benchmark", "arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "b", ":", "benchmark", "file", "(", "s", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "i", "#", ":", "iteration", "loops", "[", "1", "-", "9", "]", "(", "default", ":", "3", ")", ",", "benchmark", "mode", "only", "\\", "n", "\"", ");", "#", "if", "!", "defined", "(", "DISABLE_LZ4C_LEGACY_OPTIONS", ")", "DISPLAY", "(", "\"", "Legacy", "arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c0", ":", "fast", "compression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c1", ":", "high", "compression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "hc", ":", "high", "compression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "y", ":", "overwrite", "output", "without", "prompting", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "s", ":", "suppress", "warnings", "\\", "n", "\"", ");", "#", "endif", "/", "/", "DISABLE_LZ4C_LEGACY_OPTIONS", "EXTENDED_HELP", ";", "return", "0", ";", "}", "int", "usage_longhelp", "(", ")", "{", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Which", "values", "can", "get", "[", "output", "]", "?", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "[", "output", "]", ":", "a", "filename", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "'", "%", "s", "'", ",", "or", "'", "-'", "for", "standard", "output", "(", "pipe", "mode", ")", "\\", "n", "\"", ",", "stdoutmark", ")", ";", "DISPLAY", "(", "\"", "'", "%", "s", "'", "to", "discard", "output", "(", "test", "mode", ")", "\\", "n", "\"", ",", "NULL_OUTPUT", ")", ";", "DISPLAY", "(", "\"", "[", "output", "]", "can", "be", "left", "empty", ".", "In", "this", "case", ",", "it", "receives", "the", "following", "value", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "if", "stdout", "is", "not", "the", "console", ",", "then", "[", "output", "]", "=", "stdout", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "if", "stdout", "is", "console", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "+", "if", "compression", "selected", ",", "output", "to", "filename", "%", "s", "\\", "n", "\"", ",", "LZ4_EXTENSION", ")", ";", "DISPLAY", "(", "\"", "+", "if", "decompression", "selected", ",", "output", "to", "filename", "without", "'", "%", "s", "'", "\\", "n", "\"", ",", "LZ4_EXTENSION", ")", ";", "DISPLAY", "(", "\"", ">", "if", "input", "filename", "has", "no", "'", "%", "s", "'", "extension", ":", "error", "\\", "n", "\"", ",", "LZ4_EXTENSION", ")", ";", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Compression", "levels", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "There", "are", "technically", "2", "accessible", "compression", "levels", ".", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "0", ".", "..", "-", "2", "=", ">", "Fast", "compression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "3", ".", "..", "-", "9", "=", ">", "High", "compression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "stdin", ",", "stdout", "and", "the", "console", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "To", "protect", "the", "console", "from", "binary", "flooding", "(", "bad", "argument", "mistake", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "will", "refuse", "to", "read", "from", "console", ",", "or", "write", "to", "console", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "except", "if", "'", "-", "c", "'", "command", "is", "specified", ",", "to", "force", "output", "to", "console", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Simple", "example", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "1", ":", "compress", "'", "filename", "'", "fast", ",", "using", "default", "output", "name", "'", "filename", ".", "lz4", "'", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "filename", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Arguments", "can", "be", "appended", "together", ",", "or", "provided", "independently", ".", "For", "example", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "2", ":", "compress", "'", "filename", "'", "in", "high", "compression", "mode", ",", "overwrite", "output", "if", "exists", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "-", "f9", "filename", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "is", "equivalent", "to", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "-", "f", "-", "9", "filename", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "can", "be", "used", "in", "'", "pure", "pipe", "mode", "'", ",", "for", "example", ":", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "3", ":", "compress", "data", "stream", "from", "'", "generator", "'", ",", "send", "result", "to", "'", "consumer", "'", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "generator", "|", "%", "s", "|", "consumer", "\\", "n", "\"", ",", "programName", ")", ";", "#", "if", "!", "defined", "(", "DISABLE_LZ4C_LEGACY_OPTIONS", ")", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Warning", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Legacy", "arguments", "take", "precedence", ".", "Therefore", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "-", "hc", "filename", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "means", "'", "compress", "filename", "in", "high", "compression", "mode", "'", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "It", "is", "not", "equivalent", "to", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "-", "h", "-", "c", "filename", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "which", "would", "display", "help", "text", "and", "exit", "\\", "n", "\"", ");", "#", "endif", "/", "/", "DISABLE_LZ4C_LEGACY_OPTIONS", "return", "0", ";", "}", "int", "badusage", "(", ")", "{", "DISPLAYLEVEL", "(", "1", ",", "\"", "Incorrect", "parameters", "\\", "n", "\"", ");", "if", "(", "displayLevel", ">", "=", "1", ")", "usage", "(", ");", "exit", "(", "1", ")", ";", "}", "void", "waitEnter", "(", ")", "{", "DISPLAY", "(", "\"", "Press", "enter", "to", "continue", ".", "..", "\\", "n", "\"", ");", "getchar", "(", ");", "}", "int", "main", "(", "int", "argc", ",", "char", "*", "*", "argv", ")", "{", "int", "i", ",", "cLevel", "=", "0", ",", "decode", "=", "0", ",", "bench", "=", "0", ",", "filenamesStart", "=", "2", ",", "legacy_format", "=", "0", ",", "forceStdout", "=", "0", ",", "forceCompress", "=", "0", ",", "pause", "=", "0", ";", "char", "*", "input_filename", "=", "0", ";", "char", "*", "output_filename", "=", "0", ";", "char", "*", "dynNameSpace", "=", "0", ";", "char", "nullOutput", "[", "]", "=", "NULL_OUTPUT", ";", "char", "extension", "[", "]", "=", "LZ4_EXTENSION", ";", "int", "blockSize", ";", "/", "/", "Init", "programName", "=", "argv", "[", "0", "]", ";", "LZ4IO_setOverwrite", "(", "0", ")", ";", "blockSize", "=", "LZ4IO_setBlockSizeID", "(", "LZ4_BLOCKSIZEID_DEFAULT", ")", ";", "/", "/", "lz4cat", "behavior", "if", "(", "!", "strcmp", "(", "programName", ",", "LZ4_CAT", ")", ")", "{", "decode", "=", "1", ";", "forceStdout", "=", "1", ";", "output_filename", "=", "stdoutmark", ";", "displayLevel", "=", "1", ";", "}", "/", "/", "command", "switches", "for", "(", "i", "=", "1", ";", "i", "<", "argc", ";", "i", "+", "+)", "{", "char", "*", "argument", "=", "argv", "[", "i", "]", ";", "if", "(", "!", "argument", ")", "continue", ";", "/", "/", "Protection", "if", "argument", "empty", "/", "/", "Decode", "command", "(", "note", ":", "aggregated", "commands", "are", "allowed", ")", "if", "(", "argument", "[", "0", "]", "==", "'-", "')", "{", "/", "/", "'", "-'", "means", "stdin", "/", "stdout", "if", "(", "argument", "[", "1", "]", "==", "0", ")", "{", "if", "(", "!", "input_filename", ")", "input_filename", "=", "stdinmark", ";", "else", "output_filename", "=", "stdoutmark", ";", "}", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "{", "argument", "+", "+;", "#", "if", "!", "defined", "(", "DISABLE_LZ4C_LEGACY_OPTIONS", ")", "/", "/", "Legacy", "options", "(", "-", "c0", ",", "-", "c1", ",", "-", "hc", ",", "-", "y", ",", "-", "s", ")", "if", "(", "(", "argument", "[", "0", "]", "==", "'", "c", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "==", "'", "0", "'", "))", "{", "cLevel", "=", "0", ";", "argument", "+", "+;", "continue", ";", "}", "/", "/", "-", "c0", "(", "fast", "compression", ")", "if", "(", "(", "argument", "[", "0", "]", "==", "'", "c", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "==", "'", "1", "'", "))", "{", "cLevel", "=", "9", ";", "argument", "+", "+;", "continue", ";", "}", "/", "/", "-", "c1", "(", "high", "compression", ")", "if", "(", "(", "argument", "[", "0", "]", "==", "'", "h", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "==", "'", "c", "'", "))", "{", "cLevel", "=", "9", ";", "argument", "+", "+;", "continue", ";", "}", "/", "/", "-", "hc", "(", "high", "compression", ")", "if", "(", "*", "argument", "=", "='", "y", "'", ")", "{", "LZ4IO_setOverwrite", "(", "1", ")", ";", "continue", ";", "}", "/", "/", "-", "y", "(", "answer", "'", "yes", "'", "to", "overwrite", "permission", ")", "if", "(", "*", "argument", "=", "='", "s", "'", ")", "{", "displayLevel", "=", "1", ";", "continue", ";", "}", "/", "/", "-", "s", "(", "silent", "mode", ")", "#", "endif", "/", "/", "DISABLE_LZ4C_LEGACY_OPTIONS", "if", "(", "(*", "argument", ">", "='", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "='", "9", "'", "))", "{", "cLevel", "=", "0", ";", "while", "(", "(*", "argument", ">", "=", "'", "0", "'", ")", "&", "&", "(", "*", "argument", "<", "=", "'", "9", "'", "))", "{", "cLevel", "*", "=", "10", ";", "cLevel", "+", "=", "*", "argument", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "argument", "-", "-;", "continue", ";", "}", "switch", "(", "argument", "[", "0", "]", ")", "{", "/", "/", "Display", "help", "case", "'", "V", "'", ":", "DISPLAY", "(", "WELCOME_MESSAGE", ")", ";", "return", "0", ";", "/", "/", "Version", "case", "'", "h", "'", ":", "usage_advanced", "(", ");", "return", "0", ";", "case", "'", "H", "'", ":", "usage_advanced", "(", ");", "usage_longhelp", "(", ");", "return", "0", ";", "/", "/", "Compression", "(", "default", ")", "case", "'", "z", "'", ":", "forceCompress", "=", "1", ";", "break", ";", "/", "/", "Use", "Legacy", "format", "(", "for", "Linux", "kernel", "compression", ")", "case", "'", "l", "'", ":", "legacy_format", "=", "1", ";", "break", ";", "/", "/", "Decoding", "case", "'", "d", "'", ":", "decode", "=", "1", ";", "break", ";", "/", "/", "Force", "stdout", ",", "even", "if", "stdout", "=", "=", "console", "case", "'", "c", "'", ":", "forceStdout", "=", "1", ";", "output_filename", "=", "stdoutmark", ";", "displayLevel", "=", "1", ";", "break", ";", "/", "/", "Test", "case", "'", "t", "'", ":", "decode", "=", "1", ";", "output_filename", "=", "nulmark", ";", "break", ";", "/", "/", "Overwrite", "case", "'", "f", "'", ":", "LZ4IO_setOverwrite", "(", "1", ")", ";", "break", ";", "/", "/", "Verbose", "mode", "case", "'", "v", "'", ":", "displayLevel", "=", "4", ";", "break", ";", "/", "/", "Quiet", "mode", "case", "'", "q", "'", ":", "displayLevel", "-", "-;", "break", ";", "/", "/", "keep", "source", "file", "(", "default", "anyway", ",", "so", "useless", ")", "(", "for", "xz", "/", "lzma", "compatibility", ")", "case", "'", "k", "'", ":", "break", ";", "/", "/", "Modify", "Block", "Properties", "case", "'", "B", "'", ":", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "{", "int", "exitBlockProperties", "=", "0", ";", "switch", "(", "argument", "[", "1", "]", ")", "{", "case", "'", "4", "'", ":", "case", "'", "5", "'", ":", "case", "'", "6", "'", ":", "case", "'", "7", "'", ":", "{", "int", "B", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "blockSize", "=", "LZ4IO_setBlockSizeID", "(", "B", ")", ";", "BMK_SetBlocksize", "(", "blockSize", ")", ";", "argument", "+", "+;", "break", ";", "}", "case", "'", "D", "'", ":", "LZ4IO_setBlockMode", "(", "chainedBlocks", ")", ";", "argument", "+", "+;", "break", ";", "case", "'", "X", "'", ":", "LZ4IO_setBlockChecksumMode", "(", "1", ")", ";", "argument", "+", "+;", "break", ";", "default", ":", "exitBlockProperties", "=", "1", ";", "}", "if", "(", "exitBlockProperties", ")", "break", ";", "}", "break", ";", "/", "/", "Modify", "Stream", "properties", "case", "'", "S", "'", ":", "if", "(", "argument", "[", "1", "]", "==", "'", "x", "'", ")", "{", "LZ4IO_setStreamChecksumMode", "(", "0", ")", ";", "argument", "+", "+;", "break", ";", "}", "else", "{", "badusage", "(", ");", "}", "/", "/", "Benchmark", "case", "'", "b", "'", ":", "bench", "=", "1", ";", "break", ";", "/", "/", "Modify", "Nb", "Iterations", "(", "benchmark", "only", ")", "case", "'", "i", "'", ":", "if", "(", "(", "argument", "[", "1", "]", ">", "='", "1", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "<", "='", "9", "'", "))", "{", "int", "iters", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "BMK_SetNbIterations", "(", "iters", ")", ";", "argument", "+", "+;", "}", "break", ";", "/", "/", "Pause", "at", "the", "end", "(", "hidden", "option", ")", "case", "'", "p", "'", ":", "pause", "=", "1", ";", "BMK_SetPause", "(", ");", "break", ";", "EXTENDED_ARGUMENTS", ";", "/", "/", "Unrecognised", "command", "default", ":", "badusage", "(", ");", "}", "}", "continue", ";", "}", "/", "/", "first", "provided", "filename", "is", "input", "if", "(", "!", "input_filename", ")", "{", "input_filename", "=", "argument", ";", "filenamesStart", "=", "i", ";", "continue", ";", "}", "/", "/", "second", "provided", "filename", "is", "output", "if", "(", "!", "output_filename", ")", "{", "output_filename", "=", "argument", ";", "if", "(", "!", "strcmp", "(", "output_filename", ",", "nullOutput", ")", ")", "output_filename", "=", "nulmark", ";", "continue", ";", "}", "}", "DISPLAYLEVEL", "(", "3", ",", "WELCOME_MESSAGE", ")", ";", "DISPLAYLEVEL", "(", "4", ",", "\"", "Blocks", "size", ":", "%", "i", "KB", "\\", "n", "\"", ",", "blockSize", ">", ">", "10", ")", ";", "/", "/", "No", "input", "filename", "=", "=>", "use", "stdin", "if", "(", "!", "input_filename", ")", "{", "input_filename", "=", "stdinmark", ";", "}", "/", "/", "Check", "if", "input", "or", "output", "are", "defined", "as", "console", ";", "trigger", "an", "error", "in", "this", "case", "if", "(", "!", "strcmp", "(", "input_filename", ",", "stdinmark", ")", "&", "&", "IS_CONSOLE", "(", "stdin", ")", ")", "badusage", "(", ");", "/", "/", "Check", "if", "benchmark", "is", "selected", "if", "(", "bench", ")", "return", "BMK_benchFile", "(", "argv", "+", "filenamesStart", ",", "argc", "-", "filenamesStart", ",", "cLevel", ")", ";", "/", "/", "No", "output", "filename", "=", "=>", "try", "to", "select", "one", "automatically", "(", "when", "possible", ")", "while", "(", "!", "output_filename", ")", "{", "if", "(", "!", "IS_CONSOLE", "(", "stdout", ")", ")", "{", "output_filename", "=", "stdoutmark", ";", "break", ";", "}", "/", "/", "Default", "to", "stdout", "whenever", "possible", "(", "i", ".", "e", ".", "not", "a", "console", ")", "if", "(", "(!", "decode", ")", "&", "&", "!", "(", "forceCompress", ")", ")", "/", "/", "auto", "-", "determine", "compression", "or", "decompression", ",", "based", "on", "file", "extension", "{", "size_t", "l", "=", "strlen", "(", "input_filename", ")", ";", "if", "(", "!", "strcmp", "(", "input_filename", "+", "(", "l", "-", "4", ")", ",", "LZ4_EXTENSION", ")", ")", "decode", "=", "1", ";", "}", "if", "(", "!", "decode", ")", "/", "/", "compression", "to", "file", "{", "size_t", "l", "=", "strlen", "(", "input_filename", ")", ";", "dynNameSpace", "=", "(", "char", "*", ")", "calloc", "(", "1", ",", "l", "+", "5", ")", ";", "output_filename", "=", "dynNameSpace", ";", "strcpy", "(", "output_filename", ",", "input_filename", ")", ";", "strcpy", "(", "output_filename", "+", "l", ",", "LZ4_EXTENSION", ")", ";", "DISPLAYLEVEL", "(", "2", ",", "\"", "Compressed", "filename", "will", "be", ":", "%", "s", "\\", "n", "\"", ",", "output_filename", ")", ";", "break", ";", "}", "/", "/", "decompression", "to", "file", "(", "automatic", "name", "will", "work", "only", "if", "input", "filename", "has", "correct", "format", "extension", ")", "{", "size_t", "outl", ";", "size_t", "inl", "=", "strlen", "(", "input_filename", ")", ";", "dynNameSpace", "=", "(", "char", "*", ")", "calloc", "(", "1", ",", "inl", "+", "1", ")", ";", "output_filename", "=", "dynNameSpace", ";", "strcpy", "(", "output_filename", ",", "input_filename", ")", ";", "outl", "=", "inl", ";", "if", "(", "inl", ">", "4", ")", "while", "(", "(", "outl", ">", "=", "inl", "-", "4", ")", "&", "&", "(", "input_filename", "[", "outl", "]", "=", "=", "extension", "[", "outl", "-", "inl", "+", "4", "]", "))", "output_filename", "[", "outl", "-", "-]", "=", "0", ";", "if", "(", "outl", "!", "=", "inl", "-", "5", ")", "{", "DISPLAYLEVEL", "(", "1", ",", "\"", "Cannot", "determine", "an", "output", "filename", "\\", "n", "\"", ");", "badusage", "(", ");", "}", "DISPLAYLEVEL", "(", "2", ",", "\"", "Decoding", "file", "%", "s", "\\", "n", "\"", ",", "output_filename", ")", ";", "}", "}", "/", "/", "No", "warning", "message", "in", "pure", "pipe", "mode", "(", "stdin", "+", "stdout", ")", "if", "(", "!", "strcmp", "(", "input_filename", ",", "stdinmark", ")", "&", "&", "!", "strcmp", "(", "output_filename", ",", "stdoutmark", ")", "&", "&", "(", "displayLevel", "=", "=", "2", ")", ")", "displayLevel", "=", "1", ";", "/", "/", "Check", "if", "input", "or", "output", "are", "defined", "as", "console", ";", "trigger", "an", "error", "in", "this", "case", "if", "(", "!", "strcmp", "(", "input_filename", ",", "stdinmark", ")", "&", "&", "IS_CONSOLE", "(", "stdin", ")", ")", "badusage", "(", ");", "if", "(", "!", "strcmp", "(", "output_filename", ",", "stdoutmark", ")", "&", "&", "IS_CONSOLE", "(", "stdout", ")", "&", "&", "!", "forceStdout", ")", "badusage", "(", ");", "/", "/", "IO", "Stream", "/", "File", "LZ4IO_setNotificationLevel", "(", "displayLevel", ")", ";", "if", "(", "decode", ")", "DEFAULT_DECOMPRESSOR", "(", "input_filename", ",", "output_filename", ")", ";", "else", "/", "/", "compression", "is", "default", "action", "{", "if", "(", "legacy_format", ")", "{", "DISPLAYLEVEL", "(", "3", ",", "\"", "!", "Generating", "compressed", "LZ4", "using", "Legacy", "format", "(", "deprecated", "!", ")", "!", "\\", "n", "\"", ");", "LZ4IO_compressFilename_Legacy", "(", "input_filename", ",", "output_filename", ",", "cLevel", ")", ";", "}", "else", "{", "DEFAULT_COMPRESSOR", "(", "input_filename", ",", "output_filename", ",", "cLevel", ")", ";", "}", "}", "if", "(", "pause", ")", "waitEnter", "(", ");", "free", "(", "dynNameSpace", ")", ";", "return", "0", ";", "}", "@", "@", "-", "1", ",", "1126", "+", "1", ",", "956", "@", "@", "/", "*", "LZ4c", "-", "LZ4", "Compression", "CLI", "program", "Copyright", "(", "C", ")", "Yann", "Collet", "2011", "-", "2013", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "p", "/", "lz4", ".", "html", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "*", "/", "/", "*", "Note", ":", "this", "is", "stand", "-", "alone", "program", ".", "It", "is", "not", "part", "of", "LZ4", "compression", "library", ",", "it", "is", "a", "user", "program", "of", "LZ4", "library", ".", "The", "license", "of", "LZ4", "library", "is", "BSD", ".", "The", "license", "of", "xxHash", "library", "is", "BSD", ".", "The", "license", "of", "this", "compression", "CLI", "program", "is", "GPLv2", ".", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "define", "_CRT_SECURE_NO_WARNINGS", "#", "define", "_CRT_SECURE_NO_DEPRECATE", "/", "/", "VS2005", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "/", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "#", "endif", "/", "/", "Large", "file", "support", "on", "32", "-", "bits", "unix", "#", "define", "_FILE_OFFSET_BITS", "64", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fprintf", ",", "fopen", ",", "fread", ",", "_fileno", "(", "?)", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "malloc", "#", "include", "<", "string", ".", "h", ">", "/", "/", "strcmp", "#", "include", "<", "time", ".", "h", ">", "/", "/", "clock", "#", "ifdef", "_WIN32", "#", "include", "<", "io", ".", "h", ">", "/", "/", "_setmode", "#", "include", "<", "fcntl", ".", "h", ">", "/", "/", "_O_BINARY", "#", "endif", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "include", "\"", "bench", ".", "h", "\"", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "-", "specific", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "GCC_VERSION", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "/", "/", "Visual", "Studio", "#", "define", "swap32", "_byteswap_ulong", "#", "elif", "GCC_VERSION", ">", "=", "403", "#", "define", "swap32", "__builtin_bswap32", "#", "else", "static", "inline", "unsigned", "int", "swap32", "(", "unsigned", "int", "x", ")", "{", "return", "(", "(", "x", "<", "<", "24", ")", "&", "0xff000000", ")", "|", "(", "(", "x", "<", "<", "8", ")", "&", "0x00ff0000", ")", "|", "(", "(", "x", ">", ">", "8", ")", "&", "0x0000ff00", ")", "|", "(", "(", "x", ">", ">", "24", ")", "&", "0x000000ff", ")", ";", "}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "COMPRESSOR_NAME", "\"", "LZ4", "Compression", "CLI", "\"", "#", "define", "COMPRESSOR_VERSION", "\"", "\"", "#", "define", "COMPILED", "__DATE__", "#", "define", "AUTHOR", "\"", "Yann", "Collet", "\"", "#", "define", "EXTENSION", "\"", ".", "lz4", "\"", "#", "define", "WELCOME_MESSAGE", "\"", "**", "*", "%", "s", "%", "s", ",", "by", "%", "s", "(", "%", "s", ")", "*", "**", "\\", "n", "\"", ",", "COMPRESSOR_NAME", ",", "COMPRESSOR_VERSION", ",", "AUTHOR", ",", "COMPILED", "#", "define", "UNLZ4", "\"", "unlz4", "\"", "#", "define", "LZ4CAT", "\"", "lz4cat", "\"", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "#", "define", "_1BIT", "0x01", "#", "define", "_2BITS", "0x03", "#", "define", "_3BITS", "0x07", "#", "define", "_4BITS", "0x0F", "#", "define", "_8BITS", "0xFF", "#", "define", "MAGICNUMBER_SIZE", "4", "#", "define", "LZ4S_MAGICNUMBER", "0x184D2204", "#", "define", "LZ4S_SKIPPABLE0", "0x184D2A50", "#", "define", "LZ4S_SKIPPABLEMASK", "0xFFFFFFF0", "#", "define", "LEGACY_MAGICNUMBER", "0x184C2102", "#", "define", "CACHELINE", "64", "#", "define", "LEGACY_BLOCKSIZE", "(", "8", "MB", ")", "#", "define", "MIN_STREAM_BUFSIZE", "(", "1", "MB", "+", "64", "KB", ")", "#", "define", "LZ4S_BLOCKSIZEID_DEFAULT", "7", "#", "define", "LZ4S_CHECKSUM_SEED", "0", "#", "define", "LZ4S_EOS", "0", "#", "define", "LZ4S_MAXHEADERSIZE", "(", "MAGICNUMBER_SIZE", "+", "2", "+", "8", "+", "4", "+", "1", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Architecture", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "const", "int", "one", "=", "1", ";", "#", "define", "CPU_LITTLE_ENDIAN", "(", "*(", "char", "*", ")(", "&", "one", ")", ")", "#", "define", "CPU_BIG_ENDIAN", "(", "!", "CPU_LITTLE_ENDIAN", ")", "#", "define", "LITTLE_ENDIAN_32", "(", "i", ")", "(", "CPU_LITTLE_ENDIAN", "?", "(", "i", ")", ":", "swap32", "(", "i", ")", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Special", "input", "/", "output", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "NULL_OUTPUT", "\"", "null", "\"", "char", "stdinmark", "[", "]", "=", "\"", "stdin", "\"", ";", "char", "stdoutmark", "[", "]", "=", "\"", "stdout", "\"", ";", "#", "ifdef", "_WIN32", "char", "nulmark", "[", "]", "=", "\"", "nul", "\"", ";", "#", "else", "char", "nulmark", "[", "]", "=", "\"", "/", "dev", "/", "null", "\"", ";", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "Parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "char", "*", "programName", ";", "static", "int", "silence", "=", "0", ";", "static", "int", "verbose", "=", "0", ";", "static", "int", "overwrite", "=", "0", ";", "static", "int", "blockSizeId", "=", "LZ4S_BLOCKSIZEID_DEFAULT", ";", "static", "int", "blockChecksum", "=", "0", ";", "static", "int", "streamChecksum", "=", "1", ";", "static", "int", "blockIndependence", "=", "1", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Exceptions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DEBUG", "0", "#", "define", "DEBUGOUTPUT", "(", "..", ".)", "if", "(", "DEBUG", ")", "DISPLAY", "(", "__VA_ARGS__", ")", ";", "#", "define", "EXM_THROW", "(", "error", ",", ".", "..", ")", "\\", "{", "\\", "DEBUGOUTPUT", "(", "\"", "Error", "defined", "at", "%", "s", ",", "line", "%", "i", ":", "\\", "n", "\"", ",", "__FILE__", ",", "__LINE__", ")", ";", "\\", "DISPLAY", "(", "\"", "Error", "%", "i", ":", "\"", ",", "error", ")", ";", "\\", "DISPLAY", "(", "__VA_ARGS__", ")", ";", "\\", "DISPLAY", "(", "\"\\", "n", "\"", ");", "\\", "exit", "(", "error", ")", ";", "\\", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "int", "usage", "(", ")", "{", "DISPLAY", "(", "\"", "Usage", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "[", "arg", "]", "[", "input", "]", "[", "output", "]", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "input", ":", "a", "filename", ",", "or", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "'", "%", "s", "'", "or", "'", "-'", "for", "pipe", "mode", "(", "default", "if", "empty", ")", "\\", "n", "\"", ",", "stdinmark", ")", ";", "DISPLAY", "(", "\"", "Arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c0", "/", "-", "c", ":", "Fast", "compression", "(", "default", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "c1", "/", "-", "hc", ":", "High", "compression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "d", ":", "decompression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "y", ":", "overwrite", "without", "prompting", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "h", "/", "-", "H", ":", "Help", "(", "this", "text", "+", "advanced", "options", ")", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "usage_advanced", "(", ")", "{", "usage", "(", ");", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Advanced", "options", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "v", ":", "be", "verbose", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "t", ":", "test", "compressed", "file", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "B", "#", ":", "Block", "size", "[", "4", "-", "7", "]", "(", "default", ":", "7", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "BD", ":", "Block", "dependency", "(", "improve", "compression", "ratio", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "BX", ":", "enable", "block", "checksum", "(", "default", ":", "disabled", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "Sx", ":", "disable", "stream", "checksum", "(", "default", ":", "enabled", ")", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "b", "#", ":", "benchmark", "files", ",", "using", "#", "[", "0", "-", "1", "]", "compression", "level", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "i", "#", ":", "iteration", "loops", "[", "1", "-", "9", "]", "(", "default", ":", "3", ")", ",", "benchmark", "mode", "only", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "output", ":", "a", "filename", ",", "or", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "'", "%", "s", "'", ",", "or", "'", "-'", "for", "pipe", "mode", "\\", "n", "\"", ",", "stdoutmark", ")", ";", "DISPLAY", "(", "\"", "or", "'", "%", "s", "'", "\\", "n", "\"", ",", "NULL_OUTPUT", ")", ";", "DISPLAY", "(", "\"", "default", "if", "empty", ":", "stdout", "if", "input", "is", "stdin", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "input", ".", "lz4", "if", "compression", "selected", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "input", "without", "'", ".", "lz4", "'", "if", "decompression", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "Examples", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "1", ":", "compress", "file", "'", "filename", "'", ",", "using", "default", "output", "name", "'", "filename", ".", "lz4", "'", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "filename", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "2", ":", "compress", "'", "filename", "'", "in", "high", "compression", "mode", ",", "overwrite", "output", "if", "exists", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "-", "hcy", "filename", "\\", "n", "\"", ",", "programName", ")", ";", "DISPLAY", "(", "\"", "3", ":", "compress", "data", "stream", "from", "'", "generator", "'", ",", "send", "result", "to", "'", "consumer", "'", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "generator", "|", "%", "s", "|", "consumer", "\\", "n", "\"", ",", "programName", ")", ";", "return", "0", ";", "}", "int", "badusage", "(", ")", "{", "DISPLAY", "(", "\"", "Wrong", "parameters", "\\", "n", "\"", ");", "usage", "(", ");", "exit", "(", "1", ")", ";", "}", "static", "int", "LZ4S_GetBlockSize_FromBlockId", "(", "int", "id", ")", "{", "return", "(", "1", "<", "<", "(", "8", "+", "(", "2", "*", "id", ")", "))", ";", "}", "static", "unsigned", "int", "LZ4S_GetCheckBits_FromXXH", "(", "unsigned", "int", "xxh", ")", "{", "return", "(", "xxh", ">", ">", "8", ")", "&", "_8BITS", ";", "}", "static", "int", "LZ4S_isSkippableMagicNumber", "(", "unsigned", "int", "magic", ")", "{", "return", "(", "magic", "&", "LZ4S_SKIPPABLEMASK", ")", "=", "=", "LZ4S_SKIPPABLE0", ";", "}", "int", "get_fileHandle", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "FILE", "*", "*", "pfinput", ",", "FILE", "*", "*", "pfoutput", ")", "{", "if", "(", "!", "strcmp", "(", "input_filename", ",", "stdinmark", ")", ")", "{", "if", "(", "verbose", ")", "DISPLAY", "(", "\"", "Using", "stdin", "for", "input", "\\", "n", "\"", ");", "*", "pfinput", "=", "stdin", ";", "#", "ifdef", "_WIN32", "/", "/", "Need", "to", "set", "stdin", "/", "stdout", "to", "binary", "mode", "specifically", "for", "windows", "_setmode", "(", "_fileno", "(", "stdin", ")", ",", "_O_BINARY", ")", ";", "#", "endif", "}", "else", "{", "*", "pfinput", "=", "fopen", "(", "input_filename", ",", "\"", "rb", "\"", ");", "}", "if", "(", "!", "strcmp", "(", "output_filename", ",", "stdoutmark", ")", ")", "{", "if", "(", "verbose", ")", "DISPLAY", "(", "\"", "Using", "stdout", "for", "output", "\\", "n", "\"", ");", "*", "pfoutput", "=", "stdout", ";", "#", "ifdef", "_WIN32", "/", "/", "Need", "to", "set", "stdin", "/", "stdout", "to", "binary", "mode", "specifically", "for", "windows", "_setmode", "(", "_fileno", "(", "stdout", ")", ",", "_O_BINARY", ")", ";", "#", "endif", "}", "else", "{", "/", "/", "Check", "if", "destination", "file", "already", "exists", "*", "pfoutput", "=", "0", ";", "if", "(", "output_filename", "!", "=", "nulmark", ")", "*", "pfoutput", "=", "fopen", "(", "output_filename", ",", "\"", "rb", "\"", ")", ";", "if", "(", "*", "pfoutput", "!", "=", "0", ")", "{", "fclose", "(", "*", "pfoutput", ")", ";", "if", "(", "!", "overwrite", ")", "{", "char", "ch", ";", "DISPLAY", "(", "\"", "Warning", ":", "%", "s", "already", "exists", "\\", "n", "\"", ",", "output_filename", ")", ";", "DISPLAY", "(", "\"", "Overwrite", "?", "(", "Y", "/", "N", ")", ":", "\"", ");", "ch", "=", "(", "char", ")", "getchar", "(", ");", "if", "(", "(", "ch", "!", "='", "Y", "'", ")", "&", "&", "(", "ch", "!", "='", "y", "'", "))", "EXM_THROW", "(", "11", ",", "\"", "Operation", "aborted", ":", "%", "s", "already", "exists", "\"", ",", "output_filename", ")", ";", "}", "}", "*", "pfoutput", "=", "fopen", "(", "output_filename", ",", "\"", "wb", "\"", ")", ";", "}", "if", "(", "*", "pfinput", "=", "=", "0", ")", "EXM_THROW", "(", "12", ",", "\"", "Pb", "opening", "%", "s", "\"", ",", "input_filename", ")", ";", "if", "(", "*", "pfoutput", "=", "=", "0", ")", "EXM_THROW", "(", "13", ",", "\"", "Pb", "opening", "%", "s", "\"", ",", "output_filename", ")", ";", "return", "0", ";", "}", "int", "legacy_compress_file", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "int", "compressionlevel", ")", "{", "int", "(", "*", "compressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ")", ";", "unsigned", "long", "long", "filesize", "=", "0", ";", "unsigned", "long", "long", "compressedfilesize", "=", "MAGICNUMBER_SIZE", ";", "char", "*", "in_buff", ";", "char", "*", "out_buff", ";", "FILE", "*", "finput", ";", "FILE", "*", "foutput", ";", "int", "displayLevel", "=", "(", "compressionlevel", ">", "0", ")", ";", "clock_t", "start", ",", "end", ";", "size_t", "sizeCheck", ";", "/", "/", "Init", "switch", "(", "compressionlevel", ")", "{", "case", "0", ":", "compressionFunction", "=", "LZ4_compress", ";", "break", ";", "case", "1", ":", "compressionFunction", "=", "LZ4_compressHC", ";", "break", ";", "default", ":", "compressionFunction", "=", "LZ4_compress", ";", "}", "start", "=", "clock", "(", ");", "get_fileHandle", "(", "input_filename", ",", "output_filename", ",", "&", "finput", ",", "&", "foutput", ")", ";", "/", "/", "Allocate", "Memory", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "LEGACY_BLOCKSIZE", ")", ";", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "LZ4_compressBound", "(", "LEGACY_BLOCKSIZE", ")", ");", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", ")", "EXM_THROW", "(", "21", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "/", "/", "Write", "Archive", "Header", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "LEGACY_MAGICNUMBER", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "MAGICNUMBER_SIZE", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "MAGICNUMBER_SIZE", ")", "EXM_THROW", "(", "22", ",", "\"", "Write", "error", ":", "cannot", "write", "header", "\"", ");", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "unsigned", "int", "outSize", ";", "/", "/", "Read", "Block", "int", "inSize", "=", "(", "int", ")", "fread", "(", "in_buff", ",", "(", "size_t", ")", "1", ",", "(", "size_t", ")", "LEGACY_BLOCKSIZE", ",", "finput", ")", ";", "if", "(", "inSize", "<", "=", "0", ")", "break", ";", "filesize", "+", "=", "inSize", ";", "if", "(", "displayLevel", ")", "DISPLAY", "(", "\"", "Read", ":", "%", "i", "MB", "\\", "r", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ");", "/", "/", "Compress", "Block", "outSize", "=", "compressionFunction", "(", "in_buff", ",", "out_buff", "+", "4", ",", "inSize", ")", ";", "compressedfilesize", "+", "=", "outSize", "+", "4", ";", "if", "(", "displayLevel", ")", "DISPLAY", "(", "\"", "Read", ":", "%", "i", "MB", "=", "=>", "%", ".", "2f", "%", "%\\", "r", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "/", "/", "Write", "Block", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "outSize", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "outSize", "+", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "outSize", "+", "4", ")", ")", "EXM_THROW", "(", "23", ",", "\"", "Write", "error", ":", "cannot", "write", "compressed", "block", "\"", ");", "}", "/", "/", "Status", "end", "=", "clock", "(", ");", "if", "(", "!", "silence", ")", "DISPLAY", "(", "\"", "Compressed", "%", "llu", "bytes", "into", "%", "llu", "bytes", "=", "=>", "%", ".", "2f", "%", "%\\", "n", "\"", ",", "(", "unsigned", "long", "long", ")", "filesize", ",", "(", "unsigned", "long", "long", ")", "compressedfilesize", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "{", "double", "seconds", "=", "(", "double", ")", "(", "end", "-", "start", ")", "/", "CLOCKS_PER_SEC", ";", "if", "(", "verbose", ")", "DISPLAY", "(", "\"", "Done", "in", "%", ".", "2f", "s", "=", "=>", "%", ".", "2f", "MB", "/", "s", "\\", "n", "\"", ",", "seconds", ",", "(", "double", ")", "filesize", "/", "seconds", "/", "1024", "/", "1024", ")", ";", "}", "/", "/", "Close", "&", "Free", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "fclose", "(", "finput", ")", ";", "fclose", "(", "foutput", ")", ";", "return", "0", ";", "}", "int", "compress_file_blockDependency", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "int", "compressionlevel", ")", "{", "void", "*", "(", "*", "initFunction", ")", "(", "const", "char", "*", ");", "int", "(", "*", "compressionFunction", ")", "(", "void", "*", ",", "const", "char", "*", ",", "char", "*", ",", "int", ",", "int", ")", ";", "char", "*", "(", "*", "translateFunction", ")", "(", "void", "*", ");", "int", "(", "*", "freeFunction", ")", "(", "void", "*", ");", "void", "*", "ctx", ";", "unsigned", "long", "long", "filesize", "=", "0", ";", "unsigned", "long", "long", "compressedfilesize", "=", "0", ";", "unsigned", "int", "checkbits", ";", "char", "*", "in_buff", ",", "*", "in_start", ",", "*", "in_end", ";", "char", "*", "out_buff", ";", "FILE", "*", "finput", ";", "FILE", "*", "foutput", ";", "int", "displayLevel", "=", "(", "(", "compressionlevel", ">", "0", ")", "&", "&", "(", "!", "silence", ")", ")", "|", "|", "(", "verbose", ")", ";", "clock_t", "start", ",", "end", ";", "unsigned", "int", "blockSize", ",", "inputBufferSize", ";", "size_t", "sizeCheck", ",", "header_size", ";", "void", "*", "streamChecksumState", "=", "NULL", ";", "/", "/", "Init", "start", "=", "clock", "(", ");", "switch", "(", "compressionlevel", ")", "{", "case", "0", ":", "initFunction", "=", "LZ4_create", ";", "compressionFunction", "=", "LZ4_compress_limitedOutput_continue", ";", "translateFunction", "=", "LZ4_slideInputBuffer", ";", "freeFunction", "=", "LZ4_free", ";", "break", ";", "case", "1", ":", "default", ":", "initFunction", "=", "LZ4_createHC", ";", "compressionFunction", "=", "LZ4_compressHC_limitedOutput_continue", ";", "translateFunction", "=", "LZ4_slideInputBufferHC", ";", "freeFunction", "=", "LZ4_freeHC", ";", "}", "get_fileHandle", "(", "input_filename", ",", "output_filename", ",", "&", "finput", ",", "&", "foutput", ")", ";", "blockSize", "=", "LZ4S_GetBlockSize_FromBlockId", "(", "blockSizeId", ")", ";", "/", "/", "Allocate", "Memory", "inputBufferSize", "=", "blockSize", "+", "64", "KB", ";", "if", "(", "inputBufferSize", "<", "MIN_STREAM_BUFSIZE", ")", "inputBufferSize", "=", "MIN_STREAM_BUFSIZE", ";", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "inputBufferSize", ")", ";", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "blockSize", "+", "CACHELINE", ")", ";", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", ")", "EXM_THROW", "(", "31", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "in_start", "=", "in_buff", ";", "in_end", "=", "in_buff", "+", "inputBufferSize", ";", "if", "(", "streamChecksum", ")", "streamChecksumState", "=", "XXH32_init", "(", "LZ4S_CHECKSUM_SEED", ")", ";", "ctx", "=", "initFunction", "(", "in_buff", ")", ";", "/", "/", "Write", "Archive", "Header", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "LZ4S_MAGICNUMBER", ")", ";", "/", "/", "Magic", "Number", ",", "in", "Little", "Endian", "convention", "*", "(", "out_buff", "+", "4", ")", "=", "(", "1", "&", "_2BITS", ")", "<", "<", "6", ";", "/", "/", "Version", "(", "'", "01", "'", ")", "*", "(", "out_buff", "+", "4", ")", "|", "=", "(", "blockIndependence", "&", "_1BIT", ")", "<", "<", "5", ";", "*", "(", "out_buff", "+", "4", ")", "|", "=", "(", "blockChecksum", "&", "_1BIT", ")", "<", "<", "4", ";", "*", "(", "out_buff", "+", "4", ")", "|", "=", "(", "streamChecksum", "&", "_1BIT", ")", "<", "<", "2", ";", "*", "(", "out_buff", "+", "5", ")", "=", "(", "char", ")", "((", "blockSizeId", "&", "_3BITS", ")", "<", "<", "4", ")", ";", "checkbits", "=", "XXH32", "(", "(", "out_buff", "+", "4", ")", ",", "2", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "checkbits", "=", "LZ4S_GetCheckBits_FromXXH", "(", "checkbits", ")", ";", "*", "(", "out_buff", "+", "6", ")", "=", "(", "unsigned", "char", ")", "checkbits", ";", "header_size", "=", "7", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "header_size", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "header_size", ")", "EXM_THROW", "(", "32", ",", "\"", "Write", "error", ":", "cannot", "write", "header", "\"", ");", "compressedfilesize", "+", "=", "header_size", ";", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "unsigned", "int", "outSize", ";", "unsigned", "int", "inSize", ";", "/", "/", "Read", "Block", "if", "(", "(", "in_start", "+", "blockSize", ")", ">", "in_end", ")", "in_start", "=", "translateFunction", "(", "ctx", ")", ";", "inSize", "=", "(", "unsigned", "int", ")", "fread", "(", "in_start", ",", "(", "size_t", ")", "1", ",", "(", "size_t", ")", "blockSize", ",", "finput", ")", ";", "if", "(", "inSize", "=", "=", "0", ")", "break", ";", "/", "/", "No", "more", "input", ":", "end", "of", "compression", "filesize", "+", "=", "inSize", ";", "if", "(", "displayLevel", ")", "DISPLAY", "(", "\"", "Read", ":", "%", "i", "MB", "\\", "r", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ");", "if", "(", "streamChecksum", ")", "XXH32_update", "(", "streamChecksumState", ",", "in_start", ",", "inSize", ")", ";", "/", "/", "Compress", "Block", "outSize", "=", "compressionFunction", "(", "ctx", ",", "in_start", ",", "out_buff", "+", "4", ",", "inSize", ",", "inSize", "-", "1", ")", ";", "if", "(", "outSize", ">", "0", ")", "compressedfilesize", "+", "=", "outSize", "+", "4", ";", "else", "compressedfilesize", "+", "=", "inSize", "+", "4", ";", "if", "(", "blockChecksum", ")", "compressedfilesize", "+", "=", "4", ";", "if", "(", "displayLevel", ")", "DISPLAY", "(", "\"", "Read", ":", "%", "i", "MB", "=", "=>", "%", ".", "2f", "%", "%\\", "r", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "/", "/", "Write", "Block", "if", "(", "outSize", ">", "0", ")", "{", "int", "sizeToWrite", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "outSize", ")", ";", "if", "(", "blockChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "out_buff", "+", "4", ",", "outSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "*", "(", "unsigned", "int", "*", ")", "(", "out_buff", "+", "4", "+", "outSize", ")", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "}", "sizeToWrite", "=", "4", "+", "outSize", "+", "(", "4", "*", "blockChecksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "sizeToWrite", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "sizeToWrite", ")", ")", "EXM_THROW", "(", "33", ",", "\"", "Write", "error", ":", "cannot", "write", "compressed", "block", "\"", ");", "}", "else", "/", "/", "Copy", "Original", "{", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "inSize", "|", "0x80000000", ")", ";", "/", "/", "Add", "Uncompressed", "flag", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "34", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "header", "\"", ");", "sizeCheck", "=", "fwrite", "(", "in_start", ",", "1", ",", "inSize", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "inSize", ")", ")", "EXM_THROW", "(", "35", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "\"", ");", "if", "(", "blockChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "in_start", ",", "inSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "36", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "checksum", "\"", ");", "}", "}", "in_start", "+", "=", "inSize", ";", "}", "/", "/", "End", "of", "Stream", "mark", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LZ4S_EOS", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "37", ",", "\"", "Write", "error", ":", "cannot", "write", "end", "of", "stream", "\"", ");", "compressedfilesize", "+", "=", "4", ";", "if", "(", "streamChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32_digest", "(", "streamChecksumState", ")", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "37", ",", "\"", "Write", "error", ":", "cannot", "write", "stream", "checksum", "\"", ");", "compressedfilesize", "+", "=", "4", ";", "}", "/", "/", "Status", "end", "=", "clock", "(", ");", "if", "(", "!", "silence", ")", "DISPLAY", "(", "\"", "Compressed", "%", "llu", "bytes", "into", "%", "llu", "bytes", "=", "=>", "%", ".", "2f", "%", "%\\", "n", "\"", ",", "(", "unsigned", "long", "long", ")", "filesize", ",", "(", "unsigned", "long", "long", ")", "compressedfilesize", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "{", "double", "seconds", "=", "(", "double", ")", "(", "end", "-", "start", ")", "/", "CLOCKS_PER_SEC", ";", "if", "(", "verbose", ")", "DISPLAY", "(", "\"", "Done", "in", "%", ".", "2f", "s", "=", "=>", "%", ".", "2f", "MB", "/", "s", "\\", "n", "\"", ",", "seconds", ",", "(", "double", ")", "filesize", "/", "seconds", "/", "1024", "/", "1024", ")", ";", "}", "/", "/", "Close", "&", "Free", "freeFunction", "(", "ctx", ")", ";", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "fclose", "(", "finput", ")", ";", "fclose", "(", "foutput", ")", ";", "return", "0", ";", "}", "int", "compress_file", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "int", "compressionlevel", ")", "{", "int", "(", "*", "compressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ",", "int", ")", ";", "unsigned", "long", "long", "filesize", "=", "0", ";", "unsigned", "long", "long", "compressedfilesize", "=", "0", ";", "unsigned", "int", "checkbits", ";", "char", "*", "in_buff", ";", "char", "*", "out_buff", ";", "char", "*", "headerBuffer", ";", "FILE", "*", "finput", ";", "FILE", "*", "foutput", ";", "int", "displayLevel", "=", "(", "(", "compressionlevel", ">", "0", ")", "&", "&", "(", "!", "silence", ")", ")", "|", "|", "(", "verbose", ")", ";", "clock_t", "start", ",", "end", ";", "int", "blockSize", ";", "size_t", "sizeCheck", ",", "header_size", ",", "readSize", ";", "void", "*", "streamChecksumState", "=", "NULL", ";", "/", "/", "Branch", "out", "if", "(", "blockIndependence", "=", "=", "0", ")", "return", "compress_file_blockDependency", "(", "input_filename", ",", "output_filename", ",", "compressionlevel", ")", ";", "/", "/", "Init", "start", "=", "clock", "(", ");", "switch", "(", "compressionlevel", ")", "{", "case", "0", ":", "compressionFunction", "=", "LZ4_compress_limitedOutput", ";", "break", ";", "case", "1", ":", "compressionFunction", "=", "LZ4_compressHC_limitedOutput", ";", "break", ";", "default", ":", "compressionFunction", "=", "LZ4_compress_limitedOutput", ";", "}", "get_fileHandle", "(", "input_filename", ",", "output_filename", ",", "&", "finput", ",", "&", "foutput", ")", ";", "blockSize", "=", "LZ4S_GetBlockSize_FromBlockId", "(", "blockSizeId", ")", ";", "/", "/", "Allocate", "Memory", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "blockSize", ")", ";", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "blockSize", "+", "CACHELINE", ")", ";", "headerBuffer", "=", "(", "char", "*", ")", "malloc", "(", "LZ4S_MAXHEADERSIZE", ")", ";", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", "|", "|", "!", "(", "headerBuffer", ")", ")", "EXM_THROW", "(", "31", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "if", "(", "streamChecksum", ")", "streamChecksumState", "=", "XXH32_init", "(", "LZ4S_CHECKSUM_SEED", ")", ";", "/", "/", "Write", "Archive", "Header", "*", "(", "unsigned", "int", "*", ")", "headerBuffer", "=", "LITTLE_ENDIAN_32", "(", "LZ4S_MAGICNUMBER", ")", ";", "/", "/", "Magic", "Number", ",", "in", "Little", "Endian", "convention", "*", "(", "headerBuffer", "+", "4", ")", "=", "(", "1", "&", "_2BITS", ")", "<", "<", "6", ";", "/", "/", "Version", "(", "'", "01", "'", ")", "*", "(", "headerBuffer", "+", "4", ")", "|", "=", "(", "blockIndependence", "&", "_1BIT", ")", "<", "<", "5", ";", "*", "(", "headerBuffer", "+", "4", ")", "|", "=", "(", "blockChecksum", "&", "_1BIT", ")", "<", "<", "4", ";", "*", "(", "headerBuffer", "+", "4", ")", "|", "=", "(", "streamChecksum", "&", "_1BIT", ")", "<", "<", "2", ";", "*", "(", "headerBuffer", "+", "5", ")", "=", "(", "char", ")", "((", "blockSizeId", "&", "_3BITS", ")", "<", "<", "4", ")", ";", "checkbits", "=", "XXH32", "(", "(", "headerBuffer", "+", "4", ")", ",", "2", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "checkbits", "=", "LZ4S_GetCheckBits_FromXXH", "(", "checkbits", ")", ";", "*", "(", "headerBuffer", "+", "6", ")", "=", "(", "unsigned", "char", ")", "checkbits", ";", "header_size", "=", "7", ";", "/", "/", "Write", "header", "sizeCheck", "=", "fwrite", "(", "headerBuffer", ",", "1", ",", "header_size", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "header_size", ")", "EXM_THROW", "(", "32", ",", "\"", "Write", "error", ":", "cannot", "write", "header", "\"", ");", "compressedfilesize", "+", "=", "header_size", ";", "/", "/", "read", "first", "block", "readSize", "=", "fread", "(", "in_buff", ",", "(", "size_t", ")", "1", ",", "(", "size_t", ")", "blockSize", ",", "finput", ")", ";", "/", "/", "Main", "Loop", "while", "(", "readSize", ">", "0", ")", "{", "unsigned", "int", "outSize", ";", "filesize", "+", "=", "readSize", ";", "if", "(", "displayLevel", ")", "DISPLAY", "(", "\"", "Read", ":", "%", "i", "MB", "\\", "r", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ");", "if", "(", "streamChecksum", ")", "XXH32_update", "(", "streamChecksumState", ",", "in_buff", ",", "(", "int", ")", "readSize", ")", ";", "/", "/", "Compress", "Block", "outSize", "=", "compressionFunction", "(", "in_buff", ",", "out_buff", "+", "4", ",", "(", "int", ")", "readSize", ",", "(", "int", ")", "readSize", "-", "1", ")", ";", "if", "(", "outSize", ">", "0", ")", "compressedfilesize", "+", "=", "outSize", "+", "4", ";", "else", "compressedfilesize", "+", "=", "readSize", "+", "4", ";", "if", "(", "blockChecksum", ")", "compressedfilesize", "+", "=", "4", ";", "if", "(", "displayLevel", ")", "DISPLAY", "(", "\"", "Read", ":", "%", "i", "MB", "=", "=>", "%", ".", "2f", "%", "%\\", "r", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "/", "/", "Write", "Block", "if", "(", "outSize", ">", "0", ")", "{", "int", "sizeToWrite", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "outSize", ")", ";", "if", "(", "blockChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "out_buff", "+", "4", ",", "outSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "*", "(", "unsigned", "int", "*", ")", "(", "out_buff", "+", "4", "+", "outSize", ")", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "}", "sizeToWrite", "=", "4", "+", "outSize", "+", "(", "4", "*", "blockChecksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "sizeToWrite", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "sizeToWrite", ")", ")", "EXM_THROW", "(", "33", ",", "\"", "Write", "error", ":", "cannot", "write", "compressed", "block", "\"", ");", "}", "else", "/", "/", "Copy", "Original", "Uncompressed", "{", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "((", "unsigned", "long", ")", "readSize", ")", "|", "0x80000000", ")", ";", "/", "/", "Add", "Uncompressed", "flag", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "34", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "header", "\"", ");", "sizeCheck", "=", "fwrite", "(", "in_buff", ",", "1", ",", "readSize", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "readSize", ")", "EXM_THROW", "(", "35", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "\"", ");", "if", "(", "blockChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "in_buff", ",", "(", "int", ")", "readSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "36", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "checksum", "\"", ");", "}", "}", "/", "/", "Read", "next", "block", "readSize", "=", "fread", "(", "in_buff", ",", "(", "size_t", ")", "1", ",", "(", "size_t", ")", "blockSize", ",", "finput", ")", ";", "}", "/", "/", "End", "of", "Stream", "mark", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LZ4S_EOS", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "37", ",", "\"", "Write", "error", ":", "cannot", "write", "end", "of", "stream", "\"", ");", "compressedfilesize", "+", "=", "4", ";", "if", "(", "streamChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32_digest", "(", "streamChecksumState", ")", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "37", ",", "\"", "Write", "error", ":", "cannot", "write", "stream", "checksum", "\"", ");", "compressedfilesize", "+", "=", "4", ";", "}", "/", "/", "Close", "&", "Free", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "free", "(", "headerBuffer", ")", ";", "fclose", "(", "finput", ")", ";", "fclose", "(", "foutput", ")", ";", "/", "/", "Final", "Status", "end", "=", "clock", "(", ");", "if", "(", "!", "silence", ")", "DISPLAY", "(", "\"", "Compressed", "%", "llu", "bytes", "into", "%", "llu", "bytes", "=", "=>", "%", ".", "2f", "%", "%\\", "n", "\"", ",", "(", "unsigned", "long", "long", ")", "filesize", ",", "(", "unsigned", "long", "long", ")", "compressedfilesize", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "{", "double", "seconds", "=", "(", "double", ")", "(", "end", "-", "start", ")", "/", "CLOCKS_PER_SEC", ";", "if", "(", "verbose", ")", "DISPLAY", "(", "\"", "Done", "in", "%", ".", "2f", "s", "=", "=>", "%", ".", "2f", "MB", "/", "s", "\\", "n", "\"", ",", "seconds", ",", "(", "double", ")", "filesize", "/", "seconds", "/", "1024", "/", "1024", ")", ";", "}", "return", "0", ";", "}", "unsigned", "long", "long", "decodeLegacyStream", "(", "FILE", "*", "finput", ",", "FILE", "*", "foutput", ")", "{", "unsigned", "long", "long", "filesize", "=", "0", ";", "char", "*", "in_buff", ";", "char", "*", "out_buff", ";", "unsigned", "int", "blockSize", ";", "/", "/", "Allocate", "Memory", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "LZ4_compressBound", "(", "LEGACY_BLOCKSIZE", ")", ");", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "LEGACY_BLOCKSIZE", ")", ";", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", ")", "EXM_THROW", "(", "51", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "size_t", "uselessRet", ";", "int", "sinkint", ";", "size_t", "sizeCheck", ";", "/", "/", "Block", "Size", "uselessRet", "=", "fread", "(", "&", "blockSize", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "uselessRet", "=", "=", "0", ")", "break", ";", "/", "/", "Nothing", "to", "read", ":", "file", "read", "is", "completed", "blockSize", "=", "LITTLE_ENDIAN_32", "(", "blockSize", ")", ";", "/", "/", "Convert", "to", "Little", "Endian", "if", "(", "blockSize", ">", "LZ4_COMPRESSBOUND", "(", "LEGACY_BLOCKSIZE", ")", ")", "{", "/", "/", "Cannot", "read", "next", "block", ":", "maybe", "new", "stream", "?", "fseek", "(", "finput", ",", "-", "4", ",", "SEEK_CUR", ")", ";", "break", ";", "}", "/", "/", "Read", "Block", "uselessRet", "=", "fread", "(", "in_buff", ",", "1", ",", "blockSize", ",", "finput", ")", ";", "/", "/", "Decode", "Block", "sinkint", "=", "LZ4_decompress_safe", "(", "in_buff", ",", "out_buff", ",", "blockSize", ",", "LEGACY_BLOCKSIZE", ")", ";", "if", "(", "sinkint", "<", "0", ")", "EXM_THROW", "(", "52", ",", "\"", "Decoding", "Failed", "!", "Corrupted", "input", "detected", "!", "\")", ";", "filesize", "+", "=", "sinkint", ";", "/", "/", "Write", "Block", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "sinkint", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "(", "size_t", ")", "sinkint", ")", "EXM_THROW", "(", "53", ",", "\"", "Write", "error", ":", "cannot", "write", "decoded", "block", "into", "output", "\\", "n", "\"", ");", "}", "/", "/", "Free", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "return", "filesize", ";", "}", "unsigned", "long", "long", "decodeLZ4S", "(", "FILE", "*", "finput", ",", "FILE", "*", "foutput", ")", "{", "unsigned", "long", "long", "filesize", "=", "0", ";", "char", "*", "in_buff", ";", "char", "*", "out_buff", ",", "*", "out_start", ",", "*", "out_end", ";", "unsigned", "char", "descriptor", "[", "LZ4S_MAXHEADERSIZE", "]", ";", "size_t", "nbReadBytes", ";", "int", "decodedBytes", "=", "0", ";", "unsigned", "int", "maxBlockSize", ";", "size_t", "sizeCheck", ";", "int", "blockChecksumFlag", ",", "streamChecksumFlag", ",", "blockIndependenceFlag", ";", "void", "*", "streamChecksumState", "=", "NULL", ";", "int", "(", "*", "decompressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ",", "int", ")", "=", "LZ4_decompress_safe", ";", "unsigned", "int", "prefix64k", "=", "0", ";", "/", "/", "Decode", "stream", "descriptor", "nbReadBytes", "=", "fread", "(", "descriptor", ",", "1", ",", "3", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "!", "=", "3", ")", "EXM_THROW", "(", "61", ",", "\"", "Unreadable", "header", "\"", ");", "{", "int", "version", "=", "(", "descriptor", "[", "0", "]", ">", ">", "6", ")", "&", "_2BITS", ";", "int", "streamSize", "=", "(", "descriptor", "[", "0", "]", ">", ">", "3", ")", "&", "_1BIT", ";", "int", "reserved1", "=", "(", "descriptor", "[", "0", "]", ">", ">", "1", ")", "&", "_1BIT", ";", "int", "dictionary", "=", "(", "descriptor", "[", "0", "]", ">", ">", "0", ")", "&", "_1BIT", ";", "int", "reserved2", "=", "(", "descriptor", "[", "1", "]", ">", ">", "7", ")", "&", "_1BIT", ";", "int", "blockSizeId", "=", "(", "descriptor", "[", "1", "]", ">", ">", "4", ")", "&", "_3BITS", ";", "int", "reserved3", "=", "(", "descriptor", "[", "1", "]", ">", ">", "0", ")", "&", "_4BITS", ";", "int", "checkBits", "=", "(", "descriptor", "[", "2", "]", ">", ">", "0", ")", "&", "_8BITS", ";", "int", "checkBits_xxh32", ";", "blockIndependenceFlag", "=", "(", "descriptor", "[", "0", "]", ">", ">", "5", ")", "&", "_1BIT", ";", "blockChecksumFlag", "=", "(", "descriptor", "[", "0", "]", ">", ">", "4", ")", "&", "_1BIT", ";", "streamChecksumFlag", "=", "(", "descriptor", "[", "0", "]", ">", ">", "2", ")", "&", "_1BIT", ";", "if", "(", "version", "!", "=", "1", ")", "EXM_THROW", "(", "62", ",", "\"", "Wrong", "version", "number", "\"", ");", "if", "(", "streamSize", "=", "=", "1", ")", "EXM_THROW", "(", "64", ",", "\"", "Does", "not", "support", "stream", "size", "\"", ");", "if", "(", "reserved1", "!", "=", "0", ")", "EXM_THROW", "(", "65", ",", "\"", "Wrong", "value", "for", "reserved", "bits", "\"", ");", "if", "(", "dictionary", "=", "=", "1", ")", "EXM_THROW", "(", "66", ",", "\"", "Does", "not", "support", "dictionary", "\"", ");", "if", "(", "reserved2", "!", "=", "0", ")", "EXM_THROW", "(", "67", ",", "\"", "Wrong", "value", "for", "reserved", "bits", "\"", ");", "if", "(", "blockSizeId", "<", "4", ")", "EXM_THROW", "(", "68", ",", "\"", "Unsupported", "block", "size", "\"", ");", "if", "(", "reserved3", "!", "=", "0", ")", "EXM_THROW", "(", "67", ",", "\"", "Wrong", "value", "for", "reserved", "bits", "\"", ");", "maxBlockSize", "=", "LZ4S_GetBlockSize_FromBlockId", "(", "blockSizeId", ")", ";", "/", "/", "Checkbits", "verification", "descriptor", "[", "1", "]", "&", "=", "0xF0", ";", "checkBits_xxh32", "=", "XXH32", "(", "descriptor", ",", "2", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "checkBits_xxh32", "=", "LZ4S_GetCheckBits_FromXXH", "(", "checkBits_xxh32", ")", ";", "if", "(", "checkBits", "!", "=", "checkBits_xxh32", ")", "EXM_THROW", "(", "69", ",", "\"", "Stream", "descriptor", "error", "detected", "\"", ");", "}", "if", "(", "!", "blockIndependenceFlag", ")", "{", "decompressionFunction", "=", "LZ4_decompress_safe_withPrefix64k", ";", "prefix64k", "=", "64", "KB", ";", "}", "/", "/", "Allocate", "Memory", "{", "unsigned", "int", "outbuffSize", "=", "prefix64k", "+", "maxBlockSize", ";", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "maxBlockSize", ")", ";", "if", "(", "outbuffSize", "<", "MIN_STREAM_BUFSIZE", ")", "outbuffSize", "=", "MIN_STREAM_BUFSIZE", ";", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "outbuffSize", ")", ";", "out_end", "=", "out_buff", "+", "outbuffSize", ";", "out_start", "=", "out_buff", "+", "prefix64k", ";", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", ")", "EXM_THROW", "(", "70", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "}", "if", "(", "streamChecksumFlag", ")", "streamChecksumState", "=", "XXH32_init", "(", "LZ4S_CHECKSUM_SEED", ")", ";", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "unsigned", "int", "blockSize", ",", "uncompressedFlag", ";", "/", "/", "Block", "Size", "nbReadBytes", "=", "fread", "(", "&", "blockSize", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "!", "=", "4", ")", "EXM_THROW", "(", "71", ",", "\"", "Read", "error", ":", "cannot", "read", "next", "block", "size", "\"", ");", "if", "(", "blockSize", "=", "=", "LZ4S_EOS", ")", "break", ";", "/", "/", "End", "of", "Stream", "Mark", ":", "stream", "is", "completed", "blockSize", "=", "LITTLE_ENDIAN_32", "(", "blockSize", ")", ";", "/", "/", "Convert", "to", "little", "endian", "uncompressedFlag", "=", "blockSize", ">", ">", "31", ";", "blockSize", "&", "=", "0x7FFFFFFF", ";", "if", "(", "blockSize", ">", "maxBlockSize", ")", "EXM_THROW", "(", "72", ",", "\"", "Error", ":", "invalid", "block", "size", "\"", ");", "/", "/", "Read", "Block", "nbReadBytes", "=", "fread", "(", "in_buff", ",", "1", ",", "blockSize", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "!", "=", "blockSize", ")", "EXM_THROW", "(", "73", ",", "\"", "Read", "error", ":", "cannot", "read", "data", "block", "\"", ")", ";", "/", "/", "Check", "Block", "if", "(", "blockChecksumFlag", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "in_buff", ",", "blockSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "unsigned", "int", "readChecksum", ";", "sizeCheck", "=", "fread", "(", "&", "readChecksum", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "sizeCheck", "!", "=", "4", ")", "EXM_THROW", "(", "74", ",", "\"", "Read", "error", ":", "cannot", "read", "next", "block", "size", "\"", ");", "readChecksum", "=", "LITTLE_ENDIAN_32", "(", "readChecksum", ")", ";", "/", "/", "Convert", "to", "little", "endian", "if", "(", "checksum", "!", "=", "readChecksum", ")", "EXM_THROW", "(", "75", ",", "\"", "Error", ":", "invalid", "block", "checksum", "detected", "\"", ");", "}", "if", "(", "uncompressedFlag", ")", "{", "/", "/", "Write", "uncompressed", "Block", "sizeCheck", "=", "fwrite", "(", "in_buff", ",", "1", ",", "blockSize", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "(", "size_t", ")", "blockSize", ")", "EXM_THROW", "(", "76", ",", "\"", "Write", "error", ":", "cannot", "write", "data", "block", "\"", ");", "filesize", "+", "=", "blockSize", ";", "if", "(", "streamChecksumFlag", ")", "XXH32_update", "(", "streamChecksumState", ",", "in_buff", ",", "blockSize", ")", ";", "if", "(", "!", "blockIndependenceFlag", ")", "{", "if", "(", "blockSize", ">", "=", "prefix64k", ")", "{", "memcpy", "(", "out_buff", ",", "in_buff", "+", "(", "blockSize", "-", "prefix64k", ")", ",", "prefix64k", ")", ";", "/", "/", "Required", "for", "reference", "for", "next", "blocks", "out_start", "=", "out_buff", "+", "prefix64k", ";", "continue", ";", "}", "else", "{", "memcpy", "(", "out_start", ",", "in_buff", ",", "blockSize", ")", ";", "decodedBytes", "=", "blockSize", ";", "}", "}", "}", "else", "{", "/", "/", "Decode", "Block", "decodedBytes", "=", "decompressionFunction", "(", "in_buff", ",", "out_start", ",", "blockSize", ",", "maxBlockSize", ")", ";", "if", "(", "decodedBytes", "<", "0", ")", "EXM_THROW", "(", "77", ",", "\"", "Decoding", "Failed", "!", "Corrupted", "input", "detected", "!", "\")", ";", "filesize", "+", "=", "decodedBytes", ";", "if", "(", "streamChecksumFlag", ")", "XXH32_update", "(", "streamChecksumState", ",", "out_start", ",", "decodedBytes", ")", ";", "/", "/", "Write", "Block", "sizeCheck", "=", "fwrite", "(", "out_start", ",", "1", ",", "decodedBytes", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "(", "size_t", ")", "decodedBytes", ")", "EXM_THROW", "(", "78", ",", "\"", "Write", "error", ":", "cannot", "write", "decoded", "block", "\\", "n", "\"", ");", "}", "if", "(", "!", "blockIndependenceFlag", ")", "{", "out_start", "+", "=", "decodedBytes", ";", "if", "(", "out_start", "+", "maxBlockSize", ">", "out_end", ")", "{", "memcpy", "(", "out_buff", ",", "out_start", "-", "prefix64k", ",", "prefix64k", ")", ";", "out_start", "=", "out_buff", "+", "prefix64k", ";", "}", "}", "}", "/", "/", "Stream", "Checksum", "if", "(", "streamChecksumFlag", ")", "{", "unsigned", "int", "checksum", "=", "XXH32_digest", "(", "streamChecksumState", ")", ";", "unsigned", "int", "readChecksum", ";", "sizeCheck", "=", "fread", "(", "&", "readChecksum", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "sizeCheck", "!", "=", "4", ")", "EXM_THROW", "(", "74", ",", "\"", "Read", "error", ":", "cannot", "read", "stream", "checksum", "\"", ");", "readChecksum", "=", "LITTLE_ENDIAN_32", "(", "readChecksum", ")", ";", "/", "/", "Convert", "to", "little", "endian", "if", "(", "checksum", "!", "=", "readChecksum", ")", "EXM_THROW", "(", "75", ",", "\"", "Error", ":", "invalid", "stream", "checksum", "detected", "\"", ");", "}", "/", "/", "Free", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "return", "filesize", ";", "}", "unsigned", "long", "long", "selectDecoder", "(", "FILE", "*", "finput", ",", "FILE", "*", "foutput", ")", "{", "unsigned", "int", "magicNumber", ",", "size", ";", "int", "errorNb", ";", "size_t", "nbReadBytes", ";", "/", "/", "Check", "Archive", "Header", "nbReadBytes", "=", "fread", "(", "&", "magicNumber", ",", "1", ",", "MAGICNUMBER_SIZE", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "=", "=", "0", ")", "return", "0", ";", "/", "/", "EOF", "if", "(", "nbReadBytes", "!", "=", "MAGICNUMBER_SIZE", ")", "EXM_THROW", "(", "41", ",", "\"", "Unrecognized", "header", ":", "Magic", "Number", "unreadable", "\"", ");", "magicNumber", "=", "LITTLE_ENDIAN_32", "(", "magicNumber", ")", ";", "/", "/", "Convert", "to", "Little", "Endian", "format", "if", "(", "LZ4S_isSkippableMagicNumber", "(", "magicNumber", ")", ")", "magicNumber", "=", "LZ4S_SKIPPABLE0", ";", "/", "/", "fold", "skippable", "magic", "numbers", "switch", "(", "magicNumber", ")", "{", "case", "LZ4S_MAGICNUMBER", ":", "return", "decodeLZ4S", "(", "finput", ",", "foutput", ")", ";", "case", "LEGACY_MAGICNUMBER", ":", "if", "(", "verbose", ")", "DISPLAY", "(", "\"", "Detected", ":", "Legacy", "format", "\\", "n", "\"", ");", "return", "decodeLegacyStream", "(", "finput", ",", "foutput", ")", ";", "case", "LZ4S_SKIPPABLE0", ":", "nbReadBytes", "=", "fread", "(", "&", "size", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "!", "=", "4", ")", "EXM_THROW", "(", "42", ",", "\"", "Stream", "error", ":", "skippable", "size", "unreadable", "\"", ");", "size", "=", "LITTLE_ENDIAN_32", "(", "size", ")", ";", "/", "/", "Convert", "to", "Little", "Endian", "format", "errorNb", "=", "fseek", "(", "finput", ",", "size", ",", "SEEK_CUR", ")", ";", "if", "(", "errorNb", "!", "=", "0", ")", "EXM_THROW", "(", "43", ",", "\"", "Stream", "error", ":", "cannot", "skip", "skippable", "area", "\"", ");", "return", "selectDecoder", "(", "finput", ",", "foutput", ")", ";", "default", ":", "if", "(", "ftell", "(", "finput", ")", "=", "=", "MAGICNUMBER_SIZE", ")", "EXM_THROW", "(", "44", ",", "\"", "Unrecognized", "header", ":", "file", "cannot", "be", "decoded", "\"", ");", "/", "/", "Wrong", "magic", "number", "at", "the", "beginning", "of", "1st", "stream", "DISPLAY", "(", "\"", "Stream", "followed", "by", "unrecognized", "data", "\\", "n", "\"", ");", "return", "0", ";", "}", "}", "int", "decodeFile", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ")", "{", "unsigned", "long", "long", "filesize", "=", "0", ",", "decodedSize", "=", "0", ";", "FILE", "*", "finput", ";", "FILE", "*", "foutput", ";", "clock_t", "start", ",", "end", ";", "/", "/", "Init", "start", "=", "clock", "(", ");", "get_fileHandle", "(", "input_filename", ",", "output_filename", ",", "&", "finput", ",", "&", "foutput", ")", ";", "/", "/", "Loop", "over", "multiple", "streams", "do", "{", "decodedSize", "=", "selectDecoder", "(", "finput", ",", "foutput", ")", ";", "filesize", "+", "=", "decodedSize", ";", "}", "while", "(", "decodedSize", ")", ";", "/", "/", "Final", "Status", "end", "=", "clock", "(", ");", "if", "(", "!", "silence", ")", "DISPLAY", "(", "\"", "Successfully", "decoded", "%", "llu", "bytes", "\\", "n", "\"", ",", "filesize", ")", ";", "{", "double", "seconds", "=", "(", "double", ")", "(", "end", "-", "start", ")", "/", "CLOCKS_PER_SEC", ";", "if", "(", "verbose", ")", "DISPLAY", "(", "\"", "Done", "in", "%", ".", "2f", "s", "=", "=>", "%", ".", "2f", "MB", "/", "s", "\\", "n", "\"", ",", "seconds", ",", "(", "double", ")", "filesize", "/", "seconds", "/", "1024", "/", "1024", ")", ";", "}", "/", "/", "Close", "fclose", "(", "finput", ")", ";", "fclose", "(", "foutput", ")", ";", "/", "/", "Error", "status", "=", "OK", "return", "0", ";", "}", "int", "main", "(", "int", "argc", ",", "char", "*", "*", "argv", ")", "{", "int", "i", ",", "cLevel", "=", "0", ",", "decode", "=", "0", ",", "bench", "=", "0", ",", "filenamesStart", "=", "2", ",", "legacy_format", "=", "0", ";", "char", "*", "input_filename", "=", "0", ";", "char", "*", "output_filename", "=", "0", ";", "char", "nullOutput", "[", "]", "=", "NULL_OUTPUT", ";", "char", "extension", "[", "]", "=", "EXTENSION", ";", "/", "/", "Select", "behavior", "programName", "=", "argv", "[", "0", "]", ";", "if", "(", "strstr", "(", "programName", ",", "UNLZ4", ")", ")", "{", "decode", "=", "1", ";", "silence", "=", "1", ";", "}", "else", "if", "(", "strstr", "(", "programName", ",", "LZ4CAT", ")", ")", "{", "decode", "=", "1", ";", "silence", "=", "1", ";", "output_filename", "=", "stdoutmark", ";", "}", "for", "(", "i", "=", "1", ";", "i", "<", "argc", ";", "i", "+", "+)", "{", "char", "*", "argument", "=", "argv", "[", "i", "]", ";", "if", "(", "!", "argument", ")", "continue", ";", "/", "/", "Protection", "if", "argument", "empty", "/", "/", "Decode", "command", "(", "note", ":", "aggregated", "commands", "are", "allowed", ")", "if", "(", "argument", "[", "0", "]", "==", "'-", "')", "{", "if", "(", "argument", "[", "1", "]", "==", "0", ")", "{", "if", "(", "!", "input_filename", ")", "input_filename", "=", "stdinmark", ";", "else", "output_filename", "=", "stdoutmark", ";", "}", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "{", "argument", "+", "+;", "switch", "(", "argument", "[", "0", "]", ")", "{", "/", "/", "Display", "help", "on", "usage", "case", "'", "H", "'", ":", "usage_advanced", "(", ");", "return", "0", ";", "/", "/", "Compression", "(", "default", ")", "case", "'", "c", "'", ":", "if", "(", "(", "argument", "[", "1", "]", ">", "='", "0", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "<", "='", "1", "'", "))", "{", "cLevel", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "break", ";", "case", "'", "h", "'", ":", "if", "(", "argument", "[", "1", "]", "==", "'", "c", "'", ")", "{", "cLevel", "=", "1", ";", "argument", "+", "+;", "}", "else", "{", "usage_advanced", "(", ");", "return", "0", ";", "}", "break", ";", "/", "/", "Use", "Legacy", "format", "(", "hidden", "option", ")", "case", "'", "l", "'", ":", "legacy_format", "=", "1", ";", "break", ";", "/", "/", "Decoding", "case", "'", "d", "'", ":", "decode", "=", "1", ";", "break", ";", "/", "/", "Test", "case", "'", "t", "'", ":", "decode", "=", "1", ";", "output_filename", "=", "nulmark", ";", "break", ";", "/", "/", "Modify", "Block", "Properties", "case", "'", "B", "'", ":", "while", "(", "argument", "[", "1", "]", "!=", "0", ")", "switch", "(", "argument", "[", "1", "]", ")", "{", "case", "'", "4", "'", ":", "case", "'", "5", "'", ":", "case", "'", "6", "'", ":", "case", "'", "7", "'", ":", "{", "int", "B", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "int", "S", "=", "1", "<", "<", "(", "8", "+", "2", "*", "B", ")", ";", "BMK_SetBlocksize", "(", "S", ")", ";", "blockSizeId", "=", "B", ";", "argument", "+", "+;", "break", ";", "}", "case", "'", "D", "'", ":", "blockIndependence", "=", "0", ",", "argument", "+", "+;", "break", ";", "case", "'", "X", "'", ":", "blockChecksum", "=", "1", ",", "argument", "+", "+;", "break", ";", "default", ":", "goto", "_exit_blockProperties", ";", "}", "_exit_blockProperties", ":", "break", ";", "/", "/", "Modify", "Stream", "properties", "case", "'", "S", "'", ":", "if", "(", "argument", "[", "1", "]", "==", "'", "x", "'", ")", "{", "streamChecksum", "=", "0", ";", "argument", "+", "+;", "break", ";", "}", "else", "{", "badusage", "(", ");", "}", "/", "/", "Bench", "case", "'", "b", "'", ":", "bench", "=", "1", ";", "if", "(", "(", "argument", "[", "1", "]", ">", "='", "0", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "<", "='", "1", "'", "))", "{", "cLevel", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "argument", "+", "+;", "}", "break", ";", "/", "/", "Modify", "Nb", "Iterations", "(", "benchmark", "only", ")", "case", "'", "i", "'", ":", "if", "(", "(", "argument", "[", "1", "]", ">", "='", "1", "'", ")", "&", "&", "(", "argument", "[", "1", "]", "<", "='", "9", "'", "))", "{", "int", "iters", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "BMK_SetNbIterations", "(", "iters", ")", ";", "argument", "+", "+;", "}", "break", ";", "/", "/", "Pause", "at", "the", "end", "(", "benchmark", "only", ")", "(", "hidden", "option", ")", "case", "'", "p", "'", ":", "BMK_SetPause", "(", ");", "break", ";", "/", "/", "Overwrite", "case", "'", "y", "'", ":", "overwrite", "=", "1", ";", "break", ";", "/", "/", "Verbose", "mode", "case", "'", "v", "'", ":", "verbose", "=", "1", ";", "break", ";", "/", "/", "Unrecognised", "command", "default", ":", "badusage", "(", ");", "}", "}", "continue", ";", "}", "/", "/", "first", "provided", "filename", "is", "input", "if", "(", "!", "input_filename", ")", "{", "input_filename", "=", "argument", ";", "filenamesStart", "=", "i", ";", "continue", ";", "}", "/", "/", "second", "provided", "filename", "is", "output", "if", "(", "!", "output_filename", ")", "{", "output_filename", "=", "argument", ";", "if", "(", "!", "strcmp", "(", "output_filename", ",", "nullOutput", ")", ")", "output_filename", "=", "nulmark", ";", "continue", ";", "}", "}", "if", "(", "verbose", ")", "DISPLAY", "(", "WELCOME_MESSAGE", ")", ";", "/", "/", "No", "input", "filename", "=", "=>", "use", "stdin", "if", "(", "!", "input_filename", ")", "{", "input_filename", "=", "stdinmark", ";", "}", "/", "/", "Check", "if", "benchmark", "was", "required", "if", "(", "bench", ")", "return", "BMK_benchFile", "(", "argv", "+", "filenamesStart", ",", "argc", "-", "filenamesStart", ",", "cLevel", ")", ";", "/", "/", "No", "output", "filename", "=", "=>", "select", "one", "automatically", "(", "when", "possible", ")", "if", "(", "!", "output_filename", ")", "{", "if", "(", "input_filename", "=", "=", "stdinmark", ")", "{", "output_filename", "=", "stdoutmark", ";", "silence", "=", "1", ";", "}", "else", "if", "(", "!", "decode", ")", "/", "/", "compression", "{", "int", "i", "=", "0", ",", "l", "=", "0", ";", "while", "(", "input_filename", "[", "l", "]", "!=", "0", ")", "l", "+", "+;", "output_filename", "=", "(", "char", "*", ")", "calloc", "(", "1", ",", "l", "+", "5", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "l", ";", "i", "+", "+)", "output_filename", "[", "i", "]", "=", "input_filename", "[", "i", "]", ";", "for", "(", "i", "=", "l", ";", "i", "<", "l", "+", "4", ";", "i", "+", "+)", "output_filename", "[", "i", "]", "=", "extension", "[", "i", "-", "l", "]", ";", "if", "(", "!", "silence", ")", "DISPLAY", "(", "\"", "Compressed", "filename", "will", "be", ":", "%", "s", "\\", "n", "\"", ",", "output_filename", ")", ";", "}", "else", "/", "/", "decompression", "(", "input", "file", "must", "respect", "format", "extension", "\"", ".", "lz4", "\"", ")", "{", "int", "inl", "=", "0", ",", "outl", ";", "while", "(", "input_filename", "[", "inl", "]", "!=", "0", ")", "inl", "+", "+;", "output_filename", "=", "(", "char", "*", ")", "calloc", "(", "1", ",", "inl", "+", "1", ")", ";", "for", "(", "outl", "=", "0", ";", "outl", "<", "inl", ";", "outl", "+", "+)", "output_filename", "[", "outl", "]", "=", "input_filename", "[", "outl", "]", ";", "if", "(", "inl", ">", "4", ")", "while", "(", "(", "outl", ">", "=", "inl", "-", "4", ")", "&", "&", "(", "input_filename", "[", "outl", "]", "=", "=", "extension", "[", "outl", "-", "inl", "+", "4", "]", "))", "output_filename", "[", "outl", "-", "-]", "=", "0", ";", "if", "(", "outl", "!", "=", "inl", "-", "5", ")", "{", "DISPLAY", "(", "\"", "Cannot", "automatically", "decide", "an", "output", "filename", "\\", "n", "\"", ");", "badusage", "(", ");", "}", "}", "}", "if", "(", "(", "decode", "?", "input_filename", "=", "=", "stdinmark", ":", "output_filename", "=", "=", "stdoutmark", ")", "&", "&", "!", "overwrite", "#", "ifdef", "_WIN32", "&", "&", "_isatty", "(", "_fileno", "(", "(", "decode", "?", "stdin", ":", "stdout", ")", "))", ")", "#", "else", "&", "&", "isatty", "(", "fileno", "(", "(", "decode", "?", "stdin", ":", "stdout", ")", "))", ")", "#", "endif", "badusage", "(", ");", "if", "(", "(", "input_filename", "=", "=", "stdinmark", ")", "&", "&", "(", "output_filename", "=", "=", "stdoutmark", ")", ")", "silence", "=", "1", ";", "if", "(", "verbose", ")", "silence", "=", "0", ";", "if", "(", "decode", ")", "return", "decodeFile", "(", "input_filename", ",", "output_filename", ")", ";", "/", "/", "compression", "is", "default", "action", "if", "(", "legacy_format", ")", "{", "if", "(", "!", "silence", ")", "DISPLAY", "(", "\"!", "Generating", "compressed", "LZ4", "using", "Legacy", "format", "(", "deprecated", "!", ")", "!", "\\", "n", "\"", ");", "return", "legacy_compress_file", "(", "input_filename", ",", "output_filename", ",", "cLevel", ")", ";", "}", "else", "{", "return", "compress_file", "(", "input_filename", ",", "output_filename", ",", "cLevel", ")", ";", "}", "}", "/", "*", "LZ4io", ".", "c", "-", "LZ4", "File", "/", "Stream", "Interface", "Copyright", "(", "C", ")", "Yann", "Collet", "2011", "-", "2014", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "-", "LZ4", "public", "forum", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "#!", "forum", "/", "lz4c", "*", "/", "/", "*", "Note", ":", "this", "is", "stand", "-", "alone", "program", ".", "It", "is", "not", "part", "of", "LZ4", "compression", "library", ",", "it", "is", "a", "user", "code", "of", "the", "LZ4", "library", ".", "-", "The", "license", "of", "LZ4", "library", "is", "BSD", ".", "-", "The", "license", "of", "xxHash", "library", "is", "BSD", ".", "-", "The", "license", "of", "this", "source", "file", "is", "GPLv2", ".", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "ifdef", "_MSC_VER", "/", "*", "Visual", "Studio", "*", "/", "#", "define", "FORCE_INLINE", "static", "__forceinline", "#", "define", "_CRT_SECURE_NO_WARNINGS", "#", "define", "_CRT_SECURE_NO_DEPRECATE", "/", "/", "VS2005", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "/", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "#", "else", "#", "ifdef", "__GNUC__", "#", "define", "FORCE_INLINE", "static", "inline", "__attribute__", "(", "(", "always_inline", ")", ")", "#", "else", "#", "define", "FORCE_INLINE", "static", "inline", "#", "endif", "#", "endif", "#", "define", "_FILE_OFFSET_BITS", "64", "/", "/", "Large", "file", "support", "on", "32", "-", "bits", "unix", "#", "define", "_POSIX_SOURCE", "1", "/", "/", "for", "fileno", "(", ")", "within", "<", "stdio", ".", "h", ">", "on", "unix", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdio", ".", "h", ">", "/", "/", "fprintf", ",", "fopen", ",", "fread", ",", "_fileno", ",", "stdin", ",", "stdout", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "malloc", "#", "include", "<", "string", ".", "h", ">", "/", "/", "strcmp", ",", "strlen", "#", "include", "<", "time", ".", "h", ">", "/", "/", "clock", "#", "include", "\"", "lz4io", ".", "h", "\"", "#", "include", "\"", "lz4", ".", "h", "\"", "#", "include", "\"", "lz4hc", ".", "h", "\"", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "OS", "-", "specific", "Includes", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "MSDOS", ")", "|", "|", "defined", "(", "OS2", ")", "|", "|", "defined", "(", "WIN32", ")", "|", "|", "defined", "(", "_WIN32", ")", "|", "|", "defined", "(", "__CYGWIN__", ")", "#", "include", "<", "fcntl", ".", "h", ">", "/", "/", "_O_BINARY", "#", "include", "<", "io", ".", "h", ">", "/", "/", "_setmode", ",", "_isatty", "#", "ifdef", "__MINGW32__", "int", "_fileno", "(", "FILE", "*", "stream", ")", ";", "/", "/", "MINGW", "somehow", "forgets", "to", "include", "this", "windows", "declaration", "into", "<", "stdio", ".", "h", ">", "#", "endif", "#", "define", "SET_BINARY_MODE", "(", "file", ")", "_setmode", "(", "_fileno", "(", "file", ")", ",", "_O_BINARY", ")", "#", "define", "IS_CONSOLE", "(", "stdStream", ")", "_isatty", "(", "_fileno", "(", "stdStream", ")", ")", "#", "else", "#", "include", "<", "unistd", ".", "h", ">", "/", "/", "isatty", "#", "define", "SET_BINARY_MODE", "(", "file", ")", "#", "define", "IS_CONSOLE", "(", "stdStream", ")", "isatty", "(", "fileno", "(", "stdStream", ")", ")", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "-", "specific", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "GCC_VERSION", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", "#", "if", "defined", "(", "_MSC_VER", ")", "/", "/", "Visual", "Studio", "#", "define", "swap32", "_byteswap_ulong", "#", "elif", "GCC_VERSION", ">", "=", "403", "#", "define", "swap32", "__builtin_bswap32", "#", "else", "static", "inline", "unsigned", "int", "swap32", "(", "unsigned", "int", "x", ")", "{", "return", "(", "(", "x", "<", "<", "24", ")", "&", "0xff000000", ")", "|", "(", "(", "x", "<", "<", "8", ")", "&", "0x00ff0000", ")", "|", "(", "(", "x", ">", ">", "8", ")", "&", "0x0000ff00", ")", "|", "(", "(", "x", ">", ">", "24", ")", "&", "0x000000ff", ")", ";", "}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "#", "define", "_1BIT", "0x01", "#", "define", "_2BITS", "0x03", "#", "define", "_3BITS", "0x07", "#", "define", "_4BITS", "0x0F", "#", "define", "_8BITS", "0xFF", "#", "define", "MAGICNUMBER_SIZE", "4", "#", "define", "LZ4S_MAGICNUMBER", "0x184D2204", "#", "define", "LZ4S_SKIPPABLE0", "0x184D2A50", "#", "define", "LZ4S_SKIPPABLEMASK", "0xFFFFFFF0", "#", "define", "LEGACY_MAGICNUMBER", "0x184C2102", "#", "define", "CACHELINE", "64", "#", "define", "LEGACY_BLOCKSIZE", "(", "8", "MB", ")", "#", "define", "MIN_STREAM_BUFSIZE", "(", "192", "KB", ")", "#", "define", "LZ4S_BLOCKSIZEID_DEFAULT", "7", "#", "define", "LZ4S_CHECKSUM_SEED", "0", "#", "define", "LZ4S_EOS", "0", "#", "define", "LZ4S_MAXHEADERSIZE", "(", "MAGICNUMBER_SIZE", "+", "2", "+", "8", "+", "4", "+", "1", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Architecture", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "const", "int", "one", "=", "1", ";", "#", "define", "CPU_LITTLE_ENDIAN", "(", "*(", "char", "*", ")(", "&", "one", ")", ")", "#", "define", "CPU_BIG_ENDIAN", "(", "!", "CPU_LITTLE_ENDIAN", ")", "#", "define", "LITTLE_ENDIAN_32", "(", "i", ")", "(", "CPU_LITTLE_ENDIAN", "?", "(", "i", ")", ":", "swap32", "(", "i", ")", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DISPLAY", "(", "..", ".)", "fprintf", "(", "stderr", ",", "__VA_ARGS__", ")", "#", "define", "DISPLAYLEVEL", "(", "l", ",", ".", "..", ")", "if", "(", "displayLevel", ">", "=", "l", ")", "{", "DISPLAY", "(", "__VA_ARGS__", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "Parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "static", "int", "displayLevel", "=", "0", ";", "/", "/", "0", ":", "no", "display", "/", "/", "1", ":", "errors", "/", "/", "2", ":", "+", "result", "+", "interaction", "+", "warnings", ";", "/", "/", "3", ":", "+", "progression", ";", "/", "/", "4", ":", "+", "information", "static", "int", "overwrite", "=", "1", ";", "static", "int", "blockSizeId", "=", "LZ4S_BLOCKSIZEID_DEFAULT", ";", "static", "int", "blockChecksum", "=", "0", ";", "static", "int", "streamChecksum", "=", "1", ";", "static", "int", "blockIndependence", "=", "1", ";", "static", "const", "int", "minBlockSizeID", "=", "4", ";", "static", "const", "int", "maxBlockSizeID", "=", "7", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Exceptions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "DEBUG", "0", "#", "define", "DEBUGOUTPUT", "(", "..", ".)", "if", "(", "DEBUG", ")", "DISPLAY", "(", "__VA_ARGS__", ")", ";", "#", "define", "EXM_THROW", "(", "error", ",", ".", "..", ")", "\\", "{", "\\", "DEBUGOUTPUT", "(", "\"", "Error", "defined", "at", "%", "s", ",", "line", "%", "i", ":", "\\", "n", "\"", ",", "__FILE__", ",", "__LINE__", ")", ";", "\\", "DISPLAYLEVEL", "(", "1", ",", "\"", "Error", "%", "i", ":", "\"", ",", "error", ")", ";", "\\", "DISPLAYLEVEL", "(", "1", ",", "__VA_ARGS__", ")", ";", "\\", "DISPLAYLEVEL", "(", "1", ",", "\"", "\\", "n", "\"", ");", "\\", "exit", "(", "error", ")", ";", "\\", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Version", "modifiers", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "EXTENDED_ARGUMENTS", "#", "define", "EXTENDED_HELP", "#", "define", "EXTENDED_FORMAT", "#", "define", "DEFAULT_COMPRESSOR", "compress_file", "#", "define", "DEFAULT_DECOMPRESSOR", "decodeLZ4S", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Parameters", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "Default", "setting", ":", "overwrite", "=", "1", ";", "return", ":", "overwrite", "mode", "(", "0", "/", "1", ")", "*", "/", "int", "LZ4IO_setOverwrite", "(", "int", "yes", ")", "{", "overwrite", "=", "(", "yes", "!", "=", "0", ")", ";", "return", "overwrite", ";", "}", "/", "*", "blockSizeID", ":", "valid", "values", ":", "4", "-", "5", "-", "6", "-", "7", "*", "/", "int", "LZ4IO_setBlockSizeID", "(", "int", "bsid", ")", "{", "static", "const", "int", "blockSizeTable", "[", "]", "=", "{", "64", "KB", ",", "256", "KB", ",", "1", "MB", ",", "4", "MB", "}", ";", "if", "(", "(", "bsid", "<", "minBlockSizeID", ")", "|", "|", "(", "bsid", ">", "maxBlockSizeID", ")", ")", "return", "-", "1", ";", "blockSizeId", "=", "bsid", ";", "return", "blockSizeTable", "[", "blockSizeId", "-", "minBlockSizeID", "]", ";", "}", "int", "LZ4IO_setBlockMode", "(", "blockMode_t", "blockMode", ")", "{", "blockIndependence", "=", "(", "blockMode", "=", "=", "independentBlocks", ")", ";", "return", "blockIndependence", ";", "}", "/", "*", "Default", "setting", ":", "no", "checksum", "*", "/", "int", "LZ4IO_setBlockChecksumMode", "(", "int", "xxhash", ")", "{", "blockChecksum", "=", "(", "xxhash", "!", "=", "0", ")", ";", "return", "blockChecksum", ";", "}", "/", "*", "Default", "setting", ":", "checksum", "enabled", "*", "/", "int", "LZ4IO_setStreamChecksumMode", "(", "int", "xxhash", ")", "{", "streamChecksum", "=", "(", "xxhash", "!", "=", "0", ")", ";", "return", "streamChecksum", ";", "}", "/", "*", "Default", "setting", ":", "0", "(", "no", "notification", ")", "*", "/", "int", "LZ4IO_setNotificationLevel", "(", "int", "level", ")", "{", "displayLevel", "=", "level", ";", "return", "displayLevel", ";", "}", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "LZ4", "File", "/", "Stream", "compression", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "static", "int", "LZ4S_GetBlockSize_FromBlockId", "(", "int", "id", ")", "{", "return", "(", "1", "<", "<", "(", "8", "+", "(", "2", "*", "id", ")", "))", ";", "}", "static", "unsigned", "int", "LZ4S_GetCheckBits_FromXXH", "(", "unsigned", "int", "xxh", ")", "{", "return", "(", "xxh", ">", ">", "8", ")", "&", "_8BITS", ";", "}", "static", "int", "LZ4S_isSkippableMagicNumber", "(", "unsigned", "int", "magic", ")", "{", "return", "(", "magic", "&", "LZ4S_SKIPPABLEMASK", ")", "=", "=", "LZ4S_SKIPPABLE0", ";", "}", "static", "int", "get_fileHandle", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "FILE", "*", "*", "pfinput", ",", "FILE", "*", "*", "pfoutput", ")", "{", "if", "(", "!", "strcmp", "(", "input_filename", ",", "stdinmark", ")", ")", "{", "DISPLAYLEVEL", "(", "4", ",", "\"", "Using", "stdin", "for", "input", "\\", "n", "\"", ");", "*", "pfinput", "=", "stdin", ";", "SET_BINARY_MODE", "(", "stdin", ")", ";", "}", "else", "{", "*", "pfinput", "=", "fopen", "(", "input_filename", ",", "\"", "rb", "\"", ");", "}", "if", "(", "!", "strcmp", "(", "output_filename", ",", "stdoutmark", ")", ")", "{", "DISPLAYLEVEL", "(", "4", ",", "\"", "Using", "stdout", "for", "output", "\\", "n", "\"", ");", "*", "pfoutput", "=", "stdout", ";", "SET_BINARY_MODE", "(", "stdout", ")", ";", "}", "else", "{", "/", "/", "Check", "if", "destination", "file", "already", "exists", "*", "pfoutput", "=", "0", ";", "if", "(", "output_filename", "!", "=", "nulmark", ")", "*", "pfoutput", "=", "fopen", "(", "output_filename", ",", "\"", "rb", "\"", ")", ";", "if", "(", "*", "pfoutput", "!", "=", "0", ")", "{", "fclose", "(", "*", "pfoutput", ")", ";", "if", "(", "!", "overwrite", ")", "{", "char", "ch", ";", "DISPLAYLEVEL", "(", "2", ",", "\"", "Warning", ":", "%", "s", "already", "exists", "\\", "n", "\"", ",", "output_filename", ")", ";", "DISPLAYLEVEL", "(", "2", ",", "\"", "Overwrite", "?", "(", "Y", "/", "N", ")", ":", "\"", ");", "if", "(", "displayLevel", "<", "=", "1", ")", "EXM_THROW", "(", "11", ",", "\"", "Operation", "aborted", ":", "%", "s", "already", "exists", "\"", ",", "output_filename", ")", ";", "/", "/", "No", "interaction", "possible", "ch", "=", "(", "char", ")", "getchar", "(", ");", "if", "(", "(", "ch", "!", "='", "Y", "'", ")", "&", "&", "(", "ch", "!", "='", "y", "'", "))", "EXM_THROW", "(", "11", ",", "\"", "Operation", "aborted", ":", "%", "s", "already", "exists", "\"", ",", "output_filename", ")", ";", "}", "}", "*", "pfoutput", "=", "fopen", "(", "output_filename", ",", "\"", "wb", "\"", ")", ";", "}", "if", "(", "*", "pfinput", "=", "=", "0", ")", "EXM_THROW", "(", "12", ",", "\"", "Pb", "opening", "%", "s", "\"", ",", "input_filename", ")", ";", "if", "(", "*", "pfoutput", "=", "=", "0", ")", "EXM_THROW", "(", "13", ",", "\"", "Pb", "opening", "%", "s", "\"", ",", "output_filename", ")", ";", "return", "0", ";", "}", "/", "/", "LZ4IO_compressFilename_Legacy", ":", "This", "function", "is", "\"", "hidden", "\"", "(", "not", "published", "in", ".", "h", ")", "/", "/", "Its", "purpose", "is", "to", "generate", "compressed", "streams", "using", "the", "old", "'", "legacy", "'", "format", "int", "LZ4IO_compressFilename_Legacy", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "int", "compressionlevel", ")", "{", "int", "(", "*", "compressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ")", ";", "unsigned", "long", "long", "filesize", "=", "0", ";", "unsigned", "long", "long", "compressedfilesize", "=", "MAGICNUMBER_SIZE", ";", "char", "*", "in_buff", ";", "char", "*", "out_buff", ";", "FILE", "*", "finput", ";", "FILE", "*", "foutput", ";", "int", "displayLevel", "=", "(", "compressionlevel", ">", "0", ")", ";", "clock_t", "start", ",", "end", ";", "size_t", "sizeCheck", ";", "/", "/", "Init", "if", "(", "compressionlevel", "<", "3", ")", "compressionFunction", "=", "LZ4_compress", ";", "else", "compressionFunction", "=", "LZ4_compressHC", ";", "start", "=", "clock", "(", ");", "get_fileHandle", "(", "input_filename", ",", "output_filename", ",", "&", "finput", ",", "&", "foutput", ")", ";", "if", "(", "(", "displayLevel", "=", "=", "2", ")", "&", "&", "(", "compressionlevel", "=", "=", "1", ")", ")", "displayLevel", "=", "3", ";", "/", "/", "Allocate", "Memory", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "LEGACY_BLOCKSIZE", ")", ";", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "LZ4_compressBound", "(", "LEGACY_BLOCKSIZE", ")", ");", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", ")", "EXM_THROW", "(", "21", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "/", "/", "Write", "Archive", "Header", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "LEGACY_MAGICNUMBER", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "MAGICNUMBER_SIZE", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "MAGICNUMBER_SIZE", ")", "EXM_THROW", "(", "22", ",", "\"", "Write", "error", ":", "cannot", "write", "header", "\"", ");", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "unsigned", "int", "outSize", ";", "/", "/", "Read", "Block", "int", "inSize", "=", "(", "int", ")", "fread", "(", "in_buff", ",", "(", "size_t", ")", "1", ",", "(", "size_t", ")", "LEGACY_BLOCKSIZE", ",", "finput", ")", ";", "if", "(", "inSize", "<", "=", "0", ")", "break", ";", "filesize", "+", "=", "inSize", ";", "DISPLAYLEVEL", "(", "3", ",", "\"", "\\", "rRead", ":", "%", "i", "MB", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ");", "/", "/", "Compress", "Block", "outSize", "=", "compressionFunction", "(", "in_buff", ",", "out_buff", "+", "4", ",", "inSize", ")", ";", "compressedfilesize", "+", "=", "outSize", "+", "4", ";", "DISPLAYLEVEL", "(", "3", ",", "\"", "\\", "rRead", ":", "%", "i", "MB", "=", "=>", "%", ".", "2f", "%", "%", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "/", "/", "Write", "Block", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "outSize", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "outSize", "+", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "outSize", "+", "4", ")", ")", "EXM_THROW", "(", "23", ",", "\"", "Write", "error", ":", "cannot", "write", "compressed", "block", "\"", ");", "}", "/", "/", "Status", "end", "=", "clock", "(", ");", "DISPLAYLEVEL", "(", "2", ",", "\"", "\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "DISPLAYLEVEL", "(", "2", ",", "\"", "Compressed", "%", "llu", "bytes", "into", "%", "llu", "bytes", "=", "=>", "%", ".", "2f", "%", "%\\", "n", "\"", ",", "(", "unsigned", "long", "long", ")", "filesize", ",", "(", "unsigned", "long", "long", ")", "compressedfilesize", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "{", "double", "seconds", "=", "(", "double", ")", "(", "end", "-", "start", ")", "/", "CLOCKS_PER_SEC", ";", "DISPLAYLEVEL", "(", "4", ",", "\"", "Done", "in", "%", ".", "2f", "s", "=", "=>", "%", ".", "2f", "MB", "/", "s", "\\", "n", "\"", ",", "seconds", ",", "(", "double", ")", "filesize", "/", "seconds", "/", "1024", "/", "1024", ")", ";", "}", "/", "/", "Close", "&", "Free", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "fclose", "(", "finput", ")", ";", "fclose", "(", "foutput", ")", ";", "return", "0", ";", "}", "static", "void", "*", "LZ4IO_LZ4_createStream", "(", "const", "char", "*", "inputBuffer", ")", "{", "(", "void", ")", "inputBuffer", ";", "return", "LZ4_createStream", "(", ");", "}", "static", "int", "LZ4IO_LZ4_compress_limitedOutput_continue", "(", "void", "*", "ctx", ",", "const", "char", "*", "source", ",", "char", "*", "dest", ",", "int", "inputSize", ",", "int", "maxOutputSize", ",", "int", "compressionLevel", ")", "{", "(", "void", ")", "compressionLevel", ";", "return", "LZ4_compress_limitedOutput_continue", "(", "ctx", ",", "source", ",", "dest", ",", "inputSize", ",", "maxOutputSize", ")", ";", "}", "static", "int", "LZ4IO_LZ4_slideInputBufferHC", "(", "void", "*", "ctx", ",", "char", "*", "buffer", ",", "int", "size", ")", "{", "(", "void", ")", "size", ";", "(", "void", ")", "buffer", ";", "LZ4_slideInputBufferHC", "(", "ctx", ")", ";", "return", "1", ";", "}", "static", "int", "compress_file_blockDependency", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "int", "compressionlevel", ")", "{", "void", "*", "(", "*", "initFunction", ")", "(", "const", "char", "*", ");", "int", "(", "*", "compressionFunction", ")", "(", "void", "*", ",", "const", "char", "*", ",", "char", "*", ",", "int", ",", "int", ",", "int", ")", ";", "int", "(", "*", "nextBlockFunction", ")", "(", "void", "*", ",", "char", "*", ",", "int", ")", ";", "int", "(", "*", "freeFunction", ")", "(", "void", "*", ");", "void", "*", "ctx", ";", "unsigned", "long", "long", "filesize", "=", "0", ";", "unsigned", "long", "long", "compressedfilesize", "=", "0", ";", "unsigned", "int", "checkbits", ";", "char", "*", "in_buff", ",", "*", "in_blockStart", ";", "char", "*", "out_buff", ";", "FILE", "*", "finput", ";", "FILE", "*", "foutput", ";", "clock_t", "start", ",", "end", ";", "unsigned", "int", "blockSize", ",", "inputBufferSize", ";", "size_t", "sizeCheck", ",", "header_size", ";", "void", "*", "streamChecksumState", "=", "NULL", ";", "/", "/", "Init", "start", "=", "clock", "(", ");", "if", "(", "(", "displayLevel", "=", "=", "2", ")", "&", "&", "(", "compressionlevel", ">", "=", "3", ")", ")", "displayLevel", "=", "3", ";", "if", "(", "compressionlevel", "<", "3", ")", "{", "initFunction", "=", "LZ4IO_LZ4_createStream", ";", "compressionFunction", "=", "LZ4IO_LZ4_compress_limitedOutput_continue", ";", "nextBlockFunction", "=", "LZ4_saveDict", ";", "freeFunction", "=", "LZ4_free", ";", "}", "else", "{", "initFunction", "=", "LZ4_createHC", ";", "compressionFunction", "=", "LZ4_compressHC2_limitedOutput_continue", ";", "nextBlockFunction", "=", "LZ4IO_LZ4_slideInputBufferHC", ";", "freeFunction", "=", "LZ4_free", ";", "}", "get_fileHandle", "(", "input_filename", ",", "output_filename", ",", "&", "finput", ",", "&", "foutput", ")", ";", "blockSize", "=", "LZ4S_GetBlockSize_FromBlockId", "(", "blockSizeId", ")", ";", "/", "/", "Allocate", "Memory", "inputBufferSize", "=", "64", "KB", "+", "blockSize", ";", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "inputBufferSize", ")", ";", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "blockSize", "+", "CACHELINE", ")", ";", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", ")", "EXM_THROW", "(", "31", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "in_blockStart", "=", "in_buff", "+", "64", "KB", ";", "if", "(", "compressionlevel", ">", "=", "3", ")", "in_blockStart", "=", "in_buff", ";", "if", "(", "streamChecksum", ")", "streamChecksumState", "=", "XXH32_init", "(", "LZ4S_CHECKSUM_SEED", ")", ";", "ctx", "=", "initFunction", "(", "in_buff", ")", ";", "/", "/", "Write", "Archive", "Header", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "LZ4S_MAGICNUMBER", ")", ";", "/", "/", "Magic", "Number", ",", "in", "Little", "Endian", "convention", "*", "(", "out_buff", "+", "4", ")", "=", "(", "1", "&", "_2BITS", ")", "<", "<", "6", ";", "/", "/", "Version", "(", "'", "01", "'", ")", "*", "(", "out_buff", "+", "4", ")", "|", "=", "(", "blockIndependence", "&", "_1BIT", ")", "<", "<", "5", ";", "*", "(", "out_buff", "+", "4", ")", "|", "=", "(", "blockChecksum", "&", "_1BIT", ")", "<", "<", "4", ";", "*", "(", "out_buff", "+", "4", ")", "|", "=", "(", "streamChecksum", "&", "_1BIT", ")", "<", "<", "2", ";", "*", "(", "out_buff", "+", "5", ")", "=", "(", "char", ")", "((", "blockSizeId", "&", "_3BITS", ")", "<", "<", "4", ")", ";", "checkbits", "=", "XXH32", "(", "(", "out_buff", "+", "4", ")", ",", "2", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "checkbits", "=", "LZ4S_GetCheckBits_FromXXH", "(", "checkbits", ")", ";", "*", "(", "out_buff", "+", "6", ")", "=", "(", "unsigned", "char", ")", "checkbits", ";", "header_size", "=", "7", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "header_size", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "header_size", ")", "EXM_THROW", "(", "32", ",", "\"", "Write", "error", ":", "cannot", "write", "header", "\"", ");", "compressedfilesize", "+", "=", "header_size", ";", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "unsigned", "int", "outSize", ";", "unsigned", "int", "inSize", ";", "/", "/", "Read", "Block", "inSize", "=", "(", "unsigned", "int", ")", "fread", "(", "in_blockStart", ",", "(", "size_t", ")", "1", ",", "(", "size_t", ")", "blockSize", ",", "finput", ")", ";", "if", "(", "inSize", "=", "=", "0", ")", "break", ";", "/", "/", "No", "more", "input", ":", "end", "of", "compression", "filesize", "+", "=", "inSize", ";", "DISPLAYLEVEL", "(", "3", ",", "\"", "\\", "rRead", ":", "%", "i", "MB", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ");", "if", "(", "streamChecksum", ")", "XXH32_update", "(", "streamChecksumState", ",", "in_blockStart", ",", "inSize", ")", ";", "/", "/", "Compress", "Block", "outSize", "=", "compressionFunction", "(", "ctx", ",", "in_blockStart", ",", "out_buff", "+", "4", ",", "inSize", ",", "inSize", "-", "1", ",", "compressionlevel", ")", ";", "if", "(", "outSize", ">", "0", ")", "compressedfilesize", "+", "=", "outSize", "+", "4", ";", "else", "compressedfilesize", "+", "=", "inSize", "+", "4", ";", "if", "(", "blockChecksum", ")", "compressedfilesize", "+", "=", "4", ";", "DISPLAYLEVEL", "(", "3", ",", "\"", "==", ">", "%", ".", "2f", "%", "%", "\"", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "/", "/", "Write", "Block", "if", "(", "outSize", ">", "0", ")", "{", "int", "sizeToWrite", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "outSize", ")", ";", "if", "(", "blockChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "out_buff", "+", "4", ",", "outSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "*", "(", "unsigned", "int", "*", ")", "(", "out_buff", "+", "4", "+", "outSize", ")", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "}", "sizeToWrite", "=", "4", "+", "outSize", "+", "(", "4", "*", "blockChecksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "sizeToWrite", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "sizeToWrite", ")", ")", "EXM_THROW", "(", "33", ",", "\"", "Write", "error", ":", "cannot", "write", "compressed", "block", "\"", ");", "}", "else", "/", "/", "Copy", "Original", "{", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "inSize", "|", "0x80000000", ")", ";", "/", "/", "Add", "Uncompressed", "flag", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "34", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "header", "\"", ");", "sizeCheck", "=", "fwrite", "(", "in_blockStart", ",", "1", ",", "inSize", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "inSize", ")", ")", "EXM_THROW", "(", "35", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "\"", ");", "if", "(", "blockChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "in_blockStart", ",", "inSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "36", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "checksum", "\"", ");", "}", "}", "{", "size_t", "sizeToMove", "=", "64", "KB", ";", "if", "(", "inSize", "<", "64", "KB", ")", "sizeToMove", "=", "inSize", ";", "nextBlockFunction", "(", "ctx", ",", "in_blockStart", "-", "sizeToMove", ",", "(", "int", ")", "sizeToMove", ")", ";", "if", "(", "compressionlevel", ">", "=", "3", ")", "in_blockStart", "=", "in_buff", "+", "64", "KB", ";", "}", "}", "/", "/", "End", "of", "Stream", "mark", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LZ4S_EOS", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "37", ",", "\"", "Write", "error", ":", "cannot", "write", "end", "of", "stream", "\"", ");", "compressedfilesize", "+", "=", "4", ";", "if", "(", "streamChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32_digest", "(", "streamChecksumState", ")", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "37", ",", "\"", "Write", "error", ":", "cannot", "write", "stream", "checksum", "\"", ");", "compressedfilesize", "+", "=", "4", ";", "}", "/", "/", "Status", "end", "=", "clock", "(", ");", "DISPLAYLEVEL", "(", "2", ",", "\"", "\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "DISPLAYLEVEL", "(", "2", ",", "\"", "Compressed", "%", "llu", "bytes", "into", "%", "llu", "bytes", "=", "=>", "%", ".", "2f", "%", "%\\", "n", "\"", ",", "(", "unsigned", "long", "long", ")", "filesize", ",", "(", "unsigned", "long", "long", ")", "compressedfilesize", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "{", "double", "seconds", "=", "(", "double", ")", "(", "end", "-", "start", ")", "/", "CLOCKS_PER_SEC", ";", "DISPLAYLEVEL", "(", "4", ",", "\"", "Done", "in", "%", ".", "2f", "s", "=", "=>", "%", ".", "2f", "MB", "/", "s", "\\", "n", "\"", ",", "seconds", ",", "(", "double", ")", "filesize", "/", "seconds", "/", "1024", "/", "1024", ")", ";", "}", "/", "/", "Close", "&", "Free", "freeFunction", "(", "ctx", ")", ";", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "fclose", "(", "finput", ")", ";", "fclose", "(", "foutput", ")", ";", "return", "0", ";", "}", "FORCE_INLINE", "int", "LZ4_compress_limitedOutput_local", "(", "const", "char", "*", "src", ",", "char", "*", "dst", ",", "int", "size", ",", "int", "maxOut", ",", "int", "clevel", ")", "{", "(", "void", ")", "clevel", ";", "return", "LZ4_compress_limitedOutput", "(", "src", ",", "dst", ",", "size", ",", "maxOut", ")", ";", "}", "int", "LZ4IO_compressFilename", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "int", "compressionLevel", ")", "{", "int", "(", "*", "compressionFunction", ")", "(", "const", "char", "*", ",", "char", "*", ",", "int", ",", "int", ",", "int", ")", ";", "unsigned", "long", "long", "filesize", "=", "0", ";", "unsigned", "long", "long", "compressedfilesize", "=", "0", ";", "unsigned", "int", "checkbits", ";", "char", "*", "in_buff", ";", "char", "*", "out_buff", ";", "char", "*", "headerBuffer", ";", "FILE", "*", "finput", ";", "FILE", "*", "foutput", ";", "clock_t", "start", ",", "end", ";", "int", "blockSize", ";", "size_t", "sizeCheck", ",", "header_size", ",", "readSize", ";", "void", "*", "streamChecksumState", "=", "NULL", ";", "/", "/", "Branch", "out", "if", "(", "blockIndependence", "=", "=", "0", ")", "return", "compress_file_blockDependency", "(", "input_filename", ",", "output_filename", ",", "compressionLevel", ")", ";", "/", "/", "Init", "start", "=", "clock", "(", ");", "if", "(", "(", "displayLevel", "=", "=", "2", ")", "&", "&", "(", "compressionLevel", ">", "=", "3", ")", ")", "displayLevel", "=", "3", ";", "if", "(", "compressionLevel", "<", "=", "3", ")", "compressionFunction", "=", "LZ4_compress_limitedOutput_local", ";", "else", "{", "compressionFunction", "=", "LZ4_compressHC2_limitedOutput", ";", "}", "get_fileHandle", "(", "input_filename", ",", "output_filename", ",", "&", "finput", ",", "&", "foutput", ")", ";", "blockSize", "=", "LZ4S_GetBlockSize_FromBlockId", "(", "blockSizeId", ")", ";", "/", "/", "Allocate", "Memory", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "blockSize", ")", ";", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "blockSize", "+", "CACHELINE", ")", ";", "headerBuffer", "=", "(", "char", "*", ")", "malloc", "(", "LZ4S_MAXHEADERSIZE", ")", ";", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", "|", "|", "!", "(", "headerBuffer", ")", ")", "EXM_THROW", "(", "31", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "if", "(", "streamChecksum", ")", "streamChecksumState", "=", "XXH32_init", "(", "LZ4S_CHECKSUM_SEED", ")", ";", "/", "/", "Write", "Archive", "Header", "*", "(", "unsigned", "int", "*", ")", "headerBuffer", "=", "LITTLE_ENDIAN_32", "(", "LZ4S_MAGICNUMBER", ")", ";", "/", "/", "Magic", "Number", ",", "in", "Little", "Endian", "convention", "*", "(", "headerBuffer", "+", "4", ")", "=", "(", "1", "&", "_2BITS", ")", "<", "<", "6", ";", "/", "/", "Version", "(", "'", "01", "'", ")", "*", "(", "headerBuffer", "+", "4", ")", "|", "=", "(", "blockIndependence", "&", "_1BIT", ")", "<", "<", "5", ";", "*", "(", "headerBuffer", "+", "4", ")", "|", "=", "(", "blockChecksum", "&", "_1BIT", ")", "<", "<", "4", ";", "*", "(", "headerBuffer", "+", "4", ")", "|", "=", "(", "streamChecksum", "&", "_1BIT", ")", "<", "<", "2", ";", "*", "(", "headerBuffer", "+", "5", ")", "=", "(", "char", ")", "((", "blockSizeId", "&", "_3BITS", ")", "<", "<", "4", ")", ";", "checkbits", "=", "XXH32", "(", "(", "headerBuffer", "+", "4", ")", ",", "2", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "checkbits", "=", "LZ4S_GetCheckBits_FromXXH", "(", "checkbits", ")", ";", "*", "(", "headerBuffer", "+", "6", ")", "=", "(", "unsigned", "char", ")", "checkbits", ";", "header_size", "=", "7", ";", "/", "/", "Write", "header", "sizeCheck", "=", "fwrite", "(", "headerBuffer", ",", "1", ",", "header_size", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "header_size", ")", "EXM_THROW", "(", "32", ",", "\"", "Write", "error", ":", "cannot", "write", "header", "\"", ");", "compressedfilesize", "+", "=", "header_size", ";", "/", "/", "read", "first", "block", "readSize", "=", "fread", "(", "in_buff", ",", "(", "size_t", ")", "1", ",", "(", "size_t", ")", "blockSize", ",", "finput", ")", ";", "/", "/", "Main", "Loop", "while", "(", "readSize", ">", "0", ")", "{", "unsigned", "int", "outSize", ";", "filesize", "+", "=", "readSize", ";", "DISPLAYLEVEL", "(", "3", ",", "\"", "\\", "rRead", ":", "%", "i", "MB", "\"", ",", "(", "int", ")", "(", "filesize", ">", ">", "20", ")", ");", "if", "(", "streamChecksum", ")", "XXH32_update", "(", "streamChecksumState", ",", "in_buff", ",", "(", "int", ")", "readSize", ")", ";", "/", "/", "Compress", "Block", "outSize", "=", "compressionFunction", "(", "in_buff", ",", "out_buff", "+", "4", ",", "(", "int", ")", "readSize", ",", "(", "int", ")", "readSize", "-", "1", ",", "compressionLevel", ")", ";", "if", "(", "outSize", ">", "0", ")", "compressedfilesize", "+", "=", "outSize", "+", "4", ";", "else", "compressedfilesize", "+", "=", "readSize", "+", "4", ";", "if", "(", "blockChecksum", ")", "compressedfilesize", "+", "=", "4", ";", "DISPLAYLEVEL", "(", "3", ",", "\"", "==", ">", "%", ".", "2f", "%", "%", "\"", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "/", "/", "Write", "Block", "if", "(", "outSize", ">", "0", ")", "{", "int", "sizeToWrite", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "outSize", ")", ";", "if", "(", "blockChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "out_buff", "+", "4", ",", "outSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "*", "(", "unsigned", "int", "*", ")", "(", "out_buff", "+", "4", "+", "outSize", ")", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "}", "sizeToWrite", "=", "4", "+", "outSize", "+", "(", "4", "*", "blockChecksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "sizeToWrite", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "sizeToWrite", ")", ")", "EXM_THROW", "(", "33", ",", "\"", "Write", "error", ":", "cannot", "write", "compressed", "block", "\"", ");", "}", "else", "/", "/", "Copy", "Original", "Uncompressed", "{", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "((", "unsigned", "long", ")", "readSize", ")", "|", "0x80000000", ")", ";", "/", "/", "Add", "Uncompressed", "flag", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "34", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "header", "\"", ");", "sizeCheck", "=", "fwrite", "(", "in_buff", ",", "1", ",", "readSize", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "readSize", ")", "EXM_THROW", "(", "35", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "\"", ");", "if", "(", "blockChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "in_buff", ",", "(", "int", ")", "readSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "36", ",", "\"", "Write", "error", ":", "cannot", "write", "block", "checksum", "\"", ");", "}", "}", "/", "/", "Read", "next", "block", "readSize", "=", "fread", "(", "in_buff", ",", "(", "size_t", ")", "1", ",", "(", "size_t", ")", "blockSize", ",", "finput", ")", ";", "}", "/", "/", "End", "of", "Stream", "mark", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LZ4S_EOS", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "37", ",", "\"", "Write", "error", ":", "cannot", "write", "end", "of", "stream", "\"", ");", "compressedfilesize", "+", "=", "4", ";", "if", "(", "streamChecksum", ")", "{", "unsigned", "int", "checksum", "=", "XXH32_digest", "(", "streamChecksumState", ")", ";", "*", "(", "unsigned", "int", "*", ")", "out_buff", "=", "LITTLE_ENDIAN_32", "(", "checksum", ")", ";", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "4", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=(", "size_t", ")", "(", "4", ")", ")", "EXM_THROW", "(", "37", ",", "\"", "Write", "error", ":", "cannot", "write", "stream", "checksum", "\"", ");", "compressedfilesize", "+", "=", "4", ";", "}", "/", "/", "Close", "&", "Free", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "free", "(", "headerBuffer", ")", ";", "fclose", "(", "finput", ")", ";", "fclose", "(", "foutput", ")", ";", "/", "/", "Final", "Status", "end", "=", "clock", "(", ");", "DISPLAYLEVEL", "(", "2", ",", "\"", "\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "DISPLAYLEVEL", "(", "2", ",", "\"", "Compressed", "%", "llu", "bytes", "into", "%", "llu", "bytes", "=", "=>", "%", ".", "2f", "%", "%\\", "n", "\"", ",", "(", "unsigned", "long", "long", ")", "filesize", ",", "(", "unsigned", "long", "long", ")", "compressedfilesize", ",", "(", "double", ")", "compressedfilesize", "/", "filesize", "*", "100", ")", ";", "{", "double", "seconds", "=", "(", "double", ")", "(", "end", "-", "start", ")", "/", "CLOCKS_PER_SEC", ";", "DISPLAYLEVEL", "(", "4", ",", "\"", "Done", "in", "%", ".", "2f", "s", "=", "=>", "%", ".", "2f", "MB", "/", "s", "\\", "n", "\"", ",", "seconds", ",", "(", "double", ")", "filesize", "/", "seconds", "/", "1024", "/", "1024", ")", ";", "}", "return", "0", ";", "}", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "LZ4", "File", "/", "Stream", "decoding", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "static", "unsigned", "long", "long", "decodeLegacyStream", "(", "FILE", "*", "finput", ",", "FILE", "*", "foutput", ")", "{", "unsigned", "long", "long", "filesize", "=", "0", ";", "char", "*", "in_buff", ";", "char", "*", "out_buff", ";", "unsigned", "int", "blockSize", ";", "/", "/", "Allocate", "Memory", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "LZ4_compressBound", "(", "LEGACY_BLOCKSIZE", ")", ");", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "LEGACY_BLOCKSIZE", ")", ";", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", ")", "EXM_THROW", "(", "51", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "int", "decodeSize", ";", "size_t", "sizeCheck", ";", "/", "/", "Block", "Size", "sizeCheck", "=", "fread", "(", "&", "blockSize", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "sizeCheck", "=", "=", "0", ")", "break", ";", "/", "/", "Nothing", "to", "read", ":", "file", "read", "is", "completed", "blockSize", "=", "LITTLE_ENDIAN_32", "(", "blockSize", ")", ";", "/", "/", "Convert", "to", "Little", "Endian", "if", "(", "blockSize", ">", "LZ4_COMPRESSBOUND", "(", "LEGACY_BLOCKSIZE", ")", ")", "{", "/", "/", "Cannot", "read", "next", "block", ":", "maybe", "new", "stream", "?", "fseek", "(", "finput", ",", "-", "4", ",", "SEEK_CUR", ")", ";", "break", ";", "}", "/", "/", "Read", "Block", "sizeCheck", "=", "fread", "(", "in_buff", ",", "1", ",", "blockSize", ",", "finput", ")", ";", "/", "/", "Decode", "Block", "decodeSize", "=", "LZ4_decompress_safe", "(", "in_buff", ",", "out_buff", ",", "blockSize", ",", "LEGACY_BLOCKSIZE", ")", ";", "if", "(", "decodeSize", "<", "0", ")", "EXM_THROW", "(", "52", ",", "\"", "Decoding", "Failed", "!", "Corrupted", "input", "detected", "!", "\")", ";", "filesize", "+", "=", "decodeSize", ";", "/", "/", "Write", "Block", "sizeCheck", "=", "fwrite", "(", "out_buff", ",", "1", ",", "decodeSize", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "(", "size_t", ")", "decodeSize", ")", "EXM_THROW", "(", "53", ",", "\"", "Write", "error", ":", "cannot", "write", "decoded", "block", "into", "output", "\\", "n", "\"", ");", "}", "/", "/", "Free", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "return", "filesize", ";", "}", "static", "unsigned", "long", "long", "decodeLZ4S", "(", "FILE", "*", "finput", ",", "FILE", "*", "foutput", ")", "{", "unsigned", "long", "long", "filesize", "=", "0", ";", "char", "*", "in_buff", ";", "char", "*", "out_buff", ",", "*", "out_start", ",", "*", "out_end", ";", "unsigned", "char", "descriptor", "[", "LZ4S_MAXHEADERSIZE", "]", ";", "size_t", "nbReadBytes", ";", "int", "decodedBytes", "=", "0", ";", "unsigned", "int", "maxBlockSize", ";", "size_t", "sizeCheck", ";", "int", "blockChecksumFlag", ",", "streamChecksumFlag", ",", "blockIndependenceFlag", ";", "void", "*", "streamChecksumState", "=", "NULL", ";", "int", "(", "*", "decompressionFunction", ")", "(", "void", "*", "ctx", ",", "const", "char", "*", "src", ",", "char", "*", "dst", ",", "int", "cSize", ",", "int", "maxOSize", ")", "=", "LZ4_decompress_safe_continue", ";", "LZ4_streamDecode_t", "ctx", ";", "/", "/", "init", "memset", "(", "&", "ctx", ",", "0", ",", "sizeof", "(", "ctx", ")", ");", "/", "/", "Decode", "stream", "descriptor", "nbReadBytes", "=", "fread", "(", "descriptor", ",", "1", ",", "3", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "!", "=", "3", ")", "EXM_THROW", "(", "61", ",", "\"", "Unreadable", "header", "\"", ");", "{", "int", "version", "=", "(", "descriptor", "[", "0", "]", ">", ">", "6", ")", "&", "_2BITS", ";", "int", "streamSize", "=", "(", "descriptor", "[", "0", "]", ">", ">", "3", ")", "&", "_1BIT", ";", "int", "reserved1", "=", "(", "descriptor", "[", "0", "]", ">", ">", "1", ")", "&", "_1BIT", ";", "int", "dictionary", "=", "(", "descriptor", "[", "0", "]", ">", ">", "0", ")", "&", "_1BIT", ";", "int", "reserved2", "=", "(", "descriptor", "[", "1", "]", ">", ">", "7", ")", "&", "_1BIT", ";", "int", "blockSizeId", "=", "(", "descriptor", "[", "1", "]", ">", ">", "4", ")", "&", "_3BITS", ";", "int", "reserved3", "=", "(", "descriptor", "[", "1", "]", ">", ">", "0", ")", "&", "_4BITS", ";", "int", "checkBits", "=", "(", "descriptor", "[", "2", "]", ">", ">", "0", ")", "&", "_8BITS", ";", "int", "checkBits_xxh32", ";", "blockIndependenceFlag", "=", "(", "descriptor", "[", "0", "]", ">", ">", "5", ")", "&", "_1BIT", ";", "blockChecksumFlag", "=", "(", "descriptor", "[", "0", "]", ">", ">", "4", ")", "&", "_1BIT", ";", "streamChecksumFlag", "=", "(", "descriptor", "[", "0", "]", ">", ">", "2", ")", "&", "_1BIT", ";", "if", "(", "version", "!", "=", "1", ")", "EXM_THROW", "(", "62", ",", "\"", "Wrong", "version", "number", "\"", ");", "if", "(", "streamSize", "=", "=", "1", ")", "EXM_THROW", "(", "64", ",", "\"", "Does", "not", "support", "stream", "size", "\"", ");", "if", "(", "reserved1", "!", "=", "0", ")", "EXM_THROW", "(", "65", ",", "\"", "Wrong", "value", "for", "reserved", "bits", "\"", ");", "if", "(", "dictionary", "=", "=", "1", ")", "EXM_THROW", "(", "66", ",", "\"", "Does", "not", "support", "dictionary", "\"", ");", "if", "(", "reserved2", "!", "=", "0", ")", "EXM_THROW", "(", "67", ",", "\"", "Wrong", "value", "for", "reserved", "bits", "\"", ");", "if", "(", "blockSizeId", "<", "4", ")", "EXM_THROW", "(", "68", ",", "\"", "Unsupported", "block", "size", "\"", ");", "if", "(", "reserved3", "!", "=", "0", ")", "EXM_THROW", "(", "67", ",", "\"", "Wrong", "value", "for", "reserved", "bits", "\"", ");", "maxBlockSize", "=", "LZ4S_GetBlockSize_FromBlockId", "(", "blockSizeId", ")", ";", "/", "/", "Checkbits", "verification", "descriptor", "[", "1", "]", "&", "=", "0xF0", ";", "checkBits_xxh32", "=", "XXH32", "(", "descriptor", ",", "2", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "checkBits_xxh32", "=", "LZ4S_GetCheckBits_FromXXH", "(", "checkBits_xxh32", ")", ";", "if", "(", "checkBits", "!", "=", "checkBits_xxh32", ")", "EXM_THROW", "(", "69", ",", "\"", "Stream", "descriptor", "error", "detected", "\"", ");", "}", "/", "/", "Allocate", "Memory", "{", "size_t", "outBuffSize", "=", "maxBlockSize", "+", "64", "KB", ";", "if", "(", "outBuffSize", "<", "MIN_STREAM_BUFSIZE", ")", "outBuffSize", "=", "MIN_STREAM_BUFSIZE", ";", "in_buff", "=", "(", "char", "*", ")", "malloc", "(", "maxBlockSize", ")", ";", "out_buff", "=", "(", "char", "*", ")", "malloc", "(", "outBuffSize", ")", ";", "out_start", "=", "out_buff", ";", "out_end", "=", "out_start", "+", "outBuffSize", ";", "if", "(", "!", "in_buff", "|", "|", "!", "out_buff", ")", "EXM_THROW", "(", "70", ",", "\"", "Allocation", "error", ":", "not", "enough", "memory", "\"", ");", "if", "(", "streamChecksumFlag", ")", "streamChecksumState", "=", "XXH32_init", "(", "LZ4S_CHECKSUM_SEED", ")", ";", "}", "/", "/", "Main", "Loop", "while", "(", "1", ")", "{", "unsigned", "int", "blockSize", ",", "uncompressedFlag", ";", "/", "/", "Block", "Size", "nbReadBytes", "=", "fread", "(", "&", "blockSize", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "!", "=", "4", ")", "EXM_THROW", "(", "71", ",", "\"", "Read", "error", ":", "cannot", "read", "next", "block", "size", "\"", ");", "if", "(", "blockSize", "=", "=", "LZ4S_EOS", ")", "break", ";", "/", "/", "End", "of", "Stream", "Mark", ":", "stream", "is", "completed", "blockSize", "=", "LITTLE_ENDIAN_32", "(", "blockSize", ")", ";", "/", "/", "Convert", "to", "little", "endian", "uncompressedFlag", "=", "blockSize", ">", ">", "31", ";", "blockSize", "&", "=", "0x7FFFFFFF", ";", "if", "(", "blockSize", ">", "maxBlockSize", ")", "EXM_THROW", "(", "72", ",", "\"", "Error", ":", "invalid", "block", "size", "\"", ");", "/", "/", "Read", "Block", "nbReadBytes", "=", "fread", "(", "in_buff", ",", "1", ",", "blockSize", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "!", "=", "blockSize", ")", "EXM_THROW", "(", "73", ",", "\"", "Read", "error", ":", "cannot", "read", "data", "block", "\"", ")", ";", "/", "/", "Check", "Block", "if", "(", "blockChecksumFlag", ")", "{", "unsigned", "int", "checksum", "=", "XXH32", "(", "in_buff", ",", "blockSize", ",", "LZ4S_CHECKSUM_SEED", ")", ";", "unsigned", "int", "readChecksum", ";", "sizeCheck", "=", "fread", "(", "&", "readChecksum", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "sizeCheck", "!", "=", "4", ")", "EXM_THROW", "(", "74", ",", "\"", "Read", "error", ":", "cannot", "read", "next", "block", "size", "\"", ");", "readChecksum", "=", "LITTLE_ENDIAN_32", "(", "readChecksum", ")", ";", "/", "/", "Convert", "to", "little", "endian", "if", "(", "checksum", "!", "=", "readChecksum", ")", "EXM_THROW", "(", "75", ",", "\"", "Error", ":", "invalid", "block", "checksum", "detected", "\"", ");", "}", "if", "(", "uncompressedFlag", ")", "{", "/", "/", "Write", "uncompressed", "Block", "sizeCheck", "=", "fwrite", "(", "in_buff", ",", "1", ",", "blockSize", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "(", "size_t", ")", "blockSize", ")", "EXM_THROW", "(", "76", ",", "\"", "Write", "error", ":", "cannot", "write", "data", "block", "\"", ");", "filesize", "+", "=", "blockSize", ";", "if", "(", "streamChecksumFlag", ")", "XXH32_update", "(", "streamChecksumState", ",", "in_buff", ",", "blockSize", ")", ";", "if", "(", "!", "blockIndependenceFlag", ")", "{", "/", "/", "handle", "dictionary", "for", "streaming", "memcpy", "(", "in_buff", "+", "blockSize", "-", "64", "KB", ",", "out_buff", ",", "64", "KB", ")", ";", "LZ4_setDictDecode", "(", "&", "ctx", ",", "out_buff", ",", "64", "KB", ")", ";", "out_start", "=", "out_buff", "+", "64", "KB", ";", "}", "}", "else", "{", "/", "/", "Decode", "Block", "if", "(", "out_start", "+", "maxBlockSize", ">", "out_end", ")", "out_start", "=", "out_buff", ";", "decodedBytes", "=", "decompressionFunction", "(", "&", "ctx", ",", "in_buff", ",", "out_start", ",", "blockSize", ",", "maxBlockSize", ")", ";", "if", "(", "decodedBytes", "<", "0", ")", "EXM_THROW", "(", "77", ",", "\"", "Decoding", "Failed", "!", "Corrupted", "input", "detected", "!", "\")", ";", "filesize", "+", "=", "decodedBytes", ";", "if", "(", "streamChecksumFlag", ")", "XXH32_update", "(", "streamChecksumState", ",", "out_start", ",", "decodedBytes", ")", ";", "/", "/", "Write", "Block", "sizeCheck", "=", "fwrite", "(", "out_start", ",", "1", ",", "decodedBytes", ",", "foutput", ")", ";", "if", "(", "sizeCheck", "!", "=", "(", "size_t", ")", "decodedBytes", ")", "EXM_THROW", "(", "78", ",", "\"", "Write", "error", ":", "cannot", "write", "decoded", "block", "\\", "n", "\"", ");", "out_start", "+", "=", "decodedBytes", ";", "}", "}", "/", "/", "Stream", "Checksum", "if", "(", "streamChecksumFlag", ")", "{", "unsigned", "int", "checksum", "=", "XXH32_digest", "(", "streamChecksumState", ")", ";", "unsigned", "int", "readChecksum", ";", "sizeCheck", "=", "fread", "(", "&", "readChecksum", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "sizeCheck", "!", "=", "4", ")", "EXM_THROW", "(", "74", ",", "\"", "Read", "error", ":", "cannot", "read", "stream", "checksum", "\"", ");", "readChecksum", "=", "LITTLE_ENDIAN_32", "(", "readChecksum", ")", ";", "/", "/", "Convert", "to", "little", "endian", "if", "(", "checksum", "!", "=", "readChecksum", ")", "EXM_THROW", "(", "79", ",", "\"", "Error", ":", "invalid", "stream", "checksum", "detected", "\"", ");", "}", "/", "/", "Free", "free", "(", "in_buff", ")", ";", "free", "(", "out_buff", ")", ";", "return", "filesize", ";", "}", "static", "unsigned", "long", "long", "selectDecoder", "(", "FILE", "*", "finput", ",", "FILE", "*", "foutput", ")", "{", "unsigned", "int", "magicNumber", ",", "size", ";", "int", "errorNb", ";", "size_t", "nbReadBytes", ";", "/", "/", "Check", "Archive", "Header", "nbReadBytes", "=", "fread", "(", "&", "magicNumber", ",", "1", ",", "MAGICNUMBER_SIZE", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "=", "=", "0", ")", "return", "0", ";", "/", "/", "EOF", "if", "(", "nbReadBytes", "!", "=", "MAGICNUMBER_SIZE", ")", "EXM_THROW", "(", "41", ",", "\"", "Unrecognized", "header", ":", "Magic", "Number", "unreadable", "\"", ");", "magicNumber", "=", "LITTLE_ENDIAN_32", "(", "magicNumber", ")", ";", "/", "/", "Convert", "to", "Little", "Endian", "format", "if", "(", "LZ4S_isSkippableMagicNumber", "(", "magicNumber", ")", ")", "magicNumber", "=", "LZ4S_SKIPPABLE0", ";", "/", "/", "fold", "skippable", "magic", "numbers", "switch", "(", "magicNumber", ")", "{", "case", "LZ4S_MAGICNUMBER", ":", "return", "DEFAULT_DECOMPRESSOR", "(", "finput", ",", "foutput", ")", ";", "case", "LEGACY_MAGICNUMBER", ":", "DISPLAYLEVEL", "(", "4", ",", "\"", "Detected", ":", "Legacy", "format", "\\", "n", "\"", ");", "return", "decodeLegacyStream", "(", "finput", ",", "foutput", ")", ";", "case", "LZ4S_SKIPPABLE0", ":", "DISPLAYLEVEL", "(", "4", ",", "\"", "Skipping", "detected", "skippable", "area", "\\", "n", "\"", ");", "nbReadBytes", "=", "fread", "(", "&", "size", ",", "1", ",", "4", ",", "finput", ")", ";", "if", "(", "nbReadBytes", "!", "=", "4", ")", "EXM_THROW", "(", "42", ",", "\"", "Stream", "error", ":", "skippable", "size", "unreadable", "\"", ");", "size", "=", "LITTLE_ENDIAN_32", "(", "size", ")", ";", "/", "/", "Convert", "to", "Little", "Endian", "format", "errorNb", "=", "fseek", "(", "finput", ",", "size", ",", "SEEK_CUR", ")", ";", "if", "(", "errorNb", "!", "=", "0", ")", "EXM_THROW", "(", "43", ",", "\"", "Stream", "error", ":", "cannot", "skip", "skippable", "area", "\"", ");", "return", "selectDecoder", "(", "finput", ",", "foutput", ")", ";", "EXTENDED_FORMAT", ";", "default", ":", "if", "(", "ftell", "(", "finput", ")", "=", "=", "MAGICNUMBER_SIZE", ")", "EXM_THROW", "(", "44", ",", "\"", "Unrecognized", "header", ":", "file", "cannot", "be", "decoded", "\"", ");", "/", "/", "Wrong", "magic", "number", "at", "the", "beginning", "of", "1st", "stream", "DISPLAYLEVEL", "(", "2", ",", "\"", "Stream", "followed", "by", "unrecognized", "data", "\\", "n", "\"", ");", "return", "0", ";", "}", "}", "int", "LZ4IO_decompressFilename", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ")", "{", "unsigned", "long", "long", "filesize", "=", "0", ",", "decodedSize", "=", "0", ";", "FILE", "*", "finput", ";", "FILE", "*", "foutput", ";", "clock_t", "start", ",", "end", ";", "/", "/", "Init", "start", "=", "clock", "(", ");", "get_fileHandle", "(", "input_filename", ",", "output_filename", ",", "&", "finput", ",", "&", "foutput", ")", ";", "/", "/", "Loop", "over", "multiple", "streams", "do", "{", "decodedSize", "=", "selectDecoder", "(", "finput", ",", "foutput", ")", ";", "filesize", "+", "=", "decodedSize", ";", "}", "while", "(", "decodedSize", ")", ";", "/", "/", "Final", "Status", "end", "=", "clock", "(", ");", "DISPLAYLEVEL", "(", "2", ",", "\"", "\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "DISPLAYLEVEL", "(", "2", ",", "\"", "Successfully", "decoded", "%", "llu", "bytes", "\\", "n", "\"", ",", "filesize", ")", ";", "{", "double", "seconds", "=", "(", "double", ")", "(", "end", "-", "start", ")", "/", "CLOCKS_PER_SEC", ";", "DISPLAYLEVEL", "(", "4", ",", "\"", "Done", "in", "%", ".", "2f", "s", "=", "=>", "%", ".", "2f", "MB", "/", "s", "\\", "n", "\"", ",", "seconds", ",", "(", "double", ")", "filesize", "/", "seconds", "/", "1024", "/", "1024", ")", ";", "}", "/", "/", "Close", "fclose", "(", "finput", ")", ";", "fclose", "(", "foutput", ")", ";", "/", "/", "Error", "status", "=", "OK", "return", "0", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "77", "@", "@", "/", "*", "LZ4io", ".", "h", "-", "LZ4", "File", "/", "Stream", "Interface", "Copyright", "(", "C", ")", "Yann", "Collet", "2011", "-", "2014", "GPL", "v2", "License", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "LZ4", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "lz4", "/", "-", "LZ4", "public", "forum", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "#!", "forum", "/", "lz4c", "*", "/", "/", "*", "Note", ":", "this", "is", "stand", "-", "alone", "program", ".", "It", "is", "not", "part", "of", "LZ4", "compression", "library", ",", "it", "is", "a", "user", "code", "of", "the", "LZ4", "library", ".", "-", "The", "license", "of", "LZ4", "library", "is", "BSD", ".", "-", "The", "license", "of", "xxHash", "library", "is", "BSD", ".", "-", "The", "license", "of", "this", "source", "file", "is", "GPLv2", ".", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "Special", "input", "/", "output", "values", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "#", "define", "NULL_OUTPUT", "\"", "null", "\"", "static", "char", "stdinmark", "[", "]", "=", "\"", "stdin", "\"", ";", "static", "char", "stdoutmark", "[", "]", "=", "\"", "stdout", "\"", ";", "#", "ifdef", "_WIN32", "static", "char", "nulmark", "[", "]", "=", "\"", "nul", "\"", ";", "#", "else", "static", "char", "nulmark", "[", "]", "=", "\"", "/", "dev", "/", "null", "\"", ";", "#", "endif", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Functions", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "int", "LZ4IO_compressFilename", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ",", "int", "compressionlevel", ")", ";", "int", "LZ4IO_decompressFilename", "(", "char", "*", "input_filename", ",", "char", "*", "output_filename", ")", ";", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Parameters", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "/", "*", "Default", "setting", ":", "overwrite", "=", "1", ";", "return", ":", "overwrite", "mode", "(", "0", "/", "1", ")", "*", "/", "int", "LZ4IO_setOverwrite", "(", "int", "yes", ")", ";", "/", "*", "blockSizeID", ":", "valid", "values", ":", "4", "-", "5", "-", "6", "-", "7", "return", ":", "-", "1", "if", "error", ",", "blockSize", "if", "OK", "*", "/", "int", "LZ4IO_setBlockSizeID", "(", "int", "blockSizeID", ")", ";", "/", "*", "Default", "setting", ":", "independent", "blocks", "*", "/", "typedef", "enum", "{", "chainedBlocks", ",", "independentBlocks", "}", "blockMode_t", ";", "int", "LZ4IO_setBlockMode", "(", "blockMode_t", "blockMode", ")", ";", "/", "*", "Default", "setting", ":", "no", "checksum", "*", "/", "int", "LZ4IO_setBlockChecksumMode", "(", "int", "xxhash", ")", ";", "/", "*", "Default", "setting", ":", "checksum", "enabled", "*", "/", "int", "LZ4IO_setStreamChecksumMode", "(", "int", "xxhash", ")", ";", "/", "*", "Default", "setting", ":", "0", "(", "no", "notification", ")", "*", "/", "int", "LZ4IO_setNotificationLevel", "(", "int", "level", ")", ";", "@", "@", "-", "1", ",", "475", "+", "1", ",", "475", "@", "@", "/", "*", "xxHash", "-", "Fast", "Hash", "algorithm", "Copyright", "(", "C", ")", "2012", "-", "2013", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Tuning", "parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Unaligned", "memory", "access", "is", "automatically", "enabled", "for", "\"", "common", "\"", "CPU", ",", "such", "as", "x86", ".", "/", "/", "For", "others", "CPU", ",", "the", "compiler", "will", "be", "more", "cautious", ",", "and", "insert", "extra", "code", "to", "ensure", "aligned", "access", "is", "respected", ".", "/", "/", "If", "you", "know", "your", "target", "CPU", "supports", "unaligned", "memory", "access", ",", "you", "want", "to", "force", "this", "option", "manually", "to", "improve", "performance", ".", "/", "/", "You", "can", "also", "enable", "this", "parameter", "if", "you", "know", "your", "input", "data", "will", "always", "be", "aligned", "(", "boundaries", "of", "4", ",", "for", "U32", ")", ".", "#", "if", "defined", "(", "__ARM_FEATURE_UNALIGNED", ")", "|", "|", "defined", "(", "__i386", ")", "|", "|", "defined", "(", "_M_IX86", ")", "|", "|", "defined", "(", "__x86_64__", ")", "|", "|", "defined", "(", "_M_X64", ")", "#", "define", "XXH_USE_UNALIGNED_ACCESS", "1", "#", "endif", "/", "/", "XXH_ACCEPT_NULL_INPUT_POINTER", ":", "/", "/", "If", "the", "input", "pointer", "is", "a", "null", "pointer", ",", "xxHash", "default", "behavior", "is", "to", "trigger", "a", "memory", "access", "error", ",", "since", "it", "is", "a", "bad", "pointer", ".", "/", "/", "When", "this", "option", "is", "enabled", ",", "xxHash", "output", "for", "null", "input", "pointers", "will", "be", "the", "same", "as", "a", "null", "-", "length", "input", ".", "/", "/", "This", "option", "has", "a", "very", "small", "performance", "cost", "(", "only", "measurable", "on", "small", "inputs", ")", ".", "/", "/", "By", "default", ",", "this", "option", "is", "disabled", ".", "To", "enable", "it", ",", "uncomment", "below", "define", ":", "/", "/#", "define", "XXH_ACCEPT_NULL_INPUT_POINTER", "1", "/", "/", "XXH_FORCE_NATIVE_FORMAT", ":", "/", "/", "By", "default", ",", "xxHash", "library", "provides", "endian", "-", "independant", "Hash", "values", ",", "based", "on", "little", "-", "endian", "convention", ".", "/", "/", "Results", "are", "therefore", "identical", "for", "little", "-", "endian", "and", "big", "-", "endian", "CPU", ".", "/", "/", "This", "comes", "at", "a", "performance", "cost", "for", "big", "-", "endian", "CPU", ",", "since", "some", "swapping", "is", "required", "to", "emulate", "little", "-", "endian", "format", ".", "/", "/", "Should", "endian", "-", "independance", "be", "of", "no", "importance", "for", "your", "application", ",", "you", "may", "set", "the", "#", "define", "below", "to", "1", ".", "/", "/", "It", "will", "improve", "speed", "for", "Big", "-", "endian", "CPU", ".", "/", "/", "This", "option", "has", "no", "impact", "on", "Little_Endian", "CPU", ".", "#", "define", "XXH_FORCE_NATIVE_FORMAT", "0", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Specific", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "/", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "define", "forceinline", "static", "__forceinline", "#", "else", "#", "ifdef", "__GNUC__", "#", "define", "forceinline", "static", "inline", "__attribute__", "(", "(", "always_inline", ")", ")", "#", "else", "#", "define", "forceinline", "static", "inline", "#", "endif", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "&", "Memory", "related", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/", "Modify", "the", "local", "functions", "below", "should", "you", "wish", "to", "use", "some", "other", "memory", "related", "routines", "/", "/", "for", "malloc", "(", "),", "free", "(", ")", "#", "include", "<", "stdlib", ".", "h", ">", "forceinline", "void", "*", "XXH_malloc", "(", "size_t", "s", ")", "{", "return", "malloc", "(", "s", ")", ";", "}", "forceinline", "void", "XXH_free", "(", "void", "*", "p", ")", "{", "free", "(", "p", ")", ";", "}", "/", "/", "for", "memcpy", "(", ")", "#", "include", "<", "string", ".", "h", ">", "forceinline", "void", "*", "XXH_memcpy", "(", "void", "*", "dest", ",", "const", "void", "*", "src", ",", "size_t", "size", ")", "{", "return", "memcpy", "(", "dest", ",", "src", ",", "size", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "#", "if", "defined", "(", "__GNUC__", ")", "&", "&", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "#", "define", "_PACKED", "__attribute__", "(", "(", "packed", ")", ")", "#", "else", "#", "define", "_PACKED", "#", "endif", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "ifdef", "__IBMC__", "#", "pragma", "pack", "(", "1", ")", "#", "else", "#", "pragma", "pack", "(", "push", ",", "1", ")", "#", "endif", "#", "endif", "typedef", "struct", "_U32_S", "{", "U32", "v", ";", "}", "_PACKED", "U32_S", ";", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "pragma", "pack", "(", "pop", ")", "#", "endif", "#", "define", "A32", "(", "x", ")", "(", "((", "U32_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Compiler", "-", "specific", "Functions", "and", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "#", "define", "GCC_VERSION", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", "/", "/", "Note", ":", "although", "_rotl", "exists", "for", "minGW", "(", "GCC", "under", "windows", ")", ",", "performance", "seems", "poor", "#", "if", "defined", "(", "_MSC_VER", ")", "#", "define", "XXH_rotl32", "(", "x", ",", "r", ")", "_rotl", "(", "x", ",", "r", ")", "#", "else", "#", "define", "XXH_rotl32", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "#", "endif", "#", "if", "defined", "(", "_MSC_VER", ")", "/", "/", "Visual", "Studio", "#", "define", "XXH_swap32", "_byteswap_ulong", "#", "elif", "GCC_VERSION", ">", "=", "403", "#", "define", "XXH_swap32", "__builtin_bswap32", "#", "else", "static", "inline", "U32", "XXH_swap32", "(", "U32", "x", ")", "{", "return", "(", "(", "x", "<", "<", "24", ")", "&", "0xff000000", ")", "|", "(", "(", "x", "<", "<", "8", ")", "&", "0x00ff0000", ")", "|", "(", "(", "x", ">", ">", "8", ")", "&", "0x0000ff00", ")", "|", "(", "(", "x", ">", ">", "24", ")", "&", "0x000000ff", ")", ";}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "PRIME32_1", "2654435761U", "#", "define", "PRIME32_2", "2246822519U", "#", "define", "PRIME32_3", "3266489917U", "#", "define", "PRIME32_4", "668265263U", "#", "define", "PRIME32_5", "374761393U", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Architecture", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_bigEndian", "=", "0", ",", "XXH_littleEndian", "=", "1", "}", "XXH_endianess", ";", "#", "ifndef", "XXH_CPU_LITTLE_ENDIAN", "/", "/", "It", "is", "possible", "to", "define", "XXH_CPU_LITTLE_ENDIAN", "externally", ",", "for", "example", "using", "a", "compiler", "switch", "static", "const", "int", "one", "=", "1", ";", "#", "define", "XXH_CPU_LITTLE_ENDIAN", "(", "*(", "char", "*", ")(", "&", "one", ")", ")", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "XXH_STATIC_ASSERT", "(", "c", ")", "{", "enum", "{", "XXH_static_assert", "=", "1", "/", "(!", "!(", "c", ")", ")", "}", ";", "}", "/", "/", "use", "only", "*", "after", "*", "variable", "declarations", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Memory", "reads", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_aligned", ",", "XXH_unaligned", "}", "XXH_alignment", ";", "forceinline", "U32", "XXH_readLE32_align", "(", "const", "U32", "*", "ptr", ",", "XXH_endianess", "endian", ",", "XXH_alignment", "align", ")", "{", "if", "(", "align", "=", "=", "XXH_unaligned", ")", "return", "endian", "=", "=", "XXH_littleEndian", "?", "A32", "(", "ptr", ")", ":", "XXH_swap32", "(", "A32", "(", "ptr", ")", ");", "else", "return", "endian", "=", "=", "XXH_littleEndian", "?", "*", "ptr", ":", "XXH_swap32", "(", "*", "ptr", ")", ";", "}", "forceinline", "U32", "XXH_readLE32", "(", "const", "U32", "*", "ptr", ",", "XXH_endianess", "endian", ")", "{", "return", "XXH_readLE32_align", "(", "ptr", ",", "endian", ",", "XXH_unaligned", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Simple", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "forceinline", "U32", "XXH32_endian_align", "(", "const", "void", "*", "input", ",", "int", "len", ",", "U32", "seed", ",", "XXH_endianess", "endian", ",", "XXH_alignment", "align", ")", "{", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "input", ";", "const", "BYTE", "*", "const", "bEnd", "=", "p", "+", "len", ";", "U32", "h32", ";", "#", "ifdef", "XXH_ACCEPT_NULL_INPUT_POINTER", "if", "(", "p", "=", "=", "NULL", ")", "{", "len", "=", "0", ";", "p", "=", "(", "const", "BYTE", "*", ")(", "size_t", ")", "16", ";", "}", "#", "endif", "if", "(", "len", ">", "=", "16", ")", "{", "const", "BYTE", "*", "const", "limit", "=", "bEnd", "-", "16", ";", "U32", "v1", "=", "seed", "+", "PRIME32_1", "+", "PRIME32_2", ";", "U32", "v2", "=", "seed", "+", "PRIME32_2", ";", "U32", "v3", "=", "seed", "+", "0", ";", "U32", "v4", "=", "seed", "-", "PRIME32_1", ";", "do", "{", "v1", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v1", "=", "XXH_rotl32", "(", "v1", ",", "13", ")", ";", "v1", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v2", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v2", "=", "XXH_rotl32", "(", "v2", ",", "13", ")", ";", "v2", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v3", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v3", "=", "XXH_rotl32", "(", "v3", ",", "13", ")", ";", "v3", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v4", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v4", "=", "XXH_rotl32", "(", "v4", ",", "13", ")", ";", "v4", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "=", "limit", ")", ";", "h32", "=", "XXH_rotl32", "(", "v1", ",", "1", ")", "+", "XXH_rotl32", "(", "v2", ",", "7", ")", "+", "XXH_rotl32", "(", "v3", ",", "12", ")", "+", "XXH_rotl32", "(", "v4", ",", "18", ")", ";", "}", "else", "{", "h32", "=", "seed", "+", "PRIME32_5", ";", "}", "h32", "+", "=", "(", "U32", ")", "len", ";", "while", "(", "p", "<", "=", "bEnd", "-", "4", ")", "{", "h32", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_3", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "17", ")", "*", "PRIME32_4", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "bEnd", ")", "{", "h32", "+", "=", "(", "*", "p", ")", "*", "PRIME32_5", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "11", ")", "*", "PRIME32_1", ";", "p", "+", "+;", "}", "h32", "^", "=", "h32", ">", ">", "15", ";", "h32", "*", "=", "PRIME32_2", ";", "h32", "^", "=", "h32", ">", ">", "13", ";", "h32", "*", "=", "PRIME32_3", ";", "h32", "^", "=", "h32", ">", ">", "16", ";", "return", "h32", ";", "}", "U32", "XXH32", "(", "const", "void", "*", "input", ",", "int", "len", ",", "U32", "seed", ")", "{", "#", "if", "0", "/", "/", "Simple", "version", ",", "good", "for", "code", "maintenance", ",", "but", "unfortunately", "slow", "for", "small", "inputs", "void", "*", "state", "=", "XXH32_init", "(", "seed", ")", ";", "XXH32_update", "(", "state", ",", "input", ",", "len", ")", ";", "return", "XXH32_digest", "(", "state", ")", ";", "#", "else", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "if", "(", "((", "(", "size_t", ")", "input", ")", "&", "3", ")", ")", "/", "/", "Input", "is", "aligned", ",", "let", "'", "s", "leverage", "the", "speed", "advantage", "{", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_littleEndian", ",", "XXH_aligned", ")", ";", "else", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_bigEndian", ",", "XXH_aligned", ")", ";", "}", "#", "endif", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_littleEndian", ",", "XXH_unaligned", ")", ";", "else", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_bigEndian", ",", "XXH_unaligned", ")", ";", "#", "endif", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Advanced", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "struct", "XXH_state32_t", "{", "U64", "total_len", ";", "U32", "seed", ";", "U32", "v1", ";", "U32", "v2", ";", "U32", "v3", ";", "U32", "v4", ";", "int", "memsize", ";", "char", "memory", "[", "16", "]", ";", "}", ";", "int", "XXH32_sizeofState", "(", ")", "{", "XXH_STATIC_ASSERT", "(", "XXH32_SIZEOFSTATE", ">", "=", "sizeof", "(", "struct", "XXH_state32_t", ")", ");", "/", "/", "A", "compilation", "error", "here", "means", "XXH32_SIZEOFSTATE", "is", "not", "large", "enough", "return", "sizeof", "(", "struct", "XXH_state32_t", ")", ";", "}", "XXH_errorcode", "XXH32_resetState", "(", "void", "*", "state_in", ",", "U32", "seed", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "state", "-", ">", "seed", "=", "seed", ";", "state", "-", ">", "v1", "=", "seed", "+", "PRIME32_1", "+", "PRIME32_2", ";", "state", "-", ">", "v2", "=", "seed", "+", "PRIME32_2", ";", "state", "-", ">", "v3", "=", "seed", "+", "0", ";", "state", "-", ">", "v4", "=", "seed", "-", "PRIME32_1", ";", "state", "-", ">", "total_len", "=", "0", ";", "state", "-", ">", "memsize", "=", "0", ";", "return", "XXH_OK", ";", "}", "void", "*", "XXH32_init", "(", "U32", "seed", ")", "{", "void", "*", "state", "=", "XXH_malloc", "(", "sizeof", "(", "struct", "XXH_state32_t", ")", ");", "XXH32_resetState", "(", "state", ",", "seed", ")", ";", "return", "state", ";", "}", "forceinline", "XXH_errorcode", "XXH32_update_endian", "(", "void", "*", "state_in", ",", "const", "void", "*", "input", ",", "int", "len", ",", "XXH_endianess", "endian", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "input", ";", "const", "BYTE", "*", "const", "bEnd", "=", "p", "+", "len", ";", "#", "ifdef", "XXH_ACCEPT_NULL_INPUT_POINTER", "if", "(", "input", "=", "=", "NULL", ")", "return", "XXH_ERROR", ";", "#", "endif", "state", "-", ">", "total_len", "+", "=", "len", ";", "if", "(", "state", "-", ">", "memsize", "+", "len", "<", "16", ")", "/", "/", "fill", "in", "tmp", "buffer", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ",", "input", ",", "len", ")", ";", "state", "-", ">", "memsize", "+", "=", "len", ";", "return", "XXH_OK", ";", "}", "if", "(", "state", "-", ">", "memsize", ")", "/", "/", "some", "data", "left", "from", "previous", "update", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ",", "input", ",", "16", "-", "state", "-", ">", "memsize", ")", ";", "{", "const", "U32", "*", "p32", "=", "(", "const", "U32", "*", ")", "state", "-", ">", "memory", ";", "state", "-", ">", "v1", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v1", "=", "XXH_rotl32", "(", "state", "-", ">", "v1", ",", "13", ")", ";", "state", "-", ">", "v1", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v2", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v2", "=", "XXH_rotl32", "(", "state", "-", ">", "v2", ",", "13", ")", ";", "state", "-", ">", "v2", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v3", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v3", "=", "XXH_rotl32", "(", "state", "-", ">", "v3", ",", "13", ")", ";", "state", "-", ">", "v3", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v4", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v4", "=", "XXH_rotl32", "(", "state", "-", ">", "v4", ",", "13", ")", ";", "state", "-", ">", "v4", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "}", "p", "+", "=", "16", "-", "state", "-", ">", "memsize", ";", "state", "-", ">", "memsize", "=", "0", ";", "}", "if", "(", "p", "<", "=", "bEnd", "-", "16", ")", "{", "const", "BYTE", "*", "const", "limit", "=", "bEnd", "-", "16", ";", "U32", "v1", "=", "state", "-", ">", "v1", ";", "U32", "v2", "=", "state", "-", ">", "v2", ";", "U32", "v3", "=", "state", "-", ">", "v3", ";", "U32", "v4", "=", "state", "-", ">", "v4", ";", "do", "{", "v1", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v1", "=", "XXH_rotl32", "(", "v1", ",", "13", ")", ";", "v1", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v2", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v2", "=", "XXH_rotl32", "(", "v2", ",", "13", ")", ";", "v2", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v3", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v3", "=", "XXH_rotl32", "(", "v3", ",", "13", ")", ";", "v3", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v4", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v4", "=", "XXH_rotl32", "(", "v4", ",", "13", ")", ";", "v4", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "=", "limit", ")", ";", "state", "-", ">", "v1", "=", "v1", ";", "state", "-", ">", "v2", "=", "v2", ";", "state", "-", ">", "v3", "=", "v3", ";", "state", "-", ">", "v4", "=", "v4", ";", "}", "if", "(", "p", "<", "bEnd", ")", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", ",", "p", ",", "bEnd", "-", "p", ")", ";", "state", "-", ">", "memsize", "=", "(", "int", ")", "(", "bEnd", "-", "p", ")", ";", "}", "return", "XXH_OK", ";", "}", "XXH_errorcode", "XXH32_update", "(", "void", "*", "state_in", ",", "const", "void", "*", "input", ",", "int", "len", ")", "{", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_update_endian", "(", "state_in", ",", "input", ",", "len", ",", "XXH_littleEndian", ")", ";", "else", "return", "XXH32_update_endian", "(", "state_in", ",", "input", ",", "len", ",", "XXH_bigEndian", ")", ";", "}", "forceinline", "U32", "XXH32_intermediateDigest_endian", "(", "void", "*", "state_in", ",", "XXH_endianess", "endian", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "state", "-", ">", "memory", ";", "BYTE", "*", "bEnd", "=", "(", "BYTE", "*", ")", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ";", "U32", "h32", ";", "if", "(", "state", "-", ">", "total_len", ">", "=", "16", ")", "{", "h32", "=", "XXH_rotl32", "(", "state", "-", ">", "v1", ",", "1", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v2", ",", "7", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v3", ",", "12", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v4", ",", "18", ")", ";", "}", "else", "{", "h32", "=", "state", "-", ">", "seed", "+", "PRIME32_5", ";", "}", "h32", "+", "=", "(", "U32", ")", "state", "-", ">", "total_len", ";", "while", "(", "p", "<", "=", "bEnd", "-", "4", ")", "{", "h32", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_3", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "17", ")", "*", "PRIME32_4", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "bEnd", ")", "{", "h32", "+", "=", "(", "*", "p", ")", "*", "PRIME32_5", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "11", ")", "*", "PRIME32_1", ";", "p", "+", "+;", "}", "h32", "^", "=", "h32", ">", ">", "15", ";", "h32", "*", "=", "PRIME32_2", ";", "h32", "^", "=", "h32", ">", ">", "13", ";", "h32", "*", "=", "PRIME32_3", ";", "h32", "^", "=", "h32", ">", ">", "16", ";", "return", "h32", ";", "}", "U32", "XXH32_intermediateDigest", "(", "void", "*", "state_in", ")", "{", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_intermediateDigest_endian", "(", "state_in", ",", "XXH_littleEndian", ")", ";", "else", "return", "XXH32_intermediateDigest_endian", "(", "state_in", ",", "XXH_bigEndian", ")", ";", "}", "U32", "XXH32_digest", "(", "void", "*", "state_in", ")", "{", "U32", "h32", "=", "XXH32_intermediateDigest", "(", "state_in", ")", ";", "XXH_free", "(", "state_in", ")", ";", "return", "h32", ";", "}", "/", "*", "xxHash", "-", "Fast", "Hash", "algorithm", "Copyright", "(", "C", ")", "2012", "-", "2014", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Tuning", "parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Unaligned", "memory", "access", "is", "automatically", "enabled", "for", "\"", "common", "\"", "CPU", ",", "such", "as", "x86", ".", "/", "/", "For", "others", "CPU", ",", "the", "compiler", "will", "be", "more", "cautious", ",", "and", "insert", "extra", "code", "to", "ensure", "aligned", "access", "is", "respected", ".", "/", "/", "If", "you", "know", "your", "target", "CPU", "supports", "unaligned", "memory", "access", ",", "you", "want", "to", "force", "this", "option", "manually", "to", "improve", "performance", ".", "/", "/", "You", "can", "also", "enable", "this", "parameter", "if", "you", "know", "your", "input", "data", "will", "always", "be", "aligned", "(", "boundaries", "of", "4", ",", "for", "U32", ")", ".", "#", "if", "defined", "(", "__ARM_FEATURE_UNALIGNED", ")", "|", "|", "defined", "(", "__i386", ")", "|", "|", "defined", "(", "_M_IX86", ")", "|", "|", "defined", "(", "__x86_64__", ")", "|", "|", "defined", "(", "_M_X64", ")", "#", "define", "XXH_USE_UNALIGNED_ACCESS", "1", "#", "endif", "/", "/", "XXH_ACCEPT_NULL_INPUT_POINTER", ":", "/", "/", "If", "the", "input", "pointer", "is", "a", "null", "pointer", ",", "xxHash", "default", "behavior", "is", "to", "trigger", "a", "memory", "access", "error", ",", "since", "it", "is", "a", "bad", "pointer", ".", "/", "/", "When", "this", "option", "is", "enabled", ",", "xxHash", "output", "for", "null", "input", "pointers", "will", "be", "the", "same", "as", "a", "null", "-", "length", "input", ".", "/", "/", "This", "option", "has", "a", "very", "small", "performance", "cost", "(", "only", "measurable", "on", "small", "inputs", ")", ".", "/", "/", "By", "default", ",", "this", "option", "is", "disabled", ".", "To", "enable", "it", ",", "uncomment", "below", "define", ":", "/", "/#", "define", "XXH_ACCEPT_NULL_INPUT_POINTER", "1", "/", "/", "XXH_FORCE_NATIVE_FORMAT", ":", "/", "/", "By", "default", ",", "xxHash", "library", "provides", "endian", "-", "independant", "Hash", "values", ",", "based", "on", "little", "-", "endian", "convention", ".", "/", "/", "Results", "are", "therefore", "identical", "for", "little", "-", "endian", "and", "big", "-", "endian", "CPU", ".", "/", "/", "This", "comes", "at", "a", "performance", "cost", "for", "big", "-", "endian", "CPU", ",", "since", "some", "swapping", "is", "required", "to", "emulate", "little", "-", "endian", "format", ".", "/", "/", "Should", "endian", "-", "independance", "be", "of", "no", "importance", "for", "your", "application", ",", "you", "may", "set", "the", "#", "define", "below", "to", "1", ".", "/", "/", "It", "will", "improve", "speed", "for", "Big", "-", "endian", "CPU", ".", "/", "/", "This", "option", "has", "no", "impact", "on", "Little_Endian", "CPU", ".", "#", "define", "XXH_FORCE_NATIVE_FORMAT", "0", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Specific", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "/", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "define", "FORCE_INLINE", "static", "__forceinline", "#", "else", "#", "ifdef", "__GNUC__", "#", "define", "FORCE_INLINE", "static", "inline", "__attribute__", "(", "(", "always_inline", ")", ")", "#", "else", "#", "define", "FORCE_INLINE", "static", "inline", "#", "endif", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "&", "Memory", "related", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/", "Modify", "the", "local", "functions", "below", "should", "you", "wish", "to", "use", "some", "other", "memory", "related", "routines", "/", "/", "for", "malloc", "(", "),", "free", "(", ")", "#", "include", "<", "stdlib", ".", "h", ">", "FORCE_INLINE", "void", "*", "XXH_malloc", "(", "size_t", "s", ")", "{", "return", "malloc", "(", "s", ")", ";", "}", "FORCE_INLINE", "void", "XXH_free", "(", "void", "*", "p", ")", "{", "free", "(", "p", ")", ";", "}", "/", "/", "for", "memcpy", "(", ")", "#", "include", "<", "string", ".", "h", ">", "FORCE_INLINE", "void", "*", "XXH_memcpy", "(", "void", "*", "dest", ",", "const", "void", "*", "src", ",", "size_t", "size", ")", "{", "return", "memcpy", "(", "dest", ",", "src", ",", "size", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "#", "if", "defined", "(", "__GNUC__", ")", "&", "&", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "#", "define", "_PACKED", "__attribute__", "(", "(", "packed", ")", ")", "#", "else", "#", "define", "_PACKED", "#", "endif", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "ifdef", "__IBMC__", "#", "pragma", "pack", "(", "1", ")", "#", "else", "#", "pragma", "pack", "(", "push", ",", "1", ")", "#", "endif", "#", "endif", "typedef", "struct", "_U32_S", "{", "U32", "v", ";", "}", "_PACKED", "U32_S", ";", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "pragma", "pack", "(", "pop", ")", "#", "endif", "#", "define", "A32", "(", "x", ")", "(", "((", "U32_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Compiler", "-", "specific", "Functions", "and", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "#", "define", "GCC_VERSION", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", "/", "/", "Note", ":", "although", "_rotl", "exists", "for", "minGW", "(", "GCC", "under", "windows", ")", ",", "performance", "seems", "poor", "#", "if", "defined", "(", "_MSC_VER", ")", "#", "define", "XXH_rotl32", "(", "x", ",", "r", ")", "_rotl", "(", "x", ",", "r", ")", "#", "else", "#", "define", "XXH_rotl32", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "#", "endif", "#", "if", "defined", "(", "_MSC_VER", ")", "/", "/", "Visual", "Studio", "#", "define", "XXH_swap32", "_byteswap_ulong", "#", "elif", "GCC_VERSION", ">", "=", "403", "#", "define", "XXH_swap32", "__builtin_bswap32", "#", "else", "static", "inline", "U32", "XXH_swap32", "(", "U32", "x", ")", "{", "return", "(", "(", "x", "<", "<", "24", ")", "&", "0xff000000", ")", "|", "(", "(", "x", "<", "<", "8", ")", "&", "0x00ff0000", ")", "|", "(", "(", "x", ">", ">", "8", ")", "&", "0x0000ff00", ")", "|", "(", "(", "x", ">", ">", "24", ")", "&", "0x000000ff", ")", ";}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "PRIME32_1", "2654435761U", "#", "define", "PRIME32_2", "2246822519U", "#", "define", "PRIME32_3", "3266489917U", "#", "define", "PRIME32_4", "668265263U", "#", "define", "PRIME32_5", "374761393U", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Architecture", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_bigEndian", "=", "0", ",", "XXH_littleEndian", "=", "1", "}", "XXH_endianess", ";", "#", "ifndef", "XXH_CPU_LITTLE_ENDIAN", "/", "/", "It", "is", "possible", "to", "define", "XXH_CPU_LITTLE_ENDIAN", "externally", ",", "for", "example", "using", "a", "compiler", "switch", "static", "const", "int", "one", "=", "1", ";", "#", "define", "XXH_CPU_LITTLE_ENDIAN", "(", "*(", "char", "*", ")(", "&", "one", ")", ")", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "XXH_STATIC_ASSERT", "(", "c", ")", "{", "enum", "{", "XXH_static_assert", "=", "1", "/", "(!", "!(", "c", ")", ")", "}", ";", "}", "/", "/", "use", "only", "*", "after", "*", "variable", "declarations", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Memory", "reads", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_aligned", ",", "XXH_unaligned", "}", "XXH_alignment", ";", "FORCE_INLINE", "U32", "XXH_readLE32_align", "(", "const", "U32", "*", "ptr", ",", "XXH_endianess", "endian", ",", "XXH_alignment", "align", ")", "{", "if", "(", "align", "=", "=", "XXH_unaligned", ")", "return", "endian", "=", "=", "XXH_littleEndian", "?", "A32", "(", "ptr", ")", ":", "XXH_swap32", "(", "A32", "(", "ptr", ")", ");", "else", "return", "endian", "=", "=", "XXH_littleEndian", "?", "*", "ptr", ":", "XXH_swap32", "(", "*", "ptr", ")", ";", "}", "FORCE_INLINE", "U32", "XXH_readLE32", "(", "const", "U32", "*", "ptr", ",", "XXH_endianess", "endian", ")", "{", "return", "XXH_readLE32_align", "(", "ptr", ",", "endian", ",", "XXH_unaligned", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Simple", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "FORCE_INLINE", "U32", "XXH32_endian_align", "(", "const", "void", "*", "input", ",", "int", "len", ",", "U32", "seed", ",", "XXH_endianess", "endian", ",", "XXH_alignment", "align", ")", "{", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "input", ";", "const", "BYTE", "*", "const", "bEnd", "=", "p", "+", "len", ";", "U32", "h32", ";", "#", "ifdef", "XXH_ACCEPT_NULL_INPUT_POINTER", "if", "(", "p", "=", "=", "NULL", ")", "{", "len", "=", "0", ";", "p", "=", "(", "const", "BYTE", "*", ")(", "size_t", ")", "16", ";", "}", "#", "endif", "if", "(", "len", ">", "=", "16", ")", "{", "const", "BYTE", "*", "const", "limit", "=", "bEnd", "-", "16", ";", "U32", "v1", "=", "seed", "+", "PRIME32_1", "+", "PRIME32_2", ";", "U32", "v2", "=", "seed", "+", "PRIME32_2", ";", "U32", "v3", "=", "seed", "+", "0", ";", "U32", "v4", "=", "seed", "-", "PRIME32_1", ";", "do", "{", "v1", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v1", "=", "XXH_rotl32", "(", "v1", ",", "13", ")", ";", "v1", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v2", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v2", "=", "XXH_rotl32", "(", "v2", ",", "13", ")", ";", "v2", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v3", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v3", "=", "XXH_rotl32", "(", "v3", ",", "13", ")", ";", "v3", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v4", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v4", "=", "XXH_rotl32", "(", "v4", ",", "13", ")", ";", "v4", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "=", "limit", ")", ";", "h32", "=", "XXH_rotl32", "(", "v1", ",", "1", ")", "+", "XXH_rotl32", "(", "v2", ",", "7", ")", "+", "XXH_rotl32", "(", "v3", ",", "12", ")", "+", "XXH_rotl32", "(", "v4", ",", "18", ")", ";", "}", "else", "{", "h32", "=", "seed", "+", "PRIME32_5", ";", "}", "h32", "+", "=", "(", "U32", ")", "len", ";", "while", "(", "p", "<", "=", "bEnd", "-", "4", ")", "{", "h32", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_3", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "17", ")", "*", "PRIME32_4", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "bEnd", ")", "{", "h32", "+", "=", "(", "*", "p", ")", "*", "PRIME32_5", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "11", ")", "*", "PRIME32_1", ";", "p", "+", "+;", "}", "h32", "^", "=", "h32", ">", ">", "15", ";", "h32", "*", "=", "PRIME32_2", ";", "h32", "^", "=", "h32", ">", ">", "13", ";", "h32", "*", "=", "PRIME32_3", ";", "h32", "^", "=", "h32", ">", ">", "16", ";", "return", "h32", ";", "}", "U32", "XXH32", "(", "const", "void", "*", "input", ",", "int", "len", ",", "U32", "seed", ")", "{", "#", "if", "0", "/", "/", "Simple", "version", ",", "good", "for", "code", "maintenance", ",", "but", "unfortunately", "slow", "for", "small", "inputs", "void", "*", "state", "=", "XXH32_init", "(", "seed", ")", ";", "XXH32_update", "(", "state", ",", "input", ",", "len", ")", ";", "return", "XXH32_digest", "(", "state", ")", ";", "#", "else", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "if", "(", "((", "(", "size_t", ")", "input", ")", "&", "3", ")", ")", "/", "/", "Input", "is", "aligned", ",", "let", "'", "s", "leverage", "the", "speed", "advantage", "{", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_littleEndian", ",", "XXH_aligned", ")", ";", "else", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_bigEndian", ",", "XXH_aligned", ")", ";", "}", "#", "endif", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_littleEndian", ",", "XXH_unaligned", ")", ";", "else", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_bigEndian", ",", "XXH_unaligned", ")", ";", "#", "endif", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Advanced", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "struct", "XXH_state32_t", "{", "U64", "total_len", ";", "U32", "seed", ";", "U32", "v1", ";", "U32", "v2", ";", "U32", "v3", ";", "U32", "v4", ";", "int", "memsize", ";", "char", "memory", "[", "16", "]", ";", "}", ";", "int", "XXH32_sizeofState", "(", ")", "{", "XXH_STATIC_ASSERT", "(", "XXH32_SIZEOFSTATE", ">", "=", "sizeof", "(", "struct", "XXH_state32_t", ")", ");", "/", "/", "A", "compilation", "error", "here", "means", "XXH32_SIZEOFSTATE", "is", "not", "large", "enough", "return", "sizeof", "(", "struct", "XXH_state32_t", ")", ";", "}", "XXH_errorcode", "XXH32_resetState", "(", "void", "*", "state_in", ",", "U32", "seed", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "state", "-", ">", "seed", "=", "seed", ";", "state", "-", ">", "v1", "=", "seed", "+", "PRIME32_1", "+", "PRIME32_2", ";", "state", "-", ">", "v2", "=", "seed", "+", "PRIME32_2", ";", "state", "-", ">", "v3", "=", "seed", "+", "0", ";", "state", "-", ">", "v4", "=", "seed", "-", "PRIME32_1", ";", "state", "-", ">", "total_len", "=", "0", ";", "state", "-", ">", "memsize", "=", "0", ";", "return", "XXH_OK", ";", "}", "void", "*", "XXH32_init", "(", "U32", "seed", ")", "{", "void", "*", "state", "=", "XXH_malloc", "(", "sizeof", "(", "struct", "XXH_state32_t", ")", ");", "XXH32_resetState", "(", "state", ",", "seed", ")", ";", "return", "state", ";", "}", "FORCE_INLINE", "XXH_errorcode", "XXH32_update_endian", "(", "void", "*", "state_in", ",", "const", "void", "*", "input", ",", "int", "len", ",", "XXH_endianess", "endian", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "input", ";", "const", "BYTE", "*", "const", "bEnd", "=", "p", "+", "len", ";", "#", "ifdef", "XXH_ACCEPT_NULL_INPUT_POINTER", "if", "(", "input", "=", "=", "NULL", ")", "return", "XXH_ERROR", ";", "#", "endif", "state", "-", ">", "total_len", "+", "=", "len", ";", "if", "(", "state", "-", ">", "memsize", "+", "len", "<", "16", ")", "/", "/", "fill", "in", "tmp", "buffer", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ",", "input", ",", "len", ")", ";", "state", "-", ">", "memsize", "+", "=", "len", ";", "return", "XXH_OK", ";", "}", "if", "(", "state", "-", ">", "memsize", ")", "/", "/", "some", "data", "left", "from", "previous", "update", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ",", "input", ",", "16", "-", "state", "-", ">", "memsize", ")", ";", "{", "const", "U32", "*", "p32", "=", "(", "const", "U32", "*", ")", "state", "-", ">", "memory", ";", "state", "-", ">", "v1", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v1", "=", "XXH_rotl32", "(", "state", "-", ">", "v1", ",", "13", ")", ";", "state", "-", ">", "v1", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v2", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v2", "=", "XXH_rotl32", "(", "state", "-", ">", "v2", ",", "13", ")", ";", "state", "-", ">", "v2", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v3", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v3", "=", "XXH_rotl32", "(", "state", "-", ">", "v3", ",", "13", ")", ";", "state", "-", ">", "v3", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v4", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v4", "=", "XXH_rotl32", "(", "state", "-", ">", "v4", ",", "13", ")", ";", "state", "-", ">", "v4", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "}", "p", "+", "=", "16", "-", "state", "-", ">", "memsize", ";", "state", "-", ">", "memsize", "=", "0", ";", "}", "if", "(", "p", "<", "=", "bEnd", "-", "16", ")", "{", "const", "BYTE", "*", "const", "limit", "=", "bEnd", "-", "16", ";", "U32", "v1", "=", "state", "-", ">", "v1", ";", "U32", "v2", "=", "state", "-", ">", "v2", ";", "U32", "v3", "=", "state", "-", ">", "v3", ";", "U32", "v4", "=", "state", "-", ">", "v4", ";", "do", "{", "v1", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v1", "=", "XXH_rotl32", "(", "v1", ",", "13", ")", ";", "v1", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v2", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v2", "=", "XXH_rotl32", "(", "v2", ",", "13", ")", ";", "v2", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v3", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v3", "=", "XXH_rotl32", "(", "v3", ",", "13", ")", ";", "v3", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v4", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v4", "=", "XXH_rotl32", "(", "v4", ",", "13", ")", ";", "v4", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "=", "limit", ")", ";", "state", "-", ">", "v1", "=", "v1", ";", "state", "-", ">", "v2", "=", "v2", ";", "state", "-", ">", "v3", "=", "v3", ";", "state", "-", ">", "v4", "=", "v4", ";", "}", "if", "(", "p", "<", "bEnd", ")", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", ",", "p", ",", "bEnd", "-", "p", ")", ";", "state", "-", ">", "memsize", "=", "(", "int", ")", "(", "bEnd", "-", "p", ")", ";", "}", "return", "XXH_OK", ";", "}", "XXH_errorcode", "XXH32_update", "(", "void", "*", "state_in", ",", "const", "void", "*", "input", ",", "int", "len", ")", "{", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_update_endian", "(", "state_in", ",", "input", ",", "len", ",", "XXH_littleEndian", ")", ";", "else", "return", "XXH32_update_endian", "(", "state_in", ",", "input", ",", "len", ",", "XXH_bigEndian", ")", ";", "}", "FORCE_INLINE", "U32", "XXH32_intermediateDigest_endian", "(", "void", "*", "state_in", ",", "XXH_endianess", "endian", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "state", "-", ">", "memory", ";", "BYTE", "*", "bEnd", "=", "(", "BYTE", "*", ")", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ";", "U32", "h32", ";", "if", "(", "state", "-", ">", "total_len", ">", "=", "16", ")", "{", "h32", "=", "XXH_rotl32", "(", "state", "-", ">", "v1", ",", "1", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v2", ",", "7", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v3", ",", "12", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v4", ",", "18", ")", ";", "}", "else", "{", "h32", "=", "state", "-", ">", "seed", "+", "PRIME32_5", ";", "}", "h32", "+", "=", "(", "U32", ")", "state", "-", ">", "total_len", ";", "while", "(", "p", "<", "=", "bEnd", "-", "4", ")", "{", "h32", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_3", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "17", ")", "*", "PRIME32_4", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "bEnd", ")", "{", "h32", "+", "=", "(", "*", "p", ")", "*", "PRIME32_5", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "11", ")", "*", "PRIME32_1", ";", "p", "+", "+;", "}", "h32", "^", "=", "h32", ">", ">", "15", ";", "h32", "*", "=", "PRIME32_2", ";", "h32", "^", "=", "h32", ">", ">", "13", ";", "h32", "*", "=", "PRIME32_3", ";", "h32", "^", "=", "h32", ">", ">", "16", ";", "return", "h32", ";", "}", "U32", "XXH32_intermediateDigest", "(", "void", "*", "state_in", ")", "{", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_intermediateDigest_endian", "(", "state_in", ",", "XXH_littleEndian", ")", ";", "else", "return", "XXH32_intermediateDigest_endian", "(", "state_in", ",", "XXH_bigEndian", ")", ";", "}", "U32", "XXH32_digest", "(", "void", "*", "state_in", ")", "{", "U32", "h32", "=", "XXH32_intermediateDigest", "(", "state_in", ")", ";", "XXH_free", "(", "state_in", ")", ";", "return", "h32", ";", "}", "@", "@", "-", "1", ",", "164", "+", "1", ",", "164", "@", "@", "/", "*", "xxHash", "-", "Fast", "Hash", "algorithm", "Header", "File", "Copyright", "(", "C", ")", "2012", "-", "2013", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "*", "/", "/", "*", "Notice", "extracted", "from", "xxHash", "homepage", ":", "xxHash", "is", "an", "extremely", "fast", "Hash", "algorithm", ",", "running", "at", "RAM", "speed", "limits", ".", "It", "also", "successfully", "passes", "all", "tests", "from", "the", "SMHasher", "suite", ".", "Comparison", "(", "single", "thread", ",", "Windows", "Seven", "32", "bits", ",", "using", "SMHasher", "on", "a", "Core", "2", "Duo", "@", "3GHz", ")", "Name", "Speed", "Q", ".", "Score", "Author", "xxHash", "5", ".", "4", "GB", "/", "s", "10", "CrapWow", "3", ".", "2", "GB", "/", "s", "2", "Andrew", "MumurHash", "3a", "2", ".", "7", "GB", "/", "s", "10", "Austin", "Appleby", "SpookyHash", "2", ".", "0", "GB", "/", "s", "10", "Bob", "Jenkins", "SBox", "1", ".", "4", "GB", "/", "s", "9", "Bret", "Mulvey", "Lookup3", "1", ".", "2", "GB", "/", "s", "9", "Bob", "Jenkins", "SuperFastHash", "1", ".", "2", "GB", "/", "s", "1", "Paul", "Hsieh", "CityHash64", "1", ".", "05", "GB", "/", "s", "10", "Pike", "&", "Alakuijala", "FNV", "0", ".", "55", "GB", "/", "s", "5", "Fowler", ",", "Noll", ",", "Vo", "CRC32", "0", ".", "43", "GB", "/", "s", "9", "MD5", "-", "32", "0", ".", "33", "GB", "/", "s", "10", "Ronald", "L", ".", "Rivest", "SHA1", "-", "32", "0", ".", "28", "GB", "/", "s", "10", "Q", ".", "Score", "is", "a", "measure", "of", "quality", "of", "the", "hash", "function", ".", "It", "depends", "on", "successfully", "passing", "SMHasher", "test", "set", ".", "10", "is", "a", "perfect", "score", ".", "*", "/", "#", "pragma", "once", "#", "if", "defined", "(", "__cplusplus", ")", "extern", "\"", "C", "\"", "{", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Type", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_OK", "=", "0", ",", "XXH_ERROR", "}", "XXH_errorcode", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Simple", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "unsigned", "int", "XXH32", "(", "const", "void", "*", "input", ",", "int", "len", ",", "unsigned", "int", "seed", ")", ";", "/", "*", "XXH32", "(", ")", ":", "Calculate", "the", "32", "-", "bits", "hash", "of", "sequence", "of", "length", "\"", "len", "\"", "stored", "at", "memory", "address", "\"", "input", "\"", ".", "The", "memory", "between", "input", "&", "input", "+", "len", "must", "be", "valid", "(", "allocated", "and", "read", "-", "accessible", ")", ".", "\"", "seed", "\"", "can", "be", "used", "to", "alter", "the", "result", "predictably", ".", "This", "function", "successfully", "passes", "all", "SMHasher", "tests", ".", "Speed", "on", "Core", "2", "Duo", "@", "3", "GHz", "(", "single", "thread", ",", "SMHasher", "benchmark", ")", ":", "5", ".", "4", "GB", "/", "s", "Note", "that", "\"", "len", "\"", "is", "type", "\"", "int", "\"", ",", "which", "means", "it", "is", "limited", "to", "2", "^", "31", "-", "1", ".", "If", "your", "data", "is", "larger", ",", "use", "the", "advanced", "functions", "below", ".", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Advanced", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "void", "*", "XXH32_init", "(", "unsigned", "int", "seed", ")", ";", "XXH_errorcode", "XXH32_update", "(", "void", "*", "state", ",", "const", "void", "*", "input", ",", "int", "len", ")", ";", "unsigned", "int", "XXH32_digest", "(", "void", "*", "state", ")", ";", "/", "*", "These", "functions", "calculate", "the", "xxhash", "of", "an", "input", "provided", "in", "several", "small", "packets", ",", "as", "opposed", "to", "an", "input", "provided", "as", "a", "single", "block", ".", "It", "must", "be", "started", "with", ":", "void", "*", "XXH32_init", "(", ")", "The", "function", "returns", "a", "pointer", "which", "holds", "the", "state", "of", "calculation", ".", "This", "pointer", "must", "be", "provided", "as", "\"", "void", "*", "state", "\"", "parameter", "for", "XXH32_update", "(", ").", "XXH32_update", "(", ")", "can", "be", "called", "as", "many", "times", "as", "necessary", ".", "The", "user", "must", "provide", "a", "valid", "(", "allocated", ")", "input", ".", "The", "function", "returns", "an", "error", "code", ",", "with", "0", "meaning", "OK", ",", "and", "any", "other", "value", "meaning", "there", "is", "an", "error", ".", "Note", "that", "\"", "len", "\"", "is", "type", "\"", "int", "\"", ",", "which", "means", "it", "is", "limited", "to", "2", "^", "31", "-", "1", ".", "If", "your", "data", "is", "larger", ",", "it", "is", "recommended", "to", "chunk", "your", "data", "into", "blocks", "of", "size", "for", "example", "2", "^", "30", "(", "1GB", ")", "to", "avoid", "any", "\"", "int", "\"", "overflow", "issue", ".", "Finally", ",", "you", "can", "end", "the", "calculation", "anytime", ",", "by", "using", "XXH32_digest", "(", ").", "This", "function", "returns", "the", "final", "32", "-", "bits", "hash", ".", "You", "must", "provide", "the", "same", "\"", "void", "*", "state", "\"", "parameter", "created", "by", "XXH32_init", "(", ").", "Memory", "will", "be", "freed", "by", "XXH32_digest", "(", ").", "*", "/", "int", "XXH32_sizeofState", "(", ");", "XXH_errorcode", "XXH32_resetState", "(", "void", "*", "state", ",", "unsigned", "int", "seed", ")", ";", "#", "define", "XXH32_SIZEOFSTATE", "48", "typedef", "struct", "{", "long", "long", "ll", "[", "(", "XXH32_SIZEOFSTATE", "+", "(", "sizeof", "(", "long", "long", ")", "-", "1", ")", ")/", "sizeof", "(", "long", "long", ")", "];", "}", "XXH32_stateSpace_t", ";", "/", "*", "These", "functions", "allow", "user", "application", "to", "make", "its", "own", "allocation", "for", "state", ".", "XXH32_sizeofState", "(", ")", "is", "used", "to", "know", "how", "much", "space", "must", "be", "allocated", "for", "the", "xxHash", "32", "-", "bits", "state", ".", "Note", "that", "the", "state", "must", "be", "aligned", "to", "access", "'", "long", "long", "'", "fields", ".", "Memory", "must", "be", "allocated", "and", "referenced", "by", "a", "pointer", ".", "This", "pointer", "must", "then", "be", "provided", "as", "'", "state", "'", "into", "XXH32_resetState", "(", "),", "which", "initializes", "the", "state", ".", "For", "static", "allocation", "purposes", "(", "such", "as", "allocation", "on", "stack", ",", "or", "freestanding", "systems", "without", "malloc", "(", "))", ",", "use", "the", "structure", "XXH32_stateSpace_t", ",", "which", "will", "ensure", "that", "memory", "space", "is", "large", "enough", "and", "correctly", "aligned", "to", "access", "'", "long", "long", "'", "fields", ".", "*", "/", "unsigned", "int", "XXH32_intermediateDigest", "(", "void", "*", "state", ")", ";", "/", "*", "This", "function", "does", "the", "same", "as", "XXH32_digest", "(", "),", "generating", "a", "32", "-", "bit", "hash", ",", "but", "preserve", "memory", "context", ".", "This", "way", ",", "it", "becomes", "possible", "to", "generate", "intermediate", "hashes", ",", "and", "then", "continue", "feeding", "data", "with", "XXH32_update", "(", ").", "To", "free", "memory", "context", ",", "use", "XXH32_digest", "(", "),", "or", "free", "(", ").", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Deprecated", "function", "names", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "The", "following", "translations", "are", "provided", "to", "ease", "code", "transition", "/", "/", "You", "are", "encouraged", "to", "no", "longer", "this", "function", "names", "#", "define", "XXH32_feed", "XXH32_update", "#", "define", "XXH32_result", "XXH32_digest", "#", "define", "XXH32_getIntermediateResult", "XXH32_intermediateDigest", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif", "/", "*", "xxHash", "-", "Fast", "Hash", "algorithm", "Header", "File", "Copyright", "(", "C", ")", "2012", "-", "2014", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "*", "/", "/", "*", "Notice", "extracted", "from", "xxHash", "homepage", ":", "xxHash", "is", "an", "extremely", "fast", "Hash", "algorithm", ",", "running", "at", "RAM", "speed", "limits", ".", "It", "also", "successfully", "passes", "all", "tests", "from", "the", "SMHasher", "suite", ".", "Comparison", "(", "single", "thread", ",", "Windows", "Seven", "32", "bits", ",", "using", "SMHasher", "on", "a", "Core", "2", "Duo", "@", "3GHz", ")", "Name", "Speed", "Q", ".", "Score", "Author", "xxHash", "5", ".", "4", "GB", "/", "s", "10", "CrapWow", "3", ".", "2", "GB", "/", "s", "2", "Andrew", "MumurHash", "3a", "2", ".", "7", "GB", "/", "s", "10", "Austin", "Appleby", "SpookyHash", "2", ".", "0", "GB", "/", "s", "10", "Bob", "Jenkins", "SBox", "1", ".", "4", "GB", "/", "s", "9", "Bret", "Mulvey", "Lookup3", "1", ".", "2", "GB", "/", "s", "9", "Bob", "Jenkins", "SuperFastHash", "1", ".", "2", "GB", "/", "s", "1", "Paul", "Hsieh", "CityHash64", "1", ".", "05", "GB", "/", "s", "10", "Pike", "&", "Alakuijala", "FNV", "0", ".", "55", "GB", "/", "s", "5", "Fowler", ",", "Noll", ",", "Vo", "CRC32", "0", ".", "43", "GB", "/", "s", "9", "MD5", "-", "32", "0", ".", "33", "GB", "/", "s", "10", "Ronald", "L", ".", "Rivest", "SHA1", "-", "32", "0", ".", "28", "GB", "/", "s", "10", "Q", ".", "Score", "is", "a", "measure", "of", "quality", "of", "the", "hash", "function", ".", "It", "depends", "on", "successfully", "passing", "SMHasher", "test", "set", ".", "10", "is", "a", "perfect", "score", ".", "*", "/", "#", "pragma", "once", "#", "if", "defined", "(", "__cplusplus", ")", "extern", "\"", "C", "\"", "{", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Type", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_OK", "=", "0", ",", "XXH_ERROR", "}", "XXH_errorcode", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Simple", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "unsigned", "int", "XXH32", "(", "const", "void", "*", "input", ",", "int", "len", ",", "unsigned", "int", "seed", ")", ";", "/", "*", "XXH32", "(", ")", ":", "Calculate", "the", "32", "-", "bits", "hash", "of", "sequence", "of", "length", "\"", "len", "\"", "stored", "at", "memory", "address", "\"", "input", "\"", ".", "The", "memory", "between", "input", "&", "input", "+", "len", "must", "be", "valid", "(", "allocated", "and", "read", "-", "accessible", ")", ".", "\"", "seed", "\"", "can", "be", "used", "to", "alter", "the", "result", "predictably", ".", "This", "function", "successfully", "passes", "all", "SMHasher", "tests", ".", "Speed", "on", "Core", "2", "Duo", "@", "3", "GHz", "(", "single", "thread", ",", "SMHasher", "benchmark", ")", ":", "5", ".", "4", "GB", "/", "s", "Note", "that", "\"", "len", "\"", "is", "type", "\"", "int", "\"", ",", "which", "means", "it", "is", "limited", "to", "2", "^", "31", "-", "1", ".", "If", "your", "data", "is", "larger", ",", "use", "the", "advanced", "functions", "below", ".", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Advanced", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "void", "*", "XXH32_init", "(", "unsigned", "int", "seed", ")", ";", "XXH_errorcode", "XXH32_update", "(", "void", "*", "state", ",", "const", "void", "*", "input", ",", "int", "len", ")", ";", "unsigned", "int", "XXH32_digest", "(", "void", "*", "state", ")", ";", "/", "*", "These", "functions", "calculate", "the", "xxhash", "of", "an", "input", "provided", "in", "several", "small", "packets", ",", "as", "opposed", "to", "an", "input", "provided", "as", "a", "single", "block", ".", "It", "must", "be", "started", "with", ":", "void", "*", "XXH32_init", "(", ")", "The", "function", "returns", "a", "pointer", "which", "holds", "the", "state", "of", "calculation", ".", "This", "pointer", "must", "be", "provided", "as", "\"", "void", "*", "state", "\"", "parameter", "for", "XXH32_update", "(", ").", "XXH32_update", "(", ")", "can", "be", "called", "as", "many", "times", "as", "necessary", ".", "The", "user", "must", "provide", "a", "valid", "(", "allocated", ")", "input", ".", "The", "function", "returns", "an", "error", "code", ",", "with", "0", "meaning", "OK", ",", "and", "any", "other", "value", "meaning", "there", "is", "an", "error", ".", "Note", "that", "\"", "len", "\"", "is", "type", "\"", "int", "\"", ",", "which", "means", "it", "is", "limited", "to", "2", "^", "31", "-", "1", ".", "If", "your", "data", "is", "larger", ",", "it", "is", "recommended", "to", "chunk", "your", "data", "into", "blocks", "of", "size", "for", "example", "2", "^", "30", "(", "1GB", ")", "to", "avoid", "any", "\"", "int", "\"", "overflow", "issue", ".", "Finally", ",", "you", "can", "end", "the", "calculation", "anytime", ",", "by", "using", "XXH32_digest", "(", ").", "This", "function", "returns", "the", "final", "32", "-", "bits", "hash", ".", "You", "must", "provide", "the", "same", "\"", "void", "*", "state", "\"", "parameter", "created", "by", "XXH32_init", "(", ").", "Memory", "will", "be", "freed", "by", "XXH32_digest", "(", ").", "*", "/", "int", "XXH32_sizeofState", "(", "void", ")", ";", "XXH_errorcode", "XXH32_resetState", "(", "void", "*", "state", ",", "unsigned", "int", "seed", ")", ";", "#", "define", "XXH32_SIZEOFSTATE", "48", "typedef", "struct", "{", "long", "long", "ll", "[", "(", "XXH32_SIZEOFSTATE", "+", "(", "sizeof", "(", "long", "long", ")", "-", "1", ")", ")/", "sizeof", "(", "long", "long", ")", "];", "}", "XXH32_stateSpace_t", ";", "/", "*", "These", "functions", "allow", "user", "application", "to", "make", "its", "own", "allocation", "for", "state", ".", "XXH32_sizeofState", "(", ")", "is", "used", "to", "know", "how", "much", "space", "must", "be", "allocated", "for", "the", "xxHash", "32", "-", "bits", "state", ".", "Note", "that", "the", "state", "must", "be", "aligned", "to", "access", "'", "long", "long", "'", "fields", ".", "Memory", "must", "be", "allocated", "and", "referenced", "by", "a", "pointer", ".", "This", "pointer", "must", "then", "be", "provided", "as", "'", "state", "'", "into", "XXH32_resetState", "(", "),", "which", "initializes", "the", "state", ".", "For", "static", "allocation", "purposes", "(", "such", "as", "allocation", "on", "stack", ",", "or", "freestanding", "systems", "without", "malloc", "(", "))", ",", "use", "the", "structure", "XXH32_stateSpace_t", ",", "which", "will", "ensure", "that", "memory", "space", "is", "large", "enough", "and", "correctly", "aligned", "to", "access", "'", "long", "long", "'", "fields", ".", "*", "/", "unsigned", "int", "XXH32_intermediateDigest", "(", "void", "*", "state", ")", ";", "/", "*", "This", "function", "does", "the", "same", "as", "XXH32_digest", "(", "),", "generating", "a", "32", "-", "bit", "hash", ",", "but", "preserve", "memory", "context", ".", "This", "way", ",", "it", "becomes", "possible", "to", "generate", "intermediate", "hashes", ",", "and", "then", "continue", "feeding", "data", "with", "XXH32_update", "(", ").", "To", "free", "memory", "context", ",", "use", "XXH32_digest", "(", "),", "or", "free", "(", ").", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Deprecated", "function", "names", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "The", "following", "translations", "are", "provided", "to", "ease", "code", "transition", "/", "/", "You", "are", "encouraged", "to", "no", "longer", "this", "function", "names", "#", "define", "XXH32_feed", "XXH32_update", "#", "define", "XXH32_result", "XXH32_digest", "#", "define", "XXH32_getIntermediateResult", "XXH32_intermediateDigest", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif", "@", "@", "-", "0", ",", "0", "+", "1", ",", "44", "@", "@", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "#", "xxHash", "Makefile", "#", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2014", "#", "GPL", "v2", "License", "#", "#", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "#", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "#", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "#", "(", "at", "your", "option", ")", "any", "later", "version", ".", "#", "#", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "#", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "#", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "#", "GNU", "General", "Public", "License", "for", "more", "details", ".", "#", "#", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "#", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "#", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "#", "#", "You", "can", "contact", "the", "author", "at", ":", "#", "-", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "#", "xxHash", ".", "exe", ":", "benchmark", "program", ",", "to", "demonstrate", "xxHash", "speed", "#", "#", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "##", "#", "CC", "=", "gcc", "CFLAGS", "=", "-", "I", ".", "-", "std", "=", "c99", "-", "Wall", "-", "W", "-", "Wundef", "-", "Wno", "-", "implicit", "-", "function", "-", "declaration", "OS", ":", "=", "$", "(", "shell", "uname", ")", "ifeq", "(", "$(", "OS", ")", ",", "Linux", ")", "EXT", "=", "else", "EXT", "=", ".", "exe", "endif", "default", ":", "xxHash", "all", ":", "xxHash", "xxHash", ":", "xxhash", ".", "c", "bench", ".", "c", "$", "(", "CC", ")", "-", "O2", "$", "(", "CFLAGS", ")", "$", "^", "-", "o", "$", "@$", "(", "EXT", ")", "clean", ":", "rm", "-", "f", "core", "*", ".", "o", "xxHash", "$", "(", "EXT", ")", "@", "@", "-", "1", ",", "41", "+", "1", ",", "35", "@", "@", "/", "*", "bench", ".", "c", "-", "Demo", "program", "to", "benchmark", "open", "-", "source", "algorithm", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "Blog", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "-", "Discussion", "group", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "?", "fromgroups", "#", "!", "forum", "/", "lz4c", "bench", ".", "c", "-", "Demo", "program", "to", "benchmark", "open", "-", "source", "algorithm", "Copyright", "(", "C", ")", "Yann", "Collet", "2012", "-", "2014", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "Street", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "02110", "-", "1301", "USA", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "Blog", "homepage", ":", "http", ":", "//", "fastcompression", ".", "blogspot", ".", "com", "/", "-", "Discussion", "group", ":", "https", ":", "//", "groups", ".", "google", ".", "com", "/", "forum", "/", "?", "fromgroups", "#", "!", "forum", "/", "lz4c", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Visual", "warning", "messages", "(", "must", "be", "first", "line", ")", "/", "/", "Visual", "warning", "messages", "(", "must", "be", "first", "line", ")", "#", "define", "_CRT_SECURE_NO_WARNINGS", "/", "/", "Under", "Linux", "at", "least", ",", "pull", "in", "the", "*", "64", "commands", "#", "define", "_LARGEFILE64_SOURCE", "/", "/", "MSVC", "does", "not", "support", "S_ISREG", "#", "ifndef", "S_ISREG", "#", "define", "S_ISREG", "(", "x", ")", "(", "((", "x", ")", "&", "S_IFMT", ")", "=", "=", "S_IFREG", ")", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "@", "@", "-", "47", ",", "6", "+", "41", ",", "14", "@", "@", "#", "include", "<", "sys", "/", "stat", ".", "h", ">", "/", "/", "stat64", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "specifics", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "!", "defined", "(", "S_ISREG", ")", "#", "define", "S_ISREG", "(", "x", ")", "(", "((", "x", ")", "&", "S_IFMT", ")", "=", "=", "S_IFREG", ")", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Hash", "Functions", "to", "test", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "@", "@", "-", "55", ",", "23", "+", "57", ",", "22", "@", "@", "#", "define", "HASH0", "XXH32", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "if", "defined", "(", "_MSC_VER", ")", "/", "/", "Visual", "Studio", "does", "not", "support", "'", "stdint", "'", "natively", "#", "define", "BYTE", "unsigned", "__int8", "#", "define", "U16", "unsigned", "__int16", "#", "define", "U32", "unsigned", "__int32", "#", "define", "S32", "__int32", "#", "define", "U64", "unsigned", "__int64", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "#", "include", "<", "stdint", ".", "h", ">", "#", "define", "BYTE", "uint8_t", "#", "define", "U16", "uint16_t", "#", "define", "U32", "uint32_t", "#", "define", "S32", "int32_t", "#", "define", "U64", "uint64_t", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "@", "@", "-", "84", ",", "19", "+", "85", ",", "24", "@", "@", "#", "define", "AUTHOR", "\"", "Yann", "Collet", "\"", "#", "define", "WELCOME_MESSAGE", "\"", "**", "*", "%", "s", "%", "s", ",", "by", "%", "s", "(", "%", "s", ")", "*", "**", "\\", "n", "\"", ",", "PROGRAM_NAME", ",", "PROGRAM_VERSION", ",", "AUTHOR", ",", "COMPILED", "#", "define", "NBLOOPS", "3", "/", "/", "Default", "number", "of", "benchmark", "iterations", "#", "define", "TIMELOOP", "2000", "/", "/", "Minimum", "timing", "per", "iteration", "#", "define", "NBLOOPS", "3", "/", "/", "Default", "number", "of", "benchmark", "iterations", "#", "define", "TIMELOOP", "2000", "/", "/", "Minimum", "timing", "per", "iteration", "#", "define", "MAX_MEM", "(", "1984", "<", "<", "20", ")", "#", "define", "KB", "*", "(", "1U", "<", "<", "10", ")", "#", "define", "MB", "*", "(", "1U", "<", "<", "20", ")", "#", "define", "GB", "*", "(", "1U", "<", "<", "30", ")", "#", "define", "MAX_MEM", "(", "2", "GB", "-", "64", "MB", ")", "#", "define", "PRIME", "2654435761U", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Local", "structures", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "struct", "hashFunctionPrototype", "{", "unsigned", "int", "(", "*", "hashFunction", ")", "(", "const", "char", "*", ",", "int", ",", "unsigned", "int", ")", ";", "unsigned", "int", "(", "*", "hashFunction", ")", "(", "const", "void", "*", ",", "int", ",", "unsigned", "int", ")", ";", "}", ";", "@", "@", "-", "114", ",", "8", "+", "120", ",", "8", "@", "@", "static", "int", "nbIterations", "=", "NBLOOPS", ";", "void", "BMK_SetNbIterations", "(", "int", "nbLoops", ")", "{", "nbIterations", "=", "nbLoops", ";", "DISPLAY", "(", "\"-", "%", "i", "iterations", "-", "\",", "nbIterations", ")", ";", "nbIterations", "=", "nbLoops", ";", "DISPLAY", "(", "\"-", "%", "i", "iterations", "-", "\",", "nbIterations", ")", ";", "}", "@", "@", "-", "126", ",", "181", "+", "132", ",", "276", "@", "@", "void", "BMK_SetNbIterations", "(", "int", "nbLoops", ")", "static", "int", "BMK_GetMilliStart", "(", ")", "{", "/", "/", "Supposed", "to", "be", "portable", "/", "/", "Rolls", "over", "every", "~", "12", ".", "1", "days", "(", "0x100000", "/", "24", "/", "60", "/", "60", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeb", "tb", ";", "int", "nCount", ";", "ftime", "(", "&", "tb", ")", ";", "nCount", "=", "tb", ".", "millitm", "+", "(", "tb", ".", "time", "&", "0xfffff", ")", "*", "1000", ";", "return", "nCount", ";", "/", "/", "Supposed", "to", "be", "portable", "/", "/", "Rolls", "over", "every", "~", "12", ".", "1", "days", "(", "0x100000", "/", "24", "/", "60", "/", "60", ")", "/", "/", "Use", "GetMilliSpan", "to", "correct", "for", "rollover", "struct", "timeb", "tb", ";", "int", "nCount", ";", "ftime", "(", "&", "tb", ")", ";", "nCount", "=", "tb", ".", "millitm", "+", "(", "tb", ".", "time", "&", "0xfffff", ")", "*", "1000", ";", "return", "nCount", ";", "}", "static", "int", "BMK_GetMilliSpan", "(", "int", "nTimeStart", ")", "{", "int", "nSpan", "=", "BMK_GetMilliStart", "(", ")", "-", "nTimeStart", ";", "if", "(", "nSpan", "<", "0", ")", "nSpan", "+", "=", "0x100000", "*", "1000", ";", "return", "nSpan", ";", "int", "nSpan", "=", "BMK_GetMilliStart", "(", ")", "-", "nTimeStart", ";", "if", "(", "nSpan", "<", "0", ")", "nSpan", "+", "=", "0x100000", "*", "1000", ";", "return", "nSpan", ";", "}", "static", "size_t", "BMK_findMaxMem", "(", "U64", "requiredMem", ")", "static", "size_t", "BMK_findMaxMem", "(", "U64", "requestedMem", ")", "{", "size_t", "step", "=", "(", "64U", "<", "<", "20", ")", ";", "/", "/", "64", "MB", "BYTE", "*", "testmem", "=", "NULL", ";", "requiredMem", "=", "(", "((", "requiredMem", ">", ">", "25", ")", "+", "1", ")", "<", "<", "26", ")", ";", "if", "(", "requiredMem", ">", "MAX_MEM", ")", "requiredMem", "=", "MAX_MEM", ";", "requiredMem", "+", "=", "2", "*", "step", ";", "while", "(", "!", "testmem", ")", "{", "requiredMem", "-", "=", "step", ";", "testmem", "=", "malloc", "(", "(", "size_t", ")", "requiredMem", ")", ";", "}", "free", "(", "testmem", ")", ";", "return", "(", "size_t", ")", "(", "requiredMem", "-", "step", ")", ";", "size_t", "step", "=", "(", "64", "MB", ")", ";", "size_t", "allocatedMemory", ";", "BYTE", "*", "testmem", "=", "NULL", ";", "requestedMem", "+", "=", "3", "*", "step", ";", "requestedMem", "-", "=", "(", "size_t", ")", "requestedMem", "&", "(", "step", "-", "1", ")", ";", "if", "(", "requestedMem", ">", "MAX_MEM", ")", "requestedMem", "=", "MAX_MEM", ";", "allocatedMemory", "=", "(", "size_t", ")", "requestedMem", ";", "while", "(", "!", "testmem", ")", "{", "allocatedMemory", "-", "=", "step", ";", "testmem", "=", "(", "BYTE", "*", ")", "malloc", "(", "(", "size_t", ")", "allocatedMemory", ")", ";", "}", "free", "(", "testmem", ")", ";", "return", "(", "size_t", ")", "(", "allocatedMemory", "-", "step", ")", ";", "}", "static", "U64", "BMK_GetFileSize", "(", "char", "*", "infilename", ")", "{", "int", "r", ";", "int", "r", ";", "#", "if", "defined", "(", "_MSC_VER", ")", "struct", "_stat64", "statbuf", ";", "r", "=", "_stat64", "(", "infilename", ",", "&", "statbuf", ")", ";", "struct", "_stat64", "statbuf", ";", "r", "=", "_stat64", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "else", "struct", "stat", "statbuf", ";", "r", "=", "stat", "(", "infilename", ",", "&", "statbuf", ")", ";", "struct", "stat", "statbuf", ";", "r", "=", "stat", "(", "infilename", ",", "&", "statbuf", ")", ";", "#", "endif", "if", "(", "r", "|", "|", "!", "S_ISREG", "(", "statbuf", ".", "st_mode", ")", ")", "return", "0", ";", "/", "/", "No", "good", ".", "..", "return", "(", "U64", ")", "statbuf", ".", "st_size", ";", "if", "(", "r", "|", "|", "!", "S_ISREG", "(", "statbuf", ".", "st_mode", ")", ")", "return", "0", ";", "/", "/", "No", "good", ".", "..", "return", "(", "U64", ")", "statbuf", ".", "st_size", ";", "}", "int", "BMK_benchFile", "(", "char", "*", "*", "fileNamesTable", ",", "int", "nbFiles", ",", "int", "selection", ")", "{", "int", "fileIdx", "=", "0", ";", "FILE", "*", "fileIn", ";", "char", "*", "infilename", ";", "U64", "largefilesize", ";", "size_t", "benchedsize", ";", "size_t", "readSize", ";", "char", "*", "in_buff", ";", "struct", "hashFunctionPrototype", "hashP", ";", "unsigned", "int", "hashResult", ";", "U64", "totals", "=", "0", ";", "double", "totalc", "=", "0", ".", ";", "/", "/", "Init", "switch", "(", "selection", ")", "{", "int", "fileIdx", "=", "0", ";", "struct", "hashFunctionPrototype", "hashP", ";", "unsigned", "int", "hashResult", "=", "0", ";", "U64", "totals", "=", "0", ";", "double", "totalc", "=", "0", ".", ";", "/", "/", "Init", "switch", "(", "selection", ")", "{", "#", "ifdef", "HASH0", "case", "0", ":", "hashP", ".", "hashFunction", "=", "HASH0", ";", "break", ";", "case", "0", ":", "hashP", ".", "hashFunction", "=", "HASH0", ";", "break", ";", "#", "endif", "#", "ifdef", "HASH1", "case", "1", ":", "hashP", ".", "hashFunction", "=", "HASH1", ";", "break", ";", "case", "1", ":", "hashP", ".", "hashFunction", "=", "HASH1", ";", "break", ";", "#", "endif", "#", "ifdef", "HASH2", "case", "2", ":", "hashP", ".", "hashFunction", "=", "HASH2", ";", "break", ";", "case", "2", ":", "hashP", ".", "hashFunction", "=", "HASH2", ";", "break", ";", "#", "endif", "default", ":", "hashP", ".", "hashFunction", "=", "DEFAULTHASH", ";", "}", "/", "/", "Loop", "for", "each", "file", "while", "(", "fileIdx", "<", "nbFiles", ")", "{", "/", "/", "Check", "file", "existence", "infilename", "=", "fileNamesTable", "[", "fileIdx", "+", "+]", ";", "fileIn", "=", "fopen", "(", "infilename", ",", "\"", "rb", "\"", ")", ";", "if", "(", "fileIn", "=", "=", "NULL", ")", "{", "DISPLAY", "(", "\"", "Pb", "opening", "%", "s", "\\", "n", "\"", ",", "infilename", ")", ";", "return", "11", ";", "}", "/", "/", "Memory", "allocation", "&", "restrictions", "largefilesize", "=", "BMK_GetFileSize", "(", "infilename", ")", ";", "benchedsize", "=", "(", "size_t", ")", "BMK_findMaxMem", "(", "largefilesize", ")", ";", "if", "(", "(", "U64", ")", "benchedsize", ">", "largefilesize", ")", "benchedsize", "=", "(", "size_t", ")", "largefilesize", ";", "if", "(", "benchedsize", "<", "largefilesize", ")", "{", "DISPLAY", "(", "\"", "Not", "enough", "memory", "for", "'", "%", "s", "'", "full", "size", ";", "testing", "%", "i", "MB", "only", ".", "..", "\\", "n", "\"", ",", "infilename", ",", "(", "int", ")", "(", "benchedsize", ">", ">", "20", ")", ");", "}", "in_buff", "=", "malloc", "(", "(", "size_t", ")", "benchedsize", ")", ";", "if", "(", "!", "in_buff", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "not", "enough", "memory", "!", "\\", "n", "\"", ");", "free", "(", "in_buff", ")", ";", "fclose", "(", "fileIn", ")", ";", "return", "12", ";", "}", "/", "/", "Fill", "input", "buffer", "DISPLAY", "(", "\"", "Loading", "%", "s", ".", "..", "\\", "r", "\"", ",", "infilename", ")", ";", "readSize", "=", "fread", "(", "in_buff", ",", "1", ",", "benchedsize", ",", "fileIn", ")", ";", "fclose", "(", "fileIn", ")", ";", "if", "(", "readSize", "!", "=", "benchedsize", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "problem", "reading", "file", "'", "%", "s", "'", "!", "!", "\\", "n", "\"", ",", "infilename", ")", ";", "free", "(", "in_buff", ")", ";", "return", "13", ";", "}", "/", "/", "Bench", "{", "int", "loopNb", ",", "nb_loops", ";", "size_t", "cSize", "=", "0", ";", "int", "milliTime", ";", "double", "fastestC", "=", "100000000", ".", ";", "double", "ratio", "=", "0", ".", ";", "DISPLAY", "(", "\"\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "/", "/", "Clean", "display", "line", "for", "(", "loopNb", "=", "1", ";", "loopNb", "<", "=", "nbIterations", ";", "loopNb", "+", "+)", "{", "/", "/", "Hash", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "10i", "-", ">\\", "r", "\"", ",", "loopNb", ",", "infilename", ",", "(", "int", ")", "benchedsize", ")", ";", "nb_loops", "=", "0", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "hashResult", "=", "hashP", ".", "hashFunction", "(", "in_buff", ",", "benchedsize", ",", "0", ")", ";", "nb_loops", "+", "+;", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "if", "(", "(", "double", ")", "milliTime", "<", "fastestC", "*", "nb_loops", ")", "fastestC", "=", "(", "double", ")", "milliTime", "/", "nb_loops", ";", "cSize", "=", "benchedsize", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "loopNb", ",", "infilename", ",", "(", "int", ")", "benchedsize", ",", "(", "double", ")", "benchedsize", "/", "fastestC", "/", "1000", ".", ");", "}", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "0x", "%", "08X", "\\", "n", "\"", ",", "infilename", ",", "(", "int", ")", "benchedsize", ",", "(", "double", ")", "benchedsize", "/", "fastestC", "/", "1000", ".", ",", "hashResult", ")", ";", "totals", "+", "=", "benchedsize", ";", "totalc", "+", "=", "fastestC", ";", "}", "free", "(", "in_buff", ")", ";", "}", "if", "(", "nbFiles", ">", "1", ")", "printf", "(", "\"%", "-", "16", ".", "16s", ":", "%", "11llu", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "\"", "TOTAL", "\"", ",", "(", "long", "long", "unsigned", "int", ")", "totals", ",", "(", "double", ")", "totals", "/", "totalc", "/", "1000", ".", ");", "return", "0", ";", "default", ":", "hashP", ".", "hashFunction", "=", "DEFAULTHASH", ";", "}", "/", "/", "Loop", "for", "each", "file", "while", "(", "fileIdx", "<", "nbFiles", ")", "{", "FILE", "*", "inFile", ";", "char", "*", "inFileName", ";", "U64", "inFileSize", ";", "size_t", "benchedSize", ";", "size_t", "readSize", ";", "char", "*", "buffer", ";", "char", "*", "alignedBuffer", ";", "/", "/", "Check", "file", "existence", "inFileName", "=", "fileNamesTable", "[", "fileIdx", "+", "+]", ";", "inFile", "=", "fopen", "(", "inFileName", ",", "\"", "rb", "\"", ")", ";", "if", "(", "inFile", "=", "=", "NULL", ")", "{", "DISPLAY", "(", "\"", "Pb", "opening", "%", "s", "\\", "n", "\"", ",", "inFileName", ")", ";", "return", "11", ";", "}", "/", "/", "Memory", "allocation", "&", "restrictions", "inFileSize", "=", "BMK_GetFileSize", "(", "inFileName", ")", ";", "benchedSize", "=", "(", "size_t", ")", "BMK_findMaxMem", "(", "inFileSize", ")", ";", "if", "(", "(", "U64", ")", "benchedSize", ">", "inFileSize", ")", "benchedSize", "=", "(", "size_t", ")", "inFileSize", ";", "if", "(", "benchedSize", "<", "inFileSize", ")", "{", "DISPLAY", "(", "\"", "Not", "enough", "memory", "for", "'", "%", "s", "'", "full", "size", ";", "testing", "%", "i", "MB", "only", ".", "..", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "(", "benchedSize", ">", ">", "20", ")", ");", "}", "buffer", "=", "(", "char", "*", ")", "malloc", "(", "(", "size_t", ")", "benchedSize", "+", "16", ")", ";", "if", "(", "!", "buffer", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "not", "enough", "memory", "!", "\\", "n", "\"", ");", "fclose", "(", "inFile", ")", ";", "return", "12", ";", "}", "alignedBuffer", "=", "(", "buffer", "+", "15", ")", "-", "(", "((", "size_t", ")", "(", "buffer", "+", "15", ")", ")", "&", "0xF", ")", ";", "/", "/", "align", "on", "next", "16", "bytes", "boundaries", "/", "/", "Fill", "input", "buffer", "DISPLAY", "(", "\"", "Loading", "%", "s", ".", "..", "\\", "r", "\"", ",", "inFileName", ")", ";", "readSize", "=", "fread", "(", "alignedBuffer", ",", "1", ",", "benchedSize", ",", "inFile", ")", ";", "fclose", "(", "inFile", ")", ";", "if", "(", "readSize", "!", "=", "benchedSize", ")", "{", "DISPLAY", "(", "\"\\", "nError", ":", "problem", "reading", "file", "'", "%", "s", "'", "!", "!", "\\", "n", "\"", ",", "inFileName", ")", ";", "free", "(", "buffer", ")", ";", "return", "13", ";", "}", "/", "/", "Bench", "{", "int", "interationNb", ";", "double", "fastestC", "=", "100000000", ".", ";", "DISPLAY", "(", "\"\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "/", "/", "Clean", "display", "line", "for", "(", "interationNb", "=", "1", ";", "interationNb", "<", "=", "nbIterations", ";", "interationNb", "+", "+)", "{", "int", "nbHashes", "=", "0", ";", "int", "milliTime", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "10i", "-", ">\\", "r", "\"", ",", "interationNb", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ")", ";", "/", "/", "Hash", "loop", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "100", ";", "i", "+", "+)", "{", "hashResult", "=", "hashP", ".", "hashFunction", "(", "alignedBuffer", ",", "(", "int", ")", "benchedSize", ",", "0", ")", ";", "nbHashes", "+", "+;", "}", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "if", "(", "(", "double", ")", "milliTime", "<", "fastestC", "*", "nbHashes", ")", "fastestC", "=", "(", "double", ")", "milliTime", "/", "nbHashes", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "interationNb", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ");", "}", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "0x", "%", "08X", "\\", "n", "\"", ",", "inFileName", ",", "(", "int", ")", "benchedSize", ",", "(", "double", ")", "benchedSize", "/", "fastestC", "/", "1000", ".", ",", "hashResult", ")", ";", "totals", "+", "=", "benchedSize", ";", "totalc", "+", "=", "fastestC", ";", "}", "/", "/", "Bench", "Unaligned", "{", "int", "interationNb", ";", "double", "fastestC", "=", "100000000", ".", ";", "DISPLAY", "(", "\"\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "/", "/", "Clean", "display", "line", "for", "(", "interationNb", "=", "1", ";", "(", "interationNb", "<", "=", "nbIterations", ")", "&", "&", "(", "(", "benchedSize", ">", "1", ")", ");", "interationNb", "+", "+)", "{", "int", "nbHashes", "=", "0", ";", "int", "milliTime", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "10i", "-", ">\\", "r", "\"", ",", "interationNb", ",", "\"", "(", "unaligned", ")", "\",", "(", "int", ")", "benchedSize", ")", ";", "/", "/", "Hash", "loop", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliStart", "(", ")", "=", "=", "milliTime", ")", ";", "milliTime", "=", "BMK_GetMilliStart", "(", ");", "while", "(", "BMK_GetMilliSpan", "(", "milliTime", ")", "<", "TIMELOOP", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "100", ";", "i", "+", "+)", "{", "hashResult", "=", "hashP", ".", "hashFunction", "(", "alignedBuffer", "+", "1", ",", "(", "int", ")", "benchedSize", "-", "1", ",", "0", ")", ";", "nbHashes", "+", "+;", "}", "}", "milliTime", "=", "BMK_GetMilliSpan", "(", "milliTime", ")", ";", "if", "(", "(", "double", ")", "milliTime", "<", "fastestC", "*", "nbHashes", ")", "fastestC", "=", "(", "double", ")", "milliTime", "/", "nbHashes", ";", "DISPLAY", "(", "\"%", "1i", "-", "%-", "14", ".", "14s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "r", "\"", ",", "interationNb", ",", "\"", "(", "unaligned", ")", "\",", "(", "int", ")", "(", "benchedSize", "-", "1", ")", ",", "(", "double", ")", "(", "benchedSize", "-", "1", ")", "/", "fastestC", "/", "1000", ".", ");", "}", "DISPLAY", "(", "\"%", "-", "16", ".", "16s", ":", "%", "10i", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "\"", "(", "unaligned", ")", "\",", "(", "int", ")", "benchedSize", "-", "1", ",", "(", "double", ")", "(", "benchedSize", "-", "1", ")", "/", "fastestC", "/", "1000", ".", ");", "}", "free", "(", "buffer", ")", ";", "}", "if", "(", "nbFiles", ">", "1", ")", "printf", "(", "\"%", "-", "16", ".", "16s", ":", "%", "11llu", "-", ">", "%", "7", ".", "1f", "MB", "/", "s", "\\", "n", "\"", ",", "\"", "TOTAL", "\"", ",", "(", "long", "long", "unsigned", "int", ")", "totals", ",", "(", "double", ")", "totals", "/", "totalc", "/", "1000", ".", ");", "return", "0", ";", "}", "static", "void", "BMK_checkResult", "(", "U32", "r1", ",", "U32", "r2", ")", "{", "static", "int", "nbTests", "=", "1", ";", "if", "(", "r1", "=", "=", "r2", ")", "DISPLAY", "(", "\"\\", "rTest", "%", "3i", ":", "%", "08X", "=", "=", "%", "08X", "ok", "\"", ",", "nbTests", ",", "r1", ",", "r2", ")", ";", "else", "{", "DISPLAY", "(", "\"\\", "rERROR", ":", "Test", "%", "3i", ":", "%", "08X", "<", ">", "%", "08X", "!", "!!", "!!", "\\", "n", "\"", ",", "nbTests", ",", "r1", ",", "r2", ")", ";", "exit", "(", "1", ")", ";", "}", "nbTests", "+", "+;", "}", "static", "void", "BMK_testSequence", "(", "void", "*", "sentence", ",", "int", "len", ",", "U32", "seed", ",", "U32", "Nresult", ")", "{", "U32", "Dresult", ";", "void", "*", "state", ";", "int", "index", ";", "Dresult", "=", "XXH32", "(", "sentence", ",", "len", ",", "seed", ")", ";", "BMK_checkResult", "(", "Dresult", ",", "Nresult", ")", ";", "state", "=", "XXH32_init", "(", "seed", ")", ";", "XXH32_update", "(", "state", ",", "sentence", ",", "len", ")", ";", "Dresult", "=", "XXH32_digest", "(", "state", ")", ";", "BMK_checkResult", "(", "Dresult", ",", "Nresult", ")", ";", "state", "=", "XXH32_init", "(", "seed", ")", ";", "for", "(", "index", "=", "0", ";", "index", "<", "len", ";", "index", "+", "+)", "XXH32_update", "(", "state", ",", "(", "(", "char", "*", ")", "sentence", ")", "+", "index", ",", "1", ")", ";", "Dresult", "=", "XXH32_digest", "(", "state", ")", ";", "BMK_checkResult", "(", "Dresult", ",", "Nresult", ")", ";", "}", "#", "define", "SANITY_BUFFER_SIZE", "101", "static", "void", "BMK_sanityCheck", "(", ")", "{", "BYTE", "sanityBuffer", "[", "SANITY_BUFFER_SIZE", "]", ";", "int", "i", ";", "U32", "random", "=", "PRIME", ";", "for", "(", "i", "=", "0", ";", "i", "<", "SANITY_BUFFER_SIZE", ";", "i", "+", "+)", "{", "sanityBuffer", "[", "i", "]", "=", "(", "BYTE", ")", "(", "random", ">", ">", "24", ")", ";", "random", "*", "=", "random", ";", "}", "BMK_testSequence", "(", "sanityBuffer", ",", "1", ",", "0", ",", "0xB85CBEE5", ")", ";", "BMK_testSequence", "(", "sanityBuffer", ",", "1", ",", "PRIME", ",", "0xD5845D64", ")", ";", "BMK_testSequence", "(", "sanityBuffer", ",", "14", ",", "0", ",", "0xE5AA0AB4", ")", ";", "BMK_testSequence", "(", "sanityBuffer", ",", "14", ",", "PRIME", ",", "0x4481951D", ")", ";", "BMK_testSequence", "(", "sanityBuffer", ",", "SANITY_BUFFER_SIZE", ",", "0", ",", "0x1F1AA412", ")", ";", "BMK_testSequence", "(", "sanityBuffer", ",", "SANITY_BUFFER_SIZE", ",", "PRIME", ",", "0x498EC8E2", ")", ";", "DISPLAY", "(", "\"", "-", "-", "all", "tests", "ok", "\"", ");", "DISPLAY", "(", "\"\\", "r", "%", "79s", "\\", "r", "\"", ",", "\"", "\")", ";", "/", "/", "Clean", "display", "line", "}", "@", "@", "-", "310", ",", "62", "+", "411", ",", "65", "@", "@", "int", "BMK_benchFile", "(", "char", "*", "*", "fileNamesTable", ",", "int", "nbFiles", ",", "int", "selection", ")", "int", "usage", "(", "char", "*", "exename", ")", "{", "DISPLAY", "(", "\"", "Usage", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "[", "arg", "]", "filename", "\\", "n", "\"", ",", "exename", ")", ";", "DISPLAY", "(", "\"", "Arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "i", "#", ":", "number", "of", "iterations", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "h", ":", "help", "(", "this", "text", ")", "\\", "n", "\"", ");", "return", "0", ";", "DISPLAY", "(", "\"", "Usage", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "%", "s", "[", "arg", "]", "filename", "\\", "n", "\"", ",", "exename", ")", ";", "DISPLAY", "(", "\"", "Arguments", ":", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "i", "#", ":", "number", "of", "iterations", "\\", "n", "\"", ");", "DISPLAY", "(", "\"", "-", "h", ":", "help", "(", "this", "text", ")", "\\", "n", "\"", ");", "return", "0", ";", "}", "int", "badusage", "(", "char", "*", "exename", ")", "{", "DISPLAY", "(", "\"", "Wrong", "parameters", "\\", "n", "\"", ");", "usage", "(", "exename", ")", ";", "return", "0", ";", "DISPLAY", "(", "\"", "Wrong", "parameters", "\\", "n", "\"", ");", "usage", "(", "exename", ")", ";", "return", "0", ";", "}", "int", "main", "(", "int", "argc", ",", "char", "*", "*", "argv", ")", "{", "int", "i", ",", "filenamesStart", "=", "2", ";", "char", "*", "input_filename", "=", "0", ";", "int", "i", ",", "filenamesStart", "=", "2", ";", "char", "*", "input_filename", "=", "0", ";", "/", "/", "Welcome", "message", "DISPLAY", "(", "WELCOME_MESSAGE", ")", ";", "/", "/", "Welcome", "message", "DISPLAY", "(", "WELCOME_MESSAGE", ")", ";", "/", "/", "Check", "results", "are", "good", "BMK_sanityCheck", "(", ");", "if", "(", "argc", "<", "2", ")", "{", "badusage", "(", "argv", "[", "0", "]", ");", "return", "1", ";", "}", "if", "(", "argc", "<", "2", ")", "{", "badusage", "(", "argv", "[", "0", "]", ");", "return", "1", ";", "}", "for", "(", "i", "=", "1", ";", "i", "<", "argc", ";", "i", "+", "+)", "{", "char", "*", "argument", "=", "argv", "[", "i", "]", ";", "for", "(", "i", "=", "1", ";", "i", "<", "argc", ";", "i", "+", "+)", "{", "char", "*", "argument", "=", "argv", "[", "i", "]", ";", "if", "(", "!", "argument", ")", "continue", ";", "/", "/", "Protection", "if", "argument", "empty", "if", "(", "!", "argument", ")", "continue", ";", "/", "/", "Protection", "if", "argument", "empty", "/", "/", "Select", "command", "if", "(", "argument", "[", "0", "]", "==", "'-", "')", "{", "argument", "+", "+;", "/", "/", "Select", "command", "if", "(", "argument", "[", "0", "]", "==", "'-", "')", "{", "argument", "+", "+;", "/", "/", "Display", "help", "on", "usage", "if", "(", "argument", "[", "0", "]", "=", "='", "h", "'", ")", "{", "usage", "(", "argv", "[", "0", "]", ");", "return", "0", ";", "}", "/", "/", "Display", "help", "on", "usage", "if", "(", "argument", "[", "0", "]", "=", "='", "h", "'", ")", "{", "usage", "(", "argv", "[", "0", "]", ");", "return", "0", ";", "}", "/", "/", "Modify", "Nb", "Iterations", "(", "benchmark", "only", ")", "if", "(", "argument", "[", "0", "]", "=", "='", "i", "'", ")", "{", "int", "iters", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "BMK_SetNbIterations", "(", "iters", ")", ";", "continue", ";", "}", "/", "/", "Modify", "Nb", "Iterations", "(", "benchmark", "only", ")", "if", "(", "argument", "[", "0", "]", "=", "='", "i", "'", ")", "{", "int", "iters", "=", "argument", "[", "1", "]", "-", "'", "0", "'", ";", "BMK_SetNbIterations", "(", "iters", ")", ";", "continue", ";", "}", "}", "}", "/", "/", "first", "provided", "filename", "is", "input", "if", "(", "!", "input_filename", ")", "{", "input_filename", "=", "argument", ";", "filenamesStart", "=", "i", ";", "continue", ";", "}", "/", "/", "first", "provided", "filename", "is", "input", "if", "(", "!", "input_filename", ")", "{", "input_filename", "=", "argument", ";", "filenamesStart", "=", "i", ";", "continue", ";", "}", "}", "}", "/", "/", "No", "input", "filename", "=", "=>", "Error", "if", "(", "!", "input_filename", ")", "{", "badusage", "(", "argv", "[", "0", "]", ");", "return", "1", ";", "}", "/", "/", "No", "input", "filename", "=", "=>", "Error", "if", "(", "!", "input_filename", ")", "{", "badusage", "(", "argv", "[", "0", "]", ");", "return", "1", ";", "}", "return", "BMK_benchFile", "(", "argv", "+", "filenamesStart", ",", "argc", "-", "filenamesStart", ",", "0", ")", ";", "return", "BMK_benchFile", "(", "argv", "+", "filenamesStart", ",", "argc", "-", "filenamesStart", ",", "0", ")", ";", "}", "@", "@", "-", "1", ",", "96", "+", "1", ",", "145", "@", "@", "/", "*", "xxHash", "-", "Fast", "Hash", "algorithm", "Copyright", "(", "C", ")", "2012", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "xxHash", "-", "Fast", "Hash", "algorithm", "Copyright", "(", "C", ")", "2012", "-", "2014", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Tuning", "parameters", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "FORCE_NATIVE_FORMAT", ":", "/", "/", "By", "default", ",", "xxHash", "library", "provides", "endian", "-", "independant", "Hash", "values", ".", "/", "/", "Results", "are", "therefore", "identical", "for", "big", "-", "endian", "and", "little", "-", "endian", "CPU", ".", "/", "/", "This", "comes", "at", "a", "performance", "cost", "for", "big", "-", "endian", "CPU", ",", "since", "some", "swapping", "is", "required", "to", "emulate", "little", "-", "endian", "format", ".", "/", "/", "Should", "endian", "-", "independance", "be", "of", "no", "importance", "to", "your", "application", ",", "you", "may", "uncomment", "the", "#", "define", "below", "/", "/", "Unaligned", "memory", "access", "is", "automatically", "enabled", "for", "\"", "common", "\"", "CPU", ",", "such", "as", "x86", ".", "/", "/", "For", "others", "CPU", ",", "the", "compiler", "will", "be", "more", "cautious", ",", "and", "insert", "extra", "code", "to", "ensure", "aligned", "access", "is", "respected", ".", "/", "/", "If", "you", "know", "your", "target", "CPU", "supports", "unaligned", "memory", "access", ",", "you", "want", "to", "force", "this", "option", "manually", "to", "improve", "performance", ".", "/", "/", "You", "can", "also", "enable", "this", "parameter", "if", "you", "know", "your", "input", "data", "will", "always", "be", "aligned", "(", "boundaries", "of", "4", ",", "for", "U32", ")", ".", "#", "if", "defined", "(", "__ARM_FEATURE_UNALIGNED", ")", "|", "|", "defined", "(", "__i386", ")", "|", "|", "defined", "(", "_M_IX86", ")", "|", "|", "defined", "(", "__x86_64__", ")", "|", "|", "defined", "(", "_M_X64", ")", "#", "define", "XXH_USE_UNALIGNED_ACCESS", "1", "#", "endif", "/", "/", "XXH_ACCEPT_NULL_INPUT_POINTER", ":", "/", "/", "If", "the", "input", "pointer", "is", "a", "null", "pointer", ",", "xxHash", "default", "behavior", "is", "to", "trigger", "a", "memory", "access", "error", ",", "since", "it", "is", "a", "bad", "pointer", ".", "/", "/", "When", "this", "option", "is", "enabled", ",", "xxHash", "output", "for", "null", "input", "pointers", "will", "be", "the", "same", "as", "a", "null", "-", "length", "input", ".", "/", "/", "This", "option", "has", "a", "very", "small", "performance", "cost", "(", "only", "measurable", "on", "small", "inputs", ")", ".", "/", "/", "By", "default", ",", "this", "option", "is", "disabled", ".", "To", "enable", "it", ",", "uncomment", "below", "define", ":", "/", "/#", "define", "XXH_ACCEPT_NULL_INPUT_POINTER", "1", "/", "/", "XXH_FORCE_NATIVE_FORMAT", ":", "/", "/", "By", "default", ",", "xxHash", "library", "provides", "endian", "-", "independant", "Hash", "values", ",", "based", "on", "little", "-", "endian", "convention", ".", "/", "/", "Results", "are", "therefore", "identical", "for", "little", "-", "endian", "and", "big", "-", "endian", "CPU", ".", "/", "/", "This", "comes", "at", "a", "performance", "cost", "for", "big", "-", "endian", "CPU", ",", "since", "some", "swapping", "is", "required", "to", "emulate", "little", "-", "endian", "format", ".", "/", "/", "Should", "endian", "-", "independance", "be", "of", "no", "importance", "for", "your", "application", ",", "you", "may", "set", "the", "#", "define", "below", "to", "1", ".", "/", "/", "It", "will", "improve", "speed", "for", "Big", "-", "endian", "CPU", ".", "/", "/", "This", "option", "has", "no", "impact", "on", "Little_Endian", "CPU", ".", "/", "/#", "define", "FORCE_NATIVE_FORMAT", "1", "#", "define", "XXH_FORCE_NATIVE_FORMAT", "0", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "Specific", "Options", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Disable", "some", "Visual", "warning", "messages", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "pragma", "warning", "(", "disable", ":", "4127", ")", "/", "/", "disable", ":", "C4127", ":", "conditional", "expression", "is", "constant", "#", "endif", "#", "ifdef", "_MSC_VER", "/", "/", "Visual", "Studio", "#", "define", "FORCE_INLINE", "static", "__forceinline", "#", "else", "#", "ifdef", "__GNUC__", "#", "define", "FORCE_INLINE", "static", "inline", "__attribute__", "(", "(", "always_inline", ")", ")", "#", "else", "#", "define", "FORCE_INLINE", "static", "inline", "#", "endif", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Includes", "/", "/", "Includes", "&", "Memory", "related", "functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "include", "<", "stdlib", ".", "h", ">", "/", "/", "for", "malloc", "(", "),", "free", "(", ")", "#", "include", "<", "string", ".", "h", ">", "/", "/", "for", "memcpy", "(", ")", "#", "include", "\"", "xxhash", ".", "h", "\"", "/", "/", "Modify", "the", "local", "functions", "below", "should", "you", "wish", "to", "use", "some", "other", "memory", "related", "routines", "/", "/", "for", "malloc", "(", "),", "free", "(", ")", "#", "include", "<", "stdlib", ".", "h", ">", "FORCE_INLINE", "void", "*", "XXH_malloc", "(", "size_t", "s", ")", "{", "return", "malloc", "(", "s", ")", ";", "}", "FORCE_INLINE", "void", "XXH_free", "(", "void", "*", "p", ")", "{", "free", "(", "p", ")", ";", "}", "/", "/", "for", "memcpy", "(", ")", "#", "include", "<", "string", ".", "h", ">", "FORCE_INLINE", "void", "*", "XXH_memcpy", "(", "void", "*", "dest", ",", "const", "void", "*", "src", ",", "size_t", "size", ")", "{", "return", "memcpy", "(", "dest", ",", "src", ",", "size", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "CPU", "Feature", "Detection", "/", "/", "Basic", "Types", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Little", "Endian", "or", "Big", "Endian", "?", "/", "/", "You", "can", "overwrite", "the", "#", "define", "below", "if", "you", "know", "your", "architecture", "endianess", "#", "if", "defined", "(", "FORCE_NATIVE_FORMAT", ")", "&", "&", "(", "FORCE_NATIVE_FORMAT", "=", "=", "1", ")", "/", "/", "Force", "native", "format", ".", "The", "result", "will", "be", "endian", "dependant", ".", "#", "define", "XXH_BIG_ENDIAN", "0", "#", "elif", "defined", "(", "__GLIBC__", ")", "#", "include", "<", "endian", ".", "h", ">", "#", "if", "(", "__BYTE_ORDER", "=", "=", "__BIG_ENDIAN", ")", "#", "define", "XXH_BIG_ENDIAN", "1", "#", "if", "defined", "(", "__STDC_VERSION__", ")", "&", "&", "__STDC_VERSION__", ">", "=", "199901L", "/", "/", "C99", "#", "include", "<", "stdint", ".", "h", ">", "typedef", "uint8_t", "BYTE", ";", "typedef", "uint16_t", "U16", ";", "typedef", "uint32_t", "U32", ";", "typedef", "int32_t", "S32", ";", "typedef", "uint64_t", "U64", ";", "#", "else", "typedef", "unsigned", "char", "BYTE", ";", "typedef", "unsigned", "short", "U16", ";", "typedef", "unsigned", "int", "U32", ";", "typedef", "signed", "int", "S32", ";", "typedef", "unsigned", "long", "long", "U64", ";", "#", "endif", "#", "if", "defined", "(", "__GNUC__", ")", "&", "&", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "#", "define", "_PACKED", "__attribute__", "(", "(", "packed", ")", ")", "#", "else", "#", "define", "_PACKED", "#", "endif", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "ifdef", "__IBMC__", "#", "pragma", "pack", "(", "1", ")", "#", "else", "#", "pragma", "pack", "(", "push", ",", "1", ")", "#", "endif", "#", "elif", "(", "defined", "(", "__BIG_ENDIAN__", ")", "|", "|", "defined", "(", "__BIG_ENDIAN", ")", "|", "|", "defined", "(", "_BIG_ENDIAN", ")", ")", "&", "&", "!", "(", "defined", "(", "__LITTLE_ENDIAN__", ")", "|", "|", "defined", "(", "__LITTLE_ENDIAN", ")", "|", "|", "defined", "(", "_LITTLE_ENDIAN", ")", ")", "#", "define", "XXH_BIG_ENDIAN", "1", "#", "elif", "defined", "(", "__sparc", ")", "|", "|", "defined", "(", "__sparc__", ")", "\\", "|", "|", "defined", "(", "__ppc__", ")", "|", "|", "defined", "(", "_POWER", ")", "|", "|", "defined", "(", "__powerpc__", ")", "|", "|", "defined", "(", "_ARCH_PPC", ")", "|", "|", "defined", "(", "__PPC__", ")", "|", "|", "defined", "(", "__PPC", ")", "|", "|", "defined", "(", "PPC", ")", "|", "|", "defined", "(", "__powerpc__", ")", "|", "|", "defined", "(", "__powerpc", ")", "|", "|", "defined", "(", "powerpc", ")", "\\", "|", "|", "defined", "(", "__hpux", ")", "|", "|", "defined", "(", "__hppa", ")", "\\", "|", "|", "defined", "(", "_MIPSEB", ")", "|", "|", "defined", "(", "__s390__", ")", "#", "define", "XXH_BIG_ENDIAN", "1", "#", "endif", "#", "if", "!", "defined", "(", "XXH_BIG_ENDIAN", ")", "/", "/", "Little", "Endian", "assumed", ".", "PDP", "Endian", "and", "other", "very", "rare", "endian", "format", "are", "unsupported", ".", "#", "define", "XXH_BIG_ENDIAN", "0", "typedef", "struct", "_U32_S", "{", "U32", "v", ";", "}", "_PACKED", "U32_S", ";", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "&", "&", "!", "defined", "(", "__GNUC__", ")", "#", "pragma", "pack", "(", "pop", ")", "#", "endif", "#", "define", "A32", "(", "x", ")", "(", "((", "U32_S", "*", ")(", "x", ")", ")-", ">", "v", ")", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Compiler", "-", "specific", "Options", "&", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "/", "Compiler", "-", "specific", "Functions", "and", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "#", "define", "GCC_VERSION", "(", "__GNUC__", "*", "100", "+", "__GNUC_MINOR__", ")", "/", "/", "Note", ":", "under", "GCC", ",", "it", "may", "sometimes", "be", "faster", "to", "enable", "the", "(", "2nd", ")", "macro", "definition", ",", "instead", "of", "using", "win32", "intrinsic", "#", "if", "defined", "(", "_WIN32", ")", "/", "/", "Note", ":", "although", "_rotl", "exists", "for", "minGW", "(", "GCC", "under", "windows", ")", ",", "performance", "seems", "poor", "#", "if", "defined", "(", "_MSC_VER", ")", "#", "define", "XXH_rotl32", "(", "x", ",", "r", ")", "_rotl", "(", "x", ",", "r", ")", "#", "else", "#", "define", "XXH_rotl32", "(", "x", ",", "r", ")", "(", "(", "x", "<", "<", "r", ")", "|", "(", "x", ">", ">", "(", "32", "-", "r", ")", "))", "@", "@", "-", "101", ",", "16", "+", "150", ",", "14", "@", "@", "#", "elif", "GCC_VERSION", ">", "=", "403", "#", "define", "XXH_swap32", "__builtin_bswap32", "#", "else", "static", "inline", "unsigned", "int", "XXH_swap32", "(", "unsigned", "int", "x", ")", "{", "return", "(", "(", "x", "<", "<", "24", ")", "&", "0xff000000", ")", "|", "(", "(", "x", "<", "<", "8", ")", "&", "0x00ff0000", ")", "|", "(", "(", "x", ">", ">", "8", ")", "&", "0x0000ff00", ")", "|", "(", "(", "x", ">", ">", "24", ")", "&", "0x000000ff", ")", ";", "}", "static", "inline", "U32", "XXH_swap32", "(", "U32", "x", ")", "{", "return", "(", "(", "x", "<", "<", "24", ")", "&", "0xff000000", ")", "|", "(", "(", "x", "<", "<", "8", ")", "&", "0x00ff0000", ")", "|", "(", "(", "x", ">", ">", "8", ")", "&", "0x0000ff00", ")", "|", "(", "(", "x", ">", ">", "24", ")", "&", "0x000000ff", ")", ";}", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Constants", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "@", "@", "-", "121", ",", "78", "+", "168", ",", "124", "@", "@", "static", "inline", "unsigned", "int", "XXH_swap32", "(", "unsigned", "int", "x", ")", "{", "#", "define", "PRIME32_5", "374761393U", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Architecture", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_bigEndian", "=", "0", ",", "XXH_littleEndian", "=", "1", "}", "XXH_endianess", ";", "#", "ifndef", "XXH_CPU_LITTLE_ENDIAN", "/", "/", "It", "is", "possible", "to", "define", "XXH_CPU_LITTLE_ENDIAN", "externally", ",", "for", "example", "using", "a", "compiler", "switch", "static", "const", "int", "one", "=", "1", ";", "#", "define", "XXH_CPU_LITTLE_ENDIAN", "(", "*(", "char", "*", ")(", "&", "one", ")", ")", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Macros", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "#", "define", "XXH_LE32", "(", "p", ")", "(", "XXH_BIG_ENDIAN", "?", "XXH_swap32", "(", "*(", "unsigned", "int", "*", ")(", "p", ")", ")", ":", "*", "(", "unsigned", "int", "*", ")(", "p", ")", ")", "#", "define", "XXH_STATIC_ASSERT", "(", "c", ")", "{", "enum", "{", "XXH_static_assert", "=", "1", "/", "(!", "!(", "c", ")", ")", "}", ";", "}", "/", "/", "use", "only", "*", "after", "*", "variable", "declarations", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Memory", "reads", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_aligned", ",", "XXH_unaligned", "}", "XXH_alignment", ";", "FORCE_INLINE", "U32", "XXH_readLE32_align", "(", "const", "U32", "*", "ptr", ",", "XXH_endianess", "endian", ",", "XXH_alignment", "align", ")", "{", "if", "(", "align", "=", "=", "XXH_unaligned", ")", "return", "endian", "=", "=", "XXH_littleEndian", "?", "A32", "(", "ptr", ")", ":", "XXH_swap32", "(", "A32", "(", "ptr", ")", ");", "else", "return", "endian", "=", "=", "XXH_littleEndian", "?", "*", "ptr", ":", "XXH_swap32", "(", "*", "ptr", ")", ";", "}", "FORCE_INLINE", "U32", "XXH_readLE32", "(", "const", "U32", "*", "ptr", ",", "XXH_endianess", "endian", ")", "{", "return", "XXH_readLE32_align", "(", "ptr", ",", "endian", ",", "XXH_unaligned", ")", ";", "}", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Simple", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "FORCE_INLINE", "U32", "XXH32_endian_align", "(", "const", "void", "*", "input", ",", "int", "len", ",", "U32", "seed", ",", "XXH_endianess", "endian", ",", "XXH_alignment", "align", ")", "{", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "input", ";", "const", "BYTE", "*", "const", "bEnd", "=", "p", "+", "len", ";", "U32", "h32", ";", "#", "ifdef", "XXH_ACCEPT_NULL_INPUT_POINTER", "if", "(", "p", "=", "=", "NULL", ")", "{", "len", "=", "0", ";", "p", "=", "(", "const", "BYTE", "*", ")(", "size_t", ")", "16", ";", "}", "#", "endif", "if", "(", "len", ">", "=", "16", ")", "{", "const", "BYTE", "*", "const", "limit", "=", "bEnd", "-", "16", ";", "U32", "v1", "=", "seed", "+", "PRIME32_1", "+", "PRIME32_2", ";", "U32", "v2", "=", "seed", "+", "PRIME32_2", ";", "U32", "v3", "=", "seed", "+", "0", ";", "U32", "v4", "=", "seed", "-", "PRIME32_1", ";", "do", "{", "v1", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v1", "=", "XXH_rotl32", "(", "v1", ",", "13", ")", ";", "v1", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v2", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v2", "=", "XXH_rotl32", "(", "v2", ",", "13", ")", ";", "v2", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v3", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v3", "=", "XXH_rotl32", "(", "v3", ",", "13", ")", ";", "v3", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v4", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_2", ";", "v4", "=", "XXH_rotl32", "(", "v4", ",", "13", ")", ";", "v4", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "=", "limit", ")", ";", "h32", "=", "XXH_rotl32", "(", "v1", ",", "1", ")", "+", "XXH_rotl32", "(", "v2", ",", "7", ")", "+", "XXH_rotl32", "(", "v3", ",", "12", ")", "+", "XXH_rotl32", "(", "v4", ",", "18", ")", ";", "}", "else", "{", "h32", "=", "seed", "+", "PRIME32_5", ";", "}", "h32", "+", "=", "(", "U32", ")", "len", ";", "while", "(", "p", "<", "=", "bEnd", "-", "4", ")", "{", "h32", "+", "=", "XXH_readLE32_align", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ",", "align", ")", "*", "PRIME32_3", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "17", ")", "*", "PRIME32_4", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "bEnd", ")", "{", "h32", "+", "=", "(", "*", "p", ")", "*", "PRIME32_5", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "11", ")", "*", "PRIME32_1", ";", "p", "+", "+;", "}", "h32", "^", "=", "h32", ">", ">", "15", ";", "h32", "*", "=", "PRIME32_2", ";", "h32", "^", "=", "h32", ">", ">", "13", ";", "h32", "*", "=", "PRIME32_3", ";", "h32", "^", "=", "h32", ">", ">", "16", ";", "return", "h32", ";", "}", "unsigned", "int", "XXH32", "(", "const", "void", "*", "input", ",", "int", "len", ",", "unsigned", "int", "seed", ")", "U32", "XXH32", "(", "const", "void", "*", "input", ",", "int", "len", ",", "U32", "seed", ")", "{", "#", "if", "0", "/", "/", "Simple", "version", ",", "good", "for", "code", "maintenance", ",", "but", "unfortunately", "slow", "for", "small", "inputs", "void", "*", "state", "=", "XXH32_init", "(", "seed", ")", ";", "XXH32_feed", "(", "state", ",", "input", ",", "len", ")", ";", "return", "XXH32_result", "(", "state", ")", ";", "/", "/", "Simple", "version", ",", "good", "for", "code", "maintenance", ",", "but", "unfortunately", "slow", "for", "small", "inputs", "void", "*", "state", "=", "XXH32_init", "(", "seed", ")", ";", "XXH32_update", "(", "state", ",", "input", ",", "len", ")", ";", "return", "XXH32_digest", "(", "state", ")", ";", "#", "else", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "#", "if", "!", "defined", "(", "XXH_USE_UNALIGNED_ACCESS", ")", "if", "(", "((", "(", "size_t", ")", "input", ")", "&", "3", ")", ")", "/", "/", "Input", "is", "aligned", ",", "let", "'", "s", "leverage", "the", "speed", "advantage", "{", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_littleEndian", ",", "XXH_aligned", ")", ";", "else", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_bigEndian", ",", "XXH_aligned", ")", ";", "}", "#", "endif", "const", "unsigned", "char", "*", "p", "=", "(", "const", "unsigned", "char", "*", ")", "input", ";", "const", "unsigned", "char", "*", "const", "bEnd", "=", "p", "+", "len", ";", "unsigned", "int", "h32", ";", "if", "(", "len", ">", "=", "16", ")", "{", "const", "unsigned", "char", "*", "const", "limit", "=", "bEnd", "-", "16", ";", "unsigned", "int", "v1", "=", "seed", "+", "PRIME32_1", "+", "PRIME32_2", ";", "unsigned", "int", "v2", "=", "seed", "+", "PRIME32_2", ";", "unsigned", "int", "v3", "=", "seed", "+", "0", ";", "unsigned", "int", "v4", "=", "seed", "-", "PRIME32_1", ";", "do", "{", "v1", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_2", ";", "v1", "=", "XXH_rotl32", "(", "v1", ",", "13", ")", ";", "v1", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v2", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_2", ";", "v2", "=", "XXH_rotl32", "(", "v2", ",", "13", ")", ";", "v2", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v3", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_2", ";", "v3", "=", "XXH_rotl32", "(", "v3", ",", "13", ")", ";", "v3", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v4", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_2", ";", "v4", "=", "XXH_rotl32", "(", "v4", ",", "13", ")", ";", "v4", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "=", "limit", ")", ";", "h32", "=", "XXH_rotl32", "(", "v1", ",", "1", ")", "+", "XXH_rotl32", "(", "v2", ",", "7", ")", "+", "XXH_rotl32", "(", "v3", ",", "12", ")", "+", "XXH_rotl32", "(", "v4", ",", "18", ")", ";", "}", "else", "{", "h32", "=", "seed", "+", "PRIME32_5", ";", "}", "h32", "+", "=", "(", "unsigned", "int", ")", "len", ";", "while", "(", "p", "<", "=", "bEnd", "-", "4", ")", "{", "h32", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_3", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "17", ")", "*", "PRIME32_4", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "bEnd", ")", "{", "h32", "+", "=", "(", "*", "p", ")", "*", "PRIME32_5", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "11", ")", "*", "PRIME32_1", ";", "p", "+", "+;", "}", "h32", "^", "=", "h32", ">", ">", "15", ";", "h32", "*", "=", "PRIME32_2", ";", "h32", "^", "=", "h32", ">", ">", "13", ";", "h32", "*", "=", "PRIME32_3", ";", "h32", "^", "=", "h32", ">", ">", "16", ";", "return", "h32", ";", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_littleEndian", ",", "XXH_unaligned", ")", ";", "else", "return", "XXH32_endian_align", "(", "input", ",", "len", ",", "seed", ",", "XXH_bigEndian", ",", "XXH_unaligned", ")", ";", "#", "endif", "}", "@", "@", "-", "203", ",", "140", "+", "296", ",", "180", "@", "@", "unsigned", "int", "XXH32", "(", "const", "void", "*", "input", ",", "int", "len", ",", "unsigned", "int", "seed", ")", "struct", "XXH_state32_t", "{", "unsigned", "int", "seed", ";", "unsigned", "int", "v1", ";", "unsigned", "int", "v2", ";", "unsigned", "int", "v3", ";", "unsigned", "int", "v4", ";", "unsigned", "long", "long", "total_len", ";", "char", "memory", "[", "16", "]", ";", "int", "memsize", ";", "U64", "total_len", ";", "U32", "seed", ";", "U32", "v1", ";", "U32", "v2", ";", "U32", "v3", ";", "U32", "v4", ";", "int", "memsize", ";", "char", "memory", "[", "16", "]", ";", "}", ";", "void", "*", "XXH32_init", "(", "unsigned", "int", "seed", ")", "int", "XXH32_sizeofState", "(", ")", "{", "XXH_STATIC_ASSERT", "(", "XXH32_SIZEOFSTATE", ">", "=", "sizeof", "(", "struct", "XXH_state32_t", ")", ");", "/", "/", "A", "compilation", "error", "here", "means", "XXH32_SIZEOFSTATE", "is", "not", "large", "enough", "return", "sizeof", "(", "struct", "XXH_state32_t", ")", ";", "}", "XXH_errorcode", "XXH32_resetState", "(", "void", "*", "state_in", ",", "U32", "seed", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "state", "-", ">", "seed", "=", "seed", ";", "state", "-", ">", "v1", "=", "seed", "+", "PRIME32_1", "+", "PRIME32_2", ";", "state", "-", ">", "v2", "=", "seed", "+", "PRIME32_2", ";", "state", "-", ">", "v3", "=", "seed", "+", "0", ";", "state", "-", ">", "v4", "=", "seed", "-", "PRIME32_1", ";", "state", "-", ">", "total_len", "=", "0", ";", "state", "-", ">", "memsize", "=", "0", ";", "return", "XXH_OK", ";", "}", "void", "*", "XXH32_init", "(", "U32", "seed", ")", "{", "void", "*", "state", "=", "XXH_malloc", "(", "sizeof", "(", "struct", "XXH_state32_t", ")", ");", "XXH32_resetState", "(", "state", ",", "seed", ")", ";", "return", "state", ";", "}", "FORCE_INLINE", "XXH_errorcode", "XXH32_update_endian", "(", "void", "*", "state_in", ",", "const", "void", "*", "input", ",", "int", "len", ",", "XXH_endianess", "endian", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "malloc", "(", "sizeof", "(", "struct", "XXH_state32_t", ")", ");", "state", "-", ">", "seed", "=", "seed", ";", "state", "-", ">", "v1", "=", "seed", "+", "PRIME32_1", "+", "PRIME32_2", ";", "state", "-", ">", "v2", "=", "seed", "+", "PRIME32_2", ";", "state", "-", ">", "v3", "=", "seed", "+", "0", ";", "state", "-", ">", "v4", "=", "seed", "-", "PRIME32_1", ";", "state", "-", ">", "total_len", "=", "0", ";", "state", "-", ">", "memsize", "=", "0", ";", "return", "(", "void", "*", ")", "state", ";", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "input", ";", "const", "BYTE", "*", "const", "bEnd", "=", "p", "+", "len", ";", "#", "ifdef", "XXH_ACCEPT_NULL_INPUT_POINTER", "if", "(", "input", "=", "=", "NULL", ")", "return", "XXH_ERROR", ";", "#", "endif", "state", "-", ">", "total_len", "+", "=", "len", ";", "if", "(", "state", "-", ">", "memsize", "+", "len", "<", "16", ")", "/", "/", "fill", "in", "tmp", "buffer", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ",", "input", ",", "len", ")", ";", "state", "-", ">", "memsize", "+", "=", "len", ";", "return", "XXH_OK", ";", "}", "if", "(", "state", "-", ">", "memsize", ")", "/", "/", "some", "data", "left", "from", "previous", "update", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ",", "input", ",", "16", "-", "state", "-", ">", "memsize", ")", ";", "{", "const", "U32", "*", "p32", "=", "(", "const", "U32", "*", ")", "state", "-", ">", "memory", ";", "state", "-", ">", "v1", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v1", "=", "XXH_rotl32", "(", "state", "-", ">", "v1", ",", "13", ")", ";", "state", "-", ">", "v1", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v2", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v2", "=", "XXH_rotl32", "(", "state", "-", ">", "v2", ",", "13", ")", ";", "state", "-", ">", "v2", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v3", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v3", "=", "XXH_rotl32", "(", "state", "-", ">", "v3", ",", "13", ")", ";", "state", "-", ">", "v3", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v4", "+", "=", "XXH_readLE32", "(", "p32", ",", "endian", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v4", "=", "XXH_rotl32", "(", "state", "-", ">", "v4", ",", "13", ")", ";", "state", "-", ">", "v4", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "}", "p", "+", "=", "16", "-", "state", "-", ">", "memsize", ";", "state", "-", ">", "memsize", "=", "0", ";", "}", "if", "(", "p", "<", "=", "bEnd", "-", "16", ")", "{", "const", "BYTE", "*", "const", "limit", "=", "bEnd", "-", "16", ";", "U32", "v1", "=", "state", "-", ">", "v1", ";", "U32", "v2", "=", "state", "-", ">", "v2", ";", "U32", "v3", "=", "state", "-", ">", "v3", ";", "U32", "v4", "=", "state", "-", ">", "v4", ";", "do", "{", "v1", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v1", "=", "XXH_rotl32", "(", "v1", ",", "13", ")", ";", "v1", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v2", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v2", "=", "XXH_rotl32", "(", "v2", ",", "13", ")", ";", "v2", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v3", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v3", "=", "XXH_rotl32", "(", "v3", ",", "13", ")", ";", "v3", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v4", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_2", ";", "v4", "=", "XXH_rotl32", "(", "v4", ",", "13", ")", ";", "v4", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "=", "limit", ")", ";", "state", "-", ">", "v1", "=", "v1", ";", "state", "-", ">", "v2", "=", "v2", ";", "state", "-", ">", "v3", "=", "v3", ";", "state", "-", ">", "v4", "=", "v4", ";", "}", "if", "(", "p", "<", "bEnd", ")", "{", "XXH_memcpy", "(", "state", "-", ">", "memory", ",", "p", ",", "bEnd", "-", "p", ")", ";", "state", "-", ">", "memsize", "=", "(", "int", ")", "(", "bEnd", "-", "p", ")", ";", "}", "return", "XXH_OK", ";", "}", "XXH_errorcode", "XXH32_update", "(", "void", "*", "state_in", ",", "const", "void", "*", "input", ",", "int", "len", ")", "{", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_update_endian", "(", "state_in", ",", "input", ",", "len", ",", "XXH_littleEndian", ")", ";", "else", "return", "XXH32_update_endian", "(", "state_in", ",", "input", ",", "len", ",", "XXH_bigEndian", ")", ";", "}", "int", "XXH32_feed", "(", "void", "*", "state_in", ",", "const", "void", "*", "input", ",", "int", "len", ")", "FORCE_INLINE", "U32", "XXH32_intermediateDigest_endian", "(", "void", "*", "state_in", ",", "XXH_endianess", "endian", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "state_in", ";", "const", "unsigned", "char", "*", "p", "=", "(", "const", "unsigned", "char", "*", ")", "input", ";", "const", "unsigned", "char", "*", "const", "bEnd", "=", "p", "+", "len", ";", "state", "-", ">", "total_len", "+", "=", "len", ";", "if", "(", "state", "-", ">", "memsize", "+", "len", "<", "16", ")", "/", "/", "fill", "in", "tmp", "buffer", "{", "memcpy", "(", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ",", "input", ",", "len", ")", ";", "state", "-", ">", "memsize", "+", "=", "len", ";", "return", "0", ";", "}", "if", "(", "state", "-", ">", "memsize", ")", "/", "/", "some", "data", "left", "from", "previous", "feed", "{", "memcpy", "(", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ",", "input", ",", "16", "-", "state", "-", ">", "memsize", ")", ";", "{", "const", "unsigned", "int", "*", "p32", "=", "(", "const", "unsigned", "int", "*", ")", "state", "-", ">", "memory", ";", "state", "-", ">", "v1", "+", "=", "XXH_LE32", "(", "p32", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v1", "=", "XXH_rotl32", "(", "state", "-", ">", "v1", ",", "13", ")", ";", "state", "-", ">", "v1", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v2", "+", "=", "XXH_LE32", "(", "p32", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v2", "=", "XXH_rotl32", "(", "state", "-", ">", "v2", ",", "13", ")", ";", "state", "-", ">", "v2", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v3", "+", "=", "XXH_LE32", "(", "p32", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v3", "=", "XXH_rotl32", "(", "state", "-", ">", "v3", ",", "13", ")", ";", "state", "-", ">", "v3", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "state", "-", ">", "v4", "+", "=", "XXH_LE32", "(", "p32", ")", "*", "PRIME32_2", ";", "state", "-", ">", "v4", "=", "XXH_rotl32", "(", "state", "-", ">", "v4", ",", "13", ")", ";", "state", "-", ">", "v4", "*", "=", "PRIME32_1", ";", "p32", "+", "+;", "}", "p", "+", "=", "16", "-", "state", "-", ">", "memsize", ";", "state", "-", ">", "memsize", "=", "0", ";", "}", "{", "const", "unsigned", "char", "*", "const", "limit", "=", "bEnd", "-", "16", ";", "unsigned", "int", "v1", "=", "state", "-", ">", "v1", ";", "unsigned", "int", "v2", "=", "state", "-", ">", "v2", ";", "unsigned", "int", "v3", "=", "state", "-", ">", "v3", ";", "unsigned", "int", "v4", "=", "state", "-", ">", "v4", ";", "while", "(", "p", "<", "=", "limit", ")", "{", "v1", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_2", ";", "v1", "=", "XXH_rotl32", "(", "v1", ",", "13", ")", ";", "v1", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v2", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_2", ";", "v2", "=", "XXH_rotl32", "(", "v2", ",", "13", ")", ";", "v2", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v3", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_2", ";", "v3", "=", "XXH_rotl32", "(", "v3", ",", "13", ")", ";", "v3", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "v4", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_2", ";", "v4", "=", "XXH_rotl32", "(", "v4", ",", "13", ")", ";", "v4", "*", "=", "PRIME32_1", ";", "p", "+", "=", "4", ";", "}", "state", "-", ">", "v1", "=", "v1", ";", "state", "-", ">", "v2", "=", "v2", ";", "state", "-", ">", "v3", "=", "v3", ";", "state", "-", ">", "v4", "=", "v4", ";", "}", "if", "(", "p", "<", "bEnd", ")", "{", "memcpy", "(", "state", "-", ">", "memory", ",", "p", ",", "bEnd", "-", "p", ")", ";", "state", "-", ">", "memsize", "=", "bEnd", "-", "p", ";", "}", "return", "0", ";", "struct", "XXH_state32_t", "*", "state", "=", "(", "struct", "XXH_state32_t", "*", ")", "state_in", ";", "const", "BYTE", "*", "p", "=", "(", "const", "BYTE", "*", ")", "state", "-", ">", "memory", ";", "BYTE", "*", "bEnd", "=", "(", "BYTE", "*", ")", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ";", "U32", "h32", ";", "if", "(", "state", "-", ">", "total_len", ">", "=", "16", ")", "{", "h32", "=", "XXH_rotl32", "(", "state", "-", ">", "v1", ",", "1", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v2", ",", "7", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v3", ",", "12", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v4", ",", "18", ")", ";", "}", "else", "{", "h32", "=", "state", "-", ">", "seed", "+", "PRIME32_5", ";", "}", "h32", "+", "=", "(", "U32", ")", "state", "-", ">", "total_len", ";", "while", "(", "p", "<", "=", "bEnd", "-", "4", ")", "{", "h32", "+", "=", "XXH_readLE32", "(", "(", "const", "U32", "*", ")", "p", ",", "endian", ")", "*", "PRIME32_3", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "17", ")", "*", "PRIME32_4", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "bEnd", ")", "{", "h32", "+", "=", "(", "*", "p", ")", "*", "PRIME32_5", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "11", ")", "*", "PRIME32_1", ";", "p", "+", "+;", "}", "h32", "^", "=", "h32", ">", ">", "15", ";", "h32", "*", "=", "PRIME32_2", ";", "h32", "^", "=", "h32", ">", ">", "13", ";", "h32", "*", "=", "PRIME32_3", ";", "h32", "^", "=", "h32", ">", ">", "16", ";", "return", "h32", ";", "}", "unsigned", "int", "XXH32_getIntermediateResult", "(", "void", "*", "state_in", ")", "U32", "XXH32_intermediateDigest", "(", "void", "*", "state_in", ")", "{", "struct", "XXH_state32_t", "*", "state", "=", "state_in", ";", "unsigned", "char", "*", "p", "=", "(", "unsigned", "char", "*", ")", "state", "-", ">", "memory", ";", "unsigned", "char", "*", "bEnd", "=", "(", "unsigned", "char", "*", ")", "state", "-", ">", "memory", "+", "state", "-", ">", "memsize", ";", "unsigned", "int", "h32", ";", "if", "(", "state", "-", ">", "total_len", ">", "=", "16", ")", "{", "h32", "=", "XXH_rotl32", "(", "state", "-", ">", "v1", ",", "1", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v2", ",", "7", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v3", ",", "12", ")", "+", "XXH_rotl32", "(", "state", "-", ">", "v4", ",", "18", ")", ";", "}", "else", "{", "h32", "=", "state", "-", ">", "seed", "+", "PRIME32_5", ";", "}", "h32", "+", "=", "(", "unsigned", "int", ")", "state", "-", ">", "total_len", ";", "while", "(", "p", "<", "=", "bEnd", "-", "4", ")", "{", "h32", "+", "=", "XXH_LE32", "(", "p", ")", "*", "PRIME32_3", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "17", ")", "*", "PRIME32_4", ";", "p", "+", "=", "4", ";", "}", "while", "(", "p", "<", "bEnd", ")", "{", "h32", "+", "=", "(", "*", "p", ")", "*", "PRIME32_5", ";", "h32", "=", "XXH_rotl32", "(", "h32", ",", "11", ")", "*", "PRIME32_1", ";", "p", "+", "+;", "}", "h32", "^", "=", "h32", ">", ">", "15", ";", "h32", "*", "=", "PRIME32_2", ";", "h32", "^", "=", "h32", ">", ">", "13", ";", "h32", "*", "=", "PRIME32_3", ";", "h32", "^", "=", "h32", ">", ">", "16", ";", "return", "h32", ";", "XXH_endianess", "endian_detected", "=", "(", "XXH_endianess", ")", "XXH_CPU_LITTLE_ENDIAN", ";", "if", "(", "(", "endian_detected", "=", "=", "XXH_littleEndian", ")", "|", "|", "XXH_FORCE_NATIVE_FORMAT", ")", "return", "XXH32_intermediateDigest_endian", "(", "state_in", ",", "XXH_littleEndian", ")", ";", "else", "return", "XXH32_intermediateDigest_endian", "(", "state_in", ",", "XXH_bigEndian", ")", ";", "}", "unsigned", "int", "XXH32_result", "(", "void", "*", "state_in", ")", "U32", "XXH32_digest", "(", "void", "*", "state_in", ")", "{", "unsigned", "int", "h32", "=", "XXH32_getIntermediateResult", "(", "state_in", ")", ";", "U32", "h32", "=", "XXH32_intermediateDigest", "(", "state_in", ")", ";", "free", "(", "state_in", ")", ";", "XXH_free", "(", "state_in", ")", ";", "return", "h32", ";", "return", "h32", ";", "}", "@", "@", "-", "1", ",", "7", "+", "1", ",", "7", "@", "@", "/", "*", "xxHash", "-", "Fast", "Hash", "algorithm", "Header", "File", "Copyright", "(", "C", ")", "2012", ",", "Yann", "Collet", ".", "Copyright", "(", "C", ")", "2012", "-", "2014", ",", "Yann", "Collet", ".", "BSD", "2", "-", "Clause", "License", "(", "http", ":", "//", "www", ".", "opensource", ".", "org", "/", "licenses", "/", "bsd", "-", "license", ".", "php", ")", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "@", "@", "-", "27", ",", "8", "+", "27", ",", "8", "@", "@", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "You", "can", "contact", "the", "author", "at", ":", "-", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "You", "can", "contact", "the", "author", "at", ":", "-", "xxHash", "source", "repository", ":", "http", ":", "//", "code", ".", "google", ".", "com", "/", "p", "/", "xxhash", "/", "*", "/", "/", "*", "Notice", "extracted", "from", "xxHash", "homepage", ":", "@", "@", "-", "64", ",", "6", "+", "64", ",", "13", "@", "@", "extern", "\"", "C", "\"", "{", "#", "endif", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Type", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "typedef", "enum", "{", "XXH_OK", "=", "0", ",", "XXH_ERROR", "}", "XXH_errorcode", ";", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Simple", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "@", "@", "-", "72", ",", "12", "+", "79", ",", "13", "@", "@", "unsigned", "int", "XXH32", "(", "const", "void", "*", "input", ",", "int", "len", ",", "unsigned", "int", "seed", ")", ";", "/", "*", "XXH32", "(", ")", ":", "Calculate", "the", "32", "-", "bits", "hash", "of", "\"", "input", "\"", ",", "of", "length", "\"", "len", "\"", "\"", "seed", "\"", "can", "be", "used", "to", "alter", "the", "result", "This", "function", "successfully", "passes", "all", "SMHasher", "tests", ".", "Speed", "on", "Core", "2", "Duo", "@", "3", "GHz", "(", "single", "thread", ",", "SMHasher", "benchmark", ")", ":", "5", ".", "4", "GB", "/", "s", "Note", "that", "\"", "len", "\"", "is", "type", "\"", "int", "\"", ",", "which", "means", "it", "is", "limited", "to", "2", "^", "31", "-", "1", ".", "If", "your", "data", "is", "larger", ",", "use", "the", "advanced", "functions", "below", ".", "Calculate", "the", "32", "-", "bits", "hash", "of", "sequence", "of", "length", "\"", "len", "\"", "stored", "at", "memory", "address", "\"", "input", "\"", ".", "The", "memory", "between", "input", "&", "input", "+", "len", "must", "be", "valid", "(", "allocated", "and", "read", "-", "accessible", ")", ".", "\"", "seed", "\"", "can", "be", "used", "to", "alter", "the", "result", "predictably", ".", "This", "function", "successfully", "passes", "all", "SMHasher", "tests", ".", "Speed", "on", "Core", "2", "Duo", "@", "3", "GHz", "(", "single", "thread", ",", "SMHasher", "benchmark", ")", ":", "5", ".", "4", "GB", "/", "s", "Note", "that", "\"", "len", "\"", "is", "type", "\"", "int", "\"", ",", "which", "means", "it", "is", "limited", "to", "2", "^", "31", "-", "1", ".", "If", "your", "data", "is", "larger", ",", "use", "the", "advanced", "functions", "below", ".", "*", "/", "@", "@", "-", "86", ",", "43", "+", "94", ",", "71", "@", "@", "XXH32", "(", ")", ":", "/", "/", "Advanced", "Hash", "Functions", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "void", "*", "XXH32_init", "(", "unsigned", "int", "seed", ")", ";", "int", "XXH32_feed", "(", "void", "*", "state", ",", "const", "void", "*", "input", ",", "int", "len", ")", ";", "unsigned", "int", "XXH32_result", "(", "void", "*", "state", ")", ";", "void", "*", "XXH32_init", "(", "unsigned", "int", "seed", ")", ";", "XXH_errorcode", "XXH32_update", "(", "void", "*", "state", ",", "const", "void", "*", "input", ",", "int", "len", ")", ";", "unsigned", "int", "XXH32_digest", "(", "void", "*", "state", ")", ";", "/", "*", "These", "functions", "calculate", "the", "xxhash", "of", "an", "input", "provided", "in", "several", "small", "packets", ",", "as", "opposed", "to", "an", "input", "provided", "as", "a", "single", "block", ".", "You", "must", "start", "with", ":", "It", "must", "be", "started", "with", ":", "void", "*", "XXH32_init", "(", ")", "The", "function", "returns", "a", "pointer", "which", "holds", "the", "state", "of", "calculation", ".", "This", "pointer", "must", "be", "provided", "as", "\"", "void", "*", "state", "\"", "parameter", "for", "XXH32_feed", "(", ").", "XXH32_feed", "(", ")", "can", "be", "called", "as", "many", "times", "as", "necessary", ".", "The", "function", "returns", "an", "error", "code", ",", "with", "0", "meaning", "OK", ",", "and", "all", "other", "values", "meaning", "there", "is", "an", "error", ".", "This", "pointer", "must", "be", "provided", "as", "\"", "void", "*", "state", "\"", "parameter", "for", "XXH32_update", "(", ").", "XXH32_update", "(", ")", "can", "be", "called", "as", "many", "times", "as", "necessary", ".", "The", "user", "must", "provide", "a", "valid", "(", "allocated", ")", "input", ".", "The", "function", "returns", "an", "error", "code", ",", "with", "0", "meaning", "OK", ",", "and", "any", "other", "value", "meaning", "there", "is", "an", "error", ".", "Note", "that", "\"", "len", "\"", "is", "type", "\"", "int", "\"", ",", "which", "means", "it", "is", "limited", "to", "2", "^", "31", "-", "1", ".", "If", "your", "data", "is", "larger", ",", "it", "is", "recommended", "to", "chunk", "your", "data", "into", "blocks", "of", "size", "2", "^", "30", "(", "1GB", ")", "to", "avoid", "any", "\"", "int", "\"", "overflow", "issue", ".", "If", "your", "data", "is", "larger", ",", "it", "is", "recommended", "to", "chunk", "your", "data", "into", "blocks", "of", "size", "for", "example", "2", "^", "30", "(", "1GB", ")", "to", "avoid", "any", "\"", "int", "\"", "overflow", "issue", ".", "Finally", ",", "you", "can", "end", "the", "calculation", "anytime", ",", "by", "using", "XXH32_result", "(", ").", "Finally", ",", "you", "can", "end", "the", "calculation", "anytime", ",", "by", "using", "XXH32_digest", "(", ").", "This", "function", "returns", "the", "final", "32", "-", "bits", "hash", ".", "You", "must", "provide", "the", "same", "\"", "void", "*", "state", "\"", "parameter", "created", "by", "XXH32_init", "(", ").", "Memory", "will", "be", "freed", "by", "XXH32_digest", "(", ").", "*", "/", "int", "XXH32_sizeofState", "(", "void", ")", ";", "XXH_errorcode", "XXH32_resetState", "(", "void", "*", "state", ",", "unsigned", "int", "seed", ")", ";", "Memory", "will", "be", "freed", "by", "XXH32_result", "(", ").", "#", "define", "XXH32_SIZEOFSTATE", "48", "typedef", "struct", "{", "long", "long", "ll", "[", "(", "XXH32_SIZEOFSTATE", "+", "(", "sizeof", "(", "long", "long", ")", "-", "1", ")", ")/", "sizeof", "(", "long", "long", ")", "];", "}", "XXH32_stateSpace_t", ";", "/", "*", "These", "functions", "allow", "user", "application", "to", "make", "its", "own", "allocation", "for", "state", ".", "XXH32_sizeofState", "(", ")", "is", "used", "to", "know", "how", "much", "space", "must", "be", "allocated", "for", "the", "xxHash", "32", "-", "bits", "state", ".", "Note", "that", "the", "state", "must", "be", "aligned", "to", "access", "'", "long", "long", "'", "fields", ".", "Memory", "must", "be", "allocated", "and", "referenced", "by", "a", "pointer", ".", "This", "pointer", "must", "then", "be", "provided", "as", "'", "state", "'", "into", "XXH32_resetState", "(", "),", "which", "initializes", "the", "state", ".", "For", "static", "allocation", "purposes", "(", "such", "as", "allocation", "on", "stack", ",", "or", "freestanding", "systems", "without", "malloc", "(", "))", ",", "use", "the", "structure", "XXH32_stateSpace_t", ",", "which", "will", "ensure", "that", "memory", "space", "is", "large", "enough", "and", "correctly", "aligned", "to", "access", "'", "long", "long", "'", "fields", ".", "*", "/", "unsigned", "int", "XXH32_getIntermediateResult", "(", "void", "*", "state", ")", ";", "unsigned", "int", "XXH32_intermediateDigest", "(", "void", "*", "state", ")", ";", "/", "*", "This", "function", "does", "the", "same", "as", "XXH32_result", "(", "),", "generating", "a", "32", "-", "bit", "hash", ",", "This", "function", "does", "the", "same", "as", "XXH32_digest", "(", "),", "generating", "a", "32", "-", "bit", "hash", ",", "but", "preserve", "memory", "context", ".", "This", "way", ",", "it", "becomes", "possible", "to", "generate", "intermediate", "hashes", ",", "and", "then", "continue", "feeding", "data", "with", "XXH32_feed", "(", ").", "To", "free", "memory", "context", ",", "use", "XXH32_result", "(", ").", "This", "way", ",", "it", "becomes", "possible", "to", "generate", "intermediate", "hashes", ",", "and", "then", "continue", "feeding", "data", "with", "XXH32_update", "(", ").", "To", "free", "memory", "context", ",", "use", "XXH32_digest", "(", "),", "or", "free", "(", ").", "*", "/", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "Deprecated", "function", "names", "/", "/*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "/", "The", "following", "translations", "are", "provided", "to", "ease", "code", "transition", "/", "/", "You", "are", "encouraged", "to", "no", "longer", "this", "function", "names", "#", "define", "XXH32_feed", "XXH32_update", "#", "define", "XXH32_result", "XXH32_digest", "#", "define", "XXH32_getIntermediateResult", "XXH32_intermediateDigest", "#", "if", "defined", "(", "__cplusplus", ")", "}", "#", "endif"], "docstring_tokens": ["integer", "overflows"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "593", ",", "7", "+", "593", ",", "8", "@", "@", "static", "int", "apparmor_setprocattr", "(", "struct", "task_struct", "*", "task", ",", "char", "*", "name", ",", "sa", ".", "aad", ".", "op", "=", "OP_SETPROCATTR", ";", "sa", ".", "aad", ".", "info", "=", "name", ";", "sa", ".", "aad", ".", "error", "=", "-", "EINVAL", ";", "return", "aa_audit", "(", "AUDIT_APPARMOR_DENIED", ",", "NULL", ",", "GFP_KERNEL", ",", "return", "aa_audit", "(", "AUDIT_APPARMOR_DENIED", ",", "__aa_current_profile", "(", "),", "GFP_KERNEL", ",", "&", "sa", ",", "NULL", ")", ";", "}", "}", "else", "if", "(", "strcmp", "(", "name", ",", "\"", "exec", "\"", ")", "=", "=", "0", ")", "{"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "42", ",", "7", "+", "42", ",", "7", "@", "@", "public", "static", "long", "getNextScheduledTime", "(", "final", "String", "cronEntry", ",", "long", "currentTime", "/", "/", "Handle", "the", "once", "per", "minute", "case", "\"", "*", "*", "*", "*", "*", "\"", "/", "/", "starting", "the", "next", "event", "at", "the", "top", "of", "the", "minute", ".", "if", "(", "cronEntry", ".", "startsWith", "(", "\"*", "*", "*", "*", "*", "\")", ")", "{", "if", "(", "cronEntry", ".", "equals", "(", "\"*", "*", "*", "*", "*", "\")", ")", "{", "result", "=", "currentTime", "+", "60", "*", "1000", ";", "result", "=", "result", "/", "1000", "*", "1000", ";", "return", "result", ";", "@", "@", "-", "40", ",", "13", "+", "40", ",", "13", "@", "@", "<", "c", ":", "forEach", "items", "=", "\"$", "{", "requestContext", ".", "brokerQuery", ".", "scheduledJobs", "}", "\"", "var", "=", "\"", "row", "\"", ">", "<", "tr", ">", "<", "td", ">", "${", "row", ".", "jobId", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "cronEntry", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "nextExecutionTime", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "start", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "delay", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "period", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "repeat", "}", "</", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "jobId", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "cronEntry", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "nextExecutionTime", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "start", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "delay", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "period", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "repeat", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "deleteJob", ".", "action", "?", "jobId", "=", "${", "row", ".", "jobId", "}", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "<", "/", "td", ">"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "37", ",", "17", "+", "37", ",", "13", "@", "@", "<", "@", "s", ".", "textfield", "label", "=", "\"", "Enter", "Some", "Text", "\"", "name", "=", "\"", "text", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "action", ":", "actionPrefix", "\"", "value", "=", "\"%", "{'", "action", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "action", "=", "\"", "actionPrefix", "\"", "value", "=", "\"%", "{'", "action", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "method", ":", "alternateMethod", "\"", "value", "=", "\"%", "{'", "method", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "redirect", ":", "http", ":", "//", "www", ".", "google", ".", "com", "\"", "value", "=", "\"%", "{'", "redirect", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "redirect", "-", "action", ":", "redirectActionPrefix", "\"", "value", "=", "\"%", "{'", "redirect", "-", "action", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "method", "=", "\"", "alternateMethod", "\"", "value", "=", "\"%", "{'", "method", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "value", "=", "\"", "Normal", "Submit", "\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "action", ":", "redirectActionPrefixAction", "\"", "value", "=", "\"%", "{'", "redirect", "-", "action", "without", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "action", "=", "\"", "redirectActionPrefixAction", "\"", "value", "=", "\"%", "{'", "redirectAction", "without", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "/@", "s", ".", "form", ">", "<", "/", "div", ">", "@", "@", "-", "33", ",", "11", "+", "33", ",", "15", "@", "@", "import", "org", ".", "apache", ".", "struts2", ".", "RequestUtils", ";", "import", "org", ".", "apache", ".", "struts2", ".", "ServletActionContext", ";", "import", "org", ".", "apache", ".", "struts2", ".", "StrutsConstants", ";", "import", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "ServletRedirectResult", ";", "import", "org", ".", "apache", ".", "struts2", ".", "util", ".", "PrefixTrie", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "@", "@", "-", "164", ",", "8", "+", "168", ",", "6", "@", "@", "protected", "static", "final", "String", "METHOD_PREFIX", "=", "\"", "method", ":", "\";", "protected", "static", "final", "String", "ACTION_PREFIX", "=", "\"", "action", ":", "\";", "protected", "static", "final", "String", "REDIRECT_PREFIX", "=", "\"", "redirect", ":", "\";", "protected", "static", "final", "String", "REDIRECT_ACTION_PREFIX", "=", "\"", "redirectAction", ":", "\";", "protected", "boolean", "allowDynamicMethodCalls", "=", "true", ";", "protected", "boolean", "allowSlashesInActionNames", "=", "false", ";", "@", "@", "-", "186", ",", "8", "+", "188", ",", "7", "@", "@", "public", "DefaultActionMapper", "(", ")", "{", "put", "(", "METHOD_PREFIX", ",", "new", "ParameterAction", "(", ")", "{", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "if", "(", "allowDynamicMethodCalls", ")", "{", "mapping", ".", "setMethod", "(", "key", ".", "substring", "(", "METHOD_PREFIX", ".", "length", "(", "))", ");", "mapping", ".", "setMethod", "(", "key", ".", "substring", "(", "METHOD_PREFIX", ".", "length", "(", "))", ");", "}", "}", "}", ");", "@", "@", "-", "203", ",", "34", "+", "204", ",", "10", "@", "@", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "name", "=", "name", ".", "substring", "(", "0", ",", "bang", ")", ";", "}", "}", "mapping", ".", "setName", "(", "name", ")", ";", "mapping", ".", "setName", "(", "cleanupActionName", "(", "name", ")", ");", "}", "}", ");", "put", "(", "REDIRECT_PREFIX", ",", "new", "ParameterAction", "(", ")", "{", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "ServletRedirectResult", "redirect", "=", "new", "ServletRedirectResult", "(", ");", "container", ".", "inject", "(", "redirect", ")", ";", "redirect", ".", "setLocation", "(", "key", ".", "substring", "(", "REDIRECT_PREFIX", ".", "length", "(", "))", ");", "mapping", ".", "setResult", "(", "redirect", ")", ";", "}", "}", ");", "put", "(", "REDIRECT_ACTION_PREFIX", ",", "new", "ParameterAction", "(", ")", "{", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "String", "location", "=", "key", ".", "substring", "(", "REDIRECT_ACTION_PREFIX", ".", "length", "(", "))", ";", "ServletRedirectResult", "redirect", "=", "new", "ServletRedirectResult", "(", ");", "container", ".", "inject", "(", "redirect", ")", ";", "String", "extension", "=", "getDefaultExtension", "(", ");", "if", "(", "extension", "!", "=", "null", "&", "&", "extension", ".", "length", "(", ")", ">", "0", ")", "{", "location", "+", "=", "\"", ".\"", "+", "extension", ";", "}", "redirect", ".", "setLocation", "(", "location", ")", ";", "mapping", ".", "setResult", "(", "redirect", ")", ";", "}", "}", ");", "}", "}", ";", "}", "@", "@", "-", "21", ",", "21", "+", "21", ",", "17", "@", "@", "package", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "mapper", ";", "import", "com", ".", "mockobjects", ".", "dynamic", ".", "Mock", ";", "import", "com", ".", "mockobjects", ".", "servlet", ".", "MockHttpServletRequest", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "ActionContext", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "ActionInvocation", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "Result", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "Configuration", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "ConfigurationManager", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "entities", ".", "PackageConfig", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "impl", ".", "DefaultConfiguration", ";", "import", "org", ".", "apache", ".", "struts2", ".", "ServletActionContext", ";", "import", "org", ".", "apache", ".", "struts2", ".", "StrutsTestCase", ";", "import", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "ServletRedirectResult", ";", "import", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "StrutsResultSupport", ";", "import", "org", ".", "apache", ".", "struts2", ".", "views", ".", "jsp", ".", "StrutsMockHttpServletRequest", ";", "import", "org", ".", "apache", ".", "struts2", ".", "views", ".", "jsp", ".", "StrutsMockHttpServletResponse", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "@", "@", "-", "447", ",", "7", "+", "443", ",", "7", "@", "@", "public", "void", "testActionPrefix_fromIEImageButton", "(", ")", "throws", "Exception", "{", "public", "void", "testRedirectPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "REDIRECT_PREFIX", "+", "\"", "http", ":", "//", "www", ".", "google", ".", "com", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "\"", "redirect", ":", "\"", "+", "\"", "http", ":", "//", "www", ".", "google", ".", "com", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", ".", "action", "\"", ");", "@", "@", "-", "458", ",", "25", "+", "454", ",", "28", "@", "@", "public", "void", "testRedirectPrefix", "(", ")", "throws", "Exception", "{", "ActionMapping", "actionMapping", "=", "defaultActionMapper", ".", "getMapping", "(", "request", ",", "configManager", ")", ";", "Result", "result", "=", "actionMapping", ".", "getResult", "(", ");", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "ServletRedirectResult", ")", ";", "Mock", "invMock", "=", "new", "Mock", "(", "ActionInvocation", ".", "class", ")", ";", "ActionInvocation", "inv", "=", "(", "ActionInvocation", ")", "invMock", ".", "proxy", "(", ");", "ActionContext", "ctx", "=", "ActionContext", ".", "getContext", "(", ");", "ctx", ".", "put", "(", "ServletActionContext", ".", "HTTP_REQUEST", ",", "request", ")", ";", "StrutsMockHttpServletResponse", "response", "=", "new", "StrutsMockHttpServletResponse", "(", ");", "ctx", ".", "put", "(", "ServletActionContext", ".", "HTTP_RESPONSE", ",", "response", ")", ";", "invMock", ".", "expectAndReturn", "(", "\"", "getInvocationContext", "\"", ",", "ctx", ")", ";", "invMock", ".", "expectAndReturn", "(", "\"", "getStack", "\"", ",", "ctx", ".", "getValueStack", "(", "))", ";", "result", ".", "execute", "(", "inv", ")", ";", "assertEquals", "(", "\"", "http", ":", "//", "www", ".", "google", ".", "com", "\"", ",", "response", ".", "getRedirectURL", "(", "))", ";", "/", "/", "TODO", ":", "need", "to", "test", "location", "but", "there", "'", "s", "noaccess", "to", "the", "property", "/", "method", ",", "unless", "we", "use", "reflection", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testUnsafeRedirectPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "\"", "redirect", ":", "\"", "+", "\"", "http", ":", "//", "%{", "3", "*", "4", "}", "\",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", ".", "action", "\"", ");", "request", ".", "setParameterMap", "(", "parameterMap", ")", ";", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "defaultActionMapper", ".", "setContainer", "(", "container", ")", ";", "ActionMapping", "actionMapping", "=", "defaultActionMapper", ".", "getMapping", "(", "request", ",", "configManager", ")", ";", "Result", "result", "=", "actionMapping", ".", "getResult", "(", ");", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "REDIRECT_ACTION_PREFIX", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", ".", "action", "\"", ");", "@", "@", "-", "488", ",", "17", "+", "487", ",", "29", "@", "@", "public", "void", "testRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "StrutsResultSupport", "result", "=", "(", "StrutsResultSupport", ")", "actionMapping", ".", "getResult", "(", ");", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "ServletRedirectResult", ")", ";", "assertNull", "(", "result", ")", ";", "}", "assertEquals", "(", "\"", "myAction", ".", "action", "\"", ",", "result", ".", "getLocation", "(", "))", ";", "public", "void", "testUnsafeRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "%{", "3", "*", "4", "}", "\",", "\"", "\")", ";", "/", "/", "TODO", ":", "need", "to", "test", "location", "but", "there", "'", "s", "noaccess", "to", "the", "property", "/", "method", ",", "unless", "we", "use", "reflection", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", ".", "action", "\"", ");", "request", ".", "setParameterMap", "(", "parameterMap", ")", ";", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "defaultActionMapper", ".", "setContainer", "(", "container", ")", ";", "ActionMapping", "actionMapping", "=", "defaultActionMapper", ".", "getMapping", "(", "request", ",", "configManager", ")", ";", "StrutsResultSupport", "result", "=", "(", "StrutsResultSupport", ")", "actionMapping", ".", "getResult", "(", ");", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testRedirectActionPrefixWithEmptyExtension", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "REDIRECT_ACTION_PREFIX", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", "\"", ");", "@", "@", "-", "511", ",", "12", "+", "522", ",", "7", "@", "@", "public", "void", "testRedirectActionPrefixWithEmptyExtension", "(", ")", "throws", "Exception", "{", "StrutsResultSupport", "result", "=", "(", "StrutsResultSupport", ")", "actionMapping", ".", "getResult", "(", ");", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "ServletRedirectResult", ")", ";", "assertEquals", "(", "\"", "myAction", "\"", ",", "result", ".", "getLocation", "(", "))", ";", "/", "/", "TODO", ":", "need", "to", "test", "location", "but", "there", "'", "s", "noaccess", "to", "the", "property", "/", "method", ",", "unless", "we", "use", "reflection", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testCustomActionPrefix", "(", ")", "throws", "Exception", "{"], "docstring_tokens": ["prefixed", "parameters", "ognl", "injection"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "53", ",", "12", "+", "53", ",", "17", "@", "@", "private", "static", "final", "String", "HELP_MESSAGE", "=", "\"", "migrate", "-", "-", "conf", "{", "SRC", "}", "{", "DST", "}", "\";", "private", "static", "final", "XMLInputFactory", "INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "private", "static", "final", "XMLOutputFactory", "OUTPUT_FACTORY", "=", "XMLOutputFactory", ".", "newInstance", "(", ");", "private", "static", "final", "ObjectMapper", "OBJECT_MAPPER", "=", "new", "ObjectMapper", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "private", "final", "MigrateResultManager", "migrateResultManager", "=", "new", "MigrateResultManager", "(", ");", "private", "final", "Input", "input", ";", "@", "@", "-", "144", ",", "7", "+", "149", ",", "7", "@", "@", "private", "static", "void", "exec", "(", "final", "String", "src", ",", "final", "String", "dst", ")", "reporter", ".", "writeStartElement", "(", "\"", "dataset", "\"", ");", "InputStream", "inputStream", "=", "Files", ".", "newInputStream", "(", "Paths", ".", "get", "(", "src", ")", ");", "XMLStreamReader", "reader", "=", "INPUT_FACTORY", ".", "createXMLStreamReader", "(", "inputStream", ")", ";", "XMLStreamReader", "reader", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "inputStream", ")", ";", "reader", ".", "nextTag", "(", ");", "/", "/", "root", "reader", ".", "nextTag", "(", ");", "/", "/", "dataset", "@", "@", "-", "33", ",", "10", "+", "33", ",", "15", "@", "@", "public", "final", "class", "ReconciliationReportParser", "{", "private", "static", "final", "XMLInputFactory", "INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "ReconciliationReport", "parse", "(", "final", "Date", "run", ",", "final", "InputStream", "in", ")", "throws", "XMLStreamException", "{", "XMLStreamReader", "streamReader", "=", "INPUT_FACTORY", ".", "createXMLStreamReader", "(", "in", ")", ";", "XMLStreamReader", "streamReader", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "in", ")", ";", "streamReader", ".", "nextTag", "(", ");", "/", "/", "root", "streamReader", ".", "nextTag", "(", ");", "/", "/", "report", "streamReader", ".", "nextTag", "(", ");", "/", "/", "reportlet", "@", "@", "-", "41", ",", "6", "+", "41", ",", "13", "@", "@", "private", "static", "final", "ObjectMapper", "OBJECT_MAPPER", "=", "new", "ObjectMapper", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "Deployment", "deployDefinition", "(", "final", "ProcessEngine", "engine", ",", "final", "String", "resourceName", ",", "final", "byte", "[", "]", "definition", ")", "{", "@", "@", "-", "58", ",", "7", "+", "65", ",", "7", "@", "@", "public", "static", "void", "deployModel", "(", "final", "ProcessEngine", "engine", ",", "final", "ProcessDefiniti", "getResourceAsStream", "(", "procDef", ".", "getDeploymentId", "(", "),", "procDef", ".", "getResourceName", "(", "))", ";", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "bpmnStream", ")", ")", "{", "xtr", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLStreamReader", "(", "isr", ")", ";", "xtr", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "isr", ")", ";", "BpmnModel", "bpmnModel", "=", "new", "BpmnXMLConverter", "(", ").", "convertToBpmnModel", "(", "xtr", ")", ";", "Model", "model", "=", "engine", ".", "getRepositoryService", "(", ").", "newModel", "(", ");", "@", "@", "-", "73", ",", "6", "+", "73", ",", "7", "@", "@", "public", "DomainProcessEngine", "getObject", "(", ")", "throws", "Exception", "{", "if", "(", "conf", ".", "getExpressionManager", "(", ")", "=", "=", "null", ")", "{", "conf", ".", "setExpressionManager", "(", "new", "SpringExpressionManager", "(", "ctx", ",", "conf", ".", "getBeans", "(", "))", ");", "}", "conf", ".", "setEnableSafeBpmnXml", "(", "true", ")", ";", "engines", ".", "put", "(", "domain", ",", "conf", ".", "buildProcessEngine", "(", "))", ";", "}", "@", "@", "-", "41", ",", "6", "+", "41", ",", "13", "@", "@", "private", "static", "final", "ObjectMapper", "OBJECT_MAPPER", "=", "new", "ObjectMapper", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "Deployment", "deployDefinition", "(", "final", "ProcessEngine", "engine", ",", "final", "String", "resourceName", ",", "final", "byte", "[", "]", "definition", ")", "{", "@", "@", "-", "58", ",", "7", "+", "65", ",", "7", "@", "@", "public", "static", "void", "deployModel", "(", "final", "ProcessEngine", "engine", ",", "final", "ProcessDefiniti", "getResourceAsStream", "(", "procDef", ".", "getDeploymentId", "(", "),", "procDef", ".", "getResourceName", "(", "))", ";", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "bpmnStream", ")", ")", "{", "xtr", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLStreamReader", "(", "isr", ")", ";", "xtr", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "isr", ")", ";", "BpmnModel", "bpmnModel", "=", "new", "BpmnXMLConverter", "(", ").", "convertToBpmnModel", "(", "xtr", ")", ";", "Model", "model", "=", "engine", ".", "getRepositoryService", "(", ").", "newModel", "(", ");", "@", "@", "-", "73", ",", "6", "+", "73", ",", "7", "@", "@", "public", "DomainProcessEngine", "getObject", "(", ")", "throws", "Exception", "{", "if", "(", "conf", ".", "getExpressionManager", "(", ")", "=", "=", "null", ")", "{", "conf", ".", "setExpressionManager", "(", "new", "SpringExpressionManager", "(", "ctx", ",", "conf", ".", "getBeans", "(", "))", ");", "}", "conf", ".", "setEnableSafeBpmnXml", "(", "true", ")", ";", "engines", ".", "put", "(", "domain", ",", "conf", ".", "buildProcessEngine", "(", "))", ";", "}"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "157", ",", "18", "+", "157", ",", "30", "@", "@", "public", "void", "init", "(", "ServletConfig", "pServletConfig", ")", "throws", "ServletException", "{", "*", "@", "param", "pConfig", "configuration", "to", "update", "*", "/", "private", "void", "addJsr160DispatcherIfExternallyConfigured", "(", "Configuration", "pConfig", ")", "{", "for", "(", "String", "param", ":", "new", "String", "[", "]", "{", "System", ".", "getProperty", "(", "\"", "org", ".", "jolokia", ".", "jsr160ProxyEnabled", "\"", "),", "System", ".", "getenv", "(", "\"", "JOLOKIA_JSR160_PROXY_ENABLED", "\"", ")", "}", ")", "{", "if", "(", "param", "!", "=", "null", "&", "&", "(", "param", ".", "isEmpty", "(", ")", "|", "|", "Boolean", ".", "parseBoolean", "(", "param", ")", "))", "{", "String", "dispatchers", "=", "pConfig", ".", "get", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ")", ";", "pConfig", ".", "updateGlobalConfiguration", "(", "Collections", ".", "singletonMap", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ".", "getKeyValue", "(", "),", "(", "dispatchers", "!", "=", "null", "?", "dispatchers", "+", "\"", ",\"", ":", "\"", "\")", "+", "\"", "org", ".", "jolokia", ".", "jsr160", ".", "Jsr160RequestDispatcher", "\"", "))", ";", "return", ";", "String", "dispatchers", "=", "pConfig", ".", "get", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ")", ";", "String", "jsr160DispatcherClass", "=", "\"", "org", ".", "jolokia", ".", "jsr160", ".", "Jsr160RequestDispatcher", "\"", ";", "if", "(", "dispatchers", "=", "=", "null", "|", "|", "!", "dispatchers", ".", "contains", "(", "jsr160DispatcherClass", ")", ")", "{", "for", "(", "String", "param", ":", "new", "String", "[", "]{", "System", ".", "getProperty", "(", "\"", "org", ".", "jolokia", ".", "jsr160ProxyEnabled", "\"", "),", "System", ".", "getenv", "(", "\"", "JOLOKIA_JSR160_PROXY_ENABLED", "\"", ")", "}", ")", "{", "if", "(", "param", "!", "=", "null", "&", "&", "(", "param", ".", "isEmpty", "(", ")", "|", "|", "Boolean", ".", "parseBoolean", "(", "param", ")", "))", "{", "{", "pConfig", ".", "updateGlobalConfiguration", "(", "Collections", ".", "singletonMap", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ".", "getKeyValue", "(", "),", "(", "dispatchers", "!", "=", "null", "?", "dispatchers", "+", "\"", ",\"", ":", "\"", "\")", "+", "jsr160DispatcherClass", ")", ");", "}", "return", ";", "}", "}", "if", "(", "dispatchers", "=", "=", "null", ")", "{", "/", "/", "We", "add", "a", "breaking", "dispatcher", "to", "avoid", "silently", "ignoring", "a", "JSR160", "proxy", "request", "/", "/", "when", "it", "is", "now", "enabled", "pConfig", ".", "updateGlobalConfiguration", "(", "Collections", ".", "singletonMap", "(", "ConfigKey", ".", "DISPATCHER_CLASSES", ".", "getKeyValue", "(", "),", "Jsr160ProxyNotEnabledByDefaultAnymoreDispatcher", ".", "class", ".", "getCanonicalName", "(", "))", ");", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "54", "@", "@", "package", "org", ".", "jolokia", ".", "http", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "management", ".", "AttributeNotFoundException", ";", "import", "javax", ".", "management", ".", "InstanceNotFoundException", ";", "import", "javax", ".", "management", ".", "MBeanException", ";", "import", "javax", ".", "management", ".", "ReflectionException", ";", "import", "org", ".", "jolokia", ".", "backend", ".", "RequestDispatcher", ";", "import", "org", ".", "jolokia", ".", "backend", ".", "executor", ".", "NotChangedException", ";", "import", "org", ".", "jolokia", ".", "config", ".", "Configuration", ";", "import", "org", ".", "jolokia", ".", "converter", ".", "Converters", ";", "import", "org", ".", "jolokia", ".", "detector", ".", "ServerHandle", ";", "import", "org", ".", "jolokia", ".", "handler", ".", "RequestHandlerManager", ";", "import", "org", ".", "jolokia", ".", "request", ".", "JmxRequest", ";", "import", "org", ".", "jolokia", ".", "restrictor", ".", "Restrictor", ";", "/", "**", "*", "Temporary", "dispatcher", "added", "to", "avoid", "confusion", "for", "users", "which", "use", "1", ".", "5", ".", "0", "as", "a", "drop", "in", "replacement", "*", "for", "a", "JSR", "-", "160", "proxy", "server", ".", "Otherwise", "Jolokia", "requests", "for", "a", "JSR", "-", "160", "target", "will", "be", "silently", "*", "ignored", "and", "the", "MBeans", "of", "the", "Proxy", "server", "would", "be", "queried", ".", "*", "*", "@", "author", "roland", "*", "@", "since", "08", ".", "02", ".", "18", "*", "/", "public", "class", "Jsr160ProxyNotEnabledByDefaultAnymoreDispatcher", "implements", "RequestDispatcher", "{", "/", "/", "Constructor", "required", "for", "the", "backend", "to", "be", "able", "to", "crete", "the", "constructor", "public", "Jsr160ProxyNotEnabledByDefaultAnymoreDispatcher", "(", "Converters", "pConverters", ",", "ServerHandle", "pServerInfo", ",", "Restrictor", "pRestrictor", ",", "Configuration", "pConfig", ")", "{", "}", "@", "Override", "public", "Object", "dispatchRequest", "(", "JmxRequest", "pJmxReq", ")", "throws", "InstanceNotFoundException", ",", "AttributeNotFoundException", ",", "ReflectionException", ",", "MBeanException", ",", "IOException", ",", "NotChangedException", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "No", "JSR", "-", "160", "proxy", "is", "enabled", "by", "default", "since", "Jolokia", "1", ".", "5", ".", "0", ".", "\"", "\"", "Please", "refer", "to", "the", "reference", "manual", ",", "section", "\\", "\"", "Proxy", "Mode", "\\", "\",", "\"", "\"", "for", "how", "to", "switch", "on", "JSR", "-", "160", "proxy", "mode", "again", ".", "\")", ";", "}", "@", "Override", "public", "boolean", "canHandle", "(", "JmxRequest", "pJmxRequest", ")", "{", "return", "pJmxRequest", ".", "getTargetConfig", "(", ")", "!", "=", "null", ";", "}", "@", "Override", "public", "boolean", "useReturnValueWithPath", "(", "JmxRequest", "pJmxRequest", ")", "{", "return", "false", ";", "}", "}"], "docstring_tokens": ["jndi", "injection"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "80", ",", "6", "+", "80", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JreCompat", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JreVendor", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "res", ".", "StringManager", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "security", ".", "PermissionCheck", ";", "/", "**", "*", "Specialized", "web", "application", "class", "loader", ".", "@", "@", "-", "125", ",", "7", "+", "126", ",", "7", "@", "@", "*", "@", "author", "Craig", "R", ".", "McClanahan", "*", "/", "public", "abstract", "class", "WebappClassLoaderBase", "extends", "URLClassLoader", "implements", "Lifecycle", ",", "InstrumentableClassLoader", ",", "WebappProperties", "{", "implements", "Lifecycle", ",", "InstrumentableClassLoader", ",", "WebappProperties", ",", "PermissionCheck", "{", "private", "static", "final", "org", ".", "apache", ".", "juli", ".", "logging", ".", "Log", "log", "=", "org", ".", "apache", ".", "juli", ".", "logging", ".", "LogFactory", ".", "getLog", "(", "WebappClassLoaderBase", ".", "class", ")", ";", "@", "@", "-", "1386", ",", "6", "+", "1387", ",", "24", "@", "@", "protected", "PermissionCollection", "getPermissions", "(", "CodeSource", "codeSource", ")", "{", "}", "@", "Override", "public", "boolean", "check", "(", "Permission", "permission", ")", "{", "if", "(", "!", "Globals", ".", "IS_SECURITY_ENABLED", ")", "{", "return", "true", ";", "}", "Policy", "currentPolicy", "=", "Policy", ".", "getPolicy", "(", ");", "if", "(", "currentPolicy", "!", "=", "null", ")", "{", "URL", "contextRootUrl", "=", "resources", ".", "getResource", "(", "\"/", "\")", ".", "getCodeBase", "(", ");", "CodeSource", "cs", "=", "new", "CodeSource", "(", "contextRootUrl", ",", "(", "Certificate", "[", "])", "null", ")", ";", "PermissionCollection", "pc", "=", "currentPolicy", ".", "getPermissions", "(", "cs", ")", ";", "if", "(", "pc", ".", "implies", "(", "permission", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "<", "p", ">", "@", "@", "-", "23", ",", "11", "+", "23", ",", "13", "@", "@", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "java", ".", "security", ".", "Permission", ";", "import", "java", ".", "util", ".", "EmptyStackException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "PropertyPermission", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "SAXParser", ";", "@", "@", "-", "37", ",", "6", "+", "39", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "ExceptionUtils", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "IntrospectionUtils", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "security", ".", "PermissionCheck", ";", "import", "org", ".", "xml", ".", "sax", ".", "Attributes", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "ErrorHandler", ";", "@", "@", "-", "78", ",", "6", "+", "81", ",", "13", "@", "@", "implements", "IntrospectionUtils", ".", "PropertySource", "{", "@", "Override", "public", "String", "getProperty", "(", "String", "key", ")", "{", "ClassLoader", "cl", "=", "Thread", ".", "currentThread", "(", ").", "getContextClassLoader", "(", ");", "if", "(", "cl", "instanceof", "PermissionCheck", ")", "{", "Permission", "p", "=", "new", "PropertyPermission", "(", "key", ",", "\"", "read", "\"", ");", "if", "(", "!(", "(", "PermissionCheck", ")", "cl", ")", ".", "check", "(", "p", ")", ")", "{", "return", "null", ";", "}", "}", "return", "System", ".", "getProperty", "(", "key", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "43", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "security", ";", "import", "java", ".", "security", ".", "Permission", ";", "/", "**", "*", "This", "interface", "is", "implemented", "by", "components", "to", "enable", "privileged", "code", "to", "*", "check", "whether", "the", "component", "has", "a", "given", "permission", ".", "*", "This", "is", "typically", "used", "when", "a", "privileged", "component", "(", "e", ".", "g", ".", "the", "container", ")", "is", "*", "performing", "an", "action", "on", "behalf", "of", "an", "untrusted", "component", "(", "e", ".", "g", ".", "a", "web", "*", "application", ")", "without", "the", "current", "thread", "having", "passed", "through", "a", "code", "source", "*", "provided", "by", "the", "untrusted", "component", ".", "Because", "the", "current", "thread", "has", "not", "*", "passed", "through", "a", "code", "source", "provided", "by", "the", "untrusted", "component", "the", "*", "SecurityManager", "assumes", "the", "code", "is", "trusted", "so", "the", "standard", "checking", "*", "mechanisms", "can", "'", "t", "be", "used", ".", "*", "/", "public", "interface", "PermissionCheck", "{", "/", "**", "*", "Does", "this", "component", "have", "the", "given", "permission", "?", "*", "*", "@", "param", "permission", "The", "permission", "to", "test", "*", "*", "@", "return", "{", "@", "code", "false", "}", "if", "a", "SecurityManager", "is", "enabled", "and", "the", "component", "*", "does", "not", "have", "the", "given", "permission", ",", "otherwise", "{", "@", "code", "false", "}", "*", "/", "boolean", "check", "(", "Permission", "permission", ")", ";", "}", "@", "@", "-", "109", ",", "6", "+", "109", ",", "14", "@", "@", "<", "bug", ">", "59859", "<", "/", "bug", ">", ":", "Fix", "resource", "leak", "in", "WebDAV", "servlet", ".", "Based", "on", "patch", "by", "Coty", "Sutherland", ".", "(", "fschumacher", ")", "<", "/", "fix", ">", "<", "add", ">", "Provide", "a", "mechanism", "that", "enables", "the", "container", "to", "check", "if", "a", "component", "(", "typically", "a", "web", "application", ")", "has", "been", "granted", "a", "given", "permission", "when", "running", "under", "a", "SecurityManager", "without", "the", "current", "execution", "stack", "having", "to", "have", "passed", "through", "the", "component", ".", "Use", "this", "new", "mechanism", "to", "extend", "SecurityManager", "protection", "to", "the", "system", "property", "replacement", "feature", "of", "the", "digester", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">"], "docstring_tokens": ["property", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "139", ",", "7", "+", "139", ",", "7", "@", "@", "subprojects", "{", "subproject", "-", ">", "springSecurityVersion", "=", "'", "5", ".", "1", ".", "2", ".", "RELEASE", "'", "springRetryVersion", "=", "'", "1", ".", "2", ".", "2", ".", "RELEASE", "'", "springVersion", "=", "project", ".", "hasProperty", "(", "'", "springVersion", "'", ")", "?", "project", ".", "springVersion", ":", "'", "5", ".", "1", ".", "4", ".", "RELEASE", "'", "springWsVersion", "=", "'", "3", ".", "0", ".", "4", ".", "RELEASE", "'", "springWsVersion", "=", "'", "3", ".", "0", ".", "5", ".", "RELEASE", "'", "tomcatVersion", "=", "\"", "9", ".", "0", ".", "12", "\"", "xstreamVersion", "=", "'", "1", ".", "4", ".", "11", ".", "1", "'", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "33", ",", "6", "+", "33", ",", "8", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "/", "**", "*", "Default", "implementation", "of", "{", "@", "link", "XmlPayloadConverter", "}", ".", "Supports", "@", "@", "-", "48", ",", "11", "+", "50", ",", "12", "@", "@", "public", "DefaultXmlPayloadConverter", "(", ")", "{", "this", ".", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "this", "(", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", "))", ";", "this", ".", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "}", "public", "DefaultXmlPayloadConverter", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "Assert", ".", "notNull", "(", "documentBuilderFactory", ",", "\"", "'", "documentBuilderFactory", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "documentBuilderFactory", "=", "documentBuilderFactory", ";", "}", "@", "@", "-", "115", ",", "7", "+", "118", ",", "7", "@", "@", "protected", "Document", "nodeToDocument", "(", "Node", "node", ")", "{", "@", "Override", "public", "Node", "convertToNode", "(", "Object", "object", ")", "{", "Node", "node", "=", "null", ";", "Node", "node", ";", "if", "(", "object", "instanceof", "Node", ")", "{", "node", "=", "(", "Node", ")", "object", ";", "}", "@", "@", "-", "130", ",", "7", "+", "133", ",", "6", "@", "@", "else", "if", "(", "object", "instanceof", "DOMSource", ")", "{", "@", "Override", "public", "Source", "convertToSource", "(", "Object", "object", ")", "{", "Source", "source", "=", "null", ";", "if", "(", "object", "instanceof", "Source", ")", "{", "return", "(", "Source", ")", "object", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2014", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "34", ",", "6", "+", "34", ",", "7", "@", "@", "*", "*", "@", "author", "Mark", "Fisher", "*", "@", "author", "Artem", "Bilan", "*", "*", "@", "since", "2", ".", "0", "*", "/", "public", "class", "XPathHeaderEnricherParser", "extends", "AbstractTransformerParser", "{", "@", "@", "-", "45", ",", "15", "+", "46", ",", "16", "@", "@", "protected", "final", "String", "getTransformerClassName", "(", ")", "{", "@", "Override", "protected", "void", "parseTransformer", "(", "Element", "element", ",", "ParserContext", "parserContext", ",", "BeanDefinitionBuilder", "builder", ")", "{", "ManagedMap", "<", "String", ",", "Object", ">", "headers", "=", "new", "ManagedMap", "<", "String", ",", "Object", ">", "()", ";", "this", ".", "processHeaders", "(", "element", ",", "headers", ",", "parserContext", ")", ";", "ManagedMap", "<", "String", ",", "Object", ">", "headers", "=", "new", "ManagedMap", "<", ">(", ");", "processHeaders", "(", "element", ",", "headers", ",", "parserContext", ")", ";", "builder", ".", "addConstructorArgValue", "(", "headers", ")", ";", "IntegrationNamespaceUtils", ".", "setValueIfAttributeDefined", "(", "builder", ",", "element", ",", "\"", "default", "-", "overwrite", "\"", ");", "IntegrationNamespaceUtils", ".", "setValueIfAttributeDefined", "(", "builder", ",", "element", ",", "\"", "should", "-", "skip", "-", "nulls", "\"", ");", "}", "protected", "void", "processHeaders", "(", "Element", "element", ",", "ManagedMap", "<", "String", ",", "Object", ">", "headers", ",", "ParserContext", "parserContext", ")", "{", "Object", "source", "=", "parserContext", ".", "extractSource", "(", "element", ")", ";", "String", "converter", "=", "element", ".", "getAttribute", "(", "\"", "converter", "\"", ");", "NodeList", "childNodes", "=", "element", ".", "getChildNodes", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "childNodes", ".", "getLength", "(", ");", "i", "+", "+)", "{", "Node", "node", "=", "childNodes", ".", "item", "(", "i", ")", ";", "@", "@", "-", "62", ",", "21", "+", "64", ",", "26", "@", "@", "protected", "void", "processHeaders", "(", "Element", "element", ",", "ManagedMap", "<", "String", ",", "Object", ">", "header", "String", "elementName", "=", "node", ".", "getLocalName", "(", ");", "if", "(", "\"", "header", "\"", ".", "equals", "(", "elementName", ")", ")", "{", "BeanDefinitionBuilder", "builder", "=", "BeanDefinitionBuilder", ".", "genericBeanDefinition", "(", "XPathExpressionEvaluatingHeaderValueMessageProcessor", ".", "class", ")", ";", "BeanDefinitionBuilder", ".", "genericBeanDefinition", "(", "XPathExpressionEvaluatingHeaderValueMessageProcessor", ".", "class", ")", ";", "String", "expressionString", "=", "headerElement", ".", "getAttribute", "(", "\"", "xpath", "-", "expression", "\"", ");", "String", "expressionRef", "=", "headerElement", ".", "getAttribute", "(", "\"", "xpath", "-", "expression", "-", "ref", "\"", ");", "boolean", "isExpressionString", "=", "StringUtils", ".", "hasText", "(", "expressionString", ")", ";", "boolean", "isExpressionRef", "=", "StringUtils", ".", "hasText", "(", "expressionRef", ")", ";", "if", "(", "!(", "isExpressionString", "^", "isExpressionRef", ")", ")", "{", "if", "(", "isExpressionString", "=", "=", "isExpressionRef", ")", "{", "parserContext", ".", "getReaderContext", "(", ").", "error", "(", "\"", "Exactly", "one", "of", "the", "'", "xpath", "-", "expression", "'", "or", "'", "xpath", "-", "expression", "-", "ref", "'", "attributes", "is", "required", ".", "\",", "source", ")", ";", "\"", "Exactly", "one", "of", "the", "'", "xpath", "-", "expression", "'", "\"", "\"", "or", "'", "xpath", "-", "expression", "-", "ref", "'", "attributes", "is", "required", ".", "\",", "source", ")", ";", "}", "if", "(", "isExpressionString", ")", "{", "builder", ".", "addConstructorArgValue", "(", "expressionString", ")", ";", "}", "else", "{", "builder", ".", "addConstructorArgReference", "(", "expressionRef", ")", ";", "}", "if", "(", "StringUtils", ".", "hasText", "(", "converter", ")", ")", "{", "builder", ".", "addConstructorArgReference", "(", "converter", ")", ";", "}", "IntegrationNamespaceUtils", ".", "setValueIfAttributeDefined", "(", "builder", ",", "headerElement", ",", "\"", "evaluation", "-", "type", "\"", ");", "IntegrationNamespaceUtils", ".", "setValueIfAttributeDefined", "(", "builder", ",", "headerElement", ",", "\"", "overwrite", "\"", ");", "IntegrationNamespaceUtils", ".", "setValueIfAttributeDefined", "(", "builder", ",", "headerElement", ",", "\"", "header", "-", "type", "\"", ");", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2010", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "23", ",", "23", "+", "23", ",", "26", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "/", "**", "*", "@", "author", "Jonas", "Partner", "*", "@", "author", "Artem", "Bilan", "*", "/", "public", "class", "DomResultFactory", "implements", "ResultFactory", "{", "private", "final", "DocumentBuilderFactory", "documentBuilderFactory", ";", "public", "DomResultFactory", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "this", ".", "documentBuilderFactory", "=", "documentBuilderFactory", ";", "public", "DomResultFactory", "(", ")", "{", "this", "(", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", "))", ";", "this", ".", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "}", "public", "DomResultFactory", "(", ")", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "factory", ".", "setNamespaceAware", "(", "true", ")", ";", "this", ".", "documentBuilderFactory", "=", "factory", ";", "public", "DomResultFactory", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "Assert", ".", "notNull", "(", "documentBuilderFactory", ",", "\"", "'", "documentBuilderFactory", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "documentBuilderFactory", "=", "documentBuilderFactory", ";", "}", "@", "@", "-", "41", ",", "6", "+", "41", ",", "8", "@", "@", "*", "@", "author", "Oleg", "Zhurakousky", "*", "@", "author", "Gary", "Russell", "*", "@", "author", "Liujiong", "*", "@", "author", "Artem", "Bilan", "*", "*", "@", "since", "2", ".", "0", "*", "/", "public", "class", "XmlValidatingMessageSelector", "implements", "MessageSelector", "{", "@", "@", "-", "63", ",", "44", "+", "65", ",", "42", "@", "@", "public", "String", "getUrl", "(", ")", "{", "}", "private", "final", "Log", "logger", "=", "LogFactory", ".", "getLog", "(", "this", ".", "getClass", "(", "))", ";", "private", "final", "Log", "logger", "=", "LogFactory", ".", "getLog", "(", "getClass", "(", "))", ";", "private", "final", "XmlValidator", "xmlValidator", ";", "private", "volatile", "boolean", "throwExceptionOnRejection", ";", "private", "boolean", "throwExceptionOnRejection", ";", "private", "volatile", "XmlPayloadConverter", "converter", "=", "new", "DefaultXmlPayloadConverter", "(", ");", "public", "XmlValidatingMessageSelector", "(", "XmlValidator", "xmlValidator", ")", "{", "Assert", ".", "notNull", "(", "xmlValidator", ",", "\"", "XmlValidator", "must", "not", "be", "null", "\"", ");", "this", ".", "xmlValidator", "=", "xmlValidator", ";", "}", "private", "XmlPayloadConverter", "converter", "=", "new", "DefaultXmlPayloadConverter", "(", ");", "/", "**", "*", "Creates", "a", "selector", "with", "a", "default", "{", "@", "link", "XmlValidator", "}", ".", "The", "validator", "will", "be", "initialized", "with", "*", "the", "provided", "'", "schema", "'", "location", "{", "@", "link", "Resource", "}", "and", "'", "schemaType", "'", ".", "The", "valid", "options", "for", "schema", "*", "type", "are", "{", "@", "link", "XmlValidatorFactory", "#", "SCHEMA_W3C_XML", "}", "or", "{", "@", "link", "XmlValidatorFactory", "#", "SCHEMA_RELAX_NG", "}", ".", "*", "If", "no", "'", "schemaType", "'", "is", "provided", "it", "will", "default", "to", "{", "@", "link", "XmlValidatorFactory", "#", "SCHEMA_W3C_XML", "}", ";", "*", "*", "@", "param", "schema", "The", "schema", ".", "*", "@", "param", "schemaTypeArg", "The", "schema", "type", ".", "*", "*", "@", "param", "schemaType", "The", "schema", "type", ".", "*", "@", "throws", "IOException", "if", "the", "XmlValidatorFactory", "fails", "to", "create", "a", "validator", "*", "/", "public", "XmlValidatingMessageSelector", "(", "Resource", "schema", ",", "SchemaType", "schemaTypeArg", ")", "throws", "IOException", "{", "SchemaType", "schemaType", "=", "schemaTypeArg", ";", "Assert", ".", "notNull", "(", "schema", ",", "\"", "You", "must", "provide", "XML", "schema", "location", "to", "perform", "validation", "\"", ");", "if", "(", "schemaType", "=", "=", "null", ")", "{", "schemaType", "=", "SchemaType", ".", "XML_SCHEMA", ";", "}", "this", ".", "xmlValidator", "=", "XmlValidatorFactory", ".", "createValidator", "(", "schema", ",", "schemaType", ".", "getUrl", "(", "))", ";", "public", "XmlValidatingMessageSelector", "(", "Resource", "schema", ",", "SchemaType", "schemaType", ")", "throws", "IOException", "{", "this", "(", "XmlValidatorFactory", ".", "createValidator", "(", "schema", ",", "schemaType", "=", "=", "null", "?", "SchemaType", ".", "XML_SCHEMA", ".", "getUrl", "(", ")", ":", "schemaType", ".", "getUrl", "(", "))", ");", "}", "public", "XmlValidatingMessageSelector", "(", "XmlValidator", "xmlValidator", ")", "{", "Assert", ".", "notNull", "(", "xmlValidator", ",", "\"", "XmlValidator", "must", "not", "be", "null", "\"", ");", "this", ".", "xmlValidator", "=", "xmlValidator", ";", "}", "public", "XmlValidatingMessageSelector", "(", "Resource", "schema", ",", "String", "schemaType", ")", "throws", "IOException", "{", "this", "(", "schema", ",", "StringUtils", ".", "isEmpty", "(", "schemaType", ")", "?", "null", ":", "SchemaType", ".", "valueOf", "(", "schemaType", ".", "toUpperCase", "(", ").", "replaceFirst", "(", "\"-", "\",", "\"", "_", "\"", "))", ");", "this", "(", "schema", ",", "StringUtils", ".", "isEmpty", "(", "schemaType", ")", "?", "null", ":", "SchemaType", ".", "valueOf", "(", "schemaType", ".", "toUpperCase", "(", ").", "replaceFirst", "(", "\"-", "\",", "\"", "_", "\"", "))", ");", "}", "@", "@", "-", "131", ",", "10", "+", "131", ",", "12", "@", "@", "public", "boolean", "accept", "(", "Message", "<", "?>", "message", ")", "{", "if", "(", "!", "validationSuccess", ")", "{", "if", "(", "this", ".", "throwExceptionOnRejection", ")", "{", "throw", "new", "MessageRejectedException", "(", "message", ",", "\"", "Message", "was", "rejected", "due", "to", "XML", "Validation", "errors", "\"", ",", "new", "AggregatedXmlMessageValidationException", "(", "Arrays", ".", "<", "Throwable", ">", "asList", "(", "validationExceptions", ")", "))", ";", "new", "AggregatedXmlMessageValidationException", "(", "Arrays", ".", "asList", "(", "validationExceptions", ")", "))", ";", "}", "else", "if", "(", "this", ".", "logger", ".", "isInfoEnabled", "(", "))", "{", "this", ".", "logger", ".", "info", "(", "\"", "Message", "was", "rejected", "due", "to", "XML", "Validation", "errors", "\"", ",", "new", "AggregatedXmlMessageValidationException", "(", "Arrays", ".", "asList", "(", "validationExceptions", ")", "))", ";", "}", "this", ".", "logger", ".", "debug", "(", "\"", "Message", "was", "rejected", "due", "to", "XML", "Validation", "errors", "\"", ");", "}", "return", "validationSuccess", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "29", ",", "26", "+", "29", ",", "29", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "/", "**", "*", "{", "@", "link", "SourceFactory", "}", "implementation", "which", "supports", "creation", "of", "a", "{", "@", "link", "DOMSource", "}", "*", "from", "a", "{", "@", "link", "Document", "}", ",", "{", "@", "link", "File", "}", "or", "{", "@", "link", "String", "}", "payload", ".", "*", "*", "@", "author", "Jonas", "Partner", "*", "@", "author", "Mark", "Fisher", "*", "@", "author", "Artem", "Bilan", "*", "/", "public", "class", "DomSourceFactory", "implements", "SourceFactory", "{", "private", "final", "DocumentBuilderFactory", "documentBuilderFactory", ";", "public", "DomSourceFactory", "(", ")", "{", "DocumentBuilderFactory", "factory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "factory", ".", "setNamespaceAware", "(", "true", ")", ";", "this", ".", "documentBuilderFactory", "=", "factory", ";", "this", "(", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", "))", ";", "this", ".", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "}", "public", "DomSourceFactory", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "Assert", ".", "notNull", "(", "documentBuilderFactory", ",", "\"", "'", "documentBuilderFactory", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "documentBuilderFactory", "=", "documentBuilderFactory", ";", "}", "@", "@", "-", "87", ",", "7", "+", "90", ",", "7", "@", "@", "private", "DOMSource", "createDomSourceForString", "(", "String", "s", ")", "{", "private", "DOMSource", "createDomSourceForFile", "(", "File", "file", ")", "{", "try", "{", "Document", "document", "=", "this", ".", "getNewDocumentBuilder", "(", ").", "parse", "(", "file", ")", ";", "Document", "document", "=", "getNewDocumentBuilder", "(", ").", "parse", "(", "file", ")", ";", "return", "new", "DOMSource", "(", "document", ".", "getDocumentElement", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "27", ",", "27", "+", "27", ",", "31", "@", "@", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "/", "**", "*", "{", "@", "link", "SourceFactory", "}", "implementation", "which", "supports", "creation", "of", "a", "{", "@", "link", "StringSource", "}", "*", "from", "a", "{", "@", "link", "Document", "}", ",", "{", "@", "link", "File", "}", "or", "{", "@", "link", "String", "}", "payload", "*", "*", "@", "author", "Jonas", "Partner", "*", "@", "author", "Mark", "Fisher", "*", "@", "author", "Artem", "Bilan", "*", "/", "public", "class", "StringSourceFactory", "implements", "SourceFactory", "{", "private", "final", "TransformerFactory", "transformerFactory", ";", "public", "StringSourceFactory", "(", ")", "{", "this", "(", "TransformerFactory", ".", "newInstance", "(", "))", ";", "this", "(", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "}", "public", "StringSourceFactory", "(", "TransformerFactory", "transformerFactory", ")", "{", "Assert", ".", "notNull", "(", "transformerFactory", ",", "\"", "'", "transformerFactory", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "transformerFactory", "=", "transformerFactory", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "48", ",", "8", "+", "48", ",", "10", "@", "@", "import", "org", ".", "springframework", ".", "messaging", ".", "MessageHandlingException", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "converter", ".", "MessageConversionException", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "namespace", ".", "SimpleNamespaceContext", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathException", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpression", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpressionFactory", ";", "@", "@", "-", "68", ",", "30", "+", "70", ",", "57", "@", "@", "*", "/", "public", "class", "XPathMessageSplitter", "extends", "AbstractMessageSplitter", "{", "private", "final", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "private", "final", "TransformerFactory", "transformerFactory", ";", "private", "final", "Object", "documentBuilderFactoryMonitor", "=", "new", "Object", "(", ");", "private", "final", "XPathExpression", "xpathExpression", ";", "private", "javax", ".", "xml", ".", "xpath", ".", "XPathExpression", "jaxpExpression", ";", "private", "volatile", "boolean", "createDocuments", ";", "private", "boolean", "createDocuments", ";", "private", "volatile", "DocumentBuilderFactory", "documentBuilderFactory", ";", "private", "DocumentBuilderFactory", "documentBuilderFactory", ";", "private", "volatile", "XmlPayloadConverter", "xmlPayloadConverter", "=", "new", "DefaultXmlPayloadConverter", "(", ");", "private", "XmlPayloadConverter", "xmlPayloadConverter", "=", "new", "DefaultXmlPayloadConverter", "(", ");", "private", "volatile", "Properties", "outputProperties", ";", "private", "Properties", "outputProperties", ";", "private", "volatile", "boolean", "iterator", "=", "true", ";", "private", "boolean", "iterator", "=", "true", ";", "public", "XPathMessageSplitter", "(", "String", "expression", ")", "{", "this", "(", "expression", ",", "new", "HashMap", "<", "String", ",", "String", ">", "()", ");", "this", "(", "expression", ",", "new", "HashMap", "<", ">(", "))", ";", "}", "/", "**", "*", "Construct", "an", "instance", "based", "on", "the", "provided", "xpath", "expression", "and", "*", "{", "@", "link", "TransformerFactory", "}", ".", "*", "@", "param", "expression", "the", "xpath", "expression", "for", "splitting", ".", "*", "@", "param", "transformerFactory", "the", "{", "@", "link", "TransformerFactory", "}", "*", "for", "parsing", "and", "building", "documents", ".", "*", "@", "since", "4", ".", "3", ".", "19", "*", "/", "public", "XPathMessageSplitter", "(", "String", "expression", ",", "TransformerFactory", "transformerFactory", ")", "{", "this", "(", "expression", ",", "new", "HashMap", "<", ">(", "),", "transformerFactory", ")", ";", "}", "public", "XPathMessageSplitter", "(", "String", "expression", ",", "Map", "<", "String", ",", "String", ">", "namespaces", ")", "{", "this", "(", "XPathExpressionFactory", ".", "createXPathExpression", "(", "expression", ",", "namespaces", ")", ");", "this", "(", "expression", ",", "namespaces", ",", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "}", "/", "**", "*", "Construct", "an", "instance", "based", "on", "the", "provided", "xpath", "expression", ",", "namespaces", "and", "*", "{", "@", "link", "TransformerFactory", "}", ".", "*", "@", "param", "expression", "the", "xpath", "expression", "for", "splitting", ".", "*", "@", "param", "namespaces", "the", "XML", "namespace", "for", "parsing", ".", "*", "@", "param", "transformerFactory", "the", "{", "@", "link", "TransformerFactory", "}", "*", "for", "parsing", "and", "building", "documents", ".", "*", "@", "since", "4", ".", "3", ".", "19", "*", "/", "public", "XPathMessageSplitter", "(", "String", "expression", ",", "Map", "<", "String", ",", "String", ">", "namespaces", ",", "TransformerFactory", "transformerFactory", ")", "{", "this", "(", "XPathExpressionFactory", ".", "createXPathExpression", "(", "expression", ",", "namespaces", ")", ",", "transformerFactory", ")", ";", "XPath", "xpath", "=", "XPathFactory", ".", "newInstance", "(", ").", "newXPath", "(", ");", "SimpleNamespaceContext", "namespaceContext", "=", "new", "SimpleNamespaceContext", "(", ");", "@", "@", "-", "107", ",", "13", "+", "136", ",", "26", "@", "@", "public", "XPathMessageSplitter", "(", "String", "expression", ",", "Map", "<", "String", ",", "String", ">", "namespaces", ")", "{", "}", "public", "XPathMessageSplitter", "(", "XPathExpression", "xpathExpression", ")", "{", "this", "(", "xpathExpression", ",", "TransformerFactoryUtils", ".", "newInstance", "(", "))", ";", "}", "/", "**", "*", "Construct", "an", "instance", "based", "on", "the", "provided", "xpath", "expression", "and", "*", "{", "@", "link", "TransformerFactory", "}", ".", "*", "@", "param", "xpathExpression", "the", "xpath", "expression", "for", "splitting", ".", "*", "@", "param", "transformerFactory", "the", "{", "@", "link", "TransformerFactory", "}", "*", "for", "parsing", "and", "building", "documents", ".", "*", "@", "since", "4", ".", "3", ".", "19", "*", "/", "public", "XPathMessageSplitter", "(", "XPathExpression", "xpathExpression", ",", "TransformerFactory", "transformerFactory", ")", "{", "Assert", ".", "notNull", "(", "xpathExpression", ",", "\"", "'", "xpathExpression", "'", "must", "not", "be", "null", ".", "\")", ";", "Assert", ".", "notNull", "(", "transformerFactory", ",", "\"", "'", "transformerFactory", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "xpathExpression", "=", "xpathExpression", ";", "this", ".", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "this", ".", "transformerFactory", "=", "transformerFactory", ";", "this", ".", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "this", ".", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "}", "public", "void", "setCreateDocuments", "(", "boolean", "createDocuments", ")", "{", "this", ".", "createDocuments", "=", "createDocuments", ";", "}", "@", "@", "-", "215", ",", "7", "+", "257", ",", "7", "@", "@", "private", "Object", "splitDocument", "(", "Document", "document", ")", "throws", "Exception", "{", "if", "(", "nodes", "instanceof", "List", ")", "{", "List", "<", "Node", ">", "items", "=", "(", "List", "<", "Node", ">", ")", "nodes", ";", "List", "<", "String", ">", "splitStrings", "=", "new", "ArrayList", "<", "String", ">", "(", "items", ".", "size", "(", "))", ";", "List", "<", "String", ">", "splitStrings", "=", "new", "ArrayList", "<", ">(", "items", ".", "size", "(", "))", ";", "for", "(", "Node", "nodeFromList", ":", "items", ")", "{", "StringResult", "result", "=", "new", "StringResult", "(", ");", "transformer", ".", "transform", "(", "new", "DOMSource", "(", "nodeFromList", ")", ",", "result", ")", ";", "@", "@", "-", "328", ",", "6", "+", "370", ",", "7", "@", "@", "public", "void", "remove", "(", ")", "{", "TransformFunctionIterator", "(", "Iterator", "<", "Node", ">", "delegate", ",", "Function", "<", "?", "super", "Node", ",", "?", "extends", "String", ">", "function", ")", "{", "super", "(", "null", ",", "delegate", ",", "function", ")", ";", "this", ".", "delegate", "=", "delegate", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2010", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "28", ",", "32", "+", "28", ",", "36", "@", "@", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "/", "**", "*", "Creates", "a", "{", "@", "link", "Document", "}", "from", "a", "{", "@", "link", "Result", "}", "payload", ".", "Supports", "*", "{", "@", "link", "DOMResult", "}", "and", "{", "@", "link", "StringResult", "}", "implementations", ".", "*", "*", "@", "author", "Jonas", "Partner", "*", "@", "author", "Artem", "Bilan", "*", "/", "public", "class", "ResultToDocumentTransformer", "implements", "ResultTransformer", "{", "/", "/", "Not", "guaranteed", "to", "be", "thread", "safe", "private", "final", "DocumentBuilderFactory", "documentBuilderFactory", ";", "public", "ResultToDocumentTransformer", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "this", ".", "documentBuilderFactory", "=", "documentBuilderFactory", ";", "}", "public", "ResultToDocumentTransformer", "(", ")", "{", "this", ".", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "this", "(", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", "))", ";", "this", ".", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "}", "public", "ResultToDocumentTransformer", "(", "DocumentBuilderFactory", "documentBuilderFactory", ")", "{", "Assert", ".", "notNull", "(", "documentBuilderFactory", ",", "\"", "'", "documentBuilderFactory", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "documentBuilderFactory", "=", "documentBuilderFactory", ";", "}", "public", "Object", "transformResult", "(", "Result", "result", ")", "{", "Document", "document", "=", "null", ";", "Document", "document", ";", "if", "(", "DOMResult", ".", "class", ".", "isAssignableFrom", "(", "result", ".", "getClass", "(", "))", ")", "{", "document", "=", "createDocumentFromDomResult", "(", "(", "DOMResult", ")", "result", ")", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2010", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "27", ",", "24", "+", "27", ",", "37", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMSource", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "/", "**", "*", "Converts", "the", "passed", "{", "@", "link", "Result", "}", "to", "an", "instance", "of", "{", "@", "link", "String", "}", ".", "*", "Supports", "{", "@", "link", "StringResult", "}", "and", "{", "@", "link", "DOMResult", "}", "*", "*", "@", "author", "Jonas", "Partner", "*", "@", "author", "Mark", "Fisher", "*", "@", "author", "Artem", "Bilan", "*", "/", "public", "class", "ResultToStringTransformer", "implements", "ResultTransformer", "{", "private", "volatile", "Properties", "outputProperties", ";", "private", "final", "TransformerFactory", "transformerFactory", ";", "private", "Properties", "outputProperties", ";", "public", "ResultToStringTransformer", "(", ")", "{", "this", ".", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "this", ".", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "}", "/", "**", "*", "Construct", "an", "instance", "based", "on", "the", "provided", "{", "@", "link", "TransformerFactory", "}", ".", "*", "@", "param", "transformerFactory", "the", "{", "@", "link", "TransformerFactory", "}", "to", "use", ".", "*", "@", "since", "4", ".", "3", ".", "19", "*", "/", "public", "ResultToStringTransformer", "(", "TransformerFactory", "transformerFactory", ")", "{", "Assert", ".", "notNull", "(", "transformerFactory", ",", "\"", "'", "transformerFactory", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "transformerFactory", "=", "transformerFactory", ";", "}", "@", "@", "-", "55", ",", "12", "+", "68", ",", "12", "@", "@", "public", "void", "setOutputProperties", "(", "Properties", "outputProperties", ")", "{", "public", "Object", "transformResult", "(", "Result", "result", ")", "{", "String", "returnString", "=", "null", ";", "if", "(", "result", "instanceof", "StringResult", ")", "{", "returnString", "=", "(", "(", "StringResult", ")", "result", ")", ".", "toString", "(", ");", "returnString", "=", "result", ".", "toString", "(", ");", "}", "else", "if", "(", "result", "instanceof", "DOMResult", ")", "{", "try", "{", "StringResult", "stringResult", "=", "new", "StringResult", "(", ");", "this", ".", "getNewTransformer", "(", ").", "transform", "(", "getNewTransformer", "(", ").", "transform", "(", "new", "DOMSource", "(", "((", "DOMResult", ")", "result", ")", ".", "getNode", "(", "))", ",", "stringResult", ")", ";", "returnString", "=", "stringResult", ".", "toString", "(", ");", "}", "@", "@", "-", "76", ",", "7", "+", "89", ",", "7", "@", "@", "else", "if", "(", "result", "instanceof", "DOMResult", ")", "{", "}", "private", "Transformer", "getNewTransformer", "(", ")", "throws", "TransformerConfigurationException", "{", "Transformer", "transformer", "=", "null", ";", "Transformer", "transformer", ";", "synchronized", "(", "this", ".", "transformerFactory", ")", "{", "transformer", "=", "this", ".", "transformerFactory", ".", "newTransformer", "(", ");", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Map", ".", "Entry", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Templates", ";", "@", "@", "-", "35", ",", "7", "+", "36", ",", "10", "@", "@", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "BeanClassLoaderAware", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "FileSystemResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "VfsResource", ";", "import", "org", ".", "springframework", ".", "expression", ".", "Expression", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardEvaluationContext", ";", "import", "org", ".", "springframework", ".", "integration", ".", "expression", ".", "ExpressionUtils", ";", "@", "@", "-", "48", ",", "8", "+", "52", ",", "10", "@", "@", "import", "org", ".", "springframework", ".", "util", ".", "ObjectUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "PatternMatchUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "context", ".", "support", ".", "ServletContextResource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "TransformerFactoryUtils", ";", "/", "**", "*", "Thread", "safe", "XSLT", "transformer", "implementation", "which", "returns", "a", "transformed", "@", "@", "-", "83", ",", "25", "+", "89", ",", "25", "@", "@", "private", "final", "ResultTransformer", "resultTransformer", ";", "private", "volatile", "Resource", "xslResource", ";", "private", "final", "Resource", "xslResource", ";", "private", "volatile", "Templates", "templates", ";", "private", "Templates", "templates", ";", "private", "String", "transformerFactoryClassName", ";", "private", "volatile", "StandardEvaluationContext", "evaluationContext", ";", "private", "Map", "<", "String", ",", "Expression", ">", "xslParameterMappings", ";", "private", "volatile", "SourceFactory", "sourceFactory", "=", "new", "DomSourceFactory", "(", ");", "private", "SourceFactory", "sourceFactory", "=", "new", "DomSourceFactory", "(", ");", "private", "volatile", "boolean", "resultFactoryExplicitlySet", ";", "private", "boolean", "resultFactoryExplicitlySet", ";", "private", "volatile", "boolean", "alwaysUseSourceFactory", "=", "false", ";", "private", "boolean", "alwaysUseSourceFactory", "=", "false", ";", "private", "volatile", "boolean", "alwaysUseResultFactory", "=", "false", ";", "private", "boolean", "alwaysUseResultFactory", "=", "false", ";", "private", "volatile", "String", "[", "]", "xsltParamHeaders", ";", "private", "String", "[", "]", "xsltParamHeaders", ";", "private", "ClassLoader", "classLoader", ";", "@", "@", "-", "110", ",", "6", "+", "116", ",", "13", "@", "@", "public", "XsltPayloadTransformer", "(", "Templates", "templates", ")", "{", "this", "(", "templates", ",", "null", ")", ";", "}", "public", "XsltPayloadTransformer", "(", "Templates", "templates", ",", "ResultTransformer", "resultTransformer", ")", "{", "Assert", ".", "notNull", "(", "templates", ",", "\"", "'", "templates", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "templates", "=", "templates", ";", "this", ".", "resultTransformer", "=", "resultTransformer", ";", "this", ".", "xslResource", "=", "null", ";", "}", "public", "XsltPayloadTransformer", "(", "Resource", "xslResource", ")", "{", "this", "(", "xslResource", ",", "null", ",", "null", ")", ";", "}", "@", "@", "-", "119", ",", "29", "+", "132", ",", "25", "@", "@", "public", "XsltPayloadTransformer", "(", "Resource", "xslResource", ",", "ResultTransformer", "resultTran", "}", "public", "XsltPayloadTransformer", "(", "Resource", "xslResource", ",", "String", "transformerFactoryClassName", ")", "{", "Assert", ".", "notNull", "(", "xslResource", ",", "\"", "'", "xslResource", "'", "must", "not", "be", "null", ".", "\")", ";", "Assert", ".", "hasText", "(", "transformerFactoryClassName", ",", "\"", "'", "transformerFactoryClassName", "'", "must", "not", "be", "empty", "String", ".", "\")", ";", "this", ".", "xslResource", "=", "xslResource", ";", "this", ".", "transformerFactoryClassName", "=", "transformerFactoryClassName", ";", "this", ".", "resultTransformer", "=", "null", ";", "this", "(", "xslResource", ",", "null", ",", "transformerFactoryClassName", ")", ";", "}", "public", "XsltPayloadTransformer", "(", "Resource", "xslResource", ",", "ResultTransformer", "resultTransformer", ",", "String", "transformerFactoryClassName", ")", "{", "public", "XsltPayloadTransformer", "(", "Resource", "xslResource", ",", "ResultTransformer", "resultTransformer", ",", "String", "transformerFactoryClassName", ")", "{", "Assert", ".", "notNull", "(", "xslResource", ",", "\"", "'", "xslResource", "'", "must", "not", "be", "null", ".", "\")", ";", "Assert", ".", "isTrue", "(", "xslResource", "instanceof", "ClassPathResource", "|", "|", "xslResource", "instanceof", "FileSystemResource", "|", "|", "xslResource", "instanceof", "ServletContextResource", "|", "|", "xslResource", "instanceof", "VfsResource", ",", "\"", "Only", "'", "ClassPathResource", "'", ",", "'", "FileSystemResource", "'", ",", "'", "ServletContextResource", "'", "or", "'", "VfsResource", "'", "\"", "\"", "are", "supported", "directly", "in", "this", "transformer", ".", "For", "any", "other", "'", "Resource", "'", "implementations", "\"", "\"", "consider", "to", "use", "a", "'", "Templates", "'", "-", "based", "constructor", "instantiation", ".", "\")", ";", "this", ".", "xslResource", "=", "xslResource", ";", "this", ".", "resultTransformer", "=", "resultTransformer", ";", "this", ".", "transformerFactoryClassName", "=", "transformerFactoryClassName", ";", "}", "public", "XsltPayloadTransformer", "(", "Templates", "templates", ",", "ResultTransformer", "resultTransformer", ")", "{", "Assert", ".", "notNull", "(", "templates", ",", "\"", "'", "templates", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "templates", "=", "templates", ";", "this", ".", "resultTransformer", "=", "resultTransformer", ";", "}", "/", "**", "*", "Sets", "the", "SourceFactory", ".", "*", "*", "@", "param", "sourceFactory", "The", "source", "factory", ".", "*", "/", "public", "void", "setSourceFactory", "(", "SourceFactory", "sourceFactory", ")", "{", "@", "@", "-", "151", ",", "7", "+", "160", ",", "6", "@", "@", "public", "void", "setSourceFactory", "(", "SourceFactory", "sourceFactory", ")", "{", "/", "**", "*", "Sets", "the", "ResultFactory", ".", "*", "*", "@", "param", "resultFactory", "The", "result", "factory", ".", "*", "/", "@", "Override", "@", "@", "-", "162", ",", "7", "+", "170", ",", "6", "@", "@", "public", "void", "setResultFactory", "(", "ResultFactory", "resultFactory", ")", "{", "/", "**", "*", "Specify", "whether", "to", "always", "use", "source", "factory", "even", "for", "directly", "supported", "payload", "types", ".", "*", "*", "@", "param", "alwaysUseSourceFactory", "true", "to", "always", "use", "the", "source", "factory", ".", "*", "/", "public", "void", "setAlwaysUseSourceFactory", "(", "boolean", "alwaysUseSourceFactory", ")", "{", "@", "@", "-", "171", ",", "7", "+", "178", ",", "6", "@", "@", "public", "void", "setAlwaysUseSourceFactory", "(", "boolean", "alwaysUseSourceFactory", ")", "{", "/", "**", "*", "Specify", "whether", "to", "always", "use", "result", "factory", "even", "for", "directly", "supported", "payload", "types", "*", "*", "@", "param", "alwaysUseResultFactory", "true", "to", "always", "use", "the", "result", "factory", ".", "*", "/", "public", "void", "setAlwaysUseResultFactory", "(", "boolean", "alwaysUseResultFactory", ")", "{", "@", "@", "-", "182", ",", "7", "+", "188", ",", "8", "@", "@", "public", "void", "setXslParameterMappings", "(", "Map", "<", "String", ",", "Expression", ">", "xslParameterMappings", "this", ".", "xslParameterMappings", "=", "xslParameterMappings", ";", "}", "public", "void", "setXsltParamHeaders", "(", "String", "[", "]", "xsltParamHeaders", ")", "{", "public", "void", "setXsltParamHeaders", "(", "String", ".", "..", "xsltParamHeaders", ")", "{", "Assert", ".", "notNull", "(", "xsltParamHeaders", ",", "\"", "'", "xsltParamHeaders", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "xsltParamHeaders", "=", "Arrays", ".", "copyOf", "(", "xsltParamHeaders", ",", "xsltParamHeaders", ".", "length", ")", ";", "}", "@", "@", "-", "216", ",", "15", "+", "223", ",", "17", "@", "@", "public", "String", "getComponentType", "(", ")", "{", "@", "Override", "protected", "void", "onInit", "(", ")", "{", "super", ".", "onInit", "(", ");", "this", ".", "evaluationContext", "=", "ExpressionUtils", ".", "createStandardEvaluationContext", "(", "this", ".", "getBeanFactory", "(", "))", ";", "this", ".", "evaluationContext", "=", "ExpressionUtils", ".", "createStandardEvaluationContext", "(", "getBeanFactory", "(", "))", ";", "if", "(", "this", ".", "templates", "=", "=", "null", ")", "{", "TransformerFactory", "transformerFactory", ";", "if", "(", "this", ".", "transformerFactoryClassName", "!", "=", "null", ")", "{", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", "this", ".", "transformerFactoryClassName", ",", "this", ".", "classLoader", ")", ";", "}", "else", "{", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", "=", "TransformerFactoryUtils", ".", "newInstance", "(", ");", "}", "transformerFactory", ".", "setAttribute", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "transformerFactory", ".", "setAttribute", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_STYLESHEET", ",", "\"", "file", ",", "jar", ":", "file", "\"", ");", "try", "{", "this", ".", "templates", "=", "transformerFactory", ".", "newTemplates", "(", "createStreamSourceOnResource", "(", "this", ".", "xslResource", ")", ");", "}", "@", "@", "-", "284", ",", "13", "+", "293", ",", "16", "@", "@", "else", "if", "(", "payload", "instanceof", "Source", ")", "{", "return", "transformSource", "(", "source", ",", "payload", ",", "transformer", ")", ";", "}", "private", "Object", "transformSource", "(", "Source", "source", ",", "Object", "payload", ",", "Transformer", "transformer", ")", "throws", "TransformerException", "{", "private", "Object", "transformSource", "(", "Source", "source", ",", "Object", "payload", ",", "Transformer", "transformer", ")", "throws", "TransformerException", "{", "Result", "result", ";", "if", "(", "!", "this", ".", "resultFactoryExplicitlySet", "&", "&", "\"", "text", "\"", ".", "equals", "(", "transformer", ".", "getOutputProperties", "(", ").", "getProperty", "(", "\"", "method", "\"", "))", ")", "{", "if", "(", "!", "this", ".", "resultFactoryExplicitlySet", "&", "&", "\"", "text", "\"", ".", "equals", "(", "transformer", ".", "getOutputProperties", "(", ").", "getProperty", "(", "\"", "method", "\"", "))", ")", "{", "result", "=", "new", "StringResult", "(", ");", "}", "else", "{", "result", "=", "this", ".", "getResultFactory", "(", ").", "createResult", "(", "payload", ")", ";", "result", "=", "getResultFactory", "(", ").", "createResult", "(", "payload", ")", ";", "}", "transformer", ".", "transform", "(", "source", ",", "result", ")", ";", "if", "(", "this", ".", "resultTransformer", "!", "=", "null", ")", "{", "@", "@", "-", "320", ",", "7", "+", "332", ",", "7", "@", "@", "private", "Document", "transformDocument", "(", "Document", "documentPayload", ",", "Transformer", "transfo", "else", "{", "source", "=", "new", "DOMSource", "(", "documentPayload", ")", ";", "}", "Result", "result", "=", "this", ".", "getResultFactory", "(", ").", "createResult", "(", "documentPayload", ")", ";", "Result", "result", "=", "getResultFactory", "(", ").", "createResult", "(", "documentPayload", ")", ";", "if", "(", "!", "DOMResult", ".", "class", ".", "isAssignableFrom", "(", "result", ".", "getClass", "(", "))", ")", "{", "throw", "new", "MessagingException", "(", "\"", "Document", "to", "Document", "conversion", "requires", "a", "DOMResult", "-", "producing", "ResultFactory", "implementation", ".", "\")", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2014", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2014", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "38", ",", "31", "+", "38", ",", "55", "@", "@", "*", "@", "author", "Jonas", "Partner", "*", "@", "author", "Mark", "Fisher", "*", "@", "author", "Artem", "Bilan", "*", "*", "@", "since", "2", ".", "0", "*", "/", "public", "class", "XPathExpressionEvaluatingHeaderValueMessageProcessor", "implements", "HeaderValueMessageProcessor", "<", "Object", ">", ",", "BeanFactoryAware", "{", "private", "static", "final", "XmlPayloadConverter", "converter", "=", "new", "DefaultXmlPayloadConverter", "(", ");", "private", "final", "BeanFactoryTypeConverter", "typeConverter", "=", "new", "BeanFactoryTypeConverter", "(", ");", "private", "final", "XPathExpression", "expression", ";", "private", "volatile", "XPathEvaluationType", "evaluationType", "=", "XPathEvaluationType", ".", "STRING_RESULT", ";", "private", "final", "XmlPayloadConverter", "converter", ";", "private", "volatile", "TypeDescriptor", "headerTypeDescriptor", ";", "private", "XPathEvaluationType", "evaluationType", "=", "XPathEvaluationType", ".", "STRING_RESULT", ";", "private", "volatile", "Boolean", "overwrite", "=", "null", ";", "private", "TypeDescriptor", "headerTypeDescriptor", ";", "private", "Boolean", "overwrite", ";", "public", "XPathExpressionEvaluatingHeaderValueMessageProcessor", "(", "String", "expression", ")", "{", "Assert", ".", "hasText", "(", "expression", ",", "\"", "expression", "must", "have", "text", "\"", ");", "this", ".", "expression", "=", "XPathExpressionFactory", ".", "createXPathExpression", "(", "expression", ")", ";", "this", "(", "expression", ",", "new", "DefaultXmlPayloadConverter", "(", "))", ";", "}", "/", "**", "*", "Construct", "an", "instance", "based", "on", "the", "provided", "xpath", "expression", "and", "{", "@", "link", "XmlPayloadConverter", "}", ".", "*", "@", "param", "expression", "the", "xpath", "expression", "to", "evaluate", ".", "*", "@", "param", "converter", "the", "{", "@", "link", "XmlPayloadConverter", "}", "to", "use", "for", "document", "conversion", ".", "*", "@", "since", "4", ".", "3", ".", "19", "*", "/", "public", "XPathExpressionEvaluatingHeaderValueMessageProcessor", "(", "String", "expression", ",", "XmlPayloadConverter", "converter", ")", "{", "this", "(", "XPathExpressionFactory", ".", "createXPathExpression", "(", "expression", ")", ",", "converter", ")", ";", "}", "public", "XPathExpressionEvaluatingHeaderValueMessageProcessor", "(", "XPathExpression", "expression", ")", "{", "Assert", ".", "notNull", "(", "expression", ",", "\"", "expression", "must", "not", "be", "null", "\"", ");", "this", "(", "expression", ",", "new", "DefaultXmlPayloadConverter", "(", "))", ";", "}", "/", "**", "*", "Construct", "an", "instance", "based", "on", "the", "provided", "xpath", "expression", "and", "{", "@", "link", "XmlPayloadConverter", "}", ".", "*", "@", "param", "expression", "the", "xpath", "expression", "to", "evaluate", ".", "*", "@", "param", "converter", "the", "{", "@", "link", "XmlPayloadConverter", "}", "to", "use", "for", "document", "conversion", ".", "*", "@", "since", "4", ".", "3", ".", "19", "*", "/", "public", "XPathExpressionEvaluatingHeaderValueMessageProcessor", "(", "XPathExpression", "expression", ",", "XmlPayloadConverter", "converter", ")", "{", "Assert", ".", "notNull", "(", "expression", ",", "\"", "'", "expression", "'", "must", "not", "be", "null", ".", "\")", ";", "Assert", ".", "notNull", "(", "converter", ",", "\"", "'", "converter", "'", "must", "not", "be", "null", ".", "\")", ";", "this", ".", "expression", "=", "expression", ";", "this", ".", "converter", "=", "converter", ";", "}", "public", "void", "setEvaluationType", "(", "XPathEvaluationType", "evaluationType", ")", "{", "@", "@", "-", "94", ",", "7", "+", "118", ",", "7", "@", "@", "public", "void", "setBeanFactory", "(", "BeanFactory", "beanFactory", ")", "throws", "BeansException", "{", "@", "Override", "public", "Object", "processMessage", "(", "Message", "<", "?>", "message", ")", "{", "Node", "node", "=", "converter", ".", "convertToNode", "(", "message", ".", "getPayload", "(", "))", ";", "Node", "node", "=", "this", ".", "converter", ".", "convertToNode", "(", "message", ".", "getPayload", "(", "))", ";", "Object", "result", "=", "this", ".", "evaluationType", ".", "evaluateXPath", "(", "this", ".", "expression", ",", "node", ")", ";", "if", "(", "result", "instanceof", "String", "&", "&", "(", "(", "String", ")", "result", ")", ".", "length", "(", ")", "=", "=", "0", ")", "{", "result", "=", "null", ";", "@", "@", "-", "106", ",", "4", "+", "130", ",", "5", "@", "@", "public", "Object", "processMessage", "(", "Message", "<", "?>", "message", ")", "{", "return", "result", ";", "}", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2013", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2013", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "31", ",", "6", "+", "31", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "DefaultXmlPayloadConverter", ";", "import", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "XmlPayloadConverter", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "xml", ".", "DocumentBuilderFactoryUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "NodeMapper", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathException", ";", "import", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "XPathExpression", ";", "@", "@", "-", "41", ",", "6", "+", "42", ",", "7", "@", "@", "*", "*", "@", "author", "Artem", "Bilan", "*", "@", "author", "Gary", "Russell", "*", "*", "@", "since", "3", ".", "0", "*", "/", "public", "final", "class", "XPathUtils", "{", "@", "@", "-", "57", ",", "31", "+", "59", ",", "36", "@", "@", "public", "static", "final", "String", "DOCUMENT_LIST", "=", "\"", "document_list", "\"", ";", "private", "static", "List", "<", "String", ">", "RESULT_TYPES", "=", "Arrays", ".", "asList", "(", "STRING", ",", "BOOLEAN", ",", "NUMBER", ",", "NODE", ",", "NODE_LIST", ",", "DOCUMENT_LIST", ")", ";", "private", "static", "final", "List", "<", "String", ">", "RESULT_TYPES", "=", "Arrays", ".", "asList", "(", "STRING", ",", "BOOLEAN", ",", "NUMBER", ",", "NODE", ",", "NODE_LIST", ",", "DOCUMENT_LIST", ")", ";", "private", "static", "final", "XmlPayloadConverter", "converter", "=", "new", "DefaultXmlPayloadConverter", "(", ");", "private", "static", "XmlPayloadConverter", "converter", "=", "new", "DefaultXmlPayloadConverter", "(", ");", "private", "static", "final", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactoryUtils", ".", "newInstance", "(", ");", "private", "static", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "static", "{", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "}", "/", "**", "*", "Utility", "method", "to", "evaluate", "an", "xpath", "on", "the", "provided", "object", ".", "*", "Delegates", "evaluation", "to", "an", "{", "@", "link", "XPathExpression", "}", ".", "*", "Note", "this", "method", "provides", "the", "{", "@", "code", "#", "xpath", "(", ")}", "SpEL", "function", ".", "*", "*", "*", "@", "param", "o", "the", "xml", "Object", "for", "evaluaton", ".", "*", "@", "param", "xpath", "an", "'", "xpath", "'", "expression", "String", ".", "*", "@", "param", "object", "the", "xml", "Object", "for", "evaluation", ".", "*", "@", "param", "xpath", "an", "'", "xpath", "'", "expression", "String", ".", "*", "@", "param", "resultArg", "an", "optional", "parameter", "to", "represent", "the", "result", "type", "of", "the", "xpath", "evaluation", ".", "*", "Only", "one", "argument", "is", "allowed", ",", "which", "can", "be", "an", "instance", "of", "{", "@", "link", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "NodeMapper", "}", "or", "*", "one", "of", "these", "String", "constants", ":", "\"", "string", "\"", ",", "\"", "boolean", "\"", ",", "\"", "number", "\"", ",", "\"", "node", "\"", "or", "\"", "node_list", "\"", ".", "*", "@", "param", "<", "T", ">", "The", "required", "return", "type", ".", "*", "Only", "one", "argument", "is", "allowed", ",", "which", "can", "be", "an", "instance", "of", "*", "{", "@", "link", "org", ".", "springframework", ".", "xml", ".", "xpath", ".", "NodeMapper", "}", "or", "*", "one", "of", "these", "String", "constants", ":", "\"", "string", "\"", ",", "\"", "boolean", "\"", ",", "\"", "number", "\"", ",", "\"", "node", "\"", "or", "\"", "node_list", "\"", ".", "*", "@", "param", "<", "T", ">", "The", "required", "return", "type", ".", "*", "@", "return", "the", "result", "of", "the", "xpath", "expression", "evaluation", ".", "*", "@", "throws", "IllegalArgumentException", "-", "if", "the", "provided", "arguments", "aren", "'", "t", "appropriate", "types", "or", "values", ";", "*", "@", "throws", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", "-", "if", "the", "provided", "object", "can", "'", "t", "be", "converted", "to", "a", "{", "@", "link", "Node", "}", ";", "*", "@", "throws", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", "-", "if", "the", "provided", "*", "object", "can", "'", "t", "be", "converted", "to", "a", "{", "@", "link", "Node", "}", ";", "*", "@", "throws", "XPathException", "-", "if", "the", "xpath", "expression", "can", "'", "t", "be", "evaluated", ".", "*", "/", "@", "SuppressWarnings", "(", "{\"", "unchecked", "\"", "})", "public", "static", "<", "T", ">", "T", "evaluate", "(", "Object", "o", ",", "String", "xpath", ",", "Object", ".", "..", "resultArg", ")", "{", "@", "SuppressWarnings", "(", "{", "\"", "unchecked", "\"", "}", ")", "public", "static", "<", "T", ">", "T", "evaluate", "(", "Object", "object", ",", "String", "xpath", ",", "Object", ".", "..", "resultArg", ")", "{", "Object", "resultType", "=", "null", ";", "if", "(", "resultArg", "!", "=", "null", "&", "&", "resultArg", ".", "length", ">", "0", ")", "{", "Assert", ".", "isTrue", "(", "resultArg", ".", "length", "=", "=", "1", ",", "\"", "'", "resultArg", "'", "can", "contains", "only", "one", "element", ".", "\")", ";", "@", "@", "-", "90", ",", "7", "+", "97", ",", "7", "@", "@", "}", "XPathExpression", "expression", "=", "XPathExpressionFactory", ".", "createXPathExpression", "(", "xpath", ")", ";", "Node", "node", "=", "converter", ".", "convertToNode", "(", "o", ")", ";", "Node", "node", "=", "converter", ".", "convertToNode", "(", "object", ")", ";", "if", "(", "resultType", "=", "=", "null", ")", "{", "return", "(", "T", ")", "expression", ".", "evaluateAsString", "(", "node", ")", ";", "@", "@", "-", "101", ",", "10", "+", "108", ",", "11", "@", "@", "else", "if", "(", "resultType", "instanceof", "NodeMapper", "<", "?>", ")", "{", "else", "if", "(", "resultType", "instanceof", "String", "&", "&", "RESULT_TYPES", ".", "contains", "(", "resultType", ")", ")", "{", "String", "resType", "=", "(", "String", ")", "resultType", ";", "if", "(", "DOCUMENT_LIST", ".", "equals", "(", "resType", ")", ")", "{", "List", "<", "Node", ">", "nodeList", "=", "(", "List", "<", "Node", ">", ")", "XPathEvaluationType", ".", "NODE_LIST_RESULT", ".", "evaluateXPath", "(", "expression", ",", "node", ")", ";", "List", "<", "Node", ">", "nodeList", "=", "(", "List", "<", "Node", ">", ")", "XPathEvaluationType", ".", "NODE_LIST_RESULT", ".", "evaluateXPath", "(", "expression", ",", "node", ")", ";", "try", "{", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "List", "<", "Node", ">", "documents", "=", "new", "ArrayList", "<", "Node", ">", "(", "nodeList", ".", "size", "(", "))", ";", "List", "<", "Node", ">", "documents", "=", "new", "ArrayList", "<", ">(", "nodeList", ".", "size", "(", "))", ";", "for", "(", "Node", "n", ":", "nodeList", ")", "{", "Document", "document", "=", "documentBuilder", ".", "newDocument", "(", ");", "document", ".", "appendChild", "(", "document", ".", "importNode", "(", "n", ",", "true", ")", ");", "@", "@", "-", "383", ",", "6", "+", "383", ",", "22", "@", "@", "<", "xsd", ":", "union", "memberTypes", "=", "\"", "xsd", ":", "boolean", "xsd", ":", "string", "\"", "/", ">", "<", "/", "xsd", ":", "simpleType", ">", "<", "/", "xsd", ":", "attribute", ">", "<", "xsd", ":", "attribute", "name", "=", "\"", "converter", "\"", ">", "<", "xsd", ":", "annotation", ">", "<", "xsd", ":", "documentation", ">", "Specify", "the", "XmlPayloadConverter", "to", "use", "when", "converting", "a", "Message", "payload", "prior", "to", "XPath", "evaluation", ".", "The", "DefaultXmlPayloadConverter", "is", "used", "if", "this", "reference", "is", "not", "provided", ",", "and", "it", "should", "be", "sufficient", "in", "most", "cases", "since", "it", "can", "convert", "from", "Node", ",", "Document", ",", "Source", ",", "File", ",", "and", "String", "typed", "payloads", ".", "<", "/", "xsd", ":", "documentation", ">", "<", "xsd", ":", "appinfo", ">", "<", "tool", ":", "annotation", "kind", "=", "\"", "ref", "\"", ">", "<", "tool", ":", "expected", "-", "type", "type", "=", "\"", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "XmlPayloadConverter", "\"", "/>", "<", "/", "tool", ":", "annotation", ">", "<", "/", "xsd", ":", "appinfo", ">", "<", "/", "xsd", ":", "annotation", ">", "<", "/", "xsd", ":", "attribute", ">", "<", "/", "xsd", ":", "extension", ">", "<", "/", "xsd", ":", "complexContent", ">", "<", "/", "xsd", ":", "complexType", ">", "@", "@", "-", "53", ",", "8", "+", "53", ",", "14", "@", "@", "<", "header", "name", "=", "\"", "foo", "\"", "xpath", "-", "expression", "=", "\"/", "person", "/", "@", "name", "\"", "overwrite", "=", "\"", "true", "\"", "/", ">", "<", "/", "xpath", "-", "header", "-", "enricher", ">", "<", "xpath", "-", "header", "-", "enricher", "id", "=", "\"", "customHeaderEnricher", "\"", "input", "-", "channel", "=", "\"", "customInput", "\"", "default", "-", "overwrite", "=", "\"", "true", "\"", "should", "-", "skip", "-", "nulls", "=", "\"", "false", "\"", ">", "<", "xpath", "-", "header", "-", "enricher", "id", "=", "\"", "customHeaderEnricher", "\"", "input", "-", "channel", "=", "\"", "customInput", "\"", "default", "-", "overwrite", "=", "\"", "true", "\"", "should", "-", "skip", "-", "nulls", "=", "\"", "false", "\"", "converter", "=", "\"", "xmlPayloadConverter", "\"", ">", "<", "header", "name", "=", "\"", "foo", "\"", "xpath", "-", "expression", "=", "\"/", "person", "/", "@", "name", "\"", "overwrite", "=", "\"", "false", "\"", "/", ">", "<", "/", "xpath", "-", "header", "-", "enricher", ">", "<", "beans", ":", "bean", "id", "=", "\"", "xmlPayloadConverter", "\"", "class", "=", "\"", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "DefaultXmlPayloadConverter", "\"", "/>", "<", "/", "beans", ":", "beans", ">", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2016", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "17", ",", "12", "+", "17", ",", "16", "@", "@", "package", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "config", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "contains", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "instanceOf", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertSame", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "@", "@", "-", "37", ",", "12", "+", "41", ",", "13", "@", "@", "import", "org", ".", "springframework", ".", "integration", ".", "support", ".", "MessageBuilder", ";", "import", "org", ".", "springframework", ".", "integration", ".", "support", ".", "SmartLifecycleRoleController", ";", "import", "org", ".", "springframework", ".", "integration", ".", "test", ".", "util", ".", "TestUtils", ";", "import", "org", ".", "springframework", ".", "integration", ".", "transformer", ".", "support", ".", "HeaderValueMessageProcessor", ";", "import", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "transformer", ".", "support", ".", "XPathExpressionEvaluatingHeaderValueMessageProcessor", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "Message", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessageChannel", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "PollableChannel", ";", "import", "org", ".", "springframework", ".", "test", ".", "annotation", ".", "DirtiesContext", ";", "import", "org", ".", "springframework", ".", "test", ".", "context", ".", "ContextConfiguration", ";", "import", "org", ".", "springframework", ".", "test", ".", "context", ".", "junit4", ".", "SpringJUnit4ClassRunner", ";", "import", "org", ".", "springframework", ".", "test", ".", "context", ".", "junit4", ".", "SpringRunner", ";", "import", "org", ".", "springframework", ".", "util", ".", "MultiValueMap", ";", "/", "**", "@", "@", "-", "52", ",", "8", "+", "57", ",", "7", "@", "@", "*", "*", "@", "since", "2", ".", "0", "*", "/", "@", "ContextConfiguration", "@", "RunWith", "(", "SpringJUnit4ClassRunner", ".", "class", ")", "@", "RunWith", "(", "SpringRunner", ".", "class", ")", "@", "DirtiesContext", "public", "class", "XPathHeaderEnricherParserTests", "{", "@", "@", "-", "66", ",", "11", "+", "70", ",", "12", "@", "@", "@", "Autowired", "private", "ApplicationContext", "context", ";", "private", "final", "Message", "<", "?>", "message", "=", "MessageBuilder", ".", "withPayload", "(", "\"<", "person", "name", "=", "'", "John", "Doe", "'", "age", "=", "'", "42", "'", "married", "=", "'", "true", "'", "/>", "\")", ".", "build", "(", ");", "private", "final", "Message", "<", "?>", "message", "=", "MessageBuilder", ".", "withPayload", "(", "\"<", "person", "name", "=", "'", "John", "Doe", "'", "age", "=", "'", "42", "'", "married", "=", "'", "true", "'", "/>", "\")", ".", "build", "(", ");", "@", "Test", "public", "void", "testParse", "(", ")", "throws", "Exception", "{", "public", "void", "testParse", "(", ")", "{", "EventDrivenConsumer", "consumer", "=", "(", "EventDrivenConsumer", ")", "context", ".", "getBean", "(", "\"", "parseOnly", "\"", ");", "assertEquals", "(", "2", ",", "TestUtils", ".", "getPropertyValue", "(", "consumer", ",", "\"", "handler", ".", "order", "\"", "))", ";", "assertEquals", "(", "123L", ",", "TestUtils", ".", "getPropertyValue", "(", "consumer", ",", "\"", "handler", ".", "messagingTemplate", ".", "sendTimeout", "\"", "))", ";", "@", "@", "-", "115", ",", "35", "+", "120", ",", "36", "@", "@", "public", "void", "nodeResult", "(", ")", "{", "public", "void", "nodeListResult", "(", ")", "{", "Message", "<", "?>", "result", "=", "this", ".", "getResultMessage", "(", ");", "Object", "header", "=", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "node", "-", "list", "-", "test", "\"", ");", "assertTrue", "(", "List", ".", "class", ".", "isAssignableFrom", "(", "header", ".", "getClass", "(", "))", ");", "assertThat", "(", "header", ",", "instanceOf", "(", "List", ".", "class", ")", ");", "List", "<", "Node", ">", "nodeList", "=", "(", "List", "<", "Node", ">", ")", "header", ";", "assertNotNull", "(", "nodeList", ")", ";", "assertEquals", "(", "3", ",", "nodeList", ".", "size", "(", "))", ";", "}", "@", "Test", "public", "void", "expressionRef", "(", ")", "{", "Message", "<", "?>", "result", "=", "this", ".", "getResultMessage", "(", ");", "assertEquals", "(", "new", "Double", "(", "84", ")", ",", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "ref", "-", "test", "\"", "))", ";", "}", "@", "Test", "public", "void", "defaultOverwrite", "(", ")", "{", "assertEquals", "(", "false", ",", "this", ".", "getEnricherProperty", "(", "\"", "defaultHeaderEnricher", "\"", ",", "\"", "defaultOverwrite", "\"", "))", ";", "Message", "<", "?>", "result", "=", "getResultMessage", "(", ");", "assertEquals", "(", "84d", ",", "result", ".", "getHeaders", "(", ").", "get", "(", "\"", "ref", "-", "test", "\"", "))", ";", "}", "@", "Test", "public", "void", "defaultShouldSkipNulls", "(", ")", "{", "assertEquals", "(", "true", ",", "this", ".", "getEnricherProperty", "(", "\"", "defaultHeaderEnricher", "\"", ",", "\"", "shouldSkipNulls", "\"", "))", ";", "public", "void", "testDefaultHeaderEnricher", "(", ")", "{", "assertFalse", "(", "getEnricherProperty", "(", "\"", "defaultHeaderEnricher", "\"", ",", "\"", "defaultOverwrite", "\"", "))", ";", "assertTrue", "(", "getEnricherProperty", "(", "\"", "defaultHeaderEnricher", "\"", ",", "\"", "shouldSkipNulls", "\"", "))", ";", "}", "@", "Test", "public", "void", "customOverwrite", "(", ")", "{", "assertEquals", "(", "true", ",", "this", ".", "getEnricherProperty", "(", "\"", "customHeaderEnricher", "\"", ",", "\"", "defaultOverwrite", "\"", "))", ";", "}", "@", "Test", "public", "void", "customShouldSkipNulls", "(", ")", "{", "assertEquals", "(", "false", ",", "this", ".", "getEnricherProperty", "(", "\"", "customHeaderEnricher", "\"", ",", "\"", "shouldSkipNulls", "\"", "))", ";", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "void", "testCustomHeaderEnricher", "(", ")", "{", "assertTrue", "(", "getEnricherProperty", "(", "\"", "customHeaderEnricher", "\"", ",", "\"", "defaultOverwrite", "\"", "))", ";", "assertFalse", "(", "getEnricherProperty", "(", "\"", "customHeaderEnricher", "\"", ",", "\"", "shouldSkipNulls", "\"", "))", ";", "Map", "<", "String", ",", "?", "extends", "HeaderValueMessageProcessor", "<", "?>", ">", "headersToAdd", "=", "TestUtils", ".", "getPropertyValue", "(", "this", ".", "context", ".", "getBean", "(", "\"", "customHeaderEnricher", "\"", "),", "\"", "handler", ".", "transformer", ".", "headersToAdd", "\"", ",", "Map", ".", "class", ")", ";", "HeaderValueMessageProcessor", "<", "?>", "headerValueMessageProcessor", "=", "headersToAdd", ".", "get", "(", "\"", "foo", "\"", ");", "assertThat", "(", "headerValueMessageProcessor", ",", "instanceOf", "(", "XPathExpressionEvaluatingHeaderValueMessageProcessor", ".", "class", ")", ");", "assertSame", "(", "this", ".", "context", ".", "getBean", "(", "\"", "xmlPayloadConverter", "\"", "),", "TestUtils", ".", "getPropertyValue", "(", "headerValueMessageProcessor", ",", "\"", "converter", "\"", "))", ";", "}", "@", "Test", "@", "@", "-", "155", ",", "6", "+", "161", ",", "7", "@", "@", "public", "void", "childOverridesDefaultOverwrite", "(", ")", "{", ".", "build", "(", ");", "this", ".", "context", ".", "getBean", "(", "\"", "defaultInput", "\"", ",", "MessageChannel", ".", "class", ")", ".", "send", "(", "request", ")", ";", "Message", "<", "?>", "reply", "=", "replyChannel", ".", "receive", "(", ");", "assertNotNull", "(", "reply", ")", ";", "assertEquals", "(", "\"", "John", "Doe", "\"", ",", "reply", ".", "getHeaders", "(", ").", "get", "(", "\"", "foo", "\"", "))", ";", "}", "@", "@", "-", "167", ",", "6", "+", "174", ",", "7", "@", "@", "public", "void", "childOverridesCustomOverwrite", "(", ")", "{", ".", "build", "(", ");", "this", ".", "context", ".", "getBean", "(", "\"", "customInput", "\"", ",", "MessageChannel", ".", "class", ")", ".", "send", "(", "request", ")", ";", "Message", "<", "?>", "reply", "=", "replyChannel", ".", "receive", "(", ");", "assertNotNull", "(", "reply", ")", ";", "assertEquals", "(", "\"", "bar", "\"", ",", "reply", ".", "getHeaders", "(", ").", "get", "(", "\"", "foo", "\"", "))", ";", "}", "@", "@", "-", "180", ",", "7", "+", "188", ",", "7", "@", "@", "private", "boolean", "getEnricherProperty", "(", "String", "beanName", ",", "String", "propertyName", ")", "{", "Object", "endpoint", "=", "this", ".", "context", ".", "getBean", "(", "beanName", ")", ";", "Object", "handler", "=", "new", "DirectFieldAccessor", "(", "endpoint", ")", ".", "getPropertyValue", "(", "\"", "handler", "\"", ");", "Object", "enricher", "=", "new", "DirectFieldAccessor", "(", "handler", ")", ".", "getPropertyValue", "(", "\"", "transformer", "\"", ");", "return", "(", "(", "Boolean", ")", "new", "DirectFieldAccessor", "(", "enricher", ")", ".", "getPropertyValue", "(", "propertyName", ")", ").", "booleanValue", "(", ");", "return", "(", "boolean", ")", "new", "DirectFieldAccessor", "(", "enricher", ")", ".", "getPropertyValue", "(", "propertyName", ")", ";", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2019", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "19", ",", "28", "+", "19", ",", "34", "@", "@", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThat", ";", "import", "static", "org", ".", "assertj", ".", "core", ".", "api", ".", "Assertions", ".", "assertThatThrownBy", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Templates", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactoryConfigurationError", ";", "import", "javax", ".", "xml", ".", "transform", ".", "dom", ".", "DOMResult", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TemporaryFolder", ";", "import", "org", ".", "mockito", ".", "Mockito", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "BeanFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ByteArrayResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "ClassPathResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "FileSystemResource", ";", "import", "org", ".", "springframework", ".", "core", ".", "io", ".", "Resource", ";", "import", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "result", ".", "DomResultFactory", ";", "import", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "result", ".", "StringResultFactory", ";", "import", "org", ".", "springframework", ".", "integration", ".", "xml", ".", "util", ".", "XmlTestUtil", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "Message", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessagingException", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "support", ".", "GenericMessage", ";", "import", "org", ".", "springframework", ".", "util", ".", "FileCopyUtils", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringResult", ";", "import", "org", ".", "springframework", ".", "xml", ".", "transform", ".", "StringSource", ";", "@", "@", "-", "61", ",", "9", "+", "67", ",", "12", "@", "@", "private", "final", "String", "outputAsString", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"?", "><", "bob", ">", "test", "<", "/", "bob", ">", "\";", "@", "Rule", "public", "TemporaryFolder", "temporaryFolder", "=", "new", "TemporaryFolder", "(", ");", "@", "Before", "public", "void", "setUp", "(", ")", "{", "this", ".", "transformer", "=", "new", "XsltPayloadTransformer", "(", "getXslResource", "(", "))", ";", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "this", ".", "transformer", "=", "new", "XsltPayloadTransformer", "(", "getXslTemplates", "(", "))", ";", "this", ".", "transformer", ".", "setBeanFactory", "(", "Mockito", ".", "mock", "(", "BeanFactory", ".", "class", ")", ");", "this", ".", "transformer", ".", "setAlwaysUseResultFactory", "(", "false", ")", ";", "this", ".", "transformer", ".", "afterPropertiesSet", "(", ");", "@", "@", "-", "127", ",", "8", "+", "136", ",", "8", "@", "@", "public", "void", "testStringAsPayloadUseResultFactoryTrue", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testSourceWithResultTransformer", "(", ")", "throws", "Exception", "{", "Integer", "returnValue", "=", "13", ";", "XsltPayloadTransformer", "transformer", "=", "new", "XsltPayloadTransformer", "(", "getXslResource", "(", "),", "new", "StubResultTransformer", "(", "returnValue", ")", ");", "XsltPayloadTransformer", "transformer", "=", "new", "XsltPayloadTransformer", "(", "getXslTemplates", "(", "),", "new", "StubResultTransformer", "(", "returnValue", ")", ");", "transformer", ".", "setBeanFactory", "(", "Mockito", ".", "mock", "(", "BeanFactory", ".", "class", ")", ");", "transformer", ".", "afterPropertiesSet", "(", ");", "Object", "transformed", "=", "transformer", "@", "@", "-", "137", ",", "10", "+", "146", ",", "10", "@", "@", "public", "void", "testSourceWithResultTransformer", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "public", "void", "testXsltPayloadWithTransformerFactoryClassname", "(", ")", "throws", "Exception", "{", "public", "void", "testXsltPayloadWithTransformerFactoryClassName", "(", ")", "throws", "Exception", "{", "Integer", "returnValue", "=", "13", ";", "XsltPayloadTransformer", "transformer", "=", "new", "XsltPayloadTransformer", "(", "getXslResource", "(", "),", "new", "StubResultTransformer", "(", "returnValue", ")", ",", "new", "XsltPayloadTransformer", "(", "getXslResourceThatOutputsText", "(", "),", "new", "StubResultTransformer", "(", "returnValue", ")", ",", "\"", "com", ".", "sun", ".", "org", ".", "apache", ".", "xalan", ".", "internal", ".", "xsltc", ".", "trax", ".", "TransformerFactoryImpl", "\"", ");", "transformer", ".", "setBeanFactory", "(", "Mockito", ".", "mock", "(", "BeanFactory", ".", "class", ")", ");", "transformer", ".", "afterPropertiesSet", "(", ");", "@", "@", "-", "151", ",", "8", "+", "160", ",", "8", "@", "@", "public", "void", "testXsltPayloadWithTransformerFactoryClassname", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "public", "void", "testXsltPayloadWithBadTransformerFactoryClassname", "(", ")", "{", "XsltPayloadTransformer", "transformer", "=", "new", "XsltPayloadTransformer", "(", "getXslResource", "(", "),", "\"", "foo", ".", "bar", ".", "Baz", "\"", ");", "public", "void", "testXsltPayloadWithBadTransformerFactoryClassName", "(", ")", "throws", "IOException", "{", "XsltPayloadTransformer", "transformer", "=", "new", "XsltPayloadTransformer", "(", "getXslResourceThatOutputsText", "(", "),", "\"", "foo", ".", "bar", ".", "Baz", "\"", ");", "transformer", ".", "setBeanFactory", "(", "Mockito", ".", "mock", "(", "BeanFactory", ".", "class", ")", ");", "assertThatThrownBy", "(", "transformer", ":", ":", "afterPropertiesSet", ")", ".", "isExactlyInstanceOf", "(", "TransformerFactoryConfigurationError", ".", "class", ")", ";", "@", "@", "-", "227", ",", "23", "+", "236", ",", "29", "@", "@", "public", "void", "docInStringOut", "(", ")", "throws", "Exception", "{", "assertThat", "(", "transformed", ".", "toString", "(", "))", ".", "isEqualTo", "(", "\"", "hello", "world", "\"", ");", "}", "private", "Resource", "getXslResource", "(", ")", "{", "private", "Templates", "getXslTemplates", "(", ")", "throws", "Exception", "{", "TransformerFactory", "transformerFactory", "=", "TransformerFactory", ".", "newInstance", "(", ");", "String", "xsl", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "ISO", "-", "8859", "-", "1", "\\", "\"?", ">\"", "+", "\"", "<", "xsl", ":", "stylesheet", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "xmlns", ":", "xsl", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\\", "\">", "\"", "+", "\"", "<", "xsl", ":", "template", "match", "=", "\\\"", "order", "\\", "\">", "\"", "+", "\"", "<", "bob", ">", "test", "<", "/", "bob", ">", "\"", "+", "\"", "<", "/", "xsl", ":", "template", ">", "\"", "+", "\"", "</", "xsl", ":", "stylesheet", ">", "\";", "return", "new", "ByteArrayResource", "(", "xsl", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "return", "transformerFactory", ".", "newTemplates", "(", "new", "StringSource", "(", "xsl", ")", ");", "}", "private", "Resource", "getXslResourceThatOutputsText", "(", ")", "{", "private", "Resource", "getXslResourceThatOutputsText", "(", ")", "throws", "IOException", "{", "String", "xsl", "=", "\"", "<?", "xml", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "encoding", "=", "\\\"", "ISO", "-", "8859", "-", "1", "\\", "\"?", ">\"", "+", "\"", "<", "xsl", ":", "stylesheet", "version", "=", "\\\"", "1", ".", "0", "\\", "\"", "xmlns", ":", "xsl", "=", "\\\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "XSL", "/", "Transform", "\\", "\">", "\"", "+", "\"", "<", "xsl", ":", "output", "method", "=", "\\\"", "text", "\\", "\"", "encoding", "=", "\\\"", "UTF", "-", "8", "\\", "\"", "/", ">\"", "+", "\"", "<", "xsl", ":", "template", "match", "=", "\\\"", "order", "\\", "\">", "hello", "world", "<", "/", "xsl", ":", "template", ">", "\"", "+", "\"", "</", "xsl", ":", "stylesheet", ">", "\";", "return", "new", "ByteArrayResource", "(", "xsl", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "File", "xsltFile", "=", "this", ".", "temporaryFolder", ".", "newFile", "(", ");", "FileCopyUtils", ".", "copy", "(", "xsl", ".", "getBytes", "(", "),", "xsltFile", ")", ";", "return", "new", "FileSystemResource", "(", "xsltFile", ")", ";", "}", "public", "static", "class", "StubResultTransformer", "implements", "ResultTransformer", "{"], "docstring_tokens": ["xml", "external", "entity", "injection", "(xxe", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "91", ",", "6", "+", "91", ",", "7", "@", "@", "struct", "ext4_extent_header", "{", "}", ";", "#", "define", "EXT4_EXT_MAGIC", "cpu_to_le16", "(", "0xf30a", ")", "#", "define", "EXT4_MAX_EXTENT_DEPTH", "5", "#", "define", "EXT4_EXTENT_TAIL_OFFSET", "(", "hdr", ")", "\\", "(", "sizeof", "(", "struct", "ext4_extent_header", ")", "+", "\\", "@", "@", "-", "869", ",", "6", "+", "869", ",", "12", "@", "@", "ext4_find_extent", "(", "struct", "inode", "*", "inode", ",", "ext4_lblk_t", "block", ",", "eh", "=", "ext_inode_hdr", "(", "inode", ")", ";", "depth", "=", "ext_depth", "(", "inode", ")", ";", "if", "(", "depth", "<", "0", "|", "|", "depth", ">", "EXT4_MAX_EXTENT_DEPTH", ")", "{", "EXT4_ERROR_INODE", "(", "inode", ",", "\"", "inode", "has", "invalid", "extent", "depth", ":", "%", "d", "\"", ",", "depth", ")", ";", "ret", "=", "-", "EFSCORRUPTED", ";", "goto", "err", ";", "}", "if", "(", "path", ")", "{", "ext4_ext_drop_refs", "(", "path", ")", ";"], "docstring_tokens": ["out-of-bound", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "201", ",", "7", "+", "201", ",", "9", "@", "@", "struct", "l2tp_tunnel", "{", "}", ";", "struct", "l2tp_nl_cmd_ops", "{", "int", "(", "*", "session_create", ")", "(", "struct", "net", "*", "net", ",", "u32", "tunnel_id", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", ";", "int", "(", "*", "session_create", ")", "(", "struct", "net", "*", "net", ",", "struct", "l2tp_tunnel", "*", "tunnel", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", ";", "int", "(", "*", "session_delete", ")", "(", "struct", "l2tp_session", "*", "session", ")", ";", "}", ";", "@", "@", "-", "262", ",", "24", "+", "262", ",", "19", "@", "@", "static", "void", "l2tp_eth_adjust_mtu", "(", "struct", "l2tp_tunnel", "*", "tunnel", ",", "dev", "-", ">", "needed_headroom", "+", "=", "session", "-", ">", "hdr_len", ";", "}", "static", "int", "l2tp_eth_create", "(", "struct", "net", "*", "net", ",", "u32", "tunnel_id", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", "static", "int", "l2tp_eth_create", "(", "struct", "net", "*", "net", ",", "struct", "l2tp_tunnel", "*", "tunnel", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", "{", "unsigned", "char", "name_assign_type", ";", "struct", "net_device", "*", "dev", ";", "char", "name", "[", "IFNAMSIZ", "]", ";", "struct", "l2tp_tunnel", "*", "tunnel", ";", "struct", "l2tp_session", "*", "session", ";", "struct", "l2tp_eth", "*", "priv", ";", "struct", "l2tp_eth_sess", "*", "spriv", ";", "int", "rc", ";", "struct", "l2tp_eth_net", "*", "pn", ";", "tunnel", "=", "l2tp_tunnel_find", "(", "net", ",", "tunnel_id", ")", ";", "if", "(", "!", "tunnel", ")", "{", "rc", "=", "-", "ENODEV", ";", "goto", "out", ";", "}", "if", "(", "cfg", "-", ">", "ifname", ")", "{", "strlcpy", "(", "name", ",", "cfg", "-", ">", "ifname", ",", "IFNAMSIZ", ")", ";", "name_assign_type", "=", "NET_NAME_USER", ";", "@", "@", "-", "643", ",", "10", "+", "643", ",", "10", "@", "@", "static", "int", "l2tp_nl_cmd_session_create", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "genl_info", "*", "inf", "break", ";", "}", "ret", "=", "-", "EPROTONOSUPPORT", ";", "if", "(", "l2tp_nl_cmd_ops", "[", "cfg", ".", "pw_type", "]", "->", "session_create", ")", "ret", "=", "(", "*", "l2tp_nl_cmd_ops", "[", "cfg", ".", "pw_type", "]", "->", "session_create", ")", "(", "net", ",", "tunnel_id", ",", "session_id", ",", "peer_session_id", ",", "&", "cfg", ")", ";", "ret", "=", "l2tp_nl_cmd_ops", "[", "cfg", ".", "pw_type", "]", "->", "session_create", "(", "net", ",", "tunnel", ",", "session_id", ",", "peer_session_id", ",", "&", "cfg", ")", ";", "if", "(", "ret", ">", "=", "0", ")", "{", "session", "=", "l2tp_session_get", "(", "net", ",", "tunnel", ",", "session_id", ",", "false", ")", ";", "@", "@", "-", "788", ",", "25", "+", "788", ",", "20", "@", "@", "static", "int", "pppol2tp_connect", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "uservaddr", ",", "#", "ifdef", "CONFIG_L2TP_V3", "/", "*", "Called", "when", "creating", "sessions", "via", "the", "netlink", "interface", ".", "*", "/", "static", "int", "pppol2tp_session_create", "(", "struct", "net", "*", "net", ",", "u32", "tunnel_id", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", "/", "*", "Called", "when", "creating", "sessions", "via", "the", "netlink", "interface", ".", "*", "/", "static", "int", "pppol2tp_session_create", "(", "struct", "net", "*", "net", ",", "struct", "l2tp_tunnel", "*", "tunnel", ",", "u32", "session_id", ",", "u32", "peer_session_id", ",", "struct", "l2tp_session_cfg", "*", "cfg", ")", "{", "int", "error", ";", "struct", "l2tp_tunnel", "*", "tunnel", ";", "struct", "l2tp_session", "*", "session", ";", "struct", "pppol2tp_session", "*", "ps", ";", "tunnel", "=", "l2tp_tunnel_find", "(", "net", ",", "tunnel_id", ")", ";", "/", "*", "Error", "if", "we", "can", "'", "t", "find", "the", "tunnel", "*", "/", "error", "=", "-", "ENOENT", ";", "if", "(", "tunnel", "=", "=", "NULL", ")", "goto", "out", ";", "/", "*", "Error", "if", "tunnel", "socket", "is", "not", "prepped", "*", "/", "if", "(", "tunnel", "-", ">", "sock", "=", "=", "NULL", ")", "if", "(", "!", "tunnel", "-", ">", "sock", ")", "{", "error", "=", "-", "ENOENT", ";", "goto", "out", ";", "}", "/", "*", "Default", "MTU", "values", ".", "*", "/", "if", "(", "cfg", "-", ">", "mtu", "=", "=", "0", ")"], "docstring_tokens": ["memory", "corruption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "58", ",", "6", "+", "58", ",", "7", "@", "@", "String", "INVALID_FORM", "=", "\"", "invalid_form", "\"", ";", "String", "INVALID_CONFIG", "=", "\"", "invalid_config", "\"", ";", "String", "EXPIRED_CODE", "=", "\"", "expired_code", "\"", ";", "String", "INVALID_INPUT", "=", "\"", "invalid_input", "\"", ";", "String", "REGISTRATION_DISABLED", "=", "\"", "registration_disabled", "\"", ";", "String", "RESET_CREDENTIAL_DISABLED", "=", "\"", "reset_credential_disabled", "\"", ";", "@", "@", "-", "133", ",", "6", "+", "133", ",", "9", "@", "@", "import", "org", ".", "keycloak", ".", "storage", ".", "UserStorageProviderModel", ";", "import", "org", ".", "keycloak", ".", "storage", ".", "federated", ".", "UserFederatedStorageProvider", ";", "import", "org", ".", "keycloak", ".", "util", ".", "JsonSerialization", ";", "import", "org", ".", "keycloak", ".", "validation", ".", "ClientValidationContext", ";", "import", "org", ".", "keycloak", ".", "validation", ".", "ClientValidationProvider", ";", "import", "org", ".", "keycloak", ".", "validation", ".", "ClientValidationUtil", ";", "public", "class", "RepresentationToModel", "{", "@", "@", "-", "1235", ",", "6", "+", "1238", ",", "10", "@", "@", "private", "static", "void", "addComposites", "(", "RoleModel", "role", ",", "RoleRepresentation", "roleRep", ",", "Re", "for", "(", "ClientRepresentation", "resourceRep", ":", "rep", ".", "getClients", "(", "))", "{", "ClientModel", "app", "=", "createClient", "(", "session", ",", "realm", ",", "resourceRep", ",", "false", ",", "mappedFlows", ")", ";", "appMap", ".", "put", "(", "app", ".", "getClientId", "(", "),", "app", ")", ";", "ClientValidationUtil", ".", "validate", "(", "session", ",", "app", ",", "false", ",", "c", "-", ">", "{", "throw", "new", "RuntimeException", "(", "\"", "Invalid", "client", "\"", "+", "app", ".", "getClientId", "(", ")", "+", "\"", ":", "\"", "+", "c", ".", "getError", "(", "))", ";", "}", ");", "}", "return", "appMap", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "39", "@", "@", "/", "*", "*", "Copyright", "2019", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "validation", ";", "import", "org", ".", "keycloak", ".", "models", ".", "ClientModel", ";", "import", "org", ".", "keycloak", ".", "models", ".", "KeycloakSession", ";", "public", "interface", "ClientValidationContext", "{", "enum", "Event", "{", "CREATE", ",", "UPDATE", "}", "Event", "getEvent", "(", ");", "KeycloakSession", "getSession", "(", ");", "ClientModel", "getClient", "(", ");", "String", "getError", "(", ");", "ClientValidationContext", "invalid", "(", "String", "error", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "/", "*", "*", "Copyright", "2019", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "validation", ";", "import", "org", ".", "keycloak", ".", "provider", ".", "Provider", ";", "public", "interface", "ClientValidationProvider", "extends", "Provider", "{", "void", "validate", "(", "ClientValidationContext", "context", ")", ";", "@", "Override", "default", "void", "close", "(", ")", "{", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "37", "@", "@", "/", "*", "*", "Copyright", "2019", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "validation", ";", "import", "org", ".", "keycloak", ".", "Config", ";", "import", "org", ".", "keycloak", ".", "models", ".", "KeycloakSessionFactory", ";", "import", "org", ".", "keycloak", ".", "provider", ".", "ProviderFactory", ";", "public", "interface", "ClientValidationProviderFactory", "extends", "ProviderFactory", "<", "ClientValidationProvider", ">", "{", "@", "Override", "default", "void", "init", "(", "Config", ".", "Scope", "config", ")", "{", "}", "@", "Override", "default", "void", "postInit", "(", "KeycloakSessionFactory", "factory", ")", "{", "}", "@", "Override", "default", "void", "close", "(", ")", "{", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "45", "@", "@", "/", "*", "*", "Copyright", "2019", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "validation", ";", "import", "org", ".", "keycloak", ".", "provider", ".", "Provider", ";", "import", "org", ".", "keycloak", ".", "provider", ".", "ProviderFactory", ";", "import", "org", ".", "keycloak", ".", "provider", ".", "Spi", ";", "public", "class", "ClientValidationSPI", "implements", "Spi", "{", "@", "Override", "public", "boolean", "isInternal", "(", ")", "{", "return", "true", ";", "}", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "\"", "clientValidation", "\"", ";", "}", "@", "Override", "public", "Class", "<", "?", "extends", "Provider", ">", "getProviderClass", "(", ")", "{", "return", "ClientValidationProvider", ".", "class", ";", "}", "@", "Override", "public", "Class", "<", "?", "extends", "ProviderFactory", ">", "getProviderFactoryClass", "(", ")", "{", "return", "ClientValidationProviderFactory", ".", "class", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "88", "@", "@", "/", "*", "*", "Copyright", "2019", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "validation", ";", "import", "org", ".", "keycloak", ".", "models", ".", "ClientModel", ";", "import", "org", ".", "keycloak", ".", "models", ".", "KeycloakSession", ";", "import", "javax", ".", "ws", ".", "rs", ".", "BadRequestException", ";", "public", "class", "ClientValidationUtil", "{", "public", "static", "void", "validate", "(", "KeycloakSession", "session", ",", "ClientModel", "client", ",", "boolean", "create", ",", "ErrorHandler", "errorHandler", ")", "throws", "BadRequestException", "{", "ClientValidationProvider", "provider", "=", "session", ".", "getProvider", "(", "ClientValidationProvider", ".", "class", ")", ";", "if", "(", "provider", "!", "=", "null", ")", "{", "DefaultClientValidationContext", "context", "=", "new", "DefaultClientValidationContext", "(", "create", "?", "ClientValidationContext", ".", "Event", ".", "CREATE", ":", "ClientValidationContext", ".", "Event", ".", "UPDATE", ",", "session", ",", "client", ")", ";", "provider", ".", "validate", "(", "context", ")", ";", "if", "(", "!", "context", ".", "isValid", "(", "))", "{", "errorHandler", ".", "onError", "(", "context", ")", ";", "}", "}", "}", "public", "interface", "ErrorHandler", "{", "void", "onError", "(", "ClientValidationContext", "context", ")", ";", "}", "private", "static", "class", "DefaultClientValidationContext", "implements", "ClientValidationContext", "{", "private", "Event", "event", ";", "private", "KeycloakSession", "session", ";", "private", "ClientModel", "client", ";", "private", "String", "error", ";", "public", "DefaultClientValidationContext", "(", "Event", "event", ",", "KeycloakSession", "session", ",", "ClientModel", "client", ")", "{", "this", ".", "event", "=", "event", ";", "this", ".", "session", "=", "session", ";", "this", ".", "client", "=", "client", ";", "}", "public", "boolean", "isValid", "(", ")", "{", "return", "error", "=", "=", "null", ";", "}", "public", "String", "getError", "(", ")", "{", "return", "error", ";", "}", "@", "Override", "public", "Event", "getEvent", "(", ")", "{", "return", "event", ";", "}", "@", "Override", "public", "KeycloakSession", "getSession", "(", ")", "{", "return", "session", ";", "}", "@", "Override", "public", "ClientModel", "getClient", "(", ")", "{", "return", "client", ";", "}", "@", "Override", "public", "ClientValidationContext", "invalid", "(", "String", "error", ")", "{", "this", ".", "error", "=", "error", ";", "return", "this", ";", "}", "}", "}", "@", "@", "-", "77", ",", "4", "+", "77", ",", "5", "@", "@", "org", ".", "keycloak", ".", "crypto", ".", "ClientSignatureVerifierSpi", "org", ".", "keycloak", ".", "crypto", ".", "HashSpi", "org", ".", "keycloak", ".", "vault", ".", "VaultSpi", "org", ".", "keycloak", ".", "crypto", ".", "CekManagementSpi", "org", ".", "keycloak", ".", "crypto", ".", "ContentEncryptionSpi", "\\", "No", "newline", "at", "end", "of", "file", "org", ".", "keycloak", ".", "crypto", ".", "ContentEncryptionSpi", "org", ".", "keycloak", ".", "validation", ".", "ClientValidationSPI", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "import", "org", ".", "keycloak", ".", "services", ".", "managers", ".", "ClientManager", ";", "import", "org", ".", "keycloak", ".", "services", ".", "managers", ".", "RealmManager", ";", "import", "org", ".", "keycloak", ".", "services", ".", "validation", ".", "ValidationMessages", ";", "import", "org", ".", "keycloak", ".", "validation", ".", "ClientValidationUtil", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "@", "@", "-", "81", ",", "6", "+", "82", ",", "11", "@", "@", "public", "ClientRepresentation", "create", "(", "ClientRegistrationContext", "context", ")", "{", "client", ".", "setSecret", "(", "clientModel", ".", "getSecret", "(", "))", ";", "ClientValidationUtil", ".", "validate", "(", "session", ",", "clientModel", ",", "true", ",", "c", "-", ">", "{", "session", ".", "getTransactionManager", "(", ").", "setRollbackOnly", "(", ");", "throw", "new", "ErrorResponseException", "(", "ErrorCodes", ".", "INVALID_CLIENT_METADATA", ",", "c", ".", "getError", "(", "),", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "}", ");", "String", "registrationAccessToken", "=", "ClientRegistrationTokenUtils", ".", "updateRegistrationAccessToken", "(", "session", ",", "clientModel", ",", "registrationAuth", ")", ";", "client", ".", "setRegistrationAccessToken", "(", "registrationAccessToken", ")", ";", "@", "@", "-", "140", ",", "6", "+", "146", ",", "11", "@", "@", "public", "ClientRepresentation", "update", "(", "String", "clientId", ",", "ClientRegistrationContext", "co", "RepresentationToModel", ".", "updateClient", "(", "rep", ",", "client", ")", ";", "RepresentationToModel", ".", "updateClientProtocolMappers", "(", "rep", ",", "client", ")", ";", "ClientValidationUtil", ".", "validate", "(", "session", ",", "client", ",", "false", ",", "c", "-", ">", "{", "session", ".", "getTransactionManager", "(", ").", "setRollbackOnly", "(", ");", "throw", "new", "ErrorResponseException", "(", "ErrorCodes", ".", "INVALID_CLIENT_METADATA", ",", "c", ".", "getError", "(", "),", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "}", ");", "rep", "=", "ModelToRepresentation", ".", "toRepresentation", "(", "client", ",", "session", ")", ";", "if", "(", "auth", ".", "isRegistrationAccessToken", "(", "))", "{", "@", "@", "-", "24", ",", "6", "+", "24", ",", "7", "@", "@", "import", "org", ".", "keycloak", ".", "common", ".", "ClientConnection", ";", "import", "org", ".", "keycloak", ".", "common", ".", "Profile", ";", "import", "org", ".", "keycloak", ".", "common", ".", "util", ".", "Time", ";", "import", "org", ".", "keycloak", ".", "events", ".", "Errors", ";", "import", "org", ".", "keycloak", ".", "events", ".", "admin", ".", "OperationType", ";", "import", "org", ".", "keycloak", ".", "events", ".", "admin", ".", "ResourceType", ";", "import", "org", ".", "keycloak", ".", "models", ".", "AuthenticatedClientSessionModel", ";", "@", "@", "-", "63", ",", "6", "+", "64", ",", "7", "@", "@", "import", "org", ".", "keycloak", ".", "services", ".", "validation", ".", "PairwiseClientValidator", ";", "import", "org", ".", "keycloak", ".", "services", ".", "validation", ".", "ValidationMessages", ";", "import", "org", ".", "keycloak", ".", "utils", ".", "ProfileHelper", ";", "import", "org", ".", "keycloak", ".", "validation", ".", "ClientValidationUtil", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Consumes", ";", "import", "javax", ".", "ws", ".", "rs", ".", "DELETE", ";", "@", "@", "-", "151", ",", "10", "+", "153", ",", "16", "@", "@", "public", "Response", "update", "(", "final", "ClientRepresentation", "rep", ")", "{", "try", "{", "updateClientFromRep", "(", "rep", ",", "client", ",", "session", ")", ";", "ClientValidationUtil", ".", "validate", "(", "session", ",", "client", ",", "false", ",", "c", "-", ">", "{", "session", ".", "getTransactionManager", "(", ").", "setRollbackOnly", "(", ");", "throw", "new", "ErrorResponseException", "(", "Errors", ".", "INVALID_INPUT", ",", "c", ".", "getError", "(", "),", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "}", ");", "adminEvent", ".", "operation", "(", "OperationType", ".", "UPDATE", ")", ".", "resourcePath", "(", "session", ".", "getContext", "(", ").", "getUri", "(", "))", ".", "representation", "(", "rep", ")", ".", "success", "(", ");", "return", "Response", ".", "noContent", "(", ").", "build", "(", ");", "}", "catch", "(", "ModelDuplicateException", "e", ")", "{", "return", "ErrorResponse", ".", "exists", "(", "\"", "Client", "\"", "+", "rep", ".", "getClientId", "(", ")", "+", "\"", "already", "exists", "\"", ");", "return", "ErrorResponse", ".", "exists", "(", "\"", "Client", "already", "exists", "\"", ");", "}", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "org", ".", "jboss", ".", "resteasy", ".", "annotations", ".", "cache", ".", "NoCache", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "spi", ".", "ResteasyProviderFactory", ";", "import", "org", ".", "keycloak", ".", "authorization", ".", "admin", ".", "AuthorizationService", ";", "import", "org", ".", "keycloak", ".", "events", ".", "Errors", ";", "import", "org", ".", "keycloak", ".", "events", ".", "admin", ".", "OperationType", ";", "import", "org", ".", "keycloak", ".", "events", ".", "admin", ".", "ResourceType", ";", "import", "org", ".", "keycloak", ".", "models", ".", "ClientModel", ";", "@", "@", "-", "39", ",", "6", "+", "40", ",", "7", "@", "@", "import", "org", ".", "keycloak", ".", "services", ".", "validation", ".", "ClientValidator", ";", "import", "org", ".", "keycloak", ".", "services", ".", "validation", ".", "PairwiseClientValidator", ";", "import", "org", ".", "keycloak", ".", "services", ".", "validation", ".", "ValidationMessages", ";", "import", "org", ".", "keycloak", ".", "validation", ".", "ClientValidationUtil", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Consumes", ";", "import", "javax", ".", "ws", ".", "rs", ".", "DefaultValue", ";", "@", "@", "-", "203", ",", "6", "+", "205", ",", "11", "@", "@", "public", "Response", "createClient", "(", "final", "ClientRepresentation", "rep", ")", "{", "}", "}", "ClientValidationUtil", ".", "validate", "(", "session", ",", "clientModel", ",", "true", ",", "c", "-", ">", "{", "session", ".", "getTransactionManager", "(", ").", "setRollbackOnly", "(", ");", "throw", "new", "ErrorResponseException", "(", "Errors", ".", "INVALID_INPUT", ",", "c", ".", "getError", "(", "),", "Response", ".", "Status", ".", "BAD_REQUEST", ")", ";", "}", ");", "return", "Response", ".", "created", "(", "session", ".", "getContext", "(", ").", "getUri", "(", ").", "getAbsolutePathBuilder", "(", ").", "path", "(", "clientModel", ".", "getId", "(", "))", ".", "build", "(", "))", ".", "build", "(", ");", "}", "catch", "(", "ModelDuplicateException", "e", ")", "{", "return", "ErrorResponse", ".", "exists", "(", "\"", "Client", "\"", "+", "rep", ".", "getClientId", "(", ")", "+", "\"", "already", "exists", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "86", "@", "@", "/", "*", "*", "Copyright", "2019", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "validation", ";", "import", "org", ".", "keycloak", ".", "models", ".", "ClientModel", ";", "import", "org", ".", "keycloak", ".", "services", ".", "util", ".", "ResolveRelative", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "java", ".", "net", ".", "URL", ";", "public", "class", "DefaultClientValidationProvider", "implements", "ClientValidationProvider", "{", "private", "ClientValidationContext", "context", ";", "/", "/", "TODO", "Before", "adding", "more", "validation", "consider", "using", "a", "library", "for", "validation", "@", "Override", "public", "void", "validate", "(", "ClientValidationContext", "context", ")", "{", "this", ".", "context", "=", "context", ";", "try", "{", "validate", "(", "context", ".", "getClient", "(", "))", ";", "}", "catch", "(", "ValidationException", "e", ")", "{", "context", ".", "invalid", "(", "e", ".", "getMessage", "(", "))", ";", "}", "}", "private", "void", "validate", "(", "ClientModel", "client", ")", "throws", "ValidationException", "{", "String", "resolvedRootUrl", "=", "ResolveRelative", ".", "resolveRootUrl", "(", "context", ".", "getSession", "(", "),", "client", ".", "getRootUrl", "(", "))", ";", "String", "resolvedBaseUrl", "=", "ResolveRelative", ".", "resolveRelativeUri", "(", "context", ".", "getSession", "(", "),", "resolvedRootUrl", ",", "client", ".", "getBaseUrl", "(", "))", ";", "validateRootUrl", "(", "resolvedRootUrl", ")", ";", "validateBaseUrl", "(", "resolvedBaseUrl", ")", ";", "}", "private", "void", "validateRootUrl", "(", "String", "rootUrl", ")", "throws", "ValidationException", "{", "if", "(", "rootUrl", "!", "=", "null", "&", "&", "!", "rootUrl", ".", "isEmpty", "(", "))", "{", "basicHttpUrlCheck", "(", "\"", "rootUrl", "\"", ",", "rootUrl", ")", ";", "}", "}", "private", "void", "validateBaseUrl", "(", "String", "baseUrl", ")", "throws", "ValidationException", "{", "if", "(", "baseUrl", "!", "=", "null", "&", "&", "!", "baseUrl", ".", "isEmpty", "(", "))", "{", "basicHttpUrlCheck", "(", "\"", "baseUrl", "\"", ",", "baseUrl", ")", ";", "}", "}", "private", "void", "basicHttpUrlCheck", "(", "String", "field", ",", "String", "url", ")", "throws", "ValidationException", "{", "boolean", "valid", "=", "true", ";", "try", "{", "URI", "uri", "=", "new", "URL", "(", "url", ")", ".", "toURI", "(", ");", "if", "(", "uri", ".", "getScheme", "(", ")", "=", "=", "null", "|", "|", "uri", ".", "getScheme", "(", ").", "isEmpty", "(", "))", "{", "valid", "=", "false", ";", "}", "}", "catch", "(", "MalformedURLException", "|", "URISyntaxException", "e", ")", "{", "valid", "=", "false", ";", "}", "if", "(", "!", "valid", ")", "{", "throw", "new", "ValidationException", "(", "\"", "Invalid", "URL", "in", "\"", "+", "field", ")", ";", "}", "}", "class", "ValidationException", "extends", "Exception", "{", "public", "ValidationException", "(", "String", "message", ")", "{", "super", "(", "message", ",", "null", ",", "false", ",", "false", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "35", "@", "@", "/", "*", "*", "Copyright", "2019", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "validation", ";", "import", "org", ".", "keycloak", ".", "models", ".", "KeycloakSession", ";", "public", "class", "DefaultClientValidationProviderFactory", "implements", "ClientValidationProviderFactory", "{", "private", "final", "DefaultClientValidationProvider", "provider", "=", "new", "DefaultClientValidationProvider", "(", ");", "@", "Override", "public", "ClientValidationProvider", "create", "(", "KeycloakSession", "session", ")", "{", "return", "provider", ";", "}", "@", "Override", "public", "String", "getId", "(", ")", "{", "return", "\"", "default", "\"", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "org", ".", "keycloak", ".", "validation", ".", "DefaultClientValidationProviderFactory", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "103", ",", "6", "+", "103", ",", "67", "@", "@", "public", "void", "createClientVerify", "(", ")", "{", "Assert", ".", "assertNames", "(", "realm", ".", "clients", "(", ").", "findAll", "(", "),", "\"", "account", "\"", ",", "\"", "account", "-", "console", "\"", ",", "\"", "realm", "-", "management", "\"", ",", "\"", "security", "-", "admin", "-", "console", "\"", ",", "\"", "broker", "\"", ",", "\"", "my", "-", "app", "\"", ",", "Constants", ".", "ADMIN_CLI_CLIENT_ID", ")", ";", "}", "@", "Test", "public", "void", "createClientValidation", "(", ")", "{", "ClientRepresentation", "rep", "=", "new", "ClientRepresentation", "(", ");", "rep", ".", "setClientId", "(", "\"", "my", "-", "app", "\"", ");", "rep", ".", "setDescription", "(", "\"", "my", "-", "app", "description", "\"", ");", "rep", ".", "setEnabled", "(", "true", ")", ";", "rep", ".", "setRootUrl", "(", "\"", "invalid", "\"", ");", "createClientExpectingValidationError", "(", "rep", ",", "\"", "Invalid", "URL", "in", "rootUrl", "\"", ");", "rep", ".", "setRootUrl", "(", "null", ")", ";", "rep", ".", "setBaseUrl", "(", "\"", "invalid", "\"", ");", "createClientExpectingValidationError", "(", "rep", ",", "\"", "Invalid", "URL", "in", "baseUrl", "\"", ");", "}", "@", "Test", "public", "void", "updateClientValidation", "(", ")", "{", "ClientRepresentation", "rep", "=", "createClient", "(", ");", "rep", ".", "setClientId", "(", "\"", "my", "-", "app", "\"", ");", "rep", ".", "setDescription", "(", "\"", "my", "-", "app", "description", "\"", ");", "rep", ".", "setEnabled", "(", "true", ")", ";", "rep", ".", "setRootUrl", "(", "\"", "invalid", "\"", ");", "updateClientExpectingValidationError", "(", "rep", ",", "\"", "Invalid", "URL", "in", "rootUrl", "\"", ");", "rep", ".", "setRootUrl", "(", "null", ")", ";", "rep", ".", "setBaseUrl", "(", "\"", "invalid", "\"", ");", "updateClientExpectingValidationError", "(", "rep", ",", "\"", "Invalid", "URL", "in", "baseUrl", "\"", ");", "ClientRepresentation", "stored", "=", "realm", ".", "clients", "(", ").", "get", "(", "rep", ".", "getId", "(", "))", ".", "toRepresentation", "(", ");", "assertNull", "(", "stored", ".", "getRootUrl", "(", "))", ";", "assertNull", "(", "stored", ".", "getBaseUrl", "(", "))", ";", "}", "private", "void", "createClientExpectingValidationError", "(", "ClientRepresentation", "rep", ",", "String", "expectedError", ")", "{", "Response", "response", "=", "realm", ".", "clients", "(", ").", "create", "(", "rep", ")", ";", "assertEquals", "(", "400", ",", "response", ".", "getStatus", "(", "))", ";", "OAuth2ErrorRepresentation", "error", "=", "response", ".", "readEntity", "(", "OAuth2ErrorRepresentation", ".", "class", ")", ";", "assertEquals", "(", "\"", "invalid_input", "\"", ",", "error", ".", "getError", "(", "))", ";", "assertEquals", "(", "expectedError", ",", "error", ".", "getErrorDescription", "(", "))", ";", "assertNull", "(", "response", ".", "getLocation", "(", "))", ";", "response", ".", "close", "(", ");", "}", "private", "void", "updateClientExpectingValidationError", "(", "ClientRepresentation", "rep", ",", "String", "expectedError", ")", "{", "try", "{", "realm", ".", "clients", "(", ").", "get", "(", "rep", ".", "getId", "(", "))", ".", "update", "(", "rep", ")", ";", "fail", "(", "\"", "Expected", "exception", "\"", ");", "}", "catch", "(", "BadRequestException", "e", ")", "{", "Response", "response", "=", "e", ".", "getResponse", "(", ");", "assertEquals", "(", "400", ",", "response", ".", "getStatus", "(", "))", ";", "OAuth2ErrorRepresentation", "error", "=", "response", ".", "readEntity", "(", "OAuth2ErrorRepresentation", ".", "class", ")", ";", "assertEquals", "(", "\"", "invalid_input", "\"", ",", "error", ".", "getError", "(", "))", ";", "assertEquals", "(", "expectedError", ",", "error", ".", "getErrorDescription", "(", "))", ";", "}", "}", "@", "Test", "public", "void", "removeClient", "(", ")", "{", "String", "id", "=", "createClient", "(", ").", "getId", "(", ");", "@", "@", "-", "116", ",", "8", "+", "116", ",", "7", "@", "@", "protected", "ClientRepresentation", "createOidcClientRep", "(", "String", "name", ")", "{", "ClientRepresentation", "clientRep", "=", "new", "ClientRepresentation", "(", ");", "clientRep", ".", "setClientId", "(", "name", ")", ";", "clientRep", ".", "setName", "(", "name", ")", ";", "clientRep", ".", "setRootUrl", "(", "\"", "foo", "\"", ");", "clientRep", ".", "setProtocol", "(", "\"", "openid", "-", "connect", "\"", ");", "clientRep", ".", "setProtocol", "(", "\"", "openid", "-", "connect", "\"", ");", "return", "clientRep", ";", "}", "@", "@", "-", "345", ",", "7", "+", "345", ",", "6", "@", "@", "public", "void", "testRemoveClientScopeInUse", "(", ")", "{", "ClientRepresentation", "clientRep", "=", "new", "ClientRepresentation", "(", ");", "clientRep", ".", "setClientId", "(", "\"", "bar", "-", "client", "\"", ");", "clientRep", ".", "setName", "(", "\"", "bar", "-", "client", "\"", ");", "clientRep", ".", "setRootUrl", "(", "\"", "foo", "\"", ");", "clientRep", ".", "setProtocol", "(", "\"", "openid", "-", "connect", "\"", ");", "clientRep", ".", "setDefaultClientScopes", "(", "Collections", ".", "singletonList", "(", "\"", "foo", "-", "scope", "\"", "))", ";", "String", "clientDbId", "=", "createClient", "(", "clientRep", ")", ";", "@", "@", "-", "125", ",", "7", "+", "125", ",", "6", "@", "@", "public", "void", "createClientForClientRoles", "(", ")", "{", "ClientRepresentation", "client", "=", "new", "ClientRepresentation", "(", ");", "client", ".", "setClientId", "(", "CLIENT_ROLES_CLIENT", ")", ";", "client", ".", "setName", "(", "CLIENT_ROLES_CLIENT", ")", ";", "client", ".", "setRootUrl", "(", "\"", "foo", "\"", ");", "client", ".", "setProtocol", "(", "\"", "openid", "-", "connect", "\"", ");", "try", "(", "Response", "resp", "=", "testRealmResource", "(", ").", "clients", "(", ").", "create", "(", "client", ")", ")", "{", "@", "@", "-", "274", ",", "7", "+", "273", ",", "6", "@", "@", "private", "void", "addClients", "(", "boolean", "withServiceAccounts", ")", "throws", "IOException", "{", "ClientRepresentation", "client", "=", "new", "ClientRepresentation", "(", ");", "client", ".", "setClientId", "(", "CLIENT_PREFIX", "+", "i", ")", ";", "client", ".", "setName", "(", "CLIENT_PREFIX", "+", "i", ")", ";", "client", ".", "setRootUrl", "(", "\"", "foo", "\"", ");", "clients", ".", "add", "(", "client", ")", ";", "if", "(", "withServiceAccounts", ")", "{", "client", ".", "setServiceAccountsEnabled", "(", "true", ")", ";", "@", "@", "-", "24", ",", "11", "+", "24", ",", "15", "@", "@", "import", "org", ".", "keycloak", ".", "client", ".", "registration", ".", "HttpErrorException", ";", "import", "org", ".", "keycloak", ".", "models", ".", "Constants", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "ClientRepresentation", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "OAuth2ErrorRepresentation", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "ProtocolMapperRepresentation", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "UserRepresentation", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "arquillian", ".", "annotation", ".", "AuthServerContainerExclude", ";", "import", "org", ".", "keycloak", ".", "services", ".", "clientregistration", ".", "ErrorCodes", ";", "import", "org", ".", "keycloak", ".", "util", ".", "JsonSerialization", ";", "import", "javax", ".", "ws", ".", "rs", ".", "NotFoundException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "@", "@", "-", "155", ",", "7", "+", "159", ",", "49", "@", "@", "public", "void", "registerClientWithNonAsciiChars", "(", ")", "throws", "ClientRegistrationException", "ClientRepresentation", "createdClient", "=", "registerClient", "(", "client", ")", ";", "assertEquals", "(", "name", ",", "createdClient", ".", "getName", "(", "))", ";", "}", "@", "Test", "public", "void", "registerClientValidation", "(", ")", "throws", "IOException", "{", "authCreateClients", "(", ");", "ClientRepresentation", "client", "=", "buildClient", "(", ");", "client", ".", "setRootUrl", "(", "\"", "invalid", "\"", ");", "try", "{", "registerClient", "(", "client", ")", ";", "}", "catch", "(", "ClientRegistrationException", "e", ")", "{", "HttpErrorException", "c", "=", "(", "HttpErrorException", ")", "e", ".", "getCause", "(", ");", "assertEquals", "(", "400", ",", "c", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "OAuth2ErrorRepresentation", "error", "=", "JsonSerialization", ".", "readValue", "(", "c", ".", "getErrorResponse", "(", "),", "OAuth2ErrorRepresentation", ".", "class", ")", ";", "assertEquals", "(", "\"", "invalid_client_metadata", "\"", ",", "error", ".", "getError", "(", "))", ";", "assertEquals", "(", "\"", "Invalid", "URL", "in", "rootUrl", "\"", ",", "error", ".", "getErrorDescription", "(", "))", ";", "}", "}", "@", "Test", "public", "void", "updateClientValidation", "(", ")", "throws", "IOException", ",", "ClientRegistrationException", "{", "registerClientAsAdmin", "(", ");", "ClientRepresentation", "client", "=", "reg", ".", "get", "(", "CLIENT_ID", ")", ";", "client", ".", "setRootUrl", "(", "\"", "invalid", "\"", ");", "try", "{", "reg", ".", "update", "(", "client", ")", ";", "}", "catch", "(", "ClientRegistrationException", "e", ")", "{", "HttpErrorException", "c", "=", "(", "HttpErrorException", ")", "e", ".", "getCause", "(", ");", "assertEquals", "(", "400", ",", "c", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "OAuth2ErrorRepresentation", "error", "=", "JsonSerialization", ".", "readValue", "(", "c", ".", "getErrorResponse", "(", "),", "OAuth2ErrorRepresentation", ".", "class", ")", ";", "assertEquals", "(", "\"", "invalid_client_metadata", "\"", ",", "error", ".", "getError", "(", "))", ";", "assertEquals", "(", "\"", "Invalid", "URL", "in", "rootUrl", "\"", ",", "error", ".", "getErrorDescription", "(", "))", ";", "}", "ClientRepresentation", "updatedClient", "=", "reg", ".", "get", "(", "CLIENT_ID", ")", ";", "assertNull", "(", "updatedClient", ".", "getRootUrl", "(", "))", ";", "}", "@", "Test", "public", "void", "getClientAsAdmin", "(", ")", "throws", "ClientRegistrationException", "{", "registerClientAsAdmin", "(", ");"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "161", ",", "6", "+", "161", ",", "8", "@", "@", "Bug", "Fixes", "*", "SOLR", "-", "9969", ":", "\"", "Plugin", "/", "Stats", "\"", "section", "of", "the", "UI", "doesn", "'", "t", "display", "empty", "metric", "types", "(", "Tom", "\u00e1", "s", "Fern", "\u00e1", "ndez", "L", "\u00f6", "bbe", ")", "*", "SOLR", "-", "8491", ":", "solr", ".", "cmd", "SOLR_SSL_OPTS", "is", "overwritten", "(", "Sam", "Yi", ",", "Andy", "Hind", ",", "Marcel", "Berteler", ",", "Kevin", "Risden", ")", "*", "SOLR", "-", "10031", ":", "Validation", "of", "filename", "params", "in", "ReplicationHandler", "(", "Hrishikesh", "Gadre", ",", "janhoy", ")", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "6", ".", "4", ".", "0", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "Consult", "the", "LUCENE_CHANGES", ".", "txt", "file", "for", "additional", ",", "low", "level", ",", "changes", "in", "this", "release", ".", "@", "@", "-", "29", ",", "6", "+", "29", ",", "8", "@", "@", "import", "java", ".", "nio", ".", "channels", ".", "FileChannel", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "nio", ".", "file", ".", "NoSuchFileException", ";", "import", "java", ".", "nio", ".", "file", ".", "Path", ";", "import", "java", ".", "nio", ".", "file", ".", "Paths", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collection", ";", "@", "@", "-", "1418", ",", "9", "+", "1420", ",", "10", "@", "@", "public", "DirectoryFileStream", "(", "SolrParams", "solrParams", ")", "{", "params", "=", "solrParams", ";", "delPolicy", "=", "core", ".", "getDeletionPolicy", "(", ");", "fileName", "=", "params", ".", "get", "(", "FILE", ")", ";", "cfileName", "=", "params", ".", "get", "(", "CONF_FILE_SHORT", ")", ";", "tlogFileName", "=", "params", ".", "get", "(", "TLOG_FILE", ")", ";", "fileName", "=", "validateFilenameOrError", "(", "params", ".", "get", "(", "FILE", ")", ");", "cfileName", "=", "validateFilenameOrError", "(", "params", ".", "get", "(", "CONF_FILE_SHORT", ")", ");", "tlogFileName", "=", "validateFilenameOrError", "(", "params", ".", "get", "(", "TLOG_FILE", ")", ");", "sOffset", "=", "params", ".", "get", "(", "OFFSET", ")", ";", "sLen", "=", "params", ".", "get", "(", "LEN", ")", ";", "compress", "=", "params", ".", "get", "(", "COMPRESSION", ")", ";", "@", "@", "-", "1434", ",", "6", "+", "1437", ",", "22", "@", "@", "public", "DirectoryFileStream", "(", "SolrParams", "solrParams", ")", "{", "rateLimiter", "=", "new", "RateLimiter", ".", "SimpleRateLimiter", "(", "maxWriteMBPerSec", ")", ";", "}", "/", "/", "Throw", "exception", "on", "directory", "traversal", "attempts", "protected", "String", "validateFilenameOrError", "(", "String", "filename", ")", "{", "if", "(", "filename", "!", "=", "null", ")", "{", "Path", "filePath", "=", "Paths", ".", "get", "(", "filename", ")", ";", "filePath", ".", "forEach", "(", "subpath", "-", ">", "{", "if", "(", "\".", ".\"", ".", "equals", "(", "subpath", ".", "toString", "(", "))", ")", "{", "throw", "new", "SolrException", "(", "ErrorCode", ".", "FORBIDDEN", ",", "\"", "File", "name", "cannot", "contain", ".", ".\"", ");", "}", "}", ");", "if", "(", "filePath", ".", "isAbsolute", "(", "))", "{", "throw", "new", "SolrException", "(", "ErrorCode", ".", "FORBIDDEN", ",", "\"", "File", "name", "must", "be", "relative", "\"", ");", "}", "return", "filename", ";", "}", "else", "return", "null", ";", "}", "protected", "void", "initWrite", "(", ")", "throws", "IOException", "{", "if", "(", "sOffset", "!", "=", "null", ")", "offset", "=", "Long", ".", "parseLong", "(", "sOffset", ")", ";", "if", "(", "sLen", "!", "=", "null", ")", "len", "=", "Integer", ".", "parseInt", "(", "sLen", ")", ";", "@", "@", "-", "1424", ",", "6", "+", "1424", ",", "21", "@", "@", "public", "void", "testRateLimitedReplication", "(", ")", "throws", "Exception", "{", "assertTrue", "(", "timeTakenInSeconds", "-", "approximateTimeInSeconds", ">", "0", ")", ";", "}", "@", "Test", "public", "void", "doTestIllegalFilePaths", "(", ")", "throws", "Exception", "{", "/", "/", "Loop", "through", "the", "file", "=", ",", "cf", "=", ",", "tlogFile", "=", "params", "and", "prove", "that", "it", "throws", "exception", "for", "path", "traversal", "attempts", "List", "<", "String", ">", "illegalFilenames", "=", "Arrays", ".", "asList", "(", "\"/", "foo", "/", "bar", "\"", ",", "\"", "..", "/", "dir", "/", "traversal", "\"", ",", "\"", "illegal", "\\", "rfile", "\\", "nname", "\\", "t", "\"", ");", "List", "<", "String", ">", "params", "=", "Arrays", ".", "asList", "(", "ReplicationHandler", ".", "FILE", ",", "ReplicationHandler", ".", "CONF_FILE_SHORT", ",", "ReplicationHandler", ".", "TLOG_FILE", ")", ";", "for", "(", "String", "param", ":", "params", ")", "{", "for", "(", "String", "filename", ":", "illegalFilenames", ")", "{", "try", "{", "invokeReplicationCommand", "(", "masterJetty", ".", "getLocalPort", "(", "),", "\"", "filecontent", "&", "\"", "+", "param", "+", "\"", "=\"", "+", "filename", ")", ";", "fail", "(", "\"", "Should", "have", "thrown", "exception", "on", "illegal", "path", "for", "param", "\"", "+", "param", "+", "\"", "and", "file", "name", "\"", "+", "filename", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "}", "}", "}", "}", "private", "class", "AddExtraDocs", "implements", "Runnable", "{", "SolrClient", "masterClient", ";"], "docstring_tokens": ["path", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1450", ",", "9", "+", "1450", ",", "6", "@", "@", "AsyncSocket", ":", ":", "WriteResult", "AsyncSSLSocket", ":", ":", "interpretSSLError", "(", "int", "rc", ",", "int", "error", ")", "{", "WRITE_ERROR", ",", "std", ":", ":", "make_unique", "<", "SSLException", ">", "(", "SSLError", ":", ":", "INVALID_RENEGOTIATION", ")", ");", "}", "else", "{", "if", "(", "zero_return", "(", "error", ",", "rc", ",", "errno", ")", ")", "{", "return", "WriteResult", "(", "0", ")", ";", "}", "auto", "errError", "=", "ERR_get_error", "(", ");", "VLOG", "(", "3", ")", "<", "<", "\"", "ERROR", ":", "AsyncSSLSocket", "(", "fd", "=", "\"", "<", "<", "fd_", "<", "<", "\"", ",", "state", "=", "\"", "<", "<", "int", "(", "state_", ")", "<", "<", "\"", ",", "sslState", "=", "\"", "<", "<", "sslState_", "<", "<", "\"", ",", "events", "=", "\"", "<", "<", "eventFlags_", "<", "<", "\"", "):", "\"", "@", "@", "-", "1589", ",", "10", "+", "1586", ",", "7", "@", "@", "AsyncSocket", ":", ":", "WriteResult", "AsyncSSLSocket", ":", ":", "performWrite", "(", "*", "partialWritten", "=", "uint32_t", "(", "offset", ")", ";", "return", "WriteResult", "(", "totalWritten", ")", ";", "}", "auto", "writeResult", "=", "interpretSSLError", "(", "int", "(", "bytes", ")", ",", "error", ")", ";", "if", "(", "writeResult", ".", "writeReturn", "<", "0", ")", "{", "return", "writeResult", ";", "}", "/", "/", "else", "fall", "through", "to", "below", "to", "correctly", "record", "totalWritten", "return", "interpretSSLError", "(", "int", "(", "bytes", ")", ",", "error", ")", ";", "}", "totalWritten", "+", "=", "bytes", ";", "@", "@", "-", "808", ",", "6", "+", "808", ",", "114", "@", "@", "TEST", "(", "AsyncSSLSocketTest", ",", "SSLClientTimeoutTest", ")", "{", "cerr", "<", "<", "\"", "SSLClientTimeoutTest", "test", "completed", "\"", "<", "<", "endl", ";", "}", "class", "PerLoopReadCallback", ":", "public", "AsyncTransportWrapper", ":", ":", "ReadCallback", "{", "public", ":", "void", "getReadBuffer", "(", "void", "*", "*", "bufReturn", ",", "size_t", "*", "lenReturn", ")", "override", "{", "*", "bufReturn", "=", "buf_", ".", "data", "(", ");", "*", "lenReturn", "=", "buf_", ".", "size", "(", ");", "}", "void", "readDataAvailable", "(", "size_t", "len", ")", "noexcept", "override", "{", "VLOG", "(", "3", ")", "<", "<", "\"", "Read", "of", "size", ":", "\"", "<", "<", "len", ";", "s_", "-", ">", "setReadCB", "(", "nullptr", ")", ";", "s_", "-", ">", "getEventBase", "(", ")-", ">", "runInLoop", "(", "[", "this", "]", "()", "{", "s_", "-", ">", "setReadCB", "(", "this", ")", ";", "}", ");", "}", "void", "readErr", "(", "const", "AsyncSocketException", "&", ")", "noexcept", "override", "{", "}", "void", "readEOF", "(", ")", "noexcept", "override", "{", "}", "void", "setSocket", "(", "AsyncSocket", "*", "s", ")", "{", "s_", "=", "s", ";", "}", "private", ":", "AsyncSocket", "*", "s_", ";", "std", ":", ":", "array", "<", "uint8_t", ",", "1000", ">", "buf_", ";", "}", ";", "class", "CloseNotifyConnector", ":", "public", "AsyncSocket", ":", ":", "ConnectCallback", "{", "public", ":", "CloseNotifyConnector", "(", "EventBase", "*", "evb", ",", "const", "SocketAddress", "&", "addr", ")", "{", "evb_", "=", "evb", ";", "ssl_", "=", "AsyncSSLSocket", ":", ":", "newSocket", "(", "std", ":", ":", "make_shared", "<", "SSLContext", ">", "()", ",", "evb_", ")", ";", "ssl_", "-", ">", "connect", "(", "this", ",", "addr", ")", ";", "}", "void", "connectSuccess", "(", ")", "noexcept", "override", "{", "ssl_", "-", ">", "writeChain", "(", "nullptr", ",", "IOBuf", ":", ":", "copyBuffer", "(", "\"", "hi", "\"", "))", ";", "auto", "ssl", "=", "const_cast", "<", "SSL", "*", ">(", "ssl_", "-", ">", "getSSL", "(", "))", ";", "SSL_shutdown", "(", "ssl", ")", ";", "auto", "fd", "=", "ssl_", "-", ">", "detachNetworkSocket", "(", ");", "tcp_", ".", "reset", "(", "new", "AsyncSocket", "(", "evb_", ",", "fd", ")", ",", "AsyncSocket", ":", ":", "Destructor", "(", "))", ";", "evb_", "-", ">", "runAfterDelay", "(", "[", "this", "]", "()", "{", "perLoopReads_", ".", "setSocket", "(", "tcp_", ".", "get", "(", "))", ";", "tcp_", "-", ">", "setReadCB", "(", "&", "perLoopReads_", ")", ";", "evb_", "-", ">", "runAfterDelay", "(", "[", "this", "]", "()", "{", "tcp_", "-", ">", "closeNow", "(", ");", "}", ",", "10", ")", ";", "}", ",", "100", ")", ";", "}", "void", "connectErr", "(", "const", "AsyncSocketException", "&", "ex", ")", "noexcept", "override", "{", "FAIL", "(", ")", "<", "<", "ex", ".", "what", "(", ");", "}", "private", ":", "EventBase", "*", "evb_", ";", "std", ":", ":", "shared_ptr", "<", "AsyncSSLSocket", ">", "ssl_", ";", "std", ":", ":", "shared_ptr", "<", "AsyncSocket", ">", "tcp_", ";", "PerLoopReadCallback", "perLoopReads_", ";", "}", ";", "class", "ErrorCheckingWriteCallback", ":", "public", "AsyncSocket", ":", ":", "WriteCallback", "{", "public", ":", "void", "writeSuccess", "(", ")", "noexcept", "override", "{", "}", "void", "writeErr", "(", "size_t", ",", "const", "AsyncSocketException", "&", "ex", ")", "noexcept", "override", "{", "LOG", "(", "ERROR", ")", "<", "<", "\"", "write", "error", ":", "\"", "<", "<", "ex", ".", "what", "(", ");", "EXPECT_NE", "(", "ex", ".", "getType", "(", "),", "AsyncSocketException", ":", ":", "AsyncSocketExceptionType", ":", ":", "SSL_ERROR", ")", ";", "}", "}", ";", "class", "WriteOnEofReadCallback", ":", "public", "ReadCallback", "{", "public", ":", "using", "ReadCallback", ":", ":", "ReadCallback", ";", "void", "readEOF", "(", ")", "noexcept", "override", "{", "LOG", "(", "INFO", ")", "<", "<", "\"", "Got", "EOF", "\"", ";", "auto", "chain", "=", "IOBuf", ":", ":", "create", "(", "0", ")", ";", "for", "(", "size_t", "i", "=", "0", ";", "i", "<", "1000", "*", "1000", ";", "i", "+", "+)", "{", "auto", "buf", "=", "IOBuf", ":", ":", "create", "(", "10", ")", ";", "buf", "-", ">", "append", "(", "10", ")", ";", "memset", "(", "buf", "-", ">", "writableData", "(", "),", "'", "x", "'", ",", "10", ")", ";", "chain", "-", ">", "prependChain", "(", "std", ":", ":", "move", "(", "buf", ")", ");", "}", "socket_", "-", ">", "writeChain", "(", "&", "writeCallback_", ",", "std", ":", ":", "move", "(", "chain", ")", ");", "}", "void", "readErr", "(", "const", "AsyncSocketException", "&", "ex", ")", "noexcept", "override", "{", "LOG", "(", "ERROR", ")", "<", "<", "ex", ".", "what", "(", ");", "}", "private", ":", "ErrorCheckingWriteCallback", "writeCallback_", ";", "}", ";", "TEST", "(", "AsyncSSLSocketTest", ",", "EarlyCloseNotify", ")", "{", "WriteOnEofReadCallback", "readCallback", "(", "nullptr", ")", ";", "HandshakeCallback", "handshakeCallback", "(", "&", "readCallback", ")", ";", "SSLServerAcceptCallback", "acceptCallback", "(", "&", "handshakeCallback", ")", ";", "TestSSLServer", "server", "(", "&", "acceptCallback", ")", ";", "EventBase", "eventBase", ";", "CloseNotifyConnector", "cnc", "(", "&", "eventBase", ",", "server", ".", "getAddress", "(", "))", ";", "eventBase", ".", "loop", "(", ");", "}", "/", "**", "*", "Verify", "Client", "Ciphers", "obtained", "using", "SSL", "MSG", "Callback", ".", "*", "/", "@", "@", "-", "389", ",", "7", "+", "389", ",", "9", "@", "@", "class", "ReadCallback", ":", "public", "ReadCallbackBase", "{", "currentBuffer", ".", "length", "=", "len", ";", "wcb_", "-", ">", "setSocket", "(", "socket_", ")", ";", "if", "(", "wcb_", ")", "{", "wcb_", "-", ">", "setSocket", "(", "socket_", ")", ";", "}", "/", "/", "Write", "back", "the", "same", "data", ".", "socket_", "-", ">", "write", "(", "wcb_", ",", "currentBuffer", ".", "buffer", ",", "len", ",", "writeFlags", ")", ";"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "39", ",", "16", "+", "39", ",", "12", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "util", ".", "TypeInformation", ";", "import", "org", ".", "springframework", ".", "expression", ".", "AccessException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "EvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "EvaluationException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "Expression", ";", "import", "org", ".", "springframework", ".", "expression", ".", "TypeLocator", ";", "import", "org", ".", "springframework", ".", "expression", ".", "TypedValue", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelEvaluationException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelMessage", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelParserConfiguration", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "standard", ".", "SpelExpressionParser", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardEvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardTypeConverter", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "SimpleEvaluationContext", ";", "import", "org", ".", "springframework", ".", "util", ".", "Assert", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "WebDataBinder", ";", "@", "@", "-", "108", ",", "13", "+", "104", ",", "6", "@", "@", "protected", "ConfigurablePropertyAccessor", "getPropertyAccessor", "(", ")", "{", "private", "static", "final", "SpelExpressionParser", "PARSER", "=", "new", "SpelExpressionParser", "(", "new", "SpelParserConfiguration", "(", "false", ",", "true", ")", ");", "private", "static", "final", "TypeLocator", "REJECTING_LOCATOR", "=", "new", "TypeLocator", "(", ")", "{", "@", "Override", "public", "Class", "<", "?>", "findType", "(", "String", "typeName", ")", "throws", "EvaluationException", "{", "throw", "new", "SpelEvaluationException", "(", "SpelMessage", ".", "TYPE_NOT_FOUND", ",", "typeName", ")", ";", "}", "}", ";", "private", "final", "@", "NonNull", "Class", "<", "?>", "type", ";", "private", "final", "@", "NonNull", "Map", "<", "String", ",", "Object", ">", "map", ";", "@", "@", "-", "172", ",", "14", "+", "161", ",", "6", "@", "@", "public", "void", "setPropertyValue", "(", "String", "propertyName", ",", "Object", "value", ")", "throws", "BeansExce", "throw", "new", "NotWritablePropertyException", "(", "type", ",", "propertyName", ")", ";", "}", "StandardEvaluationContext", "context", "=", "new", "StandardEvaluationContext", "(", ");", "context", ".", "addPropertyAccessor", "(", "new", "PropertyTraversingMapAccessor", "(", "type", ",", "conversionService", ")", ");", "context", ".", "setTypeConverter", "(", "new", "StandardTypeConverter", "(", "conversionService", ")", ");", "context", ".", "setTypeLocator", "(", "REJECTING_LOCATOR", ")", ";", "context", ".", "setRootObject", "(", "map", ")", ";", "Expression", "expression", "=", "PARSER", ".", "parseExpression", "(", "propertyName", ")", ";", "PropertyPath", "leafProperty", "=", "getPropertyPath", "(", "propertyName", ")", ".", "getLeafProperty", "(", ");", "TypeInformation", "<", "?>", "owningType", "=", "leafProperty", ".", "getOwningType", "(", ");", "TypeInformation", "<", "?>", "propertyType", "=", "owningType", ".", "getProperty", "(", "leafProperty", ".", "getSegment", "(", "))", ";", "@", "@", "-", "196", ",", "6", "+", "177", ",", "15", "@", "@", "public", "void", "setPropertyValue", "(", "String", "propertyName", ",", "Object", "value", ")", "throws", "BeansExce", "value", "=", "conversionService", ".", "convert", "(", "value", ",", "TypeDescriptor", ".", "forObject", "(", "value", ")", ",", "typeDescriptor", ")", ";", "}", "EvaluationContext", "context", "=", "SimpleEvaluationContext", "/", "/", ".", "forPropertyAccessors", "(", "new", "PropertyTraversingMapAccessor", "(", "type", ",", "conversionService", ")", ")", "/", "/", ".", "withConversionService", "(", "conversionService", ")", "/", "/", ".", "withRootObject", "(", "map", ")", "/", "/", ".", "build", "(", ");", "Expression", "expression", "=", "PARSER", ".", "parseExpression", "(", "propertyName", ")", ";", "try", "{", "expression", ".", "setValue", "(", "context", ",", "value", ")", ";", "}", "catch", "(", "SpelEvaluationException", "o_O", ")", "{"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "443", ",", "7", "+", "443", ",", "7", "@", "@", "init_state", "(", "struct", "posix_acl_state", "*", "state", ",", "int", "cnt", ")", "*", "enough", "space", "for", "either", ":", "*", "/", "alloc", "=", "sizeof", "(", "struct", "posix_ace_state_array", ")", "+", "cnt", "*", "sizeof", "(", "struct", "posix_ace_state", ")", ";", "+", "cnt", "*", "sizeof", "(", "struct", "posix_user_ace_state", ")", ";", "state", "-", ">", "users", "=", "kzalloc", "(", "alloc", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "state", "-", ">", "users", ")", "return", "-", "ENOMEM", ";"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "682", ",", "6", "+", "682", ",", "15", "@", "@", "static", "int", "load_elf_binary", "(", "struct", "linux_binprm", "*", "bprm", ",", "struct", "pt_regs", "*", "regs", ")", "retval", "=", "PTR_ERR", "(", "interpreter", ")", ";", "if", "(", "IS_ERR", "(", "interpreter", ")", ")", "goto", "out_free_interp", ";", "/", "*", "*", "If", "the", "binary", "is", "not", "readable", "then", "enforce", "*", "mm", "-", ">", "dumpable", "=", "0", "regardless", "of", "the", "interpreter", "'", "s", "*", "permissions", ".", "*", "/", "if", "(", "file_permission", "(", "interpreter", ",", "MAY_READ", ")", "<", "0", ")", "bprm", "-", ">", "interp_flags", "|", "=", "BINPRM_FLAGS_ENFORCE_NONDUMP", ";", "retval", "=", "kernel_read", "(", "interpreter", ",", "0", ",", "bprm", "-", ">", "buf", ",", "BINPRM_BUF_SIZE", ")", ";", "if", "(", "retval", "!", "=", "BINPRM_BUF_SIZE", ")", "{", "@", "@", "-", "234", ",", "6", "+", "234", ",", "14", "@", "@", "static", "int", "load_elf_fdpic_binary", "(", "struct", "linux_binprm", "*", "bprm", ",", "goto", "error", ";", "}", "/", "*", "*", "If", "the", "binary", "is", "not", "readable", "then", "enforce", "*", "mm", "-", ">", "dumpable", "=", "0", "regardless", "of", "the", "interpreter", "'", "s", "*", "permissions", ".", "*", "/", "if", "(", "file_permission", "(", "interpreter", ",", "MAY_READ", ")", "<", "0", ")", "bprm", "-", ">", "interp_flags", "|", "=", "BINPRM_FLAGS_ENFORCE_NONDUMP", ";", "retval", "=", "kernel_read", "(", "interpreter", ",", "0", ",", "bprm", "-", ">", "buf", ",", "BINPRM_BUF_SIZE", ")", ";", "if", "(", "retval", "<", "0", ")"], "docstring_tokens": ["executable", "file", "read"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "281", ",", "13", "+", "281", ",", "10", "@", "@", "snd_seq_oss_open", "(", "struct", "file", "*", "file", ",", "int", "level", ")", "return", "0", ";", "_error", ":", "snd_seq_oss_writeq_delete", "(", "dp", "-", ">", "writeq", ")", ";", "snd_seq_oss_readq_delete", "(", "dp", "-", ">", "readq", ")", ";", "snd_seq_oss_synth_cleanup", "(", "dp", ")", ";", "snd_seq_oss_midi_cleanup", "(", "dp", ")", ";", "delete_port", "(", "dp", ")", ";", "delete_seq_queue", "(", "dp", "-", ">", "queue", ")", ";", "kfree", "(", "dp", ")", ";", "delete_port", "(", "dp", ")", ";", "return", "rc", ";", "}", "@", "@", "-", "350", ",", "8", "+", "347", ",", "10", "@", "@", "create_port", "(", "struct", "seq_oss_devinfo", "*", "dp", ")", "static", "int", "delete_port", "(", "struct", "seq_oss_devinfo", "*", "dp", ")", "{", "if", "(", "dp", "-", ">", "port", "<", "0", ")", "if", "(", "dp", "-", ">", "port", "<", "0", ")", "{", "kfree", "(", "dp", ")", ";", "return", "0", ";", "}", "debug_printk", "(", "(\"", "delete_port", "%", "i", "\\", "n", "\"", ",", "dp", "-", ">", "port", ")", ");", "return", "snd_seq_event_port_detach", "(", "dp", "-", ">", "cseq", ",", "dp", "-", ">", "port", ")", ";"], "docstring_tokens": ["pointer", "dereferencing"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "311", ",", "7", "+", "311", ",", "7", "@", "@", "asmlinkage", "long", "sys_oabi_semtimedop", "(", "int", "semid", ",", "long", "err", ";", "int", "i", ";", "if", "(", "nsops", "<", "1", ")", "if", "(", "nsops", "<", "1", "|", "|", "nsops", ">", "SEMOPM", ")", "return", "-", "EINVAL", ";", "sops", "=", "kmalloc", "(", "sizeof", "(", "*", "sops", ")", "*", "nsops", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "sops", ")"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "45", ",", "7", "+", "45", ",", "7", "@", "@", "protected", "void", "doGet", "(", "final", "HttpServletRequest", "request", ",", "final", "HttpServletResponse", ".", "map", "(", "cache", "-", ">", "(", "Cache", "<", "?,", "?", ">)", "cache", ")", ";", "if", "(", "!", "optionalCache", ".", "isPresent", "(", "))", "{", "request", ".", "setAttribute", "(", "\"", "warningMessage", "\"", ",", "LocaleUtils", ".", "getLocalizedString", "(", "\"", "system", ".", "cache", "-", "details", ".", "cache_not_found", "\"", ",", "Collections", ".", "singletonList", "(", "cacheName", ")", "))", ";", "request", ".", "setAttribute", "(", "\"", "warningMessage", "\"", ",", "LocaleUtils", ".", "getLocalizedString", "(", "\"", "system", ".", "cache", "-", "details", ".", "cache_not_found", "\"", ",", "Collections", ".", "singletonList", "(", "StringUtils", ".", "escapeHTMLTags", "(", "cacheName", ")", "))", ");", "}", "final", "boolean", "secretKey", "=", "optionalCache", ".", "map", "(", "Cache", ":", ":", "isKeySecret", ")", ".", "orElse", "(", "Boolean", ".", "FALSE", ")", ";", "@", "@", "-", "150", ",", "7", "+", "150", ",", "7", "@", "@", "<", "label", "for", "=", "\"", "alias", "\"", "><", "fmt", ":", "message", "key", "=", "\"", "ssl", ".", "signing", "-", "request", ".", "alias", "\"", "/>", "</", "label", ">", "<", "/", "td", ">", "<", "td", "width", "=", "\"", "99", "%", "\">", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "100", "\"", "name", "=", "\"", "alias", "\"", "id", "=", "\"", "alias", "\"", "value", "=", "\"$", "{", "param", ".", "alias", "}", "\">", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "100", "\"", "name", "=", "\"", "alias", "\"", "id", "=", "\"", "alias", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "alias", "}", "'/", ">\"", "\">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "tr", "valign", "=", "\"", "top", "\"", ">", "@", "@", "-", "490", ",", "7", "+", "490", ",", "7", "@", "@", "<", "form", "action", "=", "\"", "security", "-", "certificate", "-", "details", ".", "jsp", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "connectionType", "\"", "value", "=", "\"$", "{", "connectionType", "}", "\"/", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "isTrustStore", "\"", "value", "=", "\"$", "{", "param", ".", "isTrustStore", "}", "\"/", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "isTrustStore", "\"", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "isTrustStore", "}", "'/", ">\"", "/>", "<", "div", "style", "=", "\"", "text", "-", "align", ":", "center", ";", "\">", "<", "input", "type", "=", "\"", "submit", "\"", "name", "=", "\"", "back", "\"", "value", "=", "\"<", "fmt", ":", "message", "key", "=", "\"", "session", ".", "details", ".", "back_button", "\"", "/>", "\">", "<", "/", "div", ">", "@", "@", "-", "9", ",", "7", "+", "9", ",", "8", "@", "@", "<", "jsp", ":", "useBean", "scope", "=", "\"", "request", "\"", "id", "=", "\"", "search", "\"", "type", "=", "\"", "org", ".", "jivesoftware", ".", "admin", ".", "servlet", ".", "SystemCacheDetailsServlet", ".", "Search", "\"", "/>", "<", "%@", "page", "contentType", "=", "\"", "text", "/", "html", ";", "charset", "=", "UTF", "-", "8", "\"", "%", ">", "<", "head", ">", "<", "title", ">", "<", "fmt", ":", "message", "key", "=", "\"", "system", ".", "cache", "-", "details", ".", "title", "\"", "><", "fmt", ":", "param", "value", "=", "\"$", "{", "cacheName", "}", "\"/", "><", "/", "fmt", ":", "message", ">", "</", "title", ">", "<", "fmt", ":", "message", "key", "=", "\"", "system", ".", "cache", "-", "details", ".", "title", "\"", "var", "=", "\"", "title", "\"", "><", "fmt", ":", "param", "value", "=", "\"$", "{", "cacheName", "}", "\"/", "><", "/", "fmt", ":", "message", ">", "<", "title", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "title", "}", "\"/", "><", "/", "title", ">", "<", "meta", "name", "=", "\"", "pageID", "\"", "content", "=", "\"", "system", "-", "cache", "\"", "/>", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", "img", ".", "clickable", "{", "@", "@", "-", "235", ",", "7", "+", "235", ",", "7", "@", "@", "<", "td", "align", "=", "\"", "right", "\"", "valign", "=", "\"", "bottom", "\"", "><", "fmt", ":", "message", "key", "=", "\"", "group", ".", "summary", ".", "search", "\"", "/", ">:", "<", "input", "type", "=", "\"", "text", "\"", "size", "=", "\"", "30", "\"", "maxlength", "=", "\"", "150", "\"", "name", "=", "\"", "search", "\"", "value", "=", "\"<", "%=", "((", "search", "!", "=", "null", ")", "?", "search", ":", "\"", "\")", "%>", "\">", "</", "td", ">", "value", "=", "\"<", "c", ":", "out", "value", "=", "'$", "{", "param", ".", "search", "}", "'/", ">\"", "><", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "name", "=", "\"", "username", "\""], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "817", ",", "26", "+", "817", ",", "49", "@", "@", "static", "int", "ati_remote2_probe", "(", "struct", "usb_interface", "*", "interface", ",", "const", "struct", "usb_d", "ar2", "-", ">", "udev", "=", "udev", ";", "/", "*", "Sanity", "check", ",", "first", "interface", "must", "have", "an", "endpoint", "*", "/", "if", "(", "alt", "-", ">", "desc", ".", "bNumEndpoints", "<", "1", "|", "|", "!", "alt", "-", ">", "endpoint", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "%", "s", "(", "):", "interface", "0", "must", "have", "an", "endpoint", "\\", "n", "\"", ",", "__func__", ")", ";", "r", "=", "-", "ENODEV", ";", "goto", "fail1", ";", "}", "ar2", "-", ">", "intf", "[", "0", "]", "=", "interface", ";", "ar2", "-", ">", "ep", "[", "0", "]", "=", "&", "alt", "-", ">", "endpoint", "[", "0", "]", ".", "desc", ";", "/", "*", "Sanity", "check", ",", "the", "device", "must", "have", "two", "interfaces", "*", "/", "ar2", "-", ">", "intf", "[", "1", "]", "=", "usb_ifnum_to_if", "(", "udev", ",", "1", ")", ";", "if", "(", "(", "udev", "-", ">", "actconfig", "-", ">", "desc", ".", "bNumInterfaces", "<", "2", ")", "|", "|", "!", "ar2", "-", ">", "intf", "[", "1", "]", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "%", "s", "(", "):", "need", "2", "interfaces", ",", "found", "%", "d", "\\", "n", "\"", ",", "__func__", ",", "udev", "-", ">", "actconfig", "-", ">", "desc", ".", "bNumInterfaces", ")", ";", "r", "=", "-", "ENODEV", ";", "goto", "fail1", ";", "}", "r", "=", "usb_driver_claim_interface", "(", "&", "ati_remote2_driver", ",", "ar2", "-", ">", "intf", "[", "1", "]", ",", "ar2", ")", ";", "if", "(", "r", ")", "goto", "fail1", ";", "/", "*", "Sanity", "check", ",", "second", "interface", "must", "have", "an", "endpoint", "*", "/", "alt", "=", "ar2", "-", ">", "intf", "[", "1", "]", "->", "cur_altsetting", ";", "if", "(", "alt", "-", ">", "desc", ".", "bNumEndpoints", "<", "1", "|", "|", "!", "alt", "-", ">", "endpoint", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "%", "s", "(", "):", "interface", "1", "must", "have", "an", "endpoint", "\\", "n", "\"", ",", "__func__", ")", ";", "r", "=", "-", "ENODEV", ";", "goto", "fail2", ";", "}", "ar2", "-", ">", "ep", "[", "1", "]", "=", "&", "alt", "-", ">", "endpoint", "[", "0", "]", ".", "desc", ";", "r", "=", "ati_remote2_urb_init", "(", "ar2", ")", ";", "if", "(", "r", ")", "goto", "fail2", ";", "goto", "fail3", ";", "ar2", "-", ">", "channel_mask", "=", "channel_mask", ";", "ar2", "-", ">", "mode_mask", "=", "mode_mask", ";", "r", "=", "ati_remote2_setup", "(", "ar2", ",", "ar2", "-", ">", "channel_mask", ")", ";", "if", "(", "r", ")", "goto", "fail2", ";", "goto", "fail3", ";", "usb_make_path", "(", "udev", ",", "ar2", "-", ">", "phys", ",", "sizeof", "(", "ar2", "-", ">", "phys", ")", ");", "strlcat", "(", "ar2", "-", ">", "phys", ",", "\"", "/", "input0", "\"", ",", "sizeof", "(", "ar2", "-", ">", "phys", ")", ");", "@", "@", "-", "845", ",", "22", "+", "868", ",", "23", "@", "@", "static", "int", "ati_remote2_probe", "(", "struct", "usb_interface", "*", "interface", ",", "const", "struct", "usb_d", "r", "=", "sysfs_create_group", "(", "&", "udev", "-", ">", "dev", ".", "kobj", ",", "&", "ati_remote2_attr_group", ")", ";", "if", "(", "r", ")", "goto", "fail2", ";", "goto", "fail3", ";", "r", "=", "ati_remote2_input_init", "(", "ar2", ")", ";", "if", "(", "r", ")", "goto", "fail3", ";", "goto", "fail4", ";", "usb_set_intfdata", "(", "interface", ",", "ar2", ")", ";", "interface", "-", ">", "needs_remote_wakeup", "=", "1", ";", "return", "0", ";", "fail3", ":", "fail4", ":", "sysfs_remove_group", "(", "&", "udev", "-", ">", "dev", ".", "kobj", ",", "&", "ati_remote2_attr_group", ")", ";", "fail2", ":", "fail3", ":", "ati_remote2_urb_cleanup", "(", "ar2", ")", ";", "fail2", ":", "usb_driver_release_interface", "(", "&", "ati_remote2_driver", ",", "ar2", "-", ">", "intf", "[", "1", "]", ");", "fail1", ":", "kfree", "(", "ar2", ")", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "275", ",", "6", "+", "275", ",", "8", "@", "@", "aubio_source_avcodec_t", "*", "new_aubio_source_avcodec", "(", "const", "char_t", "*", "path", ",", "uint_t", "sa", "/", "/", "default", "to", "mono", "output", "aubio_source_avcodec_reset_resampler", "(", "s", ",", "0", ")", ";", "if", "(", "s", "-", ">", "avr", "=", "=", "NULL", ")", "goto", "beach", ";", "s", "-", ">", "eof", "=", "0", ";", "s", "-", ">", "multi", "=", "0", ";"], "docstring_tokens": ["segv", "signal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2485", ",", "6", "+", "2485", ",", "7", "@", "@", "int", "ERR_load_SSL_strings", "(", "void", ")", ";", "#", "define", "SSL_R_TLS_HEARTBEAT_PENDING", "366", "#", "define", "SSL_R_TLS_ILLEGAL_EXPORTER_LABEL", "367", "#", "define", "SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST", "157", "#", "define", "SSL_R_TOO_MANY_WARN_ALERTS", "409", "#", "define", "SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS", "314", "#", "define", "SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS", "239", "#", "define", "SSL_R_UNABLE_TO_LOAD_SSL3_MD5_ROUTINES", "242", "@", "@", "-", "443", ",", "6", "+", "443", ",", "14", "@", "@", "int", "dtls1_read_bytes", "(", "SSL", "*", "s", ",", "int", "type", ",", "int", "*", "recvd_type", ",", "unsigned", "char", "*", "buf", ",", "}", "}", "/", "*", "*", "Reset", "the", "count", "of", "consecutive", "warning", "alerts", "if", "we", "'", "ve", "got", "a", "non", "-", "empty", "*", "record", "that", "isn", "'", "t", "an", "alert", ".", "*", "/", "if", "(", "SSL3_RECORD_get_type", "(", "rr", ")", "!", "=", "SSL3_RT_ALERT", "&", "&", "SSL3_RECORD_get_length", "(", "rr", ")", "!", "=", "0", ")", "s", "-", ">", "rlayer", ".", "alert_count", "=", "0", ";", "/", "*", "we", "now", "have", "a", "packet", "which", "can", "be", "read", "and", "processed", "*", "/", "if", "(", "s", "-", ">", "s3", "-", ">", "change_cipher_spec", "/", "*", "set", "when", "we", "receive", "ChangeCipherSpec", ",", "@", "@", "-", "722", ",", "6", "+", "730", ",", "14", "@", "@", "int", "dtls1_read_bytes", "(", "SSL", "*", "s", ",", "int", "type", ",", "int", "*", "recvd_type", ",", "unsigned", "char", "*", "buf", ",", "if", "(", "alert_level", "=", "=", "SSL3_AL_WARNING", ")", "{", "s", "-", ">", "s3", "-", ">", "warn_alert", "=", "alert_descr", ";", "s", "-", ">", "rlayer", ".", "alert_count", "+", "+;", "if", "(", "s", "-", ">", "rlayer", ".", "alert_count", "=", "=", "MAX_WARN_ALERT_COUNT", ")", "{", "al", "=", "SSL_AD_UNEXPECTED_MESSAGE", ";", "SSLerr", "(", "SSL_F_DTLS1_READ_BYTES", ",", "SSL_R_TOO_MANY_WARN_ALERTS", ")", ";", "goto", "f_err", ";", "}", "if", "(", "alert_descr", "=", "=", "SSL_AD_CLOSE_NOTIFY", ")", "{", "#", "ifndef", "OPENSSL_NO_SCTP", "/", "*", "@", "@", "-", "1063", ",", "6", "+", "1063", ",", "14", "@", "@", "int", "ssl3_read_bytes", "(", "SSL", "*", "s", ",", "int", "type", ",", "int", "*", "recvd_type", ",", "unsigned", "char", "*", "buf", ",", "}", "while", "(", "num_recs", "=", "=", "0", ")", ";", "rr", "=", "&", "rr", "[", "curr_rec", "]", ";", "/", "*", "*", "Reset", "the", "count", "of", "consecutive", "warning", "alerts", "if", "we", "'", "ve", "got", "a", "non", "-", "empty", "*", "record", "that", "isn", "'", "t", "an", "alert", ".", "*", "/", "if", "(", "SSL3_RECORD_get_type", "(", "rr", ")", "!", "=", "SSL3_RT_ALERT", "&", "&", "SSL3_RECORD_get_length", "(", "rr", ")", "!", "=", "0", ")", "s", "-", ">", "rlayer", ".", "alert_count", "=", "0", ";", "/", "*", "we", "now", "have", "a", "packet", "which", "can", "be", "read", "and", "processed", "*", "/", "if", "(", "s", "-", ">", "s3", "-", ">", "change_cipher_spec", "/", "*", "set", "when", "we", "receive", "ChangeCipherSpec", ",", "@", "@", "-", "1333", ",", "6", "+", "1341", ",", "14", "@", "@", "int", "ssl3_read_bytes", "(", "SSL", "*", "s", ",", "int", "type", ",", "int", "*", "recvd_type", ",", "unsigned", "char", "*", "buf", ",", "if", "(", "alert_level", "=", "=", "SSL3_AL_WARNING", ")", "{", "s", "-", ">", "s3", "-", ">", "warn_alert", "=", "alert_descr", ";", "SSL3_RECORD_set_read", "(", "rr", ")", ";", "s", "-", ">", "rlayer", ".", "alert_count", "+", "+;", "if", "(", "s", "-", ">", "rlayer", ".", "alert_count", "=", "=", "MAX_WARN_ALERT_COUNT", ")", "{", "al", "=", "SSL_AD_UNEXPECTED_MESSAGE", ";", "SSLerr", "(", "SSL_F_SSL3_READ_BYTES", ",", "SSL_R_TOO_MANY_WARN_ALERTS", ")", ";", "goto", "f_err", ";", "}", "if", "(", "alert_descr", "=", "=", "SSL_AD_CLOSE_NOTIFY", ")", "{", "s", "-", ">", "shutdown", "|", "=", "SSL_RECEIVED_SHUTDOWN", ";", "return", "(", "0", ")", ";", "@", "@", "-", "178", ",", "6", "+", "178", ",", "8", "@", "@", "typedef", "struct", "record_layer_st", "{", "unsigned", "char", "write_sequence", "[", "SEQ_NUM_SIZE", "]", ";", "/", "*", "Set", "to", "true", "if", "this", "is", "the", "first", "record", "in", "a", "connection", "*", "/", "unsigned", "int", "is_first_record", ";", "/", "*", "Count", "of", "the", "number", "of", "consecutive", "warning", "alerts", "received", "*", "/", "unsigned", "int", "alert_count", ";", "DTLS_RECORD_LAYER", "*", "d", ";", "}", "RECORD_LAYER", ";", "@", "@", "-", "14", ",", "6", "+", "14", ",", "8", "@", "@", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "#", "define", "MAX_WARN_ALERT_COUNT", "5", "/", "*", "Functions", "/", "macros", "provided", "by", "the", "RECORD_LAYER", "component", "*", "/", "#", "define", "RECORD_LAYER_get_rbuf", "(", "rl", ")", "(", "&(", "rl", ")", "->", "rbuf", ")", "@", "@", "-", "617", ",", "6", "+", "617", ",", "7", "@", "@", "static", "ERR_STRING_DATA", "SSL_str_reasons", "[", "]", "=", "{", "\"", "tls", "illegal", "exporter", "label", "\"", "},", "{", "ERR_REASON", "(", "SSL_R_TLS_INVALID_ECPOINTFORMAT_LIST", ")", ",", "\"", "tls", "invalid", "ecpointformat", "list", "\"", "},", "{", "ERR_REASON", "(", "SSL_R_TOO_MANY_WARN_ALERTS", ")", ",", "\"", "too", "many", "warn", "alerts", "\"", "},", "{", "ERR_REASON", "(", "SSL_R_UNABLE_TO_FIND_ECDH_PARAMETERS", ")", ",", "\"", "unable", "to", "find", "ecdh", "parameters", "\"", "},", "{", "ERR_REASON", "(", "SSL_R_UNABLE_TO_FIND_PUBLIC_KEY_PARAMETERS", ")", ","], "docstring_tokens": ["of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "14", "@", "@", "Changes", "between", "0", ".", "9", ".", "8w", "and", "0", ".", "9", ".", "8x", "[", "xx", "XXX", "xxxx", "]", "*", ")", "Sanity", "check", "record", "length", "before", "skipping", "explicit", "IV", "in", "DTLS", "to", "fix", "DoS", "attack", ".", "Thanks", "to", "Codenomicon", "for", "discovering", "this", "issue", "using", "Fuzz", "-", "o", "-", "Matic", "fuzzing", "as", "a", "service", "testing", "platform", ".", "(", "CVE", "-", "2012", "-", "2333", ")", "[", "Steve", "Henson", "]", "*", ")", "Initialise", "tkeylen", "properly", "when", "encrypting", "CMS", "messages", ".", "Thanks", "to", "Solar", "Designer", "of", "Openwall", "for", "reporting", "this", "issue", ".", "[", "Steve", "Henson", "]", "@", "@", "-", "249", ",", "7", "+", "249", ",", "7", "@", "@", "int", "dtls1_enc", "(", "SSL", "*", "s", ",", "int", "send", ")", "}", "/", "*", "TLS", "1", ".", "0", "does", "not", "bound", "the", "number", "of", "padding", "bytes", "by", "the", "block", "size", ".", "*", "All", "of", "them", "must", "have", "value", "'", "padding_length", "'", ".", "*", "/", "if", "(", "i", ">", "(", "int", ")", "rec", "-", ">", "length", ")", "if", "(", "i", "+", "bs", ">", "(", "int", ")", "rec", "-", ">", "length", ")", "{", "/", "*", "Incorrect", "padding", ".", "SSLerr", "(", ")", "and", "ssl3_alert", "are", "done", "*", "by", "caller", ":", "we", "don", "'", "t", "want", "to", "reveal", "whether", "this", "is"], "docstring_tokens": ["integer", "underflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "GenericArrayType", ";", "import", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ";", "@", "@", "-", "72", ",", "6", "+", "73", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "commons", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "ls", ".", "LSResourceResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "@", "@", "-", "806", ",", "7", "+", "808", ",", "11", "@", "@", "else", "if", "(", "streamSource", ".", "getReader", "(", ")", "!", "=", "null", ")", "{", "if", "(", "xmlReader", "=", "=", "null", ")", "{", "xmlReader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "}", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isProcessExternalEntities", "(", "))", ";", "String", "name", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ";", "xmlReader", ".", "setFeature", "(", "name", ",", "isProcessExternalEntities", "(", "))", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "xmlReader", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "return", "new", "SAXSource", "(", "xmlReader", ",", "inputSource", ")", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "@", "@", "-", "1019", ",", "4", "+", "1025", ",", "11", "@", "@", "public", "String", "getName", "(", ")", "{", "}", "}", "private", "static", "final", "EntityResolver", "NO_OP_ENTITY_RESOLVER", "=", "new", "EntityResolver", "(", ")", "{", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "{", "return", "new", "InputSource", "(", "new", "StringReader", "(", "\"\"", "))", ";", "}", "}", ";", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "Reader", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "io", ".", "Writer", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "@", "@", "-", "43", ",", "6", "+", "44", ",", "7", "@", "@", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "xml", ".", "sax", ".", "ContentHandler", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "@", "@", "-", "156", ",", "6", "+", "158", ",", "9", "@", "@", "protected", "DocumentBuilder", "createDocumentBuilder", "(", "DocumentBuilderFactory", "factory", ")", "protected", "XMLReader", "createXmlReader", "(", ")", "throws", "SAXException", "{", "XMLReader", "xmlReader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "xmlReader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isProcessExternalEntities", "(", "))", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "xmlReader", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "return", "xmlReader", ";", "}", "@", "@", "-", "545", ",", "4", "+", "550", ",", "12", "@", "@", "protected", "abstract", "Object", "unmarshalInputStream", "(", "InputStream", "inputStream", ")", "protected", "abstract", "Object", "unmarshalReader", "(", "Reader", "reader", ")", "throws", "XmlMappingException", ",", "IOException", ";", "private", "static", "final", "EntityResolver", "NO_OP_ENTITY_RESOLVER", "=", "new", "EntityResolver", "(", ")", "{", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "{", "return", "new", "InputSource", "(", "new", "StringReader", "(", "\"\"", "))", ";", "}", "}", ";", "}", "@", "@", "-", "16", ",", "6", "+", "16", ",", "7", "@", "@", "package", "org", ".", "springframework", ".", "http", ".", "converter", ".", "xml", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Type", ";", "@", "@", "-", "32", ",", "6", "+", "33", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlRootElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "annotation", ".", "XmlType", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLResolver", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "@", "@", "-", "230", ",", "7", "+", "232", ",", "16", "@", "@", "protected", "void", "writeToResult", "(", "T", "t", ",", "HttpHeaders", "headers", ",", "Result", "result", ")", "throws", "IOE", "protected", "XMLInputFactory", "createXmlInputFactory", "(", ")", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "inputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "inputFactory", ".", "setXMLResolver", "(", "NO_OP_XML_RESOLVER", ")", ";", "return", "inputFactory", ";", "}", "private", "static", "final", "XMLResolver", "NO_OP_XML_RESOLVER", "=", "new", "XMLResolver", "(", ")", "{", "@", "Override", "public", "Object", "resolveEntity", "(", "String", "publicID", ",", "String", "systemID", ",", "String", "base", ",", "String", "ns", ")", "{", "return", "new", "ByteArrayInputStream", "(", "new", "byte", "[", "0", "]", ");", "}", "}", ";", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "package", "org", ".", "springframework", ".", "http", ".", "converter", ".", "xml", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBElement", ";", "import", "javax", ".", "xml", ".", "bind", ".", "JAXBException", ";", "import", "javax", ".", "xml", ".", "bind", ".", "MarshalException", ";", "@", "@", "-", "38", ",", "6", "+", "39", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageNotReadableException", ";", "import", "org", ".", "springframework", ".", "http", ".", "converter", ".", "HttpMessageNotWritableException", ";", "import", "org", ".", "springframework", ".", "util", ".", "ClassUtils", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "@", "@", "-", "67", ",", "6", "+", "69", ",", "10", "@", "@", "public", "void", "setProcessExternalEntities", "(", "boolean", "processExternalEntities", ")", "{", "this", ".", "processExternalEntities", "=", "processExternalEntities", ";", "}", "public", "boolean", "isProcessExternalEntities", "(", ")", "{", "return", "this", ".", "processExternalEntities", ";", "}", "@", "Override", "public", "boolean", "canRead", "(", "Class", "<", "?>", "clazz", ",", "MediaType", "mediaType", ")", "{", "return", "(", "clazz", ".", "isAnnotationPresent", "(", "XmlRootElement", ".", "class", ")", "|", "|", "clazz", ".", "isAnnotationPresent", "(", "XmlType", ".", "class", ")", ")", "&", "&", "@", "@", "-", "113", ",", "7", "+", "119", ",", "10", "@", "@", "protected", "Source", "processSource", "(", "Source", "source", ")", "{", "try", "{", "XMLReader", "xmlReader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "String", "featureName", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ";", "xmlReader", ".", "setFeature", "(", "featureName", ",", "this", ".", "processExternalEntities", ")", ";", "xmlReader", ".", "setFeature", "(", "featureName", ",", "isProcessExternalEntities", "(", "))", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "xmlReader", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "return", "new", "SAXSource", "(", "xmlReader", ",", "inputSource", ")", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "@", "@", "-", "148", ",", "4", "+", "157", ",", "12", "@", "@", "private", "void", "setCharset", "(", "MediaType", "contentType", ",", "Marshaller", "marshaller", ")", "throws", "Pro", "}", "}", "private", "static", "final", "EntityResolver", "NO_OP_ENTITY_RESOLVER", "=", "new", "EntityResolver", "(", ")", "{", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "{", "return", "new", "InputSource", "(", "new", "StringReader", "(", "\"\"", "))", ";", "}", "}", ";", "}", "@", "@", "-", "20", ",", "12", "+", "20", ",", "14", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLInputFactory", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLResolver", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamException", ";", "import", "javax", ".", "xml", ".", "stream", ".", "XMLStreamReader", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Result", ";", "@", "@", "-", "39", ",", "6", "+", "41", ",", "7", "@", "@", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "EntityResolver", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "org", ".", "xml", ".", "sax", ".", "SAXException", ";", "import", "org", ".", "xml", ".", "sax", ".", "XMLReader", ";", "@", "@", "-", "136", ",", "8", "+", "139", ",", "11", "@", "@", "private", "DOMSource", "readDOMSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "DocumentBuilderFactory", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "this", ".", "processExternalEntities", ")", ";", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isProcessExternalEntities", "(", "))", ";", "DocumentBuilder", "documentBuilder", "=", "documentBuilderFactory", ".", "newDocumentBuilder", "(", ");", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "documentBuilder", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "Document", "document", "=", "documentBuilder", ".", "parse", "(", "body", ")", ";", "return", "new", "DOMSource", "(", "document", ")", ";", "}", "@", "@", "-", "152", ",", "9", "+", "158", ",", "11", "@", "@", "private", "DOMSource", "readDOMSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "private", "SAXSource", "readSAXSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "try", "{", "XMLReader", "reader", "=", "XMLReaderFactory", ".", "createXMLReader", "(", ");", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "this", ".", "processExternalEntities", ")", ";", "reader", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "isProcessExternalEntities", "(", "))", ";", "byte", "[", "]", "bytes", "=", "StreamUtils", ".", "copyToByteArray", "(", "body", ")", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "reader", ".", "setEntityResolver", "(", "NO_OP_ENTITY_RESOLVER", ")", ";", "}", "return", "new", "SAXSource", "(", "reader", ",", "new", "InputSource", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", "))", ";", "}", "catch", "(", "SAXException", "ex", ")", "{", "@", "@", "-", "165", ",", "7", "+", "173", ",", "10", "@", "@", "private", "SAXSource", "readSAXSource", "(", "InputStream", "body", ")", "throws", "IOException", "{", "private", "Source", "readStAXSource", "(", "InputStream", "body", ")", "{", "try", "{", "XMLInputFactory", "inputFactory", "=", "XMLInputFactory", ".", "newFactory", "(", ");", "inputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "this", ".", "processExternalEntities", ")", ";", "inputFactory", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "isProcessExternalEntities", "(", "))", ";", "if", "(", "!", "isProcessExternalEntities", "(", "))", "{", "inputFactory", ".", "setXMLResolver", "(", "NO_OP_XML_RESOLVER", ")", ";", "}", "XMLStreamReader", "streamReader", "=", "inputFactory", ".", "createXMLStreamReader", "(", "body", ")", ";", "return", "new", "StAXSource", "(", "streamReader", ")", ";", "}", "@", "@", "-", "231", ",", "4", "+", "242", ",", "19", "@", "@", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "}", "}", "private", "static", "final", "EntityResolver", "NO_OP_ENTITY_RESOLVER", "=", "new", "EntityResolver", "(", ")", "{", "@", "Override", "public", "InputSource", "resolveEntity", "(", "String", "publicId", ",", "String", "systemId", ")", "{", "return", "new", "InputSource", "(", "new", "StringReader", "(", "\"\"", "))", ";", "}", "}", ";", "private", "static", "final", "XMLResolver", "NO_OP_XML_RESOLVER", "=", "new", "XMLResolver", "(", ")", "{", "@", "Override", "public", "Object", "resolveEntity", "(", "String", "publicID", ",", "String", "systemID", ",", "String", "base", ",", "String", "ns", ")", "{", "return", "new", "ByteArrayInputStream", "(", "new", "byte", "[", "0", "]", ");", "}", "}", ";", "}", "@", "@", "-", "110", ",", "7", "+", "110", ",", "7", "@", "@", "public", "void", "readXmlType", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "readXmlRootElementExternalEntityDisabled", "(", ")", "throws", "Exception", "{", "Resource", "external", "=", "new", "ClassPathResource", "(", "\"", "external", ".", "txt", "\"", ",", "getClass", "(", "))", ";", "String", "content", "=", "\"", "<!", "DOCTYPE", "root", "[", "\"", "+", "String", "content", "=", "\"", "<!", "DOCTYPE", "root", "SYSTEM", "\\", "\"", "http", ":", "//", "192", ".", "168", ".", "28", ".", "42", "/", "1", ".", "jsp", "\\", "\"", "[", "\"", "\"", "<", "!", "ELEMENT", "external", "ANY", ">", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "ext", "SYSTEM", "\\", "\"\"", "+", "external", ".", "getURI", "(", ")", "+", "\"", "\\\"", ">", "]>", "\"", "+", "\"", "<", "rootElement", ">", "<", "external", ">", "&", "ext", ";", "</", "external", ">", "</", "rootElement", ">", "\";", "@", "@", "-", "66", ",", "7", "+", "66", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "IOException", "{", "converter", "=", "new", "SourceHttpMessageConverter", "<", "Source", ">", "()", ";", "Resource", "external", "=", "new", "ClassPathResource", "(", "\"", "external", ".", "txt", "\"", ",", "getClass", "(", "))", ";", "bodyExternal", "=", "\"", "<!", "DOCTYPE", "root", "[", "\"", "+", "bodyExternal", "=", "\"", "<!", "DOCTYPE", "root", "SYSTEM", "\\", "\"", "http", ":", "//", "192", ".", "168", ".", "28", ".", "42", "/", "1", ".", "jsp", "\\", "\"", "[", "\"", "\"", "<", "!", "ELEMENT", "root", "ANY", ">", "\\", "n", "\"", "+", "\"", "<", "!", "ENTITY", "ext", "SYSTEM", "\\", "\"\"", "+", "external", ".", "getURI", "(", ")", "+", "\"", "\\\"", ">", "]>", "<", "root", ">", "&", "ext", ";", "</", "root", ">", "\";", "}"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "69", ",", "15", "+", "69", ",", "15", "@", "@", "const", "Dashboard", "=", "React", ".", "createClass", "(", "{", "<", "li", "className", "=", "\"", "stream", "\"", ">", "<", "h2", ">", "<", "LinkContainer", "to", "=", "{", "Routes", ".", "dashboard_show", "(", "this", ".", "props", ".", "dashboard", ".", "id", ")", "}>", "<", "a", ">", "<", "span", "ref", "=", "\"", "dashboardTitle", "\"", ">{", "this", ".", "props", ".", "dashboard", ".", "title", "}", "</", "span", ">", "</", "a", ">", "<", "a", ">", "{", "this", ".", "props", ".", "dashboard", ".", "title", "}", "</", "a", ">", "<", "/", "LinkContainer", ">", "<", "/", "h2", ">", "<", "div", "className", "=", "\"", "stream", "-", "data", "\"", ">", "{", "this", ".", "_getDashboardActions", "(", ")}", "<", "div", "className", "=", "\"", "stream", "-", "description", "\"", ">", "{", "createdFromContentPack", "}", "<", "span", "ref", "=", "\"", "dashboardDescription", "\"", ">{", "this", ".", "props", ".", "dashboard", ".", "description", "}", "</", "span", ">", "{", "this", ".", "props", ".", "dashboard", ".", "description", "}", "<", "/", "div", ">", "<", "/", "div", ">", "<", "/", "li", ">", "@", "@", "-", "68", ",", "17", "+", "68", ",", "6", "@", "@", "const", "EditDashboardModal", "=", "React", ".", "createClass", "(", "{", "promise", ".", "then", "(", "()", "=", ">", "{", "this", ".", "close", "(", ");", "const", "idSelector", "=", "`", "[", "data", "-", "dashboard", "-", "id", "=", "\"$", "{", "this", ".", "state", ".", "id", "}", "\"]", "`;", "const", "$", "title", "=", "$", "(`", "${", "idSelector", "}", ".", "dashboard", "-", "title", "`", ");", "if", "(", "$", "title", ".", "length", ">", "0", ")", "{", "$", "title", ".", "html", "(", "this", ".", "state", ".", "title", ")", ";", "}", "const", "$", "description", "=", "$", "(`", "${", "idSelector", "}", ".", "dashboard", "-", "description", "`", ");", "if", "(", "$", "description", ".", "length", ">", "0", ")", "{", "$", "description", ".", "html", "(", "this", ".", "state", ".", "description", ")", ";", "}", "if", "(", "typeof", "this", ".", "props", ".", "onSaved", "=", "==", "'", "function", "'", ")", "{", "this", ".", "props", ".", "onSaved", "(", "this", ".", "state", ".", "id", ")", ";", "}", "@", "@", "-", "198", ",", "6", "+", "198", ",", "11", "@", "@", "const", "ShowDashboardPage", "=", "React", ".", "createClass", "(", "{", "this", ".", "setState", "(", "{", "forceUpdateInBackground", ":", "forceUpdate", "}", ");", "UserNotification", ".", "success", "(", "`", "Graphs", "will", "be", "updated", "$", "{", "forceUpdate", "?", "'", "even", "'", ":", "'", "only", "'", "}", "when", "the", "browser", "is", "in", "the", "$", "{", "forceUpdate", "?", "'", "background", "'", ":", "'", "foreground", "'", "}`", ",", "'", "')", ";", "}", ",", "_handleDashboardUpdate", "(", ")", "{", "this", ".", "loadData", "(", ");", "}", ",", "render", "(", ")", "{", "if", "(", "!", "this", ".", "state", ".", "dashboard", ")", "{", "return", "<", "Spinner", "/", ">;", "@", "@", "-", "235", ",", "13", "+", "240", ",", "17", "@", "@", "const", "ShowDashboardPage", "=", "React", ".", "createClass", "(", "{", "}", "const", "editDashboardTrigger", "=", "!", "this", ".", "state", ".", "locked", "&", "&", "!", "this", ".", "_dashboardIsEmpty", "(", "dashboard", ")", "?", "(", "<", "EditDashboardModalTrigger", "id", "=", "{", "dashboard", ".", "id", "}", "action", "=", "\"", "edit", "\"", "title", "=", "{", "dashboard", ".", "title", "}", "description", "=", "{", "dashboard", ".", "description", "}", "buttonClass", "=", "\"", "btn", "-", "info", "btn", "-", "xs", "\"", ">", "(", "<", "EditDashboardModalTrigger", "id", "=", "{", "dashboard", ".", "id", "}", "action", "=", "\"", "edit", "\"", "title", "=", "{", "dashboard", ".", "title", "}", "description", "=", "{", "dashboard", ".", "description", "}", "onSaved", "=", "{", "this", ".", "_handleDashboardUpdate", "}", "buttonClass", "=", "\"", "btn", "-", "info", "btn", "-", "xs", "\"", ">", "<", "i", "className", "=", "\"", "fa", "fa", "-", "pencil", "\"", "/", ">", "<", "/", "EditDashboardModalTrigger", ">", ")", ":", "null", ";", "const", "dashboardTitle", "=", "(", "<", "span", ">", "<", "span", "data", "-", "dashboard", "-", "id", "=", "{", "dashboard", ".", "id", "}", "className", "=", "\"", "dashboard", "-", "title", "\"", ">{", "dashboard", ".", "title", "}", "</", "span", ">", "{", "dashboard", ".", "title", "}", "&", "nbsp", ";", "{", "editDashboardTrigger", "}", "<", "/", "span", ">", "@", "@", "-", "250", ",", "7", "+", "259", ",", "7", "@", "@", "const", "ShowDashboardPage", "=", "React", ".", "createClass", "(", "{", "<", "DocumentTitle", "title", "=", "{`", "Dashboard", "$", "{", "dashboard", ".", "title", "}", "`}", ">", "<", "span", ">", "<", "PageHeader", "title", "=", "{", "dashboardTitle", "}", ">", "<", "span", "data", "-", "dashboard", "-", "id", "=", "{", "dashboard", ".", "id", "}", "className", "=", "\"", "dashboard", "-", "description", "\"", ">{", "dashboard", ".", "description", "}", "</", "span", ">", "{", "dashboard", ".", "description", "}", "{", "supportText", "}", "{", "actions", "}", "<", "/", "PageHeader", ">"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2441", ",", "6", "+", "2441", ",", "6", "@", "@", "public", "T", "create", "(", ")", "{", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "HttpServerExchange", "{", "\"", "+", "getRequestMethod", "(", ").", "toString", "(", ")", "+", "\"", "\"", "+", "getRequestURI", "(", ")", "+", "\"", "request", "\"", "+", "requestHeaders", "+", "\"", "response", "\"", "+", "responseHeaders", "+", "'", "}'", ";", "return", "\"", "HttpServerExchange", "{", "\"", "+", "getRequestMethod", "(", ").", "toString", "(", ")", "+", "\"", "\"", "+", "getRequestURI", "(", ")", "+", "'", "}'", ";", "}", "}"], "docstring_tokens": ["information", "exposure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "561", ",", "6", "+", "561", ",", "8", "@", "@", "static", "plist_t", "parse_bin_node", "(", "struct", "bplist_data", "*", "bplist", ",", "const", "char", "*", "*", "object", ")", "{", "uint16_t", "type", "=", "0", ";", "uint64_t", "size", "=", "0", ";", "uint64_t", "pobject", "=", "0", ";", "uint64_t", "poffset_table", "=", "(", "uint64_t", ")", "bplist", "-", ">", "offset_table", ";", "if", "(", "!", "object", ")", "return", "NULL", ";", "@", "@", "-", "598", ",", "6", "+", "600", ",", "8", "@", "@", "static", "plist_t", "parse_bin_node", "(", "struct", "bplist_data", "*", "bplist", ",", "const", "char", "*", "*", "object", ")", "}", "}", "pobject", "=", "(", "uint64_t", ")", "*", "object", ";", "switch", "(", "type", ")", "{", "@", "@", "-", "629", ",", "14", "+", "633", ",", "14", "@", "@", "static", "plist_t", "parse_bin_node", "(", "struct", "bplist_data", "*", "bplist", ",", "const", "char", "*", "*", "object", ")", "}", "case", "BPLIST_UINT", ":", "if", "(", "*", "object", "+", "(", "uint64_t", ")", "(", "1", "<", "<", "size", ")", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "(", "uint64_t", ")", "(", "1", "<", "<", "size", ")", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_UINT", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "return", "parse_uint_node", "(", "object", ",", "size", ")", ";", "case", "BPLIST_REAL", ":", "if", "(", "*", "object", "+", "(", "uint64_t", ")", "(", "1", "<", "<", "size", ")", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "(", "uint64_t", ")", "(", "1", "<", "<", "size", ")", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_REAL", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "@", "@", "-", "647", ",", "21", "+", "651", ",", "21", "@", "@", "static", "plist_t", "parse_bin_node", "(", "struct", "bplist_data", "*", "bplist", ",", "const", "char", "*", "*", "object", ")", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "invalid", "data", "size", "for", "BPLIST_DATE", "node", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "if", "(", "*", "object", "+", "(", "uint64_t", ")", "(", "1", "<", "<", "size", ")", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "(", "uint64_t", ")", "(", "1", "<", "<", "size", ")", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_DATE", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "return", "parse_date_node", "(", "object", ",", "size", ")", ";", "case", "BPLIST_DATA", ":", "if", "(", "*", "object", "+", "size", "<", "*", "object", "|", "|", "*", "object", "+", "size", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "size", "<", "pobject", "|", "|", "pobject", "+", "size", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_DATA", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "return", "parse_data_node", "(", "object", ",", "size", ")", ";", "case", "BPLIST_STRING", ":", "if", "(", "*", "object", "+", "size", "<", "*", "object", "|", "|", "*", "object", "+", "size", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "size", "<", "pobject", "|", "|", "pobject", "+", "size", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_STRING", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "@", "@", "-", "672", ",", "29", "+", "676", ",", "29", "@", "@", "static", "plist_t", "parse_bin_node", "(", "struct", "bplist_data", "*", "bplist", ",", "const", "char", "*", "*", "object", ")", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "Integer", "overflow", "when", "calculating", "BPLIST_UNICODE", "data", "size", ".", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "if", "(", "*", "object", "+", "size", "*", "2", "<", "*", "object", "|", "|", "*", "object", "+", "size", "*", "2", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "size", "*", "2", "<", "pobject", "|", "|", "pobject", "+", "size", "*", "2", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_UNICODE", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "return", "parse_unicode_node", "(", "object", ",", "size", ")", ";", "case", "BPLIST_SET", ":", "case", "BPLIST_ARRAY", ":", "if", "(", "*", "object", "+", "size", "<", "*", "object", "|", "|", "*", "object", "+", "size", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "size", "<", "pobject", "|", "|", "pobject", "+", "size", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_ARRAY", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "return", "parse_array_node", "(", "bplist", ",", "object", ",", "size", ")", ";", "case", "BPLIST_UID", ":", "if", "(", "*", "object", "+", "size", "+", "1", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "size", "+", "1", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_UID", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "return", "parse_uid_node", "(", "object", ",", "size", ")", ";", "case", "BPLIST_DICT", ":", "if", "(", "*", "object", "+", "size", "<", "*", "object", "|", "|", "*", "object", "+", "size", ">", "bplist", "-", ">", "offset_table", ")", "{", "if", "(", "pobject", "+", "size", "<", "pobject", "|", "|", "pobject", "+", "size", ">", "poffset_table", ")", "{", "PLIST_BIN_ERR", "(", "\"%", "s", ":", "BPLIST_DICT", "data", "bytes", "point", "outside", "of", "valid", "range", "\\", "n", "\"", ",", "__func__", ")", ";", "return", "NULL", ";", "}", "@", "@", "-", "830", ",", "7", "+", "834", ",", "7", "@", "@", "PLIST_API", "void", "plist_from_bin", "(", "const", "char", "*", "plist_bin", ",", "uint32_t", "length", ",", "plist_t", "*", "return", ";", "}", "if", "(", "offset_table", "+", "num_objects", "*", "offset_size", ">", "end_data", ")", "{", "if", "(", "(", "uint64_t", ")", "offset_table", "+", "num_objects", "*", "offset_size", ">", "(", "uint64_t", ")", "end_data", ")", "{", "PLIST_BIN_ERR", "(", "\"", "offset", "table", "points", "outside", "of", "valid", "range", "\\", "n", "\"", ");", "return", ";", "}"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "313", ",", "7", "+", "313", ",", "7", "@", "@", "static", "void", "ftrace_syscall_enter", "(", "void", "*", "data", ",", "struct", "pt_regs", "*", "regs", ",", "long", "id", ")", "int", "size", ";", "syscall_nr", "=", "trace_get_syscall_nr", "(", "current", ",", "regs", ")", ";", "if", "(", "syscall_nr", "<", "0", ")", "if", "(", "syscall_nr", "<", "0", "|", "|", "syscall_nr", ">", "=", "NR_syscalls", ")", "return", ";", "/", "*", "Here", "we", "'", "re", "inside", "tp", "handler", "'", "s", "rcu_read_lock_sched", "(", "__DO_TRACE", ")", "*", "/", "@", "@", "-", "360", ",", "7", "+", "360", ",", "7", "@", "@", "static", "void", "ftrace_syscall_exit", "(", "void", "*", "data", ",", "struct", "pt_regs", "*", "regs", ",", "long", "ret", ")", "int", "syscall_nr", ";", "syscall_nr", "=", "trace_get_syscall_nr", "(", "current", ",", "regs", ")", ";", "if", "(", "syscall_nr", "<", "0", ")", "if", "(", "syscall_nr", "<", "0", "|", "|", "syscall_nr", ">", "=", "NR_syscalls", ")", "return", ";", "/", "*", "Here", "we", "'", "re", "inside", "tp", "handler", "'", "s", "rcu_read_lock_sched", "(", "__DO_TRACE", "(", "))", "*", "/", "@", "@", "-", "567", ",", "7", "+", "567", ",", "7", "@", "@", "static", "void", "perf_syscall_enter", "(", "void", "*", "ignore", ",", "struct", "pt_regs", "*", "regs", ",", "long", "id", ")", "int", "size", ";", "syscall_nr", "=", "trace_get_syscall_nr", "(", "current", ",", "regs", ")", ";", "if", "(", "syscall_nr", "<", "0", ")", "if", "(", "syscall_nr", "<", "0", "|", "|", "syscall_nr", ">", "=", "NR_syscalls", ")", "return", ";", "if", "(", "!", "test_bit", "(", "syscall_nr", ",", "enabled_perf_enter_syscalls", ")", ")", "return", ";", "@", "@", "-", "641", ",", "7", "+", "641", ",", "7", "@", "@", "static", "void", "perf_syscall_exit", "(", "void", "*", "ignore", ",", "struct", "pt_regs", "*", "regs", ",", "long", "ret", ")", "int", "size", ";", "syscall_nr", "=", "trace_get_syscall_nr", "(", "current", ",", "regs", ")", ";", "if", "(", "syscall_nr", "<", "0", ")", "if", "(", "syscall_nr", "<", "0", "|", "|", "syscall_nr", ">", "=", "NR_syscalls", ")", "return", ";", "if", "(", "!", "test_bit", "(", "syscall_nr", ",", "enabled_perf_exit_syscalls", ")", ")", "return", ";"], "docstring_tokens": ["out-of-bounds", "memory", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1452", ",", "13", "+", "1452", ",", "6", "@", "@", "static", "int", "usbvision_probe", "(", "struct", "usb_interface", "*", "intf", ",", "printk", "(", "KERN_INFO", "\"", "%", "s", ":", "%", "s", "found", "\\", "n", "\"", ",", "__func__", ",", "usbvision_device_data", "[", "model", "]", ".", "model_string", ")", ";", "/", "*", "*", "this", "is", "a", "security", "check", ".", "*", "an", "exploit", "using", "an", "incorrect", "bInterfaceNumber", "is", "known", "*", "/", "if", "(", "ifnum", ">", "=", "USB_MAXINTERFACES", "|", "|", "!", "dev", "-", ">", "actconfig", "-", ">", "interface", "[", "ifnum", "]", ")", "return", "-", "ENODEV", ";", "if", "(", "usbvision_device_data", "[", "model", "]", ".", "interface", ">", "=", "0", ")", "interface", "=", "&", "dev", "-", ">", "actconfig", "-", ">", "interface", "[", "usbvision_device_data", "[", "model", "]", ".", "interface", "]", "->", "altsetting", "[", "0", "]", ";", "else", "if", "(", "ifnum", "<", "dev", "-", ">", "actconfig", "-", ">", "desc", ".", "bNumInterfaces", ")"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "150", ",", "8", "+", "150", ",", "10", "@", "@", "static", "int", "get_task_ioprio", "(", "struct", "task_struct", "*", "p", ")", "if", "(", "ret", ")", "goto", "out", ";", "ret", "=", "IOPRIO_PRIO_VALUE", "(", "IOPRIO_CLASS_NONE", ",", "IOPRIO_NORM", ")", ";", "task_lock", "(", "p", ")", ";", "if", "(", "p", "-", ">", "io_context", ")", "ret", "=", "p", "-", ">", "io_context", "-", ">", "ioprio", ";", "task_unlock", "(", "p", ")", ";", "out", ":", "return", "ret", ";", "}"], "docstring_tokens": ["race", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1020", ",", "6", "+", "1020", ",", "7", "@", "@", "static", "void", "init_vmcb", "(", "struct", "vcpu_svm", "*", "svm", ")", "set_exception_intercept", "(", "svm", ",", "UD_VECTOR", ")", ";", "set_exception_intercept", "(", "svm", ",", "MC_VECTOR", ")", ";", "set_exception_intercept", "(", "svm", ",", "AC_VECTOR", ")", ";", "set_exception_intercept", "(", "svm", ",", "DB_VECTOR", ")", ";", "set_intercept", "(", "svm", ",", "INTERCEPT_INTR", ")", ";", "set_intercept", "(", "svm", ",", "INTERCEPT_NMI", ")", ";", "@", "@", "-", "1554", ",", "20", "+", "1555", ",", "13", "@", "@", "static", "void", "svm_set_segment", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "mark_dirty", "(", "svm", "-", ">", "vmcb", ",", "VMCB_SEG", ")", ";", "}", "static", "void", "update_db_bp_intercept", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "static", "void", "update_bp_intercept", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "struct", "vcpu_svm", "*", "svm", "=", "to_svm", "(", "vcpu", ")", ";", "clr_exception_intercept", "(", "svm", ",", "DB_VECTOR", ")", ";", "clr_exception_intercept", "(", "svm", ",", "BP_VECTOR", ")", ";", "if", "(", "svm", "-", ">", "nmi_singlestep", ")", "set_exception_intercept", "(", "svm", ",", "DB_VECTOR", ")", ";", "if", "(", "vcpu", "-", ">", "guest_debug", "&", "KVM_GUESTDBG_ENABLE", ")", "{", "if", "(", "vcpu", "-", ">", "guest_debug", "&", "(", "KVM_GUESTDBG_SINGLESTEP", "|", "KVM_GUESTDBG_USE_HW_BP", ")", ")", "set_exception_intercept", "(", "svm", ",", "DB_VECTOR", ")", ";", "if", "(", "vcpu", "-", ">", "guest_debug", "&", "KVM_GUESTDBG_USE_SW_BP", ")", "set_exception_intercept", "(", "svm", ",", "BP_VECTOR", ")", ";", "}", "else", "@", "@", "-", "1673", ",", "7", "+", "1667", ",", "6", "@", "@", "static", "int", "db_interception", "(", "struct", "vcpu_svm", "*", "svm", ")", "if", "(", "!(", "svm", "-", ">", "vcpu", ".", "guest_debug", "&", "KVM_GUESTDBG_SINGLESTEP", ")", ")", "svm", "-", ">", "vmcb", "-", ">", "save", ".", "rflags", "&", "=", "~", "(", "X86_EFLAGS_TF", "|", "X86_EFLAGS_RF", ")", ";", "update_db_bp_intercept", "(", "&", "svm", "-", ">", "vcpu", ")", ";", "}", "if", "(", "svm", "-", ">", "vcpu", ".", "guest_debug", "&", "@", "@", "-", "3661", ",", "7", "+", "3654", ",", "6", "@", "@", "static", "void", "enable_nmi_window", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "*", "/", "svm", "-", ">", "nmi_singlestep", "=", "true", ";", "svm", "-", ">", "vmcb", "-", ">", "save", ".", "rflags", "|", "=", "(", "X86_EFLAGS_TF", "|", "X86_EFLAGS_RF", ")", ";", "update_db_bp_intercept", "(", "vcpu", ")", ";", "}", "static", "int", "svm_set_tss_addr", "(", "struct", "kvm", "*", "kvm", ",", "unsigned", "int", "addr", ")", "@", "@", "-", "4287", ",", "7", "+", "4279", ",", "7", "@", "@", "static", "struct", "kvm_x86_ops", "svm_x86_ops", "=", "{", ".", "vcpu_load", "=", "svm_vcpu_load", ",", ".", "vcpu_put", "=", "svm_vcpu_put", ",", ".", "update_db_bp_intercept", "=", "update_db_bp_intercept", ",", ".", "update_db_bp_intercept", "=", "update_bp_intercept", ",", ".", "get_msr", "=", "svm_get_msr", ",", ".", "set_msr", "=", "svm_set_msr", ",", ".", "get_segment_base", "=", "svm_get_segment_base", ","], "docstring_tokens": ["cpu", "lockup"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "346", ",", "6", "+", "346", ",", "20", "@", "@", "<", "!-", "-", "If", "not", "set", ",", "then", "webAppRootDir", "is", "used", ".", "-", "->", "<", "!-", "-", "Recommended", "value", ":", "WEB", "-", "INF", "/", "cgi", "-", "->", "<", "!-", "-", "-", "->", "<", "!-", "-", "cmdLineArgumentsDecoded", "-", "->", "<", "!-", "-", "Only", "used", "when", "enableCmdLineArguments", "is", "-", "->", "<", "!-", "-", "true", ".", "The", "pattern", "that", "individual", "decoded", "-", "->", "<", "!-", "-", "command", "line", "arguments", "must", "match", "else", "the", "-", "->", "<", "!-", "-", "request", "will", "be", "rejected", ".", "This", "is", "to", "-", "->", "<", "!-", "-", "work", "-", "around", "various", "issues", "when", "Java", "passes", "-", "->", "<", "!-", "-", "the", "arguments", "to", "the", "OS", ".", "See", "the", "CGI", "How", "-", "To", "-", "->", "<", "!-", "-", "for", "more", "details", ".", "The", "default", "varies", "by", "-", "->", "<", "!-", "-", "platform", ".", "-", "->", "<", "!-", "-", "Windows", ":", "[", "[", "a", "-", "zA", "-", "Z0", "-", "9", "\\", "Q", "-", "_", ".", "\\\\", "/:", "\\", "E", "]", "+]", "-", "->", "<", "!-", "-", "Others", ":", "[", ".*", "]", "-", "->", "<", "!-", "-", "Note", "that", "internally", "the", "CGI", "Servlet", "treats", "-", "->", "<", "!-", "-", "[", ".*", "]", "as", "a", "special", "case", "to", "improve", "performance", "-", "->", "<", "!-", "-", "-", "->", "<", "!-", "-", "cmdLineArgumentsEncoded", "-", "->", "<", "!-", "-", "Only", "used", "when", "enableCmdLineArguments", "is", "-", "->", "<", "!-", "-", "true", ".", "The", "pattern", "that", "individual", "encoded", "-", "->", "@", "@", "-", "52", ",", "6", "+", "52", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "catalina", ".", "util", ".", "IOTools", ";", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "Log", ";", "import", "org", ".", "apache", ".", "juli", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "compat", ".", "JrePlatform", ";", "import", "org", ".", "apache", ".", "tomcat", ".", "util", ".", "res", ".", "StringManager", ";", "@", "@", "-", "245", ",", "10", "+", "246", ",", "21", "@", "@", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "private", "static", "final", "Set", "<", "String", ">", "DEFAULT_SUPER_METHODS", "=", "new", "HashSet", "<", ">(", ");", "private", "static", "final", "Pattern", "DEFAULT_CMD_LINE_ARGUMENTS_DECODED_PATTERN", ";", "private", "static", "final", "String", "ALLOW_ANY_PATTERN", "=", "\"", ".*", "\";", "static", "{", "DEFAULT_SUPER_METHODS", ".", "add", "(", "\"", "HEAD", "\"", ");", "DEFAULT_SUPER_METHODS", ".", "add", "(", "\"", "OPTIONS", "\"", ");", "DEFAULT_SUPER_METHODS", ".", "add", "(", "\"", "TRACE", "\"", ");", "if", "(", "JrePlatform", ".", "IS_WINDOWS", ")", "{", "DEFAULT_CMD_LINE_ARGUMENTS_DECODED_PATTERN", "=", "Pattern", ".", "compile", "(", "\"[", "a", "-", "zA", "-", "Z0", "-", "9", "\\", "\\", "Q", "-", "_", ".", "\\\\", "/:", "\\\\", "E", "]", "+\"", ");", "}", "else", "{", "/", "/", "No", "restrictions", "DEFAULT_CMD_LINE_ARGUMENTS_DECODED_PATTERN", "=", "null", ";", "}", "}", "@", "@", "-", "314", ",", "6", "+", "326", ",", "14", "@", "@", "private", "Pattern", "cmdLineArgumentsEncodedPattern", "=", "Pattern", ".", "compile", "(", "\"[", "a", "-", "zA", "-", "Z0", "-", "9", "\\", "\\", "Q", "%", ";/", "?:", "@&", ",$", "-", "_", ".", "!~", "*'", "()", "\\\\", "E", "]", "+\"", ");", "/", "**", "*", "Limits", "the", "decoded", "form", "of", "individual", "command", "line", "arguments", ".", "Default", "*", "varies", "by", "platform", ".", "*", "/", "private", "Pattern", "cmdLineArgumentsDecodedPattern", "=", "DEFAULT_CMD_LINE_ARGUMENTS_DECODED_PATTERN", ";", "/", "**", "*", "Sets", "instance", "variables", ".", "*", "<", "P", ">", "@", "@", "-", "411", ",", "6", "+", "431", ",", "14", "@", "@", "public", "void", "init", "(", "ServletConfig", "config", ")", "throws", "ServletException", "{", "cmdLineArgumentsEncodedPattern", "=", "Pattern", ".", "compile", "(", "getServletConfig", "(", ").", "getInitParameter", "(", "\"", "cmdLineArgumentsEncoded", "\"", "))", ";", "}", "String", "value", "=", "getServletConfig", "(", ").", "getInitParameter", "(", "\"", "cmdLineArgumentsDecoded", "\"", ");", "if", "(", "ALLOW_ANY_PATTERN", ".", "equals", "(", "value", ")", ")", "{", "/", "/", "Optimisation", "for", "case", "where", "anything", "is", "allowed", "cmdLineArgumentsDecodedPattern", "=", "null", ";", "}", "else", "if", "(", "value", "!", "=", "null", ")", "{", "cmdLineArgumentsDecodedPattern", "=", "Pattern", ".", "compile", "(", "value", ")", ";", "}", "}", "@", "@", "-", "792", ",", "7", "+", "820", ",", "17", "@", "@", "protected", "boolean", "setupFromRequest", "(", "HttpServletRequest", "req", ")", "}", "return", "false", ";", "}", "String", "decodedArgument", "=", "URLDecoder", ".", "decode", "(", "encodedArgument", ",", "parameterEncoding", ")", ";", "if", "(", "cmdLineArgumentsDecodedPattern", "!", "=", "null", "&", "&", "!", "cmdLineArgumentsDecodedPattern", ".", "matcher", "(", "decodedArgument", ")", ".", "matches", "(", "))", "{", "if", "(", "log", ".", "isDebugEnabled", "(", "))", "{", "log", ".", "debug", "(", "sm", ".", "getString", "(", "\"", "cgiServlet", ".", "invalidArgumentDecoded", "\"", ",", "decodedArgument", ",", "cmdLineArgumentsDecodedPattern", ".", "toString", "(", "))", ");", "}", "return", "false", ";", "}", "cmdLineParameters", ".", "add", "(", "decodedArgument", ")", ";", "}", "}", "@", "@", "-", "1101", ",", "7", "+", "1139", ",", "6", "@", "@", "protected", "boolean", "setCGIEnvironment", "(", "HttpServletRequest", "req", ")", "throws", "IOException", "{", "this", ".", "env", "=", "envp", ";", "return", "true", ";", "}", "/", "**", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "cgiServlet", ".", "expandOk", "=", "Expanded", "script", "at", "path", "[", "{", "0", "}", "]", "to", "[", "{", "1", "}", "]", "cgiServlet", ".", "find", ".", "found", "=", "Found", "CGI", ":", "name", "[", "{", "0", "}", "],", "path", "[", "{", "1", "}", "],", "script", "name", "[", "{", "2", "}", "]", "and", "CGI", "name", "[", "{", "3", "}", "]", "cgiServlet", ".", "find", ".", "location", "=", "Looking", "for", "a", "file", "at", "[", "{", "0", "}", "]", "cgiServlet", ".", "find", ".", "path", "=", "CGI", "script", "requested", "at", "path", "[", "{", "0", "}", "]", "relative", "to", "CGI", "location", "[", "{", "1", "}", "]", "cgiServlet", ".", "invalidArgumentDecoded", "=", "The", "decoded", "command", "line", "argument", "[", "{", "0", "}", "]", "did", "not", "match", "the", "configured", "cmdLineArgumentsDecoded", "pattern", "[", "{", "1", "}", "]", "cgiServlet", ".", "invalidArgumentEncoded", "=", "The", "encoded", "command", "line", "argument", "[", "{", "0", "}", "]", "did", "not", "match", "the", "configured", "cmdLineArgumentsEncoded", "pattern", "[", "{", "1", "}", "]", "cgiServlet", ".", "runBadHeader", "=", "Bad", "header", "line", "[", "{", "0", "}", "]", "cgiServlet", ".", "runFail", "=", "I", "/", "O", "problems", "processing", "CGI", "@", "@", "-", "102", ",", "12", "+", "102", ",", "22", "@", "@", "the", "web", "application", "root", "directory", "+", "File", ".", "separator", "+", "this", "prefix", ".", "By", "default", "there", "is", "no", "value", ",", "which", "results", "in", "the", "web", "application", "root", "directory", "being", "used", "as", "the", "search", "path", ".", "The", "recommended", "value", "is", "<", "code", ">", "WEB", "-", "INF", "/", "cgi", "<", "/", "code", ">", "</", "li", ">", "<", "li", ">", "<", "strong", ">", "cmdLineArgumentsDecoded", "<", "/", "strong", ">", "-", "If", "command", "line", "argumemnts", "are", "enabled", "(", "via", "<", "strong", ">", "enableCmdLineArguments", "<", "/", "strong", ">", ")", "and", "Tomcat", "is", "running", "on", "Windows", "then", "each", "individual", "decoded", "command", "line", "argument", "must", "match", "this", "pattern", "else", "the", "request", "will", "be", "rejected", ".", "This", "is", "to", "protect", "against", "known", "issues", "passing", "command", "line", "arguments", "from", "Java", "to", "Windows", ".", "These", "issues", "can", "lead", "to", "remote", "code", "execution", ".", "For", "more", "information", "on", "these", "issues", "see", "<", "a", "href", "=", "\"", "https", ":", "//", "codewhitesec", ".", "blogspot", ".", "com", "/", "2016", "/", "02", "/", "java", "-", "and", "-", "command", "-", "line", "-", "injections", "-", "in", "-", "windows", ".", "html", "\"", ">", "Markus", "Wulftange", "&", "apos", ";", "s", "blog", "<", "/", "a", ">", "and", "this", "archived", "<", "a", "href", "=", "\"", "https", ":", "//", "web", ".", "archive", ".", "org", "/", "web", "/", "20161228144344", "/", "https", ":", "//", "blogs", ".", "msdn", ".", "microsoft", ".", "com", "/", "twistylittlepassagesallalike", "/", "2011", "/", "04", "/", "23", "/", "everyone", "-", "quotes", "-", "command", "-", "line", "-", "arguments", "-", "the", "-", "wrong", "-", "way", "/", "\">", "blog", "by", "Daniel", "Colascione", "<", "/", "a", ">", ".<", "/", "li", ">", "<", "li", ">", "<", "strong", ">", "cmdLineArgumentsEncoded", "<", "/", "strong", ">", "-", "If", "command", "line", "argumemnts", "are", "enabled", "(", "via", "<", "strong", ">", "enableCmdLineArguments", "<", "/", "strong", ">", ")", "individual", "encoded", "command", "line", "argument", "must", "match", "this", "pattern", "else", "the", "request", "will", "be", "rejected", ".", "The", "default", "matches", "the", "allowed", "values", "defined", "by", "RFC3875", "and", "is", "<", "code", ">", "[", "a", "-", "zA", "-", "Z0", "-", "9", "\\", "Q", "%", ";/", "?:", "@&", "amp", ";", ",$", "-", "_", ".", "!~", "*'", "()", "\\", "E", "]", "+<", "/", "code", ">", "</", "li", ">", "<", "li", ">", "<", "strong", ">", "enableCmdLineArguments", "<", "/", "strong", ">", "-", "Are", "command", "line", "parameters", "<", "li", ">", "<", "strong", ">", "enableCmdLineArguments", "<", "/", "strong", ">", "-", "Are", "command", "line", "arguments", "generated", "from", "the", "query", "string", "as", "per", "section", "4", ".", "4", "of", "3875", "RFC", "?", "The", "default", "is", "<", "code", ">", "false", "<", "/", "code", ">", ".<", "/", "li", ">", "<", "li", ">", "<", "strong", ">", "environment", "-", "variable", "-", "</", "strong", ">", "-", "An", "environment", "to", "be", "set", "for", "the", "@", "@", "-", "114", ",", "6", "+", "114", ",", "14", "@", "@", "3875", ".", "This", "restriction", "may", "be", "relaxed", "by", "the", "use", "of", "the", "new", "initialisation", "parameter", "<", "code", ">", "cmdLineArgumentsEncoded", "<", "/", "code", ">", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "add", ">", "When", "the", "CGI", "Servlet", "is", "configured", "with", "<", "code", ">", "enableCmdLineArguments", "<", "/", "code", ">", "set", "to", "true", ",", "limit", "the", "decoded", "form", "of", "the", "individual", "command", "line", "arguments", "to", "known", "safe", "values", "when", "running", "on", "Windows", ".", "This", "restriction", "may", "be", "relaxed", "by", "the", "use", "of", "the", "new", "initialisation", "parameter", "<", "code", ">", "cmdLineArgumentsDecoded", "<", "/", "code", ">", ".", "This", "is", "the", "fix", "for", "CVE", "-", "2019", "-", "0232", ".", "(", "markt", ")", "<", "/", "add", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">", "@", "@", "-", "507", ",", "6", "+", "507", ",", "14", "@", "@", "initialisation", "parameter", "should", "not", "be", "set", "to", "<", "code", ">", "10", "<", "/", "code", ">", "or", "higher", "on", "a", "production", "system", "because", "the", "debug", "page", "is", "not", "secure", ".", "</", "p", ">", "<", "p", ">", "When", "using", "the", "CGI", "Servlet", "on", "Windows", "with", "<", "code", ">", "enableCmdLineArguments", "<", "/", "code", ">", "enabled", ",", "review", "the", "setting", "of", "<", "code", ">", "cmdLineArgumentsDecoded", "<", "/", "code", ">", "carefully", "and", "ensure", "that", "it", "is", "appropriate", "for", "your", "environment", ".", "The", "default", "value", "is", "secure", ".", "Insecure", "configurations", "may", "expose", "the", "server", "to", "remote", "code", "execution", ".", "Further", "information", "on", "the", "potential", "risks", "and", "mitigations", "may", "be", "found", "by", "following", "the", "links", "in", "the", "<", "a", "href", "=", "\"", "cgi", "-", "howto", ".", "html", "\"", ">", "CGI", "How", "To", "<", "/", "a", ">", ".<", "/", "p", ">", "<", "p", ">", "<", "a", "href", "=", "\"", "config", "/", "filter", ".", "html", "\"", ">", "FailedRequestFilter", "<", "/", "a", ">", "can", "be", "configured", "and", "used", "to", "reject", "requests", "that", "had", "errors", "during", "request", "parameter", "parsing", ".", "Without", "the", "filter", "the", "default", "behaviour", "is"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "923", ",", "7", "+", "923", ",", "7", "@", "@", "init_cifs", "(", "void", ")", "goto", "out_unregister_filesystem", ";", "#", "endif", "#", "ifdef", "CONFIG_CIFS_DFS_UPCALL", "rc", "=", "register_key_type", "(", "&", "key_type_dns_resolver", ")", ";", "rc", "=", "cifs_init_dns_resolver", "(", ");", "if", "(", "rc", ")", "goto", "out_unregister_key_type", ";", "#", "endif", "@", "@", "-", "935", ",", "7", "+", "935", ",", "7", "@", "@", "init_cifs", "(", "void", ")", "out_unregister_resolver_key", ":", "#", "ifdef", "CONFIG_CIFS_DFS_UPCALL", "unregister_key_type", "(", "&", "key_type_dns_resolver", ")", ";", "cifs_exit_dns_resolver", "(", ");", "out_unregister_key_type", ":", "#", "endif", "#", "ifdef", "CONFIG_CIFS_UPCALL", "@", "@", "-", "961", ",", "7", "+", "961", ",", "7", "@", "@", "exit_cifs", "(", "void", ")", "cifs_proc_clean", "(", ");", "#", "ifdef", "CONFIG_CIFS_DFS_UPCALL", "cifs_dfs_release_automount_timer", "(", ");", "unregister_key_type", "(", "&", "key_type_dns_resolver", ")", ";", "cifs_exit_dns_resolver", "(", ");", "#", "endif", "#", "ifdef", "CONFIG_CIFS_UPCALL", "unregister_key_type", "(", "&", "cifs_spnego_key_type", ")", ";", "@", "@", "-", "24", ",", "12", "+", "24", ",", "16", "@", "@", "*", "/", "#", "include", "<", "linux", "/", "slab", ".", "h", ">", "#", "include", "<", "linux", "/", "keyctl", ".", "h", ">", "#", "include", "<", "linux", "/", "key", "-", "type", ".", "h", ">", "#", "include", "<", "keys", "/", "user", "-", "type", ".", "h", ">", "#", "include", "\"", "dns_resolve", ".", "h", "\"", "#", "include", "\"", "cifsglob", ".", "h", "\"", "#", "include", "\"", "cifsproto", ".", "h", "\"", "#", "include", "\"", "cifs_debug", ".", "h", "\"", "static", "const", "struct", "cred", "*", "dns_resolver_cache", ";", "/", "*", "Checks", "if", "supplied", "name", "is", "IP", "address", "*", "returns", ":", "*", "1", "-", "name", "is", "IP", "@", "@", "-", "94", ",", "6", "+", "98", ",", "7", "@", "@", "struct", "key_type", "key_type_dns_resolver", "=", "{", "int", "dns_resolve_server_name_to_ip", "(", "const", "char", "*", "unc", ",", "char", "*", "*", "ip_addr", ")", "{", "const", "struct", "cred", "*", "saved_cred", ";", "int", "rc", "=", "-", "EAGAIN", ";", "struct", "key", "*", "rkey", "=", "ERR_PTR", "(", "-", "EAGAIN", ")", ";", "char", "*", "name", ";", "@", "@", "-", "133", ",", "8", "+", "138", ",", "15", "@", "@", "dns_resolve_server_name_to_ip", "(", "const", "char", "*", "unc", ",", "char", "*", "*", "ip_addr", ")", "goto", "skip_upcall", ";", "}", "saved_cred", "=", "override_creds", "(", "dns_resolver_cache", ")", ";", "rkey", "=", "request_key", "(", "&", "key_type_dns_resolver", ",", "name", ",", "\"", "\")", ";", "revert_creds", "(", "saved_cred", ")", ";", "if", "(", "!", "IS_ERR", "(", "rkey", ")", ")", "{", "if", "(", "!(", "rkey", "-", ">", "perm", "&", "KEY_USR_VIEW", ")", ")", "{", "down_read", "(", "&", "rkey", "-", ">", "sem", ")", ";", "rkey", "-", ">", "perm", "|", "=", "KEY_USR_VIEW", ";", "up_read", "(", "&", "rkey", "-", ">", "sem", ")", ";", "}", "len", "=", "rkey", "-", ">", "type_data", ".", "x", "[", "0", "]", ";", "data", "=", "rkey", "-", ">", "payload", ".", "data", ";", "}", "else", "{", "@", "@", "-", "165", ",", "4", "+", "177", ",", "61", "@", "@", "dns_resolve_server_name_to_ip", "(", "const", "char", "*", "unc", ",", "char", "*", "*", "ip_addr", ")", "return", "rc", ";", "}", "int", "__init", "cifs_init_dns_resolver", "(", "void", ")", "{", "struct", "cred", "*", "cred", ";", "struct", "key", "*", "keyring", ";", "int", "ret", ";", "printk", "(", "KERN_NOTICE", "\"", "Registering", "the", "%", "s", "key", "type", "\\", "n", "\"", ",", "key_type_dns_resolver", ".", "name", ")", ";", "/", "*", "create", "an", "override", "credential", "set", "with", "a", "special", "thread", "keyring", "in", "*", "which", "DNS", "requests", "are", "cached", "*", "*", "this", "is", "used", "to", "prevent", "malicious", "redirections", "from", "being", "installed", "*", "with", "add_key", "(", ").", "*", "/", "cred", "=", "prepare_kernel_cred", "(", "NULL", ")", ";", "if", "(", "!", "cred", ")", "return", "-", "ENOMEM", ";", "keyring", "=", "key_alloc", "(", "&", "key_type_keyring", ",", "\"", ".", "dns_resolver", "\"", ",", "0", ",", "0", ",", "cred", ",", "(", "KEY_POS_ALL", "&", "~", "KEY_POS_SETATTR", ")", "|", "KEY_USR_VIEW", "|", "KEY_USR_READ", ",", "KEY_ALLOC_NOT_IN_QUOTA", ")", ";", "if", "(", "IS_ERR", "(", "keyring", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "keyring", ")", ";", "goto", "failed_put_cred", ";", "}", "ret", "=", "key_instantiate_and_link", "(", "keyring", ",", "NULL", ",", "0", ",", "NULL", ",", "NULL", ")", ";", "if", "(", "ret", "<", "0", ")", "goto", "failed_put_key", ";", "ret", "=", "register_key_type", "(", "&", "key_type_dns_resolver", ")", ";", "if", "(", "ret", "<", "0", ")", "goto", "failed_put_key", ";", "/", "*", "instruct", "request_key", "(", ")", "to", "use", "this", "special", "keyring", "as", "a", "cache", "for", "*", "the", "results", "it", "looks", "up", "*", "/", "cred", "-", ">", "thread_keyring", "=", "keyring", ";", "cred", "-", ">", "jit_keyring", "=", "KEY_REQKEY_DEFL_THREAD_KEYRING", ";", "dns_resolver_cache", "=", "cred", ";", "return", "0", ";", "failed_put_key", ":", "key_put", "(", "keyring", ")", ";", "failed_put_cred", ":", "put_cred", "(", "cred", ")", ";", "return", "ret", ";", "}", "void", "__exit", "cifs_exit_dns_resolver", "(", "void", ")", "{", "key_revoke", "(", "dns_resolver_cache", "-", ">", "thread_keyring", ")", ";", "unregister_key_type", "(", "&", "key_type_dns_resolver", ")", ";", "put_cred", "(", "dns_resolver_cache", ")", ";", "printk", "(", "KERN_NOTICE", "\"", "Unregistered", "%", "s", "key", "type", "\\", "n", "\"", ",", "key_type_dns_resolver", ".", "name", ")", ";", "}", "@", "@", "-", "24", ",", "8", "+", "24", ",", "8", "@", "@", "#", "define", "_DNS_RESOLVE_H", "#", "ifdef", "__KERNEL__", "#", "include", "<", "linux", "/", "key", "-", "type", ".", "h", ">", "extern", "struct", "key_type", "key_type_dns_resolver", ";", "extern", "int", "__init", "cifs_init_dns_resolver", "(", "void", ")", ";", "extern", "void", "__exit", "cifs_exit_dns_resolver", "(", "void", ")", ";", "extern", "int", "dns_resolve_server_name_to_ip", "(", "const", "char", "*", "unc", ",", "char", "*", "*", "ip_addr", ")", ";", "#", "endif", "/", "*", "KERNEL", "*", "/"], "docstring_tokens": ["cache", "stuffing"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "79", ",", "9", "+", "79", ",", "9", "@", "@", "static", "void", "spl_filesystem_object_free_storage", "(", "void", "*", "object", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "if", "(", "intern", "-", ">", "oth_handler", "&", "&", "intern", "-", ">", "oth_handler", "-", ">", "dtor", ")", "{", "intern", "-", ">", "oth_handler", "-", ">", "dtor", "(", "intern", "TSRMLS_CC", ")", ";", "}", "zend_object_std_dtor", "(", "&", "intern", "-", ">", "std", "TSRMLS_CC", ")", ";", "if", "(", "intern", "-", ">", "_path", ")", "{", "efree", "(", "intern", "-", ">", "_path", ")", ";", "}", "@", "@", "-", "98", ",", "7", "+", "98", ",", "7", "@", "@", "static", "void", "spl_filesystem_object_free_storage", "(", "void", "*", "object", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "}", "if", "(", "intern", "-", ">", "u", ".", "dir", ".", "sub_path", ")", "{", "efree", "(", "intern", "-", ">", "u", ".", "dir", ".", "sub_path", ")", ";", "}", "}", "break", ";", "case", "SPL_FS_FILE", ":", "if", "(", "intern", "-", ">", "u", ".", "file", ".", "stream", ")", "{", "@", "@", "-", "134", ",", "13", "+", "134", ",", "13", "@", "@", "static", "void", "spl_filesystem_object_free_storage", "(", "void", "*", "object", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "spl_ce_dir_object_new", "*", "/", "/", "*", "creates", "the", "object", "by", "-", "allocating", "memory", "/", "*", "creates", "the", "object", "by", "-", "allocating", "memory", "-", "initializing", "the", "object", "members", "-", "storing", "the", "object", "-", "setting", "it", "'", "s", "handlers", "called", "from", "called", "from", "-", "clone", "-", "new", "*", "/", "@", "@", "-", "313", ",", "7", "+", "313", ",", "7", "@", "@", "static", "int", "spl_filesystem_file_open", "(", "spl_filesystem_object", "*", "intern", ",", "int", "use_inclu", "/", "*", "avoid", "reference", "counting", "in", "debug", "mode", ",", "thus", "do", "it", "manually", "*", "/", "ZVAL_RESOURCE", "(", "&", "intern", "-", ">", "u", ".", "file", ".", "zresource", ",", "php_stream_get_resource_id", "(", "intern", "-", ">", "u", ".", "file", ".", "stream", ")", ");", "Z_SET_REFCOUNT", "(", "intern", "-", ">", "u", ".", "file", ".", "zresource", ",", "1", ")", ";", "intern", "-", ">", "u", ".", "file", ".", "delimiter", "=", "'", ",'", ";", "intern", "-", ">", "u", ".", "file", ".", "enclosure", "=", "'", "\"'", ";", "intern", "-", ">", "u", ".", "file", ".", "escape", "=", "'", "\\\\", "';", "@", "@", "-", "325", ",", "7", "+", "325", ",", "7", "@", "@", "static", "int", "spl_filesystem_file_open", "(", "spl_filesystem_object", "*", "intern", ",", "int", "use_inclu", "/", "*", "{", "{{", "spl_filesystem_object_clone", "*", "/", "/", "*", "Local", "zend_object_value", "creation", "(", "on", "stack", ")", "Load", "the", "'", "other", "'", "object", "Load", "the", "'", "other", "'", "object", "Create", "a", "new", "empty", "object", "(", "See", "spl_filesystem_object_new_ex", ")", "Open", "the", "directory", "Clone", "other", "members", "(", "properties", ")", "@", "@", "-", "370", ",", "7", "+", "370", ",", "7", "@", "@", "static", "zend_object_value", "spl_filesystem_object_clone", "(", "zval", "*", "zobject", "TSRMLS_DC", ")", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_ERROR", ",", "\"", "An", "object", "of", "class", "%", "s", "cannot", "be", "cloned", "\"", ",", "old_object", "-", ">", "ce", "-", ">", "name", ")", ";", "break", ";", "}", "intern", "-", ">", "file_class", "=", "source", "-", ">", "file_class", ";", "intern", "-", ">", "info_class", "=", "source", "-", ">", "info_class", ";", "intern", "-", ">", "oth", "=", "source", "-", ">", "oth", ";", "@", "@", "-", "389", ",", "7", "+", "389", ",", "7", "@", "@", "static", "zend_object_value", "spl_filesystem_object_clone", "(", "zval", "*", "zobject", "TSRMLS_DC", ")", "void", "spl_filesystem_info_set_filename", "(", "spl_filesystem_object", "*", "intern", ",", "char", "*", "path", ",", "int", "len", ",", "int", "use_copy", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "char", "*", "p1", ",", "*", "p2", ";", "if", "(", "intern", "-", ">", "file_name", ")", "{", "efree", "(", "intern", "-", ">", "file_name", ")", ";", "}", "@", "@", "-", "413", ",", "7", "+", "413", ",", "7", "@", "@", "void", "spl_filesystem_info_set_filename", "(", "spl_filesystem_object", "*", "intern", ",", "char", "*", "path", ",", "}", "else", "{", "intern", "-", ">", "_path_len", "=", "0", ";", "}", "if", "(", "intern", "-", ">", "_path", ")", "{", "efree", "(", "intern", "-", ">", "_path", ")", ";", "}", "@", "@", "-", "459", ",", "7", "+", "459", ",", "7", "@", "@", "static", "spl_filesystem_object", "*", "spl_filesystem_object_create_info", "(", "spl_filesystem_", "}", "else", "{", "spl_filesystem_info_set_filename", "(", "intern", ",", "file_path", ",", "file_path_len", ",", "use_copy", "TSRMLS_CC", ")", ";", "}", "zend_restore_error_handling", "(", "&", "error_handling", "TSRMLS_CC", ")", ";", "return", "intern", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "514", ",", "7", "+", "514", ",", "7", "@", "@", "static", "spl_filesystem_object", "*", "spl_filesystem_object_create_type", "(", "int", "ht", ",", "spl_fil", "return_value", "-", ">", "value", ".", "obj", "=", "spl_filesystem_object_new_ex", "(", "ce", ",", "&", "intern", "TSRMLS_CC", ")", ";", "Z_TYPE_P", "(", "return_value", ")", "=", "IS_OBJECT", ";", "spl_filesystem_object_get_file_name", "(", "source", "TSRMLS_CC", ")", ";", "if", "(", "ce", "-", ">", "constructor", "-", ">", "common", ".", "scope", "!", "=", "spl_ce_SplFileObject", ")", "{", "@", "@", "-", "530", ",", "12", "+", "530", ",", "12", "@", "@", "static", "spl_filesystem_object", "*", "spl_filesystem_object_create_type", "(", "int", "ht", ",", "spl_fil", "intern", "-", ">", "file_name_len", "=", "source", "-", ">", "file_name_len", ";", "intern", "-", ">", "_path", "=", "spl_filesystem_object_get_path", "(", "source", ",", "&", "intern", "-", ">", "_path_len", "TSRMLS_CC", ")", ";", "intern", "-", ">", "_path", "=", "estrndup", "(", "intern", "-", ">", "_path", ",", "intern", "-", ">", "_path_len", ")", ";", "intern", "-", ">", "u", ".", "file", ".", "open_mode", "=", "\"", "r", "\"", ";", "intern", "-", ">", "u", ".", "file", ".", "open_mode_len", "=", "1", ";", "if", "(", "ht", "&", "&", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "sbr", "\"", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "open_mode", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "open_mode_len", ",", "if", "(", "ht", "&", "&", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "sbr", "\"", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "open_mode", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "open_mode_len", ",", "&", "use_include_path", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "zcontext", ")", "=", "=", "FAILURE", ")", "{", "zend_restore_error_handling", "(", "&", "error_handling", "TSRMLS_CC", ")", ";", "intern", "-", ">", "u", ".", "file", ".", "open_mode", "=", "NULL", ";", "@", "@", "-", "544", ",", "7", "+", "544", ",", "7", "@", "@", "static", "spl_filesystem_object", "*", "spl_filesystem_object_create_type", "(", "int", "ht", ",", "spl_fil", "Z_TYPE_P", "(", "return_value", ")", "=", "IS_NULL", ";", "return", "NULL", ";", "}", "if", "(", "spl_filesystem_file_open", "(", "intern", ",", "use_include_path", ",", "0", "TSRMLS_CC", ")", "=", "=", "FAILURE", ")", "{", "zend_restore_error_handling", "(", "&", "error_handling", "TSRMLS_CC", ")", ";", "zval_dtor", "(", "return_value", ")", ";", "@", "@", "-", "553", ",", "7", "+", "553", ",", "7", "@", "@", "static", "spl_filesystem_object", "*", "spl_filesystem_object_create_type", "(", "int", "ht", ",", "spl_fil", "}", "}", "break", ";", "case", "SPL_FS_DIR", ":", "case", "SPL_FS_DIR", ":", "zend_restore_error_handling", "(", "&", "error_handling", "TSRMLS_CC", ")", ";", "zend_throw_exception_ex", "(", "spl_ce_RuntimeException", ",", "0", "TSRMLS_CC", ",", "\"", "Operation", "not", "supported", "\"", ");", "return", "NULL", ";", "@", "@", "-", "617", ",", "7", "+", "617", ",", "7", "@", "@", "static", "HashTable", "*", "spl_filesystem_object_get_debug_info", "(", "zval", "*", "obj", ",", "int", "*", "is_temp", "T", "if", "(", "intern", "-", ">", "file_name", ")", "{", "pnstr", "=", "spl_gen_private_prop_name", "(", "spl_ce_SplFileInfo", ",", "\"", "fileName", "\"", ",", "sizeof", "(", "\"", "fileName", "\"", ")-", "1", ",", "&", "pnlen", "TSRMLS_CC", ")", ";", "spl_filesystem_object_get_path", "(", "intern", ",", "&", "path_len", "TSRMLS_CC", ")", ";", "if", "(", "path_len", "&", "&", "path_len", "<", "intern", "-", ">", "file_name_len", ")", "{", "add_assoc_stringl_ex", "(", "&", "zrv", ",", "pnstr", ",", "pnlen", "+", "1", ",", "intern", "-", ">", "file_name", "+", "path_len", "+", "1", ",", "intern", "-", ">", "file_name_len", "-", "(", "path_len", "+", "1", ")", ",", "1", ")", ";", "}", "else", "{", "@", "@", "-", "665", ",", "13", "+", "665", ",", "13", "@", "@", "static", "HashTable", "*", "spl_filesystem_object_get_debug_info", "(", "zval", "*", "obj", ",", "int", "*", "is_temp", "T", "zend_function", "*", "spl_filesystem_object_get_method_check", "(", "zval", "*", "*", "object_ptr", ",", "char", "*", "method", ",", "int", "method_len", ",", "const", "struct", "_zend_literal", "*", "key", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "spl_filesystem_object", "*", "fsobj", "=", "zend_object_store_get_object", "(", "*", "object_ptr", "TSRMLS_CC", ")", ";", "if", "(", "fsobj", "-", ">", "u", ".", "dir", ".", "entry", ".", "d_name", "[", "0", "]", "=", "=", "'", "\\", "0", "'", "&", "&", "fsobj", "-", ">", "orig_path", "=", "=", "NULL", ")", "{", "method", "=", "\"", "_bad_state_ex", "\"", ";", "method_len", "=", "sizeof", "(", "\"", "_bad_state_ex", "\"", ")", "-", "1", ";", "key", "=", "NULL", ";", "}", "return", "zend_get_std_object_handlers", "(", ")-", ">", "get_method", "(", "object_ptr", ",", "method", ",", "method_len", ",", "key", "TSRMLS_CC", ")", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "751", ",", "7", "+", "751", ",", "7", "@", "@", "SPL_METHOD", "(", "DirectoryIterator", ",", "__construct", ")", "SPL_METHOD", "(", "DirectoryIterator", ",", "rewind", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "769", ",", "7", "+", "769", ",", "7", "@", "@", "SPL_METHOD", "(", "DirectoryIterator", ",", "rewind", ")", "SPL_METHOD", "(", "DirectoryIterator", ",", "key", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "799", ",", "7", "+", "799", ",", "7", "@", "@", "SPL_METHOD", "(", "DirectoryIterator", ",", "next", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "int", "skip_dots", "=", "SPL_HAS_FLAG", "(", "intern", "-", ">", "flags", ",", "SPL_FILE_DIR_SKIPDOTS", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "859", ",", "7", "+", "859", ",", "7", "@", "@", "SPL_METHOD", "(", "DirectoryIterator", ",", "seek", ")", "SPL_METHOD", "(", "DirectoryIterator", ",", "valid", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "875", ",", "7", "+", "875", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getPath", ")", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "char", "*", "path", ";", "int", "path_len", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "891", ",", "13", "+", "891", ",", "13", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getFilename", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "int", "path_len", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "spl_filesystem_object_get_path", "(", "intern", ",", "&", "path_len", "TSRMLS_CC", ")", ";", "if", "(", "path_len", "&", "&", "path_len", "<", "intern", "-", ">", "file_name_len", ")", "{", "RETURN_STRINGL", "(", "intern", "-", ">", "file_name", "+", "path_len", "+", "1", ",", "intern", "-", ">", "file_name_len", "-", "(", "path_len", "+", "1", ")", ",", "1", ")", ";", "}", "else", "{", "@", "@", "-", "911", ",", "7", "+", "911", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getFilename", ")", "SPL_METHOD", "(", "DirectoryIterator", ",", "getFilename", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1019", ",", "7", "+", "1019", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getBasename", ")", "RETURN_STRINGL", "(", "fname", ",", "flen", ",", "0", ")", ";", "}", "/", "*", "}", "}}", "*/", "/", "*", "}", "}}", "*/", "/", "*", "{", "{{", "proto", "string", "DirectoryIterator", ":", ":", "getBasename", "(", "[", "string", "$", "suffix", "]", ")", "U", "Returns", "filename", "component", "of", "current", "dir", "entry", "*", "/", "@", "@", "-", "1029", ",", "7", "+", "1029", ",", "7", "@", "@", "SPL_METHOD", "(", "DirectoryIterator", ",", "getBasename", ")", "char", "*", "suffix", "=", "0", ",", "*", "fname", ";", "int", "slen", "=", "0", ";", "size_t", "flen", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "s", "\"", ",", "&", "suffix", ",", "&", "slen", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1065", ",", "7", "+", "1065", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getPathname", ")", "SPL_METHOD", "(", "FilesystemIterator", ",", "key", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1084", ",", "7", "+", "1084", ",", "7", "@", "@", "SPL_METHOD", "(", "FilesystemIterator", ",", "key", ")", "SPL_METHOD", "(", "FilesystemIterator", ",", "current", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1107", ",", "7", "+", "1107", ",", "7", "@", "@", "SPL_METHOD", "(", "FilesystemIterator", ",", "current", ")", "SPL_METHOD", "(", "DirectoryIterator", ",", "isDot", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1121", ",", "8", "+", "1121", ",", "8", "@", "@", "SPL_METHOD", "(", "DirectoryIterator", ",", "isDot", ")", "/", "*", "zend_replace_error_handling", "(", ")", "is", "used", "to", "throw", "exceptions", "in", "case", "the", "constructor", "fails", ".", "Here", "we", "use", "this", "to", "ensure", "the", "object", "has", "a", "valid", "directory", "resource", ".", "When", "the", "constructor", "gets", "called", "the", "object", "is", "already", "created", "When", "the", "constructor", "gets", "called", "the", "object", "is", "already", "created", "by", "the", "engine", ",", "so", "we", "must", "only", "call", "'", "additional", "'", "initializations", ".", "*", "/", "SPL_METHOD", "(", "SplFileInfo", ",", "__construct", ")", "@", "@", "-", "1140", ",", "11", "+", "1140", ",", "11", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "__construct", ")", "}", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "spl_filesystem_info_set_filename", "(", "intern", ",", "path", ",", "len", ",", "1", "TSRMLS_CC", ")", ";", "zend_restore_error_handling", "(", "&", "error_handling", "TSRMLS_CC", ")", ";", "/", "*", "intern", "-", ">", "type", "=", "SPL_FS_INFO", ";", "already", "set", "*", "/", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "1249", ",", "7", "+", "1249", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getLinkTarget", ")", "int", "ret", ";", "char", "buff", "[", "MAXPATHLEN", "]", ";", "zend_error_handling", "error_handling", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1297", ",", "7", "+", "1297", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getRealPath", ")", "char", "buff", "[", "MAXPATHLEN", "]", ";", "char", "*", "filename", ";", "zend_error_handling", "error_handling", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1307", ",", "10", "+", "1307", ",", "10", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getRealPath", ")", "if", "(", "intern", "-", ">", "type", "=", "=", "SPL_FS_DIR", "&", "&", "!", "intern", "-", ">", "file_name", "&", "&", "intern", "-", ">", "u", ".", "dir", ".", "entry", ".", "d_name", "[", "0", "]", ")", "{", "spl_filesystem_object_get_file_name", "(", "intern", "TSRMLS_CC", ")", ";", "}", "if", "(", "intern", "-", ">", "orig_path", ")", "{", "filename", "=", "intern", "-", ">", "orig_path", ";", "}", "else", "{", "}", "else", "{", "filename", "=", "intern", "-", ">", "file_name", ";", "}", "@", "@", "-", "1348", ",", "7", "+", "1348", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "setFileClass", ")", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "zend_class_entry", "*", "ce", "=", "spl_ce_SplFileObject", ";", "zend_error_handling", "error_handling", ";", "zend_replace_error_handling", "(", "EH_THROW", ",", "spl_ce_UnexpectedValueException", ",", "&", "error_handling", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "C", "\"", ",", "&", "ce", ")", "=", "=", "SUCCESS", ")", "{", "@", "@", "-", "1366", ",", "7", "+", "1366", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "setInfoClass", ")", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "zend_class_entry", "*", "ce", "=", "spl_ce_SplFileInfo", ";", "zend_error_handling", "error_handling", ";", "zend_replace_error_handling", "(", "EH_THROW", ",", "spl_ce_UnexpectedValueException", ",", "&", "error_handling", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "C", "\"", ",", "&", "ce", ")", "=", "=", "SUCCESS", ")", "{", "@", "@", "-", "1384", ",", "7", "+", "1384", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getFileInfo", ")", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "zend_class_entry", "*", "ce", "=", "intern", "-", ">", "info_class", ";", "zend_error_handling", "error_handling", ";", "zend_replace_error_handling", "(", "EH_THROW", ",", "spl_ce_UnexpectedValueException", ",", "&", "error_handling", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "C", "\"", ",", "&", "ce", ")", "=", "=", "SUCCESS", ")", "{", "@", "@", "-", "1402", ",", "7", "+", "1402", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileInfo", ",", "getPathInfo", ")", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "zend_class_entry", "*", "ce", "=", "intern", "-", ">", "info_class", ";", "zend_error_handling", "error_handling", ";", "zend_replace_error_handling", "(", "EH_THROW", ",", "spl_ce_UnexpectedValueException", ",", "&", "error_handling", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "C", "\"", ",", "&", "ce", ")", "=", "=", "SUCCESS", ")", "{", "@", "@", "-", "1463", ",", "7", "+", "1463", ",", "7", "@", "@", "SPL_METHOD", "(", "FilesystemIterator", ",", "rewind", ")", "SPL_METHOD", "(", "FilesystemIterator", ",", "getFlags", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1519", ",", "11", "+", "1519", ",", "11", "@", "@", "SPL_METHOD", "(", "RecursiveDirectoryIterator", ",", "getChildren", ")", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "spl_filesystem_object", "*", "subdir", ";", "char", "slash", "=", "SPL_HAS_FLAG", "(", "intern", "-", ">", "flags", ",", "SPL_FILE_DIR_UNIXPATHS", ")", "?", "'", "/'", ":", "DEFAULT_SLASH", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "spl_filesystem_object_get_file_name", "(", "intern", "TSRMLS_CC", ")", ";", "MAKE_STD_ZVAL", "(", "zflags", ")", ";", "@", "@", "-", "1554", ",", "7", "+", "1554", ",", "7", "@", "@", "SPL_METHOD", "(", "RecursiveDirectoryIterator", ",", "getChildren", ")", "SPL_METHOD", "(", "RecursiveDirectoryIterator", ",", "getSubPath", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1575", ",", "7", "+", "1575", ",", "7", "@", "@", "SPL_METHOD", "(", "RecursiveDirectoryIterator", ",", "getSubPathname", ")", "char", "*", "sub_name", ";", "int", "len", ";", "char", "slash", "=", "SPL_HAS_FLAG", "(", "intern", "-", ">", "flags", ",", "SPL_FILE_DIR_UNIXPATHS", ")", "?", "'", "/'", ":", "DEFAULT_SLASH", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1611", ",", "7", "+", "1611", ",", "7", "@", "@", "SPL_METHOD", "(", "GlobIterator", ",", "__construct", ")", "SPL_METHOD", "(", "GlobIterator", ",", "count", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "1666", ",", "7", "+", "1666", ",", "7", "@", "@", "zend_object_iterator", "*", "spl_filesystem_dir_get_iterator", "(", "zend_class_entry", "*", "ce", ",", "zval", "iterator", "-", ">", "current", "=", "object", ";", "}", "zval_add_ref", "(", "&", "object", ")", ";", "return", "(", "zend_object_iterator", "*", ")", "iterator", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "1701", ",", "7", "+", "1701", ",", "7", "@", "@", "static", "int", "spl_filesystem_dir_it_valid", "(", "zend_object_iterator", "*", "iter", "TSRMLS_DC", ")", "static", "void", "spl_filesystem_dir_it_current_data", "(", "zend_object_iterator", "*", "iter", ",", "zval", "*", "**", "data", "TSRMLS_DC", ")", "{", "spl_filesystem_iterator", "*", "iterator", "=", "(", "spl_filesystem_iterator", "*", ")", "iter", ";", "*", "data", "=", "&", "iterator", "-", ">", "current", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "1719", ",", "7", "+", "1719", ",", "7", "@", "@", "static", "void", "spl_filesystem_dir_it_current_key", "(", "zend_object_iterator", "*", "iter", ",", "zval", "*", "static", "void", "spl_filesystem_dir_it_move_forward", "(", "zend_object_iterator", "*", "iter", "TSRMLS_DC", ")", "{", "spl_filesystem_object", "*", "object", "=", "spl_filesystem_iterator_to_object", "(", "(", "spl_filesystem_iterator", "*", ")", "iter", ")", ";", "object", "-", ">", "u", ".", "dir", ".", "index", "+", "+;", "spl_filesystem_dir_read", "(", "object", "TSRMLS_CC", ")", ";", "if", "(", "object", "-", ">", "file_name", ")", "{", "@", "@", "-", "1733", ",", "7", "+", "1733", ",", "7", "@", "@", "static", "void", "spl_filesystem_dir_it_move_forward", "(", "zend_object_iterator", "*", "iter", "TSRMLS", "static", "void", "spl_filesystem_dir_it_rewind", "(", "zend_object_iterator", "*", "iter", "TSRMLS_DC", ")", "{", "spl_filesystem_object", "*", "object", "=", "spl_filesystem_iterator_to_object", "(", "(", "spl_filesystem_iterator", "*", ")", "iter", ")", ";", "object", "-", ">", "u", ".", "dir", ".", "index", "=", "0", ";", "if", "(", "object", "-", ">", "u", ".", "dir", ".", "dirp", ")", "{", "php_stream_rewinddir", "(", "object", "-", ">", "u", ".", "dir", ".", "dirp", ")", ";", "@", "@", "-", "1803", ",", "7", "+", "1803", ",", "7", "@", "@", "static", "void", "spl_filesystem_tree_it_move_forward", "(", "zend_object_iterator", "*", "iter", "TSRML", "{", "spl_filesystem_iterator", "*", "iterator", "=", "(", "spl_filesystem_iterator", "*", ")", "iter", ";", "spl_filesystem_object", "*", "object", "=", "spl_filesystem_iterator_to_object", "(", "iterator", ")", ";", "object", "-", ">", "u", ".", "dir", ".", "index", "+", "+;", "do", "{", "spl_filesystem_dir_read", "(", "object", "TSRMLS_CC", ")", ";", "@", "@", "-", "1824", ",", "7", "+", "1824", ",", "7", "@", "@", "static", "void", "spl_filesystem_tree_it_rewind", "(", "zend_object_iterator", "*", "iter", "TSRMLS_DC", ")", "{", "spl_filesystem_iterator", "*", "iterator", "=", "(", "spl_filesystem_iterator", "*", ")", "iter", ";", "spl_filesystem_object", "*", "object", "=", "spl_filesystem_iterator_to_object", "(", "iterator", ")", ";", "object", "-", ">", "u", ".", "dir", ".", "index", "=", "0", ";", "if", "(", "object", "-", ">", "u", ".", "dir", ".", "dirp", ")", "{", "php_stream_rewinddir", "(", "object", "-", ">", "u", ".", "dir", ".", "dirp", ")", ";", "@", "@", "-", "1868", ",", "7", "+", "1868", ",", "7", "@", "@", "zend_object_iterator", "*", "spl_filesystem_tree_get_iterator", "(", "zend_class_entry", "*", "ce", ",", "zva", "iterator", "-", ">", "intern", ".", "funcs", "=", "&", "spl_filesystem_tree_it_funcs", ";", "}", "zval_add_ref", "(", "&", "object", ")", ";", "return", "(", "zend_object_iterator", "*", ")", "iterator", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "1924", ",", "7", "+", "1924", ",", "7", "@", "@", "static", "int", "spl_filesystem_object_cast", "(", "zval", "*", "readobj", ",", "zval", "*", "writeobj", ",", "int", "type", "TS", "/", "*", "{", "{{", "declare", "method", "parameters", "*", "/", "/", "*", "supply", "a", "name", "and", "default", "to", "call", "by", "parameter", "*", "/", "ZEND_BEGIN_ARG_INFO", "(", "arginfo_info___construct", ",", "0", ")", "ZEND_BEGIN_ARG_INFO", "(", "arginfo_info___construct", ",", "0", ")", "ZEND_ARG_INFO", "(", "0", ",", "file_name", ")", "ZEND_END_ARG_INFO", "(", ")", "@", "@", "-", "1983", ",", "11", "+", "1983", ",", "11", "@", "@", "static", "const", "zend_function_entry", "spl_SplFileInfo_functions", "[", "]", "=", "{", "PHP_FE_END", "}", ";", "ZEND_BEGIN_ARG_INFO", "(", "arginfo_dir___construct", ",", "0", ")", "ZEND_BEGIN_ARG_INFO", "(", "arginfo_dir___construct", ",", "0", ")", "ZEND_ARG_INFO", "(", "0", ",", "path", ")", "ZEND_END_ARG_INFO", "(", ")", "ZEND_BEGIN_ARG_INFO", "(", "arginfo_dir_it_seek", ",", "0", ")", "ZEND_BEGIN_ARG_INFO", "(", "arginfo_dir_it_seek", ",", "0", ")", "ZEND_ARG_INFO", "(", "0", ",", "position", ")", "ZEND_END_ARG_INFO", "(", ");", "@", "@", "-", "2009", ",", "7", "+", "2009", ",", "7", "@", "@", "static", "const", "zend_function_entry", "spl_DirectoryIterator_functions", "[", "]", "=", "{", "PHP_FE_END", "}", ";", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_r_dir___construct", ",", "0", ",", "0", ",", "1", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_r_dir___construct", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "path", ")", "ZEND_ARG_INFO", "(", "0", ",", "flags", ")", "ZEND_END_ARG_INFO", "(", ")", "@", "@", "-", "2058", ",", "7", "+", "2058", ",", "7", "@", "@", "static", "int", "spl_filesystem_file_read", "(", "spl_filesystem_object", "*", "intern", ",", "int", "silent", "TS", "long", "line_add", "=", "(", "intern", "-", ">", "u", ".", "file", ".", "current_line", "|", "|", "intern", "-", ">", "u", ".", "file", ".", "current_zval", ")", "?", "1", ":", "0", ";", "spl_filesystem_file_free_line", "(", "intern", "TSRMLS_CC", ")", ";", "if", "(", "php_stream_eof", "(", "intern", "-", ">", "u", ".", "file", ".", "stream", ")", ")", "{", "if", "(", "!", "silent", ")", "{", "zend_throw_exception_ex", "(", "spl_ce_RuntimeException", ",", "0", "TSRMLS_CC", ",", "\"", "Cannot", "read", "from", "file", "%", "s", "\"", ",", "intern", "-", ">", "file_name", ")", ";", "@", "@", "-", "2086", ",", "7", "+", "2086", ",", "7", "@", "@", "static", "int", "spl_filesystem_file_read", "(", "spl_filesystem_object", "*", "intern", ",", "int", "silent", "TS", "line_len", "=", "strcspn", "(", "buf", ",", "\"", "\\", "r", "\\", "n", "\"", ");", "buf", "[", "line_len", "]", "=", "'", "\\", "0", "'", ";", "}", "intern", "-", ">", "u", ".", "file", ".", "current_line", "=", "buf", ";", "intern", "-", ">", "u", ".", "file", ".", "current_line_len", "=", "line_len", ";", "}", "@", "@", "-", "2107", ",", "7", "+", "2107", ",", "7", "@", "@", "static", "int", "spl_filesystem_file_call", "(", "spl_filesystem_object", "*", "intern", ",", "zend_function", "zval", "*", "**", "params", "=", "(", "zval", "*", "**", ")", "safe_emalloc", "(", "num_args", ",", "sizeof", "(", "zval", "*", "*)", ",", "0", ")", ";", "params", "[", "0", "]", "=", "&", "zresource_ptr", ";", "if", "(", "arg2", ")", "{", "params", "[", "1", "]", "=", "&", "arg2", ";", "}", "@", "@", "-", "2133", ",", "7", "+", "2133", ",", "7", "@", "@", "static", "int", "spl_filesystem_file_call", "(", "spl_filesystem_object", "*", "intern", ",", "zend_function", "fcic", ".", "object_ptr", "=", "NULL", ";", "result", "=", "zend_call_function", "(", "&", "fci", ",", "&", "fcic", "TSRMLS_CC", ")", ";", "if", "(", "result", "=", "=", "FAILURE", ")", "{", "RETVAL_FALSE", ";", "}", "else", "{", "@", "@", "-", "2159", ",", "11", "+", "2159", ",", "11", "@", "@", "static", "int", "spl_filesystem_file_call", "(", "spl_filesystem_object", "*", "intern", ",", "zend_function", "static", "int", "spl_filesystem_file_read_csv", "(", "spl_filesystem_object", "*", "intern", ",", "char", "delimiter", ",", "char", "enclosure", ",", "char", "escape", ",", "zval", "*", "return_value", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "{", "int", "ret", "=", "SUCCESS", ";", "do", "{", "ret", "=", "spl_filesystem_file_read", "(", "intern", ",", "1", "TSRMLS_CC", ")", ";", "}", "while", "(", "ret", "=", "=", "SUCCESS", "&", "&", "!", "intern", "-", ">", "u", ".", "file", ".", "current_line_len", "&", "&", "SPL_HAS_FLAG", "(", "intern", "-", ">", "flags", ",", "SPL_FILE_OBJECT_SKIP_EMPTY", ")", ");", "if", "(", "ret", "=", "=", "SUCCESS", ")", "{", "size_t", "buf_len", "=", "intern", "-", ">", "u", ".", "file", ".", "current_line_len", ";", "char", "*", "buf", "=", "estrndup", "(", "intern", "-", ">", "u", ".", "file", ".", "current_line", ",", "buf_len", ")", ";", "@", "@", "-", "2237", ",", "7", "+", "2237", ",", "7", "@", "@", "static", "int", "spl_filesystem_file_is_empty_line", "(", "spl_filesystem_object", "*", "intern", "TSRML", "if", "(", "SPL_HAS_FLAG", "(", "intern", "-", ">", "flags", ",", "SPL_FILE_OBJECT_READ_CSV", ")", "&", "&", "zend_hash_num_elements", "(", "Z_ARRVAL_P", "(", "intern", "-", ">", "u", ".", "file", ".", "current_zval", ")", ")", "=", "=", "1", ")", "{", "zval", "*", "*", "first", "=", "Z_ARRVAL_P", "(", "intern", "-", ">", "u", ".", "file", ".", "current_zval", ")", "->", "pListHead", "-", ">", "pData", ";", "return", "Z_TYPE_PP", "(", "first", ")", "=", "=", "IS_STRING", "&", "&", "Z_STRLEN_PP", "(", "first", ")", "=", "=", "0", ";", "}", "return", "zend_hash_num_elements", "(", "Z_ARRVAL_P", "(", "intern", "-", ">", "u", ".", "file", ".", "current_zval", ")", ")", "=", "=", "0", ";", "@", "@", "-", "2260", ",", "7", "+", "2260", ",", "7", "@", "@", "static", "int", "spl_filesystem_file_read_line", "(", "zval", "*", "this_ptr", ",", "spl_filesystem_object", "spl_filesystem_file_free_line", "(", "intern", "TSRMLS_CC", ")", ";", "ret", "=", "spl_filesystem_file_read_line_ex", "(", "this_ptr", ",", "intern", ",", "silent", "TSRMLS_CC", ")", ";", "}", "return", "ret", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "2294", ",", "16", "+", "2294", ",", "16", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "__construct", ")", "intern", "-", ">", "u", ".", "file", ".", "open_mode", "=", "NULL", ";", "intern", "-", ">", "u", ".", "file", ".", "open_mode_len", "=", "0", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "p", "|", "sbr", "!", "\",", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "p", "|", "sbr", "!", "\",", "&", "intern", "-", ">", "file_name", ",", "&", "intern", "-", ">", "file_name_len", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "open_mode", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "open_mode_len", ",", "&", "use_include_path", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "zcontext", ")", "=", "=", "FAILURE", ")", "{", "&", "intern", "-", ">", "u", ".", "file", ".", "open_mode", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "open_mode_len", ",", "&", "use_include_path", ",", "&", "intern", "-", ">", "u", ".", "file", ".", "zcontext", ")", "=", "=", "FAILURE", ")", "{", "intern", "-", ">", "u", ".", "file", ".", "open_mode", "=", "NULL", ";", "intern", "-", ">", "file_name", "=", "NULL", ";", "zend_restore_error_handling", "(", "&", "error_handling", "TSRMLS_CC", ")", ";", "return", ";", "}", "if", "(", "intern", "-", ">", "u", ".", "file", ".", "open_mode", "=", "=", "NULL", ")", "{", "intern", "-", ">", "u", ".", "file", ".", "open_mode", "=", "\"", "r", "\"", ";", "intern", "-", ">", "u", ".", "file", ".", "open_mode_len", "=", "1", ";", "@", "@", "-", "2368", ",", "7", "+", "2368", ",", "7", "@", "@", "SPL_METHOD", "(", "SplTempFileObject", ",", "__construct", ")", "intern", "-", ">", "u", ".", "file", ".", "open_mode", "=", "\"", "wb", "\"", ";", "intern", "-", ">", "u", ".", "file", ".", "open_mode_len", "=", "1", ";", "intern", "-", ">", "u", ".", "file", ".", "zcontext", "=", "NULL", ";", "if", "(", "spl_filesystem_file_open", "(", "intern", ",", "0", ",", "0", "TSRMLS_CC", ")", "=", "=", "SUCCESS", ")", "{", "intern", "-", ">", "_path_len", "=", "0", ";", "intern", "-", ">", "_path", "=", "estrndup", "(", "\"\"", ",", "0", ")", ";", "@", "@", "-", "2381", ",", "7", "+", "2381", ",", "7", "@", "@", "SPL_METHOD", "(", "SplTempFileObject", ",", "__construct", ")", "SPL_METHOD", "(", "SplFileObject", ",", "rewind", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2394", ",", "7", "+", "2394", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "rewind", ")", "SPL_METHOD", "(", "SplFileObject", ",", "eof", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2407", ",", "7", "+", "2407", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "eof", ")", "SPL_METHOD", "(", "SplFileObject", ",", "valid", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2424", ",", "7", "+", "2424", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "valid", ")", "SPL_METHOD", "(", "SplFileObject", ",", "fgets", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2440", ",", "7", "+", "2440", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "fgets", ")", "SPL_METHOD", "(", "SplFileObject", ",", "current", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2461", ",", "7", "+", "2461", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "current", ")", "SPL_METHOD", "(", "SplFileObject", ",", "key", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2478", ",", "7", "+", "2478", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "key", ")", "SPL_METHOD", "(", "SplFileObject", ",", "next", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2530", ",", "7", "+", "2530", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "setMaxLineLen", ")", "zend_throw_exception_ex", "(", "spl_ce_DomainException", ",", "0", "TSRMLS_CC", ",", "\"", "Maximum", "line", "length", "must", "be", "greater", "than", "or", "equal", "zero", "\"", ");", "return", ";", "}", "intern", "-", ">", "u", ".", "file", ".", "max_line_len", "=", "max_len", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "2539", ",", "7", "+", "2539", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "setMaxLineLen", ")", "SPL_METHOD", "(", "SplFileObject", ",", "getMaxLineLen", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2554", ",", "7", "+", "2554", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "hasChildren", ")", "if", "(", "zend_parse_parameters_none", "(", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "RETURN_FALSE", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "2585", ",", "7", "+", "2585", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "fgetcsv", ")", "char", "delimiter", "=", "intern", "-", ">", "u", ".", "file", ".", "delimiter", ",", "enclosure", "=", "intern", "-", ">", "u", ".", "file", ".", "enclosure", ",", "escape", "=", "intern", "-", ">", "u", ".", "file", ".", "escape", ";", "char", "*", "delim", "=", "NULL", ",", "*", "enclo", "=", "NULL", ",", "*", "esc", "=", "NULL", ";", "int", "d_len", "=", "0", ",", "e_len", "=", "0", ",", "esc_len", "=", "0", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "sss", "\"", ",", "&", "delim", ",", "&", "d_len", ",", "&", "enclo", ",", "&", "e_len", ",", "&", "esc", ",", "&", "esc_len", ")", "=", "=", "SUCCESS", ")", "{", "switch", "(", "ZEND_NUM_ARGS", "(", "))", "{", "@", "@", "-", "2627", ",", "7", "+", "2627", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "fputcsv", ")", "char", "*", "delim", "=", "NULL", ",", "*", "enclo", "=", "NULL", ",", "*", "esc", "=", "NULL", ";", "int", "d_len", "=", "0", ",", "e_len", "=", "0", ",", "esc_len", "=", "0", ",", "ret", ";", "zval", "*", "fields", "=", "NULL", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "a", "|", "sss", "\"", ",", "&", "fields", ",", "&", "delim", ",", "&", "d_len", ",", "&", "enclo", ",", "&", "e_len", ",", "&", "esc", ",", "&", "esc_len", ")", "=", "=", "SUCCESS", ")", "{", "switch", "(", "ZEND_NUM_ARGS", "(", "))", "{", "@", "@", "-", "2670", ",", "7", "+", "2670", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "setCsvControl", ")", "char", "delimiter", "=", "'", ",'", ",", "enclosure", "=", "'", "\"'", ",", "escape", "=", "'\\", "\\'", ";", "char", "*", "delim", "=", "NULL", ",", "*", "enclo", "=", "NULL", ",", "*", "esc", "=", "NULL", ";", "int", "d_len", "=", "0", ",", "e_len", "=", "0", ",", "esc_len", "=", "0", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "|", "sss", "\"", ",", "&", "delim", ",", "&", "d_len", ",", "&", "enclo", ",", "&", "e_len", ",", "&", "esc", ",", "&", "esc_len", ")", "=", "=", "SUCCESS", ")", "{", "switch", "(", "ZEND_NUM_ARGS", "(", "))", "{", "@", "@", "-", "2713", ",", "7", "+", "2713", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "getCsvControl", ")", "char", "delimiter", "[", "2", "]", ",", "enclosure", "[", "2", "]", ";", "array_init", "(", "return_value", ")", ";", "delimiter", "[", "0", "]", "=", "intern", "-", ">", "u", ".", "file", ".", "delimiter", ";", "delimiter", "[", "1", "]", "=", "'", "\\", "0", "'", ";", "enclosure", "[", "0", "]", "=", "intern", "-", ">", "u", ".", "file", ".", "enclosure", ";", "@", "@", "-", "2742", ",", "7", "+", "2742", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "fflush", ")", "Return", "current", "file", "position", "*", "/", "SPL_METHOD", "(", "SplFileObject", ",", "ftell", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "long", "ret", "=", "php_stream_tell", "(", "intern", "-", ">", "u", ".", "file", ".", "stream", ")", ";", "if", "(", "ret", "=", "=", "-", "1", ")", "{", "@", "@", "-", "2872", ",", "6", "+", "2872", ",", "10", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "fread", ")", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Length", "parameter", "must", "be", "greater", "than", "0", "\"", ");", "RETURN_FALSE", ";", "}", "if", "(", "length", ">", "INT_MAX", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Length", "parameter", "must", "be", "no", "more", "than", "%", "d", "\"", ",", "INT_MAX", ")", ";", "RETURN_FALSE", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "emalloc", "(", "length", "+", "1", ")", ";", "Z_STRLEN_P", "(", "return_value", ")", "=", "php_stream_read", "(", "intern", "-", ">", "u", ".", "file", ".", "stream", ",", "Z_STRVAL_P", "(", "return_value", ")", ",", "length", ")", ";", "@", "@", "-", "2892", ",", "7", "+", "2896", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "ftruncate", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "long", "size", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "l", "\"", ",", "&", "size", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "2901", ",", "7", "+", "2905", ",", "7", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "ftruncate", ")", "zend_throw_exception_ex", "(", "spl_ce_LogicException", ",", "0", "TSRMLS_CC", ",", "\"", "Can", "'", "t", "truncate", "file", "%", "s", "\"", ",", "intern", "-", ">", "file_name", ")", ";", "RETURN_FALSE", ";", "}", "RETURN_BOOL", "(", "0", "=", "=", "php_stream_truncate_set_size", "(", "intern", "-", ">", "u", ".", "file", ".", "stream", ",", "size", ")", ");", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "2911", ",", "17", "+", "2915", ",", "17", "@", "@", "SPL_METHOD", "(", "SplFileObject", ",", "seek", ")", "{", "spl_filesystem_object", "*", "intern", "=", "(", "spl_filesystem_object", "*", ")", "zend_object_store_get_object", "(", "getThis", "(", ")", "TSRMLS_CC", ")", ";", "long", "line_pos", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "l", "\"", ",", "&", "line_pos", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "line_pos", "<", "0", ")", "{", "zend_throw_exception_ex", "(", "spl_ce_LogicException", ",", "0", "TSRMLS_CC", ",", "\"", "Can", "'", "t", "seek", "file", "%", "s", "to", "negative", "line", "%", "ld", "\"", ",", "intern", "-", ">", "file_name", ",", "line_pos", ")", ";", "RETURN_FALSE", ";", "RETURN_FALSE", ";", "}", "spl_filesystem_file_rewind", "(", "getThis", "(", "),", "intern", "TSRMLS_CC", ")", ";", "while", "(", "intern", "-", ">", "u", ".", "file", ".", "current_line_num", "<", "line_pos", ")", "{", "if", "(", "spl_filesystem_file_read_line", "(", "getThis", "(", "),", "intern", ",", "1", "TSRMLS_CC", ")", "=", "=", "FAILURE", ")", "{", "break", ";", "@", "@", "-", "2958", ",", "25", "+", "2962", ",", "25", "@", "@", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fputcsv", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "escape", ")", "ZEND_END_ARG_INFO", "(", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_flock", ",", "0", ",", "0", ",", "1", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_flock", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "operation", ")", "ZEND_ARG_INFO", "(", "1", ",", "wouldblock", ")", "ZEND_END_ARG_INFO", "(", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fseek", ",", "0", ",", "0", ",", "1", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fseek", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "pos", ")", "ZEND_ARG_INFO", "(", "0", ",", "whence", ")", "ZEND_END_ARG_INFO", "(", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fgetss", ",", "0", ",", "0", ",", "0", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fgetss", ",", "0", ",", "0", ",", "0", ")", "ZEND_ARG_INFO", "(", "0", ",", "allowable_tags", ")", "ZEND_END_ARG_INFO", "(", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fscanf", ",", "1", ",", "0", ",", "1", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fscanf", ",", "1", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "format", ")", "ZEND_END_ARG_INFO", "(", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fwrite", ",", "0", ",", "0", ",", "1", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fwrite", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "str", ")", "ZEND_ARG_INFO", "(", "0", ",", "length", ")", "ZEND_END_ARG_INFO", "(", ")", "@", "@", "-", "2985", ",", "11", "+", "2989", ",", "11", "@", "@", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_fread", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "length", ")", "ZEND_END_ARG_INFO", "(", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_ftruncate", ",", "0", ",", "0", ",", "1", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_ftruncate", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "size", ")", "ZEND_END_ARG_INFO", "(", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_seek", ",", "0", ",", "0", ",", "1", ")", "ZEND_BEGIN_ARG_INFO_EX", "(", "arginfo_file_object_seek", ",", "0", ",", "0", ",", "1", ")", "ZEND_ARG_INFO", "(", "0", ",", "line_pos", ")", "ZEND_END_ARG_INFO", "(", ")", "@", "@", "-", "3078", ",", "7", "+", "3082", ",", "7", "@", "@", "PHP_MINIT_FUNCTION", "(", "spl_directory", ")", "REGISTER_SPL_SUB_CLASS_EX", "(", "RecursiveDirectoryIterator", ",", "FilesystemIterator", ",", "spl_filesystem_object_new", ",", "spl_RecursiveDirectoryIterator_functions", ")", ";", "REGISTER_SPL_IMPLEMENTS", "(", "RecursiveDirectoryIterator", ",", "RecursiveIterator", ")", ";", "memcpy", "(", "&", "spl_filesystem_object_check_handlers", ",", "&", "spl_filesystem_object_handlers", ",", "sizeof", "(", "zend_object_handlers", ")", ");", "spl_filesystem_object_check_handlers", ".", "get_method", "=", "spl_filesystem_object_get_method_check", ";", "@", "@", "-", "3095", ",", "7", "+", "3099", ",", "7", "@", "@", "PHP_MINIT_FUNCTION", "(", "spl_directory", ")", "REGISTER_SPL_CLASS_CONST_LONG", "(", "SplFileObject", ",", "\"", "READ_AHEAD", "\"", ",", "SPL_FILE_OBJECT_READ_AHEAD", ")", ";", "REGISTER_SPL_CLASS_CONST_LONG", "(", "SplFileObject", ",", "\"", "SKIP_EMPTY", "\"", ",", "SPL_FILE_OBJECT_SKIP_EMPTY", ")", ";", "REGISTER_SPL_CLASS_CONST_LONG", "(", "SplFileObject", ",", "\"", "READ_CSV", "\"", ",", "SPL_FILE_OBJECT_READ_CSV", ")", ";", "REGISTER_SPL_SUB_CLASS_EX", "(", "SplTempFileObject", ",", "SplFileObject", ",", "spl_filesystem_object_new_check", ",", "spl_SplTempFileObject_functions", ")", ";", "return", "SUCCESS", ";", "}"], "docstring_tokens": ["integer", "overflows)."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "39", ",", "8", "+", "39", ",", "8", "@", "@", "downscaling", "using", "the", "fixed", "point", "implementations", "are", "usually", "much", "faster", "than", "the", "existing", "gdImageCopyResampled", "while", "having", "a", "similar", "or", "better", "quality", ".", "For", "image", "rotations", ",", "the", "optimized", "versions", "have", "a", "lazy", "antialiasing", "for", "For", "image", "rotations", ",", "the", "optimized", "versions", "have", "a", "lazy", "antialiasing", "for", "the", "edges", "of", "the", "images", ".", "For", "a", "much", "better", "antialiased", "result", ",", "the", "affine", "function", "is", "recommended", ".", "*", "/", "@", "@", "-", "633", ",", "7", "+", "633", ",", "7", "@", "@", "static", "inline", "int", "_color_blend", "(", "const", "int", "dst", ",", "const", "int", "src", ")", "}", "}", "static", "inline", "int", "_setEdgePixel", "(", "const", "gdImagePtr", "src", ",", "unsigned", "int", "x", ",", "unsigned", "int", "y", ",", "gdFixed", "coverage", ",", "const", "int", "bgColor", ")", "static", "inline", "int", "_setEdgePixel", "(", "const", "gdImagePtr", "src", ",", "unsigned", "int", "x", ",", "unsigned", "int", "y", ",", "gdFixed", "coverage", ",", "const", "int", "bgColor", ")", "{", "const", "gdFixed", "f_127", "=", "gd_itofx", "(", "127", ")", ";", "register", "int", "c", "=", "src", "-", ">", "tpixels", "[", "y", "]", "[", "x", "]", ";", "@", "@", "-", "934", ",", "9", "+", "934", ",", "6", "@", "@", "static", "inline", "LineContribType", "*", "_gdContributionsCalc", "(", "unsigned", "int", "line_size", ",", "unsi", "double", "dTotalWeight", "=", "0", ".", "0", ";", "int", "iSrc", ";", "res", "-", ">", "ContribRow", "[", "u", "]", ".", "Left", "=", "iLeft", ";", "res", "-", ">", "ContribRow", "[", "u", "]", ".", "Right", "=", "iRight", ";", "/", "*", "Cut", "edge", "points", "to", "fit", "in", "filter", "window", "in", "case", "of", "spill", "-", "off", "*", "/", "if", "(", "iRight", "-", "iLeft", "+", "1", ">", "windows_size", ")", "{", "if", "(", "iLeft", "<", "(", "(", "int", ")", "src_size", "-", "1", "/", "2", ")", ")", "{", "@", "@", "-", "946", ",", "6", "+", "943", ",", "9", "@", "@", "static", "inline", "LineContribType", "*", "_gdContributionsCalc", "(", "unsigned", "int", "line_size", ",", "unsi", "}", "}", "res", "-", ">", "ContribRow", "[", "u", "]", ".", "Left", "=", "iLeft", ";", "res", "-", ">", "ContribRow", "[", "u", "]", ".", "Right", "=", "iRight", ";", "for", "(", "iSrc", "=", "iLeft", ";", "iSrc", "<", "=", "iRight", ";", "iSrc", "+", "+)", "{", "dTotalWeight", "+", "=", "(", "res", "-", ">", "ContribRow", "[", "u", "]", ".", "Weights", "[", "iSrc", "-", "iLeft", "]", "=", "scale_f_d", "*", "(", "*", "pFilter", ")", "(", "scale_f_d", "*", "(", "dCenter", "-", "(", "double", ")", "iSrc", ")", "))", ";", "}", "@", "@", "-", "2273", ",", "7", "+", "2273", ",", "7", "@", "@", "int", "gdTransformAffineGetImage", "(", "gdImagePtr", "*", "dst", ",", "if", "(", "!", "src", "-", ">", "trueColor", ")", "{", "gdImagePaletteToTrueColor", "(", "src", ")", ";", "}", "/", "*", "Translate", "to", "dst", "origin", "(", "0", ",", "0", ")", "*", "/", "gdAffineTranslate", "(", "m", ",", "-", "bbox", ".", "x", ",", "-", "bbox", ".", "y", ")", ";", "gdAffineConcat", "(", "m", ",", "affine", ",", "m", ")", ";", "@", "@", "-", "2332", ",", "7", "+", "2332", ",", "7", "@", "@", "int", "gdTransformAffineCopy", "(", "gdImagePtr", "dst", ",", "if", "(", "src", "-", ">", "interpolation_id", "=", "=", "GD_BILINEAR_FIXED", "|", "|", "src", "-", ">", "interpolation_id", "=", "=", "GD_BICUBIC_FIXED", "|", "|", "src", "-", ">", "interpolation_id", "=", "=", "GD_NEAREST_NEIGHBOUR", ")", "{", "interpolation_id_bak", "=", "src", "-", ">", "interpolation_id", ";", "interpolation_bak", "=", "src", "-", ">", "interpolation", ";", "gdImageSetInterpolationMethod", "(", "src", ",", "GD_BICUBIC", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "15", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "72227", ":", "imagescale", "out", "-", "of", "-", "bounds", "read", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "gd", "'", "))", "die", "(", "\"", "skip", "gd", "extension", "not", "available", "\\", "n", "\"", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "img", "=", "imagecreatetruecolor", "(", "100", ",", "100", ")", ";", "imagescale", "(", "$", "img", ",", "13", ",", "1", ",", "IMG_BICUBIC", ")", ";", "?", ">", "DONE", "-", "-", "EXPECT", "-", "-", "DONE", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1095", ",", "8", "+", "1095", ",", "8", "@", "@", "int", "agp_generic_insert_memory", "(", "struct", "agp_memory", "*", "mem", ",", "off_t", "pg_start", ",", "int", "type", ")", "return", "-", "EINVAL", ";", "}", "/", "*", "AK", ":", "could", "wrap", "*", "/", "if", "(", "(", "pg_start", "+", "mem", "-", ">", "page_count", ")", ">", "num_entries", ")", "if", "(", "((", "pg_start", "+", "mem", "-", ">", "page_count", ")", ">", "num_entries", ")", "|", "|", "(", "(", "pg_start", "+", "mem", "-", ">", "page_count", ")", "<", "pg_start", ")", ")", "return", "-", "EINVAL", ";", "j", "=", "pg_start", ";", "@", "@", "-", "1130", ",", "7", "+", "1130", ",", "7", "@", "@", "int", "agp_generic_remove_memory", "(", "struct", "agp_memory", "*", "mem", ",", "off_t", "pg_start", ",", "int", "type", ")", "{", "size_t", "i", ";", "struct", "agp_bridge_data", "*", "bridge", ";", "int", "mask_type", ";", "int", "mask_type", ",", "num_entries", ";", "bridge", "=", "mem", "-", ">", "bridge", ";", "if", "(", "!", "bridge", ")", "@", "@", "-", "1142", ",", "6", "+", "1142", ",", "11", "@", "@", "int", "agp_generic_remove_memory", "(", "struct", "agp_memory", "*", "mem", ",", "off_t", "pg_start", ",", "int", "type", ")", "if", "(", "type", "!", "=", "mem", "-", ">", "type", ")", "return", "-", "EINVAL", ";", "num_entries", "=", "agp_num_entries", "(", ");", "if", "(", "((", "pg_start", "+", "mem", "-", ">", "page_count", ")", ">", "num_entries", ")", "|", "|", "(", "(", "pg_start", "+", "mem", "-", ">", "page_count", ")", "<", "pg_start", ")", ")", "return", "-", "EINVAL", ";", "mask_type", "=", "bridge", "-", ">", "driver", "-", ">", "agp_type_to_mask_type", "(", "bridge", ",", "type", ")", ";", "if", "(", "mask_type", "!", "=", "0", ")", "{", "/", "*", "The", "generic", "routines", "know", "nothing", "of", "memory", "types", "*", "/"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "35", ",", "12", "+", "35", ",", "12", "@", "@", "struct", "va_alignment", "__read_mostly", "va_align", "=", "{", ".", "flags", "=", "-", "1", ",", "}", ";", "static", "unsigned", "int", "stack_maxrandom_size", "(", "void", ")", "static", "unsigned", "long", "stack_maxrandom_size", "(", "void", ")", "{", "unsigned", "int", "max", "=", "0", ";", "unsigned", "long", "max", "=", "0", ";", "if", "(", "(", "current", "-", ">", "flags", "&", "PF_RANDOMIZE", ")", "&", "&", "!", "(", "current", "-", ">", "personality", "&", "ADDR_NO_RANDOMIZE", ")", ")", "{", "max", "=", "(", "(-", "1U", ")", "&", "STACK_RND_MASK", ")", "<", "<", "PAGE_SHIFT", ";", "max", "=", "(", "(-", "1UL", ")", "&", "STACK_RND_MASK", ")", "<", "<", "PAGE_SHIFT", ";", "}", "return", "max", ";", "@", "@", "-", "645", ",", "11", "+", "645", ",", "12", "@", "@", "static", "unsigned", "long", "load_elf_interp", "(", "struct", "elfhdr", "*", "interp_elf_ex", ",", "static", "unsigned", "long", "randomize_stack_top", "(", "unsigned", "long", "stack_top", ")", "{", "unsigned", "int", "random_variable", "=", "0", ";", "unsigned", "long", "random_variable", "=", "0", ";", "if", "(", "(", "current", "-", ">", "flags", "&", "PF_RANDOMIZE", ")", "&", "&", "!", "(", "current", "-", ">", "personality", "&", "ADDR_NO_RANDOMIZE", ")", ")", "{", "random_variable", "=", "get_random_int", "(", ")", "&", "STACK_RND_MASK", ";", "random_variable", "=", "(", "unsigned", "long", ")", "get_random_int", "(", ");", "random_variable", "&", "=", "STACK_RND_MASK", ";", "random_variable", "<", "<=", "PAGE_SHIFT", ";", "}", "#", "ifdef", "CONFIG_STACK_GROWSUP"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "define", "(", "[", "\"", "require", "\"", ",", "\"", "dojo", "/", "_base", "/", "array", "\"", ",", "\"", "dojo", "/", "_base", "/", "declare", "\"", ",", "/", "/", "declare", "\"", "dojo", "/", "dom", "-", "attr", "\"", ",", "/", "/", "domAttr", ".", "get", "\"", "dojo", "/", "keys", "\"", ",", "/", "/", "keys", ".", "ENTER", "@", "@", "-", "11", ",", "7", "+", "12", ",", "7", "@", "@", "define", "(", "[", "\"", "..", "/", "_Plugin", "\"", ",", "\"", "..", "/.", "./", "form", "/", "DropDownButton", "\"", ",", "\"", "..", "/", "range", "\"", "]", ",", "function", "(", "require", ",", "declare", ",", "domAttr", ",", "keys", ",", "lang", ",", "on", ",", "has", ",", "query", ",", "string", ",", "]", ",", "function", "(", "require", ",", "array", ",", "declare", ",", "domAttr", ",", "keys", ",", "lang", ",", "on", ",", "has", ",", "query", ",", "string", ",", "_Plugin", ",", "DropDownButton", ",", "rangeapi", ")", "{", "/", "/", "module", ":", "@", "@", "-", "26", ",", "6", "+", "27", ",", "21", "@", "@", "define", "(", "[", "/", "/", "/", "/", "-", "createLink", "/", "/", "allowUnsafeHtml", ":", "boolean", "/", "/", "If", "false", "(", "default", ")", ",", "the", "link", "description", "will", "be", "filtered", "to", "prevent", "HTML", "content", ".", "/", "/", "If", "true", "no", "filtering", "is", "done", ",", "allowing", "for", "HTML", "content", "within", "the", "link", "element", ".", "/", "/", "The", "filter", "can", "be", "specified", "with", "the", "'", "linkFilter", "'", "option", ".", "allowUnsafeHtml", ":", "false", ",", "/", "/", "linkFilter", ":", "function", "or", "array", "of", "replacement", "pairs", "/", "/", "If", "'", "allowUnsafeHtml", "'", "is", "false", "then", "this", "filter", "will", "be", "applied", "to", "the", "link", "Description", "value", ".", "/", "/", "function", ":", "the", "function", "will", "be", "invoked", "with", "the", "string", "value", "of", "the", "Description", "field", "and", "its", "/", "/", "return", "value", "will", "be", "used", "/", "/", "array", ":", "each", "array", "item", "should", "be", "an", "array", "of", "two", "values", "to", "pass", "to", "String", "#", "replace", "linkFilter", ":", "[", "[", "/<", "/", "g", ",", "\"", "&", "lt", ";", "\"]", "]", ",", "/", "/", "Override", "_Plugin", ".", "buttonClass", ".", "This", "plugin", "is", "controlled", "by", "a", "DropDownButton", "/", "/", "(", "which", "triggers", "a", "TooltipDialog", ")", ".", "buttonClass", ":", "DropDownButton", ",", "@", "@", "-", "252", ",", "6", "+", "268", ",", "16", "@", "@", "define", "(", "[", "if", "(", "args", "&", "&", "args", ".", "urlInput", ")", "{", "args", ".", "urlInput", "=", "args", ".", "urlInput", ".", "replace", "(", "/\"", "/", "g", ",", "\"", "&", "quot", ";", "\")", ";", "}", "if", "(", "!", "this", ".", "allowUnsafeHtml", "&", "&", "args", "&", "&", "args", ".", "textInput", ")", "{", "if", "(", "typeof", "this", ".", "linkFilter", "=", "==", "'", "function", "'", "){", "args", ".", "textInput", "=", "this", ".", "linkFilter", "(", "args", ".", "textInput", ")", ";", "}", "else", "{", "array", ".", "forEach", "(", "this", ".", "linkFilter", ",", "function", "(", "currentFilter", ")", "{", "args", ".", "textInput", "=", "args", ".", "textInput", ".", "replace", "(", "currentFilter", "[", "0", "]", ",", "currentFilter", "[", "1", "]", ");", "}", ");", "}", "}", "return", "args", ";", "}", ",", "@", "@", "-", "629", ",", "8", "+", "655", ",", "15", "@", "@", "define", "(", "[", "}", ");", "/", "/", "Register", "these", "plugins", "_Plugin", ".", "registry", "[", "\"", "createLink", "\"", "]", "=", "function", "(", "){", "return", "new", "LinkDialog", "(", "{", "command", ":", "\"", "createLink", "\"", "})", ";", "_Plugin", ".", "registry", "[", "\"", "createLink", "\"", "]", "=", "function", "(", "args", ")", "{", "var", "pluginOptions", "=", "{", "command", ":", "\"", "createLink", "\"", ",", "allowUnsafeHtml", ":", "(", "\"", "allowUnsafeHtml", "\"", "in", "args", ")", "?", "args", ".", "allowUnsafeHtml", ":", "false", "}", ";", "if", "(", "\"", "linkFilter", "\"", "in", "args", ")", "{", "pluginOptions", ".", "linkFilter", "=", "args", ".", "linkFilter", ";", "}", "return", "new", "LinkDialog", "(", "pluginOptions", ")", ";", "}", ";", "_Plugin", ".", "registry", "[", "\"", "insertImage", "\"", "]", "=", "function", "(", "){", "return", "new", "ImgLinkDialog", "(", "{", "command", ":", "\"", "insertImage", "\"", "})", ";", "@", "@", "-", "7", ",", "6", "+", "7", ",", "10", "@", "@", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", "src", "=", "\".", "./", "boilerplate", ".", "js", "\"", "><", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "function", "filterLink", "(", ")", "{", "return", "'", "Filtered", "Value", "'", ";", "}", "require", "(", "[", "\"", "dojo", "/", "parser", "\"", ",", "\"", "dijit", "/", "Editor", "\"", ",", "@", "@", "-", "36", ",", "6", "+", "40", ",", "22", "@", "@", "<", "/", "div", ">", "<", "/", "div", ">", "<", "p", ">", "Editor", "with", "<", "code", ">", "allowUnsafeHtml", "<", "/", "code", ">", "set", "to", "<", "code", ">", "true", "<", "/", "code", ">", "</", "p", ">", "<", "div", "style", "=", "\"", "border", ":", "1px", "dotted", "black", ";", "\">", "<", "div", "id", "=", "\"", "editorUnsafe", "\"", "data", "-", "dojo", "-", "type", "=", "\"", "dijit", "/", "Editor", "\"", "data", "-", "dojo", "-", "props", "=", "'\"", "aria", "-", "label", "\"", ":\"", "editor", "\"", ",", "extraPlugins", ":", "[{", "name", ":", "\"", "createLink", "\"", ",", "allowUnsafeHtml", ":", "true", "}", ",", "\"", "insertImage", "\"", ",", "\"", "viewSource", "\"", "]'", ">", "<", "p", ">", "This", "editor", "will", "allow", "unrestricted", "HTML", "in", "the", "Description", "field", "of", "links", "<", "/", "p", ">", "<", "br", ">", "<", "/", "div", ">", "<", "/", "div", ">", "<", "p", ">", "Editor", "with", "custom", "<", "code", ">", "linkFilter", "<", "/", "code", ">", "function", "<", "/", "p", ">", "<", "div", "style", "=", "\"", "border", ":", "1px", "dotted", "black", ";", "\">", "<", "div", "id", "=", "\"", "editorLinkFilter", "\"", "data", "-", "dojo", "-", "type", "=", "\"", "dijit", "/", "Editor", "\"", "data", "-", "dojo", "-", "props", "=", "'\"", "aria", "-", "label", "\"", ":\"", "editor", "\"", ",", "extraPlugins", ":", "[{", "name", ":", "\"", "createLink", "\"", ",", "linkFilter", ":", "filterLink", "}", ",", "\"", "insertImage", "\"", ",", "\"", "viewSource", "\"", "]'", ">", "<", "p", ">", "Links", "created", "in", "this", "editor", "will", "always", "have", "a", "description", "of", "\"", "Filtered", "Value", "\"", ",", "which", "is", "the", "value", "returned", "by", "the", "custom", "<", "code", ">", "linkFilter", "<", "/", "code", ">", "function", ".", "</", "p", ">", "<", "br", ">", "<", "/", "div", ">", "<", "/", "div", ">", "<", "p", ">", "RTL", "Editor", ":", "</", "p", ">", "<", "div", "style", "=", "\"", "border", ":", "1px", "dotted", "black", ";", "\">", "<", "div", "id", "=", "\"", "reditor", "\"", "data", "-", "dojo", "-", "type", "=", "\"", "dijit", "/", "Editor", "\"", "dir", "=", "\"", "rtl", "\"", "data", "-", "dojo", "-", "props", "=", "'\"", "aria", "-", "label", "\"", ":\"", "reditor", "\"", ",", "extraPlugins", ":", "[\"", "createLink", "\"", ",", "\"", "insertImage", "\"", "]'", ">"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "16", ",", "32", "+", "16", ",", "33", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "activemq", ".", "filter", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "org", ".", "apache", ".", "activemq", ".", "command", ".", "Message", ";", "import", "org", ".", "apache", ".", "activemq", ".", "util", ".", "ByteArrayInputStream", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "javax", ".", "jms", ".", "BytesMessage", ";", "import", "javax", ".", "jms", ".", "JMSException", ";", "import", "javax", ".", "jms", ".", "TextMessage", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPath", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathConstants", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathExpressionException", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathFactory", ";", "import", "org", ".", "apache", ".", "activemq", ".", "command", ".", "Message", ";", "import", "org", ".", "apache", ".", "activemq", ".", "util", ".", "ByteArrayInputStream", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "java", ".", "io", ".", "StringReader", ";", "public", "class", "JAXPXPathEvaluator", "implements", "XPathExpression", ".", "XPathEvaluator", "{", "private", "static", "final", "XPathFactory", "FACTORY", "=", "XPathFactory", ".", "newInstance", "(", ");", "private", "final", "javax", ".", "xml", ".", "xpath", ".", "XPathExpression", "expression", ";", "private", "final", "String", "xpathExpression", ";", "private", "final", "DocumentBuilder", "builder", ";", "private", "final", "XPath", "xpath", "=", "FACTORY", ".", "newXPath", "(", ");", "public", "JAXPXPathEvaluator", "(", "String", "xpathExpression", ")", "{", "public", "JAXPXPathEvaluator", "(", "String", "xpathExpression", ",", "DocumentBuilder", "builder", ")", "throws", "Exception", "{", "this", ".", "xpathExpression", "=", "xpathExpression", ";", "try", "{", "XPath", "xpath", "=", "FACTORY", ".", "newXPath", "(", ");", "expression", "=", "xpath", ".", "compile", "(", "xpathExpression", ")", ";", "}", "catch", "(", "XPathExpressionException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "Invalid", "XPath", "expression", ":", "\"", "+", "xpathExpression", ")", ";", "if", "(", "builder", "!", "=", "null", ")", "{", "this", ".", "builder", "=", "builder", ";", "}", "else", "{", "throw", "new", "RuntimeException", "(", "\"", "No", "document", "builder", "available", "\"", ");", "}", "}", "@", "@", "-", "61", ",", "17", "+", "62", ",", "19", "@", "@", "public", "boolean", "evaluate", "(", "Message", "message", ")", "throws", "JMSException", "{", "private", "boolean", "evaluate", "(", "byte", "[", "]", "data", ")", "{", "try", "{", "InputSource", "inputSource", "=", "new", "InputSource", "(", "new", "ByteArrayInputStream", "(", "data", ")", ");", "return", "(", "(", "Boolean", ")", "expression", ".", "evaluate", "(", "inputSource", ",", "XPathConstants", ".", "BOOLEAN", ")", ").", "booleanValue", "(", ");", "}", "catch", "(", "XPathExpressionException", "e", ")", "{", "Document", "inputDocument", "=", "builder", ".", "parse", "(", "inputSource", ")", ";", "return", "(", "(", "Boolean", ")", "xpath", ".", "evaluate", "(", "xpathExpression", ",", "inputDocument", ",", "XPathConstants", ".", "BOOLEAN", ")", ").", "booleanValue", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "return", "false", ";", "}", "}", "private", "boolean", "evaluate", "(", "String", "text", ")", "{", "try", "{", "InputSource", "inputSource", "=", "new", "InputSource", "(", "new", "StringReader", "(", "text", ")", ");", "return", "(", "(", "Boolean", ")", "expression", ".", "evaluate", "(", "inputSource", ",", "XPathConstants", ".", "BOOLEAN", ")", ").", "booleanValue", "(", ");", "}", "catch", "(", "XPathExpressionException", "e", ")", "{", "Document", "inputDocument", "=", "builder", ".", "parse", "(", "inputSource", ")", ";", "return", "(", "(", "Boolean", ")", "xpath", ".", "evaluate", "(", "xpathExpression", ",", "inputDocument", ",", "XPathConstants", ".", "BOOLEAN", ")", ").", "booleanValue", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "return", "false", ";", "}", "}", "@", "@", "-", "16", ",", "34", "+", "16", ",", "33", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "activemq", ".", "filter", ";", "import", "java", ".", "io", ".", "StringReader", ";", "import", "org", ".", "apache", ".", "activemq", ".", "command", ".", "Message", ";", "import", "org", ".", "apache", ".", "activemq", ".", "util", ".", "ByteArrayInputStream", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "javax", ".", "jms", ".", "BytesMessage", ";", "import", "javax", ".", "jms", ".", "JMSException", ";", "import", "javax", ".", "jms", ".", "TextMessage", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPath", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathConstants", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathExpressionException", ";", "import", "javax", ".", "xml", ".", "xpath", ".", "XPathFactory", ";", "import", "org", ".", "apache", ".", "activemq", ".", "command", ".", "Message", ";", "import", "org", ".", "apache", ".", "activemq", ".", "util", ".", "ByteArrayInputStream", ";", "import", "org", ".", "xml", ".", "sax", ".", "InputSource", ";", "import", "java", ".", "io", ".", "StringReader", ";", "public", "class", "XalanXPathEvaluator", "implements", "XPathExpression", ".", "XPathEvaluator", "{", "private", "static", "final", "XPathFactory", "FACTORY", "=", "XPathFactory", ".", "newInstance", "(", ");", "private", "final", "javax", ".", "xml", ".", "xpath", ".", "XPathExpression", "expression", ";", "private", "final", "String", "xpathExpression", ";", "private", "final", "DocumentBuilder", "builder", ";", "private", "final", "XPath", "xpath", "=", "FACTORY", ".", "newXPath", "(", ");", "public", "XalanXPathEvaluator", "(", "String", "xpathExpression", ")", "{", "public", "XalanXPathEvaluator", "(", "String", "xpathExpression", ",", "DocumentBuilder", "builder", ")", "throws", "Exception", "{", "this", ".", "xpathExpression", "=", "xpathExpression", ";", "try", "{", "XPath", "xpath", "=", "FACTORY", ".", "newXPath", "(", ");", "expression", "=", "xpath", ".", "compile", "(", "xpathExpression", ")", ";", "}", "catch", "(", "XPathExpressionException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "Invalid", "XPath", "expression", ":", "\"", "+", "xpathExpression", ")", ";", "if", "(", "builder", "!", "=", "null", ")", "{", "this", ".", "builder", "=", "builder", ";", "}", "else", "{", "throw", "new", "RuntimeException", "(", "\"", "No", "document", "builder", "available", "\"", ");", "}", "}", "@", "@", "-", "63", ",", "17", "+", "62", ",", "19", "@", "@", "public", "boolean", "evaluate", "(", "Message", "message", ")", "throws", "JMSException", "{", "private", "boolean", "evaluate", "(", "byte", "[", "]", "data", ")", "{", "try", "{", "InputSource", "inputSource", "=", "new", "InputSource", "(", "new", "ByteArrayInputStream", "(", "data", ")", ");", "return", "(", "(", "Boolean", ")", "expression", ".", "evaluate", "(", "inputSource", ",", "XPathConstants", ".", "BOOLEAN", ")", ").", "booleanValue", "(", ");", "}", "catch", "(", "XPathExpressionException", "e", ")", "{", "Document", "inputDocument", "=", "builder", ".", "parse", "(", "inputSource", ")", ";", "return", "(", "(", "Boolean", ")", "xpath", ".", "evaluate", "(", "xpathExpression", ",", "inputDocument", ",", "XPathConstants", ".", "BOOLEAN", ")", ").", "booleanValue", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "return", "false", ";", "}", "}", "private", "boolean", "evaluate", "(", "String", "text", ")", "{", "try", "{", "InputSource", "inputSource", "=", "new", "InputSource", "(", "new", "StringReader", "(", "text", ")", ");", "return", "(", "(", "Boolean", ")", "expression", ".", "evaluate", "(", "inputSource", ",", "XPathConstants", ".", "BOOLEAN", ")", ").", "booleanValue", "(", ");", "}", "catch", "(", "XPathExpressionException", "e", ")", "{", "Document", "inputDocument", "=", "builder", ".", "parse", "(", "inputSource", ")", ";", "return", "(", "(", "Boolean", ")", "xpath", ".", "evaluate", "(", "xpathExpression", ",", "inputDocument", ",", "XPathConstants", ".", "BOOLEAN", ")", ").", "booleanValue", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "return", "false", ";", "}", "}", "@", "@", "-", "19", ",", "8", "+", "19", ",", "15", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Constructor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "javax", ".", "jms", ".", "JMSException", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "ParserConfigurationException", ";", "import", "org", ".", "apache", ".", "activemq", ".", "command", ".", "Message", ";", "import", "org", ".", "apache", ".", "activemq", ".", "util", ".", "JMSExceptionSupport", ";", "@", "@", "-", "35", ",", "15", "+", "42", ",", "32", "@", "@", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "XPathExpression", ".", "class", ")", ";", "private", "static", "final", "String", "EVALUATOR_SYSTEM_PROPERTY", "=", "\"", "org", ".", "apache", ".", "activemq", ".", "XPathEvaluatorClassName", "\"", ";", "private", "static", "final", "String", "DEFAULT_EVALUATOR_CLASS_NAME", "=", "\"", "org", ".", "apache", ".", "activemq", ".", "filter", ".", "XalanXPathEvaluator", "\"", ";", "public", "static", "final", "String", "DOCUMENT_BUILDER_FACTORY_FEATURE", "=", "\"", "org", ".", "apache", ".", "activemq", ".", "documentBuilderFactory", ".", "feature", "\"", ";", "private", "static", "final", "Constructor", "EVALUATOR_CONSTRUCTOR", ";", "private", "static", "DocumentBuilder", "builder", "=", "null", ";", "static", "{", "String", "cn", "=", "System", ".", "getProperty", "(", "EVALUATOR_SYSTEM_PROPERTY", ",", "DEFAULT_EVALUATOR_CLASS_NAME", ")", ";", "Constructor", "m", "=", "null", ";", "try", "{", "try", "{", "m", "=", "getXPathEvaluatorConstructor", "(", "cn", ")", ";", "DocumentBuilderFactory", "builderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "builderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "builderFactory", ".", "setIgnoringElementContentWhitespace", "(", "true", ")", ";", "builderFactory", ".", "setIgnoringComments", "(", "true", ")", ";", "try", "{", "/", "/", "set", "some", "reasonable", "defaults", "builderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ",", "false", ")", ";", "builderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ",", "false", ")", ";", "builderFactory", ".", "setFeature", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ",", "true", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "Error", "setting", "document", "builder", "factory", "feature", "\"", ",", "e", ")", ";", "}", "/", "/", "setup", "the", "feature", "from", "the", "system", "property", "setupFeatures", "(", "builderFactory", ")", ";", "builder", "=", "builderFactory", ".", "newDocumentBuilder", "(", ");", "}", "catch", "(", "Throwable", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "Invalid", "\"", "+", "XPathEvaluator", ".", "class", ".", "getName", "(", ")", "+", "\"", "implementation", ":", "\"", "+", "cn", "+", "\"", ",", "reason", ":", "\"", "+", "e", ",", "e", ")", ";", "cn", "=", "DEFAULT_EVALUATOR_CLASS_NAME", ";", "@", "@", "-", "75", ",", "12", "+", "99", ",", "41", "@", "@", "private", "static", "Constructor", "getXPathEvaluatorConstructor", "(", "String", "cn", ")", "throws", "ClassN", "if", "(", "!", "XPathEvaluator", ".", "class", ".", "isAssignableFrom", "(", "c", ")", ")", "{", "throw", "new", "ClassCastException", "(", "\"\"", "+", "c", "+", "\"", "is", "not", "an", "instance", "of", "\"", "+", "XPathEvaluator", ".", "class", ")", ";", "}", "return", "c", ".", "getConstructor", "(", "new", "Class", "[", "]", "{", "String", ".", "class", "}", ");", "return", "c", ".", "getConstructor", "(", "new", "Class", "[", "]", "{", "String", ".", "class", ",", "DocumentBuilder", ".", "class", "}", ");", "}", "protected", "static", "void", "setupFeatures", "(", "DocumentBuilderFactory", "factory", ")", "{", "Properties", "properties", "=", "System", ".", "getProperties", "(", ");", "List", "<", "String", ">", "features", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "for", "(", "Map", ".", "Entry", "<", "Object", ",", "Object", ">", "prop", ":", "properties", ".", "entrySet", "(", "))", "{", "String", "key", "=", "(", "String", ")", "prop", ".", "getKey", "(", ");", "if", "(", "key", ".", "startsWith", "(", "DOCUMENT_BUILDER_FACTORY_FEATURE", ")", ")", "{", "String", "uri", "=", "key", ".", "split", "(", "DOCUMENT_BUILDER_FACTORY_FEATURE", "+", "\"", ":\"", ")[", "1", "]", ";", "Boolean", "value", "=", "Boolean", ".", "valueOf", "(", "(", "String", ")", "prop", ".", "getValue", "(", "))", ";", "try", "{", "factory", ".", "setFeature", "(", "uri", ",", "value", ")", ";", "features", ".", "add", "(", "\"", "feature", "\"", "+", "uri", "+", "\"", "value", "\"", "+", "value", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "DocumentBuilderFactory", "doesn", "'", "t", "support", "the", "feature", "{", "}", "with", "value", "{", "},", "due", "to", "{", "}.", "\",", "new", "Object", "[", "]{", "uri", ",", "value", ",", "e", "}", ");", "}", "}", "}", "if", "(", "features", ".", "size", "(", ")", ">", "0", ")", "{", "StringBuffer", "featureString", "=", "new", "StringBuffer", "(", ");", "/", "/", "just", "log", "the", "configured", "feature", "for", "(", "String", "feature", ":", "features", ")", "{", "if", "(", "featureString", ".", "length", "(", ")", "!", "=", "0", ")", "{", "featureString", ".", "append", "(", "\",", "\"", ");", "}", "featureString", ".", "append", "(", "feature", ")", ";", "}", "}", "}", "private", "XPathEvaluator", "createEvaluator", "(", "String", "xpath2", ")", "{", "try", "{", "return", "(", "XPathEvaluator", ")", "EVALUATOR_CONSTRUCTOR", ".", "newInstance", "(", "new", "Object", "[", "]", "{", "xpath", "}", ");", "return", "(", "XPathEvaluator", ")", "EVALUATOR_CONSTRUCTOR", ".", "newInstance", "(", "new", "Object", "[", "]", "{", "xpath", ",", "builder", "}", ");", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "Throwable", "cause", "=", "e", ".", "getCause", "(", ");", "if", "(", "cause", "instanceof", "RuntimeException", ")", "{"], "docstring_tokens": ["xml", "external", "entity", "injection", "(xxe", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1548", ",", "21", "+", "1548", ",", "21", "@", "@", "static", "void", "*", "zend_mm_realloc_heap", "(", "zend_mm_heap", "*", "heap", ",", "void", "*", "ptr", ",", "size_t", "size", ",", "si", "ZEND_MM_CHECK", "(", "chunk", "-", ">", "heap", "=", "=", "heap", ",", "\"", "zend_mm_heap", "corrupted", "\"", ");", "if", "(", "info", "&", "ZEND_MM_IS_SRUN", ")", "{", "int", "old_bin_num", ",", "bin_num", ";", "old_bin_num", "=", "ZEND_MM_SRUN_BIN_NUM", "(", "info", ")", ";", "int", "old_bin_num", "=", "ZEND_MM_SRUN_BIN_NUM", "(", "info", ")", ";", "old_size", "=", "bin_data_size", "[", "old_bin_num", "]", ";", "bin_num", "=", "ZEND_MM_SMALL_SIZE_TO_BIN", "(", "size", ")", ";", "if", "(", "old_bin_num", "=", "=", "bin_num", ")", "{", "if", "(", "size", "<", "=", "ZEND_MM_MAX_SMALL_SIZE", ")", "{", "int", "bin_num", "=", "ZEND_MM_SMALL_SIZE_TO_BIN", "(", "size", ")", ";", "if", "(", "old_bin_num", "=", "=", "bin_num", ")", "{", "#", "if", "ZEND_DEBUG", "dbg", "=", "zend_mm_get_debug_info", "(", "heap", ",", "ptr", ")", ";", "dbg", "-", ">", "size", "=", "real_size", ";", "dbg", "-", ">", "filename", "=", "__zend_filename", ";", "dbg", "-", ">", "orig_filename", "=", "__zend_orig_filename", ";", "dbg", "-", ">", "lineno", "=", "__zend_lineno", ";", "dbg", "-", ">", "orig_lineno", "=", "__zend_orig_lineno", ";", "dbg", "=", "zend_mm_get_debug_info", "(", "heap", ",", "ptr", ")", ";", "dbg", "-", ">", "size", "=", "real_size", ";", "dbg", "-", ">", "filename", "=", "__zend_filename", ";", "dbg", "-", ">", "orig_filename", "=", "__zend_orig_filename", ";", "dbg", "-", ">", "lineno", "=", "__zend_lineno", ";", "dbg", "-", ">", "orig_lineno", "=", "__zend_orig_lineno", ";", "#", "endif", "return", "ptr", ";", "return", "ptr", ";", "}", "}", "}", "else", "/", "*", "if", "(", "info", "&", "ZEND_MM_IS_LARGE_RUN", ")", "*", "/", "{", "ZEND_MM_CHECK", "(", "ZEND_MM_ALIGNED_OFFSET", "(", "page_offset", ",", "ZEND_MM_PAGE_SIZE", ")", "=", "=", "0", ",", "\"", "zend_mm_heap", "corrupted", "\"", ");"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "42", ",", "7", "+", "42", ",", "7", "@", "@", "public", "FormattedServiceListWriter", "(", "String", "styleSheetPath", ",", "String", "title", ",", "boolean", "showForeignContexts", ",", "Bus", "bus", ")", "{", "this", ".", "styleSheetPath", "=", "styleSheetPath", ";", "this", ".", "styleSheetPath", "=", "StringEscapeUtils", ".", "escapeHtml4", "(", "styleSheetPath", ")", ";", "this", ".", "title", "=", "title", ";", "this", ".", "showForeignContexts", "=", "showForeignContexts", ";", "this", ".", "bus", "=", "bus", ";"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "53", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "spark", ".", "launcher", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "/", "**", "*", "An", "object", "input", "stream", "that", "only", "allows", "classes", "used", "by", "the", "launcher", "protocol", "to", "be", "in", "the", "*", "serialized", "stream", ".", "See", "SPARK", "-", "20922", ".", "*", "/", "class", "FilteredObjectInputStream", "extends", "ObjectInputStream", "{", "private", "static", "final", "List", "<", "String", ">", "ALLOWED_PACKAGES", "=", "Arrays", ".", "asList", "(", "\"", "org", ".", "apache", ".", "spark", ".", "launcher", ".", "\",", "\"", "java", ".", "lang", ".", "\")", ";", "FilteredObjectInputStream", "(", "InputStream", "is", ")", "throws", "IOException", "{", "super", "(", "is", ")", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "boolean", "isValid", "=", "ALLOWED_PACKAGES", ".", "stream", "(", ").", "anyMatch", "(", "p", "-", ">", "desc", ".", "getName", "(", ").", "startsWith", "(", "p", ")", ");", "if", "(", "!", "isValid", ")", "{", "throw", "new", "IllegalArgumentException", "(", "String", ".", "format", "(", "\"", "Unexpected", "class", "in", "stream", ":", "%", "s", "\"", ",", "desc", ".", "getName", "(", "))", ");", "}", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "}", "@", "@", "-", "20", ",", "7", "+", "20", ",", "6", "@", "@", "import", "java", ".", "io", ".", "Closeable", ";", "import", "java", ".", "io", ".", "EOFException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectOutputStream", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "util", ".", "logging", ".", "Level", ";", "@", "@", "-", "53", ",", "7", "+", "52", ",", "7", "@", "@", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "ObjectInputStream", "in", "=", "new", "ObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "FilteredObjectInputStream", "in", "=", "new", "FilteredObjectInputStream", "(", "socket", ".", "getInputStream", "(", "))", ";", "while", "(", "!", "closed", ")", "{", "Message", "msg", "=", "(", "Message", ")", "in", ".", "readObject", "(", ");", "handle", "(", "msg", ")", ";", "@", "@", "-", "19", ",", "8", "+", "19", ",", "11", "@", "@", "import", "java", ".", "io", ".", "Closeable", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "BlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "LinkedBlockingQueue", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Semaphore", ";", "@", "@", "-", "120", ",", "31", "+", "123", ",", "7", "@", "@", "public", "void", "testTimeout", "(", ")", "throws", "Exception", "{", "Socket", "s", "=", "new", "Socket", "(", "InetAddress", ".", "getLoopbackAddress", "(", "),", "LauncherServer", ".", "getServerInstance", "(", ").", "getPort", "(", "))", ";", "client", "=", "new", "TestClient", "(", "s", ")", ";", "/", "/", "Try", "a", "few", "times", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "server", "-", "side", "close", "/", "/", "immediately", ".", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "handle", ".", "getSecret", "(", "),", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "exception", "caused", "by", "connection", "timeout", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "}", "finally", "{", "SparkLauncher", ".", "launcherConfig", ".", "remove", "(", "SparkLauncher", ".", "CHILD_CONNECTION_TIMEOUT", ")", ";", "kill", "(", "handle", ")", ";", "@", "@", "-", "183", ",", "6", "+", "162", ",", "25", "@", "@", "public", "void", "infoChanged", "(", "SparkAppHandle", "handle", ")", "{", "}", "}", "@", "Test", "public", "void", "testStreamFiltering", "(", ")", "throws", "Exception", "{", "ChildProcAppHandle", "handle", "=", "LauncherServer", ".", "newAppHandle", "(", ");", "TestClient", "client", "=", "null", ";", "try", "{", "Socket", "s", "=", "new", "Socket", "(", "InetAddress", ".", "getLoopbackAddress", "(", "),", "LauncherServer", ".", "getServerInstance", "(", ").", "getPort", "(", "))", ";", "client", "=", "new", "TestClient", "(", "s", ")", ";", "client", ".", "send", "(", "new", "EvilPayload", "(", "))", ";", "waitForError", "(", "client", ",", "handle", ".", "getSecret", "(", "))", ";", "assertEquals", "(", "0", ",", "EvilPayload", ".", "EVIL_BIT", ")", ";", "}", "finally", "{", "kill", "(", "handle", ")", ";", "close", "(", "client", ")", ";", "client", ".", "clientThread", ".", "join", "(", ");", "}", "}", "private", "void", "kill", "(", "SparkAppHandle", "handle", ")", "{", "if", "(", "handle", "!", "=", "null", ")", "{", "handle", ".", "kill", "(", ");", "@", "@", "-", "199", ",", "6", "+", "197", ",", "35", "@", "@", "private", "void", "close", "(", "Closeable", "c", ")", "{", "}", "}", "/", "**", "*", "Try", "a", "few", "times", "to", "get", "a", "client", "-", "side", "error", ",", "since", "the", "client", "-", "side", "socket", "may", "not", "reflect", "the", "*", "server", "-", "side", "close", "immediately", ".", "*", "/", "private", "void", "waitForError", "(", "TestClient", "client", ",", "String", "secret", ")", "throws", "Exception", "{", "boolean", "helloSent", "=", "false", ";", "int", "maxTries", "=", "10", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "maxTries", ";", "i", "+", "+)", "{", "try", "{", "if", "(", "!", "helloSent", ")", "{", "client", ".", "send", "(", "new", "Hello", "(", "secret", ",", "\"", "1", ".", "4", ".", "0", "\"", "))", ";", "helloSent", "=", "true", ";", "}", "else", "{", "client", ".", "send", "(", "new", "SetAppId", "(", "\"", "appId", "\"", "))", ";", "}", "fail", "(", "\"", "Expected", "error", "but", "message", "went", "through", ".", "\")", ";", "}", "catch", "(", "IllegalStateException", "|", "IOException", "e", ")", "{", "/", "/", "Expected", ".", "break", ";", "}", "catch", "(", "AssertionError", "e", ")", "{", "if", "(", "i", "<", "maxTries", "-", "1", ")", "{", "Thread", ".", "sleep", "(", "100", ")", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "Test", "failed", "after", "\"", "+", "maxTries", "+", "\"", "attempts", ".", "\",", "e", ")", ";", "}", "}", "}", "}", "private", "static", "class", "TestClient", "extends", "LauncherConnection", "{", "final", "BlockingQueue", "<", "Message", ">", "inbound", ";", "@", "@", "-", "220", ",", "4", "+", "247", ",", "19", "@", "@", "protected", "void", "handle", "(", "Message", "msg", ")", "throws", "IOException", "{", "}", "private", "static", "class", "EvilPayload", "extends", "LauncherProtocol", ".", "Message", "{", "static", "int", "EVIL_BIT", "=", "0", ";", "/", "/", "This", "field", "should", "cause", "the", "launcher", "server", "to", "throw", "an", "error", "and", "not", "deserialize", "the", "/", "/", "message", ".", "private", "List", "<", "String", ">", "notAllowedField", "=", "Arrays", ".", "asList", "(", "\"", "disallowed", "\"", ");", "private", "void", "readObject", "(", "ObjectInputStream", "stream", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "stream", ".", "defaultReadObject", "(", ");", "EVIL_BIT", "=", "1", ";", "}", "}", "}"], "docstring_tokens": ["arbitrary", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "389", ",", "11", "+", "389", ",", "11", "@", "@", "int", "saa7164_bus_get", "(", "struct", "saa7164_dev", "*", "dev", ",", "struct", "tmComResInfo", "*", "msg", ",", "msg_tmp", ".", "size", "=", "le16_to_cpu", "(", "(", "__force", "__le16", ")", "msg_tmp", ".", "size", ")", ";", "msg_tmp", ".", "command", "=", "le32_to_cpu", "(", "(", "__force", "__le32", ")", "msg_tmp", ".", "command", ")", ";", "msg_tmp", ".", "controlselector", "=", "le16_to_cpu", "(", "(", "__force", "__le16", ")", "msg_tmp", ".", "controlselector", ")", ";", "memcpy", "(", "msg", ",", "&", "msg_tmp", ",", "sizeof", "(", "*", "msg", ")", ");", "/", "*", "No", "need", "to", "update", "the", "read", "positions", ",", "because", "this", "was", "a", "peek", "*", "/", "/", "*", "If", "the", "caller", "specifically", "want", "to", "peek", ",", "return", "*", "/", "if", "(", "peekonly", ")", "{", "memcpy", "(", "msg", ",", "&", "msg_tmp", ",", "sizeof", "(", "*", "msg", ")", ");", "goto", "peekout", ";", "}", "@", "@", "-", "438", ",", "21", "+", "438", ",", "15", "@", "@", "int", "saa7164_bus_get", "(", "struct", "saa7164_dev", "*", "dev", ",", "struct", "tmComResInfo", "*", "msg", ",", "space_rem", "=", "bus", "-", ">", "m_dwSizeGetRing", "-", "curr_grp", ";", "if", "(", "space_rem", "<", "sizeof", "(", "*", "msg", ")", ")", "{", "/", "*", "msg", "wraps", "around", "the", "ring", "*", "/", "memcpy_fromio", "(", "msg", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", ",", "space_rem", ")", ";", "memcpy_fromio", "(", "(", "u8", "*", ")", "msg", "+", "space_rem", ",", "bus", "-", ">", "m_pdwGetRing", ",", "sizeof", "(", "*", "msg", ")", "-", "space_rem", ")", ";", "if", "(", "buf", ")", "memcpy_fromio", "(", "buf", ",", "bus", "-", ">", "m_pdwGetRing", "+", "sizeof", "(", "*", "msg", ")", "-", "space_rem", ",", "buf_size", ")", ";", "}", "else", "if", "(", "space_rem", "=", "=", "sizeof", "(", "*", "msg", ")", ")", "{", "memcpy_fromio", "(", "msg", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", ",", "sizeof", "(", "*", "msg", ")", ");", "if", "(", "buf", ")", "memcpy_fromio", "(", "buf", ",", "bus", "-", ">", "m_pdwGetRing", ",", "buf_size", ")", ";", "}", "else", "{", "/", "*", "Additional", "data", "wraps", "around", "the", "ring", "*", "/", "memcpy_fromio", "(", "msg", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", ",", "sizeof", "(", "*", "msg", ")", ");", "if", "(", "buf", ")", "{", "memcpy_fromio", "(", "buf", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", "+", "sizeof", "(", "*", "msg", ")", ",", "space_rem", "-", "sizeof", "(", "*", "msg", ")", ");", "@", "@", "-", "465", ",", "15", "+", "459", ",", "10", "@", "@", "int", "saa7164_bus_get", "(", "struct", "saa7164_dev", "*", "dev", ",", "struct", "tmComResInfo", "*", "msg", ",", "}", "else", "{", "/", "*", "No", "wrapping", "*", "/", "memcpy_fromio", "(", "msg", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", ",", "sizeof", "(", "*", "msg", ")", ");", "if", "(", "buf", ")", "memcpy_fromio", "(", "buf", ",", "bus", "-", ">", "m_pdwGetRing", "+", "curr_grp", "+", "sizeof", "(", "*", "msg", ")", ",", "buf_size", ")", ";", "}", "/", "*", "Convert", "from", "little", "endian", "to", "CPU", "*", "/", "msg", "-", ">", "size", "=", "le16_to_cpu", "(", "(", "__force", "__le16", ")", "msg", "-", ">", "size", ")", ";", "msg", "-", ">", "command", "=", "le32_to_cpu", "(", "(", "__force", "__le32", ")", "msg", "-", ">", "command", ")", ";", "msg", "-", ">", "controlselector", "=", "le16_to_cpu", "(", "(", "__force", "__le16", ")", "msg", "-", ">", "controlselector", ")", ";", "/", "*", "Update", "the", "read", "positions", ",", "adjusting", "the", "ring", "*", "/", "saa7164_writel", "(", "bus", "-", ">", "m_dwGetReadPos", ",", "new_grp", ")", ";"], "docstring_tokens": ["out-of-bounds", "array", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "213", ",", "6", "+", "213", ",", "25", "@", "@", "Other", "Changes", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "8", ".", "3", ".", "1", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "Consult", "the", "LUCENE_CHANGES", ".", "txt", "file", "for", "additional", ",", "low", "level", ",", "changes", "in", "this", "release", ".", "Versions", "of", "Major", "Components", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "Apache", "Tika", "1", ".", "19", ".", "1", "Carrot2", "3", ".", "16", ".", "0", "Velocity", "2", ".", "0", "and", "Velocity", "Tools", "3", ".", "0", "Apache", "ZooKeeper", "3", ".", "5", ".", "5", "Jetty", "9", ".", "4", ".", "19", ".", "v20190610", "Upgrade", "Notes", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "*", "Velocity", "response", "writer", "is", "no", "longer", "available", "to", "be", "used", "through", "the", "_default", "configset", ".", "In", "order", "to", "use", "it", ",", "you", "would", "need", "to", "manually", "add", "it", "to", "your", "configset", ".", "Also", ",", "the", "initialization", "parameters", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", "and", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", "have", "been", "removed", "and", "replaced", "by", "startup", "parameters", "\"", "velocity", ".", "resourceloader", ".", "params", ".", "enabled", "\"", "and", "\"", "velocity", ".", "resourceloader", ".", "solr", ".", "enabled", "\"", "respectively", "(", "both", "turned", "off", "by", "default", ")", ".", "Please", "see", "SOLR", "-", "13971", "for", "more", "details", ".", "Bug", "Fixes", "@", "@", "-", "65", ",", "8", "+", "65", ",", "8", "@", "@", "public", "static", "final", "String", "PROPERTIES_FILE", "=", "\"", "init", ".", "properties", ".", "file", "\"", ";", "/", "/", "System", "property", "names", ",", "these", "are", "_only_", "loaded", "at", "node", "startup", "(", "no", "per", "-", "request", "control", "of", "these", ")", "public", "static", "final", "String", "PARAMS_RESOURCE_LOADER_ENABLED", "=", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ";", "public", "static", "final", "String", "SOLR_RESOURCE_LOADER_ENABLED", "=", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ";", "public", "static", "final", "String", "PARAMS_RESOURCE_LOADER_ENABLED", "=", "\"", "velocity", ".", "resourceloader", ".", "params", ".", "enabled", "\"", ";", "public", "static", "final", "String", "SOLR_RESOURCE_LOADER_ENABLED", "=", "\"", "velocity", ".", "resourceloader", ".", "solr", ".", "enabled", "\"", ";", "/", "/", "request", "param", "names", "public", "static", "final", "String", "TEMPLATE", "=", "\"", "v", ".", "template", "\"", ";", "@", "@", "-", "34", ",", "16", "+", "34", ",", "16", "@", "@", "public", "class", "VelocityResponseWriterTest", "extends", "SolrTestCaseJ4", "{", "@", "BeforeClass", "public", "static", "void", "beforeClass", "(", ")", "throws", "Exception", "{", "System", ".", "setProperty", "(", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ",", "\"", "true", "\"", ");", "System", ".", "setProperty", "(", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ",", "\"", "true", "\"", ");", "System", ".", "setProperty", "(", "\"", "velocity", ".", "resourceloader", ".", "params", ".", "enabled", "\"", ",", "\"", "true", "\"", ");", "System", ".", "setProperty", "(", "\"", "velocity", ".", "resourceloader", ".", "solr", ".", "enabled", "\"", ",", "\"", "true", "\"", ");", "initCore", "(", "\"", "solrconfig", ".", "xml", "\"", ",", "\"", "schema", ".", "xml", "\"", ",", "getFile", "(", "\"", "velocity", "/", "solr", "\"", ").", "getAbsolutePath", "(", "))", ";", "System", ".", "out", ".", "println", "(", "getFile", "(", "\"", "velocity", "/", "solr", "\"", ").", "getAbsolutePath", "(", "))", ";", "}", "@", "AfterClass", "public", "static", "void", "afterClass", "(", ")", "throws", "Exception", "{", "System", ".", "clearProperty", "(", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ");", "System", ".", "clearProperty", "(", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ");", "System", ".", "clearProperty", "(", "\"", "velocity", ".", "resourceloader", ".", "params", ".", "enabled", "\"", ");", "System", ".", "clearProperty", "(", "\"", "velocity", ".", "resourceloader", ".", "solr", ".", "enabled", "\"", ");", "}", "@", "Test", "@", "@", "-", "34", ",", "21", "+", "34", ",", "21", "@", "@", "Its", "JAR", "and", "dependencies", "must", "be", "added", "(", "via", "`", "<", "lib", ">", "`", "or", "solr", "/", "home", "lib", "inclusion", ")", ",", "<", "/", "queryResponseWriter", ">", "The", "above", "example", "shows", "the", "optional", "initialization", "and", "custom", "tool", "parameters", "used", "by", "VelocityResponseWriter", ";", "these", "are", "detailed", "in", "the", "following", "table", ".", "These", "initialization", "parameters", "are", "only", "specified", "in", "the", "writer", "registration", "in", "`", "solrconfig", ".", "xml", "`", ",", "not", "as", "request", "-", "time", "parameters", ".", "In", "this", "example", ",", "all", "Solr", "nodes", "should", "be", "started", "with", "`", "-", "Dparams", ".", "resource", ".", "loader", ".", "enabled", "=", "true", "`", ".", "See", "further", "below", "for", "request", "-", "time", "parameters", ".", "The", "above", "example", "shows", "the", "optional", "initialization", "and", "custom", "tool", "parameters", "used", "by", "VelocityResponseWriter", ";", "these", "are", "detailed", "in", "the", "following", "table", ".", "These", "initialization", "parameters", "are", "only", "specified", "in", "the", "writer", "registration", "in", "`", "solrconfig", ".", "xml", "`", ",", "not", "as", "request", "-", "time", "parameters", ".", "In", "this", "example", ",", "all", "Solr", "nodes", "should", "be", "started", "with", "`", "-", "Dvelocity", ".", "resourceloader", ".", "params", ".", "enabled", "=", "true", "-", "Dvelocity", ".", "resourceloader", ".", "enabled", "=", "true", "`", ".", "See", "further", "below", "for", "request", "-", "time", "parameters", ".", "=", "=", "Configuration", "&", "Usage", "=", "==", "VelocityResponseWriter", "Startup", "Parameters", "`", "params", ".", "resource", ".", "loader", ".", "enabled", "`", "::", "`", "velocity", ".", "resourceloader", ".", "params", ".", "enabled", "`", "::", "The", "\"", "params", "\"", "resource", "loader", "allows", "templates", "to", "be", "specified", "in", "Solr", "request", "parameters", ".", "For", "example", ":", "[", "source", ",", "bash", "]", "http", ":", "//", "localhost", ":", "8983", "/", "solr", "/", "gettingstarted", "/", "select", "?", "q", "=", "\\*", ":*", "&", "wt", "=", "velocity", "&", "v", ".", "template", "=", "custom", "&", "v", ".", "template", ".", "custom", "=", "CUSTOM", "%", "3A", "%", "20", "%", "23core_name", "where", "`", "v", ".", "template", "=", "custom", "`", "says", "to", "render", "a", "template", "called", "\"", "custom", "\"", "and", "the", "value", "of", "`", "v", ".", "template", ".", "custom", "`", "is", "the", "custom", "template", ".", "This", "is", "`", "false", "`", "by", "default", ";", "it", "'", "d", "be", "a", "niche", ",", "unusual", ",", "use", "case", "to", "need", "this", "enabled", ".", "`", "solr", ".", "resource", ".", "loader", ".", "enabled", "`", "::", "`", "velocity", ".", "resourceloader", ".", "solr", ".", "enabled", "`", "::", "The", "\"", "solr", "\"", "resource", "loader", "is", "the", "only", "template", "loader", "registered", "by", "default", ".", "Templates", "are", "served", "from", "resources", "visible", "to", "the", "SolrResourceLoader", "under", "a", "`", "velocity", "/", "`", "subdirectory", ".", "The", "VelocityResponseWriter", "itself", "has", "some", "built", "-", "in", "templates", "(", "in", "its", "JAR", "file", ",", "under", "`", "velocity", "/", "`)", "that", "are", "available", "automatically", "through", "this", "loader", ".", "These", "built", "-", "in", "templates", "can", "be", "overridden", "when", "the", "same", "template", "name", "is", "in", "conf", "/", "velocity", "/", "or", "by", "using", "the", "`", "template", ".", "base", ".", "dir", "`", "option", ".", "=", "==", "VelocityResponseWriter", "Initialization", "Parameters"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "655", ",", "6", "+", "655", ",", "9", "@", "@", "bsg_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "size_t", "count", ",", "loff_t", "*", "ppos", ")", "dprintk", "(", "\"%", "s", ":", "write", "%", "Zd", "bytes", "\\", "n", "\"", ",", "bd", "-", ">", "name", ",", "count", ")", ";", "if", "(", "unlikely", "(", "segment_eq", "(", "get_fs", "(", "),", "KERNEL_DS", ")", "))", "return", "-", "EINVAL", ";", "bsg_set_block", "(", "bd", ",", "file", ")", ";", "bytes_written", "=", "0", ";", "@", "@", "-", "581", ",", "6", "+", "581", ",", "9", "@", "@", "sg_write", "(", "struct", "file", "*", "filp", ",", "const", "char", "__user", "*", "buf", ",", "size_t", "count", ",", "loff_t", "*", "ppos", ")", "sg_io_hdr_t", "*", "hp", ";", "unsigned", "char", "cmnd", "[", "SG_MAX_CDB_SIZE", "]", ";", "if", "(", "unlikely", "(", "segment_eq", "(", "get_fs", "(", "),", "KERNEL_DS", ")", "))", "return", "-", "EINVAL", ";", "if", "(", "(!", "(", "sfp", "=", "(", "Sg_fd", "*", ")", "filp", "-", ">", "private_data", ")", ")", "|", "|", "(", "!(", "sdp", "=", "sfp", "-", ">", "parentdp", ")", "))", "return", "-", "ENXIO", ";", "SCSI_LOG_TIMEOUT", "(", "3", ",", "sg_printk", "(", "KERN_INFO", ",", "sdp", ","], "docstring_tokens": ["use-after-free", "error"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "188", ",", "7", "+", "188", ",", "7", "@", "@", "int", "ptrace_attach", "(", "struct", "task_struct", "*", "task", ")", "/", "*", "Protect", "exec", "'", "s", "credential", "calculations", "against", "our", "interference", ";", "*", "SUID", ",", "SGID", "and", "LSM", "creds", "get", "determined", "differently", "under", "ptrace", ".", "*", "/", "retval", "=", "mutex_lock_interruptible", "(", "&", "current", "-", ">", "cred_exec_mutex", ")", ";", "retval", "=", "mutex_lock_interruptible", "(", "&", "task", "-", ">", "cred_exec_mutex", ")", ";", "if", "(", "retval", "<", "0", ")", "goto", "out", ";", "@", "@", "-", "232", ",", "7", "+", "232", ",", "7", "@", "@", "int", "ptrace_attach", "(", "struct", "task_struct", "*", "task", ")", "bad", ":", "write_unlock_irqrestore", "(", "&", "tasklist_lock", ",", "flags", ")", ";", "task_unlock", "(", "task", ")", ";", "mutex_unlock", "(", "&", "current", "-", ">", "cred_exec_mutex", ")", ";", "mutex_unlock", "(", "&", "task", "-", ">", "cred_exec_mutex", ")", ";", "out", ":", "return", "retval", ";", "}"], "docstring_tokens": ["race", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "44", ",", "8", "+", "44", ",", "6", "@", "@", "static", "bool", "msr_mtrr_valid", "(", "unsigned", "msr", ")", "case", "MSR_MTRRdefType", ":", "case", "MSR_IA32_CR_PAT", ":", "return", "true", ";", "case", "0x2f8", ":", "return", "true", ";", "}", "return", "false", ";", "}"], "docstring_tokens": ["out-of-bounds", "r/w", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "54", ",", "7", "+", "54", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "final", "Result", "runResult", "=", "run", ".", "getResult", "(", ");", "if", "(", "run", "instanceof", "AbstractBuild", ")", "{", "Set", "<", "User", ">", "users", "=", "(", "(", "AbstractBuild", "<", "?,", "?>", ")", "run", ")", ".", "getCulprits", "(", ");", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "else", "if", "(", "runResult", "!", "=", "null", ")", "{", "List", "<", "Run", "<", "?,", "?", ">>", "builds", "=", "new", "ArrayList", "<", ">(", ");", "Run", "<", "?,", "?", ">", "build", "=", "run", ";", "@", "@", "-", "73", ",", "7", "+", "73", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "build", "=", "build", ".", "getPreviousCompletedBuild", "(", ");", "}", "Set", "<", "User", ">", "users", "=", "RecipientProviderUtilities", ".", "getChangeSetAuthors", "(", "builds", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "40", ",", "7", "+", "40", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "}", "final", "Debug", "debug", "=", "new", "Debug", "(", ");", "Set", "<", "User", ">", "users", "=", "RecipientProviderUtilities", ".", "getChangeSetAuthors", "(", "Collections", ".", "<", "Run", "<", "?,", "?", ">>", "singleton", "(", "context", ".", "getRun", "(", "))", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "@", "Extension", "@", "@", "-", "137", ",", "7", "+", "137", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "}", "if", "(", "users", "!", "=", "null", ")", "{", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "101", ",", "7", "+", "101", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "}", "}", "if", "(", "users", "!", "=", "null", ")", "{", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "users", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "28", ",", "11", "+", "28", ",", "14", "@", "@", "import", "hudson", ".", "EnvVars", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "import", "hudson", ".", "model", ".", "Cause", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "Run", ";", "import", "hudson", ".", "model", ".", "TaskListener", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "plugins", ".", "emailext", ".", "EmailRecipientUtils", ";", "import", "hudson", ".", "plugins", ".", "emailext", ".", "ExtendedEmailPublisherContext", ";", "import", "hudson", ".", "scm", ".", "ChangeLogSet", ";", "import", "hudson", ".", "tasks", ".", "MailSender", ";", "import", "javax", ".", "mail", ".", "internet", ".", "InternetAddress", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Field", ";", "@", "@", "-", "43", ",", "6", "+", "46", ",", "9", "@", "@", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "import", "org", ".", "acegisecurity", ".", "Authentication", ";", "import", "org", ".", "acegisecurity", ".", "userdetails", ".", "UsernameNotFoundException", ";", "public", "final", "class", "RecipientProviderUtilities", "{", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "RecipientProviderUtilities", ".", "class", ".", "getName", "(", "))", ";", "@", "@", "-", "153", ",", "14", "+", "159", ",", "48", "@", "@", "public", "static", "User", "getUserTriggeringTheBuild", "(", "final", "Run", "<", "?,", "?", ">", "run", ")", "{", "return", "user", ";", "}", "@", "Deprecated", "public", "static", "void", "addUsers", "(", "final", "Set", "<", "User", ">", "users", ",", "final", "TaskListener", "listener", ",", "final", "EnvVars", "env", ",", "final", "Set", "<", "InternetAddress", ">", "to", ",", "final", "Set", "<", "InternetAddress", ">", "cc", ",", "final", "Set", "<", "InternetAddress", ">", "bcc", ",", "final", "IDebug", "debug", ")", "{", "addUsers", "(", "users", ",", "listener", ",", "null", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "public", "static", "void", "addUsers", "(", "final", "Set", "<", "User", ">", "users", ",", "final", "ExtendedEmailPublisherContext", "context", ",", "final", "EnvVars", "env", ",", "final", "Set", "<", "InternetAddress", ">", "to", ",", "final", "Set", "<", "InternetAddress", ">", "cc", ",", "final", "Set", "<", "InternetAddress", ">", "bcc", ",", "final", "IDebug", "debug", ")", "{", "addUsers", "(", "users", ",", "context", ".", "getListener", "(", "),", "context", ".", "getRun", "(", "),", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "/", "**", "If", "set", ",", "send", "to", "known", "users", "who", "lack", "{", "@", "link", "Item", "#", "READ", "}", "access", "to", "the", "job", ".", "*", "/", "static", "/", "*", "not", "final", "*", "/", "boolean", "SEND_TO_USERS_WITHOUT_READ", "=", "Boolean", ".", "getBoolean", "(", "MailSender", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "SEND_TO_USERS_WITHOUT_READ", "\"", ");", "/", "**", "If", "set", ",", "send", "to", "unknown", "users", ".", "*", "/", "static", "/", "*", "not", "final", "*", "/", "boolean", "SEND_TO_UNKNOWN_USERS", "=", "Boolean", ".", "getBoolean", "(", "MailSender", ".", "class", ".", "getName", "(", ")", "+", "\"", ".", "SEND_TO_UNKNOWN_USERS", "\"", ");", "private", "static", "void", "addUsers", "(", "final", "Set", "<", "User", ">", "users", ",", "final", "TaskListener", "listener", ",", "@", "CheckForNull", "Run", "<", "?,", "?>", "run", ",", "final", "EnvVars", "env", ",", "final", "Set", "<", "InternetAddress", ">", "to", ",", "final", "Set", "<", "InternetAddress", ">", "cc", ",", "final", "Set", "<", "InternetAddress", ">", "bcc", ",", "final", "IDebug", "debug", ")", "{", "for", "(", "final", "User", "user", ":", "users", ")", "{", "if", "(", "EmailRecipientUtils", ".", "isExcludedRecipient", "(", "user", ",", "listener", ")", ")", "{", "debug", ".", "send", "(", "\"", "User", "%", "s", "is", "an", "excluded", "recipient", ".", "\",", "user", ".", "getFullName", "(", "))", ";", "}", "else", "{", "final", "String", "userAddress", "=", "EmailRecipientUtils", ".", "getUserConfiguredEmail", "(", "user", ")", ";", "if", "(", "userAddress", "!", "=", "null", ")", "{", "try", "{", "Authentication", "auth", "=", "user", ".", "impersonate", "(", ");", "if", "(", "run", "!", "=", "null", "&", "&", "!", "run", ".", "getACL", "(", ").", "hasPermission", "(", "auth", ",", "Item", ".", "READ", ")", ")", "{", "if", "(", "SEND_TO_USERS_WITHOUT_READ", ")", "{", "listener", ".", "getLogger", "(", ").", "printf", "(", "\"", "Warning", ":", "user", "%", "s", "has", "no", "permission", "to", "view", "%", "s", ",", "but", "sending", "mail", "anyway", "%", "n", "\"", ",", "userAddress", ",", "run", ".", "getFullDisplayName", "(", "))", ";", "}", "else", "{", "listener", ".", "getLogger", "(", ").", "printf", "(", "\"", "Not", "sending", "mail", "to", "user", "%", "s", "with", "no", "permission", "to", "view", "%", "s", "\"", ",", "userAddress", ",", "run", ".", "getFullDisplayName", "(", "))", ";", "continue", ";", "}", "}", "}", "catch", "(", "UsernameNotFoundException", "x", ")", "{", "if", "(", "SEND_TO_UNKNOWN_USERS", ")", "{", "listener", ".", "getLogger", "(", ").", "printf", "(", "\"", "Warning", ":", "%", "s", "is", "not", "a", "recognized", "user", ",", "but", "sending", "mail", "anyway", "%", "n", "\"", ",", "userAddress", ")", ";", "}", "else", "{", "listener", ".", "getLogger", "(", ").", "printf", "(", "\"", "Not", "sending", "mail", "to", "unregistered", "user", "%", "s", "%", "n", "\"", ",", "userAddress", ")", ";", "continue", ";", "}", "}", "debug", ".", "send", "(", "\"", "Adding", "%", "s", "with", "address", "%", "s", "\"", ",", "user", ".", "getFullName", "(", "),", "userAddress", ")", ";", "EmailRecipientUtils", ".", "addAddressesFromRecipientList", "(", "to", ",", "cc", ",", "bcc", ",", "userAddress", ",", "env", ",", "listener", ")", ";", "}", "else", "{", "@", "@", "-", "55", ",", "15", "+", "55", ",", "15", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "cur", "=", "p", ".", "getBuildByNumber", "(", "upc", ".", "getUpstreamBuild", "(", "))", ";", "upc", "=", "cur", ".", "getCause", "(", "Cause", ".", "UpstreamCause", ".", "class", ")", ";", "}", "addUserTriggeringTheBuild", "(", "cur", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ".", "getListener", "(", "),", "debug", ")", ";", "addUserTriggeringTheBuild", "(", "cur", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ",", "debug", ")", ";", "}", "private", "static", "void", "addUserTriggeringTheBuild", "(", "Run", "<", "?,", "?", ">", "run", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "TaskListener", "listener", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "final", "ExtendedEmailPublisherContext", "context", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "final", "User", "user", "=", "RecipientProviderUtilities", ".", "getUserTriggeringTheBuild", "(", "run", ")", ";", "if", "(", "user", "!", "=", "null", ")", "{", "RecipientProviderUtilities", ".", "addUsers", "(", "Collections", ".", "singleton", "(", "user", ")", ",", "listener", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "Collections", ".", "singleton", "(", "user", ")", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "6", ",", "7", "+", "6", ",", "6", "@", "@", "import", "hudson", ".", "model", ".", "Cause", ";", "import", "hudson", ".", "model", ".", "Job", ";", "import", "hudson", ".", "model", ".", "Run", ";", "import", "hudson", ".", "model", ".", "TaskListener", ";", "import", "hudson", ".", "model", ".", "User", ";", "import", "hudson", ".", "plugins", ".", "emailext", ".", "ExtendedEmailPublisherContext", ";", "import", "hudson", ".", "plugins", ".", "emailext", ".", "ExtendedEmailPublisherDescriptor", ";", "@", "@", "-", "60", ",", "7", "+", "59", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "}", "cur", "=", "p", ".", "getBuildByNumber", "(", "upc", ".", "getUpstreamBuild", "(", "))", ";", "upc", "=", "cur", ".", "getCause", "(", "Cause", ".", "UpstreamCause", ".", "class", ")", ";", "addUpstreamCommittersTriggeringBuild", "(", "cur", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ".", "getListener", "(", "),", "debug", ")", ";", "addUpstreamCommittersTriggeringBuild", "(", "cur", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ",", "debug", ")", ";", "}", "}", "@", "@", "-", "74", ",", "7", "+", "73", ",", "7", "@", "@", "public", "void", "send", "(", "final", "String", "format", ",", "final", "Object", ".", "..", "args", ")", "{", "*", "@", "param", "env", "*", "@", "param", "listener", "*", "/", "private", "void", "addUpstreamCommittersTriggeringBuild", "(", "Run", "<", "?,", "?", ">", "build", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "TaskListener", "listener", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "private", "void", "addUpstreamCommittersTriggeringBuild", "(", "Run", "<", "?,", "?", ">", "build", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "final", "ExtendedEmailPublisherContext", "context", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "debug", ".", "send", "(", "\"", "Adding", "upstream", "committer", "from", "job", "%", "s", "with", "build", "number", "%", "s", "\"", ",", "build", ".", "getParent", "(", ").", "getDisplayName", "(", "),", "build", ".", "getNumber", "(", "))", ";", "List", "<", "ChangeLogSet", "<", "?>", ">", "changeSets", "=", "new", "ArrayList", "<", ">(", ");", "@", "@", "-", "87", ",", "14", "+", "86", ",", "14", "@", "@", "private", "void", "addUpstreamCommittersTriggeringBuild", "(", "Run", "<", "?,", "?", ">", "build", ",", "Set", "<", "InternetA", "Method", "m", "=", "build", ".", "getClass", "(", ").", "getMethod", "(", "\"", "getChangeSets", "\"", ");", "changeSets", "=", "(", "List", "<", "ChangeLogSet", "<", "?", "extends", "ChangeLogSet", ".", "Entry", ">", ">)", "m", ".", "invoke", "(", "build", ")", ";", "}", "catch", "(", "NoSuchMethodException", "|", "InvocationTargetException", "|", "IllegalAccessException", "e", ")", "{", "listener", ".", "getLogger", "(", ").", "print", "(", "\"", "Could", "not", "add", "upstream", "committers", ",", "build", "type", "does", "not", "provide", "change", "set", "\"", ");", "context", ".", "getListener", "(", ").", "getLogger", "(", ").", "print", "(", "\"", "Could", "not", "add", "upstream", "committers", ",", "build", "type", "does", "not", "provide", "change", "set", "\"", ");", "}", "}", "if", "(", "!", "changeSets", ".", "isEmpty", "(", "))", "{", "for", "(", "ChangeLogSet", "<", "?", "extends", "ChangeLogSet", ".", "Entry", ">", "changeSet", ":", "changeSets", ")", "{", "for", "(", "ChangeLogSet", ".", "Entry", "change", ":", "changeSet", ")", "{", "addUserFromChangeSet", "(", "change", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "listener", ",", "debug", ")", ";", "addUserFromChangeSet", "(", "change", ",", "to", ",", "cc", ",", "bcc", ",", "env", ",", "context", ",", "debug", ")", ";", "}", "}", "}", "@", "@", "-", "109", ",", "9", "+", "108", ",", "9", "@", "@", "private", "void", "addUpstreamCommittersTriggeringBuild", "(", "Run", "<", "?,", "?", ">", "build", ",", "Set", "<", "InternetA", "*", "@", "param", "env", "The", "build", "environment", "*", "@", "param", "listener", "The", "listener", "for", "logging", "*", "/", "private", "void", "addUserFromChangeSet", "(", "ChangeLogSet", ".", "Entry", "change", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "TaskListener", "listener", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "private", "void", "addUserFromChangeSet", "(", "ChangeLogSet", ".", "Entry", "change", ",", "Set", "<", "InternetAddress", ">", "to", ",", "Set", "<", "InternetAddress", ">", "cc", ",", "Set", "<", "InternetAddress", ">", "bcc", ",", "EnvVars", "env", ",", "final", "ExtendedEmailPublisherContext", "context", ",", "RecipientProviderUtilities", ".", "IDebug", "debug", ")", "{", "User", "user", "=", "change", ".", "getAuthor", "(", ");", "RecipientProviderUtilities", ".", "addUsers", "(", "Collections", ".", "singleton", "(", "user", ")", ",", "listener", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "RecipientProviderUtilities", ".", "addUsers", "(", "Collections", ".", "singleton", "(", "user", ")", ",", "context", ",", "env", ",", "to", ",", "cc", ",", "bcc", ",", "debug", ")", ";", "}", "@", "Extension"], "docstring_tokens": ["information", "exposure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "528", ",", "6", "+", "528", ",", "7", "@", "@", "static", "int", "rfcomm_sock_getname", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "addr", ",", "int", "*", "BT_DBG", "(", "\"", "sock", "%", "p", ",", "sk", "%", "p", "\"", ",", "sock", ",", "sk", ")", ";", "memset", "(", "sa", ",", "0", ",", "sizeof", "(", "*", "sa", ")", ");", "sa", "-", ">", "rc_family", "=", "AF_BLUETOOTH", ";", "sa", "-", ">", "rc_channel", "=", "rfcomm_pi", "(", "sk", ")", "->", "channel", ";", "if", "(", "peer", ")"], "docstring_tokens": ["info", "leaks"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "362", ",", "6", "+", "362", ",", "7", "@", "@", "public", "synchronized", "AbstractXMPPConnection", "connect", "(", ")", "throws", "SmackException", ",", "IOEx", "/", "/", "Perform", "the", "actual", "connection", "to", "the", "XMPP", "service", "connectInternal", "(", ");", "return", "this", ";", "}", "@", "@", "-", "28", ",", "10", "+", "28", ",", "9", "@", "@", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "AlreadyLoggedInException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "NoResponseException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "NotConnectedException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "ConnectionException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "SecurityRequiredByClientException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "ConnectionException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "SecurityRequiredByServerException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SmackException", ".", "SecurityRequiredException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "SynchronizationPoint", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "XMPPException", ".", "StreamErrorException", ";", "import", "org", ".", "jivesoftware", ".", "smack", ".", "XMPPConnection", ";", "@", "@", "-", "857", ",", "6", "+", "856", ",", "14", "@", "@", "protected", "void", "connectInternal", "(", ")", "throws", "SmackException", ",", "IOException", ",", "XMPPExcepti", "/", "/", "Wait", "with", "SASL", "auth", "until", "the", "SASL", "mechanisms", "have", "been", "received", "saslFeatureReceived", ".", "checkIfSuccessOrWaitOrThrow", "(", ");", "/", "/", "If", "TLS", "is", "required", "but", "the", "server", "doesn", "'", "t", "offer", "it", ",", "disconnect", "/", "/", "from", "the", "server", "and", "throw", "an", "error", ".", "First", "check", "if", "we", "'", "ve", "already", "negotiated", "TLS", "/", "/", "and", "are", "secure", ",", "however", "(", "features", "get", "parsed", "a", "second", "time", "after", "TLS", "is", "established", ")", ".", "if", "(", "!", "isSecureConnection", "(", ")", "&", "&", "getConfiguration", "(", ").", "getSecurityMode", "(", ")", "=", "=", "SecurityMode", ".", "required", ")", "{", "shutdown", "(", ");", "throw", "new", "SecurityRequiredByClientException", "(", ");", "}", "/", "/", "Make", "note", "of", "the", "fact", "that", "we", "'", "re", "now", "connected", ".", "connected", "=", "true", ";", "callConnectionConnectedListener", "(", ");", "@", "@", "-", "897", ",", "7", "+", "904", ",", "7", "@", "@", "protected", "void", "setWriter", "(", "Writer", "writer", ")", "{", "}", "@", "Override", "protected", "void", "afterFeaturesReceived", "(", ")", "throws", "SecurityRequiredException", ",", "NotConnectedException", "{", "protected", "void", "afterFeaturesReceived", "(", ")", "throws", "NotConnectedException", "{", "StartTls", "startTlsFeature", "=", "getFeature", "(", "StartTls", ".", "ELEMENT", ",", "StartTls", ".", "NAMESPACE", ")", ";", "if", "(", "startTlsFeature", "!", "=", "null", ")", "{", "if", "(", "startTlsFeature", ".", "required", "(", ")", "&", "&", "config", ".", "getSecurityMode", "(", ")", "=", "=", "SecurityMode", ".", "disabled", ")", "{", "@", "@", "-", "909", ",", "13", "+", "916", ",", "6", "@", "@", "protected", "void", "afterFeaturesReceived", "(", ")", "throws", "SecurityRequiredException", ",", "NotConn", "send", "(", "new", "StartTls", "(", "))", ";", "}", "}", "/", "/", "If", "TLS", "is", "required", "but", "the", "server", "doesn", "'", "t", "offer", "it", ",", "disconnect", "/", "/", "from", "the", "server", "and", "throw", "an", "error", ".", "First", "check", "if", "we", "'", "ve", "already", "negotiated", "TLS", "/", "/", "and", "are", "secure", ",", "however", "(", "features", "get", "parsed", "a", "second", "time", "after", "TLS", "is", "established", ")", ".", "if", "(", "!", "isSecureConnection", "(", ")", "&", "&", "startTlsFeature", "=", "=", "null", "&", "&", "getConfiguration", "(", ").", "getSecurityMode", "(", ")", "=", "=", "SecurityMode", ".", "required", ")", "{", "throw", "new", "SecurityRequiredByClientException", "(", ");", "}", "if", "(", "getSASLAuthentication", "(", ").", "authenticationSuccessful", "(", "))", "{", "/", "/", "If", "we", "have", "received", "features", "after", "the", "SASL", "has", "been", "successfully", "completed", ",", "then", "we"], "docstring_tokens": ["race", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "18", ",", "9", "+", "18", ",", "6", "@", "@", "import", "static", "org", ".", "jboss", ".", "weld", ".", "logging", ".", "WeldLogger", ".", "WELD_PROJECT_CODE", ";", "import", "javax", ".", "enterprise", ".", "context", ".", "spi", ".", "Context", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "org", ".", "jboss", ".", "logging", ".", "Logger", ";", "import", "org", ".", "jboss", ".", "logging", ".", "Logger", ".", "Level", ";", "import", "org", ".", "jboss", ".", "logging", ".", "annotations", ".", "Cause", ";", "@", "@", "-", "60", ",", "8", "+", "57", ",", "8", "@", "@", "void", "webXmlMappingPatternIgnored", "(", "String", "pattern", ")", ";", "@", "LogMessage", "(", "level", "=", "Level", ".", "WARN", ")", "@", "Message", "(", "id", "=", "712", ",", "value", "=", "\"", "Unable", "to", "dissociate", "context", "{", "0", "}", "when", "destroying", "request", "{", "1", "}", "\",", "format", "=", "Format", ".", "MESSAGE_FORMAT", ")", "void", "unableToDissociateContext", "(", "Context", "context", ",", "HttpServletRequest", "request", ")", ";", "@", "Message", "(", "id", "=", "712", ",", "value", "=", "\"", "Unable", "to", "dissociate", "context", "{", "0", "}", "from", "the", "storage", "{", "1", "}", "\",", "format", "=", "Format", ".", "MESSAGE_FORMAT", ")", "void", "unableToDissociateContext", "(", "Object", "context", ",", "Object", "storage", ")", ";", "@", "Message", "(", "id", "=", "713", ",", "value", "=", "\"", "Unable", "to", "inject", "ServletContext", ".", "None", "is", "associated", "with", "{", "0", "}", ",", "{", "1", "}", "\",", "format", "=", "Format", ".", "MESSAGE_FORMAT", ")", "IllegalStateException", "cannotInjectServletContext", "(", "ClassLoader", "classLoader", ",", "ServletContextService", "service", ")", ";", "@", "@", "-", "78", ",", "4", "+", "75", ",", "8", "@", "@", "@", "Message", "(", "id", "=", "716", ",", "value", "=", "\"", "Running", "in", "Servlet", "2", ".", "x", "environment", ".", "Asynchronous", "request", "support", "is", "disabled", ".", "\")", "void", "servlet2Environment", "(", ");", "@", "LogMessage", "(", "level", "=", "Level", ".", "WARN", ")", "@", "Message", "(", "id", "=", "717", ",", "value", "=", "\"", "Unable", "to", "deactivate", "context", "{", "0", "}", "when", "destroying", "request", "{", "1", "}", "\",", "format", "=", "Format", ".", "MESSAGE_FORMAT", ")", "void", "unableToDeactivateContext", "(", "Object", "context", ",", "Object", "request", ")", ";", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "138", ",", "30", "+", "138", ",", "35", "@", "@", "private", "boolean", "isContextActivatedInRequest", "(", "HttpServletRequest", "request", ")", "{", "}", "protected", "void", "deactivateConversationContext", "(", "HttpServletRequest", "request", ")", "{", "ConversationContext", "conversationContext", "=", "httpConversationContext", "(", ");", "if", "(", "conversationContext", ".", "isActive", "(", "))", "{", "/", "/", "Only", "deactivate", "the", "context", "if", "one", "is", "already", "active", ",", "otherwise", "we", "get", "Exceptions", "if", "(", "conversationContext", "instanceof", "LazyHttpConversationContextImpl", ")", "{", "LazyHttpConversationContextImpl", "lazyConversationContext", "=", "(", "LazyHttpConversationContextImpl", ")", "conversationContext", ";", "if", "(", "!", "lazyConversationContext", ".", "isInitialized", "(", "))", "{", "/", "/", "if", "this", "lazy", "conversation", "has", "not", "been", "touched", "yet", ",", "just", "deactivate", "it", "lazyConversationContext", ".", "deactivate", "(", ");", "return", ";", "try", "{", "ConversationContext", "conversationContext", "=", "httpConversationContext", "(", ");", "if", "(", "conversationContext", ".", "isActive", "(", "))", "{", "/", "/", "Only", "deactivate", "the", "context", "if", "one", "is", "already", "active", ",", "otherwise", "we", "get", "Exceptions", "if", "(", "conversationContext", "instanceof", "LazyHttpConversationContextImpl", ")", "{", "LazyHttpConversationContextImpl", "lazyConversationContext", "=", "(", "LazyHttpConversationContextImpl", ")", "conversationContext", ";", "if", "(", "!", "lazyConversationContext", ".", "isInitialized", "(", "))", "{", "/", "/", "if", "this", "lazy", "conversation", "has", "not", "been", "touched", "yet", ",", "just", "deactivate", "it", "lazyConversationContext", ".", "deactivate", "(", ");", "return", ";", "}", "}", "}", "boolean", "isTransient", "=", "conversationContext", ".", "getCurrentConversation", "(", ").", "isTransient", "(", ");", "if", "(", "ConversationLogger", ".", "LOG", ".", "isTraceEnabled", "(", "))", "{", "boolean", "isTransient", "=", "conversationContext", ".", "getCurrentConversation", "(", ").", "isTransient", "(", ");", "if", "(", "ConversationLogger", ".", "LOG", ".", "isTraceEnabled", "(", "))", "{", "if", "(", "isTransient", ")", "{", "ConversationLogger", ".", "LOG", ".", "cleaningUpTransientConversation", "(", ");", "}", "else", "{", "ConversationLogger", ".", "LOG", ".", "cleaningUpConversation", "(", "conversationContext", ".", "getCurrentConversation", "(", ").", "getId", "(", "))", ";", "}", "}", "conversationContext", ".", "invalidate", "(", ");", "conversationContext", ".", "deactivate", "(", ");", "if", "(", "isTransient", ")", "{", "ConversationLogger", ".", "LOG", ".", "cleaningUpTransientConversation", "(", ");", "}", "else", "{", "ConversationLogger", ".", "LOG", ".", "cleaningUpConversation", "(", "conversationContext", ".", "getCurrentConversation", "(", ").", "getId", "(", "))", ";", "conversationDestroyedEvent", ".", "fire", "(", "request", ")", ";", "}", "}", "conversationContext", ".", "invalidate", "(", ");", "conversationContext", ".", "deactivate", "(", ");", "if", "(", "isTransient", ")", "{", "conversationDestroyedEvent", ".", "fire", "(", "request", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "ServletLogger", ".", "LOG", ".", "unableToDeactivateContext", "(", "httpConversationContext", "(", "),", "request", ")", ";", "ServletLogger", ".", "LOG", ".", "catchingDebug", "(", "e", ")", ";", "}", "}", "@", "@", "-", "23", ",", "6", "+", "23", ",", "8", "@", "@", "import", "org", ".", "jboss", ".", "weld", ".", "Container", ";", "import", "org", ".", "jboss", ".", "weld", ".", "bootstrap", ".", "api", ".", "Service", ";", "import", "org", ".", "jboss", ".", "weld", ".", "context", ".", "BoundContext", ";", "import", "org", ".", "jboss", ".", "weld", ".", "context", ".", "ManagedContext", ";", "import", "org", ".", "jboss", ".", "weld", ".", "context", ".", "cache", ".", "RequestScopedCache", ";", "import", "org", ".", "jboss", ".", "weld", ".", "context", ".", "http", ".", "HttpRequestContext", ";", "import", "org", ".", "jboss", ".", "weld", ".", "context", ".", "http", ".", "HttpRequestContextImpl", ";", "@", "@", "-", "279", ",", "24", "+", "281", ",", "21", "@", "@", "public", "void", "requestDestroyed", "(", "HttpServletRequest", "request", ")", "{", "if", "(", "!", "servletApi", ".", "isAsyncSupported", "(", ")", "|", "|", "!", "servletApi", ".", "isAsyncStarted", "(", "request", ")", ")", "{", "getRequestContext", "(", ").", "invalidate", "(", ");", "}", "getRequestContext", "(", ").", "deactivate", "(", ");", "safelyDeactivate", "(", "getRequestContext", "(", "),", "request", ")", ";", "/", "/", "fire", "@", "Destroyed", "(", "RequestScoped", ".", "class", ")", "requestDestroyedEvent", ".", "fire", "(", "request", ")", ";", "getSessionContext", "(", ").", "deactivate", "(", ");", "safelyDeactivate", "(", "getSessionContext", "(", "),", "request", ")", ";", "/", "/", "fire", "@", "Destroyed", "(", "SessionScoped", ".", "class", ")", "if", "(", "!", "getSessionContext", "(", ").", "isValid", "(", "))", "{", "sessionDestroyedEvent", ".", "fire", "(", "(", "HttpSession", ")", "request", ".", "getAttribute", "(", "HTTP_SESSION", ")", ");", "}", "}", "finally", "{", "getRequestContext", "(", ").", "dissociate", "(", "request", ")", ";", "safelyDissociate", "(", "getRequestContext", "(", "),", "request", ")", ";", "/", "/", "WFLY", "-", "1533", "Underlying", "HTTP", "session", "may", "be", "invalid", "try", "{", "getSessionContext", "(", ").", "dissociate", "(", "request", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "ServletLogger", ".", "LOG", ".", "unableToDissociateContext", "(", "getSessionContext", "(", "),", "request", ")", ";", "ServletLogger", ".", "LOG", ".", "catchingDebug", "(", "e", ")", ";", "}", "safelyDissociate", "(", "getSessionContext", "(", "),", "request", ")", ";", "/", "/", "Catch", "block", "is", "inside", "the", "activator", "method", "so", "that", "we", "'", "re", "able", "to", "log", "the", "context", "conversationContextActivator", ".", "disassociateConversationContext", "(", "request", ")", ";", "@", "@", "-", "312", ",", "6", "+", "311", ",", "10", "@", "@", "public", "void", "setConversationActivationEnabled", "(", "boolean", "conversationActivationEnabl", "this", ".", "conversationActivationEnabled", "=", "conversationActivationEnabled", ";", "}", "@", "Override", "public", "void", "cleanup", "(", ")", "{", "}", "/", "**", "*", "Some", "Servlet", "containers", "fire", "HttpServletListeners", "for", "include", "requests", "(", "inner", "requests", "caused", "by", "calling", "the", "include", "method", "of", "RequestDispatcher", ")", ".", "This", "*", "causes", "problems", "with", "context", "shut", "down", "as", "context", "manipulation", "is", "not", "reentrant", ".", "This", "method", "detects", "if", "this", "request", "is", "an", "included", "request", "or", "not", ".", "@", "@", "-", "338", ",", "7", "+", "341", ",", "22", "@", "@", "private", "boolean", "isRequestDestroyed", "(", "HttpServletRequest", "request", ")", "{", "return", "request", ".", "getAttribute", "(", "REQUEST_DESTROYED", ")", "!", "=", "null", ";", "}", "@", "Override", "public", "void", "cleanup", "(", ")", "{", "private", "<", "T", ">", "void", "safelyDissociate", "(", "BoundContext", "<", "T", ">", "context", ",", "T", "storage", ")", "{", "try", "{", "context", ".", "dissociate", "(", "storage", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "ServletLogger", ".", "LOG", ".", "unableToDissociateContext", "(", "context", ",", "storage", ")", ";", "ServletLogger", ".", "LOG", ".", "catchingDebug", "(", "e", ")", ";", "}", "}", "private", "void", "safelyDeactivate", "(", "ManagedContext", "context", ",", "HttpServletRequest", "request", ")", "{", "try", "{", "context", ".", "deactivate", "(", ");", "}", "catch", "(", "Exception", "e", ")", "{", "ServletLogger", ".", "LOG", ".", "unableToDeactivateContext", "(", "context", ",", "request", ")", ";", "ServletLogger", ".", "LOG", ".", "catchingDebug", "(", "e", ")", ";", "}", "}", "}"], "docstring_tokens": ["race", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "144", ",", "7", "+", "144", ",", "29", "@", "@", "public", "UtilityService", "setParent", "(", "Service", "parent", ")", "{", "@", "Override", "public", "void", "authorizeRequest", "(", "Operation", "op", ")", "{", "op", ".", "complete", "(", ");", "String", "suffix", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "URI_PATH_CHAR", ",", "UriUtils", ".", "getLastPathSegment", "(", "op", ".", "getUri", "(", "))", ");", "/", "/", "allow", "access", "to", "ui", "endpoint", "if", "(", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ".", "equals", "(", "suffix", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "ServiceDocument", "doc", "=", "new", "ServiceDocument", "(", ");", "if", "(", "this", ".", "parent", ".", "getOptions", "(", ").", "contains", "(", "ServiceOption", ".", "FACTORY_ITEM", ")", ")", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "UriUtils", ".", "getParentPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "))", ",", "suffix", ")", ";", "}", "else", "{", "doc", ".", "documentSelfLink", "=", "UriUtils", ".", "buildUriPath", "(", "this", ".", "parent", ".", "getSelfLink", "(", "),", "suffix", ")", ";", "}", "doc", ".", "documentKind", "=", "Utils", ".", "buildKind", "(", "this", ".", "parent", ".", "getStateType", "(", "))", ";", "if", "(", "getHost", "(", ").", "isAuthorized", "(", "this", ".", "parent", ",", "doc", ",", "op", ")", ")", "{", "op", ".", "complete", "(", ");", "return", ";", "}", "op", ".", "fail", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "}", "@", "Override", "@", "@", "-", "462", ",", "16", "+", "462", ",", "20", "@", "@", "public", "void", "guestAuthorization", "(", ")", "throws", "Throwable", "{", ".", "setBody", "(", "state", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_UNAUTHORIZED", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "OperationContext", ".", "setAuthorizationContext", "(", "this", ".", "host", ".", "getSystemAuthorizationContext", "(", "))", ";", "Map", "<", "String", ",", "ServiceStats", ".", "ServiceStat", ">", "stat", "=", "this", ".", "host", ".", "getServiceStats", "(", "UriUtils", ".", "buildUri", "(", "this", ".", "host", ",", "ServiceUriPaths", ".", "CORE_MANAGEMENT", ")", ");", "double", "currentInsertCount", "=", "stat", ".", "get", "(", "ServiceHostManagementService", ".", "STAT_NAME_AUTHORIZATION_CACHE_INSERT_COUNT", ")", ".", "latestValue", ";", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "/", "/", "Make", "a", "second", "request", "and", "verify", "that", "the", "cache", "did", "not", "get", "updated", ",", "instead", "Xenon", "re", "-", "used", "/", "/", "the", "cached", "Guest", "authorization", "context", ".", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ");", "OperationContext", ".", "setAuthorizationContext", "(", "this", ".", "host", ".", "getSystemAuthorizationContext", "(", "))", ";", "stat", "=", "this", ".", "host", ".", "getServiceStats", "(", "UriUtils", ".", "buildUri", "(", "this", ".", "host", ",", "ServiceUriPaths", ".", "CORE_MANAGEMENT", ")", ");", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "double", "newInsertCount", "=", "stat", ".", "get", "(", "ServiceHostManagementService", ".", "STAT_NAME_AUTHORIZATION_CACHE_INSERT_COUNT", ")", ".", "latestValue", ";", "assertTrue", "(", "currentInsertCount", "=", "=", "newInsertCount", ")", ";", "@", "@", "-", "709", ",", "6", "+", "713", ",", "16", "@", "@", "public", "void", "statefulServiceAuthorization", "(", ")", "throws", "Throwable", "{", "}", "))", ";", "this", ".", "host", ".", "testWait", "(", "ctx2", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "stats", ",", "we", "should", "get", "403", "Operation", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "do", "GET", "on", "factory", "/", "config", ",", "we", "should", "get", "403", "Operation", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "/", "/", "Assume", "Jane", "'", "s", "identity", "this", ".", "host", ".", "assumeIdentity", "(", "this", ".", "userServicePath", ")", ";", "/", "/", "add", "docs", "accessible", "by", "jane", "@", "@", "-", "750", ",", "9", "+", "764", ",", "27", "@", "@", "public", "void", "statefulServiceAuthorization", "(", ")", "throws", "Throwable", "{", "/", "/", "reset", "the", "auth", "context", "OperationContext", ".", "setAuthorizationContext", "(", "null", ")", ";", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "403", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "statsGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "configGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_CONFIG", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectFailure", "(", "configGet", ",", "Operation", ".", "STATUS_CODE_FORBIDDEN", ")", ";", "}", "/", "/", "Assume", "Jane", "'", "s", "identity", "through", "header", "auth", "token", "String", "authToken", "=", "generateAuthToken", "(", "this", ".", "userServicePath", ")", ";", "/", "/", "do", "GET", "on", "utility", "suffixes", "in", "example", "child", "services", ",", "we", "should", "get", "200", "for", "(", "URI", "childUri", ":", "exampleServices", ".", "keySet", "(", "))", "{", "statsGet", "=", "Operation", ".", "createGet", "(", "this", ".", "host", ",", "childUri", ".", "getPath", "(", ")", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ";", "statsGet", ".", "addRequestHeader", "(", "Operation", ".", "REQUEST_AUTH_TOKEN_HEADER", ",", "authToken", ")", ";", "this", ".", "host", ".", "sendAndWaitExpectSuccess", "(", "statsGet", ")", ";", "}", "verifyJaneAccess", "(", "exampleServices", ",", "authToken", ")", ";", "/", "/", "test", "user", "impersonation", "@", "@", "-", "81", ",", "10", "+", "81", ",", "6", "@", "@", "public", "void", "createUsers", "(", ")", "throws", "Throwable", "{", "*", "isn", "'", "t", "created", "immediately", ",", "so", "this", "polls", ".", "*", "/", "private", "String", "loginUser", "(", "URI", "hostUri", ")", "throws", "Throwable", "{", "URI", "usersLink", "=", "UriUtils", ".", "buildUri", "(", "hostUri", ",", "UserService", ".", "FACTORY_LINK", ")", ";", "/", "/", "wait", "for", "factory", "availability", "this", ".", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "usersLink", ")", ";", "String", "basicAuth", "=", "BasicAuthenticationUtils", ".", "constructBasicAuth", "(", "adminUser", ",", "adminUser", ")", ";", "URI", "loginUri", "=", "UriUtils", ".", "buildUri", "(", "hostUri", ",", "ServiceUriPaths", ".", "CORE_AUTHN_BASIC", ")", ";", "AuthenticationRequest", "login", "=", "new", "AuthenticationRequest", "(", ");", "@", "@", "-", "421", ",", "9", "+", "421", ",", "13", "@", "@", "private", "void", "doRequestRateLimits", "(", ")", "throws", "Throwable", "{", "ri", ".", "limit", "=", "limit", ";", "ri", ".", "options", "=", "EnumSet", ".", "of", "(", "RequestRateInfo", ".", "Option", ".", "PAUSE_PROCESSING", ")", ";", "this", ".", "host", ".", "setRequestRateLimit", "(", "userPath", ",", "ri", ")", ";", "this", ".", "host", ".", "assumeIdentity", "(", "userPath", ")", ";", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "ServiceStat", "rateLimitStatBefore", "=", "getRateLimitOpCountStat", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "this", ".", "host", ".", "assumeIdentity", "(", "userPath", ")", ";", "if", "(", "rateLimitStatBefore", "=", "=", "null", ")", "{", "rateLimitStatBefore", "=", "new", "ServiceStat", "(", ");", "rateLimitStatBefore", ".", "latestValue", "=", "0", ".", "0", ";", "@", "@", "-", "442", ",", "7", "+", "446", ",", "10", "@", "@", "private", "void", "doRequestRateLimits", "(", ")", "throws", "Throwable", "{", "}", "this", ".", "host", ".", "testWait", "(", "ctx2", ")", ";", "ctx2", ".", "logAfter", "(", ");", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "ServiceStat", "rateLimitStatAfter", "=", "getRateLimitOpCountStat", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "assertTrue", "(", "rateLimitStatAfter", ".", "latestValue", ">", "rateLimitStatBefore", ".", "latestValue", ")", ";", "this", ".", "host", ".", "setMaintenanceIntervalMicros", "(", "@", "@", "-", "472", ",", "7", "+", "479", ",", "9", "@", "@", "private", "void", "doRequestRateLimits", "(", ")", "throws", "Throwable", "{", "ctx3", ".", "logAfter", "(", ");", "/", "/", "verify", "rate", "limiting", "did", "not", "happen", "this", ".", "host", ".", "setSystemAuthorizationContext", "(", ");", "ServiceStat", "rateLimitStatExpectSame", "=", "getRateLimitOpCountStat", "(", ");", "this", ".", "host", ".", "resetSystemAuthorizationContext", "(", ");", "assertTrue", "(", "rateLimitStatAfter", ".", "latestValue", "=", "=", "rateLimitStatExpectSame", ".", "latestValue", ")", ";", "}", "@", "@", "-", "2627", ",", "8", "+", "2636", ",", "9", "@", "@", "private", "ServiceStat", "getODLStopCountStat", "(", ")", "throws", "Throwable", "{", "private", "ServiceStat", "getRateLimitOpCountStat", "(", ")", "throws", "Throwable", "{", "URI", "managementServiceUri", "=", "this", ".", "host", ".", "getManagementServiceUri", "(", ");", "return", "this", ".", "host", ".", "getServiceStats", "(", "managementServiceUri", ")", "ServiceStat", "stats", "=", "this", ".", "host", ".", "getServiceStats", "(", "managementServiceUri", ")", ".", "get", "(", "ServiceHostManagementService", ".", "STAT_NAME_RATE_LIMITED_OP_COUNT", ")", ";", "return", "stats", ";", "}", "@", "Test", "@", "@", "-", "300", ",", "11", "+", "300", ",", "14", "@", "@", "public", "void", "subscriptionsWithAuth", "(", ")", "throws", "Throwable", "{", "}", "}", ";", "hostWithAuth", ".", "setSystemAuthorizationContext", "(", ");", "Operation", "subscribe", "=", "Operation", ".", "createPost", "(", "UriUtils", ".", "buildUri", "(", "hostWithAuth", ",", "minimalServiceUUID", ")", ");", "subscribe", ".", "setReferer", "(", "hostWithAuth", ".", "getReferer", "(", "))", ";", "ServiceSubscriber", "subscriber", "=", "new", "ServiceSubscriber", "(", ");", "subscriber", ".", "replayState", "=", "true", ";", "hostWithAuth", ".", "startSubscriptionService", "(", "subscribe", ",", "notifyC", ",", "subscriber", ")", ";", "hostWithAuth", ".", "resetAuthorizationContext", "(", ");", "hostWithAuth", ".", "testWait", "(", "notifyContext", ")", ";", "}", "finally", "{", "if", "(", "hostWithAuth", "!", "=", "null", ")", "{", "@", "@", "-", "14", ",", "8", "+", "14", ",", "12", "@", "@", "package", "com", ".", "vmware", ".", "xenon", ".", "common", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_TEMPLATE", ";", "import", "static", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ".", "SERVICE_URI_SUFFIX_UI", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "EnumSet", ";", "@", "@", "-", "34", ",", "10", "+", "38", ",", "16", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ".", "AggregationType", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceStats", ".", "TimeSeriesStats", ".", "TimeBin", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "AuthTestUtils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "TestRequestSender", ".", "FailureResponse", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "test", ".", "VerificationHost", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "AuthorizationContextService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ".", "ExampleServiceState", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "MinimalTestService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ".", "Query", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ServiceUriPaths", ";", "public", "class", "TestUtilityService", "extends", "BasicReusableHostTestCase", "{", "@", "@", "-", "823", ",", "4", "+", "833", ",", "144", "@", "@", "public", "void", "statsKeyOrder", "(", ")", "{", "assertEquals", "(", "\"", "stat", "index", "2", "\"", ",", "\"", "keyCCC", "\"", ",", "statList", ".", "get", "(", "2", ")", ");", "}", "@", "Test", "public", "void", "endpointAuthorization", "(", ")", "throws", "Throwable", "{", "VerificationHost", "host", "=", "VerificationHost", ".", "create", "(", "0", ")", ";", "host", ".", "setAuthorizationService", "(", "new", "AuthorizationContextService", "(", "))", ";", "host", ".", "setAuthorizationEnabled", "(", "true", ")", ";", "host", ".", "setMaintenanceIntervalMicros", "(", "TimeUnit", ".", "MILLISECONDS", ".", "toMicros", "(", "100", ")", ");", "host", ".", "start", "(", ");", "TestRequestSender", "sender", "=", "host", ".", "getTestRequestSender", "(", ");", "host", ".", "setSystemAuthorizationContext", "(", ");", "host", ".", "waitForReplicatedFactoryServiceAvailable", "(", "UriUtils", ".", "buildUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ");", "String", "exampleUser", "=", "\"", "example", "@", "vmware", ".", "com", "\"", ";", "String", "examplePass", "=", "\"", "password", "\"", ";", "TestContext", "authCtx", "=", "host", ".", "testCreate", "(", "1", ")", ";", "AuthorizationSetupHelper", ".", "create", "(", ")", ".", "setHost", "(", "host", ")", ".", "setUserEmail", "(", "exampleUser", ")", ".", "setUserPassword", "(", "examplePass", ")", ".", "setResourceQuery", "(", "Query", ".", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_KIND", ",", "Utils", ".", "buildKind", "(", "ExampleServiceState", ".", "class", ")", ")", ".", "build", "(", "))", ".", "setCompletion", "(", "authCtx", ".", "getCompletion", "(", "))", ".", "start", "(", ");", "authCtx", ".", "await", "(", ");", "/", "/", "create", "a", "sample", "service", "ExampleServiceState", "doc", "=", "new", "ExampleServiceState", "(", ");", "doc", ".", "name", "=", "\"", "foo", "\"", ";", "doc", ".", "documentSelfLink", "=", "\"", "foo", "\"", ";", "Operation", "post", "=", "Operation", ".", "createPost", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ".", "setBody", "(", "doc", ")", ";", "ExampleServiceState", "postResult", "=", "sender", ".", "sendAndWait", "(", "post", ",", "ExampleServiceState", ".", "class", ")", ";", "host", ".", "resetAuthorizationContext", "(", ");", "URI", "factoryAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factorySubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "ExampleService", ".", "FACTORY_LINK", ")", ";", "URI", "factoryTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "factoryUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "ExampleService", ".", "FACTORY_LINK", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "URI", "serviceAvailableUri", "=", "UriUtils", ".", "buildAvailableUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceStatsUri", "=", "UriUtils", ".", "buildStatsUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceConfigUri", "=", "UriUtils", ".", "buildConfigUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceSubscriptionUri", "=", "UriUtils", ".", "buildSubscriptionUri", "(", "host", ",", "postResult", ".", "documentSelfLink", ")", ";", "URI", "serviceTemplateUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_TEMPLATE", ")", ");", "URI", "serviceUiUri", "=", "UriUtils", ".", "buildUri", "(", "host", ",", "UriUtils", ".", "buildUriPath", "(", "postResult", ".", "documentSelfLink", ",", "SERVICE_URI_SUFFIX_UI", ")", ");", "/", "/", "check", "non", "-", "authenticated", "user", "receives", "forbidden", "response", "FailureResponse", "failureResponse", ";", "Operation", "uiOpResult", ";", "/", "/", "check", "factory", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "failureResponse", "=", "sender", ".", "sendAndWaitFailure", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "failureResponse", ".", "op", ".", "getStatusCode", "(", "))", ";", "uiOpResult", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "uiOpResult", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "authenticated", "user", "does", "NOT", "receive", "forbidden", "response", "AuthTestUtils", ".", "login", "(", "host", ",", "exampleUser", ",", "examplePass", ")", ";", "Operation", "response", ";", "/", "/", "check", "factory", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factorySubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "factoryUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "/", "/", "check", "service", "endpoints", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceAvailableUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceStatsUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceConfigUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceSubscriptionUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceTemplateUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "response", "=", "sender", ".", "sendAndWait", "(", "Operation", ".", "createGet", "(", "serviceUiUri", ")", ");", "assertNotEquals", "(", "Operation", ".", "STATUS_CODE_FORBIDDEN", ",", "response", ".", "getStatusCode", "(", "))", ";", "}", "}", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "ServiceHost", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "UriUtils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Utils", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "ExampleService", ".", "ExampleServiceState", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "services", ".", "common", ".", "QueryTask", ".", "Query", ";", "@", "@", "-", "247", ",", "6", "+", "248", ",", "22", "@", "@", "public", "String", "getUserGroupName", "(", "String", "email", ")", "{", "UriUtils", ".", "buildUriPath", "(", "ServiceUriPaths", ".", "CORE_AUTHZ_USERS", ",", "email", ")", ")", ".", "build", "(", "))", ";", "/", "/", "Create", "resource", "group", "to", "allow", "access", "on", "utility", "paths", "String", "statsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "stats", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ExampleService", ".", "FACTORY_LINK", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_STATS", ")", ".", "build", "(", "))", ";", "String", "subscriptionsResourceGroupLink", "=", "createResourceGroup", "(", "target", ",", "\"", "subs", "-", "resource", "-", "group", "\"", ",", "Builder", ".", "create", "(", ")", ".", "addFieldClause", "(", "ServiceDocument", ".", "FIELD_NAME_SELF_LINK", ",", "ServiceUriPaths", ".", "CORE_LOCAL_QUERY_TASKS", "+", "ServiceHost", ".", "SERVICE_URI_SUFFIX_SUBSCRIPTIONS", ")", ".", "build", "(", "))", ";", "Collection", "<", "String", ">", "paths", "=", "new", "HashSet", "<", ">(", ");", "/", "/", "Create", "roles", "tying", "these", "together", "@", "@", "-", "261", ",", "6", "+", "278", ",", "16", "@", "@", "public", "String", "getUserGroupName", "(", "String", "email", ")", "{", "/", "/", "Create", "role", "authorizing", "access", "to", "the", "user", "'", "s", "own", "query", "tasks", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "queryTaskResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "stats", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "statsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "/", "/", "Create", "role", "authorizing", "access", "to", "/", "subscriptions", "of", "query", "tasks", "paths", ".", "add", "(", "createRole", "(", "target", ",", "userGroupLink", ",", "subscriptionsResourceGroupLink", ",", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "Action", ".", "GET", ",", "Action", ".", "POST", ",", "Action", ".", "PATCH", ",", "Action", ".", "DELETE", ")", "))", ");", "return", "paths", ";", "}", "@", "@", "-", "83", ",", "6", "+", "83", ",", "7", "@", "@", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ".", "AuthorizationContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Operation", ".", "CompletionHandler", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "OperationContext", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ".", "Action", ";", "import", "com", ".", "vmware", ".", "xenon", ".", "common", ".", "Service", ".", "ServiceOption", ";", "@", "@", "-", "1052", ",", "7", "+", "1053", ",", "15", "@", "@", "public", "ServiceDocumentQueryResult", "getExpandedFactoryState", "(", "URI", "factoryUri", ")", "{", "}", "public", "Map", "<", "String", ",", "ServiceStat", ">", "getServiceStats", "(", "URI", "serviceUri", ")", "{", "AuthorizationContext", "ctx", "=", "null", ";", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "ctx", "=", "OperationContext", ".", "getAuthorizationContext", "(", ");", "this", ".", "setSystemAuthorizationContext", "(", ");", "}", "ServiceStats", "stats", "=", "this", ".", "sender", ".", "sendStatsGetAndWait", "(", "serviceUri", ")", ";", "if", "(", "this", ".", "isAuthorizationEnabled", "(", "))", "{", "this", ".", "setAuthorizationContext", "(", "ctx", ")", ";", "}", "return", "stats", ".", "entries", ";", "}", "@", "@", "-", "3023", ",", "6", "+", "3023", ",", "7", "@", "@", "public", "void", "replicationWithAuthzCacheClear", "(", ")", "throws", "Throwable", "{", "VerificationHost", "groupHost", "=", "this", ".", "host", ".", "getPeerHost", "(", ");", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "/", "/", "wait", "for", "auth", "related", "services", "to", "be", "stabilized", "groupHost", ".", "waitForReplicatedFactoryServiceAvailable", "(", "UriUtils", ".", "buildUri", "(", "groupHost", ",", "UserService", ".", "FACTORY_LINK", ")", ");", "@", "@", "-", "3040", ",", "7", "+", "3041", ",", "7", "@", "@", "public", "void", "replicationWithAuthzCacheClear", "(", ")", "throws", "Throwable", "{", "String", "bazUserLink", "=", "UriUtils", ".", "buildUriPath", "(", "ServiceUriPaths", ".", "CORE_AUTHZ_USERS", ",", "\"", "baz", "@", "vmware", ".", "com", "\"", ");", "groupHost", ".", "setSystemAuthorizationContext", "(", ");", "/", "/", "create", "user", ",", "user", "-", "group", ",", "resource", "-", "group", ",", "role", "for", "foo", "@", "vmware", ".", "com", "/", "/", "user", ":", "/", "core", "/", "authz", "/", "users", "/", "foo", "@", "vmware", ".", "com", "@", "@", "-", "3251", ",", "7", "+", "3252", ",", "7", "@", "@", "private", "void", "populateAuthCacheInAllPeers", "(", "AuthorizationContext", "authContext", ")", "throw", "/", "/", "based", "on", "the", "role", "created", "in", "test", ",", "all", "users", "have", "access", "to", "ExampleService", "this", ".", "host", ".", "sendAndWaitExpectSuccess", "(", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildStatsUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";", "Operation", ".", "createGet", "(", "UriUtils", ".", "buildUri", "(", "peer", ",", "ExampleService", ".", "FACTORY_LINK", ")", "))", ";", "}", "this", ".", "host", ".", "waitFor", "(", "\"", "Timeout", "waiting", "for", "correct", "auth", "cache", "state", "\"", ","], "docstring_tokens": ["information", "disclosure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "package", "htmlpublisher", ";", "import", "com", ".", "google", ".", "common", ".", "base", ".", "Charsets", ";", "import", "com", ".", "infradna", ".", "tool", ".", "bridge_method_injector", ".", "WithBridgeMethods", ";", "import", "hudson", ".", "FilePath", ";", "import", "hudson", ".", "Util", ";", "@", "@", "-", "18", ",", "12", "+", "19", ",", "15", "@", "@", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "hudson", ".", "util", ".", "HttpResponses", ";", "import", "jenkins", ".", "model", ".", "RunAction2", ";", "import", "org", ".", "apache", ".", "commons", ".", "codec", ".", "binary", ".", "Hex", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "@", "@", "-", "161", ",", "12", "+", "165", ",", "33", "@", "@", "public", "boolean", "getAllowMissing", "(", ")", "{", "return", "this", ".", "allowMissing", ";", "}", "public", "String", "getSanitizedName", "(", ")", "{", "/", "**", "*", "Actually", "not", "safe", ",", "this", "allowed", "directory", "traversal", "(", "SECURITY", "-", "784", ")", ".", "*", "@", "return", "*", "/", "private", "String", "getLegacySanitizedName", "(", ")", "{", "String", "safeName", "=", "this", ".", "reportName", ";", "safeName", "=", "safeName", ".", "replace", "(", "\"", "\"", ",", "\"", "_", "\"", ");", "return", "safeName", ";", "}", "public", "String", "getSanitizedName", "(", ")", "{", "return", "sanitizeReportName", "(", "this", ".", "reportName", ")", ";", "}", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "String", "sanitizeReportName", "(", "String", "reportName", ")", "{", "Pattern", "p", "=", "Pattern", ".", "compile", "(", "\"[", "^", "a", "-", "zA", "-", "Z0", "-", "9", "-", "]\"", ");", "Matcher", "m", "=", "p", ".", "matcher", "(", "reportName", ")", ";", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", ");", "while", "(", "m", ".", "find", "(", "))", "{", "String", "match", "=", "m", ".", "group", "(", ");", "m", ".", "appendReplacement", "(", "sb", ",", "\"", "_", "\"", "+", "Hex", ".", "encodeHexString", "(", "match", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", "))", ";", "}", "m", ".", "appendTail", "(", "sb", ")", ";", "return", "sb", ".", "toString", "(", ");", "}", "public", "String", "getWrapperName", "(", ")", "{", "return", "WRAPPER_NAME", ";", "}", "@", "@", "-", "179", ",", "13", "+", "204", ",", "22", "@", "@", "public", "FilePath", "getArchiveTarget", "(", "Run", "build", ")", "{", "*", "Gets", "the", "directory", "where", "the", "HTML", "report", "is", "stored", "for", "the", "given", "project", ".", "*", "/", "private", "File", "getProjectArchiveDir", "(", "AbstractItem", "project", ")", "{", "return", "new", "File", "(", "new", "File", "(", "project", ".", "getRootDir", "(", "),", "\"", "htmlreports", "\"", "),", "this", ".", "getSanitizedName", "(", "))", ";", "return", "getProjectArchiveDir", "(", "project", ",", "getSanitizedName", "(", "))", ";", "}", "private", "File", "getProjectArchiveDir", "(", "AbstractItem", "project", ",", "String", "dirName", ")", "{", "return", "new", "File", "(", "new", "File", "(", "project", ".", "getRootDir", "(", "),", "\"", "htmlreports", "\"", "),", "dirName", ")", ";", "}", "/", "**", "*", "Gets", "the", "directory", "where", "the", "HTML", "report", "is", "stored", "for", "the", "given", "build", ".", "*", "/", "private", "File", "getBuildArchiveDir", "(", "Run", "run", ")", "{", "return", "new", "File", "(", "new", "File", "(", "run", ".", "getRootDir", "(", "),", "\"", "htmlreports", "\"", "),", "this", ".", "getSanitizedName", "(", "))", ";", "return", "getBuildArchiveDir", "(", "run", ",", "getSanitizedName", "(", "))", ";", "}", "private", "File", "getBuildArchiveDir", "(", "Run", "run", ",", "String", "dirName", ")", "{", "return", "new", "File", "(", "new", "File", "(", "run", ".", "getRootDir", "(", "),", "\"", "htmlreports", "\"", "),", "dirName", ")", ";", "}", "protected", "abstract", "class", "BaseHTMLAction", "implements", "Action", "{", "@", "@", "-", "198", ",", "7", "+", "232", ",", "7", "@", "@", "public", "BaseHTMLAction", "(", "HtmlPublisherTarget", "actualHtmlPublisherTarget", ")", "{", "}", "public", "String", "getUrlName", "(", ")", "{", "return", "actualHtmlPublisherTarget", ".", "getSanitizedName", "(", ");", "return", "dir", "(", ").", "getName", "(", ");", "}", "public", "String", "getDisplayName", "(", ")", "{", "@", "@", "-", "249", ",", "6", "+", "283", ",", "11", "@", "@", "protected", "File", "dir", "(", ")", "{", "if", "(", "run", "!", "=", "null", ")", "{", "File", "javadocDir", "=", "getBuildArchiveDir", "(", "run", ")", ";", "if", "(", "!", "javadocDir", ".", "exists", "(", "))", "{", "javadocDir", "=", "getBuildArchiveDir", "(", "run", ",", "getLegacySanitizedName", "(", "))", ";", "}", "/", "/", "TODO", "not", "sure", "about", "this", "change", "if", "(", "javadocDir", ".", "exists", "(", "))", "{", "for", "(", "HTMLBuildAction", "a", ":", "run", ".", "getActions", "(", "HTMLBuildAction", ".", "class", ")", ")", "{", "if", "(", "a", ".", "getHTMLTarget", "(", ").", "getReportName", "(", ").", "equals", "(", "getHTMLTarget", "(", ").", "getReportName", "(", "))", ")", "{", "@", "@", "-", "260", ",", "7", "+", "299", ",", "16", "@", "@", "protected", "File", "dir", "(", ")", "{", "}", "}", "return", "getProjectArchiveDir", "(", "this", ".", "project", ")", ";", "/", "/", "SECURITY", "-", "784", ":", "prefer", "safe", "over", "legacy", ",", "but", "if", "neither", "exists", ",", "return", "safe", "dir", "File", "projectArchiveDir", "=", "getProjectArchiveDir", "(", "this", ".", "project", ")", ";", "if", "(", "projectArchiveDir", ".", "exists", "(", "))", "{", "return", "projectArchiveDir", ";", "}", "File", "legacyProjectArchiveDir", "=", "getProjectArchiveDir", "(", "this", ".", "project", ",", "getLegacySanitizedName", "(", "))", ";", "if", "(", "legacyProjectArchiveDir", ".", "exists", "(", "))", "{", "return", "legacyProjectArchiveDir", ";", "}", "return", "projectArchiveDir", ";", "}", "private", "Run", "getArchiveBuild", "(", "@", "Nonnull", "Job", "job", ")", "{", "@", "@", "-", "354", ",", "7", "+", "402", ",", "16", "@", "@", "protected", "String", "getTitle", "(", ")", "{", "@", "Override", "protected", "File", "dir", "(", ")", "{", "return", "getBuildArchiveDir", "(", "this", ".", "build", ")", ";", "/", "/", "SECURITY", "-", "784", ":", "prefer", "safe", "over", "legacy", ",", "but", "if", "neither", "exists", ",", "return", "safe", "dir", "File", "buildArchiveDir", "=", "getBuildArchiveDir", "(", "this", ".", "build", ")", ";", "if", "(", "buildArchiveDir", ".", "exists", "(", "))", "{", "return", "buildArchiveDir", ";", "}", "File", "legacyBuildArchiveDir", "=", "getBuildArchiveDir", "(", "this", ".", "build", ",", "getLegacySanitizedName", "(", "))", ";", "if", "(", "legacyBuildArchiveDir", ".", "exists", "(", "))", "{", "return", "legacyBuildArchiveDir", ";", "}", "return", "buildArchiveDir", ";", "}", "/", "**", "@", "@", "-", "0", ",", "0", "+", "1", ",", "76", "@", "@", "package", "htmlpublisher", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "hudson", ".", "model", ".", "FreeStyleProject", ";", "import", "hudson", ".", "model", ".", "Job", ";", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "CreateFileBuilder", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "recipes", ".", "LocalData", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "util", ".", "Date", ";", "public", "class", "Security784Test", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "LocalData", "@", "Test", "public", "void", "security784upgradeTest", "(", ")", "throws", "Exception", "{", "FreeStyleProject", "job", "=", "j", ".", "jenkins", ".", "getItemByFullName", "(", "\"", "thejob", "\"", ",", "FreeStyleProject", ".", "class", ")", ";", "Assert", ".", "assertTrue", "(", "new", "File", "(", "job", ".", "getRootDir", "(", "),", "\"", "htmlreports", "/", "foo", "!", "!!", "!", "bar", "/", "index", ".", "html", "\"", ").", "exists", "(", "))", ";", "HtmlPublisherTarget", ".", "HTMLAction", "action", "=", "job", ".", "getAction", "(", "HtmlPublisherTarget", ".", "HTMLAction", ".", "class", ")", ";", "Assert", ".", "assertNotNull", "(", "action", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "foo", "!", "!!", "!", "bar", "\"", ",", "action", ".", "getHTMLTarget", "(", ").", "getReportName", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "foo", "!", "!!", "!", "bar", "\"", ",", "action", ".", "getUrlName", "(", "))", ";", "/", "/", "legacy", "JenkinsRule", ".", "WebClient", "client", "=", "j", ".", "createWebClient", "(", ");", "HtmlPage", "page", "=", "client", ".", "getPage", "(", "job", ",", "\"", "foo", "!", "!!", "!", "bar", "/", "index", ".", "html", "\"", ");", "String", "text", "=", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "Assert", ".", "assertEquals", "(", "\"", "Sun", "Mar", "25", "15", ":", "42", ":", "10", "CEST", "2018", "\"", ",", "text", ".", "trim", "(", "))", ";", "job", ".", "getBuildersList", "(", ").", "clear", "(", ");", "String", "newDate", "=", "new", "Date", "(", ").", "toString", "(", ");", "job", ".", "getBuildersList", "(", ").", "add", "(", "new", "CreateFileBuilder", "(", "\"", "index", ".", "html", "\"", ",", "newDate", ")", ");", "job", ".", "save", "(", ");", "j", ".", "buildAndAssertSuccess", "(", "job", ")", ";", "Assert", ".", "assertTrue", "(", "new", "File", "(", "job", ".", "getRootDir", "(", "),", "\"", "htmlreports", "/", "foo_21_21_21_21bar", "/", "index", ".", "html", "\"", ").", "exists", "(", "))", ";", "action", "=", "job", ".", "getAction", "(", "HtmlPublisherTarget", ".", "HTMLAction", ".", "class", ")", ";", "Assert", ".", "assertNotNull", "(", "action", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "foo", "!", "!!", "!", "bar", "\"", ",", "action", ".", "getHTMLTarget", "(", ").", "getReportName", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "foo_21_21_21_21bar", "\"", ",", "action", ".", "getUrlName", "(", "))", ";", "/", "/", "new", "text", "=", "client", ".", "goTo", "(", "\"", "job", "/", "thejob", "/", "foo_21_21_21_21bar", "/", "index", ".", "html", "\"", ").", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "Assert", ".", "assertEquals", "(", "newDate", ",", "text", ".", "trim", "(", "))", ";", "/", "/", "leftovers", "from", "legacy", "naming", "Assert", ".", "assertTrue", "(", "new", "File", "(", "job", ".", "getRootDir", "(", "),", "\"", "htmlreports", "/", "foo", "!", "!!", "!", "bar", "/", "index", ".", "html", "\"", ").", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "testReportNameSanitization", "(", ")", "throws", "Exception", "{", "/", "/", "start", "with", "general", "'", "sanity", "'", "requirements", "/", "/", "failed", "in", "previous", "releases", "Assert", ".", "assertNotEquals", "(", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "bar", "\"", "),", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo_bar", "\"", "))", ";", "/", "/", "don", "'", "t", "collapse", "repeated", "chars", "Assert", ".", "assertNotEquals", "(", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "!", "bar", "\"", "),", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "!", "!!", "!", "bar", "\"", "))", ";", "/", "/", "now", "be", "specific", "-", "-", "we", "escape", "non", "alphanumeric", "UTF", "-", "8", "chars", "to", "their", "hex", "code", "with", "a", "'", "_", "'", "prefix", "Assert", ".", "assertEquals", "(", "\"", "foo_21bar", "\"", ",", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "!", "bar", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "foo_20bar", "\"", ",", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "bar", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "_20foo_20bar_20", "\"", ",", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"", "foo", "bar", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "_e5b79d_e58fa3", "\"", ",", "HtmlPublisherTarget", ".", "sanitizeReportName", "(", "\"\u5ddd", "\u53e3\"", "))", ";", "/", "/", "U", "+", "5DDD", "U", "+", "53E3", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "35", "@", "@", "<", "?", "xml", "version", "=", "'", "1", ".", "0", "'", "encoding", "=", "'", "UTF", "-", "8", "'", "?>", "<", "project", ">", "<", "description", ">", "</", "description", ">", "<", "keepDependencies", ">", "false", "<", "/", "keepDependencies", ">", "<", "properties", "/", ">", "<", "scm", "class", "=", "\"", "hudson", ".", "scm", ".", "NullSCM", "\"", "/>", "<", "canRoam", ">", "true", "<", "/", "canRoam", ">", "<", "disabled", ">", "false", "<", "/", "disabled", ">", "<", "blockBuildWhenDownstreamBuilding", ">", "false", "<", "/", "blockBuildWhenDownstreamBuilding", ">", "<", "blockBuildWhenUpstreamBuilding", ">", "false", "<", "/", "blockBuildWhenUpstreamBuilding", ">", "<", "triggers", "/", ">", "<", "concurrentBuild", ">", "false", "<", "/", "concurrentBuild", ">", "<", "builders", ">", "<", "hudson", ".", "tasks", ".", "Shell", ">", "<", "command", ">", "date", "&", "gt", ";", "index", ".", "html", "<", "/", "command", ">", "<", "/", "hudson", ".", "tasks", ".", "Shell", ">", "<", "/", "builders", ">", "<", "publishers", ">", "<", "htmlpublisher", ".", "HtmlPublisher", "plugin", "=", "\"", "htmlpublisher", "@", "1", ".", "14", "\"", ">", "<", "reportTargets", ">", "<", "htmlpublisher", ".", "HtmlPublisherTarget", ">", "<", "reportName", ">", "foo", "!", "!!", "!", "bar", "<", "/", "reportName", ">", "<", "reportDir", ">", "</", "reportDir", ">", "<", "reportFiles", ">", "index", ".", "html", "<", "/", "reportFiles", ">", "<", "alwaysLinkToLastBuild", ">", "false", "<", "/", "alwaysLinkToLastBuild", ">", "<", "reportTitles", ">", "</", "reportTitles", ">", "<", "keepAll", ">", "false", "<", "/", "keepAll", ">", "<", "allowMissing", ">", "false", "<", "/", "allowMissing", ">", "<", "includes", ">", "**", "/*", "</", "includes", ">", "<", "/", "htmlpublisher", ".", "HtmlPublisherTarget", ">", "<", "/", "reportTargets", ">", "<", "/", "htmlpublisher", ".", "HtmlPublisher", ">", "<", "/", "publishers", ">", "<", "buildWrappers", "/", ">", "<", "/", "project", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "141", "@", "@", "<", "!", "DOCTYPE", "html", "PUBLIC", "\"", "-/", "/", "W3C", "/", "/", "DTD", "XHTML", "1", ".", "0", "Strict", "/", "/", "EN", "\"", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "TR", "/", "xhtml1", "/", "DTD", "/", "xhtml1", "-", "strict", ".", "dtd", "\"", ">", "<", "html", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "1999", "/", "xhtml", "\"", "xml", ":", "lang", "=", "\"", "en", "\"", "lang", "=", "\"", "en", "\"", ">", "<", "head", ">", "<", "meta", "http", "-", "equiv", "=", "\"", "Content", "-", "Type", "\"", "content", "=", "\"", "text", "/", "html", "\"", "/", ">", "<", "!-", "-", "CSS", "Tabs", "is", "licensed", "under", "Creative", "Commons", "Attribution", "3", ".", "0", "-", "http", ":", "//", "creativecommons", ".", "org", "/", "licenses", "/", "by", "/", "3", ".", "0", "/", "-", "->", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", "body", "{", "font", ":", "100", "%", "verdana", ",", "arial", ",", "sans", "-", "serif", ";", "background", "-", "color", ":", "#", "fff", ";", "}", "/", "*", "begin", "css", "tabs", "*", "/", "ul", "#", "tabnav", "{", "/", "*", "general", "settings", "*", "/", "text", "-", "align", ":", "left", ";", "/", "*", "set", "to", "left", ",", "right", "or", "center", "*", "/", "margin", ":", "8px", "0", "0", "0", ";", "/", "*", "set", "margins", "as", "desired", "*", "/", "font", ":", "bold", "11px", "verdana", ",", "arial", ",", "sans", "-", "serif", ";", "/", "*", "set", "font", "as", "desired", "*", "/", "border", "-", "bottom", ":", "1px", "solid", "#", "6c6", ";", "/", "*", "set", "border", "COLOR", "as", "desired", "*", "/", "list", "-", "style", "-", "type", ":", "none", ";", "padding", ":", "3px", "10px", "3px", "10px", ";", "/", "*", "THIRD", "number", "must", "change", "with", "respect", "to", "padding", "-", "top", "(", "X", ")", "below", "*", "/", "}", "ul", "#", "tabnav", "li", "{", "/", "*", "do", "not", "change", "*", "/", "display", ":", "inline", ";", "}", "ul", "#", "tabnav", "li", ".", "selected", "{", "/", "*", "settings", "for", "selected", "tab", "*", "/", "border", "-", "bottom", ":", "1px", "solid", "#", "fff", ";", "/", "*", "set", "border", "color", "to", "page", "background", "color", "*", "/", "background", "-", "color", ":", "#", "fff", ";", "/", "*", "set", "background", "color", "to", "match", "above", "border", "color", "*", "/", "}", "ul", "#", "tabnav", "li", "{", "/", "*", "settings", "for", "all", "tab", "links", "*", "/", "padding", ":", "3px", "4px", ";", "/", "*", "set", "padding", "(", "tab", "size", ")", "as", "desired", ";", "FIRST", "number", "must", "change", "with", "respect", "to", "padding", "-", "top", "(", "X", ")", "above", "*", "/", "border", ":", "1px", "solid", "#", "6c6", ";", "/", "*", "set", "border", "COLOR", "as", "desired", ";", "usually", "matches", "border", "color", "specified", "in", "#", "tabnav", "*", "/", "background", "-", "color", ":", "#", "cfc", ";", "/", "*", "set", "unselected", "tab", "background", "color", "as", "desired", "*", "/", "color", ":", "#", "666", ";", "/", "*", "set", "unselected", "tab", "link", "color", "as", "desired", "*", "/", "margin", "-", "right", ":", "0px", ";", "/", "*", "set", "additional", "spacing", "between", "tabs", "as", "desired", "*", "/", "text", "-", "decoration", ":", "none", ";", "border", "-", "bottom", ":", "none", ";", "cursor", ":", "pointer", ";", "}", "ul", "#", "tabnav", "li", ":", "hover", "{", "/", "*", "settings", "for", "hover", "effect", "*", "/", "background", ":", "#", "afa", ";", "/", "*", "set", "desired", "hover", "color", "*", "/", "}", "/", "*", "end", "css", "tabs", "*", "/", "/", "*", "FF", "100", "%", "height", "iframe", "*", "/", "html", ",", "body", ",", "div", ",", "iframe", "{", "margin", ":", "0", ";", "padding", ":", "0", ";", "}", "iframe", "{", "display", ":", "block", ";", "width", ":", "100", "%", ";", "border", ":", "none", ";", "}", "h1", "{", "display", ":", "inline", ";", "float", ":", "left", ";", "font", "-", "size", ":", "small", ";", "margin", ":", "0", ";", "padding", ":", "0", "10px", ";", "}", "h2", "{", "display", ":", "inline", ";", "float", ":", "right", ";", "font", "-", "size", ":", "small", ";", "margin", ":", "0", ";", "padding", ":", "0", "10px", ";", "}", "<", "/", "style", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "function", "updateBody", "(", "tabId", ",", "page", ")", "{", "document", ".", "getElementById", "(", "selectedTab", ")", ".", "setAttribute", "(", "\"", "class", "\"", ",", "\"", "unselected", "\"", ");", "tab", "=", "document", ".", "getElementById", "(", "tabId", ")", "tab", ".", "setAttribute", "(", "\"", "class", "\"", ",", "\"", "selected", "\"", ");", "selectedTab", "=", "tabId", ";", "iframe", "=", "document", ".", "getElementById", "(", "\"", "myframe", "\"", ");", "iframe", ".", "src", "=", "tab", ".", "getAttribute", "(", "\"", "value", "\"", ");", "}", "function", "init", "(", "tabId", ")", "{", "updateBody", "(", "tabId", ")", ";", "updateViewport", "(", ");", "window", ".", "onresize", "=", "updateViewport", ";", "}", "function", "updateViewport", "(", "){", "var", "viewportheight", ";", "/", "/", "the", "more", "standards", "compliant", "browsers", "(", "mozilla", "/", "netscape", "/", "opera", "/", "IE7", ")", "use", "window", ".", "innerWidth", "and", "window", ".", "innerHeight", "if", "(", "typeof", "window", ".", "innerWidth", "!", "=", "'", "undefined", "'", ")", "{", "viewportheight", "=", "window", ".", "innerHeight", "}", "/", "/", "IE6", "in", "standards", "compliant", "mode", "(", "i", ".", "e", ".", "with", "a", "valid", "doctype", "as", "the", "first", "line", "in", "the", "document", ")", "else", "if", "(", "typeof", "document", ".", "documentElement", "!", "=", "'", "undefined", "'", "&", "&", "typeof", "document", ".", "documentElement", ".", "clientWidth", "!", "=", "'", "undefined", "'", "&", "&", "document", ".", "documentElement", ".", "clientWidth", "!", "=", "0", ")", "{", "viewportheight", "=", "document", ".", "documentElement", ".", "clientHeight", "}", "/", "/", "older", "versions", "of", "IE", "else", "{", "viewportheight", "=", "document", ".", "getElementsByTagName", "(", "'", "body", "'", ")[", "0", "]", ".", "clientHeight", "}", "iframe", "=", "document", ".", "getElementById", "(", "\"", "myframe", "\"", ");", "iframe", ".", "style", ".", "height", "=", "(", "viewportheight", "-", "30", ")", "+'", "px", "'", ";", "}", "var", "selectedTab", "=", "\"", "tab1", "\"", "<", "/", "script", ">", "<", "/", "head", ">", "<", "body", "onload", "=", "\"", "init", "(", "'", "tab1", "'", ");", "\">", "<", "h1", ">", "<", "a", "id", "=", "\"", "hudson_link", "\"", "href", "=", "\"#", "\">", "</", "a", ">", "</", "h1", ">", "<", "h2", ">", "<", "a", "id", "=", "\"", "zip_link", "\"", "href", "=", "\"#", "\">", "Zip", "<", "/", "a", ">", "</", "h2", ">", "<", "ul", "id", "=", "\"", "tabnav", "\"", ">", "<", "li", "id", "=", "\"", "tab1", "\"", "class", "=", "\"", "unselected", "\"", "onclick", "=", "\"", "updateBody", "(", "'", "tab1", "'", ");", "\"", "value", "=", "\"", "index", ".", "html", "\"", ">", "index", "<", "/", "li", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "document", ".", "getElementById", "(", "\"", "hudson_link", "\"", ").", "innerHTML", "=", "\"", "Back", "to", "ffff", "\"", ";<", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "document", ".", "getElementById", "(", "\"", "hudson_link", "\"", ").", "onclick", "=", "function", "(", ")", "{", "history", ".", "go", "(", "-", "1", ")", ";", "return", "false", ";", "}", ";<", "/", "script", ">", "<", "script", "type", "=", "\"", "text", "/", "javascript", "\"", ">", "document", ".", "getElementById", "(", "\"", "zip_link", "\"", ").", "href", "=", "\"*", "zip", "*", "/", "foo", "!", "!!", "!", "bar", ".", "zip", "\"", ";<", "/", "script", ">", "<", "/", "ul", ">", "<", "div", ">", "<", "iframe", "id", "=", "\"", "myframe", "\"", "height", "=", "\"", "100", "%", "\"", "width", "=", "\"", "100", "%", "\"", "frameborder", "=", "\"", "0", "\"", "><", "/", "iframe", ">", "<", "/", "div", ">", "<", "/", "body", ">", "<", "/", "html", ">", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "Sun", "Mar", "25", "15", ":", "42", ":", "10", "CEST", "2018", "@", "@", "-", "0", ",", "0", "+", "1", "@", "@", "2"], "docstring_tokens": ["path", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "32", ",", "7", "+", "32", ",", "6", "@", "@", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "annotation", ".", "Autowired", ";", "import", "org", ".", "springframework", ".", "ui", ".", "ModelMap", ";", "import", "org", ".", "thymeleaf", ".", "ITemplateEngine", ";", "import", "org", ".", "thymeleaf", ".", "TemplateEngine", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "@", "@", "-", "63", ",", "14", "+", "62", ",", "14", "@", "@", "protected", "IBaseResource", "addCommonParams", "(", "HttpServletRequest", "theServletRequest", ",", "fi", "final", "String", "serverBase", "=", "theRequest", ".", "getServerBase", "(", "theServletRequest", ",", "myConfig", ")", ";", "final", "String", "serverName", "=", "theRequest", ".", "getServerName", "(", "myConfig", ")", ";", "final", "String", "apiKey", "=", "theRequest", ".", "getApiKey", "(", "theServletRequest", ",", "myConfig", ")", ";", "theModel", ".", "put", "(", "\"", "serverId", "\"", ",", "serverId", ")", ";", "theModel", ".", "put", "(", "\"", "base", "\"", ",", "serverBase", ")", ";", "theModel", ".", "put", "(", "\"", "baseName", "\"", ",", "serverName", ")", ";", "theModel", ".", "put", "(", "\"", "apiKey", "\"", ",", "apiKey", ")", ";", "theModel", ".", "put", "(", "\"", "resourceName", "\"", ",", "defaultString", "(", "theRequest", ".", "getResource", "(", "))", ");", "theModel", ".", "put", "(", "\"", "encoding", "\"", ",", "theRequest", ".", "getEncoding", "(", "))", ";", "theModel", ".", "put", "(", "\"", "pretty", "\"", ",", "theRequest", ".", "getPretty", "(", "))", ";", "theModel", ".", "put", "(", "\"", "_summary", "\"", ",", "theRequest", ".", "get_summary", "(", "))", ";", "theModel", ".", "put", "(", "\"", "serverId", "\"", ",", "sanitizeInput", "(", "serverId", ")", ");", "theModel", ".", "put", "(", "\"", "base", "\"", ",", "sanitizeInput", "(", "serverBase", ")", ");", "theModel", ".", "put", "(", "\"", "baseName", "\"", ",", "sanitizeInput", "(", "serverName", ")", ");", "theModel", ".", "put", "(", "\"", "apiKey", "\"", ",", "sanitizeInput", "(", "apiKey", ")", ");", "theModel", ".", "put", "(", "\"", "resourceName", "\"", ",", "sanitizeInput", "(", "defaultString", "(", "theRequest", ".", "getResource", "(", "))", "))", ";", "theModel", ".", "put", "(", "\"", "encoding", "\"", ",", "sanitizeInput", "(", "theRequest", ".", "getEncoding", "(", "))", ");", "theModel", ".", "put", "(", "\"", "pretty", "\"", ",", "sanitizeInput", "(", "theRequest", ".", "getPretty", "(", "))", ");", "theModel", ".", "put", "(", "\"", "_summary", "\"", ",", "sanitizeInput", "(", "theRequest", ".", "get_summary", "(", "))", ");", "theModel", ".", "put", "(", "\"", "serverEntries", "\"", ",", "myConfig", ".", "getIdToServerName", "(", "))", ";", "return", "loadAndAddConf", "(", "theServletRequest", ",", "theRequest", ",", "theModel", ")", ";", "@", "@", "-", "307", ",", "7", "+", "306", ",", "6", "@", "@", "private", "IBaseResource", "loadAndAddConf", "(", "HttpServletRequest", "theServletRequest", ",", "final", "throw", "new", "IllegalStateException", "(", "\"", "Unknown", "version", ":", "\"", "+", "theRequest", ".", "getFhirVersion", "(", "myConfig", ")", ");", "}", "private", "IResource", "loadAndAddConfDstu2", "(", "HttpServletRequest", "theServletRequest", ",", "final", "HomeRequest", "theRequest", ",", "final", "ModelMap", "theModel", ")", "{", "CaptureInterceptor", "interceptor", "=", "new", "CaptureInterceptor", "(", ");", "GenericClient", "client", "=", "theRequest", ".", "newClient", "(", "theServletRequest", ",", "getContext", "(", "theRequest", ")", ",", "myConfig", ",", "interceptor", ")", ";", "@", "@", "-", "746", ",", "4", "+", "744", ",", "21", "@", "@", "public", "void", "interceptResponse", "(", "IHttpResponse", "theResponse", ")", "throws", "IOException", "{", "}", "private", "static", "String", "sanitizeInput", "(", "String", "theString", ")", "{", "String", "retVal", "=", "theString", ";", "if", "(", "retVal", "!", "=", "null", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "retVal", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "nextChar", "=", "retVal", ".", "charAt", "(", "i", ")", ";", "switch", "(", "nextChar", ")", "{", "case", "'", "\\'", "':", "case", "'", "\"'", ":", "case", "'", "<'", ":", "case", "'", ">'", ":", "retVal", "=", "retVal", ".", "replace", "(", "nextChar", ",", "'", "_", "'", ");", "}", "}", "}", "return", "retVal", ";", "}", "}", "@", "@", "-", "7", ",", "6", "+", "7", ",", "11", "@", "@", "<", "/", "properties", ">", "<", "body", ">", "<", "release", "version", "=", "\"", "3", ".", "8", ".", "0", "\"", "date", "=", "\"", "TBD", "\"", "description", "=", "\"", "Hippo", "\"", ">", "<", "action", "type", "=", "\"", "fix", "\"", ">", "A", "potential", "security", "vulnerability", "in", "the", "hapi", "-", "fhir", "-", "testpage", "-", "overlay", "project", "was", "corrected", ":", "A", "URL", "parameter", "was", "not", "being", "correctly", "escaped", ",", "leading", "to", "a", "potential", "XSS", "vulnerabnility", ".", "A", "big", "thanks", "to", "Mudit", "Punia", "and", "Dushyant", "Garg", "for", "reporting", "this", ".", "<", "/", "action", ">", "<", "action", "type", "=", "\"", "add", "\"", ">", "The", "version", "of", "a", "few", "dependencies", "have", "been", "bumped", "to", "the", "latest", "versions", "(", "dependent", "HAPI", "modules", "listed", "in", "brackets", ")", ":"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "3", "+", "1", ",", "6", "@", "@", "2016", "-", "08", "-", "03", "6", ".", "9", ".", "5", "-", "5", "Cristy", "<", "quetzlzacatenango", "@", "image", ".", "..", ">", "*", "Prevent", "buffer", "overflow", "(", "bug", "report", "from", "Max", "Thrane", ")", ".", "2016", "-", "07", "-", "30", "6", ".", "9", ".", "5", "-", "4", "Cristy", "<", "quetzlzacatenango", "@", "image", ".", "..", ">", "*", "Release", "ImageMagick", "version", "6", ".", "9", ".", "5", "-", "4", ",", "GIT", "revision", "10973", ":", "a00fa93", ":", "20160729", ".", "@", "@", "-", "2998", ",", "7", "+", "2998", ",", "7", "@", "@", "MagickExport", "MagickBooleanType", "DrawImage", "(", "Image", "*", "image", ",", "const", "DrawInfo", "*", "draw_info", ")", "}", "length", "+", "+;", "}", "length", "=", "length", "*", "BezierQuantum", "/", "2", ";", "length", "=", "length", "*", "BezierQuantum", ";", "break", ";", "}", "case", "CirclePrimitive", ":"], "docstring_tokens": ["buffer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "88", ",", "13", "+", "88", ",", "13", "@", "@", "int", "__ext4_journal_stop", "(", "const", "char", "*", "where", ",", "unsigned", "int", "line", ",", "handle_t", "*", "handle", ")", "return", "0", ";", "}", "err", "=", "handle", "-", ">", "h_err", ";", "if", "(", "!", "handle", "-", ">", "h_transaction", ")", "{", "err", "=", "jbd2_journal_stop", "(", "handle", ")", ";", "return", "handle", "-", ">", "h_err", "?", "handle", "-", ">", "h_err", ":", "err", ";", "rc", "=", "jbd2_journal_stop", "(", "handle", ")", ";", "return", "err", "?", "err", ":", "rc", ";", "}", "sb", "=", "handle", "-", ">", "h_transaction", "-", ">", "t_journal", "-", ">", "j_private", ";", "err", "=", "handle", "-", ">", "h_err", ";", "rc", "=", "jbd2_journal_stop", "(", "handle", ")", ";", "if", "(", "!", "err", ")"], "docstring_tokens": ["use-after-free", "error"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "40", ",", "8", "+", "40", ",", "11", "@", "@", "class", "SaferEval", "{", "if", "(", "typeof", "code", "!", "==", "'", "string", "'", ")", "{", "throw", "new", "TypeError", "(", "'", "not", "a", "string", "'", ")", "}", "let", "src", "=", "'", "Object", ".", "constructor", "=", "function", "(", ")", "{", "};", "\\", "n", "'", "src", "+", "=", "'", "return", "'", "+", "code", "+", "'", ";\\", "n", "'", "return", "vm", ".", "runInContext", "(", "'", "(", "function", "(", ")", "{", "\"", "use", "strict", "\"", ";", "return", "'", "+", "code", "+", "'", "})", "()", "',", "'", "(", "function", "(", ")", "{", "\"", "use", "strict", "\"", ";", "'", "+", "src", "+", "'", "})", "()", "',", "this", ".", "_context", ",", "this", ".", "_options", ")"], "docstring_tokens": ["arbitrary", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2353", ",", "8", "+", "2353", ",", "12", "@", "@", "static", "ssize_t", "n_tty_write", "(", "struct", "tty_struct", "*", "tty", ",", "struct", "file", "*", "file", ",", "if", "(", "tty", "-", ">", "ops", "-", ">", "flush_chars", ")", "tty", "-", ">", "ops", "-", ">", "flush_chars", "(", "tty", ")", ";", "}", "else", "{", "struct", "n_tty_data", "*", "ldata", "=", "tty", "-", ">", "disc_data", ";", "while", "(", "nr", ">", "0", ")", "{", "mutex_lock", "(", "&", "ldata", "-", ">", "output_lock", ")", ";", "c", "=", "tty", "-", ">", "ops", "-", ">", "write", "(", "tty", ",", "b", ",", "nr", ")", ";", "mutex_unlock", "(", "&", "ldata", "-", ">", "output_lock", ")", ";", "if", "(", "c", "<", "0", ")", "{", "retval", "=", "c", ";", "goto", "break_out", ";"], "docstring_tokens": ["raw", "mode", "pty", "echo", "race", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "providers", ".", "jackson", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "exc", ".", "UnrecognizedPropertyException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MediaType", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "ExceptionMapper", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "Provider", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "util", ".", "HttpResponseCodes", ";", "/", "**", "*", "(", "RESTEASY", "-", "1485", ")", "Address", "concerns", "of", "a", "possible", "XSS", "attack", "by", "removing", "some", "*", "details", "of", "the", "exception", ".", "*", "*", "User", ":", "rsearls", "*", "Date", ":", "9", "/", "22", "/", "16", "*", "/", "@", "Provider", "public", "class", "UnrecognizedPropertyExceptionHandler", "implements", "ExceptionMapper", "<", "UnrecognizedPropertyException", ">", "{", "@", "Override", "public", "Response", "toResponse", "(", "UnrecognizedPropertyException", "exception", ")", "{", "return", "Response", ".", "status", "(", "HttpResponseCodes", ".", "SC_BAD_REQUEST", ")", ".", "type", "(", "MediaType", ".", "TEXT_HTML", ")", ".", "entity", "(", "exception", ".", "getOriginalMessage", "(", "))", ".", "build", "(", ");", "}", "}", "@", "@", "-", "1", "+", "1", ",", "2", "@", "@", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "providers", ".", "jackson", ".", "ResteasyJackson2Provider", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "providers", ".", "jackson", ".", "UnrecognizedPropertyExceptionHandler", "@", "@", "-", "0", ",", "0", "+", "1", ",", "73", "@", "@", "package", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "interceptors", ".", "encoding", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "javax", ".", "annotation", ".", "Priority", ";", "import", "javax", ".", "ws", ".", "rs", ".", "Priorities", ";", "import", "javax", ".", "ws", ".", "rs", ".", "container", ".", "ContainerRequestContext", ";", "import", "javax", ".", "ws", ".", "rs", ".", "container", ".", "ContainerResponseContext", ";", "import", "javax", ".", "ws", ".", "rs", ".", "container", ".", "ContainerResponseFilter", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ext", ".", "Provider", ";", "import", "org", ".", "jboss", ".", "resteasy", ".", "util", ".", "HttpResponseCodes", ";", "/", "**", "*", "(", "RESTEASY", "-", "1485", ")", "Thwart", "select", "XSS", "attack", "by", "escaping", "special", "chars", "in", "*", "Exception", "message", ".", "*", "*", "User", ":", "rsearls", "*", "Date", ":", "9", "/", "16", "/", "16", "*", "/", "@", "Provider", "@", "Priority", "(", "Priorities", ".", "ENTITY_CODER", ")", "public", "class", "MessageSanitizerContainerResponseFilter", "implements", "ContainerResponseFilter", "{", "@", "Override", "public", "void", "filter", "(", "ContainerRequestContext", "requestContext", ",", "ContainerResponseContext", "responseContext", ")", "throws", "IOException", "{", "if", "(", "HttpResponseCodes", ".", "SC_BAD_REQUEST", "=", "=", "responseContext", ".", "getStatus", "(", "))", "{", "Object", "entity", "=", "responseContext", ".", "getEntity", "(", ");", "if", "(", "entity", "!", "=", "null", "&", "&", "entity", "instanceof", "String", ")", "{", "String", "escapedMsg", "=", "escapeXml", "(", "(", "String", ")", "entity", ")", ";", "responseContext", ".", "setEntity", "(", "escapedMsg", ")", ";", "}", "}", "}", "/", "/", "set", "of", "replacement", "chars", "to", "hex", "encoding", "private", "static", "final", "HashMap", "<", "String", ",", "String", ">", "replacementMap", ";", "static", "{", "replacementMap", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "replacementMap", ".", "put", "(", "\"/", "\",", "\"", "&#", "x2F", ";", "\")", ";", "replacementMap", ".", "put", "(", "\"<", "\",", "\"", "&", "lt", ";", "\")", ";", "replacementMap", ".", "put", "(", "\">", "\",", "\"", "&", "gt", ";", "\")", ";", "replacementMap", ".", "put", "(", "\"&", "\",", "\"", "&", "amp", ";", "\")", ";", "replacementMap", ".", "put", "(", "\"\\", "\"\"", ",", "\"", "&", "quot", ";", "\")", ";", "replacementMap", ".", "put", "(", "\"'", "\",", "\"", "&#", "x27", ";", "\")", ";", "}", "/", "**", "*", "Replace", "char", "with", "the", "hex", "encoding", "*", "@", "param", "str", "*", "@", "return", "*", "/", "private", "String", "escapeXml", "(", "String", "str", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ");", "if", "(", "!", "str", ".", "isEmpty", "(", "))", "{", "/", "/", "the", "vertical", "bar", ",", "|", ",", "is", "a", "special", "regular", "expression", "char", "that", "/", "/", "causes", "splitting", "on", "individual", "characters", ".", "for", "(", "String", "key", ":", "str", ".", "split", "(", "\"|", "\")", ")", "{", "String", "value", "=", "replacementMap", ".", "get", "(", "key", ")", ";", "if", "(", "value", "=", "=", "null", ")", "{", "sb", ".", "append", "(", "key", ")", ";", "}", "else", "{", "sb", ".", "append", "(", "value", ")", ";", "}", "}", "}", "return", "sb", ".", "toString", "(", ");", "}", "}", "@", "@", "-", "16", ",", "5", "+", "16", ",", "6", "@", "@", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "providers", ".", "IIOImageProvider", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "interceptors", ".", "CacheControlFeature", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "interceptors", ".", "encoding", ".", "ClientContentEncodingAnnotationFeature", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "interceptors", ".", "encoding", ".", "ServerContentEncodingAnnotationFeature", "org", ".", "jboss", ".", "resteasy", ".", "plugins", ".", "interceptors", ".", "encoding", ".", "MessageSanitizerContainerResponseFilter", "@", "@", "-", "157", ",", "7", "+", "157", ",", "7", "@", "@", "public", "void", "testViolationsBeforeReturnValue", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "size", "must", "be", "between", "3", "and", "5", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "z", "\"", ",", "violation", ".", "getValue", "(", "))", ";", "violation", "=", "e", ".", "getClassViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", ">", "5", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", "&", "gt", ";", "5", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "violation", ".", "getValue", "(", ").", "startsWith", "(", "\"", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "validation", ".", "resource", ".", "ValidationCoreResourceWithAllViolationTypes", "@", "\")", ");", "response", ".", "close", "(", ");", "}", "@", "@", "-", "205", ",", "11", "+", "205", ",", "11", "@", "@", "public", "void", "testViolationsBeforeReturnValue", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "\"", "Exception", "has", "wrong", "message", "\"", ",", "\"", "size", "must", "be", "between", "3", "and", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Exception", "has", "wrong", "value", "\"", ",", "\"", "z", "\"", ",", "cv", ".", "getValue", "(", "))", ";", "cv", "=", "e", ".", "getClassViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "\"", "Exception", "has", "wrong", "message", "\"", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", ">", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Exception", "has", "wrong", "message", "\"", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", "&", "gt", ";", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "logger", ".", "info", "(", "\"", "value", ":", "\"", "+", "cv", ".", "getValue", "(", "))", ";", "Assert", ".", "assertTrue", "(", "\"", "Exception", "has", "wrong", "value", "\"", ",", "cv", ".", "getValue", "(", ").", "startsWith", "(", "\"", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "validation", ".", "resource", ".", "ViolationExceptionResourceWithFiveViolations", "@", "\")", ");", "cv", "=", "e", ".", "getParameterViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "\"", "Exception", "has", "wrong", "message", "\"", ",", "\"", "s", "must", "have", "length", ":", "3", "<", "=", "length", "<", "=", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Exception", "has", "wrong", "message", "\"", ",", "\"", "s", "must", "have", "length", ":", "3", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "\"", "Exception", "has", "wrong", "value", "\"", ",", "\"", "Foo", "[", "p", "]", "\",", "cv", ".", "getValue", "(", "))", ";", "}", "}", "@", "@", "-", "367", ",", "8", "+", "367", ",", "8", "@", "@", "public", "void", "testClassConstraint", "(", ")", "throws", "Exception", "{", "ViolationReport", "r", "=", "new", "ViolationReport", "(", "entity", ")", ";", "TestUtil", ".", "countViolations", "(", "r", ",", "0", ",", "0", ",", "1", ",", "0", ",", "0", ")", ";", "ResteasyConstraintViolation", "cv", "=", "r", ".", "getClassViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", ">", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "ValidationComplexResourceWithClassConstraint", "(", "\\\"", "a", "\\", "\",", "\\", "\"", "b", "\\", "\")", "\",", "cv", ".", "getValue", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", "&", "gt", ";", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "ValidationComplexResourceWithClassConstraint", "(", "&", "quot", ";", "a", "&", "quot", ";", ",", "&", "quot", ";", "b", "&", "quot", ";", ")\"", ",", "cv", ".", "getValue", "(", "))", ";", "logger", ".", "info", "(", "cv", ".", "getValue", "(", "))", ";", "response", ".", "close", "(", ");", "}", "@", "@", "-", "542", ",", "7", "+", "542", ",", "7", "@", "@", "public", "void", "testParameters", "(", ")", "throws", "Exception", "{", "ViolationReport", "r", "=", "new", "ViolationReport", "(", "entity", ")", ";", "TestUtil", ".", "countViolations", "(", "r", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ")", ";", "ResteasyConstraintViolation", "cv", "=", "r", ".", "getParameterViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv", ".", "getMessage", "(", ").", "equals", "(", "\"", "s", "must", "have", "length", ":", "1", "<", "=", "length", "<", "=", "3", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv", ".", "getMessage", "(", ").", "equals", "(", "\"", "s", "must", "have", "length", ":", "1", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "3", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "ValidationComplexFoo", "[", "abcdef", "]", "\",", "cv", ".", "getValue", "(", "))", ";", "response", ".", "close", "(", ");", "@", "@", "-", "554", ",", "7", "+", "554", ",", "7", "@", "@", "public", "void", "testParameters", "(", ")", "throws", "Exception", "{", "r", "=", "new", "ViolationReport", "(", "String", ".", "class", ".", "cast", "(", "entity", ")", ");", "TestUtil", ".", "countViolations", "(", "r", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ")", ";", "cv", "=", "r", ".", "getParameterViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv", ".", "getMessage", "(", ").", "equals", "(", "\"", "s", "must", "have", "length", ":", "3", "<", "=", "length", "<", "=", "5", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv", ".", "getMessage", "(", ").", "equals", "(", "\"", "s", "must", "have", "length", ":", "3", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "5", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "ValidationComplexFoo", "[", "abcdef", "]", "\",", "cv", ".", "getValue", "(", "))", ";", "response", ".", "close", "(", ");", "@", "@", "-", "573", ",", "9", "+", "573", ",", "9", "@", "@", "public", "void", "testParameters", "(", ")", "throws", "Exception", "{", "cv1", "=", "cv2", ";", "cv2", "=", "temp", ";", "}", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv1", ".", "getMessage", "(", ").", "equals", "(", "\"", "s", "must", "have", "length", ":", "1", "<", "=", "length", "<", "=", "3", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv1", ".", "getMessage", "(", ").", "equals", "(", "\"", "s", "must", "have", "length", ":", "1", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "3", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "ValidationComplexFoo", "[", "abcdef", "]", "\",", "cv1", ".", "getValue", "(", "))", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv2", ".", "getMessage", "(", ").", "equals", "(", "\"", "s", "must", "have", "length", ":", "3", "<", "=", "length", "<", "=", "5", "\"", "))", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv2", ".", "getMessage", "(", ").", "equals", "(", "\"", "s", "must", "have", "length", ":", "3", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "5", "\"", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "ValidationComplexFoo", "[", "abcdef", "]", "\",", "cv2", ".", "getValue", "(", "))", ";", "response", ".", "close", "(", ");", "@", "@", "-", "714", ",", "10", "+", "714", ",", "10", "@", "@", "public", "void", "testViolationsBeforeReturnValue", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "size", "must", "be", "between", "3", "and", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "z", "\"", ",", "cv", ".", "getValue", "(", "))", ";", "cv", "=", "r", ".", "getClassViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", ">", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", "&", "gt", ";", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "cv", ".", "getValue", "(", ").", "startsWith", "(", "\"", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "validation", ".", "resource", ".", "ValidationComplexResourceWithAllFivePotentialViolations", "@", "\")", ");", "cv", "=", "r", ".", "getParameterViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "s", "must", "have", "length", ":", "3", "<", "=", "length", "<", "=", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "s", "must", "have", "length", ":", "3", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "ValidationComplexFoo", "[", "p", "]", "\",", "cv", ".", "getValue", "(", "))", ";", "response", ".", "close", "(", ");", "}", "@", "@", "-", "876", ",", "7", "+", "876", ",", "7", "@", "@", "public", "void", "testLocators", "(", ")", "throws", "Exception", "{", "cv", "=", "r", ".", "getPropertyViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "size", "must", "be", "between", "3", "and", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "cv", "=", "r", ".", "getClassViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", ">", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", "&", "gt", ";", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertTrue", "(", "RESPONSE_ERROR_MSG", ",", "cv", ".", "getValue", "(", ").", "startsWith", "(", "\"", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "validation", ".", "resource", ".", "ValidationComplexResourceWithAllFivePotentialViolations", "@", "\")", ");", "response", ".", "close", "(", ");", "@", "@", "-", "936", ",", "10", "+", "936", ",", "10", "@", "@", "public", "void", "testAsynch", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "size", "must", "be", "between", "3", "and", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "z", "\"", ",", "cv", ".", "getValue", "(", "))", ";", "cv", "=", "r", ".", "getClassViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", ">", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", "&", "gt", ";", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertTrue", "(", "RESPONSE_ERROR_MSG", ",", "cv", ".", "getValue", "(", ").", "startsWith", "(", "\"", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "validation", ".", "resource", ".", "ValidationComplexResourceWithAllFivePotentialViolations", "@", "\")", ");", "cv", "=", "r", ".", "getParameterViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "s", "must", "have", "length", ":", "3", "<", "=", "length", "<", "=", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "s", "must", "have", "length", ":", "3", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "5", "\"", ",", "cv", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "ValidationComplexFoo", "[", "p", "]", "\",", "cv", ".", "getValue", "(", "))", ";", "response", ".", "close", "(", ");", "@", "@", "-", "1008", ",", "7", "+", "1008", ",", "7", "@", "@", "public", "void", "testCrossParameterConstraint", "(", ")", "throws", "Exception", "{", "TestUtil", ".", "countViolations", "(", "r", ",", "0", ",", "0", ",", "0", ",", "1", ",", "0", ")", ";", "ResteasyConstraintViolation", "violation", "=", "r", ".", "getParameterViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "logger", ".", "info", "(", "\"", "violation", ":", "\"", "+", "violation", ")", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Parameters", "must", "total", "<", "=", "7", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Parameters", "must", "total", "&", "lt", ";", "=", "7", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "logger", ".", "info", "(", "\"", "violation", "value", ":", "\"", "+", "violation", ".", "getValue", "(", "))", ";", "Assert", ".", "assertEquals", "(", "RESPONSE_ERROR_MSG", ",", "\"", "[", "5", ",", "7", "]", "\",", "violation", ".", "getValue", "(", "))", ";", "response", ".", "close", "(", ");", "@", "@", "-", "184", ",", "10", "+", "184", ",", "10", "@", "@", "public", "void", "testViolationsBeforeReturnValue", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "size", "must", "be", "between", "3", "and", "5", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "z", "\"", ",", "violation", ".", "getValue", "(", "))", ";", "violation", "=", "r", ".", "getClassViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", ">", "5", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "Concatenation", "of", "s", "and", "t", "must", "have", "length", "&", "gt", ";", "5", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "violation", ".", "getValue", "(", ").", "startsWith", "(", "\"", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "validation", ".", "resource", ".", "ValidationCoreResourceWithAllViolationTypes", "@", "\")", ");", "violation", "=", "r", ".", "getParameterViolations", "(", ").", "iterator", "(", ").", "next", "(", ");", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "s", "must", "have", "length", ":", "3", "<", "=", "length", "<", "=", "5", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "s", "must", "have", "length", ":", "3", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "5", "\"", ",", "violation", ".", "getMessage", "(", "))", ";", "Assert", ".", "assertEquals", "(", "WRONG_ERROR_MSG", ",", "\"", "ValidationCoreFoo", "[", "p", "]", "\",", "violation", ".", "getValue", "(", "))", ";", "response", ".", "close", "(", ");", "}", "@", "@", "-", "371", ",", "12", "+", "371", ",", "12", "@", "@", "protected", "void", "doTestText_pre", "(", "String", "mediaType", ")", "throws", "Exception", "{", "String", "classViolation", "=", "\"", "[", "CLASS", "]", "\\", "r", "\"", "+", "\"", "[]", "\\", "r", "\"", "+", "\"", "[", "Concatenation", "of", "s", "and", "u", "must", "have", "length", ">", "5", "]", "\\", "r", "\"", "+", "\"", "[", "Concatenation", "of", "s", "and", "u", "must", "have", "length", "&", "gt", ";", "5", "]", "\\", "r", "\"", "\"", "[", "org", ".", "jboss", ".", "resteasy", ".", "test", ".", "validation", ".", "resource", ".", "ValidationXMLResourceWithAllFivePotentialViolations", "\"", ";", "String", "parameterViolation", "=", "\"", "[", "PARAMETER", "]", "\\", "r", "\"", "+", "\"", "[", "post", ".", "arg0", "]", "\\", "r", "\"", "+", "\"", "[", "s", "must", "have", "length", ":", "3", "<", "=", "length", "<", "=", "5", "]", "\\", "r", "\"", "+", "\"", "[", "s", "must", "have", "length", ":", "3", "&", "lt", ";", "=", "length", "&", "lt", ";", "=", "5", "]", "\\", "r", "\"", "\"", "[", "ValidationXMLFoo", "[", "p", "]", "]\"", ";", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "entity", ".", "contains", "(", "fieldViolation1", ")", ");", "Assert", ".", "assertTrue", "(", "WRONG_ERROR_MSG", ",", "entity", ".", "contains", "(", "fieldViolation2", ")", ");", "@", "@", "-", "529", ",", "7", "+", "529", ",", "7", "@", "@", "void", "doDTDFails", "(", "String", "ext", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "HttpResponseCodes", ".", "SC_BAD_REQUEST", ",", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "exception", "in", "response", "\"", ",", "entity", ",", "startsWith", "(", "\"", "javax", ".", "xml", ".", "bind", ".", "UnmarshalException", "\"", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "content", "of", "response", "\"", ",", "entity", ",", "containsString", "(", "\"", "DOCTYPE", "\"", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "content", "of", "response", "\"", ",", "entity", ",", "containsString", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "content", "of", "response", "\"", ",", "entity", ",", "containsString", "(", "\"", "http", ":", "&#", "x2F", ";", "&#", "x2F", ";", "apache", ".", "org", "&", "#", "x2F", ";", "xml", "&", "#", "x2F", ";", "features", "&", "#", "x2F", ";", "disallow", "-", "doctype", "-", "decl", "\"", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "content", "of", "response", "\"", ",", "entity", ",", "containsString", "(", "\"", "true", "\"", "))", ";", "}", "@", "@", "-", "545", ",", "7", "+", "545", ",", "7", "@", "@", "void", "doDTDFails", "(", "String", "ext", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "HttpResponseCodes", ".", "SC_BAD_REQUEST", ",", "response", ".", "getStatus", "(", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "exception", "in", "response", "\"", ",", "entity", ",", "startsWith", "(", "\"", "javax", ".", "xml", ".", "bind", ".", "UnmarshalException", "\"", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "content", "of", "response", "\"", ",", "entity", ",", "containsString", "(", "\"", "DOCTYPE", "\"", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "content", "of", "response", "\"", ",", "entity", ",", "containsString", "(", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "content", "of", "response", "\"", ",", "entity", ",", "containsString", "(", "\"", "http", ":", "&#", "x2F", ";", "&#", "x2F", ";", "apache", ".", "org", "&", "#", "x2F", ";", "xml", "&", "#", "x2F", ";", "features", "&", "#", "x2F", ";", "disallow", "-", "doctype", "-", "decl", "\"", "))", ";", "Assert", ".", "assertThat", "(", "\"", "Wrong", "content", "of", "response", "\"", ",", "entity", ",", "containsString", "(", "\"", "true", "\"", "))", ";", "}"], "docstring_tokens": ["cross-site", "scripting", "(xss", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "32", ",", "10", "+", "32", ",", "15", "@", "@", "public", "final", "class", "ReconciliationReportParser", "{", "private", "static", "final", "XMLInputFactory", "INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "ReconciliationReport", "parse", "(", "final", "Date", "run", ",", "final", "InputStream", "in", ")", "throws", "XMLStreamException", "{", "XMLStreamReader", "streamReader", "=", "INPUT_FACTORY", ".", "createXMLStreamReader", "(", "in", ")", ";", "XMLStreamReader", "streamReader", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "in", ")", ";", "streamReader", ".", "nextTag", "(", ");", "/", "/", "root", "streamReader", ".", "nextTag", "(", ");", "/", "/", "report", "streamReader", ".", "nextTag", "(", ");", "/", "/", "reportlet", "@", "@", "-", "41", ",", "6", "+", "41", ",", "13", "@", "@", "private", "static", "final", "ObjectMapper", "OBJECT_MAPPER", "=", "new", "ObjectMapper", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "Deployment", "deployDefinition", "(", "final", "ProcessEngine", "engine", ",", "final", "String", "resourceName", ",", "final", "byte", "[", "]", "definition", ")", "{", "@", "@", "-", "58", ",", "7", "+", "65", ",", "7", "@", "@", "public", "static", "void", "deployModel", "(", "final", "ProcessEngine", "engine", ",", "final", "ProcessDefiniti", "getResourceAsStream", "(", "procDef", ".", "getDeploymentId", "(", "),", "procDef", ".", "getResourceName", "(", "))", ";", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "bpmnStream", ")", ")", "{", "xtr", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLStreamReader", "(", "isr", ")", ";", "xtr", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "isr", ")", ";", "BpmnModel", "bpmnModel", "=", "new", "BpmnXMLConverter", "(", ").", "convertToBpmnModel", "(", "xtr", ")", ";", "Model", "model", "=", "engine", ".", "getRepositoryService", "(", ").", "newModel", "(", ");", "@", "@", "-", "18", ",", "16", "+", "18", ",", "14", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "syncope", ".", "core", ".", "flowable", ".", "support", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "sql", ".", "DataSource", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringUtils", ";", "import", "org", ".", "flowable", ".", "engine", ".", "ProcessEngine", ";", "import", "org", ".", "flowable", ".", "common", ".", "engine", ".", "impl", ".", "cfg", ".", "SpringBeanFactoryProxyMap", ";", "import", "org", ".", "flowable", ".", "common", ".", "engine", ".", "impl", ".", "interceptor", ".", "EngineConfigurationConstants", ";", "import", "org", ".", "flowable", ".", "engine", ".", "form", ".", "AbstractFormType", ";", "import", "org", ".", "flowable", ".", "engine", ".", "impl", ".", "util", ".", "EngineServiceUtil", ";", "import", "org", ".", "flowable", ".", "idm", ".", "spring", ".", "SpringIdmEngineConfiguration", ";", "import", "org", ".", "flowable", ".", "spring", ".", "SpringExpressionManager", ";", "@", "@", "-", "84", ",", "9", "+", "82", ",", "8", "@", "@", "public", "DomainProcessEngine", "getObject", "(", ")", "throws", "Exception", "{", "EngineConfigurationConstants", ".", "KEY_IDM_ENGINE_CONFIG", ",", "ctx", ".", "getBean", "(", "SpringIdmEngineConfiguration", ".", "class", ")", ");", "}", "List", "<", "AbstractFormType", ">", "customFormTypes", "=", "new", "ArrayList", "<", ">(", ");", "customFormTypes", ".", "add", "(", "new", "DropdownFormType", "(", "null", ")", ");", "conf", ".", "setCustomFormTypes", "(", "customFormTypes", ")", ";", "conf", ".", "setEnableSafeBpmnXml", "(", "true", ")", ";", "conf", ".", "setCustomFormTypes", "(", "Arrays", ".", "asList", "(", "new", "DropdownFormType", "(", "null", ")", "))", ";", "engines", ".", "put", "(", "domain", ",", "conf", ".", "buildProcessEngine", "(", "))", ";", "}"], "docstring_tokens": ["xml", "external", "entity"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "31", ",", "11", "+", "31", ",", "16", "@", "@", "import", "hudson", ".", "tasks", ".", "BuildWrapper", ";", "import", "hudson", ".", "tasks", ".", "Builder", ";", "import", "hudson", ".", "util", ".", "VariableResolver", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "logging", ".", "Logger", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "DoNotUse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "Exported", ";", "@", "@", "-", "70", ",", "6", "+", "75", ",", "9", "@", "@", "*", "/", "@", "ExportedBean", "(", "defaultVisibility", "=", "3", ")", "public", "abstract", "class", "ParameterValue", "implements", "Serializable", "{", "private", "static", "final", "Logger", "LOGGER", "=", "Logger", ".", "getLogger", "(", "ParameterValue", ".", "class", ".", "getName", "(", "))", ";", "protected", "final", "String", "name", ";", "private", "String", "description", ";", "@", "@", "-", "91", ",", "6", "+", "99", ",", "16", "@", "@", "public", "void", "setDescription", "(", "String", "description", ")", "{", "this", ".", "description", "=", "description", ";", "}", "@", "Restricted", "(", "DoNotUse", ".", "class", ")", "/", "/", "for", "value", ".", "jelly", "public", "String", "getFormattedDescription", "(", ")", "{", "try", "{", "return", "Jenkins", ".", "getInstance", "(", ").", "getMarkupFormatter", "(", ").", "translate", "(", "description", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "warning", "(", "\"", "failed", "to", "translate", "description", "using", "configured", "markup", "formatter", "\"", ");", "return", "\"", "\";", "}", "}", "/", "**", "*", "Name", "of", "the", "parameter", ".", "*", "@", "@", "-", "1", ",", "25", "+", "1", ",", "30", "@", "@", "package", "hudson", ".", "model", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "DomNodeUtil", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlCheckBoxInput", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlElement", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlFormUtil", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlOption", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlPage", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlForm", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlElement", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlTextInput", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlCheckBoxInput", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "html", ".", "HtmlOption", ";", "import", "hudson", ".", "markup", ".", "MarkupFormatter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "Writer", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "org", ".", "apache", ".", "http", ".", "HttpStatus", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "ErrorCollector", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "CaptureEnvironmentBuilder", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ".", "WebClient", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "*", "@", "author", "huybrechts", "*", "/", "@", "@", "-", "28", ",", "6", "+", "33", ",", "9", "@", "@", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Rule", "public", "ErrorCollector", "collector", "=", "new", "ErrorCollector", "(", ");", "@", "Test", "public", "void", "parameterTypes", "(", ")", "throws", "Exception", "{", "FreeStyleProject", "otherProject", "=", "j", ".", "createFreeStyleProject", "(", ");", "@", "@", "-", "216", ",", "4", "+", "224", ",", "52", "@", "@", "public", "void", "unicodeParametersArePresetCorrectly", "(", ")", "throws", "Exception", "{", "final", "HtmlForm", "form", "=", "page", ".", "getFormByName", "(", "\"", "parameters", "\"", ");", "HtmlFormUtil", ".", "submit", "(", "form", ",", "HtmlFormUtil", ".", "getButtonByCaption", "(", "form", ",", "\"", "Build", "\"", "))", ";", "}", "@", "Issue", "(", "\"", "SECURITY", "-", "353", "\"", ")", "@", "Test", "public", "void", "xss", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setMarkupFormatter", "(", "new", "MyMarkupFormatter", "(", "))", ";", "FreeStyleProject", "p", "=", "j", ".", "createFreeStyleProject", "(", "\"", "p", "\"", ");", "StringParameterDefinition", "param", "=", "new", "StringParameterDefinition", "(", "\"<", "param", "name", ">", "\",", "\"", "<", "param", "default", ">", "\",", "\"", "<", "param", "description", ">", "\")", ";", "assertEquals", "(", "\"<", "b", ">", "[<", "/", "b", ">", "param", "description", "<", "b", ">", "]<", "/", "b", ">", "\",", "param", ".", "getFormattedDescription", "(", "))", ";", "p", ".", "addProperty", "(", "new", "ParametersDefinitionProperty", "(", "param", ")", ");", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "getOptions", "(", ").", "setThrowExceptionOnFailingStatusCode", "(", "false", ")", ";", "HtmlPage", "page", "=", "wc", ".", "getPage", "(", "p", ",", "\"", "build", "?", "delay", "=", "0sec", "\"", ");", "collector", ".", "checkThat", "(", "page", ".", "getWebResponse", "(", ").", "getStatusCode", "(", "),", "is", "(", "HttpStatus", ".", "SC_METHOD_NOT_ALLOWED", ")", ");", "/", "/", "405", "to", "dissuade", "scripts", "from", "thinking", "this", "triggered", "the", "build", "String", "text", "=", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "collector", ".", "checkThat", "(", "\"", "build", "page", "should", "escape", "param", "name", "\"", ",", "text", ",", "containsString", "(", "\"&", "lt", ";", "param", "name", "&", "gt", ";", "\")", ");", "collector", ".", "checkThat", "(", "\"", "build", "page", "should", "not", "leave", "param", "name", "unescaped", "\"", ",", "text", ",", "not", "(", "containsString", "(", "\"<", "param", "name", ">", "\")", "))", ";", "collector", ".", "checkThat", "(", "\"", "build", "page", "should", "escape", "param", "default", "\"", ",", "text", ",", "containsString", "(", "\"&", "lt", ";", "param", "default", "&", "gt", ";", "\")", ");", "collector", ".", "checkThat", "(", "\"", "build", "page", "should", "not", "leave", "param", "default", "unescaped", "\"", ",", "text", ",", "not", "(", "containsString", "(", "\"<", "param", "default", ">", "\")", "))", ";", "collector", ".", "checkThat", "(", "\"", "build", "page", "should", "mark", "up", "param", "description", "\"", ",", "text", ",", "containsString", "(", "\"<", "b", ">", "[<", "/", "b", ">", "param", "description", "<", "b", ">", "]<", "/", "b", ">", "\")", ");", "collector", ".", "checkThat", "(", "\"", "build", "page", "should", "not", "leave", "param", "description", "unescaped", "\"", ",", "text", ",", "not", "(", "containsString", "(", "\"<", "param", "description", ">", "\")", "))", ";", "HtmlForm", "form", "=", "page", ".", "getFormByName", "(", "\"", "parameters", "\"", ");", "HtmlTextInput", "value", "=", "form", ".", "getInputByValue", "(", "\"<", "param", "default", ">", "\")", ";", "value", ".", "setText", "(", "\"<", "param", "value", ">", "\")", ";", "j", ".", "submit", "(", "form", ")", ";", "j", ".", "waitUntilNoActivity", "(", ");", "FreeStyleBuild", "b", "=", "p", ".", "getBuildByNumber", "(", "1", ")", ";", "page", "=", "j", ".", "createWebClient", "(", ").", "getPage", "(", "b", ",", "\"", "parameters", "/", "\")", ";", "text", "=", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "collector", ".", "checkThat", "(", "\"", "parameters", "page", "should", "escape", "param", "name", "\"", ",", "text", ",", "containsString", "(", "\"&", "lt", ";", "param", "name", "&", "gt", ";", "\")", ");", "collector", ".", "checkThat", "(", "\"", "parameters", "page", "should", "not", "leave", "param", "name", "unescaped", "\"", ",", "text", ",", "not", "(", "containsString", "(", "\"<", "param", "name", ">", "\")", "))", ";", "collector", ".", "checkThat", "(", "\"", "parameters", "page", "should", "escape", "param", "value", "\"", ",", "text", ",", "containsString", "(", "\"&", "lt", ";", "param", "value", "&", "gt", ";", "\")", ");", "collector", ".", "checkThat", "(", "\"", "parameters", "page", "should", "not", "leave", "param", "value", "unescaped", "\"", ",", "text", ",", "not", "(", "containsString", "(", "\"<", "param", "value", ">", "\")", "))", ";", "collector", ".", "checkThat", "(", "\"", "parameters", "page", "should", "mark", "up", "param", "description", "\"", ",", "text", ",", "containsString", "(", "\"<", "b", ">", "[<", "/", "b", ">", "param", "description", "<", "b", ">", "]<", "/", "b", ">", "\")", ");", "collector", ".", "checkThat", "(", "\"", "parameters", "page", "should", "not", "leave", "param", "description", "unescaped", "\"", ",", "text", ",", "not", "(", "containsString", "(", "\"<", "param", "description", ">", "\")", "))", ";", "}", "static", "class", "MyMarkupFormatter", "extends", "MarkupFormatter", "{", "@", "Override", "public", "void", "translate", "(", "String", "markup", ",", "Writer", "output", ")", "throws", "IOException", "{", "Matcher", "m", "=", "Pattern", ".", "compile", "(", "\"[", "<>", "]\"", ").", "matcher", "(", "markup", ")", ";", "StringBuffer", "buf", "=", "new", "StringBuffer", "(", ");", "while", "(", "m", ".", "find", "(", "))", "{", "m", ".", "appendReplacement", "(", "buf", ",", "m", ".", "group", "(", ").", "equals", "(", "\"<", "\")", "?", "\"", "<", "b", ">", "[<", "/", "b", ">", "\"", ":", "\"", "<", "b", ">", "]<", "/", "b", ">", "\")", ";", "}", "m", ".", "appendTail", "(", "buf", ")", ";", "output", ".", "write", "(", "buf", ".", "toString", "(", "))", ";", "}", "}", "}"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "367", ",", "35", "+", "367", ",", "37", "@", "@", "static", "void", "ip6gre_tunnel_uninit", "(", "struct", "net_device", "*", "dev", ")", "static", "void", "ip6gre_err", "(", "struct", "sk_buff", "*", "skb", ",", "struct", "inet6_skb_parm", "*", "opt", ",", "u8", "type", ",", "u8", "code", ",", "int", "offset", ",", "__be32", "info", ")", "u8", "type", ",", "u8", "code", ",", "int", "offset", ",", "__be32", "info", ")", "{", "const", "struct", "ipv6hdr", "*", "ipv6h", "=", "(", "const", "struct", "ipv6hdr", "*", ")", "skb", "-", ">", "data", ";", "__be16", "*", "p", "=", "(", "__be16", "*", ")(", "skb", "-", ">", "data", "+", "offset", ")", ";", "int", "grehlen", "=", "offset", "+", "4", ";", "const", "struct", "gre_base_hdr", "*", "greh", ";", "const", "struct", "ipv6hdr", "*", "ipv6h", ";", "int", "grehlen", "=", "sizeof", "(", "*", "greh", ")", ";", "struct", "ip6_tnl", "*", "t", ";", "int", "key_off", "=", "0", ";", "__be16", "flags", ";", "__be32", "key", ";", "flags", "=", "p", "[", "0", "]", ";", "if", "(", "flags", "&", "(", "GRE_CSUM", "|", "GRE_KEY", "|", "GRE_SEQ", "|", "GRE_ROUTING", "|", "GRE_VERSION", ")", ")", "{", "if", "(", "flags", "&", "(", "GRE_VERSION", "|", "GRE_ROUTING", ")", ")", "return", ";", "if", "(", "flags", "&", "GRE_KEY", ")", "{", "grehlen", "+", "=", "4", ";", "if", "(", "flags", "&", "GRE_CSUM", ")", "grehlen", "+", "=", "4", ";", "}", "if", "(", "!", "pskb_may_pull", "(", "skb", ",", "offset", "+", "grehlen", ")", ")", "return", ";", "greh", "=", "(", "const", "struct", "gre_base_hdr", "*", ")(", "skb", "-", ">", "data", "+", "offset", ")", ";", "flags", "=", "greh", "-", ">", "flags", ";", "if", "(", "flags", "&", "(", "GRE_VERSION", "|", "GRE_ROUTING", ")", ")", "return", ";", "if", "(", "flags", "&", "GRE_CSUM", ")", "grehlen", "+", "=", "4", ";", "if", "(", "flags", "&", "GRE_KEY", ")", "{", "key_off", "=", "grehlen", "+", "offset", ";", "grehlen", "+", "=", "4", ";", "}", "/", "*", "If", "only", "8", "bytes", "returned", ",", "keyed", "message", "will", "be", "dropped", "here", "*", "/", "if", "(", "!", "pskb_may_pull", "(", "skb", ",", "grehlen", ")", ")", "if", "(", "!", "pskb_may_pull", "(", "skb", ",", "offset", "+", "grehlen", ")", ")", "return", ";", "ipv6h", "=", "(", "const", "struct", "ipv6hdr", "*", ")", "skb", "-", ">", "data", ";", "p", "=", "(", "__be16", "*", ")(", "skb", "-", ">", "data", "+", "offset", ")", ";", "greh", "=", "(", "const", "struct", "gre_base_hdr", "*", ")(", "skb", "-", ">", "data", "+", "offset", ")", ";", "key", "=", "key_off", "?", "*", "(", "__be32", "*", ")(", "skb", "-", ">", "data", "+", "key_off", ")", ":", "0", ";", "t", "=", "ip6gre_tunnel_lookup", "(", "skb", "-", ">", "dev", ",", "&", "ipv6h", "-", ">", "daddr", ",", "&", "ipv6h", "-", ">", "saddr", ",", "flags", "&", "GRE_KEY", "?", "*", "((", "(", "__be32", "*", ")", "p", ")", "+", "(", "grehlen", "/", "4", ")", "-", "1", ")", ":", "0", ",", "p", "[", "1", "]", ");", "key", ",", "greh", "-", ">", "protocol", ")", ";", "if", "(", "!", "t", ")", "return", ";"], "docstring_tokens": ["out-of-bound", "memory", "read", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "39", ",", "7", "+", "39", ",", "7", "@", "@", "THE", "SOFTWARE", ".", "<", "properties", ">", "<", "staplerFork", ">", "true", "<", "/", "staplerFork", ">", "<", "stapler", ".", "version", ">", "1", ".", "250", ".", "1", "<", "/", "stapler", ".", "version", ">", "<", "stapler", ".", "version", ">", "1", ".", "250", ".", "2", "<", "/", "stapler", ".", "version", ">", "<", "spring", ".", "version", ">", "2", ".", "5", ".", "6", ".", "SEC03", "<", "/", "spring", ".", "version", ">", "<", "groovy", ".", "version", ">", "2", ".", "4", ".", "11", "<", "/", "groovy", ".", "version", ">", "<", "!-", "-", "TODO", ":", "Actually", "many", "issues", "are", "being", "filtered", "by", "src", "/", "findbugs", "/", "findbugs", "-", "excludes", ".", "xml", "-", "->", "@", "@", "-", "0", ",", "0", "+", "1", ",", "167", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "jenkins", ".", "security", ".", "stapler", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "Page", ";", "import", "hudson", ".", "model", ".", "RootAction", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "TestExtension", ";", "import", "javax", ".", "annotation", ".", "CheckForNull", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "allOf", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "equalTo", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "public", "class", "Security867Test", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "867", "\"", ")", "public", "void", "folderTraversalPrevented_avoidStealingSecretInView", "(", ")", "throws", "Exception", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "getOptions", "(", ").", "setThrowExceptionOnFailingStatusCode", "(", "false", ")", ";", "String", "publicContent", "=", "\"", "Test", "OK", "\"", ";", "String", "secretContent", "=", "\"", "s3cr3t", "\"", ";", "/", "/", "to", "validate", "the", "attack", "reproduction", "you", "can", "disable", "the", "protection", "/", "/", "Facet", ".", "ALLOW_VIEW_NAME_PATH_TRAVERSAL", "=", "true", ";", "/", "/", "regular", "behavior", "assertThat", "(", "getContentAndCheck200", "(", "wc", ",", "\"", "rootAction1", "/", "public", "\"", "),", "containsString", "(", "publicContent", ")", ");", "/", "/", "malicious", "usage", "prevention", "/", "/", "looking", "for", "/", "jenkins", "/", "security", "/", "stapler", "/", "Security867Test", "/", "NotRootAction2", "/", "secret", "assertThat", "(", "getContent", "(", "wc", ",", "\"", "rootAction1", "/", "%", "2fjenkins", "%", "2fsecurity", "%", "2fstapler", "%", "2fSecurity867Test", "%", "2fNotRootAction2", "%", "2fsecret", "\"", "),", "not", "(", "containsString", "(", "secretContent", ")", "))", ";", "/", "/", "looking", "for", "/", "jenkins", "\\", "security", "\\", "stapler", "\\", "Security867Test", "\\", "NotRootAction2", "\\", "secret", "=", ">", "/", "/", "absolute", "path", "with", "backslash", "(", "initial", "forward", "one", "is", "required", "for", "absolute", ")", "assertThat", "(", "getContent", "(", "wc", ",", "\"", "rootAction1", "/", "%", "2fjenkins", "%", "5csecurity", "%", "5cstapler", "%", "5cSecurity867Test", "%", "5cNotRootAction2", "%", "5csecret", "\"", "),", "not", "(", "containsString", "(", "secretContent", ")", "))", ";", "/", "/", "looking", "for", ".", "./", "NotRootAction2", "/", "secret", "=", ">", "relative", "path", "assertThat", "(", "getContent", "(", "wc", ",", "\"", "rootAction1", "/", "%", "2e", "%", "2e", "%", "2fNotRootAction2", "%", "2fsecret", "\"", "),", "not", "(", "containsString", "(", "secretContent", ")", "))", ";", "/", "/", "looking", "for", ".", ".\\", "NotRootAction2", "\\", "secret", "=", ">", "relative", "path", "without", "forward", "slash", "assertThat", "(", "getContent", "(", "wc", ",", "\"", "rootAction1", "/", "%", "2e", "%", "2e", "%", "5cNotRootAction2", "%", "5csecret", "\"", "),", "not", "(", "containsString", "(", "secretContent", ")", "))", ";", "}", "private", "String", "getContent", "(", "JenkinsRule", ".", "WebClient", "wc", ",", "String", "url", ")", "throws", "Exception", "{", "Page", "page", "=", "wc", ".", "goTo", "(", "url", ",", "null", ")", ";", "return", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "}", "private", "String", "getContentAndCheck200", "(", "JenkinsRule", ".", "WebClient", "wc", ",", "String", "url", ")", "throws", "Exception", "{", "Page", "page", "=", "wc", ".", "goTo", "(", "url", ",", "null", ")", ";", "assertThat", "(", "page", ".", "getWebResponse", "(", ").", "getStatusCode", "(", "),", "equalTo", "(", "200", ")", ");", "return", "page", ".", "getWebResponse", "(", ").", "getContentAsString", "(", ");", "}", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "867", "\"", ")", "public", "void", "folderTraversalPrevented_avoidStealingSecretFromDifferentObject", "(", ")", "throws", "Exception", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "getOptions", "(", ").", "setThrowExceptionOnFailingStatusCode", "(", "false", ")", ";", "String", "action1Config", "=", "j", ".", "jenkins", ".", "getExtensionList", "(", "RootAction", ".", "class", ")", ".", "get", "(", "RootAction1", ".", "class", ")", ".", "getMyConfig", "(", ");", "String", "action3Config", "=", "j", ".", "jenkins", ".", "getExtensionList", "(", "RootAction", ".", "class", ")", ".", "get", "(", "RootAction3", ".", "class", ")", ".", "getMyConfig", "(", ");", "/", "/", "to", "validate", "the", "attack", "reproduction", "you", "can", "disable", "the", "protection", "/", "/", "Facet", ".", "ALLOW_VIEW_NAME_PATH_TRAVERSAL", "=", "true", ";", "/", "/", "regular", "behavior", ",", "the", "config", "is", "only", "displayed", "in", "ActionRoot3", "assertThat", "(", "getContentAndCheck200", "(", "wc", ",", "\"", "rootAction1", "/", "public", "\"", "),", "not", "(", "containsString", "(", "action1Config", ")", "))", ";", "assertThat", "(", "getContentAndCheck200", "(", "wc", ",", "\"", "rootAction3", "/", "showConfig", "\"", "),", "allOf", "(", "containsString", "(", "action3Config", ")", ",", "not", "(", "containsString", "(", "action1Config", ")", ")", ")", ");", "/", "/", "the", "main", "point", "here", "is", "the", "last", "node", "visited", "will", "be", "\"", "it", "\"", "for", "the", "view", "scope", "/", "/", "if", "we", "navigate", "by", "RootAction1", ",", "we", "pass", "it", "to", "the", "RootAction3", "'", "s", "view", "/", "/", "malicious", "usage", "prevention", ",", "looking", "for", ".", "./", "RootAction3", "/", "showConfig", "=", ">", "relative", "path", "/", "/", "without", "the", "prevention", ",", "the", "config", "value", "of", "RootAction1", "will", "be", "used", "here", "assertThat", "(", "getContent", "(", "wc", ",", "\"", "rootAction1", "/", "%", "2e", "%", "2e", "%", "2fRootAction3", "%", "2fshowConfig", "\"", "),", "allOf", "(", "not", "(", "containsString", "(", "action1Config", ")", "),", "not", "(", "containsString", "(", "action3Config", ")", ")", ")", ");", "}", "@", "TestExtension", "public", "static", "class", "RootAction1", "implements", "RootAction", "{", "/", "/", "not", "displayed", "in", "its", "own", "public", ".", "jelly", "public", "String", "getMyConfig", "(", ")", "{", "return", "\"", "config", "-", "1", "\"", ";", "}", "@", "Override", "public", "@", "CheckForNull", "String", "getIconFileName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "@", "CheckForNull", "String", "getDisplayName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "@", "CheckForNull", "String", "getUrlName", "(", ")", "{", "return", "\"", "rootAction1", "\"", ";", "}", "}", "@", "TestExtension", "public", "static", "class", "RootAction3", "implements", "RootAction", "{", "/", "/", "displayed", "in", "its", "showConfig", ".", "jelly", "public", "String", "getMyConfig", "(", ")", "{", "return", "\"", "config", "-", "3", "\"", ";", "}", "@", "Override", "public", "@", "CheckForNull", "String", "getIconFileName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "@", "CheckForNull", "String", "getDisplayName", "(", ")", "{", "return", "null", ";", "}", "@", "Override", "public", "@", "CheckForNull", "String", "getUrlName", "(", ")", "{", "return", "\"", "rootAction3", "\"", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", ">", "<", "p", ">", "s3cr3t", "<", "/", "p", ">", "<", "/", "j", ":", "jelly", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", ">", "<", "p", ">", "Test", "OK", "<", "/", "p", ">", "<", "/", "j", ":", "jelly", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "5", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "?>", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", ">", "<", "p", ">", "Config", ":", "$", "{", "it", ".", "myConfig", "}", "</", "p", ">", "<", "/", "j", ":", "jelly", ">"], "docstring_tokens": ["cross", "site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "715", ",", "7", "+", "715", ",", "7", "@", "@", "int", "sock_setsockopt", "(", "struct", "socket", "*", "sock", ",", "int", "level", ",", "int", "optname", ",", "val", "=", "min_t", "(", "u32", ",", "val", ",", "sysctl_wmem_max", ")", ";", "set_sndbuf", ":", "sk", "-", ">", "sk_userlocks", "|", "=", "SOCK_SNDBUF_LOCK", ";", "sk", "-", ">", "sk_sndbuf", "=", "max_t", "(", "u32", ",", "val", "*", "2", ",", "SOCK_MIN_SNDBUF", ")", ";", "sk", "-", ">", "sk_sndbuf", "=", "max_t", "(", "int", ",", "val", "*", "2", ",", "SOCK_MIN_SNDBUF", ")", ";", "/", "*", "Wake", "up", "sending", "tasks", "if", "we", "upped", "the", "value", ".", "*", "/", "sk", "-", ">", "sk_write_space", "(", "sk", ")", ";", "break", ";", "@", "@", "-", "751", ",", "7", "+", "751", ",", "7", "@", "@", "int", "sock_setsockopt", "(", "struct", "socket", "*", "sock", ",", "int", "level", ",", "int", "optname", ",", "*", "returning", "the", "value", "we", "actually", "used", "in", "getsockopt", "*", "is", "the", "most", "desirable", "behavior", ".", "*", "/", "sk", "-", ">", "sk_rcvbuf", "=", "max_t", "(", "u32", ",", "val", "*", "2", ",", "SOCK_MIN_RCVBUF", ")", ";", "sk", "-", ">", "sk_rcvbuf", "=", "max_t", "(", "int", ",", "val", "*", "2", ",", "SOCK_MIN_RCVBUF", ")", ";", "break", ";", "case", "SO_RCVBUFFORCE", ":"], "docstring_tokens": ["memory", "corruptions"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "41", ",", "8", "+", "41", ",", "7", "@", "@", "public", "long", "process", "(", "SSIMediator", "ssiMediator", ",", "String", "commandName", ",", "}", "else", "{", "Collection", "<", "String", ">", "variableNames", "=", "ssiMediator", ".", "getVariableNames", "(", ");", "for", "(", "String", "variableName", ":", "variableNames", ")", "{", "String", "variableValue", "=", "ssiMediator", ".", "getVariableValue", "(", "variableName", ")", ";", "String", "variableValue", "=", "ssiMediator", ".", "getVariableValue", "(", "variableName", ",", "\"", "entity", "\"", ");", "/", "/", "This", "shouldn", "'", "t", "happen", ",", "since", "all", "the", "variable", "names", "must", "/", "/", "have", "values", "if", "(", "variableValue", "=", "=", "null", ")", "{", "@", "@", "-", "90", ",", "6", "+", "90", ",", "9", "@", "@", "Tomcat", "used", "to", "resolve", "standard", "XML", "DTDs", "and", "schemas", "when", "Tomcat", "is", "configured", "to", "validate", "XML", "configuration", "files", "such", "as", "web", ".", "xml", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Encode", "the", "output", "of", "the", "SSI", "<", "code", ">", "printenv", "<", "/", "code", ">", "command", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "545", ",", "7", "+", "545", ",", "9", "@", "@", "public", "String", "getDateParameterSQL", "(", "Date", "param", ")", "{", "@", "Override", "public", "String", "getStringParameterSQL", "(", "String", "param", ")", "{", "return", "\"", "'\"", "+", "param", "+", "\"", "'\"", ";", "/", "/", "DASHBUILDE", "-", "113", ":", "SQL", "Injection", "on", "data", "set", "lookup", "filters", "String", "escapedParam", "=", "param", ".", "replaceAll", "(", "\"'", "\",", "\"", "''", "\")", ";", "return", "\"", "'\"", "+", "escapedParam", "+", "\"", "'\"", ";", "}", "@", "Override", "@", "@", "-", "0", ",", "0", "+", "1", ",", "99", "@", "@", "/", "*", "*", "Copyright", "2016", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "dashbuilder", ".", "dataprovider", ".", "sql", ";", "import", "org", ".", "dashbuilder", ".", "dataset", ".", "DataSet", ";", "import", "org", ".", "dashbuilder", ".", "dataset", ".", "DataSetGroupTest", ";", "import", "org", ".", "dashbuilder", ".", "dataset", ".", "DataSetLookupFactory", ";", "import", "org", ".", "dashbuilder", ".", "dataset", ".", "filter", ".", "FilterFactory", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "org", ".", "mockito", ".", "runners", ".", "MockitoJUnitRunner", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "static", "org", ".", "dashbuilder", ".", "dataset", ".", "ExpenseReportsData", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "*;", "@", "RunWith", "(", "MockitoJUnitRunner", ".", "class", ")", "public", "class", "SQLInjectionAttacksTest", "extends", "SQLDataSetTestBase", "{", "@", "Mock", "Logger", "logger", ";", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "sqlDataSetProvider", ".", "log", "=", "logger", ";", "doAnswer", "(", "invocationOnMock", "-", ">", "{", "String", "sql", "=", "(", "String", ")", "invocationOnMock", ".", "getArguments", "(", ")[", "0", "]", ";", "System", ".", "out", ".", "println", "(", "sql", ")", ";", "return", "null", ";", "}", ").", "when", "(", "logger", ")", ".", "debug", "(", "anyString", "(", "))", ";", "}", "@", "Override", "public", "void", "testAll", "(", ")", "throws", "Exception", "{", "testStringFilterInjection", "(", ");", "}", "public", "void", "testStringFilterInjection", "(", ")", "throws", "Exception", "{", "DataSet", "result", "=", "dataSetManager", ".", "lookupDataSet", "(", "DataSetLookupFactory", ".", "newDataSetLookupBuilder", "(", ")", ".", "dataset", "(", "DataSetGroupTest", ".", "EXPENSE_REPORTS", ")", ".", "filter", "(", "COLUMN_EMPLOYEE", ",", "FilterFactory", ".", "equalsTo", "(", "\"", "David", "'", "OR", "EMPLOYEE", "!", "=", "'", "Toni", "\"", "))", ".", "buildLookup", "(", "))", ";", "assertEquals", "(", "result", ".", "getRowCount", "(", "),", "0", ")", ";", "result", "=", "dataSetManager", ".", "lookupDataSet", "(", "DataSetLookupFactory", ".", "newDataSetLookupBuilder", "(", ")", ".", "dataset", "(", "DataSetGroupTest", ".", "EXPENSE_REPORTS", ")", ".", "filter", "(", "COLUMN_EMPLOYEE", ",", "FilterFactory", ".", "equalsTo", "(", "\"", "David", "\\", "\"", "OR", "EMPLOYEE", "!", "=", "\\", "\"", "Toni", "\"", "))", ".", "buildLookup", "(", "))", ";", "assertEquals", "(", "result", ".", "getRowCount", "(", "),", "0", ")", ";", "result", "=", "dataSetManager", ".", "lookupDataSet", "(", "DataSetLookupFactory", ".", "newDataSetLookupBuilder", "(", ")", ".", "dataset", "(", "DataSetGroupTest", ".", "EXPENSE_REPORTS", ")", ".", "filter", "(", "COLUMN_EMPLOYEE", ",", "FilterFactory", ".", "equalsTo", "(", "\"", "David", "`", "OR", "EMPLOYEE", "!", "=", "`", "Toni", "\"", "))", ".", "buildLookup", "(", "))", ";", "assertEquals", "(", "result", ".", "getRowCount", "(", "),", "0", ")", ";", "}", "@", "Test", "public", "void", "testDropTable", "(", ")", "throws", "Exception", "{", "DataSet", "result", "=", "dataSetManager", ".", "lookupDataSet", "(", "DataSetLookupFactory", ".", "newDataSetLookupBuilder", "(", ")", ".", "dataset", "(", "DataSetGroupTest", ".", "EXPENSE_REPORTS", ")", ".", "filter", "(", "COLUMN_EMPLOYEE", ",", "FilterFactory", ".", "equalsTo", "(", "\"", "David", "'", ";", "DROP", "TABLE", "'", "EXPENSE_REPORTS", ";", "SELECT", "'", "a", "'", "=", "'", "a", "\"", "))", ".", "buildLookup", "(", "))", ";", "result", "=", "dataSetManager", ".", "lookupDataSet", "(", "DataSetLookupFactory", ".", "newDataSetLookupBuilder", "(", ")", ".", "dataset", "(", "DataSetGroupTest", ".", "EXPENSE_REPORTS", ")", ".", "buildLookup", "(", "))", ";", "assertEquals", "(", "result", ".", "getRowCount", "(", "),", "50", ")", ";", "}", "}", "@", "@", "-", "37", ",", "6", "+", "37", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "sqlTestList", ".", "add", "(", "setUp", "(", "new", "SQLDataSetTrimTest", "(", "))", ");", "sqlTestList", ".", "add", "(", "setUp", "(", "new", "SQLTableDataSetLookupTest", "(", "))", ");", "sqlTestList", ".", "add", "(", "setUp", "(", "new", "SQLQueryDataSetLookupTest", "(", "))", ");", "sqlTestList", ".", "add", "(", "setUp", "(", "new", "SQLInjectionAttacksTest", "(", "))", ");", "}", "public", "void", "testAll", "(", ")", "throws", "Exception", "{"], "docstring_tokens": ["sql", "injection"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2415", ",", "10", "+", "2415", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "these", "are", "very", "similar", "to", "media", "blocks", "Supports_Block_Obj", "Parser", ":", ":", "parse_supports_directive", "(", ")", "{", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition", "(", ");", "if", "(", "!", "cond", ")", "{", "css_error", "(", "\"", "Invalid", "CSS", "\"", ",", "\"", "after", "\"", ",", "\"", ":", "expected", "@", "supports", "condition", "(", "e", ".", "g", ".", "(", "display", ":", "flexbox", ")", "),", "was", "\"", ",", "false", ")", ";", "}", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition", "(", "/*", "top_level", "=", "*/", "true", ")", ";", "/", "/", "create", "the", "ast", "node", "object", "for", "the", "support", "queries", "Supports_Block_Obj", "query", "=", "SASS_MEMORY_NEW", "(", "Supports_Block", ",", "pstate", ",", "cond", ")", ";", "/", "/", "additional", "block", "is", "mandatory", "@", "@", "-", "2430", ",", "26", "+", "2427", ",", "26", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "one", "query", "operation", "/", "/", "may", "encounter", "nested", "queries", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_condition", "(", ")", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_condition", "(", "bool", "top_level", ")", "{", "lex", "<", "css_whitespace", ">", "()", ";", "Supports_Condition_Obj", "cond", ";", "if", "(", "(", "cond", "=", "parse_supports_negation", "(", "))", ")", "return", "cond", ";", "if", "(", "(", "cond", "=", "parse_supports_operator", "(", "))", ")", "return", "cond", ";", "if", "(", "(", "cond", "=", "parse_supports_operator", "(", "top_level", ")", "))", "return", "cond", ";", "if", "(", "(", "cond", "=", "parse_supports_interpolation", "(", "))", ")", "return", "cond", ";", "return", "cond", ";", "}", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_negation", "(", ")", "{", "if", "(", "!", "lex", "<", "kwd_not", ">", "()", ")", "return", "{", "};", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition_in_parens", "(", ");", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition_in_parens", "(", "/*", "parens_required", "=", "*/", "true", ")", ";", "return", "SASS_MEMORY_NEW", "(", "Supports_Negation", ",", "pstate", ",", "cond", ")", ";", "}", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_operator", "(", ")", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_operator", "(", "bool", "top_level", ")", "{", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition_in_parens", "(", ");", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition_in_parens", "(", "/*", "parens_required", "=", "*/", "top_level", ")", ";", "if", "(", "cond", ".", "isNull", "(", "))", "return", "{", "};", "while", "(", "true", ")", "{", "@", "@", "-", "2458", ",", "7", "+", "2455", ",", "7", "@", "@", "namespace", "Sass", "{", "else", "if", "(", "!", "lex", "<", "kwd_or", ">", "()", ")", "{", "break", ";", "}", "lex", "<", "css_whitespace", ">", "()", ";", "Supports_Condition_Obj", "right", "=", "parse_supports_condition_in_parens", "(", ");", "Supports_Condition_Obj", "right", "=", "parse_supports_condition_in_parens", "(", "/*", "parens_required", "=", "*/", "true", ")", ";", "/", "/", "Supports_Condition", "*", "cc", "=", "SASS_MEMORY_NEW", "(", "Supports_Condition", ",", "*", "static_cast", "<", "Supports_Condition", "*", ">(", "cond", ")", ");", "cond", "=", "SASS_MEMORY_NEW", "(", "Supports_Operator", ",", "pstate", ",", "cond", ",", "right", ",", "op", ")", ";", "@", "@", "-", "2496", ",", "21", "+", "2493", ",", "24", "@", "@", "namespace", "Sass", "{", "return", "cond", ";", "}", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_condition_in_parens", "(", ")", "Supports_Condition_Obj", "Parser", ":", ":", "parse_supports_condition_in_parens", "(", "bool", "parens_required", ")", "{", "Supports_Condition_Obj", "interp", "=", "parse_supports_interpolation", "(", ");", "if", "(", "interp", "!", "=", "0", ")", "return", "interp", ";", "if", "(", "!", "lex", "<", "exactly", "<", "'(", "'>", ">", "()", ")", "return", "{", "};", "if", "(", "!", "lex", "<", "exactly", "<", "'(", "'>", ">", "()", ")", "{", "if", "(", "parens_required", ")", "{", "css_error", "(", "\"", "Invalid", "CSS", "\"", ",", "\"", "after", "\"", ",", "\"", ":", "expected", "@", "supports", "condition", "(", "e", ".", "g", ".", "(", "display", ":", "flexbox", ")", "),", "was", "\"", ",", "/", "*", "trim", "=", "*/", "false", ")", ";", "}", "else", "{", "return", "{", "};", "}", "}", "lex", "<", "css_whitespace", ">", "()", ";", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition", "(", ");", "if", "(", "cond", "!", "=", "0", ")", "{", "if", "(", "!", "lex", "<", "exactly", "<", "')", "'>", ">", "()", ")", "error", "(", "\"", "unclosed", "parenthesis", "in", "@", "supports", "declaration", "\"", ");", "}", "else", "{", "cond", "=", "parse_supports_declaration", "(", ");", "if", "(", "!", "lex", "<", "exactly", "<", "')", "'>", ">", "()", ")", "error", "(", "\"", "unclosed", "parenthesis", "in", "@", "supports", "declaration", "\"", ");", "}", "Supports_Condition_Obj", "cond", "=", "parse_supports_condition", "(", "/*", "top_level", "=", "*/", "false", ")", ";", "if", "(", "cond", ".", "isNull", "(", "))", "cond", "=", "parse_supports_declaration", "(", ");", "if", "(", "!", "lex", "<", "exactly", "<", "')", "'>", ">", "()", ")", "error", "(", "\"", "unclosed", "parenthesis", "in", "@", "supports", "declaration", "\"", ");", "lex", "<", "css_whitespace", ">", "()", ";", "return", "cond", ";", "}", "@", "@", "-", "312", ",", "12", "+", "312", ",", "12", "@", "@", "namespace", "Sass", "{", "Media_Query_Obj", "parse_media_query", "(", ");", "Media_Query_Expression_Obj", "parse_media_expression", "(", ");", "Supports_Block_Obj", "parse_supports_directive", "(", ");", "Supports_Condition_Obj", "parse_supports_condition", "(", ");", "Supports_Condition_Obj", "parse_supports_condition", "(", "bool", "top_level", ")", ";", "Supports_Condition_Obj", "parse_supports_negation", "(", ");", "Supports_Condition_Obj", "parse_supports_operator", "(", ");", "Supports_Condition_Obj", "parse_supports_operator", "(", "bool", "top_level", ")", ";", "Supports_Condition_Obj", "parse_supports_interpolation", "(", ");", "Supports_Condition_Obj", "parse_supports_declaration", "(", ");", "Supports_Condition_Obj", "parse_supports_condition_in_parens", "(", ");", "Supports_Condition_Obj", "parse_supports_condition_in_parens", "(", "bool", "parens_required", ")", ";", "At_Root_Block_Obj", "parse_at_root_block", "(", ");", "At_Root_Query_Obj", "parse_at_root_query", "(", ");", "String_Schema_Obj", "parse_almost_any_value", "(", ");"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "282", ",", "6", "+", "282", ",", "11", "@", "@", "public", "static", "final", "String", "STRUTS_EXPRESSION_PARSER", "=", "\"", "struts", ".", "expression", ".", "parser", "\"", ";", "/", "**", "namespaces", "names", "'", "whitelist", "*", "*/", "public", "static", "final", "String", "STRUTS_ALLOWED_NAMESPACE_NAMES", "=", "\"", "struts", ".", "allowed", ".", "namespace", ".", "names", "\"", ";", "/", "**", "default", "namespace", "name", "to", "use", "when", "namespace", "didn", "'", "t", "match", "the", "whitelist", "*", "*/", "public", "static", "final", "String", "STRUTS_DEFAULT_NAMESPACE_NAME", "=", "\"", "struts", ".", "default", ".", "namespace", ".", "name", "\"", ";", "/", "**", "actions", "names", "'", "whitelist", "*", "*/", "public", "static", "final", "String", "STRUTS_ALLOWED_ACTION_NAMES", "=", "\"", "struts", ".", "allowed", ".", "action", ".", "names", "\"", ";", "/", "**", "default", "action", "name", "to", "use", "when", "action", "didn", "'", "t", "match", "the", "whitelist", "*", "*/", "@", "@", "-", "31", ",", "7", "+", "31", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "struts2", ".", "RequestUtils", ";", "import", "org", ".", "apache", ".", "struts2", ".", "ServletActionContext", ";", "import", "org", ".", "apache", ".", "struts2", ".", "StrutsConstants", ";", "import", "org", ".", "apache", ".", "struts2", ".", "StrutsException", ";", "import", "org", ".", "apache", ".", "struts2", ".", "util", ".", "PrefixTrie", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "@", "@", "-", "117", ",", "6", "+", "116", ",", "10", "@", "@", "protected", "boolean", "allowSlashesInActionNames", "=", "false", ";", "protected", "boolean", "alwaysSelectFullNamespace", "=", "false", ";", "protected", "PrefixTrie", "prefixTrie", "=", "null", ";", "protected", "Pattern", "allowedNamespaceNames", "=", "Pattern", ".", "compile", "(", "\"[", "a", "-", "zA", "-", "Z0", "-", "9", ".", "_", "/", "\\\\", "-]", "*\"", ");", "protected", "String", "defaultNamespaceName", "=", "\"", "/\"", ";", "protected", "Pattern", "allowedActionNames", "=", "Pattern", ".", "compile", "(", "\"[", "a", "-", "zA", "-", "Z0", "-", "9", ".", "_", "!", "/\\", "\\-", "]*", "\")", ";", "protected", "String", "defaultActionName", "=", "\"", "index", "\"", ";", "@", "@", "-", "202", ",", "6", "+", "205", ",", "16", "@", "@", "public", "void", "setAlwaysSelectFullNamespace", "(", "String", "alwaysSelectFullNamespace", ")", "{", "this", ".", "alwaysSelectFullNamespace", "=", "BooleanUtils", ".", "toBoolean", "(", "alwaysSelectFullNamespace", ")", ";", "}", "@", "Inject", "(", "value", "=", "StrutsConstants", ".", "STRUTS_ALLOWED_NAMESPACE_NAMES", ",", "required", "=", "false", ")", "public", "void", "setAllowedNamespaceNames", "(", "String", "allowedNamespaceNames", ")", "{", "this", ".", "allowedNamespaceNames", "=", "Pattern", ".", "compile", "(", "allowedNamespaceNames", ")", ";", "}", "@", "Inject", "(", "value", "=", "StrutsConstants", ".", "STRUTS_DEFAULT_NAMESPACE_NAME", ",", "required", "=", "false", ")", "public", "void", "setDefaultNamespaceName", "(", "String", "defaultNamespaceName", ")", "{", "this", ".", "defaultNamespaceName", "=", "defaultNamespaceName", ";", "}", "@", "Inject", "(", "value", "=", "StrutsConstants", ".", "STRUTS_ALLOWED_ACTION_NAMES", ",", "required", "=", "false", ")", "public", "void", "setAllowedActionNames", "(", "String", "allowedActionNames", ")", "{", "this", ".", "allowedActionNames", "=", "Pattern", ".", "compile", "(", "allowedActionNames", ")", ";", "@", "@", "-", "389", ",", "10", "+", "402", ",", "28", "@", "@", "protected", "void", "parseNameAndNamespace", "(", "String", "uri", ",", "ActionMapping", "mapping", ",", "Configur", "}", "}", "mapping", ".", "setNamespace", "(", "namespace", ")", ";", "mapping", ".", "setNamespace", "(", "cleanupNamespaceName", "(", "namespace", ")", ");", "mapping", ".", "setName", "(", "cleanupActionName", "(", "name", ")", ");", "}", "/", "**", "*", "Checks", "namespace", "name", "against", "allowed", "pattern", "if", "not", "matched", "returns", "default", "namespace", "*", "*", "@", "param", "rawNamespace", "name", "extracted", "from", "URI", "*", "@", "return", "safe", "namespace", "name", "*", "/", "protected", "String", "cleanupNamespaceName", "(", "final", "String", "rawNamespace", ")", "{", "if", "(", "allowedNamespaceNames", ".", "matcher", "(", "rawNamespace", ")", ".", "matches", "(", "))", "{", "return", "rawNamespace", ";", "}", "else", "{", "LOG", ".", "warn", "(", "\"", "{}", "did", "not", "match", "allowed", "namespace", "names", "{", "}", "-", "default", "namespace", "{", "}", "will", "be", "used", "!", "\",", "rawNamespace", ",", "allowedActionNames", ",", "defaultActionName", ")", ";", "return", "defaultNamespaceName", ";", "}", "}", "/", "**", "*", "Checks", "action", "name", "against", "allowed", "pattern", "if", "not", "matched", "returns", "default", "action", "name", "*", "@", "@", "-", "27", ",", "12", "+", "27", ",", "12", "@", "@", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "impl", ".", "DefaultConfiguration", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "inject", ".", "Container", ";", "import", "org", ".", "apache", ".", "struts2", ".", "ServletActionContext", ";", "import", "org", ".", "apache", ".", "struts2", ".", "StrutsException", ";", "import", "org", ".", "apache", ".", "struts2", ".", "StrutsInternalTestCase", ";", "import", "org", ".", "apache", ".", "struts2", ".", "result", ".", "StrutsResultSupport", ";", "import", "org", ".", "apache", ".", "struts2", ".", "views", ".", "jsp", ".", "StrutsMockHttpServletRequest", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "@", "@", "-", "65", ",", "7", "+", "65", ",", "7", "@", "@", "public", "Configuration", "getConfiguration", "(", ")", "{", "}", ";", "}", "public", "void", "testGetMapping", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMapping", "(", ")", "{", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetAttribute", "(", "null", ")", ";", "@", "@", "-", "79", ",", "7", "+", "79", ",", "7", "@", "@", "public", "void", "testGetMapping", "(", ")", "throws", "Exception", "{", "assertNull", "(", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithMethod", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithMethod", "(", ")", "{", "req", ".", "setupGetParameterMap", "(", "new", "HashMap", "(", "))", ";", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "/", "namespace", "/", "actionName", "!", "add", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "/", "namespace", "/", "actionName", "!", "add", ".", "action", "\"", ");", "@", "@", "-", "95", ",", "7", "+", "95", ",", "7", "@", "@", "public", "void", "testGetMappingWithMethod", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "add", "\"", ",", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithSlashedName", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithSlashedName", "(", ")", "{", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "/", "foo", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "/", "foo", "/", "actionName", ".", "action", "\"", ");", "@", "@", "-", "111", ",", "7", "+", "111", ",", "7", "@", "@", "public", "void", "testGetMappingWithSlashedName", "(", ")", "throws", "Exception", "{", "assertNull", "(", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithSlashedNameAtRootButNoSlashPackage", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithSlashedNameAtRootButNoSlashPackage", "(", ")", "{", "req", ".", "setupGetRequestURI", "(", "\"/", "foo", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "foo", "/", "actionName", ".", "action", "\"", ");", "@", "@", "-", "127", ",", "7", "+", "127", ",", "7", "@", "@", "public", "void", "testGetMappingWithSlashedNameAtRootButNoSlashPackage", "(", ")", "throws", "Except", "assertNull", "(", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithSlashedNameAtRoot", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithSlashedNameAtRoot", "(", ")", "{", "config", "=", "new", "DefaultConfiguration", "(", ");", "PackageConfig", "pkg", "=", "new", "PackageConfig", ".", "Builder", "(", "\"", "myns", "\"", ")", ".", "namespace", "(", "\"/", "my", "/", "namespace", "\"", ").", "build", "(", ");", "@", "@", "-", "158", ",", "7", "+", "158", ",", "7", "@", "@", "public", "Configuration", "getConfiguration", "(", ")", "{", "public", "void", "testGetMappingWithNamespaceSlash", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithNamespaceSlash", "(", ")", "{", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "-", "hh", "/", "abc", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "-", "hh", "/", "abc", ".", "action", "\"", ");", "@", "@", "-", "181", ",", "7", "+", "181", ",", "7", "@", "@", "public", "void", "testGetMappingWithNamespaceSlash", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "my", "-", "hh", "/", "abc", "\"", ",", "mapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testGetMappingWithUnknownNamespace", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithUnknownNamespace", "(", ")", "{", "req", ".", "setupGetRequestURI", "(", "\"/", "bo", "/", "foo", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "bo", "/", "foo", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetAttribute", "(", "null", ")", ";", "@", "@", "-", "195", ",", "7", "+", "195", ",", "7", "@", "@", "public", "void", "testGetMappingWithUnknownNamespace", "(", ")", "throws", "Exception", "{", "assertNull", "(", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithUnknownNamespaceButFullNamespaceSelect", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithUnknownNamespaceButFullNamespaceSelect", "(", ")", "{", "req", ".", "setupGetRequestURI", "(", "\"/", "bo", "/", "foo", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "bo", "/", "foo", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetAttribute", "(", "null", ")", ";", "@", "@", "-", "210", ",", "32", "+", "210", ",", "32", "@", "@", "public", "void", "testGetMappingWithUnknownNamespaceButFullNamespaceSelect", "(", ")", "throws", "Ex", "assertNull", "(", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithActionName_methodAndName", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithActionName_methodAndName", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "mapper", ".", "setAllowDynamicMethodCalls", "(", "\"", "true", "\"", ");", "ActionMapping", "mapping", "=", "mapper", ".", "getMappingFromActionName", "(", "\"", "actionName", "!", "add", "\"", ");", "assertEquals", "(", "\"", "actionName", "\"", ",", "mapping", ".", "getName", "(", "))", ";", "assertEquals", "(", "\"", "add", "\"", ",", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithActionName_name", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithActionName_name", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "mapping", "=", "mapper", ".", "getMappingFromActionName", "(", "\"", "actionName", "\"", ");", "assertEquals", "(", "\"", "actionName", "\"", ",", "mapping", ".", "getName", "(", "))", ";", "assertEquals", "(", "null", ",", "mapping", ".", "getMethod", "(", "))", ";", "assertNull", "(", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithActionName_noDynamicMethod", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithActionName_noDynamicMethod", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "mapper", ".", "setAllowDynamicMethodCalls", "(", "\"", "false", "\"", ");", "ActionMapping", "mapping", "=", "mapper", ".", "getMappingFromActionName", "(", "\"", "actionName", "!", "add", "\"", ");", "assertEquals", "(", "\"", "actionName", "!", "add", "\"", ",", "mapping", ".", "getName", "(", "))", ";", "assertEquals", "(", "null", ",", "mapping", ".", "getMethod", "(", "))", ";", "assertNull", "(", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithActionName_noDynamicMethodColonPrefix", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithActionName_noDynamicMethodColonPrefix", "(", ")", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "METHOD_PREFIX", "+", "\"", "someMethod", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "247", ",", "16", "+", "247", ",", "16", "@", "@", "public", "void", "testGetMappingWithActionName_noDynamicMethodColonPrefix", "(", ")", "throws", "Exc", "ActionMapping", "actionMapping", "=", "defaultActionMapper", ".", "getMapping", "(", "request", ",", "configManager", ")", ";", "assertEquals", "(", "\"", "someServletPath", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "assertEquals", "(", "null", ",", "actionMapping", ".", "getMethod", "(", "))", ";", "assertNull", "(", "actionMapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithActionName_null", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithActionName_null", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "mapping", "=", "mapper", ".", "getMappingFromActionName", "(", "null", ")", ";", "assertNull", "(", "mapping", ")", ";", "}", "public", "void", "testGetUri", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUri", "(", ")", "{", "req", ".", "setupGetParameterMap", "(", "new", "HashMap", "(", "))", ";", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "action", "\"", ");", "@", "@", "-", "268", ",", "7", "+", "268", ",", "7", "@", "@", "public", "void", "testGetUri", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "action", "\"", ",", "mapper", ".", "getUriFromActionMapping", "(", "mapping", ")", ");", "}", "public", "void", "testGetUriWithSemicolonPresent", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriWithSemicolonPresent", "(", ")", "{", "req", ".", "setupGetParameterMap", "(", "new", "HashMap", "(", "))", ";", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "action", ";", "abc", "=", "123rty56", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "action", ";", "abc", "=", "123rty56", "\"", ");", "@", "@", "-", "280", ",", "7", "+", "280", ",", "7", "@", "@", "public", "void", "testGetUriWithSemicolonPresent", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "action", "\"", ",", "mapper", ".", "getUriFromActionMapping", "(", "mapping", ")", ");", "}", "public", "void", "testGetUriWithMethod", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriWithMethod", "(", ")", "{", "req", ".", "setupGetParameterMap", "(", "new", "HashMap", "(", "))", ";", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "/", "namespace", "/", "actionName", "!", "add", ".", "action", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "/", "namespace", "/", "actionName", "!", "add", ".", "action", "\"", ");", "@", "@", "-", "293", ",", "8", "+", "293", ",", "8", "@", "@", "public", "void", "testGetUriWithMethod", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "my", "/", "namespace", "/", "actionName", "!", "add", ".", "action", "\"", ",", "mapper", ".", "getUriFromActionMapping", "(", "mapping", ")", ");", "}", "public", "void", "testGetUriWithOriginalExtension", "(", ")", "throws", "Exception", "{", "ActionMapping", "mapping", "=", "new", "ActionMapping", "(", "\"", "actionName", "\"", ",", "\"", "/", "ns", "\"", ",", "null", ",", "new", "HashMap", "(", "))", ";", "public", "void", "testGetUriWithOriginalExtension", "(", ")", "{", "ActionMapping", "mapping", "=", "new", "ActionMapping", "(", "\"", "actionName", "\"", ",", "\"", "/", "ns", "\"", ",", "null", ",", "new", "HashMap", "<", "String", ",", "Object", ">", "()", ");", "ActionMapping", "orig", "=", "new", "ActionMapping", "(", ");", "orig", ".", "setExtension", "(", "\"", "foo", "\"", ");", "@", "@", "-", "304", ",", "7", "+", "304", ",", "7", "@", "@", "public", "void", "testGetUriWithOriginalExtension", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "ns", "/", "actionName", ".", "foo", "\"", ",", "mapper", ".", "getUriFromActionMapping", "(", "mapping", ")", ");", "}", "public", "void", "testGetMappingWithNoExtension", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithNoExtension", "(", ")", "{", "req", ".", "setupGetParameterMap", "(", "new", "HashMap", "(", "))", ";", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "/", "namespace", "/", "actionName", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "/", "namespace", "/", "actionName", "\"", ");", "@", "@", "-", "320", ",", "7", "+", "320", ",", "7", "@", "@", "public", "void", "testGetMappingWithNoExtension", "(", ")", "throws", "Exception", "{", "assertNull", "(", "mapping", ".", "getMethod", "(", "))", ";", "}", "public", "void", "testGetMappingWithNoExtensionButUriHasExtension", "(", ")", "throws", "Exception", "{", "public", "void", "testGetMappingWithNoExtensionButUriHasExtension", "(", ")", "{", "req", ".", "setupGetParameterMap", "(", "new", "HashMap", "(", "))", ";", "req", ".", "setupGetRequestURI", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "html", "\"", ");", "req", ".", "setupGetServletPath", "(", "\"/", "my", "/", "namespace", "/", "actionName", ".", "html", "\"", ");", "@", "@", "-", "340", ",", "7", "+", "340", ",", "7", "@", "@", "public", "void", "testGetMappingWithNoExtensionButUriHasExtension", "(", ")", "throws", "Exception", "{", "/", "/", "=", "==", "test", "name", "&", "namespace", "=", "==", "/", "/", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "public", "void", "testParseNameAndNamespace1", "(", ")", "throws", "Exception", "{", "public", "void", "testParseNameAndNamespace1", "(", ")", "{", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "@", "@", "-", "350", ",", "7", "+", "350", ",", "7", "@", "@", "public", "void", "testParseNameAndNamespace1", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "actionMapping", ".", "getNamespace", "(", "),", "\"", "\")", ";", "}", "public", "void", "testParseNameAndNamespace2", "(", ")", "throws", "Exception", "{", "public", "void", "testParseNameAndNamespace2", "(", ")", "{", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "@", "@", "-", "360", ",", "7", "+", "360", ",", "7", "@", "@", "public", "void", "testParseNameAndNamespace2", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "actionMapping", ".", "getNamespace", "(", "),", "\"", "/\"", ");", "}", "public", "void", "testParseNameAndNamespace3", "(", ")", "throws", "Exception", "{", "public", "void", "testParseNameAndNamespace3", "(", ")", "{", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "@", "@", "-", "370", ",", "7", "+", "370", ",", "7", "@", "@", "public", "void", "testParseNameAndNamespace3", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "actionMapping", ".", "getNamespace", "(", "),", "\"", "/", "my", "\"", ");", "}", "public", "void", "testParseNameAndNamespace_NoSlashes", "(", ")", "throws", "Exception", "{", "public", "void", "testParseNameAndNamespace_NoSlashes", "(", ")", "{", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "@", "@", "-", "381", ",", "7", "+", "381", ",", "7", "@", "@", "public", "void", "testParseNameAndNamespace_NoSlashes", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "actionMapping", ".", "getNamespace", "(", "),", "\"", "\")", ";", "}", "public", "void", "testParseNameAndNamespace_AllowSlashes", "(", ")", "throws", "Exception", "{", "public", "void", "testParseNameAndNamespace_AllowSlashes", "(", ")", "{", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "@", "@", "-", "397", ",", "8", "+", "397", ",", "8", "@", "@", "public", "void", "testParseNameAndNamespace_AllowSlashes", "(", ")", "throws", "Exception", "{", "/", "/", "=", "==", "test", "special", "prefix", "=", "==", "/", "/", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "public", "void", "testActionPrefixWhenDisabled", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testActionPrefixWhenDisabled", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "411", ",", "8", "+", "411", ",", "8", "@", "@", "public", "void", "testActionPrefixWhenDisabled", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "someServletPath", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testActionPrefixWhenEnabled", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testActionPrefixWhenEnabled", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "426", ",", "8", "+", "426", ",", "8", "@", "@", "public", "void", "testActionPrefixWhenEnabled", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "myAction", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testActionPrefixWhenSlashesAndCrossNamespaceDisabled", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testActionPrefixWhenSlashesAndCrossNamespaceDisabled", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "my", "/", "Action", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "442", ",", "8", "+", "442", ",", "8", "@", "@", "public", "void", "testActionPrefixWhenSlashesAndCrossNamespaceDisabled", "(", ")", "throws", "Except", "assertEquals", "(", "\"", "my", "/", "Action", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testActionPrefixWhenSlashesButSlashesDisabledAndCrossNamespaceDisabled", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testActionPrefixWhenSlashesButSlashesDisabledAndCrossNamespaceDisabled", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "my", "/", "Action", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "458", ",", "8", "+", "458", ",", "8", "@", "@", "public", "void", "testActionPrefixWhenSlashesButSlashesDisabledAndCrossNamespaceDisabl", "assertEquals", "(", "\"", "Action", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testActionPrefixWhenSlashesButSlashesDisabledAndCrossNamespace", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testActionPrefixWhenSlashesButSlashesDisabledAndCrossNamespace", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "my", "/", "Action", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "475", ",", "8", "+", "475", ",", "8", "@", "@", "public", "void", "testActionPrefixWhenSlashesButSlashesDisabledAndCrossNamespace", "(", ")", "thr", "assertEquals", "(", "\"", "my", "/", "Action", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testActionPrefixWhenCrossNamespace", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testActionPrefixWhenCrossNamespace", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "/", "my", "/", "Action", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "491", ",", "8", "+", "491", ",", "8", "@", "@", "public", "void", "testActionPrefixWhenCrossNamespace", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "my", "/", "Action", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testActionPrefix_fromImageButton", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testActionPrefix_fromImageButton", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "myAction", ".", "x", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "myAction", ".", "y", "\"", ",", "\"", "\")", ";", "@", "@", "-", "508", ",", "8", "+", "508", ",", "8", "@", "@", "public", "void", "testActionPrefix_fromImageButton", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "myAction", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testActionPrefix_fromIEImageButton", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testActionPrefix_fromIEImageButton", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "myAction", ".", "x", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "ACTION_PREFIX", "+", "\"", "myAction", ".", "y", "\"", ",", "\"", "\")", ";", "@", "@", "-", "524", ",", "8", "+", "524", ",", "8", "@", "@", "public", "void", "testActionPrefix_fromIEImageButton", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "myAction", "\"", ",", "actionMapping", ".", "getName", "(", "))", ";", "}", "public", "void", "testRedirectPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testRedirectPrefix", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "\"", "redirect", ":", "\"", "+", "\"", "http", ":", "//", "www", ".", "google", ".", "com", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "540", ",", "8", "+", "540", ",", "8", "@", "@", "public", "void", "testRedirectPrefix", "(", ")", "throws", "Exception", "{", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testUnsafeRedirectPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testUnsafeRedirectPrefix", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "\"", "redirect", ":", "\"", "+", "\"", "http", ":", "//", "%{", "3", "*", "4", "}", "\",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "556", ",", "8", "+", "556", ",", "8", "@", "@", "public", "void", "testUnsafeRedirectPrefix", "(", ")", "throws", "Exception", "{", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testRedirectActionPrefix", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "573", ",", "8", "+", "573", ",", "8", "@", "@", "public", "void", "testRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testUnsafeRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testUnsafeRedirectActionPrefix", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "%{", "3", "*", "4", "}", "\",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "590", ",", "8", "+", "590", ",", "8", "@", "@", "public", "void", "testUnsafeRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testRedirectActionPrefixWithEmptyExtension", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testRedirectActionPrefixWithEmptyExtension", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "608", ",", "8", "+", "608", ",", "8", "@", "@", "public", "void", "testRedirectActionPrefixWithEmptyExtension", "(", ")", "throws", "Exception", "{", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testCustomActionPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "public", "void", "testCustomActionPrefix", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "parameterMap", "=", "new", "HashMap", "<", ">(", ");", "parameterMap", ".", "put", "(", "\"", "foo", ":", "myAction", "\"", ",", "\"", "\")", ";", "final", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "@", "@", "-", "627", ",", "39", "+", "627", ",", "39", "@", "@", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "assertEquals", "(", "actionMapping", ".", "getName", "(", "),", "\"", "myAction", "\"", ");", "}", "public", "void", "testDropExtension", "(", ")", "throws", "Exception", "{", "public", "void", "testDropExtension", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "String", "name", "=", "mapper", ".", "dropExtension", "(", "\"", "foo", ".", "action", "\"", ",", "new", "ActionMapping", "(", "))", ";", "assertTrue", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "foo", "\"", ".", "equals", "(", "name", ")", ");", "assertEquals", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "foo", "\"", ",", "name", ")", ";", "name", "=", "mapper", ".", "dropExtension", "(", "\"", "foo", ".", "action", ".", "action", "\"", ",", "new", "ActionMapping", "(", "))", ";", "assertTrue", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "foo", ".", "action", "\"", ".", "equals", "(", "name", ")", ");", "assertEquals", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "foo", ".", "action", "\"", ",", "name", ")", ";", "}", "public", "void", "testDropExtensionWhenBlank", "(", ")", "throws", "Exception", "{", "public", "void", "testDropExtensionWhenBlank", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "mapper", ".", "setExtensions", "(", "\"", "action", ",", ",\"", ");", "String", "name", "=", "mapper", ".", "dropExtension", "(", "\"", "foo", ".", "action", "\"", ",", "new", "ActionMapping", "(", "))", ";", "assertTrue", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "foo", "\"", ".", "equals", "(", "name", ")", ");", "assertEquals", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "foo", "\"", ",", "name", ")", ";", "name", "=", "mapper", ".", "dropExtension", "(", "\"", "foo", "\"", ",", "new", "ActionMapping", "(", "))", ";", "assertTrue", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "foo", "\"", ".", "equals", "(", "name", ")", ");", "assertEquals", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "foo", "\"", ",", "name", ")", ";", "assertNull", "(", "mapper", ".", "dropExtension", "(", "\"", "foo", ".", "bar", "\"", ",", "new", "ActionMapping", "(", "))", ");", "assertNull", "(", "mapper", ".", "dropExtension", "(", "\"", "foo", ".", "\",", "new", "ActionMapping", "(", "))", ");", "}", "public", "void", "testDropExtensionEmbeddedDot", "(", ")", "throws", "Exception", "{", "public", "void", "testDropExtensionEmbeddedDot", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "mapper", ".", "setExtensions", "(", "\"", "action", ",", ",\"", ");", "String", "name", "=", "mapper", ".", "dropExtension", "(", "\"/", "foo", "/", "bar", "-", "1", ".", "0", "/", "baz", ".", "action", "\"", ",", "new", "ActionMapping", "(", "))", ";", "assertTrue", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "/", "foo", "/", "bar", "-", "1", ".", "0", "/", "baz", "\"", ".", "equals", "(", "name", ")", ");", "assertEquals", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "/", "foo", "/", "bar", "-", "1", ".", "0", "/", "baz", "\"", ",", "name", ")", ";", "name", "=", "mapper", ".", "dropExtension", "(", "\"/", "foo", "/", "bar", "-", "1", ".", "0", "/", "baz", "\"", ",", "new", "ActionMapping", "(", "))", ";", "assertTrue", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "/", "foo", "/", "bar", "-", "1", ".", "0", "/", "baz", "\"", ".", "equals", "(", "name", ")", ");", "assertEquals", "(", "\"", "Name", "not", "right", ":", "\"", "+", "name", ",", "\"", "/", "foo", "/", "bar", "-", "1", ".", "0", "/", "baz", "\"", ",", "name", ")", ";", "}", "public", "void", "testGetUriFromActionMapper1", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper1", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setMethod", "(", "\"", "myMethod", "\"", ");", "@", "@", "-", "670", ",", "7", "+", "670", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper1", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myNamespace", "/", "myActionName", "!", "myMethod", ".", "action", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper2", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper2", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setMethod", "(", "\"", "myMethod", "\"", ");", "@", "@", "-", "681", ",", "7", "+", "681", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper2", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myActionName", "!", "myMethod", ".", "action", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper3", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper3", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setMethod", "(", "\"", "myMethod", "\"", ");", "@", "@", "-", "693", ",", "7", "+", "693", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper3", "(", ")", "throws", "Exception", "{", "}", "public", "void", "testGetUriFromActionMapper4", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper4", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setName", "(", "\"", "myActionName", "\"", ");", "@", "@", "-", "703", ",", "7", "+", "703", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper4", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myActionName", ".", "action", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper5", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper5", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setName", "(", "\"", "myActionName", "\"", ");", "@", "@", "-", "714", ",", "7", "+", "714", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper5", "(", ")", "throws", "Exception", "{", "}", "/", "/", "public", "void", "testGetUriFromActionMapper6", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper6", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setMethod", "(", "\"", "myMethod", "\"", ");", "@", "@", "-", "725", ",", "7", "+", "725", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper6", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myNamespace", "/", "myActionName", "!", "myMethod", ".", "action", "?", "test", "=", "bla", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper7", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper7", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setMethod", "(", "\"", "myMethod", "\"", ");", "@", "@", "-", "736", ",", "7", "+", "736", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper7", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myActionName", "!", "myMethod", ".", "action", "?", "test", "=", "bla", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper8", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper8", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setMethod", "(", "\"", "myMethod", "\"", ");", "@", "@", "-", "748", ",", "7", "+", "748", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper8", "(", ")", "throws", "Exception", "{", "}", "public", "void", "testGetUriFromActionMapper9", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper9", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setName", "(", "\"", "myActionName", "?", "test", "=", "bla", "\"", ");", "@", "@", "-", "758", ",", "7", "+", "758", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper9", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myActionName", ".", "action", "?", "test", "=", "bla", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper10", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper10", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setName", "(", "\"", "myActionName", "?", "test", "=", "bla", "\"", ");", "@", "@", "-", "768", ",", "7", "+", "768", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper10", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myActionName", ".", "action", "?", "test", "=", "bla", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper11", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper11", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setName", "(", "\"", "myActionName", ".", "action", "\"", ");", "@", "@", "-", "778", ",", "7", "+", "778", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper11", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myActionName", ".", "action", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper12", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper12", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setName", "(", "\"", "myActionName", ".", "action", "\"", ");", "@", "@", "-", "788", ",", "7", "+", "788", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper12", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myActionName", ".", "action", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapper_justActionAndMethod", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapper_justActionAndMethod", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "actionMapping", ".", "setMethod", "(", "\"", "myMethod", "\"", ");", "@", "@", "-", "799", ",", "7", "+", "799", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapper_justActionAndMethod", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "myActionName", "!", "myMethod", "\"", ",", "uri", ")", ";", "}", "public", "void", "testGetUriFromActionMapperWhenBlankExtension", "(", ")", "throws", "Exception", "{", "public", "void", "testGetUriFromActionMapperWhenBlankExtension", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "mapper", ".", "setExtensions", "(", "\",", ",\"", ");", "ActionMapping", "actionMapping", "=", "new", "ActionMapping", "(", ");", "@", "@", "-", "811", ",", "7", "+", "811", ",", "7", "@", "@", "public", "void", "testGetUriFromActionMapperWhenBlankExtension", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"/", "myNamespace", "/", "myActionName", "!", "myMethod", "\"", ",", "uri", ")", ";", "}", "public", "void", "testSetExtension", "(", ")", "throws", "Exception", "{", "public", "void", "testSetExtension", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "mapper", ".", "setExtensions", "(", "\"\"", ");", "assertNull", "(", "mapper", ".", "extensions", ")", ";", "@", "@", "-", "828", ",", "15", "+", "828", ",", "40", "@", "@", "public", "void", "testSetExtension", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "Arrays", ".", "asList", "(", "\"", "html", "\"", ",", "\"", "\",", "\"", "xml", "\"", "),", "mapper", ".", "extensions", ")", ";", "mapper", ".", "setExtensions", "(", "\"", "xml", "\"", ");", "assertEquals", "(", "Arrays", ".", "asList", "(", "\"", "xml", "\"", "),", "mapper", ".", "extensions", ")", ";", "assertEquals", "(", "Collections", ".", "singletonList", "(", "\"", "xml", "\"", "),", "mapper", ".", "extensions", ")", ";", "mapper", ".", "setExtensions", "(", "\",", "\")", ";", "assertEquals", "(", "Arrays", ".", "asList", "(", "\"\"", "),", "mapper", ".", "extensions", ")", ";", "assertEquals", "(", "Collections", ".", "singletonList", "(", "\"\"", "),", "mapper", ".", "extensions", ")", ";", "}", "public", "void", "testAllowedNamespaceNames", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "String", "namespace", "=", "\"", "/\"", ";", "assertEquals", "(", "namespace", ",", "mapper", ".", "cleanupNamespaceName", "(", "namespace", ")", ");", "namespace", "=", "\"", "${", "namespace", "}", "\";", "assertEquals", "(", "mapper", ".", "defaultNamespaceName", ",", "mapper", ".", "cleanupNamespaceName", "(", "namespace", ")", ");", "namespace", "=", "\"", "${", "${", "%{", "namespace", "}", "}}", "\";", "assertEquals", "(", "mapper", ".", "defaultNamespaceName", ",", "mapper", ".", "cleanupNamespaceName", "(", "namespace", ")", ");", "namespace", "=", "\"", "${", "#", "foo", "=", "'", "namespace", "'", ",#", "foo", "}", "\";", "assertEquals", "(", "mapper", ".", "defaultNamespaceName", ",", "mapper", ".", "cleanupNamespaceName", "(", "namespace", ")", ");", "namespace", "=", "\"", "/", "test", "-", "namespace", "/", "namespace", "/", "\";", "assertEquals", "(", "\"/", "test", "-", "namespace", "/", "namespace", "/", "\",", "mapper", ".", "cleanupNamespaceName", "(", "namespace", ")", ");", "namespace", "=", "\"", "/", "test_namespace", "/", "namespace", "-", "test", "/", "\";", "assertEquals", "(", "\"/", "test_namespace", "/", "namespace", "-", "test", "/", "\",", "mapper", ".", "cleanupNamespaceName", "(", "namespace", ")", ");", "namespace", "=", "\"", "/", "test_namespace", "/", "namespace", ".", "test", "/", "\";", "assertEquals", "(", "\"/", "test_namespace", "/", "namespace", ".", "test", "/", "\",", "mapper", ".", "cleanupActionName", "(", "namespace", ")", ");", "}", "public", "void", "testAllowedActionNames", "(", ")", "throws", "Exception", "{", "public", "void", "testAllowedActionNames", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "String", "actionName", "=", "\"", "action", "\"", ";", "@", "@", "-", "861", ",", "7", "+", "886", ",", "7", "@", "@", "public", "void", "testAllowedActionNames", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "test", "!", "bar", ".", "action", "\"", ",", "mapper", ".", "cleanupActionName", "(", "actionName", ")", ");", "}", "public", "void", "testAllowedMethodNames", "(", ")", "throws", "Exception", "{", "public", "void", "testAllowedMethodNames", "(", ")", "{", "DefaultActionMapper", "mapper", "=", "new", "DefaultActionMapper", "(", ");", "assertEquals", "(", "\"\"", ",", "mapper", ".", "cleanupMethodName", "(", "\"\"", "))", ";", "@", "@", "-", "364", ",", "7", "+", "364", ",", "7", "@", "@", "protected", "void", "parseNameAndNamespace", "(", "String", "uri", ",", "ActionMapping", "mapping", ",", "Configur", "name", "=", "uri", ".", "substring", "(", "namespace", ".", "length", "(", ")", "+", "1", ")", ";", "}", "mapping", ".", "setNamespace", "(", "namespace", ")", ";", "mapping", ".", "setNamespace", "(", "cleanupNamespaceName", "(", "namespace", ")", ");", "mapping", ".", "setName", "(", "name", ")", ";", "}"], "docstring_tokens": ["namespace", "redirect", "ognl", "injection"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1777", ",", "6", "+", "1777", ",", "7", "@", "@", "SPL_METHOD", "(", "Array", ",", "unserialize", ")", "goto", "outexcept", ";", "}", "var_push_dtor", "(", "&", "var_hash", ",", "&", "pflags", ")", ";", "-", "-", "p", ";", "/", "*", "for", "'", ";'", "*", "/", "flags", "=", "Z_LVAL_P", "(", "pflags", ")", ";", "/", "*", "flags", "needs", "to", "be", "verified", "and", "we", "also", "need", "to", "verify", "whether", "the", "next", "@", "@", "-", "1800", ",", "6", "+", "1801", ",", "7", "@", "@", "SPL_METHOD", "(", "Array", ",", "unserialize", ")", "if", "(", "!", "php_var_unserialize", "(", "&", "intern", "-", ">", "array", ",", "&", "p", ",", "s", "+", "buf_len", ",", "&", "var_hash", "TSRMLS_CC", ")", ")", "{", "goto", "outexcept", ";", "}", "var_push_dtor", "(", "&", "var_hash", ",", "&", "intern", "-", ">", "array", ")", ";", "}", "if", "(", "*", "p", "!", "=", "'", ";'", ")", "{", "goto", "outexcept", ";", "@", "@", "-", "1818", ",", "6", "+", "1820", ",", "7", "@", "@", "SPL_METHOD", "(", "Array", ",", "unserialize", ")", "goto", "outexcept", ";", "}", "var_push_dtor", "(", "&", "var_hash", ",", "&", "pmembers", ")", ";", "/", "*", "copy", "members", "*", "/", "if", "(", "!", "intern", "-", ">", "std", ".", "properties", ")", "{", "rebuild_object_properties", "(", "&", "intern", "-", ">", "std", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "29", "@", "@", "-", "-", "TEST", "-", "-", "SPL", ":", "Bug", "#", "70166", "Use", "After", "Free", "Vulnerability", "in", "unserialize", "(", ")", "with", "SPLArrayObject", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "inner", "=", "'", "x", ":", "i", ":", "1", ";", "a", ":", "0", ":", "{}", ";", "m", ":", "a", ":", "0", ":", "{}", "';", "$", "exploit", "=", "'", "a", ":", "2", ":", "{", "i", ":", "0", ";", "C", ":", "11", ":", "\"", "ArrayObject", "\"", ":'", ".", "strlen", "(", "$", "inner", ")", ".'", ":{", "'.", "$", "inner", ".", "'}", "i", ":", "1", ";", "R", ":", "5", ";", "}'", ";", "$", "data", "=", "unserialize", "(", "$", "exploit", ")", ";", "for", "(", "$", "i", "=", "0", ";", "$", "i", "<", "5", ";", "$", "i", "+", "+)", "{", "$", "v", "[", "$", "i", "]", "=", "'", "hi", "'", ".$", "i", ";", "}", "var_dump", "(", "$", "data", ")", ";", "?", ">", "=", "==", "DONE", "=", "==", "-", "-", "EXPECTF", "-", "-", "array", "(", "2", ")", "{", "[", "0", "]", "=>", "object", "(", "ArrayObject", ")", "#%", "d", "(", "1", ")", "{", "[", "\"", "storage", "\"", ":\"", "ArrayObject", "\"", ":", "private", "]", "=>", "array", "(", "0", ")", "{", "}", "}", "[", "1", "]", "=>", "array", "(", "0", ")", "{", "}", "}", "=", "==", "DONE", "=", "=="], "docstring_tokens": ["use-after-free", "error"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "9", ",", "6", "+", "9", ",", "10", "@", "@", "PHP", "NEWS", ".", "Fixed", "bug", "#", "77147", "(", "Fixing", "60494", "ignored", "ICONV_MIME_DECODE_CONTINUE_ON_ERROR", ")", ".", "(", "cmb", ")", "-", "IMAP", ":", ".", "Fixed", "bug", "#", "77153", "(", "imap_open", "allows", "to", "run", "arbitrary", "shell", "commands", "via", "mailbox", "parameter", ")", ".", "(", "Stas", ")", "-", "ODBC", ":", ".", "Fixed", "bug", "#", "77079", "(", "odbc_fetch_object", "has", "incorrect", "type", "signature", ")", ".", "(", "Jon", "Allen", ")", "@", "@", "-", "146", ",", "6", "+", "146", ",", "13", "@", "@", "PHP", "7", ".", "1", "UPGRADE", "NOTES", "aligned", ",", "which", "causes", "slightly", "different", "behavior", "than", "before", "for", "some", "pathological", "cases", ".", "-", "IMAP", ":", "Starting", "with", "7", ".", "1", ".", "25", ",", "rsh", "/", "ssh", "logins", "are", "disabled", "by", "default", ".", "Use", "imap", ".", "enable_insecure_rsh", "if", "you", "want", "to", "enable", "them", ".", "Note", "that", "the", "IMAP", "library", "does", "not", "filter", "mailbox", "names", "before", "passing", "them", "to", "rsh", "/", "ssh", "command", ",", "thus", "passing", "untrusted", "data", "to", "this", "function", "with", "rsh", "/", "ssh", "enabled", "is", "insecure", ".", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "2", ".", "New", "Features", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "@", "@", "-", "562", ",", "6", "+", "562", ",", "15", "@", "@", "static", "const", "zend_module_dep", "imap_deps", "[", "]", "=", "{", "}", ";", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "PHP_INI", "*", "/", "PHP_INI_BEGIN", "(", ")", "STD_PHP_INI_BOOLEAN", "(", "\"", "imap", ".", "enable_insecure_rsh", "\"", ",", "\"", "0", "\"", ",", "PHP_INI_SYSTEM", ",", "OnUpdateBool", ",", "enable_rsh", ",", "zend_imap_globals", ",", "imap_globals", ")", "PHP_INI_END", "(", ")", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "imap_module_entry", "*", "/", "zend_module_entry", "imap_module_entry", "=", "{", "@", "@", "-", "832", ",", "6", "+", "841", ",", "8", "@", "@", "PHP_MINIT_FUNCTION", "(", "imap", ")", "{", "unsigned", "long", "sa_all", "=", "SA_MESSAGES", "|", "SA_RECENT", "|", "SA_UNSEEN", "|", "SA_UIDNEXT", "|", "SA_UIDVALIDITY", ";", "REGISTER_INI_ENTRIES", "(", ");", "#", "ifndef", "PHP_WIN32", "mail_link", "(", "&", "unixdriver", ")", ";", "/", "*", "link", "in", "the", "unix", "driver", "*", "/", "mail_link", "(", "&", "mhdriver", ")", ";", "/", "*", "link", "in", "the", "mh", "driver", "*", "/", "@", "@", "-", "1049", ",", "6", "+", "1060", ",", "12", "@", "@", "PHP_MINIT_FUNCTION", "(", "imap", ")", "GC_TEXTS", "texts", "*", "/", "if", "(", "!", "IMAPG", "(", "enable_rsh", ")", ")", "{", "/", "*", "disable", "SSH", "and", "RSH", ",", "see", "https", ":", "//", "bugs", ".", "php", ".", "net", "/", "bug", ".", "php", "?", "id", "=", "77153", "*", "/", "mail_parameters", "(", "NIL", ",", "SET_RSHTIMEOUT", ",", "0", ")", ";", "mail_parameters", "(", "NIL", ",", "SET_SSHTIMEOUT", ",", "0", ")", ";", "}", "le_imap", "=", "zend_register_list_destructors_ex", "(", "mail_close_it", ",", "NULL", ",", "\"", "imap", "\"", ",", "module_number", ")", ";", "return", "SUCCESS", ";", "}", "@", "@", "-", "216", ",", "6", "+", "216", ",", "7", "@", "@", "ZEND_BEGIN_MODULE_GLOBALS", "(", "imap", ")", "#", "endif", "/", "*", "php_stream", "for", "php_mail_gets", "(", ")", "*", "/", "php_stream", "*", "gets_stream", ";", "zend_bool", "enable_rsh", ";", "ZEND_END_MODULE_GLOBALS", "(", "imap", ")", "#", "ifdef", "ZTS", "@", "@", "-", "0", ",", "0", "+", "1", ",", "24", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "77153", "(", "imap_open", "allows", "to", "run", "arbitrary", "shell", "commands", "via", "mailbox", "parameter", ")", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "imap", "\"", "))", "{", "die", "(", "\"", "skip", "imap", "extension", "not", "available", "\"", ");", "}", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "payload", "=", "\"", "echo", "'", "BUG", "'", ">", "\"", ".", "__DIR__", ".", "'", "/", "__bug", "'", ";", "$", "payloadb64", "=", "base64_encode", "(", "$", "payload", ")", ";", "$", "server", "=", "\"", "x", "-", "oProxyCommand", "=", "echo", "\\", "t", "$", "payloadb64", "|", "base64", "\\", "t", "-", "d", "|", "sh", "}", "\";", "@", "imap_open", "(", "'{", "'.", "$", "server", ".", "':", "143", "/", "imap", "}", "INBOX", "'", ",", "'", "',", "'", "')", ";", "/", "/", "clean", "imap_errors", "(", ");", "var_dump", "(", "file_exists", "(", "__DIR__", ".", "'", "/", "__bug", "'", "))", ";", "?", ">", "-", "-", "EXPECT", "-", "-", "bool", "(", "false", ")", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "if", "(", "file_exists", "(", "__DIR__", ".", "'", "/", "__bug", "'", "))", "unlink", "(", "__DIR__", ".", "'", "/", "__bug", "'", ");", "?", ">", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "21", ",", "6", "+", "21", ",", "35", "@", "@", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonInclude", ".", "Value", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "ObjectMapper", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "module", ".", "jaxb", ".", "JaxbAnnotationIntrospector", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "security", ".", "KeyStore", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Map", ".", "Entry", ";", "import", "java", ".", "util", ".", "Objects", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "java", ".", "util", ".", "stream", ".", "Stream", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "import", "javax", ".", "net", ".", "ssl", ".", "KeyManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "KeyManagerFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLContext", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLSocketFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManagerFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "X509TrustManager", ";", "import", "javax", ".", "ws", ".", "rs", ".", "HttpMethod", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MultivaluedHashMap", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MultivaluedMap", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "okhttp3", ".", "Call", ";", "import", "okhttp3", ".", "ConnectionPool", ";", "import", "okhttp3", ".", "Headers", ";", "@", "@", "-", "42", ",", "36", "+", "71", ",", "6", "@", "@", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "springframework", ".", "util", ".", "StreamUtils", ";", "import", "javax", ".", "net", ".", "ssl", ".", "KeyManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "KeyManagerFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLContext", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLSocketFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManagerFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "X509TrustManager", ";", "import", "javax", ".", "ws", ".", "rs", ".", "HttpMethod", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MultivaluedHashMap", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "MultivaluedMap", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "security", ".", "KeyStore", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Map", ".", "Entry", ";", "import", "java", ".", "util", ".", "Objects", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "java", ".", "util", ".", "stream", ".", "Stream", ";", "import", "java", ".", "util", ".", "zip", ".", "GZIPInputStream", ";", "public", "class", "OkHttpReplicationClient", "implements", "HttpReplicationClient", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "OkHttpReplicationClient", ".", "class", ")", ";", "private", "static", "final", "Set", "<", "String", ">", "gzipEncodings", "=", "Stream", ".", "of", "(", "\"", "gzip", "\"", ",", "\"", "x", "-", "gzip", "\"", ").", "collect", "(", "Collectors", ".", "toSet", "(", "))", ";", "@", "@", "-", "95", ",", "12", "+", "94", ",", "35", "@", "@", "public", "OkHttpReplicationClient", "(", "final", "NiFiProperties", "properties", ")", "{", "@", "Override", "public", "PreparedRequest", "prepareRequest", "(", "final", "String", "method", ",", "final", "Map", "<", "String", ",", "String", ">", "headers", ",", "final", "Object", "entity", ")", "{", "final", "boolean", "gzip", "=", "isUseGzip", "(", "headers", ")", ";", "checkContentLengthHeader", "(", "method", ",", "headers", ")", ";", "final", "RequestBody", "requestBody", "=", "createRequestBody", "(", "headers", ",", "entity", ",", "gzip", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "updatedHeaders", "=", "gzip", "?", "updateHeadersForGzip", "(", "headers", ")", ":", "headers", ";", "return", "new", "OkHttpPreparedRequest", "(", "method", ",", "updatedHeaders", ",", "entity", ",", "requestBody", ")", ";", "}", "/", "**", "*", "Checks", "the", "content", "length", "header", "on", "DELETE", "requests", "to", "ensure", "it", "is", "set", "to", "'", "0", "'", ",", "avoiding", "request", "timeouts", "on", "replicated", "requests", ".", "*", "@", "param", "method", "the", "HTTP", "method", "of", "the", "request", "*", "@", "param", "headers", "the", "header", "keys", "and", "values", "*", "/", "private", "void", "checkContentLengthHeader", "(", "String", "method", ",", "Map", "<", "String", ",", "String", ">", "headers", ")", "{", "/", "/", "Only", "applies", "to", "DELETE", "requests", "if", "(", "HttpMethod", ".", "DELETE", ".", "equalsIgnoreCase", "(", "method", ")", ")", "{", "/", "/", "Find", "the", "Content", "-", "Length", "header", "if", "present", "final", "String", "CONTENT_LENGTH_HEADER_KEY", "=", "\"", "Content", "-", "Length", "\"", ";", "Map", ".", "Entry", "<", "String", ",", "String", ">", "contentLengthEntry", "=", "headers", ".", "entrySet", "(", ").", "stream", "(", ").", "filter", "(", "entry", "-", ">", "entry", ".", "getKey", "(", ").", "equalsIgnoreCase", "(", "CONTENT_LENGTH_HEADER_KEY", ")", ").", "findFirst", "(", ").", "orElse", "(", "null", ")", ";", "/", "/", "If", "no", "CL", "header", ",", "do", "nothing", "if", "(", "contentLengthEntry", "!", "=", "null", ")", "{", "/", "/", "If", "the", "provided", "CL", "value", "is", "non", "-", "zero", ",", "override", "it", "if", "(", "contentLengthEntry", ".", "getValue", "(", ")", "!", "=", "null", "&", "&", "!", "contentLengthEntry", ".", "getValue", "(", ").", "equalsIgnoreCase", "(", "\"", "0", "\"", "))", "{", "logger", ".", "warn", "(", "\"", "This", "is", "a", "DELETE", "request", ";", "the", "provided", "Content", "-", "Length", "was", "{", "};", "setting", "Content", "-", "Length", "to", "0", "\"", ",", "contentLengthEntry", ".", "getValue", "(", "))", ";", "headers", ".", "put", "(", "CONTENT_LENGTH_HEADER_KEY", ",", "\"", "0", "\"", ");", "}", "}", "}", "}", "@", "Override", "public", "Response", "replicate", "(", "final", "PreparedRequest", "request", ",", "final", "String", "uri", ")", "throws", "IOException", "{", "if", "(", "!(", "Objects", ".", "requireNonNull", "(", "request", ")", "instanceof", "OkHttpPreparedRequest", ")", ")", "{", "@", "@", "-", "140", ",", "7", "+", "162", ",", "7", "@", "@", "private", "Response", "replicate", "(", "final", "OkHttpPreparedRequest", "request", ",", "final", "String", "uri", "final", "String", "contentEncoding", "=", "callResponse", ".", "header", "(", "\"", "Content", "-", "Encoding", "\"", ");", "if", "(", "gzipEncodings", ".", "contains", "(", "contentEncoding", ")", ")", "{", "try", "(", "final", "InputStream", "gzipIn", "=", "new", "GZIPInputStream", "(", "new", "ByteArrayInputStream", "(", "rawBytes", ")", ");", "final", "ByteArrayOutputStream", "baos", "=", "new", "ByteArrayOutputStream", "(", "))", "{", "final", "ByteArrayOutputStream", "baos", "=", "new", "ByteArrayOutputStream", "(", "))", "{", "StreamUtils", ".", "copy", "(", "gzipIn", ",", "baos", ")", ";", "return", "baos", ".", "toByteArray", "(", ");", "@", "@", "-", "183", ",", "7", "+", "205", ",", "7", "@", "@", "private", "Call", "createCall", "(", "final", "OkHttpPreparedRequest", "request", ",", "final", "String", "uri", ")", "{", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "private", "HttpUrl", "buildUrl", "(", "final", "OkHttpPreparedRequest", "request", ",", "final", "String", "uri", ")", "{", "HttpUrl", ".", "Builder", "urlBuilder", "=", "HttpUrl", ".", "parse", "(", "uri", ".", "toString", "(", "))", ".", "newBuilder", "(", ");", "HttpUrl", ".", "Builder", "urlBuilder", "=", "HttpUrl", ".", "parse", "(", "uri", ")", ".", "newBuilder", "(", ");", "switch", "(", "request", ".", "getMethod", "(", ").", "toUpperCase", "(", "))", "{", "case", "HttpMethod", ".", "DELETE", ":", "case", "HttpMethod", ".", "HEAD", ":", "@", "@", "-", "226", ",", "7", "+", "248", ",", "7", "@", "@", "private", "String", "getContentType", "(", "final", "Map", "<", "String", ",", "String", ">", "headers", ",", "final", "String", "de", "private", "byte", "[", "]", "serializeEntity", "(", "final", "Object", "entity", ",", "final", "String", "contentType", ",", "final", "boolean", "gzip", ")", "{", "try", "(", "final", "ByteArrayOutputStream", "baos", "=", "new", "ByteArrayOutputStream", "(", ");", "final", "OutputStream", "out", "=", "gzip", "?", "new", "GZIPOutputStream", "(", "baos", ",", "1", ")", ":", "baos", ")", "{", "final", "OutputStream", "out", "=", "gzip", "?", "new", "GZIPOutputStream", "(", "baos", ",", "1", ")", ":", "baos", ")", "{", "getSerializer", "(", "contentType", ")", ".", "serialize", "(", "entity", ",", "out", ")", ";", "out", ".", "close", "(", ");", "@", "@", "-", "269", ",", "10", "+", "291", ",", "10", "@", "@", "private", "boolean", "isUseGzip", "(", "final", "Map", "<", "String", ",", "String", ">", "headers", ")", "{", "}", "else", "{", "final", "String", "[", "]", "acceptEncodingTokens", "=", "rawAcceptEncoding", ".", "split", "(", "\",", "\")", ";", "return", "Stream", ".", "of", "(", "acceptEncodingTokens", ")", ".", "map", "(", "String", ":", ":", "trim", ")", ".", "filter", "(", "StringUtils", ":", ":", "isNotEmpty", ")", ".", "map", "(", "String", ":", ":", "toLowerCase", ")", ".", "anyMatch", "(", "gzipEncodings", ":", ":", "contains", ")", ";", ".", "map", "(", "String", ":", ":", "trim", ")", ".", "filter", "(", "StringUtils", ":", ":", "isNotEmpty", ")", ".", "map", "(", "String", ":", ":", "toLowerCase", ")", ".", "anyMatch", "(", "gzipEncodings", ":", ":", "contains", ")", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "138", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "nifi", ".", "cluster", ".", "coordination", ".", "http", ".", "replication", ".", "okhttp", "import", "org", ".", "apache", ".", "nifi", ".", "properties", ".", "StandardNiFiProperties", "import", "org", ".", "apache", ".", "nifi", ".", "util", ".", "NiFiProperties", "import", "org", ".", "junit", ".", "BeforeClass", "import", "org", ".", "junit", ".", "Test", "import", "org", ".", "junit", ".", "runner", ".", "RunWith", "import", "org", ".", "junit", ".", "runners", ".", "JUnit4", "import", "org", ".", "slf4j", ".", "Logger", "import", "org", ".", "slf4j", ".", "LoggerFactory", "@", "RunWith", "(", "JUnit4", ".", "class", ")", "class", "OkHttpReplicationClientTest", "extends", "GroovyTestCase", "{", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "OkHttpReplicationClientTest", ".", "class", ")", "@", "BeforeClass", "static", "void", "setUpOnce", "(", ")", "throws", "Exception", "{", "logger", ".", "metaClass", ".", "methodMissing", "=", "{", "String", "name", ",", "args", "-", ">", "logger", ".", "info", "(", "\"[", "${", "name", "?", ".", "toUpperCase", "(", ")}", "]", "$", "{(", "args", "as", "List", ")", ".", "join", "(", "\"", "\"", ")}", "\")", "}", "}", "private", "static", "StandardNiFiProperties", "mockNiFiProperties", "(", ")", "{", "[", "getClusterNodeConnectionTimeout", ":", "{", "-", ">", "\"", "10", "ms", "\"", "}", ",", "getClusterNodeReadTimeout", ":", "{", "-", ">", "\"", "10", "ms", "\"", "}", ",", "getProperty", ":", "{", "String", "prop", "-", ">", "logger", ".", "mock", "(", "\"", "Requested", "getProperty", "(", "${", "prop", "}", ")", "-", ">", "\\", "\"\\", "\"\"", ")", "\"", "\"", "}", "]", "as", "StandardNiFiProperties", "}", "@", "Test", "void", "testShouldReplaceNonZeroContentLengthHeader", "(", ")", "{", "/", "/", "Arrange", "def", "headers", "=", "[", "\"", "Content", "-", "Length", "\"", ":", "\"", "123", "\"", ",", "\"", "Other", "-", "Header", "\"", ":", "\"", "arbitrary", "value", "\"", "]", "String", "method", "=", "\"", "DELETE", "\"", "logger", ".", "info", "(", "\"", "Original", "headers", ":", "$", "{", "headers", "}", "\")", "NiFiProperties", "mockProperties", "=", "mockNiFiProperties", "(", ")", "OkHttpReplicationClient", "client", "=", "new", "OkHttpReplicationClient", "(", "mockProperties", ")", "/", "/", "Act", "client", ".", "checkContentLengthHeader", "(", "method", ",", "headers", ")", "logger", ".", "info", "(", "\"", "Checked", "headers", ":", "$", "{", "headers", "}", "\")", "/", "/", "Assert", "assert", "headers", ".", "size", "(", ")", "=", "=", "2", "assert", "headers", ".", "\"", "Content", "-", "Length", "\"", "=", "=", "\"", "0", "\"", "}", "@", "Test", "void", "testShouldReplaceNonZeroContentLengthHeaderOnDeleteCaseInsensitive", "(", ")", "{", "/", "/", "Arrange", "def", "headers", "=", "[", "\"", "Content", "-", "Length", "\"", ":", "\"", "123", "\"", ",", "\"", "Other", "-", "Header", "\"", ":", "\"", "arbitrary", "value", "\"", "]", "String", "method", "=", "\"", "delete", "\"", "logger", ".", "info", "(", "\"", "Original", "headers", ":", "$", "{", "headers", "}", "\")", "NiFiProperties", "mockProperties", "=", "mockNiFiProperties", "(", ")", "OkHttpReplicationClient", "client", "=", "new", "OkHttpReplicationClient", "(", "mockProperties", ")", "/", "/", "Act", "client", ".", "checkContentLengthHeader", "(", "method", ",", "headers", ")", "logger", ".", "info", "(", "\"", "Checked", "headers", ":", "$", "{", "headers", "}", "\")", "/", "/", "Assert", "assert", "headers", ".", "size", "(", ")", "=", "=", "2", "assert", "headers", ".", "\"", "Content", "-", "Length", "\"", "=", "=", "\"", "0", "\"", "}", "@", "Test", "void", "testShouldNotReplaceContentLengthHeaderWhenZeroOrNull", "(", ")", "{", "/", "/", "Arrange", "String", "method", "=", "\"", "DELETE", "\"", "def", "zeroOrNullContentLengths", "=", "[", "null", ",", "\"", "0", "\"", "]", "NiFiProperties", "mockProperties", "=", "mockNiFiProperties", "(", ")", "OkHttpReplicationClient", "client", "=", "new", "OkHttpReplicationClient", "(", "mockProperties", ")", "/", "/", "Act", "zeroOrNullContentLengths", ".", "each", "{", "String", "contentLength", "-", ">", "def", "headers", "=", "[", "\"", "Content", "-", "Length", "\"", ":", "contentLength", ",", "\"", "Other", "-", "Header", "\"", ":", "\"", "arbitrary", "value", "\"", "]", "logger", ".", "info", "(", "\"", "Original", "headers", ":", "$", "{", "headers", "}", "\")", "logger", ".", "info", "(", "\"", "Trying", "method", "$", "{", "method", "}", "\")", "client", ".", "checkContentLengthHeader", "(", "method", ",", "headers", ")", "logger", ".", "info", "(", "\"", "Checked", "headers", ":", "$", "{", "headers", "}", "\")", "/", "/", "Assert", "assert", "headers", ".", "size", "(", ")", "=", "=", "2", "assert", "headers", ".", "\"", "Content", "-", "Length", "\"", "=", "=", "contentLength", "}", "}", "@", "Test", "void", "testShouldNotReplaceNonZeroContentLengthHeaderOnOtherMethod", "(", ")", "{", "/", "/", "Arrange", "def", "headers", "=", "[", "\"", "Content", "-", "Length", "\"", ":", "\"", "123", "\"", ",", "\"", "Other", "-", "Header", "\"", ":", "\"", "arbitrary", "value", "\"", "]", "logger", ".", "info", "(", "\"", "Original", "headers", ":", "$", "{", "headers", "}", "\")", "NiFiProperties", "mockProperties", "=", "mockNiFiProperties", "(", ")", "OkHttpReplicationClient", "client", "=", "new", "OkHttpReplicationClient", "(", "mockProperties", ")", "def", "nonDeleteMethods", "=", "[", "\"", "POST", "\"", ",", "\"", "PUT", "\"", ",", "\"", "GET", "\"", ",", "\"", "HEAD", "\"", "]", "/", "/", "Act", "nonDeleteMethods", ".", "each", "{", "String", "method", "-", ">", "logger", ".", "info", "(", "\"", "Trying", "method", "$", "{", "method", "}", "\")", "client", ".", "checkContentLengthHeader", "(", "method", ",", "headers", ")", "logger", ".", "info", "(", "\"", "Checked", "headers", ":", "$", "{", "headers", "}", "\")", "/", "/", "Assert", "assert", "headers", ".", "size", "(", ")", "=", "=", "2", "assert", "headers", ".", "\"", "Content", "-", "Length", "\"", "=", "=", "\"", "123", "\"", "}", "}", "}"], "docstring_tokens": ["input", "validation"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "657", ",", "6", "+", "657", ",", "7", "@", "@", "private", "boolean", "checkSkipBlob", "(", ")", "{", "*", "*", "@", "param", "iRecord", "Record", "to", "handle", "*", "@", "param", "iContext", "*", "*", "@", "return", "false", "if", "limit", "has", "been", "reached", ",", "otherwise", "true", "*", "/", "@", "Override", "@", "@", "-", "686", ",", "6", "+", "687", ",", "7", "@", "@", "private", "boolean", "continueSearching", "(", ")", "{", "*", "Returns", "the", "temporary", "RID", "counter", "assuring", "it", "'", "s", "unique", "per", "query", "tree", ".", "*", "*", "@", "param", "iContext", "*", "*", "@", "return", "Serial", "as", "integer", "*", "/", "public", "int", "getTemporaryRIDCounter", "(", "final", "OCommandContext", "iContext", ")", "{", "@", "@", "-", "695", ",", "11", "+", "697", ",", "27", "@", "@", "public", "int", "getTemporaryRIDCounter", "(", "final", "OCommandContext", "iContext", ")", "{", "serialTempRID", ".", "getAndIncrement", "(", ");", "}", "protected", "void", "checkForSystemClusters", "(", "final", "ODatabaseDocumentInternal", "iDatabase", ",", "final", "int", "[", "]", "iClusterIds", ")", "{", "for", "(", "int", "clId", ":", "iClusterIds", ")", "{", "if", "(", "clId", "<", "0", ")", "{", "continue", ";", "}", "final", "com", ".", "orientechnologies", ".", "orient", ".", "core", ".", "storage", ".", "OCluster", "cl", "=", "iDatabase", ".", "getStorage", "(", ").", "getClusterById", "(", "clId", ")", ";", "if", "(", "cl", "!", "=", "null", "&", "&", "cl", ".", "isSystemCluster", "(", "))", "{", "final", "OSecurityUser", "dbUser", "=", "iDatabase", ".", "getUser", "(", ");", "if", "(", "dbUser", "=", "=", "null", "|", "|", "dbUser", ".", "allow", "(", "ORule", ".", "ResourceGeneric", ".", "SYSTEM_CLUSTERS", ",", "null", ",", "ORole", ".", "PERMISSION_READ", ")", "!", "=", "null", ")", "/", "/", "AUTHORIZED", "break", ";", "}", "}", "}", "protected", "boolean", "addResult", "(", "OIdentifiable", "iRecord", ",", "final", "OCommandContext", "iContext", ")", "{", "resultCount", "+", "+;", "if", "(", "iRecord", "=", "=", "null", ")", "return", "true", ";", "checkForSystemClusters", "(", "getDatabase", "(", "),", "new", "int", "[", "]", "{", "iRecord", ".", "getIdentity", "(", ").", "getClusterId", "(", ")", "}", ");", "if", "(", "projections", "!", "=", "null", "|", "|", "groupByFields", "!", "=", "null", "&", "&", "!", "groupByFields", ".", "isEmpty", "(", "))", "{", "if", "(", "!", "aggregate", ")", "{", "/", "/", "APPLY", "PROJECTIONS", "IN", "LINE", "@", "@", "-", "2175", ",", "7", "+", "2193", ",", "7", "@", "@", "private", "boolean", "searchForIndexes", "(", "final", "OClass", "iSchemaClass", ")", "{", "context", ".", "setVariable", "(", "\"$", "limit", "\"", ",", "limit", ")", ";", "cursor", "=", "operator", ".", "executeIndexQuery", "(", "context", ",", "index", ",", "keyParams", ",", "ascSortOrder", ")", ";", "if", "(", "cursor", "!", "=", "null", ")", "{", "if", "(", "cursor", "!", "=", "null", ")", "{", "metricRecorder", ".", "recordInvolvedIndexesMetric", "(", "index", ")", ";", "}", "@", "@", "-", "2342", ",", "6", "+", "2360", ",", "7", "@", "@", "private", "boolean", "canOptimize", "(", "List", "<", "List", "<", "OIndexSearchResult", ">", ">", "conditionHierarchy", ")", "{", "*", "Use", "index", "to", "order", "documents", "by", "provided", "fields", ".", "*", "*", "@", "param", "iSchemaClass", "where", "search", "for", "indexes", "for", "optimization", ".", "*", "*", "@", "return", "true", "if", "execution", "was", "optimized", "*", "/", "private", "boolean", "optimizeSort", "(", "OClass", "iSchemaClass", ")", "{"], "docstring_tokens": ["code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "29", ",", "6", "+", "29", ",", "11", "@", "@", "class", "LocalOption", "{", "}", ";", "#", "define", "LOCAL_FLAG", "(", "name", ",", "opt", ")", "LocalOption", "<", "bool", ">", "flag_", "#", "#", "name", "(", "name", ",", "opt", ")", "#", "define", "LOCAL_COUNT", "(", "name", ",", "opt", ")", "LocalOption", "<", "size_t", ">", "cnt_", "#", "#", "name", "(", "name", ",", "opt", ")", "#", "define", "NESTING_GUARD", "(", "name", ")", "\\", "LocalOption", "<", "size_t", ">", "cnt_", "#", "#", "name", "(", "name", ",", "name", "+", "1", ")", ";", "\\", "if", "(", "nestings", ">", "MAX_NESTING", ")", "throw", "Exception", ":", ":", "NestingLimitError", "(", "pstate", ")", ";", "\\", "#", "define", "ATTACH_OPERATIONS", "(", ")\\", "virtual", "void", "perform", "(", "Operation", "<", "void", ">", "*", "op", ")", "{", "(", "*", "op", ")", "(", "this", ")", ";", "}", "\\", "@", "@", "-", "59", ",", "6", "+", "59", ",", "10", "@", "@", "namespace", "Sass", "{", ":", "Base", "(", "pstate", ",", "msg", ",", "import_stack", ")", "{", "}", "NestingLimitError", ":", ":", "NestingLimitError", "(", "ParserState", "pstate", ",", "std", ":", ":", "string", "msg", ",", "std", ":", ":", "vector", "<", "Sass_Import_Entry", ">", "*", "import_stack", ")", ":", "Base", "(", "pstate", ",", "msg", ",", "import_stack", ")", "{", "}", "UndefinedOperation", ":", ":", "UndefinedOperation", "(", "Expression_Ptr_Const", "lhs", ",", "Expression_Ptr_Const", "rhs", ",", "const", "std", ":", ":", "string", "&", "op", ")", ":", "lhs", "(", "lhs", ")", ",", "rhs", "(", "rhs", ")", ",", "op", "(", "op", ")", "{", "@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "namespace", "Sass", "{", "const", "std", ":", ":", "string", "def_msg", "=", "\"", "Invalid", "sass", "detected", "\"", ";", "const", "std", ":", ":", "string", "def_op_msg", "=", "\"", "Undefined", "operation", "\"", ";", "const", "std", ":", ":", "string", "def_op_null_msg", "=", "\"", "Invalid", "null", "operation", "\"", ";", "const", "std", ":", ":", "string", "def_nesting_limit", "=", "\"", "Code", "too", "deeply", "neested", "\"", ";", "class", "Base", ":", "public", "std", ":", ":", "runtime_error", "{", "protected", ":", "@", "@", "-", "83", ",", "6", "+", "84", ",", "12", "@", "@", "namespace", "Sass", "{", "virtual", "~", "InvalidSyntax", "(", ")", "throw", "(", ")", "{", "};", "}", ";", "class", "NestingLimitError", ":", "public", "Base", "{", "public", ":", "NestingLimitError", "(", "ParserState", "pstate", ",", "std", ":", ":", "string", "msg", "=", "def_nesting_limit", ",", "std", ":", ":", "vector", "<", "Sass_Import_Entry", ">", "*", "import_stack", "=", "0", ")", ";", "virtual", "~", "NestingLimitError", "(", ")", "throw", "(", ")", "{", "};", "}", ";", "/", "*", "common", "virtual", "base", "class", "(", "has", "no", "pstate", ")", "*", "/", "class", "OperationError", ":", "public", "std", ":", ":", "runtime_error", "{", "protected", ":", "@", "@", "-", "503", ",", "6", "+", "503", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "a", "ruleset", "connects", "a", "selector", "and", "a", "block", "Ruleset_Obj", "Parser", ":", ":", "parse_ruleset", "(", "Lookahead", "lookahead", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "/", "/", "inherit", "is_root", "from", "parent", "block", "Block_Obj", "parent", "=", "block_stack", ".", "back", "(", ");", "bool", "is_root", "=", "parent", "&", "&", "parent", "-", ">", "is_root", "(", ");", "@", "@", "-", "535", ",", "6", "+", "536", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "in", "the", "eval", "stage", "we", "will", "be", "re", "-", "parse", "it", "into", "an", "actual", "selector", "Selector_Schema_Obj", "Parser", ":", ":", "parse_selector_schema", "(", "const", "char", "*", "end_of_selector", ",", "bool", "chroot", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "/", "/", "move", "up", "to", "the", "start", "lex", "<", "optional_spaces", ">", "()", ";", "const", "char", "*", "i", "=", "position", ";", "@", "@", "-", "646", ",", "6", "+", "648", ",", "7", "@", "@", "namespace", "Sass", "{", "{", "bool", "reloop", ";", "bool", "had_linefeed", "=", "false", ";", "NESTING_GUARD", "(", "nestings", ")", ";", "Complex_Selector_Obj", "sel", ";", "Selector_List_Obj", "group", "=", "SASS_MEMORY_NEW", "(", "Selector_List", ",", "pstate", ")", ";", "group", "-", ">", "media_block", "(", "last_media_block", ")", ";", "@", "@", "-", "700", ",", "6", "+", "703", ",", "7", "@", "@", "namespace", "Sass", "{", "Complex_Selector_Obj", "Parser", ":", ":", "parse_complex_selector", "(", "bool", "chroot", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "String_Obj", "reference", "=", "0", ";", "lex", "<", "block_comment", ">", "()", ";", "advanceToNextToken", "(", ");", "@", "@", "-", "1055", ",", "6", "+", "1059", ",", "7", "@", "@", "namespace", "Sass", "{", "Expression_Obj", "Parser", ":", ":", "parse_map", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "Expression_Obj", "key", "=", "parse_list", "(", ");", "List_Obj", "map", "=", "SASS_MEMORY_NEW", "(", "List", ",", "pstate", ",", "0", ",", "SASS_HASH", ")", ";", "@", "@", "-", "1098", ",", "6", "+", "1103", ",", "7", "@", "@", "namespace", "Sass", "{", "Expression_Obj", "Parser", ":", ":", "parse_bracket_list", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "/", "/", "check", "if", "we", "have", "an", "empty", "list", "/", "/", "return", "the", "empty", "list", "as", "such", "if", "(", "peek_css", "<", "list_terminator", ">", "(", "position", ")", ")", "@", "@", "-", "1144", ",", "12", "+", "1150", ",", "14", "@", "@", "namespace", "Sass", "{", "/", "/", "so", "to", "speak", ":", "we", "unwrap", "items", "from", "lists", "if", "possible", "here", "!", "Expression_Obj", "Parser", ":", ":", "parse_list", "(", "bool", "delayed", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "return", "parse_comma_list", "(", "delayed", ")", ";", "}", "/", "/", "will", "return", "singletons", "unwrapped", "Expression_Obj", "Parser", ":", ":", "parse_comma_list", "(", "bool", "delayed", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "/", "/", "check", "if", "we", "have", "an", "empty", "list", "/", "/", "return", "the", "empty", "list", "as", "such", "if", "(", "peek_css", "<", "list_terminator", ">", "(", "position", ")", ")", "@", "@", "-", "1189", ",", "6", "+", "1197", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "will", "return", "singletons", "unwrapped", "Expression_Obj", "Parser", ":", ":", "parse_space_list", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "Expression_Obj", "disj1", "=", "parse_disjunction", "(", ");", "/", "/", "if", "it", "'", "s", "a", "singleton", ",", "return", "it", "(", "don", "'", "t", "wrap", "it", ")", "if", "(", "peek_css", "<", "space_list_terminator", ">", "(", "position", ")", "@", "@", "-", "1213", ",", "6", "+", "1222", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "logical", "OR", "operation", "Expression_Obj", "Parser", ":", ":", "parse_disjunction", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "/", "/", "parse", "the", "left", "hand", "side", "conjunction", "@", "@", "-", "1234", ",", "6", "+", "1244", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "logical", "AND", "operation", "Expression_Obj", "Parser", ":", ":", "parse_conjunction", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "/", "/", "parse", "the", "left", "hand", "side", "relation", "@", "@", "-", "1256", ",", "6", "+", "1267", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "comparison", "operations", "Expression_Obj", "Parser", ":", ":", "parse_relation", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "/", "/", "parse", "the", "left", "hand", "side", "expression", "@", "@", "-", "1308", ",", "6", "+", "1320", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "addition", "and", "subtraction", "operations", "Expression_Obj", "Parser", ":", ":", "parse_expression", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "/", "/", "parses", "multiple", "add", "and", "subtract", "operations", "@", "@", "-", "1351", ",", "6", "+", "1364", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "parse", "addition", "and", "subtraction", "operations", "Expression_Obj", "Parser", ":", ":", "parse_operators", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "advanceToNextToken", "(", ");", "ParserState", "state", "(", "pstate", ")", ";", "Expression_Obj", "factor", "=", "parse_factor", "(", ");", "@", "@", "-", "1383", ",", "6", "+", "1397", ",", "7", "@", "@", "namespace", "Sass", "{", "/", "/", "called", "from", "parse_value_schema", "Expression_Obj", "Parser", ":", ":", "parse_factor", "(", ")", "{", "NESTING_GUARD", "(", "nestings", ")", ";", "lex", "<", "css_comments", ">", "(", "false", ")", ";", "if", "(", "lex_css", "<", "exactly", "<", "'(", "'>", ">", "()", ")", "{", "/", "/", "parse_map", "may", "return", "a", "list", "@", "@", "-", "10", ",", "6", "+", "10", ",", "15", "@", "@", "#", "include", "\"", "position", ".", "hpp", "\"", "#", "include", "\"", "prelexer", ".", "hpp", "\"", "#", "ifndef", "MAX_NESTING", "/", "/", "Note", "that", "this", "limit", "is", "not", "an", "exact", "science", "/", "/", "it", "depends", "on", "various", "factors", ",", "which", "some", "are", "/", "/", "not", "under", "our", "control", "(", "compile", "time", "or", "even", "OS", "/", "/", "dependent", "settings", "on", "the", "available", "stack", "size", ")", "/", "/", "It", "should", "fix", "most", "common", "segfault", "cases", "though", ".", "#", "define", "MAX_NESTING", "512", "#", "endif", "struct", "Lookahead", "{", "const", "char", "*", "found", ";", "const", "char", "*", "error", ";", "@", "@", "-", "35", ",", "13", "+", "44", ",", "14", "@", "@", "namespace", "Sass", "{", "Position", "before_token", ";", "Position", "after_token", ";", "ParserState", "pstate", ";", "int", "indentation", ";", "size_t", "indentation", ";", "size_t", "nestings", ";", "Token", "lexed", ";", "Parser", "(", "Context", "&", "ctx", ",", "const", "ParserState", "&", "pstate", ")", ":", "ParserState", "(", "pstate", ")", ",", "ctx", "(", "ctx", ")", ",", "block_stack", "(", "),", "stack", "(", "0", ")", ",", "last_media_block", "(", "),", "source", "(", "0", ")", ",", "position", "(", "0", ")", ",", "end", "(", "0", ")", ",", "before_token", "(", "pstate", ")", ",", "after_token", "(", "pstate", ")", ",", "pstate", "(", "pstate", ")", ",", "indentation", "(", "0", ")", "source", "(", "0", ")", ",", "position", "(", "0", ")", ",", "end", "(", "0", ")", ",", "before_token", "(", "pstate", ")", ",", "after_token", "(", "pstate", ")", ",", "pstate", "(", "pstate", ")", ",", "indentation", "(", "0", ")", ",", "nestings", "(", "0", ")", "{", "stack", ".", "push_back", "(", "Scope", ":", ":", "Root", ")", ";", "}", "/", "/", "static", "Parser", "from_string", "(", "const", "std", ":", ":", "string", "&", "src", ",", "Context", "&", "ctx", ",", "ParserState", "pstate", "=", "ParserState", "(", "\"[", "STRING", "]", "\")", ");"], "docstring_tokens": ["stack", "consumption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "912", ",", "6", "+", "912", ",", "9", "@", "@", "static", "int", "do_pages_move", "(", "struct", "mm_struct", "*", "mm", ",", "struct", "task_struct", "*", "task", ",", "goto", "out_pm", ";", "err", "=", "-", "ENODEV", ";", "if", "(", "node", "<", "0", "|", "|", "node", ">", "=", "MAX_NUMNODES", ")", "goto", "out_pm", ";", "if", "(", "!", "node_state", "(", "node", ",", "N_HIGH_MEMORY", ")", ")", "goto", "out_pm", ";"], "docstring_tokens": ["information", "leakage"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "32", ",", "7", "+", "32", ",", "7", "@", "@", "#", "include", "\"", "ext", "/", "standard", "/", "info", ".", "h", "\"", "#", "include", "\"", "php_mbregex", ".", "h", "\"", "#", "include", "\"", "mbstring", ".", "h", "\"", "#", "include", "\"", "php_onig_compat", ".", "h", "\"", "/", "*", "must", "come", "prior", "to", "the", "oniguruma", "header", "*", "/", "#", "include", "<", "oniguruma", ".", "h", ">", "#", "undef", "UChar", "@", "@", "-", "55", ",", "7", "+", "55", ",", "7", "@", "@", "struct", "_zend_mb_regex_globals", "{", "#", "define", "MBREX", "(", "g", ")", "(", "MBSTRG", "(", "mb_regex_globals", ")", "->", "g", ")", "/", "*", "{", "{{", "static", "void", "php_mb_regex_free_cache", "(", ")", "*", "/", "static", "void", "php_mb_regex_free_cache", "(", "php_mb_regex_t", "*", "*", "pre", ")", "static", "void", "php_mb_regex_free_cache", "(", "php_mb_regex_t", "*", "*", "pre", ")", "{", "onig_free", "(", "*", "pre", ")", ";", "}", "@", "@", "-", "78", ",", "7", "+", "78", ",", "7", "@", "@", "static", "int", "_php_mb_regex_globals_ctor", "(", "zend_mb_regex_globals", "*", "pglobals", "TSRMLS_DC", ")", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "_php_mb_regex_globals_dtor", "*", "/", "static", "void", "_php_mb_regex_globals_dtor", "(", "zend_mb_regex_globals", "*", "pglobals", "TSRMLS_DC", ")", "static", "void", "_php_mb_regex_globals_dtor", "(", "zend_mb_regex_globals", "*", "pglobals", "TSRMLS_DC", ")", "{", "zend_hash_destroy", "(", "&", "pglobals", "-", ">", "ht_rc", ")", ";", "}", "@", "@", "-", "466", ",", "7", "+", "466", ",", "7", "@", "@", "static", "php_mb_regex_t", "*", "php_mbregex_compile_pattern", "(", "const", "char", "*", "pattern", ",", "int", "patl", "retval", "=", "*", "rc", ";", "}", "out", ":", "return", "retval", ";", "return", "retval", ";", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "483", ",", "15", "+", "483", ",", "15", "@", "@", "static", "size_t", "_php_mb_regex_get_option_string", "(", "char", "*", "str", ",", "size_t", "len", ",", "OnigOptionT", "-", "-", "len_left", ";", "*", "(", "p", "+", "+)", "=", "'", "i", "'", ";", "}", "+", "+", "len_req", ";", "+", "+", "len_req", ";", "}", "if", "(", "(", "option", "&", "ONIG_OPTION_EXTEND", ")", "!", "=", "0", ")", "{", "if", "(", "len_left", ">", "0", ")", "{", "-", "-", "len_left", ";", "*", "(", "p", "+", "+)", "=", "'", "x", "'", ";", "}", "+", "+", "len_req", ";", "+", "+", "len_req", ";", "}", "if", "(", "(", "option", "&", "(", "ONIG_OPTION_MULTILINE", "|", "ONIG_OPTION_SINGLELINE", ")", ")", "=", "=", "@", "@", "-", "500", ",", "37", "+", "500", ",", "37", "@", "@", "static", "size_t", "_php_mb_regex_get_option_string", "(", "char", "*", "str", ",", "size_t", "len", ",", "OnigOptionT", "-", "-", "len_left", ";", "*", "(", "p", "+", "+)", "=", "'", "p", "'", ";", "}", "+", "+", "len_req", ";", "+", "+", "len_req", ";", "}", "else", "{", "if", "(", "(", "option", "&", "ONIG_OPTION_MULTILINE", ")", "!", "=", "0", ")", "{", "if", "(", "len_left", ">", "0", ")", "{", "-", "-", "len_left", ";", "*", "(", "p", "+", "+)", "=", "'", "m", "'", ";", "}", "+", "+", "len_req", ";", "+", "+", "len_req", ";", "}", "if", "(", "(", "option", "&", "ONIG_OPTION_SINGLELINE", ")", "!", "=", "0", ")", "{", "if", "(", "len_left", ">", "0", ")", "{", "-", "-", "len_left", ";", "*", "(", "p", "+", "+)", "=", "'", "s", "'", ";", "}", "+", "+", "len_req", ";", "+", "+", "len_req", ";", "}", "}", "}", "if", "(", "(", "option", "&", "ONIG_OPTION_FIND_LONGEST", ")", "!", "=", "0", ")", "{", "if", "(", "len_left", ">", "0", ")", "{", "-", "-", "len_left", ";", "*", "(", "p", "+", "+)", "=", "'", "l", "'", ";", "}", "+", "+", "len_req", ";", "+", "+", "len_req", ";", "}", "if", "(", "(", "option", "&", "ONIG_OPTION_FIND_NOT_EMPTY", ")", "!", "=", "0", ")", "{", "if", "(", "len_left", ">", "0", ")", "{", "-", "-", "len_left", ";", "*", "(", "p", "+", "+)", "=", "'", "n", "'", ";", "}", "+", "+", "len_req", ";", "+", "+", "len_req", ";", "}", "c", "=", "0", ";", "@", "@", "-", "566", ",", "7", "+", "566", ",", "7", "@", "@", "static", "size_t", "_php_mb_regex_get_option_string", "(", "char", "*", "str", ",", "size_t", "len", ",", "OnigOptionT", "-", "-", "len_left", ";", "*", "(", "p", "+", "+)", "=", "'", "\\", "0", "'", ";", "}", "+", "+", "len_req", ";", "+", "+", "len_req", ";", "if", "(", "len", "<", "len_req", ")", "{", "return", "len_req", ";", "}", "@", "@", "-", "577", ",", "11", "+", "577", ",", "11", "@", "@", "static", "size_t", "_php_mb_regex_get_option_string", "(", "char", "*", "str", ",", "size_t", "len", ",", "OnigOptionT", "/", "*", "{", "{{", "_php_mb_regex_init_options", "*", "/", "static", "void", "_php_mb_regex_init_options", "(", "const", "char", "*", "parg", ",", "int", "narg", ",", "OnigOptionType", "*", "option", ",", "OnigSyntaxType", "*", "*", "syntax", ",", "int", "*", "eval", ")", "_php_mb_regex_init_options", "(", "const", "char", "*", "parg", ",", "int", "narg", ",", "OnigOptionType", "*", "option", ",", "OnigSyntaxType", "*", "*", "syntax", ",", "int", "*", "eval", ")", "{", "int", "n", ";", "char", "c", ";", "int", "optm", "=", "0", ";", "int", "optm", "=", "0", ";", "*", "syntax", "=", "ONIG_SYNTAX_RUBY", ";", "@", "@", "-", "636", ",", "13", "+", "636", ",", "13", "@", "@", "_php_mb_regex_init_options", "(", "const", "char", "*", "parg", ",", "int", "narg", ",", "OnigOptionType", "*", "option", ",", "O", "*", "syntax", "=", "ONIG_SYNTAX_POSIX_EXTENDED", ";", "break", ";", "case", "'", "e", "'", ":", "if", "(", "eval", "!", "=", "NULL", ")", "*", "eval", "=", "1", ";", "if", "(", "eval", "!", "=", "NULL", ")", "*", "eval", "=", "1", ";", "break", ";", "default", ":", "break", ";", "}", "}", "if", "(", "option", "!", "=", "NULL", ")", "*", "option", "|", "=", "optm", ";", "if", "(", "option", "!", "=", "NULL", ")", "*", "option", "|", "=", "optm", ";", "}", "}", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "860", ",", "11", "+", "860", ",", "11", "@", "@", "static", "void", "_php_mb_regex_ereg_replace_exec", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "OnigOp", "}", "else", "{", "/", "*", "FIXME", ":", "this", "code", "is", "not", "multibyte", "aware", "!", "*", "/", "convert_to_long_ex", "(", "arg_pattern_zval", ")", ";", "pat_buf", "[", "0", "]", "=", "(", "char", ")", "Z_LVAL_PP", "(", "arg_pattern_zval", ")", ";", "pat_buf", "[", "0", "]", "=", "(", "char", ")", "Z_LVAL_PP", "(", "arg_pattern_zval", ")", ";", "pat_buf", "[", "1", "]", "=", "'", "\\", "0", "'", ";", "arg_pattern", "=", "pat_buf", ";", "arg_pattern_len", "=", "1", ";", "arg_pattern_len", "=", "1", ";", "}", "/", "*", "create", "regex", "pattern", "buffer", "*", "/", "re", "=", "php_mbregex_compile_pattern", "(", "arg_pattern", ",", "arg_pattern_len", ",", "options", ",", "MBREX", "(", "current_mbctype", ")", ",", "syntax", "TSRMLS_CC", ")", ";", "@", "@", "-", "934", ",", "7", "+", "934", ",", "7", "@", "@", "static", "void", "_php_mb_regex_ereg_replace_exec", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "OnigOp", "}", "}", "}", "if", "(", "eval", ")", "{", "zval", "v", ";", "/", "*", "null", "terminate", "buffer", "*", "/", "@", "@", "-", "953", ",", "32", "+", "953", ",", "31", "@", "@", "static", "void", "_php_mb_regex_ereg_replace_exec", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "OnigOp", "eval_buf", ".", "len", "=", "0", ";", "zval_dtor", "(", "&", "v", ")", ";", "}", "else", "if", "(", "is_callable", ")", "{", "zval", "*", "retval_ptr", ";", "zval", "*", "retval_ptr", "=", "NULL", ";", "zval", "*", "*", "args", "[", "1", "]", ";", "zval", "*", "subpats", ";", "int", "i", ";", "MAKE_STD_ZVAL", "(", "subpats", ")", ";", "array_init", "(", "subpats", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "regs", "-", ">", "num_regs", ";", "i", "+", "+)", "{", "add_next_index_stringl", "(", "subpats", ",", "string", "+", "regs", "-", ">", "beg", "[", "i", "]", ",", "regs", "-", ">", "end", "[", "i", "]", "-", "regs", "-", ">", "beg", "[", "i", "]", ",", "1", ")", ";", "}", "}", "args", "[", "0", "]", "=", "&", "subpats", ";", "/", "*", "null", "terminate", "buffer", "*", "/", "smart_str_0", "(", "&", "eval_buf", ")", ";", "arg_replace_fci", ".", "param_count", "=", "1", ";", "arg_replace_fci", ".", "params", "=", "args", ";", "arg_replace_fci", ".", "retval_ptr_ptr", "=", "&", "retval_ptr", ";", "if", "(", "zend_call_function", "(", "&", "arg_replace_fci", ",", "&", "arg_replace_fci_cache", "TSRMLS_CC", ")", "=", "=", "SUCCESS", "&", "&", "arg_replace_fci", ".", "retval_ptr_ptr", ")", "{", "if", "(", "zend_call_function", "(", "&", "arg_replace_fci", ",", "&", "arg_replace_fci_cache", "TSRMLS_CC", ")", "=", "=", "SUCCESS", "&", "&", "arg_replace_fci", ".", "retval_ptr_ptr", "&", "&", "retval_ptr", ")", "{", "convert_to_string_ex", "(", "&", "retval_ptr", ")", ";", "smart_str_appendl", "(", "&", "out_buf", ",", "Z_STRVAL_P", "(", "retval_ptr", ")", ",", "Z_STRLEN_P", "(", "retval_ptr", ")", ");", "eval_buf", ".", "len", "=", "0", ";", "zval_ptr_dtor", "(", "&", "retval_ptr", ")", ";", "}", "else", "{", "efree", "(", "description", ")", ";", "if", "(", "!", "EG", "(", "exception", ")", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Unable", "to", "call", "custom", "replacement", "function", "\"", ");", "}", "@", "@", "-", "991", ",", "7", "+", "990", ",", "7", "@", "@", "static", "void", "_php_mb_regex_ereg_replace_exec", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "OnigOp", "pos", "=", "(", "OnigUChar", "*", ")", "string", "+", "n", ";", "}", "else", "{", "if", "(", "pos", "<", "string_lim", ")", "{", "smart_str_appendl", "(", "&", "out_buf", ",", "pos", ",", "1", ")", ";", "smart_str_appendl", "(", "&", "out_buf", ",", "pos", ",", "1", ")", ";", "}", "pos", "+", "+;", "}", "@", "@", "-", "1013", ",", "7", "+", "1012", ",", "7", "@", "@", "static", "void", "_php_mb_regex_ereg_replace_exec", "(", "INTERNAL_FUNCTION_PARAMETERS", ",", "OnigOp", "smart_str_free", "(", "&", "eval_buf", ")", ";", "if", "(", "err", "<", "=", "-", "2", ")", "{", "smart_str_free", "(", "&", "out_buf", ")", ";", "smart_str_free", "(", "&", "out_buf", ")", ";", "RETVAL_FALSE", ";", "}", "else", "{", "smart_str_appendc", "(", "&", "out_buf", ",", "'", "\\", "0", "'", ");", "@", "@", "-", "1063", ",", "7", "+", "1062", ",", "7", "@", "@", "PHP_FUNCTION", "(", "mb_split", ")", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "arg_pattern", ",", "&", "arg_pattern_len", ",", "&", "string", ",", "&", "string_len", ",", "&", "count", ")", "=", "=", "FAILURE", ")", "{", "RETURN_FALSE", ";", "}", "}", "if", "(", "count", ">", "0", ")", "{", "count", "-", "-;", "@", "@", "-", "1317", ",", "7", "+", "1316", ",", "7", "@", "@", "PHP_FUNCTION", "(", "mb_ereg_search_init", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "z", "|", "ss", "\"", ",", "&", "arg_str", ",", "&", "arg_pattern", ",", "&", "arg_pattern_len", ",", "&", "arg_options", ",", "&", "arg_options_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", ">", "1", "&", "&", "arg_pattern_len", "=", "=", "0", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Empty", "pattern", "\"", ");", "RETURN_FALSE", ";", "@", "@", "-", "1416", ",", "7", "+", "1415", ",", "7", "@", "@", "PHP_FUNCTION", "(", "mb_ereg_search_setpos", ")", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "php_mb_regex_set_options", "*", "/", "static", "void", "_php_mb_regex_set_options", "(", "OnigOptionType", "options", ",", "OnigSyntaxType", "*", "syntax", ",", "OnigOptionType", "*", "prev_options", ",", "OnigSyntaxType", "*", "*", "prev_syntax", "TSRMLS_DC", ")", "static", "void", "_php_mb_regex_set_options", "(", "OnigOptionType", "options", ",", "OnigSyntaxType", "*", "syntax", ",", "OnigOptionType", "*", "prev_options", ",", "OnigSyntaxType", "*", "*", "prev_syntax", "TSRMLS_DC", ")", "{", "if", "(", "prev_options", "!", "=", "NULL", ")", "{", "*", "prev_options", "=", "MBREX", "(", "regex_default_options", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "17", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "72402", ":", "_php_mb_regex_ereg_replace_exec", "-", "double", "free", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "extension_loaded", "(", "'", "mbstring", "'", ")", "or", "die", "(", "'", "skip", "mbstring", "not", "available", "'", ");", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "function", "throwit", "(", ")", "{", "throw", "new", "Exception", "(", "'", "it", "'", ");", "}", "$", "var10", "=", "\"", "throwit", "\"", ";", "try", "{", "$", "var14", "=", "mb_ereg_replace_callback", "(", "\"\"", ",", "$", "var10", ",", "\"", "\")", ";", "}", "catch", "(", "Exception", "$", "e", ")", "{", "}", "?", ">", "DONE", "-", "-", "EXPECT", "-", "-", "DONE", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["integer", "overflows)."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "180", ",", "6", "+", "180", ",", "12", "@", "@", "static", "int", "create_fixed_stream_quirk", "(", "struct", "snd_usb_audio", "*", "chip", ",", "}", "alts", "=", "&", "iface", "-", ">", "altsetting", "[", "fp", "-", ">", "altset_idx", "]", ";", "altsd", "=", "get_iface_desc", "(", "alts", ")", ";", "if", "(", "altsd", "-", ">", "bNumEndpoints", "<", "1", ")", "{", "kfree", "(", "fp", ")", ";", "kfree", "(", "rate_table", ")", ";", "return", "-", "EINVAL", ";", "}", "fp", "-", ">", "protocol", "=", "altsd", "-", ">", "bInterfaceProtocol", ";", "if", "(", "fp", "-", ">", "datainterval", "=", "=", "0", ")"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1226", ",", "7", "+", "1226", ",", "7", "@", "@", "int", "agp_generic_alloc_pages", "(", "struct", "agp_bridge_data", "*", "bridge", ",", "struct", "agp_memory", "*", "m", "int", "i", ",", "ret", "=", "-", "ENOMEM", ";", "for", "(", "i", "=", "0", ";", "i", "<", "num_pages", ";", "i", "+", "+)", "{", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", ")", ";", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", "|", "__GFP_ZERO", ")", ";", "/", "*", "agp_free_memory", "(", ")", "needs", "gart", "address", "*", "/", "if", "(", "page", "=", "=", "NULL", ")", "goto", "out", ";", "@", "@", "-", "1257", ",", "7", "+", "1257", ",", "7", "@", "@", "void", "*", "agp_generic_alloc_page", "(", "struct", "agp_bridge_data", "*", "bridge", ")", "{", "struct", "page", "*", "page", ";", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", ")", ";", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", "|", "__GFP_ZERO", ")", ";", "if", "(", "page", "=", "=", "NULL", ")", "return", "NULL", ";"], "docstring_tokens": ["information", "leakage.\""]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "101", ",", "13", "+", "101", ",", "13", "@", "@", "static", "int", "php_zip_ops_stat", "(", "php_stream", "*", "stream", ",", "php_stream_statbuf", "*", "ssb", "TSRMLS_D", "{", "struct", "zip_stat", "sb", ";", "const", "char", "*", "path", "=", "stream", "-", ">", "orig_path", ";", "int", "path_len", "=", "strlen", "(", "stream", "-", ">", "orig_path", ")", ";", "size_t", "path_len", "=", "strlen", "(", "stream", "-", ">", "orig_path", ")", ";", "char", "*", "file_basename", ";", "size_t", "file_basename_len", ";", "char", "file_dirname", "[", "MAXPATHLEN", "]", ";", "struct", "zip", "*", "za", ";", "char", "*", "fragment", ";", "int", "fragment_len", ";", "size_t", "fragment_len", ";", "int", "err", ";", "fragment", "=", "strchr", "(", "path", ",", "'", "#'", ");"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1670", ",", "47", "+", "1670", ",", "6", "@", "@", "static", "int", "srpt_handle_cmd", "(", "struct", "srpt_rdma_ch", "*", "ch", ",", "return", "-", "1", ";", "}", "/", "**", "*", "srpt_rx_mgmt_fn_tag", "(", ")", "-", "Process", "a", "task", "management", "function", "by", "tag", ".", "*", "@", "ch", ":", "RDMA", "channel", "of", "the", "task", "management", "request", ".", "*", "@", "fn", ":", "Task", "management", "function", "to", "perform", ".", "*", "@", "req_tag", ":", "Tag", "of", "the", "SRP", "task", "management", "request", ".", "*", "@", "mgmt_ioctx", ":", "I", "/", "O", "context", "of", "the", "task", "management", "request", ".", "*", "*", "Returns", "zero", "if", "the", "target", "core", "will", "process", "the", "task", "management", "*", "request", "asynchronously", ".", "*", "*", "Note", ":", "It", "is", "assumed", "that", "the", "initiator", "serializes", "tag", "-", "based", "task", "management", "*", "requests", ".", "*", "/", "static", "int", "srpt_rx_mgmt_fn_tag", "(", "struct", "srpt_send_ioctx", "*", "ioctx", ",", "u64", "tag", ")", "{", "struct", "srpt_device", "*", "sdev", ";", "struct", "srpt_rdma_ch", "*", "ch", ";", "struct", "srpt_send_ioctx", "*", "target", ";", "int", "ret", ",", "i", ";", "ret", "=", "-", "EINVAL", ";", "ch", "=", "ioctx", "-", ">", "ch", ";", "BUG_ON", "(", "!", "ch", ")", ";", "BUG_ON", "(", "!", "ch", "-", ">", "sport", ")", ";", "sdev", "=", "ch", "-", ">", "sport", "-", ">", "sdev", ";", "BUG_ON", "(", "!", "sdev", ")", ";", "spin_lock_irq", "(", "&", "sdev", "-", ">", "spinlock", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "ch", "-", ">", "rq_size", ";", "+", "+", "i", ")", "{", "target", "=", "ch", "-", ">", "ioctx_ring", "[", "i", "]", ";", "if", "(", "target", "-", ">", "cmd", ".", "se_lun", "=", "=", "ioctx", "-", ">", "cmd", ".", "se_lun", "&", "&", "target", "-", ">", "cmd", ".", "tag", "=", "=", "tag", "&", "&", "srpt_get_cmd_state", "(", "target", ")", "!", "=", "SRPT_STATE_DONE", ")", "{", "ret", "=", "0", ";", "/", "*", "now", "let", "the", "target", "core", "abort", "&", "target", "-", ">", "cmd", ";", "*", "/", "break", ";", "}", "}", "spin_unlock_irq", "(", "&", "sdev", "-", ">", "spinlock", ")", ";", "return", "ret", ";", "}", "static", "int", "srp_tmr_to_tcm", "(", "int", "fn", ")", "{", "switch", "(", "fn", ")", "{", "@", "@", "-", "1745", ",", "7", "+", "1704", ",", "6", "@", "@", "static", "void", "srpt_handle_tsk_mgmt", "(", "struct", "srpt_rdma_ch", "*", "ch", ",", "struct", "se_cmd", "*", "cmd", ";", "struct", "se_session", "*", "sess", "=", "ch", "-", ">", "sess", ";", "uint64_t", "unpacked_lun", ";", "uint32_t", "tag", "=", "0", ";", "int", "tcm_tmr", ";", "int", "rc", ";", "@", "@", "-", "1761", ",", "25", "+", "1719", ",", "10", "@", "@", "static", "void", "srpt_handle_tsk_mgmt", "(", "struct", "srpt_rdma_ch", "*", "ch", ",", "srpt_set_cmd_state", "(", "send_ioctx", ",", "SRPT_STATE_MGMT", ")", ";", "send_ioctx", "-", ">", "cmd", ".", "tag", "=", "srp_tsk", "-", ">", "tag", ";", "tcm_tmr", "=", "srp_tmr_to_tcm", "(", "srp_tsk", "-", ">", "tsk_mgmt_func", ")", ";", "if", "(", "tcm_tmr", "<", "0", ")", "{", "send_ioctx", "-", ">", "cmd", ".", "se_tmr_req", "-", ">", "response", "=", "TMR_TASK_MGMT_FUNCTION_NOT_SUPPORTED", ";", "goto", "fail", ";", "}", "unpacked_lun", "=", "srpt_unpack_lun", "(", "(", "uint8_t", "*", ")&", "srp_tsk", "-", ">", "lun", ",", "sizeof", "(", "srp_tsk", "-", ">", "lun", ")", ");", "if", "(", "srp_tsk", "-", ">", "tsk_mgmt_func", "=", "=", "SRP_TSK_ABORT_TASK", ")", "{", "rc", "=", "srpt_rx_mgmt_fn_tag", "(", "send_ioctx", ",", "srp_tsk", "-", ">", "task_tag", ")", ";", "if", "(", "rc", "<", "0", ")", "{", "send_ioctx", "-", ">", "cmd", ".", "se_tmr_req", "-", ">", "response", "=", "TMR_TASK_DOES_NOT_EXIST", ";", "goto", "fail", ";", "}", "tag", "=", "srp_tsk", "-", ">", "task_tag", ";", "}", "rc", "=", "target_submit_tmr", "(", "&", "send_ioctx", "-", ">", "cmd", ",", "sess", ",", "NULL", ",", "unpacked_lun", ",", "srp_tsk", ",", "tcm_tmr", ",", "GFP_KERNEL", ",", "tag", ",", "srp_tsk", ",", "tcm_tmr", ",", "GFP_KERNEL", ",", "srp_tsk", "-", ">", "task_tag", ",", "TARGET_SCF_ACK_KREF", ")", ";", "if", "(", "rc", "!", "=", "0", ")", "{", "send_ioctx", "-", ">", "cmd", ".", "se_tmr_req", "-", ">", "response", "=", "TMR_FUNCTION_REJECTED", ";"], "docstring_tokens": ["pointer", "dereference"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2657", ",", "6", "+", "2657", ",", "7", "@", "@", "static", "int", "dev_ifconf", "(", "struct", "net", "*", "net", ",", "struct", "compat_ifconf", "__user", "*", "uifc32", ")", "if", "(", "copy_from_user", "(", "&", "ifc32", ",", "uifc32", ",", "sizeof", "(", "struct", "compat_ifconf", ")", "))", "return", "-", "EFAULT", ";", "memset", "(", "&", "ifc", ",", "0", ",", "sizeof", "(", "ifc", ")", ");", "if", "(", "ifc32", ".", "ifcbuf", "=", "=", "0", ")", "{", "ifc32", ".", "ifc_len", "=", "0", ";", "ifc", ".", "ifc_len", "=", "0", ";"], "docstring_tokens": ["info", "leaks"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "0", ",", "0", "+", "1", ",", "13", "@", "@", "root", "=", "true", "[", "*]", "end_of_line", "=", "lf", "insert_final_newline", "=", "true", "[", "*.", "js", "]", "charset", "=", "utf", "-", "8", "indent_style", "=", "tab", "[", "{.", "travis", ".", "yml", ",", "package", ".", "json", "}", "]", "indent_style", "=", "space", "indent_size", "=", "2", "@", "@", "-", "1", ",", "2", "+", "1", "@", "@", "node_modules", "lib", "/", "parse", ".", "js", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "1", ",", "8", "+", "1", ",", "187", "@", "@", "{", "\"", "extends", "\"", ":", "\"", "peerigon", "/", "es5", "\"", ",", "\"", "root", "\"", ":", "true", ",", "\"", "env", "\"", ":", "{", "\"", "node", "\"", ":", "true", ",", "\"", "browser", "\"", ":", "true", "}", "\"", "parserOptions", "\"", ":", "{", "\"", "ecmaVersion", "\"", ":", "7", "}", ",", "\"", "plugins", "\"", ":", "[", "],", "\"", "globals", "\"", ":{", "\"", "Promise", "\"", ":", "true", ",", "\"", "JQLite", "\"", ":", "true", ",", "\"", "JQLitePrototype", "\"", ":", "true", ",", "\"", "ArrayBuffer", "\"", ":", "true", "}", ",", "\"", "env", "\"", ":", "{", "\"", "node", "\"", ":", "true", ",", "\"", "browser", "\"", ":", "true", ",", "\"", "mocha", "\"", ":", "true", "}", ",", "\"", "rules", "\"", ":", "{", "\"", "accessor", "-", "pairs", "\"", ":", "2", ",", "\"", "array", "-", "bracket", "-", "spacing", "\"", ":", "[", "2", ",", "\"", "never", "\"", "],", "\"", "arrow", "-", "parens", "\"", ":", "0", ",", "\"", "arrow", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "before", "\"", ":", "true", ",", "\"", "after", "\"", ":", "true", "}", "],", "\"", "block", "-", "scoped", "-", "var", "\"", ":", "2", ",", "\"", "block", "-", "spacing", "\"", ":", "[", "2", ",", "\"", "always", "\"", "],", "\"", "brace", "-", "style", "\"", ":", "0", ",", "\"", "callback", "-", "return", "\"", ":", "2", ",", "\"", "camelcase", "\"", ":", "[", "0", ",", "{", "\"", "properties", "\"", ":", "\"", "never", "\"", "}]", ",", "\"", "comma", "-", "dangle", "\"", ":", "[", "0", ",", "\"", "always", "-", "multiline", "\"", "],", "\"", "comma", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "before", "\"", ":", "false", ",", "\"", "after", "\"", ":", "true", "}", "],", "\"", "comma", "-", "style", "\"", ":", "[", "2", ",", "\"", "last", "\"", "],", "\"", "complexity", "\"", ":", "[", "2", ",", "10", "]", ",", "\"", "computed", "-", "property", "-", "spacing", "\"", ":", "[", "2", ",", "\"", "never", "\"", "],", "\"", "consistent", "-", "return", "\"", ":", "0", ",", "\"", "consistent", "-", "this", "\"", ":", "[", "2", ",", "\"", "self", "\"", "],", "\"", "constructor", "-", "super", "\"", ":", "2", ",", "\"", "curly", "\"", ":", "[", "2", ",", "\"", "all", "\"", "],", "\"", "default", "-", "case", "\"", ":", "0", ",", "\"", "dot", "-", "location", "\"", ":", "[", "2", ",", "\"", "property", "\"", "],", "\"", "dot", "-", "notation", "\"", ":", "2", ",", "\"", "eol", "-", "last", "\"", ":", "2", ",", "\"", "eqeqeq", "\"", ":", "[", "2", ",", "\"", "smart", "\"", "],", "\"", "func", "-", "names", "\"", ":", "0", ",", "\"", "func", "-", "style", "\"", ":", "[", "2", ",", "\"", "declaration", "\"", "],", "\"", "generator", "-", "star", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "before", "\"", ":", "false", ",", "\"", "after", "\"", ":", "true", "}", "],", "\"", "global", "-", "require", "\"", ":", "0", ",", "\"", "guard", "-", "for", "-", "in", "\"", ":", "2", ",", "\"", "handle", "-", "callback", "-", "err", "\"", ":", "2", ",", "\"", "id", "-", "length", "\"", ":", "0", ",", "\"", "id", "-", "match", "\"", ":", "0", ",", "\"", "init", "-", "declarations", "\"", ":", "0", ",", "\"", "key", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "beforeColon", "\"", ":", "false", ",", "\"", "afterColon", "\"", ":", "true", ",", "\"", "mode", "\"", ":", "\"", "strict", "\"", "}]", ",", "\"", "linebreak", "-", "style", "\"", ":", "0", ",", "\"", "lines", "-", "around", "-", "comment", "\"", ":", "0", ",", "\"", "max", "-", "nested", "-", "callbacks", "\"", ":", "0", ",", "\"", "new", "-", "cap", "\"", ":", "[", "2", ",", "{", "\"", "newIsCapExceptions", "\"", ":", "[", "\"", "Boom", ".", "badRequest", "\"", ",", "\"", "Boom", ".", "forbidden", "\"", ",", "\"", "Boom", ".", "unauthorized", "\"", ",", "\"", "Boom", ".", "wrap", "\"", "],", "\"", "capIsNewExceptions", "\"", ":", "[", "\"", "squeeze", ".", "Squeeze", "\"", "]", "}", "],", "\"", "new", "-", "parens", "\"", ":", "2", ",", "\"", "newline", "-", "after", "-", "var", "\"", ":", "0", ",", "\"", "no", "-", "alert", "\"", ":", "2", ",", "\"", "no", "-", "array", "-", "constructor", "\"", ":", "2", ",", "\"", "no", "-", "caller", "\"", ":", "2", ",", "\"", "no", "-", "catch", "-", "shadow", "\"", ":", "0", ",", "\"", "no", "-", "class", "-", "assign", "\"", ":", "2", ",", "\"", "no", "-", "console", "\"", ":", "2", ",", "\"", "no", "-", "const", "-", "assign", "\"", ":", "2", ",", "\"", "no", "-", "constant", "-", "condition", "\"", ":", "[", "2", ",", "{", "\"", "checkLoops", "\"", ":", "false", "}", "],", "\"", "no", "-", "continue", "\"", ":", "0", ",", "\"", "no", "-", "control", "-", "regex", "\"", ":", "0", ",", "\"", "no", "-", "debugger", "\"", ":", "2", ",", "\"", "no", "-", "delete", "-", "var", "\"", ":", "2", ",", "\"", "no", "-", "div", "-", "regex", "\"", ":", "2", ",", "\"", "no", "-", "dupe", "-", "args", "\"", ":", "2", ",", "\"", "no", "-", "dupe", "-", "class", "-", "members", "\"", ":", "2", ",", "\"", "no", "-", "dupe", "-", "keys", "\"", ":", "2", ",", "\"", "no", "-", "duplicate", "-", "case", "\"", ":", "2", ",", "\"", "no", "-", "else", "-", "return", "\"", ":", "2", ",", "\"", "no", "-", "empty", "\"", ":", "2", ",", "\"", "no", "-", "empty", "-", "character", "-", "class", "\"", ":", "2", ",", "\"", "no", "-", "eval", "\"", ":", "2", ",", "\"", "no", "-", "ex", "-", "assign", "\"", ":", "2", ",", "\"", "no", "-", "extend", "-", "native", "\"", ":", "2", ",", "\"", "no", "-", "extra", "-", "bind", "\"", ":", "2", ",", "\"", "no", "-", "extra", "-", "boolean", "-", "cast", "\"", ":", "2", ",", "\"", "no", "-", "extra", "-", "parens", "\"", ":", "[", "2", ",", "\"", "functions", "\"", "],", "\"", "no", "-", "extra", "-", "semi", "\"", ":", "2", ",", "\"", "no", "-", "fallthrough", "\"", ":", "2", ",", "\"", "no", "-", "floating", "-", "decimal", "\"", ":", "2", ",", "\"", "no", "-", "func", "-", "assign", "\"", ":", "2", ",", "\"", "no", "-", "implicit", "-", "coercion", "\"", ":", "0", ",", "\"", "no", "-", "implied", "-", "eval", "\"", ":", "2", ",", "\"", "no", "-", "inline", "-", "comments", "\"", ":", "0", ",", "\"", "no", "-", "inner", "-", "declarations", "\"", ":", "2", ",", "\"", "no", "-", "invalid", "-", "regexp", "\"", ":", "2", ",", "\"", "no", "-", "irregular", "-", "whitespace", "\"", ":", "2", ",", "\"", "no", "-", "iterator", "\"", ":", "2", ",", "\"", "no", "-", "label", "-", "var", "\"", ":", "2", ",", "\"", "no", "-", "labels", "\"", ":", "0", ",", "\"", "no", "-", "lone", "-", "blocks", "\"", ":", "2", ",", "\"", "no", "-", "lonely", "-", "if", "\"", ":", "2", ",", "\"", "no", "-", "loop", "-", "func", "\"", ":", "2", ",", "\"", "no", "-", "mixed", "-", "requires", "\"", ":", "2", ",", "\"", "no", "-", "mixed", "-", "spaces", "-", "and", "-", "tabs", "\"", ":", "0", ",", "\"", "no", "-", "multi", "-", "spaces", "\"", ":", "2", ",", "\"", "no", "-", "multi", "-", "str", "\"", ":", "2", ",", "\"", "no", "-", "multiple", "-", "empty", "-", "lines", "\"", ":", "[", "2", ",", "{", "\"", "max", "\"", ":", "1", "}", "],", "\"", "no", "-", "native", "-", "reassign", "\"", ":", "2", ",", "\"", "no", "-", "negated", "-", "in", "-", "lhs", "\"", ":", "2", ",", "\"", "no", "-", "new", "\"", ":", "2", ",", "\"", "no", "-", "new", "-", "func", "\"", ":", "2", ",", "\"", "no", "-", "new", "-", "object", "\"", ":", "2", ",", "\"", "no", "-", "new", "-", "require", "\"", ":", "2", ",", "\"", "no", "-", "new", "-", "wrappers", "\"", ":", "2", ",", "\"", "no", "-", "obj", "-", "calls", "\"", ":", "2", ",", "\"", "no", "-", "octal", "\"", ":", "2", ",", "\"", "no", "-", "octal", "-", "escape", "\"", ":", "2", ",", "\"", "no", "-", "param", "-", "reassign", "\"", ":", "0", ",", "\"", "no", "-", "path", "-", "concat", "\"", ":", "2", ",", "\"", "no", "-", "process", "-", "env", "\"", ":", "2", ",", "\"", "no", "-", "process", "-", "exit", "\"", ":", "2", ",", "\"", "no", "-", "proto", "\"", ":", "2", ",", "\"", "no", "-", "redeclare", "\"", ":", "2", ",", "\"", "no", "-", "regex", "-", "spaces", "\"", ":", "2", ",", "\"", "no", "-", "restricted", "-", "modules", "\"", ":", "0", ",", "\"", "no", "-", "restricted", "-", "syntax", "\"", ":", "0", ",", "\"", "no", "-", "return", "-", "assign", "\"", ":", "0", ",", "\"", "no", "-", "script", "-", "url", "\"", ":", "2", ",", "\"", "no", "-", "self", "-", "compare", "\"", ":", "2", ",", "\"", "no", "-", "sequences", "\"", ":", "2", ",", "\"", "no", "-", "shadow", "\"", ":", "0", ",", "\"", "no", "-", "shadow", "-", "restricted", "-", "names", "\"", ":", "2", ",", "\"", "no", "-", "spaced", "-", "func", "\"", ":", "2", ",", "\"", "no", "-", "sparse", "-", "arrays", "\"", ":", "2", ",", "\"", "no", "-", "ternary", "\"", ":", "0", ",", "\"", "no", "-", "this", "-", "before", "-", "super", "\"", ":", "2", ",", "\"", "no", "-", "throw", "-", "literal", "\"", ":", "2", ",", "\"", "no", "-", "trailing", "-", "spaces", "\"", ":", "2", ",", "\"", "no", "-", "undef", "\"", ":", "2", ",", "\"", "no", "-", "undef", "-", "init", "\"", ":", "0", ",", "\"", "no", "-", "undefined", "\"", ":", "0", ",", "\"", "no", "-", "underscore", "-", "dangle", "\"", ":", "0", ",", "\"", "no", "-", "unexpected", "-", "multiline", "\"", ":", "2", ",", "\"", "no", "-", "unneeded", "-", "ternary", "\"", ":", "2", ",", "\"", "no", "-", "unreachable", "\"", ":", "2", ",", "\"", "no", "-", "unused", "-", "expressions", "\"", ":", "2", ",", "\"", "no", "-", "unused", "-", "vars", "\"", ":", "2", ",", "\"", "no", "-", "use", "-", "before", "-", "define", "\"", ":", "[", "2", ",", "\"", "nofunc", "\"", "],", "\"", "no", "-", "useless", "-", "call", "\"", ":", "2", ",", "\"", "no", "-", "useless", "-", "concat", "\"", ":", "2", ",", "\"", "no", "-", "var", "\"", ":", "0", ",", "\"", "no", "-", "void", "\"", ":", "2", ",", "\"", "no", "-", "warning", "-", "comments", "\"", ":", "[", "2", ",", "{", "\"", "terms", "\"", ":", "[", "\"", "todo", "\"", ",", "\"", "fixme", "\"", "],", "\"", "location", "\"", ":", "\"", "anywhere", "\"", "}]", ",", "\"", "no", "-", "with", "\"", ":", "2", ",", "\"", "object", "-", "curly", "-", "spacing", "\"", ":", "0", ",", "\"", "object", "-", "shorthand", "\"", ":", "0", ",", "\"", "one", "-", "var", "\"", ":", "0", ",", "\"", "operator", "-", "assignment", "\"", ":", "[", "0", ",", "\"", "always", "\"", "],", "\"", "operator", "-", "linebreak", "\"", ":", "0", ",", "\"", "padded", "-", "blocks", "\"", ":", "[", "2", ",", "\"", "never", "\"", "],", "\"", "prefer", "-", "arrow", "-", "callback", "\"", ":", "0", ",", "\"", "prefer", "-", "const", "\"", ":", "0", ",", "\"", "prefer", "-", "destructuring", "\"", ":", "[", "0", ",", "{", "\"", "AssignmentExpression", "\"", ":", "{", "\"", "array", "\"", ":", "true", ",", "\"", "object", "\"", ":", "false", "}", "}", "],", "\"", "prefer", "-", "reflect", "\"", ":", "0", ",", "\"", "prefer", "-", "spread", "\"", ":", "0", ",", "\"", "prefer", "-", "template", "\"", ":", "0", ",", "\"", "quotes", "\"", ":", "[", "2", ",", "\"", "double", "\"", ",", "{", "\"", "avoidEscape", "\"", ":", "true", "}", "],", "\"", "quote", "-", "props", "\"", ":", "[", "2", ",", "\"", "as", "-", "needed", "\"", "],", "\"", "radix", "\"", ":", "2", ",", "\"", "require", "-", "jsdoc", "\"", ":", "0", ",", "\"", "require", "-", "yield", "\"", ":", "2", ",", "\"", "semi", "\"", ":", "[", "2", ",", "\"", "always", "\"", "],", "\"", "semi", "-", "spacing", "\"", ":", "[", "2", ",", "{", "\"", "before", "\"", ":", "false", ",", "\"", "after", "\"", ":", "true", "}", "],", "\"", "sort", "-", "vars", "\"", ":", "0", ",", "\"", "use", "-", "isnan", "\"", ":", "2", ",", "\"", "valid", "-", "jsdoc", "\"", ":", "0", ",", "\"", "valid", "-", "typeof", "\"", ":", "2", ",", "\"", "vars", "-", "on", "-", "top", "\"", ":", "0", ",", "\"", "wrap", "-", "iife", "\"", ":", "[", "2", ",", "\"", "inside", "\"", "],", "\"", "wrap", "-", "regex", "\"", ":", "0", ",", "\"", "yoda", "\"", ":", "[", "2", ",", "\"", "never", "\"", "]", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "angular", "-", "expressions", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "*", "*", "A", "security", "vulnerability", "has", "been", "found", "that", "affects", "all", "versions", "before", "1", ".", "0", ".", "1", ".", "Please", "read", "this", "advisory", "https", ":", "//", "github", ".", "com", "/", "peerigon", "/", "angular", "-", "expressions", "/", "security", "/", "advisories", "/", "GHSA", "-", "hxhm", "-", "96pp", "-", "2m43", "for", "more", "information", ".", "**", "#", "angular", "-", "expressions", "*", "*[", "angular", "'", "s", "nicest", "part", "]", "(", "https", ":", "//", "github", ".", "com", "/", "angular", "/", "angular", ".", "js", "/", "blob", "/", "6b049c74ccc9ee19688bb9bbe504c300e61776dc", "/", "src", "/", "ng", "/", "parse", ".", "js", ")", "extracted", "as", "a", "standalone", "module", "for", "the", "browser", "and", "node", ".", "**", "@", "@", "-", "38", ",", "16", "+", "39", ",", "13", "@", "@", "Check", "out", "[", "their", "readme", "]", "(", "http", ":", "//", "docs", ".", "angularjs", ".", "org", "/", "guide", "/", "expression", ")", "for", "further", "<", "br", "/", ">", "Setup", "#", "#", "Setup", "[", "![", "npm", "status", "]", "(", "https", ":", "//", "nodei", ".", "co", "/", "npm", "/", "angular", "-", "expressions", ".", "svg", "?", "downloads", "=", "true", "&", "stars", "=", "true", "&", "downloadRank", "=", "true", ")", "](", "https", ":", "//", "npmjs", ".", "org", "/", "package", "/", "angular", "-", "expressions", ")", "<", "br", "/", ">", "Filters", "#", "#", "Filters", "Angular", "provides", "a", "mechanism", "to", "define", "filters", "on", "expressions", ":", "@", "@", "-", "62", ",", "25", "+", "60", ",", "24", "@", "@", "Arguments", "are", "evaluated", "against", "the", "scope", ":", "`", "``", "javascript", "expressions", ".", "filters", ".", "currency", "=", "(", "input", ",", "currency", ",", "digits", ")", "=", ">", "{", "input", "=", "input", ".", "toFixed", "(", "digits", ")", ";", "input", "=", "input", ".", "toFixed", "(", "digits", ")", ";", "if", "(", "currency", "=", "==", "\"", "EUR", "\"", ")", "{", "return", "input", "+", "\"", "\u20ac\"", ";", "}", "else", "{", "return", "input", "+", "\"", "$\"", ";", "}", "if", "(", "currency", "=", "==", "\"", "EUR", "\"", ")", "{", "return", "input", "+", "\"", "\u20ac\"", ";", "}", "else", "{", "return", "input", "+", "\"", "$\"", ";", "}", "}", ";", "expr", "=", "expressions", ".", "compile", "(", "\"", "1", ".", "2345", "|", "currency", ":", "selectedCurrency", ":", "2", "\"", ");", "expr", "(", "{", "selectedCurrency", ":", "\"", "EUR", "\"", "selectedCurrency", ":", "\"", "EUR", "\"", "}", ");", "/", "/", "returns", "'", "1", ".", "23", "\u20ac", "'", "`", "``", "<", "br", "/", ">", "API", "#", "#", "API", "#", "##", "exports", "@", "@", "-", "104", ",", "9", "+", "101", ",", "9", "@", "@", "Example", "output", "of", ":", "`", "compile", "(", "\"", "tmp", "+", "1", "\"", ").", "ast", "`", "constant", ":", "false", "}", "`", "``", "*", "NOTE", "*", "angular", "$", "parse", "do", "not", "export", "ast", "variable", "it", "'", "s", "done", "by", "this", "library", ".", "_NOTE_", "angular", "\\", "$", "parse", "do", "not", "export", "ast", "variable", "it", "'", "s", "done", "by", "this", "library", ".", "#", "##", "#", ".", "compile", ".", "cache", "=", "{", "}", "#", "##", "#", ".", "compile", ".", "cache", "=", "Object", ".", "create", "(", "null", ")", "A", "cache", "containing", "all", "compiled", "functions", ".", "The", "src", "is", "used", "as", "key", ".", "Set", "this", "on", "`", "false", "`", "to", "disable", "the", "cache", ".", "@", "@", "-", "122", ",", "34", "+", "119", ",", "34", "@", "@", "The", "internal", "[", "Lexer", "]", "(", "https", ":", "//", "github", ".", "com", "/", "angular", "/", "angular", ".", "js", "/", "blob", "/", "6b049c74ccc9ee19", "The", "internal", "[", "Parser", "]", "(", "https", ":", "//", "github", ".", "com", "/", "angular", "/", "angular", ".", "js", "/", "blob", "/", "6b049c74ccc9ee19688bb9bbe504c300e61776dc", "/", "src", "/", "ng", "/", "parse", ".", "js", "#", "L390", ")", ".", "-", "--", "#", "##", "evaluate", "(", "scope", "?", "):", "*", "#", "##", "evaluate", "(", "scope", "?", "):", "\\", "*", "Evaluates", "the", "compiled", "`", "src", "`", "and", "returns", "the", "result", "of", "the", "expression", ".", "Property", "look", "-", "ups", "or", "assignments", "are", "executed", "on", "a", "given", "`", "scope", "`", ".", "#", "##", "evaluate", ".", "assign", "(", "scope", ",", "value", ")", ":", "*", "#", "##", "evaluate", ".", "assign", "(", "scope", ",", "value", ")", ":", "\\", "*", "Tries", "to", "assign", "the", "given", "`", "value", "`", "to", "the", "result", "of", "the", "compiled", "expression", "on", "the", "given", "`", "scope", "`", "and", "returns", "the", "result", "of", "the", "assignment", ".", "<", "br", "/", ">", "In", "the", "browser", "#", "#", "In", "the", "browser", "There", "is", "no", "`", "dist", "`", "build", "because", "it", "'", "s", "not", "2005", "anymore", ".", "Use", "a", "module", "bundler", "like", "[", "webpack", "]", "(", "http", ":", "//", "webpack", ".", "github", ".", "io", "/", ")", "or", "[", "browserify", "]", "(", "http", ":", "//", "browserify", ".", "org", "/", ").", "They", "'", "re", "both", "capable", "of", "CommonJS", "and", "AMD", ".", "<", "br", "/", ">", "Security", "#", "#", "Security", "The", "code", "of", "angular", "was", "not", "secured", "from", "reading", "prototype", ",", "and", "since", "version", "1", ".", "0", ".", "1", "of", "angular", "-", "expressions", ",", "the", "module", "disallows", "reading", "properties", "that", "are", "not", "ownProperties", ".", "See", "[", "this", "blog", "post", "]", "(", "http", ":", "//", "blog", ".", "angularjs", ".", "org", "/", "2016", "/", "09", "/", "angular", "-", "16", "-", "expression", "-", "sandbox", "-", "removal", ".", "html", ")", "for", "more", "details", "about", "the", "sandbox", "that", "got", "removed", "completely", "in", "angular", "1", ".", "6", ".", "Comment", "from", "`", "angular", ".", "js", "/", "src", "/", "ng", "/", "parse", ".", "js", "`", ":", "Angular", "expressions", "are", "generally", "considered", "safe", "because", "these", "expressions", "only", "have", "direct", "access", "to", "$", "scope", "and", "locals", ".", "However", ",", "one", "can", "obtain", "the", "ability", "to", "execute", "arbitrary", "JS", "code", "by", "access", "to", "\\", "$", "scope", "and", "locals", ".", "However", ",", "one", "can", "obtain", "the", "ability", "to", "execute", "arbitrary", "JS", "code", "by", "obtaining", "a", "reference", "to", "native", "JS", "functions", "such", "as", "the", "Function", "constructor", ".", "As", "an", "example", ",", "consider", "the", "following", "Angular", "expression", ":", "@", "@", "-", "180", ",", "16", "+", "177", ",", "13", "@", "@", "window", "or", "some", "DOM", "object", "that", "has", "a", "reference", "to", "window", "is", "published", "onto", "a", "Sco", "<", "br", "/", ">", "#", "#", "Authorship", "Authorship", "Kudos", "go", "entirely", "to", "the", "great", "angular", ".", "js", "team", ",", "it", "'", "s", "their", "implementation", "!", "<", "br", "/", ">", "Contributing", "#", "#", "Contributing", "Suggestions", "and", "bug", "-", "fixes", "are", "always", "appreciated", ".", "Don", "'", "t", "hesitate", "to", "create", "an", "issue", "or", "pull", "-", "request", ".", "All", "contributed", "code", "should", "pass", "@", "@", "-", "198", ",", "12", "+", "192", ",", "10", "@", "@", "Suggestions", "and", "bug", "-", "fixes", "are", "always", "appreciated", ".", "Don", "'", "t", "hesitate", "to", "create", "an", "is", "<", "br", "/", ">", "License", "#", "#", "License", "[", "Unlicense", "]", "(", "http", ":", "//", "unlicense", ".", "org", "/", ")", "Sponsors", "#", "#", "Sponsors", "[", "<", "img", "src", "=", "\"", "https", ":", "//", "assets", ".", "peerigon", ".", "com", "/", "peerigon", "/", "logo", "/", "peerigon", "-", "logo", "-", "flat", "-", "spinat", ".", "png", "\"", "width", "=", "\"", "150", "\"", "/", ">]", "(", "https", ":", "//", "peerigon", ".", "com", ")", "@", "@", "-", "6", ",", "24", "+", "6", ",", "29", "@", "@", "var", "filters", "=", "{", "};", "var", "Lexer", "=", "parse", ".", "Lexer", ";", "var", "Parser", "=", "parse", ".", "Parser", ";", "var", "parserOptions", "=", "{", "csp", ":", "false", ",", "/", "/", "noUnsafeEval", ",", "expensiveChecks", ":", "true", ",", "literals", ":", "{", "/", "/", "defined", "at", ":", "function", "$", "ParseProvider", "(", ")", "{", "true", ":", "true", ",", "false", ":", "false", ",", "null", ":", "null", ",", "/", "*", "eslint", "no", "-", "undefined", ":", "0", "*", "/", "undefined", ":", "undefined", "/", "*", "eslint", ":", "no", "-", "undefined", ":", "1", "*", "/", "}", "/", "/", "isIdentifierStart", ":", "undefined", ",", "/", "/", "isFunction", "(", "identStart", ")", "&", "&", "identStart", ",", "/", "/", "isIdentifierContinue", ":", "undefined", "/", "/", "isFunction", "(", "identContinue", ")", "&", "&", "identContinue", "csp", ":", "false", ",", "/", "/", "noUnsafeEval", ",", "expensiveChecks", ":", "true", ",", "literals", ":", "{", "/", "/", "defined", "at", ":", "function", "$", "ParseProvider", "(", ")", "{", "true", ":", "true", ",", "false", ":", "false", ",", "null", ":", "null", ",", "/", "*", "eslint", "no", "-", "undefined", ":", "0", "*", "/", "undefined", ":", "undefined", "/", "*", "eslint", ":", "no", "-", "undefined", ":", "1", "*", "/", "}", "/", "/", "isIdentifierStart", ":", "undefined", ",", "/", "/", "isFunction", "(", "identStart", ")", "&", "&", "identStart", ",", "/", "/", "isIdentifierContinue", ":", "undefined", "/", "/", "isFunction", "(", "identContinue", ")", "&", "&", "identContinue", "}", ";", "var", "lexer", "=", "new", "Lexer", "(", "{}", ");", "var", "parser", "=", "new", "Parser", "(", "lexer", ",", "function", "getFilter", "(", "name", ")", "{", "return", "filters", "[", "name", "]", ";", "}", ",", "parserOptions", ")", ";", "var", "parser", "=", "new", "Parser", "(", "lexer", ",", "function", "getFilter", "(", "name", ")", "{", "return", "filters", "[", "name", "]", ";", "}", ",", "parserOptions", ")", ";", "/", "**", "*", "Compiles", "src", "and", "returns", "a", "function", "that", "executes", "src", "on", "a", "target", "object", ".", "@", "@", "-", "33", ",", "22", "+", "38", ",", "24", "@", "@", "var", "parser", "=", "new", "Parser", "(", "lexer", ",", "function", "getFilter", "(", "name", ")", "{", "*", "@", "returns", "{", "function", "}", "*", "/", "function", "compile", "(", "src", ")", "{", "var", "cached", ";", "var", "cached", ";", "if", "(", "typeof", "src", "!", "==", "\"", "string", "\"", ")", "{", "throw", "new", "TypeError", "(", "\"", "src", "must", "be", "a", "string", ",", "instead", "saw", "'", "\"", "+", "typeof", "src", "+", "\"", "'\"", ");", "}", "if", "(", "typeof", "src", "!", "==", "\"", "string", "\"", ")", "{", "throw", "new", "TypeError", "(", "\"", "src", "must", "be", "a", "string", ",", "instead", "saw", "'", "\"", "+", "typeof", "src", "+", "\"", "'\"", ")", ";", "}", "if", "(", "!", "compile", ".", "cache", ")", "{", "return", "parser", ".", "parse", "(", "src", ")", ";", "}", "if", "(", "!", "compile", ".", "cache", ")", "{", "return", "parser", ".", "parse", "(", "src", ")", ";", "}", "cached", "=", "compile", ".", "cache", "[", "src", "]", ";", "if", "(", "!", "cached", ")", "{", "cached", "=", "compile", ".", "cache", "[", "src", "]", "=", "parser", ".", "parse", "(", "src", ")", ";", "}", "cached", "=", "compile", ".", "cache", "[", "src", "]", ";", "if", "(", "!", "cached", ")", "{", "cached", "=", "compile", ".", "cache", "[", "src", "]", "=", "parser", ".", "parse", "(", "src", ")", ";", "}", "return", "cached", ";", "return", "cached", ";", "}", "/", "**", "@", "@", "-", "57", ",", "7", "+", "64", ",", "7", "@", "@", "function", "compile", "(", "src", ")", "{", "*", "*", "@", "type", "{", "object", "}", "*", "/", "compile", ".", "cache", "=", "{", "};", "compile", ".", "cache", "=", "Object", ".", "create", "(", "null", ")", ";", "exports", ".", "Lexer", "=", "Lexer", ";", "exports", ".", "Parser", "=", "Parser", ";", "@", "@", "-", "5", ",", "8", "+", "5", ",", "8", "@", "@", "\"", "main", "\"", ":", "\"", "./", "lib", "/", "main", ".", "js", "\"", ",", "\"", "scripts", "\"", ":", "{", "\"", "test", "\"", ":", "\"", "mocha", "test", "/", "main", ".", "test", ".", "js", "-", "R", "spec", "\"", ",", "\"", "test", "-", "browser", "\"", ":", "\"", "webpack", "-", "dev", "-", "server", "mocha", "\\", "\\!", "./", "test", "/", "main", ".", "test", ".", "js", "-", "d", "\"", ",", "\"", "posttest", "\"", ":", "\"", "eslint", "-", "-", "fix", "lib", "test", "\"", "\"", "test", "-", "browser", "\"", ":", "\"", "webpack", "-", "dev", "-", "server", "'", "mocha", "-", "loader", "!", "./", "test", "/", "main", ".", "test", ".", "js", "'", "-", "-", "output", "-", "filename", "output", ".", "js", "-", "-", "port", "8081", "\"", ",", "\"", "posttest", "\"", ":", "\"", "eslint", "-", "-", "fix", "lib", "test", "&", "&", "prettier", "-", "-", "write", "lib", "/", "*.", "js", "test", "/", "*.", "js", "\"", "}", ",", "\"", "keywords", "\"", ":", "[", "\"", "angular", "\"", ",", "@", "@", "-", "20", ",", "11", "+", "20", ",", "13", "@", "@", "\"", "dependencies", "\"", ":", "{", "},", "\"", "devDependencies", "\"", ":", "{", "\"", "chai", "\"", ":", "\"", "^", "3", ".", "2", ".", "0", "\"", ",", "\"", "eslint", "\"", ":", "\"", "^", "1", ".", "5", ".", "0", "\"", ",", "\"", "eslint", "-", "config", "-", "peerigon", "\"", ":", "\"", "^", "0", ".", "1", ".", "0", "\"", ",", "\"", "mocha", "\"", ":", "\"", "^", "2", ".", "3", ".", "2", "\"", ",", "\"", "mocha", "-", "loader", "\"", ":", "\"", "^", "0", ".", "7", ".", "1", "\"", ",", "\"", "webpack", "-", "dev", "-", "server", "\"", ":", "\"", "^", "1", ".", "11", ".", "0", "\"", "\"", "eslint", "\"", ":", "\"", "^", "5", ".", "16", ".", "0", "\"", ",", "\"", "mocha", "\"", ":", "\"", "^", "7", ".", "0", ".", "0", "\"", ",", "\"", "mocha", "-", "loader", "\"", ":", "\"", "^", "4", ".", "0", ".", "1", "\"", ",", "\"", "prettier", "\"", ":", "\"", "^", "1", ".", "19", ".", "1", "\"", ",", "\"", "webpack", "\"", ":", "\"", "^", "4", ".", "41", ".", "5", "\"", ",", "\"", "webpack", "-", "cli", "\"", ":", "\"", "^", "3", ".", "3", ".", "10", "\"", ",", "\"", "webpack", "-", "dev", "-", "server", "\"", ":", "\"", "^", "3", ".", "10", ".", "1", "\"", "}", ",", "\"", "repository", "\"", ":", "{", "\"", "type", "\"", ":", "\"", "git", "\"", ",", "@", "@", "-", "1", ",", "3", "+", "0", ",", "0", "@", "@", "{", "\"", "extends", "\"", ":", "\"", "peerigon", "/", "es5tests", "\"", "}", "@", "@", "-", "9", ",", "466", "+", "9", ",", "473", "@", "@", "chai", ".", "config", ".", "includeStack", "=", "true", ";", "/", "/", "These", "tests", "make", "no", "claim", "to", "be", "complete", ".", "We", "only", "test", "the", "most", "important", "parts", "of", "angular", "expressions", ".", "/", "/", "I", "hope", "they", "have", "their", "own", "tests", ";", ")", "describe", "(", "\"", "expressions", "\"", ",", "function", "(", ")", "{", "describe", "(", "\".", "Lexer", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "Lexer", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "provide", "a", ".", "lex", "(", ")-", "method", "\"", ",", "function", "(", ")", "{", "var", "lexer", "=", "new", "expressions", ".", "Lexer", "(", ");", "expect", "(", "lexer", ".", "lex", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "}", ");", "describe", "(", "\".", "Parser", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "Parser", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "provide", "a", ".", "parse", "(", ")-", "method", "\"", ",", "function", "(", ")", "{", "var", "parser", "=", "new", "expressions", ".", "Parser", "(", "undefined", ",", "undefined", ",", "{", "})", ";", "expect", "(", "parser", ".", "parse", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "}", ");", "describe", "(", "\".", "compile", "(", "src", ")", "\",", "function", "(", ")", "{", "var", "scope", ";", "var", "evaluate", ";", "beforeEach", "(", "function", "(", ")", "{", "scope", "=", "{", "ship", ":", "{", "pirate", ":", "{", "name", ":", "\"", "Jenny", "\"", "}", "}", "}", ";", "}", ");", "it", "(", "\"", "should", "return", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"\"", "))", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "throw", "an", "error", "if", "the", "given", "value", "is", "not", "a", "string", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", ");", "}", ").", "to", ".", "throw", "(", "\"", "src", "must", "be", "a", "string", ",", "instead", "saw", "'", "undefined", "'", "\")", ";", "}", ");", "it", "(", "\"", "should", "expose", "the", "ast", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"", "tmp", "\"", ").", "ast", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "object", "\"", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "literals", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "null", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "null", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "null", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "true", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "true", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "false", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "false", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "2", ".", "34e5", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "2", ".", "34e5", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "2", ".", "34e5", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "'", "string", "'", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"'", "string", "'", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "string", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "[", "ship", ",", "1", ",", "2", ",", "[", "]]", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"[", "ship", ",", "1", ",", "2", ",", "[", "]]", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "[", "scope", ".", "ship", ",", "1", ",", "2", ",", "[", "]]", ");", "}", ");", "it", "(", "\"", "should", "return", "{", "test", ":", "'", "value", "'", ",", "'", "new", "-", "object", "'", ":", "{", "}", "}", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"{", "test", ":", "'", "value", "'", ",", "'", "new", "-", "object", "'", ":", "{", "}", "}", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "{", "test", ":", "\"", "value", "\"", ",", "\"", "new", "-", "object", "\"", ":", "{", "}", "}", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "simple", "key", "look", "-", "ups", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "notDefined", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "scope", "even", "when", "the", "'", "this", "'", "keyword", "is", "used", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "this", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "simple", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "set", "the", "new", "value", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "newValue", "=", "'", "new", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "newValue", ")", ".", "to", ".", "equal", "(", "\"", "new", "\"", ");", "}", ");", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", "=", "'", "ship", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ship", ")", ".", "to", ".", "equal", "(", "\"", "ship", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "dot", "-", "notated", "loop", "-", "ups", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", ".", "pirate", ".", "name", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "Jenny", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "island", ".", "pirate", ".", "name", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "dot", "-", "notated", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "set", "the", "new", "value", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "island", ".", "pirate", ".", "name", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "island", ".", "pirate", ".", "name", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", ".", "pirate", ".", "name", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ship", ".", "pirate", ".", "name", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "array", "look", "-", "ups", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "\"", "Jenny", "\"", "}", ",", "{", "pirate", ":", "\"", "St", "\u00f6", "rtebeker", "\"", "}", "]", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "1", "]", ".", "pirate", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "2", "]", ".", "pirate", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "array", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "\"", "Jenny", "\"", "}", "]", ";", "evaluate", "=", "compile", "(", "\"", "ships", "[", "0", "]", ".", "pirate", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ships", "[", "0", "]", ".", "pirate", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "function", "calls", "\"", ",", "function", "(", ")", "{", "describe", "(", "\"", "using", "no", "arguments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "function", "'", "s", "return", "value", "\"", ",", "function", "(", ")", "{", "scope", ".", "findPirate", "=", "function", "(", ")", "{", "return", "scope", ".", "ship", ".", "pirate", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "findPirate", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ".", "pirate", ")", ";", "}", ");", "it", "(", "\"", "should", "call", "the", "function", "on", "the", "scope", "\"", ",", "function", "(", ")", "{", "scope", ".", "returnThis", "=", "function", "(", ")", "{", "return", "this", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "returnThis", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ")", ";", "}", ");", "it", "(", "\"", "should", "call", "the", "function", "on", "the", "object", "where", "it", "is", "defined", "\"", ",", "function", "(", ")", "{", "scope", ".", "ship", ".", "returnThis", "=", "function", "(", ")", "{", "return", "this", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "ship", ".", "returnThis", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "using", "arguments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "parse", "the", "arguments", "accordingly", "\"", ",", "function", "(", ")", "{", "scope", ".", "findPirate", "=", "function", "(", "pirate", ")", "{", "return", "Array", ".", "prototype", ".", "slice", ".", "call", "(", "arguments", ")", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "findPirate", "(", "ship", ".", "pirate", ",", "1", ",", "[", "2", ",", "3", "]", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "[", "scope", ".", "ship", ".", "pirate", ",", "1", ",", "[", "2", ",", "3", "]", "])", ";", "}", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "operators", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "+", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "1", "+", "1", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "2", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "-", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "1", "-", "1", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "0", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "*", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "2", "*", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "4", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "/", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "4", "/", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "2", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "%", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "3", "%", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "1", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "&", "&\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "&", "&", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "true", "&", "&", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "evaluate", "=", "compile", "(", "\"", "false", "&", "&", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "|", "|\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "|", "|", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "true", "|", "|", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "false", "|", "|", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "!", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"!", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "evaluate", "=", "compile", "(", "\"!", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "}", ");", "/", "*", "Ooops", ",", "angular", "doesn", "'", "t", "support", "+", "+.", "Maybe", "someday", "?", "describe", "(", "\"", "expressions", "\"", ",", "function", "(", ")", "{", "describe", "(", "\".", "Lexer", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "Lexer", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "provide", "a", ".", "lex", "(", ")-", "method", "\"", ",", "function", "(", ")", "{", "var", "lexer", "=", "new", "expressions", ".", "Lexer", "(", ");", "expect", "(", "lexer", ".", "lex", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "}", ");", "describe", "(", "\".", "Parser", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "Parser", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "provide", "a", ".", "parse", "(", ")-", "method", "\"", ",", "function", "(", ")", "{", "var", "parser", "=", "new", "expressions", ".", "Parser", "(", "undefined", ",", "undefined", ",", "{", "})", ";", "expect", "(", "parser", ".", "parse", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "}", ");", "describe", "(", "\".", "compile", "(", "src", ")", "\",", "function", "(", ")", "{", "var", "scope", ";", "var", "evaluate", ";", "beforeEach", "(", "function", "(", ")", "{", "scope", "=", "{", "ship", ":", "{", "pirate", ":", "{", "name", ":", "\"", "Jenny", "\"", "}", "}", "}", ";", "}", ");", "it", "(", "\"", "should", "return", "a", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"\"", "))", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "}", ");", "it", "(", "\"", "should", "throw", "an", "error", "if", "the", "given", "value", "is", "not", "a", "string", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", ");", "}", ").", "to", ".", "throw", "(", "\"", "src", "must", "be", "a", "string", ",", "instead", "saw", "'", "undefined", "'", "\")", ";", "}", ");", "it", "(", "\"", "should", "expose", "the", "ast", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"", "tmp", "\"", ").", "ast", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "object", "\"", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "literals", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "null", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "null", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "null", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "true", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "true", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "false", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "false", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "2", ".", "34e5", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "2", ".", "34e5", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "2", ".", "34e5", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "'", "string", "'", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"'", "string", "'", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "string", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "[", "ship", ",", "1", ",", "2", ",", "[", "]]", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"[", "ship", ",", "1", ",", "2", ",", "[", "]]", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "[", "scope", ".", "ship", ",", "1", ",", "2", ",", "[", "]]", ");", "}", ");", "it", "(", "\"", "should", "return", "{", "test", ":", "'", "value", "'", ",", "'", "new", "-", "object", "'", ":", "{", "}", "}", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"{", "test", ":", "'", "value", "'", ",", "'", "new", "-", "object", "'", ":", "{", "}", "}", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "{", "test", ":", "\"", "value", "\"", ",", "\"", "new", "-", "object", "\"", ":", "{", "}", "}", ");", "}", ");", "it", "(", "\"", "should", "return", "context", "value", "when", "nothing", "in", "the", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "test", "\"", ");", "expect", "(", "evaluate", "(", "scope", ",", "{", "test", ":", "\"", "hello", "\"", "}", "))", ".", "to", ".", "equal", "(", "\"", "hello", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "context", "value", "when", "something", "in", "the", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "test", "\"", ");", "expect", "(", "evaluate", "(", "{", "test", ":", "\"", "bye", "\"", "}", ",", "{", "test", ":", "\"", "hello", "\"", "}", "))", ".", "to", ".", "equal", "(", "\"", "hello", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "simple", "key", "look", "-", "ups", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "notDefined", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "scope", "even", "when", "the", "'", "this", "'", "keyword", "is", "used", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "this", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "simple", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "set", "the", "new", "value", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "newValue", "=", "'", "new", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "newValue", ")", ".", "to", ".", "equal", "(", "\"", "new", "\"", ");", "}", ");", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", "=", "'", "ship", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ship", ")", ".", "to", ".", "equal", "(", "\"", "ship", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "dot", "-", "notated", "loop", "-", "ups", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", ".", "pirate", ".", "name", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "Jenny", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "island", ".", "pirate", ".", "name", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "dot", "-", "notated", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "set", "the", "new", "value", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "island", ".", "pirate", ".", "name", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "island", ".", "pirate", ".", "name", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ship", ".", "pirate", ".", "name", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ship", ".", "pirate", ".", "name", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "array", "look", "-", "ups", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "\"", "Jenny", "\"", "}", ",", "{", "pirate", ":", "\"", "St", "\u00f6", "rtebeker", "\"", "}", "];", "}", ");", "it", "(", "\"", "should", "return", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "1", "]", ".", "pirate", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "it", "(", "\"", "should", "return", "undefined", "instead", "of", "throwing", "a", "ReferenceError", "if", "it", "'", "s", "not", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "2", "]", ".", "pirate", "\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "undefined", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "array", "assignments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "change", "the", "value", "if", "its", "defined", "on", "scope", "\"", ",", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "\"", "Jenny", "\"", "}", "];", "evaluate", "=", "compile", "(", "\"", "ships", "[", "0", "]", ".", "pirate", "=", "'", "St", "\u00f6", "rtebeker", "'", "\")", ";", "evaluate", "(", "scope", ")", ";", "expect", "(", "scope", ".", "ships", "[", "0", "]", ".", "pirate", ")", ".", "to", ".", "equal", "(", "\"", "St", "\u00f6", "rtebeker", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "function", "calls", "\"", ",", "function", "(", ")", "{", "describe", "(", "\"", "using", "no", "arguments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "function", "'", "s", "return", "value", "\"", ",", "function", "(", ")", "{", "scope", ".", "findPirate", "=", "function", "(", ")", "{", "return", "scope", ".", "ship", ".", "pirate", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "findPirate", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ".", "pirate", ")", ";", "}", ");", "it", "(", "\"", "should", "call", "the", "function", "on", "the", "scope", "\"", ",", "function", "(", ")", "{", "scope", ".", "returnThis", "=", "function", "(", ")", "{", "return", "this", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "returnThis", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ")", ";", "}", ");", "it", "(", "\"", "should", "call", "the", "function", "on", "the", "object", "where", "it", "is", "defined", "\"", ",", "function", "(", ")", "{", "scope", ".", "ship", ".", "returnThis", "=", "function", "(", ")", "{", "return", "this", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "ship", ".", "returnThis", "(", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "scope", ".", "ship", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "using", "arguments", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "parse", "the", "arguments", "accordingly", "\"", ",", "function", "(", ")", "{", "scope", ".", "findPirate", "=", "function", "(", ")", "{", "return", "Array", ".", "prototype", ".", "slice", ".", "call", "(", "arguments", ")", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "findPirate", "(", "ship", ".", "pirate", ",", "1", ",", "[", "2", ",", "3", "]", ")\"", ");", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "eql", "(", "[", "scope", ".", "ship", ".", "pirate", ",", "1", ",", "[", "2", ",", "3", "]", "])", ";", "}", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "operators", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "+", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "1", "+", "1", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "2", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "-", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "1", "-", "1", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "0", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "*", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "2", "*", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "4", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "/", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "4", "/", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "2", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "%", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "3", "%", "2", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "1", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "&", "&\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "&", "&", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "true", "&", "&", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "evaluate", "=", "compile", "(", "\"", "false", "&", "&", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "|", "|\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "|", "|", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "true", "|", "|", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "evaluate", "=", "compile", "(", "\"", "false", "|", "|", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "!", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"!", "true", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "false", ")", ";", "evaluate", "=", "compile", "(", "\"!", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "true", ")", ";", "}", ");", "/", "*", "Ooops", ",", "angular", "doesn", "'", "t", "support", "+", "+.", "Maybe", "someday", "?", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "+", "+\"", ",", "function", "(", ")", "{", "scope", ".", "value", "=", "2", ";", "evaluate", "=", "compile", "(", "\"", "value", "+", "+\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "3", ")", ";", "expect", "(", "scope", ".", "value", ")", ".", "to", ".", "equal", "(", "3", ")", ";", "}", ");", "*/", "/", "*", "Ooops", ",", "angular", "doesn", "'", "t", "support", "-", "-.", "Maybe", "someday", "?", "/", "*", "Ooops", ",", "angular", "doesn", "'", "t", "support", "-", "-.", "Maybe", "someday", "?", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "-", "-\"", ",", "function", "(", ")", "{", "scope", ".", "value", "=", "2", ";", "evaluate", "=", "compile", "(", "\"", "value", "-", "-\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "1", ")", ";", "expect", "(", "scope", ".", "value", ")", ".", "to", ".", "equal", "(", "1", ")", ";", "}", ");", "*/", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "?", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "?", "'", "it", "works", "'", ":", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "\"", "it", "works", "\"", ");", "evaluate", "=", "compile", "(", "\"", "false", "?", "false", ":", "'", "it", "works", "'", "\")", ";", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "\"", "it", "works", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "using", "complex", "expressions", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "function", "(", "str", ")", "{", "return", "str", ";", "}", "}", ",", "{", "pirate", ":", "function", "(", "str", ")", "{", "return", "str", ";", "}", "}", "]", ";", "scope", ".", "index", "=", "0", ";", "scope", ".", "pi", "=", "\"", "pi", "\"", ";", "scope", ".", "Jenny", "=", "\"", "Jenny", "\"", ";", "}", ");", "it", "(", "\"", "should", "still", "be", "parseable", "and", "executable", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "index", "]", "[", "pi", "+", "'", "rate", "'", "](", "Jenny", ")", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "Jenny", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "syntactical", "errors", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "give", "a", "readable", "error", "message", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", "\"'", "unterminated", "string", "\"", ");", "}", ").", "to", ".", "throw", "(", "\"", "Lexer", "Error", ":", "Unterminated", "quote", "at", "columns", "0", "-", "20", "[", "'", "unterminated", "string", "]", "in", "expression", "[", "'", "unterminated", "string", "]", ".\"", ");", "}", ");", "it", "(", "\"", "should", "give", "a", "readable", "error", "message", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", "\"", "3", "=", "4", "\"", ");", "}", ").", "to", ".", "throw", "(", "\"[", "$", "parse", ":", "lval", "]", "Trying", "to", "assign", "a", "value", "to", "a", "non", "l", "-", "value", "\\", "nhttp", ":", "//", "errors", ".", "angularjs", ".", "org", "/", "\\\"", "NG_VERSION_FULL", "\\", "\"/", "$", "parse", "/", "lval", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "using", "filters", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "apply", "the", "given", "filter", "\"", ",", "function", "(", ")", "{", "expressions", ".", "filters", ".", "currency", "=", "function", "(", "input", ",", "currency", ",", "digits", ")", "{", "input", "=", "input", ".", "toFixed", "(", "digits", ")", ";", "if", "(", "currency", "=", "==", "\"", "EUR", "\"", ")", "{", "return", "input", "+", "\"", "\u20ac\"", ";", "}", "return", "input", "+", "\"", "$\"", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "1", ".", "2345", "|", "currency", ":", "selectedCurrency", ":", "2", "\"", ");", "expect", "(", "evaluate", "(", "{", "selectedCurrency", ":", "\"", "EUR", "\"", "}", "))", ".", "to", ".", "equal", "(", "\"", "1", ".", "23", "\u20ac", "\")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "the", "same", "expression", "multiple", "times", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "cache", "the", "generated", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"", "a", "\"", "))", ".", "to", ".", "equal", "(", "compile", "(", "\"", "a", "\"", "))", ";", "}", ");", "}", ");", "describe", "(", "\"", "for", "assigning", "values", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", "=", "{", "};", "}", ");", "it", "(", "\"", "should", "expose", "an", "'", "assign", "'", "-", "function", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "\"", ");", "expect", "(", "fn", ".", "assign", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "describe", "(", "\"", "the", "'", "assign", "'", "-", "function", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "work", "for", "expressions", "ending", "with", "brackets", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", ".", "b", "[", "'", "c", "'", "]\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "work", "for", "expressions", "with", "brackets", "in", "the", "middle", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "[", "\\\"", "b", "\\", "\"]", ".", "c", "\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "work", "for", "expressions", "with", "brackets", "in", "the", "middle", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "[", "\\\"", "b", "\\", "\"]", ".", "c", "\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "result", "of", "the", "assignment", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "[", "\\\"", "b", "\\", "\"]", ".", "c", "\"", ");", "expect", "(", "fn", ".", "assign", "(", "scope", ",", "123", ")", ").", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "}", ");", "}", ");", "describe", "(", "\".", "cache", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "an", "object", "by", "default", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", ".", "cache", ")", ".", "to", ".", "be", ".", "an", "(", "\"", "object", "\"", ");", "}", ");", "it", "(", "\"", "should", "cache", "the", "generated", "function", "by", "the", "expression", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "\"", ");", "expect", "(", "compile", ".", "cache", ".", "a", ")", ".", "to", ".", "equal", "(", "fn", ")", ";", "}", ");", "describe", "(", "\"", "when", "setting", "it", "to", "false", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "disable", "the", "cache", "\"", ",", "function", "(", ")", "{", "compile", ".", "cache", "=", "false", ";", "expect", "(", "compile", "(", "\"", "a", "\"", "))", ".", "to", ".", "not", ".", "equal", "(", "compile", "(", "\"", "a", "\"", "))", ";", "compile", ".", "cache", "=", "{", "};", "}", ");", "}", ");", "}", ");", "}", ");", "describe", "(", "\".", "filters", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "an", "object", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "filters", ")", ".", "to", ".", "be", ".", "an", "(", "\"", "object", "\"", ");", "}", ");", "}", ");", "it", "(", "\"", "should", "return", "the", "expected", "result", "when", "using", "?", "\",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "true", "?", "'", "it", "works", "'", ":", "false", "\"", ");", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "\"", "it", "works", "\"", ");", "evaluate", "=", "compile", "(", "\"", "false", "?", "false", ":", "'", "it", "works", "'", "\")", ";", "expect", "(", "evaluate", "(", "))", ".", "to", ".", "equal", "(", "\"", "it", "works", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "using", "complex", "expressions", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", ".", "ships", "=", "[", "{", "pirate", ":", "function", "(", "str", ")", "{", "return", "str", ";", "}", "}", ",", "{", "pirate", ":", "function", "(", "str", ")", "{", "return", "str", ";", "}", "}", "]", ";", "scope", ".", "index", "=", "0", ";", "scope", ".", "pi", "=", "\"", "pi", "\"", ";", "scope", ".", "Jenny", "=", "\"", "Jenny", "\"", ";", "}", ");", "it", "(", "\"", "should", "still", "be", "parseable", "and", "executable", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "ships", "[", "index", "]", "[", "pi", "+", "'", "rate", "'", "](", "Jenny", ")", "\")", ";", "expect", "(", "evaluate", "(", "scope", ")", ").", "to", ".", "equal", "(", "\"", "Jenny", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "syntactical", "errors", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "give", "a", "readable", "error", "message", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", "\"'", "unterminated", "string", "\"", ");", "}", ").", "to", ".", "throw", "(", "\"", "Lexer", "Error", ":", "Unterminated", "quote", "at", "columns", "0", "-", "20", "[", "'", "unterminated", "string", "]", "in", "expression", "[", "'", "unterminated", "string", "]", ".\"", ")", ";", "}", ");", "it", "(", "\"", "should", "give", "a", "readable", "error", "message", "\"", ",", "function", "(", ")", "{", "expect", "(", "function", "(", ")", "{", "compile", "(", "\"", "3", "=", "4", "\"", ");", "}", ").", "to", ".", "throw", "(", "'", "[$", "parse", ":", "lval", "]", "Trying", "to", "assign", "a", "value", "to", "a", "non", "l", "-", "value", "\\", "nhttp", ":", "//", "errors", ".", "angularjs", ".", "org", "/", "\"", "NG_VERSION_FULL", "\"", "/$", "parse", "/", "lval", "'", ")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "using", "filters", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "apply", "the", "given", "filter", "\"", ",", "function", "(", ")", "{", "expressions", ".", "filters", ".", "currency", "=", "function", "(", "input", ",", "currency", ",", "digits", ")", "{", "input", "=", "input", ".", "toFixed", "(", "digits", ")", ";", "if", "(", "currency", "=", "==", "\"", "EUR", "\"", ")", "{", "return", "input", "+", "\"", "\u20ac\"", ";", "}", "return", "input", "+", "\"", "$\"", ";", "}", ";", "evaluate", "=", "compile", "(", "\"", "1", ".", "2345", "|", "currency", ":", "selectedCurrency", ":", "2", "\"", ");", "expect", "(", "evaluate", "(", "{", "selectedCurrency", ":", "\"", "EUR", "\"", "}", ")", ")", ".", "to", ".", "equal", "(", "\"", "1", ".", "23", "\u20ac", "\")", ";", "}", ");", "}", ");", "describe", "(", "\"", "when", "evaluating", "the", "same", "expression", "multiple", "times", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "cache", "the", "generated", "function", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", "(", "\"", "a", "\"", "))", ".", "to", ".", "equal", "(", "compile", "(", "\"", "a", "\"", "))", ";", "}", ");", "}", ");", "describe", "(", "\"", "for", "assigning", "values", "\"", ",", "function", "(", ")", "{", "beforeEach", "(", "function", "(", ")", "{", "scope", "=", "{", "};", "}", ");", "it", "(", "\"", "should", "expose", "an", "'", "assign", "'", "-", "function", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "\"", ");", "expect", "(", "fn", ".", "assign", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "describe", "(", "\"", "the", "'", "assign", "'", "-", "function", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "work", "for", "expressions", "ending", "with", "brackets", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", ".", "b", "[", "'", "c", "'", "]\"", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "work", "for", "expressions", "with", "brackets", "in", "the", "middle", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "'", "a", "[", "\"", "b", "\"", "].", "c", "'", ");", "fn", ".", "assign", "(", "scope", ",", "123", ")", ";", "expect", "(", "scope", ".", "a", ".", "b", ".", "c", ")", ".", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "it", "(", "\"", "should", "return", "the", "result", "of", "the", "assignment", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "'", "a", "[", "\"", "b", "\"", "].", "c", "'", ");", "expect", "(", "fn", ".", "assign", "(", "scope", ",", "123", ")", ").", "to", ".", "equal", "(", "123", ")", ";", "}", ");", "}", ");", "}", ");", "describe", "(", "\".", "cache", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "an", "object", "by", "default", "\"", ",", "function", "(", ")", "{", "expect", "(", "compile", ".", "cache", ")", ".", "to", ".", "be", ".", "an", "(", "\"", "object", "\"", ");", "}", ");", "it", "(", "\"", "should", "cache", "the", "generated", "function", "by", "the", "expression", "\"", ",", "function", "(", ")", "{", "var", "fn", "=", "compile", "(", "\"", "a", "\"", ");", "expect", "(", "compile", ".", "cache", ".", "a", ")", ".", "to", ".", "equal", "(", "fn", ")", ";", "}", ");", "describe", "(", "\"", "when", "setting", "it", "to", "false", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "disable", "the", "cache", "\"", ",", "function", "(", ")", "{", "compile", ".", "cache", "=", "false", ";", "expect", "(", "compile", "(", "\"", "a", "\"", "))", ".", "to", ".", "not", ".", "equal", "(", "compile", "(", "\"", "a", "\"", "))", ";", "compile", ".", "cache", "=", "Object", ".", "create", "(", "null", ")", ";", "}", ");", "}", ");", "}", ");", "}", ");", "describe", "(", "\".", "filters", "\"", ",", "function", "(", ")", "{", "it", "(", "\"", "should", "be", "an", "object", "\"", ",", "function", "(", ")", "{", "expect", "(", "expressions", ".", "filters", ")", ".", "to", ".", "be", ".", "an", "(", "\"", "object", "\"", ");", "}", ");", "}", ");", "describe", "(", "\"", "prototype", "\"", ",", "function", "(", ")", "{", "var", "evaluate", ";", "it", "(", "\"", "should", "not", "leak", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"'", "'.", "split", "\"", ");", "expect", "(", "evaluate", "(", "{}", "))", ".", "to", ".", "eql", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "not", "leak", "with", "computed", "prop", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "a", "[", "'", "split", "'", "]\"", ");", "expect", "(", "evaluate", "(", "{", "a", ":", "\"", "\"", "}", "))", ".", "to", ".", "eql", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "allow", "to", "read", "string", "length", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"'", "abc", "'", ".", "length", "\"", ");", "expect", "(", "evaluate", "(", "{}", "))", ".", "to", ".", "eql", "(", "3", ")", ";", "}", ");", "it", "(", "\"", "should", "allow", "to", "read", "users", "length", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "users", ".", "length", "\"", ");", "expect", "(", "evaluate", "(", "{", "users", ":", "[", "1", ",", "4", ",", "4", "]", "}", "))", ".", "to", ".", "eql", "(", "3", ")", ";", "}", ");", "/", "/", "it", "(", "\"", "should", "disallow", "from", "changing", "prototype", "\"", ",", "function", "(", ")", "{", "/", "/", "evaluate", "=", "compile", "(", "\"", "name", ".", "split", "=", "10", "\"", ");", "/", "/", "var", "scope", "=", "{", "name", ":", "\"", "hello", "\"", "}", ";", "/", "/", "evaluate", "(", "scope", ")", ";", "/", "/", "expect", "(", "scope", ".", "name", ".", "split", ")", ".", "to", ".", "be", ".", "a", "(", "\"", "function", "\"", ");", "/", "/", "}", ");", "/", "/", "/", "/", "it", "(", "\"", "should", "work", "with", "__proto__", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "__proto__", "\"", ");", "expect", "(", "evaluate", "(", "{}", "))", ".", "to", ".", "eql", "(", "undefined", ")", ";", "}", ");", "it", "(", "\"", "should", "work", "with", "toString", "\"", ",", "function", "(", ")", "{", "evaluate", "=", "compile", "(", "\"", "toString", "\"", ");", "expect", "(", "evaluate", "(", "{", "toString", ":", "10", "}", "))", ".", "to", ".", "eql", "(", "10", ")", ";", "}", ");", "}", ");", "}", ");"], "docstring_tokens": ["remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "15", ",", "10", "+", "15", ",", "6", "@", "@", "define", "(", "[", "\"", "sync", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "legacy", "\"", ",", "\"", "sync", ",", "ab", ",", "src", ",", "./", "dojo", ",", "legacy", "-", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "152", "-", "build", ",", "legacy", "\"", ",", "@", "@", "-", "31", ",", "10", "+", "27", ",", "6", "@", "@", "define", "(", "[", "\"", "sync", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "legacy", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "src", ",", "./", "dojo", ",", "legacy", "-", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "152", "-", "build", ",", "legacy", "\"", ",", "@", "@", "-", "47", ",", "10", "+", "39", ",", "6", "@", "@", "define", "(", "[", "\"", "sync", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "legacy", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "src", ",", "./", "dojo", ",", "legacy", "-", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "152", "-", "build", ",", "legacy", "\"", ",", "@", "@", "-", "63", ",", "10", "+", "51", ",", "6", "@", "@", "define", "(", "[", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "sync", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "@", "@", "-", "75", ",", "10", "+", "59", ",", "6", "@", "@", "define", "(", "[", "\"", "async", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "@", "@", "-", "88", ",", "10", "+", "68", ",", "6", "@", "@", "define", "(", "[", "\"", "async", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "@", "@", "-", "101", ",", "10", "+", "77", ",", "6", "@", "@", "define", "(", "[", "\"", "async", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "src", ",", "./", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "src", ",", "./", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "@", "@", "-", "113", ",", "11", "+", "85", ",", "7", "@", "@", "define", "(", "[", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "src", ",", "./", "i18n", "-", "test", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "/", "i18nTest", ",", "amd", "\"", ",", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "cdn", ",", "http", ":", "//", "192", ".", "168", ".", "1", ".", "114", "/", "dev", "/", "dtk", "/", "built", "-", "i18n", "-", "test", "/", "cdn", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", "];", "\"", "async", ",", "ab", "-", "cd", "-", "ef", ",", "rel", ",", "./", "built", "-", "i18n", "-", "test", "/", "rel", "/", "dojo", ",", "built", ",", "./", "built", "-", "i18n", "-", "test", "/", "built", "-", "with", "-", "layers", "-", "and", "-", "preloads", "/", "i18nTest", ",", "amd", "\"", "];", "for", "(", "var", "i", "=", "0", ";", "i", "<", "testParams", ".", "length", ";", "i", "+", "+)", "{", "doh", ".", "register", "(", "\"", "testsDOH", ".", "_base", ".", "i18nExhaustive", "\"", "+", "i", ",", "require", ".", "toUrl", "(", "\"", "dojo", "/", "main", "\"", ")", "+", "\"", "/.", "./", "..", "/", "i18n", "-", "test", "/", "unit", ".", "html", "?", "\"", "+", "testParams", "[", "i", "]", ");", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "<", "html", ">", "<", "!-", "-<", "html", ">", "<", "head", ">", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", "span", ".", "pass", "{", "background", "-", "color", ":", "green", "}", "@", "@", "-", "12", ",", "6", "+", "12", ",", "19", "@", "@", "/", "/#", "1", ",", ",", "src", ",", "./", "dojo", "\"", ",", "src", ",", "./", "dtk", "-", "i18n", "-", "test", "(", "function", "(", "){", "var", "escapes", "=", "{", "\"", "&\"", ":", "\"", "&", "amp", ";", "\",", "\"", "<\"", ":", "\"", "&", "lt", ";", "\",", "\"", ">\"", ":", "\"", "&", "gt", ";", "\",", "\"", "\\\"", "\":", "\"", "&", "quot", ";", "\",", "\"", "'\"", ":", "\"", "&#", "039", ";", "\"", "}", ";", "function", "escape", "(", "unsafe", ")", "{", "return", "unsafe", ".", "replace", "(", "/[", "&<", ">\"", "']", "/", "g", ",", "function", "(", "match", ")", "{", "return", "escapes", "[", "match", "]", ";", "}", ");", "}", "var", "hashInfo", "=", "location", ".", "search", ".", "substring", "(", "1", ")", ",", "options", "=", "hashInfo", ".", "split", "(", "\",", "\")", ";", "async", "=", "options", "[", "0", "]", "==", "\"", "async", "\"", "?", "true", ":", "undefined", ",", "@", "@", "-", "23", ",", "7", "+", "36", ",", "11", "@", "@", "testId", "=", "\"", "async", ":", "\"", "+", "async", "+", "\"", ",", "locale", ":", "\"", "+", "locale", "+", "\"", ",", "dojo", ":", "\"", "+", "dojoType", "+", "\"", ",", "i18nTest", ":", "\"", "+", "i18nTestType", "+", "\"", "(\"", "+", "hashInfo", "+", "\"", ")\"", ",", "testKind", "=", "options", "[", "6", "]", ";", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "+", "=", "hashInfo", ";", "if", "(", "(/", "^", "http", "/", "i", ")", ".", "test", "(", "i18nTestLocation", ")", ")", "{", "return", ";", "}", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "+", "=", "escape", "(", "hashInfo", ")", ";", "function", "report", "(", "result", ")", "{", "require", "(", "[\"", "doh", "\"", "],", "function", "(", "doh", ")", "{", "@", "@", "-", "39", ",", "7", "+", "56", ",", "7", "@", "@", "}", "else", "{", "text", "=", "\"", "<", "span", "class", "=", "'", "fail", "'", ">", "FAIL", "<", "/", "span", ">", ":", "\"", "+", "testId", "+", "\"", "<", "br", ">", "\"", "+", "result", ";", "}", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "=", "text", ";", "document", ".", "getElementById", "(", "\"", "status", "\"", ").", "innerHTML", "=", "escape", "(", "text", ")", ";", "}", "dojoConfig", "=", "{", "@", "@", "-", "85", ",", "10", "+", "102", ",", "11", "@", "@", "var", "node", "=", "document", ".", "createElement", "(", "\"", "script", "\"", ");", "node", ".", "type", "=", "\"", "text", "/", "javascript", "\"", ";", "node", ".", "charset", "=", "\"", "utf", "-", "8", "\"", ";", "node", ".", "src", "=", "(", "/^", "http", "/", ".", "test", "(", "dojoLocation", ")", "?", "dojoLocation", ":", "\"", "..", "/\"", "+", "dojoLocation", ")", "+", "\"", "/", "dojo", ".", "js", "\"", ";", "/", "/", "If", "a", "user", "passes", "a", "remote", "URL", ",", "force", "it", "to", "use", "the", "local", "dojo", "node", ".", "src", "=", "(", "(/", "^", "http", "/", "i", ")", ".", "test", "(", "dojoLocation", ")", "?", "'", "..", "/", "dojo", "'", ":", "\"", "..", "/\"", "+", "dojoLocation", ")", "+", "\"", "/", "dojo", ".", "js", "\"", ";", "console", ".", "log", "(", "node", ".", "src", ")", ";", "document", ".", "getElementsByTagName", "(", "\"", "head", "\"", ")[", "0", "]", ".", "appendChild", "(", "node", ")", ";", "}", ")(", ");", "<", "/", "script", ">", "<", "/", "body", ">", "<", "/", "html", ">", "<", "/", "html", ">", "--", ">", "@", "@", "-", "59", ",", "6", "+", "59", ",", "6", "@", "@", "The", "various", "built", "module", "and", "loaders", "are", "constructed", "by", "the", "v1", ".", "7", "builder", ".", "The", "sh", "i18n", "-", "test", "/", "build", "-", "test", "-", "targets", ".", "sh", "accomplishes", "this", "task", "automatically", ".", "A", "unit", "test", "html", "page", "is", "constructed", "at", "i18n", "-", "test", "/", "unit", ".", "html", ".", "Given", "a", "query", "string", ",", "it", "will", "load", "a", "particular", "loader", "and", "exercise", "a", "particular", "set", "of", "modules", ".", "exercise", "a", "particular", "set", "of", "modules", ".", "Its", "contents", "must", "be", "uncommented", "before", "running", "the", "tests", ".", "Finally", ",", "the", "DOH", "test", "dojo", "/", "testsDOH", "/", "_base", "/", "i18nExhaustive", "runs", "all", "the", "various", "combinations", "."], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "60", ",", "6", "+", "60", ",", "13", "@", "@", "#", "include", "<", "net", "/", "sock", ".", "h", ">", "#", "include", "<", "net", "/", "net_namespace", ".", "h", ">", "/", "*", "*", "To", "send", "multiple", "CAN", "frame", "content", "within", "TX_SETUP", "or", "to", "filter", "*", "CAN", "messages", "with", "multiplex", "index", "within", "RX_SETUP", ",", "the", "number", "of", "*", "different", "filters", "is", "limited", "to", "256", "due", "to", "the", "one", "byte", "index", "value", ".", "*", "/", "#", "define", "MAX_NFRAMES", "256", "/", "*", "use", "of", "last_frames", "[", "index", "]", ".", "can_dlc", "*", "/", "#", "define", "RX_RECV", "0x40", "/", "*", "received", "data", "for", "this", "element", "*", "/", "#", "define", "RX_THR", "0x80", "/", "*", "element", "not", "been", "sent", "due", "to", "throttle", "feature", "*", "/", "@", "@", "-", "89", ",", "16", "+", "96", ",", "16", "@", "@", "struct", "bcm_op", "{", "struct", "list_head", "list", ";", "int", "ifindex", ";", "canid_t", "can_id", ";", "int", "flags", ";", "u32", "flags", ";", "unsigned", "long", "frames_abs", ",", "frames_filtered", ";", "struct", "timeval", "ival1", ",", "ival2", ";", "struct", "hrtimer", "timer", ",", "thrtimer", ";", "struct", "tasklet_struct", "tsklet", ",", "thrtsklet", ";", "ktime_t", "rx_stamp", ",", "kt_ival1", ",", "kt_ival2", ",", "kt_lastmsg", ";", "int", "rx_ifindex", ";", "int", "count", ";", "int", "nframes", ";", "int", "currframe", ";", "u32", "count", ";", "u32", "nframes", ";", "u32", "currframe", ";", "struct", "can_frame", "*", "frames", ";", "struct", "can_frame", "*", "last_frames", ";", "struct", "can_frame", "sframe", ";", "@", "@", "-", "175", ",", "7", "+", "182", ",", "7", "@", "@", "static", "int", "bcm_proc_show", "(", "struct", "seq_file", "*", "m", ",", "void", "*", "v", ")", "seq_printf", "(", "m", ",", "\"", "rx_op", ":", "%", "03X", "%", "-", "5s", "\"", ",", "op", "-", ">", "can_id", ",", "bcm_proc_getifname", "(", "ifname", ",", "op", "-", ">", "ifindex", ")", ");", "seq_printf", "(", "m", ",", "\"", "[%", "d", "]", "%", "c", "\"", ",", "op", "-", ">", "nframes", ",", "seq_printf", "(", "m", ",", "\"", "[%", "u", "]", "%", "c", "\"", ",", "op", "-", ">", "nframes", ",", "(", "op", "-", ">", "flags", "&", "RX_CHECK_DLC", ")", "?'", "d", "'", ":'", "'", ");", "if", "(", "op", "-", ">", "kt_ival1", ".", "tv64", ")", "seq_printf", "(", "m", ",", "\"", "timeo", "=", "%", "lld", "\"", ",", "@", "@", "-", "198", ",", "7", "+", "205", ",", "7", "@", "@", "static", "int", "bcm_proc_show", "(", "struct", "seq_file", "*", "m", ",", "void", "*", "v", ")", "list_for_each_entry", "(", "op", ",", "&", "bo", "-", ">", "tx_ops", ",", "list", ")", "{", "seq_printf", "(", "m", ",", "\"", "tx_op", ":", "%", "03X", "%", "s", "[", "%", "d", "]", "\"", ",", "seq_printf", "(", "m", ",", "\"", "tx_op", ":", "%", "03X", "%", "s", "[", "%", "u", "]", "\"", ",", "op", "-", ">", "can_id", ",", "bcm_proc_getifname", "(", "ifname", ",", "op", "-", ">", "ifindex", ")", ",", "op", "-", ">", "nframes", ")", ";", "@", "@", "-", "283", ",", "7", "+", "290", ",", "7", "@", "@", "static", "void", "bcm_send_to_user", "(", "struct", "bcm_op", "*", "op", ",", "struct", "bcm_msg_head", "*", "head", ",", "struct", "can_frame", "*", "firstframe", ";", "struct", "sockaddr_can", "*", "addr", ";", "struct", "sock", "*", "sk", "=", "op", "-", ">", "sk", ";", "int", "datalen", "=", "head", "-", ">", "nframes", "*", "CFSIZ", ";", "unsigned", "int", "datalen", "=", "head", "-", ">", "nframes", "*", "CFSIZ", ";", "int", "err", ";", "skb", "=", "alloc_skb", "(", "sizeof", "(", "*", "head", ")", "+", "datalen", ",", "gfp_any", "(", "))", ";", "@", "@", "-", "468", ",", "7", "+", "475", ",", "7", "@", "@", "static", "void", "bcm_rx_update_and_send", "(", "struct", "bcm_op", "*", "op", ",", "*", "bcm_rx_cmp_to_index", "-", "(", "bit", ")", "compares", "the", "currently", "received", "data", "to", "formerly", "*", "received", "data", "stored", "in", "op", "-", ">", "last_frames", "[", "]", "*", "/", "static", "void", "bcm_rx_cmp_to_index", "(", "struct", "bcm_op", "*", "op", ",", "int", "index", ",", "static", "void", "bcm_rx_cmp_to_index", "(", "struct", "bcm_op", "*", "op", ",", "unsigned", "int", "index", ",", "const", "struct", "can_frame", "*", "rxdata", ")", "{", "/", "*", "@", "@", "-", "554", ",", "7", "+", "561", ",", "8", "@", "@", "static", "enum", "hrtimer_restart", "bcm_rx_timeout_handler", "(", "struct", "hrtimer", "*", "hrtimer", ")", "/", "*", "*", "bcm_rx_do_flush", "-", "helper", "for", "bcm_rx_thr_flush", "*", "/", "static", "inline", "int", "bcm_rx_do_flush", "(", "struct", "bcm_op", "*", "op", ",", "int", "update", ",", "int", "index", ")", "static", "inline", "int", "bcm_rx_do_flush", "(", "struct", "bcm_op", "*", "op", ",", "int", "update", ",", "unsigned", "int", "index", ")", "{", "if", "(", "(", "op", "-", ">", "last_frames", ")", "&", "&", "(", "op", "-", ">", "last_frames", "[", "index", "]", ".", "can_dlc", "&", "RX_THR", ")", ")", "{", "if", "(", "update", ")", "@", "@", "-", "575", ",", "7", "+", "583", ",", "7", "@", "@", "static", "int", "bcm_rx_thr_flush", "(", "struct", "bcm_op", "*", "op", ",", "int", "update", ")", "int", "updated", "=", "0", ";", "if", "(", "op", "-", ">", "nframes", ">", "1", ")", "{", "int", "i", ";", "unsigned", "int", "i", ";", "/", "*", "for", "MUX", "filter", "we", "start", "at", "index", "1", "*", "/", "for", "(", "i", "=", "1", ";", "i", "<", "op", "-", ">", "nframes", ";", "i", "+", "+)", "@", "@", "-", "624", ",", "7", "+", "632", ",", "7", "@", "@", "static", "void", "bcm_rx_handler", "(", "struct", "sk_buff", "*", "skb", ",", "void", "*", "data", ")", "{", "struct", "bcm_op", "*", "op", "=", "(", "struct", "bcm_op", "*", ")", "data", ";", "const", "struct", "can_frame", "*", "rxframe", "=", "(", "struct", "can_frame", "*", ")", "skb", "-", ">", "data", ";", "int", "i", ";", "unsigned", "int", "i", ";", "/", "*", "disable", "timeout", "*", "/", "hrtimer_cancel", "(", "&", "op", "-", ">", "timer", ")", ";", "@", "@", "-", "822", ",", "14", "+", "830", ",", "15", "@", "@", "static", "int", "bcm_tx_setup", "(", "struct", "bcm_msg_head", "*", "msg_head", ",", "struct", "msghdr", "*", "msg", ",", "{", "struct", "bcm_sock", "*", "bo", "=", "bcm_sk", "(", "sk", ")", ";", "struct", "bcm_op", "*", "op", ";", "int", "i", ",", "err", ";", "unsigned", "int", "i", ";", "int", "err", ";", "/", "*", "we", "need", "a", "real", "device", "to", "send", "frames", "*", "/", "if", "(", "!", "ifindex", ")", "return", "-", "ENODEV", ";", "/", "*", "we", "need", "at", "least", "one", "can_frame", "*", "/", "if", "(", "msg_head", "-", ">", "nframes", "<", "1", ")", "/", "*", "check", "nframes", "boundaries", "-", "we", "need", "at", "least", "one", "can_frame", "*", "/", "if", "(", "msg_head", "-", ">", "nframes", "<", "1", "|", "|", "msg_head", "-", ">", "nframes", ">", "MAX_NFRAMES", ")", "return", "-", "EINVAL", ";", "/", "*", "check", "the", "given", "can_id", "*", "/", "@", "@", "-", "993", ",", "6", "+", "1002", ",", "10", "@", "@", "static", "int", "bcm_rx_setup", "(", "struct", "bcm_msg_head", "*", "msg_head", ",", "struct", "msghdr", "*", "msg", ",", "msg_head", "-", ">", "nframes", "=", "0", ";", "}", "/", "*", "the", "first", "element", "contains", "the", "mux", "-", "mask", "=", ">", "MAX_NFRAMES", "+", "1", "*", "/", "if", "(", "msg_head", "-", ">", "nframes", ">", "MAX_NFRAMES", "+", "1", ")", "return", "-", "EINVAL", ";", "if", "(", "(", "msg_head", "-", ">", "flags", "&", "RX_RTR_FRAME", ")", "&", "&", "(", "(", "msg_head", "-", ">", "nframes", "!", "=", "1", ")", "|", "|", "(", "!(", "msg_head", "-", ">", "can_id", "&", "CAN_RTR_FLAG", ")", "))", ")"], "docstring_tokens": ["integer", "overflow"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "556", ",", "7", "+", "556", ",", "7", "@", "@", "static", "char", "*", "php_ap_basename", "(", "const", "zend_encoding", "*", "encoding", ",", "char", "*", "path", "TSRMLS_DC", "{", "char", "*", "s", "=", "strrchr", "(", "path", ",", "'", "\\\\", "')", ";", "char", "*", "s2", "=", "strrchr", "(", "path", ",", "'", "/'", ");", "if", "(", "s", "&", "&", "s2", ")", "{", "if", "(", "s", ">", "s2", ")", "{", "+", "+", "s", ";", "@", "@", "-", "942", ",", "6", "+", "942", ",", "10", "@", "@", "SAPI_API", "SAPI_POST_HANDLER_FUNC", "(", "rfc1867_post_handler", ")", "/", "*", "{", "{{", "*", "/", "}", "tmp", "+", "+;", "}", "/", "*", "Brackets", "should", "always", "be", "closed", "*", "/", "if", "(", "c", "!", "=", "0", ")", "{", "skip_upload", "=", "1", ";", "}", "}", "total_bytes", "=", "cancel_upload", "=", "0", ";", "@", "@", "-", "977", ",", "7", "+", "981", ",", "7", "@", "@", "SAPI_API", "SAPI_POST_HANDLER_FUNC", "(", "rfc1867_post_handler", ")", "/", "*", "{", "{{", "*", "/", "offset", "=", "0", ";", "end", "=", "0", ";", "if", "(", "!", "cancel_upload", ")", "{", "/", "*", "only", "bother", "to", "open", "temp", "file", "if", "we", "have", "data", "*", "/", "blen", "=", "multipart_buffer_read", "(", "mbuff", ",", "buff", ",", "sizeof", "(", "buff", ")", ",", "&", "end", "TSRMLS_CC", ")", ";", "@", "@", "-", "1275", ",", "7", "+", "1279", ",", "7", "@", "@", "SAPI_API", "void", "php_rfc1867_set_multibyte_callbacks", "(", "php_rfc1867_getword", "=", "getword", ";", "php_rfc1867_getword_conf", "=", "getword_conf", ";", "php_rfc1867_basename", "=", "basename", ";", "}", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "@", "@", "-", "0", ",", "0", "+", "1", ",", "67", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "55500", "(", "Corrupted", "$", "_FILES", "indices", "lead", "to", "security", "concern", ")", "-", "-", "INI", "-", "-", "file_uploads", "=", "1", "error_reporting", "=", "E_ALL", "&", "~", "E_NOTICE", "upload_max_filesize", "=", "1024", "-", "-", "POST_RAW", "-", "-", "Content", "-", "Type", ":", "multipart", "/", "form", "-", "data", ";", "boundary", "=", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "20896060251896012921717172737", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "Content", "-", "Disposition", ":", "form", "-", "data", ";", "name", "=", "\"", "file", "[", "]\"", ";", "filename", "=", "\"", "file1", ".", "txt", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "-", "file1", "1", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "Content", "-", "Disposition", ":", "form", "-", "data", ";", "name", "=", "\"", "file", "[", "[", "type", "]", "\";", "filename", "=", "\"", "file2", ".", "txt", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "-", "file2", "2", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "Content", "-", "Disposition", ":", "form", "-", "data", ";", "name", "=", "\"", "file", "[", "[", "name", "]", "\";", "filename", "=", "\"", "file3", ".", "txt", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "-", "file3", "3", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "Content", "-", "Disposition", ":", "form", "-", "data", ";", "name", "=", "\"", "file", "[", "name", "]", "[\"", ";", "filename", "=", "\"", "file4", ".", "txt", "\"", "Content", "-", "Type", ":", "text", "/", "plain", "-", "file3", "4", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "20896060251896012921717172737", "-", "-", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "$", "_FILES", ")", ";", "var_dump", "(", "$", "_POST", ")", ";", "?", ">", "-", "-", "EXPECTF", "-", "-", "array", "(", "1", ")", "{", "[", "%", "u", "|", "b", "%", "\"", "file", "\"", "]=", ">", "array", "(", "5", ")", "{", "[", "%", "u", "|", "b", "%", "\"", "name", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "%", "unicode", "|", "string", "%", "(", "9", ")", "\"", "file1", ".", "txt", "\"", "}", "[", "%", "u", "|", "b", "%", "\"", "type", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "%", "unicode", "|", "string", "%", "(", "16", ")", "\"", "text", "/", "plain", "-", "file1", "\"", "}", "[", "%", "u", "|", "b", "%", "\"", "tmp_name", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "%", "unicode", "|", "string", "%", "(%", "d", ")", "\"", "%", "s", "\"", "}", "[", "%", "u", "|", "b", "%", "\"", "error", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "int", "(", "0", ")", "}", "[", "%", "u", "|", "b", "%", "\"", "size", "\"", "]=", ">", "array", "(", "1", ")", "{", "[", "0", "]", "=>", "int", "(", "1", ")", "}", "}", "}", "array", "(", "0", ")", "{", "}"], "docstring_tokens": ["directory", "traversal"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "643", ",", "15", "+", "643", ",", "23", "@", "@", "static", "int", "usb_parse_configuration", "(", "struct", "usb_device", "*", "dev", ",", "int", "cfgidx", ",", "}", "else", "if", "(", "header", "-", ">", "bDescriptorType", "=", "=", "USB_DT_INTERFACE_ASSOCIATION", ")", "{", "struct", "usb_interface_assoc_descriptor", "*", "d", ";", "d", "=", "(", "struct", "usb_interface_assoc_descriptor", "*", ")", "header", ";", "if", "(", "d", "-", ">", "bLength", "<", "USB_DT_INTERFACE_ASSOCIATION_SIZE", ")", "{", "dev_warn", "(", "ddev", ",", "\"", "config", "%", "d", "has", "an", "invalid", "interface", "association", "descriptor", "of", "length", "%", "d", ",", "skipping", "\\", "n", "\"", ",", "cfgno", ",", "d", "-", ">", "bLength", ")", ";", "continue", ";", "}", "if", "(", "iad_num", "=", "=", "USB_MAXIADS", ")", "{", "dev_warn", "(", "ddev", ",", "\"", "found", "more", "Interface", "\"", "\"", "Association", "Descriptors", "\"", "\"", "than", "allocated", "for", "in", "\"", "\"", "configuration", "%", "d", "\\", "n", "\"", ",", "cfgno", ")", ";", "}", "else", "{", "config", "-", ">", "intf_assoc", "[", "iad_num", "]", "=", "(", "struct", "usb_interface_assoc_descriptor", "*", ")", "header", ";", "config", "-", ">", "intf_assoc", "[", "iad_num", "]", "=", "d", ";", "iad_num", "+", "+;", "}", "@", "@", "-", "780", ",", "6", "+", "780", ",", "7", "@", "@", "struct", "usb_interface_assoc_descriptor", "{", "__u8", "iFunction", ";", "}", "__attribute__", "(", "(", "packed", ")", ");", "#", "define", "USB_DT_INTERFACE_ASSOCIATION_SIZE", "8", "/", "*-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "*/"], "docstring_tokens": ["out-of-bounds", "read"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2168", ",", "6", "+", "2168", ",", "7", "@", "@", "function", "createSearchBox", "(", "searchURL", ")", "{", "var", "ac", "=", "new", "YAHOO", ".", "widget", ".", "AutoComplete", "(", "\"", "search", "-", "box", "\"", ",\"", "search", "-", "box", "-", "completion", "\"", ",", "ds", ")", ";", "ac", ".", "typeAhead", "=", "false", ";", "ac", ".", "autoHighlight", "=", "false", ";", "ac", ".", "formatResult", "=", "ac", ".", "formatEscapedResult", ";", "var", "box", "=", "$", "(\"", "search", "-", "box", "\"", ");", "var", "sizer", "=", "$", "(\"", "search", "-", "box", "-", "sizer", "\"", ");"], "docstring_tokens": ["cross-site", "scripting"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "158", ",", "12", "+", "158", ",", "12", "@", "@", "All", "rights", "reserved", ".", "function", "addParameterRowForDeployApplication", "(", "row", ",", "label", ",", "value", ",", "isCheckbox", ")", "{", "var", "td1", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "td1", ".", "className", "=", "'", "setting", "-", "leftspace", "'", ";", "td1", ".", "innerHTML", "=", "'", "';", "td1", ".", "textContent", "=", "'", "';", "row", ".", "appendChild", "(", "td1", ")", ";", "var", "td2", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "td2", ".", "className", "=", "'", "setting", "-", "name", "'", ";", "td2", ".", "innerHTML", "=", "label", ";", "td2", ".", "textContent", "=", "label", ";", "row", ".", "appendChild", "(", "td2", ")", ";", "var", "td3", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "@", "@", "-", "143", ",", "12", "+", "143", ",", "12", "@", "@", "All", "rights", "reserved", ".", "function", "addParameterRowForRunPipeline", "(", "row", ",", "label", ",", "value", ")", "{", "var", "td1", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "td1", ".", "className", "=", "'", "setting", "-", "leftspace", "'", ";", "td1", ".", "innerHTML", "=", "'", "';", "td1", ".", "textContent", "=", "'", "';", "row", ".", "appendChild", "(", "td1", ")", ";", "var", "td2", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "td2", ".", "className", "=", "'", "setting", "-", "name", "'", ";", "td2", ".", "innerHTML", "=", "label", ";", "td2", ".", "textContent", "=", "label", ";", "row", ".", "appendChild", "(", "td2", ")", ";", "var", "td3", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "@", "@", "-", "145", ",", "12", "+", "145", ",", "12", "@", "@", "All", "rights", "reserved", ".", "function", "addParameterRowForRunProcedure", "(", "row", ",", "label", ",", "value", ",", "isCheckbox", ")", "{", "var", "td1", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "td1", ".", "className", "=", "'", "setting", "-", "leftspace", "'", ";", "td1", ".", "innerHTML", "=", "'", "';", "td1", ".", "textContent", "=", "'", "';", "row", ".", "appendChild", "(", "td1", ")", ";", "var", "td2", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "td2", ".", "className", "=", "'", "setting", "-", "name", "'", ";", "td2", ".", "innerHTML", "=", "label", ";", "td2", ".", "textContent", "=", "label", ";", "row", ".", "appendChild", "(", "td2", ")", ";", "var", "td3", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "@", "@", "-", "178", ",", "12", "+", "178", ",", "12", "@", "@", "All", "rights", "reserved", ".", "function", "addParameterRowForTriggerRelease", "(", "row", ",", "label", ",", "value", ",", "isCheckbox", ")", "{", "var", "td1", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "td1", ".", "className", "=", "'", "setting", "-", "leftspace", "'", ";", "td1", ".", "innerHTML", "=", "'", "';", "td1", ".", "textContent", "=", "'", "';", "row", ".", "appendChild", "(", "td1", ")", ";", "var", "td2", "=", "document", ".", "createElement", "(", "'", "td", "'", ");", "td2", ".", "className", "=", "'", "setting", "-", "name", "'", ";", "td2", ".", "innerHTML", "=", "label", ";", "td2", ".", "textContent", "=", "label", ";", "row", ".", "appendChild", "(", "td2", ")", ";", "var", "td3", "=", "document", ".", "createElement", "(", "'", "td", "'", ");"], "docstring_tokens": ["cross-site", "request", "forgery"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "15", ",", "11", "+", "15", ",", "7", "@", "@", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "rest", ".", "webmvc", ".", "json", ".", "patch", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "/", "**", "*", "Operation", "to", "add", "a", "new", "value", "to", "the", "given", "\"", "path", "\"", ".", "Will", "throw", "a", "{", "@", "link", "PatchException", "}", "if", "the", "path", "is", "invalid", "or", "if", "@", "@", "-", "60", ",", "17", "+", "56", ",", "8", "@", "@", "public", "AddOperation", "(", "String", "path", ",", "Object", "value", ")", "{", "return", "super", ".", "evaluateValueFromTarget", "(", "targetObject", ",", "entityType", ")", ";", "}", "List", "<", "String", ">", "segments", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "for", "(", "String", "segment", ":", "path", ".", "split", "(", "\"/", "\")", ")", "{", "if", "(", "!(", "segment", ".", "matches", "(", "\"\\", "\\", "d", "+", "\")", "|", "|", "segment", ".", "equals", "(", "\"-", "\")", "|", "|", "segment", ".", "isEmpty", "(", "))", ")", "{", "segments", ".", "add", "(", "segment", ")", ";", "}", "}", "PropertyPath", "propertyPath", "=", "PropertyPath", ".", "from", "(", "StringUtils", ".", "collectionToDelimitedString", "(", "segments", ",", "\"", ".\"", "),", "entityType", ")", ";", "PropertyPath", "path", "=", "verifyPath", "(", "entityType", ")", ";", "return", "value", "instanceof", "LateObjectEvaluator", "?", "(", "(", "LateObjectEvaluator", ")", "value", ")", ".", "evaluate", "(", "propertyPath", ".", "getType", "(", "))", ":", "value", ";", "return", "evaluate", "(", "path", "=", "=", "null", "?", "entityType", ":", "path", ".", "getType", "(", "))", ";", "}", "}", "@", "@", "-", "17", ",", "14", "+", "17", ",", "18", "@", "@", "import", "static", "org", ".", "springframework", ".", "data", ".", "rest", ".", "webmvc", ".", "json", ".", "patch", ".", "PathToSpEL", ".", "*;", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "springframework", ".", "core", ".", "CollectionFactory", ";", "import", "org", ".", "springframework", ".", "core", ".", "convert", ".", "TypeDescriptor", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyPath", ";", "import", "org", ".", "springframework", ".", "data", ".", "mapping", ".", "PropertyReferenceException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "Expression", ";", "import", "org", ".", "springframework", ".", "expression", ".", "ExpressionException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelEvaluationException", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "/", "**", "*", "Abstract", "base", "class", "representing", "and", "providing", "support", "methods", "for", "patch", "operations", ".", "@", "@", "-", "35", ",", "6", "+", "39", ",", "8", "@", "@", "*", "/", "public", "abstract", "class", "PatchOperation", "{", "private", "static", "final", "String", "INVALID_PATH_REFERENCE", "=", "\"", "Invalid", "path", "reference", "%", "s", "on", "type", "%", "s", "(", "from", "source", "%", "s", ")", "!\"", ";", "protected", "final", "String", "op", ";", "protected", "final", "String", "path", ";", "protected", "final", "Object", "value", ";", "@", "@", "-", "193", ",", "8", "+", "199", ",", "13", "@", "@", "protected", "Object", "getValueFromTarget", "(", "Object", "target", ")", "{", "*", "/", "protected", "<", "T", ">", "Object", "evaluateValueFromTarget", "(", "Object", "targetObject", ",", "Class", "<", "T", ">", "entityType", ")", "{", "return", "value", "instanceof", "LateObjectEvaluator", "?", "(", "(", "LateObjectEvaluator", ")", "value", ")", ".", "evaluate", "(", "spelExpression", ".", "getValueType", "(", "targetObject", ")", ")", ":", "value", ";", "verifyPath", "(", "entityType", ")", ";", "return", "evaluate", "(", "spelExpression", ".", "getValueType", "(", "targetObject", ")", ");", "}", "protected", "final", "<", "T", ">", "Object", "evaluate", "(", "Class", "<", "T", ">", "targetType", ")", "{", "return", "value", "instanceof", "LateObjectEvaluator", "?", "(", "(", "LateObjectEvaluator", ")", "value", ")", ".", "evaluate", "(", "targetType", ")", ":", "value", ";", "}", "/", "**", "@", "@", "-", "219", ",", "4", "+", "230", ",", "32", "@", "@", "private", "Integer", "targetListIndex", "(", "String", "path", ")", "{", "return", "null", ";", "}", "}", "/", "**", "*", "Verifies", ",", "that", "the", "path", "for", "the", "current", "operation", "is", "a", "valid", "property", "path", "on", "the", "given", "target", "type", ".", "*", "*", "@", "param", "type", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "protected", "PropertyPath", "verifyPath", "(", "Class", "<", "?>", "type", ")", "{", "List", "<", "String", ">", "segments", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "for", "(", "String", "segment", ":", "path", ".", "split", "(", "\"/", "\")", ")", "{", "if", "(", "!(", "segment", ".", "matches", "(", "\"\\", "\\", "d", "+", "\")", "|", "|", "segment", ".", "equals", "(", "\"-", "\")", "|", "|", "segment", ".", "isEmpty", "(", "))", ")", "{", "segments", ".", "add", "(", "segment", ")", ";", "}", "}", "if", "(", "segments", ".", "isEmpty", "(", "))", "{", "return", "null", ";", "}", "String", "pathSource", "=", "StringUtils", ".", "collectionToDelimitedString", "(", "segments", ",", "\"", ".\"", ");", "try", "{", "return", "PropertyPath", ".", "from", "(", "pathSource", ",", "type", ")", ";", "}", "catch", "(", "PropertyReferenceException", "o_O", ")", "{", "throw", "new", "PatchException", "(", "String", ".", "format", "(", "INVALID_PATH_REFERENCE", ",", "pathSource", ",", "type", ",", "path", ")", ",", "o_O", ")", ";", "}", "}", "}", "@", "@", "-", "162", ",", "6", "+", "162", ",", "11", "@", "@", "public", "void", "failureWithInvalidPatchContent", "(", ")", "throws", "Exception", "{", "patch", ".", "apply", "(", "todo", ",", "Todo", ".", "class", ")", ";", "}", "@", "Test", "(", "expected", "=", "PatchException", ".", "class", ")", "/", "/", "DATAREST", "-", "1127", "public", "void", "rejectsInvalidPaths", "(", ")", "throws", "Exception", "{", "readJsonPatch", "(", "\"", "patch", "-", "invalid", "-", "path", ".", "json", "\"", ").", "apply", "(", "new", "Todo", "(", "),", "Todo", ".", "class", ")", ";", "}", "private", "Patch", "readJsonPatch", "(", "String", "jsonPatchFile", ")", "throws", "IOException", ",", "JsonParseException", ",", "JsonMappingException", "{", "ClassPathResource", "resource", "=", "new", "ClassPathResource", "(", "jsonPatchFile", ",", "getClass", "(", "))", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "3", "@", "@", "[", "{", "\"", "op", "\"", ":\"", "replace", "\"", ",", "\"", "path", "\"", ":\"", "/", "somethingInvalid", "\"", ",", "\"", "value", "\"", ":", "\"", "bar", "\"", "}", "]"], "docstring_tokens": ["patch", "request", "remote", "code", "execution"]}
