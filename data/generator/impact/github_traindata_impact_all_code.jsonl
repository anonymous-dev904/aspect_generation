{"contents": ["empty"], "code_tokens": ["@", "@", "-", "261", ",", "6", "+", "261", ",", "58", "@", "@", "static", "unsigned", "long", "move_vma", "(", "struct", "vm_area_struct", "*", "vma", ",", "return", "new_addr", ";", "}", "static", "struct", "vm_area_struct", "*", "vma_to_resize", "(", "unsigned", "long", "addr", ",", "unsigned", "long", "old_len", ",", "unsigned", "long", "new_len", ",", "unsigned", "long", "*", "p", ")", "{", "struct", "mm_struct", "*", "mm", "=", "current", "-", ">", "mm", ";", "struct", "vm_area_struct", "*", "vma", "=", "find_vma", "(", "mm", ",", "addr", ")", ";", "if", "(", "!", "vma", "|", "|", "vma", "-", ">", "vm_start", ">", "addr", ")", "goto", "Efault", ";", "if", "(", "is_vm_hugetlb_page", "(", "vma", ")", ")", "goto", "Einval", ";", "/", "*", "We", "can", "'", "t", "remap", "across", "vm", "area", "boundaries", "*", "/", "if", "(", "old_len", ">", "vma", "-", ">", "vm_end", "-", "addr", ")", "goto", "Efault", ";", "if", "(", "vma", "-", ">", "vm_flags", "&", "(", "VM_DONTEXPAND", "|", "VM_PFNMAP", ")", ")", "{", "if", "(", "new_len", ">", "old_len", ")", "goto", "Efault", ";", "}", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_LOCKED", ")", "{", "unsigned", "long", "locked", ",", "lock_limit", ";", "locked", "=", "mm", "-", ">", "locked_vm", "<", "<", "PAGE_SHIFT", ";", "lock_limit", "=", "current", "-", ">", "signal", "-", ">", "rlim", "[", "RLIMIT_MEMLOCK", "]", ".", "rlim_cur", ";", "locked", "+", "=", "new_len", "-", "old_len", ";", "if", "(", "locked", ">", "lock_limit", "&", "&", "!", "capable", "(", "CAP_IPC_LOCK", ")", ")", "goto", "Eagain", ";", "}", "if", "(", "!", "may_expand_vm", "(", "mm", ",", "(", "new_len", "-", "old_len", ")", ">", ">", "PAGE_SHIFT", ")", ")", "goto", "Enomem", ";", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_ACCOUNT", ")", "{", "unsigned", "long", "charged", "=", "(", "new_len", "-", "old_len", ")", ">", ">", "PAGE_SHIFT", ";", "if", "(", "security_vm_enough_memory", "(", "charged", ")", ")", "goto", "Efault", ";", "*", "p", "=", "charged", ";", "}", "return", "vma", ";", "Efault", ":", "/", "*", "very", "odd", "choice", "for", "most", "of", "the", "cases", ",", "but", ".", "..", "*", "/", "return", "ERR_PTR", "(", "-", "EFAULT", ")", ";", "Einval", ":", "return", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "Enomem", ":", "return", "ERR_PTR", "(", "-", "ENOMEM", ")", ";", "Eagain", ":", "return", "ERR_PTR", "(", "-", "EAGAIN", ")", ";", "}", "/", "*", "*", "Expand", "(", "or", "shrink", ")", "an", "existing", "mapping", ",", "potentially", "moving", "it", "at", "the", "*", "same", "time", "(", "controlled", "by", "the", "MREMAP_MAYMOVE", "flag", "and", "available", "VM", "space", ")", "@", "@", "-", "340", ",", "41", "+", "392", ",", "12", "@", "@", "unsigned", "long", "do_mremap", "(", "unsigned", "long", "addr", ",", "/", "*", "*", "Ok", ",", "we", "need", "to", "grow", ".", ".", "or", "relocate", ".", "*", "/", "ret", "=", "-", "EFAULT", ";", "vma", "=", "find_vma", "(", "mm", ",", "addr", ")", ";", "if", "(", "!", "vma", "|", "|", "vma", "-", ">", "vm_start", ">", "addr", ")", "goto", "out", ";", "if", "(", "is_vm_hugetlb_page", "(", "vma", ")", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "out", ";", "}", "/", "*", "We", "can", "'", "t", "remap", "across", "vm", "area", "boundaries", "*", "/", "if", "(", "old_len", ">", "vma", "-", ">", "vm_end", "-", "addr", ")", "goto", "out", ";", "if", "(", "vma", "-", ">", "vm_flags", "&", "(", "VM_DONTEXPAND", "|", "VM_PFNMAP", ")", ")", "{", "if", "(", "new_len", ">", "old_len", ")", "goto", "out", ";", "}", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_LOCKED", ")", "{", "unsigned", "long", "locked", ",", "lock_limit", ";", "locked", "=", "mm", "-", ">", "locked_vm", "<", "<", "PAGE_SHIFT", ";", "lock_limit", "=", "current", "-", ">", "signal", "-", ">", "rlim", "[", "RLIMIT_MEMLOCK", "]", ".", "rlim_cur", ";", "locked", "+", "=", "new_len", "-", "old_len", ";", "ret", "=", "-", "EAGAIN", ";", "if", "(", "locked", ">", "lock_limit", "&", "&", "!", "capable", "(", "CAP_IPC_LOCK", ")", ")", "goto", "out", ";", "}", "if", "(", "!", "may_expand_vm", "(", "mm", ",", "(", "new_len", "-", "old_len", ")", ">", ">", "PAGE_SHIFT", ")", ")", "{", "ret", "=", "-", "ENOMEM", ";", "vma", "=", "vma_to_resize", "(", "addr", ",", "old_len", ",", "new_len", ",", "&", "charged", ")", ";", "if", "(", "IS_ERR", "(", "vma", ")", ")", "{", "ret", "=", "PTR_ERR", "(", "vma", ")", ";", "goto", "out", ";", "}", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_ACCOUNT", ")", "{", "charged", "=", "(", "new_len", "-", "old_len", ")", ">", ">", "PAGE_SHIFT", ";", "if", "(", "security_vm_enough_memory", "(", "charged", ")", ")", "goto", "out_nc", ";", "}", "/", "*", "old_len", "exactly", "to", "the", "end", "of", "the", "area", ".", ".", "*", "And", "we", "'", "re", "not", "relocating", "the", "area", ".", "*", "/", "@", "@", "-", "430", ",", "7", "+", "453", ",", "6", "@", "@", "unsigned", "long", "do_mremap", "(", "unsigned", "long", "addr", ",", "out", ":", "if", "(", "ret", "&", "~", "PAGE_MASK", ")", "vm_unacct_memory", "(", "charged", ")", ";", "out_nc", ":", "return", "ret", ";", "}"], "docstring_tokens": ["gain", "privileges", "or", "cause", "a", "denial", "of", "service", "(panic", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "617", ",", "7", "+", "617", ",", "8", "@", "@", "static", "void", "macsec_encrypt_done", "(", "struct", "crypto_async_request", "*", "base", ",", "int", "err", ")", "static", "struct", "aead_request", "*", "macsec_alloc_req", "(", "struct", "crypto_aead", "*", "tfm", ",", "unsigned", "char", "*", "*", "iv", ",", "struct", "scatterlist", "*", "*", "sg", ")", "struct", "scatterlist", "*", "*", "sg", ",", "int", "num_frags", ")", "{", "size_t", "size", ",", "iv_offset", ",", "sg_offset", ";", "struct", "aead_request", "*", "req", ";", "@", "@", "-", "629", ",", "7", "+", "630", ",", "7", "@", "@", "static", "struct", "aead_request", "*", "macsec_alloc_req", "(", "struct", "crypto_aead", "*", "tfm", ",", "size", "=", "ALIGN", "(", "size", ",", "__alignof__", "(", "struct", "scatterlist", ")", ");", "sg_offset", "=", "size", ";", "size", "+", "=", "sizeof", "(", "struct", "scatterlist", ")", "*", "(", "MAX_SKB_FRAGS", "+", "1", ")", ";", "size", "+", "=", "sizeof", "(", "struct", "scatterlist", ")", "*", "num_frags", ";", "tmp", "=", "kmalloc", "(", "size", ",", "GFP_ATOMIC", ")", ";", "if", "(", "!", "tmp", ")", "@", "@", "-", "649", ",", "6", "+", "650", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "macsec_encrypt", "(", "struct", "sk_buff", "*", "skb", ",", "{", "int", "ret", ";", "struct", "scatterlist", "*", "sg", ";", "struct", "sk_buff", "*", "trailer", ";", "unsigned", "char", "*", "iv", ";", "struct", "ethhdr", "*", "eth", ";", "struct", "macsec_eth_header", "*", "hh", ";", "@", "@", "-", "723", ",", "7", "+", "725", ",", "14", "@", "@", "static", "struct", "sk_buff", "*", "macsec_encrypt", "(", "struct", "sk_buff", "*", "skb", ",", "return", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "}", "req", "=", "macsec_alloc_req", "(", "tx_sa", "-", ">", "key", ".", "tfm", ",", "&", "iv", ",", "&", "sg", ")", ";", "ret", "=", "skb_cow_data", "(", "skb", ",", "0", ",", "&", "trailer", ")", ";", "if", "(", "unlikely", "(", "ret", "<", "0", ")", ")", "{", "macsec_txsa_put", "(", "tx_sa", ")", ";", "kfree_skb", "(", "skb", ")", ";", "return", "ERR_PTR", "(", "ret", ")", ";", "}", "req", "=", "macsec_alloc_req", "(", "tx_sa", "-", ">", "key", ".", "tfm", ",", "&", "iv", ",", "&", "sg", ",", "ret", ")", ";", "if", "(", "!", "req", ")", "{", "macsec_txsa_put", "(", "tx_sa", ")", ";", "kfree_skb", "(", "skb", ")", ";", "@", "@", "-", "732", ",", "7", "+", "741", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "macsec_encrypt", "(", "struct", "sk_buff", "*", "skb", ",", "macsec_fill_iv", "(", "iv", ",", "secy", "-", ">", "sci", ",", "pn", ")", ";", "sg_init_table", "(", "sg", ",", "MAX_SKB_FRAGS", "+", "1", ")", ";", "sg_init_table", "(", "sg", ",", "ret", ")", ";", "skb_to_sgvec", "(", "skb", ",", "sg", ",", "0", ",", "skb", "-", ">", "len", ")", ";", "if", "(", "tx_sc", "-", ">", "encrypt", ")", "{", "@", "@", "-", "917", ",", "6", "+", "926", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "macsec_decrypt", "(", "struct", "sk_buff", "*", "skb", ",", "{", "int", "ret", ";", "struct", "scatterlist", "*", "sg", ";", "struct", "sk_buff", "*", "trailer", ";", "unsigned", "char", "*", "iv", ";", "struct", "aead_request", "*", "req", ";", "struct", "macsec_eth_header", "*", "hdr", ";", "@", "@", "-", "927", ",", "7", "+", "937", ",", "12", "@", "@", "static", "struct", "sk_buff", "*", "macsec_decrypt", "(", "struct", "sk_buff", "*", "skb", ",", "if", "(", "!", "skb", ")", "return", "ERR_PTR", "(", "-", "ENOMEM", ")", ";", "req", "=", "macsec_alloc_req", "(", "rx_sa", "-", ">", "key", ".", "tfm", ",", "&", "iv", ",", "&", "sg", ")", ";", "ret", "=", "skb_cow_data", "(", "skb", ",", "0", ",", "&", "trailer", ")", ";", "if", "(", "unlikely", "(", "ret", "<", "0", ")", ")", "{", "kfree_skb", "(", "skb", ")", ";", "return", "ERR_PTR", "(", "ret", ")", ";", "}", "req", "=", "macsec_alloc_req", "(", "rx_sa", "-", ">", "key", ".", "tfm", ",", "&", "iv", ",", "&", "sg", ",", "ret", ")", ";", "if", "(", "!", "req", ")", "{", "kfree_skb", "(", "skb", ")", ";", "return", "ERR_PTR", "(", "-", "ENOMEM", ")", ";", "@", "@", "-", "936", ",", "7", "+", "951", ",", "7", "@", "@", "static", "struct", "sk_buff", "*", "macsec_decrypt", "(", "struct", "sk_buff", "*", "skb", ",", "hdr", "=", "(", "struct", "macsec_eth_header", "*", ")", "skb", "-", ">", "data", ";", "macsec_fill_iv", "(", "iv", ",", "sci", ",", "ntohl", "(", "hdr", "-", ">", "packet_number", ")", ");", "sg_init_table", "(", "sg", ",", "MAX_SKB_FRAGS", "+", "1", ")", ";", "sg_init_table", "(", "sg", ",", "ret", ")", ";", "skb_to_sgvec", "(", "skb", ",", "sg", ",", "0", ",", "skb", "-", ">", "len", ")", ";", "if", "(", "hdr", "-", ">", "tci_an", "&", "MACSEC_TCI_E", ")", "{", "@", "@", "-", "2716", ",", "7", "+", "2731", ",", "7", "@", "@", "static", "netdev_tx_t", "macsec_start_xmit", "(", "struct", "sk_buff", "*", "skb", ",", "}", "#", "define", "MACSEC_FEATURES", "\\", "(", "NETIF_F_SG", "|", "NETIF_F_HIGHDMA", ")", "(", "NETIF_F_SG", "|", "NETIF_F_HIGHDMA", "|", "NETIF_F_FRAGLIST", ")", "static", "struct", "lock_class_key", "macsec_netdev_addr_lock_key", ";", "static", "int", "macsec_dev_init", "(", "struct", "net_device", "*", "dev", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1392", ",", "6", "+", "1392", ",", "7", "@", "@", "static", "int", "ax25_getname", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "uaddr", ",", "ax25_cb", "*", "ax25", ";", "int", "err", "=", "0", ";", "memset", "(", "fsa", ",", "0", ",", "sizeof", "(", "fsa", ")", ");", "lock_sock", "(", "sk", ")", ";", "ax25", "=", "ax25_sk", "(", "sk", ")", ";", "@", "@", "-", "1403", ",", "7", "+", "1404", ",", "6", "@", "@", "static", "int", "ax25_getname", "(", "struct", "socket", "*", "sock", ",", "struct", "sockaddr", "*", "uaddr", ",", "fsa", "-", ">", "fsa_ax25", ".", "sax25_family", "=", "AF_AX25", ";", "fsa", "-", ">", "fsa_ax25", ".", "sax25_call", "=", "ax25", "-", ">", "dest_addr", ";", "fsa", "-", ">", "fsa_ax25", ".", "sax25_ndigis", "=", "0", ";", "if", "(", "ax25", "-", ">", "digipeat", "!", "=", "NULL", ")", "{", "ndigi", "=", "ax25", "-", ">", "digipeat", "-", ">", "ndigi", ";"], "docstring_tokens": ["obtain", "potentially", "sensitive", "information", "from", "kernel", "stack", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "168", ",", "6", "+", "168", ",", "9", "@", "@", "static", "long", "madvise_remove", "(", "struct", "vm_area_struct", "*", "vma", ",", "return", "-", "EINVAL", ";", "}", "if", "(", "(", "vma", "-", ">", "vm_flags", "&", "(", "VM_SHARED", "|", "VM_WRITE", ")", ")", "!", "=", "(", "VM_SHARED", "|", "VM_WRITE", ")", ")", "return", "-", "EACCES", ";", "mapping", "=", "vma", "-", ">", "vm_file", "-", ">", "f_mapping", ";", "offset", "=", "(", "loff_t", ")", "(", "start", "-", "vma", "-", ">", "vm_start", ")"], "docstring_tokens": ["gain", "write", "access", "to", "read-only", "attachments", "and", "shared", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "805", ",", "7", "+", "805", ",", "26", "@", "@", "int", "reserveWindowSize", "(", "Stream", "stream", ",", "int", "reservation", ",", "boolean", "block", ")", "throws", "IOEx", "if", "(", "allocation", "=", "=", "0", ")", "{", "if", "(", "block", ")", "{", "try", "{", "stream", ".", "wait", "(", ");", "/", "/", "Connection", "level", "window", "is", "empty", ".", "Although", "this", "/", "/", "request", "is", "for", "a", "stream", ",", "use", "the", "connection", "/", "/", "timeout", "long", "writeTimeout", "=", "protocol", ".", "getWriteTimeout", "(", ");", "if", "(", "writeTimeout", "<", "0", ")", "{", "stream", ".", "wait", "(", ");", "}", "else", "{", "stream", ".", "wait", "(", "writeTimeout", ")", ";", "}", "/", "/", "Has", "this", "stream", "been", "granted", "an", "allocation", "int", "[", "]", "value", "=", "backLogStreams", ".", "get", "(", "stream", ")", ";", "if", "(", "value", "[", "1", "]", "=", "=", "0", ")", "{", "/", "/", "No", "allocation", "/", "/", "Close", "the", "connection", ".", "Do", "this", "first", "since", "/", "/", "closing", "the", "stream", "will", "raise", "an", "exception", "close", "(", ");", "/", "/", "Close", "the", "stream", "(", "in", "app", "code", "so", "need", "to", "/", "/", "signal", "to", "app", "stream", "is", "closing", ")", "stream", ".", "doWriteTimeout", "(", ");", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "IOException", "(", "sm", ".", "getString", "(", "\"", "upgradeHandler", ".", "windowSizeReservationInterrupted", "\"", ",", "connectionId", ",", "@", "@", "-", "1023", ",", "11", "+", "1042", ",", "20", "@", "@", "private", "Stream", "createLocalStream", "(", "Request", "request", ")", "{", "private", "void", "close", "(", ")", "{", "connectionState", ".", "set", "(", "ConnectionState", ".", "CLOSED", ")", ";", "ConnectionState", "previous", "=", "connectionState", ".", "getAndSet", "(", "ConnectionState", ".", "CLOSED", ")", ";", "if", "(", "previous", "=", "=", "ConnectionState", ".", "CLOSED", ")", "{", "/", "/", "Already", "closed", "return", ";", "}", "for", "(", "Stream", "stream", ":", "streams", ".", "values", "(", "))", "{", "/", "/", "The", "connection", "is", "closing", ".", "Close", "the", "associated", "streams", "as", "no", "/", "/", "longer", "required", ".", "stream", ".", "receiveReset", "(", "Http2Error", ".", "CANCEL", ".", "getCode", "(", "))", ";", "/", "/", "Release", "any", "streams", "waiting", "for", "an", "allocation", "synchronized", "(", "stream", ")", "{", "stream", ".", "notifyAll", "(", ");", "}", "}", "try", "{", "socketWrapper", ".", "close", "(", ");", "@", "@", "-", "280", ",", "17", "+", "280", ",", "7", "@", "@", "private", "synchronized", "int", "reserveWindowSize", "(", "int", "reservation", ",", "boolean", "block", ")", "throw", "}", "windowSize", "=", "getWindowSize", "(", ");", "if", "(", "windowSize", "=", "=", "0", ")", "{", "String", "msg", "=", "sm", ".", "getString", "(", "\"", "stream", ".", "writeTimeout", "\"", ");", "StreamException", "se", "=", "new", "StreamException", "(", "msg", ",", "Http2Error", ".", "ENHANCE_YOUR_CALM", ",", "getIdAsInt", "(", "))", ";", "/", "/", "Prevent", "the", "application", "making", "further", "writes", "streamOutputBuffer", ".", "closed", "=", "true", ";", "/", "/", "Prevent", "Tomcat", "'", "s", "error", "handling", "trying", "to", "write", "coyoteResponse", ".", "setError", "(", ");", "coyoteResponse", ".", "setErrorReported", "(", ");", "/", "/", "Trigger", "a", "reset", "once", "control", "returns", "to", "Tomcat", "streamOutputBuffer", ".", "reset", "=", "se", ";", "throw", "new", "CloseNowException", "(", "msg", ",", "se", ")", ";", "doWriteTimeout", "(", ");", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "/", "/", "Possible", "shutdown", "/", "rst", "or", "similar", ".", "Use", "an", "IOException", "to", "@", "@", "-", "313", ",", "6", "+", "303", ",", "21", "@", "@", "private", "synchronized", "int", "reserveWindowSize", "(", "int", "reservation", ",", "boolean", "block", ")", "throw", "}", "void", "doWriteTimeout", "(", ")", "throws", "CloseNowException", "{", "String", "msg", "=", "sm", ".", "getString", "(", "\"", "stream", ".", "writeTimeout", "\"", ");", "StreamException", "se", "=", "new", "StreamException", "(", "msg", ",", "Http2Error", ".", "ENHANCE_YOUR_CALM", ",", "getIdAsInt", "(", "))", ";", "/", "/", "Prevent", "the", "application", "making", "further", "writes", "streamOutputBuffer", ".", "closed", "=", "true", ";", "/", "/", "Prevent", "Tomcat", "'", "s", "error", "handling", "trying", "to", "write", "coyoteResponse", ".", "setError", "(", ");", "coyoteResponse", ".", "setErrorReported", "(", ");", "/", "/", "Trigger", "a", "reset", "once", "control", "returns", "to", "Tomcat", "streamOutputBuffer", ".", "reset", "=", "se", ";", "throw", "new", "CloseNowException", "(", "msg", ",", "se", ")", ";", "}", "@", "Override", "@", "Deprecated", "protected", "synchronized", "void", "doNotifyAll", "(", ")", "{", "@", "@", "-", "113", ",", "6", "+", "113", ",", "10", "@", "@", "Refactor", "Hostname", "validation", "to", "improve", "performance", ".", "Patch", "provided", "by", "Uwe", "Hees", ".", "(", "markt", ")", "<", "/", "scode", ">", "<", "fix", ">", "Expand", "HTTP", "/", "2", "timeout", "handling", "to", "include", "connection", "window", "exhaustion", "on", "write", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Other", "\"", ">"], "docstring_tokens": ["block", "threads", "on", "the", "server", "and", "cause", "a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "495", ",", "7", "+", "495", ",", "7", "@", "@", "static", "void", "__dentry_kill", "(", "struct", "dentry", "*", "dentry", ")", "}", "/", "*", "if", "it", "was", "on", "the", "hash", "then", "remove", "it", "*", "/", "__d_drop", "(", "dentry", ")", ";", "list_del", "(", "&", "dentry", "-", ">", "d_child", ")", ";", "__list_del_entry", "(", "&", "dentry", "-", ">", "d_child", ")", ";", "/", "*", "*", "Inform", "d_walk", "(", ")", "that", "we", "are", "no", "longer", "attached", "to", "the", "*", "dentry", "tree", "@", "@", "-", "1081", ",", "33", "+", "1081", ",", "31", "@", "@", "static", "void", "d_walk", "(", "struct", "dentry", "*", "parent", ",", "void", "*", "data", ",", "/", "*", "*", "All", "done", "at", "this", "level", ".", "..", "ascend", "and", "resume", "the", "search", ".", "*", "/", "rcu_read_lock", "(", ");", "ascend", ":", "if", "(", "this_parent", "!", "=", "parent", ")", "{", "struct", "dentry", "*", "child", "=", "this_parent", ";", "this_parent", "=", "child", "-", ">", "d_parent", ";", "rcu_read_lock", "(", ");", "spin_unlock", "(", "&", "child", "-", ">", "d_lock", ")", ";", "spin_lock", "(", "&", "this_parent", "-", ">", "d_lock", ")", ";", "/", "*", "*", "might", "go", "back", "up", "the", "wrong", "parent", "if", "we", "have", "had", "a", "rename", "*", "or", "deletion", "*", "/", "if", "(", "this_parent", "!", "=", "child", "-", ">", "d_parent", "|", "|", "(", "child", "-", ">", "d_flags", "&", "DCACHE_DENTRY_KILLED", ")", "|", "|", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "{", "spin_unlock", "(", "&", "this_parent", "-", ">", "d_lock", ")", ";", "rcu_read_unlock", "(", ");", "/", "*", "might", "go", "back", "up", "the", "wrong", "parent", "if", "we", "have", "had", "a", "rename", ".", "*", "/", "if", "(", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "goto", "rename_retry", ";", "next", "=", "child", "-", ">", "d_child", ".", "next", ";", "while", "(", "unlikely", "(", "child", "-", ">", "d_flags", "&", "DCACHE_DENTRY_KILLED", ")", ")", "{", "if", "(", "next", "=", "=", "&", "this_parent", "-", ">", "d_subdirs", ")", "goto", "ascend", ";", "child", "=", "list_entry", "(", "next", ",", "struct", "dentry", ",", "d_child", ")", ";", "next", "=", "next", "-", ">", "next", ";", "}", "rcu_read_unlock", "(", ");", "next", "=", "child", "-", ">", "d_child", ".", "next", ";", "goto", "resume", ";", "}", "if", "(", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "{", "spin_unlock", "(", "&", "this_parent", "-", ">", "d_lock", ")", ";", "if", "(", "need_seqretry", "(", "&", "rename_lock", ",", "seq", ")", ")", "goto", "rename_retry", ";", "}", "rcu_read_unlock", "(", ");", "if", "(", "finish", ")", "finish", "(", "data", ")", ";", "@", "@", "-", "1117", ",", "6", "+", "1115", ",", "9", "@", "@", "static", "void", "d_walk", "(", "struct", "dentry", "*", "parent", ",", "void", "*", "data", ",", "return", ";", "rename_retry", ":", "spin_unlock", "(", "&", "this_parent", "-", ">", "d_lock", ")", ";", "rcu_read_unlock", "(", ");", "BUG_ON", "(", "seq", "&", "1", ")", ";", "if", "(", "!", "retry", ")", "return", ";", "seq", "=", "1", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(deadlock", "and", "system", "hang", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1750", ",", "7", "+", "1750", ",", "11", "@", "@", "static", "void", "__iov_iter_advance_iov", "(", "struct", "iov_iter", "*", "i", ",", "size_t", "bytes", ")", "const", "struct", "iovec", "*", "iov", "=", "i", "-", ">", "iov", ";", "size_t", "base", "=", "i", "-", ">", "iov_offset", ";", "while", "(", "bytes", ")", "{", "/", "*", "*", "The", "!", "iov", "-", ">", "iov_len", "check", "ensures", "we", "skip", "over", "unlikely", "*", "zero", "-", "length", "segments", ".", "*", "/", "while", "(", "bytes", "|", "|", "!", "iov", "-", ">", "iov_len", ")", "{", "int", "copy", "=", "min", "(", "bytes", ",", "iov", "-", ">", "iov_len", "-", "base", ")", ";", "bytes", "-", "=", "copy", ";", "@", "@", "-", "2268", ",", "6", "+", "2272", ",", "7", "@", "@", "static", "ssize_t", "generic_perform_write", "(", "struct", "file", "*", "file", ",", "cond_resched", "(", ");", "iov_iter_advance", "(", "i", ",", "copied", ")", ";", "if", "(", "unlikely", "(", "copied", "=", "=", "0", ")", ")", "{", "/", "*", "*", "If", "we", "were", "unable", "to", "copy", "any", "data", "at", "all", ",", "we", "must", "@", "@", "-", "2281", ",", "7", "+", "2286", ",", "6", "@", "@", "static", "ssize_t", "generic_perform_write", "(", "struct", "file", "*", "file", ",", "iov_iter_single_seg_count", "(", "i", ")", ");", "goto", "again", ";", "}", "iov_iter_advance", "(", "i", ",", "copied", ")", ";", "pos", "+", "=", "copied", ";", "written", "+", "=", "copied", ";"], "docstring_tokens": ["the", "application", "to", "enter", "into", "an", "infinite", "loop"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "803", ",", "10", "+", "803", ",", "13", "@", "@", "static", "int", "do_setcontext", "(", "struct", "ucontext", "__user", "*", "ucp", ",", "struct", "pt_regs", "*", "regs", ",", "int", "if", "(", "__get_user", "(", "cmcp", ",", "&", "ucp", "-", ">", "uc_regs", ")", ")", "return", "-", "EFAULT", ";", "mcp", "=", "(", "struct", "mcontext", "__user", "*", ")(", "u64", ")", "cmcp", ";", "/", "*", "no", "need", "to", "check", "access_ok", "(", "mcp", ")", ",", "since", "mcp", "<", "4GB", "*", "/", "}", "#", "else", "if", "(", "__get_user", "(", "mcp", ",", "&", "ucp", "-", ">", "uc_regs", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "!", "access_ok", "(", "VERIFY_READ", ",", "mcp", ",", "sizeof", "(", "*", "mcp", ")", "))", "return", "-", "EFAULT", ";", "#", "endif", "restore_sigmask", "(", "&", "set", ")", ";", "if", "(", "restore_user_regs", "(", "regs", ",", "mcp", ",", "sig", ")", ")", "@", "@", "-", "908", ",", "13", "+", "911", ",", "14", "@", "@", "int", "sys_debug_setcontext", "(", "struct", "ucontext", "__user", "*", "ctx", ",", "{", "struct", "sig_dbg_op", "op", ";", "int", "i", ";", "unsigned", "char", "tmp", ";", "unsigned", "long", "new_msr", "=", "regs", "-", ">", "msr", ";", "#", "if", "defined", "(", "CONFIG_4xx", ")", "|", "|", "defined", "(", "CONFIG_BOOKE", ")", "unsigned", "long", "new_dbcr0", "=", "current", "-", ">", "thread", ".", "dbcr0", ";", "#", "endif", "for", "(", "i", "=", "0", ";", "i", "<", "ndbg", ";", "i", "+", "+)", "{", "if", "(", "__copy_from_user", "(", "&", "op", ",", "dbg", ",", "sizeof", "(", "op", ")", "))", "if", "(", "copy_from_user", "(", "&", "op", ",", "dbg", "+", "i", ",", "sizeof", "(", "op", ")", "))", "return", "-", "EFAULT", ";", "switch", "(", "op", ".", "dbg_type", ")", "{", "case", "SIG_DBG_SINGLE_STEPPING", ":", "@", "@", "-", "959", ",", "6", "+", "963", ",", "11", "@", "@", "int", "sys_debug_setcontext", "(", "struct", "ucontext", "__user", "*", "ctx", ",", "current", "-", ">", "thread", ".", "dbcr0", "=", "new_dbcr0", ";", "#", "endif", "if", "(", "!", "access_ok", "(", "VERIFY_READ", ",", "ctx", ",", "sizeof", "(", "*", "ctx", ")", ")", "|", "|", "__get_user", "(", "tmp", ",", "(", "u8", "__user", "*", ")", "ctx", ")", "|", "|", "__get_user", "(", "tmp", ",", "(", "u8", "__user", "*", ")", "(", "ctx", "+", "1", ")", "-", "1", ")", ")", "return", "-", "EFAULT", ";", "/", "*", "*", "If", "we", "get", "a", "fault", "copying", "the", "context", "into", "the", "kernel", "'", "s", "*", "image", "of", "the", "user", "'", "s", "registers", ",", "we", "can", "'", "t", "just", "return", "-", "EFAULT", "@", "@", "-", "182", ",", "6", "+", "182", ",", "8", "@", "@", "static", "long", "restore_sigcontext", "(", "struct", "pt_regs", "*", "regs", ",", "sigset_t", "*", "set", ",", "int", "sig", ",", "err", "|", "=", "__get_user", "(", "msr", ",", "&", "sc", "-", ">", "gp_regs", "[", "PT_MSR", "]", ");", "if", "(", "err", ")", "return", "err", ";", "if", "(", "v_regs", "&", "&", "!", "access_ok", "(", "VERIFY_READ", ",", "v_regs", ",", "34", "*", "sizeof", "(", "vector128", ")", "))", "return", "-", "EFAULT", ";", "/", "*", "Copy", "33", "vec", "registers", "(", "vr0", ".", ".", "31", "and", "vscr", ")", "from", "the", "stack", "*", "/", "if", "(", "v_regs", "!", "=", "0", "&", "&", "(", "msr", "&", "MSR_VEC", ")", "!", "=", "0", ")", "err", "|", "=", "__copy_from_user", "(", "current", "-", ">", "thread", ".", "vr", ",", "v_regs", ","], "docstring_tokens": ["read", "portions", "of", "kernel", "memory", "on", "64-bit", "systems", "and", "read", "portions", "of", "kernel", "memory", "or", "cause", "a", "denial", "of", "service", "on", "32-bit", "systems"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "36", ",", "6", "+", "36", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Example", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "ExampleMatcher", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "ExampleMatcher", ".", "PropertyValueTransformer", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "core", ".", "support", ".", "ExampleMatcherAccessor", ";", "import", "org", ".", "springframework", ".", "data", ".", "util", ".", "DirectFieldAccessFallbackBeanWrapper", ";", "import", "org", ".", "springframework", ".", "lang", ".", "Nullable", ";", "@", "@", "-", "55", ",", "6", "+", "56", ",", "7", "@", "@", "*", "@", "author", "Christoph", "Strobl", "*", "@", "author", "Mark", "Paluch", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Jens", "Schauder", "*", "@", "since", "1", ".", "10", "*", "/", "public", "class", "QueryByExamplePredicateBuilder", "{", "@", "@", "-", "76", ",", "9", "+", "78", ",", "11", "@", "@", "*", "@", "param", "root", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "cb", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "example", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "escapeCharacter", "*", "@", "return", "never", "{", "@", "literal", "null", "}", ".", "*", "/", "public", "static", "<", "T", ">", "Predicate", "getPredicate", "(", "Root", "<", "T", ">", "root", ",", "CriteriaBuilder", "cb", ",", "Example", "<", "T", ">", "example", ")", "{", "public", "static", "<", "T", ">", "Predicate", "getPredicate", "(", "Root", "<", "T", ">", "root", ",", "CriteriaBuilder", "cb", ",", "Example", "<", "T", ">", "example", ",", "EscapeCharacter", "escapeCharacter", ")", "{", "Assert", ".", "notNull", "(", "root", ",", "\"", "Root", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notNull", "(", "cb", ",", "\"", "CriteriaBuilder", "must", "not", "be", "null", "!", "\")", ";", "@", "@", "-", "87", ",", "7", "+", "91", ",", "8", "@", "@", "ExampleMatcher", "matcher", "=", "example", ".", "getMatcher", "(", ");", "List", "<", "Predicate", ">", "predicates", "=", "getPredicates", "(", "\"\"", ",", "cb", ",", "root", ",", "root", ".", "getModel", "(", "),", "example", ".", "getProbe", "(", "),", "example", ".", "getProbeType", "(", "),", "new", "ExampleMatcherAccessor", "(", "matcher", ")", ",", "new", "PathNode", "(", "\"", "root", "\"", ",", "null", ",", "example", ".", "getProbe", "(", "))", ");", "example", ".", "getProbeType", "(", "),", "new", "ExampleMatcherAccessor", "(", "matcher", ")", ",", "new", "PathNode", "(", "\"", "root", "\"", ",", "null", ",", "example", ".", "getProbe", "(", "))", ",", "escapeCharacter", ")", ";", "if", "(", "predicates", ".", "isEmpty", "(", "))", "{", "return", "cb", ".", "isTrue", "(", "cb", ".", "literal", "(", "true", ")", ");", "@", "@", "-", "104", ",", "7", "+", "109", ",", "8", "@", "@", "@", "SuppressWarnings", "(", "{", "\"", "rawtypes", "\"", ",", "\"", "unchecked", "\"", "}", ")", "static", "List", "<", "Predicate", ">", "getPredicates", "(", "String", "path", ",", "CriteriaBuilder", "cb", ",", "Path", "<", "?>", "from", ",", "ManagedType", "<", "?>", "type", ",", "Object", "value", ",", "Class", "<", "?>", "probeType", ",", "ExampleMatcherAccessor", "exampleAccessor", ",", "PathNode", "currentNode", ")", "{", "Class", "<", "?>", "probeType", ",", "ExampleMatcherAccessor", "exampleAccessor", ",", "PathNode", "currentNode", ",", "EscapeCharacter", "escapeCharacter", ")", "{", "List", "<", "Predicate", ">", "predicates", "=", "new", "ArrayList", "<", ">(", ");", "DirectFieldAccessFallbackBeanWrapper", "beanWrapper", "=", "new", "DirectFieldAccessFallbackBeanWrapper", "(", "value", ")", ";", "@", "@", "-", "133", ",", "8", "+", "139", ",", "9", "@", "@", "if", "(", "attribute", ".", "getPersistentAttributeType", "(", ").", "equals", "(", "PersistentAttributeType", ".", "EMBEDDED", ")", ")", "{", "predicates", ".", "addAll", "(", "getPredicates", "(", "currentPath", ",", "cb", ",", "from", ".", "get", "(", "attribute", ".", "getName", "(", "))", ",", "(", "ManagedType", "<", "?>", ")", "attribute", ".", "getType", "(", "),", "attributeValue", ",", "probeType", ",", "exampleAccessor", ",", "currentNode", ")", ");", "predicates", ".", "addAll", "(", "getPredicates", "(", "currentPath", ",", "cb", ",", "from", ".", "get", "(", "attribute", ".", "getName", "(", "))", ",", "(", "ManagedType", "<", "?>", ")", "attribute", ".", "getType", "(", "),", "attributeValue", ",", "probeType", ",", "exampleAccessor", ",", "currentNode", ",", "escapeCharacter", ")", ");", "continue", ";", "}", "@", "@", "-", "153", ",", "7", "+", "160", ",", "7", "@", "@", "}", "predicates", ".", "addAll", "(", "getPredicates", "(", "currentPath", ",", "cb", ",", "(", "(", "From", "<", "?,", "?", ">)", "from", ")", ".", "join", "(", "attribute", ".", "getName", "(", "))", ",", "(", "ManagedType", "<", "?>", ")", "attribute", ".", "getType", "(", "),", "attributeValue", ",", "probeType", ",", "exampleAccessor", ",", "node", ")", ");", "(", "ManagedType", "<", "?>", ")", "attribute", ".", "getType", "(", "),", "attributeValue", ",", "probeType", ",", "exampleAccessor", ",", "node", ",", "escapeCharacter", ")", ");", "continue", ";", "}", "@", "@", "-", "173", ",", "13", "+", "180", ",", "25", "@", "@", "predicates", ".", "add", "(", "cb", ".", "equal", "(", "expression", ",", "attributeValue", ")", ");", "break", ";", "case", "CONTAINING", ":", "predicates", ".", "add", "(", "cb", ".", "like", "(", "expression", ",", "\"", "%\"", "+", "attributeValue", "+", "\"", "%\"", "))", ";", "predicates", ".", "add", "(", "cb", ".", "like", "(", "/", "/", "expression", ",", "/", "/", "\"", "%\"", "+", "escapeCharacter", ".", "escape", "(", "attributeValue", ".", "toString", "(", "))", "+", "\"", "%\"", ",", "/", "/", "escapeCharacter", ".", "getEscapeCharacter", "(", ")", "/", "/", ")", ");", "break", ";", "case", "STARTING", ":", "predicates", ".", "add", "(", "cb", ".", "like", "(", "expression", ",", "attributeValue", "+", "\"", "%\"", "))", ";", "predicates", ".", "add", "(", "cb", ".", "like", "(", "//", "expression", ",", "/", "/", "escapeCharacter", ".", "escape", "(", "attributeValue", ".", "toString", "(", "))", "+", "\"", "%\"", ",", "/", "/", "escapeCharacter", ".", "getEscapeCharacter", "(", "))", "/", "/", ")", ";", "break", ";", "case", "ENDING", ":", "predicates", ".", "add", "(", "cb", ".", "like", "(", "expression", ",", "\"", "%\"", "+", "attributeValue", ")", ");", "predicates", ".", "add", "(", "cb", ".", "like", "(", "/", "/", "expression", ",", "/", "/", "\"", "%\"", "+", "escapeCharacter", ".", "escape", "(", "attributeValue", ".", "toString", "(", "))", ",", "/", "/", "escapeCharacter", ".", "getEscapeCharacter", "(", "))", "/", "/", ")", ";", "break", ";", "default", ":", "throw", "new", "IllegalArgumentException", "(", "@", "@", "-", "133", ",", "6", "+", "133", ",", "7", "@", "@", "public", "void", "setEscapeCharacter", "(", "EscapeCharacter", "escapeCharacter", ")", "{", "JpaRepositoryImplementation", "<", "?,", "?", ">", "repository", "=", "getTargetRepository", "(", "information", ",", "entityManager", ")", ";", "repository", ".", "setRepositoryMethodMetadata", "(", "crudMethodMetadataPostProcessor", ".", "getCrudMethodMetadata", "(", "))", ";", "repository", ".", "setEscapeCharacter", "(", "escapeCharacter", ")", ";", "return", "repository", ";", "}", "@", "@", "-", "17", ",", "13", "+", "17", ",", "15", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "JpaRepository", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "JpaSpecificationExecutor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "NoRepositoryBean", ";", "/", "**", "*", "SPI", "interface", "to", "be", "implemented", "by", "{", "@", "link", "JpaRepository", "}", "implementations", ".", "*", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Stefan", "Fussenegger", "*", "@", "author", "Jens", "Schauder", "*", "/", "@", "NoRepositoryBean", "public", "interface", "JpaRepositoryImplementation", "<", "T", ",", "ID", ">", "extends", "JpaRepository", "<", "T", ",", "ID", ">", ",", "JpaSpecificationExecutor", "<", "T", ">", "{", "@", "@", "-", "34", ",", "4", "+", "36", ",", "11", "@", "@", "*", "@", "param", "crudMethodMetadata", "must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "void", "setRepositoryMethodMetadata", "(", "CrudMethodMetadata", "crudMethodMetadata", ")", ";", "/", "**", "*", "Configures", "the", "{", "@", "link", "EscapeCharacter", "}", "to", "be", "used", "with", "the", "repository", ".", "*", "*", "@", "param", "escapeCharacter", "Must", "not", "be", "{", "@", "literal", "null", "}", ".", "*", "/", "void", "setEscapeCharacter", "(", "EscapeCharacter", "escapeCharacter", ")", ";", "}", "@", "@", "-", "48", ",", "6", "+", "48", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "domain", ".", "Specification", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "provider", ".", "PersistenceProvider", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "EntityGraph", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "QueryUtils", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ".", "QueryHints", ".", "NoHints", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "support", ".", "PageableExecutionUtils", ";", "@", "@", "-", "81", ",", "6", "+", "82", ",", "7", "@", "@", "private", "final", "PersistenceProvider", "provider", ";", "private", "@", "Nullable", "CrudMethodMetadata", "metadata", ";", "private", "EscapeCharacter", "escapeCharacter", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "SimpleJpaRepository", "}", "to", "manage", "objects", "of", "the", "given", "{", "@", "link", "JpaEntityInformation", "}", ".", "@", "@", "-", "118", ",", "6", "+", "120", ",", "11", "@", "@", "public", "void", "setRepositoryMethodMetadata", "(", "CrudMethodMetadata", "crudMethodMetadata", ")", "{", "this", ".", "metadata", "=", "crudMethodMetadata", ";", "}", "@", "Override", "public", "void", "setEscapeCharacter", "(", "EscapeCharacter", "escapeCharacter", ")", "{", "this", ".", "escapeCharacter", "=", "escapeCharacter", ";", "}", "@", "Nullable", "protected", "CrudMethodMetadata", "getRepositoryMethodMetadata", "(", ")", "{", "return", "metadata", ";", "@", "@", "-", "405", ",", "7", "+", "412", ",", "7", "@", "@", "public", "boolean", "existsById", "(", "ID", "id", ")", "{", "try", "{", "return", "Optional", ".", "of", "(", "getQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ")", ",", "example", ".", "getProbeType", "(", "),", "Sort", ".", "unsorted", "(", "))", ".", "getSingleResult", "(", "))", ";", "getQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ",", "escapeCharacter", ")", ",", "example", ".", "getProbeType", "(", "),", "Sort", ".", "unsorted", "(", "))", ".", "getSingleResult", "(", "))", ";", "}", "catch", "(", "NoResultException", "e", ")", "{", "return", "Optional", ".", "empty", "(", ");", "}", "@", "@", "-", "417", ",", "7", "+", "424", ",", "7", "@", "@", "public", "boolean", "existsById", "(", "ID", "id", ")", "{", "*", "/", "@", "Override", "public", "<", "S", "extends", "T", ">", "long", "count", "(", "Example", "<", "S", ">", "example", ")", "{", "return", "executeCountQuery", "(", "getCountQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ")", ",", "example", ".", "getProbeType", "(", "))", ");", "return", "executeCountQuery", "(", "getCountQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ",", "escapeCharacter", ")", ",", "example", ".", "getProbeType", "(", "))", ");", "}", "/", "*", "@", "@", "-", "426", ",", "7", "+", "433", ",", "7", "@", "@", "public", "boolean", "existsById", "(", "ID", "id", ")", "{", "*", "/", "@", "Override", "public", "<", "S", "extends", "T", ">", "boolean", "exists", "(", "Example", "<", "S", ">", "example", ")", "{", "return", "!", "getQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ")", ",", "example", ".", "getProbeType", "(", "),", "Sort", ".", "unsorted", "(", "))", ".", "getResultList", "(", ")", "return", "!", "getQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ",", "escapeCharacter", ")", ",", "example", ".", "getProbeType", "(", "),", "Sort", ".", "unsorted", "(", "))", ".", "getResultList", "(", ")", ".", "isEmpty", "(", ");", "}", "@", "@", "-", "436", ",", "7", "+", "443", ",", "7", "@", "@", "public", "boolean", "existsById", "(", "ID", "id", ")", "{", "*", "/", "@", "Override", "public", "<", "S", "extends", "T", ">", "List", "<", "S", ">", "findAll", "(", "Example", "<", "S", ">", "example", ")", "{", "return", "getQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ")", ",", "example", ".", "getProbeType", "(", "),", "Sort", ".", "unsorted", "(", "))", ".", "getResultList", "(", ");", "return", "getQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ",", "escapeCharacter", ")", ",", "example", ".", "getProbeType", "(", "),", "Sort", ".", "unsorted", "(", "))", ".", "getResultList", "(", ");", "}", "/", "*", "@", "@", "-", "445", ",", "7", "+", "452", ",", "7", "@", "@", "public", "boolean", "existsById", "(", "ID", "id", ")", "{", "*", "/", "@", "Override", "public", "<", "S", "extends", "T", ">", "List", "<", "S", ">", "findAll", "(", "Example", "<", "S", ">", "example", ",", "Sort", "sort", ")", "{", "return", "getQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ")", ",", "example", ".", "getProbeType", "(", "),", "sort", ")", ".", "getResultList", "(", ");", "return", "getQuery", "(", "new", "ExampleSpecification", "<", "S", ">", "(", "example", ",", "escapeCharacter", ")", ",", "example", ".", "getProbeType", "(", "),", "sort", ")", ".", "getResultList", "(", ");", "}", "/", "*", "@", "@", "-", "455", ",", "9", "+", "462", ",", "9", "@", "@", "public", "boolean", "existsById", "(", "ID", "id", ")", "{", "@", "Override", "public", "<", "S", "extends", "T", ">", "Page", "<", "S", ">", "findAll", "(", "Example", "<", "S", ">", "example", ",", "Pageable", "pageable", ")", "{", "ExampleSpecification", "<", "S", ">", "spec", "=", "new", "ExampleSpecification", "<", ">(", "example", ")", ";", "ExampleSpecification", "<", "S", ">", "spec", "=", "new", "ExampleSpecification", "<", ">(", "example", ",", "escapeCharacter", ")", ";", "Class", "<", "S", ">", "probeType", "=", "example", ".", "getProbeType", "(", ");", "TypedQuery", "<", "S", ">", "query", "=", "getQuery", "(", "new", "ExampleSpecification", "<", ">(", "example", ")", ",", "probeType", ",", "pageable", ")", ";", "TypedQuery", "<", "S", ">", "query", "=", "getQuery", "(", "new", "ExampleSpecification", "<", ">(", "example", ",", "escapeCharacter", ")", ",", "probeType", ",", "pageable", ")", ";", "return", "isUnpaged", "(", "pageable", ")", "?", "new", "PageImpl", "<", ">(", "query", ".", "getResultList", "(", "))", ":", "readPage", "(", "query", ",", "probeType", ",", "pageable", ",", "spec", ")", ";", "}", "@", "@", "-", "791", ",", "16", "+", "798", ",", "21", "@", "@", "public", "Predicate", "toPredicate", "(", "Root", "<", "T", ">", "root", ",", "CriteriaQuery", "<", "?>", "query", ",", "CriteriaBuild", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "private", "final", "Example", "<", "T", ">", "example", ";", "private", "final", "EscapeCharacter", "escapeCharacter", ";", "/", "**", "*", "Creates", "new", "{", "@", "link", "ExampleSpecification", "}", ".", "*", "*", "@", "param", "example", "*", "@", "param", "escapeCharacter", "*", "/", "ExampleSpecification", "(", "Example", "<", "T", ">", "example", ")", "{", "ExampleSpecification", "(", "Example", "<", "T", ">", "example", ",", "EscapeCharacter", "escapeCharacter", ")", "{", "Assert", ".", "notNull", "(", "example", ",", "\"", "Example", "must", "not", "be", "null", "!", "\")", ";", "Assert", ".", "notNull", "(", "escapeCharacter", ",", "\"", "EscapeCharacter", "must", "not", "be", "null", "!", "\")", ";", "this", ".", "example", "=", "example", ";", "this", ".", "escapeCharacter", "=", "escapeCharacter", ";", "}", "/", "*", "@", "@", "-", "809", ",", "7", "+", "821", ",", "7", "@", "@", "public", "Predicate", "toPredicate", "(", "Root", "<", "T", ">", "root", ",", "CriteriaQuery", "<", "?>", "query", ",", "CriteriaBuild", "*", "/", "@", "Override", "public", "Predicate", "toPredicate", "(", "Root", "<", "T", ">", "root", ",", "CriteriaQuery", "<", "?>", "query", ",", "CriteriaBuilder", "cb", ")", "{", "return", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "example", ")", ";", "return", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "example", ",", "escapeCharacter", ")", ";", "}", "}", "}", "@", "@", "-", "48", ",", "6", "+", "48", ",", "7", "@", "@", "import", "org", ".", "mockito", ".", "junit", ".", "MockitoJUnitRunner", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "Example", ";", "import", "org", ".", "springframework", ".", "data", ".", "domain", ".", "ExampleMatcher", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "util", ".", "ObjectUtils", ";", "/", "**", "@", "@", "-", "56", ",", "6", "+", "57", ",", "7", "@", "@", "*", "@", "author", "Christoph", "Strobl", "*", "@", "author", "Mark", "Paluch", "*", "@", "author", "Oliver", "Gierke", "*", "@", "author", "Jens", "Schauder", "*", "/", "@", "RunWith", "(", "MockitoJUnitRunner", ".", "Silent", ".", "class", ")", "@", "SuppressWarnings", "(", "{", "\"", "rawtypes", "\"", ",", "\"", "unchecked", "\"", "}", ")", "@", "@", "-", "118", ",", "22", "+", "120", ",", "23", "@", "@", "public", "void", "setUp", "(", ")", "{", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "/", "/", "DATAJPA", "-", "218", "public", "void", "getPredicateShouldThrowExceptionOnNullRoot", "(", ")", "{", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "null", ",", "cb", ",", "of", "(", "new", "Person", "(", "))", ");", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "null", ",", "cb", ",", "of", "(", "new", "Person", "(", "))", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "/", "/", "DATAJPA", "-", "218", "public", "void", "getPredicateShouldThrowExceptionOnNullCriteriaBuilder", "(", ")", "{", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "null", ",", "of", "(", "new", "Person", "(", "))", ");", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "null", ",", "of", "(", "new", "Person", "(", "))", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "}", "@", "Test", "(", "expected", "=", "IllegalArgumentException", ".", "class", ")", "/", "/", "DATAJPA", "-", "218", "public", "void", "getPredicateShouldThrowExceptionOnNullExample", "(", ")", "{", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "null", ",", "null", ")", ";", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "null", ",", "null", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "}", "@", "Test", "/", "/", "DATAJPA", "-", "218", "public", "void", "emptyCriteriaListShouldResultTruePredicate", "(", ")", "{", "assertThat", "(", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "of", "(", "new", "Person", "(", "))", "),", "equalTo", "(", "truePredicate", ")", ");", "assertThat", "(", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "of", "(", "new", "Person", "(", "))", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ",", "equalTo", "(", "truePredicate", ")", ");", "}", "@", "Test", "/", "/", "DATAJPA", "-", "218", "@", "@", "-", "142", ",", "7", "+", "145", ",", "8", "@", "@", "public", "void", "singleElementCriteriaShouldJustReturnIt", "(", ")", "{", "Person", "p", "=", "new", "Person", "(", ");", "p", ".", "firstname", "=", "\"", "foo", "\"", ";", "assertThat", "(", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "of", "(", "p", ")", "),", "equalTo", "(", "dummyPredicate", ")", ");", "assertThat", "(", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "of", "(", "p", ")", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ",", "equalTo", "(", "dummyPredicate", ")", ");", "verify", "(", "cb", ",", "times", "(", "1", ")", ").", "equal", "(", "any", "(", "Expression", ".", "class", ")", ",", "eq", "(", "\"", "foo", "\"", "))", ";", "}", "@", "@", "-", "157", ",", "7", "+", "161", ",", "7", "@", "@", "public", "void", "unresolvableNestedAssociatedPathShouldFail", "(", ")", "{", "exception", ".", "expectCause", "(", "IsInstanceOf", ".", "<", "Throwable", ">", "instanceOf", "(", "IllegalArgumentException", ".", "class", ")", ");", "exception", ".", "expectMessage", "(", "\"", "Unexpected", "path", "type", "\"", ");", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "of", "(", "p", ")", ");", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "of", "(", "p", ")", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "}", "@", "Test", "/", "/", "DATAJPA", "-", "218", "@", "@", "-", "167", ",", "7", "+", "171", ",", "8", "@", "@", "public", "void", "multiPredicateCriteriaShouldReturnCombinedOnes", "(", ")", "{", "p", ".", "firstname", "=", "\"", "foo", "\"", ";", "p", ".", "age", "=", "2L", ";", "assertThat", "(", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "of", "(", "p", ")", "),", "equalTo", "(", "andPredicate", ")", ");", "assertThat", "(", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "of", "(", "p", ")", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ",", "equalTo", "(", "andPredicate", ")", ");", "verify", "(", "cb", ",", "times", "(", "1", ")", ").", "equal", "(", "any", "(", "Expression", ".", "class", ")", ",", "eq", "(", "\"", "foo", "\"", "))", ";", "verify", "(", "cb", ",", "times", "(", "1", ")", ").", "equal", "(", "any", "(", "Expression", ".", "class", ")", ",", "eq", "(", "2L", ")", ");", "@", "@", "-", "182", ",", "11", "+", "187", ",", "67", "@", "@", "public", "void", "orConcatenatesPredicatesIfMatcherSpecifies", "(", ")", "{", "Example", "<", "Person", ">", "example", "=", "of", "(", "person", ",", "ExampleMatcher", ".", "matchingAny", "(", "))", ";", "assertThat", "(", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "example", ")", ",", "equalTo", "(", "orPredicate", ")", ");", "assertThat", "(", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "example", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ",", "equalTo", "(", "orPredicate", ")", ");", "verify", "(", "cb", ",", "times", "(", "1", ")", ").", "or", "(", "ArgumentMatchers", ".", "any", "(", "))", ";", "}", "@", "Test", "/", "/", "DATAJPA", "-", "1534", "public", "void", "likePatternsGetEscapedContaining", "(", ")", "{", "Person", "person", "=", "new", "Person", "(", ");", "person", ".", "firstname", "=", "\"", "f", "\\", "\\", "o_o", "\"", ";", "Example", "<", "Person", ">", "example", "=", "of", "(", "/", "/", "person", ",", "/", "/", "ExampleMatcher", "/", "/", ".", "matchingAny", "(", ")", "/", "/", ".", "withStringMatcher", "(", "ExampleMatcher", ".", "StringMatcher", ".", "CONTAINING", ")", "/", "/", ")", ";", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "example", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "verify", "(", "cb", ",", "times", "(", "1", ")", ").", "like", "(", "any", "(", "Expression", ".", "class", ")", ",", "eq", "(", "\"%", "f", "\\", "\\\\", "\\", "o", "\\", "\\", "_o", "%", "\")", ",", "eq", "(", "'\\", "\\'", "))", ";", "}", "@", "Test", "/", "/", "DATAJPA", "-", "1534", "public", "void", "likePatternsGetEscapedStarting", "(", ")", "{", "Person", "person", "=", "new", "Person", "(", ");", "person", ".", "firstname", "=", "\"", "f", "\\", "\\", "o_o", "\"", ";", "Example", "<", "Person", ">", "example", "=", "of", "(", "/", "/", "person", ",", "/", "/", "ExampleMatcher", "/", "/", ".", "matchingAny", "(", ")", "/", "/", ".", "withStringMatcher", "(", "ExampleMatcher", ".", "StringMatcher", ".", "STARTING", ")", "/", "/", ")", ";", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "example", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "verify", "(", "cb", ",", "times", "(", "1", ")", ").", "like", "(", "any", "(", "Expression", ".", "class", ")", ",", "eq", "(", "\"", "f", "\\", "\\\\", "\\", "o", "\\", "\\", "_o", "%", "\")", ",", "eq", "(", "'\\", "\\'", "))", ";", "}", "@", "Test", "/", "/", "DATAJPA", "-", "1534", "public", "void", "likePatternsGetEscapedEnding", "(", ")", "{", "Person", "person", "=", "new", "Person", "(", ");", "person", ".", "firstname", "=", "\"", "f", "\\", "\\", "o_o", "\"", ";", "Example", "<", "Person", ">", "example", "=", "of", "(", "/", "/", "person", ",", "/", "/", "ExampleMatcher", "/", "/", ".", "matchingAny", "(", ")", "/", "/", ".", "withStringMatcher", "(", "ExampleMatcher", ".", "StringMatcher", ".", "ENDING", ")", "/", "/", ")", ";", "QueryByExamplePredicateBuilder", ".", "getPredicate", "(", "root", ",", "cb", ",", "example", ",", "EscapeCharacter", ".", "of", "(", "'\\", "\\'", "))", ";", "verify", "(", "cb", ",", "times", "(", "1", ")", ").", "like", "(", "any", "(", "Expression", ".", "class", ")", ",", "eq", "(", "\"%", "f", "\\", "\\\\", "\\", "o", "\\", "\\", "_o", "\"", "),", "eq", "(", "'\\", "\\'", "))", ";", "}", "static", "class", "Person", "{", "@", "Id", "Long", "id", ";"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "453", ",", "9", "+", "453", ",", "9", "@", "@", "static", "Image", "*", "ReadTXTImage", "(", "const", "ImageInfo", "*", "image_info", ",", "ExceptionInfo", "*", "exception", ")", "ThrowReaderException", "(", "CorruptImageError", ",", "\"", "ImproperImageHeader", "\"", ");", "image", "-", ">", "columns", "=", "width", ";", "image", "-", ">", "rows", "=", "height", ";", "for", "(", "depth", "=", "1", ";", "(", "GetQuantumRange", "(", "depth", ")", "+", "1", ")", "<", "max_value", ";", "depth", "+", "+)", "if", "(", "depth", ">", "=", "64", ")", "break", ";", "if", "(", "(", "max_value", "=", "=", "0", ")", "|", "|", "(", "max_value", ">", "4294967295", ")", ")", "ThrowReaderException", "(", "CorruptImageError", ",", "\"", "ImproperImageHeader", "\"", ");", "for", "(", "depth", "=", "1", ";", "(", "GetQuantumRange", "(", "depth", ")", "+", "1", ")", "<", "max_value", ";", "depth", "+", "+)", ";", "image", "-", ">", "depth", "=", "depth", ";", "status", "=", "SetImageExtent", "(", "image", ",", "image", "-", ">", "columns", ",", "image", "-", ">", "rows", ")", ";", "if", "(", "status", "=", "=", "MagickFalse", ")"], "docstring_tokens": ["an", "infinite", "loop"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "286", ",", "30", "+", "286", ",", "41", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "String", "answer", ";", "/", "/", "overrule", "takes", "precedence", "String", "overrule", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "Exchange", ".", "OVERRULE_FILE_NAME", ",", "String", ".", "class", ")", ";", "String", "consumed", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "Exchange", ".", "FILE_NAME_CONSUMED", ",", "String", ".", "class", ")", ";", "String", "name", "=", "overrule", "=", "=", "null", "?", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "Exchange", ".", "FILE_NAME", ",", "String", ".", "class", ")", ":", "overrule", ";", "Object", "value", ";", "Object", "overrule", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "Exchange", ".", "OVERRULE_FILE_NAME", ")", ";", "if", "(", "overrule", "!", "=", "null", ")", "{", "if", "(", "overrule", "instanceof", "Expression", ")", "{", "value", "=", "overrule", ";", "}", "else", "{", "value", "=", "exchange", ".", "getContext", "(", ").", "getTypeConverter", "(", ").", "convertTo", "(", "String", ".", "class", ",", "exchange", ",", "overrule", ")", ";", "}", "}", "else", "{", "value", "=", "exchange", ".", "getIn", "(", ").", "getHeader", "(", "Exchange", ".", "FILE_NAME", ")", ";", "}", "/", "/", "if", "we", "have", "an", "overrule", "then", "override", "the", "existing", "header", "to", "use", "the", "overrule", "computed", "name", "from", "this", "point", "forward", "if", "(", "overrule", "!", "=", "null", ")", "{", "exchange", ".", "getIn", "(", ").", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "name", ")", ";", "exchange", ".", "getIn", "(", ").", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "value", ")", ";", "}", "if", "(", "value", "!", "=", "null", "&", "&", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "log", ".", "warn", "(", "\"", "Simple", "expression", ":", "{", "}", "detected", "in", "header", ":", "{", "}", "of", "type", "String", ".", "This", "feature", "has", "been", "removed", "(", "see", "CAMEL", "-", "6748", ")", ".\"", ",", "value", ",", "Exchange", ".", "FILE_NAME", ")", ";", "}", "/", "/", "expression", "support", "Expression", "expression", "=", "endpoint", ".", "getFileName", "(", ");", "if", "(", "name", "!", "=", "null", "&", "&", "!", "name", ".", "equals", "(", "consumed", ")", ")", "{", "/", "/", "the", "header", "name", "can", "be", "an", "expression", "too", ",", "that", "should", "override", "/", "/", "whatever", "configured", "on", "the", "endpoint", "if", "(", "StringHelper", ".", "hasStartToken", "(", "name", ",", "\"", "simple", "\"", "))", "{", "log", ".", "trace", "(", "\"{", "}", "contains", "a", "Simple", "expression", ":", "{", "}\"", ",", "Exchange", ".", "FILE_NAME", ",", "name", ")", ";", "Language", "language", "=", "getEndpoint", "(", ").", "getCamelContext", "(", ").", "resolveLanguage", "(", "\"", "file", "\"", ");", "expression", "=", "language", ".", "createExpression", "(", "name", ")", ";", "}", "if", "(", "value", "!", "=", "null", "&", "&", "value", "instanceof", "Expression", ")", "{", "expression", "=", "(", "Expression", ")", "value", ";", "}", "/", "/", "evaluate", "the", "name", "as", "a", "String", "from", "the", "value", "String", "name", ";", "if", "(", "expression", "!", "=", "null", ")", "{", "log", ".", "trace", "(", "\"", "Filename", "evaluated", "as", "expression", ":", "{", "}\"", ",", "expression", ")", ";", "name", "=", "expression", ".", "evaluate", "(", "exchange", ",", "String", ".", "class", ")", ";", "}", "else", "{", "name", "=", "exchange", ".", "getContext", "(", ").", "getTypeConverter", "(", ").", "convertTo", "(", "String", ".", "class", ",", "exchange", ",", "value", ")", ";", "}", "/", "/", "flatten", "name", "@", "@", "-", "22", ",", "6", "+", "22", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "impl", ".", "JndiRegistry", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "language", ".", "simple", ".", "SimpleLanguage", ".", "simple", ";", "/", "**", "*", "Unit", "test", "for", "expression", "option", "for", "file", "consumer", ".", "*", "/", "@", "@", "-", "70", ",", "7", "+", "72", ",", "7", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "public", "void", "testConsumeFileBasedOnDatePattern", "(", ")", "throws", "Exception", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "/", "date", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "myfile", "-", "20081128", ".", "txt", "\"", ");", "template", ".", "sendBodyAndHeader", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "/", "date", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "myfile", "-", "20081129", ".", "txt", "\"", ");", "template", ".", "sendBodyAndHeader", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "/", "date", "\"", ",", "\"", "Goodday", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "myfile", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ");", "template", ".", "sendBodyAndHeader", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "/", "date", "\"", ",", "\"", "Goodday", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\"", "myfile", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", "))", ";", "context", ".", "addRoutes", "(", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "@", "@", "-", "1", ",", "62", "+", "0", ",", "0", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ";", "import", "java", ".", "text", ".", "SimpleDateFormat", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "TreeMap", ";", "import", "org", ".", "apache", ".", "camel", ".", "ContextTestSupport", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "/", "**", "*", "@", "version", "*", "/", "public", "class", "FileProducerConsumedFileNameEvaluationTest", "extends", "ContextTestSupport", "{", "@", "Override", "protected", "void", "setUp", "(", ")", "throws", "Exception", "{", "deleteDirectory", "(", "\"", "target", "/", "producerconsumedfilename", "\"", ");", "super", ".", "setUp", "(", ");", "}", "public", "void", "testFileNameNotEvaluatedWhenMatchingConsumed", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "Object", ">", "headers", "=", "new", "TreeMap", "<", "String", ",", "Object", ">", "()", ";", "headers", ".", "put", "(", "Exchange", ".", "FILE_NAME", ",", "\"", "file", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", "\")", ";", "headers", ".", "put", "(", "Exchange", ".", "FILE_NAME_CONSUMED", ",", "\"", "file", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", "\")", ";", "template", ".", "sendBodyAndHeaders", "(", "\"", "file", ":", "//", "target", "/", "producerconsumedfilename", "\"", ",", "\"", "Hello", "World", "\"", ",", "headers", ")", ";", "assertFileExists", "(", "\"", "target", "/", "producerconsumedfilename", "/", "file", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", "\")", ";", "}", "public", "void", "testFileNameEvaluatedWhenNotMatchingConsumed", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "Object", ">", "headers", "=", "new", "TreeMap", "<", "String", ",", "Object", ">", "()", ";", "headers", ".", "put", "(", "Exchange", ".", "FILE_NAME", ",", "\"", "file", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ");", "headers", ".", "put", "(", "Exchange", ".", "FILE_NAME_CONSUMED", ",", "\"", "file", "-", "consumed", "\"", ");", "template", ".", "sendBodyAndHeaders", "(", "\"", "file", ":", "//", "target", "/", "producerconsumedfilename", "\"", ",", "\"", "Hello", "World", "\"", ",", "headers", ")", ";", "String", "date", "=", "new", "SimpleDateFormat", "(", "\"", "yyyyMMdd", "\"", ").", "format", "(", "new", "Date", "(", "))", ";", "assertFileExists", "(", "\"", "target", "/", "producerconsumedfilename", "/", "file", "-", "\"", "+", "date", "+", "\"", ".", "txt", "\"", ");", "}", "public", "void", "testFileNameEvaluatedWhenConsumedNull", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "Object", ">", "headers", "=", "new", "TreeMap", "<", "String", ",", "Object", ">", "()", ";", "headers", ".", "put", "(", "Exchange", ".", "FILE_NAME", ",", "\"", "file", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ");", "template", ".", "sendBodyAndHeaders", "(", "\"", "file", ":", "//", "target", "/", "producerconsumedfilename", "\"", ",", "\"", "Hello", "World", "\"", ",", "headers", ")", ";", "String", "date", "=", "new", "SimpleDateFormat", "(", "\"", "yyyyMMdd", "\"", ").", "format", "(", "new", "Date", "(", "))", ";", "assertFileExists", "(", "\"", "target", "/", "producerconsumedfilename", "/", "file", "-", "\"", "+", "date", "+", "\"", ".", "txt", "\"", ");", "}", "}", "@", "@", "-", "24", ",", "6", "+", "24", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "impl", ".", "JndiRegistry", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "language", ".", "simple", ".", "SimpleLanguage", ".", "simple", ";", "/", "**", "*", "Unit", "test", "for", "expression", "option", "for", "file", "producer", ".", "*", "/", "@", "@", "-", "42", ",", "11", "+", "44", ",", "9", "@", "@", "protected", "JndiRegistry", "createRegistry", "(", ")", "throws", "Exception", "{", "return", "jndi", ";", "}", "public", "void", "testProduceBeanByHeader", "(", ")", "throws", "Exception", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "${", "bean", ":", "myguidgenerator", "}", ".", "bak", "\"", ");", "assertFileExists", "(", "\"", "target", "/", "filelanguage", "/", "123", ".", "bak", "\"", ");", "public", "void", "testProducerFileNameHeaderNotEvaluated", "(", ")", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "$", "simple", "{", "myfile", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", "}.", "txt", "\"", ");", "assertFileExists", "(", "\"", "target", "/", "filelanguage", "/", "$", "simple", "{", "myfile", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", "}.", "txt", "\"", ");", "}", "public", "void", "testProduceBeanByExpression", "(", ")", "throws", "Exception", "{", "@", "@", "-", "57", ",", "7", "+", "57", ",", "7", "@", "@", "public", "void", "testProduceBeanByExpression", "(", ")", "throws", "Exception", "{", "public", "void", "testProducerDateByHeader", "(", ")", "throws", "Exception", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "myfile", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ");", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\"", "myfile", "-", "${", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", "))", ";", "String", "date", "=", "new", "SimpleDateFormat", "(", "\"", "yyyyMMdd", "\"", ").", "format", "(", "new", "Date", "(", "))", ";", "assertFileExists", "(", "\"", "target", "/", "filelanguage", "/", "myfile", "-", "\"", "+", "date", "+", "\"", ".", "txt", "\"", ");", "@", "@", "-", "32", ",", "6", "+", "32", ",", "8", "@", "@", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "static", "org", ".", "apache", ".", "camel", ".", "language", ".", "simple", ".", "SimpleLanguage", ".", "simple", ";", "/", "**", "*", "Base", "class", "for", "unit", "testing", "using", "a", "FTPServer", "*", "/", "@", "@", "-", "125", ",", "7", "+", "127", ",", "7", "@", "@", "protected", "FtpServerFactory", "createFtpServerFactory", "(", ")", "throws", "Exception", "{", "}", "public", "void", "sendFile", "(", "String", "url", ",", "Object", "body", ",", "String", "fileName", ")", "{", "template", ".", "sendBodyAndHeader", "(", "url", ",", "body", ",", "Exchange", ".", "FILE_NAME", ",", "fileName", ")", ";", "template", ".", "sendBodyAndHeader", "(", "url", ",", "body", ",", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "fileName", ")", ");", "}", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system", "with", "elevated", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "387", ",", "13", "+", "387", ",", "22", "@", "@", "static", "void", "ion_handle_get", "(", "struct", "ion_handle", "*", "handle", ")", "kref_get", "(", "&", "handle", "-", ">", "ref", ")", ";", "}", "static", "int", "ion_handle_put", "(", "struct", "ion_handle", "*", "handle", ")", "static", "int", "ion_handle_put_nolock", "(", "struct", "ion_handle", "*", "handle", ")", "{", "int", "ret", ";", "ret", "=", "kref_put", "(", "&", "handle", "-", ">", "ref", ",", "ion_handle_destroy", ")", ";", "return", "ret", ";", "}", "int", "ion_handle_put", "(", "struct", "ion_handle", "*", "handle", ")", "{", "struct", "ion_client", "*", "client", "=", "handle", "-", ">", "client", ";", "int", "ret", ";", "mutex_lock", "(", "&", "client", "-", ">", "lock", ")", ";", "ret", "=", "kref_put", "(", "&", "handle", "-", ">", "ref", ",", "ion_handle_destroy", ")", ";", "ret", "=", "ion_handle_put_nolock", "(", "handle", ")", ";", "mutex_unlock", "(", "&", "client", "-", ">", "lock", ")", ";", "return", "ret", ";", "@", "@", "-", "417", ",", "20", "+", "426", ",", "30", "@", "@", "static", "struct", "ion_handle", "*", "ion_handle_lookup", "(", "struct", "ion_client", "*", "client", ",", "return", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "}", "static", "struct", "ion_handle", "*", "ion_handle_get_by_id", "(", "struct", "ion_client", "*", "client", ",", "static", "struct", "ion_handle", "*", "ion_handle_get_by_id_nolock", "(", "struct", "ion_client", "*", "client", ",", "int", "id", ")", "{", "struct", "ion_handle", "*", "handle", ";", "mutex_lock", "(", "&", "client", "-", ">", "lock", ")", ";", "handle", "=", "idr_find", "(", "&", "client", "-", ">", "idr", ",", "id", ")", ";", "if", "(", "handle", ")", "ion_handle_get", "(", "handle", ")", ";", "mutex_unlock", "(", "&", "client", "-", ">", "lock", ")", ";", "return", "handle", "?", "handle", ":", "ERR_PTR", "(", "-", "EINVAL", ")", ";", "}", "struct", "ion_handle", "*", "ion_handle_get_by_id", "(", "struct", "ion_client", "*", "client", ",", "int", "id", ")", "{", "struct", "ion_handle", "*", "handle", ";", "mutex_lock", "(", "&", "client", "-", ">", "lock", ")", ";", "handle", "=", "ion_handle_get_by_id_nolock", "(", "client", ",", "id", ")", ";", "mutex_unlock", "(", "&", "client", "-", ">", "lock", ")", ";", "return", "handle", ";", "}", "static", "bool", "ion_handle_validate", "(", "struct", "ion_client", "*", "client", ",", "struct", "ion_handle", "*", "handle", ")", "{", "@", "@", "-", "532", ",", "22", "+", "551", ",", "28", "@", "@", "struct", "ion_handle", "*", "ion_alloc", "(", "struct", "ion_client", "*", "client", ",", "size_t", "len", ",", "}", "EXPORT_SYMBOL", "(", "ion_alloc", ")", ";", "void", "ion_free", "(", "struct", "ion_client", "*", "client", ",", "struct", "ion_handle", "*", "handle", ")", "static", "void", "ion_free_nolock", "(", "struct", "ion_client", "*", "client", ",", "struct", "ion_handle", "*", "handle", ")", "{", "bool", "valid_handle", ";", "BUG_ON", "(", "client", "!", "=", "handle", "-", ">", "client", ")", ";", "mutex_lock", "(", "&", "client", "-", ">", "lock", ")", ";", "valid_handle", "=", "ion_handle_validate", "(", "client", ",", "handle", ")", ";", "if", "(", "!", "valid_handle", ")", "{", "WARN", "(", "1", ",", "\"", "%", "s", ":", "invalid", "handle", "passed", "to", "free", ".", "\\", "n", "\"", ",", "__func__", ")", ";", "mutex_unlock", "(", "&", "client", "-", ">", "lock", ")", ";", "return", ";", "}", "ion_handle_put_nolock", "(", "handle", ")", ";", "}", "void", "ion_free", "(", "struct", "ion_client", "*", "client", ",", "struct", "ion_handle", "*", "handle", ")", "{", "BUG_ON", "(", "client", "!", "=", "handle", "-", ">", "client", ")", ";", "mutex_lock", "(", "&", "client", "-", ">", "lock", ")", ";", "ion_free_nolock", "(", "client", ",", "handle", ")", ";", "mutex_unlock", "(", "&", "client", "-", ">", "lock", ")", ";", "ion_handle_put", "(", "handle", ")", ";", "}", "EXPORT_SYMBOL", "(", "ion_free", ")", ";", "@", "@", "-", "1332", ",", "11", "+", "1357", ",", "15", "@", "@", "static", "long", "ion_ioctl", "(", "struct", "file", "*", "filp", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "{", "struct", "ion_handle", "*", "handle", ";", "handle", "=", "ion_handle_get_by_id", "(", "client", ",", "data", ".", "handle", ".", "handle", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "mutex_lock", "(", "&", "client", "-", ">", "lock", ")", ";", "handle", "=", "ion_handle_get_by_id_nolock", "(", "client", ",", "data", ".", "handle", ".", "handle", ")", ";", "if", "(", "IS_ERR", "(", "handle", ")", ")", "{", "mutex_unlock", "(", "&", "client", "-", ">", "lock", ")", ";", "return", "PTR_ERR", "(", "handle", ")", ";", "ion_free", "(", "client", ",", "handle", ")", ";", "ion_handle_put", "(", "handle", ")", ";", "}", "ion_free_nolock", "(", "client", ",", "handle", ")", ";", "ion_handle_put_nolock", "(", "handle", ")", ";", "mutex_unlock", "(", "&", "client", "-", ">", "lock", ")", ";", "break", ";", "}", "case", "ION_IOC_SHARE", ":"], "docstring_tokens": ["gain", "privileges", "or", "cause", "a", "denial", "of", "service", "(use-after-free", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "386", ",", "6", "+", "386", ",", "8", "@", "@", "int", "copy_creds", "(", "struct", "task_struct", "*", "p", ",", "unsigned", "long", "clone_flags", ")", "struct", "cred", "*", "new", ";", "int", "ret", ";", "p", "-", ">", "replacement_session_keyring", "=", "NULL", ";", "if", "(", "#", "ifdef", "CONFIG_KEYS", "!", "p", "-", ">", "cred", "-", ">", "thread_keyring", "&", "&"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(panic", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "174", ",", "6", "+", "174", ",", "7", "@", "@", "struct", "dh_st", "{", "/", "*", "DH_check_pub_key", "error", "codes", "*", "/", "#", "define", "DH_CHECK_PUBKEY_TOO_SMALL", "0x01", "#", "define", "DH_CHECK_PUBKEY_TOO_LARGE", "0x02", "#", "define", "DH_CHECK_PUBKEY_INVALID", "0x03", "/", "*", "*", "primes", "p", "where", "(", "p", "-", "1", ")", "/", "2", "is", "prime", "too", "are", "called", "\"", "safe", "\"", ";", "we", "define", "this", "for", "@", "@", "-", "151", ",", "23", "+", "151", ",", "38", "@", "@", "int", "DH_check", "(", "const", "DH", "*", "dh", ",", "int", "*", "ret", ")", "int", "DH_check_pub_key", "(", "const", "DH", "*", "dh", ",", "const", "BIGNUM", "*", "pub_key", ",", "int", "*", "ret", ")", "{", "int", "ok", "=", "0", ";", "BIGNUM", "*", "q", "=", "NULL", ";", "BIGNUM", "*", "tmp", "=", "NULL", ";", "BN_CTX", "*", "ctx", "=", "NULL", ";", "*", "ret", "=", "0", ";", "q", "=", "BN_new", "(", ");", "if", "(", "q", "=", "=", "NULL", ")", "ctx", "=", "BN_CTX_new", "(", ");", "if", "(", "ctx", "=", "=", "NULL", ")", "goto", "err", ";", "BN_set_word", "(", "q", ",", "1", ")", ";", "if", "(", "BN_cmp", "(", "pub_key", ",", "q", ")", "<", "=", "0", ")", "BN_CTX_start", "(", "ctx", ")", ";", "tmp", "=", "BN_CTX_get", "(", "ctx", ")", ";", "if", "(", "tmp", "=", "=", "NULL", ")", "goto", "err", ";", "BN_set_word", "(", "tmp", ",", "1", ")", ";", "if", "(", "BN_cmp", "(", "pub_key", ",", "tmp", ")", "<", "=", "0", ")", "*", "ret", "|", "=", "DH_CHECK_PUBKEY_TOO_SMALL", ";", "BN_copy", "(", "q", ",", "dh", "-", ">", "p", ")", ";", "BN_sub_word", "(", "q", ",", "1", ")", ";", "if", "(", "BN_cmp", "(", "pub_key", ",", "q", ")", ">", "=", "0", ")", "BN_copy", "(", "tmp", ",", "dh", "-", ">", "p", ")", ";", "BN_sub_word", "(", "tmp", ",", "1", ")", ";", "if", "(", "BN_cmp", "(", "pub_key", ",", "tmp", ")", ">", "=", "0", ")", "*", "ret", "|", "=", "DH_CHECK_PUBKEY_TOO_LARGE", ";", "if", "(", "dh", "-", ">", "q", "!", "=", "NULL", ")", "{", "/", "*", "Check", "pub_key", "^", "q", "=", "=", "1", "mod", "p", "*", "/", "if", "(", "!", "BN_mod_exp", "(", "tmp", ",", "pub_key", ",", "dh", "-", ">", "q", ",", "dh", "-", ">", "p", ",", "ctx", ")", ")", "goto", "err", ";", "if", "(", "!", "BN_is_one", "(", "tmp", ")", ")", "*", "ret", "|", "=", "DH_CHECK_PUBKEY_INVALID", ";", "}", "ok", "=", "1", ";", "err", ":", "if", "(", "q", "!", "=", "NULL", ")", "BN_free", "(", "q", ")", ";", "if", "(", "ctx", "!", "=", "NULL", ")", "{", "BN_CTX_end", "(", "ctx", ")", ";", "BN_CTX_free", "(", "ctx", ")", ";", "}", "return", "(", "ok", ")", ";", "}"], "docstring_tokens": ["conduct", "man-in-the-middle", "attacks"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "907", ",", "7", "+", "907", ",", "8", "@", "@", "SMB2_tcon", "(", "const", "unsigned", "int", "xid", ",", "struct", "cifs_ses", "*", "ses", ",", "const", "char", "*", "tree", ",", "tcon_error_exit", ":", "if", "(", "rsp", "-", ">", "hdr", ".", "Status", "=", "=", "STATUS_BAD_NETWORK_NAME", ")", "{", "cifs_dbg", "(", "VFS", ",", "\"", "BAD_NETWORK_NAME", ":", "%", "s", "\\", "n", "\"", ",", "tree", ")", ";", "tcon", "-", ">", "bad_network_name", "=", "true", ";", "if", "(", "tcon", ")", "tcon", "-", ">", "bad_network_name", "=", "true", ";", "}", "goto", "tcon_exit", ";", "}"], "docstring_tokens": ["the", "kernel", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "427", ",", "16", "+", "427", ",", "9", "@", "@", "EXPORT_SYMBOL_GPL", "(", "register_user_hw_breakpoint", ")", ";", "*", "modify_user_hw_breakpoint", "-", "modify", "a", "user", "-", "space", "hardware", "breakpoint", "*", "@", "bp", ":", "the", "breakpoint", "structure", "to", "modify", "*", "@", "attr", ":", "new", "breakpoint", "attributes", "*", "@", "triggered", ":", "callback", "to", "trigger", "when", "we", "hit", "the", "breakpoint", "*", "@", "tsk", ":", "pointer", "to", "'", "task_struct", "'", "of", "the", "process", "to", "which", "the", "address", "belongs", "*", "/", "int", "modify_user_hw_breakpoint", "(", "struct", "perf_event", "*", "bp", ",", "struct", "perf_event_attr", "*", "attr", ")", "{", "u64", "old_addr", "=", "bp", "-", ">", "attr", ".", "bp_addr", ";", "u64", "old_len", "=", "bp", "-", ">", "attr", ".", "bp_len", ";", "int", "old_type", "=", "bp", "-", ">", "attr", ".", "bp_type", ";", "int", "err", "=", "0", ";", "/", "*", "*", "modify_user_hw_breakpoint", "can", "be", "invoked", "with", "IRQs", "disabled", "and", "hence", "it", "*", "will", "not", "be", "possible", "to", "raise", "IPIs", "that", "invoke", "__perf_event_disable", ".", "@", "@", "-", "451", ",", "27", "+", "444", ",", "18", "@", "@", "int", "modify_user_hw_breakpoint", "(", "struct", "perf_event", "*", "bp", ",", "struct", "perf_event_attr", "*", "att", "bp", "-", ">", "attr", ".", "bp_addr", "=", "attr", "-", ">", "bp_addr", ";", "bp", "-", ">", "attr", ".", "bp_type", "=", "attr", "-", ">", "bp_type", ";", "bp", "-", ">", "attr", ".", "bp_len", "=", "attr", "-", ">", "bp_len", ";", "bp", "-", ">", "attr", ".", "disabled", "=", "1", ";", "if", "(", "attr", "-", ">", "disabled", ")", "goto", "end", ";", "err", "=", "validate_hw_breakpoint", "(", "bp", ")", ";", "if", "(", "!", "err", ")", "perf_event_enable", "(", "bp", ")", ";", "if", "(", "!", "attr", "-", ">", "disabled", ")", "{", "int", "err", "=", "validate_hw_breakpoint", "(", "bp", ")", ";", "if", "(", "err", ")", "{", "bp", "-", ">", "attr", ".", "bp_addr", "=", "old_addr", ";", "bp", "-", ">", "attr", ".", "bp_type", "=", "old_type", ";", "bp", "-", ">", "attr", ".", "bp_len", "=", "old_len", ";", "if", "(", "!", "bp", "-", ">", "attr", ".", "disabled", ")", "perf_event_enable", "(", "bp", ")", ";", "if", "(", "err", ")", "return", "err", ";", "return", "err", ";", "perf_event_enable", "(", "bp", ")", ";", "bp", "-", ">", "attr", ".", "disabled", "=", "0", ";", "}", "end", ":", "bp", "-", ">", "attr", ".", "disabled", "=", "attr", "-", ">", "disabled", ";", "return", "0", ";", "}", "EXPORT_SYMBOL_GPL", "(", "modify_user_hw_breakpoint", ")", ";"], "docstring_tokens": ["the", "error", "handling", "is", "still", "wrong", "but", "the", "defect", "results", "in", "a", "disabled", "breakpoint", "instead", "of", "an", "incorrect", "breakpoint"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "492", ",", "6", "+", "492", ",", "11", "@", "@", "static", "void", "vcpu_pause", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "wait_event_interruptible", "(", "*", "wq", ",", "!", "vcpu", "-", ">", "arch", ".", "pause", ")", ";", "}", "static", "int", "kvm_vcpu_initialized", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "return", "vcpu", "-", ">", "arch", ".", "target", ">", "=", "0", ";", "}", "/", "**", "*", "kvm_arch_vcpu_ioctl_run", "-", "the", "main", "VCPU", "run", "function", "to", "execute", "guest", "code", "*", "@", "vcpu", ":", "The", "VCPU", "pointer", "@", "@", "-", "508", ",", "8", "+", "513", ",", "7", "@", "@", "int", "kvm_arch_vcpu_ioctl_run", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "struct", "kvm_run", "*", "run", ")", "int", "ret", ";", "sigset_t", "sigsaved", ";", "/", "*", "Make", "sure", "they", "initialize", "the", "vcpu", "with", "KVM_ARM_VCPU_INIT", "*", "/", "if", "(", "unlikely", "(", "vcpu", "-", ">", "arch", ".", "target", "<", "0", ")", ")", "if", "(", "unlikely", "(", "!", "kvm_vcpu_initialized", "(", "vcpu", ")", "))", "return", "-", "ENOEXEC", ";", "ret", "=", "kvm_vcpu_first_run_init", "(", "vcpu", ")", ";", "@", "@", "-", "710", ",", "6", "+", "714", ",", "10", "@", "@", "long", "kvm_arch_vcpu_ioctl", "(", "struct", "file", "*", "filp", ",", "case", "KVM_SET_ONE_REG", ":", "case", "KVM_GET_ONE_REG", ":", "{", "struct", "kvm_one_reg", "reg", ";", "if", "(", "unlikely", "(", "!", "kvm_vcpu_initialized", "(", "vcpu", ")", "))", "return", "-", "ENOEXEC", ";", "if", "(", "copy_from_user", "(", "&", "reg", ",", "argp", ",", "sizeof", "(", "reg", ")", "))", "return", "-", "EFAULT", ";", "if", "(", "ioctl", "=", "=", "KVM_SET_ONE_REG", ")", "@", "@", "-", "722", ",", "6", "+", "730", ",", "9", "@", "@", "long", "kvm_arch_vcpu_ioctl", "(", "struct", "file", "*", "filp", ",", "struct", "kvm_reg_list", "reg_list", ";", "unsigned", "n", ";", "if", "(", "unlikely", "(", "!", "kvm_vcpu_initialized", "(", "vcpu", ")", "))", "return", "-", "ENOEXEC", ";", "if", "(", "copy_from_user", "(", "&", "reg_list", ",", "user_list", ",", "sizeof", "(", "reg_list", ")", "))", "return", "-", "EFAULT", ";", "n", "=", "reg_list", ".", "n", ";"], "docstring_tokens": ["the", "kernel", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "268", ",", "7", "+", "268", ",", "7", "@", "@", "static", "X509_ALGOR", "*", "rsa_mgf1_decode", "(", "X509_ALGOR", "*", "alg", ")", "{", "const", "unsigned", "char", "*", "p", ";", "int", "plen", ";", "if", "(", "alg", "=", "=", "NULL", ")", "if", "(", "alg", "=", "=", "NULL", "|", "|", "alg", "-", ">", "parameter", "=", "=", "NULL", ")", "return", "NULL", ";", "if", "(", "OBJ_obj2nid", "(", "alg", "-", ">", "algorithm", ")", "!", "=", "NID_mgf1", ")", "return", "NULL", ";"], "docstring_tokens": ["any", "certificate", "verification", "operation", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "34", ",", "6", "+", "34", ",", "7", "@", "@", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "Exported", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "ExportedBean", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "export", ".", "Flavor", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "/", "**", "*", "Entry", "point", "of", "the", "global", "build", "stats", "plugin", "@", "@", "-", "46", ",", "7", "+", "47", ",", "7", "@", "@", "/", "**", "*", "List", "of", "aggregated", "job", "build", "results", "*", "This", "list", "will", "grow", "over", "time", ",", "but", "will", "be", "monthly", "sharded", "in", "different", "files", "to", "keep", "*", "This", "list", "will", "grow", "over", "time", ",", "butgit", "diff", "will", "be", "monthly", "sharded", "in", "different", "files", "to", "keep", "*", "save", "(", ")", "time", "constant", "*", "/", "private", "JobBuildResultSharder", "jobBuildResultsSharder", "=", "new", "JobBuildResultSharder", "(", ");", "@", "@", "-", "80", ",", "6", "+", "81", ",", "11", "@", "@", "*", "/", "private", "transient", "final", "GlobalBuildStatsValidator", "validator", "=", "new", "GlobalBuildStatsValidator", "(", ");", "/", "**", "*", "application", "/", "json", "ContentType", "for", "StaplerResponse", "*", "/", "private", "final", "static", "String", "CONTENT_TYPE", "=", "\"", "application", "/", "json", "\"", ";", "/", "**", "*", "Expose", "{", "@", "link", "GlobalBuildStatsPlugin", "}", "to", "the", "remote", "API", ":", "*", "-", "Either", "all", "build", "stat", "configuration", "data", "@", "@", "-", "330", ",", "6", "+", "336", ",", "7", "@", "@", "public", "void", "doBuildHistory", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "Servl", "req", ".", "getView", "(", "this", ",", "\"", "/", "hudson", "/", "plugins", "/", "global_build_stats", "/", "GlobalBuildStatsPlugin", "/", "buildHistory", ".", "jelly", "\"", ").", "forward", "(", "req", ",", "res", ")", ";", "}", "@", "RequirePOST", "public", "void", "doUpdateBuildStatConfiguration", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "ServletException", ",", "IOException", "{", "Hudson", ".", "getInstance", "(", ").", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "@", "@", "-", "339", ",", "19", "+", "346", ",", "23", "@", "@", "public", "void", "doUpdateBuildStatConfiguration", "(", "StaplerRequest", "req", ",", "StaplerResponse", "r", "business", ".", "updateBuildStatConfiguration", "(", "req", ".", "getParameter", "(", "\"", "buildStatId", "\"", "),", "config", ",", "regenerateId", ")", ";", "String", "json", "=", "JSONObject", ".", "fromObject", "(", "config", ")", ".", "toString", "(", ");", "res", ".", "setContentType", "(", "CONTENT_TYPE", ")", ";", "res", ".", "getWriter", "(", ").", "write", "(", "json", ")", ";", "}", "@", "RequirePOST", "public", "void", "doAddBuildStatConfiguration", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "ServletException", ",", "IOException", "{", "Hudson", ".", "getInstance", "(", ").", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "BuildStatConfiguration", "config", "=", "FromRequestObjectFactory", ".", "createBuildStatConfiguration", "(", "ModelIdGenerator", ".", "INSTANCE", ".", "generateIdForClass", "(", "BuildStatConfiguration", ".", "class", ")", ",", "req", ")", ";", "business", ".", "addBuildStatConfiguration", "(", "config", ")", ";", "String", "json", "=", "JSONObject", ".", "fromObject", "(", "config", ")", ".", "toString", "(", ");", "res", ".", "setContentType", "(", "CONTENT_TYPE", ")", ";", "res", ".", "getWriter", "(", ").", "write", "(", "json", ")", ";", "}", "@", "RequirePOST", "public", "void", "doDeleteConfiguration", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "ServletException", ",", "IOException", "{", "Hudson", ".", "getInstance", "(", ").", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "@", "@", "-", "360", ",", "6", "+", "371", ",", "7", "@", "@", "public", "void", "doDeleteConfiguration", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throw", "respondAjaxOk", "(", "res", ")", ";", "}", "@", "RequirePOST", "public", "void", "doMoveUpConf", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "ServletException", ",", "IOException", "{", "Hudson", ".", "getInstance", "(", ").", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "@", "@", "-", "368", ",", "6", "+", "380", ",", "7", "@", "@", "public", "void", "doMoveUpConf", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "Servlet", "respondAjaxOk", "(", "res", ")", ";", "}", "@", "RequirePOST", "public", "void", "doMoveDownConf", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "ServletException", ",", "IOException", "{", "Hudson", ".", "getInstance", "(", ").", "checkPermission", "(", "getRequiredPermission", "(", "))", ";", "@", "@", "-", "376", ",", "6", "+", "389", ",", "7", "@", "@", "public", "void", "doMoveDownConf", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "Servl", "respondAjaxOk", "(", "res", ")", ";", "}", "@", "RequirePOST", "public", "void", "doUpdateRetentionStrategies", "(", "StaplerRequest", "req", ",", "StaplerResponse", "res", ")", "throws", "ServletException", ",", "IOException", "{", "Hudson", ".", "getInstance", "(", ").", "checkPermission", "(", "getRequiredPermission", "(", "))", ";"], "docstring_tokens": ["modify", "this", "data"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "791", ",", "7", "+", "791", ",", "7", "@", "@", "int", "__kvm_set_memory_region", "(", "struct", "kvm", "*", "kvm", ",", "/", "*", "destroy", "any", "largepage", "mappings", "for", "dirty", "tracking", "*", "/", "}", "if", "(", "!", "npages", ")", "{", "if", "(", "!", "npages", "|", "|", "base_gfn", "!", "=", "old", ".", "base_gfn", ")", "{", "struct", "kvm_memory_slot", "*", "slot", ";", "r", "=", "-", "ENOMEM", ";", "@", "@", "-", "807", ",", "8", "+", "807", ",", "8", "@", "@", "int", "__kvm_set_memory_region", "(", "struct", "kvm", "*", "kvm", ",", "old_memslots", "=", "kvm", "-", ">", "memslots", ";", "rcu_assign_pointer", "(", "kvm", "-", ">", "memslots", ",", "slots", ")", ";", "synchronize_srcu_expedited", "(", "&", "kvm", "-", ">", "srcu", ")", ";", "/", "*", "From", "this", "point", "no", "new", "shadow", "pages", "pointing", "to", "a", "deleted", "*", "memslot", "will", "be", "created", ".", "/", "*", "From", "this", "point", "no", "new", "shadow", "pages", "pointing", "to", "a", "deleted", ",", "*", "or", "moved", ",", "memslot", "will", "be", "created", ".", "*", "*", "validation", "of", "sp", "-", ">", "gfn", "happens", "in", ":", "*", "-", "gfn_to_hva", "(", "kvm_read_guest", ",", "gfn_to_pfn", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "71", ",", "6", "+", "71", ",", "7", "@", "@", "wsFrame", ".", "noContinuation", "=", "A", "new", "message", "was", "started", "when", "a", "continuation", "frame", "was", "e", "wsFrame", ".", "notMasked", "=", "The", "client", "frame", "was", "not", "masked", "but", "all", "client", "frames", "must", "be", "masked", "wsFrame", ".", "oneByteCloseCode", "=", "The", "client", "sent", "a", "close", "frame", "with", "a", "single", "byte", "payload", "which", "is", "not", "valid", "wsFrame", ".", "partialHeaderComplete", "=", "WebSocket", "frame", "received", ".", "fin", "[", "{", "0", "}", "],", "rsv", "[", "{", "1", "}", "],", "OpCode", "[", "{", "2", "}", "],", "payload", "length", "[", "{", "3", "}", "]", "wsFrame", ".", "payloadMsbInvalid", "=", "An", "invalid", "WebSocket", "frame", "was", "received", "-", "the", "most", "significant", "bit", "of", "a", "64", "-", "bit", "payload", "was", "illegally", "set", "wsFrame", ".", "sessionClosed", "=", "The", "client", "data", "cannot", "be", "processed", "because", "the", "session", "has", "already", "been", "closed", "wsFrame", ".", "suspendRequested", "=", "Suspend", "of", "the", "message", "receiving", "has", "already", "been", "requested", ".", "wsFrame", ".", "textMessageTooBig", "=", "The", "decoded", "text", "message", "was", "too", "big", "for", "the", "output", "buffer", "and", "the", "endpoint", "does", "not", "support", "partial", "messages", "@", "@", "-", "261", ",", "6", "+", "261", ",", "13", "@", "@", "private", "boolean", "processRemainingHeader", "(", ")", "throws", "IOException", "{", "}", "else", "if", "(", "payloadLength", "=", "=", "127", ")", "{", "payloadLength", "=", "byteArrayToLong", "(", "inputBuffer", ".", "array", "(", "),", "inputBuffer", ".", "arrayOffset", "(", ")", "+", "inputBuffer", ".", "position", "(", "),", "8", ")", ";", "/", "/", "The", "most", "significant", "bit", "of", "those", "8", "bytes", "is", "required", "to", "be", "zero", "/", "/", "(", "see", "RFC", "6455", ",", "section", "5", ".", "2", ")", ".", "If", "the", "most", "significant", "bit", "is", "set", ",", "/", "/", "the", "resulting", "payload", "length", "will", "be", "negative", "so", "test", "for", "that", ".", "if", "(", "payloadLength", "<", "0", ")", "{", "throw", "new", "WsIOException", "(", "new", "CloseReason", "(", "CloseCodes", ".", "PROTOCOL_ERROR", ",", "sm", ".", "getString", "(", "\"", "wsFrame", ".", "payloadMsbInvalid", "\"", "))", ");", "}", "inputBuffer", ".", "position", "(", "inputBuffer", ".", "position", "(", ")", "+", "8", ")", ";", "}", "if", "(", "Util", ".", "isControl", "(", "opCode", ")", ")", "{", "@", "@", "-", "127", ",", "6", "+", "127", ",", "14", "@", "@", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "WebSocket", "\"", ">", "<", "changelog", ">", "<", "fix", ">", "<", "bug", ">", "64563", "<", "/", "bug", ">", ":", "Add", "additional", "validation", "of", "payload", "length", "for", "WebSocket", "messages", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Other", "\"", ">", "<", "changelog", ">", "<", "fix", ">"], "docstring_tokens": ["trigger", "an", "infinite", "loop", ".", "Multiple", "requests", "with", "invalid", "payload", "lengths", "could", "lead", "to", "a", "denial", "of", "service", "."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "262", ",", "8", "+", "262", ",", "10", "@", "@", "void", "__kvm_migrate_pit_timer", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "return", ";", "timer", "=", "&", "pit", "-", ">", "pit_state", ".", "timer", ";", "mutex_lock", "(", "&", "pit", "-", ">", "pit_state", ".", "lock", ")", ";", "if", "(", "hrtimer_cancel", "(", "timer", ")", ")", "hrtimer_start_expires", "(", "timer", ",", "HRTIMER_MODE_ABS", ")", ";", "mutex_unlock", "(", "&", "pit", "-", ">", "pit_state", ".", "lock", ")", ";", "}", "static", "void", "destroy_pit_timer", "(", "struct", "kvm_pit", "*", "pit", ")"], "docstring_tokens": ["the", "host", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "18", ",", "28", "+", "18", ",", "28", "@", "@", "static", "struct", "ctl_table", "llc2_timeout_table", "[", "]", "=", "{", "{", ".", "procname", "=", "\"", "ack", "\"", ",", ".", "data", "=", "&", "sysctl_llc2_ack_timeout", ",", ".", "maxlen", "=", "sizeof", "(", "long", ")", ",", ".", "maxlen", "=", "sizeof", "(", "sysctl_llc2_ack_timeout", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_jiffies", ",", "}", ",", "{", ".", "procname", "=", "\"", "busy", "\"", ",", ".", "data", "=", "&", "sysctl_llc2_busy_timeout", ",", ".", "maxlen", "=", "sizeof", "(", "long", ")", ",", ".", "maxlen", "=", "sizeof", "(", "sysctl_llc2_busy_timeout", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_jiffies", ",", "}", ",", "{", ".", "procname", "=", "\"", "p", "\"", ",", ".", "data", "=", "&", "sysctl_llc2_p_timeout", ",", ".", "maxlen", "=", "sizeof", "(", "long", ")", ",", ".", "maxlen", "=", "sizeof", "(", "sysctl_llc2_p_timeout", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_jiffies", ",", "}", ",", "{", ".", "procname", "=", "\"", "rej", "\"", ",", ".", "data", "=", "&", "sysctl_llc2_rej_timeout", ",", ".", "maxlen", "=", "sizeof", "(", "long", ")", ",", ".", "maxlen", "=", "sizeof", "(", "sysctl_llc2_rej_timeout", ")", ",", ".", "mode", "=", "0644", ",", ".", "proc_handler", "=", "proc_dointvec_jiffies", ",", "}", ","], "docstring_tokens": ["obtain", "potentially", "sensitive", "information", "from", "kernel", "memory", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "155", ",", "6", "+", "155", ",", "10", "@", "@", "/", "*", "rdi", ":", "prev", "*", "/", "ENTRY", "(", "ret_from_fork", ")", "CFI_DEFAULT_STACK", "push", "kernel_eflags", "(", "%", "rip", ")", "CFI_ADJUST_CFA_OFFSET", "4", "popf", "#", "reset", "kernel", "eflags", "CFI_ADJUST_CFA_OFFSET", "-", "4", "call", "schedule_tail", "GET_THREAD_INFO", "(", "%", "rcx", ")", "testl", "$", "(", "_TIF_SYSCALL_TRACE", "|", "_TIF_SYSCALL_AUDIT", ")", ",", "threadinfo_flags", "(", "%", "rcx", ")", "@", "@", "-", "180", ",", "6", "+", "180", ",", "8", "@", "@", "void", "__cpuinit", "check_efer", "(", "void", ")", "}", "}", "unsigned", "long", "kernel_eflags", ";", "/", "*", "*", "cpu_init", "(", ")", "initializes", "state", "that", "is", "per", "-", "CPU", ".", "Some", "data", "is", "already", "*", "initialized", "(", "naturally", ")", "in", "the", "bootstrap", "process", ",", "such", "as", "the", "GDT", "@", "@", "-", "281", ",", "4", "+", "283", ",", "6", "@", "@", "void", "__cpuinit", "cpu_init", "(", "void", ")", "set_debugreg", "(", "0UL", ",", "7", ")", ";", "fpu_init", "(", ");", "raw_local_save_flags", "(", "kernel_eflags", ")", ";", "}", "@", "@", "-", "14", ",", "12", "+", "14", ",", "13", "@", "@", "#", "define", "__RESTORE", "(", "reg", ",", "offset", ")", "\"", "movq", "(", "14", "-", "\"", "#", "offset", "\"", ")*", "8", "(", "%%", "rsp", ")", ",%", "%\"", "#", "reg", "\"", "\\", "n", "\\", "t", "\"", "/", "*", "frame", "pointer", "must", "be", "last", "for", "get_wchan", "*", "/", "#", "define", "SAVE_CONTEXT", "\"", "pushq", "%", "%", "rbp", ";", "movq", "%", "%", "rsi", ",", "%%", "rbp", "\\", "n", "\\", "t", "\"", "#", "define", "RESTORE_CONTEXT", "\"", "movq", "%", "%", "rbp", ",", "%%", "rsi", ";", "popq", "%", "%", "rbp", "\\", "n", "\\", "t", "\"", "#", "define", "SAVE_CONTEXT", "\"", "pushf", ";", "pushq", "%", "%", "rbp", ";", "movq", "%", "%", "rsi", ",", "%%", "rbp", "\\", "n", "\\", "t", "\"", "#", "define", "RESTORE_CONTEXT", "\"", "movq", "%", "%", "rbp", ",", "%%", "rsi", ";", "popq", "%", "%", "rbp", ";", "popf", "\\", "t", "\"", "#", "define", "__EXTRA_CLOBBER", "\\", ",", "\"", "rcx", "\"", ",\"", "rbx", "\"", ",\"", "rdx", "\"", ",\"", "r8", "\"", ",\"", "r9", "\"", ",\"", "r10", "\"", ",\"", "r11", "\"", ",\"", "r12", "\"", ",\"", "r13", "\"", ",\"", "r14", "\"", ",\"", "r15", "\"", "/", "*", "Save", "restore", "flags", "to", "clear", "handle", "leaking", "NT", "*", "/", "#", "define", "switch_to", "(", "prev", ",", "next", ",", "last", ")", "\\", "asm", "volatile", "(", "SAVE_CONTEXT", "\\", "\"", "movq", "%", "%", "rsp", ",", "%", "P", "[", "threadrsp", "]", "(%", "[", "prev", "]", ")\\", "n", "\\", "t", "\"", "/", "*", "save", "RSP", "*", "/", "\\"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(crash", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "646", ",", "6", "+", "646", ",", "8", "@", "@", "static", "int", "llcp_sock_recvmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "pr_debug", "(", "\"%", "p", "%", "zu", "\\", "n", "\"", ",", "sk", ",", "len", ")", ";", "msg", "-", ">", "msg_namelen", "=", "0", ";", "lock_sock", "(", "sk", ")", ";", "if", "(", "sk", "-", ">", "sk_state", "=", "=", "LLCP_CLOSED", "&", "&", "@", "@", "-", "691", ",", "6", "+", "693", ",", "7", "@", "@", "static", "int", "llcp_sock_recvmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "pr_debug", "(", "\"", "Datagram", "socket", "%", "d", "%", "d", "\\", "n", "\"", ",", "ui_cb", "-", ">", "dsap", ",", "ui_cb", "-", ">", "ssap", ")", ";", "memset", "(", "sockaddr", ",", "0", ",", "sizeof", "(", "*", "sockaddr", ")", ");", "sockaddr", "-", ">", "sa_family", "=", "AF_NFC", ";", "sockaddr", "-", ">", "nfc_protocol", "=", "NFC_PROTO_NFC_DEP", ";", "sockaddr", "-", ">", "dsap", "=", "ui_cb", "-", ">", "dsap", ";"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "stack", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "import", "java", ".", "nio", ".", "charset", ".", "Charset", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "org", ".", "springframework", ".", "amqp", ".", "utils", ".", "SerializationUtils", ";", "import", "org", ".", "springframework", ".", "amqp", ".", "support", ".", "converter", ".", "SerializerMessageConverter", ";", "/", "**", "*", "The", "0", "-", "8", "and", "0", "-", "9", "-", "1", "AMQP", "specifications", "do", "not", "define", "an", "Message", "class", "or", "interface", ".", "Instead", ",", "when", "performing", "an", "@", "@", "-", "42", ",", "6", "+", "42", ",", "12", "@", "@", "private", "static", "final", "String", "ENCODING", "=", "Charset", ".", "defaultCharset", "(", ").", "name", "(", ");", "private", "static", "final", "SerializerMessageConverter", "SERIALIZER_MESSAGE_CONVERTER", "=", "new", "SerializerMessageConverter", "(", ");", "static", "{", "SERIALIZER_MESSAGE_CONVERTER", ".", "setWhiteListPatterns", "(", "Arrays", ".", "asList", "(", "\"", "java", ".", "util", ".", "*\"", ",", "\"", "java", ".", "lang", ".", "*\"", "))", ";", "}", "private", "final", "MessageProperties", "messageProperties", ";", "private", "final", "byte", "[", "]", "body", ";", "@", "@", "-", "51", ",", "6", "+", "57", ",", "22", "@", "@", "public", "Message", "(", "byte", "[", "]", "body", ",", "MessageProperties", "messageProperties", ")", "{", "/", "/", "NOSONAR", "this", ".", "messageProperties", "=", "messageProperties", ";", "}", "/", "**", "*", "Add", "patterns", "to", "the", "white", "list", "of", "permissable", "package", "/", "class", "name", "patterns", "for", "*", "deserialization", "in", "{", "@", "link", "#", "toString", "(", ")}", ".", "*", "The", "patterns", "will", "be", "applied", "in", "order", "until", "a", "match", "is", "found", ".", "*", "A", "class", "can", "be", "fully", "qualified", "or", "a", "wildcard", "'", "*'", "is", "allowed", "at", "the", "*", "beginning", "or", "end", "of", "the", "class", "name", ".", "*", "Examples", ":", "{", "@", "code", "com", ".", "foo", ".", "*}", ",", "{", "@", "code", "*", ".", "MyClass", "}", ".", "*", "By", "default", ",", "only", "{", "@", "code", "java", ".", "util", "}", "and", "{", "@", "code", "java", ".", "lang", "}", "classes", "will", "be", "*", "deserialized", ".", "*", "@", "param", "patterns", "the", "patterns", ".", "*", "@", "since", "1", ".", "5", ".", "7", "*", "/", "public", "static", "void", "addWhiteListPatterns", "(", "String", ".", "..", "patterns", ")", "{", "SERIALIZER_MESSAGE_CONVERTER", ".", "addWhiteListPatterns", "(", "patterns", ")", ";", "}", "public", "byte", "[", "]", "getBody", "(", ")", "{", "return", "this", ".", "body", ";", "/", "/", "NOSONAR", "}", "@", "@", "-", "78", ",", "7", "+", "100", ",", "7", "@", "@", "private", "String", "getBodyContentAsString", "(", ")", "{", "try", "{", "String", "contentType", "=", "(", "this", ".", "messageProperties", "!", "=", "null", ")", "?", "this", ".", "messageProperties", ".", "getContentType", "(", ")", ":", "null", ";", "if", "(", "MessageProperties", ".", "CONTENT_TYPE_SERIALIZED_OBJECT", ".", "equals", "(", "contentType", ")", ")", "{", "return", "SerializationUtils", ".", "deserialize", "(", "this", ".", "body", ")", ".", "toString", "(", ");", "return", "SERIALIZER_MESSAGE_CONVERTER", ".", "fromMessage", "(", "this", ")", ".", "toString", "(", ");", "}", "if", "(", "MessageProperties", ".", "CONTENT_TYPE_TEXT_PLAIN", ".", "equals", "(", "contentType", ")", "|", "|", "MessageProperties", ".", "CONTENT_TYPE_JSON", ".", "equals", "(", "contentType", ")", "@", "@", "-", "17", ",", "6", "+", "17", ",", "7", "@", "@", "package", "org", ".", "springframework", ".", "amqp", ".", "support", ".", "converter", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "LinkedHashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "@", "@", "-", "47", ",", "6", "+", "48", ",", "16", "@", "@", "public", "void", "setWhiteListPatterns", "(", "List", "<", "String", ">", "whiteListPatterns", ")", "{", "this", ".", "whiteListPatterns", ".", "addAll", "(", "whiteListPatterns", ")", ";", "}", "/", "**", "*", "Add", "package", "/", "class", "patterns", "to", "the", "white", "list", ".", "*", "@", "param", "patterns", "the", "patterns", "to", "add", ".", "*", "@", "since", "1", ".", "5", ".", "7", "*", "@", "see", "#", "setWhiteListPatterns", "(", "List", ")", "*", "/", "public", "void", "addWhiteListPatterns", "(", "String", ".", "..", "patterns", ")", "{", "Collections", ".", "addAll", "(", "this", ".", "whiteListPatterns", ",", "patterns", ")", ";", "}", "protected", "void", "checkWhiteList", "(", "Class", "<", "?>", "clazz", ")", "throws", "IOException", "{", "if", "(", "this", ".", "whiteListPatterns", ".", "isEmpty", "(", "))", "{", "return", ";", "@", "@", "-", "16", ",", "17", "+", "16", ",", "23", "@", "@", "package", "org", ".", "springframework", ".", "amqp", ".", "core", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "ByteArrayOutputStream", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectOutputStream", ";", "import", "java", ".", "io", ".", "Serializable", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "amqp", ".", "support", ".", "converter", ".", "SimpleMessageConverter", ";", "import", "org", ".", "springframework", ".", "amqp", ".", "utils", ".", "SerializationUtils", ";", "/", "**", "@", "@", "-", "86", ",", "4", "+", "92", ",", "27", "@", "@", "public", "void", "serialization", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "new", "String", "(", "message", ".", "getBody", "(", "))", ",", "new", "String", "(", "out", ".", "getBody", "(", "))", ");", "assertEquals", "(", "message", ".", "toString", "(", "),", "out", ".", "toString", "(", "))", ";", "}", "@", "Test", "public", "void", "fooNotDeserialized", "(", ")", "{", "Message", "message", "=", "new", "SimpleMessageConverter", "(", ").", "toMessage", "(", "new", "Foo", "(", "),", "new", "MessageProperties", "(", "))", ";", "assertThat", "(", "message", ".", "toString", "(", "),", "not", "(", "containsString", "(", "\"", "aFoo", "\"", "))", ");", "Message", "listMessage", "=", "new", "SimpleMessageConverter", "(", ").", "toMessage", "(", "Collections", ".", "singletonList", "(", "new", "Foo", "(", "))", ",", "new", "MessageProperties", "(", "))", ";", "assertThat", "(", "listMessage", ".", "toString", "(", "),", "not", "(", "containsString", "(", "\"", "aFoo", "\"", "))", ");", "Message", ".", "addWhiteListPatterns", "(", "Foo", ".", "class", ".", "getName", "(", "))", ";", "assertThat", "(", "message", ".", "toString", "(", "),", "containsString", "(", "\"", "aFoo", "\"", "))", ";", "assertThat", "(", "listMessage", ".", "toString", "(", "),", "containsString", "(", "\"", "aFoo", "\"", "))", ";", "}", "@", "SuppressWarnings", "(", "\"", "serial", "\"", ")", "public", "static", "class", "Foo", "implements", "Serializable", "{", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "aFoo", "\"", ";", "}", "}", "}", "@", "@", "-", "22", ",", "7", "+", "22", ",", "7", "@", "@", "If", "you", "are", "not", ",", "then", "have", "a", "look", "at", "the", "resources", "listed", "in", "<", "<", "resources", ">", ">", "=", "==", "==", "Message", "The", "0", "-", "8", "and", "0", "-", "9", "-", "1", "AMQP", "specifications", "do", "not", "define", "a", "Message", "class", "or", "interface", ".", "The", "0", "-", "9", "-", "1", "AMQP", "specification", "does", "not", "define", "a", "Message", "class", "or", "interface", ".", "Instead", ",", "when", "performing", "an", "operation", "such", "as", "`", "basicPublish", "(", ")`", ",", "the", "content", "is", "passed", "as", "a", "byte", "-", "array", "argument", "and", "additional", "properties", "are", "passed", "in", "as", "separate", "arguments", ".", "Spring", "AMQP", "defines", "a", "Message", "class", "as", "part", "of", "a", "more", "general", "AMQP", "domain", "model", "representation", ".", "The", "purpose", "of", "the", "Message", "class", "is", "to", "simply", "encapsulate", "the", "body", "and", "properties", "within", "a", "single", "instance", "so", "that", "the", "API", "can", "in", "turn", "be", "simpler", ".", "@", "@", "-", "55", ",", "6", "+", "55", ",", "16", "@", "@", "The", "`", "MessageProperties", "`", "interface", "defines", "several", "common", "properties", "such", "as", "'", "mes", "Those", "properties", "can", "also", "be", "extended", "with", "user", "-", "defined", "'", "headers", "'", "by", "calling", "the", "`", "setHeader", "(", "String", "key", ",", "Object", "value", ")", "`", "method", ".", "[", "IMPORTANT", "]", "-", "--", "-", "Starting", "with", "versions", "`", "1", ".", "5", ".", "7", ",", "1", ".", "6", ".", "11", ",", "1", ".", "7", ".", "4", ",", "2", ".", "0", ".", "0", "`", ",", "if", "a", "message", "body", "is", "a", "serialized", "`", "Serializable", "`", "java", "object", ",", "it", "is", "no", "longer", "deserialized", "(", "by", "default", ")", "when", "performing", "`", "toString", "(", ")`", "operations", "(", "such", "as", "in", "log", "messages", ")", ".", "This", "is", "to", "prevent", "unsafe", "deserialization", ".", "By", "default", ",", "only", "`", "java", ".", "util", "`", "and", "`", "java", ".", "lang", "`", "classes", "are", "deserialized", ".", "To", "revert", "to", "the", "previous", "behavior", ",", "you", "can", "add", "allowable", "class", "/", "package", "patterns", "by", "invoking", "`", "Message", ".", "addWhiteListPatterns", "(", "..", ".)", "`.", "A", "simple", "`", "*`", "wildcard", "is", "supported", ",", "for", "example", "`", "com", ".", "foo", ".", "*,", "*", ".", "MyClass", "`", ".", "Bodies", "that", "cannot", "be", "deserialized", "will", "be", "represented", "by", "`", "byte", "[", "<", "size", ">", "]`", "in", "log", "messages", ".", "-", "--", "-", "=", "==", "==", "Exchange", "The", "`", "Exchange", "`", "interface", "represents", "an", "AMQP", "Exchange", ",", "which", "is", "what", "a", "Message", "Producer", "sends", "to", "."], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "142", ",", "55", "+", "142", ",", "6", "@", "@", "pipe_iov_copy_from_user", "(", "void", "*", "to", ",", "struct", "iovec", "*", "iov", ",", "unsigned", "long", "len", ",", "return", "0", ";", "}", "static", "int", "pipe_iov_copy_to_user", "(", "struct", "iovec", "*", "iov", ",", "const", "void", "*", "from", ",", "unsigned", "long", "len", ",", "int", "atomic", ")", "{", "unsigned", "long", "copy", ";", "while", "(", "len", ">", "0", ")", "{", "while", "(", "!", "iov", "-", ">", "iov_len", ")", "iov", "+", "+;", "copy", "=", "min_t", "(", "unsigned", "long", ",", "len", ",", "iov", "-", ">", "iov_len", ")", ";", "if", "(", "atomic", ")", "{", "if", "(", "__copy_to_user_inatomic", "(", "iov", "-", ">", "iov_base", ",", "from", ",", "copy", ")", ")", "return", "-", "EFAULT", ";", "}", "else", "{", "if", "(", "copy_to_user", "(", "iov", "-", ">", "iov_base", ",", "from", ",", "copy", ")", ")", "return", "-", "EFAULT", ";", "}", "from", "+", "=", "copy", ";", "len", "-", "=", "copy", ";", "iov", "-", ">", "iov_base", "+", "=", "copy", ";", "iov", "-", ">", "iov_len", "-", "=", "copy", ";", "}", "return", "0", ";", "}", "/", "*", "*", "Attempt", "to", "pre", "-", "fault", "in", "the", "user", "memory", ",", "so", "we", "can", "use", "atomic", "copies", ".", "*", "Returns", "the", "number", "of", "bytes", "not", "faulted", "in", ".", "*", "/", "static", "int", "iov_fault_in_pages_write", "(", "struct", "iovec", "*", "iov", ",", "unsigned", "long", "len", ")", "{", "while", "(", "!", "iov", "-", ">", "iov_len", ")", "iov", "+", "+;", "while", "(", "len", ">", "0", ")", "{", "unsigned", "long", "this_len", ";", "this_len", "=", "min_t", "(", "unsigned", "long", ",", "len", ",", "iov", "-", ">", "iov_len", ")", ";", "if", "(", "fault_in_pages_writeable", "(", "iov", "-", ">", "iov_base", ",", "this_len", ")", ")", "break", ";", "len", "-", "=", "this_len", ";", "iov", "+", "+;", "}", "return", "len", ";", "}", "/", "*", "*", "Pre", "-", "fault", "in", "the", "user", "memory", ",", "so", "we", "can", "use", "atomic", "copies", ".", "*", "/", "@", "@", "-", "329", ",", "12", "+", "280", ",", "15", "@", "@", "pipe_read", "(", "struct", "kiocb", "*", "iocb", ",", "const", "struct", "iovec", "*", "_iov", ",", "ssize_t", "ret", ";", "struct", "iovec", "*", "iov", "=", "(", "struct", "iovec", "*", ")", "_iov", ";", "size_t", "total_len", ";", "struct", "iov_iter", "iter", ";", "total_len", "=", "iov_length", "(", "iov", ",", "nr_segs", ")", ";", "/", "*", "Null", "read", "succeeds", ".", "*", "/", "if", "(", "unlikely", "(", "total_len", "=", "=", "0", ")", ")", "return", "0", ";", "iov_iter_init", "(", "&", "iter", ",", "iov", ",", "nr_segs", ",", "total_len", ",", "0", ")", ";", "do_wakeup", "=", "0", ";", "ret", "=", "0", ";", "__pipe_lock", "(", "pipe", ")", ";", "@", "@", "-", "344", ",", "9", "+", "298", ",", "9", "@", "@", "pipe_read", "(", "struct", "kiocb", "*", "iocb", ",", "const", "struct", "iovec", "*", "_iov", ",", "int", "curbuf", "=", "pipe", "-", ">", "curbuf", ";", "struct", "pipe_buffer", "*", "buf", "=", "pipe", "-", ">", "bufs", "+", "curbuf", ";", "const", "struct", "pipe_buf_operations", "*", "ops", "=", "buf", "-", ">", "ops", ";", "void", "*", "addr", ";", "size_t", "chars", "=", "buf", "-", ">", "len", ";", "int", "error", ",", "atomic", ";", "size_t", "written", ";", "int", "error", ";", "if", "(", "chars", ">", "total_len", ")", "chars", "=", "total_len", ";", "@", "@", "-", "358", ",", "27", "+", "312", ",", "10", "@", "@", "pipe_read", "(", "struct", "kiocb", "*", "iocb", ",", "const", "struct", "iovec", "*", "_iov", ",", "break", ";", "}", "atomic", "=", "!", "iov_fault_in_pages_write", "(", "iov", ",", "chars", ")", ";", "redo", ":", "if", "(", "atomic", ")", "addr", "=", "kmap_atomic", "(", "buf", "-", ">", "page", ")", ";", "else", "addr", "=", "kmap", "(", "buf", "-", ">", "page", ")", ";", "error", "=", "pipe_iov_copy_to_user", "(", "iov", ",", "addr", "+", "buf", "-", ">", "offset", ",", "chars", ",", "atomic", ")", ";", "if", "(", "atomic", ")", "kunmap_atomic", "(", "addr", ")", ";", "else", "kunmap", "(", "buf", "-", ">", "page", ")", ";", "if", "(", "unlikely", "(", "error", ")", ")", "{", "/", "*", "*", "Just", "retry", "with", "the", "slow", "path", "if", "we", "failed", ".", "*", "/", "if", "(", "atomic", ")", "{", "atomic", "=", "0", ";", "goto", "redo", ";", "}", "written", "=", "copy_page_to_iter", "(", "buf", "-", ">", "page", ",", "buf", "-", ">", "offset", ",", "chars", ",", "&", "iter", ")", ";", "if", "(", "unlikely", "(", "written", "<", "chars", ")", ")", "{", "if", "(", "!", "ret", ")", "ret", "=", "error", ";", "ret", "=", "-", "EFAULT", ";", "break", ";", "}", "ret", "+", "=", "chars", ";"], "docstring_tokens": ["a", "write", "of", "wrong-offset", "data", "and", "an", "out", "of", "bounds", "write", "to", "the", "userspace", "buffer"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1657", ",", "14", "+", "1657", ",", "13", "@", "@", "int", "ring_buffer_resize", "(", "struct", "ring_buffer", "*", "buffer", ",", "unsigned", "long", "size", ",", "!", "cpumask_test_cpu", "(", "cpu_id", ",", "buffer", "-", ">", "cpumask", ")", ")", "return", "size", ";", "size", "=", "DIV_ROUND_UP", "(", "size", ",", "BUF_PAGE_SIZE", ")", ";", "size", "*", "=", "BUF_PAGE_SIZE", ";", "nr_pages", "=", "DIV_ROUND_UP", "(", "size", ",", "BUF_PAGE_SIZE", ")", ";", "/", "*", "we", "need", "a", "minimum", "of", "two", "pages", "*", "/", "if", "(", "size", "<", "BUF_PAGE_SIZE", "*", "2", ")", "size", "=", "BUF_PAGE_SIZE", "*", "2", ";", "if", "(", "nr_pages", "<", "2", ")", "nr_pages", "=", "2", ";", "nr_pages", "=", "DIV_ROUND_UP", "(", "size", ",", "BUF_PAGE_SIZE", ")", ";", "size", "=", "nr_pages", "*", "BUF_PAGE_SIZE", ";", "/", "*", "*", "Don", "'", "t", "succeed", "if", "resizing", "is", "disabled", ",", "as", "a", "reader", "might", "be"], "docstring_tokens": ["gain", "elevated", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "122", ",", "7", "+", "122", ",", "7", "@", "@", "<", "repositories", ">", "<", "repository", ">", "<", "id", ">", "vaadin", "-", "addons", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "maven", ".", "vaadin", ".", "com", "/", "vaadin", "-", "addons", "<", "/", "url", ">", "<", "url", ">", "https", ":", "//", "maven", ".", "vaadin", ".", "com", "/", "vaadin", "-", "addons", "<", "/", "url", ">", "<", "/", "repository", ">", "<", "/", "repositories", ">"], "docstring_tokens": ["conduct", "man-in-the-middle", "attacks"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "110", ",", "7", "+", "110", ",", "7", "@", "@", "protected", "final", "String", "constructValidationUrl", "(", "final", "String", "ticket", ",", "final", "String", "logger", ".", "debug", "(", "\"", "Placing", "URL", "parameters", "in", "map", ".", "\")", ";", "urlParameters", ".", "put", "(", "\"", "ticket", "\"", ",", "ticket", ")", ";", "urlParameters", ".", "put", "(", "\"", "service", "\"", ",", "encodeUrl", "(", "serviceUrl", ")", ");", "urlParameters", ".", "put", "(", "\"", "service", "\"", ",", "serviceUrl", ")", ";", "if", "(", "this", ".", "renew", ")", "{", "urlParameters", ".", "put", "(", "\"", "renew", "\"", ",", "\"", "true", "\"", ");", "@", "@", "-", "144", ",", "7", "+", "144", ",", "8", "@", "@", "protected", "final", "String", "constructValidationUrl", "(", "final", "String", "ticket", ",", "final", "String", "buffer", ".", "append", "(", "i", "+", "+", "=", "=", "0", "?", "\"", "?\"", ":", "\"", "&\"", ");", "buffer", ".", "append", "(", "key", ")", ";", "buffer", ".", "append", "(", "\"=", "\")", ";", "buffer", ".", "append", "(", "value", ")", ";", "final", "String", "encodedValue", "=", "encodeUrl", "(", "value", ")", ";", "buffer", ".", "append", "(", "encodedValue", ")", ";", "}", "}", "@", "@", "-", "70", ",", "7", "+", "70", ",", "7", "@", "@", "public", "Cas20ServiceTicketValidator", "(", "final", "String", "casServerUrlPrefix", ")", "{", "*", "@", "param", "urlParameters", "the", "Map", "containing", "the", "existing", "parameters", "to", "send", "to", "the", "server", ".", "*", "/", "protected", "final", "void", "populateUrlAttributeMap", "(", "final", "Map", "<", "String", ",", "String", ">", "urlParameters", ")", "{", "urlParameters", ".", "put", "(", "\"", "pgtUrl", "\"", ",", "encodeUrl", "(", "this", ".", "proxyCallbackUrl", ")", ");", "urlParameters", ".", "put", "(", "\"", "pgtUrl", "\"", ",", "this", ".", "proxyCallbackUrl", ")", ";", "}", "protected", "String", "getUrlSuffix", "(", ")", "{", "@", "@", "-", "18", ",", "8", "+", "18", ",", "7", "@", "@", "*", "/", "package", "org", ".", "jasig", ".", "cas", ".", "client", ".", "validation", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "org", ".", "jasig", ".", "cas", ".", "client", ".", "PublicTestHttpServer", ";", "import", "org", ".", "junit", ".", "Before", ";", "@", "@", "-", "80", ",", "4", "+", "79", ",", "15", "@", "@", "public", "void", "testBadResponse", "(", ")", "throws", "UnsupportedEncodingException", "{", "/", "/", "expected", "}", "}", "@", "Test", "public", "void", "urlEncodedValues", "(", ")", "{", "final", "String", "ticket", "=", "\"", "ST", "-", "1", "-", "owKEOtYJjg77iHcCQpkl", "-", "cas01", ".", "example", ".", "org", "%", "26", "%", "73", "%", "65", "%", "72", "%", "76", "%", "69", "%", "63", "%", "65", "%", "3d", "%", "68", "%", "74", "%", "74", "%", "70", "%", "25", "%", "33", "%", "41", "%", "25", "%", "32", "%", "46", "%", "25", "%", "32", "%", "46", "%", "31", "%", "32", "%", "37", "%", "2e", "%", "30", "%", "2e", "%", "30", "%", "2e", "%", "31", "%", "25", "%", "32", "%", "46", "%", "62", "%", "6f", "%", "72", "%", "69", "%", "6e", "%", "67", "%", "25", "%", "32", "%", "46", "%", "23", "\"", ";", "final", "String", "service", "=", "\"", "foobar", "\"", ";", "final", "String", "url", "=", "this", ".", "ticketValidator", ".", "constructValidationUrl", "(", "ticket", ",", "service", ")", ";", "final", "String", "encodedValue", "=", "this", ".", "ticketValidator", ".", "encodeUrl", "(", "ticket", ")", ";", "assertTrue", "(", "url", ".", "contains", "(", "encodedValue", ")", ");", "assertFalse", "(", "url", ".", "contains", "(", "ticket", ")", ");", "}", "}"], "docstring_tokens": ["bypass", "security", "restrictions", "and", "perform", "unauthorized", "actions"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1425", ",", "6", "+", "1425", ",", "7", "@", "@", "static", "int", "copy_to_user_tmpl", "(", "struct", "xfrm_policy", "*", "xp", ",", "struct", "sk_buff", "*", "skb", ")", "struct", "xfrm_user_tmpl", "*", "up", "=", "&", "vec", "[", "i", "]", ";", "struct", "xfrm_tmpl", "*", "kp", "=", "&", "xp", "-", ">", "xfrm_vec", "[", "i", "]", ";", "memset", "(", "up", ",", "0", ",", "sizeof", "(", "*", "up", ")", ");", "memcpy", "(", "&", "up", "-", ">", "id", ",", "&", "kp", "-", ">", "id", ",", "sizeof", "(", "up", "-", ">", "id", ")", ");", "up", "-", ">", "family", "=", "kp", "-", ">", "encap_family", ";", "memcpy", "(", "&", "up", "-", ">", "saddr", ",", "&", "kp", "-", ">", "saddr", ",", "sizeof", "(", "up", "-", ">", "saddr", ")", ");"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1029", ",", "20", "+", "1029", ",", "11", "@", "@", "public", "OAuth2Authentication", "loadAuthentication", "(", "String", "accessToken", ")", "throws", "Authen", "throw", "new", "InvalidTokenException", "(", "\"", "Invalid", "access", "token", "value", ",", "must", "be", "at", "least", "30", "characters", ":", "\"+", "accessToken", ")", ";", "}", "TokenValidation", "tokenValidation", "=", "validateToken", "(", "accessToken", ")", ";", "Map", "<", "String", ",", "Object", ">", "claims", "=", "tokenValidation", ".", "getClaims", "(", ");", "Object", "jtiClaim", "=", "claims", ".", "get", "(", "JTI", ")", ";", "TokenValidation", "tokenValidation", "=", "validateToken", "(", "accessToken", ")", ".", "checkAccessToken", "(", ")", ".", "throwIfInvalid", "(", ");", "if", "(", "jtiClaim", "=", "=", "null", ")", "{", "throw", "new", "InvalidTokenException", "(", "\"", "The", "token", "must", "contain", "a", "jti", "claim", ".", "\")", ";", "}", "else", "{", "if", "(", "jtiClaim", ".", "toString", "(", ").", "endsWith", "(", "REFRESH_TOKEN_SUFFIX", ")", ")", "{", "throw", "new", "InvalidTokenException", "(", "\"", "Invalid", "access", "token", "was", "provided", ".", "\"", ")", ";", "}", "}", "Map", "<", "String", ",", "Object", ">", "claims", "=", "tokenValidation", ".", "getClaims", "(", ");", "accessToken", "=", "tokenValidation", ".", "getJwt", "(", ").", "getEncoded", "(", ");", "@", "@", "-", "1106", ",", "7", "+", "1097", ",", "10", "@", "@", "public", "OAuth2Authentication", "loadAuthentication", "(", "String", "accessToken", ")", "throws", "Authen", "*", "/", "@", "Override", "public", "OAuth2AccessToken", "readAccessToken", "(", "String", "accessToken", ")", "{", "TokenValidation", "tokenValidation", "=", "validateToken", "(", "accessToken", ")", ";", "TokenValidation", "tokenValidation", "=", "validateToken", "(", "accessToken", ")", ".", "checkAccessToken", "(", ")", ".", "throwIfInvalid", "(", ");", "Map", "<", "String", ",", "Object", ">", "claims", "=", "tokenValidation", ".", "getClaims", "(", ");", "accessToken", "=", "tokenValidation", ".", "getJwt", "(", ").", "getEncoded", "(", ");", "@", "@", "-", "58", ",", "9", "+", "58", ",", "11", "@", "@", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "CLIENT_ID", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "EXP", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "ISS", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "JTI", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "REVOCATION_SIGNATURE", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "SCOPE", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "USER_ID", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "TokenConstants", ".", "REFRESH_TOKEN_SUFFIX", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "UaaTokenUtils", ".", "isUserToken", ";", "public", "class", "TokenValidation", "{", "@", "@", "-", "492", ",", "4", "+", "494", ",", "19", "@", "@", "public", "Jwt", "getJwt", "(", ")", "{", "public", "Map", "<", "String", ",", "Object", ">", "getClaims", "(", ")", "{", "return", "claims", ";", "}", "public", "TokenValidation", "checkAccessToken", "(", ")", "{", "Object", "jti", "=", "this", ".", "getClaims", "(", ").", "get", "(", "JTI", ")", ";", "if", "(", "jti", "=", "=", "null", ")", "{", "addError", "(", "\"", "The", "token", "must", "contain", "a", "jti", "claim", ".", "\")", ";", "return", "this", ";", "}", "if", "(", "jti", ".", "toString", "(", ").", "endsWith", "(", "REFRESH_TOKEN_SUFFIX", ")", ")", "{", "addError", "(", "\"", "Invalid", "access", "token", ".", "\")", ";", "}", "return", "this", ";", "}", "}", "@", "@", "-", "1667", ",", "6", "+", "1667", ",", "54", "@", "@", "public", "void", "testReadAccessToken_No_PII", "(", ")", "{", "readAccessToken", "(", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "ClaimConstants", ".", "EMAIL", ",", "ClaimConstants", ".", "USER_NAME", ")", "))", ";", "}", "@", "Test", "public", "void", "testReadAccessToken_When_Given_Refresh_token_should_throw_exception", "(", ")", "{", "tokenServices", ".", "setExcludedClaims", "(", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "ClaimConstants", ".", "EMAIL", ",", "ClaimConstants", ".", "USER_NAME", ")", "))", ";", "AuthorizationRequest", "authorizationRequest", "=", "new", "AuthorizationRequest", "(", "CLIENT_ID", ",", "tokenSupport", ".", "requestedAuthScopes", ")", ";", "authorizationRequest", ".", "setResourceIds", "(", "new", "HashSet", "<", ">(", "tokenSupport", ".", "resourceIds", ")", ");", "Map", "<", "String", ",", "String", ">", "azParameters", "=", "new", "HashMap", "<", ">(", "authorizationRequest", ".", "getRequestParameters", "(", "))", ";", "azParameters", ".", "put", "(", "GRANT_TYPE", ",", "AUTHORIZATION_CODE", ")", ";", "authorizationRequest", ".", "setRequestParameters", "(", "azParameters", ")", ";", "Authentication", "userAuthentication", "=", "tokenSupport", ".", "defaultUserAuthentication", ";", "Calendar", "expiresAt1", "=", "Calendar", ".", "getInstance", "(", ");", "expiresAt1", ".", "add", "(", "Calendar", ".", "MILLISECOND", ",", "3000", ")", ";", "Calendar", "updatedAt1", "=", "Calendar", ".", "getInstance", "(", ");", "updatedAt1", ".", "add", "(", "Calendar", ".", "MILLISECOND", ",", "-", "1000", ")", ";", "tokenSupport", ".", "approvalStore", ".", "addApproval", "(", "new", "Approval", "(", ")", ".", "setUserId", "(", "tokenSupport", ".", "userId", ")", ".", "setClientId", "(", "CLIENT_ID", ")", ".", "setScope", "(", "tokenSupport", ".", "readScope", ".", "get", "(", "0", ")", ")", ".", "setExpiresAt", "(", "expiresAt1", ".", "getTime", "(", "))", ".", "setStatus", "(", "ApprovalStatus", ".", "APPROVED", ")", ".", "setLastUpdatedAt", "(", "updatedAt1", ".", "getTime", "(", "))", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "tokenSupport", ".", "approvalStore", ".", "addApproval", "(", "new", "Approval", "(", ")", ".", "setUserId", "(", "tokenSupport", ".", "userId", ")", ".", "setClientId", "(", "CLIENT_ID", ")", ".", "setScope", "(", "tokenSupport", ".", "writeScope", ".", "get", "(", "0", ")", ")", ".", "setExpiresAt", "(", "expiresAt1", ".", "getTime", "(", "))", ".", "setStatus", "(", "ApprovalStatus", ".", "APPROVED", ")", ".", "setLastUpdatedAt", "(", "updatedAt1", ".", "getTime", "(", "))", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "Approval", "approval", "=", "new", "Approval", "(", ")", ".", "setUserId", "(", "tokenSupport", ".", "userId", ")", ".", "setClientId", "(", "CLIENT_ID", ")", ".", "setScope", "(", "OPENID", ")", ".", "setExpiresAt", "(", "expiresAt1", ".", "getTime", "(", "))", ".", "setStatus", "(", "ApprovalStatus", ".", "APPROVED", ")", ".", "setLastUpdatedAt", "(", "updatedAt1", ".", "getTime", "(", "))", ";", "tokenSupport", ".", "approvalStore", ".", "addApproval", "(", "approval", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "OAuth2Authentication", "authentication", "=", "new", "OAuth2Authentication", "(", "authorizationRequest", ".", "createOAuth2Request", "(", "),", "userAuthentication", ")", ";", "OAuth2AccessToken", "accessToken", "=", "tokenServices", ".", "createAccessToken", "(", "authentication", ")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", ".", "\")", ";", "tokenServices", ".", "readAccessToken", "(", "accessToken", ".", "getRefreshToken", "(", ").", "getValue", "(", "))", ";", "}", "public", "void", "readAccessToken", "(", "Set", "<", "String", ">", "excludedClaims", ")", "{", "tokenServices", ".", "setExcludedClaims", "(", "excludedClaims", ")", ";", "AuthorizationRequest", "authorizationRequest", "=", "new", "AuthorizationRequest", "(", "CLIENT_ID", ",", "tokenSupport", ".", "requestedAuthScopes", ")", ";", "@", "@", "-", "1907", ",", "7", "+", "1955", ",", "7", "@", "@", "public", "void", "loadAuthentication_when_given_an_opaque_refreshToken_should_throw_ex", "String", "refreshTokenValue", "=", "tokenProvisioning", ".", "retrieve", "(", "compositeToken", ".", "getRefreshToken", "(", ").", "getValue", "(", "),", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ".", "getValue", "(", ");", "expectedException", ".", "expect", "(", "InvalidTokenException", ".", "class", ")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", "was", "provided", ".", "\")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", ".", "\")", ";", "tokenServices", ".", "loadAuthentication", "(", "refreshTokenValue", ")", ";", "}", "@", "@", "-", "1937", ",", "7", "+", "1985", ",", "7", "@", "@", "public", "void", "loadAuthentication_when_given_an_refresh_jwt_should_throw_exception", "(", "String", "refreshTokenValue", "=", "tokenProvisioning", ".", "retrieve", "(", "refreshToken", ".", "getClaims", "(", ").", "get", "(", "\"", "jti", "\"", ").", "toString", "(", "),", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ".", "getValue", "(", ");", "expectedException", ".", "expect", "(", "InvalidTokenException", ".", "class", ")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", "was", "provided", ".", "\")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", ".", "\")", ";", "tokenServices", ".", "loadAuthentication", "(", "refreshTokenValue", ")", ";", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUserDatabase", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneHolder", ";", "import", "org", ".", "hamcrest", ".", "CoreMatchers", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "46", ",", "13", "+", "47", ",", "19", "@", "@", "import", "static", "java", ".", "util", ".", "Collections", ".", "EMPTY_LIST", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ".", "REQUIRED_USER_GROUPS", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "EMAIL", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "JTI", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "USER_NAME", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "TokenValidation", ".", "validate", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "UaaMapUtils", ".", "entry", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "UaaMapUtils", ".", "map", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "equalTo", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "hasItems", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsInAnyOrder", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "empty", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasSize", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "instanceOf", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "@", "@", "-", "210", ",", "12", "+", "217", ",", "53", "@", "@", "public", "void", "validateToken", "(", ")", "throws", "Exception", "{", ".", "checkRevocationSignature", "(", "Collections", ".", "singletonList", "(", "\"", "fa1c787d", "\"", "))", ".", "checkAudience", "(", "\"", "acme", "\"", ",", "\"", "app", "\"", ")", ".", "checkRevocableTokenStore", "(", "revocableTokenProvisioning", ")", ".", "checkAccessToken", "(", ")", ";", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "empty", "(", "))", ";", "assertTrue", "(", "validation", ".", "isValid", "(", "))", ";", "}", "@", "Test", "public", "void", "validateAccessToken", "(", ")", "throws", "Exception", "{", "content", ".", "put", "(", "JTI", ",", "\"", "8b14f193", "-", "8212", "-", "4af2", "-", "9927", "-", "e3ae903f94a6", "-", "r", "\"", ");", "TokenValidation", "validation", "=", "validate", "(", "getToken", "(", "))", ".", "checkAccessToken", "(", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "not", "(", "empty", "(", "))", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "hasSize", "(", "1", ")", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", ").", "get", "(", "0", ")", ",", "instanceOf", "(", "InvalidTokenException", ".", "class", ")", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", ").", "get", "(", "0", ")", ".", "getMessage", "(", "),", "is", "(", "\"", "Invalid", "access", "token", ".", "\")", ");", "assertThat", "(", "validation", ".", "isValid", "(", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "validateAccessToken_with_dashR_in_JTI_should_fail_validation", "(", ")", "throws", "Exception", "{", "content", ".", "put", "(", "JTI", ",", "\"", "8b14f193", "-", "r", "-", "8212", "-", "4af2", "-", "9927", "-", "e3ae903f94a6", "\"", ");", "TokenValidation", "validation", "=", "validate", "(", "getToken", "(", "))", ".", "checkAccessToken", "(", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "empty", "(", "))", ";", "assertThat", "(", "validation", ".", "isValid", "(", "),", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "validateAccessToken_without_jti_should_fail_validation", "(", ")", "throws", "Exception", "{", "content", ".", "put", "(", "JTI", ",", "null", ")", ";", "TokenValidation", "validation", "=", "validate", "(", "getToken", "(", "))", ".", "checkAccessToken", "(", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "hasSize", "(", "1", ")", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", ").", "get", "(", "0", ")", ",", "instanceOf", "(", "InvalidTokenException", ".", "class", ")", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", ").", "get", "(", "0", ")", ".", "getMessage", "(", "),", "is", "(", "\"", "The", "token", "must", "contain", "a", "jti", "claim", ".", "\")", ");", "assertThat", "(", "validation", ".", "isValid", "(", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "validateToken_Without_Email_And_Username", "(", ")", "throws", "Exception", "{", "TokenValidation", "validation", "=", "validate", "(", "getToken", "(", "Arrays", ".", "asList", "(", "EMAIL", ",", "USER_NAME", ")", "))"], "docstring_tokens": ["bypass", "access", "restrictions"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "53", ",", "6", "+", "53", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "ResponseStatus", ";", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "RestTemplate", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "View", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "HtmlUtils", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "@", "@", "-", "164", ",", "7", "+", "165", ",", "7", "@", "@", "private", "boolean", "isMember", "(", "ScimGroup", "group", ",", "String", "userId", ")", "{", "try", "{", "result", "=", "dao", ".", "query", "(", "filter", ",", "sortBy", ",", "\"", "ascending", "\"", ".", "equalsIgnoreCase", "(", "sortOrder", ")", ",", "identityZoneManager", ".", "getCurrentIdentityZoneId", "(", "))", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "throw", "new", "ScimException", "(", "\"", "Invalid", "filter", "expression", ":", "[", "\"", "+", "filter", "+", "\"", "]\"", ",", "HttpStatus", ".", "BAD_REQUEST", ")", ";", "throw", "new", "ScimException", "(", "\"", "Invalid", "filter", "expression", ":", "[", "\"", "+", "HtmlUtils", ".", "htmlEscape", "(", "filter", ")", "+", "\"", "]\"", ",", "HttpStatus", ".", "BAD_REQUEST", ")", ";", "}", "List", "<", "ScimGroup", ">", "input", ";", "@", "@", "-", "52", ",", "6", "+", "52", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "*;", "import", "org", ".", "springframework", ".", "web", ".", "client", ".", "RestTemplate", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "View", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "HtmlUtils", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "@", "@", "-", "370", ",", "7", "+", "371", ",", "7", "@", "@", "private", "int", "getVersion", "(", "String", "userId", ",", "String", "etag", ")", "{", "if", "(", "StringUtils", ".", "hasText", "(", "sortBy", ")", ")", "{", "msg", "+", "=", "\"", "[", "\"", "+", "sortBy", "+", "\"]", "\";", "}", "throw", "new", "ScimException", "(", "msg", ",", "HttpStatus", ".", "BAD_REQUEST", ")", ";", "throw", "new", "ScimException", "(", "HtmlUtils", ".", "htmlEscape", "(", "msg", ")", ",", "HttpStatus", ".", "BAD_REQUEST", ")", ";", "}", "if", "(", "!", "StringUtils", ".", "hasLength", "(", "attributesCommaSeparated", ")", ")", "{", "@", "@", "-", "15", ",", "17", "+", "15", ",", "16", "@", "@", "import", "com", ".", "unboundid", ".", "scim", ".", "sdk", ".", "SCIMException", ";", "import", "com", ".", "unboundid", ".", "scim", ".", "sdk", ".", "SCIMFilter", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "constants", ".", "OriginKeys", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "IdentityProvider", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "IdentityProviderProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "SearchResults", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimCore", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "ScimException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "beans", ".", "DefaultSecurityContextAccessor", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "security", ".", "beans", ".", "SecurityContextAccessor", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "IdentityProvider", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "IdentityProviderProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneHolder", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "InitializingBean", ";", "import", "org", ".", "springframework", ".", "http", ".", "HttpStatus", ";", "import", "org", ".", "springframework", ".", "stereotype", ".", "Controller", ";", "@", "@", "-", "36", ",", "6", "+", "35", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "ResponseBody", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "ResponseStatus", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "View", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "HtmlUtils", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "@", "@", "-", "46", ",", "7", "+", "46", ",", "6", "@", "@", "/", "**", "*", "@", "author", "Dave", "Syer", "*", "@", "author", "Luke", "Taylor", "*", "*", "/", "@", "Controller", "public", "class", "UserIdConversionEndpoints", "implements", "InitializingBean", "{", "@", "@", "-", "137", ",", "12", "+", "136", ",", "13", "@", "@", "private", "void", "checkFilter", "(", "String", "filter", ")", "{", "}", "}", "catch", "(", "SCIMException", "e", ")", "{", "logger", ".", "debug", "(", "\"/", "ids", "/", "Users", "received", "an", "invalid", "filter", "[", "\"", "+", "filter", "+", "\"", "]\"", ",", "e", ")", ";", "throw", "new", "ScimException", "(", "\"", "Invalid", "filter", "'", "\"+", "filter", "+", "\"'", "\",", "HttpStatus", ".", "BAD_REQUEST", ")", ";", "throw", "new", "ScimException", "(", "\"", "Invalid", "filter", "'", "\"", "+", "HtmlUtils", ".", "htmlEscape", "(", "filter", ")", "+", "\"", "'\"", ",", "HttpStatus", ".", "BAD_REQUEST", ")", ";", "}", "}", "/", "**", "*", "Returns", "true", "if", "the", "field", "'", "id", "'", "or", "'", "userName", "'", "are", "present", "in", "the", "query", ".", "*", "*", "@", "param", "filter", "*", "@", "return", "*", "/", "@", "@", "-", "325", ",", "7", "+", "325", ",", "7", "@", "@", "void", "testListGroupsWithNameCoFilter", "(", ")", "{", "void", "testListGroupsWithInvalidFilterFails", "(", ")", "{", "assertThrowsWithMessageThat", "(", "ScimException", ".", "class", ",", "(", ")", "-", ">", "scimGroupEndpoints", ".", "listGroups", "(", "\"", "id", ",", "displayName", "\"", ",", "\"", "displayName", "cr", "\\", "\"", "admin", "\\", "\"\"", ",", "\"", "created", "\"", ",", "\"", "ascending", "\"", ",", "1", ",", "100", ")", ",", "is", "(", "\"", "Invalid", "filter", "expression", ":", "[", "displayName", "cr", "\\", "\"", "admin", "\\", "\"]", "\")", ");", "is", "(", "\"", "Invalid", "filter", "expression", ":", "[", "displayName", "cr", "&", "quot", ";", "admin", "&", "quot", ";", "]\"", "))", ";", "}", "@", "Test", "@", "@", "-", "9", ",", "12", "+", "9", ",", "27", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "approval", ".", "JdbcApprovalStore", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "constants", ".", "OriginKeys", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "mfa", ".", "JdbcUserGoogleMfaCredentialsProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "*;", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "IdentityProvider", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "JdbcIdentityProviderProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "LdapIdentityProviderDefinition", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "OIDCIdentityProviderDefinition", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "UaaIdentityProviderDefinition", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "SearchResults", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "SimpleAttributeNameMapper", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "jdbc", ".", "SimpleSearchQueryConverter", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "*;", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "*;", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "DisableInternalUserManagementFilter", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "InternalUserManagementDisabledException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimGroup", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimGroupMember", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimGroupMembershipManager", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimMeta", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "InvalidPasswordException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "InvalidScimResourceException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "ScimException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "ScimResourceConflictException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "ScimResourceNotFoundException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "jdbc", ".", "JdbcScimGroupMembershipManager", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "jdbc", ".", "JdbcScimGroupProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "jdbc", ".", "JdbcScimUserProvisioning", ";", "@", "@", "-", "53", ",", "19", "+", "68", ",", "41", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "HttpMediaTypeException", ";", "import", "org", ".", "springframework", ".", "web", ".", "servlet", ".", "View", ";", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "static", "java", ".", "util", ".", "Arrays", ".", "asList", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "AssertThrowsWithMessage", ".", "assertThrowsWithMessageThat", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasSize", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "Is", ".", "is", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "import", "static", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Assertions", ".", "assertThrows", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "anyBoolean", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "anyString", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "*;", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "atLeastOnce", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "doThrow", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "never", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "spy", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "times", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verifyZeroInteractions", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "WithSpring", "@", "ExtendWith", "(", "PollutionPreventionExtension", ".", "class", ")", "@", "@", "-", "679", ",", "7", "+", "716", ",", "10", "@", "@", "void", "whenSettingANegativeValueUserMaxCount_ScimUsersEndpointShouldThrowAnExcepti", "@", "Test", "void", "invalidFilterExpression", "(", ")", "{", "assertThrowsWithMessageThat", "(", "ScimException", ".", "class", ",", "(", ")", "-", ">", "scimUserEndpoints", ".", "findUsers", "(", "\"", "id", "\"", ",", "\"", "userName", "qq", "'", "d", "'", "\",", "null", ",", "\"", "ascending", "\"", ",", "1", ",", "100", ")", ",", "containsString", "(", "\"", "Invalid", "filter", "\"", "))", ";", "assertThrowsWithMessageThat", "(", "ScimException", ".", "class", ",", "(", ")", "-", ">", "scimUserEndpoints", ".", "findUsers", "(", "\"", "id", "\"", ",", "\"", "<", "svg", "onload", "=", "alert", "(", "document", ".", "domain", ")", ">\"", ",", "null", ",", "\"", "ascending", "\"", ",", "1", ",", "100", ")", ",", "is", "(", "\"", "Invalid", "filter", "expression", ":", "[", "&", "lt", ";", "svg", "onload", "=", "alert", "(", "document", ".", "domain", ")", "&", "gt", ";", "]\"", "))", ";", "}", "@", "Test", "@", "@", "-", "13", ",", "6", "+", "13", ",", "7", "@", "@", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "endpoints", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "impl", ".", "config", ".", "UaaConfiguration", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "provider", ".", "IdentityProviderProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "SearchResults", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "ScimException", ";", "@", "@", "-", "30", ",", "6", "+", "31", ",", "7", "@", "@", "import", "static", "junit", ".", "framework", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsString", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "anyString", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "@", "-", "72", ",", "6", "+", "74", ",", "13", "@", "@", "public", "void", "testHappyDay", "(", ")", "{", "endpoints", ".", "findUsers", "(", "\"", "userName", "eq", "\\", "\"", "marissa", "\\", "\"\"", ",", "\"", "ascending", "\"", ",", "0", ",", "100", ",", "false", ")", ";", "}", "@", "Test", "public", "void", "testSanitizeExceptionInFilter", "(", ")", "{", "expected", ".", "expect", "(", "ScimException", ".", "class", ")", ";", "expected", ".", "expectMessage", "(", "is", "(", "\"", "Invalid", "filter", "'", "&", "lt", ";", "svg", "onload", "=", "alert", "(", "document", ".", "domain", ")", "&", "gt", ";", "'\"", "))", ";", "endpoints", ".", "findUsers", "(", "\"<", "svg", "onload", "=", "alert", "(", "document", ".", "domain", ")", ">\"", ",", "\"", "ascending", "\"", ",", "0", ",", "100", ",", "false", ")", ";", "}", "@", "Test", "public", "void", "testBadFieldInFilter", "(", ")", "{", "expected", ".", "expect", "(", "ScimException", ".", "class", ")", ";"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "785", ",", "7", "+", "785", ",", "7", "@", "@", "int", "snd_usb_caiaq_audio_init", "(", "struct", "snd_usb_caiaqdev", "*", "dev", ")", "}", "dev", "-", ">", "pcm", "-", ">", "private_data", "=", "dev", ";", "strcpy", "(", "dev", "-", ">", "pcm", "-", ">", "name", ",", "dev", "-", ">", "product_name", ")", ";", "strlcpy", "(", "dev", "-", ">", "pcm", "-", ">", "name", ",", "dev", "-", ">", "product_name", ",", "sizeof", "(", "dev", "-", ">", "pcm", "-", ">", "name", ")", ");", "memset", "(", "dev", "-", ">", "sub_playback", ",", "0", ",", "sizeof", "(", "dev", "-", ">", "sub_playback", ")", ");", "memset", "(", "dev", "-", ">", "sub_capture", ",", "0", ",", "sizeof", "(", "dev", "-", ">", "sub_capture", ")", ");", "@", "@", "-", "136", ",", "7", "+", "136", ",", "7", "@", "@", "int", "snd_usb_caiaq_midi_init", "(", "struct", "snd_usb_caiaqdev", "*", "device", ")", "if", "(", "ret", "<", "0", ")", "return", "ret", ";", "strcpy", "(", "rmidi", "-", ">", "name", ",", "device", "-", ">", "product_name", ")", ";", "strlcpy", "(", "rmidi", "-", ">", "name", ",", "device", "-", ">", "product_name", ",", "sizeof", "(", "rmidi", "-", ">", "name", ")", ");", "rmidi", "-", ">", "info_flags", "=", "SNDRV_RAWMIDI_INFO_DUPLEX", ";", "rmidi", "-", ">", "private_data", "=", "device", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system", "or", "cause", "the", "application", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "560", ",", "6", "+", "560", ",", "24", "@", "@", "static", "int", "__nd_alloc_stack", "(", "struct", "nameidata", "*", "nd", ")", "return", "0", ";", "}", "/", "**", "*", "path_connected", "-", "Verify", "that", "a", "path", "-", ">", "dentry", "is", "below", "path", "-", ">", "mnt", ".", "mnt_root", "*", "@", "path", ":", "nameidate", "to", "verify", "*", "*", "Rename", "can", "sometimes", "move", "a", "file", "or", "directory", "outside", "of", "a", "bind", "*", "mount", ",", "path_connected", "allows", "those", "cases", "to", "be", "detected", ".", "*", "/", "static", "bool", "path_connected", "(", "const", "struct", "path", "*", "path", ")", "{", "struct", "vfsmount", "*", "mnt", "=", "path", "-", ">", "mnt", ";", "/", "*", "Only", "bind", "mounts", "can", "have", "disconnected", "paths", "*", "/", "if", "(", "mnt", "-", ">", "mnt_root", "=", "=", "mnt", "-", ">", "mnt_sb", "-", ">", "s_root", ")", "return", "true", ";", "return", "is_subdir", "(", "path", "-", ">", "dentry", ",", "mnt", "-", ">", "mnt_root", ")", ";", "}", "static", "inline", "int", "nd_alloc_stack", "(", "struct", "nameidata", "*", "nd", ")", "{", "if", "(", "likely", "(", "nd", "-", ">", "depth", "!", "=", "EMBEDDED_LEVELS", ")", ")", "@", "@", "-", "1296", ",", "6", "+", "1314", ",", "8", "@", "@", "static", "int", "follow_dotdot_rcu", "(", "struct", "nameidata", "*", "nd", ")", "return", "-", "ECHILD", ";", "nd", "-", ">", "path", ".", "dentry", "=", "parent", ";", "nd", "-", ">", "seq", "=", "seq", ";", "if", "(", "unlikely", "(", "!", "path_connected", "(", "&", "nd", "-", ">", "path", ")", "))", "return", "-", "ENOENT", ";", "break", ";", "}", "else", "{", "struct", "mount", "*", "mnt", "=", "real_mount", "(", "nd", "-", ">", "path", ".", "mnt", ")", ";", "@", "@", "-", "1396", ",", "7", "+", "1416", ",", "7", "@", "@", "static", "void", "follow_mount", "(", "struct", "path", "*", "path", ")", "}", "}", "static", "void", "follow_dotdot", "(", "struct", "nameidata", "*", "nd", ")", "static", "int", "follow_dotdot", "(", "struct", "nameidata", "*", "nd", ")", "{", "if", "(", "!", "nd", "-", ">", "root", ".", "mnt", ")", "set_root", "(", "nd", ")", ";", "@", "@", "-", "1412", ",", "13", "+", "1432", ",", "16", "@", "@", "static", "void", "follow_dotdot", "(", "struct", "nameidata", "*", "nd", ")", "/", "*", "rare", "case", "of", "legitimate", "dget_parent", "(", ").", "..", "*", "/", "nd", "-", ">", "path", ".", "dentry", "=", "dget_parent", "(", "nd", "-", ">", "path", ".", "dentry", ")", ";", "dput", "(", "old", ")", ";", "if", "(", "unlikely", "(", "!", "path_connected", "(", "&", "nd", "-", ">", "path", ")", "))", "return", "-", "ENOENT", ";", "break", ";", "}", "if", "(", "!", "follow_up", "(", "&", "nd", "-", ">", "path", ")", ")", "break", ";", "}", "follow_mount", "(", "&", "nd", "-", ">", "path", ")", ";", "nd", "-", ">", "inode", "=", "nd", "-", ">", "path", ".", "dentry", "-", ">", "d_inode", ";", "return", "0", ";", "}", "/", "*", "@", "@", "-", "1634", ",", "7", "+", "1657", ",", "7", "@", "@", "static", "inline", "int", "handle_dots", "(", "struct", "nameidata", "*", "nd", ",", "int", "type", ")", "if", "(", "nd", "-", ">", "flags", "&", "LOOKUP_RCU", ")", "{", "return", "follow_dotdot_rcu", "(", "nd", ")", ";", "}", "else", "follow_dotdot", "(", "nd", ")", ";", "return", "follow_dotdot", "(", "nd", ")", ";", "}", "return", "0", ";", "}"], "docstring_tokens": ["bypass", "an", "intended", "container", "protection", "mechanism"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "60", ",", "9", "+", "60", ",", "6", "@", "@", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "MachineTokenEnvVarProvider", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "MavenOptsEnvVariableProvider", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "ProjectsRootEnvVariableProvider", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "WorkspaceAgentCorsAllowCredentialsEnvVarProvider", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "WorkspaceAgentCorsAllowedOriginsEnvVarProvider", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "WorkspaceAgentCorsEnabledEnvVarProvider", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "WorkspaceAgentJavaOptsEnvVariableProvider", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "WorkspaceIdEnvVarProvider", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ".", "WorkspaceNameEnvVarProvider", ";", "@", "@", "-", "180", ",", "14", "+", "177", ",", "6", "@", "@", "protected", "void", "configure", "(", ")", "{", ".", "addBinding", "(", ")", ".", "to", "(", "WorkspaceAgentJavaOptsEnvVariableProvider", ".", "class", ")", ";", "legacyEnvVarProviderMultibinders", ".", "addBinding", "(", ")", ".", "to", "(", "WorkspaceAgentCorsAllowedOriginsEnvVarProvider", ".", "class", ")", ";", "legacyEnvVarProviderMultibinders", ".", "addBinding", "(", ")", ".", "to", "(", "WorkspaceAgentCorsAllowCredentialsEnvVarProvider", ".", "class", ")", ";", "legacyEnvVarProviderMultibinders", ".", "addBinding", "(", ").", "to", "(", "WorkspaceAgentCorsEnabledEnvVarProvider", ".", "class", ")", ";", "bind", "(", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "event", ".", "WorkspaceJsonRpcMessenger", ".", "class", ")", ".", "asEagerSingleton", "(", ");", "bind", "(", "org", ".", "eclipse", ".", "che", ".", "everrest", ".", "EverrestDownloadFileResponseFilter", ".", "class", ")", ";", "@", "@", "-", "52", ",", "8", "+", "52", ",", "8", "@", "@", "protected", "void", "configureServlets", "(", ")", "{", "private", "boolean", "isCheCorsEnabled", "(", ")", "{", "String", "cheCorsEnabledEnvVar", "=", "System", ".", "getenv", "(", "\"", "CHE_CORS_ENABLED", "\"", ");", "if", "(", "cheCorsEnabledEnvVar", "=", "=", "null", ")", "{", "/", "/", "by", "default", "CORS", "should", "be", "enabled", "return", "true", ";", "/", "/", "by", "default", "CORS", "should", "be", "disabled", "return", "false", ";", "}", "else", "{", "return", "Boolean", ".", "valueOf", "(", "cheCorsEnabledEnvVar", ")", ";", "}", "@", "@", "-", "685", ",", "20", "+", "685", ",", "13", "@", "@", "che", ".", "core", ".", "jsonrpc", ".", "minor_processor_queue_capacity", "=", "10000", "che", ".", "metrics", ".", "port", "=", "8087", "#", "CORS", "settings", "#", "CORS", "filter", "on", "WS", "Master", "is", "turned", "on", "by", "default", ".", "#", "Use", "environment", "variable", "\"", "CHE_CORS_ENABLED", "=", "false", "\"", "to", "turn", "it", "off", "#", "CORS", "filter", "on", "WS", "Master", "is", "turned", "off", "by", "default", ".", "#", "Use", "environment", "variable", "\"", "CHE_CORS_ENABLED", "=", "true", "\"", "to", "turn", "it", "on", "#", "\"", "cors", ".", "allowed", ".", "origins", "\"", "indicates", "which", "request", "origins", "are", "allowed", "che", ".", "cors", ".", "allowed_origins", "=", "*", "#", "\"", "cors", ".", "support", ".", "credentials", "\"", "indicates", "if", "it", "allows", "processing", "of", "requests", "with", "credentials", "#", "(", "in", "cookies", ",", "headers", ",", "TLS", "client", "certificates", ")", "che", ".", "cors", ".", "allow_credentials", "=", "false", "#", "This", "property", "is", "used", "to", "provide", "value", "for", "WS", "Agent", "CORS", "allowed", "origins", "env", "variable", "from", "WS", "Master", ".", "#", "If", "set", "to", "null", ",", "then", "the", "value", "will", "be", "automatically", "provided", "by", "WS", "Agent", ".", "che", ".", "wsagent", ".", "cors", ".", "allowed_origins", "=", "NULL", "#", "This", "property", "is", "used", "to", "provide", "value", "for", "WS", "Agent", "CORS", "credentials", "origins", "env", "variable", "from", "WS", "Master", ",", "che", ".", "wsagent", ".", "cors", ".", "allow_credentials", "=", "true", "#", "This", "property", "is", "used", "to", "provide", "value", "for", "WS", "Agent", "CORS", "enabling", ".", "che", ".", "wsagent", ".", "cors", ".", "enabled", "=", "true", "#", "#", "Factory", "defaults", ".", "#", "Editor", "and", "plugin", "which", "will", "be", "used", "for", "factories", "which", "are", "created", "from", "remote", "git", "repository", "@", "@", "-", "1", ",", "43", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Copyright", "(", "c", ")", "2012", "-", "2018", "Red", "Hat", ",", "Inc", ".", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "*", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "2", ".", "0", "*", "which", "is", "available", "at", "https", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "2", ".", "0", "/", "*", "*", "SPDX", "-", "License", "-", "Identifier", ":", "EPL", "-", "2", ".", "0", "*", "*", "Contributors", ":", "*", "Red", "Hat", ",", "Inc", ".", "-", "initial", "API", "and", "implementation", "*", "/", "package", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "javax", ".", "inject", ".", "Named", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "core", ".", "model", ".", "workspace", ".", "runtime", ".", "RuntimeIdentity", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "InfrastructureException", ";", "import", "org", ".", "eclipse", ".", "che", ".", "commons", ".", "annotation", ".", "Nullable", ";", "import", "org", ".", "eclipse", ".", "che", ".", "commons", ".", "lang", ".", "Pair", ";", "/", "**", "*", "Add", "environment", "variable", "that", "defines", "support", "for", "requests", "with", "credentials", "for", "{", "@", "link", "*", "CheCorsFilterConfig", "}", "of", "WS", "Agent", "*", "*", "@", "author", "Mykhailo", "Kuznietsov", "*", "/", "public", "class", "WorkspaceAgentCorsAllowCredentialsEnvVarProvider", "implements", "LegacyEnvVarProvider", "{", "private", "String", "wsAgentCorsAllowCredentials", ";", "@", "Inject", "public", "WorkspaceAgentCorsAllowCredentialsEnvVarProvider", "(", "@", "Nullable", "@", "Named", "(", "\"", "che", ".", "wsagent", ".", "cors", ".", "allow_credentials", "\"", ")", "String", "wsAgentCorsAllowCredentials", ")", "{", "this", ".", "wsAgentCorsAllowCredentials", "=", "wsAgentCorsAllowCredentials", ";", "}", "@", "Override", "public", "Pair", "<", "String", ",", "String", ">", "get", "(", "RuntimeIdentity", "runtimeIdentity", ")", "throws", "InfrastructureException", "{", "return", "wsAgentCorsAllowCredentials", "=", "=", "null", "?", "null", ":", "Pair", ".", "of", "(", "\"", "CHE_WSAGENT_CORS_ALLOW__CREDENTIALS", "\"", ",", "wsAgentCorsAllowCredentials", ")", ";", "}", "}", "@", "@", "-", "1", ",", "42", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Copyright", "(", "c", ")", "2012", "-", "2018", "Red", "Hat", ",", "Inc", ".", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "*", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "2", ".", "0", "*", "which", "is", "available", "at", "https", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "2", ".", "0", "/", "*", "*", "SPDX", "-", "License", "-", "Identifier", ":", "EPL", "-", "2", ".", "0", "*", "*", "Contributors", ":", "*", "Red", "Hat", ",", "Inc", ".", "-", "initial", "API", "and", "implementation", "*", "/", "package", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "javax", ".", "inject", ".", "Named", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "core", ".", "model", ".", "workspace", ".", "runtime", ".", "RuntimeIdentity", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "InfrastructureException", ";", "import", "org", ".", "eclipse", ".", "che", ".", "commons", ".", "annotation", ".", "Nullable", ";", "import", "org", ".", "eclipse", ".", "che", ".", "commons", ".", "lang", ".", "Pair", ";", "/", "**", "*", "Add", "environment", "variable", "that", "defines", "allowed", "origins", "for", "{", "@", "link", "CheCorsFilterConfig", "}", "of", "WS", "Agent", "*", "*", "@", "author", "Mykhailo", "Kuznietsov", "*", "/", "public", "class", "WorkspaceAgentCorsAllowedOriginsEnvVarProvider", "implements", "LegacyEnvVarProvider", "{", "private", "String", "wsAgentCorsAllowedOrigins", ";", "@", "Inject", "public", "WorkspaceAgentCorsAllowedOriginsEnvVarProvider", "(", "@", "Nullable", "@", "Named", "(", "\"", "che", ".", "wsagent", ".", "cors", ".", "allowed_origins", "\"", ")", "String", "wsAgentCorsAllowedOrigins", ")", "{", "this", ".", "wsAgentCorsAllowedOrigins", "=", "wsAgentCorsAllowedOrigins", ";", "}", "@", "Override", "public", "Pair", "<", "String", ",", "String", ">", "get", "(", "RuntimeIdentity", "runtimeIdentity", ")", "throws", "InfrastructureException", "{", "return", "wsAgentCorsAllowedOrigins", "=", "=", "null", "?", "null", ":", "Pair", ".", "of", "(", "\"", "CHE_WSAGENT_CORS_ALLOWED__ORIGINS", "\"", ",", "wsAgentCorsAllowedOrigins", ")", ";", "}", "}", "@", "@", "-", "1", ",", "42", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Copyright", "(", "c", ")", "2012", "-", "2018", "Red", "Hat", ",", "Inc", ".", "*", "This", "program", "and", "the", "accompanying", "materials", "are", "made", "*", "available", "under", "the", "terms", "of", "the", "Eclipse", "Public", "License", "2", ".", "0", "*", "which", "is", "available", "at", "https", ":", "//", "www", ".", "eclipse", ".", "org", "/", "legal", "/", "epl", "-", "2", ".", "0", "/", "*", "*", "SPDX", "-", "License", "-", "Identifier", ":", "EPL", "-", "2", ".", "0", "*", "*", "Contributors", ":", "*", "Red", "Hat", ",", "Inc", ".", "-", "initial", "API", "and", "implementation", "*", "/", "package", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "provision", ".", "env", ";", "import", "javax", ".", "inject", ".", "Inject", ";", "import", "javax", ".", "inject", ".", "Named", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "core", ".", "model", ".", "workspace", ".", "runtime", ".", "RuntimeIdentity", ";", "import", "org", ".", "eclipse", ".", "che", ".", "api", ".", "workspace", ".", "server", ".", "spi", ".", "InfrastructureException", ";", "import", "org", ".", "eclipse", ".", "che", ".", "commons", ".", "annotation", ".", "Nullable", ";", "import", "org", ".", "eclipse", ".", "che", ".", "commons", ".", "lang", ".", "Pair", ";", "/", "**", "*", "Add", "environment", "variable", "that", "enables", "CORS", "filter", "on", "WS", "Agent", "*", "*", "@", "author", "Mykhailo", "Kuznietsov", "*", "/", "public", "class", "WorkspaceAgentCorsEnabledEnvVarProvider", "implements", "LegacyEnvVarProvider", "{", "private", "String", "wsAgentCorsEnabled", ";", "@", "Inject", "public", "WorkspaceAgentCorsEnabledEnvVarProvider", "(", "@", "Nullable", "@", "Named", "(", "\"", "che", ".", "wsagent", ".", "cors", ".", "enabled", "\"", ")", "String", "wsAgentCorsEnabled", ")", "{", "this", ".", "wsAgentCorsEnabled", "=", "wsAgentCorsEnabled", ";", "}", "@", "Override", "public", "Pair", "<", "String", ",", "String", ">", "get", "(", "RuntimeIdentity", "runtimeIdentity", ")", "throws", "InfrastructureException", "{", "return", "wsAgentCorsEnabled", "=", "=", "null", "?", "null", ":", "Pair", ".", "of", "(", "\"", "CHE_WSAGENT_CORS_ENABLED", "\"", ",", "wsAgentCorsEnabled", ")", ";", "}", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2969", ",", "9", "+", "2969", ",", "7", "@", "@", "static", "int", "tls_decrypt_ticket", "(", "SSL", "*", "s", ",", "const", "unsigned", "char", "*", "etick", ",", "HMAC_CTX", "*", "hctx", "=", "NULL", ";", "EVP_CIPHER_CTX", "*", "ctx", ";", "SSL_CTX", "*", "tctx", "=", "s", "-", ">", "initial_ctx", ";", "/", "*", "Need", "at", "least", "keyname", "+", "iv", "+", "some", "encrypted", "data", "*", "/", "if", "(", "eticklen", "<", "48", ")", "return", "2", ";", "/", "*", "Initialize", "session", "ticket", "encryption", "and", "HMAC", "contexts", "*", "/", "hctx", "=", "HMAC_CTX_new", "(", ");", "if", "(", "hctx", "=", "=", "NULL", ")", "@", "@", "-", "3018", ",", "6", "+", "3016", ",", "12", "@", "@", "static", "int", "tls_decrypt_ticket", "(", "SSL", "*", "s", ",", "const", "unsigned", "char", "*", "etick", ",", "if", "(", "mlen", "<", "0", ")", "{", "goto", "err", ";", "}", "/", "*", "Sanity", "check", "ticket", "length", ":", "must", "exceed", "keyname", "+", "IV", "+", "HMAC", "*", "/", "if", "(", "eticklen", "<", "=", "TLSEXT_KEYNAME_LENGTH", "+", "EVP_CIPHER_CTX_iv_length", "(", "ctx", ")", "+", "mlen", ")", "{", "ret", "=", "2", ";", "goto", "err", ";", "}", "eticklen", "-", "=", "mlen", ";", "/", "*", "Check", "HMAC", "of", "encrypted", "ticket", "*", "/", "if", "(", "HMAC_Update", "(", "hctx", ",", "etick", ",", "eticklen", ")", "<", "=", "0"], "docstring_tokens": ["cause", "a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "128", ",", "12", "+", "128", ",", "11", "@", "@", "xfs_nfs_get_inode", "(", "return", "ERR_PTR", "(", "-", "ESTALE", ")", ";", "/", "*", "*", "The", "XFS_IGET_BULKSTAT", "means", "that", "an", "invalid", "inode", "number", "is", "just", "*", "fine", "and", "not", "an", "indication", "of", "a", "corrupted", "filesystem", ".", "Because", "*", "clients", "can", "send", "any", "kind", "of", "invalid", "file", "handle", ",", "e", ".", "g", ".", "after", "*", "a", "restore", "on", "the", "server", "we", "have", "to", "deal", "with", "this", "case", "gracefully", ".", "*", "The", "XFS_IGET_UNTRUSTED", "means", "that", "an", "invalid", "inode", "number", "is", "just", "*", "fine", "and", "not", "an", "indication", "of", "a", "corrupted", "filesystem", "as", "clients", "can", "*", "send", "invalid", "file", "handles", "and", "we", "have", "to", "handle", "it", "gracefully", ".", ".", "*", "/", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "XFS_IGET_BULKSTAT", ",", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "XFS_IGET_UNTRUSTED", ",", "XFS_ILOCK_SHARED", ",", "&", "ip", ",", "0", ")", ";", "if", "(", "error", ")", "{", "/", "*", "@", "@", "-", "1251", ",", "7", "+", "1251", ",", "7", "@", "@", "xfs_imap_lookup", "(", "return", "error", ";", "/", "*", "for", "untrusted", "inodes", "check", "it", "is", "allocated", "first", "*", "/", "if", "(", "(", "flags", "&", "XFS_IGET_BULKSTAT", ")", "&", "&", "if", "(", "(", "flags", "&", "XFS_IGET_UNTRUSTED", ")", "&", "&", "(", "rec", ".", "ir_free", "&", "XFS_INOBT_MASK", "(", "agino", "-", "rec", ".", "ir_startino", ")", "))", "return", "EINVAL", ";", "@", "@", "-", "1292", ",", "8", "+", "1292", ",", "11", "@", "@", "xfs_imap", "(", "if", "(", "agno", ">", "=", "mp", "-", ">", "m_sb", ".", "sb_agcount", "|", "|", "agbno", ">", "=", "mp", "-", ">", "m_sb", ".", "sb_agblocks", "|", "|", "ino", "!", "=", "XFS_AGINO_TO_INO", "(", "mp", ",", "agno", ",", "agino", ")", ")", "{", "#", "ifdef", "DEBUG", "/", "*", "no", "diagnostics", "for", "bulkstat", ",", "ino", "comes", "from", "userspace", "*", "/", "if", "(", "flags", "&", "XFS_IGET_BULKSTAT", ")", "/", "*", "*", "Don", "'", "t", "output", "diagnostic", "information", "for", "untrusted", "inodes", "*", "as", "they", "can", "be", "invalid", "without", "implying", "corruption", ".", "*", "/", "if", "(", "flags", "&", "XFS_IGET_UNTRUSTED", ")", "return", "XFS_ERROR", "(", "EINVAL", ")", ";", "if", "(", "agno", ">", "=", "mp", "-", ">", "m_sb", ".", "sb_agcount", ")", "{", "xfs_fs_cmn_err", "(", "CE_ALERT", ",", "mp", ",", "@", "@", "-", "1329", ",", "7", "+", "1332", ",", "7", "@", "@", "xfs_imap", "(", "*", "inodes", "in", "stale", "state", "on", "disk", ".", "Hence", "we", "have", "to", "do", "a", "btree", "lookup", "*", "in", "all", "cases", "where", "an", "untrusted", "inode", "number", "is", "passed", ".", "*", "/", "if", "(", "flags", "&", "XFS_IGET_BULKSTAT", ")", "{", "if", "(", "flags", "&", "XFS_IGET_UNTRUSTED", ")", "{", "error", "=", "xfs_imap_lookup", "(", "mp", ",", "tp", ",", "agno", ",", "agino", ",", "agbno", ",", "&", "chunk_agbno", ",", "&", "offset_agbno", ",", "flags", ")", ";", "if", "(", "error", ")", "@", "@", "-", "177", ",", "7", "+", "177", ",", "7", "@", "@", "xfs_imap_to_bp", "(", "if", "(", "unlikely", "(", "XFS_TEST_ERROR", "(", "!", "di_ok", ",", "mp", ",", "XFS_ERRTAG_ITOBP_INOTOBP", ",", "XFS_RANDOM_ITOBP_INOTOBP", ")", "))", "{", "if", "(", "iget_flags", "&", "XFS_IGET_BULKSTAT", ")", "{", "if", "(", "iget_flags", "&", "XFS_IGET_UNTRUSTED", ")", "{", "xfs_trans_brelse", "(", "tp", ",", "bp", ")", ";", "return", "XFS_ERROR", "(", "EINVAL", ")", ";", "}", "@", "@", "-", "500", ",", "7", "+", "500", ",", "7", "@", "@", "do", "{", "\\", "*", "Flags", "for", "xfs_iget", "(", ")", "*", "/", "#", "define", "XFS_IGET_CREATE", "0x1", "#", "define", "XFS_IGET_BULKSTAT", "0x2", "#", "define", "XFS_IGET_UNTRUSTED", "0x2", "int", "xfs_inotobp", "(", "struct", "xfs_mount", "*", ",", "struct", "xfs_trans", "*", ",", "xfs_ino_t", ",", "struct", "xfs_dinode", "*", "*,", "@", "@", "-", "80", ",", "7", "+", "80", ",", "7", "@", "@", "xfs_bulkstat_one_int", "(", "return", "XFS_ERROR", "(", "ENOMEM", ")", ";", "error", "=", "xfs_iget", "(", "mp", ",", "NULL", ",", "ino", ",", "XFS_IGET_BULKSTAT", ",", "XFS_ILOCK_SHARED", ",", "&", "ip", ",", "bno", ")", ";", "XFS_IGET_UNTRUSTED", ",", "XFS_ILOCK_SHARED", ",", "&", "ip", ",", "bno", ")", ";", "if", "(", "error", ")", "{", "*", "stat", "=", "BULKSTAT_RV_NOTHING", ";", "goto", "out_free", ";"], "docstring_tokens": ["or", "read", "or", "overwrite", "disk", "blocks", "that", "are", "currently", "assigned", "to", "an", "active", "file"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "5", ",", "6", "+", "5", ",", "8", "@", "@", "PHP", "NEWS", "-", "Core", ":", ".", "Upgraded", "crypt_blowfish", "to", "version", "1", ".", "3", ".", "(", "Leigh", ")", ".", "Fixed", "bug", "#", "68545", "(", "NULL", "pointer", "dereference", "in", "unserialize", ".", "c", ")", ".", "(", "Anatol", ")", ".", "Fixed", "bug", "#", "68594", "(", "Use", "after", "free", "vulnerability", "in", "unserialize", "(", "))", ".", "(", "Stefan", "Esser", ")", "13", "Nov", "2014", "PHP", "5", ".", "4", ".", "35", "@", "@", "-", "0", ",", "0", "+", "1", ",", "23", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "68545", "Use", "after", "free", "vulnerability", "in", "unserialize", "(", ")", "-", "-", "FILE", "-", "-", "<", "?", "php", "for", "(", "$", "i", "=", "4", ";", "$", "i", "<", "100", ";", "$", "i", "+", "+)", "{", "$", "m", "=", "new", "StdClass", "(", ");", "$", "u", "=", "array", "(", "1", ")", ";", "$", "m", "-", ">", "aaa", "=", "array", "(", "1", ",", "2", ",", "&$", "u", ",", "4", ",", "5", ")", ";", "$", "m", "-", ">", "bbb", "=", "1", ";", "$", "m", "-", ">", "ccc", "=", "&", "$", "u", ";", "$", "m", "-", ">", "ddd", "=", "str_repeat", "(", "\"", "A", "\"", ",", "$", "i", ")", ";", "$", "z", "=", "serialize", "(", "$", "m", ")", ";", "$", "z", "=", "str_replace", "(", "\"", "bbb", "\"", ",", "\"", "aaa", "\"", ",", "$", "z", ")", ";", "$", "y", "=", "unserialize", "(", "$", "z", ")", ";", "$", "z", "=", "serialize", "(", "$", "y", ")", ";", "}", "?", ">", "=", "==", "DONE", "=", "==", "-", "-", "EXPECTF", "-", "-", "=", "==", "DONE", "=", "==", "@", "@", "-", "1", ",", "4", "+", "1", ",", "4", "@", "@", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "5", "*", "/", "/", "*", "Generated", "by", "re2c", "0", ".", "13", ".", "7", ".", "5", "on", "Thu", "Dec", "11", "19", ":", "26", ":", "19", "2014", "*", "/", "#", "line", "1", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "/", "*", "+", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "@", "@", "-", "343", ",", "6", "+", "343", ",", "9", "@", "@", "static", "inline", "int", "process_nested_data", "(", "UNSERIALIZE_PARAMETER", ",", "HashTable", "*", "ht", ",", "long", "}", "else", "{", "/", "*", "object", "properties", "should", "include", "no", "integers", "*", "/", "convert_to_string", "(", "key", ")", ";", "if", "(", "zend_symtable_find", "(", "ht", ",", "Z_STRVAL_P", "(", "key", ")", ",", "Z_STRLEN_P", "(", "key", ")", "+", "1", ",", "(", "void", "*", "*)", "&", "old_data", ")", "==", "SUCCESS", ")", "{", "var_push_dtor", "(", "var_hash", ",", "old_data", ")", ";", "}", "zend_hash_update", "(", "ht", ",", "Z_STRVAL_P", "(", "key", ")", ",", "Z_STRLEN_P", "(", "key", ")", "+", "1", ",", "&", "data", ",", "sizeof", "data", ",", "NULL", ")", ";", "}", "@", "@", "-", "480", ",", "7", "+", "483", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "#", "line", "484", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "487", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "{", "YYCTYPE", "yych", ";", "static", "const", "unsigned", "char", "yybm", "[", "]", "=", "{", "@", "@", "-", "540", ",", "9", "+", "543", ",", "9", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy95", ";", "yy3", ":", "#", "line", "835", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "838", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "return", "0", ";", "}", "#", "line", "546", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "549", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy4", ":", "yych", "=", "*", "(", "YYMARKER", "=", "+", "+", "YYCURSOR", ")", ";", "if", "(", "yych", "=", "=", "'", ":'", ")", "goto", "yy89", ";", "@", "@", "-", "585", ",", "13", "+", "588", ",", "13", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "goto", "yy3", ";", "yy14", ":", "+", "+", "YYCURSOR", ";", "#", "line", "829", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "832", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "/", "*", "this", "is", "the", "case", "where", "we", "have", "less", "data", "than", "planned", "*", "/", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_NOTICE", ",", "\"", "Unexpected", "end", "of", "serialized", "data", "\"", ");", "return", "0", ";", "/", "*", "not", "sure", "if", "it", "should", "be", "0", "or", "1", "here", "?", "*", "/", "}", "#", "line", "595", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "598", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy16", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "goto", "yy3", ";", "@", "@", "-", "617", ",", "11", "+", "620", ",", "12", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "if", "(", "yybm", "[", "0", "+", "yych", "]", "&", "128", ")", "{", "goto", "yy20", ";", "}", "if", "(", "yych", "!", "=", "'", ":'", ")", "goto", "yy18", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", ";'", ")", "goto", "yy18", ";", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "683", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "686", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "len2", ",", "len3", ",", "maxlen", ";", "long", "elements", ";", "@", "@", "-", "767", ",", "7", "+", "771", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "elements", ")", ";", "}", "#", "line", "771", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "775", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy25", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "@", "@", "-", "792", ",", "15", "+", "796", ",", "15", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "675", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "678", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "INIT_PZVAL", "(", "*", "rval", ")", ";", "return", "object_common2", "(", "UNSERIALIZE_PASSTHRU", ",", "object_common1", "(", "UNSERIALIZE_PASSTHRU", ",", "ZEND_STANDARD_CLASS_DEF_PTR", ")", ");", "}", "#", "line", "804", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "808", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy32", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy33", ";", "@", "@", "-", "821", ",", "7", "+", "825", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "{'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "655", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "658", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "elements", "=", "parse_iv", "(", "start", "+", "2", ")", ";", "/", "*", "use", "iv", "(", ")", "not", "uiv", "(", ")", "in", "order", "to", "check", "data", "range", "*", "/", "@", "@", "-", "841", ",", "7", "+", "845", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "finish_nested_data", "(", "UNSERIALIZE_PASSTHRU", ")", ";", "}", "#", "line", "845", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "849", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy39", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy40", ";", "@", "@", "-", "862", ",", "7", "+", "866", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "626", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "629", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "maxlen", ";", "char", "*", "str", ";", "@", "@", "-", "891", ",", "7", "+", "895", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_STRINGL", "(", "*", "rval", ",", "str", ",", "len", ",", "0", ")", ";", "return", "1", ";", "}", "#", "line", "895", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "899", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy46", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "+'", ")", "goto", "yy47", ";", "@", "@", "-", "912", ",", "7", "+", "916", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", "\"'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "598", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "601", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "size_t", "len", ",", "maxlen", ";", "char", "*", "str", ";", "@", "@", "-", "940", ",", "7", "+", "944", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_STRINGL", "(", "*", "rval", ",", "str", ",", "len", ",", "1", ")", ";", "return", "1", ";", "}", "#", "line", "944", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "948", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy53", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "{", "@", "@", "-", "1028", ",", "7", "+", "1032", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "}", "yy63", ":", "+", "+", "YYCURSOR", ";", "#", "line", "588", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "591", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "#", "if", "SIZEOF_LONG", "=", "=", "4", "use_double", ":", "@", "@", "-", "1038", ",", "7", "+", "1042", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_DOUBLE", "(", "*", "rval", ",", "zend_strtod", "(", "(", "const", "char", "*", ")", "start", "+", "2", ",", "NULL", ")", ");", "return", "1", ";", "}", "#", "line", "1042", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1046", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy65", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "@", "@", "-", "1097", ",", "7", "+", "1101", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "573", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "576", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "@", "@", "-", "1112", ",", "7", "+", "1116", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "1", ";", "}", "#", "line", "1116", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1120", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy76", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "=", "=", "'", "N", "'", ")", "goto", "yy73", ";", "@", "@", "-", "1139", ",", "7", "+", "1143", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy79", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "546", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "549", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "#", "if", "SIZEOF_LONG", "=", "=", "4", "int", "digits", "=", "YYCURSOR", "-", "start", "-", "3", ";", "@", "@", "-", "1166", ",", "32", "+", "1170", ",", "32", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "ZVAL_LONG", "(", "*", "rval", ",", "parse_iv", "(", "start", "+", "2", ")", ");", "return", "1", ";", "}", "#", "line", "1170", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1174", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy83", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", "/'", ")", "goto", "yy18", ";", "if", "(", "yych", ">", "=", "'", "2", "'", ")", "goto", "yy18", ";", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "539", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "542", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_BOOL", "(", "*", "rval", ",", "parse_iv", "(", "start", "+", "2", ")", ");", "return", "1", ";", "}", "#", "line", "1185", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1189", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy87", ":", "+", "+", "YYCURSOR", ";", "#", "line", "532", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "535", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "*", "p", "=", "YYCURSOR", ";", "INIT_PZVAL", "(", "*", "rval", ")", ";", "ZVAL_NULL", "(", "*", "rval", ")", ";", "return", "1", ";", "}", "#", "line", "1195", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1199", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy89", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "@", "@", "-", "1214", ",", "7", "+", "1218", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy91", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "509", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "512", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "id", ";", "@", "@", "-", "1237", ",", "7", "+", "1241", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "1", ";", "}", "#", "line", "1241", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1245", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "yy95", ":", "yych", "=", "*", "++", "YYCURSOR", ";", "if", "(", "yych", "<", "=", "'", ",'", ")", "{", "@", "@", "-", "1260", ",", "7", "+", "1264", ",", "7", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "if", "(", "yych", "<", "=", "'", "9", "'", ")", "goto", "yy97", ";", "if", "(", "yych", "!", "=", "'", ";'", ")", "goto", "yy18", ";", "+", "+", "YYCURSOR", ";", "#", "line", "488", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "491", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "{", "long", "id", ";", "@", "@", "-", "1281", ",", "9", "+", "1285", ",", "9", "@", "@", "PHPAPI", "int", "php_var_unserialize", "(", "UNSERIALIZE_PARAMETER", ")", "return", "1", ";", "}", "#", "line", "1285", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "#", "line", "1289", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "c", "\"", "}", "#", "line", "837", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "#", "line", "840", "\"", "ext", "/", "standard", "/", "var_unserializer", ".", "re", "\"", "return", "0", ";", "@", "@", "-", "347", ",", "6", "+", "347", ",", "9", "@", "@", "static", "inline", "int", "process_nested_data", "(", "UNSERIALIZE_PARAMETER", ",", "HashTable", "*", "ht", ",", "long", "}", "else", "{", "/", "*", "object", "properties", "should", "include", "no", "integers", "*", "/", "convert_to_string", "(", "key", ")", ";", "if", "(", "zend_symtable_find", "(", "ht", ",", "Z_STRVAL_P", "(", "key", ")", ",", "Z_STRLEN_P", "(", "key", ")", "+", "1", ",", "(", "void", "*", "*)", "&", "old_data", ")", "==", "SUCCESS", ")", "{", "var_push_dtor", "(", "var_hash", ",", "old_data", ")", ";", "}", "zend_hash_update", "(", "ht", ",", "Z_STRVAL_P", "(", "key", ")", ",", "Z_STRLEN_P", "(", "key", ")", "+", "1", ",", "&", "data", ",", "sizeof", "data", ",", "NULL", ")", ";", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2009", ",", "2011", ",", "2013", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2009", ",", "2011", ",", "2013", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "58", ",", "8", "+", "58", ",", "10", "@", "@", "public", "SjsxpDriver", "(", "XmlFriendlyNameCoder", "nameCoder", ")", "{", "protected", "XMLInputFactory", "createInputFactory", "(", ")", "{", "Exception", "exception", "=", "null", ";", "try", "{", "return", "(", "XMLInputFactory", ")", "Class", ".", "forName", "(", "\"", "com", ".", "sun", ".", "xml", ".", "internal", ".", "stream", ".", "XMLInputFactoryImpl", "\"", ").", "newInstance", "(", ");", "}", "catch", "(", "InstantiationException", "e", ")", "{", "final", "XMLInputFactory", "instance", "=", "(", "XMLInputFactory", ")", "Class", ".", "forName", "(", "\"", "com", ".", "sun", ".", "xml", ".", "internal", ".", "stream", ".", "XMLInputFactoryImpl", "\"", ").", "newInstance", "(", ");", "instance", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "instance", ";", "}", "catch", "(", "final", "InstantiationException", "e", ")", "{", "exception", "=", "e", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "exception", "=", "e", ";", "@", "@", "-", "1", ",", "11", "+", "1", ",", "11", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2013", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2013", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "*", "style", "license", "a", "copy", "of", "which", "has", "been", "included", "with", "this", "distribution", "in", "*", "the", "LICENSE", ".", "txt", "file", ".", "*", "*", "*", "Created", "on", "27", ".", "July", "2013", "by", "Joerg", "Schaible", "*", "/", "package", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "xml", ";", "@", "@", "-", "28", ",", "7", "+", "28", ",", "7", "@", "@", "*", "implementations", "configured", "in", "<", "em", ">", "lib", "/", "stax", ".", "properties", "<", "/", "em", ">", "or", "registered", "with", "the", "Service", "*", "API", ".", "*", "<", "/", "p", ">", "*", "*", "*", "@", "author", "J", "&", "ouml", ";", "rg", "Schaible", "*", "@", "since", "1", ".", "4", ".", "5", "*", "/", "@", "@", "-", "75", ",", "7", "+", "75", ",", "9", "@", "@", "protected", "XMLInputFactory", "createInputFactory", "(", ")", "{", "try", "{", "Class", "staxInputFactory", "=", "JVM", ".", "getStaxInputFactory", "(", ");", "if", "(", "staxInputFactory", "!", "=", "null", ")", "{", "return", "(", "XMLInputFactory", ")", "staxInputFactory", ".", "newInstance", "(", ");", "final", "XMLInputFactory", "instance", "=", "(", "XMLInputFactory", ")", "staxInputFactory", ".", "newInstance", "(", ");", "instance", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "instance", ";", "}", "else", "{", "throw", "new", "StreamException", "(", "\"", "Java", "runtime", "has", "no", "standard", "XMLInputFactory", "implementation", ".", "\",", "exception", ")", ";", "}", "@", "@", "-", "1", ",", "6", "+", "1", ",", "6", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2004", ",", "2005", ",", "2006", "Joe", "Walnes", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2009", ",", "2011", ",", "2013", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2006", ",", "2007", ",", "2009", ",", "2011", ",", "2013", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "238", ",", "7", "+", "238", ",", "9", "@", "@", "protected", "XMLStreamReader", "createParser", "(", "Source", "source", ")", "throws", "XMLStreamException", "*", "@", "since", "1", ".", "4", "*", "/", "protected", "XMLInputFactory", "createInputFactory", "(", ")", "{", "return", "XMLInputFactory", ".", "newInstance", "(", ");", "final", "XMLInputFactory", "instance", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "instance", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "instance", ";", "}", "/", "**", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "(", "C", ")", "2009", ",", "2011", "XStream", "Committers", ".", "*", "Copyright", "(", "C", ")", "2009", ",", "2011", ",", "2014", ",", "2015", "XStream", "Committers", ".", "*", "All", "rights", "reserved", ".", "*", "*", "The", "software", "in", "this", "package", "is", "published", "under", "the", "terms", "of", "the", "BSD", "@", "@", "-", "62", ",", "7", "+", "62", ",", "9", "@", "@", "public", "WstxDriver", "(", "NameCoder", "nameCoder", ")", "{", "}", "protected", "XMLInputFactory", "createInputFactory", "(", ")", "{", "return", "new", "WstxInputFactory", "(", ");", "final", "XMLInputFactory", "instance", "=", "new", "WstxInputFactory", "(", ");", "instance", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "false", ")", ";", "return", "instance", ";", "}", "protected", "XMLOutputFactory", "createOutputFactory", "(", ")", "{"], "docstring_tokens": ["access", "data", "on", "the", "file", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "568", ",", "18", "+", "568", ",", "18", "@", "@", "void", "mm_release", "(", "struct", "task_struct", "*", "tsk", ",", "struct", "mm_struct", "*", "mm", ")", "*", "the", "value", "intact", "in", "a", "core", "dump", ",", "and", "to", "save", "the", "unnecessary", "*", "trouble", "otherwise", ".", "Userland", "only", "wants", "this", "done", "for", "a", "sys_exit", ".", "*", "/", "if", "(", "tsk", "-", ">", "clear_child_tid", "&", "&", "!", "(", "tsk", "-", ">", "flags", "&", "PF_SIGNALED", ")", "&", "&", "atomic_read", "(", "&", "mm", "-", ">", "mm_users", ")", ">", "1", ")", "{", "u32", "__user", "*", "tidptr", "=", "tsk", "-", ">", "clear_child_tid", ";", "if", "(", "tsk", "-", ">", "clear_child_tid", ")", "{", "if", "(", "!(", "tsk", "-", ">", "flags", "&", "PF_SIGNALED", ")", "&", "&", "atomic_read", "(", "&", "mm", "-", ">", "mm_users", ")", ">", "1", ")", "{", "/", "*", "*", "We", "don", "'", "t", "check", "the", "error", "code", "-", "if", "userspace", "has", "*", "not", "set", "up", "a", "proper", "pointer", "then", "tough", "luck", ".", "*", "/", "put_user", "(", "0", ",", "tsk", "-", ">", "clear_child_tid", ")", ";", "sys_futex", "(", "tsk", "-", ">", "clear_child_tid", ",", "FUTEX_WAKE", ",", "1", ",", "NULL", ",", "NULL", ",", "0", ")", ";", "}", "tsk", "-", ">", "clear_child_tid", "=", "NULL", ";", "/", "*", "*", "We", "don", "'", "t", "check", "the", "error", "code", "-", "if", "userspace", "has", "*", "not", "set", "up", "a", "proper", "pointer", "then", "tough", "luck", ".", "*", "/", "put_user", "(", "0", ",", "tidptr", ")", ";", "sys_futex", "(", "tidptr", ",", "FUTEX_WAKE", ",", "1", ",", "NULL", ",", "NULL", ",", "0", ")", ";", "}", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "corruption", ")", "or", "possibly", "gain", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "173", ",", "7", "+", "173", ",", "7", "@", "@", "protected", "SchemaFactory", "createSchemaFactory", "(", ")", "{", "if", "(", "getResourceResolver", "(", ")", "!", "=", "null", ")", "{", "factory", ".", "setResourceResolver", "(", "getResourceResolver", "(", "))", ";", "}", "if", "(", "camelContext", "!", "=", "null", "&", "&", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "if", "(", "camelContext", "=", "=", "null", "|", "|", "!", "Boolean", ".", "parseBoolean", "(", "camelContext", ".", "getProperty", "(", "ACCESS_EXTERNAL_DTD", ")", "))", "{", "try", "{", "factory", ".", "setProperty", "(", "XMLConstants", ".", "ACCESS_EXTERNAL_DTD", ",", "\"", "\")", ";", "}", "catch", "(", "SAXException", "e", ")", "{"], "docstring_tokens": ["read", "arbitrary", "files"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "295", ",", "8", "+", "295", ",", "10", "@", "@", "import", "static", "hudson", ".", "Util", ".", "*;", "import", "static", "hudson", ".", "init", ".", "InitMilestone", ".", "*;", "import", "hudson", ".", "remoting", ".", "ClassFilter", ";", "import", "hudson", ".", "util", ".", "LogTaskListener", ";", "import", "static", "java", ".", "util", ".", "logging", ".", "Level", ".", "*;", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "static", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ".", "*;", "import", "org", ".", "kohsuke", ".", "stapler", ".", "WebMethod", ";", "@", "@", "-", "812", ",", "6", "+", "814", ",", "8", "@", "@", "protected", "Jenkins", "(", "File", "root", ",", "ServletContext", "context", ",", "PluginManager", "pluginManager", "adjuncts", "=", "new", "AdjunctManager", "(", "servletContext", ",", "pluginManager", ".", "uberClassLoader", ",", "\"", "adjuncts", "/", "\"+", "SESSION_HASH", ",", "TimeUnit2", ".", "DAYS", ".", "toMillis", "(", "365", ")", ");", "ClassFilter", ".", "appendDefaultFilter", "(", "Pattern", ".", "compile", "(", "\"", "java", "[", ".]", "security", "[", ".]", "SignedObject", "\"", "))", ";", "/", "/", "TODO", "move", "to", "standard", "blacklist", "/", "/", "initialization", "consists", "of", ".", "..", "executeReactor", "(", "is", ",", "pluginManager", ".", "initTasks", "(", "is", ")", ",", "/", "/", "loading", "and", "preparing", "plugins", "@", "@", "-", "179", ",", "7", "+", "179", ",", "7", "@", "@", "THE", "SOFTWARE", ".", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "main", "<", "/", "groupId", ">", "<", "artifactId", ">", "remoting", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "53", ".", "5", "<", "/", "version", ">", "<", "version", ">", "2", ".", "53", ".", "6", "-", "20170306", ".", "191805", "-", "1", "<", "/", "version", ">", "<", "!-", "-", "TODO", "-", "->", "<", "/", "dependency", ">", "<", "dependency", ">", "@", "@", "-", "32", ",", "7", "+", "32", ",", "6", "@", "@", "import", "java", ".", "io", ".", "PrintStream", ";", "import", "jenkins", ".", "security", ".", "security218", ".", "Payload", ";", "import", "org", ".", "jenkinsci", ".", "remoting", ".", "RoleChecker", ";", "import", "org", ".", "junit", ".", "Ignore", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "import", "org", ".", "junit", ".", "Rule", ";", "@", "@", "-", "170", ",", "7", "+", "169", ",", "6", "@", "@", "public", "void", "ldap", "(", ")", "throws", "Exception", "{", "probe", "(", "Payload", ".", "Ldap", ",", "PayloadCaller", ".", "EXIT_CODE_REJECTED", ")", ";", "}", "@", "Ignore", "(", "\"", "TODO", "fails", "unless", "^", "java", "[", ".]", "security", "[", ".]", "SignedObject", "is", "blacklisted", "\"", ")", "@", "PresetData", "(", "PresetData", ".", "DataSet", ".", "ANONYMOUS_READONLY", ")", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "429", "\"", ")"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "40", ",", "6", "+", "40", ",", "8", "@", "@", "*", "event", ".", "Users", "may", "extend", "this", "class", "for", "each", "EventType", "they", "want", "to", "log", ".", "*", "*", "@", "author", "Ralph", "Goers", "*", "*", "@", "deprecated", "Due", "to", "a", "security", "vulnerability", ",", "this", "class", "will", "be", "removed", "without", "replacement", ".", "*", "/", "public", "class", "EventData", "implements", "Serializable", "{"], "docstring_tokens": ["bypass", "intended", "access", "restrictions"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "27", ",", "6", "+", "27", ",", "7", "@", "@", "#", "include", "<", "linux", "/", "pci", ".", "h", ">", "#", "include", "<", "linux", "/", "slab", ".", "h", ">", "#", "include", "<", "linux", "/", "mm", ".", "h", ">", "#", "include", "<", "linux", "/", "seq_file", ".", "h", ">", "#", "include", "<", "asm", "/", "uaccess", ".", "h", ">", "#", "include", "<", "linux", "/", "dma", "-", "mapping", ".", "h", ">", "#", "include", "<", "linux", "/", "moduleparam", ".", "h", ">", "@", "@", "-", "481", ",", "53", "+", "482", ",", "54", "@", "@", "static", "void", "free_all_reserved_pages", "(", "void", ")", "#", "define", "SND_MEM_PROC_FILE", "\"", "driver", "/", "snd", "-", "page", "-", "alloc", "\"", "static", "struct", "proc_dir_entry", "*", "snd_mem_proc", ";", "static", "int", "snd_mem_proc_read", "(", "char", "*", "page", ",", "char", "*", "*", "start", ",", "off_t", "off", ",", "int", "count", ",", "int", "*", "eof", ",", "void", "*", "data", ")", "static", "int", "snd_mem_proc_read", "(", "struct", "seq_file", "*", "seq", ",", "void", "*", "offset", ")", "{", "int", "len", "=", "0", ";", "long", "pages", "=", "snd_allocated_pages", ">", ">", "(", "PAGE_SHIFT", "-", "12", ")", ";", "struct", "snd_mem_list", "*", "mem", ";", "int", "devno", ";", "static", "char", "*", "types", "[", "]", "=", "{", "\"", "UNKNOWN", "\"", ",", "\"", "CONT", "\"", ",", "\"", "DEV", "\"", ",", "\"", "DEV", "-", "SG", "\"", ",", "\"", "SBUS", "\"", "}", ";", "mutex_lock", "(", "&", "list_mutex", ")", ";", "len", "+", "=", "snprintf", "(", "page", "+", "len", ",", "count", "-", "len", ",", "\"", "pages", ":", "%", "li", "bytes", "(", "%", "li", "pages", "per", "%", "likB", ")", "\\", "n", "\"", ",", "pages", "*", "PAGE_SIZE", ",", "pages", ",", "PAGE_SIZE", "/", "1024", ")", ";", "seq_printf", "(", "seq", ",", "\"", "pages", ":", "%", "li", "bytes", "(", "%", "li", "pages", "per", "%", "likB", ")", "\\", "n", "\"", ",", "pages", "*", "PAGE_SIZE", ",", "pages", ",", "PAGE_SIZE", "/", "1024", ")", ";", "devno", "=", "0", ";", "list_for_each_entry", "(", "mem", ",", "&", "mem_list_head", ",", "list", ")", "{", "devno", "+", "+;", "len", "+", "=", "snprintf", "(", "page", "+", "len", ",", "count", "-", "len", ",", "\"", "buffer", "%", "d", ":", "ID", "%", "08x", ":", "type", "%", "s", "\\", "n", "\"", ",", "devno", ",", "mem", "-", ">", "id", ",", "types", "[", "mem", "-", ">", "buffer", ".", "dev", ".", "type", "]", ");", "len", "+", "=", "snprintf", "(", "page", "+", "len", ",", "count", "-", "len", ",", "\"", "addr", "=", "0x", "%", "lx", ",", "size", "=", "%", "d", "bytes", "\\", "n", "\"", ",", "(", "unsigned", "long", ")", "mem", "-", ">", "buffer", ".", "addr", ",", "(", "int", ")", "mem", "-", ">", "buffer", ".", "bytes", ")", ";", "seq_printf", "(", "seq", ",", "\"", "buffer", "%", "d", ":", "ID", "%", "08x", ":", "type", "%", "s", "\\", "n", "\"", ",", "devno", ",", "mem", "-", ">", "id", ",", "types", "[", "mem", "-", ">", "buffer", ".", "dev", ".", "type", "]", ");", "seq_printf", "(", "seq", ",", "\"", "addr", "=", "0x", "%", "lx", ",", "size", "=", "%", "d", "bytes", "\\", "n", "\"", ",", "(", "unsigned", "long", ")", "mem", "-", ">", "buffer", ".", "addr", ",", "(", "int", ")", "mem", "-", ">", "buffer", ".", "bytes", ")", ";", "}", "mutex_unlock", "(", "&", "list_mutex", ")", ";", "return", "len", ";", "return", "0", ";", "}", "static", "int", "snd_mem_proc_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")", "{", "return", "single_open", "(", "file", ",", "snd_mem_proc_read", ",", "NULL", ")", ";", "}", "/", "*", "FIXME", ":", "for", "pci", "only", "-", "other", "bus", "?", "*", "/", "#", "ifdef", "CONFIG_PCI", "#", "define", "gettoken", "(", "bufp", ")", "strsep", "(", "bufp", ",", "\"", "\\", "t", "\\", "n", "\"", ")", "static", "int", "snd_mem_proc_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buffer", ",", "unsigned", "long", "count", ",", "void", "*", "data", ")", "static", "ssize_t", "snd_mem_proc_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buffer", ",", "size_t", "count", ",", "loff_t", "*", "ppos", ")", "{", "char", "buf", "[", "128", "]", ";", "char", "*", "token", ",", "*", "p", ";", "if", "(", "count", ">", "ARRAY_SIZE", "(", "buf", ")", "-", "1", ")", "count", "=", "ARRAY_SIZE", "(", "buf", ")", "-", "1", ";", "if", "(", "count", ">", "sizeof", "(", "buf", ")", "-", "1", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "buf", ",", "buffer", ",", "count", ")", ")", "return", "-", "EFAULT", ";", "buf", "[", "ARRAY_SIZE", "(", "buf", ")", "-", "1", "]", "=", "'", "\\", "0", "'", ";", "buf", "[", "count", "]", "=", "'", "\\", "0", "'", ";", "p", "=", "buf", ";", "token", "=", "gettoken", "(", "&", "p", ")", ";", "if", "(", "!", "token", "|", "|", "*", "token", "=", "=", "'", "#'", ")", "return", "(", "int", ")", "count", ";", "return", "count", ";", "if", "(", "strcmp", "(", "token", ",", "\"", "add", "\"", ")", "=", "=", "0", ")", "{", "char", "*", "endp", ";", "int", "vendor", ",", "device", ",", "size", ",", "buffers", ";", "@", "@", "-", "548", ",", "7", "+", "550", ",", "7", "@", "@", "static", "int", "snd_mem_proc_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buffer", ",", "(", "buffers", "=", "simple_strtol", "(", "token", ",", "NULL", ",", "0", ")", ")", "<", "=", "0", "|", "|", "buffers", ">", "4", ")", "{", "printk", "(", "KERN_ERR", "\"", "snd", "-", "page", "-", "alloc", ":", "invalid", "proc", "write", "format", "\\", "n", "\"", ");", "return", "(", "int", ")", "count", ";", "return", "count", ";", "}", "vendor", "&", "=", "0xffff", ";", "device", "&", "=", "0xffff", ";", "@", "@", "-", "560", ",", "7", "+", "562", ",", "7", "@", "@", "static", "int", "snd_mem_proc_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buffer", ",", "if", "(", "pci_set_dma_mask", "(", "pci", ",", "mask", ")", "<", "0", "|", "|", "pci_set_consistent_dma_mask", "(", "pci", ",", "mask", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "\"", "snd", "-", "page", "-", "alloc", ":", "cannot", "set", "DMA", "mask", "%", "lx", "for", "pci", "%", "04x", ":", "%", "04x", "\\", "n", "\"", ",", "mask", ",", "vendor", ",", "device", ")", ";", "return", "(", "int", ")", "count", ";", "return", "count", ";", "}", "}", "for", "(", "i", "=", "0", ";", "i", "<", "buffers", ";", "i", "+", "+)", "{", "@", "@", "-", "570", ",", "7", "+", "572", ",", "7", "@", "@", "static", "int", "snd_mem_proc_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buffer", ",", "size", ",", "&", "dmab", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "\"", "snd", "-", "page", "-", "alloc", ":", "cannot", "allocate", "buffer", "pages", "(", "size", "=", "%", "d", ")", "\\", "n", "\"", ",", "size", ")", ";", "pci_dev_put", "(", "pci", ")", ";", "return", "(", "int", ")", "count", ";", "return", "count", ";", "}", "snd_dma_reserve_buf", "(", "&", "dmab", ",", "snd_dma_pci_buf_id", "(", "pci", ")", ");", "}", "@", "@", "-", "596", ",", "9", "+", "598", ",", "21", "@", "@", "static", "int", "snd_mem_proc_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buffer", ",", "free_all_reserved_pages", "(", ");", "else", "printk", "(", "KERN_ERR", "\"", "snd", "-", "page", "-", "alloc", ":", "invalid", "proc", "cmd", "\\", "n", "\"", ");", "return", "(", "int", ")", "count", ";", "return", "count", ";", "}", "#", "endif", "/", "*", "CONFIG_PCI", "*", "/", "static", "const", "struct", "file_operations", "snd_mem_proc_fops", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "open", "=", "snd_mem_proc_open", ",", ".", "read", "=", "seq_read", ",", "#", "ifdef", "CONFIG_PCI", ".", "write", "=", "snd_mem_proc_write", ",", "#", "endif", ".", "llseek", "=", "seq_lseek", ",", ".", "release", "=", "single_release", ",", "}", ";", "#", "endif", "/", "*", "CONFIG_PROC_FS", "*", "/", "/", "*", "@", "@", "-", "609", ",", "12", "+", "623", ",", "8", "@", "@", "static", "int", "__init", "snd_mem_init", "(", "void", ")", "{", "#", "ifdef", "CONFIG_PROC_FS", "snd_mem_proc", "=", "create_proc_entry", "(", "SND_MEM_PROC_FILE", ",", "0644", ",", "NULL", ")", ";", "if", "(", "snd_mem_proc", ")", "{", "snd_mem_proc", "-", ">", "read_proc", "=", "snd_mem_proc_read", ";", "#", "ifdef", "CONFIG_PCI", "snd_mem_proc", "-", ">", "write_proc", "=", "snd_mem_proc_write", ";", "#", "endif", "}", "if", "(", "snd_mem_proc", ")", "snd_mem_proc", "-", ">", "proc_fops", "=", "&", "snd_mem_proc_fops", ";", "#", "endif", "return", "0", ";", "}"], "docstring_tokens": ["facilitating", "the", "complete", "compromise", "of", "affected", "computers", "."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "274", ",", "10", "+", "274", ",", "21", "@", "@", "private", "static", "boolean", "checkPermissionOfOther", "(", "FileSystem", "fs", ",", "Path", "path", ",", "FsAction", "action", ",", "Map", "<", "URI", ",", "FileStatus", ">", "statCache", ")", "throws", "IOException", "{", "FileStatus", "status", "=", "getFileStatus", "(", "fs", ",", "path", ".", "toUri", "(", "),", "statCache", ")", ";", "FsPermission", "perms", "=", "status", ".", "getPermission", "(", ");", "FsAction", "otherAction", "=", "perms", ".", "getOtherAction", "(", ");", "if", "(", "otherAction", ".", "implies", "(", "action", ")", ")", "{", "return", "true", ";", "/", "/", "Encrypted", "files", "are", "always", "treated", "as", "private", ".", "This", "stance", "has", "two", "/", "/", "important", "side", "effects", ".", "The", "first", "is", "that", "the", "encrypted", "files", "will", "be", "/", "/", "downloaded", "as", "the", "job", "owner", "instead", "of", "the", "YARN", "user", ",", "which", "is", "required", "/", "/", "for", "the", "KMS", "ACLs", "to", "work", "as", "expected", ".", "Second", ",", "it", "prevent", "a", "file", "with", "/", "/", "world", "readable", "permissions", "that", "is", "stored", "in", "an", "encryption", "zone", "from", "/", "/", "being", "localized", "as", "a", "publicly", "shared", "file", "with", "world", "readable", "/", "/", "permissions", ".", "if", "(", "!", "perms", ".", "getEncryptedBit", "(", "))", "{", "FsAction", "otherAction", "=", "perms", ".", "getOtherAction", "(", ");", "if", "(", "otherAction", ".", "implies", "(", "action", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}"], "docstring_tokens": ["gain", "access", "to", "files", "that", "should", "be", "protected", "by", "HDFS", "transparent", "encryption"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "274", ",", "7", "+", "274", ",", "7", "@", "@", "static", "Image", "*", "ReadHDRImage", "(", "const", "ImageInfo", "*", "image_info", ",", "ExceptionInfo", "*", "exception", ")", "if", "(", "value_expected", "=", "=", "MagickFalse", ")", "continue", ";", "p", "=", "value", ";", "while", "(", "(", "c", "!", "=", "'", "\\", "n", "'", ")", "&", "&", "(", "c", "!", "=", "'", "\\", "0", "'", "))", "while", "(", "(", "c", "!", "=", "'", "\\", "n", "'", ")", "&", "&", "(", "c", "!", "=", "'", "\\", "0", "'", ")", "&", "&", "(", "c", "!", "=", "EOF", ")", ")", "{", "if", "(", "(", "size_t", ")", "(", "p", "-", "value", ")", "<", "(", "MaxTextExtent", "-", "1", ")", ")", "*", "p", "+", "+=", "c", ";", "@", "@", "-", "319", ",", "18", "+", "319", ",", "20", "@", "@", "static", "Image", "*", "ReadHDRImage", "(", "const", "ImageInfo", "*", "image_info", ",", "ExceptionInfo", "*", "exception", ")", "chromaticity", "[", "6", "]", ",", "white_point", "[", "2", "]", ";", "(", "void", ")", "sscanf", "(", "value", ",", "\"%", "g", "%", "g", "%", "g", "%", "g", "%", "g", "%", "g", "%", "g", "%", "g", "\"", ",", "&", "chromaticity", "[", "0", "]", ",&", "chromaticity", "[", "1", "]", ",&", "chromaticity", "[", "2", "]", ",", "&", "chromaticity", "[", "3", "]", ",&", "chromaticity", "[", "4", "]", ",&", "chromaticity", "[", "5", "]", ",", "&", "white_point", "[", "0", "]", ",&", "white_point", "[", "1", "]", ");", "image", "-", ">", "chromaticity", ".", "red_primary", ".", "x", "=", "chromaticity", "[", "0", "]", ";", "image", "-", ">", "chromaticity", ".", "red_primary", ".", "y", "=", "chromaticity", "[", "1", "]", ";", "image", "-", ">", "chromaticity", ".", "green_primary", ".", "x", "=", "chromaticity", "[", "2", "]", ";", "image", "-", ">", "chromaticity", ".", "green_primary", ".", "y", "=", "chromaticity", "[", "3", "]", ";", "image", "-", ">", "chromaticity", ".", "blue_primary", ".", "x", "=", "chromaticity", "[", "4", "]", ";", "image", "-", ">", "chromaticity", ".", "blue_primary", ".", "y", "=", "chromaticity", "[", "5", "]", ";", "image", "-", ">", "chromaticity", ".", "white_point", ".", "x", "=", "white_point", "[", "0", "]", ",", "image", "-", ">", "chromaticity", ".", "white_point", ".", "y", "=", "white_point", "[", "1", "]", ";", "if", "(", "sscanf", "(", "value", ",", "\"%", "g", "%", "g", "%", "g", "%", "g", "%", "g", "%", "g", "%", "g", "%", "g", "\"", ",&", "chromaticity", "[", "0", "]", ",", "&", "chromaticity", "[", "1", "]", ",&", "chromaticity", "[", "2", "]", ",&", "chromaticity", "[", "3", "]", ",", "&", "chromaticity", "[", "4", "]", ",&", "chromaticity", "[", "5", "]", ",&", "white_point", "[", "0", "]", ",", "&", "white_point", "[", "1", "]", ")", "=", "=", "8", ")", "{", "image", "-", ">", "chromaticity", ".", "red_primary", ".", "x", "=", "chromaticity", "[", "0", "]", ";", "image", "-", ">", "chromaticity", ".", "red_primary", ".", "y", "=", "chromaticity", "[", "1", "]", ";", "image", "-", ">", "chromaticity", ".", "green_primary", ".", "x", "=", "chromaticity", "[", "2", "]", ";", "image", "-", ">", "chromaticity", ".", "green_primary", ".", "y", "=", "chromaticity", "[", "3", "]", ";", "image", "-", ">", "chromaticity", ".", "blue_primary", ".", "x", "=", "chromaticity", "[", "4", "]", ";", "image", "-", ">", "chromaticity", ".", "blue_primary", ".", "y", "=", "chromaticity", "[", "5", "]", ";", "image", "-", ">", "chromaticity", ".", "white_point", ".", "x", "=", "white_point", "[", "0", "]", ",", "image", "-", ">", "chromaticity", ".", "white_point", ".", "y", "=", "white_point", "[", "1", "]", ";", "}", "break", ";", "}", "(", "void", ")", "FormatLocaleString", "(", "tag", ",", "MaxTextExtent", ",", "\"", "hdr", ":", "%", "s", "\"", ",", "keyword", ")", ";", "@", "@", "-", "349", ",", "9", "+", "351", ",", "11", "@", "@", "static", "Image", "*", "ReadHDRImage", "(", "const", "ImageInfo", "*", "image_info", ",", "ExceptionInfo", "*", "exception", ")", "height", ",", "width", ";", "(", "void", ")", "sscanf", "(", "value", ",", "\"%", "d", "+", "X", "%", "d", "\"", ",&", "height", ",", "&", "width", ")", ";", "image", "-", ">", "columns", "=", "(", "size_t", ")", "width", ";", "image", "-", ">", "rows", "=", "(", "size_t", ")", "height", ";", "if", "(", "sscanf", "(", "value", ",", "\"%", "d", "+", "X", "%", "d", "\"", ",&", "height", ",", "&", "width", ")", "=", "=", "2", ")", "{", "image", "-", ">", "columns", "=", "(", "size_t", ")", "width", ";", "image", "-", ">", "rows", "=", "(", "size_t", ")", "height", ";", "}", "break", ";", "}", "(", "void", ")", "FormatLocaleString", "(", "tag", ",", "MaxTextExtent", ",", "\"", "hdr", ":", "%", "s", "\"", ",", "keyword", ")", ";"], "docstring_tokens": ["the", "application", "to", "enter", "into", "an", "infinite", "loop"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "70", ",", "11", "+", "70", ",", "12", "@", "@", "void", "enable_sep_cpu", "(", "void", ")", "*", "/", "extern", "const", "char", "vsyscall_int80_start", ",", "vsyscall_int80_end", ";", "extern", "const", "char", "vsyscall_sysenter_start", ",", "vsyscall_sysenter_end", ";", "static", "void", "*", "syscall_page", ";", "static", "struct", "page", "*", "syscall_pages", "[", "1", "]", ";", "int", "__init", "sysenter_setup", "(", "void", ")", "{", "syscall_page", "=", "(", "void", "*", ")", "get_zeroed_page", "(", "GFP_ATOMIC", ")", ";", "void", "*", "syscall_page", "=", "(", "void", "*", ")", "get_zeroed_page", "(", "GFP_ATOMIC", ")", ";", "syscall_pages", "[", "0", "]", "=", "virt_to_page", "(", "syscall_page", ")", ";", "#", "ifdef", "CONFIG_COMPAT_VDSO", "__set_fixmap", "(", "FIX_VDSO", ",", "__pa", "(", "syscall_page", ")", ",", "PAGE_READONLY", ")", ";", "@", "@", "-", "96", ",", "31", "+", "97", ",", "12", "@", "@", "int", "__init", "sysenter_setup", "(", "void", ")", "}", "#", "ifndef", "CONFIG_COMPAT_VDSO", "static", "struct", "page", "*", "syscall_nopage", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "adr", ",", "int", "*", "type", ")", "{", "struct", "page", "*", "p", "=", "virt_to_page", "(", "adr", "-", "vma", "-", ">", "vm_start", "+", "syscall_page", ")", ";", "get_page", "(", "p", ")", ";", "return", "p", ";", "}", "/", "*", "Prevent", "VMA", "merging", "*", "/", "static", "void", "syscall_vma_close", "(", "struct", "vm_area_struct", "*", "vma", ")", "{", "}", "static", "struct", "vm_operations_struct", "syscall_vm_ops", "=", "{", ".", "close", "=", "syscall_vma_close", ",", ".", "nopage", "=", "syscall_nopage", ",", "}", ";", "/", "*", "Defined", "in", "vsyscall", "-", "sysenter", ".", "S", "*", "/", "extern", "void", "SYSENTER_RETURN", ";", "/", "*", "Setup", "a", "VMA", "at", "program", "startup", "for", "the", "vsyscall", "page", "*", "/", "int", "arch_setup_additional_pages", "(", "struct", "linux_binprm", "*", "bprm", ",", "int", "exstack", ")", "{", "struct", "vm_area_struct", "*", "vma", ";", "struct", "mm_struct", "*", "mm", "=", "current", "-", ">", "mm", ";", "unsigned", "long", "addr", ";", "int", "ret", ";", "@", "@", "-", "132", ",", "38", "+", "114", ",", "25", "@", "@", "int", "arch_setup_additional_pages", "(", "struct", "linux_binprm", "*", "bprm", ",", "int", "exstack", ")", "goto", "up_fail", ";", "}", "vma", "=", "kmem_cache_zalloc", "(", "vm_area_cachep", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "vma", ")", "{", "ret", "=", "-", "ENOMEM", ";", "goto", "up_fail", ";", "}", "vma", "-", ">", "vm_start", "=", "addr", ";", "vma", "-", ">", "vm_end", "=", "addr", "+", "PAGE_SIZE", ";", "/", "*", "MAYWRITE", "to", "allow", "gdb", "to", "COW", "and", "set", "breakpoints", "*", "/", "vma", "-", ">", "vm_flags", "=", "VM_READ", "|", "VM_EXEC", "|", "VM_MAYREAD", "|", "VM_MAYEXEC", "|", "VM_MAYWRITE", ";", "/", "*", "*", "MAYWRITE", "to", "allow", "gdb", "to", "COW", "and", "set", "breakpoints", "*", "*", "Make", "sure", "the", "vDSO", "gets", "into", "every", "core", "dump", ".", "*", "Dumping", "its", "contents", "makes", "post", "-", "mortem", "fully", "interpretable", "later", "*", "without", "matching", "up", "the", "same", "kernel", "and", "hardware", "config", "to", "see", "*", "what", "PC", "values", "meant", ".", "*", "/", "vma", "-", ">", "vm_flags", "|", "=", "VM_ALWAYSDUMP", ";", "vma", "-", ">", "vm_flags", "|", "=", "mm", "-", ">", "def_flags", ";", "vma", "-", ">", "vm_page_prot", "=", "protection_map", "[", "vma", "-", ">", "vm_flags", "&", "7", "]", ";", "vma", "-", ">", "vm_ops", "=", "&", "syscall_vm_ops", ";", "vma", "-", ">", "vm_mm", "=", "mm", ";", "ret", "=", "insert_vm_struct", "(", "mm", ",", "vma", ")", ";", "if", "(", "unlikely", "(", "ret", ")", ")", "{", "kmem_cache_free", "(", "vm_area_cachep", ",", "vma", ")", ";", "ret", "=", "install_special_mapping", "(", "mm", ",", "addr", ",", "PAGE_SIZE", ",", "VM_READ", "|", "VM_EXEC", "|", "VM_MAYREAD", "|", "VM_MAYWRITE", "|", "VM_MAYEXEC", "|", "VM_ALWAYSDUMP", ",", "syscall_pages", ")", ";", "if", "(", "ret", ")", "goto", "up_fail", ";", "}", "current", "-", ">", "mm", "-", ">", "context", ".", "vdso", "=", "(", "void", "*", ")", "addr", ";", "current_thread_info", "(", ")-", ">", "sysenter_return", "=", "(", "void", "*", ")", "VDSO_SYM", "(", "&", "SYSENTER_RETURN", ")", ";", "mm", "-", ">", "total_vm", "+", "+;", "up_fail", ":", "up_write", "(", "&", "mm", "-", ">", "mmap_sem", ")", ";", "return", "ret", ";"], "docstring_tokens": ["gain", "elevated", "privileges", "or", "cause", "a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1126", ",", "12", "+", "1126", ",", "10", "@", "@", "static", "int", "ipv6_create_tempaddr", "(", "struct", "inet6_ifaddr", "*", "ifp", ",", "struct", "inet6_ifaddr", "*", "i", "if", "(", "ifp", "-", ">", "flags", "&", "IFA_F_OPTIMISTIC", ")", "addr_flags", "|", "=", "IFA_F_OPTIMISTIC", ";", "ift", "=", "!", "max_addresses", "|", "|", "ipv6_count_addresses", "(", "idev", ")", "<", "max_addresses", "?", "ipv6_add_addr", "(", "idev", ",", "&", "addr", ",", "NULL", ",", "tmp_plen", ",", "ipv6_addr_scope", "(", "&", "addr", ")", ",", "addr_flags", ",", "tmp_valid_lft", ",", "tmp_prefered_lft", ")", ":", "NULL", ";", "if", "(", "IS_ERR_OR_NULL", "(", "ift", ")", ")", "{", "ift", "=", "ipv6_add_addr", "(", "idev", ",", "&", "addr", ",", "NULL", ",", "tmp_plen", ",", "ipv6_addr_scope", "(", "&", "addr", ")", ",", "addr_flags", ",", "tmp_valid_lft", ",", "tmp_prefered_lft", ")", ";", "if", "(", "IS_ERR", "(", "ift", ")", ")", "{", "in6_ifa_put", "(", "ifp", ")", ";", "in6_dev_put", "(", "idev", ")", ";", "pr_info", "(", "\"%", "s", ":", "retry", "temporary", "address", "regeneration", "\\", "n", "\"", ",", "__func__", ")", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(excessive", "retries", "and", "address-generation", "outage)"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "15", "@", "@", "Changes", "between", "1", ".", "0", ".", "1f", "and", "1", ".", "0", ".", "1g", "[", "xx", "XXX", "xxxx", "]", "*", ")", "A", "missing", "bounds", "check", "in", "the", "handling", "of", "the", "TLS", "heartbeat", "extension", "can", "be", "used", "to", "reveal", "up", "to", "64k", "of", "memory", "to", "a", "connected", "client", "or", "server", ".", "Thanks", "for", "Neel", "Mehta", "of", "Google", "Security", "for", "discovering", "this", "bug", "and", "to", "Adam", "Langley", "<", "agl", "@", "chromium", ".", "org", ">", "and", "Bodo", "Moeller", "<", "bmoeller", "@", "acm", ".", "org", ">", "for", "preparing", "the", "fix", "(", "CVE", "-", "2014", "-", "0160", ")", "[", "Adam", "Langley", ",", "Bodo", "Moeller", "]", "*", ")", "Fix", "for", "the", "attack", "described", "in", "the", "paper", "\"", "Recovering", "OpenSSL", "ECDSA", "Nonces", "Using", "the", "FLUSH", "+", "RELOAD", "Cache", "Side", "-", "channel", "Attack", "\"", "by", "Yuval", "Yarom", "and", "Naomi", "Benger", ".", "Details", "can", "be", "obtained", "from", ":", "@", "@", "-", "1459", ",", "26", "+", "1459", ",", "36", "@", "@", "dtls1_process_heartbeat", "(", "SSL", "*", "s", ")", "unsigned", "int", "payload", ";", "unsigned", "int", "padding", "=", "16", ";", "/", "*", "Use", "minimum", "padding", "*", "/", "/", "*", "Read", "type", "and", "payload", "length", "first", "*", "/", "hbtype", "=", "*", "p", "+", "+;", "n2s", "(", "p", ",", "payload", ")", ";", "pl", "=", "p", ";", "if", "(", "s", "-", ">", "msg_callback", ")", "s", "-", ">", "msg_callback", "(", "0", ",", "s", "-", ">", "version", ",", "TLS1_RT_HEARTBEAT", ",", "&", "s", "-", ">", "s3", "-", ">", "rrec", ".", "data", "[", "0", "]", ",", "s", "-", ">", "s3", "-", ">", "rrec", ".", "length", ",", "s", ",", "s", "-", ">", "msg_callback_arg", ")", ";", "/", "*", "Read", "type", "and", "payload", "length", "first", "*", "/", "if", "(", "1", "+", "2", "+", "16", ">", "s", "-", ">", "s3", "-", ">", "rrec", ".", "length", ")", "return", "0", ";", "/", "*", "silently", "discard", "*", "/", "hbtype", "=", "*", "p", "+", "+;", "n2s", "(", "p", ",", "payload", ")", ";", "if", "(", "1", "+", "2", "+", "payload", "+", "16", ">", "s", "-", ">", "s3", "-", ">", "rrec", ".", "length", ")", "return", "0", ";", "/", "*", "silently", "discard", "per", "RFC", "6520", "sec", ".", "4", "*", "/", "pl", "=", "p", ";", "if", "(", "hbtype", "=", "=", "TLS1_HB_REQUEST", ")", "{", "unsigned", "char", "*", "buffer", ",", "*", "bp", ";", "unsigned", "int", "write_length", "=", "1", "/", "*", "heartbeat", "type", "*", "/", "2", "/", "*", "heartbeat", "length", "*", "/", "payload", "+", "padding", ";", "int", "r", ";", "if", "(", "write_length", ">", "SSL3_RT_MAX_PLAIN_LENGTH", ")", "return", "0", ";", "/", "*", "Allocate", "memory", "for", "the", "response", ",", "size", "is", "1", "byte", "*", "message", "type", ",", "plus", "2", "bytes", "payload", "length", ",", "plus", "*", "payload", ",", "plus", "padding", "*", "/", "buffer", "=", "OPENSSL_malloc", "(", "1", "+", "2", "+", "payload", "+", "padding", ")", ";", "buffer", "=", "OPENSSL_malloc", "(", "write_length", ")", ";", "bp", "=", "buffer", ";", "/", "*", "Enter", "response", "type", ",", "length", "and", "copy", "payload", "*", "/", "@", "@", "-", "1489", ",", "11", "+", "1499", ",", "11", "@", "@", "dtls1_process_heartbeat", "(", "SSL", "*", "s", ")", "/", "*", "Random", "padding", "*", "/", "RAND_pseudo_bytes", "(", "bp", ",", "padding", ")", ";", "r", "=", "dtls1_write_bytes", "(", "s", ",", "TLS1_RT_HEARTBEAT", ",", "buffer", ",", "3", "+", "payload", "+", "padding", ")", ";", "r", "=", "dtls1_write_bytes", "(", "s", ",", "TLS1_RT_HEARTBEAT", ",", "buffer", ",", "write_length", ")", ";", "if", "(", "r", ">", "=", "0", "&", "&", "s", "-", ">", "msg_callback", ")", "s", "-", ">", "msg_callback", "(", "1", ",", "s", "-", ">", "version", ",", "TLS1_RT_HEARTBEAT", ",", "buffer", ",", "3", "+", "payload", "+", "padding", ",", "buffer", ",", "write_length", ",", "s", ",", "s", "-", ">", "msg_callback_arg", ")", ";", "OPENSSL_free", "(", "buffer", ")", ";", "@", "@", "-", "2588", ",", "16", "+", "2588", ",", "20", "@", "@", "tls1_process_heartbeat", "(", "SSL", "*", "s", ")", "unsigned", "int", "payload", ";", "unsigned", "int", "padding", "=", "16", ";", "/", "*", "Use", "minimum", "padding", "*", "/", "/", "*", "Read", "type", "and", "payload", "length", "first", "*", "/", "hbtype", "=", "*", "p", "+", "+;", "n2s", "(", "p", ",", "payload", ")", ";", "pl", "=", "p", ";", "if", "(", "s", "-", ">", "msg_callback", ")", "s", "-", ">", "msg_callback", "(", "0", ",", "s", "-", ">", "version", ",", "TLS1_RT_HEARTBEAT", ",", "&", "s", "-", ">", "s3", "-", ">", "rrec", ".", "data", "[", "0", "]", ",", "s", "-", ">", "s3", "-", ">", "rrec", ".", "length", ",", "s", ",", "s", "-", ">", "msg_callback_arg", ")", ";", "/", "*", "Read", "type", "and", "payload", "length", "first", "*", "/", "if", "(", "1", "+", "2", "+", "16", ">", "s", "-", ">", "s3", "-", ">", "rrec", ".", "length", ")", "return", "0", ";", "/", "*", "silently", "discard", "*", "/", "hbtype", "=", "*", "p", "+", "+;", "n2s", "(", "p", ",", "payload", ")", ";", "if", "(", "1", "+", "2", "+", "payload", "+", "16", ">", "s", "-", ">", "s3", "-", ">", "rrec", ".", "length", ")", "return", "0", ";", "/", "*", "silently", "discard", "per", "RFC", "6520", "sec", ".", "4", "*", "/", "pl", "=", "p", ";", "if", "(", "hbtype", "=", "=", "TLS1_HB_REQUEST", ")", "{", "unsigned", "char", "*", "buffer", ",", "*", "bp", ";"], "docstring_tokens": ["hijack", "the", "person's", "session", "allowing", "for", "unauthorized", "access"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "147", ",", "7", "+", "147", ",", "7", "@", "@", "file_ascmagic_with_encoding", "(", "struct", "magic_set", "*", "ms", ",", "const", "unsigned", "char", "*", "buf", ",", "=", "=", "NULL", ")", "goto", "done", ";", "if", "(", "(", "rv", "=", "file_softmagic", "(", "ms", ",", "utf8_buf", ",", "(", "size_t", ")", "(", "utf8_end", "-", "utf8_buf", ")", ",", "TEXTTEST", ",", "text", ")", ")", "=", "=", "0", ")", "(", "size_t", ")", "(", "utf8_end", "-", "utf8_buf", ")", ",", "0", ",", "TEXTTEST", ",", "text", ")", ")", "=", "=", "0", ")", "rv", "=", "-", "1", ";", "}", "@", "@", "-", "437", ",", "7", "+", "437", ",", "7", "@", "@", "protected", "int", "file_encoding", "(", "struct", "magic_set", "*", ",", "const", "unsigned", "char", "*", ",", "size_t", ",", "unichar", "*", "*,", "size_t", "*", ",", "const", "char", "*", "*,", "const", "char", "*", "*,", "const", "char", "*", "*)", ";", "protected", "int", "file_is_tar", "(", "struct", "magic_set", "*", ",", "const", "unsigned", "char", "*", ",", "size_t", ")", ";", "protected", "int", "file_softmagic", "(", "struct", "magic_set", "*", ",", "const", "unsigned", "char", "*", ",", "size_t", ",", "int", ",", "int", ")", ";", "size_t", ",", "int", ",", "int", ")", ";", "protected", "int", "file_apprentice", "(", "struct", "magic_set", "*", ",", "const", "char", "*", ",", "int", ")", ";", "protected", "int", "file_magicfind", "(", "struct", "magic_set", "*", ",", "const", "char", "*", ",", "struct", "mlist", "*", ");", "protected", "uint64_t", "file_signextend", "(", "struct", "magic_set", "*", ",", "struct", "magic", "*", ",", "@", "@", "-", "235", ",", "7", "+", "235", ",", "7", "@", "@", "file_buffer", "(", "struct", "magic_set", "*", "ms", ",", "php_stream", "*", "stream", ",", "const", "char", "*", "inname", ",", "const", "/", "*", "try", "soft", "magic", "tests", "*", "/", "if", "(", "(", "ms", "-", ">", "flags", "&", "MAGIC_NO_CHECK_SOFT", ")", "=", "=", "0", ")", "if", "(", "(", "m", "=", "file_softmagic", "(", "ms", ",", "ubuf", ",", "nb", ",", "BINTEST", ",", "if", "(", "(", "m", "=", "file_softmagic", "(", "ms", ",", "ubuf", ",", "nb", ",", "0", ",", "BINTEST", ",", "looks_text", ")", ")", "!", "=", "0", ")", "{", "if", "(", "(", "ms", "-", ">", "flags", "&", "MAGIC_DEBUG", ")", "!", "=", "0", ")", "(", "void", ")", "fprintf", "(", "stderr", ",", "\"", "softmagic", "%", "d", "\\", "n", "\"", ",", "m", ")", ";", "@", "@", "-", "74", ",", "13", "+", "74", ",", "13", "@", "@", "private", "void", "cvt_64", "(", "union", "VALUETYPE", "*", ",", "const", "struct", "magic", "*", ");", "/", "*", "ARGSUSED1", "*", "/", "/", "*", "nbytes", "passed", "for", "regularity", ",", "maybe", "need", "later", "*", "/", "protected", "int", "file_softmagic", "(", "struct", "magic_set", "*", "ms", ",", "const", "unsigned", "char", "*", "buf", ",", "size_t", "nbytes", ",", "int", "mode", ",", "int", "text", ")", "size_t", "level", ",", "int", "mode", ",", "int", "text", ")", "{", "struct", "mlist", "*", "ml", ";", "int", "rv", ",", "printed_something", "=", "0", ",", "need_separator", "=", "0", ";", "for", "(", "ml", "=", "ms", "-", ">", "mlist", "[", "0", "]", "->", "next", ";", "ml", "!", "=", "ms", "-", ">", "mlist", "[", "0", "]", ";", "ml", "=", "ml", "-", ">", "next", ")", "if", "(", "(", "rv", "=", "match", "(", "ms", ",", "ml", "-", ">", "magic", ",", "ml", "-", ">", "nmagic", ",", "buf", ",", "nbytes", ",", "0", ",", "mode", ",", "text", ",", "0", ",", "0", ",", "&", "printed_something", ",", "&", "need_separator", ",", "text", ",", "0", ",", "level", ",", "&", "printed_something", ",", "&", "need_separator", ",", "NULL", ")", ")", "!", "=", "0", ")", "return", "rv", ";", "@", "@", "-", "1680", ",", "14", "+", "1680", ",", "16", "@", "@", "mget", "(", "struct", "magic_set", "*", "ms", ",", "const", "unsigned", "char", "*", "s", ",", "struct", "magic", "*", "m", ",", "break", ";", "case", "FILE_INDIRECT", ":", "if", "(", "offset", "=", "=", "0", ")", "return", "0", ";", "if", "(", "nbytes", "<", "offset", ")", "return", "0", ";", "sbuf", "=", "ms", "-", ">", "o", ".", "buf", ";", "soffset", "=", "ms", "-", ">", "offset", ";", "ms", "-", ">", "o", ".", "buf", "=", "NULL", ";", "ms", "-", ">", "offset", "=", "0", ";", "rv", "=", "file_softmagic", "(", "ms", ",", "s", "+", "offset", ",", "nbytes", "-", "offset", ",", "BINTEST", ",", "text", ")", ";", "recursion_level", ",", "BINTEST", ",", "text", ")", ";", "if", "(", "(", "ms", "-", ">", "flags", "&", "MAGIC_DEBUG", ")", "!", "=", "0", ")", "fprintf", "(", "stderr", ",", "\"", "indirect", "@", "offs", "=", "%", "u", "[", "%", "d", "]", "\\", "n", "\"", ",", "offset", ",", "rv", ")", ";", "rbuf", "=", "ms", "-", ">", "o", ".", "buf", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "39", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "66731", ":", "file", ":", "infinite", "recursion", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "class_exists", "(", "'", "finfo", "'", "))", "die", "(", "'", "skip", "no", "fileinfo", "extension", "'", ");", "-", "-", "FILE", "-", "-", "<", "?", "php", "$", "fd", "=", "__DIR__", ".", "'/", "cve", "-", "2014", "-", "1943", ".", "data", "'", ";", "$", "fm", "=", "__DIR__", ".", "'/", "cve", "-", "2014", "-", "1943", ".", "magic", "'", ";", "$", "a", "=", "\"", "\\", "105", "\\", "122", "\\", "000", "\\", "000", "\\", "000", "\\", "000", "\\", "000", "\"", ";", "$", "b", "=", "str_repeat", "(", "\"\\", "001", "\"", ",", "250000", ")", ";", "$", "m", "=", "\"", "0", "byte", "x", "\\", "n", "\"", ".", "\"", ">(", "1", ".", "b", ")", "indirect", "x", "\\", "n", "\"", ";", "file_put_contents", "(", "$", "fd", ",", "$", "a", ")", ";", "$", "fi", "=", "finfo_open", "(", "FILEINFO_NONE", ")", ";", "var_dump", "(", "finfo_file", "(", "$", "fi", ",", "$", "fd", ")", ");", "finfo_close", "(", "$", "fi", ")", ";", "file_put_contents", "(", "$", "fd", ",", "$", "b", ")", ";", "file_put_contents", "(", "$", "fm", ",", "$", "m", ")", ";", "$", "fi", "=", "finfo_open", "(", "FILEINFO_NONE", ",", "$", "fm", ")", ";", "var_dump", "(", "finfo_file", "(", "$", "fi", ",", "$", "fd", ")", ");", "finfo_close", "(", "$", "fi", ")", ";", "?", ">", "Done", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "@", "unlink", "(", "__DIR__", ".", "'/", "cve", "-", "2014", "-", "1943", ".", "data", "'", ");", "@", "unlink", "(", "__DIR__", ".", "'/", "cve", "-", "2014", "-", "1943", ".", "magic", "'", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "string", "(", "%", "d", ")", "\"", "%", "s", "\"", "Warning", ":", "finfo_file", "(", "):", "Failed", "identify", "data", "0", ":", "(", "null", ")", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "false", ")", "Done"], "docstring_tokens": ["update", "your", "vulnerable", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "661", ",", "6", "+", "661", ",", "8", "@", "@", "static", "Image", "*", "ReadBMPImage", "(", "const", "ImageInfo", "*", "image_info", ",", "ExceptionInfo", "*", "exception", ")", "bmp_info", ".", "x_pixels", "=", "ReadBlobLSBLong", "(", "image", ")", ";", "bmp_info", ".", "y_pixels", "=", "ReadBlobLSBLong", "(", "image", ")", ";", "bmp_info", ".", "number_colors", "=", "ReadBlobLSBLong", "(", "image", ")", ";", "if", "(", "bmp_info", ".", "number_colors", ">", "GetBlobSize", "(", "image", ")", ")", "ThrowReaderException", "(", "CorruptImageError", ",", "\"", "InsufficientImageDataInFile", "\"", ");", "bmp_info", ".", "colors_important", "=", "ReadBlobLSBLong", "(", "image", ")", ";", "if", "(", "image", "-", ">", "debug", "!", "=", "MagickFalse", ")", "{"], "docstring_tokens": ["cause", "a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "217", ",", "6", "+", "217", ",", "15", "@", "@", "public", "int", "hashCode", "(", ")", "{", "return", "result", ";", "}", "public", "boolean", "isEmpty", "(", ")", "{", "return", "clusterPrivileges", ".", "length", "=", "=", "0", "&", "&", "configurableClusterPrivileges", ".", "length", "=", "=", "0", "&", "&", "indicesPrivileges", ".", "length", "=", "=", "0", "&", "&", "applicationPrivileges", ".", "length", "=", "=", "0", "&", "&", "runAs", ".", "length", "=", "=", "0", "&", "&", "metadata", ".", "size", "(", ")", "=", "=", "0", ";", "}", "@", "Override", "public", "XContentBuilder", "toXContent", "(", "XContentBuilder", "builder", ",", "Params", "params", ")", "throws", "IOException", "{", "return", "toXContent", "(", "builder", ",", "params", ",", "false", ")", ";", "@", "@", "-", "54", ",", "6", "+", "54", ",", "11", "@", "@", "protected", "void", "doExecute", "(", "Task", "task", ",", "CreateApiKeyRequest", "request", ",", "ActionListener", "<", "if", "(", "authentication", "=", "=", "null", ")", "{", "listener", ".", "onFailure", "(", "new", "IllegalStateException", "(", "\"", "authentication", "is", "required", "\"", "))", ";", "}", "else", "{", "if", "(", "Authentication", ".", "AuthenticationType", ".", "API_KEY", "=", "=", "authentication", ".", "getAuthenticationType", "(", ")", "&", "&", "grantsAnyPrivileges", "(", "request", ")", ")", "{", "listener", ".", "onFailure", "(", "new", "IllegalArgumentException", "(", "\"", "creating", "derived", "api", "keys", "requires", "an", "explicit", "role", "descriptor", "that", "is", "empty", "(", "has", "no", "privileges", ")", "\")", ");", "return", ";", "}", "rolesStore", ".", "getRoleDescriptors", "(", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "authentication", ".", "getUser", "(", ").", "roles", "(", "))", "),", "ActionListener", ".", "wrap", "(", "roleDescriptors", "-", ">", "{", "for", "(", "RoleDescriptor", "rd", ":", "roleDescriptors", ")", "{", "@", "@", "-", "69", ",", "4", "+", "74", ",", "10", "@", "@", "protected", "void", "doExecute", "(", "Task", "task", ",", "CreateApiKeyRequest", "request", ",", "ActionListener", "<", "listener", ":", ":", "onFailure", ")", ");", "}", "}", "private", "boolean", "grantsAnyPrivileges", "(", "CreateApiKeyRequest", "request", ")", "{", "return", "request", ".", "getRoleDescriptors", "(", ")", "=", "=", "null", "|", "|", "request", ".", "getRoleDescriptors", "(", ").", "isEmpty", "(", ")", "|", "|", "false", "=", "=", "request", ".", "getRoleDescriptors", "(", ").", "stream", "(", ").", "allMatch", "(", "RoleDescriptor", ":", ":", "isEmpty", ")", ";", "}", "}", "@", "@", "-", "10", ",", "6", "+", "10", ",", "8", "@", "@", "import", "org", ".", "elasticsearch", ".", "ElasticsearchSecurityException", ";", "import", "org", ".", "elasticsearch", ".", "action", ".", "DocWriteResponse", ";", "import", "org", ".", "elasticsearch", ".", "action", ".", "admin", ".", "cluster", ".", "health", ".", "ClusterHealthResponse", ";", "import", "org", ".", "elasticsearch", ".", "action", ".", "admin", ".", "indices", ".", "refresh", ".", "RefreshAction", ";", "import", "org", ".", "elasticsearch", ".", "action", ".", "admin", ".", "indices", ".", "refresh", ".", "RefreshRequestBuilder", ";", "import", "org", ".", "elasticsearch", ".", "action", ".", "admin", ".", "indices", ".", "refresh", ".", "RefreshResponse", ";", "import", "org", ".", "elasticsearch", ".", "action", ".", "support", ".", "PlainActionFuture", ";", "import", "org", ".", "elasticsearch", ".", "action", ".", "support", ".", "WriteRequest", ";", "@", "@", "-", "669", ",", "6", "+", "671", ",", "80", "@", "@", "public", "void", "testApiKeyWithManageOwnPrivilegeIsAbleToInvalidateItselfButNotAnyOth", "assertThat", "(", "invalidateResponse", ".", "getErrors", "(", ").", "size", "(", "),", "equalTo", "(", "0", ")", ");", "}", "public", "void", "testDerivedKeys", "(", ")", "throws", "ExecutionException", ",", "InterruptedException", "{", "final", "Client", "client", "=", "client", "(", ").", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "\"", "Authorization", "\"", ",", "UsernamePasswordToken", ".", "basicAuthHeaderValue", "(", "SecuritySettingsSource", ".", "TEST_SUPERUSER", ",", "SecuritySettingsSourceField", ".", "TEST_PASSWORD_SECURE_STRING", ")", "))", ";", "final", "CreateApiKeyResponse", "response", "=", "new", "SecurityClient", "(", "client", ")", ".", "prepareCreateApiKey", "(", ")", ".", "setName", "(", "\"", "key", "-", "1", "\"", ")", ".", "setRoleDescriptors", "(", "Collections", ".", "singletonList", "(", "new", "RoleDescriptor", "(", "\"", "role", "\"", ",", "new", "String", "[", "]", "{", "\"", "manage_api_key", "\"", "}", ",", "null", ",", "null", ")", "))", ".", "get", "(", ");", "assertEquals", "(", "\"", "key", "-", "1", "\"", ",", "response", ".", "getName", "(", "))", ";", "assertNotNull", "(", "response", ".", "getId", "(", "))", ";", "assertNotNull", "(", "response", ".", "getKey", "(", "))", ";", "/", "/", "use", "the", "first", "ApiKey", "for", "authorized", "action", "final", "String", "base64ApiKeyKeyValue", "=", "Base64", ".", "getEncoder", "(", ").", "encodeToString", "(", "(", "response", ".", "getId", "(", ")", "+", "\"", ":\"", "+", "response", ".", "getKey", "(", ").", "toString", "(", "))", ".", "getBytes", "(", "StandardCharsets", ".", "UTF_8", ")", ");", "final", "SecurityClient", "clientKey1", "=", "new", "SecurityClient", "(", "client", "(", ").", "filterWithHeader", "(", "Collections", ".", "singletonMap", "(", "\"", "Authorization", "\"", ",", "\"", "ApiKey", "\"", "+", "base64ApiKeyKeyValue", ")", "))", ";", "final", "String", "expectedMessage", "=", "\"", "creating", "derived", "api", "keys", "requires", "an", "explicit", "role", "descriptor", "that", "is", "empty", "\"", ";", "final", "IllegalArgumentException", "e1", "=", "expectThrows", "(", "IllegalArgumentException", ".", "class", ",", "(", ")", "-", ">", "clientKey1", ".", "prepareCreateApiKey", "(", ").", "setName", "(", "\"", "key", "-", "2", "\"", ").", "get", "(", "))", ";", "assertThat", "(", "e1", ".", "getMessage", "(", "),", "containsString", "(", "expectedMessage", ")", ");", "final", "IllegalArgumentException", "e2", "=", "expectThrows", "(", "IllegalArgumentException", ".", "class", ",", "(", ")", "-", ">", "clientKey1", ".", "prepareCreateApiKey", "(", ").", "setName", "(", "\"", "key", "-", "3", "\"", ")", ".", "setRoleDescriptors", "(", "Collections", ".", "emptyList", "(", "))", ".", "get", "(", "))", ";", "assertThat", "(", "e2", ".", "getMessage", "(", "),", "containsString", "(", "expectedMessage", ")", ");", "final", "IllegalArgumentException", "e3", "=", "expectThrows", "(", "IllegalArgumentException", ".", "class", ",", "(", ")", "-", ">", "clientKey1", ".", "prepareCreateApiKey", "(", ").", "setName", "(", "\"", "key", "-", "4", "\"", ")", ".", "setRoleDescriptors", "(", "Collections", ".", "singletonList", "(", "new", "RoleDescriptor", "(", "\"", "role", "\"", ",", "new", "String", "[", "]", "{", "\"", "manage_own_api_key", "\"", "},", "null", ",", "null", ")", ")", ").", "get", "(", "))", ";", "assertThat", "(", "e3", ".", "getMessage", "(", "),", "containsString", "(", "expectedMessage", ")", ");", "final", "List", "<", "RoleDescriptor", ">", "roleDescriptors", "=", "randomList", "(", "2", ",", "10", ",", "(", ")", "-", ">", "new", "RoleDescriptor", "(", "\"", "role", "\"", ",", "null", ",", "null", ",", "null", ")", ");", "roleDescriptors", ".", "set", "(", "randomInt", "(", "roleDescriptors", ".", "size", "(", ")", "-", "1", ")", ",", "new", "RoleDescriptor", "(", "\"", "role", "\"", ",", "new", "String", "[", "]", "{", "\"", "manage_own_api_key", "\"", "},", "null", ",", "null", ")", ");", "final", "IllegalArgumentException", "e4", "=", "expectThrows", "(", "IllegalArgumentException", ".", "class", ",", "(", ")", "-", ">", "clientKey1", ".", "prepareCreateApiKey", "(", ").", "setName", "(", "\"", "key", "-", "5", "\"", ")", ".", "setRoleDescriptors", "(", "roleDescriptors", ")", ".", "get", "(", "))", ";", "assertThat", "(", "e4", ".", "getMessage", "(", "),", "containsString", "(", "expectedMessage", ")", ");", "final", "CreateApiKeyResponse", "key100Response", "=", "clientKey1", ".", "prepareCreateApiKey", "(", ").", "setName", "(", "\"", "key", "-", "100", "\"", ")", ".", "setRoleDescriptors", "(", "Collections", ".", "singletonList", "(", "new", "RoleDescriptor", "(", "\"", "role", "\"", ",", "null", ",", "null", ",", "null", ")", ")", ").", "get", "(", ");", "assertEquals", "(", "\"", "key", "-", "100", "\"", ",", "key100Response", ".", "getName", "(", "))", ";", "assertNotNull", "(", "key100Response", ".", "getId", "(", "))", ";", "assertNotNull", "(", "key100Response", ".", "getKey", "(", "))", ";", "/", "/", "Check", "at", "the", "end", "to", "allow", "sometime", "for", "the", "operation", "to", "happen", ".", "Since", "an", "erroneous", "creation", "is", "/", "/", "asynchronous", "so", "that", "the", "document", "is", "not", "available", "immediately", ".", "assertApiKeyNotCreated", "(", "client", ",", "\"", "key", "-", "2", "\"", ");", "assertApiKeyNotCreated", "(", "client", ",", "\"", "key", "-", "3", "\"", ");", "assertApiKeyNotCreated", "(", "client", ",", "\"", "key", "-", "4", "\"", ");", "assertApiKeyNotCreated", "(", "client", ",", "\"", "key", "-", "5", "\"", ");", "}", "private", "void", "assertApiKeyNotCreated", "(", "Client", "client", ",", "String", "keyName", ")", "throws", "ExecutionException", ",", "InterruptedException", "{", "new", "RefreshRequestBuilder", "(", "client", ",", "RefreshAction", ".", "INSTANCE", ")", ".", "setIndices", "(", "SECURITY_MAIN_ALIAS", ")", ".", "execute", "(", ").", "get", "(", ");", "PlainActionFuture", "<", "GetApiKeyResponse", ">", "getApiKeyResponseListener", "=", "new", "PlainActionFuture", "<", ">(", ");", "new", "SecurityClient", "(", "client", ")", ".", "getApiKey", "(", "GetApiKeyRequest", ".", "usingApiKeyName", "(", "keyName", ",", "false", ")", ",", "getApiKeyResponseListener", ")", ";", "assertEquals", "(", "0", ",", "getApiKeyResponseListener", ".", "get", "(", ").", "getApiKeyInfos", "(", ").", "length", ")", ";", "}", "private", "void", "verifyGetResponse", "(", "int", "expectedNumberOfApiKeys", ",", "List", "<", "CreateApiKeyResponse", ">", "responses", ",", "GetApiKeyResponse", "response", ",", "Set", "<", "String", ">", "validApiKeyIds", ",", "List", "<", "String", ">", "invalidatedApiKeyIds", ")", "{", "verifyGetResponse", "(", "SecuritySettingsSource", ".", "TEST_SUPERUSER", ",", "expectedNumberOfApiKeys", ",", "responses", ",", "response", ",", "validApiKeyIds", ",", "@", "@", "-", "32", ",", "7", "+", "32", ",", "9", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "LinkedHashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "static", "org", ".", "elasticsearch", ".", "common", ".", "xcontent", ".", "XContentFactory", ".", "jsonBuilder", ";", "@", "@", "-", "325", ",", "4", "+", "327", ",", "55", "@", "@", "public", "void", "testParseIndicesPrivilegesFailsWhenExceptFieldsAreNotSubsetOfGranted", "assertThat", "(", "epe", ",", "TestMatchers", ".", "throwableWithMessage", "(", "containsString", "(", "\"", "f2", "\"", "))", ");", "assertThat", "(", "epe", ",", "TestMatchers", ".", "throwableWithMessage", "(", "containsString", "(", "\"", "f3", "\"", "))", ");", "}", "public", "void", "testIsEmpty", "(", ")", "{", "assertTrue", "(", "new", "RoleDescriptor", "(", "randomAlphaOfLengthBetween", "(", "1", ",", "10", ")", ",", "null", ",", "null", ",", "null", ",", "null", ",", "null", ",", "null", ",", "null", ")", ".", "isEmpty", "(", "))", ";", "assertTrue", "(", "new", "RoleDescriptor", "(", "randomAlphaOfLengthBetween", "(", "1", ",", "10", ")", ",", "new", "String", "[", "0", "]", ",", "new", "RoleDescriptor", ".", "IndicesPrivileges", "[", "0", "]", ",", "new", "RoleDescriptor", ".", "ApplicationResourcePrivileges", "[", "0", "]", ",", "new", "ConfigurableClusterPrivilege", "[", "0", "]", ",", "new", "String", "[", "0", "]", ",", "new", "HashMap", "<", ">(", "),", "new", "HashMap", "<", ">(", "))", ".", "isEmpty", "(", "))", ";", "final", "List", "<", "Boolean", ">", "booleans", "=", "Arrays", ".", "asList", "(", "randomBoolean", "(", "),", "randomBoolean", "(", "),", "randomBoolean", "(", "),", "randomBoolean", "(", "),", "randomBoolean", "(", "),", "randomBoolean", "(", "))", ";", "final", "RoleDescriptor", "roleDescriptor", "=", "new", "RoleDescriptor", "(", "randomAlphaOfLengthBetween", "(", "1", ",", "10", ")", ",", "booleans", ".", "get", "(", "0", ")", "?", "new", "String", "[", "0", "]", ":", "new", "String", "[", "]", "{", "\"", "foo", "\"", "}", ",", "booleans", ".", "get", "(", "1", ")", "?", "new", "RoleDescriptor", ".", "IndicesPrivileges", "[", "0", "]", ":", "new", "RoleDescriptor", ".", "IndicesPrivileges", "[", "]", "{", "RoleDescriptor", ".", "IndicesPrivileges", ".", "builder", "(", ").", "indices", "(", "\"", "idx", "\"", ").", "privileges", "(", "\"", "foo", "\"", ").", "build", "(", ")", "}", ",", "booleans", ".", "get", "(", "2", ")", "?", "new", "RoleDescriptor", ".", "ApplicationResourcePrivileges", "[", "0", "]", ":", "new", "RoleDescriptor", ".", "ApplicationResourcePrivileges", "[", "]", "{", "RoleDescriptor", ".", "ApplicationResourcePrivileges", ".", "builder", "(", ")", ".", "application", "(", "\"", "app", "\"", ").", "privileges", "(", "\"", "foo", "\"", ").", "resources", "(", "\"", "res", "\"", ").", "build", "(", ")", "}", ",", "booleans", ".", "get", "(", "3", ")", "?", "new", "ConfigurableClusterPrivilege", "[", "0", "]", ":", "new", "ConfigurableClusterPrivilege", "[", "]", "{", "new", "ConfigurableClusterPrivileges", ".", "ManageApplicationPrivileges", "(", "Collections", ".", "singleton", "(", "\"", "foo", "\"", "))", "}", ",", "booleans", ".", "get", "(", "4", ")", "?", "new", "String", "[", "0", "]", ":", "new", "String", "[", "]", "{", "\"", "foo", "\"", "}", ",", "booleans", ".", "get", "(", "5", ")", "?", "new", "HashMap", "<", ">(", ")", ":", "Collections", ".", "singletonMap", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", "),", "Collections", ".", "singletonMap", "(", "\"", "foo", "\"", ",", "\"", "bar", "\"", "))", ";", "if", "(", "booleans", ".", "stream", "(", ").", "anyMatch", "(", "e", "-", ">", "e", ".", "equals", "(", "false", ")", "))", "{", "assertFalse", "(", "roleDescriptor", ".", "isEmpty", "(", "))", ";", "}", "else", "{", "assertTrue", "(", "roleDescriptor", ".", "isEmpty", "(", "))", ";", "}", "}", "}"], "docstring_tokens": ["escalate", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "45", ",", "17", "+", "45", ",", "27", "@", "@", "MODULE_AUTHOR", "(", "\"", "Mellanox", "Technologies", "\"", ");", "MODULE_DESCRIPTION", "(", "\"", "Transport", "Layer", "Security", "Support", "\"", ");", "MODULE_LICENSE", "(", "\"", "Dual", "BSD", "/", "GPL", "\"", ");", "enum", "{", "TLSV4", ",", "TLSV6", ",", "TLS_NUM_PROTS", ",", "}", ";", "enum", "{", "TLS_BASE_TX", ",", "TLS_SW_TX", ",", "TLS_NUM_CONFIG", ",", "}", ";", "static", "struct", "proto", "tls_prots", "[", "TLS_NUM_CONFIG", "]", ";", "static", "struct", "proto", "*", "saved_tcpv6_prot", ";", "static", "DEFINE_MUTEX", "(", "tcpv6_prot_mutex", ")", ";", "static", "struct", "proto", "tls_prots", "[", "TLS_NUM_PROTS", "]", "[", "TLS_NUM_CONFIG", "]", ";", "static", "inline", "void", "update_sk_prot", "(", "struct", "sock", "*", "sk", ",", "struct", "tls_context", "*", "ctx", ")", "{", "sk", "-", ">", "sk_prot", "=", "&", "tls_prots", "[", "ctx", "-", ">", "tx_conf", "]", ";", "int", "ip_ver", "=", "sk", "-", ">", "sk_family", "=", "=", "AF_INET6", "?", "TLSV6", ":", "TLSV4", ";", "sk", "-", ">", "sk_prot", "=", "&", "tls_prots", "[", "ip_ver", "]", "[", "ctx", "-", ">", "tx_conf", "]", ";", "}", "int", "wait_on_pending_writer", "(", "struct", "sock", "*", "sk", ",", "long", "*", "timeo", ")", "@", "@", "-", "453", ",", "8", "+", "463", ",", "21", "@", "@", "static", "int", "tls_setsockopt", "(", "struct", "sock", "*", "sk", ",", "int", "level", ",", "int", "optname", ",", "return", "do_tls_setsockopt", "(", "sk", ",", "optname", ",", "optval", ",", "optlen", ")", ";", "}", "static", "void", "build_protos", "(", "struct", "proto", "*", "prot", ",", "struct", "proto", "*", "base", ")", "{", "prot", "[", "TLS_BASE_TX", "]", "=", "*", "base", ";", "prot", "[", "TLS_BASE_TX", "]", ".", "setsockopt", "=", "tls_setsockopt", ";", "prot", "[", "TLS_BASE_TX", "]", ".", "getsockopt", "=", "tls_getsockopt", ";", "prot", "[", "TLS_BASE_TX", "]", ".", "close", "=", "tls_sk_proto_close", ";", "prot", "[", "TLS_SW_TX", "]", "=", "prot", "[", "TLS_BASE_TX", "]", ";", "prot", "[", "TLS_SW_TX", "]", ".", "sendmsg", "=", "tls_sw_sendmsg", ";", "prot", "[", "TLS_SW_TX", "]", ".", "sendpage", "=", "tls_sw_sendpage", ";", "}", "static", "int", "tls_init", "(", "struct", "sock", "*", "sk", ")", "{", "int", "ip_ver", "=", "sk", "-", ">", "sk_family", "=", "=", "AF_INET6", "?", "TLSV6", ":", "TLSV4", ";", "struct", "inet_connection_sock", "*", "icsk", "=", "inet_csk", "(", "sk", ")", ";", "struct", "tls_context", "*", "ctx", ";", "int", "rc", "=", "0", ";", "@", "@", "-", "479", ",", "6", "+", "502", ",", "17", "@", "@", "static", "int", "tls_init", "(", "struct", "sock", "*", "sk", ")", "ctx", "-", ">", "getsockopt", "=", "sk", "-", ">", "sk_prot", "-", ">", "getsockopt", ";", "ctx", "-", ">", "sk_proto_close", "=", "sk", "-", ">", "sk_prot", "-", ">", "close", ";", "/", "*", "Build", "IPv6", "TLS", "whenever", "the", "address", "of", "tcpv6_prot", "changes", "*", "/", "if", "(", "ip_ver", "=", "=", "TLSV6", "&", "&", "unlikely", "(", "sk", "-", ">", "sk_prot", "!", "=", "smp_load_acquire", "(", "&", "saved_tcpv6_prot", ")", "))", "{", "mutex_lock", "(", "&", "tcpv6_prot_mutex", ")", ";", "if", "(", "likely", "(", "sk", "-", ">", "sk_prot", "!", "=", "saved_tcpv6_prot", ")", ")", "{", "build_protos", "(", "tls_prots", "[", "TLSV6", "]", ",", "sk", "-", ">", "sk_prot", ")", ";", "smp_store_release", "(", "&", "saved_tcpv6_prot", ",", "sk", "-", ">", "sk_prot", ")", ";", "}", "mutex_unlock", "(", "&", "tcpv6_prot_mutex", ")", ";", "}", "ctx", "-", ">", "tx_conf", "=", "TLS_BASE_TX", ";", "update_sk_prot", "(", "sk", ",", "ctx", ")", ";", "out", ":", "@", "@", "-", "493", ",", "21", "+", "527", ",", "9", "@", "@", "static", "struct", "tcp_ulp_ops", "tcp_tls_ulp_ops", "__read_mostly", "=", "{", ".", "init", "=", "tls_init", ",", "}", ";", "static", "void", "build_protos", "(", "struct", "proto", "*", "prot", ",", "struct", "proto", "*", "base", ")", "{", "prot", "[", "TLS_BASE_TX", "]", "=", "*", "base", ";", "prot", "[", "TLS_BASE_TX", "]", ".", "setsockopt", "=", "tls_setsockopt", ";", "prot", "[", "TLS_BASE_TX", "]", ".", "getsockopt", "=", "tls_getsockopt", ";", "prot", "[", "TLS_BASE_TX", "]", ".", "close", "=", "tls_sk_proto_close", ";", "prot", "[", "TLS_SW_TX", "]", "=", "prot", "[", "TLS_BASE_TX", "]", ";", "prot", "[", "TLS_SW_TX", "]", ".", "sendmsg", "=", "tls_sw_sendmsg", ";", "prot", "[", "TLS_SW_TX", "]", ".", "sendpage", "=", "tls_sw_sendpage", ";", "}", "static", "int", "__init", "tls_register", "(", "void", ")", "{", "build_protos", "(", "tls_prots", ",", "&", "tcp_prot", ")", ";", "build_protos", "(", "tls_prots", "[", "TLSV4", "]", ",", "&", "tcp_prot", ")", ";", "tcp_register_ulp", "(", "&", "tcp_tls_ulp_ops", ")", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(slab", "out-of-bounds", "write", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "758", ",", "6", "+", "758", ",", "13", "@", "@", "sctp_disposition_t", "sctp_sf_do_5_1D_ce", "(", "struct", "net", "*", "net", ",", "struct", "sctp_chunk", "auth", ";", "sctp_ierror_t", "ret", ";", "/", "*", "Make", "sure", "that", "we", "and", "the", "peer", "are", "AUTH", "capable", "*", "/", "if", "(", "!", "net", "-", ">", "sctp", ".", "auth_enable", "|", "|", "!", "new_asoc", "-", ">", "peer", ".", "auth_capable", ")", "{", "kfree_skb", "(", "chunk", "-", ">", "auth_chunk", ")", ";", "sctp_association_free", "(", "new_asoc", ")", ";", "return", "sctp_sf_pdiscard", "(", "net", ",", "ep", ",", "asoc", ",", "type", ",", "arg", ",", "commands", ")", ";", "}", "/", "*", "set", "-", "up", "our", "fake", "chunk", "so", "that", "we", "can", "process", "it", "*", "/", "auth", ".", "skb", "=", "chunk", "-", ">", "auth_chunk", ";", "auth", ".", "asoc", "=", "chunk", "-", ">", "asoc", ";"], "docstring_tokens": ["the", "system", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "81", ",", "7", "+", "81", ",", "7", "@", "@", "protected", "void", "throwable", "(", "BodyWriter", "w", ",", "Throwable", "throwable", ",", "boolean", "isCause", ")", "{", "w", ".", "escape", "(", "\"", "Caused", "by", ":", "\"", ");", "}", "w", ".", "println", "(", "throwable", ".", "toString", "(", "))", ";", "w", ".", "escapeln", "(", "throwable", ".", "toString", "(", "))", ";", "for", "(", "StackTraceElement", "ste", ":", "throwable", ".", "getStackTrace", "(", "))", "{", "String", "className", "=", "ste", ".", "getClassName", "(", ");", "if", "(", "className", ".", "startsWith", "(", "\"", "ratpack", "\"", ")", "@", "@", "-", "120", ",", "6", "+", "120", ",", "10", "@", "@", "BodyWriter", "println", "(", "String", "string", ")", "{", "BodyWriter", "escape", "(", "String", "string", ")", "{", "return", "print", "(", "HTML_ESCAPER", ".", "escape", "(", "string", ")", ");", "}", "BodyWriter", "escapeln", "(", "String", "string", ")", "{", "return", "println", "(", "HTML_ESCAPER", ".", "escape", "(", "string", ")", ");", "}", "}", "protected", "void", "messages", "(", "BodyWriter", "writer", ",", "String", "heading", ",", "Runnable", "block", ")", "{", "@", "@", "-", "16", ",", "10", "+", "16", ",", "14", "@", "@", "package", "ratpack", ".", "error", "import", "com", ".", "google", ".", "common", ".", "escape", ".", "Escaper", "import", "com", ".", "google", ".", "common", ".", "html", ".", "HtmlEscapers", "import", "ratpack", ".", "test", ".", "internal", ".", "RatpackGroovyDslSpec", "class", "DevelopmentErrorHandlerSpec", "extends", "RatpackGroovyDslSpec", "{", "private", "static", "final", "Escaper", "HTML_ESCAPER", "=", "HtmlEscapers", ".", "htmlEscaper", "(", ")", "def", "\"", "debug", "error", "handler", "prints", "html", "info", "if", "client", "wants", "html", "\"", "()", "{", "given", ":", "def", "e", "=", "new", "RuntimeException", "(", "\"!", "\")", "@", "@", "-", "96", ",", "4", "+", "100", ",", "26", "@", "@", "class", "DevelopmentErrorHandlerSpec", "extends", "RatpackGroovyDslSpec", "{", "body", ".", "contentType", ".", "text", "}", "}", "def", "\"", "debug", "error", "handler", "properly", "escapes", "HTML", "characters", "\"", "()", "{", "given", ":", "def", "payload", "=", "\"", "<", "script", ">", "alert", "(", "1", ")", ";<", "/", "script", ">", "\"", "def", "e", "=", "new", "RuntimeException", "(", "payload", ")", "requestSpec", "{", "it", ".", "headers", ".", "add", "(", "\"", "Accept", "\"", ",", "\"", "text", "/", "html", ";", "q", "=", "1", ",", "text", "/", "plain", ";", "q", "=", "0", ".", "9", "\"", ")", "}", "when", ":", "serverConfig", "{", "development", "(", "true", ")", "}", "handlers", "{", "get", "(", "\"", "server", "\"", ")", "{", "error", "(", "e", ")", "}", "}", "then", ":", "with", "(", "get", "(", "\"", "server", "\"", "))", "{", "statusCode", "=", "=", "500", "body", ".", "text", ".", "startsWith", "(", "\"<", "!", "DOCTYPE", "html", ">", "\")", "!", "body", ".", "text", ".", "contains", "(", "payload", ")", "body", ".", "text", ".", "contains", "(", "HTML_ESCAPER", ".", "escape", "(", "payload", ")", ")", "body", ".", "contentType", ".", "html", "}", "}", "}"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "3", ",", "6", "+", "3", ",", "8", "@", "@", "Version", "8", ".", "0", ".", "13", "-", "WL", "#", "12245", ",", "DevAPI", ":", "Implement", "connect", "timeout", ".", "-", "Fix", "for", "Bug", "#", "21774249", ",", "UNIT", "TEST", "FAILS", "WITH", "ERROR", "\"", "'", "CEST", "'", "IS", "UNRECOGNIZED", "TIME", "ZONE", "\"", ".", "-", "WL", "#", "11857", ",", "DevAPI", ":", "Implement", "connection", "pooling", "for", "xprotocol", ".", "@", "@", "-", "174", ",", "6", "+", "174", ",", "7", "@", "@", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "mysqlx", ".", "url", "-", "connection", "string", "to", "the", "test", "server", "with", "xp", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "mysqlx", ".", "url", ".", "openssl", "-", "connection", "string", "to", "the", "test", "server", "compiled", "with", "OpenSSL", "and", "enabled", "xplugin", ",", "default", "_unset_", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "test", ".", "class", "-", "testcase", "class", "name", "to", "run", ",", "default", "_unset_", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "test", ".", "methods", "-", "a", "comma", "separated", "list", "of", "test", "names", "existing", "in", "class", "defined", "by", "'", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "test", ".", "class", "'", ",", "default", "_unset_", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "unavailable", ".", "host", "-", "a", "host", ":", "port", "pair", "used", "for", "tests", "checking", "socket", "connection", "timeout", "See", "also", "com", ".", "mysql", ".", "cj", ".", "conf", ".", "PropertyDefinitions", ".", "SYSP_", "*", "variables", "for", "other", "test", "options", ".", "@", "@", "-", "67", ",", "6", "+", "67", ",", "8", "@", "@", "public", "static", "final", "String", "SYSP_testsuite_cantGrant", "/", "*", "*", "/", "=", "\"", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "cantGrant", "\"", ";", "public", "static", "final", "String", "SYSP_testsuite_disable_multihost_tests", "/", "*", "*", "/", "=", "\"", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "disable", ".", "multihost", ".", "tests", "\"", ";", "/", "/", "TODO", "should", "be", "more", "specific", "for", "different", "types", "of", "multi", "-", "host", "configs", "public", "static", "final", "String", "SYSP_testsuite_unavailable_host", "/", "*", "*", "/", "=", "\"", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "unavailable", ".", "host", "\"", ";", "/", "**", "For", "testsuite", ".", "regression", ".", "DataSourceRegressionTest", "*", "/", "public", "static", "final", "String", "SYSP_testsuite_ds_host", "/", "*", "*", "/", "=", "\"", "com", ".", "mysql", ".", "cj", ".", "testsuite", ".", "ds", ".", "host", "\"", ";", "/", "**", "For", "testsuite", ".", "regression", ".", "DataSourceRegressionTest", "*", "/", "@", "@", "-", "713", ",", "6", "+", "715", ",", "8", "@", "@", "Messages", ".", "getString", "(", "\"", "ConnectionProperties", ".", "asyncResponseTimeout", "\"", "),", "\"", "8", ".", "0", ".", "7", "\"", ",", "CATEGORY_XDEVAPI", ",", "Integer", ".", "MIN_VALUE", ")", ",", "new", "EnumPropertyDefinition", "<", ">(", "PropertyKey", ".", "xdevapiAuth", ",", "AuthMech", ".", "PLAIN", ",", "RUNTIME_NOT_MODIFIABLE", ",", "Messages", ".", "getString", "(", "\"", "ConnectionProperties", ".", "auth", "\"", "),", "\"", "8", ".", "0", ".", "8", "\"", ",", "CATEGORY_XDEVAPI", ",", "Integer", ".", "MIN_VALUE", ")", ",", "new", "IntegerPropertyDefinition", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "10000", ",", "RUNTIME_MODIFIABLE", ",", "Messages", ".", "getString", "(", "\"", "ConnectionProperties", ".", "xdevapiConnectTimeout", "\"", "),", "\"", "8", ".", "0", ".", "13", "\"", ",", "CATEGORY_XDEVAPI", ",", "Integer", ".", "MIN_VALUE", ",", "0", ",", "Integer", ".", "MAX_VALUE", ")", ",", "new", "BooleanPropertyDefinition", "(", "PropertyKey", ".", "enableEscapeProcessing", ",", "DEFAULT_VALUE_TRUE", ",", "RUNTIME_MODIFIABLE", ",", "Messages", ".", "getString", "(", "\"", "ConnectionProperties", ".", "enableEscapeProcessing", "\"", "),", "\"", "6", ".", "0", ".", "1", "\"", ",", "CATEGORY_PERFORMANCE", ",", "Integer", ".", "MIN_VALUE", ")", ",", "@", "@", "-", "235", ",", "6", "+", "235", ",", "7", "@", "@", "xdevapiAsyncResponseTimeout", "(", "\"", "xdevapi", ".", "asyncResponseTimeout", "\"", ",", "\"", "xdevapiAsyncResponseTimeout", "\"", ",", "true", ")", ",", "/", "/", "xdevapiAuth", "(", "\"", "xdevapi", ".", "auth", "\"", ",", "\"", "xdevapiAuth", "\"", ",", "true", ")", ",", "/", "/", "xdevapiConnectTimeout", "(", "\"", "xdevapi", ".", "connect", "-", "timeout", "\"", ",", "\"", "xdevapiConnectTimeout", "\"", ",", "true", ")", ",", "/", "/", "xdevapiSSLMode", "(", "\"", "xdevapi", ".", "ssl", "-", "mode", "\"", ",", "\"", "xdevapiSSLMode", "\"", ",", "true", ")", ",", "/", "/", "xdevapiSSLTrustStoreUrl", "(", "\"", "xdevapi", ".", "ssl", "-", "truststore", "\"", ",", "\"", "xdevapiSSLTruststore", "\"", ",", "true", ")", ",", "/", "/", "xdevapiSSLTrustStoreType", "(", "\"", "xdevapi", ".", "ssl", "-", "truststore", "-", "type", "\"", ",", "\"", "xdevapiSSLTruststoreType", "\"", ",", "true", ")", ",", "/", "/", "@", "@", "-", "113", ",", "6", "+", "113", ",", "14", "@", "@", "public", "XProtocol", "(", "String", "host", ",", "int", "port", ",", "String", "defaultSchema", ",", "PropertySet", "propertySet", ")", "{", "this", ".", "defaultSchemaName", "=", "defaultSchema", ";", "/", "/", "Override", "common", "connectTimeout", "with", "xdevapi", ".", "connect", "-", "timeout", "to", "provide", "unified", "logic", "in", "StandardSocketFactory", "RuntimeProperty", "<", "Integer", ">", "connectTimeout", "=", "propertySet", ".", "getIntegerProperty", "(", "PropertyKey", ".", "connectTimeout", ")", ";", "RuntimeProperty", "<", "Integer", ">", "xdevapiConnectTimeout", "=", "propertySet", ".", "getIntegerProperty", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ")", ";", "if", "(", "xdevapiConnectTimeout", ".", "isExplicitlySet", "(", ")", "|", "|", "!", "connectTimeout", ".", "isExplicitlySet", "(", "))", "{", "connectTimeout", ".", "setValue", "(", "xdevapiConnectTimeout", ".", "getValue", "(", "))", ";", "}", "SocketConnection", "socketConn", "=", "propertySet", ".", "getBooleanProperty", "(", "PropertyKey", ".", "xdevapiUseAsyncProtocol", ")", ".", "getValue", "(", ")", "?", "new", "XAsyncSocketConnection", "(", ")", ":", "new", "NativeSocketConnection", "(", ");", "socketConn", ".", "connect", "(", "host", ",", "port", ",", "propertySet", ",", "null", ",", "null", ",", "0", ")", ";", "@", "@", "-", "129", ",", "6", "+", "137", ",", "14", "@", "@", "public", "XProtocol", "(", "HostInfo", "hostInfo", ",", "PropertySet", "propertySet", ")", "{", "port", "=", "33060", ";", "}", "this", ".", "defaultSchemaName", "=", "hostInfo", ".", "getDatabase", "(", ");", "/", "/", "Override", "common", "connectTimeout", "with", "xdevapi", ".", "connect", "-", "timeout", "to", "provide", "unified", "logic", "in", "StandardSocketFactory", "RuntimeProperty", "<", "Integer", ">", "connectTimeout", "=", "propertySet", ".", "getIntegerProperty", "(", "PropertyKey", ".", "connectTimeout", ")", ";", "RuntimeProperty", "<", "Integer", ">", "xdevapiConnectTimeout", "=", "propertySet", ".", "getIntegerProperty", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ")", ";", "if", "(", "xdevapiConnectTimeout", ".", "isExplicitlySet", "(", ")", "|", "|", "!", "connectTimeout", ".", "isExplicitlySet", "(", "))", "{", "connectTimeout", ".", "setValue", "(", "xdevapiConnectTimeout", ".", "getValue", "(", "))", ";", "}", "SocketConnection", "socketConn", "=", "propertySet", ".", "getBooleanProperty", "(", "PropertyKey", ".", "xdevapiUseAsyncProtocol", ")", ".", "getValue", "(", ")", "?", "new", "XAsyncSocketConnection", "(", ")", ":", "new", "NativeSocketConnection", "(", ");", "socketConn", ".", "connect", "(", "host", ",", "port", ",", "propertySet", ",", "null", ",", "null", ",", "0", ")", ";", "@", "@", "-", "908", ",", "6", "+", "908", ",", "8", "@", "@", "ConnectionProperties", ".", "sslTrustStorePassword", "=", "X", "DevAPI", "-", "specific", "password", "for", "the", "tr", "ConnectionProperties", ".", "asyncResponseTimeout", "=", "Timeout", "(", "in", "seconds", ")", "for", "getting", "server", "response", "via", "X", "Protocol", ".", "ConnectionProperties", ".", "auth", "=", "Authentication", "mechanism", "to", "use", "with", "the", "X", "Protocol", ".", "Allowed", "values", "are", "\"", "SHA256_MEMORY", "\"", ",", "\"", "MYSQL41", "\"", ",", "\"", "PLAIN", "\"", ",", "and", "\"", "EXTERNAL", "\"", ".", "Value", "is", "case", "insensitive", ".", "If", "the", "property", "is", "not", "set", ",", "the", "mechanism", "is", "chosen", "depending", "on", "the", "connection", "type", ":", "\"", "PLAIN", "\"", "is", "used", "for", "TLS", "connections", "and", "\"", "SHA256_MEMORY", "\"", "or", "\"", "MYSQL41", "\"", "is", "used", "for", "unencrypted", "connections", ".", "ConnectionProperties", ".", "xdevapiConnectTimeout", "=", "X", "DevAPI", "specific", "timeout", "for", "socket", "connect", "(", "in", "milliseconds", ")", ",", "with", "'", "0", "'", "being", "no", "timeout", ".", "Defaults", "to", "'", "10000", "'", ".", "ConnectionProperties", ".", "unknown", "=", "Property", "is", "not", "defined", "in", "Connector", "/", "J", "but", "used", "in", "connection", "URL", ".", "PropertyDefinition", ".", "1", "=", "The", "connection", "property", "'", "'{", "0", "}", "''", "acceptable", "values", "are", ":", "{", "1", "}", ".", "The", "value", "'", "'{", "2", "}", "''", "is", "not", "acceptable", ".", "@", "@", "-", "108", ",", "6", "+", "108", ",", "10", "@", "@", "protected", "String", "makeParam", "(", "PropertyKey", "key", ",", "Enum", "<", "?>", "value", ")", "{", "}", "protected", "String", "makeParam", "(", "PropertyKey", "key", ",", "String", "value", ")", "{", "return", "\"", "&\"", "+", "key", ".", "getKeyName", "(", ")", "+", "\"", "=\"", "+", "value", ";", "return", "makeParam", "(", "key", ",", "value", ",", "false", ")", ";", "}", "protected", "String", "makeParam", "(", "PropertyKey", "key", ",", "String", "value", ",", "boolean", "isFirst", ")", "{", "return", "(", "isFirst", "?", "\"", "\"", ":", "\"", "&\"", ")", "+", "key", ".", "getKeyName", "(", ")", "+", "\"", "=\"", "+", "value", ";", "}", "}", "@", "@", "-", "30", ",", "6", "+", "30", ",", "7", "@", "@", "package", "testsuite", ".", "x", ".", "devapi", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "@", "@", "-", "43", ",", "15", "+", "44", ",", "17", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "com", ".", "mysql", ".", "cj", ".", "conf", ".", "ConnectionUrl", ";", "import", "com", ".", "mysql", ".", "cj", ".", "conf", ".", "PropertyDefinitions", ";", "import", "com", ".", "mysql", ".", "cj", ".", "conf", ".", "PropertyKey", ";", "import", "com", ".", "mysql", ".", "cj", ".", "exceptions", ".", "CJCommunicationsException", ";", "import", "com", ".", "mysql", ".", "cj", ".", "exceptions", ".", "WrongArgumentException", ";", "import", "com", ".", "mysql", ".", "cj", ".", "protocol", ".", "x", ".", "XProtocolError", ";", "import", "com", ".", "mysql", ".", "cj", ".", "xdevapi", ".", "Session", ";", "import", "testsuite", ".", "x", ".", "internal", ".", "InternalXBaseTestCase", ";", "/", "**", "*", "Tests", "for", "Session", "client", "side", "failover", "features", ".", "*", "/", "public", "class", "SessionFailoverTest", "extends", "InternalXBaseTestCase", "{", "public", "class", "SessionFailoverTest", "extends", "DevApiBaseTestCase", "{", "private", "String", "testsHost", "=", "\"", "\";", "/", "**", "@", "@", "-", "74", ",", "6", "+", "77", ",", "19", "@", "@", "private", "String", "buildConnectionString", "(", "String", ".", "..", "hosts", ")", "{", "return", "url", ".", "toString", "(", ");", "}", "private", "String", "buildConnectionStringNoUser", "(", "String", ".", "..", "hosts", ")", "{", "StringBuilder", "url", "=", "new", "StringBuilder", "(", "ConnectionUrl", ".", "Type", ".", "XDEVAPI_SESSION", ".", "getScheme", "(", "))", ".", "append", "(", "\"/", "/\"", ");", "url", ".", "append", "(", "\"[", "\")", ";", "String", "separator", "=", "\"", "\";", "int", "priority", "=", "100", ";", "for", "(", "String", "h", ":", "hosts", ")", "{", "url", ".", "append", "(", "separator", ")", ".", "append", "(", "\"(", "address", "=", "\")", ".", "append", "(", "h", ")", ".", "append", "(", "\",", "priority", "=", "\")", ".", "append", "(", "priority", "-", "-)", ".", "append", "(", "\")", "\")", ";", "separator", "=", "\"", ",\"", ";", "}", "url", ".", "append", "(", "\"]", "\")", ".", "append", "(", "\"/", "\")", ".", "append", "(", "getTestDatabase", "(", "))", ";", "return", "url", ".", "toString", "(", ");", "}", "@", "Before", "public", "void", "setupFailoverTest", "(", ")", "{", "if", "(", "this", ".", "isSetForXTests", ")", "{", "@", "@", "-", "185", ",", "4", "+", "201", ",", "114", "@", "@", "public", "Void", "call", "(", ")", "{", "return", "null", ";", "}", "}", "/", "**", "*", "Tests", "xdevapi", ".", "connect", "-", "timeout", "and", "connectTimeout", "functionality", ".", "*", "*", "The", "real", "socket", "connect", "timeout", "can", "be", "revealed", "only", "when", "trying", "to", "connect", "to", "the", "unavailable", "remote", "host", "*", "pointed", "by", "IP", "address", ".", "Neither", "localhost", "IP", "nor", "domain", "names", "are", "working", ",", "they", "fail", "much", "faster", "then", "the", "timeout", "*", "is", "reached", ".", "*", "If", "default", "10", ".", "77", ".", "77", ".", "77", ":", "37070", "doesn", "'", "t", "work", "in", "a", "particular", "testing", "setup", "(", "if", "the", "ip", "address", "is", "available", ")", "*", "please", "add", "this", "variable", "to", "ant", "call", ":", "*", "-", "Dcom", ".", "mysql", ".", "cj", ".", "testsuite", ".", "unavailable", ".", "host", "=", "unavailable_ip", ":", "port", "*", "/", "@", "Test", "public", "void", "testConnectionTimeout", "(", ")", "throws", "Exception", "{", "if", "(", "!", "this", ".", "isSetForXTests", ")", "{", "return", ";", "}", "String", "customFakeHost", "=", "System", ".", "getProperty", "(", "PropertyDefinitions", ".", "SYSP_testsuite_unavailable_host", ")", ";", "String", "fakeHost", "=", "(", "customFakeHost", "!", "=", "null", "&", "&", "customFakeHost", ".", "trim", "(", ").", "length", "(", ")", "!", "=", "0", ")", "?", "customFakeHost", ":", "\"", "10", ".", "77", ".", "77", ".", "77", ":", "37070", "\"", ";", "/", "/", "TS1_1", "Create", "a", "session", "to", "a", "Server", "using", "explicit", "\"", "xdevapi", ".", "connect", "-", "timeout", "\"", "overriding", "implicit", "\"", "connectTimeout", "\"", ".", "testConnectionTimeout_assertFailureTimeout", "(", "buildConnectionString", "(", "fakeHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "500", "\"", ",", "true", ")", ",", "500", ",", "1500", ")", ";", "/", "/", "TS1_2", "Create", "a", "session", "to", "a", "Server", "using", "explicit", "\"", "xdevapi", ".", "connect", "-", "timeout", "\"", "overriding", "explicit", "\"", "connectTimeout", "\"", ".", "testConnectionTimeout_assertFailureTimeout", "(", "buildConnectionString", "(", "fakeHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "500", "\"", ",", "true", ")", "+", "makeParam", "(", "PropertyKey", ".", "connectTimeout", ",", "\"", "8000", "\"", "),", "500", ",", "1500", ")", ";", "/", "/", "TS1_3", "Create", "a", "session", "to", "a", "Server", "using", "explicit", "\"", "connectTimeout", "\"", "overriding", "implicit", "\"", "xdevapi", ".", "connect", "-", "timeout", "\"", ".", "testConnectionTimeout_assertFailureTimeout", "(", "buildConnectionString", "(", "fakeHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "connectTimeout", ",", "\"", "800", "\"", ",", "true", ")", ",", "800", ",", "1800", ")", ";", "/", "/", "TS3_1", "Create", "a", "session", "to", "a", "remote", "offline", "host", "not", "setting", "the", "\"", "connect", "-", "timeout", "\"", "parameter", ".", "The", "connection", "must", "timeout", "in", "~", "10", "seconds", ".", "/", "/", "Default", "\"", "connect", "-", "timeout", "\"", "(", "10000", "ms", ")", "overrides", "implicit", "\"", "connectTimeout", "\"", ".", "testConnectionTimeout_assertFailureTimeout", "(", "buildConnectionString", "(", "fakeHost", ")", ",", "10000", ",", "11000", ")", ";", "/", "/", "TS4_1", "Create", "a", "session", "to", "a", "remote", "offline", "host", "setting", "\"", "connect", "-", "timeout", "\"", "to", "zero", "(", "0", ")", ".", "The", "connection", "must", "not", "timeout", "until", "cancelled", ".", "testConnectionTimeout_assertFailureTimeout", "(", "buildConnectionString", "(", "fakeHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "0", "\"", ",", "true", ")", ",", "120000", ",", "600000", ")", ";", "/", "/", "TS6_1", "Create", "a", "session", "using", "the", "fail", "over", "functionality", "passing", "two", "different", "Server", "address", ".", "/", "/", "The", "Server", "with", "the", "higher", "priority", "must", "be", "offline", ".", "The", "connection", "must", "succeed", "after", "connect", "-", "timeout", "milliseconds", ".", "testConnectionTimeout_assertSuccessTimeout", "(", "buildConnectionString", "(", "fakeHost", ",", "this", ".", "testsHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "1000", "\"", ",", "true", ")", ",", "1000", ",", "2000", ")", ";", "/", "/", "TS6_2", "Create", "a", "session", "using", "the", "fail", "over", "functionality", "passing", "two", "different", "Server", "address", ".", "/", "/", "Both", "Servers", "must", "be", "offline", ".", "The", "connection", "must", "time", "out", "after", "connect", "-", "timeout", "*", "2", "milliseconds", ".", "testConnectionTimeout_assertFailureTimeout", "(", "buildConnectionString", "(", "fakeHost", ",", "fakeHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "500", "\"", ",", "true", ")", ",", "1000", ",", "2000", ")", ";", "/", "/", "TS8_1", "Create", "a", "session", "to", "a", "Server", "using", "valid", "credentials", "passing", "the", "\"", "connect", "-", "timeout", "\"", "and", "set", "it", "to", "a", "valid", "value", ".", "/", "/", "Call", "the", "function", "SLEEP", "(", ")", "and", "set", "it", "to", "10", "seconds", "once", "the", "connections", "is", "established", ".", "No", "timeout", "exception", "/", "error", "must", "be", "displayed", ".", "long", "begin", "=", "System", ".", "currentTimeMillis", "(", ");", "Session", "sess", "=", "this", ".", "fact", ".", "getSession", "(", "buildConnectionString", "(", "this", ".", "testsHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "3000", "\"", ",", "true", ")", ");", "sess", ".", "sql", "(", "\"", "SELECT", "SLEEP", "(", "11", ")", "\")", ".", "execute", "(", ");", "long", "end", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "begin", ";", "assertTrue", "(", "\"", "Expected", ":", "\"", "+", "11000", "+", "\"", "..", "\"", "+", "12000", "+", "\"", ".", "Got", "\"", "+", "end", ",", "end", ">", "=", "11000", "&", "&", "end", "<", "12000", ")", ";", "/", "/", "TS11_1", "Set", "connection", "property", "xdevapi", ".", "connect", "-", "timeout", "=", "null", ",", "try", "to", "create", "Session", ",", "check", "that", "WrongArgumentException", "is", "thrown", "/", "/", "with", "message", "\"", "The", "connection", "property", "'", "xdevapi", ".", "connect", "-", "timeout", "'", "only", "accepts", "integer", "values", ".", "The", "value", "'", "null", "'", "can", "not", "be", "converted", "to", "an", "integer", ".", "\"", "assertThrows", "(", "WrongArgumentException", ".", "class", ",", "\"", "The", "connection", "property", "'", "xdevapi", ".", "connect", "-", "timeout", "'", "only", "accepts", "integer", "values", ".", "The", "value", "'", "null", "'", "can", "not", "be", "converted", "to", "an", "integer", ".", "\",", "(", ")", "-", ">", "this", ".", "fact", ".", "getSession", "(", "buildConnectionString", "(", "fakeHost", ",", "this", ".", "testsHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "null", "\"", ",", "true", ")", "))", ";", "/", "/", "TS11_2", "Set", "connection", "property", "xdevapi", ".", "connect", "-", "timeout", "=", "-", "1", ",", "try", "to", "create", "Session", ",", "check", "that", "WrongArgumentException", "is", "thrown", "with", "/", "/", "message", "\"", "The", "connection", "property", "'", "xdevapi", ".", "connect", "-", "timeout", "'", "only", "accepts", "integer", "values", "in", "the", "range", "of", "0", "-", "2147483647", ",", "the", "value", "'", "-", "1", "'", "exceeds", "this", "range", ".", "\"", "assertThrows", "(", "WrongArgumentException", ".", "class", ",", "\"", "The", "connection", "property", "'", "xdevapi", ".", "connect", "-", "timeout", "'", "only", "accepts", "integer", "values", "in", "the", "range", "of", "0", "-", "2147483647", ",", "the", "value", "'", "-", "1", "'", "exceeds", "this", "range", ".", "\",", "(", ")", "-", ">", "this", ".", "fact", ".", "getSession", "(", "buildConnectionString", "(", "fakeHost", ",", "this", ".", "testsHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "-", "1", "\"", ",", "true", ")", "))", ";", "/", "/", "TS11_3", "Set", "connection", "property", "xdevapi", ".", "connect", "-", "timeout", "=", "abc", ",", "try", "to", "create", "Session", ",", "check", "that", "WrongArgumentException", "is", "thrown", "with", "/", "/", "message", "\"", "The", "connection", "property", "'", "xdevapi", ".", "connect", "-", "timeout", "'", "only", "accepts", "integer", "values", ".", "The", "value", "'", "abc", "'", "can", "not", "be", "converted", "to", "an", "integer", ".", "\"", "assertThrows", "(", "WrongArgumentException", ".", "class", ",", "\"", "The", "connection", "property", "'", "xdevapi", ".", "connect", "-", "timeout", "'", "only", "accepts", "integer", "values", ".", "The", "value", "'", "abc", "'", "can", "not", "be", "converted", "to", "an", "integer", ".", "\",", "(", ")", "-", ">", "this", ".", "fact", ".", "getSession", "(", "buildConnectionString", "(", "fakeHost", ",", "this", ".", "testsHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "abc", "\"", ",", "true", ")", "))", ";", "/", "/", "TS11_4", "Set", "connection", "property", "xdevapi", ".", "connect", "-", "timeout", "=", ",", "try", "to", "create", "Session", ",", "check", "that", "WrongArgumentException", "is", "thrown", "with", "/", "/", "message", "\"", "The", "connection", "property", "'", "xdevapi", ".", "connect", "-", "timeout", "'", "only", "accepts", "integer", "values", ".", "The", "value", "'", "'", "can", "not", "be", "converted", "to", "an", "integer", ".", "\"", "assertThrows", "(", "WrongArgumentException", ".", "class", ",", "\"", "The", "connection", "property", "'", "xdevapi", ".", "connect", "-", "timeout", "'", "only", "accepts", "integer", "values", ".", "The", "value", "'", "'", "can", "not", "be", "converted", "to", "an", "integer", ".", "\",", "(", ")", "-", ">", "this", ".", "fact", ".", "getSession", "(", "buildConnectionString", "(", "fakeHost", ",", "this", ".", "testsHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "\",", "true", ")", "))", ";", "/", "/", "TS11_5", "Set", "connection", "property", "xdevapi", ".", "connect", "-", "timeout", "=", "12", ".", "8", ".", "Please", "note", "that", "c", "/", "J", "truncates", "decimals", "w", "/", "o", "exception", "for", "integer", "parameters", "thus", "/", "/", "the", "error", "message", "is", "not", "thrown", "against", "the", "property", "value", ".", "Try", "to", "connect", "with", "this", "connection", "string", "and", "ensure", "that", "CJCommunicationsException", "/", "/", "is", "thrown", "not", "earlier", "than", "12", "ms", "and", "not", "later", "than", "1000", "ms", ".", "testConnectionTimeout_assertFailureTimeout", "(", "buildConnectionString", "(", "fakeHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "12", ".", "8", "\"", ",", "true", ")", ",", "12", ",", "1000", ")", ";", "/", "/", "TS12_1", "Create", "a", "session", "to", "a", "Server", "giving", "a", "valid", "value", "for", "the", "\"", "connect", "-", "timeout", "\"", ",", "and", "use", "invalid", "credentials", ".", "testConnectionTimeout_assertFailureTimeout", "(", "buildConnectionStringNoUser", "(", "this", ".", "testsHost", ")", "+", "\"", "?\"", "+", "makeParam", "(", "PropertyKey", ".", "xdevapiConnectTimeout", ",", "\"", "1000", "\"", ",", "true", ")", "+", "makeParam", "(", "PropertyKey", ".", "USER", ",", "\"", "nosuchuser", "\"", "),", "0", ",", "1000", ",", "XProtocolError", ".", "class", ")", ";", "}", "private", "<", "EX", "extends", "Throwable", ">", "void", "testConnectionTimeout_assertFailureTimeout", "(", "String", "url", ",", "int", "expLowLimit", ",", "int", "expUpLimit", ",", "Class", "<", "EX", ">", "throwable", ")", "{", "long", "begin", "=", "System", ".", "currentTimeMillis", "(", ");", "assertThrows", "(", "throwable", ",", "(", ")", "-", ">", "this", ".", "fact", ".", "getSession", "(", "url", ")", ");", "long", "end", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "begin", ";", "assertTrue", "(", "\"", "Expected", ":", "\"", "+", "expLowLimit", "+", "\"", "..", "\"", "+", "expUpLimit", "+", "\"", ".", "Got", "\"", "+", "end", ",", "end", ">", "=", "expLowLimit", "&", "&", "end", "<", "expUpLimit", ")", ";", "}", "private", "void", "testConnectionTimeout_assertFailureTimeout", "(", "String", "url", ",", "int", "expLowLimit", ",", "int", "expUpLimit", ")", "{", "testConnectionTimeout_assertFailureTimeout", "(", "url", ",", "expLowLimit", ",", "expUpLimit", ",", "CJCommunicationsException", ".", "class", ")", ";", "}", "private", "void", "testConnectionTimeout_assertSuccessTimeout", "(", "String", "url", ",", "int", "expLowLimit", ",", "int", "expUpLimit", ")", "{", "long", "begin", "=", "System", ".", "currentTimeMillis", "(", ");", "this", ".", "fact", ".", "getSession", "(", "url", ")", ";", "long", "end", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "begin", ";", "assertTrue", "(", "\"", "Expected", ":", "\"", "+", "expLowLimit", "+", "\"", "..", "\"", "+", "expUpLimit", "+", "\"", ".", "Got", "\"", "+", "end", ",", "end", ">", "=", "expLowLimit", "&", "&", "end", "<", "expUpLimit", ")", ";", "}", "}"], "docstring_tokens": ["take", "control", "of", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "228", ",", "19", "+", "228", ",", "18", "@", "@", "Jetty", "9", ".", "4", ".", "19", ".", "v20190610", "Upgrade", "Notes", "*", "Velocity", "response", "writer", "is", "no", "longer", "available", "to", "be", "used", "through", "the", "_default", "configset", ".", "In", "order", "to", "use", "it", ",", "you", "would", "need", "to", "manually", "add", "it", "to", "your", "configset", ".", "Also", ",", "the", "initialization", "parameters", "*", "Velocity", ":", "The", "initialization", "parameters", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", "and", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", "have", "been", "removed", "and", "replaced", "by", "startup", "parameters", "\"", "velocity", ".", "resourceloader", ".", "params", ".", "enabled", "\"", "and", "\"", "velocity", ".", "resourceloader", ".", "solr", ".", "enabled", "\"", "Java", "system", "properties", "\"", "velocity", ".", "resourceloader", ".", "params", ".", "enabled", "\"", "and", "\"", "velocity", ".", "resourceloader", ".", "solr", ".", "enabled", "\"", "respectively", "(", "both", "turned", "off", "by", "default", ")", ".", "Please", "see", "SOLR", "-", "13971", "for", "more", "details", ".", "Bug", "Fixes", "*", "SOLR", "-", "13963", ":", "JavaBinCodec", "has", "concurrent", "modification", "of", "CharArr", "resulting", "in", "corrupt", "internode", "updates", "(", "Colvin", "Cowie", ",", "noble", ")", "*", "SOLR", "-", "13971", ":", "Velocity", "response", "writer", "'", "s", "resource", "loading", "now", "possible", "only", "through", "startup", "parameters", ".", "Also", ",", "removed", "velocity", "response", "writer", "from", "_default", "configset", ".", "(", "Ishan", "Chattopadhyaya", ")", "*", "SOLR", "-", "13971", ":", "Velocity", "response", "writer", "'", "s", "resource", "loading", "now", "possible", "only", "through", "startup", "parameters", ".", "(", "Ishan", "Chattopadhyaya", ",", "David", "Smiley", ")", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "8", ".", "3", ".", "0", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "@", "@", "-", "108", ",", "12", "+", "108", ",", "10", "@", "@", "public", "void", "init", "(", "NamedList", "args", ")", "{", "}", "/", "/", "params", "resource", "loader", ":", "off", "by", "default", "Boolean", "prle", "=", "Boolean", ".", "getBoolean", "(", "PARAMS_RESOURCE_LOADER_ENABLED", ")", ";", "paramsResourceLoaderEnabled", "=", "(", "null", "=", "=", "prle", "?", "false", ":", "prle", ")", ";", "paramsResourceLoaderEnabled", "=", "Boolean", ".", "getBoolean", "(", "PARAMS_RESOURCE_LOADER_ENABLED", ")", ";", "/", "/", "solr", "resource", "loader", ":", "off", "by", "default", "Boolean", "srle", "=", "Boolean", ".", "getBoolean", "(", "SOLR_RESOURCE_LOADER_ENABLED", ")", ";", "solrResourceLoaderEnabled", "=", "(", "null", "=", "=", "srle", "?", "false", ":", "srle", ")", ";", "solrResourceLoaderEnabled", "=", "Boolean", ".", "getBoolean", "(", "SOLR_RESOURCE_LOADER_ENABLED", ")", ";", "initPropertiesFileName", "=", "(", "String", ")", "args", ".", "get", "(", "PROPERTIES_FILE", ")", ";", "@", "@", "-", "81", ",", "6", "+", "81", ",", "8", "@", "@", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "contrib", "/", "langid", "/", "lib", "/", "\"", "regex", "=", "\".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "dist", "/", "\"", "regex", "=", "\"", "solr", "-", "langid", "-", "\\", "d", ".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "contrib", "/", "velocity", "/", "lib", "\"", "regex", "=", "\".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "dist", "/", "\"", "regex", "=", "\"", "solr", "-", "velocity", "-", "\\", "d", ".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "dist", "/", "\"", "regex", "=", "\"", "solr", "-", "ltr", "-", "\\", "d", ".", "*\\", ".", "jar", "\"", "/", ">", "<", "!-", "-", "an", "exact", "'", "path", "'", "can", "be", "used", "instead", "of", "a", "'", "dir", "'", "to", "specify", "a", "@", "@", "-", "778", ",", "7", "+", "780", ",", "7", "@", "@", "(", "SearchHandler", ")", "can", "be", "registered", "multiple", "times", "with", "different", "names", "(", "and", "different", "init", "parameters", ")", "-", "->", "<", "requestHandler", "name", "=", "\"/", "browse", "\"", "class", "=", "\"", "solr", ".", "SearchHandler", "\"", "useParams", "=", "\"", "query", ",", "facets", ",", "browse", "\"", ">", "<", "requestHandler", "name", "=", "\"/", "browse", "\"", "class", "=", "\"", "solr", ".", "SearchHandler", "\"", "useParams", "=", "\"", "query", ",", "facets", ",", "velocity", ",", "browse", "\"", ">", "<", "lst", "name", "=", "\"", "defaults", "\"", ">", "<", "str", "name", "=", "\"", "echoParams", "\"", ">", "explicit", "<", "/", "str", ">", "<", "/", "lst", ">", "@", "@", "-", "1290", ",", "6", "+", "1292", ",", "15", "@", "@", "<", "/", "queryResponseWriter", ">", "-", "->", "<", "!-", "-", "Custom", "response", "writers", "can", "be", "declared", "as", "needed", ".", "..", "-", "->", "<", "queryResponseWriter", "name", "=", "\"", "velocity", "\"", "class", "=", "\"", "solr", ".", "VelocityResponseWriter", "\"", "startup", "=", "\"", "lazy", "\"", ">", "<", "str", "name", "=", "\"", "template", ".", "base", ".", "dir", "\"", ">$", "{", "velocity", ".", "template", ".", "base", ".", "dir", ":", "}<", "/", "str", ">", "<", "str", "name", "=", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ">$", "{", "velocity", ".", "solr", ".", "resource", ".", "loader", ".", "enabled", ":", "true", "}", "</", "str", ">", "<", "str", "name", "=", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ">$", "{", "velocity", ".", "params", ".", "resource", ".", "loader", ".", "enabled", ":", "false", "}", "</", "str", ">", "<", "/", "queryResponseWriter", ">", "<", "!-", "-", "XSLT", "response", "writer", "transforms", "the", "XML", "output", "by", "any", "xslt", "file", "found", "in", "Solr", "'", "s", "conf", "/", "xslt", "directory", ".", "Changes", "to", "xslt", "files", "are", "checked", "for", "every", "xsltCacheLifetimeSeconds", ".", "@", "@", "-", "81", ",", "6", "+", "81", ",", "8", "@", "@", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "contrib", "/", "langid", "/", "lib", "/", "\"", "regex", "=", "\".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "dist", "/", "\"", "regex", "=", "\"", "solr", "-", "langid", "-", "\\", "d", ".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "contrib", "/", "velocity", "/", "lib", "\"", "regex", "=", "\".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "dist", "/", "\"", "regex", "=", "\"", "solr", "-", "velocity", "-", "\\", "d", ".", "*\\", ".", "jar", "\"", "/", ">", "<", "lib", "dir", "=", "\"$", "{", "solr", ".", "install", ".", "dir", ":", "..", "/.", "./", "..", "/.", ".}", "/", "dist", "/", "\"", "regex", "=", "\"", "solr", "-", "ltr", "-", "\\", "d", ".", "*\\", ".", "jar", "\"", "/", ">", "<", "!-", "-", "an", "exact", "'", "path", "'", "can", "be", "used", "instead", "of", "a", "'", "dir", "'", "to", "specify", "a", "@", "@", "-", "778", ",", "7", "+", "780", ",", "7", "@", "@", "(", "SearchHandler", ")", "can", "be", "registered", "multiple", "times", "with", "different", "names", "(", "and", "different", "init", "parameters", ")", "-", "->", "<", "requestHandler", "name", "=", "\"/", "browse", "\"", "class", "=", "\"", "solr", ".", "SearchHandler", "\"", "useParams", "=", "\"", "query", ",", "facets", ",", "browse", "\"", ">", "<", "requestHandler", "name", "=", "\"/", "browse", "\"", "class", "=", "\"", "solr", ".", "SearchHandler", "\"", "useParams", "=", "\"", "query", ",", "facets", ",", "velocity", ",", "browse", "\"", ">", "<", "lst", "name", "=", "\"", "defaults", "\"", ">", "<", "str", "name", "=", "\"", "echoParams", "\"", ">", "explicit", "<", "/", "str", ">", "<", "/", "lst", ">", "@", "@", "-", "1290", ",", "6", "+", "1292", ",", "15", "@", "@", "<", "/", "queryResponseWriter", ">", "-", "->", "<", "!-", "-", "Custom", "response", "writers", "can", "be", "declared", "as", "needed", ".", "..", "-", "->", "<", "queryResponseWriter", "name", "=", "\"", "velocity", "\"", "class", "=", "\"", "solr", ".", "VelocityResponseWriter", "\"", "startup", "=", "\"", "lazy", "\"", ">", "<", "str", "name", "=", "\"", "template", ".", "base", ".", "dir", "\"", ">$", "{", "velocity", ".", "template", ".", "base", ".", "dir", ":", "}<", "/", "str", ">", "<", "str", "name", "=", "\"", "solr", ".", "resource", ".", "loader", ".", "enabled", "\"", ">$", "{", "velocity", ".", "solr", ".", "resource", ".", "loader", ".", "enabled", ":", "true", "}", "</", "str", ">", "<", "str", "name", "=", "\"", "params", ".", "resource", ".", "loader", ".", "enabled", "\"", ">$", "{", "velocity", ".", "params", ".", "resource", ".", "loader", ".", "enabled", ":", "false", "}", "</", "str", ">", "<", "/", "queryResponseWriter", ">", "<", "!-", "-", "XSLT", "response", "writer", "transforms", "the", "XML", "output", "by", "any", "xslt", "file", "found", "in", "Solr", "'", "s", "conf", "/", "xslt", "directory", ".", "Changes", "to", "xslt", "files", "are", "checked", "for", "every", "xsltCacheLifetimeSeconds", ".", "@", "@", "-", "17", ",", "8", "+", "17", ",", "8", "@", "@", "/", "/", "specific", "language", "governing", "permissions", "and", "limitations", "/", "/", "under", "the", "License", ".", "Solr", "allows", "you", "to", "load", "custom", "code", "to", "perform", "a", "variety", "of", "tasks", "within", "Solr", ",", "from", "custom", "Request", "Handlers", "to", "process", "your", "searches", ",", "to", "custom", "Analyzers", "and", "Token", "Filters", "for", "your", "text", "field", ".", "You", "can", "even", "load", "custom", "Field", "Types", ".", "These", "pieces", "of", "custom", "code", "are", "called", "plugins", ".", "Solr", "allows", "you", "to", "load", "custom", "code", "to", "perform", "a", "variety", "of", "tasks", "within", "Solr", ",", "from", "custom", "Request", "Handlers", "to", "process", "your", "searches", ",", "to", "custom", "Analyzers", "and", "Token", "Filters", "for", "your", "text", "field", ".", "You", "can", "even", "load", "custom", "Field", "Types", ".", "These", "pieces", "of", "custom", "code", "are", "called", "_plugins_", ".", "Not", "everyone", "will", "need", "to", "create", "plugins", "for", "their", "Solr", "instances", "-", "what", "'", "s", "provided", "is", "usually", "enough", "for", "most", "applications", ".", "However", ",", "if", "there", "'", "s", "something", "that", "you", "need", ",", "you", "may", "want", "to", "review", "the", "Solr", "Wiki", "documentation", "on", "plugins", "at", "http", ":", "//", "wiki", ".", "apache", ".", "org", "/", "solr", "/", "SolrPlugins", "[", "SolrPlugins", "]", ".", "Not", "everyone", "will", "need", "to", "create", "plugins", "for", "their", "Solr", "instances", "-", "what", "'", "s", "provided", "is", "usually", "enough", "for", "most", "applications", ".", "However", ",", "if", "there", "'", "s", "something", "that", "you", "need", ",", "you", "may", "want", "to", "review", "the", "Solr", "Wiki", "documentation", "on", "plugins", "at", "https", ":", "//", "cwiki", ".", "apache", ".", "org", "/", "confluence", "/", "display", "/", "solr", "/", "SolrPlugins", "[", "SolrPlugins", "]", ".", "If", "you", "have", "a", "plugin", "you", "would", "like", "to", "use", ",", "and", "you", "are", "running", "in", "SolrCloud", "mode", ",", "you", "can", "use", "the", "Blob", "Store", "API", "and", "the", "Config", "API", "to", "load", "the", "jars", "to", "Solr", ".", "The", "commands", "to", "use", "are", "described", "in", "the", "section", "<", "<", "adding", "-", "custom", "-", "plugins", "-", "in", "-", "solrcloud", "-", "mode", ".", "adoc", "#", "adding", "-", "custom", "-", "plugins", "-", "in", "-", "solrcloud", "-", "mode", ",", "Adding", "Custom", "Plugins", "in", "SolrCloud", "Mode", ">", ">.", "@", "@", "-", "40", ",", "6", "+", "40", ",", "8", "@", "@", "The", "above", "example", "shows", "the", "optional", "initialization", "and", "custom", "tool", "parameters", "u", "=", "==", "VelocityResponseWriter", "Startup", "Parameters", "These", "are", "Java", "system", "properties", "to", "mitigate", "security", "risks", ".", "`", "velocity", ".", "resourceloader", ".", "params", ".", "enabled", "`", "::", "The", "\"", "params", "\"", "resource", "loader", "allows", "templates", "to", "be", "specified", "in", "Solr", "request", "parameters", ".", "For", "example", ":"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "15", ",", "6", "+", "15", ",", "7", "@", "@", "Project", ":", "jackson", "-", "databind", "#", "1711", ":", "Delegating", "creator", "fails", "to", "work", "for", "binary", "data", "(", "`", "byte", "[", "]`", ")", "with", "binary", "formats", "(", "CBOR", ",", "Smile", ")", "#", "1735", ":", "Missing", "type", "checks", "when", "using", "polymorphic", "type", "ids", "#", "1737", ":", "Block", "more", "JDK", "types", "from", "polymorphic", "deserialization", "2", ".", "8", ".", "9", "(", "12", "-", "Jun", "-", "2017", ")", "@", "@", "-", "49", ",", "7", "+", "49", ",", "7", "@", "@", "static", "{", "Set", "<", "String", ">", "s", "=", "new", "HashSet", "<", ">(", ");", "/", "/", "Courtesy", "of", "[", "https", ":", "//", "github", ".", "com", "/", "kantega", "/", "notsoserial", "]", ":", "/", "/", "(", "and", "wrt", "[", "databind", "#", "1599", "]", "/", "/", "(", "and", "wrt", "[", "databind", "#", "1599", "]", ")", "s", ".", "add", "(", "\"", "org", ".", "apache", ".", "commons", ".", "collections", ".", "functors", ".", "InvokerTransformer", "\"", ");", "s", ".", "add", "(", "\"", "org", ".", "apache", ".", "commons", ".", "collections", ".", "functors", ".", "InstantiateTransformer", "\"", ");", "s", ".", "add", "(", "\"", "org", ".", "apache", ".", "commons", ".", "collections4", ".", "functors", ".", "InvokerTransformer", "\"", ");", "@", "@", "-", "61", ",", "6", "+", "61", ",", "15", "@", "@", "s", ".", "add", "(", "\"", "org", ".", "apache", ".", "xalan", ".", "xsltc", ".", "trax", ".", "TemplatesImpl", "\"", ");", "/", "/", "[", "databind", "#", "1680", "]", ":", "may", "or", "may", "not", "be", "problem", ",", "take", "no", "chance", "s", ".", "add", "(", "\"", "com", ".", "sun", ".", "rowset", ".", "JdbcRowSetImpl", "\"", ");", "/", "/", "[", "databind", "#", "1737", "]", ";", "JDK", "provided", "s", ".", "add", "(", "\"", "java", ".", "util", ".", "logging", ".", "FileHandler", "\"", ");", "s", ".", "add", "(", "\"", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", "\"", ");", "/", "/", "[", "databind", "#", "1737", "]", ";", "3rd", "party", "s", ".", "add", "(", "\"", "org", ".", "springframework", ".", "aop", ".", "support", ".", "AbstractBeanFactoryPointcutAdvisor", "\"", ");", "s", ".", "add", "(", "\"", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "config", ".", "PropertyPathFactoryBean", "\"", ");", "s", ".", "add", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "JndiRefForwardingDataSource", "\"", ");", "s", ".", "add", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "WrapperConnectionPoolDataSource", "\"", ");", "DEFAULT_NO_DESER_CLASS_NAMES", "=", "Collections", ".", "unmodifiableSet", "(", "s", ")", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "package", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "interop", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "annotation", ".", "JsonTypeInfo", ";", "import", "com", ".", "fasterxml", ".", "jackson", ".", "databind", ".", "*;", "/", "**", "@", "@", "-", "12", ",", "12", "+", "13", ",", "29", "@", "@", "public", "int", "id", ";", "public", "Object", "obj", ";", "}", "static", "class", "PolyWrapper", "{", "@", "JsonTypeInfo", "(", "use", "=", "JsonTypeInfo", ".", "Id", ".", "CLASS", ",", "include", "=", "JsonTypeInfo", ".", "As", ".", "WRAPPER_ARRAY", ")", "public", "Object", "v", ";", "}", "public", "void", "testIssue1599", "(", ")", "throws", "Exception", "/", "*", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "/", "*", "Unit", "tests", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "/", "private", "final", "ObjectMapper", "MAPPER", "=", "objectMapper", "(", ");", "/", "/", "/", "/", "/", "/", "Tests", "for", "[", "databind", "#", "1599", "]", "public", "void", "testXalanTypes1599", "(", ")", "throws", "Exception", "{", "final", "String", "clsName", "=", "\"", "com", ".", "sun", ".", "org", ".", "apache", ".", "xalan", ".", "internal", ".", "xsltc", ".", "trax", ".", "TemplatesImpl", "\"", ";", "final", "String", "JSON", "=", "aposToQuotes", "(", "\"", "{'", "id", "'", ":", "124", ",", "\\", "n", "\"", "+", "\"", "'", "obj", "'", ":[", "'", "com", ".", "sun", ".", "org", ".", "apache", ".", "xalan", ".", "internal", ".", "xsltc", ".", "trax", ".", "TemplatesImpl", "'", ",\\", "n", "\"", "\"", "'", "obj", "'", ":[", "'", "\"+", "clsName", "+", "\"'", ",\\", "n", "\"", "+", "\"", "{", "\\", "n", "\"", "+", "\"", "'", "transletBytecodes", "'", ":", "[", "'", "AAIAZQ", "=", "='", "]", ",\\", "n", "\"", "+", "\"", "'", "transletName", "'", ":", "'", "a", ".", "b", "'", ",\\", "n", "\"", "@", "@", "-", "32", ",", "9", "+", "50", ",", "75", "@", "@", "public", "void", "testIssue1599", "(", ")", "throws", "Exception", "mapper", ".", "readValue", "(", "JSON", ",", "Bean1599", ".", "class", ")", ";", "fail", "(", "\"", "Should", "not", "pass", "\"", ");", "}", "catch", "(", "JsonMappingException", "e", ")", "{", "verifyException", "(", "e", ",", "\"", "Illegal", "type", "\"", ");", "verifyException", "(", "e", ",", "\"", "to", "deserialize", "\"", ");", "verifyException", "(", "e", ",", "\"", "prevented", "for", "security", "reasons", "\"", ");", "_verifySecurityException", "(", "e", ",", "clsName", ")", ";", "}", "}", "/", "/", "/", "/", "/", "/", "Tests", "for", "[", "databind", "#", "1737", "]", "public", "void", "testJDKTypes1737", "(", ")", "throws", "Exception", "{", "_testTypes1737", "(", "java", ".", "util", ".", "logging", ".", "FileHandler", ".", "class", ")", ";", "_testTypes1737", "(", "java", ".", "rmi", ".", "server", ".", "UnicastRemoteObject", ".", "class", ")", ";", "}", "/", "/", "17", "-", "Aug", "-", "2017", ",", "tatu", ":", "Ideally", "would", "test", "handling", "of", "3rd", "party", "types", ",", "too", ",", "/", "/", "but", "would", "require", "adding", "dependencies", ".", "This", "may", "be", "practical", "when", "/", "/", "checking", "done", "by", "module", ",", "but", "for", "now", "let", "'", "s", "not", "do", "that", "for", "databind", ".", "/", "*", "public", "void", "testSpringTypes1737", "(", ")", "throws", "Exception", "{", "_testTypes1737", "(", "\"", "org", ".", "springframework", ".", "aop", ".", "support", ".", "AbstractBeanFactoryPointcutAdvisor", "\"", ");", "_testTypes1737", "(", "\"", "org", ".", "springframework", ".", "beans", ".", "factory", ".", "config", ".", "PropertyPathFactoryBean", "\"", ");", "}", "public", "void", "testC3P0Types1737", "(", ")", "throws", "Exception", "{", "_testTypes1737", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "JndiRefForwardingDataSource", "\"", ");", "_testTypes1737", "(", "\"", "com", ".", "mchange", ".", "v2", ".", "c3p0", ".", "WrapperConnectionPoolDataSource", "\"", ");", "}", "*", "/", "private", "void", "_testTypes1737", "(", "Class", "<", "?>", "nasty", ")", "throws", "Exception", "{", "_testTypes1737", "(", "nasty", ".", "getName", "(", "))", ";", "}", "private", "void", "_testTypes1737", "(", "String", "clsName", ")", "throws", "Exception", "{", "/", "/", "While", "usually", "exploited", "via", "default", "typing", "let", "'", "s", "not", "require", "/", "/", "it", "here", ";", "mechanism", "still", "the", "same", "String", "json", "=", "aposToQuotes", "(", "\"", "{'", "v", "'", ":[", "'\"", "+", "clsName", "+", "\"'", ",'", "/", "tmp", "/", "foobar", ".", "txt", "'", "]}", "\"", ")", ";", "try", "{", "MAPPER", ".", "readValue", "(", "json", ",", "PolyWrapper", ".", "class", ")", ";", "fail", "(", "\"", "Should", "not", "pass", "\"", ");", "}", "catch", "(", "JsonMappingException", "e", ")", "{", "_verifySecurityException", "(", "e", ",", "clsName", ")", ";", "}", "}", "protected", "void", "_verifySecurityException", "(", "Throwable", "t", ",", "String", "clsName", ")", "throws", "Exception", "{", "/", "/", "17", "-", "Aug", "-", "2017", ",", "tatu", ":", "Expected", "type", "more", "granular", "in", "2", ".", "9", "(", "over", "2", ".", "8", ")", "_verifyException", "(", "t", ",", "JsonMappingException", ".", "class", ",", "\"", "Illegal", "type", "\"", ",", "\"", "to", "deserialize", "\"", ",", "\"", "prevented", "for", "security", "reasons", "\"", ");", "verifyException", "(", "t", ",", "clsName", ")", ";", "}", "protected", "void", "_verifyException", "(", "Throwable", "t", ",", "Class", "<", "?>", "expExcType", ",", "String", ".", "..", "patterns", ")", "throws", "Exception", "{", "Class", "<", "?>", "actExc", "=", "t", ".", "getClass", "(", ");", "if", "(", "!", "expExcType", ".", "isAssignableFrom", "(", "actExc", ")", ")", "{", "fail", "(", "\"", "Expected", "Exception", "of", "type", "'", "\"+", "expExcType", ".", "getName", "(", ")+", "\"'", ",", "got", "'", "\"", "+", "actExc", ".", "getName", "(", ")+", "\"'", ",", "message", ":", "\"", "+", "t", ".", "getMessage", "(", "))", ";", "}", "for", "(", "String", "pattern", ":", "patterns", ")", "{", "verifyException", "(", "t", ",", "pattern", ")", ";", "}", "}", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "606", ",", "7", "+", "606", ",", "8", "@", "@", "int", "dccp_rcv_state_process", "(", "struct", "sock", "*", "sk", ",", "struct", "sk_buff", "*", "skb", ",", "if", "(", "inet_csk", "(", "sk", ")", "->", "icsk_af_ops", "-", ">", "conn_request", "(", "sk", ",", "skb", ")", "<", "0", ")", "return", "1", ";", "goto", "discard", ";", "consume_skb", "(", "skb", ")", ";", "return", "0", ";", "}", "if", "(", "dh", "-", ">", "dccph_type", "=", "=", "DCCP_PKT_RESET", ")", "goto", "discard", ";"], "docstring_tokens": ["obtain", "root", "privileges", "or", "cause", "a", "denial", "of", "service", "(double", "free", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "190", ",", "10", "+", "190", ",", "13", "@", "@", "asmlinkage", "long", "sys_remap_file_pages", "(", "unsigned", "long", "start", ",", "unsigned", "long", "size", ",", "*", "/", "if", "(", "mapping_cap_account_dirty", "(", "mapping", ")", ")", "{", "unsigned", "long", "addr", ";", "struct", "file", "*", "file", "=", "vma", "-", ">", "vm_file", ";", "flags", "&", "=", "MAP_NONBLOCK", ";", "addr", "=", "mmap_region", "(", "vma", "-", ">", "vm_file", ",", "start", ",", "size", ",", "get_file", "(", "file", ")", ";", "addr", "=", "mmap_region", "(", "file", ",", "start", ",", "size", ",", "flags", ",", "vma", "-", ">", "vm_flags", ",", "pgoff", ",", "1", ")", ";", "fput", "(", "file", ")", ";", "if", "(", "IS_ERR_VALUE", "(", "addr", ")", ")", "{", "err", "=", "addr", ";", "}", "else", "{"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system", "with", "superuser", "privileges", "or", "cause", "the", "system", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "274", ",", "6", "+", "274", ",", "10", "@", "@", "protected", "UserModel", "getUserAdapter", "(", "RealmModel", "realm", ",", "String", "userId", ",", "Long", "loaded", ",", "}", "protected", "UserModel", "validateCache", "(", "RealmModel", "realm", ",", "CachedUser", "cached", ")", "{", "if", "(", "!", "realm", ".", "getId", "(", ").", "equals", "(", "cached", ".", "getRealm", "(", "))", ")", "{", "return", "null", ";", "}", "StorageId", "storageId", "=", "new", "StorageId", "(", "cached", ".", "getId", "(", "))", ";", "if", "(", "!", "storageId", ".", "isLocal", "(", "))", "{", "ComponentModel", "component", "=", "realm", ".", "getComponent", "(", "storageId", ".", "getProviderId", "(", "))", ";", "@", "@", "-", "152", ",", "10", "+", "152", ",", "10", "@", "@", "public", "Response", "updateUser", "(", "final", "@", "PathParam", "(", "\"", "id", "\"", ")", "String", "id", ",", "final", "UserRepresent", "try", "{", "UserModel", "user", "=", "session", ".", "users", "(", ").", "getUserById", "(", "id", ",", "realm", ")", ";", "if", "(", "user", "=", "=", "null", ")", "{", "throw", "new", "NotFoundException", "(", "\"", "User", "not", "found", "\"", ");", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ");", "}", "Set", "<", "String", ">", "attrsToRemove", ";", "Set", "<", "String", ">", "attrsToRemove", ";", "if", "(", "rep", ".", "getAttributes", "(", ")", "!", "=", "null", ")", "{", "attrsToRemove", "=", "new", "HashSet", "<", ">(", "user", ".", "getAttributes", "(", ").", "keySet", "(", "))", ";", "attrsToRemove", ".", "removeAll", "(", "rep", ".", "getAttributes", "(", ").", "keySet", "(", "))", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "155", "@", "@", "/", "*", "*", "Copyright", "2016", "Red", "Hat", ",", "Inc", ".", "and", "/", "or", "its", "affiliates", "*", "and", "other", "contributors", "as", "indicated", "by", "the", "@", "author", "tags", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "*", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "keycloak", ".", "testsuite", ".", "admin", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "keycloak", ".", "admin", ".", "client", ".", "Keycloak", ";", "import", "org", ".", "keycloak", ".", "admin", ".", "client", ".", "resource", ".", "RealmResource", ";", "import", "org", ".", "keycloak", ".", "common", ".", "util", ".", "Time", ";", "import", "org", ".", "keycloak", ".", "models", ".", "AdminRoles", ";", "import", "org", ".", "keycloak", ".", "models", ".", "Constants", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "ClientRepresentation", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "RealmRepresentation", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "RoleRepresentation", ";", "import", "org", ".", "keycloak", ".", "representations", ".", "idm", ".", "UserRepresentation", ";", "import", "org", ".", "keycloak", ".", "services", ".", "resources", ".", "admin", ".", "RealmAuth", ".", "Resource", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "AbstractKeycloakTest", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "arquillian", ".", "AuthServerTestEnricher", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "ClientBuilder", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "CredentialBuilder", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "GreenMailRule", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "RealmBuilder", ";", "import", "org", ".", "keycloak", ".", "testsuite", ".", "util", ".", "UserBuilder", ";", "import", "javax", ".", "ws", ".", "rs", ".", "ClientErrorException", ";", "import", "javax", ".", "ws", ".", "rs", ".", "core", ".", "Response", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReference", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "/", "**", "*", "@", "author", "<", "a", "href", "=", "\"", "mailto", ":", "sthorger", "@", "redhat", ".", "com", "\"", ">", "Stian", "Thorgersen", "<", "/", "a", ">", "*", "/", "public", "class", "CrossRealmPermissionsTest", "extends", "AbstractKeycloakTest", "{", "private", "static", "final", "String", "REALM_NAME", "=", "\"", "crossrealm", "-", "test", "\"", ";", "private", "static", "final", "String", "REALM2_NAME", "=", "\"", "crossrealm2", "-", "test", "\"", ";", "private", "RealmResource", "realm1", ";", "private", "RealmResource", "realm2", ";", "@", "Rule", "public", "GreenMailRule", "greenMailRule", "=", "new", "GreenMailRule", "(", ");", "@", "Override", "public", "void", "addTestRealms", "(", "List", "<", "RealmRepresentation", ">", "testRealms", ")", "{", "RealmBuilder", "builder", "=", "RealmBuilder", ".", "create", "(", ").", "name", "(", "REALM_NAME", ")", ".", "testMail", "(", ");", "builder", ".", "client", "(", "ClientBuilder", ".", "create", "(", ").", "clientId", "(", "\"", "test", "-", "client", "\"", ").", "publicClient", "(", ").", "directAccessGrants", "(", "))", ";", "builder", ".", "user", "(", "UserBuilder", ".", "create", "(", ")", ".", "username", "(", "AdminRoles", ".", "REALM_ADMIN", ")", ".", "role", "(", "Constants", ".", "REALM_MANAGEMENT_CLIENT_ID", ",", "AdminRoles", ".", "REALM_ADMIN", ")", ".", "addPassword", "(", "\"", "password", "\"", "))", ";", "testRealms", ".", "add", "(", "builder", ".", "build", "(", "))", ";", "realm1", "=", "Keycloak", ".", "getInstance", "(", "AuthServerTestEnricher", ".", "getAuthServerContextRoot", "(", ")", "+", "\"", "/", "auth", "\"", ",", "REALM_NAME", ",", "AdminRoles", ".", "REALM_ADMIN", ",", "\"", "password", "\"", ",", "\"", "test", "-", "client", "\"", ",", "\"", "secret", "\"", ").", "realm", "(", "REALM_NAME", ")", ";", "builder", "=", "RealmBuilder", ".", "create", "(", ").", "name", "(", "REALM2_NAME", ")", ".", "testMail", "(", ");", "builder", ".", "client", "(", "ClientBuilder", ".", "create", "(", ").", "clientId", "(", "\"", "test", "-", "client", "\"", ").", "publicClient", "(", ").", "directAccessGrants", "(", "))", ";", "builder", ".", "user", "(", "UserBuilder", ".", "create", "(", ")", ".", "username", "(", "AdminRoles", ".", "REALM_ADMIN", ")", ".", "role", "(", "Constants", ".", "REALM_MANAGEMENT_CLIENT_ID", ",", "AdminRoles", ".", "REALM_ADMIN", ")", ".", "addPassword", "(", "\"", "password", "\"", "))", ";", "testRealms", ".", "add", "(", "builder", ".", "build", "(", "))", ";", "realm2", "=", "Keycloak", ".", "getInstance", "(", "AuthServerTestEnricher", ".", "getAuthServerContextRoot", "(", ")", "+", "\"", "/", "auth", "\"", ",", "REALM2_NAME", ",", "AdminRoles", ".", "REALM_ADMIN", ",", "\"", "password", "\"", ",", "\"", "test", "-", "client", "\"", ",", "\"", "secret", "\"", ").", "realm", "(", "REALM2_NAME", ")", ";", "}", "@", "Test", "public", "void", "users", "(", ")", "{", "UserRepresentation", "user", "=", "UserBuilder", ".", "create", "(", ").", "username", "(", "\"", "randomuser", "-", "\"", "+", "Time", ".", "currentTimeMillis", "(", "))", ".", "build", "(", ");", "Response", "response", "=", "realm1", ".", "users", "(", ").", "create", "(", "user", ")", ";", "String", "userId", "=", "ApiUtil", ".", "getCreatedId", "(", "response", ")", ";", "response", ".", "close", "(", ");", "realm1", ".", "users", "(", ").", "get", "(", "userId", ")", ".", "toRepresentation", "(", ");", "expectNotFound", "(", "new", "PermissionsTest", ".", "Invocation", "(", ")", "{", "@", "Override", "public", "void", "invoke", "(", "RealmResource", "realm", ")", "{", "realm", ".", "users", "(", ").", "get", "(", "userId", ")", ".", "toRepresentation", "(", ");", "}", "}", ",", "realm2", ")", ";", "expectNotFound", "(", "new", "PermissionsTest", ".", "Invocation", "(", ")", "{", "@", "Override", "public", "void", "invoke", "(", "RealmResource", "realm", ")", "{", "realm", ".", "users", "(", ").", "get", "(", "userId", ")", ".", "update", "(", "new", "UserRepresentation", "(", "))", ";", "}", "}", ",", "realm2", ")", ";", "expectNotFound", "(", "new", "PermissionsTest", ".", "Invocation", "(", ")", "{", "@", "Override", "public", "void", "invoke", "(", "RealmResource", "realm", ")", "{", "realm", ".", "users", "(", ").", "get", "(", "userId", ")", ".", "remove", "(", ");", "}", "}", ",", "realm2", ")", ";", "expectNotFound", "(", "new", "PermissionsTest", ".", "Invocation", "(", ")", "{", "@", "Override", "public", "void", "invoke", "(", "RealmResource", "realm", ")", "{", "realm", ".", "users", "(", ").", "get", "(", "userId", ")", ".", "getUserSessions", "(", ");", "}", "}", ",", "realm2", ")", ";", "}", "private", "void", "expectNotFound", "(", "final", "PermissionsTest", ".", "Invocation", "invocation", ",", "RealmResource", "realm", ")", "{", "expectNotFound", "(", "new", "PermissionsTest", ".", "InvocationWithResponse", "(", ")", "{", "public", "void", "invoke", "(", "RealmResource", "realm", ",", "AtomicReference", "<", "Response", ">", "response", ")", "{", "invocation", ".", "invoke", "(", "realm", ")", ";", "}", "}", ",", "realm", ")", ";", "}", "private", "void", "expectNotFound", "(", "PermissionsTest", ".", "InvocationWithResponse", "invocation", ",", "RealmResource", "realm", ")", "{", "int", "statusCode", "=", "0", ";", "try", "{", "AtomicReference", "<", "Response", ">", "responseReference", "=", "new", "AtomicReference", "<", ">(", ");", "invocation", ".", "invoke", "(", "realm", ",", "responseReference", ")", ";", "Response", "response", "=", "responseReference", ".", "get", "(", ");", "if", "(", "response", "!", "=", "null", ")", "{", "statusCode", "=", "response", ".", "getStatus", "(", ");", "}", "else", "{", "fail", "(", "\"", "Expected", "failure", "\"", ");", "}", "}", "catch", "(", "ClientErrorException", "e", ")", "{", "statusCode", "=", "e", ".", "getResponse", "(", ").", "getStatus", "(", ");", "}", "assertEquals", "(", "404", ",", "statusCode", ")", ";", "}", "}"], "docstring_tokens": ["bypass", "normal", "permissions", "and", "delete", "users", "in", "a", "separate", "realm", "."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "27", ",", "4", "+", "27", ",", "14", "@", "@", "public", "TikaMemoryLimitException", "(", "String", "msg", ")", "{", "super", "(", "msg", ")", ";", "}", "public", "TikaMemoryLimitException", "(", "long", "triedToAllocate", ",", "long", "maxAllowable", ")", "{", "super", "(", "msg", "(", "triedToAllocate", ",", "maxAllowable", ")", ");", "}", "private", "static", "String", "msg", "(", "long", "triedToAllocate", ",", "long", "maxAllowable", ")", "{", "return", "\"", "Tried", "to", "allocate", "\"", "+", "triedToAllocate", "+", "\"", "bytes", ",", "but", "\"", "+", "maxAllowable", "\"", "is", "the", "maximum", "allowed", ".", "Please", "open", "an", "issue", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "projects", "/", "TIKA", "\"", "\"", "if", "you", "believe", "this", "file", "is", "not", "corrupt", ".", "\";", "}", "}", "@", "@", "-", "28", ",", "6", "+", "28", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "input", ".", "CloseShieldInputStream", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaException", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaMemoryLimitException", ";", "import", "org", ".", "apache", ".", "tika", ".", "extractor", ".", "EmbeddedDocumentExtractor", ";", "import", "org", ".", "apache", ".", "tika", ".", "extractor", ".", "EmbeddedDocumentUtil", ";", "import", "org", ".", "apache", ".", "tika", ".", "io", ".", "EndianUtils", ";", "@", "@", "-", "48", ",", "6", "+", "49", ",", "7", "@", "@", "*", "/", "public", "class", "AppleSingleFileParser", "extends", "AbstractParser", "{", "private", "static", "final", "int", "MAX_FIELD_LENGTH", "=", "1_073_741_824", ";", "/", "**", "*", "Entry", "types", "*", "/", "@", "@", "-", "123", ",", "8", "+", "125", ",", "8", "@", "@", "private", "long", "processFieldEntries", "(", "InputStream", "stream", ",", "List", "<", "FieldInfo", ">", "fieldInfoLi", "IOUtils", ".", "skipFully", "(", "stream", ",", "diff", ")", ";", "bytesRead", "+", "=", "diff", ";", "if", "(", "f", ".", "entryId", "=", "=", "REAL_NAME", ")", "{", "if", "(", "f", ".", "length", ">", "Integer", ".", "MAX_VALUE", ")", "{", "throw", "new", "TikaException", "(", "\"", "File", "name", "length", "can", "'", "t", "be", ">", "integer", "max", "\"", ");", "if", "(", "f", ".", "length", ">", "MAX_FIELD_LENGTH", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "f", ".", "length", ",", "MAX_FIELD_LENGTH", ")", ";", "}", "buffer", "=", "new", "byte", "[", "(", "int", ")", "f", ".", "length", "]", ";", "IOUtils", ".", "readFully", "(", "stream", ",", "buffer", ")", ";", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "apache", ".", "poi", ".", "util", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaException", ";", "import", "org", ".", "apache", ".", "tika", ".", "exception", ".", "TikaMemoryLimitException", ";", "import", "org", ".", "apache", ".", "tika", ".", "metadata", ".", "Metadata", ";", "import", "org", ".", "apache", ".", "tika", ".", "mime", ".", "MediaType", ";", "import", "org", ".", "apache", ".", "tika", ".", "parser", ".", "ParseContext", ";", "@", "@", "-", "36", ",", "6", "+", "37", ",", "7", "@", "@", "*", "/", "public", "class", "ICNSParser", "extends", "AbstractParser", "{", "private", "static", "final", "long", "serialVersionUID", "=", "922010233654248327L", ";", "private", "static", "final", "long", "MAX_IMAGE_LENGTH_BYTES", "=", "10485760", ";", "//", "10MB", "private", "static", "final", "Set", "<", "MediaType", ">", "SUPPORTED_TYPES", "=", "Collections", ".", "singleton", "(", "MediaType", ".", "image", "(", "\"", "icns", "\"", "))", ";", "public", "static", "final", "String", "ICNS_MIME_TYPE", "=", "\"", "image", "/", "icns", "\"", ";", "@", "@", "-", "58", ",", "6", "+", "60", ",", "9", "@", "@", "public", "void", "parse", "(", "}", "IOUtils", ".", "readFully", "(", "stream", ",", "header", ",", "0", ",", "4", ")", ";", "/", "/", "Extract", "image", "size", "/", "length", "of", "bytes", "in", "file", "int", "image_length", "=", "java", ".", "nio", ".", "ByteBuffer", ".", "wrap", "(", "header", ")", ".", "getInt", "(", ");", "if", "(", "image_length", ">", "MAX_IMAGE_LENGTH_BYTES", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "image_length", ",", "MAX_IMAGE_LENGTH_BYTES", ")", ";", "}", "byte", "[", "]", "full_file", "=", "new", "byte", "[", "image_length", "]", ";", "IOUtils", ".", "readFully", "(", "stream", ",", "full_file", ")", ";", "ArrayList", "<", "ICNSType", ">", "icons", "=", "new", "ArrayList", "<", ">(", ");", "@", "@", "-", "74", ",", "7", "+", "79", ",", "7", "@", "@", "public", "void", "parse", "(", "if", "(", "icnstype", "=", "=", "null", ")", "{", "/", "/", "exit", "out", "of", "loop", "/", "/", "No", "more", "icons", "left", "offset", "=", "image_length", "-", "8", ";", "break", ";", "}", "else", "if", "(", "icnstype", ".", "hasMask", "(", ")", "=", "=", "true", ")", "{", "icon_masks", ".", "add", "(", "findIconType", "(", "tempByteArray", ")", ");", "}", "else", "{", "@", "@", "-", "628", ",", "7", "+", "628", ",", "8", "@", "@", "private", "FileNode", "deserializeFileNode", "(", "FileNode", "data", ",", "FileNodePtr", "curPath", ")", "throws", "}", "if", "(", "cch", ">", "dif", ".", "size", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "CCH", "=", "\"", "+", "cch", "+", "\"", "was", "found", "that", "was", "great", "than", "file", "size", "\"", "+", "dif", ".", "size", "(", "))", ";", "throw", "new", "TikaMemoryLimitException", "(", "\"", "CCH", "=", "\"", "+", "cch", "+", "\"", "was", "found", "that", "was", "greater", "\"", "\"", "than", "file", "size", "\"", "+", "dif", ".", "size", "(", "))", ";", "}", "ByteBuffer", "dataSpaceBuffer", "=", "ByteBuffer", ".", "allocate", "(", "(", "int", ")", "cch", "*", "2", ")", ";", "dif", ".", "read", "(", "dataSpaceBuffer", ")", ";", "@", "@", "-", "1174", ",", "7", "+", "1175", ",", "8", "@", "@", "long", "roomLeft", "(", ")", "{", "public", "void", "dumpHex", "(", ")", "throws", "TikaMemoryLimitException", ",", "IOException", "{", "if", "(", "end", "-", "offset", ">", "dif", ".", "size", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Exceeded", "memory", "limit", "when", "trying", "to", "dumpHex", "-", "\"", "+", "(", "end", "-", "offset", ")", "+", "\"", ">", "\"", "+", "dif", ".", "size", "(", "))", ";", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Exceeded", "memory", "limit", "when", "trying", "to", "dumpHex", "-", "\"", "\"", "\"", "+", "(", "end", "-", "offset", ")", "+", "\"", ">", "\"", "+", "dif", ".", "size", "(", "))", ";", "}", "ByteBuffer", "byteBuffer", "=", "ByteBuffer", ".", "allocate", "(", "(", "int", ")", "(", "end", "-", "offset", ")", ");", "LOG", ".", "debug", "(", "Hex", ".", "encodeHexString", "(", "byteBuffer", ".", "array", "(", "))", ");", "@", "@", "-", "302", ",", "7", "+", "302", ",", "8", "@", "@", "private", "boolean", "hasRevisionRole", "(", "ExtendedGUID", "rid", ",", "Pair", "<", "Long", ",", "ExtendedGUID", ">", "revis", "OneNotePtr", "content", "=", "new", "OneNotePtr", "(", "oneNoteDocument", ",", "dif", ")", ";", "content", ".", "reposition", "(", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ")", ";", "if", "(", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ".", "cb", ">", "dif", ".", "size", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "data", "store", "cb", "\"", "+", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ".", "cb", "+", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "data", "store", "cb", "\"", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ".", "cb", "\"", "exceeds", "document", "size", ":", "\"", "+", "dif", ".", "size", "(", "))", ";", "}", "handleEmbedded", "(", "(", "int", ")", "fileDataStoreObjectReference", ".", "ref", ".", "fileData", ".", "cb", ")", ";", "@", "@", "-", "454", ",", "7", "+", "454", ",", "8", "@", "@", "private", "static", "void", "copyUpToMaxLength", "(", "InputStream", "is", ",", "OutputStream", "os", ")", "throws", "IO", "BoundedInputStream", "bis", "=", "new", "BoundedInputStream", "(", "MAX_IMAGE_LENGTH_BYTES", ",", "is", ")", ";", "IOUtils", ".", "copy", "(", "bis", ",", "os", ")", ";", "if", "(", "bis", ".", "hasHitBound", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Image", "size", "is", "larger", "than", "allowed", "(", "\"", "+", "MAX_IMAGE_LENGTH_BYTES", "+", "\"", ")\"", ");", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Image", "size", "is", "larger", "than", "allowed", "(", "\"", "+", "MAX_IMAGE_LENGTH_BYTES", "+", "\"", ")\"", ");", "}", "}", "@", "@", "-", "153", ",", "9", "+", "153", ",", "7", "@", "@", "protected", "void", "writeBytes", "(", "InputStream", "is", ",", "int", "len", ")", "throws", "IOException", ",", "TikaExcep", "throw", "new", "TikaException", "(", "\"", "Requesting", "I", "read", "<", "0", "bytes", "?", "!\"", ");", "}", "if", "(", "len", ">", "memoryLimitInKb", "*", "1024", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "embedded", "in", "RTF", "caused", "this", "(", "\"", "+", "len", "+", "\"", ")", "bytes", ")", ",", "but", "maximum", "allowed", "is", "(", "\"+", "(", "memoryLimitInKb", "*", "1024", ")", "+\"", ").", "\"+", "\"", "If", "this", "is", "a", "valid", "RTF", "file", ",", "consider", "increasing", "the", "memory", "limit", "via", "TikaConfig", ".", "\")", ";", "throw", "new", "TikaMemoryLimitException", "(", "len", ",", "(", "memoryLimitInKb", "*", "1024", ")", ");", "}", "byte", "[", "]", "bytes", "=", "new", "byte", "[", "len", "]", ";", "@", "@", "-", "155", ",", "7", "+", "155", ",", "8", "@", "@", "new", "DocumentInputStream", "(", "(", "DocumentEntry", ")", "ooxml", ")", "))", "{", "IOUtils", ".", "copy", "(", "bis", ",", "out", ")", ";", "if", "(", "bis", ".", "hasHitBound", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Hit", "memory", "limit", "exception", ".", "Tried", "to", "copy", ">", "\"", "+", "memoryLimitInKb", "*", "1024", ")", ";", "throw", "new", "TikaMemoryLimitException", "(", "(", "memoryLimitInKb", "*", "1024", "+", "1", ")", ",", "(", "memoryLimitInKb", "*", "1024", ")", ");", "}", "}", "ret", "=", "out", ".", "toByteArray", "(", ");", "@", "@", "-", "190", ",", "7", "+", "191", ",", "7", "@", "@", "BoundedInputStream", "bis", "=", "new", "BoundedInputStream", "(", "memoryLimitInKb", "*", "1024", ",", "is", ")", ";", "IOUtils", ".", "copy", "(", "is", ",", "out", ")", ";", "if", "(", "bis", ".", "hasHitBound", "(", "))", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "Hit", "memory", "limit", "exception", ".", "Tried", "to", "copy", ">", "\"", "+", "memoryLimitInKb", "*", "1024", ")", ";", "throw", "new", "TikaMemoryLimitException", "(", "memoryLimitInKb", "*", "1024", "+", "1", ",", "memoryLimitInKb", "*", "1024", ")", ";", "}", "ret", "=", "out", ".", "toByteArray", "(", ");", "metadata", ".", "set", "(", "Metadata", ".", "RESOURCE_NAME_KEY", ",", "\"", "file_", "\"", "+", "unknownFilenameCount", ".", "getAndIncrement", "(", ")", "+", "\"", ".\"", "+", "type", ".", "getExtension", "(", "))", ";", "@", "@", "-", "325", ",", "12", "+", "326", ",", "9", "@", "@", "private", "String", "readLengthPrefixedAnsiString", "(", "InputStream", "is", ")", "throws", "IOException", ",", "if", "(", "len", "<", "0", ")", "{", "throw", "new", "IOException", "(", "\"", "Requested", "length", "for", "reading", "bytes", "<", "0", "?", "!:", "\"", "+", "len", ")", ";", "}", "else", "if", "(", "memoryLimitInKb", ">", "-", "1", "&", "&", "len", ">", "memoryLimitInKb", "*", "1024", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "embedded", "in", "RTF", "caused", "this", "(", "\"", "+", "len", "+", "\"", ")", "bytes", ")", ",", "but", "maximum", "allowed", "is", "(", "\"+", "(", "memoryLimitInKb", "*", "1024", ")", "+\"", ").", "\"+", "\"", "If", "this", "is", "a", "valid", "RTF", "file", ",", "consider", "increasing", "the", "memory", "limit", "via", "TikaConfig", ".", "\")", ";", "throw", "new", "TikaMemoryLimitException", "(", "len", ",", "memoryLimitInKb", "*", "1024", ")", ";", "}", "else", "if", "(", "len", ">", "Integer", ".", "MAX_VALUE", ")", "{", "throw", "new", "TikaMemoryLimitException", "(", "\"", "File", "embedded", "in", "RTF", "caused", "this", "(", "\"", "+", "len", "+", "\"", ")", "bytes", ")", ",", "but", "there", "is", "a", "hard", "limit", "of", "Integer", ".", "MAX_VALUE", "+", "\")", ";", "throw", "new", "TikaMemoryLimitException", "(", "len", ",", "Integer", ".", "MAX_VALUE", ")", ";", "}", "return", "new", "byte", "[", "(", "int", ")", "len", "]", ";", "@", "@", "-", "186", ",", "7", "+", "186", ",", "7", "@", "@", "public", "void", "parseEmbedded", "(", "InputStream", "inputStream", ",", "ContentHandler", "contentHandler", "IOUtils", ".", "copy", "(", "bis", ",", "bos", ")", ";", "if", "(", "bis", ".", "hasHitBound", "(", "))", "{", "throw", "new", "IOExceptionWithCause", "(", "new", "TikaMemoryLimitException", "(", "\"", "Tried", "to", "read", "beyond", "\"", "+", "MAX_ATTACHMENT_BYTES", "+", "\"", "bytes", "\"", "))", ";", "new", "TikaMemoryLimitException", "(", "MAX_ATTACHMENT_BYTES", "+", "1", ",", "MAX_ATTACHMENT_BYTES", ")", ");", "}", "byte", "[", "]", "data", "=", "bos", ".", "toByteArray", "(", ");"], "docstring_tokens": ["a", "denial", "of", "service", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2017", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "*", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "License", ".", "@", "@", "-", "26", ",", "15", "+", "26", ",", "14", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "CopyOnWriteArraySet", ";", "import", "org", ".", "springframework", ".", "expression", ".", "AccessException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "EvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "Expression", ";", "import", "org", ".", "springframework", ".", "expression", ".", "ExpressionParser", ";", "import", "org", ".", "springframework", ".", "expression", ".", "PropertyAccessor", ";", "import", "org", ".", "springframework", ".", "expression", ".", "TypedValue", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "SpelEvaluationException", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "standard", ".", "SpelExpressionParser", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "StandardEvaluationContext", ";", "import", "org", ".", "springframework", ".", "expression", ".", "spel", ".", "support", ".", "SimpleEvaluationContext", ";", "import", "org", ".", "springframework", ".", "lang", ".", "Nullable", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "Message", ";", "import", "org", ".", "springframework", ".", "messaging", ".", "MessageHeaders", ";", "@", "@", "-", "65", ",", "6", "+", "64", ",", "11", "@", "@", "/", "**", "Default", "maximum", "number", "of", "entries", "for", "the", "destination", "cache", ":", "1024", "*", "/", "public", "static", "final", "int", "DEFAULT_CACHE_LIMIT", "=", "1024", ";", "/", "**", "Static", "evaluation", "context", "to", "re", "-", "use", "*", "/", "private", "static", "SimpleEvaluationContext", "evaluationContext", "=", "SimpleEvaluationContext", ".", "builder", "(", ")", ".", "propertyAccessor", "(", "new", "SimpMessageHeaderPropertyAccessor", "(", "))", ".", "build", "(", ");", "private", "PathMatcher", "pathMatcher", "=", "new", "AntPathMatcher", "(", ");", "@", "@", "-", "192", ",", "7", "+", "196", ",", "6", "@", "@", "public", "void", "unregisterAllSubscriptions", "(", "String", "sessionId", ")", "{", "if", "(", "!", "this", ".", "selectorHeaderInUse", ")", "{", "return", "allMatches", ";", "}", "EvaluationContext", "context", "=", "null", ";", "MultiValueMap", "<", "String", ",", "String", ">", "result", "=", "new", "LinkedMultiValueMap", "<", ">(", "allMatches", ".", "size", "(", "))", ";", "for", "(", "String", "sessionId", ":", "allMatches", ".", "keySet", "(", "))", "{", "for", "(", "String", "subId", ":", "allMatches", ".", "get", "(", "sessionId", ")", ")", "{", "@", "@", "-", "209", ",", "12", "+", "212", ",", "8", "@", "@", "public", "void", "unregisterAllSubscriptions", "(", "String", "sessionId", ")", "{", "result", ".", "add", "(", "sessionId", ",", "subId", ")", ";", "continue", ";", "}", "if", "(", "context", "=", "=", "null", ")", "{", "context", "=", "new", "StandardEvaluationContext", "(", "message", ")", ";", "context", ".", "getPropertyAccessors", "(", ").", "add", "(", "new", "SimpMessageHeaderPropertyAccessor", "(", "))", ";", "}", "try", "{", "if", "(", "Boolean", ".", "TRUE", ".", "equals", "(", "expression", ".", "getValue", "(", "context", ",", "Boolean", ".", "class", ")", "))", "{", "if", "(", "Boolean", ".", "TRUE", ".", "equals", "(", "expression", ".", "getValue", "(", "evaluationContext", ",", "message", ",", "Boolean", ".", "class", ")", "))", "{", "result", ".", "add", "(", "sessionId", ",", "subId", ")", ";", "}", "}", "@", "@", "-", "533", ",", "7", "+", "532", ",", "7", "@", "@", "public", "String", "toString", "(", ")", "{", "@", "Override", "public", "Class", "<", "?>", "[]", "getSpecificTargetClasses", "(", ")", "{", "return", "new", "Class", "<", "?>", "[]", "{", "MessageHeaders", ".", "class", "}", ";", "return", "new", "Class", "<", "?>", "[]", "{", "Message", ".", "class", ",", "MessageHeaders", ".", "class", "}", ";", "}", "@", "Override", "@", "@", "-", "542", ",", "21", "+", "541", ",", "29", "@", "@", "public", "boolean", "canRead", "(", "EvaluationContext", "context", ",", "@", "Nullable", "Object", "target", ",", "Strin", "}", "@", "Override", "public", "TypedValue", "read", "(", "EvaluationContext", "context", ",", "@", "Nullable", "Object", "target", ",", "String", "name", ")", "throws", "AccessException", "{", "Assert", ".", "state", "(", "target", "instanceof", "MessageHeaders", ",", "\"", "No", "MessageHeaders", "\"", ");", "MessageHeaders", "headers", "=", "(", "MessageHeaders", ")", "target", ";", "SimpMessageHeaderAccessor", "accessor", "=", "MessageHeaderAccessor", ".", "getAccessor", "(", "headers", ",", "SimpMessageHeaderAccessor", ".", "class", ")", ";", "Assert", ".", "state", "(", "accessor", "!", "=", "null", ",", "\"", "No", "SimpMessageHeaderAccessor", "\"", ");", "public", "TypedValue", "read", "(", "EvaluationContext", "context", ",", "@", "Nullable", "Object", "target", ",", "String", "name", ")", "{", "Object", "value", ";", "if", "(", "\"", "destination", "\"", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "value", "=", "accessor", ".", "getDestination", "(", ");", "if", "(", "target", "instanceof", "Message", ")", "{", "value", "=", "name", ".", "equals", "(", "\"", "headers", "\"", ")", "?", "(", "(", "Message", ")", "target", ")", ".", "getHeaders", "(", ")", ":", "null", ";", "}", "else", "{", "value", "=", "accessor", ".", "getFirstNativeHeader", "(", "name", ")", ";", "if", "(", "value", "=", "=", "null", ")", "{", "value", "=", "headers", ".", "get", "(", "name", ")", ";", "else", "if", "(", "target", "instanceof", "MessageHeaders", ")", "{", "MessageHeaders", "headers", "=", "(", "MessageHeaders", ")", "target", ";", "SimpMessageHeaderAccessor", "accessor", "=", "MessageHeaderAccessor", ".", "getAccessor", "(", "headers", ",", "SimpMessageHeaderAccessor", ".", "class", ")", ";", "Assert", ".", "state", "(", "accessor", "!", "=", "null", ",", "\"", "No", "SimpMessageHeaderAccessor", "\"", ");", "if", "(", "\"", "destination", "\"", ".", "equalsIgnoreCase", "(", "name", ")", ")", "{", "value", "=", "accessor", ".", "getDestination", "(", ");", "}", "else", "{", "value", "=", "accessor", ".", "getFirstNativeHeader", "(", "name", ")", ";", "if", "(", "value", "=", "=", "null", ")", "{", "value", "=", "headers", ".", "get", "(", "name", ")", ";", "}", "}", "}", "else", "{", "/", "/", "Should", "never", "happen", ".", "..", "throw", "new", "IllegalStateException", "(", "\"", "Expected", "Message", "or", "MessageHeaders", ".", "\")", ";", "}", "return", "new", "TypedValue", "(", "value", ")", ";", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "*", "/", "package", "hudson", ".", "model", ";", "import", "hudson", ".", "Util", ";", "import", "hudson", ".", "util", ".", "RunList", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "@", "@", "-", "64", ",", "7", "+", "65", ",", "9", "@", "@", "public", "TimelineEventList", "doData", "(", "StaplerRequest", "req", ",", "@", "QueryParameter", "long", "min", ",", "@", "Q", "Event", "e", "=", "new", "Event", "(", ");", "e", ".", "start", "=", "new", "Date", "(", "r", ".", "getStartTimeInMillis", "(", "))", ";", "e", ".", "end", "=", "new", "Date", "(", "r", ".", "getStartTimeInMillis", "(", ")+", "r", ".", "getDuration", "(", "))", ";", "e", ".", "title", "=", "r", ".", "getFullDisplayName", "(", ");", "/", "/", "due", "to", "SimileAjax", ".", "HTML", ".", "deEntify", "(", "in", "simile", "-", "ajax", "-", "bundle", ".", "js", ")", ",", "\"", "&", "lt", ";", "\"", "are", "transformed", "back", "to", "\"", "<\"", ",", "but", "not", "the", "\"", "&#", "60", "\"", ";", "/", "/", "to", "protect", "against", "XSS", "e", ".", "title", "=", "Util", ".", "escape", "(", "r", ".", "getFullDisplayName", "(", "))", ".", "replace", "(", "\"&", "lt", ";", "\",", "\"", "&#", "60", ";", "\")", ";", "/", "/", "what", "to", "put", "in", "the", "description", "?", "/", "/", "e", ".", "description", "=", "\"", "Longish", "description", "of", "event", "\"", "+", "r", ".", "getFullDisplayName", "(", ");", "/", "/", "e", ".", "durationEvent", "=", "true", ";", "@", "@", "-", "56", ",", "7", "+", "56", ",", "7", "@", "@", "THE", "SOFTWARE", ".", "onSuccess", ":", "function", "(", "t", ")", "{", "if", "(", "t", ".", "status", "!", "=", "0", ")", "{", "try", "{", "eventSource1", ".", "loadJSON", "(", "eval", "(", "'(", "'+", "t", ".", "responseText", "+", "')", "')", ",'", ".'", ");", "eventSource1", ".", "loadJSON", "(", "JSON", ".", "parse", "(", "t", ".", "responseText", ")", ",'", ".'", ");", "getData", "(", "eventSource1", ",", "current", "-", "1", ",", "min", ",", "max", ")", ";", "}", "catch", "(", "e", ")", "{", "alert", "(", "e", ")", ";"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2041", ",", "8", "+", "2041", ",", "8", "@", "@", "static", "int", "ext4_fill_super", "(", "struct", "super_block", "*", "sb", ",", "void", "*", "data", ",", "int", "silent", ")", "const", "char", "*", "descr", ";", "int", "ret", "=", "-", "EINVAL", ";", "int", "blocksize", ";", "int", "db_count", ";", "int", "i", ";", "unsigned", "int", "db_count", ";", "unsigned", "int", "i", ";", "int", "needs_recovery", ",", "has_huge_files", ";", "int", "features", ";", "__u64", "blocks_count", ";", "@", "@", "-", "2331", ",", "20", "+", "2331", ",", "30", "@", "@", "static", "int", "ext4_fill_super", "(", "struct", "super_block", "*", "sb", ",", "void", "*", "data", ",", "int", "silent", ")", "if", "(", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", "=", "=", "0", ")", "goto", "cantfind_ext4", ";", "/", "*", "ensure", "blocks_count", "calculation", "below", "doesn", "'", "t", "sign", "-", "extend", "*", "/", "if", "(", "ext4_blocks_count", "(", "es", ")", "+", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", "<", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", "+", "1", ")", "{", "printk", "(", "KERN_WARNING", "\"", "EXT4", "-", "fs", ":", "bad", "geometry", ":", "block", "count", "%", "llu", ",", "\"", "\"", "first", "data", "block", "%", "u", ",", "blocks", "per", "group", "%", "lu", "\\", "n", "\"", ",", "ext4_blocks_count", "(", "es", ")", ",", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", ",", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", ");", "/", "*", "*", "It", "makes", "no", "sense", "for", "the", "first", "data", "block", "to", "be", "beyond", "the", "end", "*", "of", "the", "filesystem", ".", "*", "/", "if", "(", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", ">", "=", "ext4_blocks_count", "(", "es", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "EXT4", "-", "fs", ":", "bad", "geometry", ":", "first", "data", "\"", "\"", "block", "%", "u", "is", "beyond", "end", "of", "filesystem", "(", "%", "llu", ")", "\\", "n", "\"", ",", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", ",", "ext4_blocks_count", "(", "es", ")", ");", "goto", "failed_mount", ";", "}", "blocks_count", "=", "(", "ext4_blocks_count", "(", "es", ")", "-", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", "+", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", "-", "1", ")", ";", "do_div", "(", "blocks_count", ",", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", ");", "if", "(", "blocks_count", ">", "(", "(", "uint64_t", ")", "1", "<", "<", "32", ")", "-", "EXT4_DESC_PER_BLOCK", "(", "sb", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "EXT4", "-", "fs", ":", "groups", "count", "too", "large", ":", "%", "u", "\"", "\"", "(", "block", "count", "%", "llu", ",", "first", "data", "block", "%", "u", ",", "\"", "\"", "blocks", "per", "group", "%", "lu", ")", "\\", "n", "\"", ",", "sbi", "-", ">", "s_groups_count", ",", "ext4_blocks_count", "(", "es", ")", ",", "le32_to_cpu", "(", "es", "-", ">", "s_first_data_block", ")", ",", "EXT4_BLOCKS_PER_GROUP", "(", "sb", ")", ");", "goto", "failed_mount", ";", "}", "sbi", "-", ">", "s_groups_count", "=", "blocks_count", ";", "db_count", "=", "(", "sbi", "-", ">", "s_groups_count", "+", "EXT4_DESC_PER_BLOCK", "(", "sb", ")", "-", "1", ")", "/", "EXT4_DESC_PER_BLOCK", "(", "sb", ")", ";"], "docstring_tokens": ["crash", "the", "vulnerable", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "232", ",", "6", "+", "232", ",", "9", "@", "@", "private", "LdapContext", "getLdapContextUsingStartTls", "(", "LdapContextFactory", "ldapContextF", "ctx", ".", "addToEnvironment", "(", "Context", ".", "SECURITY_PRINCIPAL", ",", "principal", ")", ";", "ctx", ".", "addToEnvironment", "(", "Context", ".", "SECURITY_CREDENTIALS", ",", "credentials", ")", ";", "/", "/", "do", "a", "lookup", "of", "the", "user", "to", "trigger", "authentication", "ctx", ".", "lookup", "(", "principal", ".", "toString", "(", ")", ")", ";", "return", "ctx", ";", "}", "catch", "(", "IOException", "e", ")", "@", "@", "-", "717", ",", "6", "+", "717", ",", "25", "@", "@", "public", "void", "shouldBeAbleToLoginAndAuthorizeReaderWithLdapOnlyUsingStartTls", "(", ")", "thr", "}", "}", "@", "Test", "public", "void", "shouldFailLoginWrongPasswordWithLdapOnlyUsingStartTls", "(", ")", "throws", "Throwable", "{", "getLdapServer", "(", ").", "setConfidentialityRequired", "(", "true", ")", ";", "try", "(", "EmbeddedTestCertificates", "ignore", "=", "new", "EmbeddedTestCertificates", "(", ")", ")", "{", "/", "/", "When", "restartNeo4jServerWithOverriddenSettings", "(", "ldapOnlyAuthSettings", ".", "andThen", "(", "settings", "-", ">", "{", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_server", ",", "\"", "localhost", ":", "10389", "\"", ")", ";", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_use_starttls", ",", "\"", "true", "\"", ")", ";", "}", ")", ")", ";", "/", "/", "Then", "assertAuthFail", "(", "\"", "neo", "\"", ",", "\"", "wrong", "\"", ")", ";", "}", "}", "@", "Test", "public", "void", "shouldBeAbleToLoginAndAuthorizeReaderWithLdapUserContextUsingStartTls", "(", ")", "throws", "Throwable", "{", "@", "@", "-", "737", ",", "6", "+", "756", ",", "26", "@", "@", "public", "void", "shouldBeAbleToLoginAndAuthorizeReaderWithLdapUserContextUsingStartTl", "}", "}", "@", "Test", "public", "void", "shouldFailLoginWrongPasswordWithLdapUserContextUsingStartTls", "(", ")", "throws", "Throwable", "{", "getLdapServer", "(", ").", "setConfidentialityRequired", "(", "true", ")", ";", "try", "(", "EmbeddedTestCertificates", "ignore", "=", "new", "EmbeddedTestCertificates", "(", ")", ")", "{", "/", "/", "When", "restartNeo4jServerWithOverriddenSettings", "(", "ldapOnlyAuthSettings", ".", "andThen", "(", "settings", "-", ">", "{", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_authorization_use_system_account", ",", "\"", "false", "\"", ")", ";", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_server", ",", "\"", "localhost", ":", "10389", "\"", ")", ";", "settings", ".", "put", "(", "SecuritySettings", ".", "ldap_use_starttls", ",", "\"", "true", "\"", ")", ";", "}", ")", ")", ";", "/", "/", "Then", "assertAuthFail", "(", "\"", "neo", "\"", ",", "\"", "wrong", "\"", ")", ";", "}", "}", "/", "/-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-", "/", "/", "Active", "Directory", "tests", "on", "EC2", "/", "/", "NOTE", ":", "These", "rely", "on", "an", "external", "server", "and", "are", "not", "executed", "by", "automated", "testing"], "docstring_tokens": ["bypass", "access", "restrictions"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "176", "+", "1", ",", "183", "@", "@", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "?>", "<", "!-", "-", "Copyright", "(", "c", ")", "2008", "-", "2016", ",", "DYNATRACE", "LLC", "All", "rights", "reserved", ".", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "*", "Neither", "the", "name", "of", "the", "dynaTrace", "software", "nor", "the", "names", "of", "its", "contributors", "may", "be", "used", "to", "endorse", "or", "promote", "products", "derived", "from", "this", "software", "without", "specific", "prior", "written", "permission", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", ">", "<", "project", "xmlns", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "maven", "-", "v4_0_0", ".", "xsd", "\"", ">", "<", "modelVersion", ">", "4", ".", "0", ".", "0", "<", "/", "modelVersion", ">", "<", "parent", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "8", "<", "/", "version", ">", "<!", "--", "which", "version", "of", "Jenkins", "is", "this", "plugin", "built", "against", "?", "-", "->", "<", "/", "parent", ">", "<", "artifactId", ">", "dynatrace", "-", "dashboard", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "1", ".", "4", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "packaging", ">", "hpi", "<", "/", "packaging", ">", "<", "name", ">", "Dynatrace", "Application", "Monitoring", "Plugin", "<", "/", "name", ">", "<", "url", ">", "https", ":", "//", "wiki", ".", "jenkins", "-", "ci", ".", "org", "/", "display", "/", "JENKINS", "/", "Dynatrace", "+", "Plugin", "<", "/", "url", ">", "<", "scm", ">", "<", "connection", ">", "scm", ":", "git", ":", "ssh", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", ".", "git", "<", "/", "connection", ">", "<", "developerConnection", ">", "scm", ":", "git", ":", "ssh", ":", "//", "git", "@", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", ".", "git", "<", "/", "developerConnection", ">", "<", "url", ">", "https", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", "<", "/", "url", ">", "<", "tag", ">", "HEAD", "<", "/", "tag", ">", "<", "/", "scm", ">", "<", "developers", ">", "<", "developer", ">", "<", "id", ">", "dynatrace", "<", "/", "id", ">", "<", "name", ">", "Dynatrace", "Development", "Team", "<", "/", "name", ">", "<", "email", ">", "Jenkins", ".", "Plugin", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "developer", ">", "<", "id", ">", "dariusz", ".", "glugla", "<", "/", "id", ">", "<", "name", ">", "Dariusz", "Glugla", "<", "/", "name", ">", "<", "email", ">", "dariusz", ".", "glugla", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "developer", ">", "<", "id", ">", "piotr", ".", "lugowski", "<", "/", "id", ">", "<", "name", ">", "Piotr", "Lugowski", "<", "/", "name", ">", "<", "email", ">", "piotr", ".", "lugowski", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "/", "developers", ">", "<", "properties", ">", "<", "project", ".", "build", ".", "sourceEncoding", ">", "UTF", "-", "8", "<", "/", "project", ".", "build", ".", "sourceEncoding", ">", "<", "jenkins", ".", "version", ">", "2", ".", "0", "<", "/", "jenkins", ".", "version", ">", "<", "findbugs", ".", "skip", ">", "true", "<", "/", "findbugs", ".", "skip", ">", "<", "argLine", "/", ">", "<", "/", "properties", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "artifactId", ">", "maven", "-", "clean", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "0", ".", "0", "<", "/", "version", ">", "<", "/", "plugin", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "maven", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "compiler", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "5", ".", "1", "<", "/", "version", ">", "<", "configuration", ">", "<", "source", ">", "1", ".", "7", "<", "/", "source", ">", "<", "target", ">", "1", ".", "7", "<", "/", "target", ">", "<", "showWarnings", ">", "true", "<", "/", "showWarnings", ">", "<", "/", "configuration", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "<", "dependencies", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "sun", ".", "jersey", "<", "/", "groupId", ">", "<", "artifactId", ">", "jersey", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "16", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "joda", "-", "time", "<", "/", "groupId", ">", "<", "artifactId", ">", "joda", "-", "time", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "dynatrace", ".", "sdk", "<", "/", "groupId", ">", "<", "artifactId", ">", "server", "-", "rest", "-", "sdk", "<", "/", "artifactId", ">", "<", "version", ">", "7", ".", "0", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "junit", "<", "/", "groupId", ">", "<", "artifactId", ">", "junit", "<", "/", "artifactId", ">", "<", "version", ">", "4", ".", "12", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "hamcrest", "<", "/", "groupId", ">", "<", "artifactId", ">", "hamcrest", "-", "library", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "3", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "mockito", "<", "/", "groupId", ">", "<", "artifactId", ">", "mockito", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", ".", "57", "-", "beta", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "!-", "-", "dependencies", "on", "Jenkins", "Pipeline", "plugin", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "job", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "6", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "cps", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "basic", "-", "steps", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "6", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", "<", "/", "groupId", ">", "<", "artifactId", ">", "symbol", "-", "annotation", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "repositories", ">", "<", "repository", ">", "<", "id", ">", "repo", ".", "jenkins", "-", "ci", ".", "org", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "repo", ".", "jenkins", "-", "ci", ".", "org", "/", "public", "/", "</", "url", ">", "<", "/", "repository", ">", "<", "repository", ">", "<", "id", ">", "local", "-", "repo", "<", "/", "id", ">", "<", "releases", ">", "<", "enabled", ">", "true", "<", "/", "enabled", ">", "<", "checksumPolicy", ">", "ignore", "<", "/", "checksumPolicy", ">", "<", "/", "releases", ">", "<", "snapshots", ">", "<", "enabled", ">", "false", "<", "/", "enabled", ">", "<", "/", "snapshots", ">", "<", "url", ">", "file", ":", "//", "${", "project", ".", "basedir", "}", "/", "repo", "<", "/", "url", ">", "<", "/", "repository", ">", "<", "/", "repositories", ">", "<", "pluginRepositories", ">", "<", "pluginRepository", ">", "<", "id", ">", "repo", ".", "jenkins", "-", "ci", ".", "org", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "repo", ".", "jenkins", "-", "ci", ".", "org", "/", "public", "/", "</", "url", ">", "<", "/", "pluginRepository", ">", "<", "/", "pluginRepositories", ">", "<", "/", "project", ">", "<", "?", "xml", "version", "=", "\"", "1", ".", "0", "\"", "?>", "<", "!-", "-", "Copyright", "(", "c", ")", "2008", "-", "2016", ",", "DYNATRACE", "LLC", "All", "rights", "reserved", ".", "Redistribution", "and", "use", "in", "source", "and", "binary", "forms", ",", "with", "or", "without", "modification", ",", "are", "permitted", "provided", "that", "the", "following", "conditions", "are", "met", ":", "*", "Redistributions", "of", "source", "code", "must", "retain", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", ".", "*", "Redistributions", "in", "binary", "form", "must", "reproduce", "the", "above", "copyright", "notice", ",", "this", "list", "of", "conditions", "and", "the", "following", "disclaimer", "in", "the", "documentation", "and", "/", "or", "other", "materials", "provided", "with", "the", "distribution", ".", "*", "Neither", "the", "name", "of", "the", "dynaTrace", "software", "nor", "the", "names", "of", "its", "contributors", "may", "be", "used", "to", "endorse", "or", "promote", "products", "derived", "from", "this", "software", "without", "specific", "prior", "written", "permission", ".", "THIS", "SOFTWARE", "IS", "PROVIDED", "BY", "THE", "COPYRIGHT", "HOLDERS", "AND", "CONTRIBUTORS", "\"", "AS", "IS", "\"", "AND", "ANY", "EXPRESS", "OR", "IMPLIED", "WARRANTIES", ",", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "THE", "IMPLIED", "WARRANTIES", "OF", "MERCHANTABILITY", "AND", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "ARE", "DISCLAIMED", ".", "IN", "NO", "EVENT", "SHALL", "THE", "COPYRIGHT", "OWNER", "OR", "CONTRIBUTORS", "BE", "LIABLE", "FOR", "ANY", "DIRECT", ",", "INDIRECT", ",", "INCIDENTAL", ",", "SPECIAL", ",", "EXEMPLARY", ",", "OR", "CONSEQUENTIAL", "DAMAGES", "(", "INCLUDING", ",", "BUT", "NOT", "LIMITED", "TO", ",", "PROCUREMENT", "OF", "SUBSTITUTE", "GOODS", "OR", "SERVICES", ";", "LOSS", "OF", "USE", ",", "DATA", ",", "OR", "PROFITS", ";", "OR", "BUSINESS", "INTERRUPTION", ")", "HOWEVER", "CAUSED", "AND", "ON", "ANY", "THEORY", "OF", "LIABILITY", ",", "WHETHER", "IN", "CONTRACT", ",", "STRICT", "LIABILITY", ",", "OR", "TORT", "(", "INCLUDING", "NEGLIGENCE", "OR", "OTHERWISE", ")", "ARISING", "IN", "ANY", "WAY", "OUT", "OF", "THE", "USE", "OF", "THIS", "SOFTWARE", ",", "EVEN", "IF", "ADVISED", "OF", "THE", "POSSIBILITY", "OF", "SUCH", "DAMAGE", ".", "-", "->", "<", "project", "xmlns", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "\"", "xmlns", ":", "xsi", "=", "\"", "http", ":", "//", "www", ".", "w3", ".", "org", "/", "2001", "/", "XMLSchema", "-", "instance", "\"", "xsi", ":", "schemaLocation", "=", "\"", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "POM", "/", "4", ".", "0", ".", "0", "http", ":", "//", "maven", ".", "apache", ".", "org", "/", "maven", "-", "v4_0_0", ".", "xsd", "\"", ">", "<", "modelVersion", ">", "4", ".", "0", ".", "0", "<", "/", "modelVersion", ">", "<", "parent", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "8", "<", "/", "version", ">", "<!", "--", "which", "version", "of", "Jenkins", "is", "this", "plugin", "built", "against", "?", "-", "->", "<", "/", "parent", ">", "<", "artifactId", ">", "dynatrace", "-", "dashboard", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "1", ".", "4", "-", "SNAPSHOT", "<", "/", "version", ">", "<", "packaging", ">", "hpi", "<", "/", "packaging", ">", "<", "name", ">", "Dynatrace", "Application", "Monitoring", "Plugin", "<", "/", "name", ">", "<", "url", ">", "https", ":", "//", "wiki", ".", "jenkins", "-", "ci", ".", "org", "/", "display", "/", "JENKINS", "/", "Dynatrace", "+", "Plugin", "<", "/", "url", ">", "<", "scm", ">", "<", "connection", ">", "scm", ":", "git", ":", "ssh", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", ".", "git", "<", "/", "connection", ">", "<", "developerConnection", ">", "scm", ":", "git", ":", "ssh", ":", "//", "git", "@", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", ".", "git", "<", "/", "developerConnection", ">", "<", "url", ">", "https", ":", "//", "github", ".", "com", "/", "jenkinsci", "/", "dynatrace", "-", "plugin", "<", "/", "url", ">", "<", "tag", ">", "HEAD", "<", "/", "tag", ">", "<", "/", "scm", ">", "<", "developers", ">", "<", "developer", ">", "<", "id", ">", "dynatrace", "<", "/", "id", ">", "<", "name", ">", "Dynatrace", "Development", "Team", "<", "/", "name", ">", "<", "email", ">", "Jenkins", ".", "Plugin", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "developer", ">", "<", "id", ">", "dariusz", ".", "glugla", "<", "/", "id", ">", "<", "name", ">", "Dariusz", "Glugla", "<", "/", "name", ">", "<", "email", ">", "dariusz", ".", "glugla", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "developer", ">", "<", "id", ">", "piotr", ".", "lugowski", "<", "/", "id", ">", "<", "name", ">", "Piotr", "Lugowski", "<", "/", "name", ">", "<", "email", ">", "piotr", ".", "lugowski", "@", "dynatrace", ".", "com", "<", "/", "email", ">", "<", "/", "developer", ">", "<", "/", "developers", ">", "<", "properties", ">", "<", "project", ".", "build", ".", "sourceEncoding", ">", "UTF", "-", "8", "<", "/", "project", ".", "build", ".", "sourceEncoding", ">", "<", "jenkins", ".", "version", ">", "2", ".", "0", "<", "/", "jenkins", ".", "version", ">", "<", "checkstyle", ".", "skip", ">", "true", "<", "/", "checkstyle", ".", "skip", ">", "<", "findbugs", ".", "skip", ">", "true", "<", "/", "findbugs", ".", "skip", ">", "<", "argLine", "/", ">", "<", "java", ".", "level", ">", "8", "<", "/", "java", ".", "level", ">", "<", "/", "properties", ">", "<", "build", ">", "<", "plugins", ">", "<", "plugin", ">", "<", "artifactId", ">", "maven", "-", "clean", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "0", ".", "0", "<", "/", "version", ">", "<", "/", "plugin", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "apache", ".", "maven", ".", "plugins", "<", "/", "groupId", ">", "<", "artifactId", ">", "maven", "-", "compiler", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "5", ".", "1", "<", "/", "version", ">", "<", "configuration", ">", "<", "source", ">", "8", "<", "/", "source", ">", "<", "target", ">", "8", "<", "/", "target", ">", "<", "showWarnings", ">", "true", "<", "/", "showWarnings", ">", "<", "/", "configuration", ">", "<", "/", "plugin", ">", "<", "plugin", ">", "<", "groupId", ">", "org", ".", "codehaus", ".", "mojo", "<", "/", "groupId", ">", "<", "artifactId", ">", "findbugs", "-", "maven", "-", "plugin", "<", "/", "artifactId", ">", "<", "version", ">", "3", ".", "0", ".", "5", "<", "/", "version", ">", "<", "/", "plugin", ">", "<", "/", "plugins", ">", "<", "/", "build", ">", "<", "dependencies", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "sun", ".", "jersey", "<", "/", "groupId", ">", "<", "artifactId", ">", "jersey", "-", "client", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "16", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "joda", "-", "time", "<", "/", "groupId", ">", "<", "artifactId", ">", "joda", "-", "time", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "com", ".", "dynatrace", ".", "sdk", "<", "/", "groupId", ">", "<", "artifactId", ">", "server", "-", "rest", "-", "sdk", "<", "/", "artifactId", ">", "<", "version", ">", "7", ".", "0", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "junit", "<", "/", "groupId", ">", "<", "artifactId", ">", "junit", "<", "/", "artifactId", ">", "<", "version", ">", "4", ".", "12", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "hamcrest", "<", "/", "groupId", ">", "<", "artifactId", ">", "hamcrest", "-", "library", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "3", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "mockito", "<", "/", "groupId", ">", "<", "artifactId", ">", "mockito", "-", "core", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", ".", "57", "-", "beta", "<", "/", "version", ">", "<", "scope", ">", "test", "<", "/", "scope", ">", "<", "/", "dependency", ">", "<", "!-", "-", "dependencies", "on", "Jenkins", "Pipeline", "plugin", "-", "->", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "job", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "6", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "cps", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "0", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", ".", "plugins", ".", "workflow", "<", "/", "groupId", ">", "<", "artifactId", ">", "workflow", "-", "basic", "-", "steps", "<", "/", "artifactId", ">", "<", "version", ">", "2", ".", "6", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "dependency", ">", "<", "groupId", ">", "org", ".", "jenkins", "-", "ci", "<", "/", "groupId", ">", "<", "artifactId", ">", "symbol", "-", "annotation", "<", "/", "artifactId", ">", "<", "version", ">", "1", ".", "1", "<", "/", "version", ">", "<", "/", "dependency", ">", "<", "/", "dependencies", ">", "<", "repositories", ">", "<", "repository", ">", "<", "id", ">", "repo", ".", "jenkins", "-", "ci", ".", "org", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "repo", ".", "jenkins", "-", "ci", ".", "org", "/", "public", "/", "</", "url", ">", "<", "/", "repository", ">", "<", "repository", ">", "<", "id", ">", "local", "-", "repo", "<", "/", "id", ">", "<", "releases", ">", "<", "enabled", ">", "true", "<", "/", "enabled", ">", "<", "checksumPolicy", ">", "ignore", "<", "/", "checksumPolicy", ">", "<", "/", "releases", ">", "<", "snapshots", ">", "<", "enabled", ">", "false", "<", "/", "enabled", ">", "<", "/", "snapshots", ">", "<", "url", ">", "file", ":", "//", "${", "project", ".", "basedir", "}", "/", "repo", "<", "/", "url", ">", "<", "/", "repository", ">", "<", "/", "repositories", ">", "<", "pluginRepositories", ">", "<", "pluginRepository", ">", "<", "id", ">", "repo", ".", "jenkins", "-", "ci", ".", "org", "<", "/", "id", ">", "<", "url", ">", "http", ":", "//", "repo", ".", "jenkins", "-", "ci", ".", "org", "/", "public", "/", "</", "url", ">", "<", "/", "pluginRepository", ">", "<", "/", "pluginRepositories", ">", "<", "/", "project", ">", "@", "@", "-", "88", ",", "16", "+", "88", ",", "17", "@", "@", "public", "final", "String", "systemProfile", ";", "/", "/", "Test", "run", "attributes", "-", "no", "versionBuild", "attribute", "because", "it", "'", "s", "taken", "from", "the", "build", "object", "public", "String", "versionMajor", ";", "public", "String", "versionMinor", ";", "public", "String", "versionRevision", ";", "public", "String", "versionMilestone", ";", "public", "String", "marker", ";", "public", "Boolean", "recordSession", ";", "private", "String", "versionMajor", ";", "private", "String", "versionMinor", ";", "private", "String", "versionRevision", ";", "private", "String", "versionMilestone", ";", "private", "String", "marker", ";", "private", "Boolean", "recordSession", ";", "/", "**", "*", "@", "deprecated", "use", "{", "@", "link", "#", "TABuildWrapper", "(", "String", "systemProfile", ")", "}", "and", "DataBoundSetters", "instead", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "DeprecatedIsStillUsed", "\"", ")", "private", "TABuildWrapper", "(", "final", "String", "systemProfile", ",", "final", "String", "versionMajor", ",", "final", "String", "versionMinor", ",", "final", "String", "versionRevision", ",", "final", "String", "versionMilestone", ",", "final", "String", "marker", ",", "final", "Boolean", "recordSession", ")", "{", "@", "@", "-", "110", ",", "6", "+", "111", ",", "7", "@", "@", "private", "TABuildWrapper", "(", "final", "String", "systemProfile", ",", "final", "String", "versionMajor", ",", "fi", "this", ".", "recordSession", "=", "recordSession", ";", "}", "@", "SuppressWarnings", "(", "\"", "WeakerAccess", "\"", ")", "@", "DataBoundConstructor", "public", "TABuildWrapper", "(", "String", "systemProfile", ")", "{", "this", "(", "systemProfile", ",", "\"", "\",", "\"", "\",", "\"", "\",", "\"", "\",", "\"", "\",", "false", ")", ";", "@", "@", "-", "145", ",", "6", "+", "147", ",", "7", "@", "@", "public", "void", "setRecordSession", "(", "Boolean", "recordSession", ")", "{", "this", ".", "recordSession", "=", "recordSession", ";", "}", "@", "SuppressWarnings", "(", "\"", "RedundantThrows", "\"", ")", "@", "Override", "public", "void", "setUp", "(", "Context", "context", ",", "Run", "<", "?,", "?", ">", "build", ",", "FilePath", "workspace", ",", "Launcher", "launcher", ",", "TaskListener", "listener", ",", "EnvVars", "initialEnvironment", ")", "throws", "IOException", ",", "InterruptedException", "{", "Sessions", "sessions", "=", "new", "Sessions", "(", "Utils", ".", "createClient", "(", "))", ";", "@", "@", "-", "204", ",", "8", "+", "207", ",", "8", "@", "@", "private", "void", "setupBuildVariables", "(", "Run", "<", "?,", "?>", "build", ",", "String", "serverUrl", ")", "{", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "globalConfig", ".", "username", ")", ")", "{", "parameters", ".", "add", "(", "new", "StringParameterValue", "(", "BuildVarKeys", ".", "BUILD_VAR_KEY_GLOBAL_USERNAME", ",", "globalConfig", ".", "username", ")", ");", "}", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "globalConfig", ".", "password", ")", ")", "{", "parameters", ".", "add", "(", "new", "PasswordParameterValue", "(", "BuildVarKeys", ".", "BUILD_VAR_KEY_GLOBAL_PASSWORD", ",", "globalConfig", ".", "password", ")", ");", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "globalConfig", ".", "password", ".", "getPlainText", "(", "))", ")", "{", "parameters", ".", "add", "(", "new", "PasswordParameterValue", "(", "BuildVarKeys", ".", "BUILD_VAR_KEY_GLOBAL_PASSWORD", ",", "globalConfig", ".", "password", ".", "getPlainText", "(", "))", ");", "}", "}", "Utils", ".", "updateBuildVariables", "(", "build", ",", "parameters", ")", ";", "@", "@", "-", "235", ",", "9", "+", "238", ",", "8", "@", "@", "public", "boolean", "isApplicable", "(", "AbstractProject", "<", "?,", "?", ">", "abstractProject", ")", "{", "public", "FormValidation", "doCheckSystemProfile", "(", "@", "QueryParameter", "final", "String", "systemProfile", ")", "{", "if", "(", "StringUtils", ".", "isNotBlank", "(", "systemProfile", ")", ")", "{", "return", "FormValidation", ".", "ok", "(", ");", "}", "else", "{", "return", "FormValidation", ".", "error", "(", "Messages", ".", "RECORDER_VALIDATION_BLANK_SYSTEM_PROFILE", "(", "))", ";", "}", "return", "FormValidation", ".", "error", "(", "Messages", ".", "RECORDER_VALIDATION_BLANK_SYSTEM_PROFILE", "(", "))", ";", "}", "public", "FormValidation", "doTestDynatraceConnection", "(", "@", "QueryParameter", "final", "String", "systemProfile", ")", "{", "@", "@", "-", "297", ",", "6", "+", "299", ",", "7", "@", "@", "private", "String", "storeSession", "(", "final", "PrintStream", "logger", ",", "Sessions", "sessions", ")", "throws", "return", "sessionName", ";", "}", "@", "SuppressWarnings", "(", "\"", "RedundantThrows", "\"", ")", "@", "Override", "public", "void", "tearDown", "(", "Run", "<", "?,", "?", ">", "build", ",", "FilePath", "workspace", ",", "Launcher", "launcher", ",", "TaskListener", "listener", ")", "throws", "IOException", ",", "InterruptedException", "{", "PrintStream", "logger", "=", "listener", ".", "getLogger", "(", ");", "@", "@", "-", "37", ",", "12", "+", "37", ",", "14", "@", "@", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "util", ".", "FormValidation", ";", "import", "hudson", ".", "util", ".", "ListBoxModel", ";", "import", "hudson", ".", "util", ".", "Secret", ";", "import", "jenkins", ".", "model", ".", "GlobalConfiguration", ";", "import", "net", ".", "sf", ".", "json", ".", "JSONObject", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "exception", ".", "ExceptionUtils", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "interceptor", ".", "RequirePOST", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLHandshakeException", ";", "@", "@", "-", "51", ",", "6", "+", "53", ",", "7", "@", "@", "/", "**", "*", "Created", "by", "krzysztof", ".", "necel", "on", "2016", "-", "02", "-", "10", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "WeakerAccess", "\"", ")", "@", "Extension", "public", "class", "TAGlobalConfiguration", "extends", "GlobalConfiguration", "{", "@", "@", "-", "62", ",", "18", "+", "65", ",", "20", "@", "@", "private", "static", "final", "int", "DEFAULT_DELAY", "=", "0", ";", "/", "/", "seconds", "private", "static", "final", "int", "DEFAULT_RETRY_COUNT", "=", "3", ";", "private", "static", "final", "boolean", "DEFAULT_VALIDATE_CERTS", "=", "true", ";", "private", "static", "final", "String", "JSON_OBJECT_NAME", "=", "\"", "dynatrace", "-", "test", "-", "automation", "\"", ";", "/", "/", "section", "name", "from", "config", ".", "jelly", "public", "String", "protocol", "=", "getDefaultProtocol", "(", ");", "public", "String", "host", "=", "getDefaultHost", "(", ");", "public", "Integer", "port", "=", "getDefaultPort", "(", ");", "public", "String", "username", "=", "getDefaultUsername", "(", ");", "public", "String", "password", "=", "getDefaultPassword", "(", ");", "public", "Secret", "password", "=", "getDefaultPassword", "(", ");", "public", "Integer", "delay", "=", "getDefaultDelay", "(", ");", "/", "/", "time", "to", "wait", "before", "trying", "to", "get", "data", "from", "the", "DT", "server", "in", "seconds", "public", "Integer", "retryCount", "=", "getDefaultRetryCount", "(", ");", "public", "Boolean", "validateCerts", "=", "getDefaultValidateCerts", "(", ");", "public", "TAGlobalConfiguration", "(", ")", "{", "load", "(", ");", "/", "/", "KN", ":", "load", "config", "from", "XML", "file", "on", "startup", "/", "/", "load", "config", "from", "XML", "file", "on", "startup", "load", "(", ");", "}", "public", "static", "String", "getDefaultProtocol", "(", ")", "{", "@", "@", "-", "92", ",", "7", "+", "97", ",", "7", "@", "@", "public", "static", "String", "getDefaultUsername", "(", ")", "{", "return", "DEFAULT_USERNAME", ";", "}", "public", "static", "String", "getDefaultPassword", "(", ")", "{", "return", "DEFAULT_PASSWORD", ";", "}", "public", "static", "Secret", "getDefaultPassword", "(", ")", "{", "return", "Secret", ".", "fromString", "(", "DEFAULT_PASSWORD", ")", ";", "}", "public", "static", "int", "getDefaultDelay", "(", ")", "{", "return", "DEFAULT_DELAY", ";", "@", "@", "-", "106", ",", "9", "+", "111", ",", "10", "@", "@", "public", "static", "boolean", "getDefaultValidateCerts", "(", ")", "{", "return", "DEFAULT_VALIDATE_CERTS", ";", "}", "@", "SuppressWarnings", "(", "\"", "RedundantThrows", "\"", ")", "@", "Override", "public", "boolean", "configure", "(", "StaplerRequest", "req", ",", "JSONObject", "json", ")", "throws", "FormException", "{", "req", ".", "bindJSON", "(", "this", ",", "json", ".", "getJSONObject", "(", "\"", "dynatrace", "-", "test", "-", "automation", "\"", "))", ";", "/", "/", "KN", ":", "section", "name", "from", "config", ".", "jelly", "req", ".", "bindJSON", "(", "this", ",", "json", ".", "getJSONObject", "(", "JSON_OBJECT_NAME", ")", ");", "save", "(", ");", "return", "true", ";", "}", "@", "@", "-", "155", ",", "6", "+", "161", ",", "7", "@", "@", "public", "FormValidation", "doCheckDelay", "(", "@", "QueryParameter", "final", "String", "delay", ")", "{", "return", "FormValidation", ".", "ok", "(", ");", "}", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "/", "/", "ignore", "exception", ",", "covered", "by", "fallback", "error", "}", "return", "FormValidation", ".", "error", "(", "Messages", ".", "RECORDER_VALIDATION_DELAY_NAN", "(", "))", ";", "}", "@", "@", "-", "166", ",", "10", "+", "173", ",", "12", "@", "@", "public", "FormValidation", "doCheckRetryCount", "(", "@", "QueryParameter", "final", "String", "retryCount", ")", "return", "FormValidation", ".", "ok", "(", ");", "}", "}", "catch", "(", "NumberFormatException", "e", ")", "{", "/", "/", "ignore", "exception", ",", "covered", "by", "fallback", "error", "}", "return", "FormValidation", ".", "error", "(", "Messages", ".", "RECORDER_VALIDATION_RETRY_COUNT_NAN", "(", "))", ";", "}", "@", "RequirePOST", "public", "FormValidation", "doTestDynatraceConnection", "(", "@", "QueryParameter", "(", "\"", "protocol", "\"", ")", "final", "String", "protocol", ",", "@", "QueryParameter", "(", "\"", "host", "\"", ")", "final", "String", "host", ",", "@", "@", "-", "132", ",", "10", "+", "132", ",", "6", "@", "@", "private", "void", "addPreviousBuildReport", "(", ")", "{", "previousReport", "=", "prevBuildAction", ".", "getCurrentReport", "(", ");", "}", "/", "**", "*", "Custom", "message", "format", "method", ".", "Used", "in", "jelly", "script", "to", "be", "able", "to", "resolve", "externalized", "strings", "only", "once", "per", "request", ".", "*", "It", "significantly", "improves", "performance", "in", "old", "Jenkins", "versions", "but", "code", "is", "a", "bit", "less", "clear", ".", "*", "/", "public", "static", "String", "formatMessage", "(", "String", "pattern", ",", "Object", "argument", ")", "{", "return", "MessageFormat", ".", "format", "(", "pattern", ",", "argument", ")", ";", "}", "@", "@", "-", "62", ",", "7", "+", "62", ",", "7", "@", "@", "*", "Created", "by", "krzysztof", ".", "necel", "on", "2016", "-", "02", "-", "05", ".", "*", "@", "author", "piotr", ".", "lugowski", "*", "/", "public", "class", "TAReportingProjectAction", "implements", "Action", "{", "public", "class", "TAReportingProjectAction", "implements", "Action", "{", "private", "static", "final", "String", "URL_NAME", "=", "\"", "dynatrace", "-", "test", "-", "result", "-", "trend", "\"", ";", "@", "@", "-", "75", ",", "9", "+", "75", ",", "9", "@", "@", "private", "static", "final", "Color", "COLOR_IMPROVED", "=", "new", "Color", "(", "0x00a6fb", ")", ";", "private", "static", "final", "Color", "COLOR_VOLATILE", "=", "new", "Color", "(", "0xffe11c", ")", ";", "private", "abstract", "class", "GraphImpl", "extends", "Graph", "{", "private", "abstract", "static", "class", "GraphImpl", "extends", "Graph", "{", "protected", "GraphImpl", "(", ")", "{", "GraphImpl", "(", ")", "{", "super", "(", "-", "1", ",", "500", ",", "300", ")", ";", "/", "/", "cannot", "use", "timestamp", ",", "since", "ranges", "may", "change", "}", "@", "@", "-", "114", ",", "7", "+", "114", ",", "7", "@", "@", "protected", "JFreeChart", "createGraph", "(", ")", "{", "categoryaxis", ".", "setCategoryMargin", "(", "0", ".", "0D", ")", ";", "categoryaxis", ".", "setCategoryLabelPositions", "(", "CategoryLabelPositions", ".", "UP_90", ")", ";", "/", "/", "KN", ":", "force", "the", "chart", "axis", "to", "have", "only", "integer", "values", "/", "/", "force", "the", "chart", "axis", "to", "have", "only", "integer", "values", "plot", ".", "getRangeAxis", "(", ").", "setStandardTickUnits", "(", "NumberAxis", ".", "createIntegerTickUnits", "(", "))", ";", "return", "chart", ";", "@", "@", "-", "123", ",", "6", "+", "123", ",", "7", "@", "@", "protected", "JFreeChart", "createGraph", "(", ")", "{", "private", "final", "Job", "<", "?,", "?", ">", "project", ";", "@", "SuppressWarnings", "(", "\"", "WeakerAccess", "\"", ")", "public", "TAReportingProjectAction", "(", "Job", "<", "?,", "?>", "project", ")", "{", "this", ".", "project", "=", "project", ";", "}", "@", "@", "-", "148", ",", "14", "+", "149", ",", "18", "@", "@", "public", "String", "getUrlName", "(", ")", "{", "/", "**", "*", "Generates", "graph", "with", "the", "number", "of", "tests", "executed", "in", "each", "category", "for", "{", "@", "link", "#", "MAX_BUILD_NUMBER_TO_SHOW_ON_CHART", "}", "latest", "builds", ".", "*", "*", "@", "param", "request", "request", "sent", "to", "generate", "the", "graph", "*", "@", "param", "response", "response", "to", "modify", "(", "if", "needed", ")", "*", "@", "throws", "IOException", "when", "PNG", "file", "creation", "was", "not", "possible", "*", "/", "public", "void", "doSummarizerGraph", "(", "final", "StaplerRequest", "request", ",", "final", "StaplerResponse", "response", ")", "throws", "IOException", "{", "final", "Map", "<", "ChartUtil", ".", "NumberOnlyBuildLabel", ",", "Map", "<", "TestStatus", ",", "Integer", ">", ">", "summaries", "=", "new", "TreeMap", "<", ">(", ");", "List", "<", "TAReport", ">", "reports", "=", "getExistingReportsList", "(", "MAX_BUILD_NUMBER_TO_SHOW_ON_CHART", ")", ";", "for", "(", "TAReport", "report", ":", "reports", ")", "{", "Map", "<", "TestStatus", ",", "Integer", ">", "summary", "=", "report", ".", "getSummary", "(", ");", "summaries", ".", "put", "(", "new", "ChartUtil", ".", "NumberOnlyBuildLabel", "(", "(", "Run", "<", "?,", "?", ">)", "report", ".", "getBuild", "(", "))", ",", "summary", ")", ";", "summaries", ".", "put", "(", "new", "ChartUtil", ".", "NumberOnlyBuildLabel", "(", "report", ".", "getBuild", "(", "))", ",", "summary", ")", ";", "}", "final", "Graph", "graph", "=", "new", "GraphImpl", "(", ")", "{", "@", "@", "-", "200", ",", "7", "+", "205", ",", "8", "@", "@", "protected", "CategoryDataset", "createDataSet", "(", ")", "{", "if", "(", "buildAction", "!", "=", "null", ")", "{", "report", "=", "buildAction", ".", "getCurrentReport", "(", ");", "}", "else", "{", "/", "/", "KN", ":", "FOR", "BACKWARD", "COMPATIBILITY", "}", "else", "{", "/", "/", "backward", "compatibility", "report", "=", "UtilsCompat", ".", "getCompatReport", "(", "currentBuild", ")", ";", "}", "@", "@", "-", "50", ",", "11", "+", "50", ",", "6", "@", "@", "private", "static", "AbstractBuild", "<", "?,", "?", ">", "currentBuild", "=", "null", ";", "private", "TestAutomationReport", "currentReport", ";", "/", "**", "*", "Parses", "the", "reports", "and", "build", "a", "{", "@", "link", "TestAutomationBuildActionResultsDisplay", "}", ".", "*", "*", "@", "throws", "java", ".", "io", ".", "IOException", "If", "a", "report", "fails", "to", "parse", ".", "*", "/", "public", "TestAutomationBuildActionResultsDisplay", "(", "final", "TestAutomationBuildAction", "buildAction", ",", "TaskListener", "listener", ")", "throws", "IOException", "{", "this", ".", "buildAction", "=", "buildAction", ";", "@", "@", "-", "35", ",", "6", "+", "35", ",", "8", "@", "@", "import", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "BasicServerConfiguration", ";", "import", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "DynatraceClient", ";", "import", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestRuns", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "ImmutableList", ";", "import", "hudson", ".", "model", ".", "Run", ";", "import", "hudson", ".", "model", ".", "ParameterValue", ";", "import", "hudson", ".", "model", ".", "Result", ";", "@", "@", "-", "49", ",", "7", "+", "51", ",", "7", "@", "@", "*", "Created", "by", "krzysztof", ".", "necel", "on", "2016", "-", "01", "-", "25", ".", "*", "/", "public", "final", "class", "Utils", "{", "public", "static", "final", "String", "TEST_MEASURE_UNIT_DEFAULT", "=", "\"", "num", "\"", ";", "private", "static", "final", "String", "TEST_MEASURE_UNIT_DEFAULT", "=", "\"", "num", "\"", ";", "public", "static", "final", "String", "DYNATRACE_ICON_24_X_24_FILEPATH", "=", "\"", "/", "plugin", "/", "dynatrace", "-", "dashboard", "/", "images", "/", "dynatrace_icon_24x24", ".", "png", "\"", ";", "public", "static", "final", "String", "DYNATRACE_ICON_48_X_48_FILEPATH", "=", "\"", "/", "plugin", "/", "dynatrace", "-", "dashboard", "/", "images", "/", "dynatrace_icon_48x48", ".", "png", "\"", ";", "@", "@", "-", "63", ",", "7", "+", "65", ",", "7", "@", "@", "public", "static", "DynatraceClient", "createClient", "(", ")", "{", "final", "TAGlobalConfiguration", "globalConfig", "=", "GlobalConfiguration", ".", "all", "(", ").", "get", "(", "TAGlobalConfiguration", ".", "class", ")", ";", "if", "(", "globalConfig", "!", "=", "null", ")", "{", "BasicServerConfiguration", "config", "=", "new", "BasicServerConfiguration", "(", "globalConfig", ".", "username", ",", "globalConfig", ".", "password", ",", "globalConfig", ".", "password", ".", "getPlainText", "(", "),", "globalConfig", ".", "protocol", ".", "startsWith", "(", "\"", "https", "\"", "),", "globalConfig", ".", "host", ",", "globalConfig", ".", "port", ",", "@", "@", "-", "99", ",", "15", "+", "101", ",", "15", "@", "@", "public", "static", "TestRun", "convertTestRun", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "mod", "return", "new", "TestRun", "(", "testResults", ",", "testRunSummary", ",", "sdkTestRun", ".", "getId", "(", "),", "convertTestCategory", "(", "sdkTestRun", ".", "getCategory", "(", "))", ");", "}", "public", "static", "TestResult", "convertTestResult", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestResult", "sdkTestResult", ")", "{", "private", "static", "TestResult", "convertTestResult", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestResult", "sdkTestResult", ")", "{", "Set", "<", "TestMeasure", ">", "measures", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestMeasure", "sdkMeasure", ":", "sdkTestResult", ".", "getMeasures", "(", "))", "{", "measures", ".", "add", "(", "convertTestMeasure", "(", "sdkMeasure", ")", ");", "}", "return", "new", "TestResult", "(", "sdkTestResult", ".", "getExecutionTime", "(", "),", "sdkTestResult", ".", "getName", "(", "),", "sdkTestResult", ".", "getPackageName", "(", "),", "sdkTestResult", ".", "getPlatform", "(", "),", "convertTestStatus", "(", "sdkTestResult", ".", "getStatus", "(", "))", ",", "measures", ")", ";", "}", "public", "static", "TestMeasure", "convertTestMeasure", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestMeasure", "sdkTestMeasure", ")", "{", "private", "static", "TestMeasure", "convertTestMeasure", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestMeasure", "sdkTestMeasure", ")", "{", "String", "unit", "=", "sdkTestMeasure", ".", "getUnit", "(", ")", "!", "=", "null", "?", "sdkTestMeasure", ".", "getUnit", "(", ")", ":", "TEST_MEASURE_UNIT_DEFAULT", ";", "return", "new", "TestMeasure", "(", "sdkTestMeasure", ".", "getName", "(", "),", "sdkTestMeasure", ".", "getMetricGroup", "(", "),", "@", "@", "-", "118", ",", "7", "+", "120", ",", "7", "@", "@", "public", "static", "TestMeasure", "convertTestMeasure", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautoma", "sdkTestMeasure", ".", "getViolationPercentage", "(", "))", ";", "}", "public", "static", "TestCategory", "convertTestCategory", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestCategory", "sdkTestCategory", ")", "{", "private", "static", "TestCategory", "convertTestCategory", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestCategory", "sdkTestCategory", ")", "{", "switch", "(", "sdkTestCategory", ")", "{", "case", "UNIT", ":", "return", "TestCategory", ".", "UNIT", ";", "@", "@", "-", "132", ",", "7", "+", "134", ",", "7", "@", "@", "public", "static", "TestCategory", "convertTestCategory", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testauto", "throw", "new", "IllegalArgumentException", "(", "\"", "Could", "not", "convert", "TestCategory", "\"", ");", "}", "public", "static", "TestStatus", "convertTestStatus", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestStatus", "sdkTestStatus", ")", "{", "private", "static", "TestStatus", "convertTestStatus", "(", "com", ".", "dynatrace", ".", "sdk", ".", "server", ".", "testautomation", ".", "models", ".", "TestStatus", "sdkTestStatus", ")", "{", "return", "TestStatus", ".", "valueOf", "(", "sdkTestStatus", ".", "name", "(", "))", ";", "}", "@", "@", "-", "158", ",", "6", "+", "160", ",", "7", "@", "@", "public", "static", "String", "formatDoublePercentage", "(", "Double", "d", ")", "{", "return", "d", "=", "=", "null", "?", "FORMAT_DOUBLE_NULL_VALUE", ":", "DECIMAL_FORMAT", ".", "format", "(", "d", "*", "100", ")", ";", "}", "@", "SuppressWarnings", "(", "\"", "BooleanMethodIsAlwaysInverted", "\"", ")", "public", "static", "boolean", "isValidBuild", "(", "Run", "build", ",", "PrintStream", "logger", ",", "String", "message", ")", "{", "if", "(", "build", ".", "getResult", "(", ")", "=", "=", "Result", ".", "ABORTED", ")", "{", "logger", ".", "println", "(", "\"", "Build", "has", "been", "aborted", "-", "\"", "+", "message", ")", ";", "@", "@", "-", "181", ",", "6", "+", "184", ",", "6", "@", "@", "public", "static", "void", "updateBuildVariables", "(", "Run", "<", "?,", "?", ">", "build", ",", "List", "<", "ParameterValue", ">", "pa", "}", "public", "static", "void", "updateBuildVariable", "(", "Run", "<", "?,", "?", ">", "build", ",", "String", "key", ",", "String", "value", ")", "{", "updateBuildVariables", "(", "build", ",", "Collections", ".", "<", "ParameterValue", ">", "singletonList", "(", "new", "StringParameterValue", "(", "key", ",", "value", ")", "))", ";", "updateBuildVariables", "(", "build", ",", "ImmutableList", ".", "of", "(", "new", "StringParameterValue", "(", "key", ",", "value", ")", "))", ";", "}", "}"], "docstring_tokens": ["initiate", "a", "connection", "test", "to", "an", "attacker-specified", "server", "with", "attacker-specified", "username", "and", "password"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1985", ",", "20", "+", "1985", ",", "14", "@", "@", "unsigned", "long", "do_brk", "(", "unsigned", "long", "addr", ",", "unsigned", "long", "len", ")", "if", "(", "!", "len", ")", "return", "addr", ";", "if", "(", "(", "addr", "+", "len", ")", ">", "TASK_SIZE", "|", "|", "(", "addr", "+", "len", ")", "<", "addr", ")", "return", "-", "EINVAL", ";", "if", "(", "is_hugepage_only_range", "(", "mm", ",", "addr", ",", "len", ")", ")", "return", "-", "EINVAL", ";", "error", "=", "security_file_mmap", "(", "NULL", ",", "0", ",", "0", ",", "0", ",", "addr", ",", "1", ")", ";", "if", "(", "error", ")", "return", "error", ";", "flags", "=", "VM_DATA_DEFAULT_FLAGS", "|", "VM_ACCOUNT", "|", "mm", "-", ">", "def_flags", ";", "error", "=", "arch_mmap_check", "(", "addr", ",", "len", ",", "flags", ")", ";", "if", "(", "error", ")", "error", "=", "get_unmapped_area", "(", "NULL", ",", "addr", ",", "len", ",", "0", ",", "MAP_FIXED", ")", ";", "if", "(", "error", "&", "~", "PAGE_MASK", ")", "return", "error", ";", "/", "*"], "docstring_tokens": ["gain", "privileges", "or", "cause", "a", "denial", "of", "service", "(panic", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "148", ",", "12", "+", "148", ",", "12", "@", "@", "static", "noinline", "void", "key_gc_unused_keys", "(", "struct", "list_head", "*", "keys", ")", "if", "(", "test_bit", "(", "KEY_FLAG_INSTANTIATED", ",", "&", "key", "-", ">", "flags", ")", ")", "atomic_dec", "(", "&", "key", "-", ">", "user", "-", ">", "nikeys", ")", ";", "key_user_put", "(", "key", "-", ">", "user", ")", ";", "/", "*", "now", "throw", "away", "the", "key", "memory", "*", "/", "if", "(", "key", "-", ">", "type", "-", ">", "destroy", ")", "key", "-", ">", "type", "-", ">", "destroy", "(", "key", ")", ";", "key_user_put", "(", "key", "-", ">", "user", ")", ";", "kfree", "(", "key", "-", ">", "description", ")", ";", "#", "ifdef", "KEY_DEBUGGING"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "corruption", "or", "panic", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1063", ",", "7", "+", "1063", ",", "7", "@", "@", "static", "int", "mp_wait_modem_status", "(", "struct", "sb_uart_state", "*", "state", ",", "unsigned", "long", "arg", ")", "static", "int", "mp_get_count", "(", "struct", "sb_uart_state", "*", "state", ",", "struct", "serial_icounter_struct", "*", "icnt", ")", "{", "struct", "serial_icounter_struct", "icount", ";", "struct", "serial_icounter_struct", "icount", "=", "{", "};", "struct", "sb_uart_icount", "cnow", ";", "struct", "sb_uart_port", "*", "port", "=", "state", "-", ">", "port", ";"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "stack", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "151", ",", "13", "+", "151", ",", "19", "@", "@", "static", "long", "ec_device_ioctl_xcmd", "(", "struct", "cros_ec_dev", "*", "ec", ",", "void", "__user", "*", "arg", ")", "goto", "exit", ";", "}", "if", "(", "u_cmd", ".", "outsize", "!", "=", "s_cmd", "-", ">", "outsize", "|", "|", "u_cmd", ".", "insize", "!", "=", "s_cmd", "-", ">", "insize", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "exit", ";", "}", "s_cmd", "-", ">", "command", "+", "=", "ec", "-", ">", "cmd_offset", ";", "ret", "=", "cros_ec_cmd_xfer", "(", "ec", "-", ">", "ec_dev", ",", "s_cmd", ")", ";", "/", "*", "Only", "copy", "data", "to", "userland", "if", "data", "was", "received", ".", "*", "/", "if", "(", "ret", "<", "0", ")", "goto", "exit", ";", "if", "(", "copy_to_user", "(", "arg", ",", "s_cmd", ",", "sizeof", "(", "*", "s_cmd", ")", "+", "u_cmd", ".", "insize", ")", ")", "if", "(", "copy_to_user", "(", "arg", ",", "s_cmd", ",", "sizeof", "(", "*", "s_cmd", ")", "+", "s_cmd", "-", ">", "insize", ")", ")", "ret", "=", "-", "EFAULT", ";", "exit", ":", "kfree", "(", "s_cmd", ")", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "32", ",", "12", "+", "32", ",", "12", "@", "@", "private", "static", "final", "List", "<", "String", ">", "TO_REPLACE", "=", "Arrays", ".", "asList", "(", "\"", "_", "\"", ",", "\"", "%\"", ");", "char", "value", ";", "char", "escapeCharacter", ";", "/", "**", "*", "Escapes", "all", "special", "like", "characters", "(", "{@", "code", "_", "}", ",", "{", "@", "code", "%", "})", "using", "the", "configured", "escape", "character", ".", "*", "*", "@", "param", "value", "May", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "param", "value", "may", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "/", "public", "String", "escape", "(", "String", "value", ")", "{", "@", "@", "-", "49", ",", "18", "+", "49", ",", "9", "@", "@", "public", "String", "escape", "(", "String", "value", ")", "{", "String", "result", "=", "value", ";", "for", "(", "String", "toReplace", ":", "TO_REPLACE", ")", "{", "result", "=", "result", ".", "replace", "(", "toReplace", ",", "value", "+", "toReplace", ")", ";", "result", "=", "result", ".", "replace", "(", "toReplace", ",", "escapeCharacter", "+", "toReplace", ")", ";", "}", "return", "result", ";", "}", "/", "**", "*", "Makes", "the", "underlying", "character", "available", ".", "*", "*", "@", "return", "the", "value", "*", "/", "public", "char", "escapeCharacter", "(", ")", "{", "return", "value", ";", "}", "}", "@", "@", "-", "291", ",", "7", "+", "291", ",", "7", "@", "@", "public", "Predicate", "build", "(", ")", "{", "Expression", "<", "String", ">", "stringPath", "=", "getTypedPath", "(", "root", ",", "part", ")", ";", "Expression", "<", "String", ">", "propertyExpression", "=", "upperIfIgnoreCase", "(", "stringPath", ")", ";", "Expression", "<", "String", ">", "parameterExpression", "=", "upperIfIgnoreCase", "(", "provider", ".", "next", "(", "part", ",", "String", ".", "class", ")", ".", "getExpression", "(", "))", ";", "Predicate", "like", "=", "builder", ".", "like", "(", "propertyExpression", ",", "parameterExpression", ",", "escape", ".", "getValue", "(", "))", ";", "Predicate", "like", "=", "builder", ".", "like", "(", "propertyExpression", ",", "parameterExpression", ",", "escape", ".", "getEscapeCharacter", "(", "))", ";", "return", "type", ".", "equals", "(", "NOT_LIKE", ")", "|", "|", "type", ".", "equals", "(", "NOT_CONTAINING", ")", "?", "like", ".", "not", "(", ")", ":", "like", ";", "case", "TRUE", ":", "Expression", "<", "Boolean", ">", "truePath", "=", "getTypedPath", "(", "root", ",", "part", ")", ";", "@", "@", "-", "15", ",", "6", "+", "15", ",", "8", "@", "@", "*", "/", "package", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "support", ";", "import", "lombok", ".", "RequiredArgsConstructor", ";", "import", "org", ".", "springframework", ".", "data", ".", "jpa", ".", "repository", ".", "query", ".", "EscapeCharacter", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "spi", ".", "EvaluationContextExtension", ";", "import", "org", ".", "springframework", ".", "data", ".", "repository", ".", "query", ".", "spi", ".", "EvaluationContextExtensionSupport", ";", "@", "@", "-", "27", ",", "15", "+", "29", ",", "15", "@", "@", "*", "/", "public", "class", "JpaEvaluationContextExtension", "extends", "EvaluationContextExtensionSupport", "{", "private", "final", "EscapeCharacter", "character", ";", "private", "final", "JpaRootObject", "root", ";", "/", "**", "*", "Creates", "a", "new", "{", "@", "link", "JpaEvaluationContextExtension", "}", "for", "the", "given", "escape", "character", ".", "*", "*", "@", "param", "escapeCharacter", "the", "character", "to", "be", "used", "to", "escape", "parameters", "for", "LIKE", "expression", ".", "*", "/", "public", "JpaEvaluationContextExtension", "(", "char", "escapeCharacter", ")", "{", "this", ".", "character", "=", "EscapeCharacter", ".", "of", "(", "escapeCharacter", ")", ";", "this", ".", "root", "=", "JpaRootObject", ".", "of", "(", "EscapeCharacter", ".", "of", "(", "escapeCharacter", ")", ");", "}", "/", "*", "@", "@", "-", "53", ",", "6", "+", "55", ",", "32", "@", "@", "public", "String", "getExtensionId", "(", ")", "{", "*", "/", "@", "Override", "public", "Object", "getRootObject", "(", ")", "{", "return", "character", ";", "return", "root", ";", "}", "@", "RequiredArgsConstructor", "(", "staticName", "=", "\"", "of", "\"", ")", "public", "static", "class", "JpaRootObject", "{", "private", "final", "EscapeCharacter", "character", ";", "/", "**", "*", "Escapes", "the", "given", "source", "{", "@", "link", "String", "}", "for", "LIKE", "expressions", ".", "*", "*", "@", "param", "source", "can", "be", "{", "@", "literal", "null", "}", ".", "*", "@", "return", "*", "@", "see", "EscapeCharacter", "#", "escape", "(", "String", ")", "*", "/", "public", "String", "escape", "(", "String", "source", ")", "{", "return", "character", ".", "escape", "(", "source", ")", ";", "}", "/", "**", "*", "Returns", "the", "escape", "character", "being", "used", "to", "escape", "special", "characters", "for", "LIKE", "expressions", ".", "*", "*", "@", "return", "*", "/", "public", "char", "escapeCharacter", "(", ")", "{", "return", "character", ".", "getEscapeCharacter", "(", ");", "}", "}", "}", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "public", "JpaRepositoryFactoryBean", "(", "Class", "<", "?", "extends", "T", ">", "repositoryInterface", ")", "{", "}", "/", "**", "*", "Configures", "the", "escape", "character", "to", "be", "used", "to", "escape", "reserved", "characters", "for", "LIKE", "expressions", ".", "*", "Configures", "the", "escape", "character", "to", "be", "used", "to", "escape", "reserved", "characters", "in", "LIKE", "expressions", ".", "*", "*", "@", "param", "escapeCharacter", "*", "/"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2374", ",", "4", "+", "2374", ",", "9", "@", "@", "public", "RuntimeException", "cannotSetMaxPoolSizeToNegative", "(", "String", "max", ")", "{", "return", "new", "RuntimeException", "(", "\"", "Cannot", "set", "maximum", "STS", "client", "pool", "size", "to", "negative", "number", "(", "\"", "+", "max", "+", "\"", ")\"", ");", "}", "@", "Override", "public", "RuntimeException", "parserFeatureNotSupported", "(", "String", "feature", ")", "{", "return", "new", "RuntimeException", "(", "\"", "Parser", "feature", "\"", "+", "feature", "+", "\"", "not", "supported", ".", "\")", ";", "}", "}", "@", "@", "-", "1215", ",", "4", "+", "1215", ",", "6", "@", "@", "RuntimeException", "cannotSetMaxPoolSizeToNegative", "(", "String", "max", ")", ";", "RuntimeException", "parserFeatureNotSupported", "(", "String", "feature", ")", ";", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "66", ",", "6", "+", "66", ",", "10", "@", "@", "private", "static", "DocumentBuilderFactory", "documentBuilderFactory", ";", "public", "static", "final", "String", "feature_external_general_entities", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "general", "-", "entities", "\"", ";", "public", "static", "final", "String", "feature_external_parameter_entities", "=", "\"", "http", ":", "//", "xml", ".", "org", "/", "sax", "/", "features", "/", "external", "-", "parameter", "-", "entities", "\"", ";", "public", "static", "final", "String", "feature_disallow_doctype_decl", "=", "\"", "http", ":", "//", "apache", ".", "org", "/", "xml", "/", "features", "/", "disallow", "-", "doctype", "-", "decl", "\"", ";", "/", "**", "*", "Check", "whether", "a", "node", "belongs", "to", "a", "document", "*", "@", "@", "-", "517", ",", "6", "+", "521", ",", "17", "@", "@", "private", "static", "DocumentBuilderFactory", "getDocumentBuilderFactory", "(", ")", "{", "documentBuilderFactory", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "documentBuilderFactory", ".", "setNamespaceAware", "(", "true", ")", ";", "documentBuilderFactory", ".", "setXIncludeAware", "(", "true", ")", ";", "String", "feature", "=", "\"", "\";", "try", "{", "feature", "=", "feature_disallow_doctype_decl", ";", "documentBuilderFactory", ".", "setFeature", "(", "feature", ",", "true", ")", ";", "feature", "=", "feature_external_general_entities", ";", "documentBuilderFactory", ".", "setFeature", "(", "feature", ",", "false", ")", ";", "feature", "=", "feature_external_parameter_entities", ";", "documentBuilderFactory", ".", "setFeature", "(", "feature", ",", "false", ")", ";", "}", "catch", "(", "ParserConfigurationException", "e", ")", "{", "throw", "logger", ".", "parserFeatureNotSupported", "(", "feature", ")", ";", "}", "}", "finally", "{", "if", "(", "tccl_jaxp", ")", "{", "SecurityActions", ".", "setTCCL", "(", "prevTCCL", ")", ";"], "docstring_tokens": ["read", "arbitrary", "code", "and", "possibly", "have", "other", "unspecified", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "3124", ",", "11", "+", "3124", ",", "16", "@", "@", "static", "int", "proc_pid_fill_cache", "(", "struct", "file", "*", "filp", ",", "void", "*", "dirent", ",", "filldir_t", "filldi", "/", "*", "for", "the", "/", "proc", "/", "directory", "itself", ",", "after", "non", "-", "process", "stuff", "has", "been", "done", "*", "/", "int", "proc_pid_readdir", "(", "struct", "file", "*", "filp", ",", "void", "*", "dirent", ",", "filldir_t", "filldir", ")", "{", "unsigned", "int", "nr", "=", "filp", "-", ">", "f_pos", "-", "FIRST_PROCESS_ENTRY", ";", "struct", "task_struct", "*", "reaper", "=", "get_proc_task", "(", "filp", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ")", ";", "unsigned", "int", "nr", ";", "struct", "task_struct", "*", "reaper", ";", "struct", "tgid_iter", "iter", ";", "struct", "pid_namespace", "*", "ns", ";", "if", "(", "filp", "-", ">", "f_pos", ">", "=", "PID_MAX_LIMIT", "+", "TGID_OFFSET", ")", "goto", "out_no_task", ";", "nr", "=", "filp", "-", ">", "f_pos", "-", "FIRST_PROCESS_ENTRY", ";", "reaper", "=", "get_proc_task", "(", "filp", "-", ">", "f_path", ".", "dentry", "-", ">", "d_inode", ")", ";", "if", "(", "!", "reaper", ")", "goto", "out_no_task", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(system", "crash", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "151", ",", "7", "+", "151", ",", "7", "@", "@", "entry", "-", "point", "-", "ref", "=", "\"", "loginEntryPoint", "\"", "use", "-", "expressions", "=", "\"", "false", "\"", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "security", "\"", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "**", "\"", "access", "=", "\"", "IS_AUTHENTICATED_ANONYMOUSLY", "\"", "/", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "**", "\"", "access", "=", "\"", "IS_AUTHENTICATED_FULLY", "\"", "/", ">", "<", "csrf", "disabled", "=", "\"", "false", "\"", "/>", "<", "access", "-", "denied", "-", "handler", "ref", "=", "\"", "loginEntryPoint", "\"", "/>", "<", "/", "http", ">", "@", "@", "-", "90", ",", "6", "+", "90", ",", "7", "@", "@", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testChangePassword", "(", ")", "throws", "Exception", "{", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "change_password", "\"", ");", "signIn", "(", "userEmail", ",", "PASSWORD", ")", ";", "changePassword", "(", "PASSWORD", ",", "NEW_PASSWORD", ",", "\"", "new", "\"", ");", "@", "@", "-", "108", ",", "7", "+", "109", ",", "7", "@", "@", "public", "void", "displaysErrorWhenPasswordContravenesPolicy", "(", ")", "{", "/", "/", "the", "only", "policy", "we", "can", "contravene", "by", "default", "is", "the", "length", "String", "newPassword", "=", "new", "RandomValueStringGenerator", "(", "260", ")", ".", "generate", "(", ");", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "change_password", "\"", ");", "signIn", "(", "userEmail", ",", "PASSWORD", ")", ";", "changePassword", "(", "PASSWORD", ",", "newPassword", ",", "newPassword", ")", ";", "@", "@", "-", "134", ",", "11", "+", "135", ",", "8", "@", "@", "private", "void", "signOut", "(", ")", "{", "}", "private", "void", "signIn", "(", "String", "userName", ",", "String", "password", ")", "{", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "logout", ".", "do", "\"", ");", "webDriver", ".", "get", "(", "baseUrl", "+", "\"", "/", "login", "\"", ");", "webDriver", ".", "findElement", "(", "By", ".", "name", "(", "\"", "username", "\"", "))", ".", "sendKeys", "(", "userName", ")", ";", "webDriver", ".", "findElement", "(", "By", ".", "name", "(", "\"", "password", "\"", "))", ".", "sendKeys", "(", "password", ")", ";", "webDriver", ".", "findElement", "(", "By", ".", "xpath", "(", "\"/", "/", "input", "[", "@", "value", "=", "'", "Sign", "in", "'", "]\"", "))", ".", "click", "(", ");", "assertThat", "(", "webDriver", ".", "findElement", "(", "By", ".", "cssSelector", "(", "\"", "h1", "\"", "))", ".", "getText", "(", "),", "containsString", "(", "\"", "Where", "to", "?", "\")", ");", "}", "}", "@", "@", "-", "351", ",", "8", "+", "351", ",", "14", "@", "@", "public", "void", "changeEmailControllerVerifyEmailNotAllowed", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "changePasswordControllerChangePasswordPageNotAllowed", "(", ")", "throws", "Exception", "{", "MockMvcUtils", ".", "setDisableInternalUserManagement", "(", "false", ",", "getWebApplicationContext", "(", "))", ";", "ResultActions", "result", "=", "createUser", "(", ");", "ScimUser", "createdUser", "=", "JsonUtils", ".", "readValue", "(", "result", ".", "andReturn", "(", ").", "getResponse", "(", ").", "getContentAsString", "(", "),", "ScimUser", ".", "class", ")", ";", "MockMvcUtils", ".", "setDisableInternalUserManagement", "(", "true", ",", "getWebApplicationContext", "(", "))", ";", "getMockMvc", "(", ").", "perform", "(", "get", "(", "\"/", "change_password", "\"", "))", "getMockMvc", "(", ").", "perform", "(", "get", "(", "\"/", "change_password", "\"", ")", ".", "session", "(", "getUserSession", "(", "createdUser", ".", "getUserName", "(", "),", "PASSWD", ")", "))", ".", "andExpect", "(", "status", "(", ").", "isForbidden", "(", "))", ".", "andExpect", "(", "content", "(", ")", ".", "string", "(", "JsonObjectMatcherUtils", ".", "matchesJsonObject", "("], "docstring_tokens": ["determine", "and", "reset", "the", "password"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "*", "A", "<", "a", "href", "=", "\"", "http", ":", "//", "camel", ".", "apache", ".", "org", "/", "data", "-", "format", ".", "html", "\"", ">", "data", "format", "<", "/", "a", ">", "(", "{@", "link", "DataFormat", "}", ")", "*", "using", "<", "a", "href", "=", "\"", "http", ":", "//", "www", ".", "snakeyaml", ".", "org", "\"", ">", "SnakeYAML", "<", "/", "a", ">", "to", "marshal", "to", "and", "from", "YAML", ".", "*", "/", "public", "final", "class", "SnakeYAMLDataFormat", "extends", "ServiceSupport", "implements", "DataFormat", ",", "DataFormatName", "{", "public", "class", "SnakeYAMLDataFormat", "extends", "ServiceSupport", "implements", "DataFormat", ",", "DataFormatName", "{", "private", "final", "ThreadLocal", "<", "WeakReference", "<", "Yaml", ">", ">", "yamlCache", ";", "private", "BaseConstructor", "constructor", ";", "private", "Representer", "representer", ";", "@", "@", "-", "77", ",", "7", "+", "77", ",", "9", "@", "@", "public", "SnakeYAMLDataFormat", "(", "Class", "<", "?>", "type", ")", "{", "this", ".", "allowAnyType", "=", "false", ";", "if", "(", "type", "!", "=", "null", ")", "{", "setUnmarshalType", "(", "type", ")", ";", "this", ".", "unmarshalType", "=", "type", ";", "this", ".", "typeFilters", "=", "new", "CopyOnWriteArrayList", "<", ">(", ");", "this", ".", "typeFilters", ".", "add", "(", "TypeFilters", ".", "types", "(", "type", ")", ");", "}", "}"], "docstring_tokens": ["in", "the", "worst", "case", "trigger", "command", "or", "remote", "code", "execution"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "911", ",", "7", "+", "911", ",", "8", "@", "@", "static", "int", "nfc_genl_deactivate_target", "(", "struct", "sk_buff", "*", "skb", ",", "u32", "device_idx", ",", "target_idx", ";", "int", "rc", ";", "if", "(", "!", "info", "-", ">", "attrs", "[", "NFC_ATTR_DEVICE_INDEX", "]", ")", "if", "(", "!", "info", "-", ">", "attrs", "[", "NFC_ATTR_DEVICE_INDEX", "]", "|", "|", "!", "info", "-", ">", "attrs", "[", "NFC_ATTR_TARGET_INDEX", "]", ")", "return", "-", "EINVAL", ";", "device_idx", "=", "nla_get_u32", "(", "info", "-", ">", "attrs", "[", "NFC_ATTR_DEVICE_INDEX", "]", ");"], "docstring_tokens": ["a", "denial", "of", "service", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "659", ",", "6", "+", "659", ",", "13", "@", "@", "Changes", "between", "1", ".", "0", ".", "1j", "and", "1", ".", "0", ".", "1k", "[", "xx", "XXX", "xxxx", "]", "*", ")", "Abort", "handshake", "if", "server", "key", "exchange", "message", "is", "omitted", "for", "ephemeral", "ECDH", "ciphersuites", ".", "Thanks", "to", "Karthikeyan", "Bhargavan", "for", "reporting", "this", "issue", ".", "(", "CVE", "-", "2014", "-", "3572", ")", "[", "Steve", "Henson", "]", "*", ")", "Ensure", "that", "the", "session", "ID", "context", "of", "an", "SSL", "is", "updated", "when", "its", "SSL_CTX", "is", "updated", "via", "SSL_set_SSL_CTX", ".", "@", "@", "-", "1376", ",", "6", "+", "1376", ",", "8", "@", "@", "int", "ssl3_get_key_exchange", "(", "SSL", "*", "s", ")", "int", "encoded_pt_len", "=", "0", ";", "#", "endif", "EVP_MD_CTX_init", "(", "&", "md_ctx", ")", ";", "/", "*", "use", "same", "message", "size", "as", "in", "ssl3_get_certificate_request", "(", ")", "*", "as", "ServerKeyExchange", "message", "may", "be", "skipped", "*", "/", "n", "=", "s", "-", ">", "method", "-", ">", "ssl_get_message", "(", "s", ",", "@", "@", "-", "1386", ",", "14", "+", "1388", ",", "26", "@", "@", "int", "ssl3_get_key_exchange", "(", "SSL", "*", "s", ")", "&", "ok", ")", ";", "if", "(", "!", "ok", ")", "return", "(", "(", "int", ")", "n", ")", ";", "alg_k", "=", "s", "-", ">", "s3", "-", ">", "tmp", ".", "new_cipher", "-", ">", "algorithm_mkey", ";", "if", "(", "s", "-", ">", "s3", "-", ">", "tmp", ".", "message_type", "!", "=", "SSL3_MT_SERVER_KEY_EXCHANGE", ")", "{", "/", "*", "*", "Can", "'", "t", "skip", "server", "key", "exchange", "if", "this", "is", "an", "ephemeral", "*", "ciphersuite", ".", "*", "/", "if", "(", "alg_k", "&", "(", "SSL_kDHE", "|", "SSL_kECDHE", ")", ")", "{", "SSLerr", "(", "SSL_F_SSL3_GET_KEY_EXCHANGE", ",", "SSL_R_UNEXPECTED_MESSAGE", ")", ";", "al", "=", "SSL_AD_UNEXPECTED_MESSAGE", ";", "goto", "f_err", ";", "}", "#", "ifndef", "OPENSSL_NO_PSK", "/", "*", "In", "plain", "PSK", "ciphersuite", ",", "ServerKeyExchange", "can", "be", "omitted", "if", "no", "identity", "hint", "is", "sent", ".", "Set", "session", "-", ">", "sess_cert", "anyway", "to", "avoid", "problems", "later", ".", "*/", "if", "(", "s", "-", ">", "s3", "-", ">", "tmp", ".", "new_cipher", "-", ">", "algorithm_mkey", "&", "SSL_kPSK", ")", "if", "(", "alg_k", "&", "SSL_kPSK", ")", "{", "s", "-", ">", "session", "-", ">", "sess_cert", "=", "ssl_sess_cert_new", "(", ");", "if", "(", "s", "-", ">", "ctx", "-", ">", "psk_identity_hint", ")", "@", "@", "-", "1438", ",", "9", "+", "1452", ",", "7", "@", "@", "int", "ssl3_get_key_exchange", "(", "SSL", "*", "s", ")", "/", "*", "Total", "length", "of", "the", "parameters", "including", "the", "length", "prefix", "*", "/", "param_len", "=", "0", ";", "alg_k", "=", "s", "-", ">", "s3", "-", ">", "tmp", ".", "new_cipher", "-", ">", "algorithm_mkey", ";", "alg_a", "=", "s", "-", ">", "s3", "-", ">", "tmp", ".", "new_cipher", "-", ">", "algorithm_auth", ";", "EVP_MD_CTX_init", "(", "&", "md_ctx", ")", ";", "al", "=", "SSL_AD_DECODE_ERROR", ";"], "docstring_tokens": ["launch", "further", "attacks", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "6", "+", "1", ",", "4", "@", "@", "Faye", ".", "Server", "=", "Faye", ".", "Class", "(", "{", "META_METHODS", ":", "[", "'", "handshake", "'", ",", "'", "connect", "'", ",", "'", "disconnect", "'", ",", "'", "subscribe", "'", ",", "'", "unsubscribe", "'", "],", "initialize", ":", "function", "(", "options", ")", "{", "this", ".", "_options", "=", "options", "|", "|", "{", "};", "var", "engineOpts", "=", "this", ".", "_options", ".", "engine", "|", "|", "{", "};", "@", "@", "-", "103", ",", "10", "+", "101", ",", "10", "@", "@", "Faye", ".", "Server", "=", "Faye", ".", "Class", "(", "{", "}", ",", "_handleMeta", ":", "function", "(", "message", ",", "local", ",", "callback", ",", "context", ")", "{", "var", "method", "=", "Faye", ".", "Channel", ".", "parse", "(", "message", ".", "channel", ")", "[", "1", "]", ",", "var", "method", "=", "this", ".", "_methodFor", "(", "message", ")", ",", "response", ";", "if", "(", "Faye", ".", "indexOf", "(", "this", ".", "META_METHODS", ",", "method", ")", "<", "0", ")", "{", "if", "(", "method", "=", "==", "null", ")", "{", "response", "=", "this", ".", "_makeResponse", "(", "message", ")", ";", "response", ".", "error", "=", "Faye", ".", "Error", ".", "channelForbidden", "(", "message", ".", "channel", ")", ";", "response", ".", "successful", "=", "false", ";", "@", "@", "-", "120", ",", "6", "+", "118", ",", "18", "@", "@", "Faye", ".", "Server", "=", "Faye", ".", "Class", "(", "{", "}", ",", "this", ")", ";", "}", ",", "_methodFor", ":", "function", "(", "message", ")", "{", "var", "channel", "=", "message", ".", "channel", ";", "if", "(", "channel", "=", "==", "Faye", ".", "Channel", ".", "HANDSHAKE", ")", "return", "'", "handshake", "'", ";", "if", "(", "channel", "=", "==", "Faye", ".", "Channel", ".", "CONNECT", ")", "return", "'", "connect", "'", ";", "if", "(", "channel", "=", "==", "Faye", ".", "Channel", ".", "SUBSCRIBE", ")", "return", "'", "subscribe", "'", ";", "if", "(", "channel", "=", "==", "Faye", ".", "Channel", ".", "UNSUBSCRIBE", ")", "return", "'", "unsubscribe", "'", ";", "if", "(", "channel", "=", "==", "Faye", ".", "Channel", ".", "DISCONNECT", ")", "return", "'", "disconnect", "'", ";", "return", "null", ";", "}", ",", "_advize", ":", "function", "(", "response", ",", "connectionType", ")", "{", "if", "(", "Faye", ".", "indexOf", "(", "[", "Faye", ".", "Channel", ".", "HANDSHAKE", ",", "Faye", ".", "Channel", ".", "CONNECT", "]", ",", "response", ".", "channel", ")", "<", "0", ")", "return", ";", "@", "@", "-", "6", ",", "8", "+", "6", ",", "6", "@", "@", "class", "Server", "include", "Logging", "include", "Extensible", "META_METHODS", "=", "%", "w", "[", "handshake", "connect", "disconnect", "subscribe", "unsubscribe", "]", "attr_reader", ":", "engine", "def", "initialize", "(", "options", "=", "{", "})", "@", "@", "-", "103", ",", "9", "+", "101", ",", "9", "@", "@", "def", "handle", "(", "message", ",", "local", "=", "false", ",", "&", "callback", ")", "end", "def", "handle_meta", "(", "message", ",", "local", ",", "&", "callback", ")", "method", "=", "Channel", ".", "parse", "(", "message", "[", "'", "channel", "'", "])", "[", "1", "]", "method", "=", "method_for", "(", "message", ")", "unless", "META_METHODS", ".", "include", "?", "(", "method", ")", "unless", "method", "response", "=", "make_response", "(", "message", ")", "response", "[", "'", "error", "'", "]", "=", "Faye", ":", ":", "Error", ".", "channel_forbidden", "(", "message", "[", "'", "channel", "'", "])", "response", "[", "'", "successful", "'", "]", "=", "false", "@", "@", "-", "119", ",", "6", "+", "117", ",", "16", "@", "@", "def", "handle_meta", "(", "message", ",", "local", ",", "&", "callback", ")", "end", "end", "def", "method_for", "(", "message", ")", "case", "message", "[", "'", "channel", "'", "]", "when", "Channel", ":", ":", "HANDSHAKE", "then", ":", "handshake", "when", "Channel", ":", ":", "CONNECT", "then", ":", "connect", "when", "Channel", ":", ":", "SUBSCRIBE", "then", ":", "subscribe", "when", "Channel", ":", ":", "UNSUBSCRIBE", "then", ":", "unsubscribe", "when", "Channel", ":", ":", "DISCONNECT", "then", ":", "disconnect", "end", "end", "def", "advize", "(", "response", ",", "connection_type", ")", "return", "unless", "[", "Channel", ":", ":", "HANDSHAKE", ",", "Channel", ":", ":", "CONNECT", "]", ".", "include", "?", "(", "response", "[", "'", "channel", "'", "])", "@", "@", "-", "31", ",", "6", "+", "31", ",", "42", "@", "@", "JS", ".", "ENV", ".", "Server", ".", "ExtensionsSpec", "=", "JS", ".", "Test", ".", "describe", "(", "\"", "Server", "extensions", "\"", ",", "function", "(", ")", "}", "})", "}", "})", "describe", "(", "\"", "with", "subscription", "auth", "installed", "\"", ",", "function", "(", ")", "{", "with", "(", "this", ")", "{", "before", "(", "function", "(", ")", "{", "with", "(", "this", ")", "{", "var", "extension", "=", "{", "incoming", ":", "function", "(", "message", ",", "callback", ")", "{", "if", "(", "message", ".", "channel", "=", "==", "\"", "/", "meta", "/", "subscribe", "\"", "&", "&", "!", "message", ".", "auth", ")", "{", "message", ".", "error", "=", "\"", "Invalid", "auth", "\"", "}", "callback", "(", "message", ")", "}", "}", "server", ".", "addExtension", "(", "extension", ")", "}", "})", "it", "(", "\"", "does", "not", "subscribe", "using", "the", "intended", "channel", "\"", ",", "function", "(", ")", "{", "with", "(", "this", ")", "{", "var", "message", "=", "{", "channel", ":", "\"", "/", "meta", "/", "subscribe", "\"", ",", "clientId", ":", "\"", "fakeclientid", "\"", ",", "subscription", ":", "\"", "/", "foo", "\"", "}", "stub", "(", "engine", ",", "\"", "clientExists", "\"", ").", "yields", "(", "[", "true", "]", ")", "expect", "(", "engine", ",", "\"", "subscribe", "\"", ").", "exactly", "(", "0", ")", "server", ".", "process", "(", "message", ",", "false", ",", "function", "(", ")", "{", "})", "}", "})", "it", "(", "\"", "does", "not", "subscribe", "using", "an", "extended", "channel", "\"", ",", "function", "(", ")", "{", "with", "(", "this", ")", "{", "var", "message", "=", "{", "channel", ":", "\"", "/", "meta", "/", "subscribe", "/", "x", "\"", ",", "clientId", ":", "\"", "fakeclientid", "\"", ",", "subscription", ":", "\"", "/", "foo", "\"", "}", "stub", "(", "engine", ",", "\"", "clientExists", "\"", ").", "yields", "(", "[", "true", "]", ")", "expect", "(", "engine", ",", "\"", "subscribe", "\"", ").", "exactly", "(", "0", ")", "server", ".", "process", "(", "message", ",", "false", ",", "function", "(", ")", "{", "})", "}", "})", "}", "})", "describe", "(", "\"", "with", "an", "outgoing", "extension", "installed", "\"", ",", "function", "(", ")", "{", "with", "(", "this", ")", "{", "before", "(", "function", "(", ")", "{", "with", "(", "this", ")", "{", "var", "extension", "=", "{", "@", "@", "-", "40", ",", "6", "+", "40", ",", "42", "@", "@", "def", "incoming", "(", "message", ",", "callback", ")", "end", "end", "describe", "\"", "with", "subscription", "auth", "installed", "\"", "do", "before", "do", "extension", "=", "Class", ".", "new", "do", "def", "incoming", "(", "message", ",", "callback", ")", "if", "message", "[", "\"", "channel", "\"", "]", "=", "=", "\"", "/", "meta", "/", "subscribe", "\"", "and", "!", "message", "[", "\"", "auth", "\"", "]", "message", "[", "\"", "error", "\"", "]", "=", "\"", "Invalid", "auth", "\"", "end", "callback", ".", "call", "(", "message", ")", "end", "end", "server", ".", "add_extension", "(", "extension", ".", "new", ")", "end", "it", "\"", "does", "not", "subscribe", "using", "the", "intended", "channel", "\"", "do", "message", "=", "{", "\"", "channel", "\"", "=", ">", "\"", "/", "meta", "/", "subscribe", "\"", ",", "\"", "clientId", "\"", "=", ">", "\"", "fakeclientid", "\"", ",", "\"", "subscription", "\"", "=", ">", "\"", "/", "foo", "\"", "}", "engine", ".", "stub", "(", ":", "client_exists", ")", ".", "and_yield", "(", "true", ")", "engine", ".", "should_not_receive", "(", ":", "subscribe", ")", "server", ".", "process", "(", "message", ",", "false", ")", "{", "}", "end", "it", "\"", "does", "not", "subscribe", "using", "an", "extended", "channel", "\"", "do", "message", "=", "{", "\"", "channel", "\"", "=", ">", "\"", "/", "meta", "/", "subscribe", "/", "x", "\"", ",", "\"", "clientId", "\"", "=", ">", "\"", "fakeclientid", "\"", ",", "\"", "subscription", "\"", "=", ">", "\"", "/", "foo", "\"", "}", "engine", ".", "stub", "(", ":", "client_exists", ")", ".", "and_yield", "(", "true", ")", "engine", ".", "should_not_receive", "(", ":", "subscribe", ")", "server", ".", "process", "(", "message", ",", "false", ")", "{", "}", "end", "end", "describe", "\"", "with", "an", "outgoing", "extension", "installed", "\"", "do", "before", "do", "extension", "=", "Class", ".", "new", "do"], "docstring_tokens": ["bypass", "checks", "in", "server-side", "extensions", "and", "append", "extra", "segments", "to", "the", "message", "channel"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "62", ",", "12", "+", "62", ",", "11", "@", "@", "public", "String", "getIconFileName", "(", ")", "{", "}", "public", "String", "getDisplayName", "(", ")", "{", "return", "\"", "Jenkins", "CLI", "\"", ";", "}", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "cli", "\"", ";", "return", "jenkins", ".", "CLI", ".", "DISABLED", "?", "null", ":", "\"", "cli", "\"", ";", "}", "public", "void", "doCommand", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", "{", "@", "@", "-", "32", ",", "7", "+", "32", ",", "7", "@", "@", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "\"", "CLI", "-", "connect", "\"", ";", "return", "jenkins", ".", "CLI", ".", "DISABLED", "?", "null", ":", "\"", "CLI", "-", "connect", "\"", ";", "}", "@", "Override", "@", "@", "-", "24", ",", "7", "+", "24", ",", "7", "@", "@", "public", "class", "CliProtocol2", "extends", "CliProtocol", "{", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "\"", "CLI2", "-", "connect", "\"", ";", "return", "jenkins", ".", "CLI", ".", "DISABLED", "?", "null", ":", "\"", "CLI2", "-", "connect", "\"", ";", "}", "@", "Override", "@", "@", "-", "0", ",", "0", "+", "1", ",", "17", "@", "@", "package", "jenkins", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "/", "**", "*", "Kill", "switch", "to", "disable", "the", "entire", "Jenkins", "CLI", "system", ".", "*", "*", "Marked", "as", "no", "external", "use", "because", "the", "CLI", "subsystem", "is", "nearing", "EOL", ".", "*", "*", "@", "author", "Kohsuke", "Kawaguchi", "*", "/", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "class", "CLI", "{", "/", "/", "non", "-", "final", "to", "allow", "setting", "from", "$", "JENKINS_HOME", "/", "init", ".", "groovy", ".", "d", "public", "static", "boolean", "DISABLED", "=", "Boolean", ".", "getBoolean", "(", "CLI", ".", "class", ".", "getName", "(", ")+", "\".", "disabled", "\"", ");", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "65", "@", "@", "package", "jenkins", ";", "import", "hudson", ".", "cli", ".", "FullDuplexHttpStream", ";", "import", "hudson", ".", "model", ".", "Computer", ";", "import", "hudson", ".", "model", ".", "Failure", ";", "import", "hudson", ".", "remoting", ".", "Channel", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "java", ".", "io", ".", "FileNotFoundException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "/", "**", "*", "@", "author", "Kohsuke", "Kawaguchi", "*", "/", "public", "class", "CLITest", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "/", "**", "*", "Checks", "if", "the", "kill", "switch", "works", "correctly", "*", "/", "@", "Test", "public", "void", "killSwitch", "(", ")", "throws", "Exception", "{", "/", "/", "this", "should", "succeed", ",", "as", "a", "control", "case", "makeHttpCall", "(", ");", "makeJnlpCall", "(", ");", "CLI", ".", "DISABLED", "=", "true", ";", "try", "{", "try", "{", "makeHttpCall", "(", ");", "fail", "(", "\"", "Should", "have", "been", "rejected", "\"", ");", "}", "catch", "(", "FileNotFoundException", "e", ")", "{", "/", "/", "attempt", "to", "make", "a", "call", "should", "fail", "}", "try", "{", "makeJnlpCall", "(", ");", "fail", "(", "\"", "Should", "have", "been", "rejected", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "/", "/", "attempt", "to", "make", "a", "call", "should", "fail", "e", ".", "printStackTrace", "(", ");", "/", "/", "the", "current", "expected", "failure", "mode", "is", "EOFException", ",", "though", "we", "don", "'", "t", "really", "care", "how", "it", "fails", "}", "}", "finally", "{", "CLI", ".", "DISABLED", "=", "false", ";", "}", "}", "private", "void", "makeHttpCall", "(", ")", "throws", "Exception", "{", "FullDuplexHttpStream", "con", "=", "new", "FullDuplexHttpStream", "(", "new", "URL", "(", "j", ".", "getURL", "(", "),", "\"", "cli", "\"", "))", ";", "Channel", "ch", "=", "new", "Channel", "(", "\"", "test", "connection", "\"", ",", "Computer", ".", "threadPoolForRemoting", ",", "con", ".", "getInputStream", "(", "),", "con", ".", "getOutputStream", "(", "))", ";", "ch", ".", "close", "(", ");", "}", "private", "void", "makeJnlpCall", "(", ")", "throws", "Exception", "{", "int", "r", "=", "hudson", ".", "cli", ".", "CLI", ".", "_main", "(", "new", "String", "[", "]{", "\"-", "s", "\"", ",", "j", ".", "getURL", "(", ").", "toString", "(", "),", "\"", "version", "\"", "})", ";", "if", "(", "r", "!", "=", "0", ")", "throw", "new", "Failure", "(", "\"", "CLI", "failed", "\"", ");", "}", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "58", ",", "6", "+", "58", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "RestProcessorMultiStartSelfTest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "RestProcessorStartSelfTest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "TaskCommandHandlerSelfTest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "TcpRestUnmarshalVulnerabilityTest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "protocols", ".", "tcp", ".", "TcpRestParserSelfTest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "protocols", ".", "tcp", ".", "redis", ".", "RedisProtocolConnectSelfTest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "protocols", ".", "tcp", ".", "redis", ".", "RedisProtocolServerSelfTest", ";", "@", "@", "-", "84", ",", "6", "+", "85", ",", "7", "@", "@", "public", "static", "TestSuite", "suite", "(", ")", "{", "/", "/", "Test", "custom", "binary", "protocol", "with", "test", "client", ".", "suite", ".", "addTestSuite", "(", "RestBinaryProtocolSelfTest", ".", "class", ")", ";", "suite", ".", "addTestSuite", "(", "TcpRestUnmarshalVulnerabilityTest", ".", "class", ")", ";", "/", "/", "Test", "jetty", "rest", "processor", "suite", ".", "addTestSuite", "(", "JettyRestProcessorSignedSelfTest", ".", "class", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "269", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ";", "import", "java", ".", "io", ".", "BufferedInputStream", ";", "import", "java", ".", "io", ".", "BufferedOutputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicBoolean", ";", "import", "org", ".", "apache", ".", "ignite", ".", "configuration", ".", "ConnectorConfiguration", ";", "import", "org", ".", "apache", ".", "ignite", ".", "configuration", ".", "IgniteConfiguration", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "marshaller", ".", "jdk", ".", "GridClientJdkMarshaller", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "client", ".", "message", ".", "GridClientHandshakeRequest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "client", ".", "message", ".", "GridClientMessage", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "IgniteUtils", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "lang", ".", "GridAbsPredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "typedef", ".", "internal", ".", "U", ";", "import", "org", ".", "apache", ".", "ignite", ".", "testframework", ".", "GridTestUtils", ";", "import", "org", ".", "apache", ".", "ignite", ".", "testframework", ".", "junits", ".", "common", ".", "GridCommonAbstractTest", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_BLACKLIST", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_WHITELIST", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "protocols", ".", "tcp", ".", "GridMemcachedMessage", ".", "IGNITE_HANDSHAKE_FLAG", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "protocols", ".", "tcp", ".", "GridMemcachedMessage", ".", "IGNITE_REQ_FLAG", ";", "/", "**", "*", "Tests", "for", "whitelist", "and", "blacklist", "ot", "avoiding", "deserialization", "vulnerability", ".", "*", "/", "public", "class", "TcpRestUnmarshalVulnerabilityTest", "extends", "GridCommonAbstractTest", "{", "/", "**", "Marshaller", ".", "*", "/", "private", "static", "final", "GridClientJdkMarshaller", "MARSH", "=", "new", "GridClientJdkMarshaller", "(", ");", "/", "**", "Shared", "value", ".", "*", "/", "private", "static", "final", "AtomicBoolean", "SHARED", "=", "new", "AtomicBoolean", "(", ");", "/", "**", "Port", ".", "*", "/", "private", "static", "int", "port", ";", "/", "**", "Host", ".", "*", "/", "private", "static", "String", "host", ";", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "protected", "IgniteConfiguration", "getConfiguration", "(", "String", "igniteInstanceName", ")", "throws", "Exception", "{", "IgniteConfiguration", "cfg", "=", "super", ".", "getConfiguration", "(", "igniteInstanceName", ")", ";", "ConnectorConfiguration", "connCfg", "=", "new", "ConnectorConfiguration", "(", ");", "port", "=", "connCfg", ".", "getPort", "(", ");", "host", "=", "connCfg", ".", "getHost", "(", ");", "cfg", ".", "setConnectorConfiguration", "(", "connCfg", ")", ";", "return", "cfg", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "protected", "void", "beforeTest", "(", ")", "throws", "Exception", "{", "super", ".", "beforeTest", "(", ");", "SHARED", ".", "set", "(", "false", ")", ";", "System", ".", "clearProperty", "(", "IGNITE_MARSHALLER_WHITELIST", ")", ";", "System", ".", "clearProperty", "(", "IGNITE_MARSHALLER_BLACKLIST", ")", ";", "IgniteUtils", ".", "clearClassCache", "(", ");", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testNoLists", "(", ")", "throws", "Exception", "{", "testExploit", "(", "true", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testWhiteListIncluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_included", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_WHITELIST", ",", "path", ")", ";", "testExploit", "(", "true", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testWhiteListExcluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_excluded", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_WHITELIST", ",", "path", ")", ";", "testExploit", "(", "false", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testBlackListIncluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_included", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_BLACKLIST", ",", "path", ")", ";", "testExploit", "(", "false", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testBlackListExcluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_excluded", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_BLACKLIST", ",", "path", ")", ";", "testExploit", "(", "true", ")", ";", "}", "/", "**", "*", "@", "throws", "Exception", "If", "failed", ".", "*", "/", "public", "void", "testBothListIncluded", "(", ")", "throws", "Exception", "{", "String", "path", "=", "U", ".", "resolveIgnitePath", "(", "\"", "modules", "/", "core", "/", "src", "/", "test", "/", "config", "/", "class_list_exploit_included", ".", "txt", "\"", ").", "getPath", "(", ");", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_WHITELIST", ",", "path", ")", ";", "System", ".", "setProperty", "(", "IGNITE_MARSHALLER_BLACKLIST", ",", "path", ")", ";", "testExploit", "(", "false", ")", ";", "}", "/", "**", "*", "@", "param", "positive", "Positive", ".", "*", "/", "private", "void", "testExploit", "(", "boolean", "positive", ")", "throws", "Exception", "{", "try", "{", "startGrid", "(", ");", "attack", "(", "marshal", "(", "new", "Exploit", "(", "))", ".", "array", "(", "))", ";", "boolean", "res", "=", "GridTestUtils", ".", "waitForCondition", "(", "new", "GridAbsPredicate", "(", ")", "{", "@", "Override", "public", "boolean", "apply", "(", ")", "{", "return", "SHARED", ".", "get", "(", ");", "}", "}", ",", "3000L", ")", ";", "if", "(", "positive", ")", "assertTrue", "(", "res", ")", ";", "else", "assertFalse", "(", "res", ")", ";", "}", "finally", "{", "stopAllGrids", "(", ");", "}", "}", "/", "**", "*", "@", "param", "obj", "Object", ".", "*", "/", "private", "static", "ByteBuffer", "marshal", "(", "Object", "obj", ")", "throws", "IOException", "{", "return", "MARSH", ".", "marshal", "(", "obj", ",", "0", ")", ";", "}", "/", "**", "*", "@", "param", "data", "Data", ".", "*", "/", "private", "void", "attack", "(", "byte", "[", "]", "data", ")", "throws", "IOException", "{", "InetAddress", "addr", "=", "InetAddress", ".", "getByName", "(", "host", ")", ";", "try", "(", "Socket", "sock", "=", "new", "Socket", "(", "addr", ",", "port", ")", ";", "OutputStream", "os", "=", "new", "BufferedOutputStream", "(", "sock", ".", "getOutputStream", "(", "))", ")", "{", "/", "/", "Handshake", "request", ".", "os", ".", "write", "(", "IGNITE_HANDSHAKE_FLAG", ")", ";", "GridClientHandshakeRequest", "req", "=", "new", "GridClientHandshakeRequest", "(", ");", "req", ".", "marshallerId", "(", "GridClientJdkMarshaller", ".", "ID", ")", ";", "os", ".", "write", "(", "req", ".", "rawBytes", "(", "))", ";", "os", ".", "flush", "(", ");", "/", "/", "Handshake", "response", "InputStream", "is", "=", "new", "BufferedInputStream", "(", "sock", ".", "getInputStream", "(", "))", ";", "is", ".", "read", "(", "new", "byte", "[", "146", "]", ");", "/", "/", "Read", "handshake", "response", ".", "int", "len", "=", "data", ".", "length", "+", "40", ";", "os", ".", "write", "(", "IGNITE_REQ_FLAG", ")", ";", "/", "/", "Package", "type", ".", "os", ".", "write", "(", "(", "byte", ")", "(", "len", ">", ">", "24", ")", ");", "/", "/", "Package", "length", ".", "os", ".", "write", "(", "(", "byte", ")", "(", "len", ">", ">", "16", ")", ");", "os", ".", "write", "(", "(", "byte", ")", "(", "len", ">", ">", "8", ")", ");", "os", ".", "write", "(", "(", "byte", ")", "(", "len", ")", ");", "os", ".", "write", "(", "new", "byte", "[", "40", "]", ");", "/", "/", "Stream", "header", ".", "os", ".", "write", "(", "data", ")", ";", "/", "/", "Exploit", ".", "os", ".", "flush", "(", ");", "}", "}", "/", "**", "*", "/", "private", "static", "class", "Exploit", "implements", "GridClientMessage", "{", "/", "**", "*", "@", "param", "is", "Input", "stream", ".", "*", "/", "private", "void", "readObject", "(", "ObjectInputStream", "is", ")", "throws", "ClassNotFoundException", ",", "IOException", "{", "SHARED", ".", "set", "(", "true", ")", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "long", "requestId", "(", ")", "{", "return", "0", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "requestId", "(", "long", "reqId", ")", "{", "/", "/", "No", "-", "op", ".", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "UUID", "clientId", "(", ")", "{", "return", "null", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "clientId", "(", "UUID", "id", ")", "{", "/", "/", "No", "-", "op", ".", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "UUID", "destinationId", "(", ")", "{", "return", "null", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "destinationId", "(", "UUID", "id", ")", "{", "/", "/", "No", "-", "op", ".", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "byte", "[", "]", "sessionToken", "(", ")", "{", "return", "new", "byte", "[", "0", "]", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "void", "sessionToken", "(", "byte", "[", "]", "sesTok", ")", "{", "/", "/", "No", "-", "op", ".", "}", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "22", ",", "11", "+", "22", ",", "14", "@", "@", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "marshaller", ".", "GridClientMarshaller", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "marshaller", ".", "jdk", ".", "GridClientJdkMarshaller", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "marshaller", ".", "optimized", ".", "GridClientOptimizedMarshaller", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "client", ".", "message", ".", "GridClientCacheRequest", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "typedef", ".", "X", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "import", "org", ".", "apache", ".", "ignite", ".", "testframework", ".", "junits", ".", "common", ".", "GridCommonAbstractTest", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "client", ".", "message", ".", "GridClientCacheRequest", ".", "GridCacheOperation", ".", "CAS", ";", "@", "@", "-", "41", ",", "10", "+", "44", ",", "15", "@", "@", "/", "**", "*", "/", "public", "ClientMarshallerBenchmarkTest", "(", ")", "{", "marshallers", "=", "new", "GridClientMarshaller", "[", "]", "{", "new", "GridClientJdkMarshaller", "(", "),", "new", "GridClientOptimizedMarshaller", "(", ")", "}", ";", "try", "{", "marshallers", "=", "new", "GridClientMarshaller", "[", "]", "{", "new", "GridClientJdkMarshaller", "(", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", "),", "new", "GridClientOptimizedMarshaller", "(", ")", "}", ";", "}", "catch", "(", "IgniteCheckedException", "e", ")", "{", "throw", "new", "IgniteException", "(", "e", ")", ";", "}", "}", "/", "**", "@", "@", "-", "17", ",", "14", "+", "17", ",", "10", "@", "@", "package", "org", ".", "apache", ".", "ignite", ".", "internal", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "Externalizable", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "FileNotFoundException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "java", ".", "io", ".", "InvalidObjectException", ";", "import", "java", ".", "io", ".", "ObjectInput", ";", "import", "java", ".", "io", ".", "ObjectOutput", ";", "@", "@", "-", "197", ",", "6", "+", "193", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "ignite", ".", "lifecycle", ".", "LifecycleBean", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lifecycle", ".", "LifecycleEventType", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerExclusions", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "jdk", ".", "JdkMarshaller", ";", "import", "org", ".", "apache", ".", "ignite", ".", "mxbean", ".", "ClusterMetricsMXBean", ";", "import", "org", ".", "apache", ".", "ignite", ".", "mxbean", ".", "IgniteMXBean", ";", "@", "@", "-", "274", ",", "8", "+", "271", ",", "6", "@", "@", "import", "static", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "IgniteVersionUtils", ".", "VER_STR", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "lifecycle", ".", "LifecycleEventType", ".", "AFTER_NODE_START", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "lifecycle", ".", "LifecycleEventType", ".", "BEFORE_NODE_START", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ".", "CLS_NAMES_FILE", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ".", "JDK_CLS_NAMES_FILE", ";", "/", "**", "*", "Ignite", "kernal", ".", "@", "@", "-", "902", ",", "7", "+", "897", ",", "7", "@", "@", "public", "void", "start", "(", "schemaExecSvc", ",", "customExecSvcs", ",", "plugins", ",", "classNameFilter", "(", ")", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", ")", ";", "cfg", ".", "getMarshaller", "(", ").", "setContext", "(", "ctx", ".", "marshallerContext", "(", "))", ";", "@", "@", "-", "1768", ",", "105", "+", "1763", ",", "6", "@", "@", "private", "void", "startProcessor", "(", "GridProcessor", "proc", ")", "throws", "IgniteCheckedException", "{", "}", "}", "/", "**", "*", "Returns", "class", "name", "filter", "for", "marshaller", ".", "*", "*", "@", "return", "Class", "name", "filter", "for", "marshaller", ".", "*", "/", "private", "IgnitePredicate", "<", "String", ">", "classNameFilter", "(", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "whiteList", "=", "classWhiteList", "(", ");", "ClassSet", "blackList", "=", "classBlackList", "(", ");", "return", "new", "IgnitePredicate", "<", "String", ">", "()", "{", "@", "Override", "public", "boolean", "apply", "(", "String", "s", ")", "{", "/", "/", "Allows", "all", "primitive", "arrays", "and", "checks", "arrays", "'", "type", ".", "if", "(", "(", "blackList", "!", "=", "null", "|", "|", "whiteList", "!", "=", "null", ")", "&", "&", "s", ".", "charAt", "(", "0", ")", "=", "=", "'", "['", ")", "{", "if", "(", "s", ".", "charAt", "(", "1", ")", "=", "=", "'", "L", "'", "&", "&", "s", ".", "length", "(", ")", ">", "2", ")", "s", "=", "s", ".", "substring", "(", "2", ",", "s", ".", "length", "(", ")", "-", "1", ")", ";", "else", "return", "true", ";", "}", "return", "(", "blackList", "=", "=", "null", "|", "|", "!", "blackList", ".", "contains", "(", "s", ")", ")", "&", "&", "(", "whiteList", "=", "=", "null", "|", "|", "whiteList", ".", "contains", "(", "s", ")", ");", "}", "}", ";", "}", "/", "**", "*", "@", "return", "White", "list", "of", "classes", ".", "*", "/", "private", "ClassSet", "classWhiteList", "(", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "clsSet", "=", "null", ";", "String", "fileName", "=", "IgniteSystemProperties", ".", "getString", "(", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_WHITELIST", ")", ";", "if", "(", "fileName", "!", "=", "null", ")", "{", "clsSet", "=", "new", "ClassSet", "(", ");", "addClassNames", "(", "JDK_CLS_NAMES_FILE", ",", "clsSet", ")", ";", "addClassNames", "(", "CLS_NAMES_FILE", ",", "clsSet", ")", ";", "addClassNames", "(", "fileName", ",", "clsSet", ")", ";", "}", "return", "clsSet", ";", "}", "/", "**", "*", "@", "return", "Black", "list", "of", "classes", ".", "*", "/", "private", "ClassSet", "classBlackList", "(", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "clsSet", "=", "null", ";", "String", "blackListFileName", "=", "IgniteSystemProperties", ".", "getString", "(", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_BLACKLIST", ")", ";", "if", "(", "blackListFileName", "!", "=", "null", ")", "addClassNames", "(", "blackListFileName", ",", "clsSet", "=", "new", "ClassSet", "(", "))", ";", "return", "clsSet", ";", "}", "/", "**", "*", "Reads", "class", "names", "from", "resource", "referred", "by", "given", "system", "property", "name", "and", "returns", "set", "of", "classes", ".", "*", "*", "@", "param", "fileName", "File", "name", "containing", "list", "of", "classes", ".", "*", "@", "param", "clsSet", "Class", "set", "for", "update", ".", "*", "@", "return", "Set", "of", "classes", ".", "*", "/", "private", "void", "addClassNames", "(", "String", "fileName", ",", "ClassSet", "clsSet", ")", "throws", "IgniteCheckedException", "{", "InputStream", "is", "=", "this", ".", "getClass", "(", ").", "getClassLoader", "(", ").", "getResourceAsStream", "(", "fileName", ")", ";", "if", "(", "is", "=", "=", "null", ")", "{", "try", "{", "is", "=", "new", "FileInputStream", "(", "new", "File", "(", "fileName", ")", ");", "}", "catch", "(", "FileNotFoundException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "File", "\"", "+", "fileName", "+", "\"", "not", "found", ".", "\")", ";", "}", "}", "try", "(", "BufferedReader", "reader", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "is", ")", "))", "{", "String", "line", ";", "for", "(", "int", "i", "=", "1", ";", "(", "line", "=", "reader", ".", "readLine", "(", "))", "!", "=", "null", ";", "i", "+", "+)", "{", "String", "s", "=", "line", ".", "trim", "(", ");", "if", "(", "!", "s", ".", "isEmpty", "(", ")", "&", "&", "s", ".", "charAt", "(", "0", ")", "!", "=", "'", "#'", "&", "&", "s", ".", "charAt", "(", "0", ")", "!", "=", "'", "['", ")", "{", "try", "{", "clsSet", ".", "add", "(", "s", ")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "Exception", "occurred", "while", "reading", "list", "of", "classes", "\"", "+", "\"", "[", "path", "=", "\"", "+", "fileName", "+", "\"", ",", "row", "=", "\"", "+", "i", "+", "\"", ",", "line", "=", "\"", "+", "s", "+", "'", "]'", ",", "e", ")", ";", "}", "}", "}", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "Exception", "occurred", "while", "reading", "and", "creating", "list", "of", "classes", "\"", "+", "\"", "[", "path", "=", "\"", "+", "fileName", "+", "'", "]'", ",", "e", ")", ";", "}", "}", "/", "**", "*", "Add", "helper", ".", "*", "@", "@", "-", "19", ",", "13", "+", "19", ",", "16", "@", "@", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "ObjectInput", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectOutput", ";", "import", "java", ".", "io", ".", "ObjectOutputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "java", ".", "nio", ".", "ByteBuffer", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "marshaller", ".", "GridClientMarshaller", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "io", ".", "GridByteArrayOutputStream", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "/", "**", "*", "Simple", "marshaller", "that", "utilize", "JDK", "serialization", "features", ".", "@", "@", "-", "34", ",", "6", "+", "37", ",", "23", "@", "@", "/", "**", "ID", ".", "*", "/", "public", "static", "final", "byte", "ID", "=", "2", ";", "/", "**", "Class", "name", "filter", ".", "*", "/", "private", "final", "IgnitePredicate", "<", "String", ">", "clsFilter", ";", "/", "**", "*", "Default", "constructor", ".", "*", "/", "public", "GridClientJdkMarshaller", "(", ")", "{", "this", "(", "null", ")", ";", "}", "/", "**", "*", "@", "param", "clsFilter", "Class", "filter", ".", "*", "/", "public", "GridClientJdkMarshaller", "(", "IgnitePredicate", "<", "String", ">", "clsFilter", ")", "{", "this", ".", "clsFilter", "=", "clsFilter", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "public", "ByteBuffer", "marshal", "(", "Object", "obj", ",", "int", "off", ")", "throws", "IOException", "{", "GridByteArrayOutputStream", "bOut", "=", "new", "GridByteArrayOutputStream", "(", ");", "@", "@", "-", "60", ",", "7", "+", "80", ",", "7", "@", "@", "@", "Override", "public", "<", "T", ">", "T", "unmarshal", "(", "byte", "[", "]", "bytes", ")", "throws", "IOException", "{", "ByteArrayInputStream", "tmp", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "ObjectInput", "in", "=", "new", "ObjectInputStream", "(", "tmp", ")", ";", "ObjectInput", "in", "=", "new", "ClientJdkInputStream", "(", "tmp", ",", "clsFilter", ")", ";", "try", "{", "return", "(", "T", ")", "in", ".", "readObject", "(", ");", "@", "@", "-", "69", ",", "4", "+", "89", ",", "33", "@", "@", "throw", "new", "IOException", "(", "\"", "Failed", "to", "unmarshal", "target", "object", ":", "\"", "+", "e", ".", "getMessage", "(", "),", "e", ")", ";", "}", "}", "/", "**", "*", "Wrapper", "with", "class", "resolving", "control", ".", "*", "/", "private", "static", "class", "ClientJdkInputStream", "extends", "ObjectInputStream", "{", "/", "**", "Class", "name", "filter", ".", "*", "/", "private", "final", "IgnitePredicate", "<", "String", ">", "clsFilter", ";", "/", "**", "*", "@", "param", "in", "Input", "stream", ".", "*", "@", "param", "clsFilter", "Class", "filter", ".", "*", "/", "public", "ClientJdkInputStream", "(", "InputStream", "in", ",", "IgnitePredicate", "<", "String", ">", "clsFilter", ")", "throws", "IOException", "{", "super", "(", "in", ")", ";", "this", ".", "clsFilter", "=", "clsFilter", ";", "}", "/", "**", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "String", "clsName", "=", "desc", ".", "getName", "(", ");", "if", "(", "clsFilter", "!", "=", "null", "&", "&", "!", "clsFilter", ".", "apply", "(", "clsName", ")", ")", "throw", "new", "RuntimeException", "(", "\"", "Deserialization", "of", "class", "\"", "+", "clsName", "+", "\"", "is", "disallowed", ".", "\")", ";", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "23", ",", "6", "+", "23", ",", "8", "@", "@", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteLogger", ";", "import", "org", ".", "apache", ".", "ignite", ".", "failure", ".", "FailureType", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "GridClientException", ";", "@", "@", "-", "42", ",", "6", "+", "44", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "nio", ".", "GridNioServerListener", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "nio", ".", "GridNioSession", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "typedef", ".", "internal", ".", "U", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "import", "org", ".", "apache", ".", "ignite", ".", "plugin", ".", "PluginProvider", ";", "import", "org", ".", "jetbrains", ".", "annotations", ".", "Nullable", ";", "@", "@", "-", "87", ",", "7", "+", "91", ",", "15", "@", "@", "public", "GridTcpRouterNioListenerAdapter", "(", "IgniteLogger", "log", ",", "GridRouterClientImpl", "cl", "marshMap", ".", "put", "(", "GridClientOptimizedMarshaller", ".", "ID", ",", "optdMarsh", ")", ";", "marshMap", ".", "put", "(", "GridClientZipOptimizedMarshaller", ".", "ID", ",", "new", "GridClientZipOptimizedMarshaller", "(", "optdMarsh", ",", "providers", ")", ");", "marshMap", ".", "put", "(", "GridClientJdkMarshaller", ".", "ID", ",", "new", "GridClientJdkMarshaller", "(", "))", ";", "try", "{", "IgnitePredicate", "<", "String", ">", "clsFilter", "=", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "marshMap", ".", "put", "(", "GridClientJdkMarshaller", ".", "ID", ",", "new", "GridClientJdkMarshaller", "(", "clsFilter", ")", ");", "}", "catch", "(", "IgniteCheckedException", "e", ")", "{", "throw", "new", "IgniteException", "(", "e", ")", ";", "}", "init", "(", ");", "}", "@", "@", "-", "27", ",", "6", "+", "27", ",", "7", "@", "@", "import", "javax", ".", "net", ".", "ssl", ".", "SSLContext", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "configuration", ".", "ConnectorConfiguration", ";", "import", "org", ".", "apache", ".", "ignite", ".", "configuration", ".", "IgniteConfiguration", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "GridKernalContext", ";", "@", "@", "-", "46", ",", "6", "+", "47", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "nio", ".", "GridNioServerListener", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "nio", ".", "ssl", ".", "GridNioSslFilter", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "util", ".", "typedef", ".", "internal", ".", "U", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "import", "org", ".", "apache", ".", "ignite", ".", "plugin", ".", "PluginProvider", ";", "import", "org", ".", "apache", ".", "ignite", ".", "spi", ".", "IgnitePortProtocol", ";", "import", "org", ".", "jetbrains", ".", "annotations", ".", "Nullable", ";", "@", "@", "-", "149", ",", "7", "+", "152", ",", "15", "@", "@", "else", "if", "(", "depFactory", "!", "=", "null", ")", "marshMap", ".", "put", "(", "GridClientOptimizedMarshaller", ".", "ID", ",", "optMarsh", ")", ";", "marshMap", ".", "put", "(", "GridClientZipOptimizedMarshaller", ".", "ID", ",", "new", "GridClientZipOptimizedMarshaller", "(", "optMarsh", ",", "providers", ")", ");", "marshMap", ".", "put", "(", "GridClientJdkMarshaller", ".", "ID", ",", "new", "GridClientJdkMarshaller", "(", "))", ";", "try", "{", "IgnitePredicate", "<", "String", ">", "clsFilter", "=", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "marshMap", ".", "put", "(", "GridClientJdkMarshaller", ".", "ID", ",", "new", "GridClientJdkMarshaller", "(", "clsFilter", ")", ");", "}", "catch", "(", "IgniteCheckedException", "e", ")", "{", "throw", "new", "IgniteException", "(", "e", ")", ";", "}", "lsnr", ".", "marshallers", "(", "marshMap", ")", ";", "}", "@", "@", "-", "17", ",", "6", "+", "17", ",", "17", "@", "@", "package", "org", ".", "apache", ".", "ignite", ".", "marshaller", ";", "import", "java", ".", "io", ".", "BufferedReader", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "FileNotFoundException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InputStreamReader", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteSystemProperties", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "ClassSet", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgniteProductVersion", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "jdk", ".", "JdkMarshaller", ";", "import", "org", ".", "jetbrains", ".", "annotations", ".", "Nullable", ";", "@", "@", "-", "83", ",", "4", "+", "94", ",", "110", "@", "@", "public", "static", "void", "jobSenderVersion", "(", "IgniteProductVersion", "ver", ")", "{", "public", "static", "IgniteProductVersion", "jobSenderVersion", "(", ")", "{", "return", "JOB_SND_NODE_VER", ".", "get", "(", ");", "}", "/", "**", "*", "Returns", "class", "name", "filter", "for", "marshaller", ".", "*", "*", "@", "return", "Class", "name", "filter", "for", "marshaller", ".", "*", "/", "public", "static", "IgnitePredicate", "<", "String", ">", "classNameFilter", "(", "ClassLoader", "clsLdr", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "whiteList", "=", "classWhiteList", "(", "clsLdr", ")", ";", "ClassSet", "blackList", "=", "classBlackList", "(", "clsLdr", ")", ";", "return", "new", "IgnitePredicate", "<", "String", ">", "()", "{", "@", "Override", "public", "boolean", "apply", "(", "String", "s", ")", "{", "/", "/", "Allows", "all", "primitive", "arrays", "and", "checks", "arrays", "'", "type", ".", "if", "(", "(", "blackList", "!", "=", "null", "|", "|", "whiteList", "!", "=", "null", ")", "&", "&", "s", ".", "charAt", "(", "0", ")", "=", "=", "'", "['", ")", "{", "if", "(", "s", ".", "charAt", "(", "1", ")", "=", "=", "'", "L", "'", "&", "&", "s", ".", "length", "(", ")", ">", "2", ")", "s", "=", "s", ".", "substring", "(", "2", ",", "s", ".", "length", "(", ")", "-", "1", ")", ";", "else", "return", "true", ";", "}", "return", "(", "blackList", "=", "=", "null", "|", "|", "!", "blackList", ".", "contains", "(", "s", ")", ")", "&", "&", "(", "whiteList", "=", "=", "null", "|", "|", "whiteList", ".", "contains", "(", "s", ")", ");", "}", "}", ";", "}", "/", "**", "*", "@", "param", "clsLdr", "Class", "loader", ".", "*", "@", "return", "White", "list", "of", "classes", ".", "*", "/", "private", "static", "ClassSet", "classWhiteList", "(", "ClassLoader", "clsLdr", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "clsSet", "=", "null", ";", "String", "fileName", "=", "IgniteSystemProperties", ".", "getString", "(", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_WHITELIST", ")", ";", "if", "(", "fileName", "!", "=", "null", ")", "{", "clsSet", "=", "new", "ClassSet", "(", ");", "addClassNames", "(", "JDK_CLS_NAMES_FILE", ",", "clsSet", ",", "clsLdr", ")", ";", "addClassNames", "(", "CLS_NAMES_FILE", ",", "clsSet", ",", "clsLdr", ")", ";", "addClassNames", "(", "fileName", ",", "clsSet", ",", "clsLdr", ")", ";", "}", "return", "clsSet", ";", "}", "/", "**", "*", "@", "param", "clsLdr", "Class", "loader", ".", "*", "@", "return", "Black", "list", "of", "classes", ".", "*", "/", "private", "static", "ClassSet", "classBlackList", "(", "ClassLoader", "clsLdr", ")", "throws", "IgniteCheckedException", "{", "ClassSet", "clsSet", "=", "null", ";", "String", "blackListFileName", "=", "IgniteSystemProperties", ".", "getString", "(", "IgniteSystemProperties", ".", "IGNITE_MARSHALLER_BLACKLIST", ")", ";", "if", "(", "blackListFileName", "!", "=", "null", ")", "addClassNames", "(", "blackListFileName", ",", "clsSet", "=", "new", "ClassSet", "(", "),", "clsLdr", ")", ";", "return", "clsSet", ";", "}", "/", "**", "*", "Reads", "class", "names", "from", "resource", "referred", "by", "given", "system", "property", "name", "and", "returns", "set", "of", "classes", ".", "*", "*", "@", "param", "fileName", "File", "name", "containing", "list", "of", "classes", ".", "*", "@", "param", "clsSet", "Class", "set", "for", "update", ".", "*", "@", "param", "clsLdr", "Class", "loader", ".", "*", "/", "private", "static", "void", "addClassNames", "(", "String", "fileName", ",", "ClassSet", "clsSet", ",", "ClassLoader", "clsLdr", ")", "throws", "IgniteCheckedException", "{", "InputStream", "is", "=", "clsLdr", ".", "getResourceAsStream", "(", "fileName", ")", ";", "if", "(", "is", "=", "=", "null", ")", "{", "try", "{", "is", "=", "new", "FileInputStream", "(", "new", "File", "(", "fileName", ")", ");", "}", "catch", "(", "FileNotFoundException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "File", "\"", "+", "fileName", "+", "\"", "not", "found", ".", "\")", ";", "}", "}", "try", "(", "BufferedReader", "reader", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "is", ")", "))", "{", "String", "line", ";", "for", "(", "int", "i", "=", "1", ";", "(", "line", "=", "reader", ".", "readLine", "(", "))", "!", "=", "null", ";", "i", "+", "+)", "{", "String", "s", "=", "line", ".", "trim", "(", ");", "if", "(", "!", "s", ".", "isEmpty", "(", ")", "&", "&", "s", ".", "charAt", "(", "0", ")", "!", "=", "'", "#'", "&", "&", "s", ".", "charAt", "(", "0", ")", "!", "=", "'", "['", ")", "{", "try", "{", "clsSet", ".", "add", "(", "s", ")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "Exception", "occurred", "while", "reading", "list", "of", "classes", "\"", "\"", "[", "path", "=", "\"", "+", "fileName", "+", "\"", ",", "row", "=", "\"", "+", "i", "+", "\"", ",", "line", "=", "\"", "+", "s", "+", "'", "]'", ",", "e", ")", ";", "}", "}", "}", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "IgniteCheckedException", "(", "\"", "Exception", "occurred", "while", "reading", "and", "creating", "list", "of", "classes", "\"", "\"", "[", "path", "=", "\"", "+", "fileName", "+", "'", "]'", ",", "e", ")", ";", "}", "}", "}", "@", "@", "-", "16", ",", "4", "+", "16", ",", "5", "@", "@", "#", "org", ".", "apache", ".", "ignite", ".", "spi", ".", "discovery", ".", "tcp", ".", "DiscoveryUnmarshalVulnerabilityTest", "$", "Exploit", "org", ".", "apache", ".", "ignite", ".", "stream", ".", "socket", ".", "SocketStreamerUnmarshalVulnerabilityTest", "$", "Exploit", "\\", "No", "newline", "at", "end", "of", "file", "org", ".", "apache", ".", "ignite", ".", "stream", ".", "socket", ".", "SocketStreamerUnmarshalVulnerabilityTest", "$", "Exploit", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "rest", ".", "TcpRestUnmarshalVulnerabilityTest", "$", "Exploit", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "17", ",", "6", "+", "17", ",", "8", "@", "@", "package", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "processors", ".", "hadoop", ".", "mapreduce", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteCheckedException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "IgniteException", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "GridClient", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "GridClientConfiguration", ";", "import", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "GridClientException", ";", "@", "@", "-", "26", ",", "6", "+", "28", ",", "8", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Collection", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "apache", ".", "ignite", ".", "lang", ".", "IgnitePredicate", ";", "import", "org", ".", "apache", ".", "ignite", ".", "marshaller", ".", "MarshallerUtils", ";", "import", "static", "org", ".", "apache", ".", "ignite", ".", "internal", ".", "client", ".", "GridClientProtocol", ".", "TCP", ";", "@", "@", "-", "83", ",", "7", "+", "87", ",", "17", "@", "@", "public", "GridClient", "client", "(", ")", "throws", "IOException", "{", "cliCfg", ".", "setProtocol", "(", "TCP", ")", ";", "cliCfg", ".", "setServers", "(", "addrs", ")", ";", "cliCfg", ".", "setMarshaller", "(", "new", "GridClientJdkMarshaller", "(", "))", ";", "try", "{", "IgnitePredicate", "<", "String", ">", "clsFilter", "=", "MarshallerUtils", ".", "classNameFilter", "(", "this", ".", "getClass", "(", ").", "getClassLoader", "(", "))", ";", "cliCfg", ".", "setMarshaller", "(", "new", "GridClientJdkMarshaller", "(", "clsFilter", ")", ");", "}", "catch", "(", "IgniteCheckedException", "e", ")", "{", "throw", "new", "IgniteException", "(", "e", ")", ";", "}", "cliCfg", ".", "setMaxConnectionIdleTime", "(", "24", "*", "60", "*", "60", "*", "1000L", ")", ";", "/", "/", "1", "day", ".", "cliCfg", ".", "setDaemon", "(", "true", ")", ";"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "Ignite", "nodes"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "208", ",", "7", "+", "208", ",", "8", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "sp", "=", "sctp_sk", "(", "asoc", "-", ">", "base", ".", "sk", ")", ";", "num_types", "=", "sp", "-", ">", "pf", "-", ">", "supported_addrs", "(", "sp", ",", "types", ")", ";", "chunksize", "=", "sizeof", "(", "init", ")", "+", "addrs_len", "+", "SCTP_SAT_LEN", "(", "num_types", ")", ";", "chunksize", "=", "sizeof", "(", "init", ")", "+", "addrs_len", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "SCTP_SAT_LEN", "(", "num_types", ")", ");", "chunksize", "+", "=", "sizeof", "(", "ecap_param", ")", ";", "if", "(", "sctp_prsctp_enable", ")", "@", "@", "-", "238", ",", "14", "+", "239", ",", "14", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "/", "*", "Add", "HMACS", "parameter", "length", "if", "any", "were", "defined", "*", "/", "auth_hmacs", "=", "(", "sctp_paramhdr_t", "*", ")", "asoc", "-", ">", "c", ".", "auth_hmacs", ";", "if", "(", "auth_hmacs", "-", ">", "length", ")", "chunksize", "+", "=", "ntohs", "(", "auth_hmacs", "-", ">", "length", ")", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "ntohs", "(", "auth_hmacs", "-", ">", "length", ")", ");", "else", "auth_hmacs", "=", "NULL", ";", "/", "*", "Add", "CHUNKS", "parameter", "length", "*", "/", "auth_chunks", "=", "(", "sctp_paramhdr_t", "*", ")", "asoc", "-", ">", "c", ".", "auth_chunks", ";", "if", "(", "auth_chunks", "-", ">", "length", ")", "chunksize", "+", "=", "ntohs", "(", "auth_chunks", "-", ">", "length", ")", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "ntohs", "(", "auth_chunks", "-", ">", "length", ")", ");", "else", "auth_chunks", "=", "NULL", ";", "@", "@", "-", "255", ",", "7", "+", "256", ",", "8", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "/", "*", "If", "we", "have", "any", "extensions", "to", "report", ",", "account", "for", "that", "*", "/", "if", "(", "num_ext", ")", "chunksize", "+", "=", "sizeof", "(", "sctp_supported_ext_param_t", ")", "+", "num_ext", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "sizeof", "(", "sctp_supported_ext_param_t", ")", "num_ext", ")", ";", "/", "*", "RFC", "2960", "3", ".", "3", ".", "2", "Initiation", "(", "INIT", ")", "(", "1", ")", "*", "@", "@", "-", "397", ",", "13", "+", "399", ",", "13", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init_ack", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "auth_hmacs", "=", "(", "sctp_paramhdr_t", "*", ")", "asoc", "-", ">", "c", ".", "auth_hmacs", ";", "if", "(", "auth_hmacs", "-", ">", "length", ")", "chunksize", "+", "=", "ntohs", "(", "auth_hmacs", "-", ">", "length", ")", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "ntohs", "(", "auth_hmacs", "-", ">", "length", ")", ");", "else", "auth_hmacs", "=", "NULL", ";", "auth_chunks", "=", "(", "sctp_paramhdr_t", "*", ")", "asoc", "-", ">", "c", ".", "auth_chunks", ";", "if", "(", "auth_chunks", "-", ">", "length", ")", "chunksize", "+", "=", "ntohs", "(", "auth_chunks", "-", ">", "length", ")", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "ntohs", "(", "auth_chunks", "-", ">", "length", ")", ");", "else", "auth_chunks", "=", "NULL", ";", "@", "@", "-", "412", ",", "7", "+", "414", ",", "8", "@", "@", "struct", "sctp_chunk", "*", "sctp_make_init_ack", "(", "const", "struct", "sctp_association", "*", "asoc", ",", "}", "if", "(", "num_ext", ")", "chunksize", "+", "=", "sizeof", "(", "sctp_supported_ext_param_t", ")", "+", "num_ext", ";", "chunksize", "+", "=", "WORD_ROUND", "(", "sizeof", "(", "sctp_supported_ext_param_t", ")", "num_ext", ")", ";", "/", "*", "Now", "allocate", "and", "fill", "out", "the", "chunk", ".", "*", "/", "retval", "=", "sctp_make_chunk", "(", "asoc", ",", "SCTP_CID_INIT_ACK", ",", "0", ",", "chunksize", ")", ";"], "docstring_tokens": ["a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "42", ",", "6", "+", "42", ",", "7", "@", "@", "import", "io", ".", "undertow", ".", "util", ".", "HeaderMap", ";", "import", "io", ".", "undertow", ".", "util", ".", "Headers", ";", "import", "io", ".", "undertow", ".", "util", ".", "HexConverter", ";", "import", "io", ".", "undertow", ".", "util", ".", "StatusCodes", ";", "import", "java", ".", "nio", ".", "charset", ".", "StandardCharsets", ";", "import", "java", ".", "security", ".", "MessageDigest", ";", "@", "@", "-", "181", ",", "7", "+", "182", ",", "7", "@", "@", "public", "AuthenticationMechanismOutcome", "authenticate", "(", "final", "HttpServerExchange", "exch", "return", "AuthenticationMechanismOutcome", ".", "NOT_ATTEMPTED", ";", "}", "public", "AuthenticationMechanismOutcome", "handleDigestHeader", "(", "HttpServerExchange", "exchange", ",", "final", "SecurityContext", "securityContext", ")", "{", "private", "AuthenticationMechanismOutcome", "handleDigestHeader", "(", "HttpServerExchange", "exchange", ",", "final", "SecurityContext", "securityContext", ")", "{", "DigestContext", "context", "=", "exchange", ".", "getAttachment", "(", "DigestContext", ".", "ATTACHMENT_KEY", ")", ";", "Map", "<", "DigestAuthorizationToken", ",", "String", ">", "parsedHeader", "=", "context", ".", "getParsedHeader", "(", ");", "/", "/", "Step", "1", "-", "Verify", "the", "set", "of", "tokens", "received", "to", "ensure", "valid", "values", ".", "@", "@", "-", "231", ",", "7", "+", "232", ",", "21", "@", "@", "public", "AuthenticationMechanismOutcome", "handleDigestHeader", "(", "HttpServerExchange", "exch", "return", "AuthenticationMechanismOutcome", ".", "NOT_AUTHENTICATED", ";", "}", "/", "/", "TODO", "-", "Validate", "the", "URI", "if", "(", "parsedHeader", ".", "containsKey", "(", "DigestAuthorizationToken", ".", "DIGEST_URI", ")", ")", "{", "String", "uri", "=", "parsedHeader", ".", "get", "(", "DigestAuthorizationToken", ".", "DIGEST_URI", ")", ";", "String", "requestURI", "=", "exchange", ".", "getRequestURI", "(", ");", "if", "(", "!", "exchange", ".", "getQueryString", "(", ").", "isEmpty", "(", "))", "{", "requestURI", "=", "requestURI", "+", "\"", "?\"", "+", "exchange", ".", "getQueryString", "(", ");", "}", "if", "(", "!", "uri", ".", "equals", "(", "requestURI", ")", ")", "{", "/", "/", "just", "end", "the", "auth", "process", "exchange", ".", "setStatusCode", "(", "StatusCodes", ".", "BAD_REQUEST", ")", ";", "exchange", ".", "endExchange", "(", ");", "return", "AuthenticationMechanismOutcome", ".", "NOT_AUTHENTICATED", ";", "}", "}", "else", "{", "return", "AuthenticationMechanismOutcome", ".", "NOT_AUTHENTICATED", ";", "}", "if", "(", "parsedHeader", ".", "containsKey", "(", "DigestAuthorizationToken", ".", "OPAQUE", ")", ")", "{", "if", "(", "!", "OPAQUE_VALUE", ".", "equals", "(", "parsedHeader", ".", "get", "(", "DigestAuthorizationToken", ".", "OPAQUE", ")", "))", "{", "@", "@", "-", "163", ",", "7", "+", "163", ",", "7", "@", "@", "private", "static", "String", "createAuthorizationLine", "(", "final", "String", "userName", ",", "final", "Strin", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "USERNAME", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\")", ".", "append", "(", "\"\\", "\"", "userOne", "\\", "\"\"", ").", "append", "(", "\",", "\")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "REALM", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "\")", ".", "append", "(", "REALM_NAME", ")", ".", "append", "(", "\"\\", "\",", "\")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "NONCE", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "\")", ".", "append", "(", "nonce", ")", ".", "append", "(", "\"\\", "\",", "\")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "DIGEST_URI", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "/\\", "\",", "\")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "DIGEST_URI", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "\"", "+", "uri", "+", "\"", "\\\"", ",\"", ");", "String", "nonceCountHex", "=", "toHex", "(", "nonceCount", ")", ";", "String", "response", "=", "createResponse", "(", "userName", ",", "REALM_NAME", ",", "password", ",", "method", ",", "uri", ",", "nonce", ",", "nonceCountHex", ",", "cnonce", ")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "RESPONSE", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "\")", ".", "append", "(", "response", ")", ".", "append", "(", "\"\\", "\",", "\")", ";", "@", "@", "-", "243", ",", "6", "+", "243", ",", "49", "@", "@", "static", "void", "_testDigestSuccess", "(", ")", "throws", "Exception", "{", "}", "}", "/", "**", "*", "Test", "for", "a", "successful", "authentication", ".", "*", "*", "Also", "makes", "two", "additional", "calls", "to", "demonstrate", "nonce", "re", "-", "use", "with", "an", "incrementing", "nonce", "count", ".", "*", "/", "@", "Test", "public", "void", "testDigestBadUri", "(", ")", "throws", "Exception", "{", "_testDigestBadUri", "(", ");", "}", "static", "void", "_testDigestBadUri", "(", ")", "throws", "Exception", "{", "TestHttpClient", "client", "=", "new", "TestHttpClient", "(", ");", "HttpGet", "get", "=", "new", "HttpGet", "(", "DefaultServer", ".", "getDefaultServerURL", "(", "))", ";", "HttpResponse", "result", "=", "client", ".", "execute", "(", "get", ")", ";", "assertEquals", "(", "StatusCodes", ".", "UNAUTHORIZED", ",", "result", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "Header", "[", "]", "values", "=", "result", ".", "getHeaders", "(", "WWW_AUTHENTICATE", ".", "toString", "(", "))", ";", "String", "value", "=", "getAuthHeader", "(", "DIGEST", ",", "values", ")", ";", "Map", "<", "DigestWWWAuthenticateToken", ",", "String", ">", "parsedHeader", "=", "DigestWWWAuthenticateToken", ".", "parseHeader", "(", "value", ".", "substring", "(", "7", ")", ");", "assertEquals", "(", "REALM_NAME", ",", "parsedHeader", ".", "get", "(", "DigestWWWAuthenticateToken", ".", "REALM", ")", ");", "assertEquals", "(", "DigestAlgorithm", ".", "MD5", ".", "getToken", "(", "),", "parsedHeader", ".", "get", "(", "DigestWWWAuthenticateToken", ".", "ALGORITHM", ")", ");", "assertEquals", "(", "DigestQop", ".", "AUTH", ".", "getToken", "(", "),", "parsedHeader", ".", "get", "(", "DigestWWWAuthenticateToken", ".", "MESSAGE_QOP", ")", ");", "String", "clientNonce", "=", "createNonce", "(", ");", "int", "nonceCount", "=", "1", ";", "String", "nonce", "=", "parsedHeader", ".", "get", "(", "DigestWWWAuthenticateToken", ".", "NONCE", ")", ";", "String", "opaque", "=", "parsedHeader", ".", "get", "(", "DigestWWWAuthenticateToken", ".", "OPAQUE", ")", ";", "assertNotNull", "(", "opaque", ")", ";", "/", "/", "Send", "5", "requests", "with", "an", "incrementing", "nonce", "count", "on", "each", "call", ".", "for", "(", "int", "i", "=", "0", ";", "i", "<", "5", ";", "i", "+", "+)", "{", "client", "=", "new", "TestHttpClient", "(", ");", "get", "=", "new", "HttpGet", "(", "DefaultServer", ".", "getDefaultServerURL", "(", "))", ";", "int", "thisNonceCount", "=", "nonceCount", "+", "+;", "String", "authorization", "=", "createAuthorizationLine", "(", "\"", "userOne", "\"", ",", "\"", "passwordOne", "\"", ",", "\"", "GET", "\"", ",", "\"", "/", "badUri", "\"", ",", "nonce", ",", "thisNonceCount", ",", "clientNonce", ",", "opaque", ")", ";", "get", ".", "addHeader", "(", "AUTHORIZATION", ".", "toString", "(", "),", "authorization", ")", ";", "result", "=", "client", ".", "execute", "(", "get", ")", ";", "assertEquals", "(", "StatusCodes", ".", "BAD_REQUEST", ",", "result", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "}", "}", "/", "**", "*", "Test", "for", "a", "failed", "authentication", "where", "a", "bad", "username", "is", "provided", ".", "*", "/", "@", "@", "-", "119", ",", "7", "+", "119", ",", "8", "@", "@", "public", "void", "testAuthType", "(", ")", "throws", "Exception", "{", "public", "void", "testCall", "(", "final", "String", "path", ",", "final", "String", "expectedResponse", ")", "throws", "Exception", "{", "TestHttpClient", "client", "=", "new", "TestHttpClient", "(", ");", "String", "url", "=", "DefaultServer", ".", "getDefaultServerURL", "(", ")", "+", "\"", "/", "servletContext", "/", "secured", "/", "\"", "+", "path", ";", "String", "servletPath", "=", "\"", "/", "servletContext", "/", "secured", "/", "\"", "+", "path", ";", "String", "url", "=", "DefaultServer", ".", "getDefaultServerURL", "(", ")", "+", "servletPath", ";", "HttpGet", "get", "=", "new", "HttpGet", "(", "url", ")", ";", "HttpResponse", "result", "=", "client", ".", "execute", "(", "get", ")", ";", "assertEquals", "(", "StatusCodes", ".", "UNAUTHORIZED", ",", "result", ".", "getStatusLine", "(", ").", "getStatusCode", "(", "))", ";", "@", "@", "-", "134", ",", "7", "+", "135", ",", "7", "@", "@", "public", "void", "testCall", "(", "final", "String", "path", ",", "final", "String", "expectedResponse", ")", "throws", "Ex", "String", "nonce", "=", "parsedHeader", ".", "get", "(", "DigestWWWAuthenticateToken", ".", "NONCE", ")", ";", "String", "clientResponse", "=", "createResponse", "(", "\"", "user1", "\"", ",", "REALM_NAME", ",", "\"", "password1", "\"", ",", "\"", "GET", "\"", ",", "\"", "/\"", ",", "nonce", ")", ";", "String", "clientResponse", "=", "createResponse", "(", "\"", "user1", "\"", ",", "REALM_NAME", ",", "\"", "password1", "\"", ",", "\"", "GET", "\"", ",", "servletPath", ",", "nonce", ")", ";", "client", "=", "new", "TestHttpClient", "(", ");", "get", "=", "new", "HttpGet", "(", "url", ")", ";", "@", "@", "-", "143", ",", "7", "+", "144", ",", "7", "@", "@", "public", "void", "testCall", "(", "final", "String", "path", ",", "final", "String", "expectedResponse", ")", "throws", "Ex", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "USERNAME", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\")", ".", "append", "(", "\"\\", "\"", "user1", "\\", "\"\"", ").", "append", "(", "\",", "\")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "REALM", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "\")", ".", "append", "(", "REALM_NAME", ")", ".", "append", "(", "\"\\", "\",", "\")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "NONCE", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "\")", ".", "append", "(", "nonce", ")", ".", "append", "(", "\"\\", "\",", "\")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "DIGEST_URI", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "/\\", "\",", "\")", ";", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "DIGEST_URI", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "\"", "+", "servletPath", "+", "\"", "\\\"", ",\"", ");", "sb", ".", "append", "(", "DigestAuthorizationToken", ".", "RESPONSE", ".", "getName", "(", "))", ".", "append", "(", "\"=", "\\\"", "\")", ".", "append", "(", "clientResponse", ")", ".", "append", "(", "\"\\", "\"\"", ");", "get", ".", "addHeader", "(", "AUTHORIZATION", ".", "toString", "(", "),", "sb", ".", "toString", "(", "))", ";"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "3", "+", "1", ",", "10", "@", "@", "2019", "-", "04", "-", "23", "Dirk", "Frederickx", "(", "brushed", "AT", "apache", "DOT", "org", ")", "*", "2", ".", "11", ".", "0", "-", "M4", "-", "git", "-", "06", "*", "[", "JSPWIKI", "-", "1109", "]", "ReferredPagesPlugin", "with", "illegal", "characters", "in", "parameters", "causes", "XSS", "vulnerability", "2019", "-", "04", "-", "23", "Dirk", "Frederickx", "(", "brushed", "AT", "apache", "DOT", "org", ")", "*", "2", ".", "11", ".", "0", "-", "M4", "-", "git", "-", "05", "@", "@", "-", "72", ",", "7", "+", "72", ",", "7", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "<", "p", ">", "*", "If", "the", "build", "identifier", "is", "empty", ",", "it", "is", "not", "added", ".", "*", "/", "public", "static", "final", "String", "BUILD", "=", "\"", "05", "\"", ";", "public", "static", "final", "String", "BUILD", "=", "\"", "06", "\"", ";", "/", "**", "*", "This", "is", "the", "generic", "version", "string", "you", "should", "use", "when", "printing", "out", "the", "version", ".", "It", "is", "of", "@", "@", "-", "134", ",", "8", "+", "134", ",", "8", "@", "@", "public", "String", "execute", "(", "WikiContext", "context", ",", "Map", "<", "String", ",", "String", ">", "params", ")", "throws", "m_result", ".", "append", "(", "\"<", "div", "class", "=", "\\\"", "ReferredPagesPlugin", "\\", "\">", "\\", "n", "\"", ");", "m_result", ".", "append", "(", "\"<", "a", "class", "=", "\\\"", "wikipage", "\\", "\"", "href", "=", "\\\"", "\"+", "href", "+", "\"", "\\\"", "title", "=", "\\\"", "\"", "+", "title", "+", "\"", "\\\"", ">\"", "+", "rootname", "+", "\"", "</", "a", ">", "\\", "n", "\"", ");", "\"", "\\\"", "title", "=", "\\\"", "\"", "+", "TextUtil", ".", "replaceEntities", "(", "title", ")", "\"", "\\\"", ">\"", "+", "TextUtil", ".", "replaceEntities", "(", "rootname", ")", "+", "\"", "</", "a", ">", "\\", "n", "\"", ");", "m_exists", ".", "add", "(", "rootname", ")", ";", "/", "/", "pre", "compile", "all", "needed", "patterns", "@", "@", "-", "232", ",", "7", "+", "232", ",", "7", "@", "@", "private", "void", "handleLinks", "(", "WikiContext", "context", ",", "Collection", "<", "String", ">", "links", ",", "int", "depth", "}", "}", "else", "{", "if", "(", "!", "isUL", ")", "{", "isUL", "=", "true", ";", "isUL", "=", "true", ";", "m_result", ".", "append", "(", "\"<", "ul", ">", "\\", "n", "\"", ");", "}"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "11834", ",", "7", "+", "11834", ",", "7", "@", "@", "static", "int", "vmx_update_pi_irte", "(", "struct", "kvm", "*", "kvm", ",", "unsigned", "int", "host_irq", ",", "struct", "kvm_lapic_irq", "irq", ";", "struct", "kvm_vcpu", "*", "vcpu", ";", "struct", "vcpu_data", "vcpu_info", ";", "int", "idx", ",", "ret", "=", "-", "EINVAL", ";", "int", "idx", ",", "ret", "=", "0", ";", "if", "(", "!", "kvm_arch_has_assigned_device", "(", "kvm", ")", "|", "|", "!", "irq_remapping_cap", "(", "IRQ_POSTING_CAP", ")", "|", "|", "@", "@", "-", "11843", ",", "7", "+", "11843", ",", "12", "@", "@", "static", "int", "vmx_update_pi_irte", "(", "struct", "kvm", "*", "kvm", ",", "unsigned", "int", "host_irq", ",", "idx", "=", "srcu_read_lock", "(", "&", "kvm", "-", ">", "irq_srcu", ")", ";", "irq_rt", "=", "srcu_dereference", "(", "kvm", "-", ">", "irq_routing", ",", "&", "kvm", "-", ">", "irq_srcu", ")", ";", "BUG_ON", "(", "guest_irq", ">", "=", "irq_rt", "-", ">", "nr_rt_entries", ")", ";", "if", "(", "guest_irq", ">", "=", "irq_rt", "-", ">", "nr_rt_entries", "|", "|", "hlist_empty", "(", "&", "irq_rt", "-", ">", "map", "[", "guest_irq", "]", "))", "{", "pr_warn_once", "(", "\"", "no", "route", "for", "guest_irq", "%", "u", "/", "%", "u", "(", "broken", "user", "space", "?", ")\\", "n", "\"", ",", "guest_irq", ",", "irq_rt", "-", ">", "nr_rt_entries", ")", ";", "goto", "out", ";", "}", "hlist_for_each_entry", "(", "e", ",", "&", "irq_rt", "-", ">", "map", "[", "guest_irq", "]", ",", "link", ")", "{", "if", "(", "e", "-", ">", "type", "!", "=", "KVM_IRQ_ROUTING_MSI", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(assertion", "failure"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "48", ",", "6", "+", "48", ",", "7", "@", "@", "#", "include", "<", "asm", "/", "uaccess", ".", "h", ">", "#", "include", "<", "rdma", "/", "ib", ".", "h", ">", "#", "include", "<", "rdma", "/", "ib_cm", ".", "h", ">", "#", "include", "<", "rdma", "/", "ib_user_cm", ".", "h", ">", "#", "include", "<", "rdma", "/", "ib_marshall", ".", "h", ">", "@", "@", "-", "1103", ",", "6", "+", "1104", ",", "9", "@", "@", "static", "ssize_t", "ib_ucm_write", "(", "struct", "file", "*", "filp", ",", "const", "char", "__user", "*", "buf", ",", "struct", "ib_ucm_cmd_hdr", "hdr", ";", "ssize_t", "result", ";", "if", "(", "WARN_ON_ONCE", "(", "!", "ib_safe_file_access", "(", "filp", ")", "))", "return", "-", "EACCES", ";", "if", "(", "len", "<", "sizeof", "(", "hdr", ")", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "1574", ",", "6", "+", "1574", ",", "9", "@", "@", "static", "ssize_t", "ucma_write", "(", "struct", "file", "*", "filp", ",", "const", "char", "__user", "*", "buf", ",", "struct", "rdma_ucm_cmd_hdr", "hdr", ";", "ssize_t", "ret", ";", "if", "(", "WARN_ON_ONCE", "(", "!", "ib_safe_file_access", "(", "filp", ")", "))", "return", "-", "EACCES", ";", "if", "(", "len", "<", "sizeof", "(", "hdr", ")", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "48", ",", "6", "+", "48", ",", "8", "@", "@", "#", "include", "<", "asm", "/", "uaccess", ".", "h", ">", "#", "include", "<", "rdma", "/", "ib", ".", "h", ">", "#", "include", "\"", "uverbs", ".", "h", "\"", "MODULE_AUTHOR", "(", "\"", "Roland", "Dreier", "\"", ");", "@", "@", "-", "709", ",", "6", "+", "711", ",", "9", "@", "@", "static", "ssize_t", "ib_uverbs_write", "(", "struct", "file", "*", "filp", ",", "const", "char", "__user", "*", "buf", ",", "int", "srcu_key", ";", "ssize_t", "ret", ";", "if", "(", "WARN_ON_ONCE", "(", "!", "ib_safe_file_access", "(", "filp", ")", "))", "return", "-", "EACCES", ";", "if", "(", "count", "<", "sizeof", "hdr", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "45", ",", "6", "+", "45", ",", "8", "@", "@", "#", "include", "<", "linux", "/", "export", ".", "h", ">", "#", "include", "<", "linux", "/", "uio", ".", "h", ">", "#", "include", "<", "rdma", "/", "ib", ".", "h", ">", "#", "include", "\"", "qib", ".", "h", "\"", "#", "include", "\"", "qib_common", ".", "h", "\"", "#", "include", "\"", "qib_user_sdma", ".", "h", "\"", "@", "@", "-", "2067", ",", "6", "+", "2069", ",", "9", "@", "@", "static", "ssize_t", "qib_write", "(", "struct", "file", "*", "fp", ",", "const", "char", "__user", "*", "data", ",", "ssize_t", "ret", "=", "0", ";", "void", "*", "dest", ";", "if", "(", "WARN_ON_ONCE", "(", "!", "ib_safe_file_access", "(", "fp", ")", "))", "return", "-", "EACCES", ";", "if", "(", "count", "<", "sizeof", "(", "cmd", ".", "type", ")", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "bail", ";", "@", "@", "-", "3", ",", "4", "+", "3", ",", "4", "@", "@", "July", ",", "2015", "-", "Remove", "unneeded", "file", "entries", "in", "sysfs", "-", "Remove", "software", "processing", "of", "IB", "protocol", "and", "place", "in", "library", "for", "use", "by", "qib", ",", "ipath", "(", "if", "still", "present", ")", ",", "hfi1", ",", "and", "eventually", "soft", "-", "roce", "-", "Replace", "incorrect", "uAPI", "@", "@", "-", "49", ",", "6", "+", "49", ",", "8", "@", "@", "#", "include", "<", "linux", "/", "vmalloc", ".", "h", ">", "#", "include", "<", "linux", "/", "io", ".", "h", ">", "#", "include", "<", "rdma", "/", "ib", ".", "h", ">", "#", "include", "\"", "hfi", ".", "h", "\"", "#", "include", "\"", "pio", ".", "h", "\"", "#", "include", "\"", "device", ".", "h", "\"", "@", "@", "-", "190", ",", "6", "+", "192", ",", "10", "@", "@", "static", "ssize_t", "hfi1_file_write", "(", "struct", "file", "*", "fp", ",", "const", "char", "__user", "*", "data", ",", "int", "uctxt_required", "=", "1", ";", "int", "must_be_root", "=", "0", ";", "/", "*", "FIXME", ":", "This", "interface", "cannot", "continue", "out", "of", "staging", "*", "/", "if", "(", "WARN_ON_ONCE", "(", "!", "ib_safe_file_access", "(", "fp", ")", "))", "return", "-", "EACCES", ";", "if", "(", "count", "<", "sizeof", "(", "cmd", ")", ")", "{", "ret", "=", "-", "EINVAL", ";", "goto", "bail", ";", "@", "@", "-", "34", ",", "6", "+", "34", ",", "7", "@", "@", "#", "define", "_RDMA_IB_H", "#", "include", "<", "linux", "/", "types", ".", "h", ">", "#", "include", "<", "linux", "/", "sched", ".", "h", ">", "struct", "ib_addr", "{", "union", "{", "@", "@", "-", "86", ",", "4", "+", "87", ",", "19", "@", "@", "struct", "sockaddr_ib", "{", "__u64", "sib_scope_id", ";", "}", ";", "/", "*", "*", "The", "IB", "interfaces", "that", "use", "write", "(", ")", "as", "bi", "-", "directional", "ioctl", "(", ")", "are", "*", "fundamentally", "unsafe", ",", "since", "there", "are", "lots", "of", "ways", "to", "trigger", "\"", "write", "(", ")\"", "*", "calls", "from", "various", "contexts", "with", "elevated", "privileges", ".", "That", "includes", "the", "*", "traditional", "suid", "executable", "error", "message", "writes", ",", "but", "also", "various", "kernel", "*", "interfaces", "that", "can", "write", "to", "file", "descriptors", ".", "*", "*", "This", "function", "provides", "protection", "for", "the", "legacy", "API", "by", "restricting", "the", "*", "calling", "context", ".", "*", "/", "static", "inline", "bool", "ib_safe_file_access", "(", "struct", "file", "*", "filp", ")", "{", "return", "filp", "-", ">", "f_cred", "=", "=", "current_cred", "(", ")", "&", "&", "segment_eq", "(", "get_fs", "(", "),", "USER_DS", ")", ";", "}", "#", "endif", "/", "*", "_RDMA_IB_H", "*", "/"], "docstring_tokens": ["the", "return", "structure", "that", "is", "normally", "written", "to", "user", "space", "being", "shunted", "off", "to", "user", "specified", "kernel", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "293", ",", "12", "+", "293", ",", "13", "@", "@", "static", "inline", "int", "restore_fpu_checking", "(", "struct", "task_struct", "*", "tsk", ")", "/", "*", "AMD", "K7", "/", "K8", "CPUs", "don", "'", "t", "save", "/", "restore", "FDP", "/", "FIP", "/", "FOP", "unless", "an", "exception", "is", "pending", ".", "Clear", "the", "x87", "state", "here", "by", "setting", "it", "to", "fixed", "values", ".", "\"", "m", "\"", "is", "a", "random", "variable", "that", "should", "be", "in", "L1", "*", "/", "alternative_input", "(", "ASM_NOP8", "ASM_NOP2", ",", "\"", "emms", "\\", "n", "\\", "t", "\"", "/", "*", "clear", "stack", "tags", "*", "/", "\"", "fildl", "%", "P", "[", "addr", "]", "\",", "/", "*", "set", "F", "?", "P", "to", "defined", "value", "*", "/", "X86_FEATURE_FXSAVE_LEAK", ",", "[", "addr", "]", "\"", "m", "\"", "(", "tsk", "-", ">", "thread", ".", "fpu", ".", "has_fpu", ")", ");", "if", "(", "unlikely", "(", "static_cpu_has", "(", "X86_FEATURE_FXSAVE_LEAK", ")", "))", "{", "asm", "volatile", "(", "\"", "fnclex", "\\", "n", "\\", "t", "\"", "\"", "emms", "\\", "n", "\\", "t", "\"", "\"", "fildl", "%", "P", "[", "addr", "]", "\"", "/", "*", "set", "F", "?", "P", "to", "defined", "value", "*", "/", ":", ":", "[", "addr", "]", "\"", "m", "\"", "(", "tsk", "-", ">", "thread", ".", "fpu", ".", "has_fpu", ")", ");", "}", "return", "fpu_restore_checking", "(", "&", "tsk", "-", ">", "thread", ".", "fpu", ")", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(task", "kill", ")", "or", "possibly", "gain", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "4", ",", "6", "+", "4", ",", "9", "@", "@", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Array", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "org", ".", "junit", ".", "Rule", ";", "@", "@", "-", "229", ",", "7", "+", "232", ",", "45", "@", "@", "public", "File", "newFolder", "(", ")", "throws", "IOException", "{", "return", "createTemporaryFolderIn", "(", "getRoot", "(", "))", ";", "}", "private", "File", "createTemporaryFolderIn", "(", "File", "parentFolder", ")", "throws", "IOException", "{", "private", "static", "File", "createTemporaryFolderIn", "(", "File", "parentFolder", ")", "throws", "IOException", "{", "try", "{", "return", "createTemporaryFolderWithNioApi", "(", "parentFolder", ")", ";", "}", "catch", "(", "ClassNotFoundException", "ignore", ")", "{", "/", "/", "Fallback", "for", "Java", "5", "and", "6", "return", "createTemporaryFolderWithFileApi", "(", "parentFolder", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "Throwable", "cause", "=", "e", ".", "getCause", "(", ");", "if", "(", "cause", "instanceof", "IOException", ")", "{", "throw", "(", "IOException", ")", "cause", ";", "}", "if", "(", "cause", "instanceof", "RuntimeException", ")", "{", "throw", "(", "RuntimeException", ")", "cause", ";", "}", "IOException", "exception", "=", "new", "IOException", "(", "\"", "Failed", "to", "create", "temporary", "folder", "in", "\"", "+", "parentFolder", ")", ";", "exception", ".", "initCause", "(", "cause", ")", ";", "throw", "exception", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "Failed", "to", "create", "temporary", "folder", "in", "\"", "+", "parentFolder", ",", "e", ")", ";", "}", "}", "private", "static", "File", "createTemporaryFolderWithNioApi", "(", "File", "parentFolder", ")", "throws", "ClassNotFoundException", ",", "NoSuchMethodException", ",", "InvocationTargetException", ",", "IllegalAccessException", "{", "Class", "<", "?>", "filesClass", "=", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "Files", "\"", ");", "Object", "fileAttributeArray", "=", "Array", ".", "newInstance", "(", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "attribute", ".", "FileAttribute", "\"", "),", "0", ")", ";", "Class", "<", "?>", "pathClass", "=", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "Path", "\"", ");", "Object", "tempDir", ";", "if", "(", "parentFolder", "!", "=", "null", ")", "{", "Method", "createTempDirectoryMethod", "=", "filesClass", ".", "getDeclaredMethod", "(", "\"", "createTempDirectory", "\"", ",", "pathClass", ",", "String", ".", "class", ",", "fileAttributeArray", ".", "getClass", "(", "))", ";", "Object", "parentPath", "=", "File", ".", "class", ".", "getDeclaredMethod", "(", "\"", "toPath", "\"", ").", "invoke", "(", "parentFolder", ")", ";", "tempDir", "=", "createTempDirectoryMethod", ".", "invoke", "(", "null", ",", "parentPath", ",", "TMP_PREFIX", ",", "fileAttributeArray", ")", ";", "}", "else", "{", "Method", "createTempDirectoryMethod", "=", "filesClass", ".", "getDeclaredMethod", "(", "\"", "createTempDirectory", "\"", ",", "String", ".", "class", ",", "fileAttributeArray", ".", "getClass", "(", "))", ";", "tempDir", "=", "createTempDirectoryMethod", ".", "invoke", "(", "null", ",", "TMP_PREFIX", ",", "fileAttributeArray", ")", ";", "}", "return", "(", "File", ")", "pathClass", ".", "getDeclaredMethod", "(", "\"", "toFile", "\"", ").", "invoke", "(", "tempDir", ")", ";", "}", "private", "static", "File", "createTemporaryFolderWithFileApi", "(", "File", "parentFolder", ")", "throws", "IOException", "{", "File", "createdFolder", "=", "null", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "TEMP_DIR_ATTEMPTS", ";", "+", "+", "i", ")", "{", "/", "/", "Use", "createTempFile", "to", "get", "a", "suitable", "folder", "name", ".", "@", "@", "-", "3", ",", "21", "+", "3", ",", "28", "@", "@", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "MatcherAssert", ".", "assertThat", ";", "import", "static", "org", ".", "hamcrest", ".", "core", ".", "IsNot", ".", "not", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "junit", ".", "Assume", ".", "assumeTrue", ";", "import", "static", "org", ".", "junit", ".", "experimental", ".", "results", ".", "PrintableResult", ".", "testResult", ";", "import", "static", "org", ".", "junit", ".", "experimental", ".", "results", ".", "ResultMatchers", ".", "failureCountIs", ";", "import", "static", "org", ".", "junit", ".", "experimental", ".", "results", ".", "ResultMatchers", ".", "isSuccessful", ";", "import", "java", ".", "io", ".", "File", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Array", ";", "import", "java", ".", "lang", ".", "reflect", ".", "InvocationTargetException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "SortedSet", ";", "import", "java", ".", "util", ".", "TreeSet", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "AssumptionViolatedException", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "junit", ".", "rules", ".", "TemporaryFolder", ";", "public", "class", "TempFolderRuleTest", "{", "private", "static", "File", "[", "]", "createdFiles", "=", "new", "File", "[", "20", "]", ";", "@", "@", "-", "182", ",", "6", "+", "189", ",", "34", "@", "@", "public", "void", "recursiveDeleteFolderWithZeroElements", "(", ")", "throws", "IOException", "{", "assertFalse", "(", "folder", ".", "getRoot", "(", ").", "exists", "(", "))", ";", "}", "@", "Test", "public", "void", "tempFolderIsOnlyAccessibleByOwner", "(", ")", "throws", "IOException", "{", "TemporaryFolder", "folder", "=", "new", "TemporaryFolder", "(", ");", "folder", ".", "create", "(", ");", "Set", "<", "String", ">", "expectedPermissions", "=", "new", "TreeSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "\"", "OWNER_READ", "\"", ",", "\"", "OWNER_WRITE", "\"", ",", "\"", "OWNER_EXECUTE", "\"", "))", ";", "Set", "<", "String", ">", "actualPermissions", "=", "getPosixFilePermissions", "(", "folder", ".", "getRoot", "(", "))", ";", "assertEquals", "(", "expectedPermissions", ",", "actualPermissions", ")", ";", "}", "private", "Set", "<", "String", ">", "getPosixFilePermissions", "(", "File", "root", ")", "{", "try", "{", "Class", "<", "?>", "pathClass", "=", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "Path", "\"", ");", "Object", "linkOptionArray", "=", "Array", ".", "newInstance", "(", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "LinkOption", "\"", "),", "0", ")", ";", "Class", "<", "?>", "filesClass", "=", "Class", ".", "forName", "(", "\"", "java", ".", "nio", ".", "file", ".", "Files", "\"", ");", "Object", "path", "=", "File", ".", "class", ".", "getDeclaredMethod", "(", "\"", "toPath", "\"", ").", "invoke", "(", "root", ")", ";", "Method", "posixFilePermissionsMethod", "=", "filesClass", ".", "getDeclaredMethod", "(", "\"", "getPosixFilePermissions", "\"", ",", "pathClass", ",", "linkOptionArray", ".", "getClass", "(", "))", ";", "Set", "<", "?>", "permissions", "=", "(", "Set", "<", "?>", ")", "posixFilePermissionsMethod", ".", "invoke", "(", "null", ",", "path", ",", "linkOptionArray", ")", ";", "SortedSet", "<", "String", ">", "convertedPermissions", "=", "new", "TreeSet", "<", "String", ">", "()", ";", "for", "(", "Object", "item", ":", "permissions", ")", "{", "convertedPermissions", ".", "add", "(", "item", ".", "toString", "(", "))", ";", "}", "return", "convertedPermissions", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "AssumptionViolatedException", "(", "\"", "Test", "requires", "at", "least", "Java", "1", ".", "7", "\"", ",", "e", ")", ";", "}", "}", "public", "static", "class", "NameClashes", "{", "@", "Rule", "public", "TemporaryFolder", "folder", "=", "new", "TemporaryFolder", "(", ");"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "103", ",", "15", "+", "103", ",", "15", "@", "@", "static", "struct", "sctp_endpoint", "*", "sctp_endpoint_init", "(", "struct", "sctp_endpoint", "*", "ep", ",", "/", "*", "Initialize", "the", "CHUNKS", "parameter", "*", "/", "auth_chunks", "-", ">", "param_hdr", ".", "type", "=", "SCTP_PARAM_CHUNKS", ";", "auth_chunks", "-", ">", "param_hdr", ".", "length", "=", "htons", "(", "sizeof", "(", "sctp_paramhdr_t", ")", ");", "/", "*", "If", "the", "Add", "-", "IP", "functionality", "is", "enabled", ",", "we", "must", "*", "authenticate", ",", "ASCONF", "and", "ASCONF", "-", "ACK", "chunks", "*", "/", "if", "(", "sctp_addip_enable", ")", "{", "auth_chunks", "-", ">", "chunks", "[", "0", "]", "=", "SCTP_CID_ASCONF", ";", "auth_chunks", "-", ">", "chunks", "[", "1", "]", "=", "SCTP_CID_ASCONF_ACK", ";", "auth_chunks", "-", ">", "param_hdr", ".", "length", "=", "htons", "(", "sizeof", "(", "sctp_paramhdr_t", ")", "+", "2", ")", ";", "auth_chunks", "-", ">", "param_hdr", ".", "length", "+", "=", "htons", "(", "2", ")", ";", "}", "}", "@", "@", "-", "3055", ",", "6", "+", "3055", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_auth_chunk", "(", "struct", "sock", "*", "sk", ",", "{", "struct", "sctp_authchunk", "val", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "!", "=", "sizeof", "(", "struct", "sctp_authchunk", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "optlen", ")", ")", "@", "@", "-", "3085", ",", "6", "+", "3088", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_hmac_ident", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_hmacalgo", "*", "hmacs", ";", "int", "err", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "<", "sizeof", "(", "struct", "sctp_hmacalgo", ")", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "3123", ",", "6", "+", "3129", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_auth_key", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_association", "*", "asoc", ";", "int", "ret", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "<", "=", "sizeof", "(", "struct", "sctp_authkey", ")", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "3160", ",", "6", "+", "3169", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_active_key", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_authkeyid", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "!", "=", "sizeof", "(", "struct", "sctp_authkeyid", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "optlen", ")", ")", "@", "@", "-", "3185", ",", "6", "+", "3197", ",", "9", "@", "@", "static", "int", "sctp_setsockopt_del_key", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_authkeyid", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "optlen", "!", "=", "sizeof", "(", "struct", "sctp_authkeyid", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "optlen", ")", ")", "@", "@", "-", "5197", ",", "19", "+", "5212", ",", "29", "@", "@", "static", "int", "sctp_getsockopt_maxburst", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "static", "int", "sctp_getsockopt_hmac_ident", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "char", "__user", "*", "optval", ",", "int", "__user", "*", "optlen", ")", "{", "struct", "sctp_hmacalgo", "__user", "*", "p", "=", "(", "void", "__user", "*", ")", "optval", ";", "struct", "sctp_hmac_algo_param", "*", "hmacs", ";", "__u16", "param_len", ";", "__u16", "data_len", "=", "0", ";", "u32", "num_idents", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "hmacs", "=", "sctp_sk", "(", "sk", ")", "->", "ep", "-", ">", "auth_hmacs_list", ";", "param_len", "=", "ntohs", "(", "hmacs", "-", ">", "param_hdr", ".", "length", ")", ";", "data_len", "=", "ntohs", "(", "hmacs", "-", ">", "param_hdr", ".", "length", ")", "-", "sizeof", "(", "sctp_paramhdr_t", ")", ";", "if", "(", "len", "<", "param_len", ")", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_hmacalgo", ")", "+", "data_len", ")", "return", "-", "EINVAL", ";", "len", "=", "sizeof", "(", "struct", "sctp_hmacalgo", ")", "+", "data_len", ";", "num_idents", "=", "data_len", "/", "sizeof", "(", "u16", ")", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "optval", ",", "hmacs", "-", ">", "hmac_ids", ",", "len", ")", ")", "if", "(", "put_user", "(", "num_idents", ",", "&", "p", "-", ">", "shmac_num_idents", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "p", "-", ">", "shmac_idents", ",", "hmacs", "-", ">", "hmac_ids", ",", "data_len", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "@", "@", "-", "5219", ",", "6", "+", "5244", ",", "9", "@", "@", "static", "int", "sctp_getsockopt_active_key", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "struct", "sctp_authkeyid", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_authkeyid", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "sizeof", "(", "struct", "sctp_authkeyid", ")", "))", "@", "@", "-", "5233", ",", "6", "+", "5261", ",", "12", "@", "@", "static", "int", "sctp_getsockopt_active_key", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "else", "val", ".", "scact_keynumber", "=", "sctp_sk", "(", "sk", ")", "->", "ep", "-", ">", "active_key_id", ";", "len", "=", "sizeof", "(", "struct", "sctp_authkeyid", ")", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "optval", ",", "&", "val", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "@", "@", "-", "5243", ",", "13", "+", "5277", ",", "16", "@", "@", "static", "int", "sctp_getsockopt_peer_auth_chunks", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "struct", "sctp_authchunks", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "struct", "sctp_chunks_param", "*", "ch", ";", "u32", "num_chunks", ";", "u32", "num_chunks", "=", "0", ";", "char", "__user", "*", "to", ";", "if", "(", "len", "<", "=", "sizeof", "(", "struct", "sctp_authchunks", ")", ")", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_authchunks", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "p", ",", "sizeof", "(", "struct", "sctp_authchunks", ")", "))", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "sizeof", "(", "struct", "sctp_authchunks", ")", "))", "return", "-", "EFAULT", ";", "to", "=", "p", "-", ">", "gauth_chunks", ";", "@", "@", "-", "5258", ",", "20", "+", "5295", ",", "21", "@", "@", "static", "int", "sctp_getsockopt_peer_auth_chunks", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "return", "-", "EINVAL", ";", "ch", "=", "asoc", "-", ">", "peer", ".", "peer_chunks", ";", "if", "(", "!", "ch", ")", "goto", "num", ";", "/", "*", "See", "if", "the", "user", "provided", "enough", "room", "for", "all", "the", "data", "*", "/", "num_chunks", "=", "ntohs", "(", "ch", "-", ">", "param_hdr", ".", "length", ")", "-", "sizeof", "(", "sctp_paramhdr_t", ")", ";", "if", "(", "len", "<", "num_chunks", ")", "return", "-", "EINVAL", ";", "len", "=", "num_chunks", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "if", "(", "copy_to_user", "(", "to", ",", "ch", "-", ">", "chunks", ",", "num_chunks", ")", ")", "return", "-", "EFAULT", ";", "num", ":", "len", "=", "sizeof", "(", "struct", "sctp_authchunks", ")", "+", "num_chunks", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "put_user", "(", "num_chunks", ",", "&", "p", "-", ">", "gauth_number_of_chunks", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "to", ",", "ch", "-", ">", "chunks", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "@", "@", "-", "5282", ",", "13", "+", "5320", ",", "16", "@", "@", "static", "int", "sctp_getsockopt_local_auth_chunks", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "struct", "sctp_authchunks", "val", ";", "struct", "sctp_association", "*", "asoc", ";", "struct", "sctp_chunks_param", "*", "ch", ";", "u32", "num_chunks", ";", "u32", "num_chunks", "=", "0", ";", "char", "__user", "*", "to", ";", "if", "(", "len", "<", "=", "sizeof", "(", "struct", "sctp_authchunks", ")", ")", "if", "(", "!", "sctp_auth_enable", ")", "return", "-", "EACCES", ";", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_authchunks", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "&", "val", ",", "p", ",", "sizeof", "(", "struct", "sctp_authchunks", ")", "))", "if", "(", "copy_from_user", "(", "&", "val", ",", "optval", ",", "sizeof", "(", "struct", "sctp_authchunks", ")", "))", "return", "-", "EFAULT", ";", "to", "=", "p", "-", ">", "gauth_chunks", ";", "@", "@", "-", "5301", ",", "17", "+", "5342", ",", "21", "@", "@", "static", "int", "sctp_getsockopt_local_auth_chunks", "(", "struct", "sock", "*", "sk", ",", "int", "len", ",", "else", "ch", "=", "sctp_sk", "(", "sk", ")", "->", "ep", "-", ">", "auth_chunk_list", ";", "if", "(", "!", "ch", ")", "goto", "num", ";", "num_chunks", "=", "ntohs", "(", "ch", "-", ">", "param_hdr", ".", "length", ")", "-", "sizeof", "(", "sctp_paramhdr_t", ")", ";", "if", "(", "len", "<", "num_chunks", ")", "if", "(", "len", "<", "sizeof", "(", "struct", "sctp_authchunks", ")", "+", "num_chunks", ")", "return", "-", "EINVAL", ";", "len", "=", "num_chunks", ";", "if", "(", "copy_to_user", "(", "to", ",", "ch", "-", ">", "chunks", ",", "num_chunks", ")", ")", "return", "-", "EFAULT", ";", "num", ":", "len", "=", "sizeof", "(", "struct", "sctp_authchunks", ")", "+", "num_chunks", ";", "if", "(", "put_user", "(", "len", ",", "optlen", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "put_user", "(", "num_chunks", ",", "&", "p", "-", ">", "gauth_number_of_chunks", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "copy_to_user", "(", "to", ",", "ch", "-", ">", "chunks", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}"], "docstring_tokens": ["a", "system", "panic", "and", "result", "in", "a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "61", ",", "7", "+", "61", ",", "6", "@", "@", "before", "the", "more", "general", "line", "given", "above", "as", "the", "first", "match", "is", "the", "one", "taken", ".", "create", "dns_resolver", "foo", ":", "*", "*", "/", "usr", "/", "sbin", "/", "dns", ".", "foo", "%", "k", "=", "==", "==", "USAGE", "=", "==", "==", "@", "@", "-", "104", ",", "6", "+", "103", ",", "14", "@", "@", "implemented", "in", "the", "module", "can", "be", "called", "after", "doing", ":", "returned", "also", ".", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "READING", "DNS", "KEYS", "FROM", "USERSPACE", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "Keys", "of", "dns_resolver", "type", "can", "be", "read", "from", "userspace", "using", "keyctl_read", "(", ")", "or", "\"", "keyctl", "read", "/", "print", "/", "pipe", "\"", ".", "=", "==", "==", "==", "==", "MECHANISM", "=", "==", "==", "==", "==", "@", "@", "-", "67", ",", "8", "+", "67", ",", "9", "@", "@", "dns_resolver_instantiate", "(", "struct", "key", "*", "key", ",", "const", "void", "*", "_data", ",", "size_t", "datalen", ")", "size_t", "result_len", "=", "0", ";", "const", "char", "*", "data", "=", "_data", ",", "*", "end", ",", "*", "opt", ";", "kenter", "(", "\"%", "%%", "d", ",", "%", "s", ",", "'%", "s", "'", ",%", "zu", "\"", ",", "key", "-", ">", "serial", ",", "key", "-", ">", "description", ",", "data", ",", "datalen", ")", ";", "kenter", "(", "\"%", "%%", "d", ",", "%", "s", ",", "'%", "*.", "*", "s", "'", ",%", "zu", "\"", ",", "key", "-", ">", "serial", ",", "key", "-", ">", "description", ",", "(", "int", ")", "datalen", ",", "(", "int", ")", "datalen", ",", "data", ",", "datalen", ")", ";", "if", "(", "datalen", "<", "=", "1", "|", "|", "!", "data", "|", "|", "data", "[", "datalen", "-", "1", "]", "!", "=", "'", "\\", "0", "'", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "217", ",", "14", "+", "218", ",", "27", "@", "@", "static", "void", "dns_resolver_describe", "(", "const", "struct", "key", "*", "key", ",", "struct", "seq_file", "*", "m", ")", "seq_printf", "(", "m", ",", "\"", ":", "%", "u", "\"", ",", "key", "-", ">", "datalen", ")", ";", "}", "/", "*", "*", "read", "the", "DNS", "data", "*", "-", "the", "key", "'", "s", "semaphore", "is", "read", "-", "locked", "*", "/", "static", "long", "dns_resolver_read", "(", "const", "struct", "key", "*", "key", ",", "char", "__user", "*", "buffer", ",", "size_t", "buflen", ")", "{", "if", "(", "key", "-", ">", "type_data", ".", "x", "[", "0", "]", ")", "return", "key", "-", ">", "type_data", ".", "x", "[", "0", "]", ";", "return", "user_read", "(", "key", ",", "buffer", ",", "buflen", ")", ";", "}", "struct", "key_type", "key_type_dns_resolver", "=", "{", ".", "name", "=", "\"", "dns_resolver", "\"", ",", ".", "instantiate", "=", "dns_resolver_instantiate", ",", ".", "match", "=", "dns_resolver_match", ",", ".", "revoke", "=", "user_revoke", ",", ".", "destroy", "=", "user_destroy", ",", ".", "describe", "=", "dns_resolver_describe", ",", ".", "read", "=", "user_read", ",", ".", "read", "=", "dns_resolver_read", ",", "}", ";", "static", "int", "__init", "init_dns_resolver", "(", "void", ")"], "docstring_tokens": ["a", "kernel", "OOPS"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "27", ",", "26", "+", "27", ",", "38", "@", "@", "import", "com", ".", "sonyericsson", ".", "jenkins", ".", "plugins", ".", "bfa", ".", "PluginImpl", ";", "import", "com", ".", "sonyericsson", ".", "jenkins", ".", "plugins", ".", "bfa", ".", "model", ".", "FailureCauseBuildAction", ";", "import", "com", ".", "sonyericsson", ".", "jenkins", ".", "plugins", ".", "bfa", ".", "model", ".", "FailureCauseMatrixBuildAction", ";", "import", "hudson", ".", "Extension", ";", "import", "hudson", ".", "ExtensionList", ";", "import", "hudson", ".", "ExtensionPoint", ";", "import", "hudson", ".", "Functions", ";", "import", "hudson", ".", "matrix", ".", "MatrixBuild", ";", "import", "hudson", ".", "matrix", ".", "MatrixRun", ";", "import", "hudson", ".", "model", ".", "Action", ";", "import", "hudson", ".", "model", ".", "Item", ";", "import", "hudson", ".", "model", ".", "Job", ";", "import", "hudson", ".", "model", ".", "Run", ";", "import", "hudson", ".", "model", ".", "Project", ";", "import", "hudson", ".", "model", ".", "Result", ";", "import", "hudson", ".", "util", ".", "RunList", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "List", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "hudson", ".", "model", ".", "Run", ";", "import", "hudson", ".", "util", ".", "Iterators", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "acegisecurity", ".", "AccessDeniedException", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "QueryParameter", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "Restricted", ";", "import", "org", ".", "kohsuke", ".", "accmod", ".", "restrictions", ".", "NoExternalUse", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "Ancestor", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "AncestorInPath", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "Stapler", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "import", "javax", ".", "annotation", ".", "Nonnull", ";", "import", "javax", ".", "servlet", ".", "ServletException", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "List", ";", "import", "static", "com", ".", "sonyericsson", ".", "jenkins", ".", "plugins", ".", "bfa", ".", "sod", ".", "ScanOnDemandBaseAction", ".", "ScanMode", ".", "BFA_SOD_BUILD_TYPE", ";", "import", "static", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ".", "isBlank", ";", "/", "**", "*", "Action", "class", "for", "scanning", "non", "scanned", "build", ".", "*", "@", "@", "-", "56", ",", "18", "+", "68", ",", "6", "@", "@", "/", "**", "The", "project", ".", "*", "/", "private", "Job", "project", ";", "/", "**", "*", "javascript", "file", "location", ".", "*", "/", "public", "static", "final", "String", "PLUGIN_JS_URL", "=", "\"", "/", "plugin", "/", "build", "-", "failure", "-", "analyzer", "/", "js", "/", "\";", "/", "**", "*", "nonscanned", "build", "constant", ".", "*", "/", "public", "static", "final", "String", "NON_SCANNED", "=", "\"", "nonscanned", "\"", ";", "/", "**", "The", "scan", "build", "type", ".", "*", "/", "private", "String", "buildType", ";", "/", "**", "*", "SODBaseAction", "constructor", ".", "@", "@", "-", "78", ",", "19", "+", "78", ",", "6", "@", "@", "public", "ScanOnDemandBaseAction", "(", "final", "Job", "project", ")", "{", "this", ".", "project", "=", "project", ";", "}", "/", "**", "*", "Gets", "the", "full", "path", "to", "the", "provided", "javascript", "file", ".", "*", "For", "use", "by", "jelly", "files", "to", "give", "to", "the", "client", "browser", ".", "*", "*", "@", "param", "jsName", "the", "javascript", "filename", ".", "*", "@", "return", "the", "full", "path", "from", "the", "web", "-", "context", "root", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "called", "from", "jelly", "public", "String", "getJsUrl", "(", "String", "jsName", ")", "{", "return", "PLUGIN_JS_URL", "+", "jsName", ";", "}", "@", "Override", "public", "String", "getIconFileName", "(", ")", "{", "if", "(", "hasPermission", "(", "))", "{", "@", "@", "-", "118", ",", "6", "+", "105", ",", "17", "@", "@", "public", "String", "getUrlName", "(", ")", "{", "}", "}", "/", "**", "*", "The", "full", "url", "to", "this", "action", "instance", ".", "*", "*", "@", "return", "the", "full", "url", "*", "@", "see", "Job", "#", "getUrl", "(", ")", "*", "/", "@", "Nonnull", "private", "String", "getFullUrl", "(", ")", "{", "return", "Functions", ".", "joinPath", "(", "project", ".", "getUrl", "(", "),", "getUrlName", "(", "))", ";", "}", "/", "**", "*", "Checks", "if", "the", "current", "user", "has", "{", "@", "link", "Item", "#", "CONFIGURE", "}", "or", "{", "@", "link", "Project", "#", "BUILD", "}", "permission", ".", "@", "@", "-", "152", ",", "173", "+", "150", ",", "305", "@", "@", "public", "void", "checkPermission", "(", ")", "{", "}", "/", "**", "*", "Method", "for", "finding", "all", "failed", "builds", ".", "*", "Method", "for", "remove", "matrix", "run", "actions", ".", "*", "*", "@", "return", "sodbuilds", ".", "*", "@", "param", "build", "the", "MatrixBuild", ".", "*", "/", "public", "List", "<", "Run", ">", "getAllBuilds", "(", ")", "{", "Job", "currentProject", "=", "project", ";", "List", "<", "Run", ">", "sodbuilds", "=", "new", "ArrayList", "<", "Run", ">", "()", ";", "if", "(", "currentProject", "!", "=", "null", ")", "{", "RunList", "builds", "=", "currentProject", ".", "getBuilds", "(", ");", "for", "(", "Object", "build", ":", "builds", ")", "{", "if", "(", "PluginImpl", ".", "needToAnalyze", "(", "((", "Run", ")", "build", ")", ".", "getResult", "(", "))", ")", "{", "sodbuilds", ".", "add", "(", "(", "Run", ")", "build", ")", ";", "public", "void", "removeRunActions", "(", "MatrixBuild", "build", ")", "{", "List", "<", "MatrixRun", ">", "runs", "=", "build", ".", "getRuns", "(", ");", "for", "(", "MatrixRun", "run", ":", "runs", ")", "{", "if", "(", "run", ".", "getNumber", "(", ")", "=", "=", "build", ".", "getNumber", "(", "))", "{", "FailureCauseBuildAction", "fcba", "=", "run", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ";", "if", "(", "fcba", "!", "=", "null", ")", "{", "run", ".", "getActions", "(", ").", "remove", "(", "fcba", ")", ";", "}", "FailureCauseMatrixBuildAction", "fcmba", "=", "run", ".", "getAction", "(", "FailureCauseMatrixBuildAction", ".", "class", ")", ";", "if", "(", "fcmba", "!", "=", "null", ")", "{", "run", ".", "getActions", "(", ").", "remove", "(", "fcmba", ")", ";", "}", "}", "}", "return", "sodbuilds", ";", "}", "/", "**", "*", "This", "method", "will", "set", "the", "buildType", "*", "while", "calling", "getBuilds", "from", "index", ".", "jelly", ".", "*", "Shortcut", "method", "to", "*", "{", "@", "link", "#", "getDefault", "(", ")}", ".{", "@", "link", "ScanMode", "#", "doPerformScan", "(", "ScanOnDemandBaseAction", ",", "StaplerRequest", ",", "StaplerResponse", ")", "}", "*", "If", "the", "user", "clicks", "on", "scan", "on", "the", "default", "scanmode", "page", ".", "*", "*", "@", "param", "scanTarget", "String", ".", "*", "@", "return", "builds", ".", "*", "@", "param", "request", "the", "request", "*", "@", "param", "response", "the", "response", "*", "@", "throws", "ServletException", "if", "so", "*", "@", "throws", "InterruptedException", "if", "so", "*", "@", "throws", "IOException", "if", "so", "*", "/", "public", "List", "<", "Run", ">", "getBuilds", "(", "String", "scanTarget", ")", "{", "if", "(", "scanTarget", "!", "=", "null", ")", "{", "setBuildType", "(", "scanTarget", ")", ";", "}", "return", "getBuilds", "(", ");", "public", "void", "doPerformScan", "(", "StaplerRequest", "request", ",", "StaplerResponse", "response", ")", "throws", "ServletException", ",", "InterruptedException", ",", "IOException", "{", "getDefault", "(", ").", "doPerformScan", "(", "this", ",", "request", ",", "response", ")", ";", "}", "/", "**", "*", "Method", "for", "returning", "builds", "as", "*", "per", "buildtype", ".", "*", "Finds", "the", "user", "'", "s", "default", "{", "@", "link", "ScanMode", "}", ".", "*", "If", "no", "selection", "is", "found", "in", "the", "session", ",", "or", "not", "in", "the", "request", "scope", "then", "{", "@", "link", "NonScanned", "}", "is", "returned", ".", "*", "*", "@", "return", "builds", ".", "*", "@", "return", "the", "default", "mode", ".", "*", "/", "public", "List", "<", "Run", ">", "getBuilds", "(", ")", "{", "buildType", "=", "getBuildType", "(", ");", "if", "(", "buildType", "!", "=", "null", ")", "{", "if", "(", "buildType", ".", "length", "(", ")", "=", "=", "0", "|", "|", "buildType", ".", "equals", "(", "NON_SCANNED", ")", ")", "{", "return", "getNotScannedBuilds", "(", ");", "}", "else", "{", "return", "getAllBuilds", "(", ");", "public", "ScanMode", "getDefault", "(", ")", "{", "StaplerRequest", "request", "=", "Stapler", ".", "getCurrentRequest", "(", ");", "if", "(", "request", "!", "=", "null", ")", "{", "String", "selected", "=", "(", "String", ")", "request", ".", "getSession", "(", "true", ")", ".", "getAttribute", "(", "BFA_SOD_BUILD_TYPE", ")", ";", "if", "(", "!", "isBlank", "(", "selected", ")", ")", "{", "ScanMode", "mode", "=", "getMode", "(", "selected", ")", ";", "if", "(", "mode", "!", "=", "null", ")", "{", "return", "mode", ";", "}", "}", "}", "else", "{", "return", "getNotScannedBuilds", "(", ");", "}", "return", "getMode", "(", "NonScanned", ".", "URL", ")", ";", "}", "/", "**", "*", "Method", "for", "finding", "sodbuilds", ".", "*", "Stapler", "function", "to", "enable", "'", "scan", "-", "on", "-", "demand", "/", "all", "'", "etc", ".", "*", "*", "@", "param", "url", "the", "scan", "mode", "*", "*", "@", "return", "sodbuilds", ".", "*", "@", "return", "most", "likely", "a", "{", "@", "link", "ScanMode", "}", "*", "/", "public", "List", "<", "Run", ">", "getNotScannedBuilds", "(", ")", "{", "List", "<", "Run", ">", "sodbuilds", "=", "new", "ArrayList", "<", "Run", ">", "()", ";", "if", "(", "project", "!", "=", "null", ")", "{", "List", "<", "Run", ">", "builds", "=", "project", ".", "getBuilds", "(", ");", "for", "(", "Run", "build", ":", "builds", ")", "{", "final", "Result", "result", "=", "build", ".", "getResult", "(", ");", "if", "(", "result", "!", "=", "null", "&", "&", "PluginImpl", ".", "needToAnalyze", "(", "result", ")", "&", "&", "build", ".", "getActions", "(", "FailureCauseBuildAction", ".", "class", ")", ".", "isEmpty", "(", ")", "&", "&", "build", ".", "getActions", "(", "FailureCauseMatrixBuildAction", ".", "class", ")", ".", "isEmpty", "(", "))", "{", "sodbuilds", ".", "add", "(", "build", ")", ";", "}", "}", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "Stapler", "function", "public", "Object", "getDynamic", "(", "String", "url", ")", "{", "if", "(", "isBlank", "(", "url", ")", ")", "{", "return", "getDefault", "(", ");", "}", "else", "{", "return", "getMode", "(", "url", ")", ";", "}", "return", "sodbuilds", ";", "}", "/", "**", "*", "Method", "for", "remove", "matrix", "run", "actions", ".", "*", "Finds", "the", "mode", "with", "the", "provided", "url", "as", "returned", "by", "{", "@", "link", "ScanMode", "#", "getUrlName", "(", ")}", ".", "*", "*", "@", "param", "build", "the", "MatrixBuild", ".", "*", "@", "param", "url", "the", "url", "to", "match", "*", "*", "@", "return", "the", "scan", "mode", "or", "null", "if", "no", "matching", "scan", "mode", "is", "found", ".", "*", "/", "public", "void", "removeRunActions", "(", "MatrixBuild", "build", ")", "{", "List", "<", "MatrixRun", ">", "runs", "=", "build", ".", "getRuns", "(", ");", "for", "(", "MatrixRun", "run", ":", "runs", ")", "{", "if", "(", "run", ".", "getNumber", "(", ")", "=", "=", "build", ".", "getNumber", "(", "))", "{", "FailureCauseBuildAction", "fcba", "=", "run", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ";", "if", "(", "fcba", "!", "=", "null", ")", "{", "run", ".", "getActions", "(", ").", "remove", "(", "fcba", ")", ";", "}", "FailureCauseMatrixBuildAction", "fcmba", "=", "run", ".", "getAction", "(", "FailureCauseMatrixBuildAction", ".", "class", ")", ";", "if", "(", "fcmba", "!", "=", "null", ")", "{", "run", ".", "getActions", "(", ").", "remove", "(", "fcmba", ")", ";", "}", "public", "ScanMode", "getMode", "(", "String", "url", ")", "{", "for", "(", "ScanMode", "mode", ":", "ExtensionList", ".", "lookup", "(", "ScanMode", ".", "class", ")", ")", "{", "if", "(", "mode", ".", "getUrlName", "(", ").", "equals", "(", "url", ")", ")", "{", "return", "mode", ";", "}", "}", "return", "null", ";", "}", "/", "**", "*", "Submit", "method", "for", "running", "build", "scan", ".", "*", "Represents", "the", "different", "scan", "modes", "that", "can", "be", "used", "to", "re", "-", "scan", "the", "builds", "of", "a", "Job", ".", "*", "*", "@", "param", "request", "StaplerRequest", "*", "@", "param", "response", "StaplerResponse", "*", "@", "throws", "ServletException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "@", "see", "NonScanned", "*", "@", "see", "AllBuilds", "*", "/", "public", "void", "doPerformScan", "(", "StaplerRequest", "request", ",", "StaplerResponse", "response", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "checkPermission", "(", ");", "List", "<", "Run", ">", "sodbuilds", "=", "getBuilds", "(", ");", "if", "(", "!", "sodbuilds", ".", "isEmpty", "(", "))", "{", "for", "(", "Run", "sodbuild", ":", "sodbuilds", ")", "{", "FailureCauseBuildAction", "fcba", "=", "sodbuild", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ";", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "abstract", "static", "class", "ScanMode", "implements", "ExtensionPoint", "{", "/", "**", "*", "Session", "key", "used", "to", "store", "the", "default", "scan", "mode", "*", "/", "static", "final", "String", "BFA_SOD_BUILD_TYPE", "=", "\"", "bfa", "-", "sod", "-", "buildType", "\"", ";", "/", "**", "*", "If", "there", "is", "any", "run", "in", "the", "job", "matching", "this", "scan", "mode", "'", "s", "criteria", ".", "*", "Default", "implementation", "is", "{", "@", "link", "#", "getRuns", "(", "Job", ")", "}{", "@", "code", ".", "hasNext", "(", ")}", "*", "@", "param", "job", "the", "job", "to", "check", "*", "*", "@", "return", "true", "if", "so", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "Called", "by", "the", "view", "public", "boolean", "hasAnyRun", "(", "Job", "job", ")", "{", "return", "getRuns", "(", "job", ")", ".", "hasNext", "(", ");", "}", "/", "**", "*", "The", "short", "relative", "url", "name", "of", "this", "scan", "mode", ".", "*", "Also", "used", "as", "a", "short", "identifier", "of", "the", "scan", "mode", ".", "*", "*", "@", "return", "the", "url", "name", "*", "/", "@", "Nonnull", "public", "abstract", "String", "getUrlName", "(", ");", "/", "**", "*", "The", "full", "url", "from", "the", "root", "of", "Jenkins", ".", "*", "*", "@", "return", "the", "full", "url", "*", "@", "see", "ScanOnDemandBaseAction", "#", "getFullUrl", "(", ")", "*", "/", "@", "Nonnull", "public", "String", "getFullUrl", "(", ")", "{", "return", "Functions", ".", "joinPath", "(", "getParent", "(", ").", "getFullUrl", "(", "),", "getUrlName", "(", "))", ";", "}", "/", "**", "*", "Human", "readable", "name", "to", "display", ".", "*", "*", "@", "return", "the", "name", "*", "/", "@", "Nonnull", "public", "abstract", "String", "getDisplayName", "(", ");", "/", "**", "*", "Provides", "an", "iterator", "of", "the", "{", "@", "link", "Run", "}", "s", "of", "the", "provided", "job", "that", "matches", "this", "scan", "mode", ".", "*", "*", "@", "param", "job", "the", "job", "to", "filter", "builds", "from", "*", "@", "return", "an", "iterator", "of", "the", "matching", "builds", "*", "/", "@", "Nonnull", "abstract", "Iterator", "<", "Run", ">", "getRuns", "(", "Job", "job", ")", ";", "/", "**", "*", "Sets", "this", "scan", "mode", "as", "the", "default", "for", "this", "user", "on", "future", "page", "visits", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "Called", "by", "the", "view", "public", "void", "setAsDefault", "(", ")", "{", "StaplerRequest", "request", "=", "Stapler", ".", "getCurrentRequest", "(", ");", "if", "(", "request", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "setAsDefault", "(", ")", "can", "only", "be", "called", "in", "request", "scope", "\"", ");", "}", "request", ".", "getSession", "(", "true", ")", ".", "setAttribute", "(", "BFA_SOD_BUILD_TYPE", ",", "getUrlName", "(", "))", ";", "}", "/", "**", "*", "Finds", "the", "{", "@", "link", "ScanOnDemandBaseAction", "}", "in", "the", "ancestor", "path", ".", "*", "*", "Throws", "{", "@", "link", "IllegalStateException", "}", "if", "we", "are", "not", "in", "the", "request", "scope", "and", "*", "{", "@", "link", "Stapler", "#", "getCurrentRequest", "(", ")}", "returns", "null", ".", "*", "*", "@", "return", "the", "ancestor", "action", "*", "*", "/", "@", "Nonnull", "public", "ScanOnDemandBaseAction", "getParent", "(", ")", "{", "StaplerRequest", "request", "=", "Stapler", ".", "getCurrentRequest", "(", ");", "if", "(", "request", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "getParent", "can", "only", "be", "called", "from", "request", "scope", ".", "\")", ";", "}", "Ancestor", "ancestor", "=", "request", ".", "findAncestor", "(", "ScanOnDemandBaseAction", ".", "class", ")", ";", "if", "(", "ancestor", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Not", "within", "the", "path", "of", "ScanOnDemandBaseAction", "\"", ");", "}", "return", "(", "ScanOnDemandBaseAction", ")", "ancestor", ".", "getObject", "(", ");", "}", "/", "**", "*", "Submit", "method", "for", "running", "build", "scan", ".", "*", "*", "@", "param", "action", "the", "action", "we", "have", "as", "an", "ancestor", "*", "@", "param", "request", "StaplerRequest", "*", "@", "param", "response", "StaplerResponse", "*", "@", "throws", "ServletException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "/", "@", "SuppressWarnings", "(", "\"", "unused", "\"", ")", "/", "/", "Called", "by", "the", "view", "public", "void", "doPerformScan", "(", "@", "AncestorInPath", "ScanOnDemandBaseAction", "action", ",", "StaplerRequest", "request", ",", "StaplerResponse", "response", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "action", ".", "checkPermission", "(", ");", "Iterator", "<", "Run", ">", "runIterator", "=", "getRuns", "(", "action", ".", "getProject", "(", "))", ";", "while", "(", "runIterator", ".", "hasNext", "(", "))", "{", "Run", "run", "=", "runIterator", ".", "next", "(", ");", "FailureCauseBuildAction", "fcba", "=", "run", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ";", "if", "(", "fcba", "!", "=", "null", ")", "{", "sodbuild", ".", "getActions", "(", ").", "remove", "(", "fcba", ")", ";", "run", ".", "getActions", "(", ").", "remove", "(", "fcba", ")", ";", "/", "/", "TODO", "Replace", "instead", "}", "FailureCauseMatrixBuildAction", "fcmba", "=", "sodbuild", ".", "getAction", "(", "FailureCauseMatrixBuildAction", ".", "class", ")", ";", "if", "(", "sodbuild", "instanceof", "MatrixBuild", "FailureCauseMatrixBuildAction", "fcmba", "=", "run", ".", "getAction", "(", "FailureCauseMatrixBuildAction", ".", "class", ")", ";", "if", "(", "run", "instanceof", "MatrixBuild", "&", "&", "fcmba", "!", "=", "null", ")", "{", "sodbuild", ".", "getActions", "(", ").", "remove", "(", "fcmba", ")", ";", "removeRunActions", "(", "(", "MatrixBuild", ")", "sodbuild", ")", ";", "run", ".", "getActions", "(", ").", "remove", "(", "fcmba", ")", ";", "/", "/", "TODO", "Replace", "instead", "action", ".", "removeRunActions", "(", "(", "MatrixBuild", ")", "run", ")", ";", "}", "ScanOnDemandTask", "task", "=", "new", "ScanOnDemandTask", "(", "sodbuild", ")", ";", "ScanOnDemandTask", "task", "=", "new", "ScanOnDemandTask", "(", "run", ")", ";", "ScanOnDemandQueue", ".", "queue", "(", "task", ")", ";", "}", "response", ".", "sendRedirect2", "(", "Functions", ".", "joinPath", "(", "\"/", "\",", "request", ".", "getContextPath", "(", "),", "getParent", "(", ").", "getProject", "(", ").", "getUrl", "(", "))", ");", "}", "/", "**", "*", "Provides", "the", "lookup", "list", "of", "all", "registered", "{", "@", "link", "ScanMode", "}", "s", ".", "*", "*", "@", "return", "the", "list", "of", "available", "modes", ".", "*", "/", "public", "static", "List", "<", "ScanMode", ">", "all", "(", ")", "{", "return", "ExtensionList", ".", "lookup", "(", "ScanMode", ".", "class", ")", ";", "}", "response", ".", "sendRedirect", "(", "\".", "./", "\")", ";", "}", "/", "**", "*", "Returns", "the", "buildType", ".", "*", "*", "@", "return", "buildType", "String", ".", "*", "/", "public", "String", "getBuildType", "(", ")", "{", "return", "buildType", ";", "}", "/", "**", "*", "Set", "buildType", ".", "*", "*", "@", "param", "buildType", "String", ".", "*", "ScanMode", "that", "scans", "only", "previously", "non", "scanned", "builds", ".", "*", "/", "public", "void", "setBuildType", "(", "String", "buildType", ")", "{", "this", ".", "buildType", "=", "buildType", ";", "@", "Extension", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "class", "NonScanned", "extends", "ScanMode", "{", "/", "**", "*", "The", "{", "@", "link", "#", "getUrlName", "(", ")}", "of", "this", "ScanMode", ".", "*", "/", "static", "final", "String", "URL", "=", "\"", "nonscanned", "\"", ";", "@", "Nonnull", "@", "Override", "public", "String", "getUrlName", "(", ")", "{", "return", "URL", ";", "}", "@", "Nonnull", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "Messages", ".", "ScanOnDemandBaseAction_NonScanned_DisplayName", "(", ");", "}", "@", "Nonnull", "@", "Override", "Iterator", "<", "Run", ">", "getRuns", "(", "Job", "job", ")", "{", "return", "new", "Iterators", ".", "FilterIterator", "<", "Run", ">", "(", "job", ".", "getBuilds", "(", ").", "iterator", "(", "))", "{", "@", "Override", "protected", "boolean", "filter", "(", "Run", "run", ")", "{", "final", "Result", "result", "=", "run", ".", "getResult", "(", ");", "return", "result", "!", "=", "null", "&", "&", "PluginImpl", ".", "needToAnalyze", "(", "result", ")", "&", "&", "run", ".", "getActions", "(", "FailureCauseBuildAction", ".", "class", ")", ".", "isEmpty", "(", ")", "&", "&", "run", ".", "getActions", "(", "FailureCauseMatrixBuildAction", ".", "class", ")", ".", "isEmpty", "(", ");", "}", "}", ";", "}", "}", "/", "**", "*", "Select", "buildType", ".", "*", "*", "@", "param", "scanTarget", "QueryParameter", ".", "*", "@", "param", "req", "StaplerRequest", ".", "*", "@", "param", "rsp", "StaplerResponse", ".", "*", "@", "throws", "ServletException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "IOException", "if", "something", "unfortunate", "happens", ".", "*", "@", "throws", "InterruptedException", "if", "something", "unfortunate", "happens", ".", "*", "ScanMode", "that", "re", "-", "scans", "all", "builds", "regardless", "if", "they", "have", "been", "scanned", "before", "or", "not", ".", "*", "/", "public", "void", "doSelectBuildType", "(", "@", "QueryParameter", "(", "\"", "build", "\"", ")", "String", "scanTarget", ",", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "ServletException", ",", "IOException", ",", "InterruptedException", "{", "if", "(", "scanTarget", "=", "=", "null", ")", "{", "if", "(", "req", ".", "getSession", "(", ")", "!", "=", "null", "&", "&", "req", ".", "getSession", "(", ").", "getAttribute", "(", "\"", "buildType", "\"", ")", "!", "=", "null", ")", "{", "scanTarget", "=", "(", "String", ")", "req", ".", "getSession", "(", ").", "getAttribute", "(", "\"", "buildType", "\"", ");", "}", "else", "{", "scanTarget", "=", "NON_SCANNED", ";", "}", "@", "Extension", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "public", "static", "class", "AllBuilds", "extends", "ScanMode", "{", "@", "Nonnull", "@", "Override", "public", "String", "getUrlName", "(", ")", "{", "return", "\"", "all", "\"", ";", "}", "@", "Nonnull", "@", "Override", "public", "String", "getDisplayName", "(", ")", "{", "return", "Messages", ".", "ScanOnDemandBaseAction_AllBuilds_DisplayName", "(", ");", "}", "setBuildType", "(", "scanTarget", ")", ";", "if", "(", "req", ".", "getSession", "(", ")", "!", "=", "null", ")", "{", "req", ".", "getSession", "(", "true", ")", ".", "setAttribute", "(", "\"", "buildType", "\"", ",", "buildType", ")", ";", "@", "Nonnull", "@", "Override", "Iterator", "<", "Run", ">", "getRuns", "(", "Job", "job", ")", "{", "return", "new", "Iterators", ".", "FilterIterator", "<", "Run", ">", "(", "job", ".", "getBuilds", "(", ").", "iterator", "(", "))", "{", "@", "Override", "protected", "boolean", "filter", "(", "Run", "run", ")", "{", "final", "Result", "result", "=", "run", ".", "getResult", "(", ");", "return", "result", "!", "=", "null", "&", "&", "PluginImpl", ".", "needToAnalyze", "(", "result", ")", ";", "}", "}", ";", "}", "rsp", ".", "sendRedirect2", "(", "\".", "\")", ";", "}", "}", "@", "@", "-", "19", ",", "3", "+", "19", ",", "5", "@", "@", "InvalidURL_Error", "=", "Invalid", "URL", "FailedToScanFile_Error", "=", "Failed", "to", "scan", "file", "FailureScan_DisplayName", "=", "Failure", "Scan", "Options", "SodAccessDeniedException", "=", "{", "0", "}", "is", "missing", "the", "{", "1", "}", "or", "{", "2", "}", "permission", "ScanOnDemandBaseAction_NonScanned_DisplayName", "=", "Only", "non", "-", "scanned", "builds", "ScanOnDemandBaseAction_AllBuilds_DisplayName", "=", "All", "builds", "@", "@", "-", "0", ",", "0", "+", "1", ",", "85", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "2012", "Sony", "Mobile", "Communications", "AB", ".", "All", "rights", "reserved", ".", "*", "Copyright", "(", "c", ")", "2016", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "import", "com", ".", "sonyericsson", ".", "jenkins", ".", "plugins", ".", "bfa", ".", "sod", ".", "ScanOnDemandBaseAction", "def", "l", "=", "namespace", "(", "lib", ".", "LayoutTagLib", ")", "def", "st", "=", "namespace", "(", "\"", "jelly", ":", "stapler", "\"", ")", "def", "f", "=", "namespace", "(", "lib", ".", "FormTagLib", ")", "ScanOnDemandBaseAction", ".", "ScanMode", "mode", "=", "my", ";", "mode", ".", "setAsDefault", "(", ")", "l", ".", "layout", "(", "title", ":", "_", "(", "\"", "Failure", "Scan", "Options", "\"", "),", "norefresh", ":", "true", ")", "{", "l", ".", "header", "{", "mode", ".", "parent", ".", "checkPermission", "(", ")", "style", "(", "type", ":", "\"", "text", "/", "css", "\"", ",", "\"", "\"\"", "tr", ".", "disablehover", ":", "hover", "{", "background", "-", "color", ":", "white", ";", "}", "\"", "\"\"", ")", "}", "st", ".", "include", "(", "it", ":", "mode", ".", "parent", ".", "project", ",", "page", ":", "\"", "sidepanel", ".", "jelly", "\"", ")", "l", ".", "'", "main", "-", "panel", "'", "{", "f", ".", "form", "{", "f", ".", "section", "(", "title", ":", "_", "(", "\"", "Select", "the", "option", "and", "scan", "the", "builds", "\"", "))", "{", "ScanOnDemandBaseAction", ".", "ScanMode", ".", "all", "(", ").", "each", "{", "ScanOnDemandBaseAction", ".", "ScanMode", "option", "-", ">", "f", ".", "entry", "(", "field", ":", "option", ".", "urlName", ",", "help", ":", "\"", "/", "plugin", "/", "build", "-", "failure", "-", "analyzer", "/", "help", "/", "sod", "/", "${", "option", ".", "urlName", "}", ".", "html", "\"", ")", "{", "f", ".", "radio", "(", "name", ":", "\"", "buildType", "\"", ",", "value", ":", "option", ".", "urlName", ",", "onclick", ":", "\"", "document", ".", "location", "=", "'$", "{", "rootURL", "}", "/$", "{", "option", ".", "getFullUrl", "(", ")}", "';", "\",", "checked", ":", "option", "=", "=", "mode", ",", "title", ":", "option", ".", "displayName", ")", "}", "}", "}", "}", "if", "(", "!", "mode", ".", "hasAnyRun", "(", "mode", ".", "parent", ".", "project", ")", ")", "{", "f", ".", "section", "(", "title", ":", "_", "(", "\"", "No", "build", "found", "\"", "))", "{", "f", ".", "block", "{", "table", "(", "width", ":", "\"", "100", "%", "\",", "border", ":", "\"", "0", "\"", ",", "cellpadding", ":", "\"", "2", "\"", ",", "cellspacing", ":", "\"", "0", "\"", ",", "class", ":", "\"", "pane", "bigtable", "\"", ",", "style", ":", "\"", "margin", "-", "top", ":", "0", "\"", ")", "{", "tr", "{", "td", "(", ")", "td", "{", "strong", "(", "_", "(", "\"", "No", "build", "found", "to", "scan", "\"", "))", "}", "}", "}", "}", "}", "}", "else", "{", "f", ".", "form", "(", "method", ":", "\"", "POST", "\"", ",", "action", ":", "\"", "performScan", "\"", ")", "{", "f", ".", "section", "{", "f", ".", "block", "{", "f", ".", "submit", "(", "value", ":", "_", "(", "\"", "Scan", "\"", "))", "}", "}", "}", "}", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "2", ",", "6", "+", "2", ",", "7", "@", "@", "~", "The", "MIT", "License", "~", "~", "Copyright", "2012", "Sony", "Mobile", "Communications", "AB", ".", "All", "rights", "reserved", ".", "~", "Copyright", "(", "c", ")", "2016", ",", "CloudBees", ",", "Inc", ".", "~", "~", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "~", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "@", "@", "-", "22", ",", "64", "+", "23", ",", "6", "@", "@", "~", "THE", "SOFTWARE", ".", "-", "->", "<", "?", "jelly", "escape", "-", "by", "-", "default", "=", "'", "true", "'", "?>", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", "xmlns", ":", "d", "=", "\"", "jelly", ":", "define", "\"", "xmlns", ":", "l", "=", "\"/", "lib", "/", "layout", "\"", "xmlns", ":", "t", "=", "\"/", "lib", "/", "hudson", "\"", "xmlns", ":", "f", "=", "\"/", "lib", "/", "form", "\"", "xmlns", ":", "i", "=", "\"", "jelly", ":", "fmt", "\"", ">", "<", "l", ":", "layout", "title", "=", "\"$", "{%", "Failure", "Scan", "Options", "}", "\"", "norefresh", "=", "\"", "true", "\"", "permission", "=", "\"$", "{", "it", ".", "requiredPermission", "}", "\">", "<", "l", ":", "header", ">", "<", "script", "src", "=", "\"$", "{", "rootURL", "}", "${", "it", ".", "getJsUrl", "(", "'", "bfa", "-", "sod", ".", "js", "'", ")}", "\"", "type", "=", "\"", "text", "/", "javascript", "\"", "><", "/", "script", ">", "<", "style", "type", "=", "\"", "text", "/", "css", "\"", ">", "tr", ".", "disablehover", ":", "hover", "{", "background", "-", "color", ":", "white", ";", "}", "<", "/", "style", ">", "<", "/", "l", ":", "header", ">", "<", "st", ":", "include", "it", "=", "\"$", "{", "it", ".", "project", "}", "\"", "page", "=", "\"", "sidepanel", ".", "jelly", "\"", "/", ">", "<", "body", "onload", "=", "\"", "initialLoading", "(", "'$", "{", "request", ".", "session", ".", "getAttribute", "(", "'", "buildType", "'", ")}", "')", "\">", "<", "l", ":", "main", "-", "panel", ">", "<", "f", ":", "form", "method", "=", "\"", "get", "\"", "action", "=", "\"", "selectBuildType", "\"", "id", "=", "\"\"", ">", "<", "f", ":", "section", "title", "=", "\"$", "{%", "Select", "the", "option", "and", "scan", "the", "builds", "}", "\">", "<", "f", ":", "entry", "help", "=", "\"/", "plugin", "/", "build", "-", "failure", "-", "analyzer", "/", "help", "/", "help", "-", "SearchOption", ".", "html", "\"", ">", "<", "input", "type", "=", "\"", "hidden", "\"", "id", "=", "\"", "build", "\"", "name", "=", "\"", "build", "\"", "value", "=", "\"", "nonscanned", "\"", "/>", "<", "input", "type", "=", "\"", "radio", "\"", "name", "=", "\"", "buildType", "\"", "value", "=", "\"", "Only", "non", "-", "scanned", "builds", "\"", "id", "=", "\"", "nonscanned_builds", "\"", "onClick", "=", "\"", "selectBuildType", "(", "'", "nonscanned", "'", ",'", "nonscanned_builds", "'", ");", "this", ".", "form", ".", "submit", "(", ")\"", "/", ">", "Scan", "non", "-", "scanned", "builds", "<", "br", "/", ">", "<", "input", "type", "=", "\"", "radio", "\"", "name", "=", "\"", "buildType", "\"", "value", "=", "\"", "All", "builds", "\"", "id", "=", "\"", "all_builds", "\"", "onClick", "=", "\"", "selectBuildType", "(", "'", "all", "'", ",'", "all_builds", "'", ");", "this", ".", "form", ".", "submit", "(", ")\"", "/", ">", "Scan", "/", "Rescan", "all", "the", "builds", "<", "br", "/", ">", "<", "/", "f", ":", "entry", ">", "<", "br", "/", ">", "<", "/", "f", ":", "section", ">", "<", "/", "f", ":", "form", ">", "<", "j", ":", "set", "var", "=", "\"", "scanTarget", "\"", "value", "=", "\"$", "{", "request", ".", "session", ".", "getAttribute", "(", "'", "buildType", "'", ")}", "\"/", ">", "<", "j", ":", "set", "var", "=", "\"", "scanBuilds", "\"", "value", "=", "\"$", "{", "it", ".", "getBuilds", "(", "scanTarget", ")", "}\"", "/>", "<", "j", ":", "if", "test", "=", "\"$", "{", "empty", "(", "scanBuilds", ")", "}\"", ">", "<", "f", ":", "form", "method", "=", "\"", "get", "\"", "action", "=", "\"", "performScan", "\"", "name", "=", "\"", "config", "\"", ">", "<", "f", ":", "section", "title", "=", "\"$", "{%", "No", "build", "found", "}", "\">", "<", "f", ":", "block", ">", "<", "table", "width", "=", "\"", "100", "%", "\"", "border", "=", "\"", "0", "\"", "cellpadding", "=", "\"", "2", "\"", "cellspacing", "=", "\"", "0", "\"", "class", "=", "\"", "pane", "bigtable", "\"", "style", "=", "\"", "margin", "-", "top", ":", "0", "\"", ">", "<", "tr", ">", "<", "td", "/", ">", "<", "td", ">", "<", "b", ">", "$", "{%", "No", "build", "found", "for", "scanning", "}", "<", "/", "b", ">", "<", "/", "td", ">", "<", "/", "tr", ">", "<", "/", "table", ">", "<", "/", "f", ":", "block", ">", "<", "/", "f", ":", "section", ">", "<", "/", "f", ":", "form", ">", "<", "/", "j", ":", "if", ">", "<", "j", ":", "if", "test", "=", "\"$", "{!", "empty", "(", "scanBuilds", ")", "}\"", ">", "<", "f", ":", "form", "method", "=", "\"", "get", "\"", "action", "=", "\"", "performScan", "\"", ">", "<", "f", ":", "section", ">", "<", "f", ":", "block", ">", "<", "f", ":", "submit", "value", "=", "\"$", "{%", "Scan", "}", "\"/", ">", "<", "/", "f", ":", "block", ">", "<", "/", "f", ":", "section", ">", "<", "/", "f", ":", "form", ">", "<", "/", "j", ":", "if", ">", "<", "/", "l", ":", "main", "-", "panel", ">", "<", "/", "body", ">", "<", "/", "l", ":", "layout", ">", "<", "j", ":", "jelly", "xmlns", ":", "j", "=", "\"", "jelly", ":", "core", "\"", "xmlns", ":", "st", "=", "\"", "jelly", ":", "stapler", "\"", ">", "<", "st", ":", "include", "it", "=", "\"$", "{", "it", ".", "default", "}", "\"", "page", "=", "\"", "index", ".", "groovy", "\"", "/", ">", "<", "/", "j", ":", "jelly", ">", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "<", "!-", "-", "~", "The", "MIT", "License", "~", "~", "Copyright", "(", "c", ")", "2016", ",", "CloudBees", ",", "Inc", ".", "~", "~", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "~", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "~", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "~", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "~", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "~", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "~", "~", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "~", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "~", "~", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "~", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "~", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "~", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "~", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "~", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "~", "THE", "SOFTWARE", ".", "-", "->", "<", "p", ">", "Scan", "all", "the", "builds", "including", "already", "scanned", "and", "non", "-", "scanned", "builds", ".", "<", "/", "p", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "0", ",", "0", "+", "1", ",", "27", "@", "@", "<", "!-", "-", "~", "The", "MIT", "License", "~", "~", "Copyright", "(", "c", ")", "2016", ",", "CloudBees", ",", "Inc", ".", "~", "~", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "~", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "~", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "~", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "~", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "~", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "~", "~", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "~", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "~", "~", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "~", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "~", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "~", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "~", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "~", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "~", "THE", "SOFTWARE", ".", "-", "->", "<", "p", ">", "Scan", "only", "builds", "that", "have", "not", "already", "been", "scanned", ".", "<", "/", "p", ">", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "1", ",", "48", "+", "0", ",", "0", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "2013", "Sony", "Mobile", "Communications", "AB", ".", "All", "rights", "reserved", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "function", "selectBuildType", "(", "type", ",", "id", ")", "{", "var", "buildType", "=", "document", ".", "getElementById", "(", "\"", "build", "\"", ");", "if", "(", "buildType", "!", "=", "null", ")", "{", "buildType", ".", "value", "=", "type", ";", "}", "else", "{", "buildType", ".", "value", "=", "\"", "nonscanned", "\"", ";", "}", "}", "function", "initialLoading", "(", "type", ")", "{", "var", "nonscanRb", "=", "document", ".", "getElementById", "(", "\"", "nonscanned_builds", "\"", ");", "var", "allRb", "=", "document", ".", "getElementById", "(", "\"", "all_builds", "\"", ");", "if", "(", "type", ")", "{", "if", "(", "type", "=", "=\"", "nonscanned", "\"", "){", "nonscanRb", ".", "checked", "=", "true", ";", "}", "if", "(", "type", "=", "=\"", "all", "\"", "){", "allRb", ".", "checked", "=", "true", ";", "}", "}", "else", "{", "nonscanRb", ".", "checked", "=", "true", ";", "}", "}", "@", "@", "-", "41", ",", "29", "+", "41", ",", "40", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "jenkins", ".", "model", ".", "Jenkins", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "HudsonTestCase", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "MockBuilder", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerRequest", ";", "import", "org", ".", "kohsuke", ".", "stapler", ".", "StaplerResponse", ";", "import", "org", ".", "powermock", ".", "api", ".", "mockito", ".", "PowerMockito", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "fail", ";", "/", "/", "CS", "IGNORE", "MagicNumber", "FOR", "NEXT", "100", "LINES", ".", "REASON", ":", "TestData", ".", "/", "**", "*", "Tests", "for", "the", "ScanOnDemandBaseAction", ".", "*", "Tests", "for", "{", "@", "link", "ScanOnDemandBaseAction", "}", ".", "*", "@", "author", "Shemeer", "Sulaiman", "&", "lt", ";", "shemeer", ".", "x", ".", "sulaiman", "@", "sonymobile", ".", "com", "&", "gt", ";", "*", "@", "throws", "Exception", "if", "so", ".", "*", "/", "public", "class", "ScanOnDemandBaseActionTest", "extends", "HudsonTestCase", "{", "public", "class", "ScanOnDemandBaseActionTest", "{", "/", "/", "CS", "IGNORE", "VisibilityModifier", "FOR", "NEXT", "5", "LINES", ".", "REASON", ":", "by", "design", "/", "**", "*", "The", "Jenkins", "rule", ",", "duh", ".", "*", "/", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "private", "static", "final", "String", "TO_PRINT", "=", "\"", "ERROR", "\"", ";", "/", "**", "*", "Tests", "for", "performScanMethod", "by", "passing", "failed", "build", ".", "*", "*", "@", "throws", "Exception", "if", "so", ".", "*", "/", "@", "Test", "public", "void", "testPerformScanFailedProject", "(", ")", "throws", "Exception", "{", "FreeStyleProject", "project", "=", "createFreeStyleProject", "(", ");", "FreeStyleProject", "project", "=", "j", ".", "createFreeStyleProject", "(", ");", "project", ".", "getBuildersList", "(", ").", "add", "(", "new", "PrintToLogBuilder", "(", "TO_PRINT", ")", ");", "project", ".", "getBuildersList", "(", ").", "add", "(", "new", "MockBuilder", "(", "Result", ".", "FAILURE", ")", ");", "Future", "<", "FreeStyleBuild", ">", "future", "=", "project", ".", "scheduleBuild2", "(", "0", ")", ";", "@", "@", "-", "72", ",", "12", "+", "83", ",", "8", "@", "@", "public", "void", "testPerformScanFailedProject", "(", ")", "throws", "Exception", "{", "build", ".", "getActions", "(", ").", "remove", "(", "build", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ");", "}", "assertNull", "(", "build", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ");", "assertBuildStatus", "(", "Result", ".", "FAILURE", ",", "build", ")", ";", "ScanOnDemandBaseAction", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "project", ")", ";", "sodbaseaction", ".", "setBuildType", "(", "\"", "nonscanned", "\"", ");", "StaplerRequest", "mockrequest", "=", "PowerMockito", ".", "mock", "(", "StaplerRequest", ".", "class", ")", ";", "StaplerResponse", "mockresponse", "=", "PowerMockito", ".", "mock", "(", "StaplerResponse", ".", "class", ")", ";", "sodbaseaction", ".", "doPerformScan", "(", "mockrequest", ",", "mockresponse", ")", ";", "j", ".", "assertBuildStatus", "(", "Result", ".", "FAILURE", ",", "build", ")", ";", "j", ".", "createWebClient", "(", ").", "getPage", "(", "project", ",", "\"", "scan", "-", "on", "-", "demand", "/", "nonscanned", "/", "performScan", "\"", ");", "ScanOnDemandQueue", ".", "shutdown", "(", ");", "assertNotNull", "(", "build", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ");", "@", "@", "-", "88", ",", "21", "+", "95", ",", "19", "@", "@", "public", "void", "testPerformScanFailedProject", "(", ")", "throws", "Exception", "{", "*", "*", "@", "throws", "Exception", "if", "so", ".", "*", "/", "@", "Test", "public", "void", "testPerformScanSuccessProject", "(", ")", "throws", "Exception", "{", "FreeStyleProject", "project", "=", "createFreeStyleProject", "(", ");", "FreeStyleProject", "project", "=", "j", ".", "createFreeStyleProject", "(", ");", "project", ".", "getBuildersList", "(", ").", "add", "(", "new", "MockBuilder", "(", "Result", ".", "SUCCESS", ")", ");", "Future", "<", "FreeStyleBuild", ">", "future", "=", "project", ".", "scheduleBuild2", "(", "0", ")", ";", "FreeStyleBuild", "build", "=", "future", ".", "get", "(", "10", ",", "TimeUnit", ".", "SECONDS", ")", ";", "if", "(", "build", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", "!", "=", "null", ")", "{", "build", ".", "getActions", "(", ").", "remove", "(", "build", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ");", "}", "assertNull", "(", "build", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ");", "assertBuildStatus", "(", "Result", ".", "SUCCESS", ",", "build", ")", ";", "ScanOnDemandBaseAction", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "project", ")", ";", "sodbaseaction", ".", "setBuildType", "(", "\"", "nonscanned", "\"", ");", "StaplerRequest", "mockrequest", "=", "PowerMockito", ".", "mock", "(", "StaplerRequest", ".", "class", ")", ";", "StaplerResponse", "mockresponse", "=", "PowerMockito", ".", "mock", "(", "StaplerResponse", ".", "class", ")", ";", "sodbaseaction", ".", "doPerformScan", "(", "mockrequest", ",", "mockresponse", ")", ";", "j", ".", "assertBuildStatus", "(", "Result", ".", "SUCCESS", ",", "build", ")", ";", "j", ".", "createWebClient", "(", ").", "getPage", "(", "project", ",", "\"", "scan", "-", "on", "-", "demand", "/", "nonscanned", "/", "performScan", "\"", ");", "ScanOnDemandQueue", ".", "shutdown", "(", ");", "assertNull", "(", "build", ".", "getAction", "(", "FailureCauseBuildAction", ".", "class", ")", ");", "}", "@", "@", "-", "112", ",", "11", "+", "117", ",", "12", "@", "@", "public", "void", "testPerformScanSuccessProject", "(", ")", "throws", "Exception", "{", "*", "@", "throws", "Exception", "if", "problemos", "*", "@", "see", "ScanOnDemandBaseAction", "#", "hasPermission", "(", ")", "*", "/", "@", "Test", "public", "void", "testShouldOnlyShowWhenHasPermission", "(", ")", "throws", "Exception", "{", "FreeStyleProject", "project", "=", "createFreeStyleProject", "(", ");", "String", "expectedHref", "=", "\"", "/\"", "+", "project", ".", "getUrl", "(", ")", "+", "\"", "scan", "-", "on", "-", "demand", "\"", ";", "FreeStyleProject", "project", "=", "j", ".", "createFreeStyleProject", "(", ");", "String", "expectedHref", "=", "\"", "/", "jenkins", "/", "\"", "+", "project", ".", "getUrl", "(", ")", "+", "\"", "scan", "-", "on", "-", "demand", "\"", ";", "SecurityRealm", "securityRealm", "=", "createDummySecurityRealm", "(", ");", "SecurityRealm", "securityRealm", "=", "j", ".", "createDummySecurityRealm", "(", ");", "Jenkins", ".", "getInstance", "(", ").", "setSecurityRealm", "(", "securityRealm", ")", ";", "GlobalMatrixAuthorizationStrategy", "strategy", "=", "new", "GlobalMatrixAuthorizationStrategy", "(", ");", "strategy", ".", "add", "(", "Jenkins", ".", "READ", ",", "\"", "anonymous", "\"", ");", "@", "@", "-", "128", ",", "7", "+", "134", ",", "7", "@", "@", "public", "void", "testShouldOnlyShowWhenHasPermission", "(", ")", "throws", "Exception", "{", "Jenkins", ".", "getInstance", "(", ").", "setAuthorizationStrategy", "(", "strategy", ")", ";", "WebClient", "client", "=", "createWebClient", "(", ");", "JenkinsRule", ".", "WebClient", "client", "=", "j", ".", "createWebClient", "(", ");", "HtmlPage", "page", "=", "client", ".", "login", "(", "\"", "alice", "\"", ").", "getPage", "(", "project", ")", ";", "try", "{", "@", "@", "-", "151", ",", "12", "+", "157", ",", "13", "@", "@", "public", "void", "testShouldOnlyShowWhenHasPermission", "(", ")", "throws", "Exception", "{", "*", "*", "@", "throws", "Exception", "if", "problemos", "*", "/", "@", "Test", "public", "void", "testShouldOnlyShowWhenScanningIsEnabled", "(", ")", "throws", "Exception", "{", "FreeStyleProject", "project", "=", "createFreeStyleProject", "(", ");", "project", "=", "configRoundtrip", "(", "project", ")", ";", "String", "expectedHref", "=", "\"", "/\"", "+", "project", ".", "getUrl", "(", ")", "+", "\"", "scan", "-", "on", "-", "demand", "\"", ";", "FreeStyleProject", "project", "=", "j", ".", "createFreeStyleProject", "(", ");", "project", "=", "j", ".", "configRoundtrip", "(", "project", ")", ";", "String", "expectedHref", "=", "\"", "/", "jenkins", "/", "\"", "+", "project", ".", "getUrl", "(", ")", "+", "\"", "scan", "-", "on", "-", "demand", "\"", ";", "WebClient", "client", "=", "createWebClient", "(", ");", "JenkinsRule", ".", "WebClient", "client", "=", "j", ".", "createWebClient", "(", ");", "/", "/", "Assert", "visible", "HtmlPage", "page", "=", "client", ".", "getPage", "(", "project", ")", ";", "@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "*", "/", "package", "com", ".", "sonyericsson", ".", "jenkins", ".", "plugins", ".", "bfa", ".", "sod", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "Lists", ";", "import", "com", ".", "sonyericsson", ".", "jenkins", ".", "plugins", ".", "bfa", ".", "PluginImpl", ";", "import", "com", ".", "sonyericsson", ".", "jenkins", ".", "plugins", ".", "bfa", ".", "model", ".", "FoundFailureCause", ";", "import", "hudson", ".", "model", ".", "AbstractBuild", ";", "@", "@", "-", "66", ",", "7", "+", "67", ",", "6", "@", "@", "@", "PrepareForTest", "(", "{", "Jenkins", ".", "class", ",", "PluginImpl", ".", "class", ",", "ScanOnDemandQueue", ".", "class", ",", "ScanOnDemandTask", ".", "class", "}", ")", "public", "class", "ScanOnDemandTaskTest", "{", "private", "ScanOnDemandBaseAction", "sodbaseaction", ";", "private", "AbstractProject", "mockproject", ";", "private", "PluginImpl", "pluginMock", ";", "@", "@", "-", "99", ",", "8", "+", "99", ",", "8", "@", "@", "public", "void", "testOneSODbuildfoundwithBuildFailure", "(", ")", "throws", "Exception", "{", "RunList", "<", "AbstractBuild", ">", "builds", "=", "new", "RunList", "<", "AbstractBuild", ">", "(", "Collections", ".", "<", "Job", ">", "emptyList", "(", "))", ";", "Whitebox", ".", "setInternalState", "(", "builds", ",", "\"", "base", "\"", ",", "Arrays", ".", "asList", "(", "mockbuild1", ",", "mockbuild2", ")", ");", "PowerMockito", ".", "when", "(", "mockproject", ".", "getBuilds", "(", "))", ".", "thenReturn", "(", "builds", ")", ";", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "mockproject", ")", ";", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "1", ",", "sodbaseaction", ".", "getNotScannedBuilds", "(", ").", "size", "(", "))", ";", "ScanOnDemandBaseAction", ".", "NonScanned", "action", "=", "new", "ScanOnDemandBaseAction", ".", "NonScanned", "(", ");", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "1", ",", "Lists", ".", "newArrayList", "(", "action", ".", "getRuns", "(", "mockproject", ")", ").", "size", "(", "))", ";", "}", "/", "**", "@", "@", "-", "121", ",", "8", "+", "121", ",", "8", "@", "@", "public", "void", "testTwoSODbuildfoundwithBuildFailure", "(", ")", "throws", "Exception", "{", "Whitebox", ".", "setInternalState", "(", "builds", ",", "\"", "base", "\"", ",", "Arrays", ".", "asList", "(", "mockbuild1", ",", "mockbuild2", ")", ");", "PowerMockito", ".", "when", "(", "mockproject", ".", "getBuilds", "(", "))", ".", "thenReturn", "(", "builds", ")", ";", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "mockproject", ")", ";", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "2", ",", "sodbaseaction", ".", "getNotScannedBuilds", "(", ").", "size", "(", "))", ";", "ScanOnDemandBaseAction", ".", "NonScanned", "action", "=", "new", "ScanOnDemandBaseAction", ".", "NonScanned", "(", ");", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "2", ",", "Lists", ".", "newArrayList", "(", "action", ".", "getRuns", "(", "mockproject", ")", ").", "size", "(", "))", ";", "}", "/", "**", "@", "@", "-", "141", ",", "8", "+", "141", ",", "8", "@", "@", "public", "void", "testNoSODbuildfoundwithBuildSuccess", "(", ")", "{", "RunList", "<", "AbstractBuild", ">", "builds", "=", "new", "RunList", "<", "AbstractBuild", ">", "(", "Collections", ".", "<", "Job", ">", "emptyList", "(", "))", ";", "Whitebox", ".", "setInternalState", "(", "builds", ",", "\"", "base", "\"", ",", "Arrays", ".", "asList", "(", "mockbuild1", ",", "mockbuild2", ")", ");", "PowerMockito", ".", "when", "(", "mockproject", ".", "getBuilds", "(", "))", ".", "thenReturn", "(", "builds", ")", ";", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "mockproject", ")", ";", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "0", ",", "sodbaseaction", ".", "getNotScannedBuilds", "(", ").", "size", "(", "))", ";", "ScanOnDemandBaseAction", ".", "NonScanned", "action", "=", "new", "ScanOnDemandBaseAction", ".", "NonScanned", "(", ");", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "0", ",", "Lists", ".", "newArrayList", "(", "action", ".", "getRuns", "(", "mockproject", ")", ").", "size", "(", "))", ";", "}", "/", "**", "@", "@", "-", "169", ",", "8", "+", "169", ",", "8", "@", "@", "public", "void", "testNoSODbuildfoundwithBuildFailedButAlreadyScanned", "(", ")", "throws", "Excepti", "PowerMockito", ".", "when", "(", "mockbuild1", ".", "getActions", "(", "FailureCauseBuildAction", ".", "class", ")", ").", "thenReturn", "(", "failureCauseBuildActions", ")", ";", "PowerMockito", ".", "when", "(", "mockproject", ".", "getBuilds", "(", "))", ".", "thenReturn", "(", "builds", ")", ";", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "mockproject", ")", ";", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "0", ",", "sodbaseaction", ".", "getNotScannedBuilds", "(", ").", "size", "(", "))", ";", "ScanOnDemandBaseAction", ".", "NonScanned", "action", "=", "new", "ScanOnDemandBaseAction", ".", "NonScanned", "(", ");", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "0", ",", "Lists", ".", "newArrayList", "(", "action", ".", "getRuns", "(", "mockproject", ")", ").", "size", "(", "))", ";", "}", "/", "**", "@", "@", "-", "192", ",", "8", "+", "192", ",", "8", "@", "@", "public", "void", "testOneSODMatrixbuildfoundwithBuildFailure", "(", ")", "throws", "Exception", "{", "Whitebox", ".", "setInternalState", "(", "builds", ",", "\"", "base", "\"", ",", "Arrays", ".", "asList", "(", "matrixbuild1", ",", "matrixbuild2", ")", ");", "PowerMockito", ".", "when", "(", "mockproject", ".", "getBuilds", "(", "))", ".", "thenReturn", "(", "builds", ")", ";", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "mockproject", ")", ";", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "1", ",", "sodbaseaction", ".", "getNotScannedBuilds", "(", ").", "size", "(", "))", ";", "ScanOnDemandBaseAction", ".", "NonScanned", "action", "=", "new", "ScanOnDemandBaseAction", ".", "NonScanned", "(", ");", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "1", ",", "Lists", ".", "newArrayList", "(", "action", ".", "getRuns", "(", "mockproject", ")", ").", "size", "(", "))", ";", "}", "/", "**", "@", "@", "-", "215", ",", "8", "+", "215", ",", "8", "@", "@", "public", "void", "testNoSODMatrixBuildfoundwithBuildSuccess", "(", ")", "throws", "Exception", "{", "Whitebox", ".", "setInternalState", "(", "builds", ",", "\"", "base", "\"", ",", "Arrays", ".", "asList", "(", "matrixbuild1", ",", "matrixbuild2", ")", ");", "PowerMockito", ".", "when", "(", "mockproject", ".", "getBuilds", "(", "))", ".", "thenReturn", "(", "builds", ")", ";", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "mockproject", ")", ";", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "0", ",", "sodbaseaction", ".", "getNotScannedBuilds", "(", ").", "size", "(", "))", ";", "ScanOnDemandBaseAction", ".", "NonScanned", "action", "=", "new", "ScanOnDemandBaseAction", ".", "NonScanned", "(", ");", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "0", ",", "Lists", ".", "newArrayList", "(", "action", ".", "getRuns", "(", "mockproject", ")", ").", "size", "(", "))", ";", "}", "/", "**", "@", "@", "-", "243", ",", "12", "+", "243", ",", "12", "@", "@", "public", "void", "testNoSODmatrixbuildfoundwithBuildFailedButAlreadyScanned", "(", ")", "throws", "E", "PowerMockito", ".", "when", "(", "mockbuild1", ".", "getActions", "(", "FailureCauseBuildAction", ".", "class", ")", ").", "thenReturn", "(", "failureCauseBuildActions", ")", ";", "PowerMockito", ".", "when", "(", "mockproject", ".", "getBuilds", "(", "))", ".", "thenReturn", "(", "builds", ")", ";", "sodbaseaction", "=", "new", "ScanOnDemandBaseAction", "(", "mockproject", ")", ";", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "0", ",", "sodbaseaction", ".", "getNotScannedBuilds", "(", ").", "size", "(", "))", ";", "ScanOnDemandBaseAction", ".", "NonScanned", "action", "=", "new", "ScanOnDemandBaseAction", ".", "NonScanned", "(", ");", "assertEquals", "(", "\"", "Nonscanned", "buils", "\"", ",", "0", ",", "Lists", ".", "newArrayList", "(", "action", ".", "getRuns", "(", "mockproject", ")", ").", "size", "(", "))", ";", "}", "/", "**", "*", "Convenience", "method", "for", "a", "standard", "cause", "that", "finds", "{", "@", "link", "#", "TO_PRINT", "}", "in", "the", "build", "log", ".", "*", "Convenience", "method", "for", "a", "standard", "cause", "that", "finds", "ERROR", "in", "the", "build", "log", ".", "*", "*", "@", "return", "the", "configured", "cause", "that", "was", "added", "to", "the", "global", "config", ".", "*", "@", "throws", "Exception", "if", "something", "goes", "wrong", "in", "handling", "the", "causes", "."], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "116", ",", "6", "+", "116", ",", "8", "@", "@", "struct", "snd_card", "{", "int", "user_ctl_count", ";", "/", "*", "count", "of", "all", "user", "controls", "*", "/", "struct", "list_head", "controls", ";", "/", "*", "all", "controls", "for", "this", "card", "*", "/", "struct", "list_head", "ctl_files", ";", "/", "*", "active", "control", "files", "*", "/", "struct", "mutex", "user_ctl_lock", ";", "/", "*", "protects", "user", "controls", "against", "concurrent", "access", "*", "/", "struct", "snd_info_entry", "*", "proc_root", ";", "/", "*", "root", "for", "soundcard", "specific", "files", "*", "/", "struct", "snd_info_entry", "*", "proc_id", ";", "/", "*", "the", "card", "id", "*", "/", "@", "@", "-", "991", ",", "6", "+", "991", ",", "7", "@", "@", "static", "int", "snd_ctl_elem_unlock", "(", "struct", "snd_ctl_file", "*", "file", ",", "struct", "user_element", "{", "struct", "snd_ctl_elem_info", "info", ";", "struct", "snd_card", "*", "card", ";", "void", "*", "elem_data", ";", "/", "*", "element", "data", "*", "/", "unsigned", "long", "elem_data_size", ";", "/", "*", "size", "of", "element", "data", "in", "bytes", "*", "/", "void", "*", "tlv_data", ";", "/", "*", "TLV", "data", "*", "/", "@", "@", "-", "1034", ",", "7", "+", "1035", ",", "9", "@", "@", "static", "int", "snd_ctl_elem_user_get", "(", "struct", "snd_kcontrol", "*", "kcontrol", ",", "{", "struct", "user_element", "*", "ue", "=", "kcontrol", "-", ">", "private_data", ";", "mutex_lock", "(", "&", "ue", "-", ">", "card", "-", ">", "user_ctl_lock", ")", ";", "memcpy", "(", "&", "ucontrol", "-", ">", "value", ",", "ue", "-", ">", "elem_data", ",", "ue", "-", ">", "elem_data_size", ")", ";", "mutex_unlock", "(", "&", "ue", "-", ">", "card", "-", ">", "user_ctl_lock", ")", ";", "return", "0", ";", "}", "@", "@", "-", "1043", ",", "10", "+", "1046", ",", "12", "@", "@", "static", "int", "snd_ctl_elem_user_put", "(", "struct", "snd_kcontrol", "*", "kcontrol", ",", "{", "int", "change", ";", "struct", "user_element", "*", "ue", "=", "kcontrol", "-", ">", "private_data", ";", "mutex_lock", "(", "&", "ue", "-", ">", "card", "-", ">", "user_ctl_lock", ")", ";", "change", "=", "memcmp", "(", "&", "ucontrol", "-", ">", "value", ",", "ue", "-", ">", "elem_data", ",", "ue", "-", ">", "elem_data_size", ")", "!", "=", "0", ";", "if", "(", "change", ")", "memcpy", "(", "ue", "-", ">", "elem_data", ",", "&", "ucontrol", "-", ">", "value", ",", "ue", "-", ">", "elem_data_size", ")", ";", "mutex_unlock", "(", "&", "ue", "-", ">", "card", "-", ">", "user_ctl_lock", ")", ";", "return", "change", ";", "}", "@", "@", "-", "1066", ",", "19", "+", "1071", ",", "32", "@", "@", "static", "int", "snd_ctl_elem_user_tlv", "(", "struct", "snd_kcontrol", "*", "kcontrol", ",", "new_data", "=", "memdup_user", "(", "tlv", ",", "size", ")", ";", "if", "(", "IS_ERR", "(", "new_data", ")", ")", "return", "PTR_ERR", "(", "new_data", ")", ";", "mutex_lock", "(", "&", "ue", "-", ">", "card", "-", ">", "user_ctl_lock", ")", ";", "change", "=", "ue", "-", ">", "tlv_data_size", "!", "=", "size", ";", "if", "(", "!", "change", ")", "change", "=", "memcmp", "(", "ue", "-", ">", "tlv_data", ",", "new_data", ",", "size", ")", ";", "kfree", "(", "ue", "-", ">", "tlv_data", ")", ";", "ue", "-", ">", "tlv_data", "=", "new_data", ";", "ue", "-", ">", "tlv_data_size", "=", "size", ";", "mutex_unlock", "(", "&", "ue", "-", ">", "card", "-", ">", "user_ctl_lock", ")", ";", "}", "else", "{", "if", "(", "!", "ue", "-", ">", "tlv_data_size", "|", "|", "!", "ue", "-", ">", "tlv_data", ")", "return", "-", "ENXIO", ";", "if", "(", "size", "<", "ue", "-", ">", "tlv_data_size", ")", "return", "-", "ENOSPC", ";", "int", "ret", "=", "0", ";", "mutex_lock", "(", "&", "ue", "-", ">", "card", "-", ">", "user_ctl_lock", ")", ";", "if", "(", "!", "ue", "-", ">", "tlv_data_size", "|", "|", "!", "ue", "-", ">", "tlv_data", ")", "{", "ret", "=", "-", "ENXIO", ";", "goto", "err_unlock", ";", "}", "if", "(", "size", "<", "ue", "-", ">", "tlv_data_size", ")", "{", "ret", "=", "-", "ENOSPC", ";", "goto", "err_unlock", ";", "}", "if", "(", "copy_to_user", "(", "tlv", ",", "ue", "-", ">", "tlv_data", ",", "ue", "-", ">", "tlv_data_size", ")", ")", "return", "-", "EFAULT", ";", "ret", "=", "-", "EFAULT", ";", "err_unlock", ":", "mutex_unlock", "(", "&", "ue", "-", ">", "card", "-", ">", "user_ctl_lock", ")", ";", "if", "(", "ret", ")", "return", "ret", ";", "}", "return", "change", ";", "}", "@", "@", "-", "1210", ",", "6", "+", "1228", ",", "7", "@", "@", "static", "int", "snd_ctl_elem_add", "(", "struct", "snd_ctl_file", "*", "file", ",", "ue", "=", "kzalloc", "(", "sizeof", "(", "struct", "user_element", ")", "+", "private_size", ",", "GFP_KERNEL", ")", ";", "if", "(", "ue", "=", "=", "NULL", ")", "return", "-", "ENOMEM", ";", "ue", "-", ">", "card", "=", "card", ";", "ue", "-", ">", "info", "=", "*", "info", ";", "ue", "-", ">", "info", ".", "access", "=", "0", ";", "ue", "-", ">", "elem_data", "=", "(", "char", "*", ")", "ue", "+", "sizeof", "(", "*", "ue", ")", ";", "@", "@", "-", "232", ",", "6", "+", "232", ",", "7", "@", "@", "int", "snd_card_new", "(", "struct", "device", "*", "parent", ",", "int", "idx", ",", "const", "char", "*", "xid", ",", "INIT_LIST_HEAD", "(", "&", "card", "-", ">", "devices", ")", ";", "init_rwsem", "(", "&", "card", "-", ">", "controls_rwsem", ")", ";", "rwlock_init", "(", "&", "card", "-", ">", "ctl_files_rwlock", ")", ";", "mutex_init", "(", "&", "card", "-", ">", "user_ctl_lock", ")", ";", "INIT_LIST_HEAD", "(", "&", "card", "-", ">", "controls", ")", ";", "INIT_LIST_HEAD", "(", "&", "card", "-", ">", "ctl_files", ")", ";", "spin_lock_init", "(", "&", "card", "-", ">", "files_lock", ")", ";"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "103", ",", "7", "+", "103", ",", "7", "@", "@", "static", "int", "ext2_commit_chunk", "(", "struct", "page", "*", "page", ",", "loff_t", "pos", ",", "unsigned", "len", ")", "return", "err", ";", "}", "static", "void", "ext2_check_page", "(", "struct", "page", "*", "page", ")", "static", "void", "ext2_check_page", "(", "struct", "page", "*", "page", ",", "int", "quiet", ")", "{", "struct", "inode", "*", "dir", "=", "page", "-", ">", "mapping", "-", ">", "host", ";", "struct", "super_block", "*", "sb", "=", "dir", "-", ">", "i_sb", ";", "@", "@", "-", "146", ",", "10", "+", "146", ",", "10", "@", "@", "static", "void", "ext2_check_page", "(", "struct", "page", "*", "page", ")", "/", "*", "Too", "bad", ",", "we", "had", "an", "error", "*", "/", "Ebadsize", ":", "ext2_error", "(", "sb", ",", "\"", "ext2_check_page", "\"", ",", "\"", "size", "of", "directory", "#", "%", "lu", "is", "not", "a", "multiple", "of", "chunk", "size", "\"", ",", "dir", "-", ">", "i_ino", ")", ";", "if", "(", "!", "quiet", ")", "ext2_error", "(", "sb", ",", "__func__", ",", "\"", "size", "of", "directory", "#", "%", "lu", "is", "not", "a", "multiple", "\"", "\"", "of", "chunk", "size", "\"", ",", "dir", "-", ">", "i_ino", ")", ";", "goto", "fail", ";", "Eshort", ":", "error", "=", "\"", "rec_len", "is", "smaller", "than", "minimal", "\"", ";", "@", "@", "-", "166", ",", "32", "+", "166", ",", "36", "@", "@", "static", "void", "ext2_check_page", "(", "struct", "page", "*", "page", ")", "Einumber", ":", "error", "=", "\"", "inode", "out", "of", "bounds", "\"", ";", "bad_entry", ":", "ext2_error", "(", "sb", ",", "\"", "ext2_check_page", "\"", ",", "\"", "bad", "entry", "in", "directory", "#", "%", "lu", ":", "%", "s", "-", "\"", "\"", "offset", "=", "%", "lu", ",", "inode", "=", "%", "lu", ",", "rec_len", "=", "%", "d", ",", "name_len", "=", "%", "d", "\"", ",", "dir", "-", ">", "i_ino", ",", "error", ",", "(", "page", "-", ">", "index", "<", "<", "PAGE_CACHE_SHIFT", ")", "+", "offs", ",", "(", "unsigned", "long", ")", "le32_to_cpu", "(", "p", "-", ">", "inode", ")", ",", "rec_len", ",", "p", "-", ">", "name_len", ")", ";", "if", "(", "!", "quiet", ")", "ext2_error", "(", "sb", ",", "__func__", ",", "\"", "bad", "entry", "in", "directory", "#", "%", "lu", ":", ":", "%", "s", "-", "\"", "\"", "offset", "=", "%", "lu", ",", "inode", "=", "%", "lu", ",", "rec_len", "=", "%", "d", ",", "name_len", "=", "%", "d", "\"", ",", "dir", "-", ">", "i_ino", ",", "error", ",", "(", "page", "-", ">", "index", "<", "<", "PAGE_CACHE_SHIFT", ")", "+", "offs", ",", "(", "unsigned", "long", ")", "le32_to_cpu", "(", "p", "-", ">", "inode", ")", ",", "rec_len", ",", "p", "-", ">", "name_len", ")", ";", "goto", "fail", ";", "Eend", ":", "p", "=", "(", "ext2_dirent", "*", ")(", "kaddr", "+", "offs", ")", ";", "ext2_error", "(", "sb", ",", "\"", "ext2_check_page", "\"", ",", "\"", "entry", "in", "directory", "#", "%", "lu", "spans", "the", "page", "boundary", "\"", "\"", "offset", "=", "%", "lu", ",", "inode", "=", "%", "lu", "\"", ",", "dir", "-", ">", "i_ino", ",", "(", "page", "-", ">", "index", "<", "<", "PAGE_CACHE_SHIFT", ")", "+", "offs", ",", "(", "unsigned", "long", ")", "le32_to_cpu", "(", "p", "-", ">", "inode", ")", ");", "if", "(", "!", "quiet", ")", "{", "p", "=", "(", "ext2_dirent", "*", ")(", "kaddr", "+", "offs", ")", ";", "ext2_error", "(", "sb", ",", "\"", "ext2_check_page", "\"", ",", "\"", "entry", "in", "directory", "#", "%", "lu", "spans", "the", "page", "boundary", "\"", "\"", "offset", "=", "%", "lu", ",", "inode", "=", "%", "lu", "\"", ",", "dir", "-", ">", "i_ino", ",", "(", "page", "-", ">", "index", "<", "<", "PAGE_CACHE_SHIFT", ")", "+", "offs", ",", "(", "unsigned", "long", ")", "le32_to_cpu", "(", "p", "-", ">", "inode", ")", ");", "}", "fail", ":", "SetPageChecked", "(", "page", ")", ";", "SetPageError", "(", "page", ")", ";", "}", "static", "struct", "page", "*", "ext2_get_page", "(", "struct", "inode", "*", "dir", ",", "unsigned", "long", "n", ")", "static", "struct", "page", "*", "ext2_get_page", "(", "struct", "inode", "*", "dir", ",", "unsigned", "long", "n", ",", "int", "quiet", ")", "{", "struct", "address_space", "*", "mapping", "=", "dir", "-", ">", "i_mapping", ";", "struct", "page", "*", "page", "=", "read_mapping_page", "(", "mapping", ",", "n", ",", "NULL", ")", ";", "if", "(", "!", "IS_ERR", "(", "page", ")", ")", "{", "kmap", "(", "page", ")", ";", "if", "(", "!", "PageChecked", "(", "page", ")", ")", "ext2_check_page", "(", "page", ")", ";", "ext2_check_page", "(", "page", ",", "quiet", ")", ";", "if", "(", "PageError", "(", "page", ")", ")", "goto", "fail", ";", "}", "@", "@", "-", "292", ",", "7", "+", "296", ",", "7", "@", "@", "ext2_readdir", "(", "struct", "file", "*", "filp", ",", "void", "*", "dirent", ",", "filldir_t", "filldir", ")", "for", "(", ";", "n", "<", "npages", ";", "n", "+", "+,", "offset", "=", "0", ")", "{", "char", "*", "kaddr", ",", "*", "limit", ";", "ext2_dirent", "*", "de", ";", "struct", "page", "*", "page", "=", "ext2_get_page", "(", "inode", ",", "n", ")", ";", "struct", "page", "*", "page", "=", "ext2_get_page", "(", "inode", ",", "n", ",", "0", ")", ";", "if", "(", "IS_ERR", "(", "page", ")", ")", "{", "ext2_error", "(", "sb", ",", "__func__", ",", "@", "@", "-", "361", ",", "6", "+", "365", ",", "7", "@", "@", "struct", "ext2_dir_entry_2", "*", "ext2_find_entry", "(", "struct", "inode", "*", "dir", ",", "struct", "page", "*", "page", "=", "NULL", ";", "struct", "ext2_inode_info", "*", "ei", "=", "EXT2_I", "(", "dir", ")", ";", "ext2_dirent", "*", "de", ";", "int", "dir_has_error", "=", "0", ";", "if", "(", "npages", "=", "=", "0", ")", "goto", "out", ";", "@", "@", "-", "374", ",", "7", "+", "379", ",", "7", "@", "@", "struct", "ext2_dir_entry_2", "*", "ext2_find_entry", "(", "struct", "inode", "*", "dir", ",", "n", "=", "start", ";", "do", "{", "char", "*", "kaddr", ";", "page", "=", "ext2_get_page", "(", "dir", ",", "n", ")", ";", "page", "=", "ext2_get_page", "(", "dir", ",", "n", ",", "dir_has_error", ")", ";", "if", "(", "!", "IS_ERR", "(", "page", ")", ")", "{", "kaddr", "=", "page_address", "(", "page", ")", ";", "de", "=", "(", "ext2_dirent", "*", ")", "kaddr", ";", "@", "@", "-", "391", ",", "7", "+", "396", ",", "9", "@", "@", "struct", "ext2_dir_entry_2", "*", "ext2_find_entry", "(", "struct", "inode", "*", "dir", ",", "de", "=", "ext2_next_entry", "(", "de", ")", ";", "}", "ext2_put_page", "(", "page", ")", ";", "}", "}", "else", "dir_has_error", "=", "1", ";", "if", "(", "++", "n", ">", "=", "npages", ")", "n", "=", "0", ";", "/", "*", "next", "page", "is", "past", "the", "blocks", "we", "'", "ve", "got", "*", "/", "@", "@", "-", "414", ",", "7", "+", "421", ",", "7", "@", "@", "struct", "ext2_dir_entry_2", "*", "ext2_find_entry", "(", "struct", "inode", "*", "dir", ",", "struct", "ext2_dir_entry_2", "*", "ext2_dotdot", "(", "struct", "inode", "*", "dir", ",", "struct", "page", "*", "*", "p", ")", "{", "struct", "page", "*", "page", "=", "ext2_get_page", "(", "dir", ",", "0", ")", ";", "struct", "page", "*", "page", "=", "ext2_get_page", "(", "dir", ",", "0", ",", "0", ")", ";", "ext2_dirent", "*", "de", "=", "NULL", ";", "if", "(", "!", "IS_ERR", "(", "page", ")", ")", "{", "@", "@", "-", "487", ",", "7", "+", "494", ",", "7", "@", "@", "int", "ext2_add_link", "(", "struct", "dentry", "*", "dentry", ",", "struct", "inode", "*", "inode", ")", "for", "(", "n", "=", "0", ";", "n", "<", "=", "npages", ";", "n", "+", "+)", "{", "char", "*", "dir_end", ";", "page", "=", "ext2_get_page", "(", "dir", ",", "n", ")", ";", "page", "=", "ext2_get_page", "(", "dir", ",", "n", ",", "0", ")", ";", "err", "=", "PTR_ERR", "(", "page", ")", ";", "if", "(", "IS_ERR", "(", "page", ")", ")", "goto", "out", ";", "@", "@", "-", "655", ",", "14", "+", "662", ",", "17", "@", "@", "int", "ext2_empty_dir", "(", "struct", "inode", "*", "inode", ")", "{", "struct", "page", "*", "page", "=", "NULL", ";", "unsigned", "long", "i", ",", "npages", "=", "dir_pages", "(", "inode", ")", ";", "int", "dir_has_error", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "npages", ";", "i", "+", "+)", "{", "char", "*", "kaddr", ";", "ext2_dirent", "*", "de", ";", "page", "=", "ext2_get_page", "(", "inode", ",", "i", ")", ";", "page", "=", "ext2_get_page", "(", "inode", ",", "i", ",", "dir_has_error", ")", ";", "if", "(", "IS_ERR", "(", "page", ")", ")", "if", "(", "IS_ERR", "(", "page", ")", ")", "{", "dir_has_error", "=", "1", ";", "continue", ";", "}", "kaddr", "=", "page_address", "(", "page", ")", ";", "de", "=", "(", "ext2_dirent", "*", ")", "kaddr", ";"], "docstring_tokens": ["the", "system", "to", "hang", "resulting", "in", "a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "#", "IpcMainEvent", "Object", "extends", "`", "Event", "`", "*", "`", "processId", "`", "Integer", "-", "The", "internal", "ID", "of", "the", "renderer", "process", "that", "sent", "this", "message", "*", "`", "frameId", "`", "Integer", "-", "The", "ID", "of", "the", "renderer", "frame", "that", "sent", "this", "message", "*", "`", "returnValue", "`", "any", "-", "Set", "this", "to", "the", "value", "to", "be", "returned", "in", "a", "synchronous", "message", "*", "`", "sender", "`", "WebContents", "-", "Returns", "the", "`", "webContents", "`", "that", "sent", "the", "message", "@", "@", "-", "1", ",", "4", "+", "1", ",", "5", "@", "@", "#", "IpcMainInvokeEvent", "Object", "extends", "`", "Event", "`", "*", "`", "processId", "`", "Integer", "-", "The", "internal", "ID", "of", "the", "renderer", "process", "that", "sent", "this", "message", "*", "`", "frameId", "`", "Integer", "-", "The", "ID", "of", "the", "renderer", "frame", "that", "sent", "this", "message", "*", "`", "sender", "`", "WebContents", "-", "Returns", "the", "`", "webContents", "`", "that", "sent", "the", "message", "@", "@", "-", "1696", ",", "7", "+", "1696", ",", "7", "@", "@", "app", ".", "whenReady", "(", ").", "then", "(", "()", "=", ">", "{", "#", "##", "#", "`", "contents", ".", "sendToFrame", "(", "frameId", ",", "channel", ",", ".", "..", "args", ")", "`", "*", "`", "frameId", "`", "Integer", "*", "`", "frameId", "`", "Integer", "|", "[", "number", ",", "number", "]", "*", "`", "channel", "`", "String", "*", "`", "..", ".", "args", "`", "any", "[", "]", "@", "@", "-", "148", ",", "23", "+", "148", ",", "23", "@", "@", "WebContents", ".", "prototype", ".", "_sendInternal", "=", "function", "(", "channel", ",", ".", "..", "args", ")", "{", "return", "this", ".", "_send", "(", "true", "/", "*", "internal", "*", "/,", "channel", ",", "args", ")", ";", "}", ";", "WebContents", ".", "prototype", ".", "sendToFrame", "=", "function", "(", "frameId", ",", "channel", ",", ".", "..", "args", ")", "{", "WebContents", ".", "prototype", ".", "sendToFrame", "=", "function", "(", "frame", ",", "channel", ",", ".", "..", "args", ")", "{", "if", "(", "typeof", "channel", "!", "==", "'", "string", "'", ")", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "channel", "argument", "'", ");", "}", "else", "if", "(", "typeof", "frameId", "!", "==", "'", "number", "'", ")", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "frameId", "argument", "'", ");", "}", "else", "if", "(", "!(", "typeof", "frame", "=", "==", "'", "number", "'", "|", "|", "Array", ".", "isArray", "(", "frame", ")", "))", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "frame", "argument", "(", "must", "be", "number", "or", "array", ")", "')", ";", "}", "return", "this", ".", "_sendToFrame", "(", "false", "/", "*", "internal", "*", "/,", "frameId", ",", "channel", ",", "args", ")", ";", "return", "this", ".", "_sendToFrame", "(", "false", "/", "*", "internal", "*", "/,", "frame", ",", "channel", ",", "args", ")", ";", "}", ";", "WebContents", ".", "prototype", ".", "_sendToFrameInternal", "=", "function", "(", "frameId", ",", "channel", ",", ".", "..", "args", ")", "{", "WebContents", ".", "prototype", ".", "_sendToFrameInternal", "=", "function", "(", "frame", ",", "channel", ",", ".", "..", "args", ")", "{", "if", "(", "typeof", "channel", "!", "==", "'", "string", "'", ")", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "channel", "argument", "'", ");", "}", "else", "if", "(", "typeof", "frameId", "!", "==", "'", "number", "'", ")", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "frameId", "argument", "'", ");", "}", "else", "if", "(", "!(", "typeof", "frame", "=", "==", "'", "number", "'", "|", "|", "Array", ".", "isArray", "(", "frame", ")", "))", "{", "throw", "new", "Error", "(", "'", "Missing", "required", "frame", "argument", "(", "must", "be", "number", "or", "array", ")", "')", ";", "}", "return", "this", ".", "_sendToFrame", "(", "true", "/", "*", "internal", "*", "/,", "frameId", ",", "channel", ",", "args", ")", ";", "return", "this", ".", "_sendToFrame", "(", "true", "/", "*", "internal", "*", "/,", "frame", ",", "channel", ",", "args", ")", ";", "}", ";", "/", "/", "Following", "methods", "are", "mapped", "to", "webFrame", ".", "@", "@", "-", "456", ",", "8", "+", "456", ",", "9", "@", "@", "WebContents", ".", "prototype", ".", "_callWindowOpenHandler", "=", "function", "(", "event", ":", "any", ",", "url", ":", "string", "}", ";", "const", "addReplyToEvent", "=", "(", "event", ":", "any", ")", "=", ">", "{", "const", "{", "processId", ",", "frameId", "}", "=", "event", ";", "event", ".", "reply", "=", "(", "..", ".", "args", ":", "any", "[", "])", "=", ">", "{", "event", ".", "sender", ".", "sendToFrame", "(", "event", ".", "frameId", ",", ".", "..", "args", ")", ";", "event", ".", "sender", ".", "sendToFrame", "(", "[", "processId", ",", "frameId", "]", ",", ".", "..", "args", ")", ";", "}", ";", "}", ";", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "const", "FUNCTION_PROPERTIES", "=", "[", "]", ";", "type", "RendererFunctionId", "=", "[", "string", ",", "number", "]", "/", "/", "[", "contextId", ",", "funcId", "]", "type", "FinalizerInfo", "=", "{", "id", ":", "RendererFunctionId", ",", "webContents", ":", "electron", ".", "WebContents", ",", "frameId", ":", "number", "}", ";", "type", "FinalizerInfo", "=", "{", "id", ":", "RendererFunctionId", ",", "webContents", ":", "electron", ".", "WebContents", ",", "frameId", ":", "[", "number", ",", "number", "]", "}", ";", "type", "CallIntoRenderer", "=", "(", "..", ".", "args", ":", "any", "[", "])", "=", ">", "void", "/", "/", "The", "remote", "functions", "in", "renderer", "processes", ".", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "function", "getCachedRendererFunction", "(", "id", ":", "RendererFunctionId", ")", ":", "CallIntoRenderer", "|", "if", "(", "deref", "!", "==", "undefined", ")", "return", "deref", ";", "}", "}", "function", "setCachedRendererFunction", "(", "id", ":", "RendererFunctionId", ",", "wc", ":", "electron", ".", "WebContents", ",", "frameId", ":", "number", ",", "value", ":", "CallIntoRenderer", ")", "{", "function", "setCachedRendererFunction", "(", "id", ":", "RendererFunctionId", ",", "wc", ":", "electron", ".", "WebContents", ",", "frameId", ":", "[", "number", ",", "number", "]", ",", "value", ":", "CallIntoRenderer", ")", "{", "/", "/", "eslint", "-", "disable", "-", "next", "-", "line", "no", "-", "undef", "const", "wr", "=", "new", "WeakRef", "<", "CallIntoRenderer", ">", "(", "value", ")", ";", "const", "mapKey", "=", "id", "[", "0", "]", "+", "'", "~'", "+", "id", "[", "1", "]", ";", "@", "@", "-", "220", ",", "7", "+", "220", ",", "7", "@", "@", "const", "fakeConstructor", "=", "(", "constructor", ":", "Function", ",", "name", ":", "string", ")", "=", ">", "}", ");", "/", "/", "Convert", "array", "of", "meta", "data", "from", "renderer", "into", "array", "of", "real", "values", ".", "const", "unwrapArgs", "=", "function", "(", "sender", ":", "electron", ".", "WebContents", ",", "frameId", ":", "number", ",", "contextId", ":", "string", ",", "args", ":", "any", "[", "])", "{", "const", "unwrapArgs", "=", "function", "(", "sender", ":", "electron", ".", "WebContents", ",", "frameId", ":", "[", "number", ",", "number", "]", ",", "contextId", ":", "string", ",", "args", ":", "any", "[", "])", "{", "const", "metaToValue", "=", "function", "(", "meta", ":", "MetaTypeFromRenderer", ")", ":", "any", "{", "switch", "(", "meta", ".", "type", ")", "{", "case", "'", "nativeimage", "'", ":", "@", "@", "-", "423", ",", "7", "+", "423", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_GET_CURRENT_WEB_CONTENTS", ",", "function", "(", "eve", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_CONSTRUCTOR", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "constructor", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "constructor", "=", "=", "null", ")", "{", "@", "@", "-", "434", ",", "7", "+", "434", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_CONSTRUCTOR", ",", "function", "(", "event", ",", "contextId", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_FUNCTION_CALL", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "func", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "func", "=", "=", "null", ")", "{", "@", "@", "-", "451", ",", "7", "+", "451", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_FUNCTION_CALL", ",", "function", "(", "event", ",", "context", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_CONSTRUCTOR", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "method", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "object", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "object", "=", "=", "null", ")", "{", "@", "@", "-", "462", ",", "7", "+", "462", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_CONSTRUCTOR", ",", "function", "(", "event", ",", "co", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_CALL", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "method", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "object", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "object", "=", "=", "null", ")", "{", "@", "@", "-", "479", ",", "7", "+", "479", ",", "7", "@", "@", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_CALL", ",", "function", "(", "event", ",", "contextId", "}", ");", "handleRemoteCommand", "(", "IPC_MESSAGES", ".", "BROWSER_MEMBER_SET", ",", "function", "(", "event", ",", "contextId", ",", "id", ",", "name", ",", "args", ")", "{", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "event", ".", "frameId", ",", "contextId", ",", "args", ")", ";", "args", "=", "unwrapArgs", "(", "event", ".", "sender", ",", "[", "event", ".", "processId", ",", "event", ".", "frameId", "]", ",", "contextId", ",", "args", ")", ";", "const", "obj", "=", "objectsRegistry", ".", "get", "(", "id", ")", ";", "if", "(", "obj", "=", "=", "null", ")", "{", "@", "@", "-", "2708", ",", "7", "+", "2708", ",", "7", "@", "@", "bool", "WebContents", ":", ":", "SendIPCMessageWithSender", "(", "bool", "internal", ",", "}", "bool", "WebContents", ":", ":", "SendIPCMessageToFrame", "(", "bool", "internal", ",", "int32_t", "frame_id", ",", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Value", ">", "frame", ",", "const", "std", ":", ":", "string", "&", "channel", ",", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Value", ">", "args", ")", "{", "v8", ":", ":", "Isolate", "*", "isolate", "=", "JavascriptEnvironment", ":", ":", "GetIsolate", "(", ");", "@", "@", "-", "2718", ",", "17", "+", "2718", ",", "30", "@", "@", "bool", "WebContents", ":", ":", "SendIPCMessageToFrame", "(", "bool", "internal", ",", "gin", ":", ":", "StringToV8", "(", "isolate", ",", "\"", "Failed", "to", "serialize", "arguments", "\"", "))", ");", "return", "false", ";", "}", "auto", "frames", "=", "web_contents", "(", ")-", ">", "GetAllFrames", "(", ");", "auto", "iter", "=", "std", ":", ":", "find_if", "(", "frames", ".", "begin", "(", "),", "frames", ".", "end", "(", "),", "[", "frame_id", "]", "(", "auto", "*", "f", ")", "{", "return", "f", "-", ">", "GetRoutingID", "(", ")", "=", "=", "frame_id", ";", "}", ");", "if", "(", "iter", "=", "=", "frames", ".", "end", "(", "))", "return", "false", ";", "if", "(", "!(", "*", "iter", ")", "->", "IsRenderFrameLive", "(", "))", "int32_t", "frame_id", ";", "int32_t", "process_id", ";", "if", "(", "gin", ":", ":", "ConvertFromV8", "(", "isolate", ",", "frame", ",", "&", "frame_id", ")", ")", "{", "process_id", "=", "web_contents", "(", ")-", ">", "GetMainFrame", "(", ")-", ">", "GetProcess", "(", ")-", ">", "GetID", "(", ");", "}", "else", "{", "std", ":", ":", "vector", "<", "int32_t", ">", "id_pair", ";", "if", "(", "gin", ":", ":", "ConvertFromV8", "(", "isolate", ",", "frame", ",", "&", "id_pair", ")", "&", "&", "id_pair", ".", "size", "(", ")", "=", "=", "2", ")", "{", "process_id", "=", "id_pair", "[", "0", "]", ";", "frame_id", "=", "id_pair", "[", "1", "]", ";", "}", "else", "{", "isolate", "-", ">", "ThrowException", "(", "v8", ":", ":", "Exception", ":", ":", "Error", "(", "gin", ":", ":", "StringToV8", "(", "isolate", ",", "\"", "frameId", "must", "be", "a", "number", "or", "a", "pair", "of", "[", "processId", ",", "frameId", "]", "\")", "))", ";", "return", "false", ";", "}", "}", "auto", "*", "rfh", "=", "content", ":", ":", "RenderFrameHost", ":", ":", "FromID", "(", "process_id", ",", "frame_id", ")", ";", "if", "(", "!", "rfh", "|", "|", "!", "rfh", "-", ">", "IsRenderFrameLive", "(", ")", "|", "|", "content", ":", ":", "WebContents", ":", ":", "FromRenderFrameHost", "(", "rfh", ")", "!", "=", "web_contents", "(", "))", "return", "false", ";", "mojo", ":", ":", "AssociatedRemote", "<", "mojom", ":", ":", "ElectronRenderer", ">", "electron_renderer", ";", "(", "*", "iter", ")", "->", "GetRemoteAssociatedInterfaces", "(", ")-", ">", "GetInterface", "(", "&", "electron_renderer", ")", ";", "rfh", "-", ">", "GetRemoteAssociatedInterfaces", "(", ")-", ">", "GetInterface", "(", "&", "electron_renderer", ")", ";", "electron_renderer", "-", ">", "Message", "(", "internal", ",", "channel", ",", "std", ":", ":", "move", "(", "message", ")", ",", "0", "/", "*", "sender_id", "*", "/)", ";", "return", "true", ";", "@", "@", "-", "258", ",", "7", "+", "258", ",", "7", "@", "@", "class", "WebContents", ":", "public", "gin", ":", ":", "Wrappable", "<", "WebContents", ">", ",", "int32_t", "sender_id", "=", "0", ")", ";", "bool", "SendIPCMessageToFrame", "(", "bool", "internal", ",", "int32_t", "frame_id", ",", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Value", ">", "frame", ",", "const", "std", ":", ":", "string", "&", "channel", ",", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Value", ">", "args", ")", ";", "@", "@", "-", "5", ",", "6", "+", "5", ",", "7", "@", "@", "#", "include", "\"", "shell", "/", "common", "/", "gin_helper", "/", "event_emitter", ".", "h", "\"", "#", "include", "\"", "content", "/", "public", "/", "browser", "/", "render_frame_host", ".", "h", "\"", "#", "include", "\"", "content", "/", "public", "/", "browser", "/", "render_process_host", ".", "h", "\"", "#", "include", "\"", "shell", "/", "browser", "/", "api", "/", "event", ".", "h", "\"", "#", "include", "\"", "shell", "/", "common", "/", "gin_helper", "/", "dictionary", ".", "h", "\"", "#", "include", "\"", "shell", "/", "common", "/", "gin_helper", "/", "object_template_builder", ".", "h", "\"", "@", "@", "-", "67", ",", "8", "+", "68", ",", "10", "@", "@", "v8", ":", ":", "Local", "<", "v8", ":", ":", "Object", ">", "CreateNativeEvent", "(", "Dictionary", "dict", "(", "isolate", ",", "event", ")", ";", "dict", ".", "Set", "(", "\"", "sender", "\"", ",", "sender", ")", ";", "/", "/", "Should", "always", "set", "frameId", "even", "when", "callback", "is", "null", ".", "if", "(", "frame", ")", "if", "(", "frame", ")", "{", "dict", ".", "Set", "(", "\"", "frameId", "\"", ",", "frame", "-", ">", "GetRoutingID", "(", "))", ";", "dict", ".", "Set", "(", "\"", "processId", "\"", ",", "frame", "-", ">", "GetProcess", "(", ")-", ">", "GetID", "(", "))", ";", "}", "return", "event", ";", "}", "@", "@", "-", "3", ",", "6", "+", "3", ",", "7", "@", "@", "import", "*", "as", "path", "from", "'", "path", "'", ";", "import", "*", "as", "cp", "from", "'", "child_process", "'", ";", "import", "{", "closeAllWindows", "}", "from", "'", "./", "window", "-", "helpers", "'", ";", "import", "{", "emittedOnce", "}", "from", "'", "./", "events", "-", "helpers", "'", ";", "import", "{", "defer", "}", "from", "'", "./", "spec", "-", "helpers", "'", ";", "import", "{", "ipcMain", ",", "BrowserWindow", "}", "from", "'", "electron", "/", "main", "'", ";", "describe", "(", "'", "ipc", "main", "module", "'", ",", "(", ")", "=", ">", "{", "@", "@", "-", "59", ",", "5", "+", "60", ",", "30", "@", "@", "describe", "(", "'", "ipc", "main", "module", "'", ",", "(", ")", "=", ">", "{", "output", "=", "JSON", ".", "parse", "(", "output", ")", ";", "expect", "(", "output", ")", ".", "to", ".", "deep", ".", "equal", "(", "['", "error", "'", "])", ";", "}", ");", "it", "(", "'", "can", "be", "replied", "to", "'", ",", "async", "(", ")", "=", ">", "{", "ipcMain", ".", "on", "(", "'", "test", "-", "echo", "'", ",", "(", "e", ",", "arg", ")", "=", ">", "{", "e", ".", "reply", "(", "'", "test", "-", "echo", "'", ",", "arg", ")", ";", "}", ");", "defer", "(", "()", "=", ">", "{", "ipcMain", ".", "removeAllListeners", "(", "'", "test", "-", "echo", "'", ");", "}", ");", "const", "w", "=", "new", "BrowserWindow", "(", "{", "show", ":", "false", ",", "webPreferences", ":", "{", "nodeIntegration", ":", "true", "}", "}", ");", "w", ".", "loadURL", "(", "'", "about", ":", "blank", "'", ");", "const", "v", "=", "await", "w", ".", "webContents", ".", "executeJavaScript", "(", "`", "new", "Promise", "(", "(", "resolve", ",", "reject", ")", "=", ">", "{", "const", "{", "ipcRenderer", "}", "=", "require", "(", "'", "electron", "'", ")", "ipcRenderer", ".", "send", "(", "'", "test", "-", "echo", "'", ",", "'", "hello", "'", ")", "ipcRenderer", ".", "on", "(", "'", "test", "-", "echo", "'", ",", "(", "e", ",", "v", ")", "=", ">", "{", "resolve", "(", "v", ")", "}", ")", "}", ")`", ");", "expect", "(", "v", ")", ".", "to", ".", "equal", "(", "'", "hello", "'", ");", "}", ");", "}", ");", "}", ");", "@", "@", "-", "3", ",", "7", "+", "3", ",", "8", "@", "@", "\"", "top", "=", "5", ",", "left", "=", "10", ",", "resizable", "=", "no", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "37", ",", "7", "+", "38", ",", "8", "@", "@", "\"", "zoomFactor", "=", "2", ",", "resizable", "=", "0", ",", "x", "=", "0", ",", "y", "=", "10", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "70", ",", "7", "+", "72", ",", "8", "@", "@", "\"", "backgroundColor", "=", "gray", ",", "webPreferences", "=", "0", ",", "x", "=", "100", ",", "y", "=", "100", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "103", ",", "7", "+", "106", ",", "8", "@", "@", "\"", "x", "=", "50", ",", "y", "=", "20", ",", "title", "=", "sup", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "134", ",", "7", "+", "138", ",", "8", "@", "@", "\"", "show", "=", "false", ",", "top", "=", "1", ",", "left", "=", "1", "\"", ",", "{", "\"", "sender", "\"", ":", "\"", "[", "WebContents", "]", "\",", "\"", "frameId", "\"", ":", "1", "\"", "frameId", "\"", ":", "1", ",", "\"", "processId", "\"", ":", "\"", "placeholder", "-", "process", "-", "id", "\"", "}", ",", "\"", "about", ":", "blank", "\"", ",", "\"", "frame", "name", "\"", ",", "@", "@", "-", "189", ",", "6", "+", "189", ",", "9", "@", "@", "function", "stringifySnapshots", "(", "snapshots", ":", "any", ",", "pretty", "=", "false", ")", "{", "if", "(", "key", "=", "==", "'", "openerId", "'", "&", "&", "typeof", "value", "=", "==", "'", "number", "'", ")", "{", "return", "'", "placeholder", "-", "opener", "-", "id", "'", ";", "}", "if", "(", "key", "=", "==", "'", "processId", "'", "&", "&", "typeof", "value", "=", "==", "'", "number", "'", ")", "{", "return", "'", "placeholder", "-", "process", "-", "id", "'", ";", "}", "if", "(", "key", "=", "==", "'", "returnValue", "'", ")", "{", "return", "'", "placeholder", "-", "guest", "-", "contents", "-", "id", "'", ";", "}", "@", "@", "-", "68", ",", "8", "+", "68", ",", "8", "@", "@", "declare", "namespace", "Electron", "{", "_callWindowOpenHandler", "(", "event", ":", "any", ",", "url", ":", "string", ",", "frameName", ":", "string", ",", "rawFeatures", ":", "string", ")", ":", "Electron", ".", "BrowserWindowConstructorOptions", "|", "null", ";", "_setNextChildWebPreferences", "(", "prefs", ":", "Partial", "<", "Electron", ".", "BrowserWindowConstructorOptions", "[", "'", "webPreferences", "'", "]>", "&", "Pick", "<", "Electron", ".", "BrowserWindowConstructorOptions", ",", "'", "backgroundColor", "'", ">)", ":", "void", ";", "_send", "(", "internal", ":", "boolean", ",", "channel", ":", "string", ",", "args", ":", "any", ")", ":", "boolean", ";", "_sendToFrame", "(", "internal", ":", "boolean", ",", "frameId", ":", "number", ",", "channel", ":", "string", ",", "args", ":", "any", ")", ":", "boolean", ";", "_sendToFrameInternal", "(", "frameId", ":", "number", ",", "channel", ":", "string", ",", ".", "..", "args", ":", "any", "[", "])", ":", "boolean", ";", "_sendToFrame", "(", "internal", ":", "boolean", ",", "frameId", ":", "number", "|", "[", "number", ",", "number", "]", ",", "channel", ":", "string", ",", "args", ":", "any", ")", ":", "boolean", ";", "_sendToFrameInternal", "(", "frameId", ":", "number", "|", "[", "number", ",", "number", "]", ",", "channel", ":", "string", ",", ".", "..", "args", ":", "any", "[", "])", ":", "boolean", ";", "_postMessage", "(", "channel", ":", "string", ",", "message", ":", "any", ",", "transfer", "?", ":", "any", "[", "])", ":", "void", ";", "_sendInternal", "(", "channel", ":", "string", ",", ".", "..", "args", ":", "any", "[", "])", ":", "void", ";", "_printToPDF", "(", "options", ":", "any", ")", ":", "Promise", "<", "Buffer", ">", ";"], "docstring_tokens": ["delivered", "to", "the", "wrong", "frame"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "283", ",", "6", "+", "283", ",", "7", "@", "@", "enum", "LINUX_MIB_TCPACKCOMPRESSED", ",", "/", "*", "TCPAckCompressed", "*", "/", "LINUX_MIB_TCPZEROWINDOWDROP", ",", "/", "*", "TCPZeroWindowDrop", "*", "/", "LINUX_MIB_TCPRCVQDROP", ",", "/", "*", "TCPRcvQDrop", "*", "/", "LINUX_MIB_TCPWQUEUETOOBIG", ",", "/", "*", "TCPWqueueTooBig", "*", "/", "__LINUX_MIB_MAX", "}", ";", "@", "@", "-", "287", ",", "6", "+", "287", ",", "7", "@", "@", "static", "const", "struct", "snmp_mib", "snmp4_net_list", "[", "]", "=", "{", "SNMP_MIB_ITEM", "(", "\"", "TCPAckCompressed", "\"", ",", "LINUX_MIB_TCPACKCOMPRESSED", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPZeroWindowDrop", "\"", ",", "LINUX_MIB_TCPZEROWINDOWDROP", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPRcvQDrop", "\"", ",", "LINUX_MIB_TCPRCVQDROP", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "TCPWqueueTooBig", "\"", ",", "LINUX_MIB_TCPWQUEUETOOBIG", ")", ",", "SNMP_MIB_SENTINEL", "}", ";", "@", "@", "-", "1296", ",", "6", "+", "1296", ",", "11", "@", "@", "int", "tcp_fragment", "(", "struct", "sock", "*", "sk", ",", "enum", "tcp_queue", "tcp_queue", ",", "if", "(", "nsize", "<", "0", ")", "nsize", "=", "0", ";", "if", "(", "unlikely", "(", "(", "sk", "-", ">", "sk_wmem_queued", ">", ">", "1", ")", ">", "sk", "-", ">", "sk_sndbuf", ")", ")", "{", "NET_INC_STATS", "(", "sock_net", "(", "sk", ")", ",", "LINUX_MIB_TCPWQUEUETOOBIG", ")", ";", "return", "-", "ENOMEM", ";", "}", "if", "(", "skb_unclone", "(", "skb", ",", "gfp", ")", ")", "return", "-", "ENOMEM", ";"], "docstring_tokens": ["send", "a", "crafted", "sequence", "of", "SACKs", "which", "will", "fragment", "the", "RACK", "send", "map"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1926", ",", "7", "+", "1926", ",", "7", "@", "@", "static", "ssize_t", "ocfs2_file_splice_write", "(", "struct", "pipe_inode_info", "*", "pipe", ",", "out", "-", ">", "f_path", ".", "dentry", "-", ">", "d_name", ".", "len", ",", "out", "-", ">", "f_path", ".", "dentry", "-", ">", "d_name", ".", "name", ")", ";", "inode_double_lock", "(", "inode", ",", "pipe", "-", ">", "inode", ")", ";", "mutex_lock_nested", "(", "&", "inode", "-", ">", "i_mutex", ",", "I_MUTEX_PARENT", ")", ";", "ret", "=", "ocfs2_rw_lock", "(", "inode", ",", "1", ")", ";", "if", "(", "ret", "<", "0", ")", "{", "@", "@", "-", "1941", ",", "12", "+", "1941", ",", "16", "@", "@", "static", "ssize_t", "ocfs2_file_splice_write", "(", "struct", "pipe_inode_info", "*", "pipe", ",", "goto", "out_unlock", ";", "}", "if", "(", "pipe", "-", ">", "inode", ")", "mutex_lock_nested", "(", "&", "pipe", "-", ">", "inode", "-", ">", "i_mutex", ",", "I_MUTEX_CHILD", ")", ";", "ret", "=", "generic_file_splice_write_nolock", "(", "pipe", ",", "out", ",", "ppos", ",", "len", ",", "flags", ")", ";", "if", "(", "pipe", "-", ">", "inode", ")", "mutex_unlock", "(", "&", "pipe", "-", ">", "inode", "-", ">", "i_mutex", ")", ";", "out_unlock", ":", "ocfs2_rw_unlock", "(", "inode", ",", "1", ")", ";", "out", ":", "inode_double_unlock", "(", "inode", ",", "pipe", "-", ">", "inode", ")", ";", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "mlog_exit", "(", "ret", ")", ";", "return", "ret", ";", "@", "@", "-", "737", ",", "10", "+", "737", ",", "19", "@", "@", "ssize_t", "splice_from_pipe", "(", "struct", "pipe_inode_info", "*", "pipe", ",", "struct", "file", "*", "out", ",", "*", "-", ">", "write_end", ".", "Most", "of", "the", "time", ",", "these", "expect", "i_mutex", "to", "*", "be", "held", ".", "Since", "this", "may", "result", "in", "an", "ABBA", "deadlock", "with", "*", "pipe", "-", ">", "inode", ",", "we", "have", "to", "order", "lock", "acquiry", "here", ".", "*", "*", "Outer", "lock", "must", "be", "inode", "-", ">", "i_mutex", ",", "as", "pipe_wait", "(", ")", "will", "*", "release", "and", "reacquire", "pipe", "-", ">", "inode", "-", ">", "i_mutex", ",", "AND", "inode", "must", "*", "never", "be", "a", "pipe", ".", "*", "/", "inode_double_lock", "(", "inode", ",", "pipe", "-", ">", "inode", ")", ";", "WARN_ON", "(", "S_ISFIFO", "(", "inode", "-", ">", "i_mode", ")", ");", "mutex_lock_nested", "(", "&", "inode", "-", ">", "i_mutex", ",", "I_MUTEX_PARENT", ")", ";", "if", "(", "pipe", "-", ">", "inode", ")", "mutex_lock_nested", "(", "&", "pipe", "-", ">", "inode", "-", ">", "i_mutex", ",", "I_MUTEX_CHILD", ")", ";", "ret", "=", "__splice_from_pipe", "(", "pipe", ",", "&", "sd", ",", "actor", ")", ";", "inode_double_unlock", "(", "inode", ",", "pipe", "-", ">", "inode", ")", ";", "if", "(", "pipe", "-", ">", "inode", ")", "mutex_unlock", "(", "&", "pipe", "-", ">", "inode", "-", ">", "i_mutex", ")", ";", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "return", "ret", ";", "}", "@", "@", "-", "831", ",", "11", "+", "840", ",", "17", "@", "@", "generic_file_splice_write", "(", "struct", "pipe_inode_info", "*", "pipe", ",", "struct", "file", "*", "out", ",", "}", ";", "ssize_t", "ret", ";", "inode_double_lock", "(", "inode", ",", "pipe", "-", ">", "inode", ")", ";", "WARN_ON", "(", "S_ISFIFO", "(", "inode", "-", ">", "i_mode", ")", ");", "mutex_lock_nested", "(", "&", "inode", "-", ">", "i_mutex", ",", "I_MUTEX_PARENT", ")", ";", "ret", "=", "file_remove_suid", "(", "out", ")", ";", "if", "(", "likely", "(", "!", "ret", ")", ")", "if", "(", "likely", "(", "!", "ret", ")", ")", "{", "if", "(", "pipe", "-", ">", "inode", ")", "mutex_lock_nested", "(", "&", "pipe", "-", ">", "inode", "-", ">", "i_mutex", ",", "I_MUTEX_CHILD", ")", ";", "ret", "=", "__splice_from_pipe", "(", "pipe", ",", "&", "sd", ",", "pipe_to_file", ")", ";", "inode_double_unlock", "(", "inode", ",", "pipe", "-", ">", "inode", ")", ";", "if", "(", "pipe", "-", ">", "inode", ")", "mutex_unlock", "(", "&", "pipe", "-", ">", "inode", "-", ">", "i_mutex", ")", ";", "}", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "if", "(", "ret", ">", "0", ")", "{", "unsigned", "long", "nr_pages", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(prevention", "of", "file", "creation", "and", "removal", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "72", ",", "7", "+", "72", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "86", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "87", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "102", ",", "6", "+", "102", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "startingDirectoryMustExist", "*", "(", "consumer", ")", "|", "Whether", "the", "starting", "directory", "must", "exist", ".", "Mind", "that", "the", "autoCreate", "option", "is", "default", "enabled", ",", "which", "means", "the", "starting", "directory", "is", "normally", "auto", "created", "if", "it", "doesn", "'", "t", "exist", ".", "You", "can", "disable", "autoCreate", "and", "enable", "this", "to", "ensure", "the", "starting", "directory", "must", "exist", ".", "Will", "thrown", "an", "exception", "if", "the", "directory", "doesn", "'", "t", "exist", ".", "|", "false", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "94", ",", "6", "+", "94", ",", "8", "@", "@", "protected", "boolean", "keepLastModified", ";", "@", "UriParam", "(", "label", "=", "\"", "producer", ",", "advanced", "\"", ")", "protected", "boolean", "allowNullBody", ";", "@", "UriParam", "(", "label", "=", "\"", "producer", "\"", ",", "defaultValue", "=", "\"", "true", "\"", ")", "protected", "boolean", "jailStartingDirectory", "=", "true", ";", "/", "/", "consumer", "options", "@", "@", "-", "1251", ",", "6", "+", "1253", ",", "19", "@", "@", "public", "void", "setAllowNullBody", "(", "boolean", "allowNullBody", ")", "{", "this", ".", "allowNullBody", "=", "allowNullBody", ";", "}", "public", "boolean", "isJailStartingDirectory", "(", ")", "{", "return", "jailStartingDirectory", ";", "}", "/", "**", "*", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "*", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "*", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "*", "/", "public", "void", "setJailStartingDirectory", "(", "boolean", "jailStartingDirectory", ")", "{", "this", ".", "jailStartingDirectory", "=", "jailStartingDirectory", ";", "}", "public", "ExceptionHandler", "getOnCompletionExceptionHandler", "(", ")", "{", "return", "onCompletionExceptionHandler", ";", "}", "@", "@", "-", "22", ",", "6", "+", "22", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "Lock", ";", "import", "java", ".", "util", ".", "concurrent", ".", "locks", ".", "ReentrantLock", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExchangeException", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Expression", ";", "import", "org", ".", "apache", ".", "camel", ".", "support", ".", "DefaultExchange", ";", "@", "@", "-", "325", ",", "7", "+", "326", ",", "7", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "exchange", ".", "getIn", "(", ").", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "value", ")", ";", "}", "if", "(", "value", "!", "=", "null", "&", "&", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "if", "(", "value", "instanceof", "String", "&", "&", "StringHelper", ".", "hasStartToken", "(", "(", "String", ")", "value", ",", "\"", "simple", "\"", "))", "{", "log", ".", "warn", "(", "\"", "Simple", "expression", ":", "{", "}", "detected", "in", "header", ":", "{", "}", "of", "type", "String", ".", "This", "feature", "has", "been", "removed", "(", "see", "CAMEL", "-", "6748", ")", ".\"", ",", "value", ",", "Exchange", ".", "FILE_NAME", ")", ";", "}", "@", "@", "-", "372", ",", "6", "+", "373", ",", "15", "@", "@", "public", "String", "createFileName", "(", "Exchange", "exchange", ")", "{", "answer", "=", "baseDir", "+", "endpoint", ".", "getGeneratedFileName", "(", "exchange", ".", "getIn", "(", "))", ";", "}", "if", "(", "endpoint", ".", "isJailStartingDirectory", "(", "))", "{", "/", "/", "check", "for", "file", "must", "be", "within", "starting", "directory", "(", "need", "to", "compact", "first", "as", "the", "name", "can", "be", "using", "relative", "paths", "via", ".", "./", "etc", ")", "String", "compatchAnswer", "=", "FileUtil", ".", "compactPath", "(", "answer", ")", ";", "String", "compatchBaseDir", "=", "FileUtil", ".", "compactPath", "(", "baseDir", ")", ";", "if", "(", "!", "compatchAnswer", ".", "startsWith", "(", "compatchBaseDir", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "Cannot", "write", "file", "with", "name", ":", "\"", "+", "compatchAnswer", "+", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", ":", "\"", "+", "compatchBaseDir", ")", ";", "}", "}", "if", "(", "endpoint", ".", "getConfiguration", "(", ").", "needToNormalize", "(", "))", "{", "/", "/", "must", "normalize", "path", "to", "cater", "for", "Windows", "and", "other", "OS", "answer", "=", "normalizePath", "(", "answer", ")", ";", "@", "@", "-", "81", ",", "7", "+", "81", ",", "7", "@", "@", "public", "void", "testProducerDateByExpression", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testProducerComplexByExpression", "(", ")", "throws", "Exception", "{", "String", "expression", "=", "\"", "..", "/", "filelanguageinbox", "/", "myfile", "-", "${", "bean", ":", "myguidgenerator", ".", "guid", "}", "-$", "{", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ";", "template", ".", "sendBody", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "?", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "template", ".", "sendBody", "(", "\"", "file", ":", "//", "target", "/", "filelanguage", "?", "jailStartingDirectory", "=", "false", "&", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "String", "date", "=", "new", "SimpleDateFormat", "(", "\"", "yyyyMMdd", "\"", ").", "format", "(", "new", "Date", "(", "))", ";", "assertFileExists", "(", "\"", "target", "/", "filelanguageinbox", "/", "myfile", "-", "123", "-", "\"", "+", "date", "+", "\"", ".", "txt", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "73", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ";", "import", "org", ".", "apache", ".", "camel", ".", "ContextTestSupport", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "FileProducerJailStartingDirectoryTest", "extends", "ContextTestSupport", "{", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "deleteDirectory", "(", "\"", "target", "/", "jail", "\"", ");", "super", ".", "setUp", "(", ");", "}", "@", "Test", "public", "void", "testWriteOutsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "0", ")", ";", "try", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "hello", ".", "txt", "\"", ");", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "IllegalArgumentException", "iae", "=", "assertIsInstanceOf", "(", "IllegalArgumentException", ".", "class", ",", "e", ".", "getCause", "(", "))", ";", "assertTrue", "(", "iae", ".", "getMessage", "(", ").", "contains", "(", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", "\"", "))", ";", "}", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Test", "public", "void", "testWriteInsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "outbox", "/", "bye", ".", "txt", "\"", ");", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\".", "./", "${", "file", ":", "name", "}", "\")", ")", ".", "to", "(", "\"", "file", ":", "target", "/", "jail", "/", "outbox", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "109", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "110", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "143", ",", "6", "+", "143", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "60", ",", "7", "+", "60", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "121", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "122", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "103", ",", "6", "+", "103", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "117", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "118", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "87", ",", "6", "+", "87", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "85", ",", "7", "+", "85", ",", "7", "@", "@", "public", "void", "testProducerDateByExpression", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testProducerComplexByExpression", "(", ")", "throws", "Exception", "{", "/", "/", "need", "one", "extra", "subdirectory", "(", "=", "foo", ")", "to", "be", "able", "to", "start", "with", ".", ".", "in", "the", "fileName", "option", "String", "url", "=", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "filelanguage", "/", "foo", "?", "password", "=", "admin", "\"", ";", "String", "url", "=", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "filelanguage", "/", "foo", "?", "password", "=", "admin", "&", "jailStartingDirectory", "=", "false", "\"", ";", "String", "expression", "=", "\"", "..", "/", "filelanguageinbox", "/", "myfile", "-", "${", "bean", ":", "myguidgenerator", ".", "guid", "}", "-$", "{", "date", ":", "now", ":", "yyyyMMdd", "}", ".", "txt", "\"", ";", "template", ".", "sendBody", "(", "url", "+", "\"", "&", "fileName", "=", "\"", "+", "expression", ",", "\"", "Hello", "World", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "68", "@", "@", "/", "**", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "file", ".", "remote", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "FtpProducerJailStartingDirectoryTest", "extends", "FtpServerTestSupport", "{", "private", "String", "getFtpUrl", "(", ")", "{", "return", "\"", "ftp", ":", "//", "admin", "@", "localhost", ":", "\"", "+", "getPort", "(", ")", "+", "\"", "/", "upload", "/", "jail", "?", "binary", "=", "false", "&", "password", "=", "admin", "&", "tempPrefix", "=", ".", "uploading", "\"", ";", "}", "@", "Test", "public", "void", "testWriteOutsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "0", ")", ";", "try", "{", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Hello", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "hello", ".", "txt", "\"", ");", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "Exception", "e", ")", "{", "IllegalArgumentException", "iae", "=", "assertIsInstanceOf", "(", "IllegalArgumentException", ".", "class", ",", "e", ".", "getCause", "(", "))", ";", "assertTrue", "(", "iae", ".", "getMessage", "(", ").", "contains", "(", "\"", "as", "the", "filename", "is", "jailed", "to", "the", "starting", "directory", "\"", "))", ";", "}", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Test", "public", "void", "testWriteInsideStartingDirectory", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "template", ".", "sendBodyAndHeader", "(", "\"", "direct", ":", "start", "\"", ",", "\"", "Bye", "World", "\"", ",", "Exchange", ".", "FILE_NAME", ",", "\"", "jail", "/", "bye", ".", "txt", "\"", ");", "assertMockEndpointsSatisfied", "(", ");", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "start", "\"", ")", ".", "setHeader", "(", "Exchange", ".", "FILE_NAME", ",", "simple", "(", "\".", "./", "${", "file", ":", "name", "}", "\")", ")", ".", "to", "(", "getFtpUrl", "(", "))", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "83", ",", "7", "+", "83", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "21", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "22", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "93", ",", "6", "+", "93", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "chmod", "*", "(", "producer", ")", "|", "Allows", "you", "to", "set", "chmod", "on", "the", "stored", "file", ".", "For", "example", "chmod", "=", "664", ".", "|", "664", "|", "String", "|", "*", "fileName", "*", "(", "producer", ")", "|", "Use", "Expression", "such", "as", "File", "Language", "to", "dynamically", "set", "the", "filename", ".", "For", "consumers", ",", "it", "'", "s", "used", "as", "a", "filename", "filter", ".", "For", "producers", ",", "it", "'", "s", "used", "to", "evaluate", "the", "filename", "to", "write", ".", "If", "an", "expression", "is", "set", ",", "it", "take", "precedence", "over", "the", "CamelFileName", "header", ".", "(", "Note", ":", "The", "header", "itself", "can", "also", "be", "an", "Expression", ")", ".", "The", "expression", "options", "support", "both", "String", "and", "Expression", "types", ".", "If", "the", "expression", "is", "a", "String", "type", ",", "it", "is", "always", "evaluated", "using", "the", "File", "Language", ".", "If", "the", "expression", "is", "an", "Expression", "type", ",", "the", "specified", "Expression", "type", "is", "used", "-", "this", "allows", "you", ",", "for", "instance", ",", "to", "use", "OGNL", "expressions", ".", "For", "the", "consumer", ",", "you", "can", "use", "it", "to", "filter", "filenames", ",", "so", "you", "can", "for", "instance", "consume", "today", "'", "s", "file", "using", "the", "File", "Language", "syntax", ":", "mydata", "-", "$", "date", ":", "now", ":", "yyyyMMdd", ".", "txt", ".", "The", "producers", "support", "the", "CamelOverruleFileName", "header", "which", "takes", "precedence", "over", "any", "existing", "CamelFileName", "header", ";", "the", "CamelOverruleFileName", "is", "a", "header", "that", "is", "used", "only", "once", ",", "and", "makes", "it", "easier", "as", "this", "avoids", "to", "temporary", "store", "CamelFileName", "and", "have", "to", "restore", "it", "afterwards", ".", "|", "|", "String", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "strictHostKeyChecking", "*", "(", "producer", ")", "|", "Sets", "whether", "to", "use", "strict", "host", "key", "checking", ".", "Possible", "values", "are", ":", "no", ",", "yes", "|", "no", "|", "String", "|", "*", "allowNullBody", "*", "(", "producer", ")", "|", "Used", "to", "specify", "if", "a", "null", "body", "is", "allowed", "during", "file", "writing", ".", "If", "set", "to", "true", "then", "an", "empty", "file", "will", "be", "created", ",", "when", "set", "to", "false", ",", "and", "attempting", "to", "send", "a", "null", "body", "to", "the", "file", "component", ",", "a", "GenericFileWriteException", "of", "'", "Cannot", "write", "null", "body", "to", "file", ".", "'", "will", "be", "thrown", ".", "If", "the", "fileExist", "option", "is", "set", "to", "'", "Override", "'", ",", "then", "the", "file", "will", "be", "truncated", ",", "and", "if", "set", "to", "append", "the", "file", "will", "remain", "unchanged", ".", "|", "false", "|", "boolean", "|", "*", "disconnectOnBatchComplete", "*", "(", "producer", ")", "|", "Whether", "or", "not", "to", "disconnect", "from", "remote", "FTP", "server", "right", "after", "a", "Batch", "upload", "is", "complete", ".", "disconnectOnBatchComplete", "will", "only", "disconnect", "the", "current", "connection", "to", "the", "FTP", "server", ".", "|", "false", "|", "boolean", "@", "@", "-", "100", ",", "7", "+", "100", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "109", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "110", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "143", ",", "6", "+", "143", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "60", ",", "7", "+", "60", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "121", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "122", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "103", ",", "6", "+", "103", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String", "@", "@", "-", "83", ",", "7", "+", "83", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "21", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "22", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "93", ",", "6", "+", "93", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "chmod", "*", "(", "producer", ")", "|", "Allows", "you", "to", "set", "chmod", "on", "the", "stored", "file", ".", "For", "example", "chmod", "=", "664", ".", "|", "664", "|", "String", "|", "*", "fileName", "*", "(", "producer", ")", "|", "Use", "Expression", "such", "as", "File", "Language", "to", "dynamically", "set", "the", "filename", ".", "For", "consumers", ",", "it", "'", "s", "used", "as", "a", "filename", "filter", ".", "For", "producers", ",", "it", "'", "s", "used", "to", "evaluate", "the", "filename", "to", "write", ".", "If", "an", "expression", "is", "set", ",", "it", "take", "precedence", "over", "the", "CamelFileName", "header", ".", "(", "Note", ":", "The", "header", "itself", "can", "also", "be", "an", "Expression", ")", ".", "The", "expression", "options", "support", "both", "String", "and", "Expression", "types", ".", "If", "the", "expression", "is", "a", "String", "type", ",", "it", "is", "always", "evaluated", "using", "the", "File", "Language", ".", "If", "the", "expression", "is", "an", "Expression", "type", ",", "the", "specified", "Expression", "type", "is", "used", "-", "this", "allows", "you", ",", "for", "instance", ",", "to", "use", "OGNL", "expressions", ".", "For", "the", "consumer", ",", "you", "can", "use", "it", "to", "filter", "filenames", ",", "so", "you", "can", "for", "instance", "consume", "today", "'", "s", "file", "using", "the", "File", "Language", "syntax", ":", "mydata", "-", "$", "date", ":", "now", ":", "yyyyMMdd", ".", "txt", ".", "The", "producers", "support", "the", "CamelOverruleFileName", "header", "which", "takes", "precedence", "over", "any", "existing", "CamelFileName", "header", ";", "the", "CamelOverruleFileName", "is", "a", "header", "that", "is", "used", "only", "once", ",", "and", "makes", "it", "easier", "as", "this", "avoids", "to", "temporary", "store", "CamelFileName", "and", "have", "to", "restore", "it", "afterwards", ".", "|", "|", "String", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "strictHostKeyChecking", "*", "(", "producer", ")", "|", "Sets", "whether", "to", "use", "strict", "host", "key", "checking", ".", "Possible", "values", "are", ":", "no", ",", "yes", "|", "no", "|", "String", "|", "*", "allowNullBody", "*", "(", "producer", ")", "|", "Used", "to", "specify", "if", "a", "null", "body", "is", "allowed", "during", "file", "writing", ".", "If", "set", "to", "true", "then", "an", "empty", "file", "will", "be", "created", ",", "when", "set", "to", "false", ",", "and", "attempting", "to", "send", "a", "null", "body", "to", "the", "file", "component", ",", "a", "GenericFileWriteException", "of", "'", "Cannot", "write", "null", "body", "to", "file", ".", "'", "will", "be", "thrown", ".", "If", "the", "fileExist", "option", "is", "set", "to", "'", "Override", "'", ",", "then", "the", "file", "will", "be", "truncated", ",", "and", "if", "set", "to", "append", "the", "file", "will", "remain", "unchanged", ".", "|", "false", "|", "boolean", "|", "*", "disconnectOnBatchComplete", "*", "(", "producer", ")", "|", "Whether", "or", "not", "to", "disconnect", "from", "remote", "FTP", "server", "right", "after", "a", "Batch", "upload", "is", "complete", ".", "disconnectOnBatchComplete", "will", "only", "disconnect", "the", "current", "connection", "to", "the", "FTP", "server", ".", "|", "false", "|", "boolean", "@", "@", "-", "51", ",", "7", "+", "51", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "==", "=", "=", "==", "=", "Query", "Parameters", "(", "117", "parameters", ")", ":", "=", "==", "=", "Query", "Parameters", "(", "118", "parameters", ")", ":", "[", "width", "=", "\"", "100", "%", "\",", "cols", "=", "\"", "2", ",", "5", ",", "^", "1", ",", "2", "\"", ",", "options", "=", "\"", "header", "\"", "]", "@", "@", "-", "87", ",", "6", "+", "87", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "useList", "*", "(", "consumer", ")", "|", "Whether", "to", "allow", "using", "LIST", "command", "when", "downloading", "a", "file", ".", "Default", "is", "true", ".", "In", "some", "use", "cases", "you", "may", "want", "to", "download", "a", "specific", "file", "and", "are", "not", "allowed", "to", "use", "the", "LIST", "command", ",", "and", "therefore", "you", "can", "set", "this", "option", "to", "false", ".", "Notice", "when", "using", "this", "option", ",", "then", "the", "specific", "file", "to", "download", "does", "not", "include", "meta", "-", "data", "information", "such", "as", "file", "size", ",", "timestamp", ",", "permissions", "etc", ",", "because", "those", "information", "is", "only", "possible", "to", "retrieve", "when", "LIST", "command", "is", "in", "use", ".", "|", "true", "|", "boolean", "|", "*", "fileExist", "*", "(", "producer", ")", "|", "What", "to", "do", "if", "a", "file", "already", "exists", "with", "the", "same", "name", ".", "Override", ",", "which", "is", "the", "default", ",", "replaces", "the", "existing", "file", ".", "Append", "-", "adds", "content", "to", "the", "existing", "file", ".", "Fail", "-", "throws", "a", "GenericFileOperationException", ",", "indicating", "that", "there", "is", "already", "an", "existing", "file", ".", "Ignore", "-", "silently", "ignores", "the", "problem", "and", "does", "not", "override", "the", "existing", "file", ",", "but", "assumes", "everything", "is", "okay", ".", "Move", "-", "option", "requires", "to", "use", "the", "moveExisting", "option", "to", "be", "configured", "as", "well", ".", "The", "option", "eagerDeleteTargetFile", "can", "be", "used", "to", "control", "what", "to", "do", "if", "an", "moving", "the", "file", ",", "and", "there", "exists", "already", "an", "existing", "file", ",", "otherwise", "causing", "the", "move", "operation", "to", "fail", ".", "The", "Move", "option", "will", "move", "any", "existing", "files", ",", "before", "writing", "the", "target", "file", ".", "TryRename", "is", "only", "applicable", "if", "tempFileName", "option", "is", "in", "use", ".", "This", "allows", "to", "try", "renaming", "the", "file", "from", "the", "temporary", "name", "to", "the", "actual", "name", ",", "without", "doing", "any", "exists", "check", ".", "This", "check", "may", "be", "faster", "on", "some", "file", "systems", "and", "especially", "FTP", "servers", ".", "|", "Override", "|", "GenericFileExist", "|", "*", "flatten", "*", "(", "producer", ")", "|", "Flatten", "is", "used", "to", "flatten", "the", "file", "name", "path", "to", "strip", "any", "leading", "paths", ",", "so", "it", "'", "s", "just", "the", "file", "name", ".", "This", "allows", "you", "to", "consume", "recursively", "into", "sub", "-", "directories", ",", "but", "when", "you", "eg", "write", "the", "files", "to", "another", "directory", "they", "will", "be", "written", "in", "a", "single", "directory", ".", "Setting", "this", "to", "true", "on", "the", "producer", "enforces", "that", "any", "file", "name", "in", "CamelFileName", "header", "will", "be", "stripped", "for", "any", "leading", "paths", ".", "|", "false", "|", "boolean", "|", "*", "jailStartingDirectory", "*", "(", "producer", ")", "|", "Used", "for", "jailing", "(", "restricting", ")", "writing", "files", "to", "the", "starting", "directory", "(", "and", "sub", ")", "only", ".", "This", "is", "enabled", "by", "default", "to", "not", "allow", "Camel", "to", "write", "files", "to", "outside", "directories", "(", "to", "be", "more", "secured", "out", "of", "the", "box", ")", ".", "You", "can", "turn", "this", "off", "to", "allow", "writing", "files", "to", "directories", "outside", "the", "starting", "directory", ",", "such", "as", "parent", "or", "root", "folders", ".", "|", "true", "|", "boolean", "|", "*", "moveExisting", "*", "(", "producer", ")", "|", "Expression", "(", "such", "as", "File", "Language", ")", "used", "to", "compute", "file", "name", "to", "use", "when", "fileExist", "=", "Move", "is", "configured", ".", "To", "move", "files", "into", "a", "backup", "subdirectory", "just", "enter", "backup", ".", "This", "option", "only", "supports", "the", "following", "File", "Language", "tokens", ":", "file", ":", "name", ",", "file", ":", "name", ".", "ext", ",", "file", ":", "name", ".", "noext", ",", "file", ":", "onlyname", ",", "file", ":", "onlyname", ".", "noext", ",", "file", ":", "ext", ",", "and", "file", ":", "parent", ".", "Notice", "the", "file", ":", "parent", "is", "not", "supported", "by", "the", "FTP", "component", ",", "as", "the", "FTP", "component", "can", "only", "move", "any", "existing", "files", "to", "a", "relative", "directory", "based", "on", "current", "dir", "as", "base", ".", "|", "|", "String", "|", "*", "tempFileName", "*", "(", "producer", ")", "|", "The", "same", "as", "tempPrefix", "option", "but", "offering", "a", "more", "fine", "grained", "control", "on", "the", "naming", "of", "the", "temporary", "filename", "as", "it", "uses", "the", "File", "Language", ".", "|", "|", "String", "|", "*", "tempPrefix", "*", "(", "producer", ")", "|", "This", "option", "is", "used", "to", "write", "the", "file", "using", "a", "temporary", "name", "and", "then", ",", "after", "the", "write", "is", "complete", ",", "rename", "it", "to", "the", "real", "name", ".", "Can", "be", "used", "to", "identify", "files", "being", "written", "and", "also", "avoid", "consumers", "(", "not", "using", "exclusive", "read", "locks", ")", "reading", "in", "progress", "files", ".", "Is", "often", "used", "by", "FTP", "when", "uploading", "big", "files", ".", "|", "|", "String"], "docstring_tokens": ["view", "arbitrary", "files", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2", ",", "6", "+", "2", ",", "9", "@", "@", "PHP", "NEWS", "|", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "?", "?", "?", "??", "2015", "PHP", "5", ".", "4", ".", "40", "-", "GD", ":", ".", "Fixed", "bug", "#", "68601", "(", "buffer", "read", "overflow", "in", "gd_gif_in", ".", "c", ")", ".", "(", "Remi", ")", "-", "SOAP", ":", ".", "Fixed", "bug", "#", "69152", "(", "Type", "Confusion", "Infoleak", "Vulnerability", "in", "unserialize", "(", ")", "with", "SoapFault", ")", ".", "(", "Dmitry", ")", "@", "@", "-", "72", ",", "8", "+", "72", ",", "10", "@", "@", "static", "struct", "{", "#", "define", "STACK_SIZE", "(", "(", "1", "<", "<(", "MAX_LWZ_BITS", ")", ")*", "2", ")", "#", "define", "CSD_BUF_SIZE", "280", "typedef", "struct", "{", "unsigned", "char", "buf", "[", "280", "]", ";", "unsigned", "char", "buf", "[", "CSD_BUF_SIZE", "]", ";", "int", "curbit", ",", "lastbit", ",", "done", ",", "last_byte", ";", "}", "CODE_STATIC_DATA", ";", "@", "@", "-", "400", ",", "7", "+", "402", ",", "12", "@", "@", "GetCode_", "(", "gdIOCtx", "*", "fd", ",", "CODE_STATIC_DATA", "*", "scd", ",", "int", "code_size", ",", "int", "flag", ",", "int", "*", "ZeroD", "ret", "=", "0", ";", "for", "(", "i", "=", "scd", "-", ">", "curbit", ",", "j", "=", "0", ";", "j", "<", "code_size", ";", "+", "+", "i", ",", "+", "+", "j", ")", "ret", "|", "=", "(", "(", "scd", "-", ">", "buf", "[", "i", "/", "8", "]", "&", "(", "1", "<", "<", "(", "i", "%", "8", ")", "))", "!", "=", "0", ")", "<", "<", "j", ";", "if", "(", "i", "<", "CSD_BUF_SIZE", "*", "8", ")", "{", "ret", "|", "=", "(", "(", "scd", "-", ">", "buf", "[", "i", "/", "8", "]", "&", "(", "1", "<", "<", "(", "i", "%", "8", ")", "))", "!", "=", "0", ")", "<", "<", "j", ";", "}", "else", "{", "ret", "=", "-", "1", ";", "break", ";", "}", "scd", "-", ">", "curbit", "+", "=", "code_size", ";", "return", "ret", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system", "or", "cause", "the", "server", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "13", ",", "8", "+", "13", ",", "6", "@", "@", "#", "include", "\"", "auth_x", ".", "h", "\"", "#", "include", "\"", "auth_x_protocol", ".", "h", "\"", "#", "define", "TEMP_TICKET_BUF_LEN", "256", "static", "void", "ceph_x_validate_tickets", "(", "struct", "ceph_auth_client", "*", "ac", ",", "int", "*", "pneed", ")", ";", "static", "int", "ceph_x_is_authenticated", "(", "struct", "ceph_auth_client", "*", "ac", ")", "@", "@", "-", "64", ",", "7", "+", "62", ",", "7", "@", "@", "static", "int", "ceph_x_encrypt", "(", "struct", "ceph_crypto_key", "*", "secret", ",", "}", "static", "int", "ceph_x_decrypt", "(", "struct", "ceph_crypto_key", "*", "secret", ",", "void", "*", "*", "p", ",", "void", "*", "end", ",", "void", "*", "obuf", ",", "size_t", "olen", ")", "void", "*", "*", "p", ",", "void", "*", "end", ",", "void", "*", "*", "obuf", ",", "size_t", "olen", ")", "{", "struct", "ceph_x_encrypt_header", "head", ";", "size_t", "head_len", "=", "sizeof", "(", "head", ")", ";", "@", "@", "-", "75", ",", "8", "+", "73", ",", "14", "@", "@", "static", "int", "ceph_x_decrypt", "(", "struct", "ceph_crypto_key", "*", "secret", ",", "return", "-", "EINVAL", ";", "dout", "(", "\"", "ceph_x_decrypt", "len", "%", "d", "\\", "n", "\"", ",", "len", ")", ";", "ret", "=", "ceph_decrypt2", "(", "secret", ",", "&", "head", ",", "&", "head_len", ",", "obuf", ",", "&", "olen", ",", "*", "p", ",", "len", ")", ";", "if", "(", "*", "obuf", "=", "=", "NULL", ")", "{", "*", "obuf", "=", "kmalloc", "(", "len", ",", "GFP_NOFS", ")", ";", "if", "(", "!*", "obuf", ")", "return", "-", "ENOMEM", ";", "olen", "=", "len", ";", "}", "ret", "=", "ceph_decrypt2", "(", "secret", ",", "&", "head", ",", "&", "head_len", ",", "*", "obuf", ",", "&", "olen", ",", "*", "p", ",", "len", ")", ";", "if", "(", "ret", ")", "return", "ret", ";", "if", "(", "head", ".", "struct_v", "!", "=", "1", "|", "|", "le64_to_cpu", "(", "head", ".", "magic", ")", "!", "=", "CEPHX_ENC_MAGIC", ")", "@", "@", "-", "131", ",", "18", "+", "135", ",", "19", "@", "@", "static", "void", "remove_ticket_handler", "(", "struct", "ceph_auth_client", "*", "ac", ",", "static", "int", "process_one_ticket", "(", "struct", "ceph_auth_client", "*", "ac", ",", "struct", "ceph_crypto_key", "*", "secret", ",", "void", "*", "*", "p", ",", "void", "*", "end", ",", "void", "*", "dbuf", ",", "void", "*", "ticket_buf", ")", "void", "*", "*", "p", ",", "void", "*", "end", ")", "{", "struct", "ceph_x_info", "*", "xi", "=", "ac", "-", ">", "private", ";", "int", "type", ";", "u8", "tkt_struct_v", ",", "blob_struct_v", ";", "struct", "ceph_x_ticket_handler", "*", "th", ";", "void", "*", "dbuf", "=", "NULL", ";", "void", "*", "dp", ",", "*", "dend", ";", "int", "dlen", ";", "char", "is_enc", ";", "struct", "timespec", "validity", ";", "struct", "ceph_crypto_key", "old_key", ";", "void", "*", "ticket_buf", "=", "NULL", ";", "void", "*", "tp", ",", "*", "tpend", ";", "struct", "ceph_timespec", "new_validity", ";", "struct", "ceph_crypto_key", "new_session_key", ";", "@", "@", "-", "167", ",", "8", "+", "172", ",", "7", "@", "@", "static", "int", "process_one_ticket", "(", "struct", "ceph_auth_client", "*", "ac", ",", "}", "/", "*", "blob", "for", "me", "*", "/", "dlen", "=", "ceph_x_decrypt", "(", "secret", ",", "p", ",", "end", ",", "dbuf", ",", "TEMP_TICKET_BUF_LEN", ")", ";", "dlen", "=", "ceph_x_decrypt", "(", "secret", ",", "p", ",", "end", ",", "&", "dbuf", ",", "0", ")", ";", "if", "(", "dlen", "<", "=", "0", ")", "{", "ret", "=", "dlen", ";", "goto", "out", ";", "@", "@", "-", "195", ",", "20", "+", "199", ",", "25", "@", "@", "static", "int", "process_one_ticket", "(", "struct", "ceph_auth_client", "*", "ac", ",", "/", "*", "ticket", "blob", "for", "service", "*", "/", "ceph_decode_8_safe", "(", "p", ",", "end", ",", "is_enc", ",", "bad", ")", ";", "tp", "=", "ticket_buf", ";", "if", "(", "is_enc", ")", "{", "/", "*", "encrypted", "*", "/", "dout", "(", "\"", "encrypted", "ticket", "\\", "n", "\"", ");", "dlen", "=", "ceph_x_decrypt", "(", "&", "old_key", ",", "p", ",", "end", ",", "ticket_buf", ",", "TEMP_TICKET_BUF_LEN", ")", ";", "dlen", "=", "ceph_x_decrypt", "(", "&", "old_key", ",", "p", ",", "end", ",", "&", "ticket_buf", ",", "0", ")", ";", "if", "(", "dlen", "<", "0", ")", "{", "ret", "=", "dlen", ";", "goto", "out", ";", "}", "tp", "=", "ticket_buf", ";", "dlen", "=", "ceph_decode_32", "(", "&", "tp", ")", ";", "}", "else", "{", "/", "*", "unencrypted", "*", "/", "ceph_decode_32_safe", "(", "p", ",", "end", ",", "dlen", ",", "bad", ")", ";", "ticket_buf", "=", "kmalloc", "(", "dlen", ",", "GFP_NOFS", ")", ";", "if", "(", "!", "ticket_buf", ")", "{", "ret", "=", "-", "ENOMEM", ";", "goto", "out", ";", "}", "tp", "=", "ticket_buf", ";", "ceph_decode_need", "(", "p", ",", "end", ",", "dlen", ",", "bad", ")", ";", "ceph_decode_copy", "(", "p", ",", "ticket_buf", ",", "dlen", ")", ";", "}", "@", "@", "-", "237", ",", "6", "+", "246", ",", "8", "@", "@", "static", "int", "process_one_ticket", "(", "struct", "ceph_auth_client", "*", "ac", ",", "xi", "-", ">", "have_keys", "|", "=", "th", "-", ">", "service", ";", "out", ":", "kfree", "(", "ticket_buf", ")", ";", "kfree", "(", "dbuf", ")", ";", "return", "ret", ";", "bad", ":", "@", "@", "-", "249", ",", "21", "+", "260", ",", "10", "@", "@", "static", "int", "ceph_x_proc_ticket_reply", "(", "struct", "ceph_auth_client", "*", "ac", ",", "void", "*", "buf", ",", "void", "*", "end", ")", "{", "void", "*", "p", "=", "buf", ";", "char", "*", "dbuf", ";", "char", "*", "ticket_buf", ";", "u8", "reply_struct_v", ";", "u32", "num", ";", "int", "ret", ";", "dbuf", "=", "kmalloc", "(", "TEMP_TICKET_BUF_LEN", ",", "GFP_NOFS", ")", ";", "if", "(", "!", "dbuf", ")", "return", "-", "ENOMEM", ";", "ret", "=", "-", "ENOMEM", ";", "ticket_buf", "=", "kmalloc", "(", "TEMP_TICKET_BUF_LEN", ",", "GFP_NOFS", ")", ";", "if", "(", "!", "ticket_buf", ")", "goto", "out_dbuf", ";", "ceph_decode_8_safe", "(", "&", "p", ",", "end", ",", "reply_struct_v", ",", "bad", ")", ";", "if", "(", "reply_struct_v", "!", "=", "1", ")", "return", "-", "EINVAL", ";", "@", "@", "-", "272", ",", "22", "+", "272", ",", "15", "@", "@", "static", "int", "ceph_x_proc_ticket_reply", "(", "struct", "ceph_auth_client", "*", "ac", ",", "dout", "(", "\"%", "d", "tickets", "\\", "n", "\"", ",", "num", ")", ";", "while", "(", "num", "-", "-)", "{", "ret", "=", "process_one_ticket", "(", "ac", ",", "secret", ",", "&", "p", ",", "end", ",", "dbuf", ",", "ticket_buf", ")", ";", "ret", "=", "process_one_ticket", "(", "ac", ",", "secret", ",", "&", "p", ",", "end", ")", ";", "if", "(", "ret", ")", "goto", "out", ";", "return", "ret", ";", "}", "ret", "=", "0", ";", "out", ":", "kfree", "(", "ticket_buf", ")", ";", "out_dbuf", ":", "kfree", "(", "dbuf", ")", ";", "return", "ret", ";", "return", "0", ";", "bad", ":", "ret", "=", "-", "EINVAL", ";", "goto", "out", ";", "return", "-", "EINVAL", ";", "}", "static", "int", "ceph_x_build_authorizer", "(", "struct", "ceph_auth_client", "*", "ac", ",", "@", "@", "-", "603", ",", "13", "+", "596", ",", "14", "@", "@", "static", "int", "ceph_x_verify_authorizer_reply", "(", "struct", "ceph_auth_client", "*", "ac", ",", "struct", "ceph_x_ticket_handler", "*", "th", ";", "int", "ret", "=", "0", ";", "struct", "ceph_x_authorize_reply", "reply", ";", "void", "*", "preply", "=", "&", "reply", ";", "void", "*", "p", "=", "au", "-", ">", "reply_buf", ";", "void", "*", "end", "=", "p", "+", "sizeof", "(", "au", "-", ">", "reply_buf", ")", ";", "th", "=", "get_ticket_handler", "(", "ac", ",", "au", "-", ">", "service", ")", ";", "if", "(", "IS_ERR", "(", "th", ")", ")", "return", "PTR_ERR", "(", "th", ")", ";", "ret", "=", "ceph_x_decrypt", "(", "&", "th", "-", ">", "session_key", ",", "&", "p", ",", "end", ",", "&", "reply", ",", "sizeof", "(", "reply", ")", ");", "ret", "=", "ceph_x_decrypt", "(", "&", "th", "-", ">", "session_key", ",", "&", "p", ",", "end", ",", "&", "preply", ",", "sizeof", "(", "reply", ")", ");", "if", "(", "ret", "<", "0", ")", "return", "ret", ";", "if", "(", "ret", "!", "=", "sizeof", "(", "reply", ")", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(system", "crash", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2670", ",", "6", "+", "2670", ",", "10", "@", "@", "static", "int", "do_anonymous_page", "(", "struct", "mm_struct", "*", "mm", ",", "struct", "vm_area_struct", "*", "vma", ",", "pte_unmap", "(", "page_table", ")", ";", "/", "*", "File", "mapping", "without", "-", ">", "vm_ops", "?", "*", "/", "if", "(", "vma", "-", ">", "vm_flags", "&", "VM_SHARED", ")", "return", "VM_FAULT_SIGBUS", ";", "/", "*", "Check", "if", "we", "need", "to", "add", "a", "guard", "page", "to", "the", "stack", "*", "/", "if", "(", "check_stack_guard_page", "(", "vma", ",", "address", ")", "<", "0", ")", "return", "VM_FAULT_SIGSEGV", ";", "@", "@", "-", "3099", ",", "6", "+", "3103", ",", "9", "@", "@", "static", "int", "do_fault", "(", "struct", "mm_struct", "*", "mm", ",", "struct", "vm_area_struct", "*", "vma", ",", "-", "vma", "-", ">", "vm_start", ")", ">", ">", "PAGE_SHIFT", ")", "+", "vma", "-", ">", "vm_pgoff", ";", "pte_unmap", "(", "page_table", ")", ";", "/", "*", "The", "VMA", "was", "not", "fully", "populated", "on", "mmap", "(", ")", "or", "missing", "VM_DONTEXPAND", "*", "/", "if", "(", "!", "vma", "-", ">", "vm_ops", "-", ">", "fault", ")", "return", "VM_FAULT_SIGBUS", ";", "if", "(", "!(", "flags", "&", "FAULT_FLAG_WRITE", ")", ")", "return", "do_read_fault", "(", "mm", ",", "vma", ",", "address", ",", "pmd", ",", "pgoff", ",", "flags", ",", "orig_pte", ")", ";", "@", "@", "-", "3244", ",", "13", "+", "3251", ",", "12", "@", "@", "static", "int", "handle_pte_fault", "(", "struct", "mm_struct", "*", "mm", ",", "barrier", "(", ");", "if", "(", "!", "pte_present", "(", "entry", ")", ")", "{", "if", "(", "pte_none", "(", "entry", ")", ")", "{", "if", "(", "vma", "-", ">", "vm_ops", ")", "{", "if", "(", "likely", "(", "vma", "-", ">", "vm_ops", "-", ">", "fault", ")", ")", "return", "do_fault", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";", "}", "return", "do_anonymous_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ")", ";", "if", "(", "vma", "-", ">", "vm_ops", ")", "return", "do_fault", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";", "return", "do_anonymous_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ")", ";", "}", "return", "do_swap_page", "(", "mm", ",", "vma", ",", "address", ",", "pte", ",", "pmd", ",", "flags", ",", "entry", ")", ";"], "docstring_tokens": ["gain", "privileges", "or", "cause", "a", "denial", "of", "service", "(page", "tainting", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1314", ",", "13", "+", "1314", ",", "14", "@", "@", "int", "hidp_connection_add", "(", "struct", "hidp_connadd_req", "*", "req", ",", "{", "struct", "hidp_session", "*", "session", ";", "struct", "l2cap_conn", "*", "conn", ";", "struct", "l2cap_chan", "*", "chan", "=", "l2cap_pi", "(", "ctrl_sock", "-", ">", "sk", ")", "->", "chan", ";", "struct", "l2cap_chan", "*", "chan", ";", "int", "ret", ";", "ret", "=", "hidp_verify_sockets", "(", "ctrl_sock", ",", "intr_sock", ")", ";", "if", "(", "ret", ")", "return", "ret", ";", "chan", "=", "l2cap_pi", "(", "ctrl_sock", "-", ">", "sk", ")", "->", "chan", ";", "conn", "=", "NULL", ";", "l2cap_chan_lock", "(", "chan", ")", ";", "if", "(", "chan", "-", ">", "conn", ")"], "docstring_tokens": ["gain", "elevated", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "32", ",", "12", "+", "32", ",", "14", "@", "@", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "jose", ".", "jwt", ".", "JwtUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oauth2", ".", "common", ".", "Client", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oauth2", ".", "common", ".", "OAuthContext", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oauth2", ".", "common", ".", "OAuthPermission", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oauth2", ".", "provider", ".", "OAuthDataProvider", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oauth2", ".", "provider", ".", "OAuthServerJoseJwtProducer", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oauth2", ".", "utils", ".", "OAuthContextUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oauth2", ".", "utils", ".", "OAuthUtils", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oidc", ".", "common", ".", "IdToken", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oidc", ".", "common", ".", "UserInfo", ";", "import", "org", ".", "apache", ".", "cxf", ".", "rs", ".", "security", ".", "oidc", ".", "utils", ".", "OidcUtils", ";", "@", "Path", "(", "\"/", "userinfo", "\"", ")", "public", "class", "UserInfoService", "extends", "OAuthServerJoseJwtProducer", "{", "@", "@", "-", "51", ",", "6", "+", "53", ",", "14", "@", "@", "@", "Produces", "(", "{\"", "application", "/", "json", "\"", ",", "\"", "application", "/", "jwt", "\"", "}", ")", "public", "Response", "getUserInfo", "(", ")", "{", "OAuthContext", "oauth", "=", "OAuthContextUtils", ".", "getContext", "(", "mc", ")", ";", "/", "/", "Check", "the", "access", "token", "has", "the", "\"", "openid", "\"", "scope", "if", "(", "!", "oauth", ".", "getPermissions", "(", ").", "stream", "(", ")", ".", "map", "(", "OAuthPermission", ":", ":", "getPermission", ")", ".", "anyMatch", "(", "OidcUtils", ".", "OPENID_SCOPE", ":", ":", "equals", ")", ")", "{", "Response", ".", "status", "(", "401", ")", ";", "}", "UserInfo", "userInfo", "=", "null", ";", "if", "(", "userInfoProvider", "!", "=", "null", ")", "{", "userInfo", "=", "userInfoProvider", ".", "getUserInfo", "(", "oauth", ".", "getClientId", "(", "),", "oauth", ".", "getSubject", "(", "),"], "docstring_tokens": ["steal", "an", "authorization", "code", "issued", "to", "another", "client"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "204", ",", "6", "+", "204", ",", "7", "@", "@", "typedef", "struct", "HLSContext", "{", "char", "*", "http_proxy", ";", "/", "//", "<", "holds", "the", "address", "of", "the", "HTTP", "proxy", "server", "AVDictionary", "*", "avio_opts", ";", "int", "strict_std_compliance", ";", "char", "*", "allowed_extensions", ";", "}", "HLSContext", ";", "static", "int", "read_chomp_line", "(", "AVIOContext", "*", "s", ",", "char", "*", "buf", ",", "int", "maxlen", ")", "@", "@", "-", "618", ",", "8", "+", "619", ",", "19", "@", "@", "static", "int", "open_url", "(", "AVFormatContext", "*", "s", ",", "AVIOContext", "*", "*", "pb", ",", "const", "char", "*", "url", ",", "return", "AVERROR_INVALIDDATA", ";", "/", "/", "only", "http", "(", "s", ")", "&", "file", "are", "allowed", "if", "(", "!", "av_strstart", "(", "proto_name", ",", "\"", "http", "\"", ",", "NULL", ")", "&", "&", "!", "av_strstart", "(", "proto_name", ",", "\"", "file", "\"", ",", "NULL", ")", ")", "if", "(", "av_strstart", "(", "proto_name", ",", "\"", "file", "\"", ",", "NULL", ")", ")", "{", "if", "(", "strcmp", "(", "c", "-", ">", "allowed_extensions", ",", "\"", "ALL", "\"", ")", "&", "&", "!", "av_match_ext", "(", "url", ",", "c", "-", ">", "allowed_extensions", ")", ")", "{", "av_log", "(", "s", ",", "AV_LOG_ERROR", ",", "\"", "Filename", "extension", "of", "\\", "'%", "s", "\\", "'", "is", "not", "a", "common", "multimedia", "extension", ",", "blocked", "for", "security", "reasons", ".", "\\", "n", "\"", "\"", "If", "you", "wish", "to", "override", "this", "adjust", "allowed_extensions", ",", "you", "can", "set", "it", "to", "\\", "'", "ALL", "\\", "'", "to", "allow", "all", "\\", "n", "\"", ",", "url", ")", ";", "return", "AVERROR_INVALIDDATA", ";", "}", "}", "else", "if", "(", "av_strstart", "(", "proto_name", ",", "\"", "http", "\"", ",", "NULL", ")", ")", "{", ";", "}", "else", "return", "AVERROR_INVALIDDATA", ";", "if", "(", "!", "strncmp", "(", "proto_name", ",", "url", ",", "strlen", "(", "proto_name", ")", ")", "&", "&", "url", "[", "strlen", "(", "proto_name", ")", "]", "=", "=", "'", ":'", ")", ";", "else", "if", "(", "av_strstart", "(", "url", ",", "\"", "crypto", "\"", ",", "NULL", ")", "&", "&", "!", "strncmp", "(", "proto_name", ",", "url", "+", "7", ",", "strlen", "(", "proto_name", ")", ")", "&", "&", "url", "[", "7", "+", "strlen", "(", "proto_name", ")", "]", "=", "=", "'", ":'", ")", "@", "@", "-", "2134", ",", "6", "+", "2146", ",", "10", "@", "@", "static", "int", "hls_probe", "(", "AVProbeData", "*", "p", ")", "static", "const", "AVOption", "hls_options", "[", "]", "=", "{", "{", "\"", "live_start_index", "\"", ",", "\"", "segment", "index", "to", "start", "live", "streams", "at", "(", "negative", "values", "are", "from", "the", "end", ")", "\",", "OFFSET", "(", "live_start_index", ")", ",", "AV_OPT_TYPE_INT", ",", "{", ".", "i64", "=", "-", "3", "}", ",", "INT_MIN", ",", "INT_MAX", ",", "FLAGS", "}", ",", "{", "\"", "allowed_extensions", "\"", ",", "\"", "List", "of", "file", "extensions", "that", "hls", "is", "allowed", "to", "access", "\"", ",", "OFFSET", "(", "allowed_extensions", ")", ",", "AV_OPT_TYPE_STRING", ",", "{", ".", "str", "=", "\"", "3gp", ",", "aac", ",", "avi", ",", "flac", ",", "mkv", ",", "m3u8", ",", "m4a", ",", "m4s", ",", "m4v", ",", "mpg", ",", "mov", ",", "mp2", ",", "mp3", ",", "mp4", ",", "mpeg", ",", "mpegts", ",", "ogg", ",", "ogv", ",", "oga", ",", "ts", ",", "vob", ",", "wav", "\"", "},", "INT_MIN", ",", "INT_MAX", ",", "FLAGS", "}", ",", "{", "NULL", "}", "}", ";"], "docstring_tokens": ["read", "arbitrary", "files", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1104", ",", "9", "+", "1104", ",", "6", "@", "@", "private", "void", "addStatus", "(", "UnknownHostException", "e", ")", "{", "*", "/", "protected", "abstract", "void", "onSuccess", "(", ");", "private", "Authentication", "authentication", ";", "/", "**", "*", "During", "download", ",", "an", "attempt", "is", "made", "to", "compute", "the", "SHA", "-", "1", "checksum", "of", "the", "file", ".", "*", "@", "@", "-", "1115", ",", "7", "+", "1112", ",", "13", "@", "@", "private", "void", "addStatus", "(", "UnknownHostException", "e", ")", "{", "/", "/", "TODO", "no", "new", "API", "in", "LTS", ",", "but", "remove", "for", "mainline", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "@", "CheckForNull", "protected", "String", "computedSHA1", ";", "protected", "String", "getComputedSHA1", "(", ")", "{", "return", "computedSHA1", ";", "}", "private", "String", "computedSHA1", ";", "private", "Authentication", "authentication", ";", "/", "**", "*", "Get", "the", "user", "that", "initiated", "this", "job", "@", "@", "-", "1168", ",", "7", "+", "1171", ",", "8", "@", "@", "protected", "void", "_run", "(", ")", "throws", "IOException", ",", "InstallationStatus", "{", "dis", ".", "close", "(", ");", "}", "byte", "[", "]", "digest", "=", "sha1", ".", "digest", "(", ");", "computedSHA1", "=", "Base64", ".", "encodeBase64String", "(", "digest", ")", ";", "/", "/", "need", "to", "trim", "because", "commons", "-", "codec", "1", ".", "4", "used", "in", "test", "chunked", "output", "and", "adds", "\\", "r", "\\", "n", "at", "the", "end", "computedSHA1", "=", "Base64", ".", "encodeBase64String", "(", "digest", ")", ".", "trim", "(", ");", "}", "catch", "(", "NoSuchAlgorithmException", "ignored", ")", "{", "/", "/", "Irrelevant", "as", "the", "Java", "spec", "says", "SHA", "-", "1", "must", "exist", ".", "Still", ",", "if", "this", "fails", "/", "/", "the", "DownloadJob", "will", "just", "have", "computedSha1", "=", "null", "and", "that", "is", "expected", "@", "@", "-", "1374", ",", "30", "+", "1378", ",", "33", "@", "@", "public", "String", "toString", "(", ")", "{", "*", "/", "@", "Override", "protected", "void", "replace", "(", "File", "dst", ",", "File", "src", ")", "throws", "IOException", "{", "File", "bak", "=", "Util", ".", "changeExtension", "(", "dst", ",", "\".", "bak", "\"", ");", "bak", ".", "delete", "(", ");", "final", "File", "legacy", "=", "getLegacyDestination", "(", ");", "if", "(", "legacy", ".", "exists", "(", "))", "{", "legacy", ".", "renameTo", "(", "bak", ")", ";", "}", "else", "{", "dst", ".", "renameTo", "(", "bak", ")", ";", "}", "legacy", ".", "delete", "(", ");", "if", "(", "plugin", ".", "sha1", "!", "=", "null", ")", "{", "if", "(", "computedSHA1", "=", "=", "null", ")", "{", "if", "(", "plugin", ".", "getSha1", "(", ")", "!", "=", "null", ")", "{", "if", "(", "getComputedSHA1", "(", ")", "=", "=", "null", ")", "{", "/", "/", "refuse", "to", "install", "if", "SHA", "-", "1", "could", "not", "be", "computed", "throw", "new", "IOException", "(", "\"", "Failed", "to", "compute", "SHA", "-", "1", "of", "downloaded", "file", ",", "refusing", "installation", "\"", ");", "}", "if", "(", "!", "plugin", ".", "sha1", ".", "equals", "(", "computedSHA1", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "Downloaded", "file", "\"", "+", "src", ".", "getAbsolutePath", "(", ")", "+", "\"", "does", "not", "match", "expected", "SHA", "-", "1", ",", "expected", "\"", "+", "plugin", ".", "sha1", "+", "\"", ",", "actual", "\"", "+", "computedSHA1", ")", ";", "if", "(", "!", "plugin", ".", "getSha1", "(", ").", "equals", "(", "getComputedSHA1", "(", "))", ")", "{", "throw", "new", "IOException", "(", "\"", "Downloaded", "file", "\"", "+", "src", ".", "getAbsolutePath", "(", ")", "+", "\"", "does", "not", "match", "expected", "SHA", "-", "1", ",", "expected", "\"", "+", "plugin", ".", "getSha1", "(", ")", "+", "\"", ",", "actual", "\"", "+", "getComputedSHA1", "(", "))", ";", "/", "/", "keep", "'", "src", "'", "around", "for", "investigating", "what", "'", "s", "going", "on", "}", "}", "dst", ".", "delete", "(", ");", "/", "/", "any", "failure", "up", "to", "here", "is", "no", "big", "deal", "File", "bak", "=", "Util", ".", "changeExtension", "(", "dst", ",", "\"", ".", "bak", "\"", ");", "bak", ".", "delete", "(", ");", "final", "File", "legacy", "=", "getLegacyDestination", "(", ");", "if", "(", "legacy", ".", "exists", "(", "))", "{", "if", "(", "!", "legacy", ".", "renameTo", "(", "bak", ")", ")", "{", "legacy", ".", "delete", "(", ");", "}", "}", "if", "(", "dst", ".", "exists", "(", "))", "{", "if", "(", "!", "dst", ".", "renameTo", "(", "bak", ")", ")", "{", "dst", ".", "delete", "(", ");", "}", "}", "if", "(", "!", "src", ".", "renameTo", "(", "dst", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "Failed", "to", "rename", "\"", "+", "src", "+", "\"", "to", "\"", "+", "dst", ")", ";", "}", "@", "@", "-", "1515", ",", "14", "+", "1522", ",", "14", "@", "@", "protected", "void", "onSuccess", "(", ")", "{", "@", "Override", "protected", "void", "replace", "(", "File", "dst", ",", "File", "src", ")", "throws", "IOException", "{", "String", "expectedSHA1", "=", "site", ".", "getData", "(", ").", "core", ".", "sha1", ";", "String", "expectedSHA1", "=", "site", ".", "getData", "(", ").", "core", ".", "getSha1", "(", ");", "if", "(", "expectedSHA1", "!", "=", "null", ")", "{", "if", "(", "computedSHA1", "=", "=", "null", ")", "{", "if", "(", "getComputedSHA1", "(", ")", "=", "=", "null", ")", "{", "/", "/", "refuse", "to", "install", "if", "SHA", "-", "1", "could", "not", "be", "computed", "throw", "new", "IOException", "(", "\"", "Failed", "to", "compute", "SHA", "-", "1", "of", "downloaded", "file", ",", "refusing", "installation", "\"", ");", "}", "if", "(", "!", "expectedSHA1", ".", "equals", "(", "computedSHA1", ")", ")", "{", "throw", "new", "IOException", "(", "\"", "Downloaded", "file", "\"", "+", "src", ".", "getAbsolutePath", "(", ")", "+", "\"", "does", "not", "match", "expected", "SHA", "-", "1", ",", "expected", "\"", "+", "expectedSHA1", "+", "\"", ",", "actual", "\"", "+", "computedSHA1", ")", ";", "if", "(", "!", "expectedSHA1", ".", "equals", "(", "getComputedSHA1", "(", "))", ")", "{", "throw", "new", "IOException", "(", "\"", "Downloaded", "file", "\"", "+", "src", ".", "getAbsolutePath", "(", ")", "+", "\"", "does", "not", "match", "expected", "SHA", "-", "1", ",", "expected", "\"", "+", "expectedSHA1", "+", "\"", ",", "actual", "\"", "+", "getComputedSHA1", "(", "))", ";", "/", "/", "keep", "'", "src", "'", "around", "for", "investigating", "what", "'", "s", "going", "on", "}", "}", "@", "@", "-", "510", ",", "12", "+", "510", ",", "7", "@", "@", "public", "boolean", "canUpgrade", "(", ")", "{", "@", "Exported", "public", "final", "String", "url", ";", "/", "**", "*", "The", "base64", "encoded", "binary", "SHA", "-", "1", "checksum", "of", "the", "file", ".", "*", "@", "since", "TODO", "*", "/", "/", "/", "TODO", "@", "Exported", "assuming", "we", "want", "this", "in", "the", "API", "public", "final", "String", "sha1", ";", "private", "final", "String", "sha1", ";", "public", "Entry", "(", "String", "sourceId", ",", "JSONObject", "o", ")", "{", "this", "(", "sourceId", ",", "o", ",", "null", ")", ";", "@", "@", "-", "536", ",", "6", "+", "531", ",", "16", "@", "@", "public", "Entry", "(", "String", "sourceId", ",", "JSONObject", "o", ")", "{", "this", ".", "url", "=", "url", ";", "}", "/", "**", "*", "The", "base64", "encoded", "binary", "SHA", "-", "1", "checksum", "of", "the", "file", ".", "*", "Can", "be", "null", "if", "not", "provided", "by", "the", "update", "site", ".", "*", "@", "since", "TODO", "*", "/", "/", "/", "TODO", "@", "Exported", "assuming", "we", "want", "this", "in", "the", "API", "public", "String", "getSha1", "(", ")", "{", "return", "sha1", ";", "}", "/", "**", "*", "Checks", "if", "the", "specified", "\"", "current", "version", "\"", "is", "older", "than", "the", "version", "of", "this", "entry", ".", "*"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "493", ",", "6", "+", "493", ",", "28", "@", "@", "static", "char", "*", "php_zipobj_get_zip_comment", "(", "struct", "zip", "*", "za", ",", "int", "*", "len", "TSRMLS_DC", ")", "/", "*", "#", "else", "#", "define", "GLOB_FLAGMASK", "(", "~", "0", ")", "#", "endif", "#", "ifndef", "GLOB_BRACE", "#", "define", "GLOB_BRACE", "0", "#", "endif", "#", "ifndef", "GLOB_MARK", "#", "define", "GLOB_MARK", "0", "#", "endif", "#", "ifndef", "GLOB_NOSORT", "#", "define", "GLOB_NOSORT", "0", "#", "endif", "#", "ifndef", "GLOB_NOCHECK", "#", "define", "GLOB_NOCHECK", "0", "#", "endif", "#", "ifndef", "GLOB_NOESCAPE", "#", "define", "GLOB_NOESCAPE", "0", "#", "endif", "#", "ifndef", "GLOB_ERR", "#", "define", "GLOB_ERR", "0", "#", "endif", "/", "*", "This", "is", "used", "for", "checking", "validity", "of", "passed", "flags", "(", "passing", "invalid", "flags", "causes", "segfault", "in", "glob", "(", ")!", "!", "*", "/", "#", "define", "GLOB_AVAILABLE_FLAGS", "(", "0", "|", "GLOB_BRACE", "|", "GLOB_MARK", "|", "GLOB_NOSORT", "|", "GLOB_NOCHECK", "|", "GLOB_NOESCAPE", "|", "GLOB_ERR", "|", "GLOB_ONLYDIR", ")", "#", "endif", "/", "*", "}", "}}", "*", "/", "int", "php_zip_glob", "(", "char", "*", "pattern", ",", "int", "pattern_len", ",", "long", "flags", ",", "zval", "*", "return_value", "TSRMLS_DC", ")", "/", "*", "{", "{{", "*", "/", "@", "@", "-", "507", ",", "6", "+", "529", ",", "16", "@", "@", "int", "php_zip_glob", "(", "char", "*", "pattern", ",", "int", "pattern_len", ",", "long", "flags", ",", "zval", "*", "return_value", "glob_t", "globbuf", ";", "int", "n", ";", "int", "ret", ";", "if", "(", "pattern_len", ">", "=", "MAXPATHLEN", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Pattern", "exceeds", "the", "maximum", "allowed", "length", "of", "%", "d", "characters", "\"", ",", "MAXPATHLEN", ")", ";", "return", "-", "1", ";", "}", "if", "(", "(", "GLOB_AVAILABLE_FLAGS", "&", "flags", ")", "!", "=", "flags", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "At", "least", "one", "of", "the", "passed", "flags", "is", "invalid", "or", "not", "supported", "on", "this", "platform", "\"", ");", "return", "-", "1", ";", "}", "#", "ifdef", "ZTS", "if", "(", "!", "IS_ABSOLUTE_PATH", "(", "pattern", ",", "pattern_len", ")", ")", "{"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(application", "crash", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "23", ",", "6", "+", "23", ",", "7", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "exception", ".", "ScimResourceNotFoundException", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneHolder", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "MultitenantJdbcClientDetailsService", ";", "import", "org", ".", "springframework", ".", "dao", ".", "EmptyResultDataAccessException", ";", "import", "org", ".", "springframework", ".", "http", ".", "ResponseEntity", ";", "@", "@", "-", "75", ",", "10", "+", "76", ",", "12", "@", "@", "public", "TokenRevocationEndpoint", "(", "MultitenantJdbcClientDetailsService", "clientDetails", "@", "RequestMapping", "(", "\"/", "oauth", "/", "token", "/", "revoke", "/", "client", "/", "{", "clientId", "}", "\")", "public", "ResponseEntity", "<", "Void", ">", "revokeTokensForClient", "(", "@", "PathVariable", "String", "clientId", ")", "{", "logger", ".", "debug", "(", "\"", "Revoking", "tokens", "for", "client", ":", "\"", "+", "clientId", ")", ";", "String", "zoneId", "=", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", ");", "BaseClientDetails", "client", "=", "(", "BaseClientDetails", ")", "clientDetailsService", ".", "loadClientByClientId", "(", "clientId", ")", ";", "client", ".", "addAdditionalInformation", "(", "ClientConstants", ".", "TOKEN_SALT", ",", "generator", ".", "generate", "(", "))", ";", "clientDetailsService", ".", "updateClientDetails", "(", "client", ")", ";", "logger", ".", "debug", "(", "\"", "Tokens", "revoked", "for", "client", ":", "\"", "+", "clientId", ")", ";", "tokenProvisioning", ".", "deleteByClient", "(", "clientId", ",", "zoneId", ")", ";", "return", "new", "ResponseEntity", "<", ">(", "OK", ")", ";", "}", "@", "@", "-", "46", ",", "6", "+", "46", ",", "7", "@", "@", "protected", "final", "static", "String", "DELETE_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "token_id", "=", "?", "and", "identity_zone_id", "=", "?\"", ";", "protected", "final", "static", "String", "DELETE_EXPIRED_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "expires_at", "<", "?", "\";", "protected", "final", "static", "String", "DELETE_REFRESH_TOKEN_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "user_id", "=", "?", "AND", "client_id", "=", "?", "AND", "response_type", "=", "'\"", "+", "REFRESH_TOKEN_RESPONSE_TYPE", "+", "\"", "'", "AND", "identity_zone_id", "=", "?\"", ";", "protected", "final", "static", "String", "DELETE_BY_CLIENT_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "identity_zone_id", "=", "?", "and", "client_id", "=", "?\"", ";", "protected", "final", "static", "String", "DELETE_BY_ZONE_QUERY", "=", "\"", "DELETE", "FROM", "\"", "+", "TABLE", "+", "\"", "WHERE", "identity_zone_id", "=", "?\"", ";", "@", "@", "-", "56", ",", "7", "+", "57", ",", "7", "@", "@", "protected", "AtomicLong", "lastExpiredCheck", "=", "new", "AtomicLong", "(", "0", ")", ";", "protected", "long", "expirationCheckInterval", "=", "30000", ";", "/", "/", "30", "seconds", "protected", "JdbcRevocableTokenProvisioning", "(", "JdbcTemplate", "jdbcTemplate", ")", "{", "public", "JdbcRevocableTokenProvisioning", "(", "JdbcTemplate", "jdbcTemplate", ")", "{", "this", ".", "rowMapper", "=", "new", "RevocableTokenRowMapper", "(", ");", "this", ".", "template", "=", "jdbcTemplate", ";", "}", "@", "@", "-", "136", ",", "6", "+", "137", ",", "11", "@", "@", "public", "RevocableToken", "delete", "(", "String", "id", ",", "int", "version", ")", "{", "return", "previous", ";", "}", "@", "Override", "public", "int", "deleteByClient", "(", "String", "clientId", ",", "String", "zoneId", ")", "{", "return", "template", ".", "update", "(", "DELETE_BY_CLIENT_QUERY", ",", "zoneId", ",", "clientId", ")", ";", "}", "@", "Override", "public", "int", "deleteByIdentityZone", "(", "String", "zoneId", ")", "{", "return", "template", ".", "update", "(", "DELETE_BY_ZONE_QUERY", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "@", "@", "-", "26", ",", "6", "+", "26", ",", "6", "@", "@", "List", "<", "RevocableToken", ">", "getClientTokens", "(", "String", "clientId", ")", ";", "int", "deleteByClient", "(", "String", "clientId", ",", "String", "zoneId", ")", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "121", "@", "@", "/", "*", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Cloud", "Foundry", "*", "Copyright", "(", "c", ")", "[", "2009", "-", "2017", "]", "Pivotal", "Software", ",", "Inc", ".", "All", "Rights", "Reserved", ".", "*", "*", "This", "product", "is", "licensed", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ").", "*", "You", "may", "not", "use", "this", "product", "except", "in", "compliance", "with", "the", "License", ".", "*", "*", "This", "product", "includes", "a", "number", "of", "subcomponents", "with", "*", "separate", "copyright", "notices", "and", "license", "terms", ".", "Your", "use", "of", "these", "*", "subcomponents", "is", "subject", "to", "the", "terms", "and", "conditions", "of", "the", "*", "subcomponent", "'", "s", "license", ",", "as", "noted", "in", "the", "LICENSE", "file", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "/", "package", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaAuthentication", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaAuthenticationDetails", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "authentication", ".", "UaaPrincipal", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "constants", ".", "OriginKeys", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "JdbcRevocableTokenProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "RevocableToken", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "resources", ".", "jdbc", ".", "JdbcPagingListFactory", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "ScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "scim", ".", "jdbc", ".", "JdbcScimUserProvisioning", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "test", ".", "JdbcTestBase", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneHolder", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "MultitenantJdbcClientDetailsService", ";", "import", "org", ".", "junit", ".", "After", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "context", ".", "ApplicationEventPublisher", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "context", ".", "SecurityContextHolder", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "util", ".", "RandomValueStringGenerator", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "ClientDetails", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "OAuth2Request", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "client", ".", "BaseClientDetails", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ".", "TOKEN_SALT", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotEquals", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "spy", ";", "public", "class", "TokenRevocationEndpointTests", "extends", "JdbcTestBase", "{", "private", "TokenRevocationEndpoint", "endpoint", ";", "private", "RandomValueStringGenerator", "generator", ";", "private", "BaseClientDetails", "client", ";", "private", "ApplicationEventPublisher", "publisher", ";", "private", "MultitenantJdbcClientDetailsService", "clientService", ";", "@", "Before", "public", "void", "setupForTokenRevocation", "(", ")", "throws", "Exception", "{", "String", "zoneId", "=", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", ");", "generator", "=", "new", "RandomValueStringGenerator", "(", ");", "String", "clientId", "=", "generator", ".", "generate", "(", ").", "toLowerCase", "(", ");", "client", "=", "new", "BaseClientDetails", "(", "clientId", ",", "\"", "\",", "\"", "some", ".", "scopes", "\"", ",", "\"", "client_credentials", "\"", ",", "\"", "authorities", "\"", ");", "client", ".", "addAdditionalInformation", "(", "TOKEN_SALT", ",", "\"", "pre", "-", "salt", "\"", ");", "clientService", "=", "spy", "(", "new", "MultitenantJdbcClientDetailsService", "(", "dataSource", ")", ");", "clientService", ".", "addClientDetails", "(", "client", ")", ";", "ScimUserProvisioning", "userProvisioning", "=", "new", "JdbcScimUserProvisioning", "(", "jdbcTemplate", ",", "new", "JdbcPagingListFactory", "(", "jdbcTemplate", ",", "limitSqlAdapter", ")", ")", ";", "JdbcRevocableTokenProvisioning", "provisioning", "=", "spy", "(", "new", "JdbcRevocableTokenProvisioning", "(", "jdbcTemplate", ")", ");", "endpoint", "=", "spy", "(", "new", "TokenRevocationEndpoint", "(", "clientService", ",", "userProvisioning", ",", "provisioning", ")", ");", "publisher", "=", "mock", "(", "ApplicationEventPublisher", ".", "class", ")", ";", "SecurityContextHolder", ".", "getContext", "(", ").", "setAuthentication", "(", "new", "UaaOauth2Authentication", "(", "\"", "token", "-", "value", "\"", ",", "zoneId", ",", "mock", "(", "OAuth2Request", ".", "class", ")", ",", "new", "UaaAuthentication", "(", "new", "UaaPrincipal", "(", "\"", "id", "\"", ",", "\"", "username", "\"", ",", "\"", "username", "@", "test", ".", "com", "\"", ",", "OriginKeys", ".", "UAA", ",", "\"", "\",", "zoneId", ")", ",", "Collections", ".", "emptyList", "(", "),", "mock", "(", "UaaAuthenticationDetails", ".", "class", ")", ")", ")", ")", ";", "provisioning", ".", "create", "(", "new", "RevocableToken", "(", ")", ".", "setClientId", "(", "client", ".", "getClientId", "(", "))", ".", "setTokenId", "(", "\"", "token", "-", "id", "\"", ")", ".", "setUserId", "(", "null", ")", ".", "setResponseType", "(", "RevocableToken", ".", "TokenType", ".", "ACCESS_TOKEN", ")", ".", "setValue", "(", "\"", "value", "\"", ")", ".", "setIssuedAt", "(", "System", ".", "currentTimeMillis", "(", "))", ")", ";", "}", "@", "After", "public", "void", "cleanup", "(", ")", "throws", "Exception", "{", "SecurityContextHolder", ".", "clearContext", "(", ");", "IdentityZoneHolder", ".", "clear", "(", ");", "}", "@", "Test", "public", "void", "revokeTokensForClient", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "pre", "-", "salt", "\"", ",", "getClient", "(", ").", "getAdditionalInformation", "(", ").", "get", "(", "TOKEN_SALT", ")", ");", "assertEquals", "(", "1", ",", "clientTokenCount", "(", "))", ";", "endpoint", ".", "revokeTokensForClient", "(", "client", ".", "getClientId", "(", "))", ";", "assertNotEquals", "(", "\"", "pre", "-", "salt", "\"", ",", "getClient", "(", ").", "getAdditionalInformation", "(", ").", "get", "(", "TOKEN_SALT", ")", ");", "assertEquals", "(", "0", ",", "clientTokenCount", "(", "))", ";", "}", "public", "ClientDetails", "getClient", "(", ")", "{", "return", "clientService", ".", "loadClientByClientId", "(", "client", ".", "getClientId", "(", "))", ";", "}", "public", "int", "clientTokenCount", "(", ")", "{", "return", "jdbcTemplate", ".", "queryForObject", "(", "\"", "select", "count", "(", "*)", "from", "revocable_tokens", "where", "client_id", "=", "?", "\",", "Integer", ".", "class", ",", "client", ".", "getClientId", "(", "))", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "69", ",", "7", "+", "69", ",", "7", "@", "@", "authentication", "-", "manager", "-", "ref", "=", "\"", "emptyAuthenticationManager", "\"", "entry", "-", "point", "-", "ref", "=", "\"", "oauthAuthenticationEntryPoint", "\"", "xmlns", "=", "\"", "http", ":", "//", "www", ".", "springframework", ".", "org", "/", "schema", "/", "security", "\"", "use", "-", "expressions", "=", "\"", "true", "\"", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "oauth", "/", "token", "/", "revoke", "/", "client", "/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasScope", "(", "'", "uaa", ".", "admin", "'", ")", "or", "@", "self", ".", "isClientTokenRevocationForSelf", "(", "request", ",", "4", ")", "\"", "/", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "oauth", "/", "token", "/", "revoke", "/", "client", "/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasScope", "(", "'", "tokens", ".", "revoke", "'", ")\"", "/", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "oauth", "/", "token", "/", "revoke", "/", "user", "/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasScope", "(", "'", "uaa", ".", "admin", "'", ")", "or", "(", "#", "oauth2", ".", "hasScope", "(", "'", "tokens", ".", "revoke", "'", ")", "and", "@", "self", ".", "isUserTokenRevocationForSelf", "(", "request", ",", "4", ")", ")\"", "/", ">", "<", "intercept", "-", "url", "pattern", "=", "\"/", "oauth", "/", "token", "/", "revoke", "/", "**", "\"", "access", "=", "\"#", "oauth2", ".", "hasScope", "(", "'", "tokens", ".", "revoke", "'", ")", "or", "@", "self", ".", "isTokenRevocationForSelf", "(", "request", ",", "3", ")", "\"", "method", "=", "\"", "DELETE", "\"", "/>", "<", "intercept", "-", "url", "pattern", "=", "\"/", "**", "\"", "access", "=", "\"", "denyAll", "\"", "/", ">", "@", "@", "-", "692", ",", "7", "+", "692", ",", "7", "@", "@", "public", "void", "revokeAllTokens_forAClient", "(", ")", "throws", "Exception", "{", "true", ")", ";", "Snippet", "requestHeaders", "=", "requestHeaders", "(", "headerWithName", "(", "\"", "Authorization", "\"", ").", "description", "(", "\"", "Bearer", "token", "with", "uaa", ".", "admin", "or", "tokens", ".", "revoke", "scope", ".", "Any", "token", "with", "the", "matching", "client_id", "may", "also", "be", "used", "for", "self", "revocation", ".", "\")", ",", "headerWithName", "(", "\"", "Authorization", "\"", ").", "description", "(", "\"", "Bearer", "token", "with", "uaa", ".", "admin", "or", "tokens", ".", "revoke", "scope", ".", "\")", ",", "IDENTITY_ZONE_ID_HEADER", ",", "IDENTITY_ZONE_SUBDOMAIN_HEADER", ")", ";", "@", "@", "-", "2948", ",", "50", "+", "2948", ",", "119", "@", "@", "public", "void", "revokeOwnJWToken", "(", ")", "throws", "Exception", "{", "}", "@", "Test", "public", "void", "revokeOtherClientToken", "(", ")", "throws", "Exception", "{", "public", "void", "revokeOtherClientTokenByJti", "(", ")", "throws", "Exception", "{", "String", "revokerClientId", "=", "generator", ".", "generate", "(", ");", "String", "resourceClientId", "=", "generator", ".", "generate", "(", ");", "BaseClientDetails", "resourceClient", "=", "new", "BaseClientDetails", "(", "resourceClientId", ",", "\"", "\",", "\"", "tokens", ".", "revoke", "\"", ",", "\"", "uaa", ".", "resource", "\"", ",", "\"", "client_credentials", ",", "password", "\"", ",", "\"", "uaa", ".", "resource", "\"", ");", "\"", "uaa", ".", "resource", "\"", ",", "\"", "http", ":", "//", "redirect", ".", "uri", "\"", ");", "resourceClient", ".", "setClientSecret", "(", "\"", "secret", "\"", ");", "createClient", "(", "getMockMvc", "(", "),", "adminToken", ",", "resourceClient", ")", ";", "BaseClientDetails", "client", "=", "new", "BaseClientDetails", "(", "BaseClientDetails", "revokerClient", "=", "new", "BaseClientDetails", "(", "generator", ".", "generate", "(", "),", "\"", "\",", "\"", "uaa", ".", "none", "\"", ",", "\"", "openid", "\"", ",", "\"", "client_credentials", ",", "password", "\"", ",", "\"", "tokens", ".", "revoke", "\"", ");", "client", ".", "setClientSecret", "(", "\"", "secret", "\"", ");", "createClient", "(", "getMockMvc", "(", "),", "adminToken", ",", "client", ")", ";", "\"", "tokens", ".", "revoke", "\"", ",", "\"", "http", ":", "//", "redirect", ".", "uri", "\"", ");", "revokerClient", ".", "setClientSecret", "(", "\"", "secret", "\"", ");", "createClient", "(", "getMockMvc", "(", "),", "adminToken", ",", "revokerClient", ")", ";", "/", "/", "this", "is", "the", "token", "we", "will", "revoke", "String", "revokeAccessToken", "=", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "client", ".", "getClientId", "(", "),", "client", ".", "getClientSecret", "(", "),", "\"", "tokens", ".", "revoke", "\"", ",", "null", ",", "false", ")", ";", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "revokerClient", ".", "getClientId", "(", "),", "SECRET", ",", "\"", "tokens", ".", "revoke", "\"", ",", "null", ",", "false", ")", ";", "String", "tokenToBeRevoked", "=", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "resourceClientId", ",", "resourceClient", ".", "getClientSecret", "(", "),", "null", ",", "null", ",", "true", ")", ";", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "resourceClientId", ",", "SECRET", ",", "null", ",", "null", ",", "true", ")", ";", "getMockMvc", "(", ").", "perform", "(", "delete", "(", "\"/", "oauth", "/", "token", "/", "revoke", "/", "\"", "+", "tokenToBeRevoked", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "revokeAccessToken", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "revokeAccessToken", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";", "try", "{", "tokenProvisioning", ".", "retrieve", "(", "tokenToBeRevoked", ")", ";", "fail", "(", "\"", "Token", "should", "have", "been", "deleted", "\"", ");", "}", "catch", "(", "EmptyResultDataAccessException", "e", ")", "{", "/", "/", "expected", "}", "}", "@", "Test", "public", "void", "revokeOtherClientTokenByClientId_tokensDotRevoke", "(", ")", "throws", "Exception", "{", "revokeOtherClientTokenByClientId", "(", "\"", "tokens", ".", "revoke", "\"", ");", "}", "@", "Test", "public", "void", "revokeOtherClientTokenByClientId_uaaDotAdmin", "(", ")", "throws", "Exception", "{", "revokeOtherClientTokenByClientId", "(", "\"", "uaa", ".", "admin", "\"", ");", "}", "public", "void", "revokeOtherClientTokenByClientId", "(", "String", "scope", ")", "throws", "Exception", "{", "String", "revokerClientId", "=", "generator", ".", "generate", "(", ");", "String", "resourceClientId", "=", "generator", ".", "generate", "(", ");", "BaseClientDetails", "revokerClient", "=", "setUpClients", "(", "revokerClientId", ",", "scope", ",", "\"", "openid", "\"", ",", "\"", "client_credentials", ",", "password", "\"", ",", "true", ")", ";", "BaseClientDetails", "targetClient", "=", "setUpClients", "(", "resourceClientId", ",", "\"", "uaa", ".", "none", "\"", ",", "\"", "openid", "\"", ",", "\"", "client_credentials", ",", "password", "\"", ",", "true", ")", ";", "/", "/", "this", "is", "the", "token", "we", "will", "revoke", "String", "revokeAccessToken", "=", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "revokerClient", ".", "getClientId", "(", "),", "SECRET", ",", "scope", ",", "null", ",", "false", ")", ";", "String", "tokenToBeRevoked", "=", "getClientCredentialsOAuthAccessToken", "(", "getMockMvc", "(", "),", "resourceClientId", ",", "SECRET", ",", "null", ",", "null", ",", "true", ")", ";", "getMockMvc", "(", ").", "perform", "(", "delete", "(", "\"/", "oauth", "/", "token", "/", "revoke", "/", "client", "/", "\"", "+", "resourceClientId", ")", ".", "header", "(", "\"", "Authorization", "\"", ",", "\"", "Bearer", "\"", "+", "revokeAccessToken", ")", ")", ".", "andExpect", "(", "status", "(", ").", "isOk", "(", "))", ";", "try", "{"], "docstring_tokens": ["revoke", "client", "tokens", "for", "other", "users", "on", "the", "same", "client", "."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "932", ",", "7", "+", "932", ",", "7", "@", "@", "int", "kernel_read_file", "(", "struct", "file", "*", "file", ",", "void", "*", "*", "buf", ",", "loff_t", "*", "size", ",", "bytes", "=", "kernel_read", "(", "file", ",", "*", "buf", "+", "pos", ",", "i_size", "-", "pos", ",", "&", "pos", ")", ";", "if", "(", "bytes", "<", "0", ")", "{", "ret", "=", "bytes", ";", "goto", "out", ";", "goto", "out_free", ";", "}", "if", "(", "bytes", "=", "=", "0", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1692", ",", "17", "+", "1692", ",", "15", "@", "@", "static", "void", "apic_sync_pv_eoi_from_guest", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "void", "kvm_lapic_sync_from_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "u32", "data", ";", "void", "*", "vapic", ";", "if", "(", "test_bit", "(", "KVM_APIC_PV_EOI_PENDING", ",", "&", "vcpu", "-", ">", "arch", ".", "apic_attention", ")", ")", "apic_sync_pv_eoi_from_guest", "(", "vcpu", ",", "vcpu", "-", ">", "arch", ".", "apic", ")", ";", "if", "(", "!", "test_bit", "(", "KVM_APIC_CHECK_VAPIC", ",", "&", "vcpu", "-", ">", "arch", ".", "apic_attention", ")", ")", "return", ";", "vapic", "=", "kmap_atomic", "(", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_page", ")", ";", "data", "=", "*", "(", "u32", "*", ")(", "vapic", "+", "offset_in_page", "(", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_addr", ")", ");", "kunmap_atomic", "(", "vapic", ")", ";", "kvm_read_guest_cached", "(", "vcpu", "-", ">", "kvm", ",", "&", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_cache", ",", "&", "data", ",", "sizeof", "(", "u32", ")", ");", "apic_set_tpr", "(", "vcpu", "-", ">", "arch", ".", "apic", ",", "data", "&", "0xff", ")", ";", "}", "@", "@", "-", "1738", ",", "7", "+", "1736", ",", "6", "@", "@", "void", "kvm_lapic_sync_to_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "u32", "data", ",", "tpr", ";", "int", "max_irr", ",", "max_isr", ";", "struct", "kvm_lapic", "*", "apic", "=", "vcpu", "-", ">", "arch", ".", "apic", ";", "void", "*", "vapic", ";", "apic_sync_pv_eoi_to_guest", "(", "vcpu", ",", "apic", ")", ";", "@", "@", "-", "1754", ",", "18", "+", "1751", ",", "24", "@", "@", "void", "kvm_lapic_sync_to_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "max_isr", "=", "0", ";", "data", "=", "(", "tpr", "&", "0xff", ")", "|", "(", "(", "max_isr", "&", "0xf0", ")", "<", "<", "8", ")", "|", "(", "max_irr", "<", "<", "24", ")", ";", "vapic", "=", "kmap_atomic", "(", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_page", ")", ";", "*", "(", "u32", "*", ")(", "vapic", "+", "offset_in_page", "(", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_addr", ")", ")", "=", "data", ";", "kunmap_atomic", "(", "vapic", ")", ";", "kvm_write_guest_cached", "(", "vcpu", "-", ">", "kvm", ",", "&", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_cache", ",", "&", "data", ",", "sizeof", "(", "u32", ")", ");", "}", "void", "kvm_lapic_set_vapic_addr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "vapic_addr", ")", "int", "kvm_lapic_set_vapic_addr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "vapic_addr", ")", "{", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_addr", "=", "vapic_addr", ";", "if", "(", "vapic_addr", ")", "if", "(", "vapic_addr", ")", "{", "if", "(", "kvm_gfn_to_hva_cache_init", "(", "vcpu", "-", ">", "kvm", ",", "&", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_cache", ",", "vapic_addr", ",", "sizeof", "(", "u32", ")", "))", "return", "-", "EINVAL", ";", "__set_bit", "(", "KVM_APIC_CHECK_VAPIC", ",", "&", "vcpu", "-", ">", "arch", ".", "apic_attention", ")", ";", "else", "}", "else", "{", "__clear_bit", "(", "KVM_APIC_CHECK_VAPIC", ",", "&", "vcpu", "-", ">", "arch", ".", "apic_attention", ")", ";", "}", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_addr", "=", "vapic_addr", ";", "return", "0", ";", "}", "int", "kvm_x2apic_msr_write", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "u32", "msr", ",", "u64", "data", ")", "@", "@", "-", "34", ",", "7", "+", "34", ",", "7", "@", "@", "struct", "kvm_lapic", "{", "*", "/", "void", "*", "regs", ";", "gpa_t", "vapic_addr", ";", "struct", "page", "*", "vapic_page", ";", "struct", "gfn_to_hva_cache", "vapic_cache", ";", "unsigned", "long", "pending_events", ";", "unsigned", "int", "sipi_vector", ";", "}", ";", "@", "@", "-", "76", ",", "7", "+", "76", ",", "7", "@", "@", "void", "kvm_set_lapic_tscdeadline_msr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "u64", "data", ")", ";", "void", "kvm_apic_write_nodecode", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "u32", "offset", ")", ";", "void", "kvm_apic_set_eoi_accelerated", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "int", "vector", ")", ";", "void", "kvm_lapic_set_vapic_addr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "vapic_addr", ")", ";", "int", "kvm_lapic_set_vapic_addr", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "gpa_t", "vapic_addr", ")", ";", "void", "kvm_lapic_sync_from_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", ";", "void", "kvm_lapic_sync_to_vapic", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", ";", "@", "@", "-", "3214", ",", "8", "+", "3214", ",", "7", "@", "@", "long", "kvm_arch_vcpu_ioctl", "(", "struct", "file", "*", "filp", ",", "r", "=", "-", "EFAULT", ";", "if", "(", "copy_from_user", "(", "&", "va", ",", "argp", ",", "sizeof", "va", ")", ")", "goto", "out", ";", "r", "=", "0", ";", "kvm_lapic_set_vapic_addr", "(", "vcpu", ",", "va", ".", "vapic_addr", ")", ";", "r", "=", "kvm_lapic_set_vapic_addr", "(", "vcpu", ",", "va", ".", "vapic_addr", ")", ";", "break", ";", "}", "case", "KVM_X86_SETUP_MCE", ":", "{", "@", "@", "-", "5739", ",", "36", "+", "5738", ",", "6", "@", "@", "static", "void", "post_kvm_run_save", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "!", "kvm_event_needs_reinjection", "(", "vcpu", ")", ";", "}", "static", "int", "vapic_enter", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "struct", "kvm_lapic", "*", "apic", "=", "vcpu", "-", ">", "arch", ".", "apic", ";", "struct", "page", "*", "page", ";", "if", "(", "!", "apic", "|", "|", "!", "apic", "-", ">", "vapic_addr", ")", "return", "0", ";", "page", "=", "gfn_to_page", "(", "vcpu", "-", ">", "kvm", ",", "apic", "-", ">", "vapic_addr", ">", ">", "PAGE_SHIFT", ")", ";", "if", "(", "is_error_page", "(", "page", ")", ")", "return", "-", "EFAULT", ";", "vcpu", "-", ">", "arch", ".", "apic", "-", ">", "vapic_page", "=", "page", ";", "return", "0", ";", "}", "static", "void", "vapic_exit", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "struct", "kvm_lapic", "*", "apic", "=", "vcpu", "-", ">", "arch", ".", "apic", ";", "int", "idx", ";", "if", "(", "!", "apic", "|", "|", "!", "apic", "-", ">", "vapic_addr", ")", "return", ";", "idx", "=", "srcu_read_lock", "(", "&", "vcpu", "-", ">", "kvm", "-", ">", "srcu", ")", ";", "kvm_release_page_dirty", "(", "apic", "-", ">", "vapic_page", ")", ";", "mark_page_dirty", "(", "vcpu", "-", ">", "kvm", ",", "apic", "-", ">", "vapic_addr", ">", ">", "PAGE_SHIFT", ")", ";", "srcu_read_unlock", "(", "&", "vcpu", "-", ">", "kvm", "-", ">", "srcu", ",", "idx", ")", ";", "}", "static", "void", "update_cr8_intercept", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "{", "int", "max_irr", ",", "tpr", ";", "@", "@", "-", "6069", ",", "11", "+", "6038", ",", "6", "@", "@", "static", "int", "__vcpu_run", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "struct", "kvm", "*", "kvm", "=", "vcpu", "-", ">", "kvm", ";", "vcpu", "-", ">", "srcu_idx", "=", "srcu_read_lock", "(", "&", "kvm", "-", ">", "srcu", ")", ";", "r", "=", "vapic_enter", "(", "vcpu", ")", ";", "if", "(", "r", ")", "{", "srcu_read_unlock", "(", "&", "kvm", "-", ">", "srcu", ",", "vcpu", "-", ">", "srcu_idx", ")", ";", "return", "r", ";", "}", "r", "=", "1", ";", "while", "(", "r", ">", "0", ")", "{", "@", "@", "-", "6132", ",", "8", "+", "6096", ",", "6", "@", "@", "static", "int", "__vcpu_run", "(", "struct", "kvm_vcpu", "*", "vcpu", ")", "srcu_read_unlock", "(", "&", "kvm", "-", ">", "srcu", ",", "vcpu", "-", ">", "srcu_idx", ")", ";", "vapic_exit", "(", "vcpu", ")", ";", "return", "r", ";", "}"], "docstring_tokens": ["gain", "privileges", "or", "cause", "a", "denial", "of", "service", "(system", "crash", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "42", ",", "7", "+", "42", ",", "7", "@", "@", "public", "static", "long", "getNextScheduledTime", "(", "final", "String", "cronEntry", ",", "long", "currentTime", "/", "/", "Handle", "the", "once", "per", "minute", "case", "\"", "*", "*", "*", "*", "*", "\"", "/", "/", "starting", "the", "next", "event", "at", "the", "top", "of", "the", "minute", ".", "if", "(", "cronEntry", ".", "startsWith", "(", "\"*", "*", "*", "*", "*", "\")", ")", "{", "if", "(", "cronEntry", ".", "equals", "(", "\"*", "*", "*", "*", "*", "\")", ")", "{", "result", "=", "currentTime", "+", "60", "*", "1000", ";", "result", "=", "result", "/", "1000", "*", "1000", ";", "return", "result", ";", "@", "@", "-", "40", ",", "13", "+", "40", ",", "13", "@", "@", "<", "c", ":", "forEach", "items", "=", "\"$", "{", "requestContext", ".", "brokerQuery", ".", "scheduledJobs", "}", "\"", "var", "=", "\"", "row", "\"", ">", "<", "tr", ">", "<", "td", ">", "${", "row", ".", "jobId", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "cronEntry", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "nextExecutionTime", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "start", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "delay", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "period", "}", "</", "td", ">", "<", "td", ">", "${", "row", ".", "repeat", "}", "</", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "jobId", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "cronEntry", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "nextExecutionTime", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "start", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "delay", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "period", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "c", ":", "out", "value", "=", "\"$", "{", "row", ".", "repeat", "}", "\"/", "><", "/", "td", ">", "<", "td", ">", "<", "a", "href", "=", "\"", "deleteJob", ".", "action", "?", "jobId", "=", "${", "row", ".", "jobId", "}", "&", "secret", "=", "<", "c", ":", "out", "value", "=", "'$", "{", "sessionScope", "[", "\"", "secret", "\"", "]}", "'/", ">\"", ">", "Delete", "<", "/", "a", ">", "<", "/", "td", ">"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "236", ",", "6", "+", "236", ",", "8", "@", "@", "struct", "pernet_operations", "{", "struct", "list_head", "list", ";", "int", "(", "*", "init", ")", "(", "struct", "net", "*", "net", ")", ";", "void", "(", "*", "exit", ")", "(", "struct", "net", "*", "net", ")", ";", "int", "*", "id", ";", "size_t", "size", ";", "}", ";", "/", "*", "@", "@", "-", "259", ",", "12", "+", "261", ",", "30", "@", "@", "struct", "pernet_operations", "{", "*", "/", "extern", "int", "register_pernet_subsys", "(", "struct", "pernet_operations", "*", ");", "extern", "void", "unregister_pernet_subsys", "(", "struct", "pernet_operations", "*", ");", "extern", "int", "register_pernet_gen_subsys", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", ");", "extern", "void", "unregister_pernet_gen_subsys", "(", "int", "id", ",", "struct", "pernet_operations", "*", ");", "extern", "int", "register_pernet_device", "(", "struct", "pernet_operations", "*", ");", "extern", "void", "unregister_pernet_device", "(", "struct", "pernet_operations", "*", ");", "extern", "int", "register_pernet_gen_device", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", ");", "extern", "void", "unregister_pernet_gen_device", "(", "int", "id", ",", "struct", "pernet_operations", "*", ");", "static", "inline", "int", "register_pernet_gen_subsys", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "ops", "-", ">", "id", "=", "id", ";", "return", "register_pernet_subsys", "(", "ops", ")", ";", "}", "static", "inline", "void", "unregister_pernet_gen_subsys", "(", "int", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "return", "unregister_pernet_subsys", "(", "ops", ")", ";", "}", "static", "inline", "int", "register_pernet_gen_device", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "ops", "-", ">", "id", "=", "id", ";", "return", "register_pernet_device", "(", "ops", ")", ";", "}", "static", "inline", "void", "unregister_pernet_gen_device", "(", "int", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "return", "unregister_pernet_device", "(", "ops", ")", ";", "}", "struct", "ctl_path", ";", "struct", "ctl_table", ";", "@", "@", "-", "43", ",", "13", "+", "43", ",", "40", "@", "@", "static", "void", "unregister_netdevices", "(", "struct", "net", "*", "net", ",", "struct", "list_head", "*", "list", ")", "}", "}", "static", "int", "ops_init", "(", "const", "struct", "pernet_operations", "*", "ops", ",", "struct", "net", "*", "net", ")", "{", "int", "err", ";", "if", "(", "ops", "-", ">", "id", "&", "&", "ops", "-", ">", "size", ")", "{", "void", "*", "data", "=", "kzalloc", "(", "ops", "-", ">", "size", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "data", ")", "return", "-", "ENOMEM", ";", "err", "=", "net_assign_generic", "(", "net", ",", "*", "ops", "-", ">", "id", ",", "data", ")", ";", "if", "(", "err", ")", "{", "kfree", "(", "data", ")", ";", "return", "err", ";", "}", "}", "if", "(", "ops", "-", ">", "init", ")", "return", "ops", "-", ">", "init", "(", "net", ")", ";", "return", "0", ";", "}", "static", "void", "ops_free", "(", "const", "struct", "pernet_operations", "*", "ops", ",", "struct", "net", "*", "net", ")", "{", "if", "(", "ops", "-", ">", "id", "&", "&", "ops", "-", ">", "size", ")", "{", "int", "id", "=", "*", "ops", "-", ">", "id", ";", "kfree", "(", "net_generic", "(", "net", ",", "id", ")", ");", "}", "}", "/", "*", "*", "setup_net", "runs", "the", "initializers", "for", "the", "network", "namespace", "object", ".", "*", "/", "static", "__net_init", "int", "setup_net", "(", "struct", "net", "*", "net", ")", "{", "/", "*", "Must", "be", "called", "with", "net_mutex", "held", "*", "/", "struct", "pernet_operations", "*", "ops", ";", "const", "struct", "pernet_operations", "*", "ops", ",", "*", "saved_ops", ";", "int", "error", "=", "0", ";", "atomic_set", "(", "&", "net", "-", ">", "count", ",", "1", ")", ";", "@", "@", "-", "59", ",", "11", "+", "86", ",", "9", "@", "@", "static", "__net_init", "int", "setup_net", "(", "struct", "net", "*", "net", ")", "#", "endif", "list_for_each_entry", "(", "ops", ",", "&", "pernet_list", ",", "list", ")", "{", "if", "(", "ops", "-", ">", "init", ")", "{", "error", "=", "ops", "-", ">", "init", "(", "net", ")", ";", "if", "(", "error", "<", "0", ")", "goto", "out_undo", ";", "}", "error", "=", "ops_init", "(", "ops", ",", "net", ")", ";", "if", "(", "error", "<", "0", ")", "goto", "out_undo", ";", "}", "out", ":", "return", "error", ";", "@", "@", "-", "72", ",", "6", "+", "97", ",", "7", "@", "@", "static", "__net_init", "int", "setup_net", "(", "struct", "net", "*", "net", ")", "/", "*", "Walk", "through", "the", "list", "backwards", "calling", "the", "exit", "functions", "*", "for", "the", "pernet", "modules", "whose", "init", "functions", "did", "not", "fail", ".", "*", "/", "saved_ops", "=", "ops", ";", "list_for_each_entry_continue_reverse", "(", "ops", ",", "&", "pernet_list", ",", "list", ")", "{", "if", "(", "ops", "-", ">", "exit", ")", "ops", "-", ">", "exit", "(", "net", ")", ";", "@", "@", "-", "83", ",", "6", "+", "109", ",", "9", "@", "@", "static", "__net_init", "int", "setup_net", "(", "struct", "net", "*", "net", ")", "rtnl_unlock", "(", ");", "}", "}", "ops", "=", "saved_ops", ";", "list_for_each_entry_continue_reverse", "(", "ops", ",", "&", "pernet_list", ",", "list", ")", "ops_free", "(", "ops", ",", "net", ")", ";", "rcu_barrier", "(", ");", "goto", "out", ";", "@", "@", "-", "175", ",", "7", "+", "204", ",", "7", "@", "@", "static", "LIST_HEAD", "(", "cleanup_list", ")", ";", "/", "*", "Must", "hold", "cleanup_list_lock", "to", "touch", "*", "/", "static", "void", "cleanup_net", "(", "struct", "work_struct", "*", "work", ")", "{", "struct", "pernet_operations", "*", "ops", ";", "const", "struct", "pernet_operations", "*", "ops", ";", "struct", "net", "*", "net", ",", "*", "tmp", ";", "LIST_HEAD", "(", "net_kill_list", ")", ";", "@", "@", "-", "214", ",", "6", "+", "243", ",", "13", "@", "@", "static", "void", "cleanup_net", "(", "struct", "work_struct", "*", "work", ")", "rtnl_unlock", "(", ");", "}", "}", "/", "*", "Free", "the", "net", "generic", "variables", "*", "/", "list_for_each_entry_reverse", "(", "ops", ",", "&", "pernet_list", ",", "list", ")", "{", "if", "(", "ops", "-", ">", "size", "&", "&", "ops", "-", ">", "id", ")", "{", "list_for_each_entry", "(", "net", ",", "&", "net_kill_list", ",", "cleanup_list", ")", "ops_free", "(", "ops", ",", "net", ")", ";", "}", "}", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "@", "@", "-", "309", ",", "16", "+", "345", ",", "16", "@", "@", "static", "int", "__init", "net_ns_init", "(", "void", ")", "pure_initcall", "(", "net_ns_init", ")", ";", "#", "ifdef", "CONFIG_NET_NS", "static", "int", "register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "static", "int", "__register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "struct", "net", "*", "net", ",", "*", "undo_net", ";", "int", "error", ";", "list_add_tail", "(", "&", "ops", "-", ">", "list", ",", "list", ")", ";", "if", "(", "ops", "-", ">", "init", ")", "{", "if", "(", "ops", "-", ">", "init", "|", "|", "(", "ops", "-", ">", "id", "&", "&", "ops", "-", ">", "size", ")", ")", "{", "for_each_net", "(", "net", ")", "{", "error", "=", "ops", "-", ">", "init", "(", "net", ")", ";", "error", "=", "ops_init", "(", "ops", ",", "net", ")", ";", "if", "(", "error", ")", "goto", "out_undo", ";", "}", "@", "@", "-", "336", ",", "38", "+", "372", ",", "85", "@", "@", "static", "int", "register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "}", "}", "undone", ":", "if", "(", "ops", "-", ">", "size", "&", "&", "ops", "-", ">", "id", ")", "{", "for_each_net", "(", "undo_net", ")", "{", "if", "(", "net_eq", "(", "undo_net", ",", "net", ")", ")", "goto", "freed", ";", "ops_free", "(", "ops", ",", "undo_net", ")", ";", "}", "}", "freed", ":", "return", "error", ";", "}", "static", "void", "unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "static", "void", "__unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "{", "struct", "net", "*", "net", ";", "list_del", "(", "&", "ops", "-", ">", "list", ")", ";", "if", "(", "ops", "-", ">", "exit", ")", "for_each_net", "(", "net", ")", "ops", "-", ">", "exit", "(", "net", ")", ";", "if", "(", "ops", "-", ">", "id", "&", "&", "ops", "-", ">", "size", ")", "for_each_net", "(", "net", ")", "ops_free", "(", "ops", ",", "net", ")", ";", "}", "#", "else", "static", "int", "register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "static", "int", "__register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "if", "(", "ops", "-", ">", "init", "=", "=", "NULL", ")", "return", "0", ";", "return", "ops", "-", ">", "init", "(", "&", "init_net", ")", ";", "int", "err", "=", "0", ";", "err", "=", "ops_init", "(", "ops", ",", "&", "init_net", ")", ";", "if", "(", "err", ")", "ops_free", "(", "ops", ",", "&", "init_net", ")", ";", "return", "err", ";", "}", "static", "void", "unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "static", "void", "__unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "{", "if", "(", "ops", "-", ">", "exit", ")", "ops", "-", ">", "exit", "(", "&", "init_net", ")", ";", "ops_free", "(", "ops", ",", "&", "init_net", ")", ";", "}", "#", "endif", "#", "endif", "/", "*", "CONFIG_NET_NS", "*", "/", "static", "DEFINE_IDA", "(", "net_generic_ids", ")", ";", "static", "int", "register_pernet_operations", "(", "struct", "list_head", "*", "list", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "int", "error", ";", "if", "(", "ops", "-", ">", "id", ")", "{", "again", ":", "error", "=", "ida_get_new_above", "(", "&", "net_generic_ids", ",", "1", ",", "ops", "-", ">", "id", ")", ";", "if", "(", "error", "<", "0", ")", "{", "if", "(", "error", "=", "=", "-", "EAGAIN", ")", "{", "ida_pre_get", "(", "&", "net_generic_ids", ",", "GFP_KERNEL", ")", ";", "goto", "again", ";", "}", "return", "error", ";", "}", "}", "error", "=", "__register_pernet_operations", "(", "list", ",", "ops", ")", ";", "if", "(", "error", "&", "&", "ops", "-", ">", "id", ")", "ida_remove", "(", "&", "net_generic_ids", ",", "*", "ops", "-", ">", "id", ")", ";", "return", "error", ";", "}", "static", "void", "unregister_pernet_operations", "(", "struct", "pernet_operations", "*", "ops", ")", "{", "__unregister_pernet_operations", "(", "ops", ")", ";", "if", "(", "ops", "-", ">", "id", ")", "ida_remove", "(", "&", "net_generic_ids", ",", "*", "ops", "-", ">", "id", ")", ";", "}", "/", "**", "*", "register_pernet_subsys", "-", "register", "a", "network", "namespace", "subsystem", "*", "@", "ops", ":", "pernet", "operations", "structure", "for", "the", "subsystem", "@", "@", "-", "414", ",", "38", "+", "497", ",", "6", "@", "@", "void", "unregister_pernet_subsys", "(", "struct", "pernet_operations", "*", "module", ")", "}", "EXPORT_SYMBOL_GPL", "(", "unregister_pernet_subsys", ")", ";", "int", "register_pernet_gen_subsys", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "int", "rv", ";", "mutex_lock", "(", "&", "net_mutex", ")", ";", "again", ":", "rv", "=", "ida_get_new_above", "(", "&", "net_generic_ids", ",", "1", ",", "id", ")", ";", "if", "(", "rv", "<", "0", ")", "{", "if", "(", "rv", "=", "=", "-", "EAGAIN", ")", "{", "ida_pre_get", "(", "&", "net_generic_ids", ",", "GFP_KERNEL", ")", ";", "goto", "again", ";", "}", "goto", "out", ";", "}", "rv", "=", "register_pernet_operations", "(", "first_device", ",", "ops", ")", ";", "if", "(", "rv", "<", "0", ")", "ida_remove", "(", "&", "net_generic_ids", ",", "*", "id", ")", ";", "out", ":", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "return", "rv", ";", "}", "EXPORT_SYMBOL_GPL", "(", "register_pernet_gen_subsys", ")", ";", "void", "unregister_pernet_gen_subsys", "(", "int", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "mutex_lock", "(", "&", "net_mutex", ")", ";", "unregister_pernet_operations", "(", "ops", ")", ";", "ida_remove", "(", "&", "net_generic_ids", ",", "id", ")", ";", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "}", "EXPORT_SYMBOL_GPL", "(", "unregister_pernet_gen_subsys", ")", ";", "/", "**", "*", "register_pernet_device", "-", "register", "a", "network", "namespace", "device", "*", "@", "ops", ":", "pernet", "operations", "structure", "for", "the", "subsystem", "@", "@", "-", "477", ",", "30", "+", "528", ",", "6", "@", "@", "int", "register_pernet_device", "(", "struct", "pernet_operations", "*", "ops", ")", "}", "EXPORT_SYMBOL_GPL", "(", "register_pernet_device", ")", ";", "int", "register_pernet_gen_device", "(", "int", "*", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "int", "error", ";", "mutex_lock", "(", "&", "net_mutex", ")", ";", "again", ":", "error", "=", "ida_get_new_above", "(", "&", "net_generic_ids", ",", "1", ",", "id", ")", ";", "if", "(", "error", ")", "{", "if", "(", "error", "=", "=", "-", "EAGAIN", ")", "{", "ida_pre_get", "(", "&", "net_generic_ids", ",", "GFP_KERNEL", ")", ";", "goto", "again", ";", "}", "goto", "out", ";", "}", "error", "=", "register_pernet_operations", "(", "&", "pernet_list", ",", "ops", ")", ";", "if", "(", "error", ")", "ida_remove", "(", "&", "net_generic_ids", ",", "*", "id", ")", ";", "else", "if", "(", "first_device", "=", "=", "&", "pernet_list", ")", "first_device", "=", "&", "ops", "-", ">", "list", ";", "out", ":", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "return", "error", ";", "}", "EXPORT_SYMBOL_GPL", "(", "register_pernet_gen_device", ")", ";", "/", "**", "*", "unregister_pernet_device", "-", "unregister", "a", "network", "namespace", "netdevice", "*", "@", "ops", ":", "pernet", "operations", "structure", "to", "manipulate", "@", "@", "-", "520", ",", "17", "+", "547", ",", "6", "@", "@", "void", "unregister_pernet_device", "(", "struct", "pernet_operations", "*", "ops", ")", "}", "EXPORT_SYMBOL_GPL", "(", "unregister_pernet_device", ")", ";", "void", "unregister_pernet_gen_device", "(", "int", "id", ",", "struct", "pernet_operations", "*", "ops", ")", "{", "mutex_lock", "(", "&", "net_mutex", ")", ";", "if", "(", "&", "ops", "-", ">", "list", "=", "=", "first_device", ")", "first_device", "=", "first_device", "-", ">", "next", ";", "unregister_pernet_operations", "(", "ops", ")", ";", "ida_remove", "(", "&", "net_generic_ids", ",", "id", ")", ";", "mutex_unlock", "(", "&", "net_mutex", ")", ";", "}", "EXPORT_SYMBOL_GPL", "(", "unregister_pernet_gen_device", ")", ";", "static", "void", "net_generic_release", "(", "struct", "rcu_head", "*", "rcu", ")", "{", "struct", "net_generic", "*", "ng", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "3944", ",", "16", "+", "3944", ",", "24", "@", "@", "static", "ssize_t", "l2cap_sysfs_show", "(", "struct", "class", "*", "dev", ",", "struct", "sock", "*", "sk", ";", "struct", "hlist_node", "*", "node", ";", "char", "*", "str", "=", "buf", ";", "int", "size", "=", "PAGE_SIZE", ";", "read_lock_bh", "(", "&", "l2cap_sk_list", ".", "lock", ")", ";", "sk_for_each", "(", "sk", ",", "node", ",", "&", "l2cap_sk_list", ".", "head", ")", "{", "struct", "l2cap_pinfo", "*", "pi", "=", "l2cap_pi", "(", "sk", ")", ";", "int", "len", ";", "str", "+", "=", "sprintf", "(", "str", ",", "\"", "%", "s", "%", "s", "%", "d", "%", "d", "0x", "%", "4", ".", "4x", "0x", "%", "4", ".", "4x", "%", "d", "%", "d", "%", "d", "\\", "n", "\"", ",", "len", "=", "snprintf", "(", "str", ",", "size", ",", "\"", "%", "s", "%", "s", "%", "d", "%", "d", "0x", "%", "4", ".", "4x", "0x", "%", "4", ".", "4x", "%", "d", "%", "d", "%", "d", "\\", "n", "\"", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "src", ")", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "dst", ")", ",", "sk", "-", ">", "sk_state", ",", "__le16_to_cpu", "(", "pi", "-", ">", "psm", ")", ",", "pi", "-", ">", "scid", ",", "pi", "-", ">", "dcid", ",", "pi", "-", ">", "imtu", ",", "pi", "-", ">", "omtu", ",", "pi", "-", ">", "sec_level", ")", ";", "size", "-", "=", "len", ";", "if", "(", "size", "<", "=", "0", ")", "break", ";", "str", "+", "=", "len", ";", "}", "read_unlock_bh", "(", "&", "l2cap_sk_list", ".", "lock", ")", ";", "@", "@", "-", "2105", ",", "6", "+", "2105", ",", "7", "@", "@", "static", "ssize_t", "rfcomm_dlc_sysfs_show", "(", "struct", "class", "*", "dev", ",", "struct", "rfcomm_session", "*", "s", ";", "struct", "list_head", "*", "pp", ",", "*", "p", ";", "char", "*", "str", "=", "buf", ";", "int", "size", "=", "PAGE_SIZE", ";", "rfcomm_lock", "(", ");", "@", "@", "-", "2113", ",", "11", "+", "2114", ",", "21", "@", "@", "static", "ssize_t", "rfcomm_dlc_sysfs_show", "(", "struct", "class", "*", "dev", ",", "list_for_each", "(", "pp", ",", "&", "s", "-", ">", "dlcs", ")", "{", "struct", "sock", "*", "sk", "=", "s", "-", ">", "sock", "-", ">", "sk", ";", "struct", "rfcomm_dlc", "*", "d", "=", "list_entry", "(", "pp", ",", "struct", "rfcomm_dlc", ",", "list", ")", ";", "int", "len", ";", "str", "+", "=", "sprintf", "(", "str", ",", "\"", "%", "s", "%", "s", "%", "ld", "%", "d", "%", "d", "%", "d", "%", "d", "\\", "n", "\"", ",", "len", "=", "snprintf", "(", "str", ",", "size", ",", "\"", "%", "s", "%", "s", "%", "ld", "%", "d", "%", "d", "%", "d", "%", "d", "\\", "n", "\"", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "src", ")", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "dst", ")", ",", "d", "-", ">", "state", ",", "d", "-", ">", "dlci", ",", "d", "-", ">", "mtu", ",", "d", "-", ">", "rx_credits", ",", "d", "-", ">", "tx_credits", ")", ";", "size", "-", "=", "len", ";", "if", "(", "size", "<", "=", "0", ")", "break", ";", "str", "+", "=", "len", ";", "}", "if", "(", "size", "<", "=", "0", ")", "break", ";", "}", "rfcomm_unlock", "(", ");", "@", "@", "-", "1068", ",", "13", "+", "1068", ",", "22", "@", "@", "static", "ssize_t", "rfcomm_sock_sysfs_show", "(", "struct", "class", "*", "dev", ",", "struct", "sock", "*", "sk", ";", "struct", "hlist_node", "*", "node", ";", "char", "*", "str", "=", "buf", ";", "int", "size", "=", "PAGE_SIZE", ";", "read_lock_bh", "(", "&", "rfcomm_sk_list", ".", "lock", ")", ";", "sk_for_each", "(", "sk", ",", "node", ",", "&", "rfcomm_sk_list", ".", "head", ")", "{", "str", "+", "=", "sprintf", "(", "str", ",", "\"", "%", "s", "%", "s", "%", "d", "%", "d", "\\", "n", "\"", ",", "int", "len", ";", "len", "=", "snprintf", "(", "str", ",", "size", ",", "\"", "%", "s", "%", "s", "%", "d", "%", "d", "\\", "n", "\"", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "src", ")", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "dst", ")", ",", "sk", "-", ">", "sk_state", ",", "rfcomm_pi", "(", "sk", ")", "->", "channel", ")", ";", "size", "-", "=", "len", ";", "if", "(", "size", "<", "=", "0", ")", "break", ";", "str", "+", "=", "len", ";", "}", "read_unlock_bh", "(", "&", "rfcomm_sk_list", ".", "lock", ")", ";", "@", "@", "-", "960", ",", "13", "+", "960", ",", "22", "@", "@", "static", "ssize_t", "sco_sysfs_show", "(", "struct", "class", "*", "dev", ",", "struct", "sock", "*", "sk", ";", "struct", "hlist_node", "*", "node", ";", "char", "*", "str", "=", "buf", ";", "int", "size", "=", "PAGE_SIZE", ";", "read_lock_bh", "(", "&", "sco_sk_list", ".", "lock", ")", ";", "sk_for_each", "(", "sk", ",", "node", ",", "&", "sco_sk_list", ".", "head", ")", "{", "str", "+", "=", "sprintf", "(", "str", ",", "\"", "%", "s", "%", "s", "%", "d", "\\", "n", "\"", ",", "int", "len", ";", "len", "=", "snprintf", "(", "str", ",", "size", ",", "\"", "%", "s", "%", "s", "%", "d", "\\", "n", "\"", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "src", ")", ",", "batostr", "(", "&", "bt_sk", "(", "sk", ")", "->", "dst", ")", ",", "sk", "-", ">", "sk_state", ")", ";", "size", "-", "=", "len", ";", "if", "(", "size", "<", "=", "0", ")", "break", ";", "str", "+", "=", "len", ";", "}", "read_unlock_bh", "(", "&", "sco_sk_list", ".", "lock", ")", ";"], "docstring_tokens": ["scribble", "repeatedly", "on", "arbitrary", "pages", "of", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "330", ",", "6", "+", "330", ",", "7", "@", "@", "struct", "sta_info", "*", "sta_info_alloc", "(", "struct", "ieee80211_sub_if_data", "*", "sdata", ",", "rcu_read_unlock", "(", ");", "spin_lock_init", "(", "&", "sta", "-", ">", "lock", ")", ";", "spin_lock_init", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "INIT_WORK", "(", "&", "sta", "-", ">", "drv_unblock_wk", ",", "sta_unblock", ")", ";", "INIT_WORK", "(", "&", "sta", "-", ">", "ampdu_mlme", ".", "work", ",", "ieee80211_ba_session_work", ")", ";", "mutex_init", "(", "&", "sta", "-", ">", "ampdu_mlme", ".", "mtx", ")", ";", "@", "@", "-", "1109", ",", "6", "+", "1110", ",", "8", "@", "@", "void", "ieee80211_sta_ps_deliver_wakeup", "(", "struct", "sta_info", "*", "sta", ")", "skb_queue_head_init", "(", "&", "pending", ")", ";", "/", "*", "sync", "with", "ieee80211_tx_h_unicast_ps_buf", "*", "/", "spin_lock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "/", "*", "Send", "all", "buffered", "frames", "to", "the", "station", "*", "/", "for", "(", "ac", "=", "0", ";", "ac", "<", "IEEE80211_NUM_ACS", ";", "ac", "+", "+)", "{", "int", "count", "=", "skb_queue_len", "(", "&", "pending", ")", ",", "tmp", ";", "@", "@", "-", "1128", ",", "6", "+", "1131", ",", "7", "@", "@", "void", "ieee80211_sta_ps_deliver_wakeup", "(", "struct", "sta_info", "*", "sta", ")", "}", "ieee80211_add_pending_skbs_fn", "(", "local", ",", "&", "pending", ",", "clear_sta_ps_flags", ",", "sta", ")", ";", "spin_unlock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "/", "*", "This", "station", "just", "woke", "up", "and", "isn", "'", "t", "aware", "of", "our", "SMPS", "state", "*", "/", "if", "(", "!", "ieee80211_smps_is_restrictive", "(", "sta", "-", ">", "known_smps_mode", ",", "@", "@", "-", "267", ",", "6", "+", "267", ",", "7", "@", "@", "struct", "ieee80211_tx_latency_stat", "{", "*", "@", "drv_unblock_wk", ":", "used", "for", "driver", "PS", "unblocking", "*", "@", "listen_interval", ":", "listen", "interval", "of", "this", "station", ",", "when", "we", "'", "re", "acting", "as", "AP", "*", "@", "_flags", ":", "STA", "flags", ",", "see", "&", "enum", "ieee80211_sta_info_flags", ",", "do", "not", "use", "directly", "*", "@", "ps_lock", ":", "used", "for", "powersave", "(", "when", "mac80211", "is", "the", "AP", ")", "related", "locking", "*", "@", "ps_tx_buf", ":", "buffers", "(", "per", "AC", ")", "of", "frames", "to", "transmit", "to", "this", "station", "*", "when", "it", "leaves", "power", "saving", "state", "or", "polls", "*", "@", "tx_filtered", ":", "buffers", "(", "per", "AC", ")", "of", "frames", "we", "already", "tried", "to", "@", "@", "-", "356", ",", "10", "+", "357", ",", "8", "@", "@", "struct", "sta_info", "{", "/", "*", "use", "the", "accessors", "defined", "below", "*", "/", "unsigned", "long", "_flags", ";", "/", "*", "*", "STA", "powersave", "frame", "queues", ",", "no", "more", "than", "the", "internal", "*", "locking", "required", ".", "*", "/", "/", "*", "STA", "powersave", "lock", "and", "frame", "queues", "*", "/", "spinlock_t", "ps_lock", ";", "struct", "sk_buff_head", "ps_tx_buf", "[", "IEEE80211_NUM_ACS", "]", ";", "struct", "sk_buff_head", "tx_filtered", "[", "IEEE80211_NUM_ACS", "]", ";", "unsigned", "long", "driver_buffered_tids", ";", "@", "@", "-", "478", ",", "6", "+", "478", ",", "20", "@", "@", "ieee80211_tx_h_unicast_ps_buf", "(", "struct", "ieee80211_tx_data", "*", "tx", ")", "sta", "-", ">", "sta", ".", "addr", ",", "sta", "-", ">", "sta", ".", "aid", ",", "ac", ")", ";", "if", "(", "tx", "-", ">", "local", "-", ">", "total_ps_buffered", ">", "=", "TOTAL_MAX_TX_BUFFER", ")", "purge_old_ps_buffers", "(", "tx", "-", ">", "local", ")", ";", "/", "*", "sync", "with", "ieee80211_sta_ps_deliver_wakeup", "*", "/", "spin_lock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "/", "*", "*", "STA", "woke", "up", "the", "meantime", "and", "all", "the", "frames", "on", "ps_tx_buf", "have", "*", "been", "queued", "to", "pending", "queue", ".", "No", "reordering", "can", "happen", ",", "go", "*", "ahead", "and", "Tx", "the", "packet", ".", "*", "/", "if", "(", "!", "test_sta_flag", "(", "sta", ",", "WLAN_STA_PS_STA", ")", "&", "&", "!", "test_sta_flag", "(", "sta", ",", "WLAN_STA_PS_DRIVER", ")", ")", "{", "spin_unlock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "return", "TX_CONTINUE", ";", "}", "if", "(", "skb_queue_len", "(", "&", "sta", "-", ">", "ps_tx_buf", "[", "ac", "]", ")", ">", "=", "STA_MAX_TX_BUFFER", ")", "{", "struct", "sk_buff", "*", "old", "=", "skb_dequeue", "(", "&", "sta", "-", ">", "ps_tx_buf", "[", "ac", "]", ");", "ps_dbg", "(", "tx", "-", ">", "sdata", ",", "@", "@", "-", "492", ",", "6", "+", "506", ",", "7", "@", "@", "ieee80211_tx_h_unicast_ps_buf", "(", "struct", "ieee80211_tx_data", "*", "tx", ")", "info", "-", ">", "flags", "|", "=", "IEEE80211_TX_INTFL_NEED_TXPROCESSING", ";", "info", "-", ">", "flags", "&", "=", "~", "IEEE80211_TX_TEMPORARY_FLAGS", ";", "skb_queue_tail", "(", "&", "sta", "-", ">", "ps_tx_buf", "[", "ac", "]", ",", "tx", "-", ">", "skb", ")", ";", "spin_unlock", "(", "&", "sta", "-", ">", "ps_lock", ")", ";", "if", "(", "!", "timer_pending", "(", "&", "local", "-", ">", "sta_cleanup", ")", ")", "mod_timer", "(", "&", "local", "-", ">", "sta_cleanup", ","], "docstring_tokens": ["trigger", "a", "NULL", "pointer", "dereference", "and", "crash", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1515", ",", "7", "+", "1515", ",", "8", "@", "@", "int", "do_coredump", "(", "long", "signr", ",", "int", "exit_code", ",", "struct", "pt_regs", "*", "regs", ")", "ispipe", "=", "1", ";", "}", "else", "file", "=", "filp_open", "(", "corename", ",", "O_CREAT", "|", "2", "|", "O_NOFOLLOW", "|", "O_LARGEFILE", ",", "0600", ")", ";", "O_CREAT", "|", "2", "|", "O_NOFOLLOW", "|", "O_LARGEFILE", "|", "flag", ",", "0600", ")", ";", "if", "(", "IS_ERR", "(", "file", ")", ")", "goto", "fail_unlock", ";", "inode", "=", "file", "-", ">", "f_dentry", "-", ">", "d_inode", ";"], "docstring_tokens": ["rewrite", "arbitrary", "files", "during", "a", "core", "dump"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "366", ",", "6", "+", "366", ",", "12", "@", "@", "int", "ieee80211_rx", "(", "struct", "ieee80211_device", "*", "ieee", ",", "struct", "sk_buff", "*", "skb", ",", "frag", "=", "WLAN_GET_SEQ_FRAG", "(", "sc", ")", ";", "hdrlen", "=", "ieee80211_get_hdrlen", "(", "fc", ")", ";", "if", "(", "skb", "-", ">", "len", "<", "hdrlen", ")", "{", "printk", "(", "KERN_INFO", "\"", "%", "s", ":", "invalid", "SKB", "length", "%", "d", "\\", "n", "\"", ",", "dev", "-", ">", "name", ",", "skb", "-", ">", "len", ")", ";", "goto", "rx_dropped", ";", "}", "/", "*", "Put", "this", "code", "here", "so", "that", "we", "avoid", "duplicating", "it", "in", "all", "*", "Rx", "paths", ".", "-", "Jean", "II", "*", "/", "#", "ifdef", "CONFIG_WIRELESS_EXT"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(crash", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "45", ",", "22", "+", "45", ",", "20", "@", "@", "gdImagePtr", "gdImageCrop", "(", "gdImagePtr", "src", ",", "const", "gdRectPtr", "crop", ")", "gdImagePtr", "dst", ";", "int", "y", ";", "/", "*", "check", "size", "*", "/", "if", "(", "crop", "-", ">", "width", "<", "=", "0", "|", "|", "crop", "-", ">", "height", "<", "=", "0", ")", "{", "return", "NULL", ";", "}", "/", "*", "allocate", "the", "requested", "size", "(", "could", "be", "only", "partially", "filled", ")", "*", "/", "if", "(", "src", "-", ">", "trueColor", ")", "{", "dst", "=", "gdImageCreateTrueColor", "(", "crop", "-", ">", "width", ",", "crop", "-", ">", "height", ")", ";", "if", "(", "dst", "=", "=", "NULL", ")", "{", "return", "NULL", ";", "}", "gdImageSaveAlpha", "(", "dst", ",", "1", ")", ";", "}", "else", "{", "dst", "=", "gdImageCreate", "(", "crop", "-", ">", "width", ",", "crop", "-", ">", "height", ")", ";", "if", "(", "dst", "=", "=", "NULL", ")", "{", "return", "NULL", ";", "}", "gdImagePaletteCopy", "(", "dst", ",", "src", ")", ";", "}", "if", "(", "dst", "=", "=", "NULL", ")", "{", "return", "NULL", ";", "}", "dst", "-", ">", "transparent", "=", "src", "-", ">", "transparent", ";", "/", "*", "check", "position", "in", "the", "src", "image", "*", "/", "@", "@", "-", "24", ",", "6", "+", "24", ",", "8", "@", "@", "var_dump", "(", "imagecrop", "(", "$", "img", ",", "array", "(", "\"", "x", "\"", "=", ">", "-", "20", ",", "\"", "y", "\"", "=", ">", "-", "20", ",", "\"", "width", "\"", "=", ">", "10", ",", "\"", "height", "\"", "=", "/", "/", "POC", "#", "4", "var_dump", "(", "imagecrop", "(", "$", "img", ",", "array", "(", "\"", "x", "\"", "=", ">", "0x7fffff00", ",", "\"", "y", "\"", "=", ">", "0", ",", "\"", "width", "\"", "=", ">", "10", ",", "\"", "height", "\"", "=", ">", "10", ")", "))", ";", "/", "/", "bug", "66815", "var_dump", "(", "imagecrop", "(", "$", "img", ",", "array", "(", "\"", "x", "\"", "=", ">", "0", ",", "\"", "y", "\"", "=", ">", "0", ",", "\"", "width", "\"", "=", ">", "65535", ",", "\"", "height", "\"", "=", ">", "65535", ")", "))", ";", "?", ">", "-", "-", "EXPECTF", "resource", "(", "%", "d", ")", "of", "type", "(", "gd", ")", "@", "@", "-", "35", ",", "6", "+", "37", ",", "13", "@", "@", "Array", "[", "width", "]", "=", ">", "10", "[", "height", "]", "=", ">", "10", ")", "Warning", ":", "imagecrop", "(", "):", "gd", "warning", ":", "one", "parameter", "to", "a", "memory", "allocation", "multiplication", "is", "negative", "or", "zero", ",", "failing", "operation", "gracefully", "in", "%", "sbug66356", ".", "php", "on", "line", "%", "d", "bool", "(", "false", ")", "resource", "(", "%", "d", ")", "of", "type", "(", "gd", ")", "resource", "(", "%", "d", ")", "of", "type", "(", "gd", ")", "\\", "No", "newline", "at", "end", "of", "file", "resource", "(", "%", "d", ")", "of", "type", "(", "gd", ")", "Warning", ":", "imagecrop", "(", "):", "gd", "warning", ":", "product", "of", "memory", "allocation", "multiplication", "would", "exceed", "INT_MAX", ",", "failing", "operation", "gracefully", "in", "%", "sbug66356", ".", "php", "on", "line", "%", "d", "bool", "(", "false", ")", "\\", "No", "newline", "at", "end", "of", "file"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(application", "crash", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "16", ",", "12", "+", "16", ",", "10", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "builder", ";", "import", "java", ".", "nio", ".", "charset", ".", "Charset", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "zip", ".", "Deflater", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "DataFormatDefinition", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "ProcessorDefinition", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "AvroDataFormat", ";", "@", "@", "-", "55", ",", "7", "+", "53", ",", "9", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "XmlJsonDataFormat", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "ZipDataFormat", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "ZipFileDataFormat", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "CollectionStringBuffer", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "jsse", ".", "KeyStoreParameters", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Node", ";", "/", "**", "*", "An", "expression", "for", "constructing", "the", "different", "possible", "{", "@", "link", "org", ".", "apache", ".", "camel", ".", "spi", ".", "DataFormat", "}", "@", "@", "-", "720", ",", "17", "+", "720", ",", "60", "@", "@", "public", "T", "tidyMarkup", "(", ")", "{", "}", "/", "**", "*", "Uses", "the", "XStream", "data", "format", "*", "Uses", "the", "XStream", "data", "format", ".", "*", "<", "p", "/", ">", "*", "Favor", "using", "{", "@", "link", "#", "xstream", "(", "String", ")", "}", "to", "pass", "in", "a", "permission", "*", "/", "public", "T", "xstream", "(", ")", "{", "return", "dataFormat", "(", "new", "XStreamDataFormat", "(", "))", ";", "}", "/", "**", "*", "Uses", "the", "xstream", "by", "setting", "the", "encoding", "or", "permission", "*", "*", "@", "param", "encodingOrPermission", "is", "either", "an", "encoding", "or", "permission", "syntax", "*", "/", "public", "T", "xstream", "(", "String", "encodingOrPermission", ")", "{", "/", "/", "is", "it", "an", "encoding", "?", "if", "not", "we", "assume", "its", "a", "permission", "if", "(", "Charset", ".", "isSupported", "(", "encodingOrPermission", ")", ")", "{", "return", "xstream", "(", "encodingOrPermission", ",", "(", "String", ")", "null", ")", ";", "}", "else", "{", "return", "xstream", "(", "null", ",", "encodingOrPermission", ")", ";", "}", "}", "/", "**", "*", "Uses", "the", "xstream", "by", "setting", "the", "encoding", "*", "/", "public", "T", "xstream", "(", "String", "encoding", ")", "{", "return", "dataFormat", "(", "new", "XStreamDataFormat", "(", "encoding", ")", ");", "public", "T", "xstream", "(", "String", "encoding", ",", "String", "permission", ")", "{", "XStreamDataFormat", "xdf", "=", "new", "XStreamDataFormat", "(", ");", "xdf", ".", "setPermissions", "(", "permission", ")", ";", "xdf", ".", "setEncoding", "(", "encoding", ")", ";", "return", "dataFormat", "(", "xdf", ")", ";", "}", "/", "**", "*", "Uses", "the", "xstream", "by", "permitting", "the", "java", "type", "*", "*", "@", "param", "type", "the", "pojo", "xstream", "should", "use", "as", "allowed", "permission", "*", "/", "public", "T", "xstream", "(", "Class", "<", "?>", "type", ")", "{", "return", "xstream", "(", "null", ",", "type", ")", ";", "}", "/", "**", "*", "Uses", "the", "xstream", "by", "permitting", "the", "java", "type", "*", "*", "@", "param", "encoding", "encoding", "to", "use", "*", "@", "param", "type", "the", "pojo", "class", "(", "es", ")", "xstream", "should", "use", "as", "allowed", "permission", "*", "/", "public", "T", "xstream", "(", "String", "encoding", ",", "Class", "<", "?>", "..", ".", "type", ")", "{", "CollectionStringBuffer", "csb", "=", "new", "CollectionStringBuffer", "(", "\",", "\")", ";", "for", "(", "Class", "<", "?>", "clazz", ":", "type", ")", "{", "csb", ".", "append", "(", "\"+", "\")", ";", "csb", ".", "append", "(", "clazz", ".", "getName", "(", "))", ";", "}", "return", "xstream", "(", "encoding", ",", "csb", ".", "toString", "(", "))", ";", "}", "/", "**", "@", "@", "-", "27", ",", "6", "+", "27", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "spi", ".", "DataFormat", ";", "import", "org", ".", "apache", ".", "camel", ".", "spi", ".", "Metadata", ";", "import", "org", ".", "apache", ".", "camel", ".", "spi", ".", "RouteContext", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "CollectionStringBuffer", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "ObjectHelper", ";", "/", "**", "@", "@", "-", "68", ",", "6", "+", "69", ",", "8", "@", "@", "private", "String", "enableFeatures", ";", "@", "XmlAttribute", "private", "String", "disableFeatures", ";", "@", "XmlAttribute", "private", "String", "permissions", ";", "public", "JsonDataFormat", "(", ")", "{", "super", "(", "\"", "json", "\"", ");", "@", "@", "-", "253", ",", "6", "+", "256", ",", "42", "@", "@", "public", "void", "setDisableFeatures", "(", "String", "disableFeatures", ")", "{", "this", ".", "disableFeatures", "=", "disableFeatures", ";", "}", "public", "String", "getPermissions", "(", ")", "{", "return", "permissions", ";", "}", "/", "**", "*", "Adds", "permissions", "that", "controls", "which", "Java", "packages", "and", "classes", "XStream", "is", "allowed", "to", "use", "during", "*", "unmarshal", "from", "xml", "/", "json", "to", "Java", "beans", ".", "*", "<", "p", "/", ">", "*", "A", "permission", "must", "be", "configured", "either", "here", "or", "globally", "using", "a", "JVM", "system", "property", ".", "The", "permission", "*", "can", "be", "specified", "in", "a", "syntax", "where", "a", "plus", "sign", "is", "allow", ",", "and", "minus", "sign", "is", "deny", ".", "*", "<", "br", "/", ">", "*", "Wildcards", "is", "supported", "by", "using", "<", "tt", ">", ".*", "</", "tt", ">", "as", "prefix", ".", "For", "example", "to", "allow", "<", "tt", ">", "com", ".", "foo", "<", "/", "tt", ">", "and", "all", "subpackages", "*", "then", "specfy", "<", "tt", ">", "+", "com", ".", "foo", ".", "*<", "/", "tt", ">", ".", "Multiple", "permissions", "can", "be", "configured", "separated", "by", "comma", ",", "such", "as", "*", "<", "tt", ">", "+", "com", ".", "foo", ".", "*,", "-", "com", ".", "foo", ".", "bar", ".", "MySecretBean", "<", "/", "tt", ">", ".", "*", "<", "br", "/", ">", "*", "The", "following", "default", "permission", "is", "always", "included", ":", "<", "tt", ">", "\"-", "*,", "java", ".", "lang", ".", "*,", "java", ".", "util", ".", "*\"", "</", "tt", ">", "unless", "*", "its", "overridden", "by", "specifying", "a", "JVM", "system", "property", "with", "they", "key", "<", "tt", ">", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", "<", "/", "tt", ">", ".", "*", "/", "public", "void", "setPermissions", "(", "String", "permissions", ")", "{", "this", ".", "permissions", "=", "permissions", ";", "}", "/", "**", "*", "To", "add", "permission", "for", "the", "given", "pojo", "classes", ".", "*", "@", "param", "type", "the", "pojo", "class", "(", "es", ")", "xstream", "should", "use", "as", "allowed", "permission", "*", "@", "see", "#", "setPermissions", "(", "String", ")", "*", "/", "public", "void", "setPermissions", "(", "Class", "<", "?>", "..", ".", "type", ")", "{", "CollectionStringBuffer", "csb", "=", "new", "CollectionStringBuffer", "(", "\",", "\")", ";", "for", "(", "Class", "<", "?>", "clazz", ":", "type", ")", "{", "csb", ".", "append", "(", "\"+", "\")", ";", "csb", ".", "append", "(", "clazz", ".", "getName", "(", "))", ";", "}", "setPermissions", "(", "csb", ".", "toString", "(", "))", ";", "}", "@", "Override", "public", "String", "getDataFormatName", "(", ")", "{", "/", "/", "json", "data", "format", "is", "special", "as", "the", "name", "can", "be", "from", "different", "bundles", "@", "@", "-", "325", ",", "6", "+", "364", ",", "14", "@", "@", "protected", "void", "configureDataFormat", "(", "DataFormat", "dataFormat", ",", "CamelContext", "camelCont", "if", "(", "disableFeatures", "!", "=", "null", ")", "{", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "disableFeatures", "\"", ",", "disableFeatures", ")", ";", "}", "if", "(", "permissions", "!", "=", "null", ")", "{", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "permissions", "\"", ",", "permissions", ")", ";", "}", "/", "/", "if", "we", "have", "the", "unmarshal", "type", ",", "but", "no", "permission", "set", ",", "then", "use", "it", "to", "be", "allowed", "if", "(", "permissions", "=", "=", "null", "&", "&", "unmarshalType", "!", "=", "null", ")", "{", "String", "allow", "=", "\"", "+\"", "+", "unmarshalType", ".", "getName", "(", ");", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "permissions", "\"", ",", "allow", ")", ";", "}", "}", "}", "@", "@", "-", "38", ",", "6", "+", "38", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "spi", ".", "Metadata", ";", "import", "org", ".", "apache", ".", "camel", ".", "spi", ".", "RouteContext", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "CamelContextHelper", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "CollectionStringBuffer", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "ObjectHelper", ";", "/", "**", "@", "@", "-", "49", ",", "6", "+", "50", ",", "8", "@", "@", "@", "XmlRootElement", "(", "name", "=", "\"", "xstream", "\"", ")", "@", "XmlAccessorType", "(", "XmlAccessType", ".", "NONE", ")", "public", "class", "XStreamDataFormat", "extends", "DataFormatDefinition", "{", "@", "XmlAttribute", "private", "String", "permissions", ";", "@", "XmlAttribute", "private", "String", "encoding", ";", "@", "XmlAttribute", "@", "@", "-", "57", ",", "9", "+", "60", ",", "7", "@", "@", "private", "String", "driverRef", ";", "@", "XmlAttribute", "private", "String", "mode", ";", "@", "XmlAttribute", "private", "String", "permissions", ";", "@", "XmlJavaTypeAdapter", "(", "ConvertersAdapter", ".", "class", ")", "@", "XmlElement", "(", "name", "=", "\"", "converters", "\"", ")", "private", "List", "<", "String", ">", "converters", ";", "@", "@", "-", "187", ",", "12", "+", "188", ",", "37", "@", "@", "public", "String", "getPermissions", "(", ")", "{", "}", "/", "**", "*", "Adds", "permissionsList", "*", "Adds", "permissions", "that", "controls", "which", "Java", "packages", "and", "classes", "XStream", "is", "allowed", "to", "use", "during", "*", "unmarshal", "from", "xml", "/", "json", "to", "Java", "beans", ".", "*", "<", "p", "/", ">", "*", "A", "permission", "must", "be", "configured", "either", "here", "or", "globally", "using", "a", "JVM", "system", "property", ".", "The", "permission", "*", "can", "be", "specified", "in", "a", "syntax", "where", "a", "plus", "sign", "is", "allow", ",", "and", "minus", "sign", "is", "deny", ".", "*", "<", "br", "/", ">", "*", "Wildcards", "is", "supported", "by", "using", "<", "tt", ">", ".*", "</", "tt", ">", "as", "prefix", ".", "For", "example", "to", "allow", "<", "tt", ">", "com", ".", "foo", "<", "/", "tt", ">", "and", "all", "subpackages", "*", "then", "specfy", "<", "tt", ">", "+", "com", ".", "foo", ".", "*<", "/", "tt", ">", ".", "Multiple", "permissions", "can", "be", "configured", "separated", "by", "comma", ",", "such", "as", "*", "<", "tt", ">", "+", "com", ".", "foo", ".", "*,", "-", "com", ".", "foo", ".", "bar", ".", "MySecretBean", "<", "/", "tt", ">", ".", "*", "<", "br", "/", ">", "*", "The", "following", "default", "permission", "is", "always", "included", ":", "<", "tt", ">", "\"-", "*,", "java", ".", "lang", ".", "*,", "java", ".", "util", ".", "*\"", "</", "tt", ">", "unless", "*", "its", "overridden", "by", "specifying", "a", "JVM", "system", "property", "with", "they", "key", "<", "tt", ">", "org", ".", "apache", ".", "camel", ".", "xstream", ".", "permissions", "<", "/", "tt", ">", ".", "*", "/", "public", "void", "setPermissions", "(", "String", "permissions", ")", "{", "this", ".", "permissions", "=", "permissions", ";", "}", "/", "**", "*", "To", "add", "permission", "for", "the", "given", "pojo", "classes", ".", "*", "@", "param", "type", "the", "pojo", "class", "(", "es", ")", "xstream", "should", "use", "as", "allowed", "permission", "*", "@", "see", "#", "setPermissions", "(", "String", ")", "*", "/", "public", "void", "setPermissions", "(", "Class", "<", "?>", "..", ".", "type", ")", "{", "CollectionStringBuffer", "csb", "=", "new", "CollectionStringBuffer", "(", "\",", "\")", ";", "for", "(", "Class", "<", "?>", "clazz", ":", "type", ")", "{", "csb", ".", "append", "(", "\"+", "\")", ";", "csb", ".", "append", "(", "clazz", ".", "getName", "(", "))", ";", "}", "setPermissions", "(", "csb", ".", "toString", "(", "))", ";", "}", "@", "Override", "protected", "DataFormat", "createDataFormat", "(", "RouteContext", "routeContext", ")", "{", "if", "(", "\"", "json", "\"", ".", "equals", "(", "this", ".", "driver", ")", ")", "{", "@", "@", "-", "208", ",", "6", "+", "234", ",", "9", "@", "@", "protected", "DataFormat", "createDataFormat", "(", "RouteContext", "routeContext", ")", "{", "@", "Override", "protected", "void", "configureDataFormat", "(", "DataFormat", "dataFormat", ",", "CamelContext", "camelContext", ")", "{", "if", "(", "this", ".", "permissions", "!", "=", "null", ")", "{", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "permissions", "\"", ",", "this", ".", "permissions", ")", ";", "}", "if", "(", "encoding", "!", "=", "null", ")", "{", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "encoding", "\"", ",", "encoding", ")", ";", "}", "@", "@", "-", "223", ",", "9", "+", "252", ",", "6", "@", "@", "protected", "void", "configureDataFormat", "(", "DataFormat", "dataFormat", ",", "CamelContext", "camelCont", "if", "(", "this", ".", "implicitCollections", "!", "=", "null", ")", "{", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "implicitCollections", "\"", ",", "this", ".", "implicitCollections", ")", ";", "}", "if", "(", "this", ".", "permissions", "!", "=", "null", ")", "{", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "permissions", "\"", ",", "this", ".", "permissions", ")", ";", "}", "if", "(", "this", ".", "mode", "!", "=", "null", ")", "{", "setProperty", "(", "camelContext", ",", "dataFormat", ",", "\"", "mode", "\"", ",", "mode", ")", ";", "}", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "JsonLibrary", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "MarshalDomainObjectJSONTest", "extends", "MarshalDomainObjectTest", "{", "@", "@", "-", "57", ",", "10", "+", "58", ",", "10", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "/", "/", "just", "used", "for", "helping", "to", "marshal", "from", "(", "\"", "direct", ":", "marshal", "\"", ").", "marshal", "(", ").", "json", "(", ");", "from", "(", "\"", "direct", ":", "reverse", "\"", ").", "unmarshal", "(", ").", "json", "(", ").", "to", "(", "\"", "mock", ":", "reverse", "\"", ");", "from", "(", "\"", "direct", ":", "reverse", "\"", ").", "unmarshal", "(", ").", "json", "(", "JsonLibrary", ".", "XStream", ",", "PurchaseOrder", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "reverse", "\"", ");", "from", "(", "\"", "direct", ":", "inPretty", "\"", ").", "marshal", "(", ").", "json", "(", "true", ")", ";", "from", "(", "\"", "direct", ":", "backPretty", "\"", ").", "unmarshal", "(", ").", "json", "(", ").", "to", "(", "\"", "mock", ":", "reverse", "\"", ");", "from", "(", "\"", "direct", ":", "backPretty", "\"", ").", "unmarshal", "(", ").", "json", "(", "JsonLibrary", ".", "XStream", ",", "PurchaseOrder", ".", "class", ",", "true", ")", ".", "to", "(", "\"", "mock", ":", "reverse", "\"", ");", "}", "}", ";", "}", "@", "@", "-", "19", ",", "25", "+", "19", ",", "13", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "/", "**", "*", "Marshal", "tests", "with", "domain", "objects", ".", "*", "/", "public", "class", "MarshalDomainObjectTest", "extends", "CamelTestSupport", "{", "@", "BeforeClass", "public", "static", "void", "setup", "(", ")", "{", "XStreamTestUtils", ".", "setPermissionSystemProperty", "(", "\"\"", ");", "}", "@", "AfterClass", "public", "static", "void", "cleanup", "(", ")", "{", "XStreamTestUtils", ".", "revertPermissionSystemProperty", "(", ");", "}", "@", "Test", "public", "void", "testMarshalDomainObject", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "@", "@", "-", "96", ",", "12", "+", "84", ",", "12", "@", "@", "public", "void", "testMarshalAndUnmarshal", "(", ")", "throws", "Exception", "{", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "direct", ":", "in", "\"", ").", "marshal", "(", ").", "xstream", "(", ").", "to", "(", "\"", "mock", ":", "result", "\"", ");", "from", "(", "\"", "direct", ":", "in", "\"", ").", "marshal", "(", ").", "xstream", "(", "PurchaseOrder", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "/", "/", "just", "used", "for", "helping", "to", "marshal", "from", "(", "\"", "direct", ":", "marshal", "\"", ").", "marshal", "(", ").", "xstream", "(", "\"", "UTF", "-", "8", "\"", ");", "from", "(", "\"", "direct", ":", "marshal", "\"", ").", "marshal", "(", ").", "xstream", "(", "\"", "UTF", "-", "8", "\"", ",", "PurchaseOrder", ".", "class", ")", ";", "from", "(", "\"", "direct", ":", "reverse", "\"", ").", "unmarshal", "(", ").", "xstream", "(", "\"", "UTF", "-", "8", "\"", ").", "to", "(", "\"", "mock", ":", "reverse", "\"", ");", "from", "(", "\"", "direct", ":", "reverse", "\"", ").", "unmarshal", "(", ").", "xstream", "(", "\"", "UTF", "-", "8", "\"", ",", "PurchaseOrder", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "reverse", "\"", ");", "}", "}", ";", "}", "@", "@", "-", "19", ",", "19", "+", "19", ",", "20", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Processor", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "JsonLibrary", ";", "public", "class", "UnmarshalThenMarshalJSONTest", "extends", "UnmarshalThenMarshalTest", "{", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "{", "return", "new", "RouteBuilder", "(", ")", "{", "public", "void", "configure", "(", ")", "{", "from", "(", "\"", "direct", ":", "start", "\"", ").", "marshal", "(", ").", "json", "(", ").", "marshal", "(", ").", "json", "(", "JsonLibrary", ".", "XStream", ",", "PurchaseOrder", ".", "class", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "log", ".", "debug", "(", "\"", "marshalled", ":", "\"", "+", "exchange", ".", "getIn", "(", ").", "getBody", "(", "String", ".", "class", ")", ");", "}", "}", ").", "unmarshal", "(", ").", "json", "(", ").", "unmarshal", "(", ").", "json", "(", "JsonLibrary", ".", "XStream", ",", "PurchaseOrder", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "@", "@", "-", "23", ",", "25", "+", "23", ",", "13", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "/", "**", "*", "@", "version", "*", "/", "public", "class", "UnmarshalThenMarshalTest", "extends", "CamelTestSupport", "{", "@", "BeforeClass", "public", "static", "void", "setup", "(", ")", "{", "XStreamTestUtils", ".", "setPermissionSystemProperty", "(", "\"\"", ");", "}", "@", "AfterClass", "public", "static", "void", "cleanup", "(", ")", "{", "XStreamTestUtils", ".", "revertPermissionSystemProperty", "(", ");", "}", "@", "Test", "public", "void", "testSendXmlAndUnmarshal", "(", ")", "throws", "Exception", "{", "@", "@", "-", "69", ",", "13", "+", "57", ",", "13", "@", "@", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "{", "return", "new", "RouteBuilder", "(", ")", "{", "public", "void", "configure", "(", ")", "{", "from", "(", "\"", "direct", ":", "start", "\"", ").", "marshal", "(", ").", "xstream", "(", ").", "marshal", "(", ").", "xstream", "(", "PurchaseOrder", ".", "class", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "log", ".", "debug", "(", "\"", "marshalled", ":", "\"", "+", "exchange", ".", "getIn", "(", ").", "getBody", "(", "String", ".", "class", ")", ");", "}", "}", ").", "unmarshal", "(", ").", "xstream", "(", ").", "unmarshal", "(", ").", "xstream", "(", "PurchaseOrder", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "@", "@", "-", "22", ",", "25", "+", "22", ",", "13", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "/", "**", "*", "@", "version", "*", "/", "public", "class", "XStreamConcurrencyTest", "extends", "CamelTestSupport", "{", "@", "BeforeClass", "public", "static", "void", "setup", "(", ")", "{", "XStreamTestUtils", ".", "setPermissionSystemProperty", "(", "\"\"", ");", "}", "@", "AfterClass", "public", "static", "void", "cleanup", "(", ")", "{", "XStreamTestUtils", ".", "revertPermissionSystemProperty", "(", ");", "}", "@", "Test", "public", "void", "testNoConcurrentProducers", "(", ")", "throws", "Exception", "{", "doSendMessages", "(", "1", ",", "1", ")", ";", "@", "@", "-", "79", ",", "11", "+", "67", ",", "11", "@", "@", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "{", "return", "new", "RouteBuilder", "(", ")", "{", "public", "void", "configure", "(", ")", "{", "from", "(", "\"", "direct", ":", "start", "\"", ").", "marshal", "(", ").", "xstream", "(", ").", "marshal", "(", ").", "xstream", "(", "PurchaseOrder", ".", "class", ")", ".", "to", "(", "\"", "direct", ":", "marshalled", "\"", ");", "from", "(", "\"", "direct", ":", "marshalled", "\"", ").", "unmarshal", "(", ").", "xstream", "(", ").", "unmarshal", "(", ").", "xstream", "(", "PurchaseOrder", ".", "class", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "@", "@", "-", "28", ",", "13", "+", "28", ",", "10", "@", "@", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "HierarchicalStreamReader", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "HierarchicalStreamWriter", ";", "import", "com", ".", "thoughtworks", ".", "xstream", ".", "io", ".", "json", ".", "JsonHierarchicalStreamDriver", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "mock", ".", "MockEndpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "model", ".", "dataformat", ".", "XStreamDataFormat", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "junit4", ".", "CamelTestSupport", ";", "import", "org", ".", "junit", ".", "AfterClass", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "/", "**", "@", "@", "-", "45", ",", "16", "+", "42", ",", "6", "@", "@", "private", "static", "volatile", "boolean", "constructorInjected", ";", "private", "static", "volatile", "boolean", "methodInjected", ";", "@", "BeforeClass", "public", "static", "void", "setup", "(", ")", "{", "XStreamTestUtils", ".", "setPermissionSystemProperty", "(", "\"\"", ");", "}", "@", "AfterClass", "public", "static", "void", "cleanup", "(", ")", "{", "XStreamTestUtils", ".", "revertPermissionSystemProperty", "(", ");", "}", "@", "Override", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ");", "@", "@", "-", "152", ",", "6", "+", "139", ",", "7", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "String", ">", "aliases", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "aliases", ".", "put", "(", "\"", "purchase", "-", "order", "\"", ",", "PurchaseOrder", ".", "class", ".", "getName", "(", "))", ";", "xstreamDefinition", ".", "setAliases", "(", "aliases", ")", ";", "xstreamDefinition", ".", "setPermissions", "(", "PurchaseOrder", ".", "class", ",", "PurchaseHistory", ".", "class", ")", ";", "List", "<", "String", ">", "converters", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "converters", ".", "add", "(", "PurchaseOrderConverter", ".", "class", ".", "getName", "(", "))", ";", "@", "@", "-", "172", ",", "6", "+", "160", ",", "7", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "aliases", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "aliases", ".", "put", "(", "\"", "purchase", "-", "order", "\"", ",", "PurchaseOrder", ".", "class", ".", "getName", "(", "))", ";", "xstreamDefinition", ".", "setAliases", "(", "aliases", ")", ";", "xstreamDefinition", ".", "setPermissions", "(", "PurchaseOrder", ".", "class", ",", "PurchaseHistory", ".", "class", ")", ";", "converters", "=", "new", "ArrayList", "<", "String", ">", "()", ";", "converters", ".", "add", "(", "PurchaseOrderConverter", ".", "class", ".", "getName", "(", "))", ";", "@", "@", "-", "182", ",", "6", "+", "171", ",", "8", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "XStreamDataFormat", "xStreamDataFormat", "=", "new", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "XStreamDataFormat", "(", ");", "xStreamDataFormat", ".", "setXstreamDriver", "(", "new", "JsonHierarchicalStreamDriver", "(", "))", ";", "xStreamDataFormat", ".", "setPermissions", "(", "\"+", "6org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "*\"", ");", "from", "(", "\"", "direct", ":", "myDriver", "\"", ").", "marshal", "(", "xStreamDataFormat", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "}", ";", "@", "@", "-", "14", ",", "7", "+", "14", ",", "6", "@", "@", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ";", "/", "**", "@", "@", "-", "20", ",", "7", "+", "20", ",", "7", "@", "@", "#", "log4j", ".", "rootLogger", "=", "INFO", ",", "out", "log4j", ".", "logger", ".", "org", ".", "apache", ".", "activemq", ".", "spring", "=", "WARN", "#", "log4j", ".", "logger", ".", "org", ".", "apache", ".", "camel", "=", "DEBUG", "#", "CONSOLE", "appender", "not", "used", "by", "default", "log4j", ".", "appender", ".", "stdout", "=", "org", ".", "apache", ".", "log4j", ".", "ConsoleAppender", "@", "@", "-", "34", ",", "4", "+", "34", ",", "3", "@", "@", "log4j", ".", "appender", ".", "out", ".", "layout", ".", "ConversionPattern", "=", "%", "d", "[", "%-", "15", ".", "15t", "]", "%", "-", "5p", "%", "-", "30", ".", "30c", "{", "1", "}", "-", "%", "m", "%", "log4j", ".", "appender", ".", "out", ".", "file", "=", "target", "/", "camel", "-", "xstream", "-", "test", ".", "log", "log4j", ".", "appender", ".", "out", ".", "append", "=", "true", "log4j", ".", "logger", ".", "org", ".", "apache", ".", "camel", "=", "DEBUG", "@", "@", "-", "27", ",", "8", "+", "27", ",", "8", "@", "@", "<", "!-", "-", "we", "define", "the", "json", "xstream", "data", "formats", "to", "be", "used", "(", "xstream", "is", "default", ")", "-", "->", "<", "dataFormats", ">", "<", "json", "id", "=", "\"", "json", "\"", "/>", "<", "json", "id", "=", "\"", "pretty", "\"", "prettyPrint", "=", "\"", "true", "\"", "/>", "<", "json", "id", "=", "\"", "json", "\"", "unmarshalTypeName", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "PurchaseOrder", "\"", "/>", "<", "json", "id", "=", "\"", "pretty", "\"", "prettyPrint", "=", "\"", "true", "\"", "unmarshalTypeName", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "PurchaseOrder", "\"", "/>", "<", "/", "dataFormats", ">", "<", "route", ">", "@", "@", "-", "27", ",", "8", "+", "27", ",", "8", "@", "@", "<", "!-", "-", "we", "define", "the", "json", "xstream", "data", "formats", "to", "be", "used", "(", "xstream", "is", "default", ")", "-", "->", "<", "dataFormats", ">", "<", "xstream", "id", "=", "\"", "xstream", "-", "utf8", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "/>", "<", "xstream", "id", "=", "\"", "xstream", "-", "default", "\"", "/>", "<", "xstream", "id", "=", "\"", "xstream", "-", "utf8", "\"", "encoding", "=", "\"", "UTF", "-", "8", "\"", "permissions", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "stream", ".", "*\"", "/>", "<", "xstream", "id", "=", "\"", "xstream", "-", "default", "\"", "permissions", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "stream", ".", "*\"", "/>", "<", "/", "dataFormats", ">", "<", "route", ">", "@", "@", "-", "26", ",", "7", "+", "26", ",", "7", "@", "@", "<", "!-", "-", "START", "SNIPPET", ":", "e1", "-", "->", "<", "dataFormats", ">", "<", "xstream", "id", "=", "\"", "xstream", "\"", ">", "<", "xstream", "id", "=", "\"", "xstream", "\"", "permissions", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "stream", ".", "*\"", ">", "<", "!-", "-", "omit", "the", "price", "file", "from", "the", "PurchaseOrder", "class", "-", "->", "<", "omitFields", ">", "<", "omitField", "class", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "PurchaseOrder", "\"", ">", "@", "@", "-", "44", ",", "7", "+", "44", ",", "7", "@", "@", "<", "/", "implicitCollections", ">", "<", "/", "xstream", ">", "<", "xstream", "id", "=", "\"", "xstream", "-", "json", "\"", "driver", "=", "\"", "json", "\"", ">", "<", "xstream", "id", "=", "\"", "xstream", "-", "json", "\"", "driver", "=", "\"", "json", "\"", "permissions", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "*\"", ">", "<", "converters", ">", "<", "converter", "class", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "XStreamConfigurationTest", "$", "PurchaseOrderConverter", "\"", "/", ">", "<", "/", "converters", ">", "@", "@", "-", "58", ",", "7", "+", "58", ",", "7", "@", "@", "<", "/", "implicitCollections", ">", "<", "/", "xstream", ">", "<", "xstream", "id", "=", "\"", "xstream", "-", "driver", "\"", "driverRef", "=", "\"", "myDriver", "\"", "/>", "<", "xstream", "id", "=", "\"", "xstream", "-", "driver", "\"", "driverRef", "=", "\"", "myDriver", "\"", "permissions", "=", "\"", "org", ".", "apache", ".", "camel", ".", "dataformat", ".", "xstream", ".", "*\"", "/>", "<", "/", "dataFormats", ">", "<", "route", ">"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1253", ",", "6", "+", "1253", ",", "7", "@", "@", "static", "int", "rose_recvmsg", "(", "struct", "kiocb", "*", "iocb", ",", "struct", "socket", "*", "sock", ",", "skb_copy_datagram_iovec", "(", "skb", ",", "0", ",", "msg", "-", ">", "msg_iov", ",", "copied", ")", ";", "if", "(", "srose", "!", "=", "NULL", ")", "{", "memset", "(", "srose", ",", "0", ",", "msg", "-", ">", "msg_namelen", ")", ";", "srose", "-", ">", "srose_family", "=", "AF_ROSE", ";", "srose", "-", ">", "srose_addr", "=", "rose", "-", ">", "dest_addr", ";", "srose", "-", ">", "srose_call", "=", "rose", "-", ">", "dest_call", ";"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "stack", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "3993", ",", "7", "+", "3993", ",", "13", "@", "@", "int", "kvm_arch_vcpu_ioctl_set_sregs", "(", "struct", "kvm_vcpu", "*", "vcpu", ",", "vcpu", "-", ">", "arch", ".", "cr2", "=", "sregs", "-", ">", "cr2", ";", "mmu_reset_needed", "|", "=", "vcpu", "-", ">", "arch", ".", "cr3", "!", "=", "sregs", "-", ">", "cr3", ";", "vcpu", "-", ">", "arch", ".", "cr3", "=", "sregs", "-", ">", "cr3", ";", "down_read", "(", "&", "vcpu", "-", ">", "kvm", "-", ">", "slots_lock", ")", ";", "if", "(", "gfn_to_memslot", "(", "vcpu", "-", ">", "kvm", ",", "sregs", "-", ">", "cr3", ">", ">", "PAGE_SHIFT", ")", ")", "vcpu", "-", ">", "arch", ".", "cr3", "=", "sregs", "-", ">", "cr3", ";", "else", "set_bit", "(", "KVM_REQ_TRIPLE_FAULT", ",", "&", "vcpu", "-", ">", "requests", ")", ";", "up_read", "(", "&", "vcpu", "-", ">", "kvm", "-", ">", "slots_lock", ")", ";", "kvm_set_cr8", "(", "vcpu", ",", "sregs", "-", ">", "cr8", ")", ";"], "docstring_tokens": ["lock", "the", "kernel", "resources", "and", "cause", "a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2971", ",", "31", "+", "2971", ",", "30", "@", "@", "static", "void", "*", "dev_seq_start", "(", "struct", "seq_file", "*", "s", ",", "loff_t", "*", "pos", ")", "{", "struct", "sg_proc_deviter", "*", "it", "=", "kmalloc", "(", "sizeof", "(", "*", "it", ")", ",", "GFP_KERNEL", ")", ";", "s", "-", ">", "private", "=", "it", ";", "if", "(", "!", "it", ")", "return", "NULL", ";", "if", "(", "NULL", "=", "=", "sg_dev_arr", ")", "goto", "err1", ";", "return", "NULL", ";", "it", "-", ">", "index", "=", "*", "pos", ";", "it", "-", ">", "max", "=", "sg_last_dev", "(", ");", "if", "(", "it", "-", ">", "index", ">", "=", "it", "-", ">", "max", ")", "goto", "err1", ";", "return", "NULL", ";", "return", "it", ";", "err1", ":", "kfree", "(", "it", ")", ";", "return", "NULL", ";", "}", "static", "void", "*", "dev_seq_next", "(", "struct", "seq_file", "*", "s", ",", "void", "*", "v", ",", "loff_t", "*", "pos", ")", "{", "struct", "sg_proc_deviter", "*", "it", "=", "(", "struct", "sg_proc_deviter", "*", ")", "v", ";", "struct", "sg_proc_deviter", "*", "it", "=", "s", "-", ">", "private", ";", "*", "pos", "=", "+", "+", "it", "-", ">", "index", ";", "return", "(", "it", "-", ">", "index", "<", "it", "-", ">", "max", ")", "?", "it", ":", "NULL", ";", "}", "static", "void", "dev_seq_stop", "(", "struct", "seq_file", "*", "s", ",", "void", "*", "v", ")", "{", "kfree", "(", "v", ")", ";", "kfree", "(", "s", "-", ">", "private", ")", ";", "}", "static", "int", "sg_proc_open_dev", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "149", ",", "7", "+", "149", ",", "7", "@", "@", "public", "Environment", "setUp", "(", "@", "SuppressWarnings", "(", "\"", "rawtypes", "\"", ")", "AbstractBuild", "build", ",", "Launc", "final", "BuildListener", "listener", ")", "throws", "IOException", ",", "InterruptedException", "{", "DescriptorImpl", "DESCRIPTOR", "=", "Hudson", ".", "getInstance", "(", ").", "getDescriptorByType", "(", "DescriptorImpl", ".", "class", ")", ";", "String", "vnc2swf", "=", "Util", ".", "nullify", "(", "DESCRIPTOR", ".", "getVnc2swf", "(", "))", ";", "String", "vnc2swf", "=", "Util", ".", "escape", "(", "Util", ".", "nullify", "(", "DESCRIPTOR", ".", "getVnc2swf", "(", "))", ");", "if", "(", "vnc2swf", ".", "equals", "(", "CANT_FIND_VNC2SWF", ")", ")", "{", "listener", ".", "fatalError", "(", "\"", "VNC", "Recorder", ":", "can", "'", "t", "find", "'", "vnc2swf", "'", "please", "check", "your", "jenkins", "global", "settings", "!", "\")", ";"], "docstring_tokens": ["users", "with", "View/Configure", "permission", "to", "add", "a", "new", "column", "to", "list", "views", "that", "contains", "a", "user-configurable", "link"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "304", ",", "6", "+", "304", ",", "9", "@", "@", "public", "void", "doLogout", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", "/", "/", "reset", "remember", "-", "me", "cookie", "Cookie", "cookie", "=", "new", "Cookie", "(", "ACEGI_SECURITY_HASHED_REMEMBER_ME_COOKIE_KEY", ",", "\"\"", ");", "cookie", ".", "setMaxAge", "(", "0", ")", ";", "cookie", ".", "setSecure", "(", "req", ".", "isSecure", "(", "))", ";", "cookie", ".", "setHttpOnly", "(", "true", ")", ";", "cookie", ".", "setPath", "(", "req", ".", "getContextPath", "(", ").", "length", "(", ")>", "0", "?", "req", ".", "getContextPath", "(", ")", ":", "\"", "/\"", ");", "rsp", ".", "addCookie", "(", "cookie", ")", ";", "@", "@", "-", "123", ",", "19", "+", "123", ",", "39", "@", "@", "public", "void", "loginSuccess", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "respons", "@", "Override", "public", "Authentication", "autoLogin", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "try", "{", "return", "super", ".", "autoLogin", "(", "request", ",", "response", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "cancelCookie", "(", "request", ",", "response", ",", "\"", "Failed", "to", "handle", "remember", "-", "me", "cookie", ":", "\"", "+", "Functions", ".", "printThrowable", "(", "e", ")", ");", "if", "(", "Jenkins", ".", "getInstance", "(", ").", "isDisableRememberMe", "(", "))", "{", "cancelCookie", "(", "request", ",", "response", ",", "null", ")", ";", "return", "null", ";", "}", "else", "{", "try", "{", "return", "super", ".", "autoLogin", "(", "request", ",", "response", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "cancelCookie", "(", "request", ",", "response", ",", "\"", "Failed", "to", "handle", "remember", "-", "me", "cookie", ":", "\"", "+", "Functions", ".", "printThrowable", "(", "e", ")", ");", "return", "null", ";", "}", "}", "}", "@", "Override", "protected", "Cookie", "makeValidCookie", "(", "String", "tokenValueBase64", ",", "HttpServletRequest", "request", ",", "long", "maxAge", ")", "{", "Cookie", "cookie", "=", "super", ".", "makeValidCookie", "(", "tokenValueBase64", ",", "request", ",", "maxAge", ")", ";", "@", "Override", "protected", "Cookie", "makeValidCookie", "(", "String", "tokenValueBase64", ",", "HttpServletRequest", "request", ",", "long", "maxAge", ")", "{", "Cookie", "cookie", "=", "super", ".", "makeValidCookie", "(", "tokenValueBase64", ",", "request", ",", "maxAge", ")", ";", "secureCookie", "(", "cookie", ",", "request", ")", ";", "return", "cookie", ";", "}", "@", "Override", "protected", "Cookie", "makeCancelCookie", "(", "HttpServletRequest", "request", ")", "{", "Cookie", "cookie", "=", "super", ".", "makeCancelCookie", "(", "request", ")", ";", "secureCookie", "(", "cookie", ",", "request", ")", ";", "return", "cookie", ";", "}", "/", "**", "*", "Force", "always", "the", "http", "-", "only", "flag", "and", "depending", "on", "the", "request", ",", "put", "also", "the", "secure", "flag", ".", "*", "/", "private", "void", "secureCookie", "(", "Cookie", "cookie", ",", "HttpServletRequest", "request", ")", "{", "/", "/", "if", "we", "can", "mark", "the", "cookie", "HTTP", "only", ",", "do", "so", "to", "protect", "this", "cookie", "even", "in", "case", "of", "XSS", "vulnerability", ".", "if", "(", "SET_HTTP_ONLY", "!", "=", "null", ")", "{", "if", "(", "SET_HTTP_ONLY", "!", "=", "null", ")", "{", "try", "{", "SET_HTTP_ONLY", ".", "invoke", "(", "cookie", ",", "true", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "@", "@", "-", "148", ",", "12", "+", "168", ",", "10", "@", "@", "protected", "Cookie", "makeValidCookie", "(", "String", "tokenValueBase64", ",", "HttpServletRequest", "req", "/", "/", "if", "the", "user", "is", "running", "Jenkins", "over", "HTTPS", ",", "we", "also", "want", "to", "prevent", "the", "cookie", "from", "leaking", "in", "HTTP", ".", "/", "/", "whether", "the", "login", "is", "done", "over", "HTTPS", "or", "not", "would", "be", "a", "good", "enough", "approximation", "of", "whether", "Jenkins", "runs", "in", "/", "/", "HTTPS", "or", "not", ",", "so", "use", "that", ".", "if", "(", "request", ".", "isSecure", "(", "))", "cookie", ".", "setSecure", "(", "true", ")", ";", "return", "cookie", ";", "}", "cookie", ".", "setSecure", "(", "request", ".", "isSecure", "(", "))", ";", "}", "/", "**", "/", "**", "*", "Used", "to", "compute", "the", "token", "signature", "securely", ".", "*", "/", "private", "static", "final", "HMACConfidentialKey", "MAC", "=", "new", "HMACConfidentialKey", "(", "TokenBasedRememberMeServices", ".", "class", ",", "\"", "mac", "\"", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "88", "@", "@", "/", "*", "*", "The", "MIT", "License", "*", "*", "Copyright", "(", "c", ")", "2018", ",", "CloudBees", ",", "Inc", ".", "*", "*", "Permission", "is", "hereby", "granted", ",", "free", "of", "charge", ",", "to", "any", "person", "obtaining", "a", "copy", "*", "of", "this", "software", "and", "associated", "documentation", "files", "(", "the", "\"", "Software", "\"", "),", "to", "deal", "*", "in", "the", "Software", "without", "restriction", ",", "including", "without", "limitation", "the", "rights", "*", "to", "use", ",", "copy", ",", "modify", ",", "merge", ",", "publish", ",", "distribute", ",", "sublicense", ",", "and", "/", "or", "sell", "*", "copies", "of", "the", "Software", ",", "and", "to", "permit", "persons", "to", "whom", "the", "Software", "is", "*", "furnished", "to", "do", "so", ",", "subject", "to", "the", "following", "conditions", ":", "*", "*", "The", "above", "copyright", "notice", "and", "this", "permission", "notice", "shall", "be", "included", "in", "*", "all", "copies", "or", "substantial", "portions", "of", "the", "Software", ".", "*", "*", "THE", "SOFTWARE", "IS", "PROVIDED", "\"", "AS", "IS", "\"", ",", "WITHOUT", "WARRANTY", "OF", "ANY", "KIND", ",", "EXPRESS", "OR", "*", "IMPLIED", ",", "INCLUDING", "BUT", "NOT", "LIMITED", "TO", "THE", "WARRANTIES", "OF", "MERCHANTABILITY", ",", "*", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", "AND", "NONINFRINGEMENT", ".", "IN", "NO", "EVENT", "SHALL", "THE", "*", "AUTHORS", "OR", "COPYRIGHT", "HOLDERS", "BE", "LIABLE", "FOR", "ANY", "CLAIM", ",", "DAMAGES", "OR", "OTHER", "*", "LIABILITY", ",", "WHETHER", "IN", "AN", "ACTION", "OF", "CONTRACT", ",", "TORT", "OR", "OTHERWISE", ",", "ARISING", "FROM", ",", "*", "OUT", "OF", "OR", "IN", "CONNECTION", "WITH", "THE", "SOFTWARE", "OR", "THE", "USE", "OR", "OTHER", "DEALINGS", "IN", "*", "THE", "SOFTWARE", ".", "*", "/", "package", "hudson", ".", "security", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "util", ".", "Cookie", ";", "import", "com", ".", "gargoylesoftware", ".", "htmlunit", ".", "xml", ".", "XmlPage", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "Issue", ";", "import", "org", ".", "jvnet", ".", "hudson", ".", "test", ".", "JenkinsRule", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "text", ".", "IsEmptyString", ".", "isEmptyString", ";", "import", "static", "org", ".", "hamcrest", ".", "xml", ".", "HasXPath", ".", "hasXPath", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNotNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "public", "class", "TokenBasedRememberMeServices2Test_SEC996", "{", "@", "Rule", "public", "JenkinsRule", "j", "=", "new", "JenkinsRule", "(", ");", "@", "Test", "@", "Issue", "(", "\"", "SECURITY", "-", "996", "\"", ")", "public", "void", "rememberMeToken_shouldNotBeRead_ifOptionIsDisabled", "(", ")", "throws", "Exception", "{", "j", ".", "jenkins", ".", "setDisableRememberMe", "(", "false", ")", ";", "j", ".", "jenkins", ".", "setSecurityRealm", "(", "j", ".", "createDummySecurityRealm", "(", "))", ";", "Cookie", "rememberMeCookie", "=", "null", ";", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "login", "(", "\"", "alice", "\"", ",", "\"", "alice", "\"", ",", "true", ")", ";", "/", "/", "we", "should", "see", "a", "remember", "me", "cookie", "rememberMeCookie", "=", "getRememberMeCookie", "(", "wc", ")", ";", "assertNotNull", "(", "rememberMeCookie", ")", ";", "assertThat", "(", "rememberMeCookie", ".", "getValue", "(", "),", "not", "(", "isEmptyString", "(", "))", ");", "}", "j", ".", "jenkins", ".", "setDisableRememberMe", "(", "true", ")", ";", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "getCookieManager", "(", ").", "addCookie", "(", "rememberMeCookie", ")", ";", "/", "/", "the", "application", "should", "not", "use", "the", "cookie", "to", "connect", "XmlPage", "page", "=", "(", "XmlPage", ")", "wc", ".", "goTo", "(", "\"", "whoAmI", "/", "api", "/", "xml", "\"", ",", "\"", "application", "/", "xml", "\"", ");", "assertThat", "(", "page", ",", "hasXPath", "(", "\"/", "/", "name", "\"", ",", "not", "(", "is", "(", "\"", "alice", "\"", "))", "))", ";", "}", "j", ".", "jenkins", ".", "setDisableRememberMe", "(", "false", ")", ";", "{", "JenkinsRule", ".", "WebClient", "wc", "=", "j", ".", "createWebClient", "(", ");", "wc", ".", "getCookieManager", "(", ").", "addCookie", "(", "rememberMeCookie", ")", ";", "/", "/", "if", "we", "reactivate", "the", "remember", "me", "feature", ",", "it", "'", "s", "ok", "XmlPage", "page", "=", "(", "XmlPage", ")", "wc", ".", "goTo", "(", "\"", "whoAmI", "/", "api", "/", "xml", "\"", ",", "\"", "application", "/", "xml", "\"", ");", "assertThat", "(", "page", ",", "hasXPath", "(", "\"/", "/", "name", "\"", ",", "is", "(", "\"", "alice", "\"", "))", ");", "}", "}", "private", "Cookie", "getRememberMeCookie", "(", "JenkinsRule", ".", "WebClient", "wc", ")", "{", "return", "wc", ".", "getCookieManager", "(", ").", "getCookie", "(", "TokenBasedRememberMeServices2", ".", "ACEGI_SECURITY_HASHED_REMEMBER_ME_COOKIE_KEY", ")", ";", "}", "}"], "docstring_tokens": ["evaluate", "the", "\\\"Remember", "me\\\"", "cookie", "even", "when", "the", "feature", "has", "been", "disabled"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "42", ",", "6", "+", "42", ",", "10", "@", "@", "PHP", "NEWS", "-", "Firebird", "Database", "extension", "(", "ibase", ")", ":", ".", "Fixed", "bug", "#", "60802", "(", "ibase_trans", "(", ")", "gives", "segfault", "when", "passing", "params", ")", ".", "-", "Libxml", ":", ".", "Fixed", "bug", "#", "61367", "(", "open_basedir", "bypass", "using", "libxml", "RSHUTDOWN", ")", ".", "(", "Tim", "Starling", ")", "-", "mysqli", ".", "Fixed", "bug", "#", "61003", "(", "mysql_stat", "(", ")", "require", "a", "valid", "connection", ")", ".", "(", "Johannes", ")", ".", "@", "@", "-", "82", ",", "8", "+", "82", ",", "8", "@", "@", "ZEND_GET_MODULE", "(", "libxml", ")", "static", "PHP_MINIT_FUNCTION", "(", "libxml", ")", ";", "static", "PHP_RINIT_FUNCTION", "(", "libxml", ")", ";", "static", "PHP_MSHUTDOWN_FUNCTION", "(", "libxml", ")", ";", "static", "PHP_RSHUTDOWN_FUNCTION", "(", "libxml", ")", ";", "static", "PHP_MINFO_FUNCTION", "(", "libxml", ")", ";", "static", "int", "php_libxml_post_deactivate", "(", ");", "/", "*", "}", "}}", "*", "/", "@", "@", "-", "129", ",", "13", "+", "129", ",", "13", "@", "@", "zend_module_entry", "libxml_module_entry", "=", "{", "PHP_MINIT", "(", "libxml", ")", ",", "/", "*", "extension", "-", "wide", "startup", "function", "*", "/", "PHP_MSHUTDOWN", "(", "libxml", ")", ",", "/", "*", "extension", "-", "wide", "shutdown", "function", "*", "/", "PHP_RINIT", "(", "libxml", ")", ",", "/", "*", "per", "-", "request", "startup", "function", "*", "/", "PHP_RSHUTDOWN", "(", "libxml", ")", ",", "/", "*", "per", "-", "request", "shutdown", "function", "*", "/", "NULL", ",", "/", "*", "per", "-", "request", "shutdown", "function", "*", "/", "PHP_MINFO", "(", "libxml", ")", ",", "/", "*", "information", "function", "*", "/", "NO_VERSION_YET", ",", "PHP_MODULE_GLOBALS", "(", "libxml", ")", ",", "/", "*", "globals", "descriptor", "*", "/", "PHP_GINIT", "(", "libxml", ")", ",", "/", "*", "globals", "ctor", "*", "/", "NULL", ",", "/", "*", "globals", "dtor", "*", "/", "NULL", ",", "/", "*", "post", "deactivate", "*", "/", "php_libxml_post_deactivate", ",", "/", "*", "post", "deactivate", "*", "/", "STANDARD_MODULE_PROPERTIES_EX", "}", ";", "@", "@", "-", "655", ",", "9", "+", "655", ",", "9", "@", "@", "static", "PHP_MSHUTDOWN_FUNCTION", "(", "libxml", ")", "return", "SUCCESS", ";", "}", "static", "PHP_RSHUTDOWN_FUNCTION", "(", "libxml", ")", "static", "int", "php_libxml_post_deactivate", "(", ")", "{", "TSRMLS_FETCH", "(", ");", "/", "*", "reset", "libxml", "generic", "error", "handling", "*", "/", "xmlSetGenericErrorFunc", "(", "NULL", ",", "NULL", ")", ";", "xmlSetStructuredErrorFunc", "(", "NULL", ",", "NULL", ")", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "58", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "61367", ":", "open_basedir", "bypass", "in", "libxml", "RSHUTDOWN", ":", "read", "test", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "dom", "'", "))", "echo", "'", "skip", "'", ";", "?", ">", "-", "-", "INI", "-", "-", "open_basedir", "=", ".", ";", "Suppress", "spurious", "\"", "Trying", "to", "get", "property", "of", "non", "-", "object", "\"", "notices", "error_reporting", "=", "E_ALL", "&", "~", "E_NOTICE", "-", "-", "FILE", "-", "-", "<", "?", "php", "class", "StreamExploiter", "{", "public", "function", "stream_close", "(", ")", "{", "$", "doc", "=", "new", "DOMDocument", ";", "$", "doc", "-", ">", "resolveExternals", "=", "true", ";", "$", "doc", "-", ">", "substituteEntities", "=", "true", ";", "$", "dir", "=", "htmlspecialchars", "(", "dirname", "(", "getcwd", "(", "))", ");", "$", "doc", "-", ">", "loadXML", "(", "<", "<<", "XML", "<", "!", "DOCTYPE", "doc", "[", "<", "!", "ENTITY", "file", "SYSTEM", "\"", "file", ":", "//", "/$", "dir", "/", "bad", "\"", ">", "]", ">", "<", "doc", ">", "&", "file", ";", "</", "doc", ">", "XML", ")", ";", "print", "$", "doc", "-", ">", "documentElement", "-", ">", "firstChild", "-", ">", "nodeValue", ";", "}", "public", "function", "stream_open", "(", "$", "path", ",", "$", "mode", ",", "$", "options", ",", "&", "$", "opened_path", ")", "{", "return", "true", ";", "}", "}", "var_dump", "(", "mkdir", "(", "'", "test_bug_61367", "'", "))", ";", "var_dump", "(", "mkdir", "(", "'", "test_bug_61367", "/", "base", "'", "))", ";", "var_dump", "(", "file_put_contents", "(", "'", "test_bug_61367", "/", "bad", "'", ",", "'", "blah", "'", "))", ";", "var_dump", "(", "chdir", "(", "'", "test_bug_61367", "/", "base", "'", "))", ";", "stream_wrapper_register", "(", "'", "exploit", "'", ",", "'", "StreamExploiter", "'", ")", ";", "$", "s", "=", "fopen", "(", "'", "exploit", ":", "//", "',", "'", "r", "'", ")", ";", "?", ">", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "unlink", "(", "'", "test_bug_61367", "/", "bad", "'", ");", "rmdir", "(", "'", "test_bug_61367", "/", "base", "'", ");", "rmdir", "(", "'", "test_bug_61367", "'", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "bool", "(", "true", ")", "bool", "(", "true", ")", "int", "(", "4", ")", "bool", "(", "true", ")", "Warning", ":", "DOMDocument", ":", ":", "loadXML", "(", "):", "I", "/", "O", "warning", ":", "failed", "to", "load", "external", "entity", "\"", "file", ":", "//", "/%", "s", "/", "test_bug_61367", "/", "bad", "\"", "in", "%", "s", "on", "line", "%", "d", "Warning", ":", "DOMDocument", ":", ":", "loadXML", "(", "):", "Failure", "to", "process", "entity", "file", "in", "Entity", ",", "line", ":", "4", "in", "%", "s", "on", "line", "%", "d", "Warning", ":", "DOMDocument", ":", ":", "loadXML", "(", "):", "Entity", "'", "file", "'", "not", "defined", "in", "Entity", ",", "line", ":", "4", "in", "%", "s", "on", "line", "%", "d", "@", "@", "-", "0", ",", "0", "+", "1", ",", "48", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "#", "61367", ":", "open_basedir", "bypass", "in", "libxml", "RSHUTDOWN", ":", "write", "test", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "'", "dom", "'", "))", "echo", "'", "skip", "'", ";", "?", ">", "-", "-", "INI", "-", "-", "open_basedir", "=", ".", ";", "Suppress", "spurious", "\"", "Trying", "to", "get", "property", "of", "non", "-", "object", "\"", "notices", "error_reporting", "=", "E_ALL", "&", "~", "E_NOTICE", "-", "-", "FILE", "-", "-", "<", "?", "php", "class", "StreamExploiter", "{", "public", "function", "stream_close", "(", ")", "{", "$", "doc", "=", "new", "DOMDocument", ";", "$", "doc", "-", ">", "appendChild", "(", "$", "doc", "-", ">", "createTextNode", "(", "'", "hello", "'", "))", ";", "var_dump", "(", "$", "doc", "-", ">", "save", "(", "dirname", "(", "getcwd", "(", "))", ".", "'", "/", "bad", "'", "))", ";", "}", "public", "function", "stream_open", "(", "$", "path", ",", "$", "mode", ",", "$", "options", ",", "&", "$", "opened_path", ")", "{", "return", "true", ";", "}", "}", "var_dump", "(", "mkdir", "(", "'", "test_bug_61367", "'", "))", ";", "var_dump", "(", "mkdir", "(", "'", "test_bug_61367", "/", "base", "'", "))", ";", "var_dump", "(", "file_put_contents", "(", "'", "test_bug_61367", "/", "bad", "'", ",", "'", "blah", "'", "))", ";", "var_dump", "(", "chdir", "(", "'", "test_bug_61367", "/", "base", "'", "))", ";", "stream_wrapper_register", "(", "'", "exploit", "'", ",", "'", "StreamExploiter", "'", ")", ";", "$", "s", "=", "fopen", "(", "'", "exploit", ":", "//", "',", "'", "r", "'", ")", ";", "?", ">", "-", "-", "CLEAN", "-", "-", "<", "?", "php", "@", "unlink", "(", "'", "test_bug_61367", "/", "bad", "'", ");", "rmdir", "(", "'", "test_bug_61367", "/", "base", "'", ");", "rmdir", "(", "'", "test_bug_61367", "'", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "bool", "(", "true", ")", "bool", "(", "true", ")", "int", "(", "4", ")", "bool", "(", "true", ")", "Warning", ":", "DOMDocument", ":", ":", "save", "(", "):", "open_basedir", "restriction", "in", "effect", ".", "File", "(", "%", "s", ")", "is", "not", "within", "the", "allowed", "path", "(", "s", ")", ":", "(", ".)", "in", "%", "s", "on", "line", "%", "d", "Warning", ":", "DOMDocument", ":", ":", "save", "(", "%", "s", ")", ":", "failed", "to", "open", "stream", ":", "Operation", "not", "permitted", "in", "%", "s", "on", "line", "%", "d", "bool", "(", "false", ")"], "docstring_tokens": ["bypass", "the", "open_basedir", "restriction", "and", "read", "arbitrary", "files", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1473", ",", "11", "+", "1473", ",", "11", "@", "@", "public", "HeaderEmitter", "headersStart", "(", "int", "streamId", ",", "boolean", "headersEndStream", ")", "}", "private", "void", "closeIdleStreams", "(", "int", "newMaxActiveRemoteStreamId", ")", "throws", "Http2Exception", "{", "for", "(", "int", "i", "=", "maxActiveRemoteStreamId", "+", "2", ";", "i", "<", "newMaxActiveRemoteStreamId", ";", "i", "+", "=", "2", ")", "{", "Stream", "stream", "=", "getStream", "(", "i", ",", "false", ")", ";", "if", "(", "stream", "!", "=", "null", ")", "{", "stream", ".", "closeIfIdle", "(", ");", "private", "void", "closeIdleStreams", "(", "int", "newMaxActiveRemoteStreamId", ")", "{", "for", "(", "Entry", "<", "Integer", ",", "Stream", ">", "entry", ":", "streams", ".", "entrySet", "(", "))", "{", "if", "(", "entry", ".", "getKey", "(", ").", "intValue", "(", ")", ">", "maxActiveRemoteStreamId", "&", "&", "entry", ".", "getKey", "(", ").", "intValue", "(", ")", "<", "newMaxActiveRemoteStreamId", ")", "{", "entry", ".", "getValue", "(", ").", "closeIfIdle", "(", ");", "}", "}", "maxActiveRemoteStreamId", "=", "newMaxActiveRemoteStreamId", ";", "@", "@", "-", "147", ",", "21", "+", "147", ",", "44", "@", "@", "public", "void", "testClientSendOldStream", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testImplicitClose", "(", ")", "throws", "Exception", "{", "doTestImplicitClose", "(", "5", ")", ";", "}", "/", "/", "https", ":", "//", "bz", ".", "apache", ".", "org", "/", "bugzilla", "/", "show_bug", ".", "cgi", "?", "id", "=", "64467", "@", "Test", "public", "void", "testImplicitCloseLargeId", "(", ")", "throws", "Exception", "{", "doTestImplicitClose", "(", "Integer", ".", "MAX_VALUE", "-", "8", ")", ";", "}", "private", "void", "doTestImplicitClose", "(", "int", "lastStreamId", ")", "throws", "Exception", "{", "long", "startFirst", "=", "System", ".", "nanoTime", "(", ");", "http2Connect", "(", ");", "long", "durationFirst", "=", "System", ".", "nanoTime", "(", ")", "-", "startFirst", ";", "sendPriority", "(", "3", ",", "0", ",", "16", ")", ";", "sendPriority", "(", "5", ",", "0", ",", "16", ")", ";", "sendPriority", "(", "lastStreamId", ",", "0", ",", "16", ")", ";", "sendSimpleGetRequest", "(", "5", ")", ";", "long", "startSecond", "=", "System", ".", "nanoTime", "(", ");", "sendSimpleGetRequest", "(", "lastStreamId", ")", ";", "readSimpleGetResponse", "(", ");", "Assert", ".", "assertEquals", "(", "getSimpleResponseTrace", "(", "5", ")", ",", "output", ".", "getTrace", "(", "))", ";", "long", "durationSecond", "=", "System", ".", "nanoTime", "(", ")", "-", "startSecond", ";", "Assert", ".", "assertEquals", "(", "getSimpleResponseTrace", "(", "lastStreamId", ")", ",", "output", ".", "getTrace", "(", "))", ";", "output", ".", "clearTrace", "(", ");", "/", "/", "Allow", "second", "request", "to", "take", "up", "to", "5", "times", "first", "request", "or", "up", "to", "1", "second", "-", "whichever", "is", "the", "larger", "-", "mainly", "/", "/", "to", "allow", "for", "CI", "systems", "under", "load", "that", "can", "exhibit", "significant", "timing", "variation", ".", "Assert", ".", "assertTrue", "(", "\"", "First", "request", "took", "[", "\"", "+", "durationFirst", "/", "1000000", "+", "\"", "ms", "]", ",", "second", "request", "took", "[", "\"", "durationSecond", "/", "1000000", "+", "\"", "ms", "]", "\",", "durationSecond", "<", "1000000000", "|", "|", "durationSecond", "<", "durationFirst", "*", "3", ")", ";", "/", "/", "Should", "trigger", "an", "error", "since", "stream", "3", "should", "have", "been", "implicitly", "/", "/", "closed", ".", "sendSimpleGetRequest", "(", "3", ")", ";", "handleGoAwayResponse", "(", "5", ")", ";", "handleGoAwayResponse", "(", "lastStreamId", ")", ";", "}", "@", "@", "-", "71", ",", "6", "+", "71", ",", "10", "@", "@", "<", "update", ">", "Add", "support", "for", "ALPN", "on", "recent", "OpenJDK", "8", "releases", ".", "(", "remm", ")", "<", "/", "update", ">", "<", "fix", ">", "<", "bug", ">", "64467", "<", "/", "bug", ">", ":", "Improve", "performance", "of", "closing", "idle", "HTTP", "/", "2", "streams", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "WebSocket", "\"", ">"], "docstring_tokens": ["trigger", "high", "CPU\\r\\nusage", "for", "several", "seconds"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "565", ",", "11", "+", "565", ",", "15", "@", "@", "static", "void", "shm_get_stat", "(", "struct", "ipc_namespace", "*", "ns", ",", "unsigned", "long", "*", "rss", ",", "struct", "hstate", "*", "h", "=", "hstate_file", "(", "shp", "-", ">", "shm_file", ")", ";", "*", "rss", "+", "=", "pages_per_huge_page", "(", "h", ")", "*", "mapping", "-", ">", "nrpages", ";", "}", "else", "{", "#", "ifdef", "CONFIG_SHMEM", "struct", "shmem_inode_info", "*", "info", "=", "SHMEM_I", "(", "inode", ")", ";", "spin_lock", "(", "&", "info", "-", ">", "lock", ")", ";", "*", "rss", "+", "=", "inode", "-", ">", "i_mapping", "-", ">", "nrpages", ";", "*", "swp", "+", "=", "info", "-", ">", "swapped", ";", "spin_unlock", "(", "&", "info", "-", ">", "lock", ")", ";", "#", "else", "*", "rss", "+", "=", "inode", "-", ">", "i_mapping", "-", ">", "nrpages", ";", "#", "endif", "}", "total", "+", "+;"], "docstring_tokens": ["misinterpret", "the", "data", "type", "of", "an", "inode", "and", "cause", "the", "system", "to", "hang"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "221", ",", "32", "+", "221", ",", "38", "@", "@", "long", "ext4_ioctl", "(", "struct", "file", "*", "filp", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "struct", "file", "*", "donor_filp", ";", "int", "err", ";", "if", "(", "!(", "filp", "-", ">", "f_mode", "&", "FMODE_READ", ")", "|", "|", "!", "(", "filp", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", ")", "return", "-", "EBADF", ";", "if", "(", "copy_from_user", "(", "&", "me", ",", "(", "struct", "move_extent", "__user", "*", ")", "arg", ",", "sizeof", "(", "me", ")", "))", "return", "-", "EFAULT", ";", "me", ".", "moved_len", "=", "0", ";", "donor_filp", "=", "fget", "(", "me", ".", "donor_fd", ")", ";", "if", "(", "!", "donor_filp", ")", "return", "-", "EBADF", ";", "if", "(", "!", "capable", "(", "CAP_DAC_OVERRIDE", ")", ")", "{", "if", "(", "(", "current", "-", ">", "real_cred", "-", ">", "fsuid", "!", "=", "inode", "-", ">", "i_uid", ")", "|", "|", "!", "(", "inode", "-", ">", "i_mode", "&", "S_IRUSR", ")", "|", "|", "!", "(", "donor_filp", "-", ">", "f_dentry", "-", ">", "d_inode", "-", ">", "i_mode", "&", "S_IRUSR", ")", ")", "{", "fput", "(", "donor_filp", ")", ";", "return", "-", "EACCES", ";", "}", "if", "(", "!(", "donor_filp", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", ")", "{", "err", "=", "-", "EBADF", ";", "goto", "mext_out", ";", "}", "me", ".", "moved_len", "=", "0", ";", "err", "=", "mnt_want_write", "(", "filp", "-", ">", "f_path", ".", "mnt", ")", ";", "if", "(", "err", ")", "goto", "mext_out", ";", "err", "=", "ext4_move_extents", "(", "filp", ",", "donor_filp", ",", "me", ".", "orig_start", ",", "me", ".", "donor_start", ",", "me", ".", "len", ",", "&", "me", ".", "moved_len", ")", ";", "fput", "(", "donor_filp", ")", ";", "mnt_drop_write", "(", "filp", "-", ">", "f_path", ".", "mnt", ")", ";", "if", "(", "me", ".", "moved_len", ">", "0", ")", "file_remove_suid", "(", "donor_filp", ")", ";", "if", "(", "copy_to_user", "(", "(", "struct", "move_extent", "*", ")", "arg", ",", "&", "me", ",", "sizeof", "(", "me", ")", "))", "return", "-", "EFAULT", ";", "err", "=", "-", "EFAULT", ";", "mext_out", ":", "fput", "(", "donor_filp", ")", ";", "return", "err", ";", "}", "@", "@", "-", "957", ",", "6", "+", "957", ",", "13", "@", "@", "mext_check_arguments", "(", "struct", "inode", "*", "orig_inode", ",", "return", "-", "EINVAL", ";", "}", "if", "(", "donor_inode", "-", ">", "i_mode", "&", "(", "S_ISUID", "|", "S_ISGID", ")", ")", "{", "ext4_debug", "(", "\"", "ext4", "move", "extent", ":", "suid", "or", "sgid", "is", "set", "\"", "\"", "to", "donor", "file", "[", "ino", ":", "orig", "%", "lu", ",", "donor", "%", "lu", "]", "\\", "n", "\"", ",", "orig_inode", "-", ">", "i_ino", ",", "donor_inode", "-", ">", "i_ino", ")", ";", "return", "-", "EINVAL", ";", "}", "/", "*", "Ext4", "move", "extent", "does", "not", "support", "swapfile", "*", "/", "if", "(", "IS_SWAPFILE", "(", "orig_inode", ")", "|", "|", "IS_SWAPFILE", "(", "donor_inode", ")", ")", "{", "ext4_debug", "(", "\"", "ext4", "move", "extent", ":", "The", "argument", "files", "should", "\""], "docstring_tokens": ["the", "complete", "compromise", "of", "affected", "computers"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "562", ",", "7", "+", "562", ",", "7", "@", "@", "public", "void", "internalAdd", "(", "final", "Component", "child", ")", "*", "/", "class", "MarkupChildIterator", "implements", "Iterator", "<", "Component", ">", "{", "private", "int", "indexInRemovalsSinceLastUpdate", "=", "removals_size", "(", ");", "private", "int", "indexInRemovalsSinceLastUpdate", ";", "private", "int", "expectedModCounter", "=", "-", "1", ";", "private", "Component", "currentComponent", "=", "null", ";", "private", "Iterator", "<", "Component", ">", "internalIterator", "=", "null", ";", "@", "@", "-", "590", ",", "8", "+", "590", ",", "10", "@", "@", "public", "void", "remove", "(", ")", "private", "void", "refreshInternalIteratorIfNeeded", "(", ")", "{", "if", "(", "expectedModCounter", ">", "=", "modCounter", ")", "if", "(", "expectedModCounter", ">", "=", "modCounter", ")", "{", "/", "/", "no", "new", "modifications", "return", ";", "}", "if", "(", "children", "=", "=", "null", ")", "{", "@", "@", "-", "615", ",", "7", "+", "617", ",", "6", "@", "@", "else", "if", "(", "children", "instanceof", "List", ")", "/", "/", "since", "we", "now", "have", "a", "new", "iterator", ",", "we", "need", "to", "set", "it", "to", "the", "last", "known", "position", "currentComponent", "=", "findLastExistingChildAlreadyReturned", "(", "currentComponent", ")", ";", "expectedModCounter", "=", "modCounter", ";", "indexInRemovalsSinceLastUpdate", "=", "removals_size", "(", ");", "if", "(", "currentComponent", "!", "=", "null", ")", "{", "@", "@", "-", "627", ",", "33", "+", "628", ",", "38", "@", "@", "else", "if", "(", "children", "instanceof", "List", ")", "}", "}", "private", "Component", "findLastExistingChildAlreadyReturned", "(", "Component", "target", ")", "private", "Component", "findLastExistingChildAlreadyReturned", "(", "Component", "current", ")", "{", "while", "(", "true", ")", "{", "if", "(", "target", "=", "=", "null", ")", "return", "null", ";", "RemovedChild", "removedChild", "=", "null", ";", "for", "(", "int", "i", "=", "indexInRemovalsSinceLastUpdate", ";", "i", "<", "removals_size", "(", ");", "i", "+", "+)", "{", "RemovedChild", "curRemovedChild", "=", "removals_get", "(", "i", ")", ";", "if", "(", "curRemovedChild", ".", "removedChild", "=", "=", "target", "|", "|", "curRemovedChild", ".", "removedChild", "=", "=", "null", ")", "if", "(", "current", "=", "=", "null", ")", "{", "indexInRemovalsSinceLastUpdate", "=", "0", ";", "}", "else", "{", "LinkedList", "<", "RemovedChild", ">", "removals", "=", "removals_get", "(", ");", "if", "(", "removals", "!", "=", "null", ")", "{", "check_removed", ":", "while", "(", "current", "!", "=", "null", ")", "{", "removedChild", "=", "curRemovedChild", ";", "for", "(", "int", "i", "=", "indexInRemovalsSinceLastUpdate", ";", "i", "<", "removals", ".", "size", "(", ");", "i", "+", "+)", "{", "RemovedChild", "removal", "=", "removals", ".", "get", "(", "i", ")", ";", "if", "(", "removal", ".", "removedChild", "=", "=", "current", "|", "|", "removal", ".", "removedChild", "=", "=", "null", ")", "{", "current", "=", "removal", ".", "previousSibling", ";", "/", "/", "current", "was", "removed", ",", "use", "its", "sibling", "instead", "continue", "check_removed", ";", "}", "}", "/", "/", "current", "wasn", "'", "t", "removed", ",", "keep", "it", "break", ";", "}", "}", "if", "(", "removedChild", "=", "=", "null", ")", "{", "return", "target", ";", "}", "else", "{", "target", "=", "removedChild", ".", "previousSibling", ";", "indexInRemovalsSinceLastUpdate", "=", "removals", ".", "size", "(", ");", "}", "}", "return", "current", ";", "}", "}", ";", "return", "new", "MarkupChildIterator", "(", ");", "@", "@", "-", "1361", ",", "29", "+", "1367", ",", "6", "@", "@", "private", "void", "removals_add", "(", "Component", "removedChild", ",", "Component", "prevSibling", ")", "removals", ".", "add", "(", "new", "RemovedChild", "(", "removedChild", ",", "prevSibling", ")", ");", "}", "/", "**", "*", "Gets", "the", "{", "@", "link", "RemovedChild", "}", "from", "the", "list", "of", "removals", "at", "given", "position", ".", "*", "*", "@", "param", "i", "*", "the", "position", "*", "@", "return", "the", "removed", "child", "*", "/", "private", "RemovedChild", "removals_get", "(", "int", "i", ")", "{", "return", "getMetaData", "(", "REMOVALS_KEY", ")", ".", "get", "(", "i", ")", ";", "}", "/", "**", "*", "Gets", "the", "number", "of", "removals", "that", "happened", "during", "the", "request", ".", "*", "*", "@", "return", "the", "number", "of", "removals", "*", "/", "private", "int", "removals_size", "(", ")", "{", "LinkedList", "<", "RemovedChild", ">", "removals", "=", "removals_get", "(", ");", "return", "removals", "=", "=", "null", "?", "0", ":", "removals", ".", "size", "(", ");", "}", "/", "**", "*", "@", "param", "component", "*", "Component", "being", "removed"], "docstring_tokens": ["see", "possibly", "sensitive", "information", "inside", "a", "HTML", "template", "that", "is", "usually", "removed", "during", "rendering"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "317", ",", "10", "+", "317", ",", "14", "@", "@", "arch_get_unmapped_area_topdown", "(", "struct", "file", "*", "filp", ",", "const", "unsigned", "long", "addr0", ",", "unsigned", "long", "get_fb_unmapped_area", "(", "struct", "file", "*", "filp", ",", "unsigned", "long", "orig_addr", ",", "unsigned", "long", "len", ",", "unsigned", "long", "pgoff", ",", "unsigned", "long", "flags", ")", "{", "unsigned", "long", "align_goal", ",", "addr", "=", "-", "ENOMEM", ";", "unsigned", "long", "(", "*", "get_area", ")", "(", "struct", "file", "*", ",", "unsigned", "long", ",", "unsigned", "long", ",", "unsigned", "long", ",", "unsigned", "long", ")", ";", "get_area", "=", "current", "-", ">", "mm", "-", ">", "get_unmapped_area", ";", "if", "(", "flags", "&", "MAP_FIXED", ")", "{", "/", "*", "Ok", ",", "don", "'", "t", "mess", "with", "it", ".", "*", "/", "return", "get_unmapped_area", "(", "NULL", ",", "orig_addr", ",", "len", ",", "pgoff", ",", "flags", ")", ";", "return", "get_area", "(", "NULL", ",", "orig_addr", ",", "len", ",", "pgoff", ",", "flags", ")", ";", "}", "flags", "&", "=", "~", "MAP_SHARED", ";", "@", "@", "-", "333", ",", "7", "+", "337", ",", "7", "@", "@", "unsigned", "long", "get_fb_unmapped_area", "(", "struct", "file", "*", "filp", ",", "unsigned", "long", "orig_addr", ",", "u", "align_goal", "=", "(", "64UL", "*", "1024", ")", ";", "do", "{", "addr", "=", "get_unmapped_area", "(", "NULL", ",", "orig_addr", ",", "len", "+", "(", "align_goal", "-", "PAGE_SIZE", ")", ",", "pgoff", ",", "flags", ")", ";", "addr", "=", "get_area", "(", "NULL", ",", "orig_addr", ",", "len", "+", "(", "align_goal", "-", "PAGE_SIZE", ")", ",", "pgoff", ",", "flags", ")", ";", "if", "(", "!(", "addr", "&", "~", "PAGE_MASK", ")", ")", "{", "addr", "=", "(", "addr", "+", "(", "align_goal", "-", "1UL", ")", ")", "&", "~", "(", "align_goal", "-", "1UL", ")", ";", "break", ";", "@", "@", "-", "351", ",", "7", "+", "355", ",", "7", "@", "@", "unsigned", "long", "get_fb_unmapped_area", "(", "struct", "file", "*", "filp", ",", "unsigned", "long", "orig_addr", ",", "u", "*", "be", "obtained", ".", "*", "/", "if", "(", "addr", "&", "~", "PAGE_MASK", ")", "addr", "=", "get_unmapped_area", "(", "NULL", ",", "orig_addr", ",", "len", ",", "pgoff", ",", "flags", ")", ";", "addr", "=", "get_area", "(", "NULL", ",", "orig_addr", ",", "len", ",", "pgoff", ",", "flags", ")", ";", "return", "addr", ";", "}", "@", "@", "-", "290", ",", "28", "+", "290", ",", "28", "@", "@", "static", "unsigned", "long", "shm_get_unmapped_area", "(", "struct", "file", "*", "file", ",", "unsigned", "long", "flags", ")", "{", "struct", "shm_file_data", "*", "sfd", "=", "shm_file_data", "(", "file", ")", ";", "return", "get_unmapped_area", "(", "sfd", "-", ">", "file", ",", "addr", ",", "len", ",", "pgoff", ",", "flags", ")", ";", "}", "int", "is_file_shm_hugepages", "(", "struct", "file", "*", "file", ")", "{", "int", "ret", "=", "0", ";", "if", "(", "file", "-", ">", "f_op", "=", "=", "&", "shm_file_operations", ")", "{", "struct", "shm_file_data", "*", "sfd", ";", "sfd", "=", "shm_file_data", "(", "file", ")", ";", "ret", "=", "is_file_hugepages", "(", "sfd", "-", ">", "file", ")", ";", "}", "return", "ret", ";", "return", "sfd", "-", ">", "file", "-", ">", "f_op", "-", ">", "get_unmapped_area", "(", "sfd", "-", ">", "file", ",", "addr", ",", "len", ",", "pgoff", ",", "flags", ")", ";", "}", "static", "const", "struct", "file_operations", "shm_file_operations", "=", "{", ".", "mmap", "=", "shm_mmap", ",", ".", "fsync", "=", "shm_fsync", ",", ".", "release", "=", "shm_release", ",", "}", ";", "static", "const", "struct", "file_operations", "shm_file_operations_huge", "=", "{", ".", "mmap", "=", "shm_mmap", ",", ".", "fsync", "=", "shm_fsync", ",", ".", "release", "=", "shm_release", ",", ".", "get_unmapped_area", "=", "shm_get_unmapped_area", ",", "}", ";", "int", "is_file_shm_hugepages", "(", "struct", "file", "*", "file", ")", "{", "return", "file", "-", ">", "f_op", "=", "=", "&", "shm_file_operations_huge", ";", "}", "static", "const", "struct", "vm_operations_struct", "shm_vm_ops", "=", "{", ".", "open", "=", "shm_open", ",", "/", "*", "callback", "for", "a", "new", "vm", "-", "area", "open", "*", "/", ".", "close", "=", "shm_close", ",", "/", "*", "callback", "for", "when", "the", "vm", "-", "area", "is", "released", "*", "/", "@", "@", "-", "889", ",", "7", "+", "889", ",", "10", "@", "@", "long", "do_shmat", "(", "int", "shmid", ",", "char", "__user", "*", "shmaddr", ",", "int", "shmflg", ",", "ulong", "*", "raddr", ")", "if", "(", "!", "sfd", ")", "goto", "out_put_dentry", ";", "file", "=", "alloc_file", "(", "path", ".", "mnt", ",", "path", ".", "dentry", ",", "f_mode", ",", "&", "shm_file_operations", ")", ";", "file", "=", "alloc_file", "(", "path", ".", "mnt", ",", "path", ".", "dentry", ",", "f_mode", ",", "is_file_hugepages", "(", "shp", "-", ">", "shm_file", ")", "?", "&", "shm_file_operations_huge", ":", "&", "shm_file_operations", ")", ";", "if", "(", "!", "file", ")", "goto", "out_free", ";", "ima_counts_get", "(", "file", ")", ";"], "docstring_tokens": ["gain", "privileges", "or", "cause", "a", "denial", "of", "service", "(panic", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "66", "+", "0", ",", "0", "@", "@", "ALS", "-", "007", "/", "ALS", "-", "100", "/", "ALS", "-", "200", "based", "sound", "cards", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "Support", "for", "sound", "cards", "based", "around", "the", "Avance", "Logic", "ALS", "-", "007", "/", "ALS", "-", "100", "/", "ALS", "-", "200", "chip", "is", "included", ".", "These", "chips", "are", "a", "single", "chip", "PnP", "sound", "solution", "which", "is", "mostly", "hardware", "compatible", "with", "the", "Sound", "Blaster", "16", "card", ",", "with", "most", "differences", "occurring", "in", "the", "use", "of", "the", "mixer", "registers", ".", "For", "this", "reason", "the", "ALS", "code", "is", "integrated", "as", "part", "of", "the", "Sound", "Blaster", "16", "driver", "(", "adding", "only", "800", "bytes", "to", "the", "SB16", "driver", ")", ".", "To", "use", "an", "ALS", "sound", "card", "under", "Linux", ",", "enable", "the", "following", "options", "as", "modules", "in", "the", "sound", "configuration", "section", "of", "the", "kernel", "config", ":", "-", "100", "%", "Sound", "Blaster", "compatibles", "(", "SB16", "/", "32", "/", "64", ",", "ESS", ",", "Jazz16", ")", "support", "-", "FM", "synthesizer", "(", "YM3812", "/", "OPL", "-", "3", ")", "support", "-", "standalone", "MPU401", "support", "may", "be", "required", "for", "some", "cards", ";", "for", "the", "ALS", "-", "007", ",", "when", "using", "isapnptools", ",", "it", "is", "required", "Since", "the", "ALS", "-", "007", "/", "100", "/", "200", "are", "PnP", "cards", ",", "ISAPnP", "support", "should", "probably", "be", "compiled", "in", ".", "If", "kernel", "level", "PnP", "support", "is", "not", "included", ",", "isapnptools", "will", "be", "required", "to", "configure", "the", "card", "before", "the", "sound", "modules", "are", "loaded", ".", "When", "using", "kernel", "level", "ISAPnP", ",", "the", "kernel", "should", "correctly", "identify", "and", "configure", "all", "resources", "required", "by", "the", "card", "when", "the", "\"", "sb", "\"", "module", "is", "inserted", ".", "Note", "that", "the", "ALS", "-", "007", "does", "not", "have", "a", "16", "bit", "DMA", "channel", "and", "that", "the", "MPU401", "interface", "on", "this", "card", "uses", "a", "different", "interrupt", "to", "the", "audio", "section", ".", "This", "should", "all", "be", "correctly", "configured", "by", "the", "kernel", ";", "if", "problems", "with", "the", "MPU401", "interface", "surface", ",", "try", "using", "the", "standalone", "MPU401", "module", ",", "passing", "\"", "0", "\"", "as", "the", "\"", "sb", "\"", "module", "'", "s", "\"", "mpu_io", "\"", "module", "parameter", "to", "prevent", "the", "soundblaster", "driver", "attempting", "to", "register", "the", "MPU401", "itself", ".", "The", "onboard", "synth", "device", "can", "be", "accessed", "using", "the", "\"", "opl3", "\"", "module", ".", "If", "isapnptools", "is", "used", "to", "wake", "up", "the", "sound", "card", "(", "as", "in", "2", ".", "2", ".", "x", ")", ",", "the", "settings", "of", "the", "card", "'", "s", "resources", "should", "be", "passed", "to", "the", "kernel", "modules", "(", "\"", "sb", "\"", ",", "\"", "opl3", "\"", "and", "\"", "mpu401", "\"", ")", "using", "the", "module", "parameters", ".", "When", "configuring", "an", "ALS", "-", "007", ",", "be", "sure", "to", "specify", "different", "IRQs", "for", "the", "audio", "and", "MPU401", "sections", "-", "this", "card", "requires", "they", "be", "different", ".", "For", "\"", "sb", "\"", ",", "\"", "io", "\"", ",", "\"", "irq", "\"", "and", "\"", "dma", "\"", "should", "be", "set", "to", "the", "same", "values", "used", "to", "configure", "the", "audio", "section", "of", "the", "card", "with", "isapnp", ".", "\"", "dma16", "\"", "should", "be", "explicitly", "set", "to", "\"", "-", "1", "\"", "for", "an", "ALS", "-", "007", "since", "this", "card", "does", "not", "have", "a", "16", "bit", "dma", "channel", ";", "if", "not", "specified", "the", "kernel", "will", "default", "to", "using", "channel", "5", "anyway", "which", "will", "cause", "audio", "not", "to", "work", ".", "\"", "mpu_io", "\"", "should", "be", "set", "to", "0", ".", "The", "\"", "io", "\"", "parameter", "of", "the", "\"", "opl3", "\"", "module", "should", "also", "agree", "with", "the", "setting", "used", "by", "isapnp", ".", "To", "get", "the", "MPU401", "interface", "working", "on", "an", "ALS", "-", "007", "card", ",", "the", "\"", "mpu401", "\"", "module", "will", "be", "required", "since", "this", "card", "uses", "separate", "IRQs", "for", "the", "audio", "and", "MPU401", "sections", "and", "there", "is", "no", "parameter", "available", "to", "pass", "a", "different", "IRQ", "to", "the", "\"", "sb", "\"", "driver", "(", "whose", "inbuilt", "MPU401", "driver", "would", "otherwise", "be", "fine", ")", ".", "Insert", "the", "mpu401", "module", "passing", "appropriate", "values", "using", "the", "\"", "io", "\"", "and", "\"", "irq", "\"", "parameters", ".", "The", "resulting", "sound", "driver", "will", "provide", "the", "following", "capabilities", ":", "-", "8", "and", "16", "bit", "audio", "playback", "-", "8", "and", "16", "bit", "audio", "recording", "-", "Software", "selection", "of", "record", "source", "(", "line", "in", ",", "CD", ",", "FM", ",", "mic", ",", "master", ")", "-", "Record", "and", "playback", "of", "midi", "data", "via", "the", "external", "MPU", "-", "401", "-", "Playback", "of", "midi", "data", "using", "inbuilt", "FM", "synthesizer", "-", "Control", "of", "the", "ALS", "-", "007", "mixer", "via", "any", "OSS", "-", "compatible", "mixer", "programs", ".", "Controls", "available", "are", "Master", "(", "L", "&", "R", ")", ",", "Line", "in", "(", "L", "&", "R", ")", ",", "CD", "(", "L", "&", "R", ")", ",", "DSP", "/", "PCM", "/", "audio", "out", "(", "L", "&", "R", ")", ",", "FM", "(", "L", "&", "R", ")", "and", "Mic", "in", "(", "mono", ")", ".", "Jonathan", "Woithe", "jwoithe", "@", "just42", ".", "net", "30", "March", "1998", "Modified", "2000", "-", "02", "-", "26", "by", "Dave", "Forrest", ",", "drf5n", "@", "virginia", ".", "edu", "to", "add", "ALS100", "/", "ALS200", "Modified", "2000", "-", "04", "-", "10", "by", "Paul", "Laufer", ",", "pelaufer", "@", "csupomona", ".", "edu", "to", "add", "ISAPnP", "info", ".", "Modified", "2000", "-", "11", "-", "19", "by", "Jonathan", "Woithe", ",", "jwoithe", "@", "just42", ".", "net", "-", "updated", "information", "for", "kernel", "2", ".", "4", ".", "x", ".", "@", "@", "-", "1", ",", "101", "+", "0", ",", "0", "@", "@", "Driver", "Information", "about", "Audio", "Excel", "DSP", "16", "driver", "can", "be", "found", "in", "the", "source", "file", "aedsp16", ".", "c", "Please", ",", "read", "the", "head", "of", "the", "source", "before", "using", "it", ".", "It", "contain", "useful", "information", ".", "Configuration", "The", "Audio", "Excel", "configuration", ",", "is", "now", "done", "with", "the", "standard", "Linux", "setup", ".", "You", "have", "to", "configure", "the", "sound", "card", "(", "Sound", "Blaster", "or", "Microsoft", "Sound", "System", ")", "and", ",", "if", "you", "want", "it", ",", "the", "Roland", "MPU", "-", "401", "(", "do", "not", "use", "the", "Sound", "Blaster", "MPU", "-", "401", ",", "SB", "-", "MPU401", ")", "in", "the", "main", "driver", "menu", ".", "Activate", "the", "lowlevel", "drivers", "then", "select", "the", "Audio", "Excel", "hardware", "that", "you", "want", "to", "initialize", ".", "Check", "the", "IRQ", "/", "DMA", "/", "MIRQ", "of", "the", "Audio", "Excel", "initialization", ":", "it", "must", "be", "the", "same", "as", "the", "SBPRO", "(", "or", "MSS", ")", "setup", ".", "If", "the", "parameters", "are", "different", ",", "correct", "it", ".", "I", "you", "own", "a", "Gallant", "'", "s", "audio", "card", "based", "on", "SC", "-", "6600", ",", "activate", "the", "SC", "-", "6600", "support", ".", "If", "you", "want", "to", "change", "the", "configuration", "of", "the", "sound", "board", ",", "be", "sure", "to", "check", "off", "all", "the", "configuration", "items", "before", "re", "-", "configure", "it", ".", "Module", "parameters", "To", "use", "this", "driver", "as", "a", "module", ",", "you", "must", "configure", "some", "module", "parameters", ",", "to", "set", "up", "I", "/", "O", "addresses", ",", "IRQ", "lines", "and", "DMA", "channels", ".", "Some", "parameters", "are", "mandatory", "while", "some", "others", "are", "optional", ".", "Here", "a", "list", "of", "parameters", "you", "can", "use", "with", "this", "module", ":", "Name", "Description", "=", "==", "=", "=", "==", "==", "==", "==", "==", "MANDATORY", "io", "I", "/", "O", "base", "address", "(", "0x220", "or", "0x240", ")", "irq", "irq", "line", "(", "5", ",", "7", ",", "9", ",", "10", "or", "11", ")", "dma", "dma", "channel", "(", "0", ",", "1", "or", "3", ")", "OPTIONAL", "mss_base", "I", "/", "O", "base", "address", "for", "activate", "MSS", "mode", "(", "default", "SBPRO", ")", "(", "0x530", "or", "0xE80", ")", "mpu_base", "I", "/", "O", "base", "address", "for", "activate", "MPU", "-", "401", "mode", "(", "0x300", ",", "0x310", ",", "0x320", "or", "0x330", ")", "mpu_irq", "MPU", "-", "401", "irq", "line", "(", "5", ",", "7", ",", "9", ",", "10", "or", "0", ")", "A", "configuration", "file", "in", "/", "etc", "/", "modprobe", ".", "d", "/", "directory", "will", "have", "lines", "like", "this", ":", "options", "opl3", "io", "=", "0x388", "options", "ad1848", "io", "=", "0x530", "irq", "=", "11", "dma", "=", "3", "options", "aedsp16", "io", "=", "0x220", "irq", "=", "11", "dma", "=", "3", "mss_base", "=", "0x530", "Where", "the", "aedsp16", "options", "are", "the", "options", "for", "this", "driver", "while", "opl3", "and", "ad1848", "are", "the", "corresponding", "options", "for", "the", "MSS", "and", "OPL3", "modules", ".", "Loading", "MSS", "and", "OPL3", "needs", "to", "pre", "load", "the", "aedsp16", "module", "to", "set", "up", "correctly", "the", "sound", "card", ".", "Installation", "dependencies", "must", "be", "written", "in", "configuration", "files", "under", "/", "etc", "/", "modprobe", ".", "d", "/", "directory", ":", "softdep", "ad1848", "pre", ":", "aedsp16", "softdep", "opl3", "pre", ":", "aedsp16", "Then", "you", "must", "load", "the", "sound", "modules", "stack", "in", "this", "order", ":", "sound", "-", ">", "aedsp16", "-", ">", "[", "ad1848", ",", "opl3", "]", "With", "the", "above", "configuration", ",", "loading", "ad1848", "or", "opl3", "modules", ",", "will", "automatically", "load", "all", "the", "sound", "stack", ".", "Sound", "cards", "supported", "This", "driver", "supports", "the", "SC", "-", "6000", "and", "SC", "-", "6600", "based", "Gallant", "'", "s", "sound", "card", ".", "It", "don", "'", "t", "support", "the", "Audio", "Excel", "DSP", "16", "III", "(", "try", "the", "SC", "-", "6600", "code", ")", ".", "I", "'", "m", "working", "on", "the", "III", "version", "of", "the", "card", ":", "if", "someone", "have", "useful", "information", "about", "it", ",", "please", "let", "me", "know", ".", "For", "all", "the", "non", "-", "supported", "audio", "cards", ",", "you", "have", "to", "boot", "MS", "-", "DOS", "(", "or", "WIN95", ")", "activating", "the", "audio", "card", "with", "the", "MS", "-", "DOS", "device", "driver", ",", "then", "you", "have", "to", "<", "ctrl", ">", "-<", "alt", ">", "-<", "del", ">", "and", "boot", "Linux", ".", "Follow", "these", "steps", ":", "1", ")", "Compile", "Linux", "kernel", "with", "standard", "sound", "driver", ",", "using", "the", "emulation", "you", "want", ",", "with", "the", "parameters", "of", "your", "audio", "card", ",", "e", ".", "g", ".", "Microsoft", "Sound", "System", "irq10", "dma3", "2", ")", "Install", "your", "new", "kernel", "as", "the", "default", "boot", "kernel", ".", "3", ")", "Boot", "MS", "-", "DOS", "and", "configure", "the", "audio", "card", "with", "the", "boot", "time", "device", "driver", ",", "for", "MSS", "irq10", "dma3", "in", "our", "example", ".", "4", ")", "<", "ctrl", ">", "-<", "alt", ">", "-<", "del", ">", "and", "boot", "Linux", ".", "This", "will", "maintain", "the", "DOS", "configuration", "and", "will", "boot", "the", "new", "kernel", "with", "sound", "driver", ".", "The", "sound", "driver", "will", "find", "the", "audio", "card", "and", "will", "recognize", "and", "attach", "it", ".", "Reports", "on", "User", "successes", ">", "Date", ":", "Mon", ",", "29", "Jul", "1996", "08", ":", "35", ":", "40", "+", "0100", ">", "From", ":", "Mr", "S", "J", "Greenaway", "<", "sjg95", "@", "unixfe", ".", "rl", ".", "ac", ".", "uk", ">", ">", "To", ":", "riccardo", "@", "cdc8g5", ".", "cdc", ".", "polimi", ".", "it", "(", "Riccardo", "Facchetti", ")", ">", "Subject", ":", "Re", ":", "Audio", "Excel", "DSP", "16", "initialization", "code", ">", ">", "Just", "to", "let", "you", "know", "got", "my", "Audio", "Excel", "(", "emulating", "a", "MSS", ")", "working", ">", "with", "my", "original", "SB16", ",", "thanks", "for", "the", "driver", "!", "Last", "revised", ":", "20", "August", "1998", "Riccardo", "Facchetti", "fizban", "@", "tin", ".", "it", "@", "@", "-", "1", ",", "152", "+", "0", ",", "0", "@", "@", "Documentation", "for", "CMI", "8330", "(", "SoundPRO", ")", "Alessandro", "Zummo", "<", "azummo", "@", "ita", ".", "flashnet", ".", "it", ">", "(", "Be", "sure", "to", "read", "Documentation", "/", "sound", "/", "oss", "/", "SoundPro", "too", ")", "This", "adapter", "is", "now", "directly", "supported", "by", "the", "sb", "driver", ".", "The", "only", "thing", "you", "have", "to", "do", "is", "to", "compile", "the", "kernel", "sound", "support", "as", "a", "module", "and", "to", "enable", "kernel", "ISAPnP", "support", ",", "as", "shown", "below", ".", "CONFIG_SOUND", "=", "m", "CONFIG_SOUND_SB", "=", "m", "CONFIG_PNP", "=", "y", "CONFIG_ISAPNP", "=", "y", "and", "optionally", ":", "CONFIG_SOUND_MPU401", "=", "m", "for", "MPU401", "support", ".", "(", "I", "suggest", "you", "to", "use", "\"", "make", "menuconfig", "\"", "or", "\"", "make", "xconfig", "\"", "for", "a", "more", "comfortable", "configuration", "editing", ")", "Then", "you", "can", "do", "modprobe", "sb", "and", "everything", "will", "be", "(", "hopefully", ")", "configured", ".", "You", "should", "get", "something", "similar", "in", "syslog", ":", "sb", ":", "CMI8330", "detected", ".", "sb", ":", "CMI8330", "sb", "base", "located", "at", "0x220", "sb", ":", "CMI8330", "mpu", "base", "located", "at", "0x330", "sb", ":", "CMI8330", "mail", "reports", "to", "Alessandro", "Zummo", "<", "azummo", "@", "ita", ".", "flashnet", ".", "it", ">", "sb", ":", "ISAPnP", "reports", "CMI", "8330", "SoundPRO", "at", "i", "/", "o", "0x220", ",", "irq", "7", ",", "dma", "1", ",", "5", "The", "old", "documentation", "file", "follows", "for", "reference", "purposes", ".", "How", "to", "enable", "CMI", "8330", "(", "SOUNDPRO", ")", "soundchip", "on", "Linux", "Stefan", "Laudat", "<", "Stefan", ".", "Laudat", "@", "asit", ".", "ro", ">", "[", "Note", ":", "The", "CMI", "8338", "is", "unrelated", "and", "is", "supported", "by", "cmpci", ".", "o", "]", "In", "order", "to", "use", "CMI8330", "under", "Linux", "you", "just", "have", "to", "use", "a", "proper", "isapnp", ".", "conf", ",", "a", "good", "isapnp", "and", "a", "little", "bit", "of", "patience", ".", "I", "use", "isapnp", "1", ".", "17", ",", "but", "you", "may", "get", "a", "better", "one", "I", "guess", "at", "http", ":", "//", "www", ".", "roestock", ".", "demon", ".", "co", ".", "uk", "/", "isapnptools", "/", ".", "Of", "course", "you", "will", "have", "to", "compile", "kernel", "sound", "support", "as", "module", ",", "as", "shown", "below", ":", "CONFIG_SOUND", "=", "m", "CONFIG_SOUND_OSS", "=", "m", "CONFIG_SOUND_SB", "=", "m", "CONFIG_SOUND_ADLIB", "=", "m", "CONFIG_SOUND_MPU401", "=", "m", "#", "Mikro", "$", "chaft", "sound", "system", "(", "kinda", "useful", "here", ";", "))", "CONFIG_SOUND_MSS", "=", "m", "The", "/", "etc", "/", "isapnp", ".", "conf", "file", "will", "be", ":", "<", "snip", "below", ">", "(", "READPORT", "0x0203", ")", "(", "ISOLATE", "PRESERVE", ")", "(", "IDENTIFY", "*", ")", "(", "VERBOSITY", "2", ")", "(", "CONFLICT", "(", "IO", "FATAL", ")", "(", "IRQ", "FATAL", ")", "(", "DMA", "FATAL", ")", "(", "MEM", "FATAL", ")", ")", "#", "or", "WARNING", "(", "VERIFYLD", "N", ")", "#", "WSS", "(", "CONFIGURE", "CMI0001", "/", "16777472", "(", "LD", "0", "(", "IO", "0", "(", "SIZE", "8", ")", "(", "BASE", "0x0530", ")", ")", "(", "IO", "1", "(", "SIZE", "8", ")", "(", "BASE", "0x0388", ")", ")", "(", "INT", "0", "(", "IRQ", "7", "(", "MODE", "+", "E", ")", "))", "(", "DMA", "0", "(", "CHANNEL", "0", ")", ")", "(", "NAME", "\"", "CMI0001", "/", "16777472", "[", "0", "]", "{", "CMI8330", "/", "C3D", "Audio", "Adapter", "}", "\")", "(", "ACT", "Y", ")", ")", ")", "#", "MPU", "(", "CONFIGURE", "CMI0001", "/", "16777472", "(", "LD", "1", "(", "IO", "0", "(", "SIZE", "2", ")", "(", "BASE", "0x0330", ")", ")", "(", "INT", "0", "(", "IRQ", "11", "(", "MODE", "+", "E", ")", "))", "(", "NAME", "\"", "CMI0001", "/", "16777472", "[", "1", "]", "{", "CMI8330", "/", "C3D", "Audio", "Adapter", "}", "\")", "(", "ACT", "Y", ")", ")", ")", "#", "Joystick", "(", "CONFIGURE", "CMI0001", "/", "16777472", "(", "LD", "2", "(", "IO", "0", "(", "SIZE", "8", ")", "(", "BASE", "0x0200", ")", ")", "(", "NAME", "\"", "CMI0001", "/", "16777472", "[", "2", "]", "{", "CMI8330", "/", "C3D", "Audio", "Adapter", "}", "\")", "(", "ACT", "Y", ")", ")", ")", "#", "SoundBlaster", "(", "CONFIGURE", "CMI0001", "/", "16777472", "(", "LD", "3", "(", "IO", "0", "(", "SIZE", "16", ")", "(", "BASE", "0x0220", ")", ")", "(", "INT", "0", "(", "IRQ", "5", "(", "MODE", "+", "E", ")", "))", "(", "DMA", "0", "(", "CHANNEL", "1", ")", ")", "(", "DMA", "1", "(", "CHANNEL", "5", ")", ")", "(", "NAME", "\"", "CMI0001", "/", "16777472", "[", "3", "]", "{", "CMI8330", "/", "C3D", "Audio", "Adapter", "}", "\")", "(", "ACT", "Y", ")", ")", ")", "(", "WAITFORKEY", ")", "<", "end", "of", "snip", ">", "The", "module", "sequence", "is", "trivial", ":", "/", "sbin", "/", "insmod", "soundcore", "/", "sbin", "/", "insmod", "sound", "/", "sbin", "/", "insmod", "uart401", "#", "insert", "this", "first", "/", "sbin", "/", "insmod", "ad1848", "io", "=", "0x530", "irq", "=", "7", "dma", "=", "0", "soundpro", "=", "1", "#", "The", "sb", "module", "is", "an", "alternative", "to", "the", "ad1848", "(", "Microsoft", "Sound", "System", ")", "#", "Anyhow", ",", "this", "is", "full", "duplex", "and", "has", "MIDI", "/", "sbin", "/", "insmod", "sb", "io", "=", "0x220", "dma", "=", "1", "dma16", "=", "5", "irq", "=", "5", "mpu_io", "=", "0x330", "Alma", "Chao", "<", "elysian", "@", "ethereal", ".", "torsion", ".", "org", ">", "suggests", "the", "following", "in", "a", "/", "etc", "/", "modprobe", ".", "d", "/", "*", "conf", "file", ":", "alias", "sound", "ad1848", "alias", "synth0", "opl3", "options", "ad1848", "io", "=", "0x530", "irq", "=", "7", "dma", "=", "0", "soundpro", "=", "1", "options", "opl3", "io", "=", "0x388", "@", "@", "-", "1", ",", "34", "+", "0", ",", "0", "@", "@", "Documentation", "for", "the", "ESS", "AudioDrive", "chips", "In", "2", ".", "4", "kernels", "the", "SoundBlaster", "driver", "not", "only", "tries", "to", "detect", "an", "ESS", "chip", ",", "it", "tries", "to", "detect", "the", "type", "of", "ESS", "chip", "too", ".", "The", "correct", "detection", "of", "the", "chip", "doesn", "'", "t", "always", "succeed", "however", ",", "so", "unless", "you", "use", "the", "kernel", "isapnp", "facilities", "(", "and", "you", "chip", "is", "pnp", "capable", ")", "the", "default", "behaviour", "is", "2", ".", "0", "behaviour", "which", "means", ":", "only", "detect", "ES688", "and", "ES1688", ".", "All", "ESS", "chips", "now", "have", "a", "recording", "level", "setting", ".", "This", "is", "a", "need", "-", "to", "-", "have", "for", "people", "who", "want", "to", "use", "their", "ESS", "for", "recording", "sound", ".", "Every", "chip", "that", "'", "s", "detected", "as", "a", "later", "-", "than", "-", "es1688", "chip", "has", "a", "6", "bits", "logarithmic", "master", "volume", "control", ".", "Every", "chip", "that", "'", "s", "detected", "as", "a", "ES1887", "now", "has", "Full", "Duplex", "support", ".", "Made", "a", "little", "testprogram", "that", "shows", "that", "is", "works", ",", "haven", "'", "t", "seen", "a", "real", "program", "that", "needs", "this", "however", ".", "For", "ESS", "chips", "an", "additional", "parameter", "\"", "esstype", "\"", "can", "be", "specified", ".", "This", "controls", "the", "(", "auto", ")", "detection", "of", "the", "ESS", "chips", ".", "It", "can", "have", "3", "kinds", "of", "values", ":", "1", "Act", "like", "2", ".", "0", "kernels", ":", "only", "detect", "ES688", "or", "ES1688", ".", "0", "Try", "to", "auto", "-", "detect", "the", "chip", "(", "may", "fail", "for", "ES1688", ")", "688", "The", "chip", "will", "be", "treated", "as", "ES688", "1688", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", "ES1688", "1868", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", "ES1868", "1869", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", "ES1869", "1788", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", "ES1788", "1887", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", "ES1887", "1888", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", ",", "ES1888", "Because", "Full", "Duplex", "is", "supported", "for", "ES1887", "you", "can", "specify", "a", "second", "DMA", "channel", "by", "specifying", "module", "parameter", "dma16", ".", "It", "can", "be", "one", "of", ":", "0", ",", "1", ",", "3", "or", "5", ".", "@", "@", "-", "1", ",", "55", "+", "0", ",", "0", "@", "@", "Documentation", "for", "the", "ESS1868F", "AudioDrive", "PnP", "sound", "card", "The", "ESS1868", "sound", "card", "is", "a", "PnP", "ESS1688", "-", "compatible", "16", "-", "bit", "sound", "card", ".", "It", "should", "be", "automatically", "detected", "by", "the", "Linux", "Kernel", "isapnp", "support", "when", "you", "load", "the", "sb", ".", "o", "module", ".", "Otherwise", "you", "should", "take", "care", "of", ":", "*", "The", "ESS1868", "does", "not", "allow", "use", "of", "a", "16", "-", "bit", "DMA", ",", "thus", "DMA", "0", ",", "1", ",", "2", ",", "and", "3", "may", "only", "be", "used", ".", "*", "isapnptools", "version", "1", ".", "14", "does", "work", "with", "ESS1868", ".", "Earlier", "versions", "might", "not", ".", "*", "Sound", "support", "MUST", "be", "compiled", "as", "MODULES", ",", "not", "statically", "linked", "into", "the", "kernel", ".", "NOTE", ":", "this", "is", "only", "needed", "when", "not", "using", "the", "kernel", "isapnp", "support", "!", "For", "configuring", "the", "sound", "card", "'", "s", "I", "/", "O", "addresses", ",", "IRQ", "and", "DMA", ",", "here", "is", "a", "sample", "copy", "of", "the", "isapnp", ".", "conf", "directives", "regarding", "the", "ESS1868", ":", "(", "CONFIGURE", "ESS1868", "/", "-", "1", "(", "LD", "1", "(", "IO", "0", "(", "BASE", "0x0220", ")", ")", "(", "IO", "1", "(", "BASE", "0x0388", ")", ")", "(", "IO", "2", "(", "BASE", "0x0330", ")", ")", "(", "DMA", "0", "(", "CHANNEL", "1", ")", ")", "(", "INT", "0", "(", "IRQ", "5", "(", "MODE", "+", "E", ")", "))", "(", "ACT", "Y", ")", ")", ")", "(", "for", "a", "full", "working", "isapnp", ".", "conf", "file", ",", "remember", "the", "(", "ISOLATE", ")", "(", "IDENTIFY", "*", ")", "at", "the", "beginning", "and", "the", "(", "WAITFORKEY", ")", "at", "the", "end", ".", ")", "In", "this", "setup", ",", "the", "main", "card", "I", "/", "O", "is", "0x0220", ",", "FM", "synthesizer", "is", "0x0388", ",", "and", "the", "MPU", "-", "401", "MIDI", "port", "is", "located", "at", "0x0330", ".", "IRQ", "is", "IRQ", "5", ",", "DMA", "is", "channel", "1", ".", "After", "configuring", "the", "sound", "card", "via", "isapnp", ",", "to", "use", "the", "card", "you", "must", "load", "the", "sound", "modules", "with", "the", "proper", "I", "/", "O", "information", ".", "Here", "is", "my", "setup", ":", "#", "ESS1868F", "AudioDrive", "initialization", "/", "sbin", "/", "modprobe", "sound", "/", "sbin", "/", "insmod", "uart401", "/", "sbin", "/", "insmod", "sb", "io", "=", "0x220", "irq", "=", "5", "dma", "=", "1", "dma16", "=", "-", "1", "/", "sbin", "/", "insmod", "mpu401", "io", "=", "0x330", "/", "sbin", "/", "insmod", "opl3", "io", "=", "0x388", "/", "sbin", "/", "insmod", "v_midi", "opl3", "is", "the", "FM", "synthesizer", "/", "sbin", "/", "insmod", "opl3", "io", "=", "0x388", "@", "@", "-", "1", ",", "459", "+", "0", ",", "0", "@", "@", "Introduction", "Notes", "on", "Modular", "Sound", "Drivers", "and", "Soundcore", "Wade", "Hampton", "2", "/", "14", "/", "2001", "Purpose", ":", "=", "==", "==", "==", "=", "This", "document", "provides", "some", "general", "notes", "on", "the", "modular", "sound", "drivers", "and", "their", "configuration", ",", "along", "with", "the", "support", "modules", "sound", ".", "o", "and", "soundcore", ".", "o", ".", "Note", ",", "some", "of", "this", "probably", "should", "be", "added", "to", "the", "Sound", "-", "HOWTO", "!", "Note", ",", "soundlow", ".", "o", "was", "present", "with", "2", ".", "2", "kernels", "but", "is", "not", "required", "for", "2", ".", "4", ".", "x", "kernels", ".", "References", "have", "been", "removed", "to", "this", ".", "Copying", ":", "=", "==", "==", "==", "=", "none", "History", ":", "=", "==", "==", "==", "=", "0", ".", "1", ".", "0", "11", "/", "20", "/", "1998", "First", "version", ",", "draft", "1", ".", "0", ".", "0", "11", "/", "1998", "Alan", "Cox", "changes", ",", "incorporation", "in", "2", ".", "2", ".", "0", "as", "Documentation", "/", "sound", "/", "oss", "/", "Introduction", "1", ".", "1", ".", "0", "6", "/", "30", "/", "1999", "Second", "version", ",", "added", "notes", "on", "making", "the", "drivers", ",", "added", "info", "on", "multiple", "sound", "cards", "of", "similar", "types", ",", "]", "added", "more", "diagnostics", "info", ",", "added", "info", "about", "esd", ".", "added", "info", "on", "OSS", "and", "ALSA", ".", "1", ".", "1", ".", "1", "19991031", "Added", "notes", "on", "sound", "-", "slot", "-", "and", "sound", "-", "service", ".", "(", "Alan", "Cox", ")", "1", ".", "1", ".", "2", "20000920", "Modified", "for", "Kernel", "2", ".", "4", "(", "Christoph", "Hellwig", ")", "1", ".", "1", ".", "3", "20010214", "Minor", "notes", "and", "corrections", "(", "Wade", "Hampton", ")", "Added", "examples", "of", "sound", "-", "slot", "-", "0", ",", "etc", ".", "Modular", "Sound", "Drivers", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "Thanks", "to", "the", "GREAT", "work", "by", "Alan", "Cox", "(", "alan", "@", "lxorguk", ".", "ukuu", ".", "org", ".", "uk", ")", ",", "[", "And", "Oleg", "Drokin", ",", "Thomas", "Sailer", ",", "Andrew", "Veliath", "and", "more", "than", "a", "few", "others", "-", "not", "to", "mention", "Hannu", "'", "s", "original", "code", "being", "designed", "well", "enough", "to", "cope", "with", "that", "kind", "of", "chopping", "up", "]", "(", "Alan", ")", "the", "standard", "Linux", "kernels", "support", "a", "modular", "sound", "driver", ".", "From", "Alan", "'", "s", "comments", "in", "linux", "/", "drivers", "/", "sound", "/", "README", ".", "FIRST", ":", "The", "modular", "sound", "driver", "patches", "were", "funded", "by", "Red", "Hat", "Software", "(", "www", ".", "redhat", ".", "com", ")", ".", "The", "sound", "driver", "here", "is", "thus", "a", "modified", "version", "of", "Hannu", "'", "s", "code", ".", "Please", "bear", "that", "in", "mind", "when", "considering", "the", "appropriate", "forums", "for", "bug", "reporting", ".", "The", "modular", "sound", "drivers", "may", "be", "loaded", "via", "insmod", "or", "modprobe", ".", "To", "support", "all", "the", "various", "sound", "modules", ",", "there", "are", "two", "general", "support", "modules", "that", "must", "be", "loaded", "first", ":", "soundcore", ".", "o", ":", "Top", "level", "handler", "for", "the", "sound", "system", ",", "provides", "a", "set", "of", "functions", "for", "registration", "of", "devices", "by", "type", ".", "sound", ".", "o", ":", "Common", "sound", "functions", "required", "by", "all", "modules", ".", "For", "the", "specific", "sound", "modules", "(", "e", ".", "g", ".", ",", "sb", ".", "o", "for", "the", "Soundblaster", ")", ",", "read", "the", "documentation", "on", "that", "module", "to", "determine", "what", "options", "are", "available", ",", "for", "example", "IRQ", ",", "address", ",", "DMA", ".", "Warning", ",", "the", "options", "for", "different", "cards", "sometime", "use", "different", "names", "for", "the", "same", "or", "a", "similar", "feature", "(", "dma1", "=", "versus", "dma16", "=", ").", "As", "a", "last", "resort", ",", "inspect", "the", "code", "(", "search", "for", "module_param", ")", ".", "Notes", ":", "1", ".", "There", "is", "a", "new", "OpenSource", "sound", "driver", "called", "ALSA", "which", "is", "currently", "under", "development", ":", "http", ":", "//", "www", ".", "alsa", "-", "project", ".", "org", "/", "The", "ALSA", "drivers", "support", "some", "newer", "hardware", "that", "may", "not", "be", "supported", "by", "this", "sound", "driver", "and", "also", "provide", "some", "additional", "features", ".", "2", ".", "The", "commercial", "OSS", "driver", "may", "be", "obtained", "from", "the", "site", ":", "http", ":", "//", "www", ".", "opensound", ".", "com", ".", "This", "may", "be", "used", "for", "cards", "that", "are", "unsupported", "by", "the", "kernel", "driver", ",", "or", "may", "be", "used", "by", "other", "operating", "systems", ".", "3", ".", "The", "enlightenment", "sound", "daemon", "may", "be", "used", "for", "playing", "multiple", "sounds", "at", "the", "same", "time", "via", "a", "single", "card", ",", "eliminating", "some", "of", "the", "requirements", "for", "multiple", "sound", "card", "systems", ".", "For", "more", "information", ",", "see", ":", "http", ":", "//", "www", ".", "tux", ".", "org", "/", "~", "ricdude", "/", "EsounD", ".", "html", "The", "\"", "esd", "\"", "program", "may", "be", "used", "with", "the", "real", "-", "player", "and", "mpeg", "players", "like", "mpg123", "and", "x11amp", ".", "The", "newer", "real", "-", "player", "and", "some", "games", "even", "include", "built", "-", "in", "support", "for", "ESD", "!", "Building", "the", "Modules", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "This", "document", "does", "not", "provide", "full", "details", "on", "building", "the", "kernel", ",", "etc", ".", "The", "notes", "below", "apply", "only", "to", "making", "the", "kernel", "sound", "modules", ".", "If", "this", "conflicts", "with", "the", "kernel", "'", "s", "README", ",", "the", "README", "takes", "precedence", ".", "1", ".", "To", "make", "the", "kernel", "sound", "modules", ",", "cd", "to", "your", "/", "usr", "/", "src", "/", "linux", "directory", "(", "typically", ")", "and", "type", "make", "config", ",", "make", "menuconfig", ",", "or", "make", "xconfig", "(", "to", "start", "the", "command", "line", ",", "dialog", ",", "or", "x", "-", "based", "configuration", "tool", ")", ".", "2", ".", "Select", "the", "Sound", "option", "and", "a", "dialog", "will", "be", "displayed", ".", "3", ".", "Select", "M", "(", "module", ")", "for", "\"", "Sound", "card", "support", "\"", ".", "4", ".", "Select", "your", "sound", "driver", "(", "s", ")", "as", "a", "module", ".", "For", "ProAudio", ",", "Sound", "Blaster", ",", "etc", ".", ",", "select", "M", "(", "module", ")", "for", "OSS", "sound", "modules", ".", "[", "thanks", "to", "Marvin", "Stodolsky", "<", "stodolsk", "@", "erols", ".", "com", ">", "]", "A", "5", ".", "Make", "the", "kernel", "(", "e", ".", "g", ".", ",", "make", "bzImage", ")", ",", "and", "install", "the", "kernel", ".", "6", ".", "Make", "the", "modules", "and", "install", "them", "(", "make", "modules", ";", "make", "modules_install", ")", ".", "Note", ",", "for", "2", ".", "5", ".", "x", "kernels", ",", "make", "sure", "you", "have", "the", "newer", "module", "-", "init", "-", "tools", "installed", "or", "modules", "will", "not", "be", "loaded", "properly", ".", "2", ".", "5", ".", "x", "requires", "an", "updated", "module", "-", "init", "-", "tools", ".", "Plug", "and", "Play", "(", "PnP", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "If", "the", "sound", "card", "is", "an", "ISA", "PnP", "card", ",", "isapnp", "may", "be", "used", "to", "configure", "the", "card", ".", "See", "the", "file", "isapnp", ".", "txt", "in", "the", "directory", "one", "level", "up", "(", "e", ".", "g", ".", ",", "/", "usr", "/", "src", "/", "linux", "/", "Documentation", ")", ".", "Also", "the", "2", ".", "4", ".", "x", "kernels", "provide", "PnP", "capabilities", ",", "see", "the", "file", "NEWS", "in", "this", "directory", ".", "PCI", "sound", "cards", "are", "highly", "recommended", ",", "as", "they", "are", "far", "easier", "to", "configure", "and", "from", "what", "I", "have", "read", ",", "they", "use", "less", "resources", "and", "are", "more", "CPU", "efficient", ".", "INSMOD", ":", "=", "==", "==", "==", "If", "loading", "via", "insmod", ",", "the", "common", "modules", "must", "be", "loaded", "in", "the", "order", "below", "BEFORE", "loading", "the", "other", "sound", "modules", ".", "The", "card", "-", "specific", "modules", "may", "then", "be", "loaded", "(", "most", "require", "parameters", ")", ".", "For", "example", ",", "I", "use", "the", "following", "via", "a", "shell", "script", "to", "load", "my", "SoundBlaster", ":", "SB_BASE", "=", "0x240", "SB_IRQ", "=", "9", "SB_DMA", "=", "3", "SB_DMA2", "=", "5", "SB_MPU", "=", "0x300", "#", "echo", "Starting", "sound", "/", "sbin", "/", "insmod", "soundcore", "/", "sbin", "/", "insmod", "sound", "#", "echo", "Starting", "sound", "blaster", ".", "..", ".", "/", "sbin", "/", "insmod", "uart401", "/", "sbin", "/", "insmod", "sb", "io", "=", "$", "SB_BASE", "irq", "=", "$", "SB_IRQ", "dma", "=", "$", "SB_DMA", "dma16", "=", "$", "SB_DMA2", "mpu_io", "=", "$", "SB_MP", "When", "using", "sound", "as", "a", "module", ",", "I", "typically", "put", "these", "commands", "in", "a", "file", "such", "as", "/", "root", "/", "soundon", ".", "sh", ".", "MODPROBE", ":", "=", "==", "==", "==", "==", "If", "loading", "via", "modprobe", ",", "these", "common", "files", "are", "automatically", "loaded", "when", "requested", "by", "modprobe", ".", "For", "example", ",", "my", "/", "etc", "/", "modprobe", ".", "d", "/", "oss", ".", "conf", "contains", ":", "alias", "sound", "sb", "options", "sb", "io", "=", "0x240", "irq", "=", "9", "dma", "=", "3", "dma16", "=", "5", "mpu_io", "=", "0x300", "All", "you", "need", "to", "do", "to", "load", "the", "module", "is", ":", "/", "sbin", "/", "modprobe", "sb", "Sound", "Status", ":", "=", "==", "==", "==", "==", "==", "==", "The", "status", "of", "sound", "may", "be", "read", "/", "checked", "by", ":", "cat", "(", "anyfile", ")", ".", "au", ">", "/", "dev", "/", "audio", "[", "WWH", ":", "This", "may", "not", "work", "properly", "for", "SoundBlaster", "PCI", "128", "cards", "such", "as", "the", "es1370", "/", "1", "(", "see", "the", "es1370", "/", "1", "files", "in", "this", "directory", ")", "as", "they", "do", "not", "automatically", "support", "uLaw", "on", "/", "dev", "/", "audio", ".", "]", "The", "status", "of", "the", "modules", "and", "which", "modules", "depend", "on", "which", "other", "modules", "may", "be", "checked", "by", ":", "/", "sbin", "/", "lsmod", "/", "sbin", "/", "lsmod", "should", "show", "something", "like", "the", "following", ":", "sb", "26280", "0", "uart401", "5640", "0", "[", "sb", "]", "sound", "57112", "0", "[", "sb", "uart401", "]", "soundcore", "1968", "8", "[", "sb", "sound", "]", "Removing", "Sound", ":", "=", "==", "==", "==", "==", "==", "==", "==", "Sound", "may", "be", "removed", "by", "using", "/", "sbin", "/", "rmmod", "in", "the", "reverse", "order", "in", "which", "you", "load", "the", "modules", ".", "Note", ",", "if", "a", "program", "has", "a", "sound", "device", "open", "(", "e", ".", "g", ".", ",", "xmixer", ")", ",", "that", "module", "(", "and", "the", "modules", "on", "which", "it", "depends", ")", "may", "not", "be", "unloaded", ".", "For", "example", ",", "I", "use", "the", "following", "to", "remove", "my", "Soundblaster", "(", "rmmod", "in", "the", "reverse", "order", "in", "which", "I", "loaded", "the", "modules", ")", ":", "/", "sbin", "/", "rmmod", "sb", "/", "sbin", "/", "rmmod", "uart401", "/", "sbin", "/", "rmmod", "sound", "/", "sbin", "/", "rmmod", "soundcore", "When", "using", "sound", "as", "a", "module", ",", "I", "typically", "put", "these", "commands", "in", "a", "script", "such", "as", "/", "root", "/", "soundoff", ".", "sh", ".", "Removing", "Sound", "for", "use", "with", "OSS", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "If", "you", "get", "really", "stuck", "or", "have", "a", "card", "that", "the", "kernel", "modules", "will", "not", "support", ",", "you", "can", "get", "a", "commercial", "sound", "driver", "from", "http", ":", "//", "www", ".", "opensound", ".", "com", ".", "Before", "loading", "the", "commercial", "sound", "driver", ",", "you", "should", "do", "the", "following", ":", "1", ".", "remove", "sound", "modules", "(", "detailed", "above", ")", "2", ".", "remove", "the", "sound", "modules", "from", "/", "etc", "/", "modprobe", ".", "d", "/", "*.", "conf", "3", ".", "move", "the", "sound", "modules", "from", "/", "lib", "/", "modules", "/", "<", "kernel", ">", "/", "misc", "(", "for", "example", ",", "I", "make", "a", "/", "lib", "/", "modules", "/", "<", "kernel", ">", "/", "misc", "/", "tmp", "directory", "and", "copy", "the", "sound", "module", "files", "to", "that", "directory", ")", ".", "Multiple", "Sound", "Cards", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "The", "sound", "drivers", "will", "support", "multiple", "sound", "cards", "and", "there", "are", "some", "great", "applications", "like", "multitrack", "that", "support", "them", ".", "Typically", ",", "you", "need", "two", "sound", "cards", "of", "different", "types", ".", "Note", ",", "this", "uses", "more", "precious", "interrupts", "and", "DMA", "channels", "and", "sometimes", "can", "be", "a", "configuration", "nightmare", ".", "I", "have", "heard", "reports", "of", "3", "-", "4", "sound", "cards", "(", "typically", "I", "only", "use", "2", ")", ".", "You", "can", "sometimes", "use", "multiple", "PCI", "sound", "cards", "of", "the", "same", "type", ".", "On", "my", "machine", "I", "have", "two", "sound", "cards", "(", "cs4232", "and", "Soundblaster", "Vibra", "16", ")", ".", "By", "loading", "sound", "as", "modules", ",", "I", "can", "control", "which", "is", "the", "first", "sound", "device", "(", "/", "dev", "/", "dsp", ",", "/", "dev", "/", "audio", ",", "/", "dev", "/", "mixer", ")", "and", "which", "is", "the", "second", ".", "Normally", ",", "the", "cs4232", "(", "Dell", "sound", "on", "the", "motherboard", ")", "would", "be", "the", "first", "sound", "device", ",", "but", "I", "prefer", "the", "Soundblaster", ".", "All", "you", "have", "to", "do", "is", "to", "load", "the", "one", "you", "want", "as", "/", "dev", "/", "dsp", "first", "(", "in", "my", "case", "\"", "sb", "\"", ")", "and", "then", "load", "the", "other", "one", "(", "in", "my", "case", "\"", "cs4232", "\"", ").", "If", "you", "have", "two", "cards", "of", "the", "same", "type", "that", "are", "jumpered", "cards", "or", "different", "PnP", "revisions", ",", "you", "may", "load", "the", "same", "module", "twice", ".", "For", "example", ",", "I", "have", "a", "SoundBlaster", "vibra", "16", "and", "an", "older", "SoundBlaster", "16", "(", "jumpers", ")", ".", "To", "load", "the", "module", "twice", ",", "you", "need", "to", "do", "the", "following", ":", "1", ".", "Copy", "the", "sound", "modules", "to", "a", "new", "name", ".", "For", "example", "sb", ".", "o", "could", "be", "copied", "(", "or", "symlinked", ")", "to", "sb1", ".", "o", "for", "the", "second", "SoundBlaster", ".", "2", ".", "Make", "a", "second", "entry", "in", "/", "etc", "/", "modprobe", ".", "d", "/", "*", "conf", ",", "for", "example", ",", "sound1", "or", "sb1", ".", "This", "second", "entry", "should", "refer", "to", "the", "new", "module", "names", "for", "example", "sb1", ",", "and", "should", "include", "the", "I", "/", "O", ",", "etc", ".", "for", "the", "second", "sound", "card", ".", "3", ".", "Update", "your", "soundon", ".", "sh", "script", ",", "etc", ".", "Warning", ":", "I", "have", "never", "been", "able", "to", "get", "two", "PnP", "sound", "cards", "of", "the", "same", "type", "to", "load", "at", "the", "same", "time", ".", "I", "have", "tried", "this", "several", "times", "with", "the", "Soundblaster", "Vibra", "16", "cards", ".", "OSS", "has", "indicated", "that", "this", "is", "a", "PnP", "problem", ".", "..", ".", "If", "anyone", "has", "any", "luck", "doing", "this", ",", "please", "send", "me", "an", "E", "-", "MAIL", ".", "PCI", "sound", "cards", "should", "not", "have", "this", "problem", ".", "a", "Since", "this", "was", "originally", "release", ",", "I", "have", "received", "a", "couple", "of", "mails", "from", "people", "who", "have", "accomplished", "this", "!", "NOTE", ":", "In", "Linux", "2", ".", "4", "the", "Sound", "Blaster", "driver", "(", "and", "only", "this", "one", "yet", ")", "supports", "multiple", "cards", "with", "one", "module", "by", "default", ".", "Read", "the", "file", "'", "Soundblaster", "'", "in", "this", "directory", "for", "details", ".", "Sound", "Problems", ":", "=", "==", "==", "==", "==", "==", "==", "==", "First", "RTFM", "(", "including", "the", "troubleshooting", "section", "in", "the", "Sound", "-", "HOWTO", ")", ".", "1", ")", "If", "you", "are", "having", "problems", "loading", "the", "modules", "(", "for", "example", ",", "if", "you", "get", "device", "conflict", "errors", ")", "try", "the", "following", ":", "A", ")", "If", "you", "have", "Win95", "or", "NT", "on", "the", "same", "computer", ",", "write", "down", "what", "addresses", ",", "IRQ", ",", "and", "DMA", "channels", "those", "were", "using", "for", "the", "same", "hardware", ".", "You", "probably", "can", "use", "these", "addresses", ",", "IRQs", ",", "and", "DMA", "channels", ".", "You", "should", "really", "do", "this", "BEFORE", "attempting", "to", "get", "sound", "working", "!", "B", ")", "Check", "(", "cat", ")", "/", "proc", "/", "interrupts", ",", "/", "proc", "/", "ioports", ",", "and", "/", "proc", "/", "dma", ".", "Are", "you", "trying", "to", "use", "an", "address", ",", "IRQ", "or", "DMA", "port", "that", "another", "device", "is", "using", "?", "C", ")", "Check", "(", "cat", ")", "/", "proc", "/", "isapnp", "D", ")", "Inspect", "your", "/", "var", "/", "log", "/", "messages", "file", ".", "Often", "that", "will", "indicate", "what", "IRQ", "or", "IO", "port", "could", "not", "be", "obtained", ".", "E", ")", "Try", "another", "port", "or", "IRQ", ".", "Note", "this", "may", "involve", "using", "the", "PnP", "tools", "to", "move", "the", "sound", "card", "to", "another", "location", ".", "Sometimes", "this", "is", "the", "only", "way", "and", "it", "is", "more", "or", "less", "trial", "and", "error", ".", "2", ")", "If", "you", "get", "motor", "-", "boating", "(", "the", "same", "sound", "or", "part", "of", "a", "sound", "clip", "repeated", ")", ",", "you", "probably", "have", "either", "an", "IRQ", "or", "DMA", "conflict", ".", "Move", "the", "card", "to", "another", "IRQ", "or", "DMA", "port", ".", "This", "has", "happened", "to", "me", "when", "playing", "long", "files", "when", "I", "had", "an", "IRQ", "conflict", ".", "3", ".", "If", "you", "get", "dropouts", "or", "pauses", "when", "playing", "high", "sample", "rate", "files", "such", "as", "using", "mpg123", "or", "x11amp", "/", "xmms", ",", "you", "may", "have", "too", "slow", "of", "a", "CPU", "and", "may", "have", "to", "use", "the", "options", "to", "play", "the", "files", "at", "1", "/", "2", "speed", ".", "For", "example", ",", "you", "may", "use", "the", "-", "2", "or", "-", "4", "option", "on", "mpg123", ".", "You", "may", "also", "get", "this", "when", "trying", "to", "play", "mpeg", "files", "stored", "on", "a", "CD", "-", "ROM", "(", "my", "Toshiba", "T8000", "PII", "/", "366", "sometimes", "has", "this", "problem", ")", ".", "4", ".", "If", "you", "get", "\"", "cannot", "access", "device", "\"", "errors", ",", "your", "/", "dev", "/", "dsp", "files", ",", "etc", ".", "may", "be", "set", "to", "owner", "root", ",", "mode", "600", ".", "You", "may", "have", "to", "use", "the", "command", ":", "chmod", "666", "/", "dev", "/", "dsp", "/", "dev", "/", "mixer", "/", "dev", "/", "audio", "5", ".", "If", "you", "get", "\"", "device", "busy", "\"", "errors", ",", "another", "program", "has", "the", "sound", "device", "open", ".", "For", "example", ",", "if", "using", "the", "Enlightenment", "sound", "daemon", "\"", "esd", "\"", ",", "the", "\"", "esd", "\"", "program", "has", "the", "sound", "device", ".", "If", "using", "\"", "esd", "\"", ",", "please", "RTFM", "the", "docs", "on", "ESD", ".", "For", "example", ",", "esddsp", "<", "program", ">", "may", "be", "used", "to", "play", "files", "via", "a", "non", "-", "esd", "aware", "program", ".", "6", ")", "Ask", "for", "help", "on", "the", "sound", "list", "or", "send", "E", "-", "MAIL", "to", "the", "sound", "driver", "author", "/", "maintainer", ".", "7", ")", "Turn", "on", "debug", "in", "drivers", "/", "sound", "/", "sound_config", ".", "h", "(", "DEB", ",", "DDB", ",", "MDB", ")", ".", "8", ")", "If", "the", "system", "reports", "insufficient", "DMA", "memory", "then", "you", "may", "want", "to", "load", "sound", "with", "the", "\"", "dmabufs", "=", "1", "\"", "option", ".", "Or", "in", "/", "etc", "/", "conf", ".", "modules", "add", "preinstall", "sound", "dmabufs", "=", "1", "This", "makes", "the", "sound", "system", "allocate", "its", "buffers", "and", "hang", "onto", "them", ".", "You", "may", "also", "set", "persistent", "DMA", "when", "building", "a", "2", ".", "4", ".", "x", "kernel", ".", "Configuring", "Sound", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "There", "are", "several", "ways", "of", "configuring", "your", "sound", ":", "1", ")", "On", "the", "kernel", "command", "line", "(", "when", "using", "the", "sound", "driver", "(", "s", ")", "compiled", "in", "the", "kernel", ")", ".", "Check", "the", "driver", "source", "and", "documentation", "for", "details", ".", "2", ")", "On", "the", "command", "line", "when", "using", "insmod", "or", "in", "a", "bash", "script", "using", "command", "line", "calls", "to", "load", "sound", ".", "3", ")", "In", "/", "etc", "/", "modprobe", ".", "d", "/", "*", "conf", "when", "using", "modprobe", ".", "4", ")", "Via", "Red", "Hat", "'", "s", "GPL", "'", "d", "/", "usr", "/", "sbin", "/", "sndconfig", "program", "(", "text", "based", ")", ".", "5", ")", "Via", "the", "OSS", "soundconf", "program", "(", "with", "the", "commercial", "version", "of", "the", "OSS", "driver", ".", "6", ")", "By", "just", "loading", "the", "module", "and", "let", "isapnp", "do", "everything", "relevant", "for", "you", ".", "This", "works", "only", "with", "a", "few", "drivers", "yet", "and", "-", "of", "course", "only", "with", "isapnp", "hardware", ".", "And", "I", "am", "sure", ",", "several", "other", "ways", ".", "Anyone", "want", "to", "write", "a", "linuxconf", "module", "for", "configuring", "sound", "?", "Module", "Loading", ":", "=", "==", "==", "==", "==", "==", "==", "==", "When", "a", "sound", "card", "is", "first", "referenced", "and", "sound", "is", "modular", ",", "the", "sound", "system", "will", "ask", "for", "the", "sound", "devices", "to", "be", "loaded", ".", "Initially", "it", "requests", "that", "the", "driver", "for", "the", "sound", "system", "is", "loaded", ".", "It", "then", "will", "ask", "for", "sound", "-", "slot", "-", "0", ",", "where", "0", "is", "the", "first", "sound", "card", ".", "(", "sound", "-", "slot", "-", "1", "the", "second", "and", "so", "on", ")", ".", "Thus", "you", "can", "do", "alias", "sound", "-", "slot", "-", "0", "sb", "To", "load", "a", "soundblaster", "at", "this", "point", ".", "If", "the", "slot", "loading", "does", "not", "provide", "the", "desired", "device", "-", "for", "example", "a", "soundblaster", "does", "not", "directly", "provide", "a", "midi", "synth", "in", "all", "cases", "then", "it", "will", "request", "\"", "sound", "-", "service", "-", "0", "-", "n", "\"", "where", "n", "is", "0", "Mixer", "2", "MIDI", "3", ",", "4", "DSP", "audio", "For", "example", ",", "I", "use", "the", "following", "to", "load", "my", "Soundblaster", "PCI", "128", "(", "ES", "1371", ")", "card", "first", ",", "followed", "by", "my", "SoundBlaster", "Vibra", "16", "card", ",", "then", "by", "my", "TV", "card", ":", "#", "Load", "the", "Soundblaster", "PCI", "128", "as", "/", "dev", "/", "dsp", ",", "/", "dev", "/", "dsp1", ",", "/", "dev", "/", "mixer", "alias", "sound", "-", "slot", "-", "0", "es1371", "#", "Load", "the", "Soundblaster", "Vibra", "16", "as", "/", "dev", "/", "dsp2", ",", "/", "dev", "/", "mixer1", "alias", "sound", "-", "slot", "-", "1", "sb", "options", "sb", "io", "=", "0x240", "irq", "=", "5", "dma", "=", "1", "dma16", "=", "5", "mpu_io", "=", "0x330", "#", "Load", "the", "BTTV", "(", "TV", "card", ")", "as", "/", "dev", "/", "mixer2", "alias", "sound", "-", "slot", "-", "2", "bttv", "alias", "sound", "-", "service", "-", "2", "-", "0", "tvmixer", "pre", "-", "install", "bttv", "modprobe", "tuner", ";", "modprobe", "tvmixer", "pre", "-", "install", "tvmixer", "modprobe", "msp3400", ";", "modprobe", "tvaudio", "options", "tuner", "debug", "=", "0", "type", "=", "8", "options", "bttv", "card", "=", "0", "radio", "=", "0", "pll", "=", "0", "For", "More", "Information", "(", "RTFM", ")", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "1", ")", "Information", "on", "kernel", "modules", ":", "manual", "pages", "for", "insmod", "and", "modprobe", ".", "2", ")", "Information", "on", "PnP", ",", "RTFM", "manual", "pages", "for", "isapnp", ".", "3", ")", "Sound", "-", "HOWTO", "and", "Sound", "-", "Playing", "-", "HOWTO", ".", "4", ")", "OSS", "'", "s", "WWW", "site", "at", "http", ":", "//", "www", ".", "opensound", ".", "com", ".", "5", ")", "All", "the", "files", "in", "Documentation", "/", "sound", ".", "6", ")", "The", "comments", "and", "code", "in", "linux", "/", "drivers", "/", "sound", ".", "7", ")", "The", "sndconfig", "and", "rhsound", "documentation", "from", "Red", "Hat", ".", "8", ")", "The", "Linux", "-", "sound", "mailing", "list", ":", "sound", "-", "list", "@", "redhat", ".", "com", ".", "9", ")", "Enlightenment", "documentation", "(", "for", "info", "on", "esd", ")", "http", ":", "//", "www", ".", "tux", ".", "org", "/", "~", "ricdude", "/", "EsounD", ".", "html", ".", "10", ")", "ALSA", "home", "page", ":", "http", ":", "//", "www", ".", "alsa", "-", "project", ".", "org", "/", "Contact", "Information", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "Wade", "Hampton", ":", "(", "whampton", "@", "staffnet", ".", "com", ")", "@", "@", "-", "1", ",", "1137", "+", "0", ",", "0", "@", "@", "#", "!", "/", "bin", "/", "sh", "#", "#", "Turtle", "Beach", "MultiSound", "Driver", "Notes", "#", "-", "-", "Andrew", "Veliath", "<", "andrewtv", "@", "usa", ".", "net", ">", "#", "#", "Last", "update", ":", "September", "10", ",", "1998", "#", "Corresponding", "msnd", "driver", ":", "0", ".", "8", ".", "3", "#", "#", "*", "*", "This", "file", "is", "a", "README", "(", "top", "part", ")", "and", "shell", "archive", "(", "bottom", "part", ")", ".", "#", "The", "corresponding", "archived", "utility", "sources", "can", "be", "unpacked", "by", "#", "running", "`", "sh", "MultiSound", "'", "(", "the", "utilities", "are", "only", "needed", "for", "the", "#", "Pinnacle", "and", "Fiji", "cards", ")", ".", "*", "*", "#", "#", "#", "-", "=-", "=-", "Getting", "Firmware", "-", "=-", "=", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~", "#", "#", "See", "the", "section", "`", "Obtaining", "and", "Creating", "Firmware", "Files", "'", "in", "this", "#", "document", "for", "instructions", "on", "obtaining", "the", "necessary", "firmware", "#", "files", ".", "#", "#", "#", "Supported", "Features", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~", "#", "#", "Currently", ",", "full", "-", "duplex", "digital", "audio", "(", "/", "dev", "/", "dsp", "only", ",", "/", "dev", "/", "audio", "is", "#", "not", "currently", "available", ")", "and", "mixer", "functionality", "(", "/", "dev", "/", "mixer", ")", "are", "#", "supported", "(", "memory", "mapped", "digital", "audio", "is", "not", "yet", "supported", ")", ".", "#", "Digital", "transfers", "and", "monitoring", "can", "be", "done", "as", "well", "if", "you", "have", "#", "the", "digital", "daughterboard", "(", "see", "the", "section", "on", "using", "the", "S", "/", "PDIF", "port", "#", "for", "more", "information", ")", ".", "#", "#", "Support", "for", "the", "Turtle", "Beach", "MultiSound", "Hurricane", "architecture", "is", "#", "composed", "of", "the", "following", "modules", "(", "these", "can", "also", "operate", "compiled", "#", "into", "the", "kernel", ")", ":", "#", "#", "msnd", "-", "MultiSound", "base", "(", "requires", "soundcore", ")", "#", "#", "msnd_classic", "-", "Base", "audio", "/", "mixer", "support", "for", "Classic", ",", "Monetery", "and", "#", "Tahiti", "cards", "#", "#", "msnd_pinnacle", "-", "Base", "audio", "/", "mixer", "support", "for", "Pinnacle", "and", "Fiji", "cards", "#", "#", "#", "Important", "Notes", "-", "Read", "Before", "Using", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "#", "#", "The", "firmware", "files", "are", "not", "included", "(", "may", "change", "in", "future", ")", ".", "You", "#", "must", "obtain", "these", "images", "from", "Turtle", "Beach", "(", "they", "are", "included", "in", "#", "the", "MultiSound", "Development", "Kits", ")", ",", "and", "place", "them", "in", "/", "etc", "/", "sound", "for", "#", "example", ",", "and", "give", "the", "full", "paths", "in", "the", "Linux", "configuration", ".", "If", "#", "you", "are", "compiling", "in", "support", "for", "the", "MultiSound", "driver", "rather", "than", "#", "using", "it", "as", "a", "module", ",", "these", "firmware", "files", "must", "be", "accessible", "#", "during", "kernel", "compilation", ".", "#", "#", "Please", "note", "these", "files", "must", "be", "binary", "files", ",", "not", "assembler", ".", "See", "#", "the", "section", "later", "in", "this", "document", "for", "instructions", "to", "obtain", "these", "#", "files", ".", "#", "#", "#", "Configuring", "Card", "Resources", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~", "#", "#", "*", "*", "This", "section", "is", "very", "important", ",", "as", "your", "card", "may", "not", "work", "at", "all", "#", "or", "your", "machine", "may", "crash", "if", "you", "do", "not", "do", "this", "correctly", ".", "*", "*", "#", "#", "*", "Classic", "/", "Monterey", "/", "Tahiti", "#", "#", "These", "cards", "are", "configured", "through", "the", "driver", "msnd_classic", ".", "You", "must", "#", "know", "the", "io", "port", ",", "then", "the", "driver", "will", "select", "the", "irq", "and", "memory", "resources", "#", "on", "the", "card", ".", "It", "is", "up", "to", "you", "to", "know", "if", "these", "are", "free", "locations", "or", "now", ",", "#", "a", "conflict", "can", "lock", "the", "machine", "up", ".", "#", "#", "*", "Pinnacle", "/", "Fiji", "#", "#", "The", "Pinnacle", "and", "Fiji", "cards", "have", "an", "extra", "config", "port", ",", "either", "#", "0x250", ",", "0x260", "or", "0x270", ".", "This", "port", "can", "be", "disabled", "to", "have", "the", "card", "#", "configured", "strictly", "through", "PnP", ",", "however", "you", "lose", "the", "ability", "to", "#", "access", "the", "IDE", "controller", "and", "joystick", "devices", "on", "this", "card", "when", "#", "using", "PnP", ".", "The", "included", "pinnaclecfg", "program", "in", "this", "shell", "archive", "#", "can", "be", "used", "to", "configure", "the", "card", "in", "non", "-", "PnP", "mode", ",", "and", "in", "PnP", "mode", "#", "you", "can", "use", "isapnptools", ".", "These", "are", "described", "briefly", "here", ".", "#", "#", "pinnaclecfg", "is", "not", "required", ";", "you", "can", "use", "the", "msnd_pinnacle", "module", "#", "to", "fully", "configure", "the", "card", "as", "well", ".", "However", ",", "pinnaclecfg", "can", "be", "#", "used", "to", "change", "the", "resource", "values", "of", "a", "particular", "device", "after", "the", "#", "msnd_pinnacle", "module", "has", "been", "loaded", ".", "If", "you", "are", "compiling", "the", "#", "driver", "into", "the", "kernel", ",", "you", "must", "set", "these", "values", "during", "compile", "#", "time", ",", "however", "other", "peripheral", "resource", "values", "can", "be", "changed", "with", "#", "the", "pinnaclecfg", "program", "after", "the", "kernel", "is", "loaded", ".", "#", "#", "#", "*", "**", "PnP", "mode", "#", "#", "Use", "pnpdump", "to", "obtain", "a", "sample", "configuration", "if", "you", "can", ";", "I", "was", "able", "#", "to", "obtain", "one", "with", "the", "command", "`", "pnpdump", "1", "0x203", "'", "-", "-", "this", "may", "vary", "#", "for", "you", "(", "running", "pnpdump", "by", "itself", "did", "not", "work", "for", "me", ")", ".", "Then", ",", "#", "edit", "this", "file", "and", "use", "isapnp", "to", "uncomment", "and", "set", "the", "card", "values", ".", "#", "Use", "these", "values", "when", "inserting", "the", "msnd_pinnacle", "module", ".", "Using", "#", "this", "method", ",", "you", "can", "set", "the", "resources", "for", "the", "DSP", "and", "the", "Kurzweil", "#", "synth", "(", "Pinnacle", ")", ".", "Since", "Linux", "does", "not", "directly", "support", "PnP", "#", "devices", ",", "you", "may", "have", "difficulty", "when", "using", "the", "card", "in", "PnP", "mode", "#", "when", "it", "the", "driver", "is", "compiled", "into", "the", "kernel", ".", "Using", "non", "-", "PnP", "mode", "#", "is", "preferable", "in", "this", "case", ".", "#", "#", "Here", "is", "an", "example", "mypinnacle", ".", "conf", "for", "isapnp", "that", "sets", "the", "card", "to", "#", "io", "base", "0x210", ",", "irq", "5", "and", "mem", "0xd8000", ",", "and", "also", "sets", "the", "Kurzweil", "#", "synth", "to", "0x330", "and", "irq", "9", "(", "may", "need", "editing", "for", "your", "system", ")", ":", "#", "#", "(", "READPORT", "0x0203", ")", "#", "(", "CSN", "2", ")", "#", "(", "IDENTIFY", "*", ")", "#", "#", "#", "DSP", "#", "(", "CONFIGURE", "BVJ0440", "/", "-", "1", "(", "LD", "0", "#", "(", "INT", "0", "(", "IRQ", "5", "(", "MODE", "+", "E", ")", "))", "(", "IO", "0", "(", "BASE", "0x0210", ")", ")", "(", "MEM", "0", "(", "BASE", "0x0d8000", ")", ")", "#", "(", "ACT", "Y", ")", "))", "#", "#", "#", "Kurzweil", "Synth", "(", "Pinnacle", "Only", ")", "#", "(", "CONFIGURE", "BVJ0440", "/", "-", "1", "(", "LD", "1", "#", "(", "IO", "0", "(", "BASE", "0x0330", ")", ")", "(", "INT", "0", "(", "IRQ", "9", "(", "MODE", "+", "E", ")", "))", "#", "(", "ACT", "Y", ")", "))", "#", "#", "(", "WAITFORKEY", ")", "#", "#", "#", "*", "**", "Non", "-", "PnP", "mode", "#", "#", "The", "second", "way", "is", "by", "running", "the", "card", "in", "non", "-", "PnP", "mode", ".", "This", "#", "actually", "has", "some", "advantages", "in", "that", "you", "can", "access", "some", "other", "#", "devices", "on", "the", "card", ",", "such", "as", "the", "joystick", "and", "IDE", "controller", ".", "To", "#", "configure", "the", "card", ",", "unpack", "this", "shell", "archive", "and", "build", "the", "#", "pinnaclecfg", "program", ".", "Using", "this", "program", ",", "you", "can", "assign", "the", "#", "resource", "values", "to", "the", "card", "'", "s", "devices", ",", "or", "disable", "the", "devices", ".", "As", "#", "an", "alternative", "to", "using", "pinnaclecfg", ",", "you", "can", "specify", "many", "of", "the", "#", "configuration", "values", "when", "loading", "the", "msnd_pinnacle", "module", "(", "or", "#", "during", "kernel", "configuration", "when", "compiling", "the", "driver", "into", "the", "#", "kernel", ")", ".", "#", "#", "If", "you", "specify", "cfg", "=", "0x250", "for", "the", "msnd_pinnacle", "module", ",", "it", "#", "automatically", "configure", "the", "card", "to", "the", "given", "io", ",", "irq", "and", "memory", "#", "values", "using", "that", "config", "port", "(", "the", "config", "port", "is", "jumper", "selectable", "#", "on", "the", "card", "to", "0x250", ",", "0x260", "or", "0x270", ")", ".", "#", "#", "See", "the", "`", "msnd_pinnacle", "Additional", "Options", "'", "section", "below", "for", "more", "#", "information", "on", "these", "parameters", "(", "also", ",", "if", "you", "compile", "the", "driver", "#", "directly", "into", "the", "kernel", ",", "these", "extra", "parameters", "can", "be", "useful", "#", "here", ")", ".", "#", "#", "#", "*", "*", "It", "is", "very", "easy", "to", "cause", "problems", "in", "your", "machine", "if", "you", "choose", "a", "#", "resource", "value", "which", "is", "incorrect", ".", "*", "*", "#", "#", "#", "Examples", "#", "~", "~~", "~~", "~~", "~", "#", "#", "*", "MultiSound", "Classic", "/", "Monterey", "/", "Tahiti", ":", "#", "#", "modprobe", "soundcore", "#", "insmod", "msnd", "#", "insmod", "msnd_classic", "io", "=", "0x290", "irq", "=", "7", "mem", "=", "0xd0000", "#", "#", "*", "MultiSound", "Pinnacle", "in", "PnP", "mode", ":", "#", "#", "modprobe", "soundcore", "#", "insmod", "msnd", "#", "isapnp", "mypinnacle", ".", "conf", "#", "insmod", "msnd_pinnacle", "io", "=", "0x210", "irq", "=", "5", "mem", "=", "0xd8000", "<", "--", "match", "mypinnacle", ".", "conf", "values", "#", "#", "*", "MultiSound", "Pinnacle", "in", "non", "-", "PnP", "mode", "(", "replace", "0x250", "with", "your", "configuration", "port", ",", "#", "one", "of", "0x250", ",", "0x260", "or", "0x270", ")", ":", "#", "#", "insmod", "soundcore", "#", "insmod", "msnd", "#", "insmod", "msnd_pinnacle", "cfg", "=", "0x250", "io", "=", "0x290", "irq", "=", "5", "mem", "=", "0xd0000", "#", "#", "*", "To", "use", "the", "MPU", "-", "compatible", "Kurzweil", "synth", "on", "the", "Pinnacle", "in", "PnP", "#", "mode", ",", "add", "the", "following", "(", "assumes", "you", "did", "`", "isapnp", "mypinnacle", ".", "conf", "'", "):", "#", "#", "insmod", "sound", "#", "insmod", "mpu401", "io", "=", "0x330", "irq", "=", "9", "<", "--", "match", "mypinnacle", ".", "conf", "values", "#", "#", "*", "To", "use", "the", "MPU", "-", "compatible", "Kurzweil", "synth", "on", "the", "Pinnacle", "in", "non", "-", "PnP", "#", "mode", ",", "add", "the", "following", ".", "Note", "how", "we", "first", "configure", "the", "peripheral", "'", "s", "#", "resources", ",", "_then_", "install", "a", "Linux", "driver", "for", "it", ":", "#", "#", "insmod", "sound", "#", "pinnaclecfg", "0x250", "mpu", "0x330", "9", "#", "insmod", "mpu401", "io", "=", "0x330", "irq", "=", "9", "#", "#", "-", "-", "OR", "you", "can", "use", "the", "following", "sequence", "without", "pinnaclecfg", "in", "non", "-", "PnP", "mode", ":", "#", "#", "insmod", "soundcore", "#", "insmod", "msnd", "#", "insmod", "msnd_pinnacle", "cfg", "=", "0x250", "io", "=", "0x290", "irq", "=", "5", "mem", "=", "0xd0000", "mpu_io", "=", "0x330", "mpu_irq", "=", "9", "#", "insmod", "sound", "#", "insmod", "mpu401", "io", "=", "0x330", "irq", "=", "9", "#", "#", "*", "To", "setup", "the", "joystick", "port", "on", "the", "Pinnacle", "in", "non", "-", "PnP", "mode", "(", "though", "#", "you", "have", "to", "find", "the", "actual", "Linux", "joystick", "driver", "elsewhere", ")", ",", "you", "#", "can", "use", "pinnaclecfg", ":", "#", "#", "pinnaclecfg", "0x250", "joystick", "0x200", "#", "#", "-", "-", "OR", "you", "can", "configure", "this", "using", "msnd_pinnacle", "with", "the", "following", ":", "#", "#", "insmod", "soundcore", "#", "insmod", "msnd", "#", "insmod", "msnd_pinnacle", "cfg", "=", "0x250", "io", "=", "0x290", "irq", "=", "5", "mem", "=", "0xd0000", "joystick_io", "=", "0x200", "#", "#", "#", "msnd_classic", ",", "msnd_pinnacle", "Required", "Options", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~", "#", "#", "If", "the", "following", "options", "are", "not", "given", ",", "the", "module", "will", "not", "load", ".", "#", "Examine", "the", "kernel", "message", "log", "for", "informative", "error", "messages", ".", "#", "WARNING", "-", "-", "probing", "isn", "'", "t", "supported", "so", "try", "to", "make", "sure", "you", "have", "the", "#", "correct", "shared", "memory", "area", ",", "otherwise", "you", "may", "experience", "problems", ".", "#", "#", "io", "I", "/", "O", "base", "of", "DSP", ",", "e", ".", "g", ".", "io", "=", "0x210", "#", "irq", "IRQ", "number", ",", "e", ".", "g", ".", "irq", "=", "5", "#", "mem", "Shared", "memory", "area", ",", "e", ".", "g", ".", "mem", "=", "0xd8000", "#", "#", "#", "msnd_classic", ",", "msnd_pinnacle", "Additional", "Options", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~", "#", "#", "fifosize", "The", "digital", "audio", "FIFOs", ",", "in", "kilobytes", ".", "If", "not", "#", "specified", ",", "the", "default", "will", "be", "used", ".", "Increasing", "#", "this", "value", "will", "reduce", "the", "chance", "of", "a", "FIFO", "#", "underflow", "at", "the", "expense", "of", "increasing", "overall", "#", "latency", ".", "For", "example", ",", "fifosize", "=", "512", "will", "#", "allocate", "512kB", "read", "and", "write", "FIFOs", "(", "1MB", "total", ")", ".", "#", "While", "this", "may", "reduce", "dropouts", ",", "a", "heavy", "machine", "#", "load", "will", "undoubtedly", "starve", "the", "FIFO", "of", "data", "#", "and", "you", "will", "eventually", "get", "dropouts", ".", "One", "#", "option", "is", "to", "alter", "the", "scheduling", "priority", "of", "#", "the", "playback", "process", ",", "using", "`", "nice", "'", "or", "some", "form", "#", "of", "POSIX", "soft", "real", "-", "time", "scheduling", ".", "#", "#", "calibrate_signal", "Setting", "this", "to", "one", "calibrates", "the", "ADCs", "to", "the", "#", "signal", ",", "zero", "calibrates", "to", "the", "card", "(", "defaults", "#", "to", "zero", ")", ".", "#", "#", "#", "msnd_pinnacle", "Additional", "Options", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~", "#", "#", "digital", "Specify", "digital", "=", "1", "to", "enable", "the", "S", "/", "PDIF", "input", "#", "if", "you", "have", "the", "digital", "daughterboard", "#", "adapter", ".", "This", "will", "enable", "access", "to", "the", "#", "DIGITAL1", "input", "for", "the", "soundcard", "in", "the", "mixer", ".", "#", "Some", "mixer", "programs", "might", "have", "trouble", "setting", "#", "the", "DIGITAL1", "source", "as", "an", "input", ".", "If", "you", "have", "#", "trouble", ",", "you", "can", "try", "the", "setdigital", ".", "c", "program", "#", "at", "the", "bottom", "of", "this", "document", ".", "#", "#", "cfg", "Non", "-", "PnP", "configuration", "port", "for", "the", "Pinnacle", "#", "and", "Fiji", "(", "typically", "0x250", ",", "0x260", "or", "0x270", ",", "#", "depending", "on", "the", "jumper", "configuration", ")", ".", "If", "#", "this", "option", "is", "omitted", ",", "then", "it", "is", "assumed", "#", "that", "the", "card", "is", "in", "PnP", "mode", ",", "and", "that", "the", "#", "specified", "DSP", "resource", "values", "are", "already", "#", "configured", "with", "PnP", "(", "i", ".", "e", ".", "it", "won", "'", "t", "attempt", "to", "#", "do", "any", "sort", "of", "configuration", ")", ".", "#", "#", "When", "the", "Pinnacle", "is", "in", "non", "-", "PnP", "mode", ",", "you", "can", "use", "the", "following", "#", "options", "to", "configure", "particular", "devices", ".", "If", "a", "full", "specification", "#", "for", "a", "device", "is", "not", "given", ",", "then", "the", "device", "is", "not", "configured", ".", "Note", "#", "that", "you", "still", "must", "use", "a", "Linux", "driver", "for", "any", "of", "these", "devices", "#", "once", "their", "resources", "are", "setup", "(", "such", "as", "the", "Linux", "joystick", "driver", ",", "#", "or", "the", "MPU401", "driver", "from", "OSS", "for", "the", "Kurzweil", "synth", ")", ".", "#", "#", "mpu_io", "I", "/", "O", "port", "of", "MPU", "(", "on", "-", "board", "Kurzweil", "synth", ")", "#", "mpu_irq", "IRQ", "of", "MPU", "(", "on", "-", "board", "Kurzweil", "synth", ")", "#", "ide_io0", "First", "I", "/", "O", "port", "of", "IDE", "controller", "#", "ide_io1", "Second", "I", "/", "O", "port", "of", "IDE", "controller", "#", "ide_irq", "IRQ", "IDE", "controller", "#", "joystick_io", "I", "/", "O", "port", "of", "joystick", "#", "#", "#", "Obtaining", "and", "Creating", "Firmware", "Files", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "#", "#", "For", "the", "Classic", "/", "Tahiti", "/", "Monterey", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "#", "#", "Download", "to", "/", "tmp", "and", "unzip", "the", "following", "file", "from", "Turtle", "Beach", ":", "#", "#", "ftp", ":", "//", "ftp", ".", "voyetra", ".", "com", "/", "pub", "/", "tbs", "/", "msndcl", "/", "msndvkit", ".", "zip", "#", "#", "When", "unzipped", ",", "unzip", "the", "file", "named", "MsndFiles", ".", "zip", ".", "Then", "copy", "the", "#", "following", "firmware", "files", "to", "/", "etc", "/", "sound", "(", "note", "the", "file", "renaming", ")", ":", "#", "#", "cp", "DSPCODE", "/", "MSNDINIT", ".", "BIN", "/", "etc", "/", "sound", "/", "msndinit", ".", "bin", "#", "cp", "DSPCODE", "/", "MSNDPERM", ".", "REB", "/", "etc", "/", "sound", "/", "msndperm", ".", "bin", "#", "#", "When", "configuring", "the", "Linux", "kernel", ",", "specify", "/", "etc", "/", "sound", "/", "msndinit", ".", "bin", "and", "#", "/", "etc", "/", "sound", "/", "msndperm", ".", "bin", "for", "the", "two", "firmware", "files", "(", "Linux", "kernel", "#", "versions", "older", "than", "2", ".", "2", "do", "not", "ask", "for", "firmware", "paths", ",", "and", "are", "#", "hardcoded", "to", "/", "etc", "/", "sound", ")", ".", "#", "#", "If", "you", "are", "compiling", "the", "driver", "into", "the", "kernel", ",", "these", "files", "must", "#", "be", "accessible", "during", "compilation", ",", "but", "will", "not", "be", "needed", "later", ".", "#", "The", "files", "must", "remain", ",", "however", ",", "if", "the", "driver", "is", "used", "as", "a", "module", ".", "#", "#", "#", "For", "the", "Pinnacle", "/", "Fiji", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "#", "#", "Download", "to", "/", "tmp", "and", "unzip", "the", "following", "file", "from", "Turtle", "Beach", "(", "be", "#", "sure", "to", "use", "the", "entire", "URL", ";", "some", "have", "had", "trouble", "navigating", "to", "the", "#", "URL", ")", ":", "#", "#", "ftp", ":", "//", "ftp", ".", "voyetra", ".", "com", "/", "pub", "/", "tbs", "/", "pinn", "/", "pnddk100", ".", "zip", "#", "#", "Unpack", "this", "shell", "archive", ",", "and", "run", "make", "in", "the", "created", "directory", "#", "(", "you", "need", "a", "C", "compiler", "and", "flex", "to", "build", "the", "utilities", ")", ".", "This", "#", "should", "give", "you", "the", "executables", "conv", ",", "pinnaclecfg", "and", "setdigital", ".", "#", "conv", "is", "only", "used", "temporarily", "here", "to", "create", "the", "firmware", "files", ",", "#", "while", "pinnaclecfg", "is", "used", "to", "configure", "the", "Pinnacle", "or", "Fiji", "card", "in", "#", "non", "-", "PnP", "mode", ",", "and", "setdigital", "can", "be", "used", "to", "set", "the", "S", "/", "PDIF", "input", "on", "#", "the", "mixer", "(", "pinnaclecfg", "and", "setdigital", "should", "be", "copied", "to", "a", "#", "convenient", "place", ",", "possibly", "run", "during", "system", "initialization", ")", ".", "#", "#", "To", "generating", "the", "firmware", "files", "with", "the", "`", "conv", "'", "program", ",", "we", "create", "#", "the", "binary", "firmware", "files", "by", "doing", "the", "following", "conversion", "#", "(", "assuming", "the", "archive", "unpacked", "into", "a", "directory", "named", "PINNDDK", ")", ":", "#", "#", ".", "/", "conv", "<", "PINNDDK", "/", "dspcode", "/", "pndspini", ".", "asm", ">", "/", "etc", "/", "sound", "/", "pndspini", ".", "bin", "#", ".", "/", "conv", "<", "PINNDDK", "/", "dspcode", "/", "pndsperm", ".", "asm", ">", "/", "etc", "/", "sound", "/", "pndsperm", ".", "bin", "#", "#", "The", "conv", "(", "and", "conv", ".", "l", ")", "program", "is", "not", "needed", "after", "conversion", "and", "can", "#", "be", "safely", "deleted", ".", "Then", ",", "when", "configuring", "the", "Linux", "kernel", ",", "specify", "#", "/", "etc", "/", "sound", "/", "pndspini", ".", "bin", "and", "/", "etc", "/", "sound", "/", "pndsperm", ".", "bin", "for", "the", "two", "#", "firmware", "files", "(", "Linux", "kernel", "versions", "older", "than", "2", ".", "2", "do", "not", "ask", "for", "#", "firmware", "paths", ",", "and", "are", "hardcoded", "to", "/", "etc", "/", "sound", ")", ".", "#", "#", "If", "you", "are", "compiling", "the", "driver", "into", "the", "kernel", ",", "these", "files", "must", "#", "be", "accessible", "during", "compilation", ",", "but", "will", "not", "be", "needed", "later", ".", "#", "The", "files", "must", "remain", ",", "however", ",", "if", "the", "driver", "is", "used", "as", "a", "module", ".", "#", "#", "#", "Using", "Digital", "I", "/", "O", "with", "the", "S", "/", "PDIF", "Port", "#", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~", "#", "#", "If", "you", "have", "a", "Pinnacle", "or", "Fiji", "with", "the", "digital", "daughterboard", "and", "#", "want", "to", "set", "it", "as", "the", "input", "source", ",", "you", "can", "use", "this", "program", "if", "you", "#", "have", "trouble", "trying", "to", "do", "it", "with", "a", "mixer", "program", "(", "be", "sure", "to", "#", "insert", "the", "module", "with", "the", "digital", "=", "1", "option", ",", "or", "say", "Y", "to", "the", "option", "#", "during", "compiled", "-", "in", "kernel", "operation", ")", ".", "Upon", "selection", "of", "the", "S", "/", "PDIF", "#", "port", ",", "you", "should", "be", "able", "monitor", "and", "record", "from", "it", ".", "#", "#", "There", "is", "something", "to", "note", "about", "using", "the", "S", "/", "PDIF", "port", ".", "Digital", "#", "timing", "is", "taken", "from", "the", "digital", "signal", ",", "so", "if", "a", "signal", "is", "not", "#", "connected", "to", "the", "port", "and", "it", "is", "selected", "as", "recording", "input", ",", "you", "#", "will", "find", "PCM", "playback", "to", "be", "distorted", "in", "playback", "rate", ".", "Also", ",", "#", "attempting", "to", "record", "at", "a", "sampling", "rate", "other", "than", "the", "DAT", "rate", "may", "#", "be", "problematic", "(", "i", ".", "e", ".", "trying", "to", "record", "at", "8000Hz", "when", "the", "DAT", "signal", "#", "is", "44100Hz", ")", ".", "If", "you", "have", "a", "problem", "with", "this", ",", "set", "the", "recording", "#", "input", "to", "analog", "if", "you", "need", "to", "record", "at", "a", "rate", "other", "than", "that", "of", "#", "the", "DAT", "rate", ".", "#", "#", "#", "-", "-", "Shell", "archive", "attached", "below", ",", "just", "run", "`", "sh", "MultiSound", "'", "to", "extract", ".", "#", "Contains", "Pinnacle", "/", "Fiji", "utilities", "to", "convert", "firmware", ",", "configure", "#", "in", "non", "-", "PnP", "mode", ",", "and", "select", "the", "DIGITAL1", "input", "for", "the", "mixer", ".", "#", "#", "#", "!/", "bin", "/", "sh", "#", "This", "is", "a", "shell", "archive", "(", "produced", "by", "GNU", "sharutils", "4", ".", "2", ")", ".", "#", "To", "extract", "the", "files", "from", "this", "archive", ",", "save", "it", "to", "some", "FILE", ",", "remove", "#", "everything", "before", "the", "`", "!/", "bin", "/", "sh", "'", "line", "above", ",", "then", "type", "`", "sh", "FILE", "'", ".", "#", "#", "Made", "on", "1998", "-", "12", "-", "04", "10", ":", "07", "EST", "by", "<", "andrewtv", "@", "ztransform", ".", "velsoft", ".", "com", ">", ".", "#", "Source", "directory", "was", "`", "/", "home", "/", "andrewtv", "/", "programming", "/", "pinnacle", "/", "pinnacle", "'", ".", "#", "#", "Existing", "files", "will", "*", "not", "*", "be", "overwritten", "unless", "`", "-", "c", "'", "is", "specified", ".", "#", "#", "This", "shar", "contains", ":", "#", "length", "mode", "name", "#", "-", "--", "--", "-", "-", "--", "--", "--", "--", "-", "#", "2046", "-", "rw", "-", "rw", "-", "r", "-", "-", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "#", "10235", "-", "rw", "-", "rw", "-", "r", "-", "-", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "#", "106", "-", "rw", "-", "rw", "-", "r", "-", "-", "MultiSound", ".", "d", "/", "Makefile", "#", "141", "-", "rw", "-", "rw", "-", "r", "-", "-", "MultiSound", ".", "d", "/", "conv", ".", "l", "#", "1472", "-", "rw", "-", "rw", "-", "r", "-", "-", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "#", "save_IFS", "=", "\"$", "{", "IFS", "}", "\"", "IFS", "=", "\"$", "{", "IFS", "}", ":\"", "gettext_dir", "=", "FAILED", "locale_dir", "=", "FAILED", "first_param", "=", "\"$", "1", "\"", "for", "dir", "in", "$", "PATH", "do", "if", "test", "\"", "$", "gettext_dir", "\"", "=", "FAILED", "&", "&", "test", "-", "f", "$", "dir", "/", "gettext", "\\", "&", "&", "(", "$", "dir", "/", "gettext", "-", "-", "version", ">", "/", "dev", "/", "null", "2", ">", "&", "1", ")", "then", "set", "`", "$", "dir", "/", "gettext", "-", "-", "version", "2", ">", "&", "1", "`", "if", "test", "\"", "$", "3", "\"", "=", "GNU", "then", "gettext_dir", "=", "$", "dir", "fi", "fi", "if", "test", "\"", "$", "locale_dir", "\"", "=", "FAILED", "&", "&", "test", "-", "f", "$", "dir", "/", "shar", "\\", "&", "&", "(", "$", "dir", "/", "shar", "-", "-", "print", "-", "text", "-", "domain", "-", "dir", ">", "/", "dev", "/", "null", "2", ">", "&", "1", ")", "then", "locale_dir", "=", "`$", "dir", "/", "shar", "-", "-", "print", "-", "text", "-", "domain", "-", "dir", "`", "fi", "done", "IFS", "=", "\"$", "save_IFS", "\"", "if", "test", "\"", "$", "locale_dir", "\"", "=", "FAILED", "|", "|", "test", "\"", "$", "gettext_dir", "\"", "=", "FAILED", "then", "echo", "=", "echo", "else", "TEXTDOMAINDIR", "=", "$", "locale_dir", "export", "TEXTDOMAINDIR", "TEXTDOMAIN", "=", "sharutils", "export", "TEXTDOMAIN", "echo", "=", "\"$", "gettext_dir", "/", "gettext", "-", "s", "\"", "fi", "touch", "-", "am", "1231235999", "$", "$.", "touch", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "if", "test", "!", "-", "f", "1231235999", "&", "&", "test", "-", "f", "$", "$.", "touch", ";", "then", "shar_touch", "=", "touch", "else", "shar_touch", "=", ":", "echo", "$", "echo", "'", "WARNING", ":", "not", "restoring", "timestamps", ".", "Consider", "getting", "and", "'", "$", "echo", "\"", "installing", "GNU", "\\", "`", "touch", "'", ",", "distributed", "in", "GNU", "File", "Utilities", ".", "..", "\"", "echo", "fi", "rm", "-", "f", "1231235999", "$", "$.", "touch", "#", "if", "mkdir", "_sh01426", ";", "then", "$", "echo", "'", "x", "-", "'", "'", "creating", "lock", "directory", "'", "else", "$", "echo", "'", "failed", "to", "create", "lock", "directory", "'", "exit", "1", "fi", "#", "=", "==", "==", "==", "==", "==", "==", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "=", "==", "==", "==", "==", "==", "==", "=", "if", "test", "!", "-", "d", "'", "MultiSound", ".", "d", "'", ";", "then", "$", "echo", "'", "x", "-", "'", "'", "creating", "directory", "'", "'", "MultiSound", ".", "d", "'", "mkdir", "'", "MultiSound", ".", "d", "'", "fi", "if", "test", "-", "f", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "'", "&", "&", "test", "\"", "$", "first_param", "\"", "!", "=", "-", "c", ";", "then", "$", "echo", "'", "x", "-", "'", "SKIPPING", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "'", "'", "(", "file", "already", "exists", ")", "'", "else", "$", "echo", "'", "x", "-", "'", "extracting", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "'", "'", "(", "text", ")", "'", "sed", "'", "s", "/", "^", "X", "/", "/'", "<", "<", "'", "SHAR_EOF", "'", ">", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "'", "&", "&", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "X", "*", "X", "*", "setdigital", ".", "c", "-", "sets", "the", "DIGITAL1", "input", "for", "a", "mixer", "X", "*", "X", "*", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "X", "*", "X", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "X", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "X", "*", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "X", "*", "(", "at", "your", "option", ")", "any", "later", "version", ".", "X", "*", "X", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "X", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "X", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "X", "*", "GNU", "General", "Public", "License", "for", "more", "details", ".", "X", "*", "X", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "X", "*", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "X", "*", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "X", "*", "X", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "X", "#", "include", "<", "stdio", ".", "h", ">", "#", "include", "<", "unistd", ".", "h", ">", "#", "include", "<", "fcntl", ".", "h", ">", "#", "include", "<", "sys", "/", "types", ".", "h", ">", "#", "include", "<", "sys", "/", "stat", ".", "h", ">", "#", "include", "<", "sys", "/", "ioctl", ".", "h", ">", "#", "include", "<", "sys", "/", "soundcard", ".", "h", ">", "X", "int", "main", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "X", "int", "fd", ";", "X", "unsigned", "long", "recmask", ",", "recsrc", ";", "X", "X", "if", "(", "argc", "!", "=", "2", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "usage", ":", "setdigital", "<", "mixer", "device", ">", "\\", "n", "\"", ");", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "if", "(", "(", "fd", "=", "open", "(", "argv", "[", "1", "]", ",", "O_RDWR", ")", ")", "<", "0", ")", "{", "X", "perror", "(", "argv", "[", "1", "]", ");", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "if", "(", "ioctl", "(", "fd", ",", "SOUND_MIXER_READ_RECMASK", ",", "&", "recmask", ")", "<", "0", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "ioctl", "read", "recording", "mask", "failed", "\\", "n", "\"", ");", "X", "perror", "(", "\"", "ioctl", "\"", ");", "X", "close", "(", "fd", ")", ";", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "if", "(", "!(", "recmask", "&", "SOUND_MASK_DIGITAL1", ")", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "cannot", "find", "DIGITAL1", "device", "in", "mixer", "\\", "n", "\"", ");", "X", "close", "(", "fd", ")", ";", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "if", "(", "ioctl", "(", "fd", ",", "SOUND_MIXER_READ_RECSRC", ",", "&", "recsrc", ")", "<", "0", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "ioctl", "read", "recording", "source", "failed", "\\", "n", "\"", ");", "X", "perror", "(", "\"", "ioctl", "\"", ");", "X", "close", "(", "fd", ")", ";", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "recsrc", "|", "=", "SOUND_MASK_DIGITAL1", ";", "X", "X", "if", "(", "ioctl", "(", "fd", ",", "SOUND_MIXER_WRITE_RECSRC", ",", "&", "recsrc", ")", "<", "0", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "ioctl", "write", "recording", "source", "failed", "\\", "n", "\"", ");", "X", "perror", "(", "\"", "ioctl", "\"", ");", "X", "close", "(", "fd", ")", ";", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "close", "(", "fd", ")", ";", "X", "X", "return", "0", ";", "}", "SHAR_EOF", "$", "shar_touch", "-", "am", "1204092598", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "'", "&", "&", "chmod", "0664", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "'", "|", "|", "$", "echo", "'", "restore", "of", "'", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "'", "'", "failed", "'", "if", "(", "md5sum", "-", "-", "help", "2", ">", "&", "1", "|", "grep", "'", "sage", ":", "md5sum", "\\", "['", ")", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "&", "&", "(", "md5sum", "-", "-", "version", "2", ">", "&", "1", "|", "grep", "-", "v", "'", "textutils", "1", ".", "12", "'", ")", ">", "/", "dev", "/", "null", ";", "then", "md5sum", "-", "c", "<", "<", "SHAR_EOF", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", ":", "'", "'", "MD5", "check", "failed", "'", "e87217fc3e71288102ba41fd81f71ec4", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "SHAR_EOF", "else", "shar_count", "=", "\"`", "LC_ALL", "=", "LC_CTYPE", "=", "LANG", "=", "wc", "-", "c", "<", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", "'", "`\"", "test", "2046", "-", "eq", "\"", "$", "shar_count", "\"", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "setdigital", ".", "c", ":", "'", "'", "original", "size", "'", "'", "2046", ",", "'", "'", "current", "size", "'", "\"", "$", "shar_count", "!", "\"", "fi", "fi", "#", "=", "==", "==", "==", "==", "==", "==", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "=", "==", "==", "==", "==", "==", "==", "=", "if", "test", "-", "f", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "'", "&", "&", "test", "\"", "$", "first_param", "\"", "!", "=", "-", "c", ";", "then", "$", "echo", "'", "x", "-", "'", "SKIPPING", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "'", "'", "(", "file", "already", "exists", ")", "'", "else", "$", "echo", "'", "x", "-", "'", "extracting", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "'", "'", "(", "text", ")", "'", "sed", "'", "s", "/", "^", "X", "/", "/'", "<", "<", "'", "SHAR_EOF", "'", ">", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "'", "&", "&", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "X", "*", "X", "*", "pinnaclecfg", ".", "c", "-", "Pinnacle", "/", "Fiji", "Device", "Configuration", "Program", "X", "*", "X", "*", "This", "is", "for", "NON", "-", "PnP", "mode", "only", ".", "For", "PnP", "mode", ",", "use", "isapnptools", ".", "X", "*", "X", "*", "This", "is", "Linux", "-", "specific", ",", "and", "must", "be", "run", "with", "root", "permissions", ".", "X", "*", "X", "*", "Part", "of", "the", "Turtle", "Beach", "MultiSound", "Sound", "Card", "Driver", "for", "Linux", "X", "*", "X", "*", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "X", "*", "X", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "X", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "X", "*", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "X", "*", "(", "at", "your", "option", ")", "any", "later", "version", ".", "X", "*", "X", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "X", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "X", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "X", "*", "GNU", "General", "Public", "License", "for", "more", "details", ".", "X", "*", "X", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "X", "*", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "X", "*", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "X", "*", "X", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "X", "#", "include", "<", "stdio", ".", "h", ">", "#", "include", "<", "stdlib", ".", "h", ">", "#", "include", "<", "string", ".", "h", ">", "#", "include", "<", "errno", ".", "h", ">", "#", "include", "<", "unistd", ".", "h", ">", "#", "include", "<", "asm", "/", "io", ".", "h", ">", "#", "include", "<", "asm", "/", "types", ".", "h", ">", "X", "#", "define", "IREG_LOGDEVICE", "0x07", "#", "define", "IREG_ACTIVATE", "0x30", "#", "define", "LD_ACTIVATE", "0x01", "#", "define", "LD_DISACTIVATE", "0x00", "#", "define", "IREG_EECONTROL", "0x3F", "#", "define", "IREG_MEMBASEHI", "0x40", "#", "define", "IREG_MEMBASELO", "0x41", "#", "define", "IREG_MEMCONTROL", "0x42", "#", "define", "IREG_MEMRANGEHI", "0x43", "#", "define", "IREG_MEMRANGELO", "0x44", "#", "define", "MEMTYPE_8BIT", "0x00", "#", "define", "MEMTYPE_16BIT", "0x02", "#", "define", "MEMTYPE_RANGE", "0x00", "#", "define", "MEMTYPE_HIADDR", "0x01", "#", "define", "IREG_IO0_BASEHI", "0x60", "#", "define", "IREG_IO0_BASELO", "0x61", "#", "define", "IREG_IO1_BASEHI", "0x62", "#", "define", "IREG_IO1_BASELO", "0x63", "#", "define", "IREG_IRQ_NUMBER", "0x70", "#", "define", "IREG_IRQ_TYPE", "0x71", "#", "define", "IRQTYPE_HIGH", "0x02", "#", "define", "IRQTYPE_LOW", "0x00", "#", "define", "IRQTYPE_LEVEL", "0x01", "#", "define", "IRQTYPE_EDGE", "0x00", "X", "#", "define", "HIBYTE", "(", "w", ")", "(", "(", "BYTE", ")", "((", "(", "WORD", ")", "(", "w", ")", ">", ">", "8", ")", "&", "0xFF", ")", ")", "#", "define", "LOBYTE", "(", "w", ")", "(", "(", "BYTE", ")", "(", "w", ")", ")", "#", "define", "MAKEWORD", "(", "low", ",", "hi", ")", "(", "(", "WORD", ")", "((", "(", "BYTE", ")", "(", "low", ")", ")|", "((", "(", "WORD", ")", "((", "BYTE", ")", "(", "hi", ")", "))", "<<", "8", ")", "))", "X", "typedef", "__u8", "BYTE", ";", "typedef", "__u16", "USHORT", ";", "typedef", "__u16", "WORD", ";", "X", "static", "int", "config_port", "=", "-", "1", ";", "X", "static", "int", "msnd_write_cfg", "(", "int", "cfg", ",", "int", "reg", ",", "int", "value", ")", "{", "X", "outb", "(", "reg", ",", "cfg", ")", ";", "X", "outb", "(", "value", ",", "cfg", "+", "1", ")", ";", "X", "if", "(", "value", "!", "=", "inb", "(", "cfg", "+", "1", ")", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "msnd_write_cfg", ":", "I", "/", "O", "error", "\\", "n", "\"", ");", "X", "return", "-", "EIO", ";", "X", "}", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_read_cfg", "(", "int", "cfg", ",", "int", "reg", ")", "{", "X", "outb", "(", "reg", ",", "cfg", ")", ";", "X", "return", "inb", "(", "cfg", "+", "1", ")", ";", "}", "X", "static", "int", "msnd_write_cfg_io0", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "io", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IO0_BASEHI", ",", "HIBYTE", "(", "io", ")", "))", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IO0_BASELO", ",", "LOBYTE", "(", "io", ")", "))", "X", "return", "-", "EIO", ";", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_read_cfg_io0", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "*", "io", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "X", "*", "io", "=", "MAKEWORD", "(", "msnd_read_cfg", "(", "cfg", ",", "IREG_IO0_BASELO", ")", ",", "X", "msnd_read_cfg", "(", "cfg", ",", "IREG_IO0_BASEHI", ")", ");", "X", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_write_cfg_io1", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "io", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IO1_BASEHI", ",", "HIBYTE", "(", "io", ")", "))", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IO1_BASELO", ",", "LOBYTE", "(", "io", ")", "))", "X", "return", "-", "EIO", ";", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_read_cfg_io1", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "*", "io", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "X", "*", "io", "=", "MAKEWORD", "(", "msnd_read_cfg", "(", "cfg", ",", "IREG_IO1_BASELO", ")", ",", "X", "msnd_read_cfg", "(", "cfg", ",", "IREG_IO1_BASEHI", ")", ");", "X", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_write_cfg_irq", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "irq", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IRQ_NUMBER", ",", "LOBYTE", "(", "irq", ")", "))", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IRQ_TYPE", ",", "IRQTYPE_EDGE", ")", ")", "X", "return", "-", "EIO", ";", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_read_cfg_irq", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "*", "irq", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "X", "*", "irq", "=", "msnd_read_cfg", "(", "cfg", ",", "IREG_IRQ_NUMBER", ")", ";", "X", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_write_cfg_mem", "(", "int", "cfg", ",", "int", "num", ",", "int", "mem", ")", "{", "X", "WORD", "wmem", ";", "X", "X", "mem", ">", ">=", "8", ";", "X", "mem", "&", "=", "0xfff", ";", "X", "wmem", "=", "(", "WORD", ")", "mem", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_MEMBASEHI", ",", "HIBYTE", "(", "wmem", ")", "))", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_MEMBASELO", ",", "LOBYTE", "(", "wmem", ")", "))", "X", "return", "-", "EIO", ";", "X", "if", "(", "wmem", "&", "&", "msnd_write_cfg", "(", "cfg", ",", "IREG_MEMCONTROL", ",", "(", "MEMTYPE_HIADDR", "|", "MEMTYPE_16BIT", ")", "))", "X", "return", "-", "EIO", ";", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_read_cfg_mem", "(", "int", "cfg", ",", "int", "num", ",", "int", "*", "mem", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "X", "*", "mem", "=", "MAKEWORD", "(", "msnd_read_cfg", "(", "cfg", ",", "IREG_MEMBASELO", ")", ",", "X", "msnd_read_cfg", "(", "cfg", ",", "IREG_MEMBASEHI", ")", ");", "X", "*", "mem", "<", "<=", "8", ";", "X", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_activate_logical", "(", "int", "cfg", ",", "int", "num", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_ACTIVATE", ",", "LD_ACTIVATE", ")", ")", "X", "return", "-", "EIO", ";", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_write_cfg_logical", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "io0", ",", "WORD", "io1", ",", "WORD", "irq", ",", "int", "mem", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg_io0", "(", "cfg", ",", "num", ",", "io0", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg_io1", "(", "cfg", ",", "num", ",", "io1", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg_irq", "(", "cfg", ",", "num", ",", "irq", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_write_cfg_mem", "(", "cfg", ",", "num", ",", "mem", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_activate_logical", "(", "cfg", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "return", "0", ";", "}", "X", "static", "int", "msnd_read_cfg_logical", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "*", "io0", ",", "WORD", "*", "io1", ",", "WORD", "*", "irq", ",", "int", "*", "mem", ")", "{", "X", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_read_cfg_io0", "(", "cfg", ",", "num", ",", "io0", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_read_cfg_io1", "(", "cfg", ",", "num", ",", "io1", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_read_cfg_irq", "(", "cfg", ",", "num", ",", "irq", ")", ")", "X", "return", "-", "EIO", ";", "X", "if", "(", "msnd_read_cfg_mem", "(", "cfg", ",", "num", ",", "mem", ")", ")", "X", "return", "-", "EIO", ";", "X", "return", "0", ";", "}", "X", "static", "void", "usage", "(", "void", ")", "{", "X", "fprintf", "(", "stderr", ",", "X", "\"", "\\", "n", "\"", "X", "\"", "pinnaclecfg", "1", ".", "0", "\\", "n", "\"", "X", "\"", "\\", "n", "\"", "X", "\"", "usage", ":", "pinnaclecfg", "<", "config", "port", ">", "[", "device", "config", "]", "\\", "n", "\"", "X", "\"", "\\", "n", "\"", "X", "\"", "This", "is", "for", "use", "with", "the", "card", "in", "NON", "-", "PnP", "mode", "only", ".", "\\", "n", "\"", "X", "\"", "\\", "n", "\"", "X", "\"", "Available", "devices", "(", "not", "all", "available", "for", "Fiji", ")", ":\\", "n", "\"", "X", "\"", "\\", "n", "\"", "X", "\"", "Device", "Description", "\\", "n", "\"", "X", "\"", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "\\", "n", "\"", "X", "\"", "reset", "Reset", "all", "devices", "(", "i", ".", "e", ".", "disable", ")", "\\", "n", "\"", "X", "\"", "show", "Display", "current", "device", "configurations", "\\", "n", "\"", "X", "\"", "\\", "n", "\"", "X", "\"", "dsp", "<", "io", ">", "<", "irq", ">", "<", "mem", ">", "Audio", "device", "\\", "n", "\"", "X", "\"", "mpu", "<", "io", ">", "<", "irq", ">", "Internal", "Kurzweil", "synth", "\\", "n", "\"", "X", "\"", "ide", "<", "io0", ">", "<", "io1", ">", "<", "irq", ">", "On", "-", "board", "IDE", "controller", "\\", "n", "\"", "X", "\"", "joystick", "<", "io", ">", "Joystick", "port", "\\", "n", "\"", "X", "\"", "\\", "n", "\"", ");", "X", "exit", "(", "1", ")", ";", "}", "X", "static", "int", "cfg_reset", "(", "void", ")", "{", "X", "int", "i", ";", "X", "X", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "+", "+", "i", ")", "X", "msnd_write_cfg_logical", "(", "config_port", ",", "i", ",", "0", ",", "0", ",", "0", ",", "0", ")", ";", "X", "X", "return", "0", ";", "}", "X", "static", "int", "cfg_show", "(", "void", ")", "{", "X", "int", "i", ";", "X", "int", "count", "=", "0", ";", "X", "X", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "+", "+", "i", ")", "{", "X", "WORD", "io0", ",", "io1", ",", "irq", ";", "X", "int", "mem", ";", "X", "msnd_read_cfg_logical", "(", "config_port", ",", "i", ",", "&", "io0", ",", "&", "io1", ",", "&", "irq", ",", "&", "mem", ")", ";", "X", "switch", "(", "i", ")", "{", "X", "case", "0", ":", "X", "if", "(", "io0", "|", "|", "irq", "|", "|", "mem", ")", "{", "X", "printf", "(", "\"", "dsp", "0x", "%", "x", "%", "d", "0x", "%", "x", "\\", "n", "\"", ",", "io0", ",", "irq", ",", "mem", ")", ";", "X", "+", "+", "count", ";", "X", "}", "X", "break", ";", "X", "case", "1", ":", "X", "if", "(", "io0", "|", "|", "irq", ")", "{", "X", "printf", "(", "\"", "mpu", "0x", "%", "x", "%", "d", "\\", "n", "\"", ",", "io0", ",", "irq", ")", ";", "X", "+", "+", "count", ";", "X", "}", "X", "break", ";", "X", "case", "2", ":", "X", "if", "(", "io0", "|", "|", "io1", "|", "|", "irq", ")", "{", "X", "printf", "(", "\"", "ide", "0x", "%", "x", "0x", "%", "x", "%", "d", "\\", "n", "\"", ",", "io0", ",", "io1", ",", "irq", ")", ";", "X", "+", "+", "count", ";", "X", "}", "X", "break", ";", "X", "case", "3", ":", "X", "if", "(", "io0", ")", "{", "X", "printf", "(", "\"", "joystick", "0x", "%", "x", "\\", "n", "\"", ",", "io0", ")", ";", "X", "+", "+", "count", ";", "X", "}", "X", "break", ";", "X", "}", "X", "}", "X", "X", "if", "(", "count", "=", "=", "0", ")", "X", "fprintf", "(", "stderr", ",", "\"", "no", "devices", "configured", "\\", "n", "\"", ");", "X", "X", "return", "0", ";", "}", "X", "static", "int", "cfg_dsp", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "X", "int", "io", ",", "irq", ",", "mem", ";", "X", "X", "if", "(", "argc", "<", "3", "|", "|", "X", "sscanf", "(", "argv", "[", "0", "]", ",", "\"", "0x", "%", "x", "\"", ",", "&", "io", ")", "!", "=", "1", "|", "|", "X", "sscanf", "(", "argv", "[", "1", "]", ",", "\"", "%", "d", "\"", ",", "&", "irq", ")", "!", "=", "1", "|", "|", "X", "sscanf", "(", "argv", "[", "2", "]", ",", "\"", "0x", "%", "x", "\"", ",", "&", "mem", ")", "!", "=", "1", ")", "X", "usage", "(", ");", "X", "X", "if", "(", "!(", "io", "=", "=", "0x290", "|", "|", "X", "io", "=", "=", "0x260", "|", "|", "X", "io", "=", "=", "0x250", "|", "|", "X", "io", "=", "=", "0x240", "|", "|", "X", "io", "=", "=", "0x230", "|", "|", "X", "io", "=", "=", "0x220", "|", "|", "X", "io", "=", "=", "0x210", "|", "|", "X", "io", "=", "=", "0x3e0", ")", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "io", "must", "be", "one", "of", "\"", "X", "\"", "210", ",", "220", ",", "230", ",", "240", ",", "250", ",", "260", ",", "290", ",", "or", "3E0", "\\", "n", "\"", ");", "X", "usage", "(", ");", "X", "}", "X", "X", "if", "(", "!(", "irq", "=", "=", "5", "|", "|", "X", "irq", "=", "=", "7", "|", "|", "X", "irq", "=", "=", "9", "|", "|", "X", "irq", "=", "=", "10", "|", "|", "X", "irq", "=", "=", "11", "|", "|", "X", "irq", "=", "=", "12", ")", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "irq", "must", "be", "one", "of", "\"", "X", "\"", "5", ",", "7", ",", "9", ",", "10", ",", "11", "or", "12", "\\", "n", "\"", ");", "X", "usage", "(", ");", "X", "}", "X", "X", "if", "(", "!(", "mem", "=", "=", "0xb0000", "|", "|", "X", "mem", "=", "=", "0xc8000", "|", "|", "X", "mem", "=", "=", "0xd0000", "|", "|", "X", "mem", "=", "=", "0xd8000", "|", "|", "X", "mem", "=", "=", "0xe0000", "|", "|", "X", "mem", "=", "=", "0xe8000", ")", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "mem", "must", "be", "one", "of", "\"", "X", "\"", "0xb0000", ",", "0xc8000", ",", "0xd0000", ",", "0xd8000", ",", "0xe0000", "or", "0xe8000", "\\", "n", "\"", ");", "X", "usage", "(", ");", "X", "}", "X", "X", "return", "msnd_write_cfg_logical", "(", "config_port", ",", "0", ",", "io", ",", "0", ",", "irq", ",", "mem", ")", ";", "}", "X", "static", "int", "cfg_mpu", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "X", "int", "io", ",", "irq", ";", "X", "X", "if", "(", "argc", "<", "2", "|", "|", "X", "sscanf", "(", "argv", "[", "0", "]", ",", "\"", "0x", "%", "x", "\"", ",", "&", "io", ")", "!", "=", "1", "|", "|", "X", "sscanf", "(", "argv", "[", "1", "]", ",", "\"", "%", "d", "\"", ",", "&", "irq", ")", "!", "=", "1", ")", "X", "usage", "(", ");", "X", "X", "return", "msnd_write_cfg_logical", "(", "config_port", ",", "1", ",", "io", ",", "0", ",", "irq", ",", "0", ")", ";", "}", "X", "static", "int", "cfg_ide", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "X", "int", "io0", ",", "io1", ",", "irq", ";", "X", "X", "if", "(", "argc", "<", "3", "|", "|", "X", "sscanf", "(", "argv", "[", "0", "]", ",", "\"", "0x", "%", "x", "\"", ",", "&", "io0", ")", "!", "=", "1", "|", "|", "X", "sscanf", "(", "argv", "[", "0", "]", ",", "\"", "0x", "%", "x", "\"", ",", "&", "io1", ")", "!", "=", "1", "|", "|", "X", "sscanf", "(", "argv", "[", "1", "]", ",", "\"", "%", "d", "\"", ",", "&", "irq", ")", "!", "=", "1", ")", "X", "usage", "(", ");", "X", "X", "return", "msnd_write_cfg_logical", "(", "config_port", ",", "2", ",", "io0", ",", "io1", ",", "irq", ",", "0", ")", ";", "}", "X", "static", "int", "cfg_joystick", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "X", "int", "io", ";", "X", "X", "if", "(", "argc", "<", "1", "|", "|", "X", "sscanf", "(", "argv", "[", "0", "]", ",", "\"", "0x", "%", "x", "\"", ",", "&", "io", ")", "!", "=", "1", ")", "X", "usage", "(", ");", "X", "X", "return", "msnd_write_cfg_logical", "(", "config_port", ",", "3", ",", "io", ",", "0", ",", "0", ",", "0", ")", ";", "}", "X", "int", "main", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "X", "char", "*", "device", ";", "X", "int", "rv", "=", "0", ";", "X", "X", "-", "-", "argc", ";", "+", "+", "argv", ";", "X", "X", "if", "(", "argc", "<", "2", ")", "X", "usage", "(", ");", "X", "X", "sscanf", "(", "argv", "[", "0", "]", ",", "\"", "0x", "%", "x", "\"", ",", "&", "config_port", ")", ";", "X", "if", "(", "config_port", "!", "=", "0x250", "&", "&", "config_port", "!", "=", "0x260", "&", "&", "config_port", "!", "=", "0x270", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "<", "config", "port", ">", "must", "be", "0x250", ",", "0x260", "or", "0x270", "\\", "n", "\"", ");", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "if", "(", "ioperm", "(", "config_port", ",", "2", ",", "1", ")", ")", "{", "X", "perror", "(", "\"", "ioperm", "\"", ");", "X", "fprintf", "(", "stderr", ",", "\"", "note", ":", "pinnaclecfg", "must", "be", "run", "as", "root", "\\", "n", "\"", ");", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "device", "=", "argv", "[", "1", "]", ";", "X", "X", "argc", "-", "=", "2", ";", "argv", "+", "=", "2", ";", "X", "X", "if", "(", "strcmp", "(", "device", ",", "\"", "reset", "\"", ")", "=", "=", "0", ")", "X", "rv", "=", "cfg_reset", "(", ");", "X", "else", "if", "(", "strcmp", "(", "device", ",", "\"", "show", "\"", ")", "=", "=", "0", ")", "X", "rv", "=", "cfg_show", "(", ");", "X", "else", "if", "(", "strcmp", "(", "device", ",", "\"", "dsp", "\"", ")", "=", "=", "0", ")", "X", "rv", "=", "cfg_dsp", "(", "argc", ",", "argv", ")", ";", "X", "else", "if", "(", "strcmp", "(", "device", ",", "\"", "mpu", "\"", ")", "=", "=", "0", ")", "X", "rv", "=", "cfg_mpu", "(", "argc", ",", "argv", ")", ";", "X", "else", "if", "(", "strcmp", "(", "device", ",", "\"", "ide", "\"", ")", "=", "=", "0", ")", "X", "rv", "=", "cfg_ide", "(", "argc", ",", "argv", ")", ";", "X", "else", "if", "(", "strcmp", "(", "device", ",", "\"", "joystick", "\"", ")", "=", "=", "0", ")", "X", "rv", "=", "cfg_joystick", "(", "argc", ",", "argv", ")", ";", "X", "else", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "unknown", "device", "%", "s", "\\", "n", "\"", ",", "device", ")", ";", "X", "usage", "(", ");", "X", "}", "X", "X", "if", "(", "rv", ")", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "device", "configuration", "failed", "\\", "n", "\"", ");", "X", "X", "return", "0", ";", "}", "SHAR_EOF", "$", "shar_touch", "-", "am", "1204092598", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "'", "&", "&", "chmod", "0664", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "'", "|", "|", "$", "echo", "'", "restore", "of", "'", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "'", "'", "failed", "'", "if", "(", "md5sum", "-", "-", "help", "2", ">", "&", "1", "|", "grep", "'", "sage", ":", "md5sum", "\\", "['", ")", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "&", "&", "(", "md5sum", "-", "-", "version", "2", ">", "&", "1", "|", "grep", "-", "v", "'", "textutils", "1", ".", "12", "'", ")", ">", "/", "dev", "/", "null", ";", "then", "md5sum", "-", "c", "<", "<", "SHAR_EOF", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", ":", "'", "'", "MD5", "check", "failed", "'", "366bdf27f0db767a3c7921d0a6db20fe", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "SHAR_EOF", "else", "shar_count", "=", "\"`", "LC_ALL", "=", "LC_CTYPE", "=", "LANG", "=", "wc", "-", "c", "<", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", "'", "`\"", "test", "10235", "-", "eq", "\"", "$", "shar_count", "\"", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "pinnaclecfg", ".", "c", ":", "'", "'", "original", "size", "'", "'", "10235", ",", "'", "'", "current", "size", "'", "\"", "$", "shar_count", "!", "\"", "fi", "fi", "#", "=", "==", "==", "==", "==", "==", "==", "MultiSound", ".", "d", "/", "Makefile", "=", "==", "==", "==", "==", "==", "==", "=", "if", "test", "-", "f", "'", "MultiSound", ".", "d", "/", "Makefile", "'", "&", "&", "test", "\"", "$", "first_param", "\"", "!", "=", "-", "c", ";", "then", "$", "echo", "'", "x", "-", "'", "SKIPPING", "'", "MultiSound", ".", "d", "/", "Makefile", "'", "'", "(", "file", "already", "exists", ")", "'", "else", "$", "echo", "'", "x", "-", "'", "extracting", "'", "MultiSound", ".", "d", "/", "Makefile", "'", "'", "(", "text", ")", "'", "sed", "'", "s", "/", "^", "X", "/", "/'", "<", "<", "'", "SHAR_EOF", "'", ">", "'", "MultiSound", ".", "d", "/", "Makefile", "'", "&", "&", "CC", "=", "gcc", "CFLAGS", "=", "-", "O", "PROGS", "=", "setdigital", "msndreset", "pinnaclecfg", "conv", "X", "all", ":", "$", "(", "PROGS", ")", "X", "clean", ":", "X", "rm", "-", "f", "$", "(", "PROGS", ")", "SHAR_EOF", "$", "shar_touch", "-", "am", "1204092398", "'", "MultiSound", ".", "d", "/", "Makefile", "'", "&", "&", "chmod", "0664", "'", "MultiSound", ".", "d", "/", "Makefile", "'", "|", "|", "$", "echo", "'", "restore", "of", "'", "'", "MultiSound", ".", "d", "/", "Makefile", "'", "'", "failed", "'", "if", "(", "md5sum", "-", "-", "help", "2", ">", "&", "1", "|", "grep", "'", "sage", ":", "md5sum", "\\", "['", ")", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "&", "&", "(", "md5sum", "-", "-", "version", "2", ">", "&", "1", "|", "grep", "-", "v", "'", "textutils", "1", ".", "12", "'", ")", ">", "/", "dev", "/", "null", ";", "then", "md5sum", "-", "c", "<", "<", "SHAR_EOF", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "Makefile", ":", "'", "'", "MD5", "check", "failed", "'", "76ca8bb44e3882edcf79c97df6c81845", "MultiSound", ".", "d", "/", "Makefile", "SHAR_EOF", "else", "shar_count", "=", "\"`", "LC_ALL", "=", "LC_CTYPE", "=", "LANG", "=", "wc", "-", "c", "<", "'", "MultiSound", ".", "d", "/", "Makefile", "'", "`\"", "test", "106", "-", "eq", "\"", "$", "shar_count", "\"", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "Makefile", ":", "'", "'", "original", "size", "'", "'", "106", ",", "'", "'", "current", "size", "'", "\"", "$", "shar_count", "!", "\"", "fi", "fi", "#", "=", "==", "==", "==", "==", "==", "==", "MultiSound", ".", "d", "/", "conv", ".", "l", "=", "==", "==", "==", "==", "==", "==", "=", "if", "test", "-", "f", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", "'", "&", "&", "test", "\"", "$", "first_param", "\"", "!", "=", "-", "c", ";", "then", "$", "echo", "'", "x", "-", "'", "SKIPPING", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", "'", "'", "(", "file", "already", "exists", ")", "'", "else", "$", "echo", "'", "x", "-", "'", "extracting", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", "'", "'", "(", "text", ")", "'", "sed", "'", "s", "/", "^", "X", "/", "/'", "<", "<", "'", "SHAR_EOF", "'", ">", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", "'", "&", "&", "%", "%", "[", "\\", "n", "\\", "t", ",", "\\", "r", "]", "\\", ";.", "*", "DB", "[", "0", "-", "9A", "-", "Fa", "-", "f", "]", "+", "H", "{", "int", "n", ";", "sscanf", "(", "yytext", ",", "\"", "%", "xH", "\"", ",", "&", "n", ")", ";", "printf", "(", "\"%", "c", "\"", ",", "n", ")", ";", "}", "%", "%", "int", "yywrap", "(", ")", "{", "return", "1", ";", "}", "main", "(", ")", "{", "yylex", "(", ");", "}", "SHAR_EOF", "$", "shar_touch", "-", "am", "0828231798", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", "'", "&", "&", "chmod", "0664", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", "'", "|", "|", "$", "echo", "'", "restore", "of", "'", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", "'", "'", "failed", "'", "if", "(", "md5sum", "-", "-", "help", "2", ">", "&", "1", "|", "grep", "'", "sage", ":", "md5sum", "\\", "['", ")", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "&", "&", "(", "md5sum", "-", "-", "version", "2", ">", "&", "1", "|", "grep", "-", "v", "'", "textutils", "1", ".", "12", "'", ")", ">", "/", "dev", "/", "null", ";", "then", "md5sum", "-", "c", "<", "<", "SHAR_EOF", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", ":", "'", "'", "MD5", "check", "failed", "'", "d2411fc32cd71a00dcdc1f009e858dd2", "MultiSound", ".", "d", "/", "conv", ".", "l", "SHAR_EOF", "else", "shar_count", "=", "\"`", "LC_ALL", "=", "LC_CTYPE", "=", "LANG", "=", "wc", "-", "c", "<", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", "'", "`\"", "test", "141", "-", "eq", "\"", "$", "shar_count", "\"", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "conv", ".", "l", ":", "'", "'", "original", "size", "'", "'", "141", ",", "'", "'", "current", "size", "'", "\"", "$", "shar_count", "!", "\"", "fi", "fi", "#", "=", "==", "==", "==", "==", "==", "==", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "=", "==", "==", "==", "==", "==", "==", "=", "if", "test", "-", "f", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "'", "&", "&", "test", "\"", "$", "first_param", "\"", "!", "=", "-", "c", ";", "then", "$", "echo", "'", "x", "-", "'", "SKIPPING", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "'", "'", "(", "file", "already", "exists", ")", "'", "else", "$", "echo", "'", "x", "-", "'", "extracting", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "'", "'", "(", "text", ")", "'", "sed", "'", "s", "/", "^", "X", "/", "/'", "<", "<", "'", "SHAR_EOF", "'", ">", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "'", "&", "&", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "X", "*", "X", "*", "msndreset", ".", "c", "-", "resets", "the", "MultiSound", "card", "X", "*", "X", "*", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "X", "*", "X", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "X", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "X", "*", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "X", "*", "(", "at", "your", "option", ")", "any", "later", "version", ".", "X", "*", "X", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "X", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "X", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "X", "*", "GNU", "General", "Public", "License", "for", "more", "details", ".", "X", "*", "X", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "X", "*", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "X", "*", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "X", "*", "X", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "X", "#", "include", "<", "stdio", ".", "h", ">", "#", "include", "<", "unistd", ".", "h", ">", "#", "include", "<", "fcntl", ".", "h", ">", "#", "include", "<", "sys", "/", "types", ".", "h", ">", "#", "include", "<", "sys", "/", "stat", ".", "h", ">", "#", "include", "<", "sys", "/", "ioctl", ".", "h", ">", "#", "include", "<", "sys", "/", "soundcard", ".", "h", ">", "X", "int", "main", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "X", "int", "fd", ";", "X", "X", "if", "(", "argc", "!", "=", "2", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "usage", ":", "msndreset", "<", "mixer", "device", ">", "\\", "n", "\"", ");", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "if", "(", "(", "fd", "=", "open", "(", "argv", "[", "1", "]", ",", "O_RDWR", ")", ")", "<", "0", ")", "{", "X", "perror", "(", "argv", "[", "1", "]", ");", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "if", "(", "ioctl", "(", "fd", ",", "SOUND_MIXER_PRIVATE1", ",", "0", ")", "<", "0", ")", "{", "X", "fprintf", "(", "stderr", ",", "\"", "error", ":", "msnd", "ioctl", "reset", "failed", "\\", "n", "\"", ");", "X", "perror", "(", "\"", "ioctl", "\"", ");", "X", "close", "(", "fd", ")", ";", "X", "exit", "(", "1", ")", ";", "X", "}", "X", "X", "close", "(", "fd", ")", ";", "X", "X", "return", "0", ";", "}", "SHAR_EOF", "$", "shar_touch", "-", "am", "1204100698", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "'", "&", "&", "chmod", "0664", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "'", "|", "|", "$", "echo", "'", "restore", "of", "'", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "'", "'", "failed", "'", "if", "(", "md5sum", "-", "-", "help", "2", ">", "&", "1", "|", "grep", "'", "sage", ":", "md5sum", "\\", "['", ")", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "&", "&", "(", "md5sum", "-", "-", "version", "2", ">", "&", "1", "|", "grep", "-", "v", "'", "textutils", "1", ".", "12", "'", ")", ">", "/", "dev", "/", "null", ";", "then", "md5sum", "-", "c", "<", "<", "SHAR_EOF", ">", "/", "dev", "/", "null", "2", ">", "&", "1", "\\", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", ":", "'", "'", "MD5", "check", "failed", "'", "c52f876521084e8eb25e12e01dcccb8a", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "SHAR_EOF", "else", "shar_count", "=", "\"`", "LC_ALL", "=", "LC_CTYPE", "=", "LANG", "=", "wc", "-", "c", "<", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", "'", "`\"", "test", "1472", "-", "eq", "\"", "$", "shar_count", "\"", "|", "|", "$", "echo", "'", "MultiSound", ".", "d", "/", "msndreset", ".", "c", ":", "'", "'", "original", "size", "'", "'", "1472", ",", "'", "'", "current", "size", "'", "\"", "$", "shar_count", "!", "\"", "fi", "fi", "rm", "-", "fr", "_sh01426", "exit", "0", "@", "@", "-", "1", ",", "6", "+", "0", ",", "0", "@", "@", "A", "pure", "OPL3", "card", "is", "nice", "and", "easy", "to", "configure", ".", "Simply", "do", "insmod", "opl3", "io", "=", "0x388", "Change", "the", "I", "/", "O", "address", "in", "the", "very", "unlikely", "case", "this", "card", "is", "differently", "configured", "@", "@", "-", "1", ",", "218", "+", "0", ",", "0", "@", "@", "Support", "for", "the", "OPTi", "82C931", "chip", "Note", ":", "parts", "of", "this", "README", "file", "apply", "also", "to", "other", "cards", "that", "use", "the", "mad16", "driver", ".", "Some", "items", "in", "this", "README", "file", "are", "based", "on", "features", "added", "to", "the", "sound", "driver", "after", "Linux", "-", "2", ".", "1", ".", "91", "was", "out", ".", "By", "the", "time", "of", "writing", "this", "I", "do", "not", "know", "which", "official", "kernel", "release", "will", "include", "these", "features", ".", "Please", "do", "not", "report", "inconsistencies", "on", "older", "Linux", "kernels", ".", "The", "OPTi", "82C931", "is", "supported", "in", "its", "non", "-", "PnP", "mode", ".", "Usually", "you", "do", "not", "need", "to", "set", "jumpers", ",", "etc", ".", "The", "sound", "driver", "will", "check", "the", "card", "status", "and", "if", "it", "is", "required", "it", "will", "force", "the", "card", "into", "a", "mode", "in", "which", "it", "can", "be", "programmed", ".", "If", "you", "have", "another", "OS", "installed", "on", "your", "computer", "it", "is", "recommended", "that", "Linux", "and", "the", "other", "OS", "use", "the", "same", "resources", ".", "Also", ",", "it", "is", "recommended", "that", "resources", "specified", "in", "/", "etc", "/", "modprobe", ".", "d", "/", "*.", "conf", "and", "resources", "specified", "in", "/", "etc", "/", "isapnp", ".", "conf", "agree", ".", "Compiling", "the", "sound", "driver", "I", "highly", "recommend", "that", "you", "build", "a", "modularized", "sound", "driver", ".", "This", "document", "does", "not", "cover", "a", "sound", "-", "driver", "which", "is", "built", "in", "the", "kernel", ".", "Sound", "card", "support", "should", "be", "enabled", "as", "a", "module", "(", "chose", "m", ")", ".", "Answer", "'", "m", "'", "for", "these", "items", ":", "Generic", "OPL2", "/", "OPL3", "FM", "synthesizer", "support", "(", "CONFIG_SOUND_ADLIB", ")", "Microsoft", "Sound", "System", "support", "(", "CONFIG_SOUND_MSS", ")", "Support", "for", "OPTi", "MAD16", "and", "/", "or", "Mozart", "based", "cards", "(", "CONFIG_SOUND_MAD16", ")", "FM", "synthesizer", "(", "YM3812", "/", "OPL", "-", "3", ")", "support", "(", "CONFIG_SOUND_YM3812", ")", "The", "configuration", "menu", "may", "ask", "for", "addresses", ",", "IRQ", "lines", "or", "DMA", "channels", ".", "If", "the", "card", "is", "used", "as", "a", "module", "the", "module", "loading", "options", "will", "override", "these", "values", ".", "For", "the", "OPTi", "931", "you", "can", "answer", "'", "n", "'", "to", ":", "Support", "MIDI", "in", "older", "MAD16", "based", "cards", "(", "requires", "SB", ")", "(", "CONFIG_SOUND_MAD16_OLDCARD", ")", "If", "you", "do", "need", "MIDI", "support", "in", "a", "Mozart", "or", "C928", "based", "card", "you", "need", "to", "answer", "'", "m", "'", "to", "the", "above", "question", ".", "In", "that", "case", "you", "will", "also", "need", "to", "answer", "'", "m", "'", "to", ":", "'", "100", "%", "Sound", "Blaster", "compatibles", "(", "SB16", "/", "32", "/", "64", ",", "ESS", ",", "Jazz16", ")", "support", "'", "(", "CONFIG_SOUND_SB", ")", "Go", "on", "and", "compile", "your", "kernel", "and", "modules", ".", "Install", "the", "modules", ".", "Run", "depmod", "-", "a", ".", "Using", "isapnptools", "In", "most", "systems", "with", "a", "PnP", "BIOS", "you", "do", "not", "need", "to", "use", "isapnp", ".", "The", "initialization", "provided", "by", "the", "BIOS", "is", "sufficient", "for", "the", "driver", "to", "pick", "up", "the", "card", "and", "continue", "initialization", ".", "If", "that", "fails", ",", "or", "if", "you", "have", "other", "PnP", "cards", ",", "you", "need", "to", "use", "isapnp", "to", "initialize", "the", "card", ".", "This", "was", "tested", "with", "isapnptools", "-", "1", ".", "11", "but", "I", "recommend", "that", "you", "use", "isapnptools", "-", "1", ".", "13", "(", "or", "newer", ")", ".", "Run", "pnpdump", "to", "dump", "the", "information", "about", "your", "PnP", "cards", ".", "Then", "edit", "the", "resulting", "file", "and", "select", "the", "options", "of", "your", "choice", ".", "This", "file", "is", "normally", "installed", "as", "/", "etc", "/", "isapnp", ".", "conf", ".", "The", "driver", "has", "one", "limitation", "with", "respect", "to", "I", "/", "O", "port", "resources", ":", "IO3", "base", "must", "be", "0x0E0C", ".", "Although", "isapnp", "allows", "other", "ports", ",", "this", "address", "is", "hard", "-", "coded", "into", "the", "driver", ".", "Using", "kmod", "and", "autoloading", "the", "sound", "driver", "Config", "files", "in", "'", "/", "etc", "/", "modprobe", ".", "d", "/", "'", "are", "used", "as", "below", ":", "alias", "mixer0", "mad16", "alias", "audio0", "mad16", "alias", "midi0", "mad16", "alias", "synth0", "opl3", "options", "sb", "mad16", "=", "1", "options", "mad16", "irq", "=", "10", "dma", "=", "0", "dma16", "=", "1", "io", "=", "0x530", "joystick", "=", "1", "cdtype", "=", "0", "options", "opl3", "io", "=", "0x388", "install", "mad16", "/", "sbin", "/", "modprobe", "-", "i", "mad16", "&", "&", "/", "sbin", "/", "ad1848_mixer_reroute", "14", "8", "15", "3", "16", "6", "If", "you", "have", "an", "MPU", "daughtercard", "or", "onboard", "MPU", "you", "will", "want", "to", "add", "to", "the", "\"", "options", "mad16", "\"", "line", "-", "eg", "options", "mad16", "irq", "=", "5", "dma", "=", "0", "dma16", "=", "3", "io", "=", "0x530", "mpu_io", "=", "0x330", "mpu_irq", "=", "9", "To", "set", "the", "I", "/", "O", "and", "IRQ", "of", "the", "MPU", ".", "Explain", ":", "alias", "mixer0", "mad16", "alias", "audio0", "mad16", "alias", "midi0", "mad16", "alias", "synth0", "opl3", "When", "any", "sound", "device", "is", "opened", "the", "kernel", "requests", "auto", "-", "loading", "of", "char", "-", "major", "-", "14", ".", "There", "is", "a", "built", "-", "in", "alias", "that", "translates", "this", "request", "to", "loading", "the", "main", "sound", "module", ".", "The", "sound", "module", "in", "its", "turn", "will", "request", "loading", "of", "a", "sub", "-", "driver", "for", "mixer", ",", "audio", ",", "midi", "or", "synthesizer", "device", ".", "The", "first", "3", "are", "supported", "by", "the", "mad16", "driver", ".", "The", "synth", "device", "is", "supported", "by", "the", "opl3", "driver", ".", "There", "is", "currently", "no", "way", "to", "autoload", "the", "sound", "device", "driver", "if", "more", "than", "one", "card", "is", "installed", ".", "options", "sb", "mad16", "=", "1", "This", "is", "left", "for", "historical", "reasons", ".", "If", "you", "enable", "the", "config", "option", "'", "Support", "MIDI", "in", "older", "MAD16", "based", "cards", "(", "requires", "SB", ")", "'", "or", "if", "you", "use", "an", "older", "mad16", "driver", "it", "will", "force", "loading", "of", "the", "SoundBlaster", "driver", ".", "This", "option", "tells", "the", "SB", "driver", "not", "to", "look", "for", "a", "SB", "card", "but", "to", "wait", "for", "the", "mad16", "driver", ".", "options", "mad16", "irq", "=", "10", "dma", "=", "0", "dma16", "=", "1", "io", "=", "0x530", "joystick", "=", "1", "cdtype", "=", "0", "options", "opl3", "io", "=", "0x388", "post", "-", "install", "mad16", "/", "sbin", "/", "ad1848_mixer_reroute", "14", "8", "15", "3", "16", "6", "This", "sets", "resources", "and", "options", "for", "the", "mad16", "and", "opl3", "drivers", ".", "I", "use", "two", "DMA", "channels", "(", "only", "one", "is", "required", ")", "to", "enable", "full", "duplex", ".", "joystick", "=", "1", "enables", "the", "joystick", "port", ".", "cdtype", "=", "0", "disables", "the", "cd", "port", ".", "You", "can", "also", "set", "mpu_io", "and", "mpu_irq", "in", "the", "mad16", "options", "for", "the", "uart401", "driver", ".", "This", "tells", "modprobe", "to", "run", "/", "sbin", "/", "ad1848_mixer_reroute", "after", "mad16", "is", "successfully", "loaded", "and", "initialized", ".", "The", "source", "for", "ad1848_mixer_reroute", "is", "appended", "to", "the", "end", "of", "this", "readme", "file", ".", "It", "is", "impossible", "for", "the", "sound", "driver", "to", "know", "the", "actual", "connections", "to", "the", "mixer", ".", "The", "3", "inputs", "intended", "for", "cd", ",", "synth", "and", "line", "-", "in", "are", "mapped", "to", "the", "generic", "inputs", "line1", ",", "line2", "and", "line3", ".", "This", "program", "reroutes", "these", "mixer", "channels", "to", "their", "right", "names", "(", "note", "the", "right", "mapping", "depends", "on", "the", "actual", "sound", "card", "that", "you", "use", ")", ".", "The", "numeric", "parameters", "mean", ":", "14", "=", "line1", "8", "=", "cd", "-", "reroute", "line1", "to", "the", "CD", "input", ".", "15", "=", "line2", "3", "=", "synth", "-", "reroute", "line2", "to", "the", "synthesizer", "input", ".", "16", "=", "line3", "6", "=", "line", "-", "reroute", "line3", "to", "the", "line", "input", ".", "For", "reference", "on", "other", "input", "names", "look", "at", "the", "file", "/", "usr", "/", "include", "/", "linux", "/", "soundcard", ".", "h", ".", "Using", "a", "joystick", "You", "must", "enable", "a", "joystick", "in", "the", "mad16", "options", ".", "(", "also", "in", "/", "etc", "/", "isapnp", ".", "conf", "if", "you", "use", "it", ")", ".", "Tested", "with", "regular", "analog", "joysticks", ".", "A", "CDROM", "drive", "connected", "to", "the", "sound", "card", "The", "82C931", "chip", "has", "support", "only", "for", "secondary", "ATAPI", "cdrom", ".", "(", "cdtype", "=", "8", ")", ".", "Loading", "the", "mad16", "driver", "resets", "the", "C931", "chip", "and", "if", "a", "cdrom", "was", "already", "mounted", "it", "may", "cause", "a", "complete", "system", "hang", ".", "Do", "not", "use", "the", "sound", "card", "if", "you", "have", "an", "alternative", ".", "If", "you", "do", "use", "the", "sound", "card", "it", "is", "important", "that", "you", "load", "the", "mad16", "driver", "(", "use", "\"", "modprobe", "mad16", "\"", "to", "prevent", "auto", "-", "unloading", ")", "before", "the", "cdrom", "is", "accessed", "the", "first", "time", ".", "Using", "the", "sound", "driver", "built", "-", "in", "to", "the", "kernel", "may", "help", "here", ",", "but", ".", "..", "Most", "new", "systems", "have", "a", "PnP", "BIOS", "and", "also", "two", "IDE", "controllers", ".", "The", "IDE", "controller", "on", "the", "sound", "card", "may", "be", "needed", "only", "on", "older", "systems", "(", "which", "have", "only", "one", "IDE", "controller", ")", "but", "these", "systems", "also", "do", "not", "have", "a", "PnP", "BIOS", "-", "requiring", "isapnptools", "and", "a", "modularized", "driver", ".", "Known", "problems", "1", ".", "See", "the", "section", "on", "\"", "A", "CDROM", "drive", "connected", "to", "the", "sound", "card", "\"", ".", "2", ".", "On", "my", "system", "the", "codec", "cannot", "capture", "companded", "sound", "samples", ".", "(", "eg", ".", ",", "recording", "from", "/", "dev", "/", "audio", ")", ".", "When", "any", "companded", "capture", "is", "requested", "I", "get", "stereo", "-", "16", "bit", "samples", "instead", ".", "Playback", "of", "companded", "samples", "works", "well", ".", "Apparently", "this", "problem", "is", "not", "common", "to", "all", "C931", "based", "cards", ".", "I", "do", "not", "know", "how", "to", "identify", "cards", "that", "have", "this", "problem", ".", "Source", "for", "ad1848_mixer_reroute", ".", "c", "#", "include", "<", "stdio", ".", "h", ">", "#", "include", "<", "fcntl", ".", "h", ">", "#", "include", "<", "linux", "/", "soundcard", ".", "h", ">", "static", "char", "*", "mixer_names", "[", "SOUND_MIXER_NRDEVICES", "]", "=", "SOUND_DEVICE_LABELS", ";", "int", "main", "(", "int", "argc", ",", "char", "*", "*", "argv", ")", "{", "int", "val", ",", "from", ",", "to", ";", "int", "i", ",", "fd", ";", "fd", "=", "open", "(", "\"/", "dev", "/", "mixer", "\"", ",", "O_RDWR", ")", ";", "if", "(", "fd", "<", "0", ")", "{", "perror", "(", "\"/", "dev", "/", "mixer", "\"", ");", "return", "1", ";", "}", "for", "(", "i", "=", "2", ";", "i", "<", "argc", ";", "i", "+", "=", "2", ")", "{", "from", "=", "atoi", "(", "argv", "[", "i", "-", "1", "]", ");", "to", "=", "atoi", "(", "argv", "[", "i", "]", ");", "if", "(", "to", "=", "=", "SOUND_MIXER_NONE", ")", "fprintf", "(", "stderr", ",", "\"", "%", "s", ":", "turning", "off", "mixer", "%", "s", "\\", "n", "\"", ",", "argv", "[", "0", "]", ",", "mixer_names", "[", "to", "]", ");", "else", "fprintf", "(", "stderr", ",", "\"", "%", "s", ":", "rerouting", "mixer", "%", "s", "to", "%", "s", "\\", "n", "\"", ",", "argv", "[", "0", "]", ",", "mixer_names", "[", "from", "]", ",", "mixer_names", "[", "to", "]", ");", "val", "=", "from", "<", "<", "8", "|", "to", ";", "if", "(", "ioctl", "(", "fd", ",", "SOUND_MIXER_PRIVATE2", ",", "&", "val", ")", ")", "{", "perror", "(", "\"", "AD1848", "mixer", "reroute", "\"", ");", "return", "1", ";", "}", "}", "return", "0", ";", "}", "@", "@", "-", "1", ",", "162", "+", "0", ",", "0", "@", "@", "Pro", "Audio", "Spectrum", "16", "for", "2", ".", "3", ".", "99", "and", "later", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "by", "Thomas", "Molina", "(", "tmolina", "@", "home", ".", "com", ")", "last", "modified", "3", "Mar", "2001", "Acknowledgement", "to", "Axel", "Boldt", "(", "boldt", "@", "math", ".", "ucsb", ".", "edu", ")", "for", "stuff", "taken", "from", "Configure", ".", "help", ",", "Riccardo", "Facchetti", "for", "stuff", "from", "README", ".", "OSS", ",", "and", "others", "whose", "names", "I", "could", "not", "find", ".", "This", "documentation", "is", "relevant", "for", "the", "PAS16", "driver", "(", "pas2_card", ".", "c", "and", "friends", ")", "under", "kernel", "version", "2", ".", "3", ".", "99", "and", "later", ".", "If", "you", "are", "unfamiliar", "with", "configuring", "sound", "under", "Linux", ",", "please", "read", "the", "Sound", "-", "HOWTO", ",", "Documentation", "/", "sound", "/", "oss", "/", "Introduction", "and", "other", "relevant", "docs", "first", ".", "The", "following", "information", "is", "relevant", "information", "from", "README", ".", "OSS", "and", "legacy", "docs", "for", "the", "Pro", "Audio", "Spectrum", "16", "(", "PAS16", ")", ":", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "The", "pas2_card", ".", "c", "driver", "supports", "the", "following", "cards", "Pro", "Audio", "Spectrum", "16", "(", "PAS16", ")", "and", "compatibles", ":", "Pro", "Audio", "Spectrum", "16", "Pro", "Audio", "Studio", "16", "Logitech", "Sound", "Man", "16", "NOTE", "!", "The", "original", "Pro", "Audio", "Spectrum", "as", "well", "as", "the", "PAS", "+", "are", "not", "and", "will", "not", "be", "supported", "by", "the", "driver", ".", "The", "sound", "driver", "configuration", "dialog", "Sound", "configuration", "starts", "by", "making", "some", "yes", "/", "no", "questions", ".", "Be", "careful", "when", "answering", "to", "these", "questions", "since", "answering", "y", "to", "a", "question", "may", "prevent", "some", "later", "ones", "from", "being", "asked", ".", "For", "example", "don", "'", "t", "answer", "y", "to", "the", "question", "about", "(", "PAS16", ")", "if", "you", "don", "'", "t", "really", "have", "a", "PAS16", ".", "Sound", "configuration", "may", "also", "be", "made", "modular", "by", "answering", "m", "to", "configuration", "options", "presented", ".", "Note", "also", "that", "all", "questions", "may", "not", "be", "asked", ".", "The", "configuration", "program", "may", "disable", "some", "questions", "depending", "on", "the", "earlier", "choices", ".", "It", "may", "also", "select", "some", "options", "automatically", "as", "well", ".", "\"", "ProAudioSpectrum", "16", "support", "\"", ",", "-", "Answer", "'", "y", "'", "_ONLY_", "if", "you", "have", "a", "Pro", "Audio", "Spectrum", "_16_", ",", "Pro", "Audio", "Studio", "16", "or", "Logitech", "SoundMan", "16", "(", "be", "sure", "that", "you", "read", "the", "above", "list", "correctly", ")", ".", "Don", "'", "t", "answer", "'", "y", "'", "if", "you", "have", "some", "other", "card", "made", "by", "Media", "Vision", "or", "Logitech", "since", "they", "are", "not", "PAS16", "compatible", ".", "NOTE", "!", "Since", "3", ".", "5", "-", "beta10", "you", "need", "to", "enable", "SB", "support", "(", "next", "question", ")", "if", "you", "want", "to", "use", "the", "SB", "emulation", "of", "PAS16", ".", "It", "'", "s", "also", "possible", "to", "the", "emulation", "if", "you", "want", "to", "use", "a", "true", "SB", "card", "together", "with", "PAS16", "(", "there", "is", "another", "question", "about", "this", "that", "is", "asked", "later", ")", ".", "\"", "Generic", "OPL2", "/", "OPL3", "FM", "synthesizer", "support", "\"", ",", "-", "Answer", "'", "y", "'", "if", "your", "card", "has", "a", "FM", "chip", "made", "by", "Yamaha", "(", "OPL2", "/", "OPL3", "/", "OPL4", ")", ".", "The", "PAS16", "has", "an", "OPL3", "-", "compatible", "FM", "chip", ".", "With", "PAS16", "you", "can", "use", "two", "audio", "device", "files", "at", "the", "same", "time", ".", "/", "dev", "/", "dsp", "(", "and", "/", "dev", "/", "audio", ")", "is", "connected", "to", "the", "8", "/", "16", "bit", "native", "codec", "and", "the", "/", "dev", "/", "dsp1", "(", "and", "/", "dev", "/", "audio1", ")", "is", "connected", "to", "the", "SB", "emulation", "(", "8", "bit", "mono", "only", ")", ".", "The", "new", "stuff", "for", "2", ".", "3", ".", "99", "and", "later", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "The", "following", "configuration", "options", "are", "relevant", "to", "configuring", "the", "PAS16", ":", "Sound", "card", "support", "CONFIG_SOUND", "If", "you", "have", "a", "sound", "card", "in", "your", "computer", ",", "i", ".", "e", ".", "if", "it", "can", "say", "more", "than", "an", "occasional", "beep", ",", "say", "Y", ".", "Be", "sure", "to", "have", "all", "the", "information", "about", "your", "sound", "card", "and", "its", "configuration", "down", "(", "I", "/", "O", "port", ",", "interrupt", "and", "DMA", "channel", ")", ",", "because", "you", "will", "be", "asked", "for", "it", ".", "You", "want", "to", "read", "the", "Sound", "-", "HOWTO", ",", "available", "from", "http", ":", "//", "www", ".", "tldp", ".", "org", "/", "docs", ".", "html", "#", "howto", ".", "General", "information", "about", "the", "modular", "sound", "system", "is", "contained", "in", "the", "files", "Documentation", "/", "sound", "/", "oss", "/", "Introduction", ".", "The", "file", "Documentation", "/", "sound", "/", "oss", "/", "README", ".", "OSS", "contains", "some", "slightly", "outdated", "but", "still", "useful", "information", "as", "well", ".", "OSS", "sound", "modules", "CONFIG_SOUND_OSS", "OSS", "is", "the", "Open", "Sound", "System", "suite", "of", "sound", "card", "drivers", ".", "They", "make", "sound", "programming", "easier", "since", "they", "provide", "a", "common", "API", ".", "Say", "Y", "or", "M", "here", "(", "the", "module", "will", "be", "called", "sound", ".", "o", ")", "if", "you", "haven", "'", "t", "found", "a", "driver", "for", "your", "sound", "card", "above", ",", "then", "pick", "your", "driver", "from", "the", "list", "below", ".", "Persistent", "DMA", "buffers", "CONFIG_SOUND_DMAP", "Linux", "can", "often", "have", "problems", "allocating", "DMA", "buffers", "for", "ISA", "sound", "cards", "on", "machines", "with", "more", "than", "16MB", "of", "RAM", ".", "This", "is", "because", "ISA", "DMA", "buffers", "must", "exist", "below", "the", "16MB", "boundary", "and", "it", "is", "quite", "possible", "that", "a", "large", "enough", "free", "block", "in", "this", "region", "cannot", "be", "found", "after", "the", "machine", "has", "been", "running", "for", "a", "while", ".", "If", "you", "say", "Y", "here", "the", "DMA", "buffers", "(", "64Kb", ")", "will", "be", "allocated", "at", "boot", "time", "and", "kept", "until", "the", "shutdown", ".", "This", "option", "is", "only", "useful", "if", "you", "said", "Y", "to", "\"", "OSS", "sound", "modules", "\"", ",", "above", ".", "If", "you", "said", "M", "to", "\"", "OSS", "sound", "modules", "\"", "then", "you", "can", "get", "the", "persistent", "DMA", "buffer", "functionality", "by", "passing", "the", "command", "-", "line", "argument", "\"", "dmabuf", "=", "1", "\"", "to", "the", "sound", ".", "o", "module", ".", "Say", "y", "here", "for", "PAS16", ".", "ProAudioSpectrum", "16", "support", "CONFIG_SOUND_PAS", "Answer", "Y", "only", "if", "you", "have", "a", "Pro", "Audio", "Spectrum", "16", ",", "ProAudio", "Studio", "16", "or", "Logitech", "SoundMan", "16", "sound", "card", ".", "Don", "'", "t", "answer", "Y", "if", "you", "have", "some", "other", "card", "made", "by", "Media", "Vision", "or", "Logitech", "since", "they", "are", "not", "PAS16", "compatible", ".", "It", "is", "not", "necessary", "to", "enable", "the", "separate", "Sound", "Blaster", "support", ";", "it", "is", "included", "in", "the", "PAS", "driver", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", ",", "you", "have", "to", "add", "\"", "pas2", "=", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "dma2", ">", ",<", "sbio", ">", ",<", "sbirq", ">", ",<", "sbdma", ">", ",<", "sbdma2", ">", "to", "the", "kernel", "command", "line", ".", "FM", "Synthesizer", "(", "YM3812", "/", "OPL", "-", "3", ")", "support", "CONFIG_SOUND_YM3812", "Answer", "Y", "if", "your", "card", "has", "a", "FM", "chip", "made", "by", "Yamaha", "(", "OPL2", "/", "OPL3", "/", "OPL4", ")", ".", "Answering", "Y", "is", "usually", "a", "safe", "and", "recommended", "choice", ",", "however", "some", "cards", "may", "have", "software", "(", "TSR", ")", "FM", "emulation", ".", "Enabling", "FM", "support", "with", "these", "cards", "may", "cause", "trouble", "(", "I", "don", "'", "t", "currently", "know", "of", "any", "such", "cards", ",", "however", ")", ".", "Please", "read", "the", "file", "Documentation", "/", "sound", "/", "oss", "/", "OPL3", "if", "your", "card", "has", "an", "OPL3", "chip", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", ",", "you", "have", "to", "add", "\"", "opl3", "=", "<", "io", ">", "\"", "to", "the", "kernel", "command", "line", ".", "If", "you", "compile", "your", "drivers", "into", "the", "kernel", ",", "you", "MUST", "configure", "OPL3", "support", "as", "a", "module", "for", "PAS16", "support", "to", "work", "properly", ".", "You", "can", "then", "get", "OPL3", "functionality", "by", "issuing", "the", "command", ":", "insmod", "opl3", "In", "addition", ",", "you", "must", "either", "add", "the", "following", "line", "to", "/", "etc", "/", "modprobe", ".", "d", "/", "*.", "conf", ":", "options", "opl3", "io", "=", "0x388", "or", "else", "add", "the", "following", "line", "to", "/", "etc", "/", "lilo", ".", "conf", ":", "opl3", "=", "0x388", "EXAMPLES", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "To", "use", "the", "PAS16", "in", "my", "computer", "I", "have", "enabled", "the", "following", "sound", "configuration", "options", ":", "CONFIG_SOUND", "=", "y", "CONFIG_SOUND_OSS", "=", "y", "CONFIG_SOUND_TRACEINIT", "=", "y", "CONFIG_SOUND_DMAP", "=", "y", "CONFIG_SOUND_PAS", "=", "y", "CONFIG_SOUND_SB", "=", "n", "CONFIG_SOUND_YM3812", "=", "m", "I", "have", "also", "included", "the", "following", "append", "line", "in", "/", "etc", "/", "lilo", ".", "conf", ":", "append", "=", "\"", "pas2", "=", "0x388", ",", "10", ",", "3", ",", "-", "1", ",", "0x220", ",", "5", ",", "1", ",", "-", "1", "sb", "=", "0x220", ",", "5", ",", "1", ",", "-", "1", "opl3", "=", "0x388", "\"", "The", "io", "address", "of", "0x388", "is", "default", "configuration", "on", "the", "PAS16", ".", "The", "irq", "of", "10", "and", "dma", "of", "3", "may", "not", "match", "your", "installation", ".", "The", "above", "configuration", "enables", "PAS16", ",", "8", "-", "bit", "Soundblaster", "and", "OPL3", "functionality", ".", "If", "Soundblaster", "functionality", "is", "not", "desired", ",", "the", "following", "line", "would", "be", "appropriate", ":", "append", "=", "\"", "pas2", "=", "0x388", ",", "10", ",", "3", ",", "-", "1", ",", "0", ",", "-", "1", ",", "-", "1", ",", "-", "1", "opl3", "=", "0x388", "\"", "If", "sound", "is", "built", "totally", "modular", ",", "the", "above", "options", "may", "be", "specified", "in", "/", "etc", "/", "modprobe", ".", "d", "/", "*.", "conf", "for", "pas2", ",", "sb", "and", "opl3", "respectively", ".", "@", "@", "-", "1", ",", "41", "+", "0", ",", "0", "@", "@", "The", "PSS", "cards", "and", "other", "ECHO", "based", "cards", "provide", "an", "onboard", "DSP", "with", "downloadable", "programs", "and", "also", "has", "an", "AD1848", "\"", "Microsoft", "Sound", "System", "\"", "device", ".", "The", "PSS", "driver", "enables", "MSS", "and", "MPU401", "modes", "of", "the", "card", ".", "SB", "is", "not", "enabled", "since", "it", "doesn", "'", "t", "work", "concurrently", "with", "MSS", ".", "If", "you", "build", "this", "driver", "as", "a", "module", "then", "the", "driver", "takes", "the", "following", "parameters", "pss_io", ".", "The", "I", "/", "O", "base", "the", "PSS", "card", "is", "configured", "at", "(", "normally", "0x220", "or", "0x240", ")", "mss_io", "The", "base", "address", "of", "the", "Microsoft", "Sound", "System", "interface", ".", "This", "is", "normally", "0x530", ",", "but", "may", "be", "0x604", "or", "other", "addresses", ".", "mss_irq", "The", "interrupt", "assigned", "to", "the", "Microsoft", "Sound", "System", "emulation", ".", "IRQ", "'", "s", "3", ",", "5", ",", "7", ",", "9", ",", "10", ",", "11", "and", "12", "are", "available", ".", "If", "you", "get", "IRQ", "errors", "be", "sure", "to", "check", "the", "interrupt", "is", "set", "to", "\"", "ISA", "/", "Legacy", "\"", "in", "the", "BIOS", "on", "modern", "machines", ".", "mss_dma", "The", "DMA", "channel", "used", "by", "the", "Microsoft", "Sound", "System", ".", "This", "can", "be", "0", ",", "1", ",", "or", "3", ".", "DMA", "0", "is", "not", "available", "on", "older", "machines", "and", "will", "cause", "a", "crash", "on", "them", ".", "mpu_io", "The", "MPU", "emulation", "base", "address", ".", "This", "sets", "the", "base", "of", "the", "synthesizer", ".", "It", "is", "typically", "0x330", "but", "can", "be", "altered", ".", "mpu_irq", "The", "interrupt", "to", "use", "for", "the", "synthesizer", ".", "It", "must", "differ", "from", "the", "IRQ", "used", "by", "the", "Microsoft", "Sound", "System", "port", ".", "The", "mpu_io", "/", "mpu_irq", "fields", "are", "optional", ".", "If", "they", "are", "not", "specified", "the", "synthesizer", "parts", "are", "not", "configured", ".", "When", "the", "module", "is", "loaded", "it", "looks", "for", "a", "file", "called", "/", "etc", "/", "sound", "/", "pss_synth", ".", "This", "is", "the", "firmware", "file", "from", "the", "DOS", "install", "disks", ".", "This", "fil", "holds", "a", "general", "MIDI", "emulation", ".", "The", "file", "expected", "is", "called", "genmidi", ".", "ld", "on", "newer", "DOS", "driver", "install", "disks", "and", "synth", ".", "ld", "on", "older", "ones", ".", "You", "can", "also", "load", "alternative", "DSP", "algorithms", "into", "the", "card", "if", "you", "wish", ".", "One", "alternative", "driver", "can", "be", "found", "at", "http", ":", "//", "www", ".", "mpg123", ".", "de", "/", "@", "@", "-", "1", ",", "88", "+", "0", ",", "0", "@", "@", "This", "file", "contains", "notes", "for", "users", "of", "PSS", "sound", "cards", "who", "wish", "to", "use", "the", "newly", "added", "features", "of", "the", "newest", "version", "of", "this", "driver", ".", "The", "major", "enhancements", "present", "in", "this", "new", "revision", "of", "this", "driver", "is", "the", "addition", "of", "two", "new", "module", "parameters", "that", "allow", "you", "to", "take", "full", "advantage", "of", "all", "the", "features", "present", "on", "your", "PSS", "sound", "card", ".", "These", "features", "include", "the", "ability", "to", "enable", "both", "the", "builtin", "CDROM", "and", "joystick", "ports", ".", "pss_enable_joystick", "This", "parameter", "is", "basically", "a", "flag", ".", "A", "0", "will", "leave", "the", "joystick", "port", "disabled", ",", "while", "a", "non", "-", "zero", "value", "would", "enable", "the", "joystick", "port", ".", "The", "default", "setting", "is", "pss_enable_joystick", "=", "0", "as", "this", "keeps", "this", "driver", "fully", "compatible", "with", "systems", "that", "were", "using", "previous", "versions", "of", "this", "driver", ".", "If", "you", "wish", "to", "enable", "the", "joystick", "port", "you", "will", "have", "to", "add", "pss_enable_joystick", "=", "1", "as", "an", "argument", "to", "the", "driver", ".", "To", "actually", "use", "the", "joystick", "port", "you", "will", "then", "have", "to", "load", "the", "joystick", "driver", "itself", ".", "Just", "remember", "to", "load", "the", "joystick", "driver", "AFTER", "the", "pss", "sound", "driver", ".", "pss_cdrom_port", "This", "parameter", "takes", "a", "port", "address", "as", "its", "parameter", ".", "Any", "available", "port", "address", "can", "be", "specified", "to", "enable", "the", "CDROM", "port", ",", "except", "for", "0x0", "and", "-", "1", "as", "these", "values", "would", "leave", "the", "port", "disabled", ".", "Like", "the", "joystick", "port", ",", "the", "cdrom", "port", "will", "require", "that", "an", "appropriate", "CDROM", "driver", "be", "loaded", "before", "you", "can", "make", "use", "of", "the", "newly", "enabled", "CDROM", "port", ".", "Like", "the", "joystick", "port", "option", "above", ",", "remember", "to", "load", "the", "CDROM", "driver", "AFTER", "the", "pss", "sound", "driver", ".", "While", "it", "may", "differ", "on", "some", "PSS", "sound", "cards", ",", "all", "the", "PSS", "sound", "cards", "that", "I", "have", "seen", "have", "a", "builtin", "Wearnes", "CDROM", "port", ".", "If", "this", "is", "the", "case", "with", "your", "PSS", "sound", "card", "you", "should", "load", "aztcd", "with", "the", "appropriate", "port", "option", "that", "matches", "the", "port", "you", "assigned", "to", "the", "CDROM", "port", "when", "you", "loaded", "your", "pss", "sound", "driver", ".", "(", "ex", ".", "modprobe", "pss", "pss_cdrom_port", "=", "0x340", "&", "&", "modprobe", "aztcd", "aztcd", "=", "0x340", ")", "The", "default", "setting", "of", "this", "parameter", "leaves", "the", "CDROM", "port", "disabled", "to", "maintain", "full", "compatibility", "with", "systems", "using", "previous", "versions", "of", "this", "driver", ".", "Other", "options", "have", "also", "been", "added", "for", "the", "added", "convenience", "and", "utility", "of", "the", "user", ".", "These", "options", "are", "only", "available", "if", "this", "driver", "is", "loaded", "as", "a", "module", ".", "pss_no_sound", "This", "module", "parameter", "is", "a", "flag", "that", "can", "be", "used", "to", "tell", "the", "driver", "to", "just", "configure", "non", "-", "sound", "components", ".", "0", "configures", "all", "components", ",", "a", "non", "-", "0", "value", "will", "only", "attempt", "to", "configure", "the", "CDROM", "and", "joystick", "ports", ".", "This", "parameter", "can", "be", "used", "by", "a", "user", "who", "only", "wished", "to", "use", "the", "builtin", "joystick", "and", "/", "or", "CDROM", "port", "(", "s", ")", "of", "his", "PSS", "sound", "card", ".", "If", "this", "driver", "is", "loaded", "with", "this", "parameter", "and", "with", "the", "parameter", "below", "set", "to", "true", "then", "a", "user", "can", "safely", "unload", "this", "driver", "with", "the", "following", "command", "\"", "rmmod", "pss", "&", "&", "rmmod", "ad1848", "&", "&", "rmmod", "mpu401", "&", "&", "rmmod", "sound", "&", "&", "rmmod", "soundcore", "\"", "and", "retain", "the", "full", "functionality", "of", "his", "CDROM", "and", "/", "or", "joystick", "port", "(", "s", ")", "while", "gaining", "back", "the", "memory", "previously", "used", "by", "the", "sound", "drivers", ".", "This", "default", "setting", "of", "this", "parameter", "is", "0", "to", "retain", "full", "behavioral", "compatibility", "with", "previous", "versions", "of", "this", "driver", ".", "pss_keep_settings", "This", "parameter", "can", "be", "used", "to", "specify", "whether", "you", "want", "the", "driver", "to", "reset", "all", "emulations", "whenever", "its", "unloaded", ".", "This", "can", "be", "useful", "for", "those", "who", "are", "sharing", "resources", "(", "io", "ports", ",", "IRQ", "'", "s", ",", "DMA", "'", "s", ")", "between", "different", "ISA", "cards", ".", "This", "flag", "can", "also", "be", "useful", "in", "that", "future", "versions", "of", "this", "driver", "may", "reset", "all", "emulations", "by", "default", "on", "the", "driver", "'", "s", "unloading", "(", "as", "it", "probably", "should", ")", ",", "so", "specifying", "it", "now", "will", "ensure", "that", "all", "future", "versions", "of", "this", "driver", "will", "continue", "to", "work", "as", "expected", ".", "The", "default", "value", "of", "this", "parameter", "is", "1", "to", "retain", "full", "behavioral", "compatibility", "with", "previous", "versions", "of", "this", "driver", ".", "pss_firmware", "This", "parameter", "can", "be", "used", "to", "specify", "the", "file", "containing", "the", "firmware", "code", "so", "that", "a", "user", "could", "tell", "the", "driver", "where", "that", "file", "is", "located", "instead", "of", "having", "to", "put", "it", "in", "a", "predefined", "location", "with", "a", "predefined", "name", ".", "The", "default", "setting", "of", "this", "parameter", "is", "\"", "/", "etc", "/", "sound", "/", "pss_synth", "\"", "as", "this", "was", "the", "path", "and", "filename", "the", "hardcoded", "value", "in", "the", "previous", "versions", "of", "this", "driver", ".", "Examples", ":", "#", "Normal", "PSS", "sound", "card", "system", ",", "loading", "of", "drivers", ".", "#", "Should", "be", "specified", "in", "an", "rc", "file", "(", "ex", ".", "Slackware", "uses", "/", "etc", "/", "rc", ".", "d", "/", "rc", ".", "modules", ")", ".", "/", "sbin", "/", "modprobe", "pss", "pss_io", "=", "0x220", "mpu_io", "=", "0x338", "mpu_irq", "=", "9", "mss_io", "=", "0x530", "mss_irq", "=", "10", "mss_dma", "=", "1", "pss_cdrom_port", "=", "0x340", "pss_enable_joystick", "=", "1", "/", "sbin", "/", "modprobe", "aztcd", "aztcd", "=", "0x340", "/", "sbin", "/", "modprobe", "joystick", "#", "System", "using", "the", "PSS", "sound", "card", "just", "for", "its", "CDROM", "and", "joystick", "ports", ".", "#", "Should", "be", "specified", "in", "an", "rc", "file", "(", "ex", ".", "Slackware", "uses", "/", "etc", "/", "rc", ".", "d", "/", "rc", ".", "modules", ")", ".", "/", "sbin", "/", "modprobe", "pss", "pss_io", "=", "0x220", "pss_cdrom_port", "=", "0x340", "pss_enable_joystick", "=", "1", "pss_no_sound", "=", "1", "/", "sbin", "/", "rmmod", "pss", "&", "&", "/", "sbin", "/", "rmmod", "ad1848", "&", "&", "/", "sbin", "/", "rmmod", "mpu401", "&", "&", "/", "sbin", "/", "rmmod", "sound", "&", "&", "/", "sbin", "/", "rmmod", "soundcore", "#", "This", "line", "not", "needed", ",", "but", "saves", "memory", ".", "/", "sbin", "/", "modprobe", "aztcd", "aztcd", "=", "0x340", "/", "sbin", "/", "modprobe", "joystick", "@", "@", "-", "1", ",", "1455", "+", "0", ",", "0", "@", "@", "Introduction", "This", "file", "is", "a", "collection", "of", "all", "the", "old", "Readme", "files", "distributed", "with", "OSS", "/", "Lite", "by", "Hannu", "Savolainen", ".", "Since", "the", "new", "Linux", "sound", "driver", "is", "founded", "on", "it", "I", "think", "these", "information", "may", "still", "be", "interesting", "for", "users", "that", "have", "to", "configure", "their", "sound", "system", ".", "Be", "warned", ":", "Alan", "Cox", "is", "the", "current", "maintainer", "of", "the", "Linux", "sound", "driver", "so", "if", "you", "have", "problems", "with", "it", ",", "please", "contact", "him", "or", "the", "current", "device", "-", "specific", "driver", "maintainer", "(", "e", ".", "g", ".", "for", "aedsp16", "specific", "problems", "contact", "me", ")", ".", "If", "you", "have", "patches", ",", "contributions", "or", "suggestions", "send", "them", "to", "Alan", ":", "I", "'", "m", "sure", "they", "are", "welcome", ".", "In", "this", "document", "you", "will", "find", "a", "lot", "of", "references", "about", "OSS", "/", "Lite", "or", "ossfree", ":", "they", "are", "gone", "forever", ".", "Keeping", "this", "in", "mind", "and", "with", "a", "grain", "of", "salt", "this", "document", "can", "be", "still", "interesting", "and", "very", "helpful", ".", "[", "File", "edited", "17", ".", "01", ".", "1999", "-", "Riccardo", "Facchetti", "]", "[", "Edited", "miroSOUND", "section", "19", ".", "04", ".", "2001", "-", "Robert", "Siemer", "]", "OSS", "/", "Free", "version", "3", ".", "8", "release", "notes", "Please", "read", "the", "SOUND", "-", "HOWTO", "(", "available", "from", "sunsite", ".", "unc", ".", "edu", "and", "other", "Linux", "FTP", "sites", ")", ".", "It", "gives", "instructions", "about", "using", "sound", "with", "Linux", ".", "It", "'", "s", "bit", "out", "of", "date", "but", "still", "very", "useful", ".", "Information", "about", "bug", "fixes", "and", "such", "things", "is", "available", "from", "the", "web", "page", "(", "see", "above", ")", ".", "Please", "check", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "pguide", "for", "more", "info", "about", "programming", "with", "OSS", "API", ".", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "THIS", "VERSION", "____REQUIRES____", "Linux", "2", ".", "1", ".", "57", "OR", "LATER", ".", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "Packages", "\"", "snd", "-", "util", "-", "3", ".", "8", ".", "tar", ".", "gz", "\"", "and", "\"", "snd", "-", "data", "-", "0", ".", "1", ".", "tar", ".", "Z", "\"", "contain", "useful", "utilities", "to", "be", "used", "with", "this", "driver", ".", "See", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", "/", "for", "download", "instructions", ".", "If", "you", "are", "looking", "for", "the", "installation", "instructions", ",", "please", "look", "forward", "into", "this", "document", ".", "Supported", "sound", "cards", "See", "below", ".", "Contributors", "This", "driver", "contains", "code", "by", "several", "contributors", ".", "In", "addition", "several", "other", "persons", "have", "given", "useful", "suggestions", ".", "The", "following", "is", "a", "list", "of", "major", "contributors", ".", "(", "I", "could", "have", "forgotten", "some", "names", ".", ")", "Craig", "Metz", "1", "/", "2", "of", "the", "PAS16", "Mixer", "and", "PCM", "support", "Rob", "Hooft", "Volume", "computation", "algorithm", "for", "the", "FM", "synth", ".", "Mika", "Liljeberg", "uLaw", "encoding", "and", "decoding", "routines", "Jeff", "Tranter", "Linux", "SOUND", "HOWTO", "document", "Greg", "Lee", "Volume", "computation", "algorithm", "for", "the", "GUS", "and", "lots", "of", "valuable", "suggestions", ".", "Andy", "Warner", "ISC", "port", "Jim", "Lowe", ",", "Amancio", "Hasty", "Jr", "FreeBSD", "/", "NetBSD", "port", "Anders", "Baekgaard", "Bug", "hunting", "and", "valuable", "suggestions", ".", "Joerg", "Schubert", "SB16", "DSP", "support", "(", "initial", "version", ")", ".", "Andrew", "Robinson", "Improvements", "to", "the", "GUS", "driver", "Megens", "SA", "MIDI", "recording", "for", "SB", "and", "SB", "Pro", "(", "initial", "version", ")", ".", "Mikael", "Nordqvist", "Linear", "volume", "support", "for", "GUS", "and", "nonblocking", "/", "dev", "/", "sequencer", ".", "Ian", "Hartas", "SVR4", ".", "2", "port", "Markus", "Aroharju", "and", "Risto", "Kankkunen", "Major", "contributions", "to", "the", "mixer", "support", "of", "GUS", "v3", ".", "7", ".", "Hunyue", "Yau", "Mixer", "support", "for", "SG", "NX", "Pro", ".", "Marc", "Hoffman", "PSS", "support", "(", "initial", "version", ")", ".", "Rainer", "Vranken", "Initialization", "for", "Jazz16", "(", "initial", "version", ")", ".", "Peter", "Trattler", "Initial", "version", "of", "loadable", "module", "support", "for", "Linux", ".", "JRA", "Gibson", "16", "bit", "mode", "for", "Jazz16", "(", "initial", "version", ")", "Davor", "Jadrijevic", "MAD16", "support", "(", "initial", "version", ")", "Gregor", "Hoffleit", "Mozart", "support", "(", "initial", "version", ")", "Riccardo", "Facchetti", "Audio", "Excel", "DSP", "16", "(", "aedsp16", ")", "support", "James", "Hightower", "Spotting", "a", "tiny", "but", "important", "bug", "in", "CS423x", "support", ".", "Denis", "Sablic", "OPTi", "82C924", "specific", "enhancements", "(", "non", "PnP", "mode", ")", "Tim", "MacKenzie", "Full", "duplex", "support", "for", "OPTi", "82C930", ".", "Please", "look", "at", "lowlevel", "/", "README", "for", "more", "contributors", ".", "There", "are", "probably", "many", "other", "names", "missing", ".", "If", "you", "have", "sent", "me", "some", "patches", "and", "your", "name", "is", "not", "in", "the", "above", "list", ",", "please", "inform", "me", ".", "Sending", "your", "contributions", "or", "patches", "First", "of", "all", "it", "'", "s", "highly", "recommended", "to", "contact", "me", "before", "sending", "anything", "or", "before", "even", "starting", "to", "do", "any", "work", ".", "Tell", "me", "what", "you", "suggest", "to", "be", "changed", "or", "what", "you", "have", "planned", "to", "do", ".", "Also", "ensure", "you", "are", "using", "the", "very", "latest", "(", "development", ")", "version", "of", "OSS", "/", "Free", "since", "the", "change", "may", "already", "be", "implemented", "there", ".", "In", "general", "it", "'", "s", "a", "major", "waste", "of", "time", "to", "try", "to", "improve", "a", "several", "months", "old", "version", ".", "Information", "about", "the", "latest", "version", "can", "be", "found", "from", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", ".", "In", "general", "there", "is", "no", "point", "in", "sending", "me", "patches", "relative", "to", "production", "kernels", ".", "Sponsors", "etc", ".", "The", "following", "companies", "have", "greatly", "helped", "development", "of", "this", "driver", "in", "form", "of", "a", "free", "copy", "of", "their", "product", ":", "Novell", ",", "Inc", ".", "UnixWare", "personal", "edition", "+", "SDK", "The", "Santa", "Cruz", "Operation", ",", "Inc", ".", "A", "SCO", "OpenServer", "+", "SDK", "Ensoniq", "Corp", ",", "a", "SoundScape", "card", "and", "extensive", "amount", "of", "assistance", "MediaTrix", "Peripherals", "Inc", ",", "a", "AudioTrix", "Pro", "card", "+", "SDK", "Acer", ",", "Inc", ".", "a", "pair", "of", "AcerMagic", "S23", "cards", ".", "In", "addition", "the", "following", "companies", "have", "provided", "me", "sufficient", "amount", "of", "technical", "information", "at", "least", "some", "of", "their", "products", "(", "free", "or", "$", "$$", "):", "Advanced", "Gravis", "Computer", "Technology", "Ltd", ".", "Media", "Vision", "Inc", ".", "Analog", "Devices", "Inc", ".", "Logitech", "Inc", ".", "Aztech", "Labs", "Inc", ".", "Crystal", "Semiconductor", "Corporation", ",", "Integrated", "Circuit", "Systems", "Inc", ".", "OAK", "Technology", "OPTi", "Turtle", "Beach", "miro", "Ad", "Lib", "Inc", ".", "(", "$$", ")", "Music", "Quest", "Inc", ".", "(", "$$", ")", "Creative", "Labs", "(", "$$", "$)", "If", "you", "have", "some", "problems", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "Read", "the", "sound", "HOWTO", "(", "sunsite", ".", "unc", ".", "edu", ":", "/", "pub", "/", "Linux", "/", "docs", "/", "..", ".?", ").", "Also", "look", "at", "the", "home", "page", "(", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", ")", ".", "It", "may", "contain", "info", "about", "some", "recent", "bug", "fixes", ".", "It", "'", "s", "likely", "that", "you", "have", "some", "problems", "when", "trying", "to", "use", "the", "sound", "driver", "first", "time", ".", "Sound", "cards", "don", "'", "t", "have", "standard", "configuration", "so", "there", "are", "no", "good", "default", "configuration", "to", "use", ".", "Please", "try", "to", "use", "same", "I", "/", "O", ",", "DMA", "and", "IRQ", "values", "for", "the", "sound", "card", "than", "with", "DOS", ".", "If", "you", "get", "an", "error", "message", "when", "trying", "to", "use", "the", "driver", ",", "please", "look", "at", "/", "var", "/", "adm", "/", "messages", "for", "more", "verbose", "error", "message", ".", "The", "following", "errors", "are", "likely", "with", "/", "dev", "/", "dsp", "and", "/", "dev", "/", "audio", ".", "-", "\"", "No", "such", "device", "or", "address", "\"", ".", "This", "error", "indicates", "that", "there", "are", "no", "suitable", "hardware", "for", "the", "device", "file", "or", "the", "sound", "driver", "has", "been", "compiled", "without", "support", "for", "this", "particular", "device", ".", "For", "example", "/", "dev", "/", "audio", "and", "/", "dev", "/", "dsp", "will", "not", "work", "if", "\"", "digitized", "voice", "support", "\"", "was", "not", "enabled", "during", "\"", "make", "config", "\"", ".", "-", "\"", "Device", "or", "resource", "busy", "\"", ".", "Probably", "the", "IRQ", "(", "or", "DMA", ")", "channel", "required", "by", "the", "sound", "card", "is", "in", "use", "by", "some", "other", "device", "/", "driver", ".", "-", "\"", "I", "/", "O", "error", "\"", ".", "Almost", "certainly", "(", "99", "%", ")", "it", "'", "s", "an", "IRQ", "or", "DMA", "conflict", ".", "Look", "at", "the", "kernel", "messages", "in", "/", "var", "/", "adm", "/", "notice", "for", "more", "info", ".", "-", "\"", "Invalid", "argument", "\"", ".", "The", "application", "is", "calling", "ioctl", "(", ")", "with", "impossible", "parameters", ".", "Check", "that", "the", "application", "is", "for", "sound", "driver", "version", "2", ".", "X", "or", "later", ".", "Linux", "installation", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "IMPORTANT", "!", "Read", "this", "if", "you", "are", "installing", "a", "separately", "distributed", "version", "of", "this", "driver", ".", "Check", "that", "your", "kernel", "version", "works", "with", "this", "release", "of", "the", "driver", "(", "see", "Readme", ")", ".", "Also", "verify", "that", "your", "current", "kernel", "version", "doesn", "'", "t", "have", "more", "recent", "sound", "driver", "version", "than", "this", "one", ".", "IT", "'", "S", "HIGHLY", "RECOMMENDED", "THAT", "YOU", "USE", "THE", "SOUND", "DRIVER", "VERSION", "THAT", "IS", "DISTRIBUTED", "WITH", "KERNEL", "SOURCES", ".", "When", "installing", "separately", "distributed", "sound", "driver", "you", "should", "first", "read", "the", "above", "notice", ".", "Then", "try", "to", "find", "proper", "directory", "where", "and", "how", "to", "install", "the", "driver", "sources", ".", "You", "should", "not", "try", "to", "install", "a", "separately", "distributed", "driver", "version", "if", "you", "are", "not", "able", "to", "find", "the", "proper", "way", "yourself", "(", "in", "this", "case", "use", "the", "version", "that", "is", "distributed", "with", "kernel", "sources", ")", ".", "Remove", "old", "version", "of", "linux", "/", "drivers", "/", "sound", "directory", "before", "installing", "new", "files", ".", "To", "build", "the", "device", "files", "you", "need", "to", "run", "the", "enclosed", "shell", "script", "(", "see", "below", ")", ".", "You", "need", "to", "do", "this", "only", "when", "installing", "sound", "driver", "first", "time", "or", "when", "upgrading", "to", "much", "recent", "version", "than", "the", "earlier", "one", ".", "Configure", "and", "compile", "Linux", "as", "normally", "(", "remember", "to", "include", "the", "sound", "support", "during", "\"", "make", "config", "\"", ").", "Please", "refer", "to", "kernel", "documentation", "for", "instructions", "about", "configuring", "and", "compiling", "kernel", ".", "File", "Readme", ".", "cards", "contains", "card", "specific", "instructions", "for", "configuring", "this", "driver", "for", "use", "with", "various", "sound", "cards", ".", "Boot", "time", "configuration", "(", "using", "lilo", "and", "insmod", ")", "This", "information", "has", "been", "removed", ".", "Too", "many", "users", "didn", "'", "t", "believe", "that", "it", "'", "s", "really", "not", "necessary", "to", "use", "this", "method", ".", "Please", "look", "at", "Readme", "of", "sound", "driver", "version", "3", ".", "0", ".", "1", "if", "you", "still", "want", "to", "use", "this", "method", ".", "Problems", "Common", "error", "messages", ":", "/", "dev", "/", "??", "??", "??", "?:", "No", "such", "file", "or", "directory", ".", "Run", "the", "script", "at", "the", "end", "of", "this", "file", ".", "/", "dev", "/", "??", "??", "??", "?:", "No", "such", "device", ".", "You", "are", "not", "running", "kernel", "which", "contains", "the", "sound", "driver", ".", "When", "using", "modularized", "sound", "driver", "this", "error", "means", "that", "the", "sound", "driver", "is", "not", "loaded", ".", "/", "dev", "/", "??", "??", ":", "No", "such", "device", "or", "address", ".", "Sound", "driver", "didn", "'", "t", "detect", "suitable", "card", "when", "initializing", ".", "Please", "look", "at", "Readme", ".", "cards", "for", "info", "about", "configuring", "the", "driver", "with", "your", "card", ".", "Also", "check", "for", "possible", "boot", "(", "insmod", ")", "time", "error", "messages", "in", "/", "var", "/", "adm", "/", "messages", ".", "Other", "messages", "or", "problems", "Please", "check", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", "for", "more", "info", ".", "Configuring", "version", "3", ".", "8", "(", "for", "Linux", ")", "with", "some", "common", "sound", "cards", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "This", "document", "describes", "configuring", "sound", "cards", "with", "the", "freeware", "version", "of", "Open", "Sound", "Systems", "(", "OSS", "/", "Free", ")", ".", "Information", "about", "the", "commercial", "version", "(", "OSS", "/", "Linux", ")", "and", "its", "configuration", "is", "available", "from", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "linux", ".", "html", ".", "Information", "presented", "here", "is", "not", "valid", "for", "OSS", "/", "Linux", ".", "If", "you", "are", "unsure", "about", "how", "to", "configure", "OSS", "/", "Free", "you", "can", "download", "the", "free", "evaluation", "version", "of", "OSS", "/", "Linux", "from", "the", "above", "address", ".", "There", "is", "a", "chance", "that", "it", "can", "autodetect", "your", "sound", "card", ".", "In", "this", "case", "you", "can", "use", "the", "information", "included", "in", "soundon", ".", "log", "when", "configuring", "OSS", "/", "Free", ".", "IMPORTANT", "!", "This", "document", "covers", "only", "cards", "that", "were", "\"", "known", "\"", "when", "this", "driver", "version", "was", "released", ".", "Please", "look", "at", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", "for", "info", "about", "cards", "introduced", "recently", ".", "When", "configuring", "the", "sound", "driver", ",", "you", "should", "carefully", "check", "each", "sound", "configuration", "option", "(", "particularly", "\"", "Support", "for", "/", "dev", "/", "dsp", "and", "/", "dev", "/", "audio", "\"", ").", "The", "default", "values", "offered", "by", "these", "programs", "are", "not", "necessarily", "valid", ".", "THE", "BIGGEST", "MISTAKES", "YOU", "CAN", "MAKE", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "1", ".", "Assuming", "that", "the", "card", "is", "Sound", "Blaster", "compatible", "when", "it", "'", "s", "not", ".", "The", "number", "one", "mistake", "is", "to", "assume", "that", "your", "card", "is", "compatible", "with", "Sound", "Blaster", ".", "Only", "the", "cards", "made", "by", "Creative", "Technology", "or", "which", "have", "one", "or", "more", "chips", "labeled", "by", "Creative", "are", "SB", "compatible", ".", "In", "addition", "there", "are", "few", "sound", "chipsets", "which", "are", "SB", "compatible", "in", "Linux", "such", "as", "ESS1688", "or", "Jazz16", ".", "Note", "that", "SB", "compatibility", "in", "DOS", "/", "Windows", "does", "_NOT_", "mean", "anything", "in", "Linux", ".", "IF", "YOU", "REALLY", "ARE", "150", "%", "SURE", "YOU", "HAVE", "A", "SOUND", "BLASTER", "YOU", "CAN", "SKIP", "THE", "REST", "OF", "THIS", "CHAPTER", ".", "For", "most", "other", "\"", "supposed", "to", "be", "SB", "compatible", "\"", "cards", "you", "have", "to", "use", "other", "than", "SB", "drivers", "(", "see", "below", ")", ".", "It", "is", "possible", "to", "get", "most", "sound", "cards", "to", "work", "in", "SB", "mode", "but", "in", "general", "it", "'", "s", "a", "complete", "waste", "of", "time", ".", "There", "are", "several", "problems", "which", "you", "will", "encounter", "by", "using", "SB", "mode", "with", "cards", "that", "are", "not", "truly", "SB", "compatible", ":", "The", "SB", "emulation", "is", "at", "most", "SB", "Pro", "(", "DSP", "version", "3", ".", "x", ")", "which", "means", "that", "you", "get", "only", "8", "bit", "audio", "(", "there", "is", "always", "an", "another", "(", "\"", "native", "\"", ")", "mode", "which", "gives", "the", "16", "bit", "capability", ")", ".", "The", "8", "bit", "only", "operation", "is", "the", "reason", "why", "many", "users", "claim", "that", "sound", "quality", "in", "Linux", "is", "much", "worse", "than", "in", "DOS", ".", "In", "addition", "some", "applications", "require", "16", "bit", "mode", "and", "they", "produce", "just", "noise", "with", "a", "8", "bit", "only", "device", ".", "The", "card", "may", "work", "only", "in", "some", "cases", "but", "refuse", "to", "work", "most", "of", "the", "time", ".", "The", "SB", "compatible", "mode", "always", "requires", "special", "initialization", "which", "is", "done", "by", "the", "DOS", "/", "Windows", "drivers", ".", "This", "kind", "of", "cards", "work", "in", "Linux", "after", "you", "have", "warm", "booted", "it", "after", "DOS", "but", "they", "don", "'", "t", "work", "after", "cold", "boot", "(", "power", "on", "or", "reset", ")", ".", "You", "get", "the", "famous", "\"", "DMA", "timed", "out", "\"", "messages", ".", "Usually", "all", "SB", "clones", "have", "software", "selectable", "IRQ", "and", "DMA", "settings", ".", "If", "the", "(", "power", "on", "default", ")", "values", "currently", "used", "by", "the", "card", "don", "'", "t", "match", "configuration", "of", "the", "driver", "you", "will", "get", "the", "above", "error", "message", "whenever", "you", "try", "to", "record", "or", "play", ".", "There", "are", "few", "other", "reasons", "to", "the", "DMA", "timeout", "message", "but", "using", "the", "SB", "mode", "seems", "to", "be", "the", "most", "common", "cause", ".", "2", ".", "Trying", "to", "use", "a", "PnP", "(", "Plug", "&", "Play", ")", "card", "just", "like", "an", "ordinary", "sound", "card", "Plug", "&", "Play", "is", "a", "protocol", "defined", "by", "Intel", "and", "Microsoft", ".", "It", "lets", "operating", "systems", "to", "easily", "identify", "and", "reconfigure", "I", "/", "O", "ports", ",", "IRQs", "and", "DMAs", "of", "ISA", "cards", ".", "The", "problem", "with", "PnP", "cards", "is", "that", "the", "standard", "Linux", "doesn", "'", "t", "currently", "(", "versions", "2", ".", "1", ".", "x", "and", "earlier", ")", "don", "'", "t", "support", "PnP", ".", "This", "means", "that", "you", "will", "have", "to", "use", "some", "special", "tricks", "(", "see", "later", ")", "to", "get", "a", "PnP", "card", "alive", ".", "Many", "PnP", "cards", "work", "after", "they", "have", "been", "initialized", "but", "this", "is", "not", "always", "the", "case", ".", "There", "are", "sometimes", "both", "PnP", "and", "non", "-", "PnP", "versions", "of", "the", "same", "sound", "card", ".", "The", "non", "-", "PnP", "version", "is", "the", "original", "model", "which", "usually", "has", "been", "discontinued", "more", "than", "an", "year", "ago", ".", "The", "PnP", "version", "has", "the", "same", "name", "but", "with", "\"", "PnP", "\"", "appended", "to", "it", "(", "sometimes", "not", ")", ".", "This", "causes", "major", "confusion", "since", "the", "non", "-", "PnP", "model", "works", "with", "Linux", "but", "the", "PnP", "one", "doesn", "'", "t", ".", "You", "should", "carefully", "check", "if", "\"", "Plug", "&", "Play", "\"", "or", "\"", "PnP", "\"", "is", "mentioned", "in", "the", "name", "of", "the", "card", "or", "in", "the", "documentation", "or", "package", "that", "came", "with", "the", "card", ".", "Everything", "described", "in", "the", "rest", "of", "this", "document", "is", "not", "necessarily", "valid", "for", "PnP", "models", "of", "sound", "cards", "even", "you", "have", "managed", "to", "wake", "up", "the", "card", "properly", ".", "Many", "PnP", "cards", "are", "simply", "too", "different", "from", "their", "non", "-", "PnP", "ancestors", "which", "are", "covered", "by", "this", "document", ".", "Cards", "that", "are", "not", "(", "fully", ")", "supported", "by", "this", "driver", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "See", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", "for", "information", "about", "sound", "cards", "to", "be", "supported", "in", "future", ".", "How", "to", "use", "sound", "without", "recompiling", "kernel", "and", "/", "or", "sound", "driver", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "There", "is", "a", "commercial", "sound", "driver", "which", "comes", "in", "precompiled", "form", "and", "doesn", "'", "t", "require", "recompiling", "of", "the", "kernel", ".", "See", "http", ":", "//", "www", ".", "4Front", "-", "tech", ".", "com", "/", "oss", ".", "html", "for", "more", "info", ".", "Configuring", "PnP", "cards", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "New", "versions", "of", "most", "sound", "cards", "use", "the", "so", "-", "called", "ISA", "PnP", "protocol", "for", "soft", "configuring", "their", "I", "/", "O", ",", "IRQ", ",", "DMA", "and", "shared", "memory", "resources", ".", "Currently", "at", "least", "cards", "made", "by", "Creative", "Technology", "(", "SB32", "and", "SB32AWE", "PnP", ")", ",", "Gravis", "(", "GUS", "PnP", "and", "GUS", "PnP", "Pro", ")", ",", "Ensoniq", "(", "Soundscape", "PnP", ")", "and", "Aztech", "(", "some", "Sound", "Galaxy", "models", ")", "use", "PnP", "technology", ".", "The", "CS4232", "/", "4236", "audio", "chip", "by", "Crystal", "Semiconductor", "(", "Intel", "Atlantis", ",", "HP", "Pavilion", "and", "many", "other", "motherboards", ")", "is", "also", "based", "on", "PnP", "technology", "but", "there", "is", "a", "\"", "native", "\"", "driver", "available", "for", "it", "(", "see", "information", "about", "CS4232", "later", "in", "this", "document", ")", ".", "PnP", "sound", "cards", "(", "as", "well", "as", "most", "other", "PnP", "ISA", "cards", ")", "are", "not", "supported", "by", "this", "version", "of", "the", "driver", ".", "Proper", "support", "for", "them", "should", "be", "released", "during", "97", "once", "the", "kernel", "level", "PnP", "support", "is", "available", ".", "There", "is", "a", "method", "to", "get", "most", "of", "the", "PnP", "cards", "to", "work", ".", "The", "basic", "method", "is", "the", "following", ":", "1", ")", "Boot", "DOS", "so", "the", "card", "'", "s", "DOS", "drivers", "have", "a", "chance", "to", "initialize", "it", ".", "2", ")", "_Cold_", "boot", "to", "Linux", "by", "using", "\"", "loadlin", ".", "exe", "\"", ".", "Hitting", "ctrl", "-", "alt", "-", "del", "works", "with", "older", "machines", "but", "causes", "a", "hard", "reset", "of", "all", "cards", "on", "recent", "(", "Pentium", ")", "machines", ".", "3", ")", "If", "you", "have", "the", "sound", "driver", "in", "Linux", "configured", "properly", ",", "the", "card", "should", "work", "now", ".", "\"", "Proper", "\"", "means", "that", "I", "/", "O", ",", "IRQ", "and", "DMA", "settings", "are", "the", "same", "as", "in", "DOS", ".", "The", "hard", "part", "is", "to", "find", "which", "settings", "were", "used", ".", "See", "the", "documentation", "of", "your", "card", "for", "more", "info", ".", "Windows", "95", "could", "work", "as", "well", "as", "DOS", "but", "running", "loadlin", "may", "be", "difficult", ".", "Probably", "you", "should", "\"", "shut", "down", "\"", "your", "machine", "to", "MS", "-", "DOS", "mode", "before", "running", "it", ".", "Some", "machines", "have", "a", "BIOS", "utility", "for", "setting", "PnP", "resources", ".", "This", "is", "a", "good", "way", "to", "configure", "some", "cards", ".", "In", "this", "case", "you", "don", "'", "t", "need", "to", "boot", "DOS", "/", "Win95", "before", "starting", "Linux", ".", "Another", "way", "to", "initialize", "PnP", "cards", "without", "DOS", "/", "Win95", "is", "a", "Linux", "based", "PnP", "isolation", "tool", ".", "When", "writing", "this", "there", "is", "a", "pre", "alpha", "test", "version", "of", "such", "a", "tool", "available", "from", "ftp", ":", "//", "ftp", ".", "demon", ".", "co", ".", "uk", "/", "pub", "/", "unix", "/", "linux", "/", "utils", ".", "The", "file", "is", "called", "isapnptools", "-", "*.", "Please", "note", "that", "this", "tool", "is", "just", "a", "temporary", "solution", "which", "may", "be", "incompatible", "with", "future", "kernel", "versions", "having", "proper", "support", "for", "PnP", "cards", ".", "There", "are", "bugs", "in", "setting", "DMA", "channels", "in", "earlier", "versions", "of", "isapnptools", "so", "at", "least", "version", "1", ".", "6", "is", "required", "with", "sound", "cards", ".", "Yet", "another", "way", "to", "use", "PnP", "cards", "is", "to", "use", "(", "commercial", ")", "OSS", "/", "Linux", "drivers", ".", "See", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "linux", ".", "html", "for", "more", "info", ".", "This", "is", "probably", "the", "way", "you", "should", "do", "it", "if", "you", "don", "'", "t", "want", "to", "spend", "time", "recompiling", "the", "kernel", "and", "required", "tools", ".", "Read", "this", "before", "trying", "to", "configure", "the", "driver", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "There", "are", "currently", "many", "cards", "that", "work", "with", "this", "driver", ".", "Some", "of", "the", "cards", "have", "native", "support", "while", "others", "work", "since", "they", "emulate", "some", "other", "card", "(", "usually", "SB", ",", "MSS", "/", "WSS", "and", "/", "or", "MPU401", ")", ".", "The", "following", "cards", "have", "native", "support", "in", "the", "driver", ".", "Detailed", "instructions", "for", "configuring", "these", "cards", "will", "be", "given", "later", "in", "this", "document", ".", "Pro", "Audio", "Spectrum", "16", "(", "PAS16", ")", "and", "compatibles", ":", "Pro", "Audio", "Spectrum", "16", "Pro", "Audio", "Studio", "16", "Logitech", "Sound", "Man", "16", "NOTE", "!", "The", "original", "Pro", "Audio", "Spectrum", "as", "well", "as", "the", "PAS", "+", "are", "not", "and", "will", "not", "be", "supported", "by", "the", "driver", ".", "Media", "Vision", "Jazz16", "based", "cards", "Pro", "Sonic", "16", "Logitech", "SoundMan", "Wave", "(", "Other", "Jazz", "based", "cards", "should", "work", "but", "I", "don", "'", "t", "have", "any", "reports", "about", "them", ")", ".", "Sound", "Blasters", "SB", "1", ".", "0", "to", "2", ".", "0", "SB", "Pro", "SB", "16", "SB32", "/", "64", "/", "AWE", "Configure", "SB32", "/", "64", "/", "AWE", "just", "like", "SB16", ".", "See", "lowlevel", "/", "README", ".", "awe", "for", "information", "about", "using", "the", "wave", "table", "synth", ".", "NOTE", "!", "AWE63", "/", "Gold", "and", "16", "/", "32", "/", "AWE", "\"", "PnP", "\"", "cards", "need", "to", "be", "activated", "using", "isapnptools", "before", "they", "work", "with", "OSS", "/", "Free", ".", "SB16", "compatible", "cards", "by", "other", "manufacturers", "than", "Creative", ".", "You", "have", "been", "fooled", "since", "there", "are", "_no_", "SB16", "compatible", "cards", "on", "the", "market", "(", "as", "of", "May", "1997", ")", ".", "It", "'", "s", "likely", "that", "your", "card", "is", "compatible", "just", "with", "SB", "Pro", "but", "there", "is", "also", "a", "non", "-", "SB", "compatible", "16", "bit", "mode", ".", "Usually", "it", "'", "s", "MSS", "/", "WSS", "but", "it", "could", "also", "be", "a", "proprietary", "one", "like", "MV", "Jazz16", "or", "ESS", "ES688", ".", "OPTi", "MAD16", "chips", "are", "very", "common", "in", "so", "called", "\"", "SB", "16", "bit", "cards", "\"", "(", "try", "with", "the", "MAD16", "driver", ")", ".", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "\"", "Supposed", "to", "be", "SB", "compatible", "\"", "cards", ".", "Forget", "the", "SB", "compatibility", "and", "check", "for", "other", "alternatives", "first", ".", "The", "only", "cards", "that", "work", "with", "the", "SB", "driver", "in", "Linux", "have", "been", "made", "by", "Creative", "Technology", "(", "there", "is", "at", "least", "one", "chip", "on", "the", "card", "with", "\"", "CREATIVE", "\"", "printed", "on", "it", ")", ".", "The", "only", "other", "SB", "compatible", "chips", "are", "ESS", "and", "Jazz16", "chips", "(", "maybe", "ALSxxx", "chips", "too", "but", "they", "probably", "don", "'", "t", "work", ")", ".", "Most", "other", "\"", "16", "bit", "SB", "compatible", "\"", "cards", "such", "as", "\"", "OPTi", "/", "MAD16", "\"", "or", "\"", "Crystal", "\"", "are", "_NOT_", "SB", "compatible", "in", "Linux", ".", "Practically", "all", "sound", "cards", "have", "some", "kind", "of", "SB", "emulation", "mode", "in", "addition", "to", "their", "native", "(", "16", "bit", ")", "mode", ".", "In", "most", "cases", "this", "(", "8", "bit", "only", ")", "SB", "compatible", "mode", "doesn", "'", "t", "work", "with", "Linux", ".", "If", "you", "get", "it", "working", "it", "may", "cause", "problems", "with", "games", "and", "applications", "which", "require", "16", "bit", "audio", ".", "Some", "16", "bit", "only", "applications", "don", "'", "t", "check", "if", "the", "card", "actually", "supports", "16", "bits", ".", "They", "just", "dump", "16", "bit", "data", "to", "a", "8", "bit", "card", "which", "produces", "just", "noise", ".", "In", "most", "cases", "the", "16", "bit", "native", "mode", "is", "supported", "by", "Linux", ".", "Use", "the", "SB", "mode", "with", "\"", "clones", "\"", "only", "if", "you", "don", "'", "t", "find", "anything", "better", "from", "the", "rest", "of", "this", "doc", ".", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "Gravis", "Ultrasound", "(", "GUS", ")", "GUS", "GUS", "+", "the", "16", "bit", "option", "GUS", "MAX", "GUS", "ACE", "(", "No", "MIDI", "port", "and", "audio", "recording", ")", "GUS", "PnP", "(", "with", "RAM", ")", "MPU", "-", "401", "and", "compatibles", "The", "driver", "works", "both", "with", "the", "full", "(", "intelligent", "mode", ")", "MPU", "-", "401", "cards", "(", "such", "as", "MPU", "IPC", "-", "T", "and", "MQX", "-", "32M", ")", "and", "with", "the", "UART", "only", "dumb", "MIDI", "ports", ".", "MPU", "-", "401", "is", "currently", "the", "most", "common", "MIDI", "interface", ".", "Most", "sound", "cards", "are", "compatible", "with", "it", ".", "However", ",", "don", "'", "t", "enable", "MPU401", "mode", "blindly", ".", "Many", "cards", "with", "native", "support", "in", "the", "driver", "have", "their", "own", "MPU401", "driver", ".", "Enabling", "the", "standard", "one", "will", "cause", "a", "conflict", "with", "these", "cards", ".", "So", "check", "if", "your", "card", "is", "in", "the", "list", "of", "supported", "cards", "before", "enabling", "MPU401", ".", "Windows", "Sound", "System", "(", "MSS", "/", "WSS", ")", "Even", "when", "Microsoft", "has", "discontinued", "their", "own", "Sound", "System", "card", "they", "managed", "to", "make", "it", "a", "standard", ".", "MSS", "compatible", "cards", "are", "based", "on", "a", "codec", "chip", "which", "is", "easily", "available", "from", "at", "least", "two", "manufacturers", "(", "AD1848", "by", "Analog", "Devices", "and", "CS4231", "/", "CS4248", "by", "Crystal", "Semiconductor", ")", ".", "Currently", "most", "sound", "cards", "are", "based", "on", "one", "of", "the", "MSS", "compatible", "codec", "chips", ".", "The", "CS4231", "is", "used", "in", "the", "high", "quality", "cards", "such", "as", "GUS", "MAX", ",", "MediaTrix", "AudioTrix", "Pro", "and", "TB", "Tropez", "(", "GUS", "MAX", "is", "not", "MSS", "compatible", ")", ".", "Having", "a", "AD1848", ",", "CS4248", "or", "CS4231", "codec", "chip", "on", "the", "card", "is", "a", "good", "sign", ".", "Even", "if", "the", "card", "is", "not", "MSS", "compatible", ",", "it", "could", "be", "easy", "to", "write", "support", "for", "it", ".", "Note", "also", "that", "most", "MSS", "compatible", "cards", "require", "special", "boot", "time", "initialization", "which", "may", "not", "be", "present", "in", "the", "driver", ".", "Also", ",", "some", "MSS", "compatible", "cards", "have", "native", "support", ".", "Enabling", "the", "MSS", "support", "with", "these", "cards", "is", "likely", "to", "cause", "a", "conflict", ".", "So", "check", "if", "your", "card", "is", "listed", "in", "this", "file", "before", "enabling", "the", "MSS", "support", ".", "Yamaha", "FM", "synthesizers", "(", "OPL2", ",", "OPL3", "(", "not", "OPL3", "-", "SA", ")", "and", "OPL4", ")", "Most", "sound", "cards", "have", "a", "FM", "synthesizer", "chip", ".", "The", "OPL2", "is", "a", "2", "operator", "chip", "used", "in", "the", "original", "AdLib", "card", ".", "Currently", "it", "'", "s", "used", "only", "in", "the", "cheapest", "(", "8", "bit", "mono", ")", "cards", ".", "The", "OPL3", "is", "a", "4", "operator", "FM", "chip", "which", "provides", "better", "sound", "quality", "and", "/", "or", "more", "available", "voices", "than", "the", "OPL2", ".", "The", "OPL4", "is", "a", "new", "chip", "that", "has", "an", "OPL3", "and", "a", "wave", "table", "synthesizer", "packed", "onto", "the", "same", "chip", ".", "The", "driver", "supports", "just", "the", "OPL3", "mode", "directly", ".", "Most", "cards", "with", "an", "OPL4", "(", "like", "SM", "Wave", "and", "AudioTrix", "Pro", ")", "support", "the", "OPL4", "mode", "using", "MPU401", "emulation", ".", "Writing", "a", "native", "OPL4", "support", "is", "difficult", "since", "Yamaha", "doesn", "'", "t", "give", "information", "about", "their", "sample", "ROM", "chip", ".", "Enable", "the", "generic", "OPL2", "/", "OPL3", "FM", "synthesizer", "support", "if", "your", "card", "has", "a", "FM", "chip", "made", "by", "Yamaha", ".", "Don", "'", "t", "enable", "it", "if", "your", "card", "has", "a", "software", "(", "TRS", ")", "based", "FM", "emulator", ".", "NOTE", "!", "OPL3", "-", "SA", "is", "different", "chip", "than", "the", "ordinary", "OPL3", ".", "In", "addition", "to", "the", "FM", "synth", "this", "chip", "has", "also", "digital", "audio", "(", "WSS", ")", "and", "MIDI", "(", "MPU401", ")", "capabilities", ".", "Support", "for", "OPL3", "-", "SA", "is", "described", "below", ".", "Yamaha", "OPL3", "-", "SA1", "Yamaha", "OPL3", "-", "SA1", "(", "YMF701", ")", "is", "an", "audio", "controller", "chip", "used", "on", "some", "(", "Intel", ")", "motherboards", "and", "on", "cheap", "sound", "cards", ".", "It", "should", "not", "be", "confused", "with", "the", "original", "OPL3", "chip", "(", "YMF278", ")", "which", "is", "entirely", "different", "chip", ".", "OPL3", "-", "SA1", "has", "support", "for", "MSS", ",", "MPU401", "and", "SB", "Pro", "(", "not", "used", "in", "OSS", "/", "Free", ")", "in", "addition", "to", "the", "OPL3", "FM", "synth", ".", "There", "are", "also", "chips", "called", "OPL3", "-", "SA2", ",", "OPL3", "-", "SA3", ",", ".", "..", ",", "OPL3SA", "-", "N", ".", "They", "are", "PnP", "chips", "and", "will", "not", "work", "with", "the", "OPL3", "-", "SA1", "driver", ".", "You", "should", "use", "the", "standard", "MSS", ",", "MPU401", "and", "OPL3", "options", "with", "these", "chips", "and", "to", "activate", "the", "card", "using", "isapnptools", ".", "4Front", "Technologies", "SoftOSS", "SoftOSS", "is", "a", "software", "based", "wave", "table", "emulation", "which", "works", "with", "any", "16", "bit", "stereo", "sound", "card", ".", "Due", "to", "its", "nature", "a", "fast", "CPU", "is", "required", "(", "P133", "is", "minimum", ")", ".", "Although", "SoftOSS", "does", "_not_", "use", "MMX", "instructions", "it", "has", "proven", "out", "that", "recent", "processors", "(", "which", "appear", "to", "have", "MMX", ")", "perform", "significantly", "better", "with", "SoftOSS", "than", "earlier", "ones", ".", "For", "example", "a", "P166MMX", "beats", "a", "PPro200", ".", "SoftOSS", "should", "not", "be", "used", "on", "486", "or", "386", "machines", ".", "The", "amount", "of", "CPU", "load", "caused", "by", "SoftOSS", "can", "be", "controlled", "by", "selecting", "the", "CONFIG_SOFTOSS_RATE", "and", "CONFIG_SOFTOSS_VOICES", "parameters", "properly", "(", "they", "will", "be", "prompted", "by", "make", "config", ")", ".", "It", "'", "s", "recommended", "to", "set", "CONFIG_SOFTOSS_VOICES", "to", "32", ".", "If", "you", "have", "a", "P166MMX", "or", "faster", "(", "PPro200", "is", "not", "faster", ")", "you", "can", "set", "CONFIG_SOFTOSS_RATE", "to", "44100", "(", "kHz", ")", ".", "However", "with", "slower", "systems", "it", "recommended", "to", "use", "sampling", "rates", "around", "22050", "or", "even", "16000", "kHz", ".", "Selecting", "too", "high", "values", "for", "these", "parameters", "may", "hang", "your", "system", "when", "playing", "MIDI", "files", "with", "hight", "degree", "of", "polyphony", "(", "number", "of", "concurrently", "playing", "notes", ")", ".", "It", "'", "s", "also", "possible", "to", "decrease", "CONFIG_SOFTOSS_VOICES", ".", "This", "makes", "it", "possible", "to", "use", "higher", "sampling", "rates", ".", "However", "using", "fewer", "voices", "decreases", "playback", "quality", "more", "than", "decreasing", "the", "sampling", "rate", ".", "SoftOSS", "keeps", "the", "samples", "loaded", "on", "the", "system", "'", "s", "RAM", "so", "much", "RAM", "is", "required", ".", "SoftOSS", "should", "never", "be", "used", "on", "machines", "with", "less", "than", "16", "MB", "of", "RAM", "since", "this", "is", "potentially", "dangerous", "(", "you", "may", "accidentally", "run", "out", "of", "memory", "which", "probably", "crashes", "the", "machine", ")", ".", "SoftOSS", "implements", "the", "wave", "table", "API", "originally", "designed", "for", "GUS", ".", "For", "this", "reason", "all", "applications", "designed", "for", "GUS", "should", "work", "(", "at", "least", "after", "minor", "modifications", ")", ".", "For", "example", "gmod", "/", "xgmod", "and", "playmidi", "-", "g", "are", "known", "to", "work", ".", "To", "work", "SoftOSS", "will", "require", "GUS", "compatible", "patch", "files", "to", "be", "installed", "on", "the", "system", "(", "in", "/", "dos", "/", "ultrasnd", "/", "midi", ")", ".", "You", "can", "use", "the", "public", "domain", "MIDIA", "patchset", "available", "from", "several", "ftp", "sites", ".", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "IMPORTANT", "NOTICE", "!", "The", "original", "patch", "set", "distributed", "with", "the", "Gravis", "Ultrasound", "card", "is", "not", "in", "public", "domain", "(", "even", "though", "it", "'", "s", "available", "from", "some", "FTP", "sites", ")", ".", "You", "should", "contact", "Voice", "Crystal", "(", "www", ".", "voicecrystal", ".", "com", ")", "if", "you", "like", "to", "use", "these", "patches", "with", "SoftOSS", "included", "in", "OSS", "/", "Free", ".", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "PSS", "based", "cards", "(", "AD1848", "+", "ADSP", "-", "2115", "+", "Echo", "ESC614", "ASIC", ")", "Analog", "Devices", "and", "Echo", "Speech", "have", "together", "defined", "a", "sound", "card", "architecture", "based", "on", "the", "above", "chips", ".", "The", "DSP", "chip", "is", "used", "for", "emulation", "of", "SB", "Pro", ",", "FM", "and", "General", "MIDI", "/", "MT32", ".", "There", "are", "several", "cards", "based", "on", "this", "architecture", ".", "The", "most", "known", "ones", "are", "Orchid", "SW32", "and", "Cardinal", "DSP16", ".", "The", "driver", "supports", "downloading", "DSP", "algorithms", "to", "these", "cards", ".", "NOTE", "!", "You", "will", "have", "to", "use", "the", "\"", "old", "\"", "config", "script", "when", "configuring", "PSS", "cards", ".", "MediaTrix", "AudioTrix", "Pro", "The", "ATP", "card", "is", "built", "around", "a", "CS4231", "codec", "and", "an", "OPL4", "synthesizer", "chips", ".", "The", "OPL4", "mode", "is", "supported", "by", "a", "microcontroller", "running", "a", "General", "MIDI", "emulator", ".", "There", "is", "also", "a", "SB", "1", ".", "5", "compatible", "playback", "mode", ".", "Ensoniq", "SoundScape", "and", "compatibles", "Ensoniq", "has", "designed", "a", "sound", "card", "architecture", "based", "on", "the", "OTTO", "synthesizer", "chip", "used", "in", "their", "professional", "MIDI", "synthesizers", ".", "Several", "companies", "(", "including", "Ensoniq", ",", "Reveal", "and", "Spea", ")", "are", "selling", "cards", "based", "on", "this", "architecture", ".", "NOTE", "!", "The", "SoundScape", "PnP", "is", "not", "supported", "by", "OSS", "/", "Free", ".", "Ensoniq", "VIVO", "and", "VIVO90", "cards", "are", "not", "compatible", "with", "Soundscapes", "so", "the", "Soundscape", "driver", "will", "not", "work", "with", "them", ".", "You", "may", "want", "to", "use", "OSS", "/", "Linux", "with", "these", "cards", ".", "OPTi", "MAD16", "and", "Mozart", "based", "cards", "The", "Mozart", "(", "OAK", "OTI", "-", "601", ")", ",", "MAD16", "(", "OPTi", "82C928", ")", ",", "MAD16", "Pro", "(", "OPTi", "82C929", ")", ",", "OPTi", "82C924", "/", "82C925", "(", "in", "_non_", "PnP", "mode", ")", "and", "OPTi", "82C930", "interface", "chips", "are", "used", "in", "many", "different", "sound", "cards", ",", "including", "some", "cards", "by", "Reveal", "miro", "and", "Turtle", "Beach", "(", "Tropez", ")", ".", "The", "purpose", "of", "these", "chips", "is", "to", "connect", "other", "audio", "components", "to", "the", "PC", "bus", ".", "The", "interface", "chip", "performs", "address", "decoding", "for", "the", "other", "chips", ".", "NOTE", "!", "Tropez", "Plus", "is", "not", "MAD16", "but", "CS4232", "based", ".", "NOTE", "!", "MAD16", "PnP", "cards", "(", "82C924", ",", "82C925", ",", "82C931", ")", "are", "not", "MAD16", "compatible", "in", "the", "PnP", "mode", ".", "You", "will", "have", "to", "use", "them", "in", "MSS", "mode", "after", "having", "initialized", "them", "using", "isapnptools", "or", "DOS", ".", "82C931", "probably", "requires", "initialization", "using", "DOS", "/", "Windows", "(", "running", "isapnptools", "is", "not", "enough", ")", ".", "It", "'", "s", "possible", "to", "use", "82C931", "with", "OSS", "/", "Free", "by", "jumpering", "it", "to", "non", "-", "PnP", "mode", "(", "provided", "that", "the", "card", "has", "a", "jumper", "for", "this", ")", ".", "In", "non", "-", "PnP", "mode", "82C931", "is", "compatible", "with", "82C930", "and", "should", "work", "with", "the", "MAD16", "driver", "(", "without", "need", "to", "use", "isapnptools", "or", "DOS", "to", "initialize", "it", ")", ".", "All", "OPTi", "chips", "are", "supported", "by", "OSS", "/", "Linux", "(", "both", "in", "PnP", "and", "non", "-", "PnP", "modes", ")", ".", "Audio", "Excel", "DSP16", "Support", "for", "this", "card", "was", "written", "by", "Riccardo", "Faccetti", "(", "riccardo", "@", "cdc8g5", ".", "cdc", ".", "polimi", ".", "it", ")", ".", "The", "AEDSP16", "driver", "included", "in", "the", "lowlevel", "/", "directory", ".", "To", "use", "it", "you", "should", "enable", "the", "\"", "Additional", "low", "level", "drivers", "\"", "option", ".", "Crystal", "CS4232", "and", "CS4236", "based", "cards", "such", "as", "AcerMagic", "S23", ",", "TB", "Tropez", "_Plus_", "and", "many", "PC", "motherboards", "(", "Compaq", ",", "HP", ",", "Intel", ",", ".", "..", ")", "CS4232", "is", "a", "PnP", "multimedia", "chip", "which", "contains", "a", "CS3231A", "codec", ",", "SB", "and", "MPU401", "emulations", ".", "There", "is", "support", "for", "OPL3", "too", ".", "Unfortunately", "the", "MPU401", "mode", "doesn", "'", "t", "work", "(", "I", "don", "'", "t", "know", "how", "to", "initialize", "it", ")", ".", "CS4236", "is", "an", "enhanced", "(", "compatible", ")", "version", "of", "CS4232", ".", "NOTE", "!", "Don", "'", "t", "ever", "try", "to", "use", "isapnptools", "with", "CS4232", "since", "this", "will", "just", "freeze", "your", "machine", "(", "due", "to", "chip", "bugs", ")", ".", "If", "you", "have", "problems", "in", "getting", "CS4232", "working", "you", "could", "try", "initializing", "it", "with", "DOS", "(", "CS4232C", ".", "EXE", ")", "and", "then", "booting", "Linux", "using", "loadlin", ".", "CS4232C", ".", "EXE", "loads", "a", "secret", "firmware", "patch", "which", "is", "not", "documented", "by", "Crystal", ".", "Turtle", "Beach", "Maui", "and", "Tropez", "\"", "classic", "\"", "This", "driver", "version", "supports", "sample", ",", "patch", "and", "program", "loading", "commands", "described", "in", "the", "Maui", "/", "Tropez", "User", "'", "s", "manual", ".", "There", "is", "now", "full", "initialization", "support", "too", ".", "The", "audio", "side", "of", "the", "Tropez", "is", "based", "on", "the", "MAD16", "chip", "(", "see", "above", ")", ".", "NOTE", "!", "Tropez", "Plus", "is", "different", "card", "than", "Tropez", "\"", "classic", "\"", "and", "will", "not", "work", "fully", "in", "Linux", ".", "You", "can", "get", "audio", "features", "working", "by", "configuring", "the", "card", "as", "a", "CS4232", "based", "card", "(", "above", ")", ".", "Jumpers", "and", "software", "configuration", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "Some", "of", "the", "earliest", "sound", "cards", "were", "jumper", "configurable", ".", "You", "have", "to", "configure", "the", "driver", "use", "I", "/", "O", ",", "IRQ", "and", "DMA", "settings", "that", "match", "the", "jumpers", ".", "Just", "few", "8", "bit", "cards", "are", "fully", "jumper", "configurable", "(", "SB", "1", ".", "x", "/", "2", ".", "x", ",", "SB", "Pro", "and", "clones", ")", ".", "Some", "cards", "made", "by", "Aztech", "have", "an", "EEPROM", "which", "contains", "the", "config", "info", ".", "These", "cards", "behave", "much", "like", "hardware", "jumpered", "cards", ".", "Most", "cards", "have", "jumper", "for", "the", "base", "I", "/", "O", "address", "but", "other", "parameters", "are", "software", "configurable", ".", "Sometimes", "there", "are", "few", "other", "jumpers", "too", ".", "Latest", "cards", "are", "fully", "software", "configurable", "or", "they", "are", "PnP", "ISA", "compatible", ".", "There", "are", "no", "jumpers", "on", "the", "board", ".", "The", "driver", "handles", "software", "configurable", "cards", "automatically", ".", "Just", "configure", "the", "driver", "to", "use", "I", "/", "O", ",", "IRQ", "and", "DMA", "settings", "which", "are", "known", "to", "work", ".", "You", "could", "usually", "use", "the", "same", "values", "than", "with", "DOS", "and", "/", "or", "Windows", ".", "Using", "different", "settings", "is", "possible", "but", "not", "recommended", "since", "it", "may", "cause", "some", "trouble", "(", "for", "example", "when", "warm", "booting", "from", "an", "OS", "to", "another", "or", "when", "installing", "new", "hardware", "to", "the", "machine", ")", ".", "Sound", "driver", "sets", "the", "soft", "configurable", "parameters", "of", "the", "card", "automatically", "during", "boot", ".", "Usually", "you", "don", "'", "t", "need", "to", "run", "any", "extra", "initialization", "programs", "when", "booting", "Linux", "but", "there", "are", "some", "exceptions", ".", "See", "the", "card", "-", "specific", "instructions", "below", "for", "more", "info", ".", "The", "drawback", "of", "software", "configuration", "is", "that", "the", "driver", "needs", "to", "know", "how", "the", "card", "must", "be", "initialized", ".", "It", "cannot", "initialize", "unknown", "cards", "even", "if", "they", "are", "otherwise", "compatible", "with", "some", "other", "cards", "(", "like", "SB", ",", "MPU401", "or", "Windows", "Sound", "System", ")", ".", "What", "if", "your", "card", "was", "not", "listed", "above", "?", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "The", "first", "thing", "to", "do", "is", "to", "look", "at", "the", "major", "IC", "chips", "on", "the", "card", ".", "Many", "of", "the", "latest", "sound", "cards", "are", "based", "on", "some", "standard", "chips", ".", "If", "you", "are", "lucky", ",", "all", "of", "them", "could", "be", "supported", "by", "the", "driver", ".", "The", "most", "common", "ones", "are", "the", "OPTi", "MAD16", ",", "Mozart", ",", "SoundScape", "(", "Ensoniq", ")", "and", "the", "PSS", "architectures", "listed", "above", ".", "Also", "look", "at", "the", "end", "of", "this", "file", "for", "list", "of", "unsupported", "cards", "and", "the", "ones", "which", "could", "be", "supported", "later", ".", "The", "last", "resort", "is", "to", "send", "_exact_", "name", "and", "model", "information", "of", "the", "card", "to", "me", "together", "with", "a", "list", "of", "the", "major", "IC", "chips", "(", "manufactured", ",", "model", ")", "to", "me", ".", "I", "could", "then", "try", "to", "check", "if", "your", "card", "looks", "like", "something", "familiar", ".", "There", "are", "many", "more", "cards", "in", "the", "world", "than", "listed", "above", ".", "The", "first", "thing", "to", "do", "with", "these", "cards", "is", "to", "check", "if", "they", "emulate", "some", "other", "card", "or", "interface", "such", "as", "SB", ",", "MSS", "and", "/", "or", "MPU401", ".", "In", "this", "case", "there", "is", "a", "chance", "to", "get", "the", "card", "to", "work", "by", "booting", "DOS", "before", "starting", "Linux", "(", "boot", "DOS", ",", "hit", "ctrl", "-", "alt", "-", "del", "and", "boot", "Linux", "without", "hard", "resetting", "the", "machine", ")", ".", "In", "this", "method", "the", "DOS", "based", "driver", "initializes", "the", "hardware", "to", "use", "known", "I", "/", "O", ",", "IRQ", "and", "DMA", "settings", ".", "If", "sound", "driver", "is", "configured", "to", "use", "the", "same", "settings", ",", "everything", "should", "work", "OK", ".", "Configuring", "sound", "driver", "(", "with", "Linux", ")", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "The", "sound", "driver", "is", "currently", "distributed", "as", "part", "of", "the", "Linux", "kernel", ".", "The", "files", "are", "in", "/", "usr", "/", "src", "/", "linux", "/", "drivers", "/", "sound", "/", ".", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "ALWAYS", "USE", "THE", "SOUND", "DRIVER", "VERSION", "WHICH", "IS", "DISTRIBUTED", "WITH", "*", "*", "THE", "KERNEL", "SOURCE", "PACKAGE", "YOU", "ARE", "USING", ".", "SOME", "ALPHA", "AND", "BETA", "TEST", "*", "*", "VERSIONS", "CAN", "BE", "INSTALLED", "FROM", "A", "SEPARATELY", "DISTRIBUTED", "PACKAGE", "*", "*", "BUT", "CHECK", "THAT", "THE", "PACKAGE", "IS", "NOT", "MUCH", "OLDER", "(", "OR", "NEWER", ")", "THAN", "THE", "*", "*", "KERNEL", "YOU", "ARE", "USING", ".", "IT", "'", "S", "POSSIBLE", "THAT", "THE", "KERNEL", "/", "DRIVER", "*", "*", "INTERFACE", "CHANGES", "BETWEEN", "KERNEL", "RELEASES", "WHICH", "MAY", "CAUSE", "SOME", "*", "*", "INCOMPATIBILITY", "PROBLEMS", ".", "*", "*", "*", "*", "IN", "CASE", "YOU", "INSTALL", "A", "SEPARATELY", "DISTRIBUTED", "SOUND", "DRIVER", "VERSION", ",", "*", "*", "BE", "SURE", "TO", "REMOVE", "OR", "RENAME", "THE", "OLD", "SOUND", "DRIVER", "DIRECTORY", "BEFORE", "*", "*", "INSTALLING", "THE", "NEW", "ONE", ".", "LEAVING", "OLD", "FILES", "TO", "THE", "SOUND", "DRIVER", "*", "*", "DIRECTORY", "_WILL_", "CAUSE", "PROBLEMS", "WHEN", "THE", "DRIVER", "IS", "USED", "OR", "*", "*", "COMPILED", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "To", "configure", "the", "driver", ",", "run", "\"", "make", "config", "\"", "in", "the", "kernel", "source", "directory", "(", "/", "usr", "/", "src", "/", "linux", ")", ".", "Answer", "\"", "y", "\"", "or", "\"", "m", "\"", "to", "the", "question", "about", "Sound", "card", "support", "(", "after", "the", "questions", "about", "mouse", ",", "CD", "-", "ROM", ",", "ftape", ",", "etc", ".", "support", ")", ".", "Questions", "about", "options", "for", "sound", "will", "then", "be", "asked", ".", "After", "configuring", "the", "kernel", "and", "sound", "driver", "and", "compile", "the", "kernel", "following", "instructions", "in", "the", "kernel", "README", ".", "The", "sound", "driver", "configuration", "dialog", "Sound", "configuration", "starts", "by", "making", "some", "yes", "/", "no", "questions", ".", "Be", "careful", "when", "answering", "to", "these", "questions", "since", "answering", "y", "to", "a", "question", "may", "prevent", "some", "later", "ones", "from", "being", "asked", ".", "For", "example", "don", "'", "t", "answer", "y", "to", "the", "first", "question", "(", "PAS16", ")", "if", "you", "don", "'", "t", "really", "have", "a", "PAS16", ".", "Don", "'", "t", "enable", "more", "cards", "than", "you", "really", "need", "since", "they", "just", "consume", "memory", ".", "Also", "some", "drivers", "(", "like", "MPU401", ")", "may", "conflict", "with", "your", "SCSI", "controller", "and", "prevent", "kernel", "from", "booting", ".", "If", "you", "card", "was", "in", "the", "list", "of", "supported", "cards", "(", "above", ")", ",", "please", "look", "at", "the", "card", "specific", "config", "instructions", "(", "later", "in", "this", "file", ")", "before", "starting", "to", "configure", ".", "Some", "cards", "must", "be", "configured", "in", "way", "which", "is", "not", "obvious", ".", "So", "here", "is", "the", "beginning", "of", "the", "config", "dialog", ".", "Answer", "'", "y", "'", "or", "'", "n", "'", "to", "these", "questions", ".", "The", "default", "answer", "is", "shown", "so", "that", "(", "y", "/", "n", ")", "means", "'", "y", "'", "by", "default", "and", "(", "n", "/", "y", ")", "means", "'", "n", "'", ".", "To", "use", "the", "default", "value", ",", "just", "hit", "ENTER", ".", "But", "be", "careful", "since", "using", "the", "default", "_doesn", "'", "t_", "guarantee", "anything", ".", "Note", "also", "that", "all", "questions", "may", "not", "be", "asked", ".", "The", "configuration", "program", "may", "disable", "some", "questions", "depending", "on", "the", "earlier", "choices", ".", "It", "may", "also", "select", "some", "options", "automatically", "as", "well", ".", "\"", "ProAudioSpectrum", "16", "support", "\"", ",", "-", "Answer", "'", "y", "'", "_ONLY_", "if", "you", "have", "a", "Pro", "Audio", "Spectrum", "_16_", ",", "Pro", "Audio", "Studio", "16", "or", "Logitech", "SoundMan", "16", "(", "be", "sure", "that", "you", "read", "the", "above", "list", "correctly", ")", ".", "Don", "'", "t", "answer", "'", "y", "'", "if", "you", "have", "some", "other", "card", "made", "by", "Media", "Vision", "or", "Logitech", "since", "they", "are", "not", "PAS16", "compatible", ".", "NOTE", "!", "Since", "3", ".", "5", "-", "beta10", "you", "need", "to", "enable", "SB", "support", "(", "next", "question", ")", "if", "you", "want", "to", "use", "the", "SB", "emulation", "of", "PAS16", ".", "It", "'", "s", "also", "possible", "to", "the", "emulation", "if", "you", "want", "to", "use", "a", "true", "SB", "card", "together", "with", "PAS16", "(", "there", "is", "another", "question", "about", "this", "that", "is", "asked", "later", ")", ".", "\"", "Sound", "Blaster", "support", "\"", ",", "-", "Answer", "'", "y", "'", "if", "you", "have", "an", "original", "SB", "card", "made", "by", "Creative", "Labs", "or", "a", "full", "100", "%", "hardware", "compatible", "clone", "(", "like", "Thunderboard", "or", "SM", "Games", ")", ".", "If", "your", "card", "was", "in", "the", "list", "of", "supported", "cards", "(", "above", ")", ",", "please", "look", "at", "the", "card", "specific", "instructions", "later", "in", "this", "file", "before", "answering", "this", "question", ".", "For", "an", "unknown", "card", "you", "may", "answer", "'", "y", "'", "if", "the", "card", "claims", "to", "be", "SB", "compatible", ".", "Enable", "this", "option", "also", "with", "PAS16", "(", "changed", "since", "v3", ".", "5", "-", "beta9", ")", ".", "Don", "'", "t", "enable", "SB", "if", "you", "have", "a", "MAD16", "or", "Mozart", "compatible", "card", ".", "\"", "Generic", "OPL2", "/", "OPL3", "FM", "synthesizer", "support", "\"", ",", "-", "Answer", "'", "y", "'", "if", "your", "card", "has", "a", "FM", "chip", "made", "by", "Yamaha", "(", "OPL2", "/", "OPL3", "/", "OPL4", ")", ".", "Answering", "'", "y", "'", "is", "usually", "a", "safe", "and", "recommended", "choice", ".", "However", "some", "cards", "may", "have", "software", "(", "TSR", ")", "FM", "emulation", ".", "Enabling", "FM", "support", "with", "these", "cards", "may", "cause", "trouble", ".", "However", "I", "don", "'", "t", "currently", "know", "such", "cards", ".", "\"", "Gravis", "Ultrasound", "support", "\"", ",", "-", "Answer", "'", "y", "'", "if", "you", "have", "GUS", "or", "GUS", "MAX", ".", "Answer", "'", "n", "'", "if", "you", "don", "'", "t", "have", "GUS", "since", "the", "GUS", "driver", "consumes", "much", "memory", ".", "Currently", "I", "don", "'", "t", "have", "experiences", "with", "the", "GUS", "ACE", "so", "I", "don", "'", "t", "know", "what", "to", "answer", "with", "it", ".", "\"", "MPU", "-", "401", "support", "(", "NOT", "for", "SB16", ")", "\",", "-", "Be", "careful", "with", "this", "question", ".", "The", "MPU401", "interface", "is", "supported", "by", "almost", "any", "sound", "card", "today", ".", "However", "some", "natively", "supported", "cards", "have", "their", "own", "driver", "for", "MPU401", ".", "Enabling", "the", "MPU401", "option", "with", "these", "cards", "will", "cause", "a", "conflict", ".", "Also", "enabling", "MPU401", "on", "a", "system", "that", "doesn", "'", "t", "really", "have", "a", "MPU401", "could", "cause", "some", "trouble", ".", "If", "your", "card", "was", "in", "the", "list", "of", "supported", "cards", "(", "above", ")", ",", "please", "look", "at", "the", "card", "specific", "instructions", "later", "in", "this", "file", ".", "In", "MOST", "cases", "this", "MPU401", "driver", "should", "only", "be", "used", "with", "\"", "true", "\"", "MIDI", "-", "only", "MPU401", "professional", "cards", ".", "In", "most", "other", "cases", "there", "is", "another", "way", "to", "get", "the", "MPU401", "compatible", "interface", "of", "a", "sound", "card", "to", "work", ".", "Support", "for", "the", "MPU401", "compatible", "MIDI", "port", "of", "SB16", ",", "ESS1688", "and", "MV", "Jazz16", "cards", "is", "included", "in", "the", "SB", "driver", ".", "Use", "it", "instead", "of", "this", "separate", "MPU401", "driver", "with", "these", "cards", ".", "As", "well", "Soundscape", ",", "PSS", "and", "Maui", "drivers", "include", "their", "own", "MPU401", "options", ".", "It", "'", "s", "safe", "to", "answer", "'", "y", "'", "if", "you", "have", "a", "true", "MPU401", "MIDI", "interface", "card", ".", "\"", "6850", "UART", "Midi", "support", "\"", ",", "-", "It", "'", "s", "safe", "to", "answer", "'", "n", "'", "to", "this", "question", "in", "all", "cases", ".", "The", "6850", "UART", "interface", "is", "so", "rarely", "used", ".", "\"", "PSS", "(", "ECHO", "-", "ADI2111", ")", "support", "\"", ",", "-", "Answer", "'", "y", "'", "only", "if", "you", "have", "Orchid", "SW32", ",", "Cardinal", "DSP16", "or", "some", "other", "card", "based", "on", "the", "PSS", "chipset", "(", "AD1848", "codec", "+", "ADSP", "-", "2115", "DSP", "chip", "+", "Echo", "ESC614", "ASIC", "CHIP", ")", ".", "\"", "16", "bit", "sampling", "option", "of", "GUS", "(", "_NOT_", "GUS", "MAX", ")", "\",", "-", "Answer", "'", "y", "'", "if", "you", "have", "installed", "the", "16", "bit", "sampling", "daughtercard", "to", "your", "GUS", ".", "Answer", "'", "n", "'", "if", "you", "have", "GUS", "MAX", ".", "Enabling", "this", "option", "disables", "GUS", "MAX", "support", ".", "\"", "GUS", "MAX", "support", "\"", ",", "-", "Answer", "'", "y", "'", "only", "if", "you", "have", "a", "GUS", "MAX", ".", "\"", "Microsoft", "Sound", "System", "support", "\"", ",", "-", "Again", "think", "carefully", "before", "answering", "'", "y", "'", "to", "this", "question", ".", "It", "'", "s", "safe", "to", "answer", "'", "y", "'", "in", "case", "you", "have", "the", "original", "Windows", "Sound", "System", "card", "made", "by", "Microsoft", "or", "Aztech", "SG", "16", "Pro", "(", "or", "NX16", "Pro", ")", ".", "Also", "you", "may", "answer", "'", "y", "'", "in", "case", "your", "card", "was", "not", "listed", "earlier", "in", "this", "file", ".", "For", "cards", "having", "native", "support", "in", "the", "driver", ",", "consult", "the", "card", "specific", "instructions", "later", "in", "this", "file", ".", "Some", "drivers", "have", "their", "own", "MSS", "support", "and", "enabling", "this", "option", "will", "cause", "a", "conflict", ".", "Note", "!", "The", "MSS", "driver", "permits", "configuring", "two", "DMA", "channels", ".", "This", "is", "a", "\"", "nonstandard", "\"", "feature", "and", "works", "only", "with", "very", "few", "cards", "(", "if", "any", ")", ".", "In", "most", "cases", "the", "second", "DMA", "channel", "should", "be", "disabled", "or", "set", "to", "the", "same", "channel", "than", "the", "first", "one", ".", "Trying", "to", "configure", "two", "separate", "channels", "with", "cards", "that", "don", "'", "t", "support", "this", "feature", "will", "prevent", "audio", "(", "at", "least", "recording", ")", "from", "working", ".", "\"", "Ensoniq", "Soundscape", "support", "\"", ",", "-", "Answer", "'", "y", "'", "if", "you", "have", "a", "sound", "card", "based", "on", "the", "Ensoniq", "SoundScape", "chipset", ".", "Such", "cards", "are", "being", "manufactured", "at", "least", "by", "Ensoniq", ",", "Spea", "and", "Reveal", "(", "note", "that", "Reveal", "makes", "other", "cards", "also", ")", ".", "The", "oldest", "cards", "made", "by", "Spea", "don", "'", "t", "work", "properly", "with", "Linux", ".", "Soundscape", "PnP", "as", "well", "as", "Ensoniq", "VIVO", "work", "only", "with", "the", "commercial", "OSS", "/", "Linux", "version", ".", "\"", "MediaTrix", "AudioTrix", "Pro", "support", "\"", ",", "-", "Answer", "'", "y", "'", "if", "you", "have", "the", "AudioTrix", "Pro", ".", "\"", "Support", "for", "MAD16", "and", "/", "or", "Mozart", "based", "cards", "\"", ",", "-", "Answer", "y", "if", "your", "card", "has", "a", "Mozart", "(", "OAK", "OTI", "-", "601", ")", "or", "MAD16", "(", "OPTi", "82C928", ",", "82C929", ",", "82C924", "/", "82C925", "or", "82C930", ")", "audio", "interface", "chip", ".", "These", "chips", "are", "currently", "quite", "common", "so", "it", "'", "s", "possible", "that", "many", "no", "-", "name", "cards", "have", "one", "of", "them", ".", "In", "addition", "the", "MAD16", "chip", "is", "used", "in", "some", "cards", "made", "by", "known", "manufacturers", "such", "as", "Turtle", "Beach", "(", "Tropez", ")", ",", "Reveal", "(", "some", "models", ")", "and", "Diamond", "(", "some", "recent", "models", ")", ".", "Note", "OPTi", "82C924", "and", "82C925", "are", "MAD16", "compatible", "only", "in", "non", "PnP", "mode", "(", "jumper", "selectable", "on", "many", "cards", ")", ".", "\"", "Support", "for", "TB", "Maui", "\"", "-", "This", "enables", "TB", "Maui", "specific", "initialization", ".", "Works", "with", "TB", "Maui", "and", "TB", "Tropez", "(", "may", "not", "work", "with", "Tropez", "Plus", ")", ".", "Then", "the", "configuration", "program", "asks", "some", "y", "/", "n", "questions", "about", "the", "higher", "level", "services", ".", "It", "'", "s", "recommended", "to", "answer", "'", "y", "'", "to", "each", "of", "these", "questions", ".", "Answer", "'", "n", "'", "only", "if", "you", "know", "you", "will", "not", "need", "the", "option", ".", "\"", "MIDI", "interface", "support", "\"", ",", "-", "Answering", "'", "n", "'", "disables", "/", "dev", "/", "midi", "#", "#", "devices", "and", "access", "to", "any", "MIDI", "ports", "using", "/", "dev", "/", "sequencer", "and", "/", "dev", "/", "music", ".", "This", "option", "also", "affects", "any", "MPU401", "and", "/", "or", "General", "MIDI", "compatible", "devices", ".", "\"", "FM", "synthesizer", "(", "YM3812", "/", "OPL", "-", "3", ")", "support", "\"", ",", "-", "Answer", "'", "y", "'", "here", ".", "\"", "/", "dev", "/", "sequencer", "support", "\"", ",", "-", "Answering", "'", "n", "'", "disables", "/", "dev", "/", "sequencer", "and", "/", "dev", "/", "music", ".", "Entering", "the", "I", "/", "O", ",", "IRQ", "and", "DMA", "config", "parameters", "After", "the", "above", "questions", "the", "configuration", "program", "prompts", "for", "the", "card", "specific", "configuration", "information", ".", "Usually", "just", "a", "set", "of", "I", "/", "O", "address", ",", "IRQ", "and", "DMA", "numbers", "are", "asked", ".", "With", "some", "cards", "the", "program", "asks", "for", "some", "files", "to", "be", "used", "during", "initialization", "of", "the", "card", ".", "For", "example", "many", "cards", "have", "a", "DSP", "chip", "or", "microprocessor", "which", "must", "be", "initialized", "by", "downloading", "a", "program", "(", "microcode", ")", "file", "to", "the", "card", ".", "Instructions", "for", "answering", "these", "questions", "are", "given", "in", "the", "next", "section", ".", "Card", "specific", "information", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "This", "section", "gives", "additional", "instructions", "about", "configuring", "some", "cards", ".", "Please", "refer", "manual", "of", "your", "card", "for", "valid", "I", "/", "O", ",", "IRQ", "and", "DMA", "numbers", ".", "Using", "the", "same", "settings", "with", "DOS", "/", "Windows", "and", "Linux", "is", "recommended", ".", "Using", "different", "values", "could", "cause", "some", "problems", "when", "switching", "between", "different", "operating", "systems", ".", "Sound", "Blasters", "(", "the", "original", "ones", "by", "Creative", ")", "NOTE", "!", "Check", "if", "you", "have", "a", "PnP", "Sound", "Blaster", "(", "cards", "sold", "after", "summer", "1995", "are", "almost", "certainly", "PnP", "ones", ")", ".", "With", "PnP", "cards", "you", "should", "use", "isapnptools", "to", "activate", "them", "(", "see", "above", ")", ".", "It", "'", "s", "possible", "to", "configure", "these", "cards", "to", "use", "different", "I", "/", "O", ",", "IRQ", "and", "DMA", "settings", ".", "Since", "the", "possible", "/", "default", "settings", "have", "changed", "between", "various", "models", ",", "you", "have", "to", "consult", "manual", "of", "your", "card", "for", "the", "proper", "ones", ".", "It", "'", "s", "a", "good", "idea", "to", "use", "the", "same", "values", "than", "with", "DOS", "/", "Windows", ".", "With", "SB", "and", "SB", "Pro", "it", "'", "s", "the", "only", "choice", ".", "SB16", "has", "software", "selectable", "IRQ", "and", "DMA", "channels", "but", "using", "different", "values", "with", "DOS", "and", "Linux", "is", "likely", "to", "cause", "troubles", ".", "The", "DOS", "driver", "is", "not", "able", "to", "reset", "the", "card", "properly", "after", "warm", "boot", "from", "Linux", "if", "Linux", "has", "used", "different", "IRQ", "or", "DMA", "values", ".", "The", "original", "(", "steam", ")", "Sound", "Blaster", "(", "versions", "1", ".", "x", "and", "2", ".", "x", ")", "use", "always", "DMA1", ".", "There", "is", "no", "way", "to", "change", "it", ".", "The", "SB16", "needs", "two", "DMA", "channels", ".", "A", "8", "bit", "one", "(", "1", "or", "3", ")", "is", "required", "for", "8", "bit", "operation", "and", "a", "16", "bit", "one", "(", "5", ",", "6", "or", "7", ")", "for", "the", "16", "bit", "mode", ".", "In", "theory", "it", "'", "s", "possible", "to", "use", "just", "one", "(", "8", "bit", ")", "DMA", "channel", "by", "answering", "the", "8", "bit", "one", "when", "the", "configuration", "program", "asks", "for", "the", "16", "bit", "one", ".", "This", "may", "work", "in", "some", "systems", "but", "is", "likely", "to", "cause", "terrible", "noise", "on", "some", "other", "systems", ".", "It", "'", "s", "possible", "to", "use", "two", "SB16", "/", "32", "/", "64", "at", "the", "same", "time", ".", "To", "do", "this", "you", "should", "first", "configure", "OSS", "/", "Free", "for", "one", "card", ".", "Then", "edit", "local", ".", "h", "manually", "and", "define", "SB2_BASE", ",", "SB2_IRQ", ",", "SB2_DMA", "and", "SB2_DMA2", "for", "the", "second", "one", ".", "You", "can", "'", "t", "get", "the", "OPL3", ",", "MIDI", "and", "EMU8000", "devices", "of", "the", "second", "card", "to", "work", ".", "If", "you", "are", "going", "to", "use", "two", "PnP", "Sound", "Blasters", ",", "ensure", "that", "they", "are", "of", "different", "model", "and", "have", "different", "PnP", "IDs", ".", "There", "is", "no", "way", "to", "get", "two", "cards", "with", "the", "same", "card", "ID", "and", "serial", "number", "to", "work", ".", "The", "easiest", "way", "to", "check", "this", "is", "trying", "if", "isapnptools", "can", "see", "both", "cards", "or", "just", "one", ".", "NOTE", "!", "Don", "'", "t", "enable", "the", "SM", "Games", "option", "(", "asked", "by", "the", "configuration", "program", ")", "if", "you", "are", "not", "101", "%", "sure", "that", "your", "card", "is", "a", "Logitech", "Soundman", "Games", "(", "not", "a", "SM", "Wave", "or", "SM16", ")", ".", "SB", "Clones", "First", "of", "all", ":", "There", "are", "no", "SB16", "clones", ".", "There", "are", "SB", "Pro", "clones", "with", "a", "16", "bit", "mode", "which", "is", "not", "SB16", "compatible", ".", "The", "most", "likely", "alternative", "is", "that", "the", "16", "bit", "mode", "means", "MSS", "/", "WSS", ".", "There", "are", "just", "a", "few", "fully", "100", "%", "hardware", "SB", "or", "SB", "Pro", "compatible", "cards", ".", "I", "know", "just", "Thunderboard", "and", "SM", "Games", ".", "Other", "cards", "require", "some", "kind", "of", "hardware", "initialization", "before", "they", "become", "SB", "compatible", ".", "Check", "if", "your", "card", "was", "listed", "in", "the", "beginning", "of", "this", "file", ".", "In", "this", "case", "you", "should", "follow", "instructions", "for", "your", "card", "later", "in", "this", "file", ".", "For", "other", "not", "fully", "SB", "clones", "you", "may", "try", "initialization", "using", "DOS", "in", "the", "following", "way", ":", "-", "Boot", "DOS", "so", "that", "the", "card", "specific", "driver", "gets", "run", ".", "-", "Hit", "ctrl", "-", "alt", "-", "del", "(", "or", "use", "loadlin", ")", "to", "boot", "Linux", ".", "Don", "'", "t", "switch", "off", "power", "or", "press", "the", "reset", "button", ".", "-", "If", "you", "use", "the", "same", "I", "/", "O", ",", "IRQ", "and", "DMA", "settings", "in", "Linux", ",", "the", "card", "should", "work", ".", "If", "your", "card", "is", "both", "SB", "and", "MSS", "compatible", ",", "I", "recommend", "using", "the", "MSS", "mode", ".", "Most", "cards", "of", "this", "kind", "are", "not", "able", "to", "work", "in", "the", "SB", "and", "the", "MSS", "mode", "simultaneously", ".", "Using", "the", "MSS", "mode", "provides", "16", "bit", "recording", "and", "playback", ".", "ProAudioSpectrum", "16", "and", "compatibles", "PAS16", "has", "a", "SB", "emulation", "chip", "which", "can", "be", "used", "together", "with", "the", "native", "(", "16", "bit", ")", "mode", "of", "the", "card", ".", "To", "enable", "this", "emulation", "you", "should", "configure", "the", "driver", "to", "have", "SB", "support", "too", "(", "this", "has", "been", "changed", "since", "version", "3", ".", "5", "-", "beta9", "of", "this", "driver", ")", ".", "With", "current", "driver", "versions", "it", "'", "s", "also", "possible", "to", "use", "PAS16", "together", "with", "another", "SB", "compatible", "card", ".", "In", "this", "case", "you", "should", "configure", "SB", "support", "for", "the", "other", "card", "and", "to", "disable", "the", "SB", "emulation", "of", "PAS16", "(", "there", "is", "a", "separate", "questions", "about", "this", ")", ".", "With", "PAS16", "you", "can", "use", "two", "audio", "device", "files", "at", "the", "same", "time", ".", "/", "dev", "/", "dsp", "(", "and", "/", "dev", "/", "audio", ")", "is", "connected", "to", "the", "8", "/", "16", "bit", "native", "codec", "and", "the", "/", "dev", "/", "dsp1", "(", "and", "/", "dev", "/", "audio1", ")", "is", "connected", "to", "the", "SB", "emulation", "(", "8", "bit", "mono", "only", ")", ".", "Gravis", "Ultrasound", "There", "are", "many", "different", "revisions", "of", "the", "Ultrasound", "card", "(", "GUS", ")", ".", "The", "earliest", "ones", "(", "pre", "3", ".", "7", ")", "don", "'", "t", "have", "a", "hardware", "mixer", ".", "With", "these", "cards", "the", "driver", "uses", "a", "software", "emulation", "for", "synth", "and", "pcm", "playbacks", ".", "It", "'", "s", "also", "possible", "to", "switch", "some", "of", "the", "inputs", "(", "line", "in", ",", "mic", ")", "off", "by", "setting", "mixer", "volume", "of", "the", "channel", "level", "below", "10", "%", ".", "For", "recording", "you", "have", "to", "select", "the", "channel", "as", "a", "recording", "source", "and", "to", "use", "volume", "above", "10", "%", ".", "GUS", "3", ".", "7", "has", "a", "hardware", "mixer", ".", "GUS", "MAX", "and", "the", "16", "bit", "sampling", "daughtercard", "have", "a", "CS4231", "codec", "chip", "which", "also", "contains", "a", "mixer", ".", "Configuring", "GUS", "is", "simple", ".", "Just", "enable", "the", "GUS", "support", "and", "GUS", "MAX", "or", "the", "16", "bit", "daughtercard", "if", "you", "have", "them", ".", "Note", "that", "enabling", "the", "daughter", "card", "disables", "GUS", "MAX", "driver", ".", "NOTE", "for", "owners", "of", "the", "16", "bit", "daughtercard", ":", "By", "default", "the", "daughtercard", "uses", "/", "dev", "/", "dsp", "(", "and", "/", "dev", "/", "audio", ")", ".", "Command", "\"", "ln", "-", "sf", "/", "dev", "/", "dsp1", "/", "dev", "/", "dsp", "\"", "selects", "the", "daughter", "card", "as", "the", "default", "device", ".", "With", "just", "the", "standard", "GUS", "enabled", "the", "configuration", "program", "prompts", "for", "the", "I", "/", "O", ",", "IRQ", "and", "DMA", "numbers", "for", "the", "card", ".", "Use", "the", "same", "values", "than", "with", "DOS", ".", "With", "the", "daughter", "card", "option", "enabled", "you", "will", "be", "prompted", "for", "the", "I", "/", "O", ",", "IRQ", "and", "DMA", "numbers", "for", "the", "daughter", "card", ".", "You", "have", "to", "use", "different", "I", "/", "O", "and", "DMA", "values", "than", "for", "the", "standard", "GUS", ".", "The", "daughter", "card", "permits", "simultaneous", "recording", "and", "playback", ".", "Use", "/", "dev", "/", "dsp", "(", "the", "daughtercard", ")", "for", "recording", "and", "/", "dev", "/", "dsp1", "(", "GUS", "GF1", ")", "for", "playback", ".", "GUS", "MAX", "uses", "the", "same", "I", "/", "O", "address", "and", "IRQ", "settings", "than", "the", "original", "GUS", "(", "GUS", "MAX", "=", "GUS", "+", "a", "CS4231", "codec", ")", ".", "In", "addition", "an", "extra", "DMA", "channel", "may", "be", "used", ".", "Using", "two", "DMA", "channels", "permits", "simultaneous", "playback", "using", "two", "devices", "(", "dev", "/", "dsp0", "and", "/", "dev", "/", "dsp1", ")", ".", "The", "second", "DMA", "channel", "is", "required", "for", "full", "duplex", "audio", ".", "To", "enable", "the", "second", "DMA", "channels", ",", "give", "a", "valid", "DMA", "channel", "when", "the", "config", "program", "asks", "for", "the", "GUS", "MAX", "DMA", "(", "entering", "-", "1", "disables", "the", "second", "DMA", ")", ".", "Using", "16", "bit", "DMA", "channels", "(", "5", ",", "6", "or", "7", ")", "is", "recommended", ".", "If", "you", "have", "problems", "in", "recording", "with", "GUS", "MAX", ",", "you", "could", "try", "to", "use", "just", "one", "8", "bit", "DMA", "channel", ".", "Recording", "will", "not", "work", "with", "one", "DMA", "channel", "if", "it", "'", "s", "a", "16", "bit", "one", ".", "Microphone", "input", "of", "GUS", "MAX", "is", "connected", "to", "mixer", "in", "little", "bit", "nonstandard", "way", ".", "There", "is", "actually", "two", "microphone", "volume", "controls", ".", "Normal", "\"", "mic", "\"", "controls", "only", "recording", "level", ".", "Mixer", "control", "\"", "speaker", "\"", "is", "used", "to", "control", "volume", "of", "microphone", "signal", "connected", "directly", "to", "line", "/", "speaker", "out", ".", "So", "just", "decrease", "volume", "of", "\"", "speaker", "\"", "if", "you", "have", "problems", "with", "microphone", "feedback", ".", "GUS", "ACE", "works", "too", "but", "any", "attempt", "to", "record", "or", "to", "use", "the", "MIDI", "port", "will", "fail", ".", "GUS", "PnP", "(", "with", "RAM", ")", "is", "partially", "supported", "but", "it", "needs", "to", "be", "initialized", "using", "DOS", "or", "isapnptools", "before", "starting", "the", "driver", ".", "MPU401", "and", "Windows", "Sound", "System", "Again", ".", "Don", "'", "t", "enable", "these", "options", "in", "case", "your", "card", "is", "listed", "somewhere", "else", "in", "this", "file", ".", "Configuring", "these", "cards", "is", "obvious", "(", "or", "it", "should", "be", ")", ".", "With", "MSS", "you", "should", "probably", "enable", "the", "OPL3", "synth", "also", "since", "most", "MSS", "compatible", "cards", "have", "it", ".", "However", "check", "that", "this", "is", "true", "before", "enabling", "OPL3", ".", "Sound", "driver", "supports", "more", "than", "one", "MPU401", "compatible", "cards", "at", "the", "same", "time", "but", "the", "config", "program", "asks", "config", "info", "for", "just", "the", "first", "of", "them", ".", "Adding", "the", "second", "or", "third", "MPU", "interfaces", "must", "be", "done", "manually", "by", "editing", "sound", "/", "local", ".", "h", "(", "after", "running", "the", "config", "program", ")", ".", "Add", "defines", "for", "MPU2_BASE", "&", "MPU2_IRQ", "(", "and", "MPU3_BASE", "&", "MPU3_IRQ", ")", "to", "the", "file", ".", "CAUTION", "!", "The", "default", "I", "/", "O", "base", "of", "Adaptec", "AHA", "-", "1542", "SCSI", "controller", "is", "0x330", "which", "is", "also", "the", "default", "of", "the", "MPU401", "driver", ".", "Don", "'", "t", "configure", "the", "sound", "driver", "to", "use", "0x330", "as", "the", "MPU401", "base", "if", "you", "have", "a", "AHA1542", ".", "The", "kernel", "will", "not", "boot", "if", "you", "make", "this", "mistake", ".", "PSS", "Even", "the", "PSS", "cards", "are", "compatible", "with", "SB", ",", "MSS", "and", "MPU401", ",", "you", "must", "not", "enable", "these", "options", "when", "configuring", "the", "driver", ".", "The", "configuration", "program", "handles", "these", "options", "itself", ".", "(", "You", "may", "use", "the", "SB", ",", "MPU", "and", "MSS", "options", "together", "with", "PSS", "if", "you", "have", "another", "card", "on", "the", "system", ")", ".", "The", "PSS", "driver", "enables", "MSS", "and", "MPU401", "modes", "of", "the", "card", ".", "SB", "is", "not", "enabled", "since", "it", "doesn", "'", "t", "work", "concurrently", "with", "MSS", ".", "The", "driver", "loads", "also", "a", "DSP", "algorithm", "which", "is", "used", "to", "for", "the", "general", "MIDI", "emulation", ".", "The", "algorithm", "file", "(", ".", "ld", ")", "is", "read", "by", "the", "config", "program", "and", "written", "to", "a", "file", "included", "when", "the", "pss", ".", "c", "is", "compiled", ".", "For", "this", "reason", "the", "config", "program", "asks", "if", "you", "want", "to", "download", "the", "file", ".", "Use", "the", "genmidi", ".", "ld", "file", "distributed", "with", "the", "DOS", "/", "Windows", "drivers", "of", "the", "card", "(", "don", "'", "t", "use", "the", "mt32", ".", "ld", ")", ".", "With", "some", "cards", "the", "file", "is", "called", "'", "synth", ".", "ld", "'", ".", "You", "must", "have", "access", "to", "the", "file", "when", "configuring", "the", "driver", ".", "The", "easiest", "way", "is", "to", "mount", "the", "DOS", "partition", "containing", "the", "file", "with", "Linux", ".", "It", "'", "s", "possible", "to", "load", "your", "own", "DSP", "algorithms", "and", "run", "them", "with", "the", "card", ".", "Look", "at", "the", "directory", "pss_test", "of", "snd", "-", "util", "-", "3", ".", "0", ".", "tar", ".", "gz", "for", "more", "info", ".", "AudioTrix", "Pro", "You", "have", "to", "enable", "the", "OPL3", "and", "SB", "(", "not", "SB", "Pro", "or", "SB16", ")", "drivers", "in", "addition", "to", "the", "native", "AudioTrix", "driver", ".", "Don", "'", "t", "enable", "MSS", "or", "MPU", "drivers", ".", "Configuring", "ATP", "is", "little", "bit", "tricky", "since", "it", "uses", "so", "many", "I", "/", "O", ",", "IRQ", "and", "DMA", "numbers", ".", "Using", "the", "same", "values", "than", "with", "DOS", "/", "Win", "is", "a", "good", "idea", ".", "Don", "'", "t", "attempt", "to", "use", "the", "same", "IRQ", "or", "DMA", "channels", "twice", ".", "The", "SB", "mode", "of", "ATP", "is", "implemented", "so", "the", "ATP", "driver", "just", "enables", "SB", "in", "the", "proper", "address", ".", "The", "SB", "driver", "handles", "the", "rest", ".", "You", "have", "to", "configure", "both", "the", "SB", "driver", "and", "the", "SB", "mode", "of", "ATP", "to", "use", "the", "same", "IRQ", ",", "DMA", "and", "I", "/", "O", "settings", ".", "Also", "the", "ATP", "has", "a", "microcontroller", "for", "the", "General", "MIDI", "emulation", "(", "OPL4", ")", ".", "For", "this", "reason", "the", "driver", "asks", "for", "the", "name", "of", "a", "file", "containing", "the", "microcode", "(", "TRXPRO", ".", "HEX", ")", ".", "This", "file", "is", "usually", "located", "in", "the", "directory", "where", "the", "DOS", "drivers", "were", "installed", ".", "You", "must", "have", "access", "to", "this", "file", "when", "configuring", "the", "driver", ".", "If", "you", "have", "the", "effects", "daughtercard", ",", "it", "must", "be", "initialized", "by", "running", "the", "setfx", "program", "of", "snd", "-", "util", "-", "3", ".", "0", ".", "tar", ".", "gz", "package", ".", "This", "step", "is", "not", "required", "when", "using", "the", "(", "future", ")", "binary", "distribution", "version", "of", "the", "driver", ".", "Ensoniq", "SoundScape", "NOTE", "!", "The", "new", "PnP", "SoundScape", "is", "not", "supported", "yet", ".", "Soundscape", "compatible", "cards", "made", "by", "Reveal", "don", "'", "t", "work", "with", "Linux", ".", "They", "use", "older", "revision", "of", "the", "Soundscape", "chipset", "which", "is", "not", "fully", "compatible", "with", "newer", "cards", "made", "by", "Ensoniq", ".", "The", "SoundScape", "driver", "handles", "initialization", "of", "MSS", "and", "MPU", "supports", "itself", "so", "you", "don", "'", "t", "need", "to", "enable", "other", "drivers", "than", "SoundScape", "(", "enable", "also", "the", "/", "dev", "/", "dsp", ",", "/", "dev", "/", "sequencer", "and", "MIDI", "supports", ")", ".", "!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!", "!", "!!", "!!", "!", "!!", "!", "!", "!!", "!!", "NOTE", "!", "Before", "version", "3", ".", "5", "-", "beta6", "there", "WERE", "two", "sets", "of", "audio", "!", "!!", "!", "!", "!!", "!!", "device", "files", "(", "/", "dev", "/", "dsp0", "and", "/", "dev", "/", "dsp1", ")", ".", "The", "first", "one", "WAS", "!", "!!", "!", "!", "!!", "!!", "used", "only", "for", "card", "initialization", "and", "the", "second", "for", "audio", "!", "!!", "!", "!", "!!", "!!", "purposes", ".", "It", "WAS", "required", "to", "change", "/", "dev", "/", "dsp", "(", "a", "symlink", ")", "to", "!", "!!", "!", "!", "!!", "!!", "point", "to", "/", "dev", "/", "dsp1", ".", "!", "!!", "!", "!", "!!", "!!", "!", "!!", "!", "!", "!!", "!!", "This", "is", "not", "required", "with", "OSS", "versions", "3", ".", "5", "-", "beta6", "and", "later", "!", "!!", "!", "!", "!!", "!!", "since", "there", "is", "now", "just", "one", "audio", "device", "file", ".", "Please", "!", "!!", "!", "!", "!!", "!!", "change", "/", "dev", "/", "dsp", "to", "point", "back", "to", "/", "dev", "/", "dsp0", "if", "you", "are", "!", "!!", "!", "!", "!!", "!!", "upgrading", "from", "an", "earlier", "driver", "version", "using", "!", "!!", "!", "!", "!!", "!!", "(", "cd", "/", "dev", ";", "rm", "dsp", ";", "ln", "-", "s", "dsp0", "dsp", ")", ".", "!", "!!", "!", "!", "!!", "!!", "!", "!!", "!", "!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!!", "!", "The", "configuration", "program", "asks", "one", "DMA", "channel", "and", "two", "interrupts", ".", "One", "IRQ", "and", "one", "DMA", "is", "used", "by", "the", "MSS", "codec", ".", "The", "second", "IRQ", "is", "required", "for", "the", "MPU401", "mode", "(", "you", "have", "to", "use", "different", "IRQs", "for", "both", "purposes", ")", ".", "There", "were", "earlier", "two", "DMA", "channels", "for", "SoundScape", "but", "the", "current", "driver", "version", "requires", "just", "one", ".", "The", "SoundScape", "card", "has", "a", "Motorola", "microcontroller", "which", "must", "initialized", "_after_", "boot", "(", "the", "driver", "doesn", "'", "t", "initialize", "it", "during", "boot", ")", ".", "The", "initialization", "is", "done", "by", "running", "the", "'", "ssinit", "'", "program", "which", "is", "distributed", "in", "the", "snd", "-", "util", "-", "3", ".", "0", ".", "tar", ".", "gz", "package", ".", "You", "have", "to", "edit", "two", "defines", "in", "the", "ssinit", ".", "c", "and", "then", "compile", "the", "program", ".", "You", "may", "run", "ssinit", "manually", "(", "after", "each", "boot", ")", "or", "add", "it", "to", "/", "etc", "/", "rc", ".", "d", "/", "rc", ".", "local", ".", "The", "ssinit", "program", "needs", "the", "microcode", "file", "that", "comes", "with", "the", "DOS", "/", "Windows", "driver", "of", "the", "card", ".", "You", "will", "need", "to", "use", "version", "1", ".", "30", ".", "00", "or", "later", "of", "the", "microcode", "file", "(", "sndscape", ".", "co0", "or", "sndscape", ".", "co1", "depending", "on", "your", "card", "model", ")", ".", "THE", "OLD", "sndscape", ".", "cod", "WILL", "NOT", "WORK", ".", "IT", "WILL", "HANG", "YOUR", "MACHINE", ".", "The", "only", "way", "to", "get", "the", "new", "microcode", "file", "is", "to", "download", "and", "install", "the", "DOS", "/", "Windows", "driver", "from", "ftp", ":", "//", "ftp", ".", "ensoniq", ".", "com", "/", "pub", ".", "Then", "you", "have", "to", "select", "the", "proper", "microcode", "file", "to", "use", ":", "soundscape", ".", "co0", "is", "the", "right", "one", "for", "most", "cards", "and", "sndscape", ".", "co1", "is", "for", "few", "(", "older", ")", "cards", "made", "by", "Reveal", "and", "/", "or", "Spea", ".", "The", "driver", "has", "capability", "to", "detect", "the", "card", "version", "during", "boot", ".", "Look", "at", "the", "boot", "log", "messages", "in", "/", "var", "/", "adm", "/", "messages", "and", "locate", "the", "sound", "driver", "initialization", "message", "for", "the", "SoundScape", "card", ".", "If", "the", "driver", "displays", "string", "<", "Ensoniq", "Soundscape", "(", "old", ")", ">,", "you", "have", "an", "old", "card", "and", "you", "will", "need", "to", "use", "sndscape", ".", "co1", ".", "For", "other", "cards", "use", "soundscape", ".", "co0", ".", "New", "Soundscape", "revisions", "such", "as", "Elite", "and", "PnP", "use", "code", "files", "with", "higher", "numbers", "(", ".", "co2", ",", ".", "co3", ",", "etc", ".", ").", "NOTE", "!", "Ensoniq", "Soundscape", "VIVO", "is", "not", "compatible", "with", "other", "Soundscape", "cards", ".", "Currently", "it", "'", "s", "possible", "to", "use", "it", "in", "Linux", "only", "with", "OSS", "/", "Linux", "drivers", ".", "Check", "/", "var", "/", "adm", "/", "messages", "after", "running", "ssinit", ".", "The", "driver", "prints", "the", "board", "version", "after", "downloading", "the", "microcode", "file", ".", "That", "version", "number", "must", "match", "the", "number", "in", "the", "name", "of", "the", "microcode", "file", "(", "extension", ")", ".", "Running", "ssinit", "with", "a", "wrong", "version", "of", "the", "sndscape", ".", "co", "?", "file", "is", "not", "dangerous", "as", "long", "as", "you", "don", "'", "t", "try", "to", "use", "a", "file", "called", "sndscape", ".", "cod", ".", "If", "you", "have", "initialized", "the", "card", "using", "a", "wrong", "microcode", "file", "(", "sounds", "are", "terrible", ")", ",", "just", "modify", "ssinit", ".", "c", "to", "use", "another", "microcode", "file", "and", "try", "again", ".", "It", "'", "s", "possible", "to", "use", "an", "earlier", "version", "of", "sndscape", ".", "co", "[", "01", "]", "but", "it", "may", "sound", "weird", ".", "MAD16", "(", "Pro", ")", "and", "Mozart", "You", "need", "to", "enable", "just", "the", "MAD16", "/", "Mozart", "support", "when", "configuring", "the", "driver", ".", "_Don", "'", "t_", "enable", "SB", ",", "MPU401", "or", "MSS", ".", "However", "you", "will", "need", "the", "/", "dev", "/", "audio", ",", "/", "dev", "/", "sequencer", "and", "MIDI", "supports", ".", "Mozart", "and", "OPTi", "82C928", "(", "the", "original", "MAD16", ")", "chips", "don", "'", "t", "support", "MPU401", "mode", "so", "enter", "just", "0", "when", "the", "configuration", "program", "asks", "the", "MPU", "/", "MIDI", "I", "/", "O", "base", ".", "The", "MAD16", "Pro", "(", "OPTi", "82C929", ")", "and", "82C930", "chips", "have", "MPU401", "mode", ".", "TB", "Tropez", "is", "based", "on", "the", "82C929", "chip", ".", "It", "has", "two", "MIDI", "ports", ".", "The", "one", "connected", "to", "the", "MAD16", "chip", "is", "the", "second", "one", "(", "there", "is", "a", "second", "MIDI", "connector", "/", "pins", "somewhere", "?", "?)", ".", "If", "you", "have", "not", "connected", "the", "second", "MIDI", "port", ",", "just", "disable", "the", "MIDI", "port", "of", "MAD16", ".", "The", "'", "Maui", "'", "compatible", "synth", "of", "Tropez", "is", "jumper", "configurable", "and", "not", "connected", "to", "the", "MAD16", "chip", "(", "the", "Maui", "driver", "can", "be", "used", "with", "it", ")", ".", "Some", "MAD16", "based", "cards", "may", "cause", "feedback", ",", "whistle", "or", "terrible", "noise", "if", "the", "line3", "mixer", "channel", "is", "turned", "too", "high", ".", "This", "happens", "at", "least", "with", "Shuttle", "Sound", "System", ".", "Current", "driver", "versions", "set", "volume", "of", "line3", "low", "enough", "so", "this", "should", "not", "be", "a", "problem", ".", "If", "you", "have", "a", "MAD16", "card", "which", "have", "an", "OPL4", "(", "FM", "+", "Wave", "table", ")", "synthesizer", "chip", "(", "_not_", "an", "OPL3", ")", ",", "you", "have", "to", "append", "a", "line", "containing", "#", "define", "MAD16_OPL4", "to", "the", "file", "linux", "/", "drivers", "/", "sound", "/", "local", ".", "h", "(", "after", "running", "make", "config", ")", ".", "MAD16", "cards", "having", "a", "CS4231", "codec", "support", "full", "duplex", "mode", ".", "This", "mode", "can", "be", "enabled", "by", "configuring", "the", "card", "to", "use", "two", "DMA", "channels", ".", "Possible", "DMA", "channel", "pairs", "are", ":", "0", "&", "1", ",", "1", "&", "0", "and", "3", "&", "0", ".", "NOTE", "!", "Cards", "having", "an", "OPTi", "82C924", "/", "82C925", "chip", "work", "with", "OSS", "/", "Free", "only", "in", "non", "-", "PnP", "mode", "(", "usually", "jumper", "selectable", ")", ".", "The", "PnP", "mode", "is", "supported", "only", "by", "OSS", "/", "Linux", ".", "MV", "Jazz", "(", "ProSonic", ")", "The", "Jazz16", "driver", "is", "just", "a", "hack", "made", "to", "the", "SB", "Pro", "driver", ".", "However", "it", "works", "fairly", "well", ".", "You", "have", "to", "enable", "SB", ",", "SB", "Pro", "(", "_not_", "SB16", ")", "and", "MPU401", "supports", "when", "configuring", "the", "driver", ".", "The", "configuration", "program", "asks", "later", "if", "you", "want", "support", "for", "MV", "Jazz16", "based", "cards", "(", "after", "asking", "SB", "base", "address", ")", ".", "Answer", "'", "y", "'", "here", "and", "the", "driver", "asks", "the", "second", "(", "16", "bit", ")", "DMA", "channel", ".", "The", "Jazz16", "driver", "uses", "the", "MPU401", "driver", "in", "a", "way", "which", "will", "cause", "problems", "if", "you", "have", "another", "MPU401", "compatible", "card", ".", "In", "this", "case", "you", "must", "give", "address", "of", "the", "Jazz16", "based", "MPU401", "interface", "when", "the", "config", "program", "prompts", "for", "the", "MPU401", "information", ".", "Then", "look", "at", "the", "MPU401", "specific", "section", "for", "instructions", "about", "configuring", "more", "than", "one", "MPU401", "cards", ".", "Logitech", "Soundman", "Wave", "Read", "the", "above", "MV", "Jazz", "specific", "instructions", "first", ".", "The", "Logitech", "SoundMan", "Wave", "(", "don", "'", "t", "confuse", "this", "with", "the", "SM16", "or", "SM", "Games", ")", "is", "a", "MV", "Jazz", "based", "card", "which", "has", "an", "additional", "OPL4", "based", "wave", "table", "synthesizer", ".", "The", "OPL4", "chip", "is", "handled", "by", "an", "on", "board", "microcontroller", "which", "must", "be", "initialized", "during", "boot", ".", "The", "config", "program", "asks", "if", "you", "have", "a", "SM", "Wave", "immediately", "after", "asking", "the", "second", "DMA", "channel", "of", "jazz16", ".", "If", "you", "answer", "'", "y", "'", ",", "the", "config", "program", "will", "ask", "name", "of", "the", "file", "containing", "code", "to", "be", "loaded", "to", "the", "microcontroller", ".", "The", "file", "is", "usually", "called", "MIDI0001", ".", "BIN", "and", "it", "'", "s", "located", "in", "the", "DOS", "/", "Windows", "driver", "directory", ".", "The", "file", "may", "also", "be", "called", "as", "TSUNAMI", ".", "BIN", "or", "something", "else", "(", "older", "cards", "?", ").", "The", "OPL4", "synth", "will", "be", "inaccessible", "without", "loading", "the", "microcontroller", "code", ".", "Also", "remember", "to", "enable", "SB", "MPU401", "support", "if", "you", "want", "to", "use", "the", "OPL4", "mode", ".", "(", "Don", "'", "t", "enable", "the", "'", "normal", "'", "MPU401", "device", "as", "with", "some", "earlier", "driver", "versions", "(", "pre", "3", ".", "5", "-", "alpha8", ")", ").", "NOTE", "!", "Don", "'", "t", "answer", "'", "y", "'", "when", "the", "driver", "asks", "about", "SM", "Games", "support", "(", "the", "next", "question", "after", "the", "MIDI0001", ".", "BIN", "name", ")", ".", "However", "answering", "'", "y", "'", "doesn", "'", "t", "cause", "damage", "your", "computer", "so", "don", "'", "t", "panic", ".", "Sound", "Galaxies", "There", "are", "many", "different", "Sound", "Galaxy", "cards", "made", "by", "Aztech", ".", "The", "8", "bit", "ones", "are", "fully", "SB", "or", "SB", "Pro", "compatible", "and", "there", "should", "be", "no", "problems", "with", "them", ".", "The", "older", "16", "bit", "cards", "(", "SG", "Pro16", ",", "SG", "NX", "Pro16", ",", "Nova", "and", "Lyra", ")", "have", "an", "EEPROM", "chip", "for", "storing", "the", "configuration", "data", ".", "There", "is", "a", "microcontroller", "which", "initializes", "the", "card", "to", "match", "the", "EEPROM", "settings", "when", "the", "machine", "is", "powered", "on", ".", "These", "cards", "actually", "behave", "just", "like", "they", "have", "jumpers", "for", "all", "of", "the", "settings", ".", "Configure", "driver", "for", "MSS", ",", "MPU", ",", "SB", "/", "SB", "Pro", "and", "OPL3", "supports", "with", "these", "cards", ".", "There", "are", "some", "new", "Sound", "Galaxies", "in", "the", "market", ".", "I", "have", "no", "experience", "with", "them", "so", "read", "the", "card", "'", "s", "manual", "carefully", ".", "ESS", "ES1688", "and", "ES688", "'", "AudioDrive", "'", "based", "cards", "Support", "for", "these", "two", "ESS", "chips", "is", "embedded", "in", "the", "SB", "driver", ".", "Configure", "these", "cards", "just", "like", "SB", ".", "Enable", "the", "'", "SB", "MPU401", "MIDI", "port", "'", "if", "you", "want", "to", "use", "MIDI", "features", "of", "ES1688", ".", "ES688", "doesn", "'", "t", "have", "MPU", "mode", "so", "you", "don", "'", "t", "need", "to", "enable", "it", "(", "the", "driver", "uses", "normal", "SB", "MIDI", "automatically", "with", "ES688", ")", ".", "NOTE", "!", "ESS", "cards", "are", "not", "compatible", "with", "MSS", "/", "WSS", "so", "don", "'", "t", "worry", "if", "MSS", "support", "of", "OSS", "doesn", "'", "t", "work", "with", "it", ".", "There", "are", "some", "ES1688", "/", "688", "based", "sound", "cards", "and", "(", "particularly", ")", "motherboards", "which", "use", "software", "configurable", "I", "/", "O", "port", "relocation", "feature", "of", "the", "chip", ".", "This", "ESS", "proprietary", "feature", "is", "supported", "only", "by", "OSS", "/", "Linux", ".", "There", "are", "ES1688", "based", "cards", "which", "use", "different", "interrupt", "pin", "assignment", "than", "recommended", "by", "ESS", "(", "5", ",", "7", ",", "9", "/", "2", "and", "10", ")", ".", "In", "this", "case", "all", "IRQs", "don", "'", "t", "work", ".", "At", "least", "a", "card", "called", "(", "Pearl", "?", ")", "Hypersound", "16", "supports", "IRQ", "15", "but", "it", "doesn", "'", "t", "work", ".", "ES1868", "is", "a", "PnP", "chip", "which", "is", "(", "supposed", "to", "be", ")", "compatible", "with", "ESS1688", "probably", "works", "with", "OSS", "/", "Free", "after", "initialization", "using", "isapnptools", ".", "Reveal", "cards", "There", "are", "several", "different", "cards", "made", "/", "marketed", "by", "Reveal", ".", "Some", "of", "them", "are", "compatible", "with", "SoundScape", "and", "some", "use", "the", "MAD16", "chip", ".", "You", "may", "have", "to", "look", "at", "the", "card", "and", "try", "to", "identify", "its", "origin", ".", "Diamond", "The", "oldest", "(", "Sierra", "Aria", "based", ")", "sound", "cards", "made", "by", "Diamond", "are", "not", "supported", "(", "they", "may", "work", "if", "the", "card", "is", "initialized", "using", "DOS", ")", ".", "The", "recent", "(", "LX", "?", ")", "models", "are", "based", "on", "the", "MAD16", "chip", "which", "is", "supported", "by", "the", "driver", ".", "Audio", "Excel", "DSP16", "Support", "for", "this", "card", "is", "currently", "not", "functional", ".", "A", "new", "driver", "for", "it", "should", "be", "available", "later", "this", "year", ".", "PCMCIA", "cards", "Sorry", ",", "can", "'", "t", "help", ".", "Some", "cards", "may", "work", "and", "some", "don", "'", "t", ".", "TI", "TM4000M", "notebooks", "These", "computers", "have", "a", "built", "in", "sound", "support", "based", "on", "the", "Jazz", "chipset", ".", "Look", "at", "the", "instructions", "for", "MV", "Jazz", "(", "above", ")", ".", "It", "'", "s", "also", "important", "to", "note", "that", "there", "is", "something", "wrong", "with", "the", "mouse", "port", "and", "sound", "at", "least", "on", "some", "TM", "models", ".", "Don", "'", "t", "enable", "the", "\"", "C", "&", "T", "82C710", "mouse", "port", "support", "\"", "when", "configuring", "Linux", ".", "Having", "it", "enabled", "is", "likely", "to", "cause", "mysterious", "problems", "and", "kernel", "failures", "when", "sound", "is", "used", ".", "miroSOUND", "The", "miroSOUND", "PCM1", "-", "pro", ",", "PCM12", "and", "PCM20", "radio", "has", "been", "used", "successfully", ".", "These", "cards", "are", "based", "on", "the", "MAD16", ",", "OPL4", ",", "and", "CS4231A", "chips", "and", "everything", "said", "in", "the", "section", "about", "MAD16", "cards", "applies", "here", ",", "too", ".", "The", "only", "major", "difference", "between", "the", "PCMxx", "and", "other", "MAD16", "cards", "is", "that", "instead", "of", "the", "mixer", "in", "the", "CS4231", "codec", "a", "separate", "mixer", "controlled", "by", "an", "on", "-", "board", "80C32", "microcontroller", "is", "used", ".", "Control", "of", "the", "mixer", "takes", "place", "via", "the", "ACI", "(", "miro", "'", "s", "audio", "control", "interface", ")", "protocol", "that", "is", "implemented", "in", "a", "separate", "lowlevel", "driver", ".", "Make", "sure", "you", "compile", "this", "ACI", "driver", "together", "with", "the", "normal", "MAD16", "support", "when", "you", "use", "a", "miroSOUND", "PCMxx", "card", ".", "The", "ACI", "mixer", "is", "controlled", "by", "/", "dev", "/", "mixer", "and", "the", "CS4231", "mixer", "by", "/", "dev", "/", "mixer1", "(", "depends", "on", "load", "time", ")", ".", "Only", "in", "special", "cases", "you", "want", "to", "change", "something", "regularly", "on", "the", "CS4231", "mixer", ".", "The", "miroSOUND", "PCM12", "and", "PCM20", "radio", "is", "capable", "of", "full", "duplex", "operation", "(", "simultaneous", "PCM", "replay", "and", "recording", ")", ",", "which", "allows", "you", "to", "implement", "nice", "real", "-", "time", "signal", "processing", "audio", "effect", "software", "and", "network", "telephones", ".", "The", "ACI", "mixer", "has", "to", "be", "switched", "into", "the", "\"", "solo", "\"", "mode", "for", "duplex", "operation", "in", "order", "to", "avoid", "feedback", "caused", "by", "the", "mixer", "(", "input", "hears", "output", "signal", ")", ".", "You", "can", "de", "-", "/", "activate", "this", "mode", "through", "toggling", "the", "record", "button", "for", "the", "wave", "controller", "with", "an", "OSS", "-", "mixer", ".", "The", "PCM20", "contains", "a", "radio", "tuner", ",", "which", "is", "also", "controlled", "by", "ACI", ".", "This", "radio", "tuner", "is", "supported", "by", "the", "ACI", "driver", "together", "with", "the", "miropcm20", ".", "o", "module", ".", "Also", "the", "7", "-", "band", "equalizer", "is", "integrated", "(", "limited", "by", "the", "OSS", "-", "design", ")", ".", "Development", "has", "started", "and", "maybe", "finished", "for", "the", "RDS", "decoder", "on", "this", "card", ",", "too", ".", "You", "will", "be", "able", "to", "read", "RadioText", ",", "the", "Programme", "Service", "name", ",", "Programme", "TYpe", "and", "others", ".", "Even", "the", "v4l", "radio", "module", "benefits", "from", "it", "with", "a", "refined", "strength", "value", ".", "See", "aci", ".", "[", "ch", "]", "and", "miropcm20", "*", ".[", "ch", "]", "for", "more", "details", ".", "The", "following", "configuration", "parameters", "have", "worked", "fine", "for", "the", "PCM12", "in", "Markus", "Kuhn", "'", "s", "system", ",", "many", "other", "configurations", "might", "work", ",", "too", ":", "CONFIG_MAD16_BASE", "=", "0x530", ",", "CONFIG_MAD16_IRQ", "=", "11", ",", "CONFIG_MAD16_DMA", "=", "3", ",", "CONFIG_MAD16_DMA2", "=", "0", ",", "CONFIG_MAD16_MPU_BASE", "=", "0x330", ",", "CONFIG_MAD16_MPU_IRQ", "=", "10", ",", "DSP_BUFFSIZE", "=", "65536", ",", "SELECTED_SOUND_OPTIONS", "=", "0x00281000", ".", "Bas", "van", "der", "Linden", "is", "using", "his", "PCM1", "-", "pro", "with", "a", "configuration", "that", "differs", "in", ":", "CONFIG_MAD16_IRQ", "=", "7", ",", "CONFIG_MAD16_DMA", "=", "1", ",", "CONFIG_MAD16_MPU_IRQ", "=", "9", "Compaq", "Deskpro", "XL", "The", "builtin", "sound", "hardware", "of", "Compaq", "Deskpro", "XL", "is", "now", "supported", ".", "You", "need", "to", "configure", "the", "driver", "with", "MSS", "and", "OPL3", "supports", "enabled", ".", "In", "addition", "you", "need", "to", "manually", "edit", "linux", "/", "drivers", "/", "sound", "/", "local", ".", "h", "and", "to", "add", "a", "line", "containing", "\"", "#", "define", "DESKPROXL", "\"", "if", "you", "used", "make", "menuconfig", "/", "xconfig", ".", "Others", "?", "Since", "there", "are", "so", "many", "different", "sound", "cards", ",", "it", "'", "s", "likely", "that", "I", "have", "forgotten", "to", "mention", "many", "of", "them", ".", "Please", "inform", "me", "if", "you", "know", "yet", "another", "card", "which", "works", "with", "Linux", ",", "please", "inform", "me", "(", "or", "is", "anybody", "else", "willing", "to", "maintain", "a", "database", "of", "supported", "cards", "(", "just", "like", "in", "XF86", ")", "?)", ".", "Cards", "not", "supported", "yet", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "Please", "check", "the", "version", "of", "sound", "driver", "you", "are", "using", "before", "complaining", "that", "your", "card", "is", "not", "supported", ".", "It", "'", "s", "possible", "you", "are", "using", "a", "driver", "version", "which", "was", "released", "months", "before", "your", "card", "was", "introduced", ".", "First", "of", "all", ",", "there", "is", "an", "easy", "way", "to", "make", "most", "sound", "cards", "work", "with", "Linux", ".", "Just", "use", "the", "DOS", "based", "driver", "to", "initialize", "the", "card", "to", "a", "known", "state", ",", "then", "use", "loadlin", ".", "exe", "to", "boot", "Linux", ".", "If", "Linux", "is", "configured", "to", "use", "the", "same", "I", "/", "O", ",", "IRQ", "and", "DMA", "numbers", "as", "DOS", ",", "the", "card", "could", "work", ".", "(", "ctrl", "-", "alt", "-", "del", "can", "be", "used", "in", "place", "of", "loadlin", ".", "exe", "but", "it", "doesn", "'", "t", "work", "with", "new", "motherboards", ")", ".", "This", "method", "works", "also", "with", "all", "/", "most", "PnP", "sound", "cards", ".", "Don", "'", "t", "get", "fooled", "with", "SB", "compatibility", ".", "Most", "cards", "are", "compatible", "with", "SB", "but", "that", "may", "require", "a", "TSR", "which", "is", "not", "possible", "with", "Linux", ".", "If", "the", "card", "is", "compatible", "with", "MSS", ",", "it", "'", "s", "a", "better", "choice", ".", "Some", "cards", "don", "'", "t", "work", "in", "the", "SB", "and", "MSS", "modes", "at", "the", "same", "time", ".", "Then", "there", "are", "cards", "which", "are", "no", "longer", "manufactured", "and", "/", "or", "which", "are", "relatively", "rarely", "used", "(", "such", "as", "the", "8", "bit", "ProAudioSpectrum", "models", ")", ".", "It", "'", "s", "extremely", "unlikely", "that", "such", "cards", "ever", "get", "supported", ".", "Adding", "support", "for", "a", "new", "card", "requires", "much", "work", "and", "increases", "time", "required", "in", "maintaining", "the", "driver", "(", "some", "changes", "need", "to", "be", "done", "to", "all", "low", "level", "drivers", "and", "be", "tested", "too", ",", "maybe", "with", "multiple", "operating", "systems", ")", ".", "For", "this", "reason", "I", "have", "made", "a", "decision", "to", "not", "support", "obsolete", "cards", ".", "It", "'", "s", "possible", "that", "someone", "else", "makes", "a", "separately", "distributed", "driver", "(", "diffs", ")", "for", "the", "card", ".", "Writing", "a", "driver", "for", "a", "new", "card", "is", "not", "possible", "if", "there", "are", "no", "programming", "information", "available", "about", "the", "card", ".", "If", "you", "don", "'", "t", "find", "your", "new", "card", "from", "this", "file", ",", "look", "from", "the", "home", "page", "(", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", ")", ".", "Then", "please", "contact", "manufacturer", "of", "the", "card", "and", "ask", "if", "they", "have", "(", "or", "are", "willing", "to", ")", "released", "technical", "details", "of", "the", "card", ".", "Do", "this", "before", "contacting", "me", ".", "I", "can", "only", "answer", "'", "no", "'", "if", "there", "are", "no", "programming", "information", "available", ".", "I", "have", "made", "decision", "to", "not", "accept", "code", "based", "on", "reverse", "engineering", "to", "the", "driver", ".", "There", "are", "three", "main", "reasons", ":", "First", "I", "don", "'", "t", "want", "to", "break", "relationships", "to", "sound", "card", "manufacturers", ".", "The", "second", "reason", "is", "that", "maintaining", "and", "supporting", "a", "driver", "without", "any", "specs", "will", "be", "a", "pain", ".", "The", "third", "reason", "is", "that", "companies", "have", "freedom", "to", "refuse", "selling", "their", "products", "to", "other", "than", "Windows", "users", ".", "Some", "companies", "don", "'", "t", "give", "low", "level", "technical", "information", "about", "their", "products", "to", "public", "or", "at", "least", "their", "require", "signing", "a", "NDA", ".", "It", "'", "s", "not", "possible", "to", "implement", "a", "freeware", "driver", "for", "them", ".", "However", "it", "'", "s", "possible", "that", "support", "for", "such", "cards", "become", "available", "in", "the", "commercial", "version", "of", "this", "driver", "(", "see", "http", ":", "//", "www", ".", "4Front", "-", "tech", ".", "com", "/", "oss", ".", "html", "for", "more", "info", ")", ".", "There", "are", "some", "common", "audio", "chipsets", "that", "are", "not", "supported", "yet", ".", "For", "example", "Sierra", "Aria", "and", "IBM", "Mwave", ".", "It", "'", "s", "possible", "that", "these", "architectures", "get", "some", "support", "in", "future", "but", "I", "can", "'", "t", "make", "any", "promises", ".", "Just", "look", "at", "the", "home", "page", "(", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", "/", ")", "for", "latest", "info", ".", "Information", "about", "unsupported", "sound", "cards", "and", "chipsets", "is", "welcome", "as", "well", "as", "free", "copies", "of", "sound", "cards", ",", "SDKs", "and", "operating", "systems", ".", "If", "you", "have", "any", "corrections", "and", "/", "or", "comments", ",", "please", "contact", "me", ".", "Hannu", "Savolainen", "hannu", "@", "opensound", ".", "com", "home", "page", "of", "OSS", "/", "Free", ":", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "ossfree", "home", "page", "of", "commercial", "OSS", "(", "Open", "Sound", "System", ")", "drivers", ":", "http", ":", "//", "www", ".", "opensound", ".", "com", "/", "oss", ".", "html", "@", "@", "-", "1", ",", "106", "+", "0", ",", "0", "@", "@", "Building", "a", "modular", "sound", "driver", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "=", "The", "following", "information", "is", "current", "as", "of", "linux", "-", "2", ".", "1", ".", "85", ".", "Check", "the", "other", "readme", "files", ",", "especially", "README", ".", "OSS", ",", "for", "information", "not", "specific", "to", "making", "sound", "modular", ".", "First", ",", "configure", "your", "kernel", ".", "This", "is", "an", "idea", "of", "what", "you", "should", "be", "setting", "in", "the", "sound", "section", ":", "<", "M", ">", "Sound", "card", "support", "<", "M", ">", "100", "%", "Sound", "Blaster", "compatibles", "(", "SB16", "/", "32", "/", "64", ",", "ESS", ",", "Jazz16", ")", "support", "I", "have", "SoundBlaster", ".", "Select", "your", "card", "from", "the", "list", ".", "<", "M", ">", "Generic", "OPL2", "/", "OPL3", "FM", "synthesizer", "support", "<", "M", ">", "FM", "synthesizer", "(", "YM3812", "/", "OPL", "-", "3", ")", "support", "If", "you", "don", "'", "t", "set", "these", ",", "you", "will", "probably", "find", "you", "can", "play", ".", "wav", "files", "but", "not", ".", "midi", ".", "As", "the", "help", "for", "them", "says", ",", "set", "them", "unless", "you", "know", "your", "card", "does", "not", "use", "one", "of", "these", "chips", "for", "FM", "support", ".", "Once", "you", "are", "configured", ",", "make", "zlilo", ",", "modules", ",", "modules_install", ";", "reboot", ".", "Note", "that", "it", "is", "no", "longer", "necessary", "or", "possible", "to", "configure", "sound", "in", "the", "drivers", "/", "sound", "dir", ".", "Now", "one", "simply", "configures", "and", "makes", "one", "'", "s", "kernel", "and", "modules", "in", "the", "usual", "way", ".", "Then", ",", "add", "to", "your", "/", "etc", "/", "modprobe", ".", "d", "/", "oss", ".", "conf", "something", "like", ":", "alias", "char", "-", "major", "-", "14", "-", "*", "sb", "install", "sb", "/", "sbin", "/", "modprobe", "-", "i", "sb", "&", "&", "/", "sbin", "/", "modprobe", "adlib_card", "options", "sb", "io", "=", "0x220", "irq", "=", "7", "dma", "=", "1", "dma16", "=", "5", "mpu_io", "=", "0x330", "options", "adlib_card", "io", "=", "0x388", "#", "FM", "synthesizer", "Alternatively", ",", "if", "you", "have", "compiled", "in", "kernel", "level", "ISAPnP", "support", ":", "alias", "char", "-", "major", "-", "14", "sb", "softdep", "sb", "post", ":", "adlib_card", "options", "adlib_card", "io", "=", "0x388", "The", "effect", "of", "this", "is", "that", "the", "sound", "driver", "and", "all", "necessary", "bits", "and", "pieces", "autoload", "on", "demand", ",", "assuming", "you", "use", "kerneld", "(", "a", "sound", "choice", ")", "and", "autoclean", "when", "not", "in", "use", ".", "Also", ",", "options", "for", "the", "device", "drivers", "are", "set", ".", "They", "will", "not", "work", "without", "them", ".", "Change", "as", "appropriate", "for", "your", "card", ".", "If", "you", "are", "not", "yet", "using", "the", "very", "cool", "kerneld", ",", "you", "will", "have", "to", "\"", "modprobe", "k", "sb", "\"", "yourself", "to", "get", "things", "going", ".", "Eventually", "things", "may", "be", "fixed", "so", "that", "this", "kludgery", "is", "not", "necessary", ";", "for", "the", "time", "being", ",", "it", "seems", "to", "work", "well", ".", "Replace", "'", "sb", "'", "with", "the", "driver", "for", "your", "card", ",", "and", "give", "it", "the", "right", "options", ".", "To", "find", "the", "filename", "of", "the", "driver", ",", "look", "in", "/", "lib", "/", "modules", "/", "<", "kernel", "-", "version", ">", "/", "misc", ".", "Mine", "looks", "like", ":", "adlib_card", ".", "o", "#", "This", "is", "the", "generic", "OPLx", "driver", "opl3", ".", "o", "#", "The", "OPL3", "driver", "sb", ".", "o", "#", "<", "<", "The", "SoundBlaster", "driver", ".", "Yours", "may", "differ", ".", ">>", "sound", ".", "o", "#", "The", "sound", "driver", "uart401", ".", "o", "#", "Used", "by", "sb", ",", "maybe", "other", "cards", "Whichever", "card", "you", "have", ",", "try", "feeding", "it", "the", "options", "that", "would", "be", "the", "default", "if", "you", "were", "making", "the", "driver", "wired", ",", "not", "as", "modules", ".", "You", "can", "look", "at", "function", "referred", "to", "by", "module_init", "(", ")", "for", "the", "card", "to", "see", "what", "args", "are", "expected", ".", "Note", "that", "at", "present", "there", "is", "no", "way", "to", "configure", "the", "io", ",", "irq", "and", "other", "parameters", "for", "the", "modular", "drivers", "as", "one", "does", "for", "the", "wired", "drivers", ".", ".", "One", "needs", "to", "pass", "the", "modules", "the", "necessary", "parameters", "as", "arguments", ",", "either", "with", "/", "etc", "/", "modprobe", ".", "d", "/", "*.", "conf", "or", "with", "command", "-", "line", "args", "to", "modprobe", ",", "e", ".", "g", ".", "modprobe", "sb", "io", "=", "0x220", "irq", "=", "7", "dma", "=", "1", "dma16", "=", "5", "mpu_io", "=", "0x330", "modprobe", "adlib_card", "io", "=", "0x388", "recommend", "using", "/", "etc", "/", "modprobe", ".", "d", "/", "*.", "conf", ".", "Persistent", "DMA", "Buffers", ":", "The", "sound", "modules", "normally", "allocate", "DMA", "buffers", "during", "open", "(", ")", "and", "deallocate", "them", "during", "close", "(", ").", "Linux", "can", "often", "have", "problems", "allocating", "DMA", "buffers", "for", "ISA", "cards", "on", "machines", "with", "more", "than", "16MB", "RAM", ".", "This", "is", "because", "ISA", "DMA", "buffers", "must", "exist", "below", "the", "16MB", "boundary", "and", "it", "is", "quite", "possible", "that", "we", "can", "'", "t", "find", "a", "large", "enough", "free", "block", "in", "this", "region", "after", "the", "machine", "has", "been", "running", "for", "any", "amount", "of", "time", ".", "The", "way", "to", "avoid", "this", "problem", "is", "to", "allocate", "the", "DMA", "buffers", "during", "module", "load", "and", "deallocate", "them", "when", "the", "module", "is", "unloaded", ".", "For", "this", "to", "be", "effective", "we", "need", "to", "load", "the", "sound", "modules", "right", "after", "the", "kernel", "boots", ",", "either", "manually", "or", "by", "an", "init", "script", ",", "and", "keep", "them", "around", "until", "we", "shut", "down", ".", "This", "is", "a", "little", "wasteful", "of", "RAM", ",", "but", "it", "guarantees", "that", "sound", "always", "works", ".", "To", "make", "the", "sound", "driver", "use", "persistent", "DMA", "buffers", "we", "need", "to", "pass", "the", "sound", ".", "o", "module", "a", "\"", "dmabuf", "=", "1", "\"", "command", "-", "line", "argument", ".", "This", "is", "normally", "done", "in", "/", "etc", "/", "modprobe", ".", "d", "/", "*.", "conf", "files", "like", "so", ":", "options", "sound", "dmabuf", "=", "1", "If", "you", "have", "16MB", "or", "less", "RAM", "or", "a", "PCI", "sound", "card", ",", "this", "is", "wasteful", "and", "unnecessary", ".", "It", "is", "possible", "that", "machine", "with", "16MB", "or", "less", "RAM", "will", "find", "this", "option", "useful", ",", "but", "if", "your", "machine", "is", "so", "memory", "-", "starved", "that", "it", "cannot", "find", "a", "64K", "block", "free", ",", "you", "will", "be", "wasting", "even", "more", "RAM", "by", "keeping", "the", "sound", "modules", "loaded", "and", "the", "DMA", "buffers", "allocated", "when", "they", "are", "not", "needed", ".", "The", "proper", "solution", "is", "to", "upgrade", "your", "RAM", ".", "But", "you", "do", "also", "have", "this", "improper", "solution", "as", "well", ".", "Use", "it", "wisely", ".", "I", "'", "m", "afraid", "I", "know", "nothing", "about", "anything", "but", "my", "setup", ",", "being", "more", "of", "a", "text", "-", "mode", "guy", "anyway", ".", "If", "you", "have", "options", "for", "other", "cards", "or", "other", "helpful", "hints", ",", "send", "them", "to", "me", ",", "Jim", "Bray", ",", "jb", "@", "as220", ".", "org", ",", "http", ":", "//", "as220", ".", "org", "/", "jb", ".", "@", "@", "-", "1", ",", "107", "+", "0", ",", "0", "@", "@", "Legacy", "audio", "driver", "for", "YMF7xx", "PCI", "cards", ".", "FIRST", "OF", "ALL", "=", "==", "==", "==", "==", "==", "=", "This", "code", "references", "YAMAHA", "'", "s", "sample", "codes", "and", "data", "sheets", ".", "I", "respect", "and", "thank", "for", "all", "people", "they", "made", "open", "the", "information", "about", "YMF7xx", "cards", ".", "And", "this", "codes", "heavily", "based", "on", "Jeff", "Garzik", "<", "jgarzik", "@", "pobox", ".", "com", ">", "'", "s", "old", "VIA", "82Cxxx", "driver", "(", "via82cxxx", ".", "c", ")", ".", "I", "also", "respect", "him", ".", "DISCLIMER", "=", "==", "==", "==", "==", "This", "driver", "is", "currently", "at", "early", "ALPHA", "stage", ".", "It", "may", "cause", "serious", "damage", "to", "your", "computer", "when", "used", ".", "PLEASE", "USE", "IT", "AT", "YOUR", "OWN", "RISK", ".", "ABOUT", "THIS", "DRIVER", "=", "==", "==", "==", "==", "==", "==", "==", "==", "This", "code", "enables", "you", "to", "use", "your", "YMF724", "[", "A", "-", "F", "]", ",", "YMF740", "[", "A", "-", "C", "]", ",", "YMF744", ",", "YMF754", "cards", ".", "When", "enabled", ",", "your", "card", "acts", "as", "\"", "SoundBlaster", "Pro", "\"", "compatible", "card", ".", "It", "can", "only", "play", "22", ".", "05kHz", "/", "8bit", "/", "Stereo", "samples", ",", "control", "external", "MIDI", "port", ".", "If", "you", "want", "to", "use", "your", "card", "as", "recent", "\"", "16", "-", "bit", "\"", "card", ",", "you", "should", "use", "Alsa", "or", "OSS", "/", "Linux", "driver", ".", "Of", "course", "you", "can", "write", "native", "PCI", "driver", "for", "your", "cards", ":", ")", "USAGE", "=", "==", "==", "#", "modprobe", "ymfsb", "(", "options", ")", "OPTIONS", "FOR", "MODULE", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "io", ":", "SB", "base", "address", "(", "0x220", ",", "0x240", ",", "0x260", ",", "0x280", ")", "synth_io", ":", "OPL3", "base", "address", "(", "0x388", ",", "0x398", ",", "0x3a0", ",", "0x3a8", ")", "dma", ":", "DMA", "number", "(", "0", ",", "1", ",", "3", ")", "master_volume", ":", "AC", "'", "97", "PCM", "out", "Vol", "(", "0", "-", "100", ")", "spdif_out", ":", "SPDIF", "-", "out", "flag", "(", "0", ":", "disable", "1", ":", "enable", ")", "These", "options", "will", "change", "in", "future", ".", "..", "FREQUENCY", "=", "==", "==", "==", "==", "When", "playing", "sounds", "via", "this", "driver", ",", "you", "will", "hear", "its", "pitch", "is", "slightly", "lower", "than", "original", "sounds", ".", "Since", "this", "driver", "recognizes", "your", "card", "acts", "with", "21", ".", "739kHz", "sample", "rates", "rather", "than", "22", ".", "050kHz", "(", "I", "think", "it", "must", "be", "hardware", "restriction", ")", ".", "So", "many", "players", "become", "tone", "deafness", ".", "To", "prevent", "this", ",", "you", "should", "express", "some", "options", "to", "your", "sound", "player", "that", "specify", "correct", "sample", "frequency", ".", "For", "example", ",", "to", "play", "your", "MP3", "file", "correctly", "with", "mpg123", ",", "specify", "the", "frequency", "like", "following", ":", "%", "mpg123", "-", "r", "21739", "foo", ".", "mp3", "SPDIF", "OUT", "=", "==", "==", "==", "==", "With", "installing", "modules", "with", "option", "'", "spdif_out", "=", "1", "'", ",", "you", "can", "enjoy", "your", "sounds", "from", "SPDIF", "-", "out", "of", "your", "card", "(", "if", "it", "had", ")", ".", "Its", "Fs", "is", "fixed", "to", "48kHz", "(", "It", "never", "means", "the", "sample", "frequency", "become", "up", "to", "48kHz", ".", "All", "sounds", "via", "SPDIF", "-", "out", "also", "22kHz", "samples", ")", ".", "So", "your", "digital", "-", "in", "capable", "components", "has", "to", "be", "able", "to", "handle", "48kHz", "Fs", ".", "COPYING", "=", "==", "==", "==", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "TODO", "=", "==", "=", "*", "support", "for", "multiple", "cards", "(", "set", "the", "different", "SB_IO", ",", "MPU_IO", ",", "OPL_IO", "for", "each", "cards", ")", "*", "support", "for", "OPL", "(", "dmfm", ")", ":", "There", "will", "be", "no", "requirements", ".", "..", ":", "-<", "AUTHOR", "=", "==", "==", "=", "Daisuke", "Nagano", "<", "breeze", ".", "nagano", "@", "nifty", ".", "ne", ".", "jp", ">", "@", "@", "-", "1", ",", "105", "+", "0", ",", "0", "@", "@", "Documentation", "for", "the", "SoundPro", "CMI8330", "extensions", "in", "the", "WSS", "driver", "(", "ad1848", ".", "o", ")", "(", "Be", "sure", "to", "read", "Documentation", "/", "sound", "/", "oss", "/", "CMI8330", "too", ")", "Ion", "Badulescu", ",", "ionut", "@", "cs", ".", "columbia", ".", "edu", "February", "24", ",", "1999", "(", "derived", "from", "the", "OPL3", "-", "SA2", "documentation", "by", "Scott", "Murray", ")", "The", "SoundPro", "CMI8330", "(", "ISA", ")", "is", "a", "chip", "usually", "found", "on", "some", "Taiwanese", "motherboards", ".", "The", "official", "name", "in", "the", "documentation", "is", "CMI8330", ",", "SoundPro", "is", "the", "nickname", "and", "the", "big", "inscription", "on", "the", "chip", "itself", ".", "The", "chip", "emulates", "a", "WSS", "as", "well", "as", "a", "SB16", ",", "but", "it", "has", "certain", "differences", "in", "the", "mixer", "section", "which", "require", "separate", "support", ".", "It", "also", "emulates", "an", "MPU401", "and", "an", "OPL3", "synthesizer", ",", "so", "you", "probably", "want", "to", "enable", "support", "for", "these", ",", "too", ".", "The", "chip", "identifies", "itself", "as", "an", "AD1848", ",", "but", "its", "mixer", "is", "significantly", "more", "advanced", "than", "the", "original", "AD1848", "one", ".", "If", "your", "system", "works", "with", "either", "WSS", "or", "SB16", "and", "you", "are", "having", "problems", "with", "some", "mixer", "controls", "(", "no", "CD", "audio", ",", "no", "line", "-", "in", ",", "etc", ")", ",", "you", "might", "want", "to", "give", "this", "driver", "a", "try", ".", "Detection", "should", "work", ",", "but", "it", "hasn", "'", "t", "been", "widely", "tested", ",", "so", "it", "might", "still", "mis", "-", "identify", "the", "chip", ".", "You", "can", "still", "force", "soundpro", "=", "1", "in", "the", "modprobe", "parameters", "for", "ad1848", ".", "Please", "let", "me", "know", "if", "it", "happens", "to", "you", ",", "so", "I", "can", "adjust", "the", "detection", "routine", ".", "The", "chip", "is", "capable", "of", "doing", "full", "-", "duplex", ",", "but", "since", "the", "driver", "sees", "it", "as", "an", "AD1848", ",", "it", "cannot", "take", "advantage", "of", "this", ".", "Moreover", ",", "the", "full", "-", "duplex", "mode", "is", "not", "achievable", "through", "the", "WSS", "interface", ",", "b", "/", "c", "it", "needs", "a", "dma16", "line", "which", "is", "assigned", "only", "to", "the", "SB16", "subdevice", "(", "with", "isapnp", ")", ".", "Windows", "documentation", "says", "the", "user", "must", "use", "WSS", "Playback", "and", "SB16", "Recording", "for", "full", "-", "duplex", ",", "so", "it", "might", "be", "possible", "to", "do", "the", "same", "thing", "under", "Linux", ".", "You", "can", "try", "loading", "up", "both", "ad1848", "and", "sb", "then", "use", "one", "for", "playback", "and", "the", "other", "for", "recording", ".", "I", "don", "'", "t", "know", "if", "this", "works", ",", "b", "/", "c", "I", "haven", "'", "t", "tested", "it", ".", "Anyway", ",", "if", "you", "try", "it", ",", "be", "very", "careful", ":", "the", "SB16", "mixer", "*", "mostly", "*", "works", ",", "but", "certain", "settings", "can", "have", "unexpected", "effects", ".", "Use", "the", "WSS", "mixer", "for", "best", "results", ".", "There", "is", "also", "a", "PCI", "SoundPro", "chip", ".", "I", "have", "not", "seen", "this", "chip", ",", "so", "I", "have", "no", "idea", "if", "the", "driver", "will", "work", "with", "it", ".", "I", "suspect", "it", "won", "'", "t", ".", "As", "with", "PnP", "cards", ",", "some", "configuration", "is", "required", ".", "There", "are", "two", "ways", "of", "doing", "this", ".", "The", "most", "common", "is", "to", "use", "the", "isapnptools", "package", "to", "initialize", "the", "card", ",", "and", "use", "the", "kernel", "module", "form", "of", "the", "sound", "subsystem", "and", "sound", "drivers", ".", "Alternatively", ",", "some", "BIOS", "'", "s", "allow", "manual", "configuration", "of", "installed", "PnP", "devices", "in", "a", "BIOS", "menu", ",", "which", "should", "allow", "using", "the", "non", "-", "modular", "sound", "drivers", ",", "i", ".", "e", ".", "built", "into", "the", "kernel", ".", "Since", "in", "this", "latter", "case", "you", "cannot", "use", "module", "parameters", ",", "you", "will", "have", "to", "enable", "support", "for", "the", "SoundPro", "at", "compile", "time", ".", "The", "IRQ", "and", "DMA", "values", "can", "be", "any", "that", "are", "considered", "acceptable", "for", "a", "WSS", ".", "Assuming", "you", "'", "ve", "got", "isapnp", "all", "happy", ",", "then", "you", "should", "be", "able", "to", "do", "something", "like", "the", "following", "(", "which", "*", "must", "*", "match", "the", "isapnp", "/", "BIOS", "configuration", ")", ":", "modprobe", "ad1848", "io", "=", "0x530", "irq", "=", "11", "dma", "=", "0", "soundpro", "=", "1", "and", "maybe", "modprobe", "sb", "io", "=", "0x220", "irq", "=", "5", "dma", "=", "1", "dma16", "=", "5", "then", "modprobe", "mpu401", "io", "=", "0x330", "irq", "=", "9", "modprobe", "opl3", "io", "=", "0x388", "If", "all", "goes", "well", "and", "you", "see", "no", "error", "messages", ",", "you", "should", "be", "able", "to", "start", "using", "the", "sound", "capabilities", "of", "your", "system", ".", "If", "you", "get", "an", "error", "message", "while", "trying", "to", "insert", "the", "module", "(", "s", ")", ",", "then", "make", "sure", "that", "the", "values", "of", "the", "various", "arguments", "match", "what", "you", "specified", "in", "your", "isapnp", "configuration", "file", ",", "and", "that", "there", "is", "no", "conflict", "with", "another", "device", "for", "an", "I", "/", "O", "port", "or", "interrupt", ".", "Checking", "the", "contents", "of", "/", "proc", "/", "ioports", "and", "/", "proc", "/", "interrupts", "can", "be", "useful", "to", "see", "if", "you", "'", "re", "butting", "heads", "with", "another", "device", ".", "If", "you", "do", "not", "see", "the", "chipset", "version", "message", ",", "and", "none", "of", "the", "other", "messages", "present", "in", "the", "system", "log", "are", "helpful", ",", "try", "adding", "'", "debug", "=", "1", "'", "to", "the", "ad1848", "parameters", ",", "email", "me", "the", "syslog", "results", "and", "I", "'", "ll", "do", "my", "best", "to", "help", ".", "Lastly", ",", "if", "you", "'", "re", "using", "modules", "and", "want", "to", "set", "up", "automatic", "module", "loading", "with", "kmod", ",", "the", "kernel", "module", "loader", ",", "here", "is", "the", "section", "I", "currently", "use", "in", "my", "conf", ".", "modules", "file", ":", "#", "Sound", "post", "-", "install", "sound", "modprobe", "-", "k", "ad1848", ";", "modprobe", "-", "k", "mpu401", ";", "modprobe", "-", "k", "opl3", "options", "ad1848", "io", "=", "0x530", "irq", "=", "11", "dma", "=", "0", "options", "sb", "io", "=", "0x220", "irq", "=", "5", "dma", "=", "1", "dma16", "=", "5", "options", "mpu401", "io", "=", "0x330", "irq", "=", "9", "options", "opl3", "io", "=", "0x388", "The", "above", "ensures", "that", "ad1848", "will", "be", "loaded", "whenever", "the", "sound", "system", "is", "being", "used", ".", "Good", "luck", ".", "Ion", "NOT", "REALLY", "TESTED", ":", "recording", "recording", "device", "selection", "full", "-", "duplex", "TODO", ":", "implement", "mixer", "support", "for", "surround", ",", "loud", ",", "digital", "CD", "switches", ".", "come", "up", "with", "a", "scheme", "which", "allows", "recording", "volumes", "for", "each", "subdevice", ".", "This", "is", "a", "major", "OSS", "API", "change", ".", "@", "@", "-", "1", ",", "53", "+", "0", ",", "0", "@", "@", "modprobe", "sound", "insmod", "uart401", "insmod", "sb", ".", "..", "This", "loads", "the", "driver", "for", "the", "Sound", "Blaster", "and", "assorted", "clones", ".", "Cards", "that", "are", "covered", "by", "other", "drivers", "should", "not", "be", "using", "this", "driver", ".", "The", "Sound", "Blaster", "module", "takes", "the", "following", "arguments", "io", "I", "/", "O", "address", "of", "the", "Sound", "Blaster", "chip", "(", "0x220", ",", "0x240", ",", "0x260", ",", "0x280", ")", "irq", "IRQ", "of", "the", "Sound", "Blaster", "chip", "(", "5", ",", "7", ",", "9", ",", "10", ")", "dma", "8", "-", "bit", "DMA", "channel", "for", "the", "Sound", "Blaster", "(", "0", ",", "1", ",", "3", ")", "dma16", "16", "-", "bit", "DMA", "channel", "for", "SB16", "and", "equivalent", "cards", "(", "5", ",", "6", ",", "7", ")", "mpu_io", "I", "/", "O", "for", "MPU", "chip", "if", "present", "(", "0x300", ",", "0x330", ")", "sm_games", "=", "1", "Set", "if", "you", "have", "a", "Logitech", "soundman", "games", "acer", "=", "1", "Set", "this", "to", "detect", "cards", "in", "some", "ACER", "notebooks", "mwave_bug", "=", "1", "Set", "if", "you", "are", "trying", "to", "use", "this", "driver", "with", "mwave", "(", "see", "on", ")", "type", "Use", "this", "to", "specify", "a", "specific", "card", "type", "The", "following", "arguments", "are", "taken", "if", "ISAPnP", "support", "is", "compiled", "in", "isapnp", "=", "0", "Set", "this", "to", "disable", "ISAPnP", "detection", "(", "use", "io", "=", "0xXXX", "etc", ".", "above", ")", "multiple", "=", "0", "Set", "to", "disable", "detection", "of", "multiple", "Soundblaster", "cards", ".", "Consider", "it", "a", "bug", "if", "this", "option", "is", "needed", ",", "and", "send", "in", "a", "report", ".", "pnplegacy", "=", "1", "Set", "this", "to", "be", "able", "to", "use", "a", "PnP", "card", "(", "s", ")", "along", "with", "a", "single", "non", "-", "PnP", "(", "legacy", ")", "card", ".", "Above", "options", "for", "io", ",", "irq", ",", "etc", ".", "are", "needed", ",", "and", "will", "apply", "only", "to", "the", "legacy", "card", ".", "reverse", "=", "1", "Reverses", "the", "order", "of", "the", "search", "in", "the", "PnP", "table", ".", "uart401", "=", "1", "Set", "to", "enable", "detection", "of", "mpu", "devices", "on", "some", "clones", ".", "isapnpjump", "=", "n", "Jumps", "to", "slot", "n", "in", "the", "driver", "'", "s", "PnP", "table", ".", "Use", "the", "source", ",", "Luke", ".", "You", "may", "well", "want", "to", "load", "the", "opl3", "driver", "for", "synth", "music", "on", "most", "SB", "and", "clone", "SB", "devices", "insmod", "opl3", "io", "=", "0x388", "Using", "Mwave", "To", "make", "this", "driver", "work", "with", "Mwave", "you", "must", "set", "mwave_bug", ".", "You", "also", "need", "to", "warm", "boot", "from", "DOS", "/", "Windows", "with", "the", "required", "firmware", "loaded", "under", "this", "OS", ".", "IBM", "are", "being", "difficult", "about", "documenting", "how", "to", "load", "this", "firmware", ".", "Avance", "Logic", "ALS007", "This", "card", "is", "supported", ";", "see", "the", "separate", "file", "ALS007", "for", "full", "details", ".", "Avance", "Logic", "ALS100", "This", "card", "is", "supported", ";", "setup", "should", "be", "as", "for", "a", "standard", "Sound", "Blaster", "16", ".", "The", "driver", "will", "identify", "the", "audio", "device", "as", "a", "\"", "Sound", "Blaster", "16", "(", "ALS", "-", "100", ")", "\".", "@", "@", "-", "1", ",", "26", "+", "0", ",", "0", "@", "@", "From", ":", "Paul", "Barton", "-", "Davis", "<", "pbd", "@", "op", ".", "net", ">", "Here", "is", "the", "configuration", "I", "use", "with", "a", "Tropez", "+", "and", "my", "modular", "driver", ":", "alias", "char", "-", "major", "-", "14", "wavefront", "alias", "synth0", "wavefront", "alias", "mixer0", "cs4232", "alias", "audio0", "cs4232", "pre", "-", "install", "wavefront", "modprobe", "\"", "-", "k", "\"", "\"", "cs4232", "\"", "post", "-", "install", "wavefront", "modprobe", "\"", "-", "k", "\"", "\"", "opl3", "\"", "options", "wavefront", "io", "=", "0x200", "irq", "=", "9", "options", "cs4232", "synthirq", "=", "9", "synthio", "=", "0x200", "io", "=", "0x530", "irq", "=", "5", "dma", "=", "1", "dma2", "=", "0", "options", "opl3", "io", "=", "0x388", "Things", "to", "note", ":", "the", "wavefront", "options", "\"", "io", "\"", "and", "\"", "irq", "\"", "*", "**", "MUST", "*", "**", "match", "the", "\"", "synthio", "\"", "and", "\"", "synthirq", "\"", "cs4232", "options", ".", "you", "can", "do", "without", "the", "opl3", "module", "if", "you", "don", "'", "t", "want", "to", "use", "the", "OPL", "/", "[", "34", "]", "synth", "on", "the", "soundcard", "the", "opl3", "io", "parameter", "is", "conventionally", "not", "adjustable", ".", "Please", "see", "drivers", "/", "sound", "/", "README", ".", "wavefront", "for", "more", "details", ".", "@", "@", "-", "1", ",", "80", "+", "0", ",", "0", "@", "@", "Sound", "Blaster", "16X", "Vibra", "addendum", "by", "Marius", "Ilioaea", "<", "mariusi", "@", "protv", ".", "ro", ">", "Stefan", "Laudat", "<", "stefan", "@", "asit", ".", "ro", ">", "Sat", "Mar", "6", "23", ":", "55", ":", "27", "EET", "1999", "Hello", "again", ",", "Playing", "with", "a", "SB", "Vibra", "16x", "soundcard", "we", "found", "it", "very", "difficult", "to", "setup", "because", "the", "kernel", "reported", "a", "lot", "of", "DMA", "errors", "and", "wouldn", "'", "t", "simply", "play", "any", "sound", ".", "A", "good", "starting", "point", "is", "that", "the", "vibra16x", "chip", "full", "-", "duplex", "facility", "is", "neither", "still", "exploited", "by", "the", "sb", "driver", "found", "in", "the", "linux", "kernel", "(", "tried", "it", "with", "a", "2", ".", "2", ".", "2", "-", "ac7", ")", ",", "nor", "in", "the", "commercial", "OSS", "package", "(", "it", "reports", "it", "as", "half", "-", "duplex", "soundcard", ")", ".", "Oh", ",", "I", "almost", "forgot", ",", "the", "RedHat", "sndconfig", "failed", "detecting", "it", ";", ")", "So", ",", "the", "big", "problem", "still", "remains", ",", "because", "the", "sb", "module", "wants", "a", "8", "-", "bit", "and", "a", "16", "-", "bit", "dma", ",", "which", "we", "could", "not", "allocate", "for", "vibra", ".", "..", "it", "supports", "only", "two", "8", "-", "bit", "dma", "channels", ",", "the", "second", "one", "will", "be", "passed", "to", "the", "module", "as", "a", "16", "bit", "channel", ",", "the", "kernel", "will", "yield", "about", "that", "but", "everything", "will", "be", "okay", ",", "trust", "us", ".", "The", "only", "inconvenient", "you", "may", "find", "is", "that", "you", "will", "have", "some", "sound", "playing", "jitters", "if", "you", "have", "HDD", "dma", "support", "enabled", "-", "but", "this", "will", "happen", "with", "almost", "all", "soundcards", ".", "..", "A", "fully", "working", "isapnp", ".", "conf", "is", "just", "here", ":", "<", "snip", "here", ">", "(", "READPORT", "0x0203", ")", "(", "ISOLATE", "PRESERVE", ")", "(", "IDENTIFY", "*", ")", "(", "VERBOSITY", "2", ")", "(", "CONFLICT", "(", "IO", "FATAL", ")", "(", "IRQ", "FATAL", ")", "(", "DMA", "FATAL", ")", "(", "MEM", "FATAL", ")", ")", "#", "or", "WARNING", "#", "SB", "16", "and", "OPL3", "devices", "(", "CONFIGURE", "CTL00f0", "/", "-", "1", "(", "LD", "0", "(", "INT", "0", "(", "IRQ", "5", "(", "MODE", "+", "E", ")", "))", "(", "DMA", "0", "(", "CHANNEL", "1", ")", ")", "(", "DMA", "1", "(", "CHANNEL", "3", ")", ")", "(", "IO", "0", "(", "SIZE", "16", ")", "(", "BASE", "0x0220", ")", ")", "(", "IO", "2", "(", "SIZE", "4", ")", "(", "BASE", "0x0388", ")", ")", "(", "NAME", "\"", "CTL00f0", "/", "-", "1", "[", "0", "]", "{", "Audio", "}", "\")", "(", "ACT", "Y", ")", ")", ")", "#", "Joystick", "device", "-", "only", "if", "you", "need", "it", ":", "-/", "(", "CONFIGURE", "CTL00f0", "/", "-", "1", "(", "LD", "1", "(", "IO", "0", "(", "SIZE", "1", ")", "(", "BASE", "0x0200", ")", ")", "(", "NAME", "\"", "CTL00f0", "/", "-", "1", "[", "1", "]", "{", "Game", "}", "\")", "(", "ACT", "Y", ")", ")", ")", "(", "WAITFORKEY", ")", "<", "end", "of", "snipping", ">", "So", ",", "after", "a", "good", "kernel", "modules", "compilation", "and", "a", "'", "depmod", "-", "a", "kernel_ver", "'", "you", "may", "want", "to", ":", "modprobe", "sb", "io", "=", "0x220", "irq", "=", "5", "dma", "=", "1", "dma16", "=", "3", "Or", ",", "take", "the", "hard", "way", ":", "modprobe", "soundcore", "modprobe", "sound", "modprobe", "uart401", "modprobe", "sb", "io", "=", "0x220", "irq", "=", "5", "dma", "=", "1", "dma16", "=", "3", "#", "do", "you", "need", "MIDI", "?", "modprobe", "opl3", "=", "0x388", "Just", "in", "case", ",", "the", "kernel", "sound", "support", "should", "be", ":", "CONFIG_SOUND", "=", "m", "CONFIG_SOUND_OSS", "=", "m", "CONFIG_SOUND_SB", "=", "m", "Enjoy", "your", "new", "noisy", "Linux", "box", "!", ";", ")", "@", "@", "-", "1", ",", "170", "+", "0", ",", "0", "@", "@", "(", "the", "following", "is", "from", "the", "armlinux", "CVS", ")", "WaveArtist", "mixer", "and", "volume", "levels", "can", "be", "accessed", "via", "these", "commands", ":", "nn30", "read", "registers", "nn", ",", "where", "nn", "=", "00", "-", "09", "for", "mixer", "settings", "0a", "-", "13", "for", "channel", "volumes", "mm31", "write", "the", "volume", "setting", "in", "pairs", ",", "where", "mm", "=", "(", "nn", "-", "10", ")", "/", "2", "rr32", "write", "the", "mixer", "settings", "in", "pairs", ",", "where", "rr", "=", "nn", "/", "2", "xx33", "reset", "all", "settings", "to", "default", "0y34", "select", "mono", "source", ",", "y", "=", "0", "=", "left", ",", "y", "=", "1", "=", "right", "bits", "nn", "15", "14", "13", "12", "11", "10", "9", "8", "7", "6", "5", "4", "3", "2", "1", "0", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "00", "|", "0", "|", "0", "0", "1", "1", "|", "left", "line", "mixer", "gain", "|", "left", "aux1", "mixer", "gain", "|", "lmute", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "01", "|", "0", "|", "0", "1", "0", "1", "|", "left", "aux2", "mixer", "gain", "|", "right", "2", "left", "mic", "gain", "|", "mmute", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "02", "|", "0", "|", "0", "1", "1", "1", "|", "left", "mic", "mixer", "gain", "|", "left", "mic", "|", "left", "mixer", "gain", "|", "dith", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "03", "|", "0", "|", "1", "0", "0", "1", "|", "left", "mixer", "input", "select", "|", "lrfg", "|", "left", "ADC", "gain", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "04", "|", "0", "|", "1", "0", "1", "1", "|", "right", "line", "mixer", "gain", "|", "right", "aux1", "mixer", "gain", "|", "rmute", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "05", "|", "0", "|", "1", "1", "0", "1", "|", "right", "aux2", "mixer", "gain", "|", "left", "2", "right", "mic", "gain", "|", "test", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "06", "|", "0", "|", "1", "1", "1", "1", "|", "right", "mic", "mixer", "gain", "|", "right", "mic", "|", "right", "mixer", "gain", "|", "rbyps", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "07", "|", "1", "|", "0", "0", "0", "1", "|", "right", "mixer", "select", "|", "rrfg", "|", "right", "ADC", "gain", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "08", "|", "1", "|", "0", "0", "1", "1", "|", "mono", "mixer", "gain", "|", "right", "ADC", "mux", "sel", "|", "left", "ADC", "mux", "sel", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "09", "|", "1", "|", "0", "1", "0", "1", "|", "loopb", "|", "left", "linout", "|", "loop", "|", "ADCch", "|", "TxFch", "|", "OffCD", "|", "test", "|", "loopb", "|", "loopb", "|", "osamp", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "0a", "|", "0", "|", "left", "PCM", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "0b", "|", "0", "|", "right", "PCM", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "0c", "|", "0", "|", "left", "FM", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "0d", "|", "0", "|", "right", "FM", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "0e", "|", "0", "|", "left", "wavetable", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "0f", "|", "0", "|", "right", "wavetable", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "10", "|", "0", "|", "left", "PCM", "expansion", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "11", "|", "0", "|", "right", "PCM", "expansion", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "12", "|", "0", "|", "left", "FM", "expansion", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "13", "|", "0", "|", "right", "FM", "expansion", "channel", "volume", "|", "+", "--", "-+", "--", "--", "--", "--", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "--", "+-", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "--", "--", "-+", "lmute", ":", "left", "mute", "mmute", ":", "mono", "mute", "dith", ":", "dithds", "lrfg", ":", "rmute", ":", "right", "mute", "rbyps", ":", "right", "bypass", "rrfg", ":", "ADCch", ":", "TxFch", ":", "OffCD", ":", "osamp", ":", "And", "the", "following", "diagram", "is", "derived", "from", "the", "description", "in", "the", "CVS", "archive", ":", "MIC", "L", "(", "mouthpiece", ")", "+", "--", "--", "--", "+", "-", "->", "PreAmp", ">", "-\\", "+", "--", "^-", "--", "+", "|", "|", "|", "r2b4", "-", "5", "|", "+", "--", "--", "--", "--", "+", "/", "--", "--", "*-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "->", "5", "|", "|", "|", "|", "|", "/", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "->", "4", "|", "|", "|", "|", "|", "|", "|", "/", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "->", "3", "1of5", "|", "+", "--", "-+", "|", "|", "|", "|", "mux", ">", "--", ">", "AMP", ">", "--", ">", "ADC", "L", "|", "|", "|", "/", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "->", "2", "|", "+", "-^", "-+", "|", "|", "|", "|", "|", "|", "|", "Line", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "+", "--", "-+", "/", "--", "--", ">", "1", "|", "r3b3", "-", "0", "-", "--", "--", "--", "--", "--", "-*", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "|", "|", "|", "|", "L", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "*", "->", "0", "|", "|", "|", "|", "|", "|", "|", "+", "--", "-^", "--", "--", "+", "Aux2", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "-", "--", "--", "--", "--", "-*", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "M", "|", "|", "r8b0", "-", "2", "L", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "\\", "--", "--", "--", "\\", "Aux1", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "-", "--", "--", "--", "-*", "--", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "I", "|", "|", "L", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "+", "--", "-+", "|", "*", "--", "--", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "X", ">", "--", ">", "AMP", ">", "--", "*", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "+", "-^", "-+", "|", "|", "|", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "r2b1", "-", "3", "|", "|", "/", "--", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "E", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "/", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "R", "|", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "|", "|", "r9b8", "-", "9", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "/", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "|", "|", "+", "--", "-", "v", "-", "--", "+", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "+", "--", "-+", "/", "-*", "->", "0", "|", "DAC", "|", "|", "|", "|", "|", "|", "|", "-", "--", "--", "--", "--", "--", "-*", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "->", "?", "|", "+", "--", "--", "+", "L", "|", "|", "|", "|", "|", "Mux", ">", "--", ">", "mute", ">", "--", ">", "L", "output", "|", "|", "|", "|", "/", "->", "?", "|", "+", "--", "^-", "+", "|", "|", "|", "|", "|", "|", "|", "|", "|", "|", "|", "/", "--", "--", "--", "--", "->", "?", "|", "r0b0", "|", "|", "|", "|", "|", "|", "+", "--", "--", "--", "-+", "|", "|", "|", "|", "|", "|", "Mono", "|", "|", "|", "|", "|", "|", "+", "--", "--", "--", "-+", "-", "--", "--", "--", "--", "-*", "|", "\\", "--", "->", "|", "+", "--", "--", "+", "|", "|", "|", "|", "|", "|", "Mix", ">", "--", ">", "mute", ">", "--", ">", "Mono", "output", "|", "|", "|", "|", "*", "->", "|", "+", "--", "^-", "+", "|", "|", "|", "|", "|", "+", "--", "--", "--", "-+", "|", "|", "|", "|", "|", "|", "r1b0", "DAC", "|", "|", "|", "|", "|", "+", "--", "--", "--", "-+", "-", "--", "--", "--", "--", "--", "-*", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "-*", "--", "--", "--", "--", "->", "1", "|", "+", "--", "--", "+", "R", "|", "|", "|", "|", "|", "|", "Mux", ">", "--", ">", "mute", ">", "--", ">", "R", "output", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "+", "--", "-+", "*", "->", "0", "|", "+", "--", "^-", "+", "|", "|", "|", "\\", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "|", "|", "+", "--", "-^", "--", "-+", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "r5b0", "|", "|", "|", "|", "|", "|", "r6b0", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "\\", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "M", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "*", "--", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "I", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "+", "--", "-+", "|", "\\", "--", "--", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "X", ">", "--", ">", "AMP", ">", "--", "*", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "+", "-^", "-+", "|", "/", "--", "/", "|", "|", "|", "|", "Aux1", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "r6b1", "-", "3", "|", "-", "--", "--", "--", "*-", "--", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "E", "|", "|", "R", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "|", "Aux2", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "/", "--", "--", "--", "/", "-", "--", "--", "--", "--", "*-", "--", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "R", "|", "|", "R", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "|", "|", "|", "|", "|", "|", "+", "--", "--", "--", "--", "+", "Line", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "|", "|", "|", "*", "->", "0", "|", "-", "--", "--", "--", "--", "--", "*-", "->", "mute", ">", "--", ">", "Gain", ">", "--", ">", "|", "|", "|", "|", "R", "|", "|", "|", "|", "+", "--", "--", "+", "+", "--", "--", "--", "+", "+", "--", "-+", "\\", "--", "--", ">", "1", "|", "|", "|", "|", "|", "|", "|", "|", "|", "|", "\\", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", ">", "2", "|", "+", "--", "-+", "|", "|", "|", "|", "Mux", ">", "--", ">", "AMP", ">", "--", ">", "ADC", "R", "|", "|", "\\", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", ">", "3", "|", "+", "-^", "-+", "|", "|", "|", "|", "|", "|", "\\", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", ">", "4", "|", "r7b3", "-", "0", "|", "|", "|", "\\", "--", "--", "-*", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", ">", "5", "|", "|", "+", "--", "-^", "--", "--", "+", "r6b4", "-", "5", "|", "|", "|", "|", "r8b3", "-", "5", "+", "--", "v", "-", "--", "+", "|", "-", "->", "PreAmp", ">", "-/", "+", "--", "--", "--", "+", "MIC", "R", "(", "electret", "mic", ")", "@", "@", "-", "1", ",", "92", "+", "0", ",", "0", "@", "@", "Intro", "=", "==", "==", "people", "start", "bugging", "me", "about", "this", "with", "questions", ",", "looks", "like", "I", "should", "write", "up", "some", "documentation", "for", "this", "beast", ".", "That", "way", "I", "don", "'", "t", "have", "to", "answer", "that", "much", "mails", "I", "hope", ".", "Yes", ",", "I", "'", "m", "lazy", ".", "..", "You", "might", "have", "noticed", "that", "the", "bt878", "grabber", "cards", "have", "actually", "_two_", "PCI", "functions", ":", "$", "lspci", "[", ".", "..", "]", "00", ":", "0a", ".", "0", "Multimedia", "video", "controller", ":", "Brooktree", "Corporation", "Bt878", "(", "rev", "02", ")", "00", ":", "0a", ".", "1", "Multimedia", "controller", ":", "Brooktree", "Corporation", "Bt878", "(", "rev", "02", ")", "[", ".", "..", "]", "The", "first", "does", "video", ",", "it", "is", "backward", "compatible", "to", "the", "bt848", ".", "The", "second", "does", "audio", ".", "btaudio", "is", "a", "driver", "for", "the", "second", "function", ".", "It", "'", "s", "a", "sound", "driver", "which", "can", "be", "used", "for", "recording", "sound", "(", "and", "_only_", "recording", ",", "no", "playback", ")", ".", "As", "most", "TV", "cards", "come", "with", "a", "short", "cable", "which", "can", "be", "plugged", "into", "your", "sound", "card", "'", "s", "line", "-", "in", "you", "probably", "don", "'", "t", "need", "this", "driver", "if", "all", "you", "want", "to", "do", "is", "just", "watching", "TV", ".", "..", "Driver", "Status", "=", "==", "==", "==", "==", "==", "==", "Still", "somewhat", "experimental", ".", "The", "driver", "should", "work", "stable", ",", "i", ".", "e", ".", "it", "should", "'", "nt", "crash", "your", "box", ".", "It", "might", "not", "work", "as", "expected", ",", "have", "bugs", ",", "not", "being", "fully", "OSS", "API", "compliant", ",", ".", "..", "Latest", "versions", "are", "available", "from", "http", ":", "//", "bytesex", ".", "org", "/", "bttv", "/", ",", "the", "driver", "is", "in", "the", "bttv", "tarball", ".", "Kernel", "patches", "might", "be", "available", "too", ",", "have", "a", "look", "at", "http", ":", "//", "bytesex", ".", "org", "/", "bttv", "/", "listing", ".", "html", ".", "The", "chip", "knows", "two", "different", "modes", ".", "btaudio", "registers", "two", "dsp", "devices", ",", "one", "for", "each", "mode", ".", "They", "can", "not", "be", "used", "at", "the", "same", "time", ".", "Digital", "audio", "mode", "=", "==", "==", "==", "==", "==", "==", "==", "==", "=", "The", "chip", "gives", "you", "16", "bit", "stereo", "sound", ".", "The", "sample", "rate", "depends", "on", "the", "external", "source", "which", "feeds", "the", "bt878", "with", "digital", "sound", "via", "I2S", "interface", ".", "There", "is", "a", "insmod", "option", "(", "rate", ")", "to", "tell", "the", "driver", "which", "sample", "rate", "the", "hardware", "uses", "(", "32000", "is", "the", "default", ")", ".", "One", "possible", "source", "for", "digital", "sound", "is", "the", "msp34xx", "audio", "processor", "chip", "which", "provides", "digital", "sound", "via", "I2S", "with", "32", "kHz", "sample", "rate", ".", "My", "Hauppauge", "board", "works", "this", "way", ".", "The", "Osprey", "-", "200", "reportly", "gives", "you", "digital", "sound", "with", "44100", "Hz", "sample", "rate", ".", "It", "is", "also", "possible", "that", "you", "get", "no", "sound", "at", "all", ".", "analog", "mode", "(", "A", "/", "D", ")", "=", "==", "==", "==", "==", "==", "==", "==", "==", "You", "can", "tell", "the", "driver", "to", "use", "this", "mode", "with", "the", "insmod", "option", "\"", "analog", "=", "1", "\"", ".", "The", "chip", "has", "three", "analog", "inputs", ".", "Consequently", "you", "'", "ll", "get", "a", "mixer", "device", "to", "control", "these", ".", "The", "analog", "mode", "supports", "mono", "only", ".", "Both", "8", "+", "16", "bit", ".", "Both", "are", "_signed_", "int", ",", "which", "is", "uncommon", "for", "the", "8", "bit", "case", ".", "Sample", "rate", "range", "is", "119", "kHz", "to", "448", "kHz", ".", "Yes", ",", "the", "number", "of", "digits", "is", "correct", ".", "The", "driver", "supports", "downsampling", "by", "powers", "of", "two", ",", "so", "you", "can", "ask", "for", "more", "usual", "sample", "rates", "like", "44", "kHz", "too", ".", "With", "my", "Hauppauge", "I", "get", "noisy", "sound", "on", "the", "second", "input", "(", "mapped", "to", "line2", "by", "the", "mixer", "device", ")", ".", "Others", "get", "a", "useable", "signal", "on", "line1", ".", "some", "examples", "=", "==", "==", "==", "==", "==", "==", "*", "read", "audio", "data", "from", "btaudio", "(", "dsp2", ")", ",", "send", "to", "es1730", "(", "dsp", ",", "dsp1", ")", ":", "$", "sox", "-", "w", "-", "r", "32000", "-", "t", "ossdsp", "/", "dev", "/", "dsp2", "-", "t", "ossdsp", "/", "dev", "/", "dsp", "*", "read", "audio", "data", "from", "btaudio", ",", "send", "to", "esound", "daemon", "(", "which", "might", "be", "running", "on", "another", "host", ")", ":", "$", "sox", "-", "c", "2", "-", "w", "-", "r", "32000", "-", "t", "ossdsp", "/", "dev", "/", "dsp2", "-", "t", "sw", "-", "|", "esdcat", "-", "r", "32000", "$", "sox", "-", "c", "1", "-", "w", "-", "r", "32000", "-", "t", "ossdsp", "/", "dev", "/", "dsp2", "-", "t", "sw", "-", "|", "esdcat", "-", "m", "-", "r", "32000", "Have", "fun", ",", "Gerd", "Gerd", "Knorr", "<", "kraxel", "@", "bytesex", ".", "org", ">", "@", "@", "-", "1", ",", "185", "+", "0", ",", "0", "@", "@", "How", "to", "try", "to", "survive", "an", "IBM", "Mwave", "under", "Linux", "SB", "drivers", "+", "IBM", "have", "now", "released", "documentation", "of", "sorts", "and", "Torsten", "is", "busy", "trying", "to", "make", "the", "Mwave", "work", ".", "This", "is", "not", "however", "a", "trivial", "task", ".", "OK", ",", "first", "thing", "-", "the", "IRQ", "problem", "IS", "a", "problem", ",", "whether", "the", "test", "is", "bypassed", "or", "not", ".", "It", "is", "NOT", "a", "Linux", "problem", ",", "but", "an", "MWAVE", "problem", "that", "is", "fixed", "with", "the", "latest", "MWAVE", "patches", ".", "So", ",", "in", "other", "words", ",", "don", "'", "t", "bypass", "the", "test", "for", "MWAVES", "!", "I", "have", "Windows", "95", "on", "/", "dev", "/", "hda1", ",", "swap", "on", "/", "dev", "/", "hda2", ",", "and", "Red", "Hat", "5", "on", "/", "dev", "/", "hda3", ".", "The", "steps", ",", "then", ":", "Boot", "to", "Linux", ".", "Mount", "Windows", "95", "file", "system", "(", "assume", "mount", "point", "=", "/", "dos95", ")", ".", "mkdir", "/", "dos95", "/", "linux", "mkdir", "/", "dos95", "/", "linux", "/", "boot", "mkdir", "/", "dos95", "/", "linux", "/", "boot", "/", "parms", "Copy", "the", "kernel", ",", "any", "initrd", "image", ",", "and", "loadlin", "to", "/", "dos95", "/", "linux", "/", "boot", "/", ".", "Reboot", "to", "Windows", "95", ".", "Edit", "C", ":", "/", "msdos", ".", "sys", "and", "add", "or", "change", "the", "following", ":", "Logo", "=", "0", "BootGUI", "=", "0", "Note", "that", "msdos", ".", "sys", "is", "a", "text", "file", "but", "it", "needs", "to", "be", "made", "'", "unhidden", "'", ",", "readable", "and", "writable", "before", "it", "can", "be", "edited", ".", "This", "can", "be", "done", "with", "DOS", "'", "\"", "attrib", "\"", "command", ".", "Edit", "config", ".", "sys", "to", "have", "multiple", "config", "menus", ".", "I", "have", "one", "for", "windows", "95", "and", "five", "for", "Linux", ",", "like", "this", ":", "[", "menu", "]", "menuitem", "=", "W95", ",", "Windows", "95", "menuitem", "=", "LINTP", ",", "Linux", "-", "ThinkPad", "menuitem", "=", "LINTP3", ",", "Linux", "-", "ThinkPad", "Console", "menuitem", "=", "LINDOC", ",", "Linux", "-", "Docked", "menuitem", "=", "LINDOC3", ",", "Linux", "-", "Docked", "Console", "menuitem", "=", "LIN1", ",", "Linux", "-", "Single", "User", "Mode", "REM", "menudefault", "=", "W95", ",", "10", "[", "W95", "]", "[", "LINTP", "]", "[", "LINDOC", "]", "[", "LINTP3", "]", "[", "LINDOC3", "]", "[", "LIN1", "]", "[", "COMMON", "]", "FILES", "=", "30", "REM", "Please", "read", "README", ".", "TXT", "in", "C", ":", "\\", "MWW", "subdirectory", "before", "changing", "the", "DOS", "=", "statement", ".", "DOS", "=", "HIGH", ",", "UMB", "DEVICE", "=", "C", ":", "\\", "MWW", "\\", "MANAGER", "\\", "MWD50430", ".", "EXE", "SHELL", "=", "c", ":", "\\", "command", ".", "com", "/", "e", ":", "2048", "The", "important", "things", "are", "the", "SHELL", "and", "DEVICE", "statements", ".", "Then", "change", "autoexec", ".", "bat", ".", "Basically", "everything", "in", "there", "originally", "should", "be", "done", "ONLY", "when", "Windows", "95", "is", "booted", ".", "Then", "you", "add", "new", "things", "specifically", "for", "Linux", ".", "Mine", "is", "as", "follows", "@", "ECHO", "OFF", "if", "\"", "%", "CONFIG", "%", "\"", "=", "=", "\"", "W95", "\"", "goto", "W95", "REM", "REM", "Linux", "stuff", "REM", "SET", "MWPATH", "=", "C", ":", "\\", "MWW", "\\", "DLL", ";", "C", ":", "\\", "MWW", "\\", "MWGAMES", ";", "C", ":", "\\", "MWW", "\\", "DSP", "SET", "BLASTER", "=", "A220", "I5", "D1", "SET", "MWROOT", "=", "C", ":", "\\", "MWW", "SET", "LIBPATH", "=", "C", ":", "\\", "MWW", "\\", "DLL", "SET", "PATH", "=", "C", ":", "\\", "WINDOWS", ";", "C", ":", "\\", "MWW", "\\", "DLL", ";", "CALL", "MWAVE", "START", "NOSHOW", "c", ":", "\\", "linux", "\\", "boot", "\\", "loadlin", ".", "exe", "@", "c", ":", "\\", "linux", "\\", "boot", "\\", "parms", "\\", "%", "CONFIG", "%", ".", "par", ":", "W95", "REM", "REM", "Windows", "95", "stuff", "REM", "c", ":", "\\", "toolkit", "\\", "guard", "SET", "MSINPUT", "=", "C", ":", "\\", "MSINPUT", "SET", "MWPATH", "=", "C", ":", "\\", "MWW", "\\", "DLL", ";", "C", ":", "\\", "MWW", "\\", "MWGAMES", ";", "C", ":", "\\", "MWW", "\\", "DSP", "REM", "The", "following", "is", "used", "by", "DOS", "games", "to", "recognize", "Sound", "Blaster", "hardware", ".", "REM", "If", "hardware", "settings", "are", "changed", ",", "please", "change", "this", "line", "as", "well", ".", "REM", "See", "the", "Mwave", "README", "file", "for", "instructions", ".", "SET", "BLASTER", "=", "A220", "I5", "D1", "SET", "MWROOT", "=", "C", ":", "\\", "MWW", "SET", "LIBPATH", "=", "C", ":", "\\", "MWW", "\\", "DLL", "SET", "PATH", "=", "C", ":", "\\", "WINDOWS", ";", "C", ":", "\\", "WINDOWS", "\\", "COMMAND", ";", "E", ":", "\\", "ORAWIN95", "\\", "BIN", ";", "f", ":", "\\", "msdev", "\\", "bin", ";", "e", ":", "\\", "v30", "\\", "bin", ".", "dbg", ";", "v", ":", "\\", "devt", "\\", "v30", "\\", "bin", ";", "c", ":", "\\", "JavaSDK", "\\", "Bin", ";", "C", ":", "\\", "MWW", "\\", "DLL", ";", "SET", "INCLUDE", "=", "f", ":", "\\", "MSDEV", "\\", "INCLUDE", ";", "F", ":", "\\", "MSDEV", "\\", "MFC", "\\", "INCLUDE", "SET", "LIB", "=", "F", ":", "\\", "MSDEV", "\\", "LIB", ";", "F", ":", "\\", "MSDEV", "\\", "MFC", "\\", "LIB", "win", "Now", "build", "a", "file", "in", "c", ":", "\\", "linux", "\\", "boot", "\\", "parms", "for", "each", "Linux", "config", "that", "you", "have", ".", "For", "example", ",", "my", "LINDOC3", "config", "is", "for", "a", "docked", "Thinkpad", "at", "runlevel", "3", "with", "no", "initrd", "image", ",", "and", "has", "a", "parameter", "file", "named", "LINDOC3", ".", "PAR", "in", "c", ":", "\\", "linux", "\\", "boot", "\\", "parms", ":", "#", "LOADLIN", "@", "param_file", "image", "=", "other_image", "root", "=", "/", "dev", "/", "other", "#", "#", "Linux", "Console", "in", "docking", "station", "#", "c", ":", "\\", "linux", "\\", "boot", "\\", "zImage", ".", "krn", "#", "First", "value", "must", "be", "filename", "of", "Linux", "kernel", ".", "root", "=", "/", "dev", "/", "hda3", "#", "device", "which", "gets", "mounted", "as", "root", "FS", "ro", "#", "Other", "kernel", "arguments", "go", "here", ".", "apm", "=", "off", "doc", "=", "yes", "3", "The", "doc", "=", "yes", "parameter", "is", "an", "environment", "variable", "used", "by", "my", "init", "scripts", ",", "not", "a", "kernel", "argument", ".", "However", ",", "the", "apm", "=", "off", "parameter", "IS", "a", "kernel", "argument", "!", "APM", ",", "at", "least", "in", "my", "setup", ",", "causes", "the", "kernel", "to", "crash", "when", "loaded", "via", "loadlin", "(", "but", "NOT", "when", "loaded", "via", "LILO", ")", ".", "The", "APM", "stuff", "COULD", "be", "forced", "out", "of", "the", "kernel", "via", "the", "kernel", "compile", "options", ".", "Instead", ",", "I", "got", "an", "unofficial", "patch", "to", "the", "APM", "drivers", "that", "allows", "them", "to", "be", "dynamically", "deactivated", "via", "kernel", "arguments", ".", "Whatever", "you", "chose", "to", "document", ",", "APM", ",", "it", "seems", ",", "MUST", "be", "off", "for", "setups", "like", "mine", ".", "Now", "make", "sure", "C", ":", "\\", "MWW", "\\", "MWCONFIG", ".", "REF", "looks", "like", "this", ":", "[", "NativeDOS", "]", "Default", "=", "SB1", ".", "5", "SBInputSource", "=", "CD", "SYNTH", "=", "FM", "QSound", "=", "OFF", "Reverb", "=", "OFF", "Chorus", "=", "OFF", "ReverbDepth", "=", "5", "ChorusDepth", "=", "5", "SBInputVolume", "=", "5", "SBMainVolume", "=", "10", "SBWaveVolume", "=", "10", "SBSynthVolume", "=", "10", "WaveTableVolume", "=", "10", "AudioPowerDriver", "=", "ON", "[", "FastCFG", "]", "Show", "=", "No", "HideOption", "=", "Off", "OR", "the", "Default", "=", "line", "COULD", "be", "Default", "=", "SBPRO", "Reboot", "to", "Windows", "95", "and", "choose", "Linux", ".", "When", "booted", ",", "use", "sndconfig", "to", "configure", "the", "sound", "modules", "and", "voil", "\u00e0", "-", "ThinkPad", "sound", "with", "Linux", ".", "Now", "the", "gotchas", "-", "you", "can", "either", "have", "CD", "sound", "OR", "Mixers", "but", "not", "both", ".", "That", "'", "s", "a", "problem", "with", "the", "SB1", ".", "5", "(", "CD", "sound", ")", "or", "SBPRO", "(", "Mixers", ")", "settings", ".", "No", "one", "knows", "why", "this", "is", "!", "For", "some", "reason", "MPEG3", "files", ",", "when", "played", "through", "mpg123", ",", "sound", "like", "they", "are", "playing", "at", "1", "/", "8th", "speed", "-", "not", "very", "useful", "!", "If", "you", "have", "ANY", "insight", "on", "why", "this", "second", "thing", "might", "be", "happening", ",", "I", "would", "be", "grateful", ".", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "Martin", "John", "Bartlett", "_", "/", "_", "/", "_", "/", "_", "/", "(", "martin", "@", "nitram", ".", "demon", ".", "co", ".", "uk", ")", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "_", "/", "=", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "==", "@", "@", "-", "1", ",", "51", "+", "0", ",", "0", "@", "@", "OSS", "Kernel", "Parameters", "~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "~~", "See", "Documentation", "/", "admin", "-", "guide", "/", "kernel", "-", "parameters", ".", "rst", "for", "general", "information", "on", "specifying", "module", "parameters", ".", "This", "document", "may", "not", "be", "entirely", "up", "to", "date", "and", "comprehensive", ".", "The", "command", "\"", "modinfo", "-", "p", "$", "{", "modulename", "}", "\"", "shows", "a", "current", "list", "of", "all", "parameters", "of", "a", "loadable", "module", ".", "Loadable", "modules", ",", "after", "being", "loaded", "into", "the", "running", "kernel", ",", "also", "reveal", "their", "parameters", "in", "/", "sys", "/", "module", "/", "${", "modulename", "}", "/", "parameters", "/", ".", "Some", "of", "these", "parameters", "may", "be", "changed", "at", "runtime", "by", "the", "command", "\"", "echo", "-", "n", "$", "{", "value", "}", ">", "/", "sys", "/", "module", "/", "${", "modulename", "}", "/", "parameters", "/", "${", "parm", "}", "\".", "ad1848", "=", "[", "HW", ",", "OSS", "]", "Format", ":", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "dma2", ">", ",<", "type", ">", "aedsp16", "=", "[", "HW", ",", "OSS", "]", "Audio", "Excel", "DSP", "16", "Format", ":", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "mss_io", ">", ",<", "mpu_io", ">", ",<", "mpu_irq", ">", "See", "also", "header", "of", "sound", "/", "oss", "/", "aedsp16", ".", "c", ".", "dmasound", "=", "[", "HW", ",", "OSS", "]", "Sound", "subsystem", "buffers", "mpu401", "=", "[", "HW", ",", "OSS", "]", "Format", ":", "<", "io", ">", ",<", "irq", ">", "opl3", "=", "[", "HW", ",", "OSS", "]", "Format", ":", "<", "io", ">", "pas2", "=", "[", "HW", ",", "OSS", "]", "Format", ":", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "dma16", ">", ",<", "sb_io", ">", ",<", "sb_irq", ">", ",<", "sb_dma", ">", ",<", "sb_dma16", ">", "pss", "=", "[", "HW", ",", "OSS", "]", "Personal", "Sound", "System", "(", "ECHO", "ESC614", ")", "Format", ":", "<", "io", ">", ",<", "mss_io", ">", ",<", "mss_irq", ">", ",<", "mss_dma", ">", ",<", "mpu_io", ">", ",<", "mpu_irq", ">", "sscape", "=", "[", "HW", ",", "OSS", "]", "Format", ":", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "mpu_io", ">", ",<", "mpu_irq", ">", "trix", "=", "[", "HW", ",", "OSS", "]", "MediaTrix", "AudioTrix", "Pro", "Format", ":", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "dma2", ">", ",<", "sb_io", ">", ",<", "sb_irq", ">", ",<", "sb_dma", ">", ",<", "mpu_io", ">", ",<", "mpu_irq", ">", "uart401", "=", "[", "HW", ",", "OSS", "]", "Format", ":", "<", "io", ">", ",<", "irq", ">", "uart6850", "=", "[", "HW", ",", "OSS", "]", "Format", ":", "<", "io", ">", ",<", "irq", ">", "waveartist", "=", "[", "HW", ",", "OSS", "]", "Format", ":", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "dma2", ">", "@", "@", "-", "1", ",", "30", "+", "0", ",", "0", "@", "@", "modprobe", "sound", "insmod", "ad1848", "insmod", "gus", "io", "=", "*", "irq", "=", "*", "dma", "=", "*", ".", "..", "This", "loads", "the", "driver", "for", "the", "Gravis", "Ultrasound", "family", "of", "sound", "cards", ".", "The", "gus", "module", "takes", "the", "following", "arguments", "io", "I", "/", "O", "address", "of", "the", "Ultrasound", "card", "(", "eg", ".", "io", "=", "0x220", ")", "irq", "IRQ", "of", "the", "Sound", "Blaster", "card", "dma", "DMA", "channel", "for", "the", "Sound", "Blaster", "dma16", "2nd", "DMA", "channel", ",", "only", "needed", "for", "full", "duplex", "operation", "type", "1", "for", "PnP", "card", "gus16", "1", "for", "using", "16", "bit", "sampling", "daughter", "board", "no_wave_dma", "Set", "to", "disable", "DMA", "usage", "for", "wavetable", "(", "see", "note", ")", "db16", "?", "??", "no_wave_dma", "option", "This", "option", "defaults", "to", "a", "value", "of", "0", ",", "which", "allows", "the", "Ultrasound", "wavetable", "DSP", "to", "use", "DMA", "for", "playback", "and", "downloading", "samples", ".", "This", "is", "the", "same", "as", "the", "old", "behaviour", ".", "If", "set", "to", "1", ",", "no", "DMA", "is", "needed", "for", "downloading", "samples", ",", "and", "allows", "owners", "of", "a", "GUS", "MAX", "to", "make", "use", "of", "simultaneous", "digital", "audio", "(", "/", "dev", "/", "dsp", ")", ",", "MIDI", ",", "and", "wavetable", "playback", ".", "If", "you", "have", "problems", "in", "recording", "with", "GUS", "MAX", ",", "you", "could", "try", "to", "use", "just", "one", "8", "bit", "DMA", "channel", ".", "Recording", "will", "not", "work", "with", "one", "DMA", "channel", "if", "it", "'", "s", "a", "16", "bit", "one", ".", "@", "@", "-", "527", ",", "11", "+", "527", ",", "6", "@", "@", "W", ":", "http", ":", "//", "ez", ".", "analog", ".", "com", "/", "community", "/", "linux", "-", "device", "-", "drivers", "S", ":", "Supported", "F", ":", "drivers", "/", "input", "/", "misc", "/", "adxl34x", ".", "c", "AEDSP16", "DRIVER", "M", ":", "Riccardo", "Facchetti", "<", "fizban", "@", "tin", ".", "it", ">", "S", ":", "Maintained", "F", ":", "sound", "/", "oss", "/", "aedsp16", ".", "c", "AF9013", "MEDIA", "DRIVER", "M", ":", "Antti", "Palosaari", "<", "crope", "@", "iki", ".", "fi", ">", "L", ":", "linux", "-", "media", "@", "vger", ".", "kernel", ".", "org", "@", "@", "-", "9199", ",", "12", "+", "9194", ",", "6", "@", "@", "F", ":", "include", "/", "linux", "/", "dt", "-", "bindings", "/", "mux", "/", "F", ":", "include", "/", "linux", "/", "mux", "/", "F", ":", "drivers", "/", "mux", "/", "MULTISOUND", "SOUND", "DRIVER", "M", ":", "Andrew", "Veliath", "<", "andrewtv", "@", "usa", ".", "net", ">", "S", ":", "Maintained", "F", ":", "Documentation", "/", "sound", "/", "oss", "/", "MultiSound", "F", ":", "sound", "/", "oss", "/", "msnd", "*", "MULTITECH", "MULTIPORT", "CARD", "(", "ISICOM", ")", "S", ":", "Orphan", "F", ":", "drivers", "/", "tty", "/", "isicom", ".", "c", "@", "@", "-", "3", ",", "25", "+", "3", ",", "7", "@", "@", "menuconfig", "SOUND", "depends", "on", "HAS_IOMEM", "help", "If", "you", "have", "a", "sound", "card", "in", "your", "computer", ",", "i", ".", "e", ".", "if", "it", "can", "say", "more", "than", "an", "occasional", "beep", ",", "say", "Y", ".", "Be", "sure", "to", "have", "all", "the", "information", "about", "your", "sound", "card", "and", "its", "configuration", "down", "(", "I", "/", "O", "port", ",", "interrupt", "and", "DMA", "channel", ")", ",", "because", "you", "will", "be", "asked", "for", "it", ".", "You", "want", "to", "read", "the", "Sound", "-", "HOWTO", ",", "available", "from", "<", "http", ":", "//", "www", ".", "tldp", ".", "org", "/", "docs", ".", "html", "#", "howto", ">", ".", "General", "information", "about", "the", "modular", "sound", "system", "is", "contained", "in", "the", "files", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "Introduction", ">", ".", "The", "file", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "README", ".", "OSS", ">", "contains", "some", "slightly", "outdated", "but", "still", "useful", "information", "as", "well", ".", "Newer", "sound", "driver", "documentation", "is", "found", "in", "<", "file", ":", "Documentation", "/", "sound", "/", "alsa", "/", "*>", ".", "If", "you", "have", "a", "PnP", "sound", "card", "and", "you", "want", "to", "configure", "it", "at", "boot", "time", "using", "the", "ISA", "PnP", "tools", "(", "read", "<", "http", ":", "//", "www", ".", "roestock", ".", "demon", ".", "co", ".", "uk", "/", "isapnptools", "/", ">)", ",", "then", "you", "need", "to", "compile", "the", "sound", "card", "support", "as", "a", "module", "and", "load", "that", "module", "after", "the", "PnP", "configuration", "is", "finished", ".", "To", "do", "this", ",", "choose", "M", "here", "and", "read", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "README", ".", "modules", ">", ";", "the", "module", "will", "be", "called", "soundcore", ".", "than", "an", "occasional", "beep", ",", "say", "Y", ".", "if", "SOUND", "@", "@", "-", "114", ",", "19", "+", "96", ",", "6", "@", "@", "source", "\"", "sound", "/", "synth", "/", "Kconfig", "\"", "endif", "#", "SND", "menuconfig", "SOUND_PRIME", "tristate", "\"", "Open", "Sound", "System", "(", "DEPRECATED", ")", "\"", "select", "SOUND_OSS_CORE", "depends", "on", "BROKEN", "help", "Say", "'", "Y", "'", "or", "'", "M", "'", "to", "enable", "Open", "Sound", "System", "drivers", ".", "if", "SOUND_PRIME", "source", "\"", "sound", "/", "oss", "/", "Kconfig", "\"", "endif", "#", "SOUND_PRIME", "endif", "#", "!", "UML", "endif", "#", "SOUND", "@", "@", "-", "2", ",", "8", "+", "2", ",", "7", "@", "@", "#", "obj", "-", "$(", "CONFIG_SOUND", ")", "+", "=", "soundcore", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_PRIME", ")", "+", "=", "oss", "/", "obj", "-", "$(", "CONFIG_DMASOUND", ")", "+", "=", "oss", "/", "obj", "-", "$(", "CONFIG_DMASOUND", ")", "+", "=", "oss", "/", "dmasound", "/", "obj", "-", "$(", "CONFIG_SND", ")", "+", "=", "core", "/", "i2c", "/", "drivers", "/", "isa", "/", "pci", "/", "ppc", "/", "arm", "/", "sh", "/", "synth", "/", "usb", "/", "\\", "firewire", "/", "sparc", "/", "spi", "/", "parisc", "/", "pcmcia", "/", "mips", "/", "soc", "/", "atmel", "/", "hda", "/", "x86", "/", "obj", "-", "$(", "CONFIG_SND_AOA", ")", "+", "=", "aoa", "/", "@", "@", "-", "1", ",", "369", "+", "0", ",", "0", "@", "@", "Note", "these", "changes", "relate", "to", "Hannu", "'", "s", "code", "and", "don", "'", "t", "include", "the", "changes", "made", "outside", "of", "this", "for", "modularising", "the", "sound", "Changelog", "for", "version", "3", ".", "8o", "Since", "3", ".", "8h", "Included", "support", "for", "OPL3", "-", "SA1", "and", "SoftOSS", "Since", "3", ".", "8", "Fixed", "SNDCTL_DSP_GETOSPACE", "Compatibility", "fixes", "for", "Linux", "2", ".", "1", ".", "47", "Since", "3", ".", "8", "-", "beta21", "Fixed", "all", "known", "bugs", "(", "I", "think", ")", ".", "Since", "3", ".", "8", "-", "beta8", "Lot", "of", "fixes", "to", "audio", "playback", "code", "in", "dmabuf", ".", "c", "Since", "3", ".", "8", "-", "beta6", "Fixed", "the", "famous", "Quake", "delay", "bug", ".", "Since", "3", ".", "8", "-", "beta5", "Fixed", "many", "bugs", "in", "audio", "playback", ".", "Since", "3", ".", "8", "-", "beta4", "Just", "minor", "changes", ".", "Since", "3", ".", "8", "-", "beta1", "Major", "rewrite", "of", "audio", "playback", "handling", ".", "Added", "AWE32", "support", "by", "Takashi", "Iwai", "(", "in", ".", "/", "lowlevel", "/", ").", "Since", "3", ".", "7", "-", "beta", "#", "Passing", "of", "ioctl", "(", ")", "parameters", "between", "soundcard", ".", "c", "and", "other", "modules", "has", "been", "changed", "so", "that", "arg", "always", "points", "to", "kernel", "space", ".", "Some", "bugfixes", ".", "Since", "3", ".", "7", "-", "beta5", "Disabled", "MIDI", "input", "with", "GUS", "PnP", "(", "Interwave", ")", ".", "There", "seems", "to", "be", "constant", "stream", "of", "received", "0x00", "bytes", "when", "the", "MIDI", "receiver", "is", "enabled", ".", "Since", "3", ".", "5", "Changes", "almost", "everywhere", ".", "Support", "for", "OPTi", "82C924", "-", "based", "sound", "cards", ".", "Since", "3", ".", "5", ".", "4", "-", "beta8", "Fixed", "a", "bug", "in", "handling", "of", "non", "-", "fragment", "sized", "writes", "in", "16", "bit", "/", "stereo", "mode", "with", "GUS", ".", "Limited", "minimum", "fragment", "size", "with", "some", "audio", "devices", "(", "GUS", "=", "512", "and", "SB", "=", "32", ")", ".", "These", "devices", "require", "more", "time", "to", "\"", "recover", "\"", "from", "processing", "of", "each", "fragment", ".", "Since", "3", ".", "5", ".", "4", "-", "beta6", "/", "7", "There", "seems", "to", "be", "problems", "in", "the", "OPTi", "82C930", "so", "cards", "based", "on", "this", "chip", "don", "'", "t", "necessarily", "work", "yet", ".", "There", "are", "problems", "in", "detecting", "the", "MIDI", "interface", ".", "Also", "mixer", "volumes", "may", "be", "seriously", "wrong", "on", "some", "systems", ".", "You", "can", "safely", "use", "this", "driver", "version", "with", "C930", "if", "it", "looks", "to", "work", ".", "However", "please", "don", "'", "t", "complain", "if", "you", "have", "problems", "with", "it", ".", "C930", "support", "should", "be", "fixed", "in", "future", "releases", ".", "Got", "initialization", "of", "GUS", "PnP", "to", "work", ".", "With", "this", "version", "GUS", "PnP", "should", "work", "in", "GUS", "compatible", "mode", "after", "initialization", "using", "isapnptools", ".", "Fixed", "a", "bug", "in", "handling", "of", "full", "duplex", "cards", "in", "write", "only", "mode", ".", "This", "has", "been", "causing", "\"", "audio", "device", "opening", "\"", "errors", "with", "RealAudio", "player", ".", "Since", "3", ".", "5", ".", "4", ".", "beta5", "Changes", "to", "OPTi", "82C930", "driver", ".", "Major", "changes", "to", "the", "Soundscape", "driver", ".", "The", "driver", "requires", "now", "just", "one", "DMA", "channel", ".", "The", "extra", "audio", "/", "dsp", "device", "(", "the", "\"", "Not", "functional", "\"", "one", ")", "used", "for", "code", "download", "in", "the", "earlier", "versions", "has", "been", "eliminated", ".", "There", "is", "now", "just", "one", "/", "dev", "/", "dsp", "#", "device", "which", "is", "used", "both", "for", "code", "download", "and", "audio", ".", "Since", "3", ".", "5", ".", "4", ".", "beta4", "Minor", "changes", ".", "Since", "3", ".", "5", ".", "4", "-", "beta2", "Fixed", "silent", "playback", "with", "ESS", "688", "/", "1688", ".", "Got", "SB16", "to", "work", "without", "the", "16", "bit", "DMA", "channel", "(", "only", "the", "8", "bit", "one", "is", "required", "for", "8", "and", "16", "bit", "modes", ")", ".", "Added", "the", "\"", "lowlevel", "\"", "subdirectory", "for", "additional", "low", "level", "drivers", "that", "are", "not", "part", "of", "USS", "core", ".", "See", "lowlevel", "/", "README", "for", "more", "info", ".", "Included", "support", "for", "ACI", "mixer", "(", "by", "Markus", "Kuhn", ")", ".", "ACI", "is", "a", "mixer", "used", "in", "miroPCM", "sound", "cards", ".", "See", "lowlevel", "/", "aci", ".", "readme", "for", "more", "info", ".", "Support", "for", "Aztech", "Washington", "chipset", "(", "AZT2316", "ASIC", ")", ".", "Since", "3", ".", "5", ".", "4", "-", "beta1", "Reduced", "clicking", "with", "AD1848", ".", "Support", "for", "OPTi", "82C930", ".", "Only", "half", "duplex", "at", "this", "time", ".", "16", "bit", "playback", "is", "sometimes", "just", "white", "noise", "(", "occurs", "randomly", ")", ".", "Since", "3", ".", "5", ".", "2", "Major", "changes", "to", "the", "SB", "/", "Jazz16", "/", "ESS", "driver", "(", "most", "parts", "rewritten", ")", ".", "The", "most", "noticeable", "new", "feature", "is", "support", "for", "multiple", "SB", "cards", "at", "the", "same", "time", ".", "Renamed", "sb16_midi", ".", "c", "to", "uart401", ".", "c", ".", "Also", "modified", "it", "to", "work", "also", "with", "other", "MPU401", "UART", "compatible", "cards", "than", "SB16", "/", "ESS", "/", "Jazz", ".", "Some", "changes", "which", "reduce", "clicking", "in", "audio", "playback", ".", "Copying", "policy", "is", "now", "GPL", ".", "Since", "3", ".", "5", ".", "1", "TB", "Maui", "initialization", "support", "Since", "3", ".", "5", "Improved", "handling", "of", "playback", "underrun", "situations", ".", "Since", "3", ".", "5", "-", "beta10", "Bug", "fixing", "Since", "3", ".", "5", "-", "beta9", "Fixed", "for", "compatibility", "with", "Linux", "1", ".", "3", ".", "70", "and", "later", ".", "Changed", "boot", "time", "passing", "of", "16", "bit", "DMA", "channel", "number", "to", "SB", "driver", ".", "Since", "3", ".", "5", "-", "beta8", "Minor", "changes", "Since", "3", ".", "5", "-", "beta7", "enhancements", "to", "configure", "program", "(", "by", "Jeff", "Tranter", ")", ":", "-", "prompts", "are", "in", "same", "format", "as", "1", ".", "3", ".", "x", "Linux", "kernel", "config", "program", "-", "on", "-", "line", "help", "for", "each", "question", "-", "fixed", "some", "compile", "warnings", "detected", "by", "gcc", "/", "g", "+", "+", "-", "Wall", "-", "minor", "grammatical", "changes", "to", "prompts", "Since", "3", ".", "5", "-", "beta6", "Fixed", "bugs", "in", "mmap", "(", ")", "support", ".", "Minor", "changes", "to", "Maui", "driver", ".", "Since", "3", ".", "5", "-", "beta5", "Fixed", "crash", "after", "recording", "with", "ESS688", ".", "It", "'", "s", "generally", "a", "good", "idea", "to", "stop", "inbound", "DMA", "transfers", "before", "freeing", "the", "memory", "buffer", ".", "Fixed", "handling", "of", "AD1845", "codec", "(", "for", "example", "Shuttle", "Sound", "System", ")", ".", "Few", "other", "fixes", ".", "Since", "3", ".", "5", "-", "beta4", "Fixed", "bug", "in", "handling", "of", "uninitialized", "instruments", "with", "GUS", ".", "Since", "3", ".", "5", "-", "beta3", "Few", "changes", "which", "decrease", "popping", "at", "end", "/", "beginning", "of", "audio", "playback", ".", "Since", "3", ".", "5", "-", "beta2", "Removed", "MAD16", "+", "CS4231", "hack", "made", "in", "previous", "version", "since", "it", "didn", "'", "t", "help", ".", "Fixed", "the", "above", "bug", "in", "proper", "way", "and", "in", "proper", "place", ".", "Many", "thanks", "to", "James", "Hightower", ".", "Since", "3", ".", "5", "-", "beta1", "Bug", "fixes", ".", "Full", "duplex", "audio", "with", "MAD16", "+", "CS4231", "may", "work", "now", ".", "The", "driver", "configures", "SB", "DMA", "of", "MAD16", "so", "that", "it", "doesn", "'", "t", "conflict", "with", "codec", "'", "s", "DMA", "channels", ".", "The", "side", "effect", "is", "that", "all", "8", "bit", "DMA", "channels", "(", "0", ",", "1", ",", "3", ")", "are", "populated", "in", "duplex", "mode", ".", "Since", "3", ".", "5", "-", "alpha9", "Bug", "fixes", "(", "mostly", "in", "Jazz16", "and", "ESS1688", "/", "688", "supports", ")", ".", "Temporarily", "disabled", "recording", "with", "ESS1688", "/", "688", "since", "it", "causes", "crash", ".", "Changed", "audio", "buffer", "partitioning", "algorithm", "so", "that", "it", "selects", "smaller", "fragment", "size", "than", "earlier", ".", "This", "improves", "real", "time", "capabilities", "of", "the", "driver", "and", "makes", "recording", "to", "disk", "to", "work", "better", ".", "Unfortunately", "this", "change", "breaks", "some", "programs", "which", "assume", "that", "fragments", "cannot", "be", "shorter", "than", "4096", "bytes", ".", "Since", "3", ".", "5", "-", "alpha8", "Bug", "fixes", "Since", "3", ".", "5", "-", "alpha7", "Linux", "kernel", "compatible", "configuration", "(", "_EXPERIMENTAL_", ")", ".", "Enable", "using", "command", "\"", "cd", "/", "linux", "/", "drivers", "/", "sound", ";", "make", "script", "\"", "and", "then", "just", "run", "kernel", "'", "s", "make", "config", "normally", ".", "Minor", "fixes", "to", "the", "SB", "support", ".", "Hopefully", "the", "driver", "works", "with", "all", "SB", "models", "now", ".", "Added", "support", "for", "ESS", "ES1688", "\"", "AudioDrive", "\"", "based", "cards", ".", "Since", "3", ".", "5", "-", "alpha6", "SB", "Pro", "and", "SB16", "supports", "are", "no", "longer", "separately", "selectable", "options", ".", "Enabling", "SB", "enables", "them", "too", ".", "Changed", "all", "#", "ifndef", "EXCLUDE_xx", "stuff", "to", "#", "ifdef", "CONFIG_xx", ".", "Modified", "configure", "to", "handle", "this", ".", "Removed", "initialization", "messages", "from", "the", "modularized", "version", ".", "They", "can", "be", "enabled", "by", "using", "init_trace", "=", "1", "in", "the", "insmod", "command", "line", "(", "insmod", "sound", "init_trace", "=", "1", ")", ".", "More", "AIX", "stuff", ".", "Added", "support", "for", "synchronizing", "dsp", "/", "audio", "devices", "with", "/", "dev", "/", "sequencer", ".", "mmap", "(", ")", "support", "for", "dsp", "/", "audio", "devices", ".", "Since", "3", ".", "5", "-", "alpha5", "AIX", "port", ".", "Changed", "some", "xxx_PATCH", "macros", "in", "soundcard", ".", "h", "to", "work", "with", "big", "endian", "machines", ".", "Since", "3", ".", "5", "-", "alpha4", "Removed", "the", "'", "setfx", "'", "stuff", "from", "the", "version", "distributed", "with", "kernel", "sources", ".", "Running", "'", "setfx", "'", "is", "required", "again", ".", "Since", "3", ".", "5", "-", "alpha3", "Moved", "stuff", "from", "the", "'", "setfx", "'", "program", "to", "the", "AudioTrix", "Pro", "driver", ".", "Since", "3", ".", "5", "-", "alpha2", "Modifications", "to", "makefile", "and", "configure", ".", "c", ".", "Unnecessary", "sources", "are", "no", "longer", "compiled", ".", "Newly", "created", "local", ".", "h", "is", "also", "copied", "to", "/", "etc", "/", "soundconf", ".", "\"", "make", "oldconfig", "\"", "reads", "/", "etc", "/", "soundconf", "and", "produces", "new", "local", ".", "h", "which", "is", "compatible", "with", "current", "version", "of", "the", "driver", ".", "Some", "fixes", "to", "the", "SB16", "support", ".", "Fixed", "random", "protection", "fault", "in", "gus_wave", ".", "c", "Since", "3", ".", "5", "-", "alpha1", "Modified", "to", "work", "with", "Linux", "-", "1", ".", "3", ".", "33", "and", "later", "Some", "minor", "changes", "Since", "3", ".", "0", ".", "2", "Support", "for", "CS4232", "based", "PnP", "cards", "(", "AcerMagic", "S23", "etc", ")", ".", "Full", "duplex", "support", "for", "some", "CS4231", ",", "CS4232", "and", "AD1845", "based", "cards", "(", "GUS", "MAX", ",", "AudioTrix", "Pro", ",", "AcerMagic", "S23", "and", "many", "MAD16", "/", "Mozart", "cards", "having", "a", "codec", "mentioned", "above", ")", ".", "Almost", "fully", "rewritten", "loadable", "modules", "support", ".", "Fixed", "some", "bugs", ".", "Huge", "amount", "of", "testing", "(", "more", "testing", "is", "still", "required", ")", ".", "mmap", "(", ")", "support", "(", "works", "with", "some", "cards", ")", ".", "Requires", "much", "more", "testing", ".", "Sample", "/", "patch", "/", "program", "loading", "for", "TB", "Maui", "/", "Tropez", ".", "No", "initialization", "since", "TB", "doesn", "'", "t", "allow", "me", "to", "release", "that", "code", ".", "Using", "CS4231", "compatible", "codecs", "as", "timer", "for", "/", "dev", "/", "music", ".", "Since", "3", ".", "0", ".", "1", "Added", "allocation", "of", "I", "/", "O", "ports", ",", "DMA", "channels", "and", "interrupts", "to", "the", "initialization", "code", ".", "This", "may", "break", "modules", "support", "since", "the", "driver", "may", "not", "free", "some", "resources", "on", "unload", ".", "Should", "be", "fixed", "soon", ".", "Since", "3", ".", "0", "Some", "important", "bug", "fixes", ".", "select", "(", ")", "for", "/", "dev", "/", "dsp", "and", "/", "dev", "/", "audio", "(", "Linux", "only", ")", ".", "(", "To", "use", "select", "(", ")", "with", "read", ",", "you", "have", "to", "call", "read", "(", ")", "to", "start", "the", "recording", ".", "Calling", "write", "(", ")", "kills", "recording", "immediately", "so", "use", "select", "(", ")", "carefully", "when", "you", "are", "writing", "a", "half", "duplex", "app", ".", "Full", "duplex", "mode", "is", "not", "implemented", "yet", ".", ")", "Select", "works", "also", "with", "/", "dev", "/", "sequencer", "and", "/", "dev", "/", "music", ".", "Maybe", "with", "/", "dev", "/", "midi", "#", "#", "too", ".", "Since", "3", ".", "0", "-", "beta2", "Minor", "fixes", ".", "Added", "Readme", ".", "cards", "Since", "3", ".", "0", "-", "beta1", "Minor", "fixes", "to", "the", "modules", "support", ".", "Eliminated", "call", "to", "sb_free_irq", "(", ")", "in", "ad1848", ".", "c", "Rewritten", "MAD16", "&", "Mozart", "support", "(", "not", "tested", "with", "MAD16", "Pro", ")", ".", "Fix", "to", "DMA", "initialization", "of", "PSS", "cards", ".", "Some", "fixes", "to", "ad1848", "/", "cs42xx", "mixer", "support", "(", "GUS", "MAX", ",", "MSS", ",", "etc", ".", ")", "Fixed", "some", "bugs", "in", "the", "PSS", "driver", "which", "caused", "I", "/", "O", "errors", "with", "the", "MSS", "mode", "(", "/", "dev", "/", "dsp", ")", ".", "Since", "3", ".", "0", "-", "950506", "Recording", "with", "GUS", "MAX", "fixed", ".", "It", "works", "when", "the", "driver", "is", "configured", "to", "use", "two", "DMA", "channels", "with", "GUS", "MAX", "(", "16", "bit", "ones", "recommended", ")", ".", "Since", "3", ".", "0", "-", "94xxxx", "Too", "many", "changes", "Since", "3", ".", "0", "-", "940818", "Fixes", "for", "Linux", "1", ".", "1", ".", "4x", ".", "Disables", "Disney", "Sound", "System", "with", "SG", "NX", "Pro", "16", "(", "less", "noise", ")", ".", "Since", "2", ".", "90", "-", "2", "Fixes", "to", "soundcard", ".", "h", "Non", "blocking", "mode", "to", "/", "dev", "/", "sequencer", "Experimental", "detection", "code", "for", "Ensoniq", "Soundscape", ".", "Since", "2", ".", "90", "Minor", "and", "major", "bug", "fixes", "Since", "pre", "-", "3", ".", "0", "-", "940712", "GUS", "MAX", "support", "Partially", "working", "MSS", "/", "WSS", "support", "(", "could", "work", "with", "some", "cards", ")", ".", "Hardware", "u", "-", "Law", "and", "A", "-", "Law", "support", "with", "AD1848", "/", "CS4248", "and", "CS4231", "codecs", "(", "GUS", "MAX", ",", "GUS16", ",", "WSS", "etc", ")", ".", "Hardware", "ADPCM", "is", "possible", "with", "GUS16", "and", "GUS", "MAX", ",", "but", "it", "doesn", "'", "t", "work", "yet", ".", "Since", "pre", "-", "3", ".", "0", "-", "940426", "AD1848", "/", "CS4248", "/", "CS4231", "codec", "support", "(", "MSS", ",", "GUS", "MAX", ",", "Aztec", ",", "Orchid", "etc", ")", ".", "This", "codec", "chip", "is", "used", "in", "various", "sound", "cards", ".", "This", "version", "is", "developed", "for", "the", "16", "bit", "daughtercard", "of", "GUS", ".", "It", "should", "work", "with", "other", "cards", "also", "if", "the", "following", "requirements", "are", "met", ":", "-", "The", "I", "/", "O", ",", "IRQ", "and", "DMA", "settings", "are", "jumper", "selectable", "or", "the", "card", "is", "initialized", "by", "booting", "DOS", "before", "booting", "Linux", "(", "etc", ".", ").", "-", "You", "add", "the", "IO", ",", "IRQ", "and", "DMA", "settings", "manually", "to", "the", "local", ".", "h", ".", "(", "Just", "define", "GUS16_BASE", ",", "GUS16_IRQ", "and", "GUS16_DMA", ")", ".", "Note", "that", "the", "base", "address", "bust", "be", "the", "base", "address", "of", "the", "codec", "chip", "not", "the", "card", "itself", ".", "For", "the", "GUS16", "these", "are", "the", "same", "but", "most", "MSS", "compatible", "cards", "have", "the", "codec", "located", "at", "card_base", "+", "4", ".", "Some", "minor", "changes", "Since", "2", ".", "5", "(", "**", "**", "**", "*", "MAJOR", "REWRITE", "*", "**", "**", "**", "**", "**", ")", "This", "version", "is", "based", "on", "v2", ".", "3", ".", "I", "have", "tried", "to", "maintain", "two", "versions", "together", "so", "that", "this", "one", "should", "have", "the", "same", "features", "than", "v2", ".", "5", ".", "Something", "may", "still", "be", "missing", ".", "If", "you", "notice", "such", "things", ",", "please", "let", "me", "know", ".", "The", "Readme", ".", "v30", "contains", "more", "details", ".", "/", "dev", "/", "midi", "#", "#", "devices", ".", "/", "dev", "/", "sequencer2", "Since", "2", ".", "5", "-", "beta2", "Some", "fine", "tuning", "to", "the", "GUS", "v3", ".", "7", "mixer", "code", ".", "Fixed", "speed", "limits", "for", "the", "plain", "SB", "(", "1", ".", "0", "to", "2", ".", "0", ")", ".", "Since", "2", ".", "5", "-", "beta", "Fixed", "OPL", "-", "3", "detection", "with", "SB", ".", "Caused", "problems", "with", "PAS16", ".", "GUS", "v3", ".", "7", "mixer", "support", ".", "Since", "2", ".", "4", "Mixer", "support", "for", "Sound", "Galaxy", "NX", "Pro", "(", "define", "__SGNXPRO__", "on", "your", "local", ".", "h", ")", ".", "Fixed", "truncated", "sound", "on", "/", "dev", "/", "dsp", "when", "the", "device", "is", "closed", ".", "Linear", "volume", "mode", "for", "GUS", "Pitch", "bends", "larger", "than", "+", "/-", "2", "octaves", ".", "MIDI", "recording", "for", "SB", "and", "SB", "Pro", ".", "(", "Untested", ")", ".", "Some", "other", "fixes", ".", "SB16", "MIDI", "and", "DSP", "drivers", "only", "initialized", "if", "SB16", "actually", "installed", ".", "Implemented", "better", "detection", "for", "OPL", "-", "3", ".", "This", "should", "be", "useful", "if", "you", "have", "an", "old", "SB", "Pro", "(", "the", "non", "-", "OPL", "-", "3", "one", ")", "or", "a", "SB", "2", ".", "0", "clone", "which", "has", "a", "OPL", "-", "3", ".", "SVR4", ".", "2", "support", "by", "Ian", "Hartas", ".", "Initial", "ALPHA", "TEST", "version", "(", "untested", ")", ".", "Since", "2", ".", "3b", "Fixed", "bug", "which", "made", "it", "impossible", "to", "make", "long", "recordings", "to", "disk", ".", "Recording", "was", "not", "restarted", "after", "a", "buffer", "overflow", "situation", ".", "Limited", "mixer", "support", "for", "GUS", ".", "Numerous", "improvements", "to", "the", "GUS", "driver", "by", "Andrew", "Robinson", ".", "Including", "some", "click", "removal", "etc", ".", "Since", "2", ".", "3", "Fixed", "some", "minor", "bugs", "in", "the", "SB16", "driver", ".", "Since", "2", ".", "2b", "Full", "SB16", "DSP", "support", ".", "8", "/", "16", "bit", ",", "mono", "/", "stereo", "The", "SCO", "and", "FreeBSD", "versions", "should", "be", "in", "sync", "now", ".", "There", "are", "some", "problems", "with", "SB16", "and", "GUS", "in", "the", "FreeBSD", "versions", ".", "The", "DMA", "buffer", "allocation", "of", "the", "SCO", "version", "has", "been", "polished", "but", "there", "could", "still", "be", "some", "problems", ".", "At", "least", "it", "hogs", "memory", ".", "The", "DMA", "channel", "configuration", "method", "used", "in", "the", "SCO", "/", "System", "is", "a", "hack", ".", "Support", "for", "the", "MPU", "emulation", "of", "the", "SB16", ".", "Some", "big", "arrays", "are", "now", "allocated", "boot", "time", ".", "This", "makes", "the", "BSS", "segment", "smaller", "which", "makes", "it", "possible", "to", "use", "the", "full", "driver", "with", "NetBSD", ".", "These", "arrays", "are", "not", "allocated", "if", "no", "suitable", "sound", "card", "is", "available", ".", "Fixed", "a", "bug", "in", "the", "compute_and_set_volume", "in", "gus_wave", ".", "c", "Fixed", "the", "too", "fast", "mono", "playback", "problem", "of", "SB", "Pro", "and", "PAS16", ".", "Since", "2", ".", "2", "Stereo", "recording", "for", "SB", "Pro", ".", "Somehow", "it", "was", "missing", "and", "nobody", "had", "noticed", "it", "earlier", ".", "Minor", "polishing", ".", "Interpreting", "of", "boot", "time", "arguments", "(", "sound", "=", ")", "for", "Linux", ".", "Breakup", "of", "sb_dsp", ".", "c", ".", "Parts", "of", "the", "code", "has", "been", "moved", "to", "sb_mixer", ".", "c", "and", "sb_midi", ".", "c", "Since", "2", ".", "1", "Preliminary", "support", "for", "SB16", ".", "-", "The", "SB16", "mixer", "is", "supported", "in", "its", "native", "mode", ".", "-", "Digitized", "voice", "capability", "up", "to", "44", ".", "1", "kHz", "/", "8", "bit", "/", "mono", "(", "16", "bit", "and", "stereo", "support", "coming", "in", "the", "next", "release", ")", ".", "Fixed", "some", "bugs", "in", "the", "digitized", "voice", "driver", "for", "PAS16", ".", "Proper", "initialization", "of", "the", "SB", "emulation", "of", "latest", "PAS16", "models", ".", "Significantly", "improved", "/", "dev", "/", "dsp", "and", "/", "dev", "/", "audio", "support", ".", "-", "Now", "supports", "half", "duplex", "mode", ".", "It", "'", "s", "now", "possible", "to", "record", "and", "playback", "without", "closing", "and", "reopening", "the", "device", ".", "-", "It", "'", "s", "possible", "to", "use", "smaller", "buffers", "than", "earlier", ".", "There", "is", "a", "new", "ioctl", "(", "fd", ",", "SNDCTL_DSP_SUBDIVIDE", ",", "&", "n", ")", "where", "n", "should", "be", "1", ",", "2", "or", "4", ".", "This", "call", "instructs", "the", "driver", "to", "use", "smaller", "buffers", ".", "The", "default", "buffer", "size", "(", "0", ".", "5", "to", "1", ".", "0", "seconds", ")", "is", "divided", "by", "n", ".", "Should", "be", "called", "immediately", "after", "opening", "the", "device", ".", "Since", "2", ".", "0", "Just", "cosmetic", "changes", ".", "@", "@", "-", "1", ",", "533", "+", "0", ",", "0", "@", "@", "#", "18", "Apr", "1998", ",", "Michael", "Elizabeth", "Chastain", ",", "<", "mailto", ":", "mec", "@", "shout", ".", "net", ">", "#", "More", "hacking", "for", "modularisation", ".", "#", "#", "Prompt", "user", "for", "primary", "drivers", ".", "config", "SOUND_BCM_CS4297A", "tristate", "\"", "Crystal", "Sound", "CS4297a", "(", "for", "Swarm", ")", "\"", "depends", "on", "SIBYTE_SWARM", "help", "The", "BCM91250A", "has", "a", "Crystal", "CS4297a", "on", "synchronous", "serial", "port", "B", "(", "in", "addition", "to", "the", "DB", "-", "9", "serial", "port", ")", ".", "Say", "Y", "or", "M", "here", "to", "enable", "the", "sound", "chip", "instead", "of", "the", "UART", ".", "Also", "note", "that", "CONFIG_KGDB", "should", "not", "be", "enabled", "at", "the", "same", "time", ",", "since", "it", "also", "attempts", "to", "use", "this", "UART", "port", ".", "config", "SOUND_MSNDCLAS", "tristate", "\"", "Support", "for", "Turtle", "Beach", "MultiSound", "Classic", ",", "Tahiti", ",", "Monterey", "\"", "depends", "on", "(", "m", "|", "|", "!", "STANDALONE", ")", "&", "&", "ISA", "help", "Say", "M", "here", "if", "you", "have", "a", "Turtle", "Beach", "MultiSound", "Classic", ",", "Tahiti", "or", "Monterey", "(", "not", "for", "the", "Pinnacle", "or", "Fiji", ")", ".", "See", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "MultiSound", ">", "for", "important", "information", "about", "this", "driver", ".", "Note", "that", "it", "has", "been", "discontinued", ",", "but", "the", "Voyetra", "Turtle", "Beach", "knowledge", "base", "entry", "for", "it", "is", "still", "available", "at", "<", "http", ":", "//", "www", ".", "turtlebeach", ".", "com", "/", "site", "/", "kb_ftp", "/", "790", ".", "asp", ">", ".", "comment", "\"", "Compiled", "-", "in", "MSND", "Classic", "support", "requires", "firmware", "during", "compilation", ".", "\"", "depends", "on", "SOUND_PRIME", "&", "&", "SOUND_MSNDCLAS", "=", "y", "config", "MSNDCLAS_HAVE_BOOT", "bool", "depends", "on", "SOUND_MSNDCLAS", "=", "y", "&", "&", "!", "STANDALONE", "default", "y", "config", "MSNDCLAS_INIT_FILE", "string", "\"", "Full", "pathname", "of", "MSNDINIT", ".", "BIN", "firmware", "file", "\"", "depends", "on", "SOUND_MSNDCLAS", "default", "\"", "/", "etc", "/", "sound", "/", "msndinit", ".", "bin", "\"", "help", "The", "MultiSound", "cards", "have", "two", "firmware", "files", "which", "are", "required", "for", "operation", ",", "and", "are", "not", "currently", "included", ".", "These", "files", "can", "be", "obtained", "from", "Turtle", "Beach", ".", "See", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "MultiSound", ">", "for", "information", "on", "how", "to", "obtain", "this", ".", "config", "MSNDCLAS_PERM_FILE", "string", "\"", "Full", "pathname", "of", "MSNDPERM", ".", "BIN", "firmware", "file", "\"", "depends", "on", "SOUND_MSNDCLAS", "default", "\"", "/", "etc", "/", "sound", "/", "msndperm", ".", "bin", "\"", "help", "The", "MultiSound", "cards", "have", "two", "firmware", "files", "which", "are", "required", "for", "operation", ",", "and", "are", "not", "currently", "included", ".", "These", "files", "can", "be", "obtained", "from", "Turtle", "Beach", ".", "See", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "MultiSound", ">", "for", "information", "on", "how", "to", "obtain", "this", ".", "config", "MSNDCLAS_IRQ", "int", "\"", "MSND", "Classic", "IRQ", "5", ",", "7", ",", "9", ",", "10", ",", "11", ",", "12", "\"", "depends", "on", "SOUND_MSNDCLAS", "=", "y", "default", "\"", "5", "\"", "help", "Interrupt", "Request", "line", "for", "the", "MultiSound", "Classic", "and", "related", "cards", ".", "config", "MSNDCLAS_MEM", "hex", "\"", "MSND", "Classic", "memory", "B0000", ",", "C8000", ",", "D0000", ",", "D8000", ",", "E0000", ",", "E8000", "\"", "depends", "on", "SOUND_MSNDCLAS", "=", "y", "default", "\"", "D0000", "\"", "help", "Memory", "-", "mapped", "I", "/", "O", "base", "address", "for", "the", "MultiSound", "Classic", "and", "related", "cards", ".", "config", "MSNDCLAS_IO", "hex", "\"", "MSND", "Classic", "I", "/", "O", "210", ",", "220", ",", "230", ",", "240", ",", "250", ",", "260", ",", "290", ",", "3E0", "\"", "depends", "on", "SOUND_MSNDCLAS", "=", "y", "default", "\"", "290", "\"", "help", "I", "/", "O", "port", "address", "for", "the", "MultiSound", "Classic", "and", "related", "cards", ".", "config", "SOUND_MSNDPIN", "tristate", "\"", "Support", "for", "Turtle", "Beach", "MultiSound", "Pinnacle", ",", "Fiji", "\"", "depends", "on", "(", "m", "|", "|", "!", "STANDALONE", ")", "&", "&", "ISA", "help", "Say", "M", "here", "if", "you", "have", "a", "Turtle", "Beach", "MultiSound", "Pinnacle", "or", "Fiji", ".", "See", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "MultiSound", ">", "for", "important", "information", "about", "this", "driver", ".", "Note", "that", "it", "has", "been", "discontinued", ",", "but", "the", "Voyetra", "Turtle", "Beach", "knowledge", "base", "entry", "for", "it", "is", "still", "available", "at", "<", "http", ":", "//", "www", ".", "turtlebeach", ".", "com", "/", "site", "/", "kb_ftp", "/", "600", ".", "asp", ">", ".", "comment", "\"", "Compiled", "-", "in", "MSND", "Pinnacle", "support", "requires", "firmware", "during", "compilation", ".", "\"", "depends", "on", "SOUND_PRIME", "&", "&", "SOUND_MSNDPIN", "=", "y", "config", "MSNDPIN_HAVE_BOOT", "bool", "depends", "on", "SOUND_MSNDPIN", "=", "y", "default", "y", "config", "MSNDPIN_INIT_FILE", "string", "\"", "Full", "pathname", "of", "PNDSPINI", ".", "BIN", "firmware", "file", "\"", "depends", "on", "SOUND_MSNDPIN", "default", "\"", "/", "etc", "/", "sound", "/", "pndspini", ".", "bin", "\"", "help", "The", "MultiSound", "cards", "have", "two", "firmware", "files", "which", "are", "required", "for", "operation", ",", "and", "are", "not", "currently", "included", ".", "These", "files", "can", "be", "obtained", "from", "Turtle", "Beach", ".", "See", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "MultiSound", ">", "for", "information", "on", "how", "to", "obtain", "this", ".", "config", "MSNDPIN_PERM_FILE", "string", "\"", "Full", "pathname", "of", "PNDSPERM", ".", "BIN", "firmware", "file", "\"", "depends", "on", "SOUND_MSNDPIN", "default", "\"", "/", "etc", "/", "sound", "/", "pndsperm", ".", "bin", "\"", "help", "The", "MultiSound", "cards", "have", "two", "firmware", "files", "which", "are", "required", "for", "operation", ",", "and", "are", "not", "currently", "included", ".", "These", "files", "can", "be", "obtained", "from", "Turtle", "Beach", ".", "See", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "MultiSound", ">", "for", "information", "on", "how", "to", "obtain", "this", ".", "config", "MSNDPIN_IRQ", "int", "\"", "MSND", "Pinnacle", "IRQ", "5", ",", "7", ",", "9", ",", "10", ",", "11", ",", "12", "\"", "depends", "on", "SOUND_MSNDPIN", "=", "y", "default", "\"", "5", "\"", "help", "Interrupt", "request", "line", "for", "the", "primary", "synthesizer", "on", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSNDPIN_MEM", "hex", "\"", "MSND", "Pinnacle", "memory", "B0000", ",", "C8000", ",", "D0000", ",", "D8000", ",", "E0000", ",", "E8000", "\"", "depends", "on", "SOUND_MSNDPIN", "=", "y", "default", "\"", "D0000", "\"", "help", "Memory", "-", "mapped", "I", "/", "O", "base", "address", "for", "the", "primary", "synthesizer", "on", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSNDPIN_IO", "hex", "\"", "MSND", "Pinnacle", "I", "/", "O", "210", ",", "220", ",", "230", ",", "240", ",", "250", ",", "260", ",", "290", ",", "3E0", "\"", "depends", "on", "SOUND_MSNDPIN", "=", "y", "default", "\"", "290", "\"", "help", "Memory", "-", "mapped", "I", "/", "O", "base", "address", "for", "the", "primary", "synthesizer", "on", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSNDPIN_DIGITAL", "bool", "\"", "MSND", "Pinnacle", "has", "S", "/", "PDIF", "I", "/", "O", "\"", "depends", "on", "SOUND_MSNDPIN", "=", "y", "help", "If", "you", "have", "the", "S", "/", "PDIF", "daughter", "board", "for", "the", "Pinnacle", "or", "Fiji", ",", "answer", "Y", "here", ";", "otherwise", ",", "say", "N", ".", "If", "you", "have", "this", ",", "you", "will", "be", "able", "to", "play", "and", "record", "from", "the", "S", "/", "PDIF", "port", "(", "digital", "signal", ")", ".", "See", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "MultiSound", ">", "for", "information", "on", "how", "to", "make", "use", "of", "this", "capability", ".", "config", "MSNDPIN_NONPNP", "bool", "\"", "MSND", "Pinnacle", "non", "-", "PnP", "Mode", "\"", "depends", "on", "SOUND_MSNDPIN", "=", "y", "help", "The", "Pinnacle", "and", "Fiji", "card", "resources", "can", "be", "configured", "either", "with", "PnP", ",", "or", "through", "a", "configuration", "port", ".", "Say", "Y", "here", "if", "your", "card", "is", "NOT", "in", "PnP", "mode", ".", "For", "the", "Pinnacle", ",", "configuration", "in", "non", "-", "PnP", "mode", "allows", "use", "of", "the", "IDE", "and", "joystick", "peripherals", "on", "the", "card", "as", "well", ";", "these", "do", "not", "show", "up", "when", "the", "card", "is", "in", "PnP", "mode", ".", "Specifying", "zero", "for", "any", "resource", "of", "a", "device", "will", "disable", "the", "device", ".", "If", "you", "are", "running", "the", "card", "in", "PnP", "mode", ",", "you", "must", "say", "N", "here", "and", "use", "isapnptools", "to", "configure", "the", "card", "'", "s", "resources", ".", "comment", "\"", "MSND", "Pinnacle", "DSP", "section", "will", "be", "configured", "to", "above", "parameters", ".", "\"", "depends", "on", "SOUND_MSNDPIN", "=", "y", "&", "&", "MSNDPIN_NONPNP", "config", "MSNDPIN_CFG", "hex", "\"", "MSND", "Pinnacle", "config", "port", "250", ",", "260", ",", "270", "\"", "depends", "on", "MSNDPIN_NONPNP", "default", "\"", "250", "\"", "help", "This", "is", "the", "port", "which", "the", "Pinnacle", "and", "Fiji", "uses", "to", "configure", "the", "card", "'", "s", "resources", "when", "not", "in", "PnP", "mode", ".", "If", "your", "card", "is", "in", "PnP", "mode", ",", "then", "be", "sure", "to", "say", "N", "to", "the", "previous", "option", ",", "\"", "MSND", "Pinnacle", "Non", "-", "PnP", "Mode", "\"", ".", "comment", "\"", "Pinnacle", "-", "specific", "Device", "Configuration", "(", "0", "disables", ")", "\"", "depends", "on", "SOUND_MSNDPIN", "=", "y", "&", "&", "MSNDPIN_NONPNP", "config", "MSNDPIN_MPU_IO", "hex", "\"", "MSND", "Pinnacle", "MPU", "I", "/", "O", "(", "e", ".", "g", ".", "330", ")", "\"", "depends", "on", "MSNDPIN_NONPNP", "default", "\"", "0", "\"", "help", "Memory", "-", "mapped", "I", "/", "O", "base", "address", "for", "the", "Kurzweil", "daughterboard", "synthesizer", "on", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSNDPIN_MPU_IRQ", "int", "\"", "MSND", "Pinnacle", "MPU", "IRQ", "(", "e", ".", "g", ".", "9", ")", "\"", "depends", "on", "MSNDPIN_NONPNP", "default", "\"", "0", "\"", "help", "Interrupt", "request", "number", "for", "the", "Kurzweil", "daughterboard", "synthesizer", "on", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSNDPIN_IDE_IO0", "hex", "\"", "MSND", "Pinnacle", "IDE", "I", "/", "O", "0", "(", "e", ".", "g", ".", "170", ")", "\"", "depends", "on", "MSNDPIN_NONPNP", "default", "\"", "0", "\"", "help", "CD", "-", "ROM", "drive", "0", "memory", "-", "mapped", "I", "/", "O", "base", "address", "for", "the", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSNDPIN_IDE_IO1", "hex", "\"", "MSND", "Pinnacle", "IDE", "I", "/", "O", "1", "(", "e", ".", "g", ".", "376", ")", "\"", "depends", "on", "MSNDPIN_NONPNP", "default", "\"", "0", "\"", "help", "CD", "-", "ROM", "drive", "1", "memory", "-", "mapped", "I", "/", "O", "base", "address", "for", "the", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSNDPIN_IDE_IRQ", "int", "\"", "MSND", "Pinnacle", "IDE", "IRQ", "(", "e", ".", "g", ".", "15", ")", "\"", "depends", "on", "MSNDPIN_NONPNP", "default", "\"", "0", "\"", "help", "Interrupt", "request", "number", "for", "the", "IDE", "CD", "-", "ROM", "interface", "on", "the", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSNDPIN_JOYSTICK_IO", "hex", "\"", "MSND", "Pinnacle", "joystick", "I", "/", "O", "(", "e", ".", "g", ".", "200", ")", "\"", "depends", "on", "MSNDPIN_NONPNP", "default", "\"", "0", "\"", "help", "Memory", "-", "mapped", "I", "/", "O", "base", "address", "for", "the", "joystick", "port", "on", "MultiSound", "Pinnacle", "and", "Fiji", "sound", "cards", ".", "config", "MSND_FIFOSIZE", "int", "\"", "MSND", "buffer", "size", "(", "kB", ")", "\"", "depends", "on", "SOUND_MSNDPIN", "=", "y", "|", "|", "SOUND_MSNDCLAS", "=", "y", "default", "\"", "128", "\"", "help", "Configures", "the", "size", "of", "each", "audio", "buffer", ",", "in", "kilobytes", ",", "for", "recording", "and", "playing", "in", "the", "MultiSound", "drivers", "(", "both", "the", "Classic", "and", "Pinnacle", ")", ".", "Larger", "values", "reduce", "the", "chance", "of", "data", "overruns", "at", "the", "expense", "of", "overall", "latency", ".", "If", "unsure", ",", "use", "the", "default", ".", "menuconfig", "SOUND_OSS", "tristate", "\"", "OSS", "sound", "modules", "\"", "depends", "on", "ISA_DMA_API", "&", "&", "(", "VIRT_TO_BUS", "|", "|", "ARCH_RPC", "|", "|", "ARCH_NETWINDER", ")", "depends", "on", "!", "GENERIC_ISA_DMA_SUPPORT_BROKEN", "help", "OSS", "is", "the", "Open", "Sound", "System", "suite", "of", "sound", "card", "drivers", ".", "They", "make", "sound", "programming", "easier", "since", "they", "provide", "a", "common", "API", ".", "Say", "Y", "or", "M", "here", "(", "the", "module", "will", "be", "called", "sound", ")", "if", "you", "haven", "'", "t", "found", "a", "driver", "for", "your", "sound", "card", "above", ",", "then", "pick", "your", "driver", "from", "the", "list", "below", ".", "if", "SOUND_OSS", "config", "SOUND_TRACEINIT", "bool", "\"", "Verbose", "initialisation", "\"", "help", "Verbose", "soundcard", "initialization", "-", "-", "affects", "the", "format", "of", "autoprobe", "and", "initialization", "messages", "at", "boot", "time", ".", "config", "SOUND_DMAP", "bool", "\"", "Persistent", "DMA", "buffers", "\"", "-", "--", "help", "Linux", "can", "often", "have", "problems", "allocating", "DMA", "buffers", "for", "ISA", "sound", "cards", "on", "machines", "with", "more", "than", "16MB", "of", "RAM", ".", "This", "is", "because", "ISA", "DMA", "buffers", "must", "exist", "below", "the", "16MB", "boundary", "and", "it", "is", "quite", "possible", "that", "a", "large", "enough", "free", "block", "in", "this", "region", "cannot", "be", "found", "after", "the", "machine", "has", "been", "running", "for", "a", "while", ".", "If", "you", "say", "Y", "here", "the", "DMA", "buffers", "(", "64Kb", ")", "will", "be", "allocated", "at", "boot", "time", "and", "kept", "until", "the", "shutdown", ".", "This", "option", "is", "only", "useful", "if", "you", "said", "Y", "to", "\"", "OSS", "sound", "modules", "\"", ",", "above", ".", "If", "you", "said", "M", "to", "\"", "OSS", "sound", "modules", "\"", "then", "you", "can", "get", "the", "persistent", "DMA", "buffer", "functionality", "by", "passing", "the", "command", "-", "line", "argument", "\"", "dmabuf", "=", "1", "\"", "to", "the", "sound", "module", ".", "Say", "Y", "unless", "you", "have", "16MB", "or", "more", "RAM", "or", "a", "PCI", "sound", "card", ".", "config", "SOUND_VMIDI", "tristate", "\"", "Loopback", "MIDI", "device", "support", "\"", "help", "Support", "for", "MIDI", "loopback", "on", "port", "1", "or", "2", ".", "config", "SOUND_TRIX", "tristate", "\"", "MediaTrix", "AudioTrix", "Pro", "support", "\"", "help", "Answer", "Y", "if", "you", "have", "the", "AudioTriX", "Pro", "sound", "card", "manufactured", "by", "MediaTrix", ".", "config", "TRIX_HAVE_BOOT", "bool", "\"", "Have", "TRXPRO", ".", "HEX", "firmware", "file", "\"", "depends", "on", "SOUND_TRIX", "=", "y", "&", "&", "!", "STANDALONE", "help", "The", "MediaTrix", "AudioTrix", "Pro", "has", "an", "on", "-", "board", "microcontroller", "which", "needs", "to", "be", "initialized", "by", "downloading", "the", "code", "from", "the", "file", "TRXPRO", ".", "HEX", "in", "the", "DOS", "driver", "directory", ".", "If", "you", "don", "'", "t", "have", "the", "TRXPRO", ".", "HEX", "file", "handy", "you", "may", "skip", "this", "step", ".", "However", ",", "the", "SB", "and", "MPU", "-", "401", "modes", "of", "AudioTrix", "Pro", "will", "not", "work", "without", "this", "file", "!", "config", "TRIX_BOOT_FILE", "string", "\"", "Full", "pathname", "of", "TRXPRO", ".", "HEX", "firmware", "file", "\"", "depends", "on", "TRIX_HAVE_BOOT", "default", "\"", "/", "etc", "/", "sound", "/", "trxpro", ".", "hex", "\"", "help", "Enter", "the", "full", "pathname", "of", "your", "TRXPRO", ".", "HEX", "file", ",", "starting", "from", "/", ".", "config", "SOUND_MSS", "tristate", "\"", "Microsoft", "Sound", "System", "support", "\"", "-", "--", "help", "Again", "think", "carefully", "before", "answering", "Y", "to", "this", "question", ".", "It", "'", "s", "safe", "to", "answer", "Y", "if", "you", "have", "the", "original", "Windows", "Sound", "System", "card", "made", "by", "Microsoft", "or", "Aztech", "SG", "16", "Pro", "(", "or", "NX16", "Pro", ")", ".", "Also", "you", "may", "say", "Y", "in", "case", "your", "card", "is", "NOT", "among", "these", ":", "ATI", "Stereo", "F", "/", "X", ",", "AdLib", ",", "Audio", "Excell", "DSP16", ",", "Cardinal", "DSP16", ",", "Ensoniq", "SoundScape", "(", "and", "compatibles", "made", "by", "Reveal", "and", "Spea", ")", ",", "Gravis", "Ultrasound", ",", "Gravis", "Ultrasound", "ACE", ",", "Gravis", "Ultrasound", "Max", ",", "Gravis", "Ultrasound", "with", "16", "bit", "option", ",", "Logitech", "Sound", "Man", "16", ",", "Logitech", "SoundMan", "Games", ",", "Logitech", "SoundMan", "Wave", ",", "MAD16", "Pro", "(", "OPTi", "82C929", ")", ",", "Media", "Vision", "Jazz16", ",", "MediaTriX", "AudioTriX", "Pro", ",", "Microsoft", "Windows", "Sound", "System", "(", "MSS", "/", "WSS", ")", ",", "Mozart", "(", "OAK", "OTI", "-", "601", ")", ",", "Orchid", "SW32", ",", "Personal", "Sound", "System", "(", "PSS", ")", ",", "Pro", "Audio", "Spectrum", "16", ",", "Pro", "Audio", "Studio", "16", ",", "Pro", "Sonic", "16", ",", "Roland", "MPU", "-", "401", "MIDI", "interface", ",", "Sound", "Blaster", "1", ".", "0", ",", "Sound", "Blaster", "16", ",", "Sound", "Blaster", "16ASP", ",", "Sound", "Blaster", "2", ".", "0", ",", "Sound", "Blaster", "AWE32", ",", "Sound", "Blaster", "Pro", ",", "TI", "TM4000M", "notebook", ",", "ThunderBoard", ",", "Turtle", "Beach", "Tropez", ",", "Yamaha", "FM", "synthesizers", "(", "OPL2", ",", "OPL3", "and", "OPL4", ")", ",", "6850", "UART", "MIDI", "Interface", ".", "For", "cards", "having", "native", "support", "in", "VoxWare", ",", "consult", "the", "card", "specific", "instructions", "in", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "README", ".", "OSS", ">", ".", "Some", "drivers", "have", "their", "own", "MSS", "support", "and", "saying", "Y", "to", "this", "option", "will", "cause", "a", "conflict", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", ",", "you", "have", "to", "add", "\"", "ad1848", "=", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "dma2", ">", "[,", "<", "type", ">", "]\"", "to", "the", "kernel", "command", "line", ".", "config", "SOUND_MPU401", "tristate", "\"", "MPU", "-", "401", "support", "(", "NOT", "for", "SB16", ")", "\"", "-", "--", "help", "Be", "careful", "with", "this", "question", ".", "The", "MPU401", "interface", "is", "supported", "by", "all", "sound", "cards", ".", "However", ",", "some", "natively", "supported", "cards", "have", "their", "own", "driver", "for", "MPU401", ".", "Enabling", "this", "MPU401", "option", "with", "these", "cards", "will", "cause", "a", "conflict", ".", "Also", ",", "enabling", "MPU401", "on", "a", "system", "that", "doesn", "'", "t", "really", "have", "a", "MPU401", "could", "cause", "some", "trouble", ".", "If", "your", "card", "was", "in", "the", "list", "of", "supported", "cards", ",", "look", "at", "the", "card", "specific", "instructions", "in", "the", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "README", ".", "OSS", ">", "file", ".", "It", "is", "safe", "to", "answer", "Y", "if", "you", "have", "a", "true", "MPU401", "MIDI", "interface", "card", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", ",", "you", "have", "to", "add", "\"", "mpu401", "=", "<", "io", ">", ",<", "irq", ">", "\"", "to", "the", "kernel", "command", "line", ".", "config", "SOUND_PAS", "tristate", "\"", "ProAudioSpectrum", "16", "support", "\"", "-", "--", "help", "Answer", "Y", "only", "if", "you", "have", "a", "Pro", "Audio", "Spectrum", "16", ",", "ProAudio", "Studio", "16", "or", "Logitech", "SoundMan", "16", "sound", "card", ".", "Answer", "N", "if", "you", "have", "some", "other", "card", "made", "by", "Media", "Vision", "or", "Logitech", "since", "those", "are", "not", "PAS16", "compatible", ".", "Please", "read", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "PAS16", ">", ".", "It", "is", "not", "necessary", "to", "add", "Sound", "Blaster", "support", "separately", ";", "it", "is", "included", "in", "PAS", "support", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", ",", "you", "have", "to", "add", "\"", "pas2", "=", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "dma2", ">", ",<", "sbio", ">", ",<", "sbirq", ">", ",<", "sbdma", ">", ",<", "sbdma2", ">", "to", "the", "kernel", "command", "line", ".", "config", "PAS_JOYSTICK", "bool", "\"", "Enable", "PAS16", "joystick", "port", "\"", "depends", "on", "SOUND_PAS", "=", "y", "help", "Say", "Y", "here", "to", "enable", "the", "Pro", "Audio", "Spectrum", "16", "'", "s", "auxiliary", "joystick", "port", ".", "config", "SOUND_PSS", "tristate", "\"", "PSS", "(", "AD1848", ",", "ADSP", "-", "2115", ",", "ESC614", ")", "support", "\"", "help", "Answer", "Y", "or", "M", "if", "you", "have", "an", "Orchid", "SW32", ",", "Cardinal", "DSP16", ",", "Beethoven", "ADSP", "-", "16", "or", "some", "other", "card", "based", "on", "the", "PSS", "chipset", "(", "AD1848", "codec", "+", "ADSP", "-", "2115", "DSP", "chip", "+", "Echo", "ESC614", "ASIC", "CHIP", ")", ".", "For", "more", "information", "on", "how", "to", "compile", "it", "into", "the", "kernel", "or", "as", "a", "module", "see", "the", "file", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "PSS", ">", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", ",", "you", "have", "to", "add", "\"", "pss", "=", "<", "io", ">", ",<", "mssio", ">", ",<", "mssirq", ">", ",<", "mssdma", ">", ",<", "mpuio", ">", ",<", "mpuirq", ">", "\"", "to", "the", "kernel", "command", "line", ".", "config", "PSS_MIXER", "bool", "\"", "Enable", "PSS", "mixer", "(", "Beethoven", "ADSP", "-", "16", "and", "other", "compatible", ")", "\"", "depends", "on", "SOUND_PSS", "help", "Answer", "Y", "for", "Beethoven", "ADSP", "-", "16", ".", "You", "may", "try", "to", "say", "Y", "also", "for", "other", "cards", "if", "they", "have", "master", "volume", ",", "bass", ",", "treble", ",", "and", "you", "can", "'", "t", "control", "it", "under", "Linux", ".", "If", "you", "answer", "N", "for", "Beethoven", "ADSP", "-", "16", ",", "you", "can", "'", "t", "control", "master", "volume", ",", "bass", ",", "treble", "and", "synth", "volume", ".", "If", "you", "said", "M", "to", "\"", "PSS", "support", "\"", "above", ",", "you", "may", "enable", "or", "disable", "this", "PSS", "mixer", "with", "the", "module", "parameter", "pss_mixer", ".", "For", "more", "information", "see", "the", "file", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "PSS", ">", ".", "config", "PSS_HAVE_BOOT", "bool", "\"", "Have", "DSPxxx", ".", "LD", "firmware", "file", "\"", "depends", "on", "SOUND_PSS", "&", "&", "!", "STANDALONE", "help", "If", "you", "have", "the", "DSPxxx", ".", "LD", "file", "or", "SYNTH", ".", "LD", "file", "for", "you", "card", ",", "say", "Y", "to", "include", "this", "file", ".", "Without", "this", "file", "the", "synth", "device", "(", "OPL", ")", "may", "not", "work", ".", "config", "PSS_BOOT_FILE", "string", "\"", "Full", "pathname", "of", "DSPxxx", ".", "LD", "firmware", "file", "\"", "depends", "on", "PSS_HAVE_BOOT", "default", "\"", "/", "etc", "/", "sound", "/", "dsp001", ".", "ld", "\"", "help", "Enter", "the", "full", "pathname", "of", "your", "DSPxxx", ".", "LD", "file", "or", "SYNTH", ".", "LD", "file", ",", "starting", "from", "/", ".", "config", "SOUND_SB", "tristate", "\"", "100", "%", "Sound", "Blaster", "compatibles", "(", "SB16", "/", "32", "/", "64", ",", "ESS", ",", "Jazz16", ")", "support", "\"", "-", "--", "help", "Answer", "Y", "if", "you", "have", "an", "original", "Sound", "Blaster", "card", "made", "by", "Creative", "Labs", "or", "a", "100", "%", "hardware", "compatible", "clone", "(", "like", "the", "Thunderboard", "or", "SM", "Games", ")", ".", "For", "an", "unknown", "card", "you", "may", "answer", "Y", "if", "the", "card", "claims", "to", "be", "Sound", "Blaster", "-", "compatible", ".", "Please", "read", "the", "file", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "Soundblaster", ">", ".", "You", "should", "also", "say", "Y", "here", "for", "cards", "based", "on", "the", "Avance", "Logic", "ALS", "-", "007", "and", "ALS", "-", "1X0", "chips", "(", "read", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "ALS", ">", ")", "and", "for", "cards", "based", "on", "ESS", "chips", "(", "read", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "ESS1868", ">", "and", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "ESS", ">", ").", "If", "you", "have", "an", "IBM", "Mwave", "card", ",", "say", "Y", "here", "and", "read", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "mwave", ">", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", "and", "don", "'", "t", "want", "to", "use", "isapnp", ",", "you", "have", "to", "add", "\"", "sb", "=", "<", "io", ">", ",<", "irq", ">", ",<", "dma", ">", ",<", "dma2", ">", "\"", "to", "the", "kernel", "command", "line", ".", "You", "can", "say", "M", "here", "to", "compile", "this", "driver", "as", "a", "module", ";", "the", "module", "is", "called", "sb", ".", "config", "SOUND_YM3812", "tristate", "\"", "Yamaha", "FM", "synthesizer", "(", "YM3812", "/", "OPL", "-", "3", ")", "support", "\"", "-", "--", "help", "Answer", "Y", "if", "your", "card", "has", "a", "FM", "chip", "made", "by", "Yamaha", "(", "OPL2", "/", "OPL3", "/", "OPL4", ")", ".", "Answering", "Y", "is", "usually", "a", "safe", "and", "recommended", "choice", ",", "however", "some", "cards", "may", "have", "software", "(", "TSR", ")", "FM", "emulation", ".", "Enabling", "FM", "support", "with", "these", "cards", "may", "cause", "trouble", "(", "I", "don", "'", "t", "currently", "know", "of", "any", "such", "cards", ",", "however", ")", ".", "Please", "read", "the", "file", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "OPL3", ">", "if", "your", "card", "has", "an", "OPL3", "chip", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", ",", "you", "have", "to", "add", "\"", "opl3", "=", "<", "io", ">", "\"", "to", "the", "kernel", "command", "line", ".", "If", "unsure", ",", "say", "Y", ".", "config", "SOUND_UART6850", "tristate", "\"", "6850", "UART", "support", "\"", "help", "This", "option", "enables", "support", "for", "MIDI", "interfaces", "based", "on", "the", "6850", "UART", "chip", ".", "This", "interface", "is", "rarely", "found", "on", "sound", "cards", ".", "It", "'", "s", "safe", "to", "answer", "N", "to", "this", "question", ".", "If", "you", "compile", "the", "driver", "into", "the", "kernel", ",", "you", "have", "to", "add", "\"", "uart6850", "=", "<", "io", ">", ",<", "irq", ">", "\"", "to", "the", "kernel", "command", "line", ".", "config", "SOUND_AEDSP16", "tristate", "\"", "Gallant", "Audio", "Cards", "(", "SC", "-", "6000", "and", "SC", "-", "6600", "based", ")", "\"", "-", "--", "help", "Answer", "Y", "if", "you", "have", "a", "Gallant", "'", "s", "Audio", "Excel", "DSP", "16", "card", ".", "This", "driver", "supports", "Audio", "Excel", "DSP", "16", "but", "not", "the", "III", "nor", "PnP", "versions", "of", "this", "card", ".", "The", "Gallant", "'", "s", "Audio", "Excel", "DSP", "16", "card", "can", "emulate", "either", "an", "SBPro", "or", "a", "Microsoft", "Sound", "System", "card", ",", "so", "you", "should", "have", "said", "Y", "to", "either", "\"", "100", "%", "Sound", "Blaster", "compatibles", "(", "SB16", "/", "32", "/", "64", ",", "ESS", ",", "Jazz16", ")", "support", "\"", "or", "\"", "Microsoft", "Sound", "System", "support", "\"", ",", "above", ",", "and", "you", "need", "to", "answer", "the", "\"", "MSS", "emulation", "\"", "and", "\"", "SBPro", "emulation", "\"", "questions", "below", "accordingly", ".", "You", "should", "say", "Y", "to", "one", "and", "only", "one", "of", "these", "two", "questions", ".", "Read", "the", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "README", ".", "OSS", ">", "file", "and", "the", "head", "of", "<", "file", ":", "sound", "/", "oss", "/", "aedsp16", ".", "c", ">", "as", "well", "as", "<", "file", ":", "Documentation", "/", "sound", "/", "oss", "/", "AudioExcelDSP16", ">", "to", "get", "more", "information", "about", "this", "driver", "and", "its", "configuration", ".", "config", "SC6600", "bool", "\"", "SC", "-", "6600", "based", "audio", "cards", "(", "new", "Audio", "Excel", "DSP", "16", ")", "\"", "depends", "on", "SOUND_AEDSP16", "help", "The", "SC6600", "is", "the", "new", "version", "of", "DSP", "mounted", "on", "the", "Audio", "Excel", "DSP", "16", "cards", ".", "Find", "in", "the", "manual", "the", "FCC", "ID", "of", "your", "audio", "card", "and", "answer", "Y", "if", "you", "have", "an", "SC6600", "DSP", ".", "config", "SC6600_JOY", "bool", "\"", "Activate", "SC", "-", "6600", "Joystick", "Interface", "\"", "depends", "on", "SC6600", "help", "Say", "Y", "here", "in", "order", "to", "use", "the", "joystick", "interface", "of", "the", "Audio", "Excel", "DSP", "16", "card", ".", "config", "SC6600_CDROM", "int", "\"", "SC", "-", "6600", "CDROM", "Interface", "(", "4", "=", "None", ",", "3", "=", "IDE", ",", "1", "=", "Panasonic", ",", "0", "=", "?", "Sony", "?", ")\"", "depends", "on", "SC6600", "default", "\"", "4", "\"", "help", "This", "is", "used", "to", "activate", "the", "CD", "-", "ROM", "interface", "of", "the", "Audio", "Excel", "DSP", "16", "card", ".", "Enter", ":", "0", "for", "Sony", ",", "1", "for", "Panasonic", ",", "2", "for", "IDE", ",", "4", "for", "no", "CD", "-", "ROM", "present", ".", "config", "SC6600_CDROMBASE", "hex", "\"", "SC", "-", "6600", "CDROM", "Interface", "I", "/", "O", "Address", "\"", "depends", "on", "SC6600", "default", "\"", "0", "\"", "help", "Base", "I", "/", "O", "port", "address", "for", "the", "CD", "-", "ROM", "interface", "of", "the", "Audio", "Excel", "DSP", "16", "card", ".", "config", "SOUND_VIDC", "tristate", "\"", "VIDC", "16", "-", "bit", "sound", "\"", "depends", "on", "ARM", "&", "&", "ARCH_ACORN", "help", "16", "-", "bit", "support", "for", "the", "VIDC", "onboard", "sound", "hardware", "found", "on", "Acorn", "machines", ".", "config", "SOUND_WAVEARTIST", "tristate", "\"", "Netwinder", "WaveArtist", "\"", "depends", "on", "ARM", "&", "&", "ARCH_NETWINDER", "help", "Say", "Y", "here", "to", "include", "support", "for", "the", "Rockwell", "WaveArtist", "sound", "system", ".", "This", "driver", "is", "mainly", "for", "the", "NetWinder", ".", "config", "SOUND_KAHLUA", "tristate", "\"", "XpressAudio", "Sound", "Blaster", "emulation", "\"", "depends", "on", "SOUND_SB", "endif", "#", "SOUND_OSS", "@", "@", "-", "1", ",", "107", "+", "0", ",", "0", "@", "@", "#", "Makefile", "for", "the", "Linux", "sound", "card", "driver", "#", "#", "18", "Apr", "1998", ",", "Michael", "Elizabeth", "Chastain", ",", "<", "mailto", ":", "mec", "@", "shout", ".", "net", ">", "#", "Rewritten", "to", "use", "lists", "instead", "of", "if", "-", "statements", ".", "#", "Each", "configuration", "option", "enables", "a", "list", "of", "files", ".", "obj", "-", "$(", "CONFIG_SOUND_OSS", ")", "+", "=", "sound", ".", "o", "#", "Please", "leave", "it", "as", "is", ",", "cause", "the", "link", "order", "is", "significant", "!", "obj", "-", "$(", "CONFIG_SOUND_AEDSP16", ")", "+", "=", "aedsp16", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_PSS", ")", "+", "=", "pss", ".", "o", "ad1848", ".", "o", "mpu401", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_TRIX", ")", "+", "=", "trix", ".", "o", "ad1848", ".", "o", "sb_lib", ".", "o", "uart401", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_MSS", ")", "+", "=", "ad1848", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_PAS", ")", "+", "=", "pas2", ".", "o", "sb", ".", "o", "sb_lib", ".", "o", "uart401", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_SB", ")", "+", "=", "sb", ".", "o", "sb_lib", ".", "o", "uart401", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_KAHLUA", ")", "+", "=", "kahlua", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_MPU401", ")", "+", "=", "mpu401", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_UART6850", ")", "+", "=", "uart6850", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_YM3812", ")", "+", "=", "opl3", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_VMIDI", ")", "+", "=", "v_midi", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_VIDC", ")", "+", "=", "vidc_mod", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_WAVEARTIST", ")", "+", "=", "waveartist", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_MSNDCLAS", ")", "+", "=", "msnd", ".", "o", "msnd_classic", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_MSNDPIN", ")", "+", "=", "msnd", ".", "o", "msnd_pinnacle", ".", "o", "obj", "-", "$(", "CONFIG_SOUND_BCM_CS4297A", ")", "+", "=", "swarm_cs4297a", ".", "o", "obj", "-", "$(", "CONFIG_DMASOUND", ")", "+", "=", "dmasound", "/", "#", "Declare", "multi", "-", "part", "drivers", ".", "sound", "-", "objs", ":", "=", "\\", "dev_table", ".", "o", "soundcard", ".", "o", "\\", "audio", ".", "o", "dmabuf", ".", "o", "\\", "midi_synth", ".", "o", "midibuf", ".", "o", "\\", "sequencer", ".", "o", "sound_timer", ".", "o", "sys_timer", ".", "o", "pas2", "-", "objs", ":", "=", "pas2_card", ".", "o", "pas2_midi", ".", "o", "pas2_mixer", ".", "o", "pas2_pcm", ".", "o", "sb", "-", "objs", ":", "=", "sb_card", ".", "o", "sb_lib", "-", "objs", ":", "=", "sb_common", ".", "o", "sb_audio", ".", "o", "sb_midi", ".", "o", "sb_mixer", ".", "o", "sb_ess", ".", "o", "vidc_mod", "-", "objs", ":", "=", "vidc", ".", "o", "vidc_fill", ".", "o", "hostprogs", "-", "y", ":", "=", "bin2hex", "hex2hex", "#", "Files", "generated", "that", "shall", "be", "removed", "upon", "make", "clean", "clean", "-", "files", ":", "=", "msndperm", ".", "c", "msndinit", ".", "c", "pndsperm", ".", "c", "pndspini", ".", "c", "\\", "pss_boot", ".", "h", "trix_boot", ".", "h", "#", "Firmware", "files", "that", "need", "translation", "#", "#", "The", "translated", "files", "are", "protected", "by", "a", "file", "that", "keeps", "track", "#", "of", "what", "name", "was", "used", "to", "build", "them", ".", "If", "the", "name", "changes", ",", "they", "#", "will", "be", "forced", "to", "be", "remade", ".", "#", "#", "Turtle", "Beach", "MultiSound", "ifeq", "(", "$(", "CONFIG_MSNDCLAS_HAVE_BOOT", ")", ",", "y", ")", "$", "(", "obj", ")", "/", "msnd_classic", ".", "o", ":", "$", "(", "obj", ")", "/", "msndperm", ".", "c", "$", "(", "obj", ")", "/", "msndinit", ".", "c", "$", "(", "obj", ")", "/", "msndperm", ".", "c", ":", "$", "(", "patsubst", "\"", "%\"", ",", "%", ",", "$", "(", "CONFIG_MSNDCLAS_PERM_FILE", ")", ")", "$", "(", "obj", ")", "/", "bin2hex", "$", "(", "obj", ")", "/", "bin2hex", "msndperm", "<", "$", "<", ">", "$", "@", "$", "(", "obj", ")", "/", "msndinit", ".", "c", ":", "$", "(", "patsubst", "\"", "%\"", ",", "%", ",", "$", "(", "CONFIG_MSNDCLAS_INIT_FILE", ")", ")", "$", "(", "obj", ")", "/", "bin2hex", "$", "(", "obj", ")", "/", "bin2hex", "msndinit", "<", "$", "<", ">", "$", "@", "endif", "ifeq", "(", "$(", "CONFIG_MSNDPIN_HAVE_BOOT", ")", ",", "y", ")", "$", "(", "obj", ")", "/", "msnd_pinnacle", ".", "o", ":", "$", "(", "obj", ")", "/", "pndsperm", ".", "c", "$", "(", "obj", ")", "/", "pndspini", ".", "c", "$", "(", "obj", ")", "/", "pndsperm", ".", "c", ":", "$", "(", "patsubst", "\"", "%\"", ",", "%", ",", "$", "(", "CONFIG_MSNDPIN_PERM_FILE", ")", ")", "$", "(", "obj", ")", "/", "bin2hex", "$", "(", "obj", ")", "/", "bin2hex", "pndsperm", "<", "$", "<", ">", "$", "@", "$", "(", "obj", ")", "/", "pndspini", ".", "c", ":", "$", "(", "patsubst", "\"", "%\"", ",", "%", ",", "$", "(", "CONFIG_MSNDPIN_INIT_FILE", ")", ")", "$", "(", "obj", ")", "/", "bin2hex", "$", "(", "obj", ")", "/", "bin2hex", "pndspini", "<", "$", "<", ">", "$", "@", "endif", "#", "PSS", "(", "ECHO", "-", "ADI2111", ")", "$", "(", "obj", ")", "/", "pss", ".", "o", ":", "$", "(", "obj", ")", "/", "pss_boot", ".", "h", "ifeq", "(", "$(", "CONFIG_PSS_HAVE_BOOT", ")", ",", "y", ")", "$", "(", "obj", ")", "/", "pss_boot", ".", "h", ":", "$", "(", "patsubst", "\"", "%\"", ",", "%", ",", "$", "(", "CONFIG_PSS_BOOT_FILE", ")", ")", "$", "(", "obj", ")", "/", "bin2hex", "$", "(", "obj", ")", "/", "bin2hex", "pss_synth", "<", "$", "<", ">", "$", "@", "else", "$", "(", "obj", ")", "/", "pss_boot", ".", "h", ":", "$", "(", "Q", ")", "(", "\\", "echo", "'", "static", "unsigned", "char", "*", "pss_synth", "=", "NULL", ";", "';", "\\", "echo", "'", "static", "int", "pss_synthLen", "=", "0", ";", "';", "\\", ")", ">", "$", "@", "endif", "#", "MediaTrix", "AudioTrix", "Pro", "$", "(", "obj", ")", "/", "trix", ".", "o", ":", "$", "(", "obj", ")", "/", "trix_boot", ".", "h", "ifeq", "(", "$(", "CONFIG_TRIX_HAVE_BOOT", ")", ",", "y", ")", "$", "(", "obj", ")", "/", "trix_boot", ".", "h", ":", "$", "(", "patsubst", "\"", "%\"", ",", "%", ",", "$", "(", "CONFIG_TRIX_BOOT_FILE", ")", ")", "$", "(", "obj", ")", "/", "hex2hex", "$", "(", "obj", ")", "/", "hex2hex", "-", "i", "trix_boot", "<", "$", "<", ">", "$", "@", "else", "$", "(", "obj", ")", "/", "trix_boot", ".", "h", ":", "$", "(", "Q", ")", "(", "\\", "echo", "'", "static", "unsigned", "char", "*", "trix_boot", "=", "NULL", ";", "';", "\\", "echo", "'", "static", "int", "trix_boot_len", "=", "0", ";", "';", "\\", ")", ">", "$", "@", "endif", "@", "@", "-", "1", ",", "6", "+", "0", ",", "0", "@", "@", "The", "modular", "sound", "driver", "patches", "were", "funded", "by", "Red", "Hat", "Software", "(", "www", ".", "redhat", ".", "com", ")", ".", "The", "sound", "driver", "here", "is", "thus", "a", "modified", "version", "of", "Hannu", "'", "s", "code", ".", "Please", "bear", "that", "in", "mind", "when", "considering", "the", "appropriate", "forums", "for", "bug", "reporting", ".", "Alan", "Cox", "@", "@", "-", "1", ",", "24", "+", "0", ",", "0", "@", "@", "#", "include", "<", "linux", "/", "interrupt", ".", "h", ">", "#", "define", "AD_F_CS4231", "0x0001", "/", "*", "Returned", "if", "a", "CS4232", "(", "or", "compatible", ")", "detected", "*", "/", "#", "define", "AD_F_CS4248", "0x0001", "/", "*", "Returned", "if", "a", "CS4248", "(", "or", "compatible", ")", "detected", "*", "/", "#", "define", "AD1848_SET_XTAL", "1", "#", "define", "AD1848_MIXER_REROUTE", "2", "#", "define", "AD1848_REROUTE", "(", "oldctl", ",", "newctl", ")", "\\", "ad1848_control", "(", "AD1848_MIXER_REROUTE", ",", "(", "(", "oldctl", ")", "<<", "8", ")", "|(", "newctl", ")", ")", "int", "ad1848_init", "(", "char", "*", "name", ",", "struct", "resource", "*", "ports", ",", "int", "irq", ",", "int", "dma_playback", ",", "int", "dma_capture", ",", "int", "share_dma", ",", "int", "*", "osp", ",", "struct", "module", "*", "owner", ")", ";", "void", "ad1848_unload", "(", "int", "io_base", ",", "int", "irq", ",", "int", "dma_playback", ",", "int", "dma_capture", ",", "int", "share_dma", ")", ";", "int", "ad1848_detect", "(", "struct", "resource", "*", "ports", ",", "int", "*", "flags", ",", "int", "*", "osp", ")", ";", "int", "ad1848_control", "(", "int", "cmd", ",", "int", "arg", ")", ";", "void", "attach_ms_sound", "(", "struct", "address_info", "*", "hw_config", ",", "struct", "resource", "*", "ports", ",", "struct", "module", "*", "owner", ")", ";", "int", "probe_ms_sound", "(", "struct", "address_info", "*", "hw_config", ",", "struct", "resource", "*", "ports", ")", ";", "void", "unload_ms_sound", "(", "struct", "address_info", "*", "hw_info", ")", ";", "@", "@", "-", "1", ",", "253", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "ad1848_mixer", ".", "h", "*", "*", "Definitions", "for", "the", "mixer", "of", "AD1848", "and", "compatible", "codecs", ".", "*", "/", "/", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "/", "/", "*", "*", "The", "AD1848", "codec", "has", "generic", "input", "lines", "called", "Line", ",", "Aux1", "and", "Aux2", ".", "*", "Sound", "card", "manufacturers", "have", "connected", "actual", "inputs", "(", "CD", ",", "synth", ",", "line", ",", "*", "etc", ")", "to", "these", "inputs", "in", "different", "order", ".", "Therefore", "it", "'", "s", "difficult", "*", "to", "assign", "mixer", "channels", "to", "these", "inputs", "correctly", ".", "The", "following", "*", "contains", "two", "alternative", "mappings", ".", "The", "first", "one", "is", "for", "GUS", "MAX", "and", "*", "the", "second", "is", "just", "a", "generic", "one", "(", "line1", ",", "line2", "and", "line3", ")", ".", "*", "(", "Actually", "this", "is", "not", "a", "mapping", "but", "rather", "some", "kind", "of", "interleaving", "*", "solution", ")", ".", "*", "/", "#", "define", "MODE1_REC_DEVICES", "(", "SOUND_MASK_LINE3", "|", "SOUND_MASK_MIC", "|", "\\", "SOUND_MASK_LINE1", "|", "SOUND_MASK_IMIX", ")", "#", "define", "SPRO_REC_DEVICES", "(", "SOUND_MASK_LINE", "|", "SOUND_MASK_MIC", "|", "\\", "SOUND_MASK_CD", "|", "SOUND_MASK_LINE1", ")", "#", "define", "MODE1_MIXER_DEVICES", "(", "SOUND_MASK_LINE1", "|", "SOUND_MASK_MIC", "|", "\\", "SOUND_MASK_LINE2", "|", "\\", "SOUND_MASK_IGAIN", "|", "\\", "SOUND_MASK_PCM", "|", "SOUND_MASK_IMIX", ")", "#", "define", "MODE2_MIXER_DEVICES", "(", "SOUND_MASK_LINE1", "|", "SOUND_MASK_LINE2", "|", "\\", "SOUND_MASK_MIC", "|", "\\", "SOUND_MASK_LINE3", "|", "SOUND_MASK_SPEAKER", "|", "\\", "SOUND_MASK_IGAIN", "|", "\\", "SOUND_MASK_PCM", "|", "SOUND_MASK_IMIX", ")", "#", "define", "MODE3_MIXER_DEVICES", "(", "MODE2_MIXER_DEVICES", "|", "SOUND_MASK_VOLUME", ")", "/", "*", "OPTi", "82C930", "has", "no", "IMIX", "level", "control", ",", "but", "it", "can", "still", "be", "selected", "as", "an", "*", "input", "*", "/", "#", "define", "C930_MIXER_DEVICES", "(", "SOUND_MASK_LINE1", "|", "SOUND_MASK_LINE2", "|", "\\", "SOUND_MASK_MIC", "|", "SOUND_MASK_VOLUME", "|", "\\", "SOUND_MASK_LINE3", "|", "\\", "SOUND_MASK_IGAIN", "|", "SOUND_MASK_PCM", ")", "#", "define", "SPRO_MIXER_DEVICES", "(", "SOUND_MASK_VOLUME", "|", "SOUND_MASK_PCM", "|", "\\", "SOUND_MASK_LINE", "|", "SOUND_MASK_SYNTH", "|", "\\", "SOUND_MASK_CD", "|", "SOUND_MASK_MIC", "|", "\\", "SOUND_MASK_SPEAKER", "|", "SOUND_MASK_LINE1", "|", "\\", "SOUND_MASK_OGAIN", ")", "struct", "mixer_def", "{", "unsigned", "int", "regno", ":", "6", ";", "/", "*", "register", "number", "for", "volume", "*", "/", "unsigned", "int", "polarity", ":", "1", ";", "/", "*", "volume", "polarity", ":", "0", "=", "normal", ",", "1", "=", "reversed", "*", "/", "unsigned", "int", "bitpos", ":", "3", ";", "/", "*", "position", "of", "bits", "in", "register", "for", "volume", "*", "/", "unsigned", "int", "nbits", ":", "3", ";", "/", "*", "number", "of", "bits", "in", "register", "for", "volume", "*", "/", "unsigned", "int", "mutereg", ":", "6", ";", "/", "*", "register", "number", "for", "mute", "bit", "*", "/", "unsigned", "int", "mutepol", ":", "1", ";", "/", "*", "mute", "polarity", ":", "0", "=", "normal", ",", "1", "=", "reversed", "*", "/", "unsigned", "int", "mutepos", ":", "4", ";", "/", "*", "position", "of", "mute", "bit", "in", "register", "*", "/", "unsigned", "int", "recreg", ":", "6", ";", "/", "*", "register", "number", "for", "recording", "bit", "*", "/", "unsigned", "int", "recpol", ":", "1", ";", "/", "*", "recording", "polarity", ":", "0", "=", "normal", ",", "1", "=", "reversed", "*", "/", "unsigned", "int", "recpos", ":", "4", ";", "/", "*", "position", "of", "recording", "bit", "in", "register", "*", "/", "}", ";", "static", "char", "mix_cvt", "[", "101", "]", "=", "{", "0", ",", "0", ",", "3", ",", "7", ",", "10", ",", "13", ",", "16", ",", "19", ",", "21", ",", "23", ",", "26", ",", "28", ",", "30", ",", "32", ",", "34", ",", "35", ",", "37", ",", "39", ",", "40", ",", "42", ",", "43", ",", "45", ",", "46", ",", "47", ",", "49", ",", "50", ",", "51", ",", "52", ",", "53", ",", "55", ",", "56", ",", "57", ",", "58", ",", "59", ",", "60", ",", "61", ",", "62", ",", "63", ",", "64", ",", "65", ",", "65", ",", "66", ",", "67", ",", "68", ",", "69", ",", "70", ",", "70", ",", "71", ",", "72", ",", "73", ",", "73", ",", "74", ",", "75", ",", "75", ",", "76", ",", "77", ",", "77", ",", "78", ",", "79", ",", "79", ",", "80", ",", "81", ",", "81", ",", "82", ",", "82", ",", "83", ",", "84", ",", "84", ",", "85", ",", "85", ",", "86", ",", "86", ",", "87", ",", "87", ",", "88", ",", "88", ",", "89", ",", "89", ",", "90", ",", "90", ",", "91", ",", "91", ",", "92", ",", "92", ",", "93", ",", "93", ",", "94", ",", "94", ",", "95", ",", "95", ",", "96", ",", "96", ",", "96", ",", "97", ",", "97", ",", "98", ",", "98", ",", "98", ",", "99", ",", "99", ",", "100", "}", ";", "typedef", "struct", "mixer_def", "mixer_ent", ";", "typedef", "mixer_ent", "mixer_ents", "[", "2", "]", ";", "/", "*", "*", "Most", "of", "the", "mixer", "entries", "work", "in", "backwards", ".", "Setting", "the", "polarity", "field", "*", "makes", "them", "to", "work", "correctly", ".", "*", "*", "The", "channel", "numbering", "used", "by", "individual", "sound", "cards", "is", "not", "fixed", ".", "Some", "*", "cards", "have", "assigned", "different", "meanings", "for", "the", "AUX1", ",", "AUX2", "and", "LINE", "inputs", ".", "*", "The", "current", "version", "doesn", "'", "t", "try", "to", "compensate", "this", ".", "*", "/", "#", "define", "MIX_ENT", "(", "name", ",", "reg_l", ",", "pola_l", ",", "pos_l", ",", "len_l", ",", "reg_r", ",", "pola_r", ",", "pos_r", ",", "len_r", ",", "mute_bit", ")", "\\", "[", "name", "]", "=", "{", "{", "reg_l", ",", "pola_l", ",", "pos_l", ",", "len_l", ",", "reg_l", ",", "0", ",", "mute_bit", ",", "0", ",", "0", ",", "8", "}", ",", "\\", "{", "reg_r", ",", "pola_r", ",", "pos_r", ",", "len_r", ",", "reg_r", ",", "0", ",", "mute_bit", ",", "0", ",", "0", ",", "8", "}", "}", "#", "define", "MIX_ENT2", "(", "name", ",", "reg_l", ",", "pola_l", ",", "pos_l", ",", "len_l", ",", "mute_reg_l", ",", "mute_pola_l", ",", "mute_pos_l", ",", "\\", "rec_reg_l", ",", "rec_pola_l", ",", "rec_pos_l", ",", "\\", "reg_r", ",", "pola_r", ",", "pos_r", ",", "len_r", ",", "mute_reg_r", ",", "mute_pola_r", ",", "mute_pos_r", ",", "\\", "rec_reg_r", ",", "rec_pola_r", ",", "rec_pos_r", ")", "\\", "[", "name", "]", "=", "{", "{", "reg_l", ",", "pola_l", ",", "pos_l", ",", "len_l", ",", "mute_reg_l", ",", "mute_pola_l", ",", "mute_pos_l", ",", "\\", "rec_reg_l", ",", "rec_pola_l", ",", "rec_pos_l", "}", ",", "\\", "{", "reg_r", ",", "pola_r", ",", "pos_r", ",", "len_r", ",", "mute_reg_r", ",", "mute_pola_r", ",", "mute_pos_r", ",", "\\", "rec_reg_r", ",", "rec_pola_r", ",", "rec_pos_r", "}", "}", "static", "mixer_ents", "ad1848_mix_devices", "[", "32", "]", "=", "{", "MIX_ENT", "(", "SOUND_MIXER_VOLUME", ",", "27", ",", "1", ",", "0", ",", "4", ",", "29", ",", "1", ",", "0", ",", "4", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_BASS", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_TREBLE", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SYNTH", ",", "4", ",", "1", ",", "0", ",", "5", ",", "5", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_PCM", ",", "6", ",", "1", ",", "0", ",", "6", ",", "7", ",", "1", ",", "0", ",", "6", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SPEAKER", ",", "26", ",", "1", ",", "0", ",", "4", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE", ",", "18", ",", "1", ",", "0", ",", "5", ",", "19", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_MIC", ",", "0", ",", "0", ",", "5", ",", "1", ",", "1", ",", "0", ",", "5", ",", "1", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_CD", ",", "2", ",", "1", ",", "0", ",", "5", ",", "3", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IMIX", ",", "13", ",", "1", ",", "2", ",", "6", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_ALTPCM", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_RECLEV", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IGAIN", ",", "0", ",", "0", ",", "0", ",", "4", ",", "1", ",", "0", ",", "0", ",", "4", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_OGAIN", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE1", ",", "2", ",", "1", ",", "0", ",", "5", ",", "3", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE2", ",", "4", ",", "1", ",", "0", ",", "5", ",", "5", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE3", ",", "18", ",", "1", ",", "0", ",", "5", ",", "19", ",", "1", ",", "0", ",", "5", ",", "7", ")", "}", ";", "static", "mixer_ents", "iwave_mix_devices", "[", "32", "]", "=", "{", "MIX_ENT", "(", "SOUND_MIXER_VOLUME", ",", "25", ",", "1", ",", "0", ",", "5", ",", "27", ",", "1", ",", "0", ",", "5", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_BASS", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_TREBLE", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SYNTH", ",", "4", ",", "1", ",", "0", ",", "5", ",", "5", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_PCM", ",", "6", ",", "1", ",", "0", ",", "6", ",", "7", ",", "1", ",", "0", ",", "6", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SPEAKER", ",", "26", ",", "1", ",", "0", ",", "4", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE", ",", "18", ",", "1", ",", "0", ",", "5", ",", "19", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_MIC", ",", "0", ",", "0", ",", "5", ",", "1", ",", "1", ",", "0", ",", "5", ",", "1", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_CD", ",", "2", ",", "1", ",", "0", ",", "5", ",", "3", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IMIX", ",", "16", ",", "1", ",", "0", ",", "5", ",", "17", ",", "1", ",", "0", ",", "5", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_ALTPCM", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_RECLEV", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IGAIN", ",", "0", ",", "0", ",", "0", ",", "4", ",", "1", ",", "0", ",", "0", ",", "4", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_OGAIN", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE1", ",", "2", ",", "1", ",", "0", ",", "5", ",", "3", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE2", ",", "4", ",", "1", ",", "0", ",", "5", ",", "5", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE3", ",", "18", ",", "1", ",", "0", ",", "5", ",", "19", ",", "1", ",", "0", ",", "5", ",", "7", ")", "}", ";", "static", "mixer_ents", "cs42xb_mix_devices", "[", "32", "]", "=", "{", "/", "*", "Digital", "master", "volume", "actually", "has", "seven", "bits", ",", "but", "we", "only", "use", "six", "to", "avoid", "the", "discontinuity", "when", "the", "analog", "gain", "kicks", "in", ".", "*", "/", "MIX_ENT", "(", "SOUND_MIXER_VOLUME", ",", "46", ",", "1", ",", "0", ",", "6", ",", "47", ",", "1", ",", "0", ",", "6", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_BASS", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_TREBLE", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SYNTH", ",", "4", ",", "1", ",", "0", ",", "5", ",", "5", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_PCM", ",", "6", ",", "1", ",", "0", ",", "6", ",", "7", ",", "1", ",", "0", ",", "6", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SPEAKER", ",", "26", ",", "1", ",", "0", ",", "4", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE", ",", "18", ",", "1", ",", "0", ",", "5", ",", "19", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_MIC", ",", "34", ",", "1", ",", "0", ",", "5", ",", "35", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_CD", ",", "2", ",", "1", ",", "0", ",", "5", ",", "3", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "/", "*", "For", "the", "IMIX", "entry", ",", "it", "was", "not", "possible", "to", "use", "the", "MIX_ENT", "macro", "because", "the", "mute", "bit", "is", "in", "different", "positions", "for", "the", "two", "channels", "and", "requires", "reverse", "polarity", ".", "*", "/", "[", "SOUND_MIXER_IMIX", "]", "=", "{", "{", "13", ",", "1", ",", "2", ",", "6", ",", "13", ",", "1", ",", "0", ",", "0", ",", "0", ",", "8", "}", ",", "{", "42", ",", "1", ",", "0", ",", "6", ",", "42", ",", "1", ",", "7", ",", "0", ",", "0", ",", "8", "}", "},", "MIX_ENT", "(", "SOUND_MIXER_ALTPCM", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_RECLEV", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IGAIN", ",", "0", ",", "0", ",", "0", ",", "4", ",", "1", ",", "0", ",", "0", ",", "4", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_OGAIN", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE1", ",", "2", ",", "1", ",", "0", ",", "5", ",", "3", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE2", ",", "4", ",", "1", ",", "0", ",", "5", ",", "5", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE3", ",", "38", ",", "1", ",", "0", ",", "6", ",", "39", ",", "1", ",", "0", ",", "6", ",", "7", ")", "}", ";", "/", "*", "OPTi", "82C930", "has", "somewhat", "different", "port", "addresses", ".", "*", "Note", ":", "VOLUME", "=", "=", "SPEAKER", ",", "SYNTH", "=", "=", "LINE2", ",", "LINE", "=", "=", "LINE3", ",", "CD", "=", "=", "LINE1", "*", "VOLUME", ",", "SYNTH", ",", "LINE", ",", "CD", "are", "not", "enabled", "above", ".", "*", "MIC", "is", "level", "of", "mic", "monitoring", "direct", "to", "output", ".", "Same", "for", "CD", ",", "LINE", ",", "etc", ".", "*", "/", "static", "mixer_ents", "c930_mix_devices", "[", "32", "]", "=", "{", "MIX_ENT", "(", "SOUND_MIXER_VOLUME", ",", "22", ",", "1", ",", "1", ",", "5", ",", "23", ",", "1", ",", "1", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_BASS", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_TREBLE", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SYNTH", ",", "4", ",", "1", ",", "1", ",", "4", ",", "5", ",", "1", ",", "1", ",", "4", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_PCM", ",", "6", ",", "1", ",", "0", ",", "5", ",", "7", ",", "1", ",", "0", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SPEAKER", ",", "22", ",", "1", ",", "1", ",", "5", ",", "23", ",", "1", ",", "1", ",", "5", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE", ",", "18", ",", "1", ",", "1", ",", "4", ",", "19", ",", "1", ",", "1", ",", "4", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_MIC", ",", "20", ",", "1", ",", "1", ",", "4", ",", "21", ",", "1", ",", "1", ",", "4", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_CD", ",", "2", ",", "1", ",", "1", ",", "4", ",", "3", ",", "1", ",", "1", ",", "4", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IMIX", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_ALTPCM", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_RECLEV", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IGAIN", ",", "0", ",", "0", ",", "0", ",", "4", ",", "1", ",", "0", ",", "0", ",", "4", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_OGAIN", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE1", ",", "2", ",", "1", ",", "1", ",", "4", ",", "3", ",", "1", ",", "1", ",", "4", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE2", ",", "4", ",", "1", ",", "1", ",", "4", ",", "5", ",", "1", ",", "1", ",", "4", ",", "7", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_LINE3", ",", "18", ",", "1", ",", "1", ",", "4", ",", "19", ",", "1", ",", "1", ",", "4", ",", "7", ")", "}", ";", "static", "mixer_ents", "spro_mix_devices", "[", "32", "]", "=", "{", "MIX_ENT", "(", "SOUND_MIXER_VOLUME", ",", "19", ",", "0", ",", "4", ",", "4", ",", "19", ",", "0", ",", "0", ",", "4", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_BASS", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_TREBLE", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT2", "(", "SOUND_MIXER_SYNTH", ",", "4", ",", "1", ",", "1", ",", "4", ",", "23", ",", "0", ",", "3", ",", "0", ",", "0", ",", "8", ",", "5", ",", "1", ",", "1", ",", "4", ",", "23", ",", "0", ",", "3", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_PCM", ",", "6", ",", "1", ",", "1", ",", "4", ",", "7", ",", "1", ",", "1", ",", "4", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_SPEAKER", ",", "18", ",", "0", ",", "3", ",", "2", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT2", "(", "SOUND_MIXER_LINE", ",", "20", ",", "0", ",", "4", ",", "4", ",", "17", ",", "1", ",", "4", ",", "16", ",", "0", ",", "2", ",", "20", ",", "0", ",", "0", ",", "4", ",", "17", ",", "1", ",", "3", ",", "16", ",", "0", ",", "1", ")", ",", "MIX_ENT2", "(", "SOUND_MIXER_MIC", ",", "18", ",", "0", ",", "0", ",", "3", ",", "17", ",", "1", ",", "0", ",", "16", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ")", ",", "MIX_ENT2", "(", "SOUND_MIXER_CD", ",", "21", ",", "0", ",", "4", ",", "4", ",", "17", ",", "1", ",", "2", ",", "16", ",", "0", ",", "4", ",", "21", ",", "0", ",", "0", ",", "4", ",", "17", ",", "1", ",", "1", ",", "16", ",", "0", ",", "3", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IMIX", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_ALTPCM", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_RECLEV", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_IGAIN", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "MIX_ENT", "(", "SOUND_MIXER_OGAIN", ",", "17", ",", "1", ",", "6", ",", "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "8", ")", ",", "/", "*", "This", "is", "external", "wavetable", "*", "/", "MIX_ENT2", "(", "SOUND_MIXER_LINE1", ",", "22", ",", "0", ",", "4", ",", "4", ",", "23", ",", "1", ",", "1", ",", "23", ",", "0", ",", "4", ",", "22", ",", "0", ",", "0", ",", "4", ",", "23", ",", "1", ",", "0", ",", "23", ",", "0", ",", "5", ")", ",", "}", ";", "static", "int", "default_mixer_levels", "[", "32", "]", "=", "{", "0x3232", ",", "/", "*", "Master", "Volume", "*", "/", "0x3232", ",", "/", "*", "Bass", "*", "/", "0x3232", ",", "/", "*", "Treble", "*", "/", "0x4b4b", ",", "/", "*", "FM", "*", "/", "0x3232", ",", "/", "*", "PCM", "*", "/", "0x1515", ",", "/", "*", "PC", "Speaker", "*", "/", "0x2020", ",", "/", "*", "Ext", "Line", "*", "/", "0x1010", ",", "/", "*", "Mic", "*", "/", "0x4b4b", ",", "/", "*", "CD", "*", "/", "0x0000", ",", "/", "*", "Recording", "monitor", "*", "/", "0x4b4b", ",", "/", "*", "Second", "PCM", "*", "/", "0x4b4b", ",", "/", "*", "Recording", "level", "*", "/", "0x4b4b", ",", "/", "*", "Input", "gain", "*", "/", "0x4b4b", ",", "/", "*", "Output", "gain", "*", "/", "0x2020", ",", "/", "*", "Line1", "*", "/", "0x2020", ",", "/", "*", "Line2", "*", "/", "0x1515", "/", "*", "Line3", "(", "usually", "line", "in", ")", "*/", "}", ";", "#", "define", "LEFT_CHN", "0", "#", "define", "RIGHT_CHN", "1", "/", "*", "*", "Channel", "enable", "bits", "for", "ioctl", "(", "SOUND_MIXER_PRIVATE1", ")", "*", "/", "#", "ifndef", "AUDIO_SPEAKER", "#", "define", "AUDIO_SPEAKER", "0x01", "/", "*", "Enable", "mono", "output", "*", "/", "#", "define", "AUDIO_HEADPHONE", "0x02", "/", "*", "Sparc", "only", "*", "/", "#", "define", "AUDIO_LINE_OUT", "0x04", "/", "*", "Sparc", "only", "*", "/", "#", "endif", "@", "@", "-", "1", ",", "1373", "+", "0", ",", "0", "@", "@", "/", "*", "sound", "/", "oss", "/", "aedsp16", ".", "c", "Audio", "Excel", "DSP", "16", "software", "configuration", "routines", "Copyright", "(", "C", ")", "1995", ",", "1996", ",", "1997", ",", "1998", "Riccardo", "Facchetti", "(", "fizban", "@", "tin", ".", "it", ")", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "General", "Public", "License", "for", "more", "details", ".", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "*", "/", "/", "*", "*", "Include", "the", "main", "OSS", "Lite", "header", "file", ".", "It", "include", "all", "the", "os", ",", "OSS", "Lite", ",", "etc", "*", "headers", "needed", "by", "this", "source", ".", "*", "/", "#", "include", "<", "linux", "/", "delay", ".", "h", ">", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "/", "*", "READ", "THIS", "This", "module", "started", "to", "configure", "the", "Audio", "Excel", "DSP", "16", "Sound", "Card", ".", "Now", "works", "with", "the", "SC", "-", "6000", "(", "old", "aedsp16", ")", "and", "new", "SC", "-", "6600", "based", "cards", ".", "NOTE", ":", "I", "have", "NO", "idea", "about", "Audio", "Excel", "DSP", "16", "III", ".", "If", "someone", "owns", "this", "audio", "card", "and", "want", "to", "see", "the", "kernel", "support", "for", "it", ",", "please", "contact", "me", ".", "Audio", "Excel", "DSP", "16", "is", "an", "SB", "pro", "II", ",", "Microsoft", "Sound", "System", "and", "MPU", "-", "401", "compatible", "card", ".", "It", "is", "software", "-", "only", "configurable", "(", "no", "jumpers", "to", "hard", "-", "set", "irq", "/", "dma", "/", "mpu", "-", "irq", ")", ",", "so", "before", "this", "module", ",", "the", "only", "way", "to", "configure", "the", "DSP", "under", "linux", "was", "boot", "the", "MS", "-", "DOS", "loading", "the", "sound", ".", "sys", "device", "driver", "(", "this", "driver", "soft", "configure", "the", "sound", "board", "hardware", "by", "massaging", "someone", "of", "its", "registers", ")", ",", "and", "then", "ctrl", "-", "alt", "-", "del", "to", "boot", "linux", "with", "the", "DSP", "configured", "by", "the", "DOS", "driver", ".", "This", "module", "works", "configuring", "your", "Audio", "Excel", "DSP", "16", "'", "s", "irq", ",", "dma", "and", "mpu", "-", "401", "-", "irq", ".", "The", "OSS", "Lite", "routines", "rely", "on", "the", "fact", "that", "if", "the", "hardware", "is", "there", ",", "they", "can", "detect", "it", ".", "The", "problem", "with", "AEDSP16", "is", "that", "no", "hardware", "can", "be", "found", "by", "the", "probe", "routines", "if", "the", "sound", "card", "is", "not", "configured", "properly", ".", "Sometimes", "the", "kernel", "probe", "routines", "can", "find", "an", "SBPRO", "even", "when", "the", "card", "is", "not", "configured", "(", "this", "is", "the", "standard", "setup", "of", "the", "card", ")", ",", "but", "the", "SBPRO", "emulation", "don", "'", "t", "work", "well", "if", "the", "card", "is", "not", "properly", "initialized", ".", "For", "this", "reason", "aedsp16_init_board", "(", ")", "routine", "is", "called", "before", "the", "OSS", "Lite", "probe", "routines", "try", "to", "detect", "the", "hardware", ".", "NOTE", "(", "READ", "THE", "NOTE", "TOO", ",", "IT", "CONTAIN", "USEFUL", "INFORMATIONS", ")", "NOTE", ":", "Now", "it", "works", "with", "SC", "-", "6000", "and", "SC", "-", "6600", "based", "audio", "cards", ".", "The", "new", "cards", "have", "no", "jumper", "switch", "at", "all", ".", "No", "more", "WSS", "or", "MPU", "-", "401", "I", "/", "O", "port", "switches", ".", "They", "have", "to", "be", "configured", "by", "software", ".", "NOTE", ":", "The", "driver", "is", "merged", "with", "the", "new", "OSS", "Lite", "sound", "driver", ".", "It", "works", "as", "a", "lowlevel", "driver", ".", "The", "Audio", "Excel", "DSP", "16", "Sound", "Card", "emulates", "both", "SBPRO", "and", "MSS", ";", "the", "OSS", "Lite", "sound", "driver", "can", "be", "configured", "for", "SBPRO", "and", "MSS", "cards", "at", "the", "same", "time", ",", "but", "the", "aedsp16", "can", "'", "t", "be", "two", "cards", "!", "!", "When", "we", "configure", "it", ",", "we", "have", "to", "choose", "the", "SBPRO", "or", "the", "MSS", "emulation", "for", "AEDSP16", ".", "We", "also", "can", "install", "a", "*", "REAL", "*", "card", "of", "the", "other", "type", "(", "see", "[", "1", "]", ").", "NOTE", ":", "If", "someone", "can", "test", "the", "combination", "AEDSP16", "+", "MSS", "or", "AEDSP16", "+", "SBPRO", "please", "let", "me", "know", "if", "it", "works", ".", "The", "MPU", "-", "401", "support", "can", "be", "compiled", "in", "together", "with", "one", "of", "the", "other", "two", "operating", "modes", ".", "NOTE", ":", "This", "is", "something", "like", "plug", "-", "and", "-", "play", ":", "we", "have", "only", "to", "plug", "the", "AEDSP16", "board", "in", "the", "socket", ",", "and", "then", "configure", "and", "compile", "a", "kernel", "that", "uses", "the", "AEDSP16", "software", "configuration", "capability", ".", "No", "jumper", "setting", "is", "needed", "!", "For", "example", ",", "if", "you", "want", "AEDSP16", "to", "be", "an", "SBPro", ",", "on", "irq", "10", ",", "dma", "3", "you", "have", "just", "to", "make", "config", "the", "OSS", "Lite", "package", ",", "configuring", "the", "AEDSP16", "sound", "card", ",", "then", "activating", "the", "SBPro", "emulation", "mode", "and", "at", "last", "configuring", "IRQ", "and", "DMA", ".", "Compile", "the", "kernel", "and", "run", "it", ".", "NOTE", ":", "This", "means", "for", "SC", "-", "6000", "cards", "that", "you", "can", "choose", "irq", "and", "dma", ",", "but", "not", "the", "I", "/", "O", "addresses", ".", "To", "change", "I", "/", "O", "addresses", "you", "have", "to", "set", "them", "with", "jumpers", ".", "For", "SC", "-", "6600", "cards", "you", "have", "no", "jumpers", "so", "you", "have", "to", "set", "up", "your", "full", "card", "configuration", "in", "the", "make", "config", ".", "You", "can", "change", "the", "irq", "/", "dma", "/", "mirq", "settings", "WITHOUT", "THE", "NEED", "to", "open", "your", "computer", "and", "massage", "the", "jumpers", "(", "there", "are", "no", "irq", "/", "dma", "/", "mirq", "jumpers", "to", "be", "configured", "anyway", ",", "only", "I", "/", "O", "BASE", "values", "have", "to", "be", "configured", "with", "jumpers", ")", "For", "some", "ununderstandable", "reason", ",", "the", "card", "default", "of", "irq", "7", ",", "dma", "1", ",", "don", "'", "t", "work", "for", "me", ".", "Seems", "to", "be", "an", "IRQ", "or", "DMA", "conflict", ".", "Under", "heavy", "HDD", "work", ",", "the", "kernel", "start", "to", "erupt", "out", "a", "lot", "of", "messages", "like", ":", "'", "Sound", ":", "DMA", "timed", "out", "-", "IRQ", "/", "DRQ", "config", "error", "?", "'", "For", "what", "I", "can", "say", ",", "I", "have", "NOT", "any", "conflict", "at", "irq", "7", "(", "under", "linux", "I", "'", "m", "using", "the", "lp", "polling", "driver", ")", ",", "and", "dma", "line", "1", "is", "unused", "as", "stated", "by", "/", "proc", "/", "dma", ".", "I", "can", "suppose", "this", "is", "a", "bug", "of", "AEDSP16", ".", "I", "know", "my", "hardware", "so", "I", "'", "m", "pretty", "sure", "I", "have", "not", "any", "conflict", ",", "but", "may", "be", "I", "'", "m", "wrong", ".", "Who", "knows", "!", "Anyway", "a", "setting", "of", "irq", "10", ",", "dma", "3", "works", "really", "fine", ".", "NOTE", ":", "if", "someone", "can", "use", "AEDSP16", "with", "irq", "7", ",", "dma", "1", ",", "please", "let", "me", "know", "the", "emulation", "mode", ",", "all", "the", "installed", "hardware", "and", "the", "hardware", "configuration", "(", "irq", "and", "dma", "settings", "of", "all", "the", "hardware", ")", ".", "This", "init", "module", "should", "work", "with", "SBPRO", "+", "MSS", ",", "when", "one", "of", "the", "two", "is", "the", "AEDSP16", "emulation", "and", "the", "other", "the", "real", "card", ".", "(", "see", "[", "1", "]", ")", "For", "example", ":", "AEDSP16", "(", "0x220", ")", "in", "SBPRO", "emu", "(", "0x220", ")", "+", "real", "MSS", "+", "other", "AEDSP16", "(", "0x220", ")", "in", "MSS", "emu", "+", "real", "SBPRO", "(", "0x240", ")", "+", "other", "MPU401", "should", "work", ".", "(", "see", "[", "2", "]", ")", "[", "1", "]", "Date", ":", "Mon", ",", "29", "Jul", "1997", "08", ":", "35", ":", "40", "+", "0100", "From", ":", "Mr", "S", "J", "Greenaway", "<", "sjg95", "@", "unixfe", ".", "rl", ".", "ac", ".", "uk", ">", "[", "..", ".]", "Just", "to", "let", "you", "know", "got", "my", "Audio", "Excel", "(", "emulating", "a", "MSS", ")", "working", "with", "my", "original", "SB16", ",", "thanks", "for", "the", "driver", "!", "[", "..", ".]", "[", "2", "]", "Not", "tested", "by", "me", "for", "lack", "of", "hardware", ".", "TODO", ",", "WISHES", "AND", "TECH", "-", "About", "I", "/", "O", "ports", "allocation", "Request", "the", "2x0h", "region", "(", "port", "base", ")", "in", "any", "case", "if", "we", "are", "using", "this", "card", ".", "NOTE", ":", "the", "\"", "aedsp16", "(", "base", ")", "\"", "string", "with", "which", "we", "are", "requesting", "the", "aedsp16", "port", "base", "region", "(", "see", "code", ")", "does", "not", "mean", "necessarily", "that", "we", "are", "emulating", "sbpro", ".", "Even", "if", "this", "region", "is", "the", "sbpro", "I", "/", "O", "ports", "region", ",", "we", "use", "this", "region", "to", "access", "the", "control", "registers", "of", "the", "card", ",", "and", "if", "emulating", "sbpro", ",", "I", "/", "O", "sbpro", "registers", "too", ".", "If", "we", "are", "emulating", "MSS", ",", "the", "sbpro", "registers", "are", "not", "used", ",", "in", "no", "way", ",", "to", "emulate", "an", "sbpro", ":", "they", "are", "used", "only", "for", "configuration", "purposes", ".", "Started", "Fri", "Mar", "17", "16", ":", "13", ":", "18", "MET", "1995", "v0", ".", "1", "(", "ALPHA", ",", "was", "a", "user", "-", "level", "program", "called", "AudioExcelDSP16", ".", "c", ")", "-", "Initial", "code", ".", "v0", ".", "2", "(", "ALPHA", ")", "-", "Cleanups", ".", "-", "Integrated", "with", "Linux", "voxware", "v", "2", ".", "90", "-", "2", "kernel", "sound", "driver", ".", "-", "SoundBlaster", "Pro", "mode", "configuration", ".", "-", "Microsoft", "Sound", "System", "mode", "configuration", ".", "-", "MPU", "-", "401", "mode", "configuration", ".", "v0", ".", "3", "(", "ALPHA", ")", "-", "Cleanups", ".", "-", "Rearranged", "the", "code", "to", "let", "aedsp16_init_board", "be", "more", "general", ".", "-", "Erased", "the", "REALLY_SLOW_IO", ".", "We", "don", "'", "t", "need", "it", ".", "Erased", "the", "linux", "/", "io", ".", "h", "inclusion", "too", ".", "We", "rely", "on", "os", ".", "h", "-", "Used", "the", "to", "get", "a", "variable", "len", "string", "(", "we", "are", "not", "sure", "about", "the", "len", "of", "Copyright", "string", ")", ".", "This", "works", "with", "any", "SB", "and", "compatible", ".", "-", "Added", "the", "code", "to", "request_region", "at", "device", "init", "(", "should", "go", "in", "the", "main", "body", "of", "voxware", ")", ".", "v0", ".", "4", "(", "BETA", ")", "-", "Better", "configure", ".", "c", "patch", "for", "aedsp16", "configuration", "(", "better", "logic", "of", "inclusion", "of", "AEDSP16", "support", ")", "-", "Modified", "the", "conditional", "compilation", "to", "better", "support", "more", "than", "one", "sound", "card", "of", "the", "emulated", "type", "(", "read", "the", "NOTES", "above", ")", "-", "Moved", "the", "sb", "init", "routine", "from", "the", "attach", "to", "the", "very", "first", "probe", "in", "sb_card", ".", "c", "-", "Rearrangements", "and", "cleanups", "-", "Wiped", "out", "some", "unnecessary", "code", "and", "variables", ":", "this", "is", "kernel", "code", "so", "it", "is", "better", "save", "some", "TEXT", "and", "DATA", "-", "Fixed", "the", "request_region", "code", ".", "We", "must", "allocate", "the", "aedsp16", "(", "sbpro", ")", "I", "/", "O", "ports", "in", "any", "case", "because", "they", "are", "used", "to", "access", "the", "DSP", "configuration", "registers", "and", "we", "can", "not", "allow", "anyone", "to", "get", "them", ".", "v0", ".", "5", "-", "cleanups", "on", "comments", "-", "prep", "for", "diffs", "against", "v3", ".", "0", "-", "proto", "-", "950402", "v0", ".", "6", "-", "removed", "the", "request_region", "(", ")", "s", "when", "compiling", "the", "MODULE", "sound", ".", "o", "because", "we", "are", "not", "allowed", "(", "by", "the", "actual", "voxware", "structure", ")", "to", "release_region", "(", ")", "v0", ".", "7", "(", "pre", "ALPHA", ",", "not", "distributed", ")", "-", "started", "porting", "this", "module", "to", "kernel", "1", ".", "3", ".", "84", ".", "Dummy", "probe", "/", "attach", "routines", ".", "v0", ".", "8", "(", "ALPHA", ")", "-", "attached", "all", "the", "init", "routines", ".", "v0", ".", "9", "(", "BETA", ")", "-", "Integrated", "with", "linux", "-", "pre2", ".", "0", ".", "7", "-", "Integrated", "with", "configuration", "scripts", ".", "-", "Cleaned", "up", "and", "beautyfied", "the", "code", ".", "v0", ".", "9", ".", "9", "(", "BETA", ")", "-", "Thanks", "to", "Piercarlo", "Grandi", ":", "corrected", "the", "conditonal", "compilation", "code", ".", "Now", "only", "the", "code", "configured", "is", "compiled", "in", ",", "with", "some", "memory", "saving", ".", "v0", ".", "9", ".", "10", "-", "Integration", "into", "the", "sound", "/", "lowlevel", "/", "section", "of", "the", "sound", "driver", ".", "-", "Re", "-", "organized", "the", "code", ".", "v0", ".", "9", ".", "11", "(", "not", "distributed", ")", "-", "Rewritten", "the", "init", "interface", "-", "routines", "to", "initialize", "the", "AEDSP16", "in", "one", "shot", ".", "-", "More", "cosmetics", ".", "-", "SC", "-", "6600", "support", ".", "-", "More", "soft", "/", "hard", "configuration", ".", "v0", ".", "9", ".", "12", "-", "Refined", "the", "v0", ".", "9", ".", "11", "code", "with", "conditional", "compilation", "to", "distinguish", "between", "SC", "-", "6000", "and", "SC", "-", "6600", "code", ".", "v1", ".", "0", ".", "0", "-", "Prep", "for", "merging", "with", "OSS", "Lite", "and", "Linux", "kernel", "2", ".", "1", ".", "13", "-", "Corrected", "a", "bug", "in", "request", "/", "check", "/", "release", "region", "calls", "(", "thanks", "to", "the", "new", "kernel", "exception", "handling", ")", ".", "v1", ".", "1", "-", "Revamped", "for", "integration", "with", "new", "modularized", "sound", "drivers", ":", "to", "enhance", "the", "flexibility", "of", "modular", "version", ",", "I", "have", "removed", "all", "the", "conditional", "compilation", "for", "SBPRO", ",", "MPU", "and", "MSS", "code", ".", "Now", "it", "is", "all", "managed", "with", "the", "ae_config", "structure", ".", "v1", ".", "2", "-", "Module", "informations", "added", ".", "-", "Removed", "aedsp16_delay_10msec", "(", "),", "now", "using", "mdelay", "(", "10", ")", "-", "All", "data", "and", "funcs", "moved", "to", ".", "*.", "init", "section", ".", "v1", ".", "3", "Arnaldo", "Carvalho", "de", "Melo", "<", "acme", "@", "conectiva", ".", "com", ".", "br", ">", "-", "2000", "/", "09", "/", "27", "-", "got", "rid", "of", "check_region", "Known", "Problems", ":", "-", "Audio", "Excel", "DSP", "16", "III", "don", "'", "t", "work", "with", "this", "driver", ".", "Credits", ":", "Many", "thanks", "to", "Gerald", "Britton", "<", "gbritton", "@", "CapAccess", ".", "org", ">", ".", "He", "helped", "me", "a", "lot", "in", "testing", "the", "0", ".", "9", ".", "11", "and", "0", ".", "9", ".", "12", "versions", "of", "this", "driver", ".", "*", "/", "#", "define", "VERSION", "\"", "1", ".", "3", "\"", "/", "*", "Version", "of", "Audio", "Excel", "DSP", "16", "driver", "*", "/", "#", "undef", "AEDSP16_DEBUG", "/", "*", "Define", "this", "to", "1", "to", "enable", "debug", "code", "*", "/", "#", "undef", "AEDSP16_DEBUG_MORE", "/", "*", "Define", "this", "to", "1", "to", "enable", "more", "debug", "*", "/", "#", "undef", "AEDSP16_INFO", "/", "*", "Define", "this", "to", "1", "to", "enable", "info", "code", "*", "/", "#", "if", "defined", "(", "AEDSP16_DEBUG", ")", "#", "define", "DBG", "(", "x", ")", "printk", "x", "#", "if", "defined", "(", "AEDSP16_DEBUG_MORE", ")", "#", "define", "DBG1", "(", "x", ")", "printk", "x", "#", "else", "#", "define", "DBG1", "(", "x", ")", "#", "endif", "#", "else", "#", "define", "DBG", "(", "x", ")", "#", "define", "DBG1", "(", "x", ")", "#", "endif", "/", "*", "*", "Misc", "definitions", "*", "/", "#", "define", "TRUE", "1", "#", "define", "FALSE", "0", "/", "*", "*", "Region", "Size", "for", "request", "/", "check", "/", "release", "region", ".", "*", "/", "#", "define", "IOBASE_REGION_SIZE", "0x10", "/", "*", "*", "Hardware", "related", "defaults", "*", "/", "#", "define", "DEF_AEDSP16_IOB", "0x220", "/", "*", "0x220", "(", "default", ")", "0x240", "*", "/", "#", "define", "DEF_AEDSP16_IRQ", "7", "/", "*", "5", "7", "(", "default", ")", "9", "10", "11", "*", "/", "#", "define", "DEF_AEDSP16_MRQ", "0", "/", "*", "5", "7", "9", "10", "0", "(", "default", ")", ",", "0", "means", "disable", "*", "/", "#", "define", "DEF_AEDSP16_DMA", "1", "/", "*", "0", "1", "(", "default", ")", "3", "*", "/", "/", "*", "*", "Commands", "of", "AEDSP16", "'", "s", "DSP", "(", "SBPRO", "+", "special", ")", ".", "*", "Some", "of", "them", "are", "COMMAND_xx", ",", "in", "the", "future", "they", "may", "change", ".", "*", "/", "#", "define", "WRITE_MDIRQ_CFG", "0x50", "/", "*", "Set", "M", "&", "I", "&", "DRQ", "mask", "(", "the", "real", "config", ")", "*", "/", "#", "define", "COMMAND_52", "0x52", "/", "*", "*", "/", "#", "define", "READ_HARD_CFG", "0x58", "/", "*", "Read", "Hardware", "Config", "(", "I", "/", "O", "base", "etc", ")", "*", "/", "#", "define", "COMMAND_5C", "0x5c", "/", "*", "*", "/", "#", "define", "COMMAND_60", "0x60", "/", "*", "*", "/", "#", "define", "COMMAND_66", "0x66", "/", "*", "*", "/", "#", "define", "COMMAND_6C", "0x6c", "/", "*", "*", "/", "#", "define", "COMMAND_6E", "0x6e", "/", "*", "*", "/", "#", "define", "COMMAND_88", "0x88", "/", "*", "*", "/", "#", "define", "DSP_INIT_MSS", "0x8c", "/", "*", "Enable", "Microsoft", "Sound", "System", "mode", "*", "/", "#", "define", "COMMAND_C5", "0xc5", "/", "*", "*", "/", "#", "define", "GET_DSP_VERSION", "0xe1", "/", "*", "Get", "DSP", "Version", "*", "/", "#", "define", "GET_DSP_COPYRIGHT", "0xe3", "/", "*", "Get", "DSP", "Copyright", "*", "/", "/", "*", "*", "Offsets", "of", "AEDSP16", "DSP", "I", "/", "O", "ports", ".", "The", "offset", "is", "added", "to", "base", "I", "/", "O", "port", "*", "to", "have", "the", "actual", "I", "/", "O", "port", ".", "*", "Register", "permissions", "are", ":", "*", "(", "wo", ")", "=", "=", "Write", "Only", "*", "(", "ro", ")", "=", "=", "Read", "Only", "*", "(", "w", "-", ")", "=", "=", "Write", "*", "(", "r", "-", ")", "=", "=", "Read", "*", "/", "#", "define", "DSP_RESET", "0x06", "/", "*", "offset", "of", "DSP", "RESET", "(", "wo", ")", "*", "/", "#", "define", "DSP_READ", "0x0a", "/", "*", "offset", "of", "DSP", "READ", "(", "ro", ")", "*", "/", "#", "define", "DSP_WRITE", "0x0c", "/", "*", "offset", "of", "DSP", "WRITE", "(", "w", "-", ")", "*", "/", "#", "define", "DSP_COMMAND", "0x0c", "/", "*", "offset", "of", "DSP", "COMMAND", "(", "w", "-", ")", "*", "/", "#", "define", "DSP_STATUS", "0x0c", "/", "*", "offset", "of", "DSP", "STATUS", "(", "r", "-", ")", "*", "/", "#", "define", "DSP_DATAVAIL", "0x0e", "/", "*", "offset", "of", "DSP", "DATA", "AVAILABLE", "(", "ro", ")", "*", "/", "#", "define", "RETRY", "10", "/", "*", "Various", "retry", "values", "on", "I", "/", "O", "opera", "-", "*", "/", "#", "define", "STATUSRETRY", "1000", "/", "*", "tions", ".", "Sometimes", "we", "have", "to", "*", "/", "#", "define", "HARDRETRY", "500000", "/", "*", "wait", "for", "previous", "cmd", "to", "complete", "*", "/", "/", "*", "*", "Size", "of", "character", "arrays", "that", "store", "name", "and", "version", "of", "sound", "card", "*", "/", "#", "define", "CARDNAMELEN", "15", "/", "*", "Size", "of", "the", "card", "'", "s", "name", "in", "chars", "*", "/", "#", "define", "CARDVERLEN", "10", "/", "*", "Size", "of", "the", "card", "'", "s", "version", "in", "chars", "*", "/", "#", "define", "CARDVERDIGITS", "2", "/", "*", "Number", "of", "digits", "in", "the", "version", "*", "/", "#", "if", "defined", "(", "CONFIG_SC6600", ")", "/", "*", "*", "Bitmapped", "flags", "of", "hard", "configuration", "*", "/", "/", "*", "*", "Decode", "macros", "(", "xl", "=", "=", "low", "byte", ",", "xh", "=", "high", "byte", ")", "*", "/", "#", "define", "IOBASE", "(", "xl", ")", "(", "(", "xl", "&", "0x01", ")", "?", "0x240", ":", "0x220", ")", "#", "define", "JOY", "(", "xl", ")", "(", "xl", "&", "0x02", ")", "#", "define", "MPUADDR", "(", "xl", ")", "(", "\\", "(", "xl", "&", "0x0C", ")", "?", "0x330", ":", "\\", "(", "xl", "&", "0x08", ")", "?", "0x320", ":", "\\", "(", "xl", "&", "0x04", ")", "?", "0x310", ":", "\\", "0x300", ")", "#", "define", "WSSADDR", "(", "xl", ")", "(", "(", "xl", "&", "0x10", ")", "?", "0xE80", ":", "0x530", ")", "#", "define", "CDROM", "(", "xh", ")", "(", "xh", "&", "0x20", ")", "#", "define", "CDROMADDR", "(", "xh", ")", "(", "((", "xh", "&", "0x1F", ")", "<", "<", "4", ")", "+", "0x200", ")", "/", "*", "*", "Encode", "macros", "*", "/", "#", "define", "BLDIOBASE", "(", "xl", ",", "val", ")", "{", "\\", "xl", "&", "=", "~", "0x01", ";", "\\", "if", "(", "val", "=", "=", "0x240", ")", "\\", "xl", "|", "=", "0x01", ";", "\\", "}", "#", "define", "BLDJOY", "(", "xl", ",", "val", ")", "{", "\\", "xl", "&", "=", "~", "0x02", ";", "\\", "if", "(", "val", "=", "=", "1", ")", "\\", "xl", "|", "=", "0x02", ";", "\\", "}", "#", "define", "BLDMPUADDR", "(", "xl", ",", "val", ")", "{", "\\", "xl", "&", "=", "~", "0x0C", ";", "\\", "switch", "(", "val", ")", "{", "\\", "case", "0x330", ":", "\\", "xl", "|", "=", "0x0C", ";", "\\", "break", ";", "\\", "case", "0x320", ":", "\\", "xl", "|", "=", "0x08", ";", "\\", "break", ";", "\\", "case", "0x310", ":", "\\", "xl", "|", "=", "0x04", ";", "\\", "break", ";", "\\", "case", "0x300", ":", "\\", "xl", "|", "=", "0x00", ";", "\\", "break", ";", "\\", "default", ":", "\\", "xl", "|", "=", "0x00", ";", "\\", "break", ";", "\\", "}", "\\", "}", "#", "define", "BLDWSSADDR", "(", "xl", ",", "val", ")", "{", "\\", "xl", "&", "=", "~", "0x10", ";", "\\", "if", "(", "val", "=", "=", "0xE80", ")", "\\", "xl", "|", "=", "0x10", ";", "\\", "}", "#", "define", "BLDCDROM", "(", "xh", ",", "val", ")", "{", "\\", "xh", "&", "=", "~", "0x20", ";", "\\", "if", "(", "val", "=", "=", "1", ")", "\\", "xh", "|", "=", "0x20", ";", "\\", "}", "#", "define", "BLDCDROMADDR", "(", "xh", ",", "val", ")", "{", "\\", "int", "tmp", "=", "val", ";", "\\", "tmp", "-", "=", "0x200", ";", "\\", "tmp", ">", ">=", "4", ";", "\\", "tmp", "&", "=", "0x1F", ";", "\\", "xh", "|", "=", "tmp", ";", "\\", "xh", "&", "=", "0x7F", ";", "\\", "xh", "|", "=", "0x40", ";", "\\", "}", "#", "endif", "/", "*", "CONFIG_SC6600", "*", "/", "/", "*", "*", "Bit", "mapped", "flags", "for", "calling", "aedsp16_init_board", "(", "),", "and", "saving", "the", "current", "*", "emulation", "mode", ".", "*", "/", "#", "define", "INIT_NONE", "(", "0", ")", "#", "define", "INIT_SBPRO", "(", "1", "<", "<", "0", ")", "#", "define", "INIT_MSS", "(", "1", "<", "<", "1", ")", "#", "define", "INIT_MPU401", "(", "1", "<", "<", "2", ")", "static", "int", "soft_cfg", "__initdata", "=", "0", ";", "/", "*", "bitmapped", "config", "*", "/", "static", "int", "soft_cfg_mss", "__initdata", "=", "0", ";", "/", "*", "bitmapped", "mss", "config", "*", "/", "static", "int", "ver", "[", "CARDVERDIGITS", "]", "__initdata", "=", "{", "0", ",", "0", "}", ";", "/", "*", "DSP", "Ver", ":", "hi", "-", ">", "ver", "[", "0", "]", "lo", "-", ">", "ver", "[", "1", "]", "*", "/", "#", "if", "defined", "(", "CONFIG_SC6600", ")", "static", "int", "hard_cfg", "[", "2", "]", "/", "*", "lo", "<", "-", "hard_cfg", "[", "0", "]", "hi", "<", "-", "hard_cfg", "[", "1", "]", "*", "/", "__initdata", "=", "{", "0", ",", "0", "}", ";", "#", "endif", "/", "*", "CONFIG_SC6600", "*", "/", "#", "if", "defined", "(", "CONFIG_SC6600", ")", "/", "*", "Decoded", "hard", "configuration", "*", "/", "struct", "d_hcfg", "{", "int", "iobase", ";", "int", "joystick", ";", "int", "mpubase", ";", "int", "wssbase", ";", "int", "cdrom", ";", "int", "cdrombase", ";", "}", ";", "static", "struct", "d_hcfg", "decoded_hcfg", "__initdata", "=", "{", "0", ",", "}", ";", "#", "endif", "/", "*", "CONFIG_SC6600", "*", "/", "/", "*", "orVals", "contain", "the", "values", "to", "be", "or", "'", "ed", "*", "/", "struct", "orVals", "{", "int", "val", ";", "/", "*", "irq", "|", "mirq", "|", "dma", "*", "/", "int", "or", ";", "/", "*", "soft_cfg", "|", "=", "TheStruct", ".", "or", "*", "/", "}", ";", "/", "*", "aedsp16_info", "contain", "the", "audio", "card", "configuration", "*", "/", "struct", "aedsp16_info", "{", "int", "base_io", ";", "/", "*", "base", "I", "/", "O", "address", "for", "accessing", "card", "*", "/", "int", "irq", ";", "/", "*", "irq", "value", "for", "DSP", "I", "/", "O", "*", "/", "int", "mpu_irq", ";", "/", "*", "irq", "for", "mpu401", "interface", "I", "/", "O", "*", "/", "int", "dma", ";", "/", "*", "dma", "value", "for", "DSP", "I", "/", "O", "*", "/", "int", "mss_base", ";", "/", "*", "base", "I", "/", "O", "for", "Microsoft", "Sound", "System", "*", "/", "int", "mpu_base", ";", "/", "*", "base", "I", "/", "O", "for", "MPU", "-", "401", "emulation", "*", "/", "int", "init", ";", "/", "*", "Initialization", "status", "of", "the", "card", "*", "/", "}", ";", "/", "*", "*", "Magic", "values", "that", "the", "DSP", "will", "eat", "when", "configuring", "irq", "/", "mirq", "/", "dma", "*", "/", "/", "*", "DSP", "IRQ", "conversion", "array", "*", "/", "static", "struct", "orVals", "orIRQ", "[", "]", "__initdata", "=", "{", "{", "0x05", ",", "0x28", "}", ",", "{", "0x07", ",", "0x08", "}", ",", "{", "0x09", ",", "0x10", "}", ",", "{", "0x0a", ",", "0x18", "}", ",", "{", "0x0b", ",", "0x20", "}", ",", "{", "0x00", ",", "0x00", "}", "}", ";", "/", "*", "MPU", "-", "401", "IRQ", "conversion", "array", "*", "/", "static", "struct", "orVals", "orMIRQ", "[", "]", "__initdata", "=", "{", "{", "0x05", ",", "0x04", "}", ",", "{", "0x07", ",", "0x44", "}", ",", "{", "0x09", ",", "0x84", "}", ",", "{", "0x0a", ",", "0xc4", "}", ",", "{", "0x00", ",", "0x00", "}", "}", ";", "/", "*", "DMA", "Channels", "conversion", "array", "*", "/", "static", "struct", "orVals", "orDMA", "[", "]", "__initdata", "=", "{", "{", "0x00", ",", "0x01", "}", ",", "{", "0x01", ",", "0x02", "}", ",", "{", "0x03", ",", "0x03", "}", ",", "{", "0x00", ",", "0x00", "}", "}", ";", "static", "struct", "aedsp16_info", "ae_config", "=", "{", ".", "base_io", "=", "DEF_AEDSP16_IOB", ",", ".", "irq", "=", "DEF_AEDSP16_IRQ", ",", ".", "mpu_irq", "=", "DEF_AEDSP16_MRQ", ",", ".", "dma", "=", "DEF_AEDSP16_DMA", ",", ".", "mss_base", "=", "-", "1", ",", ".", "mpu_base", "=", "-", "1", ",", ".", "init", "=", "INIT_NONE", "}", ";", "/", "*", "*", "Buffers", "to", "store", "audio", "card", "informations", "*", "/", "static", "char", "DSPCopyright", "[", "CARDNAMELEN", "+", "1", "]", "__initdata", "=", "{", "0", ",", "}", ";", "static", "char", "DSPVersion", "[", "CARDVERLEN", "+", "1", "]", "__initdata", "=", "{", "0", ",", "}", ";", "static", "int", "__init", "aedsp16_wait_data", "(", "int", "port", ")", "{", "int", "loop", "=", "STATUSRETRY", ";", "unsigned", "char", "ret", "=", "0", ";", "DBG1", "(", "(\"", "aedsp16_wait_data", "(", "0x", "%", "x", ")", ":", "\"", ",", "port", ")", ");", "do", "{", "ret", "=", "inb", "(", "port", "+", "DSP_DATAVAIL", ")", ";", "/", "*", "*", "Wait", "for", "data", "available", "(", "bit", "7", "of", "ret", "=", "=", "1", ")", "*", "/", "}", "while", "(", "!(", "ret", "&", "0x80", ")", "&", "&", "loop", "-", "-)", ";", "if", "(", "ret", "&", "0x80", ")", "{", "DBG1", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "DBG1", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "static", "int", "__init", "aedsp16_read", "(", "int", "port", ")", "{", "int", "inbyte", ";", "DBG", "(", "(\"", "Read", "DSP", "Byte", "(", "0x", "%", "x", ")", ":", "\"", ",", "port", ")", ");", "if", "(", "aedsp16_wait_data", "(", "port", ")", "=", "=", "FALSE", ")", "{", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "-", "1", ";", "}", "inbyte", "=", "inb", "(", "port", "+", "DSP_READ", ")", ";", "DBG", "(", "(\"", "read", "[", "0x", "%", "x", "]", "/{", "%", "c", "}", ".\\", "n", "\"", ",", "inbyte", ",", "inbyte", ")", ");", "return", "inbyte", ";", "}", "static", "int", "__init", "aedsp16_test_dsp", "(", "int", "port", ")", "{", "return", "(", "(", "aedsp16_read", "(", "port", ")", "=", "=", "0xaa", ")", "?", "TRUE", ":", "FALSE", ")", ";", "}", "static", "int", "__init", "aedsp16_dsp_reset", "(", "int", "port", ")", "{", "/", "*", "*", "Reset", "DSP", "*", "/", "DBG", "(", "(\"", "Reset", "DSP", ":", "\\", "n", "\"", "))", ";", "outb", "(", "1", ",", "(", "port", "+", "DSP_RESET", ")", ");", "udelay", "(", "10", ")", ";", "outb", "(", "0", ",", "(", "port", "+", "DSP_RESET", ")", ");", "udelay", "(", "10", ")", ";", "udelay", "(", "10", ")", ";", "if", "(", "aedsp16_test_dsp", "(", "port", ")", "=", "=", "TRUE", ")", "{", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "else", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "static", "int", "__init", "aedsp16_write", "(", "int", "port", ",", "int", "cmd", ")", "{", "unsigned", "char", "ret", ";", "int", "loop", "=", "HARDRETRY", ";", "DBG", "(", "(\"", "Write", "DSP", "Byte", "(", "0x", "%", "x", ")", "[", "0x", "%", "x", "]", ":", "\"", ",", "port", ",", "cmd", ")", ");", "do", "{", "ret", "=", "inb", "(", "port", "+", "DSP_STATUS", ")", ";", "/", "*", "*", "DSP", "ready", "to", "receive", "data", "if", "bit", "7", "of", "ret", "=", "=", "0", "*", "/", "if", "(", "!(", "ret", "&", "0x80", ")", ")", "{", "outb", "(", "cmd", ",", "port", "+", "DSP_COMMAND", ")", ";", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "return", "0", ";", "}", "}", "while", "(", "loop", "-", "-)", ";", "DBG", "(", "(\"", "timeout", ".", "\\", "n", "\"", "))", ";", "printk", "(", "\"[", "AEDSP16", "]", "DSP", "Command", "(", "0x", "%", "x", ")", "timeout", ".", "\\", "n", "\"", ",", "cmd", ")", ";", "return", "-", "1", ";", "}", "#", "if", "defined", "(", "CONFIG_SC6600", ")", "#", "if", "defined", "(", "AEDSP16_INFO", ")", "|", "|", "defined", "(", "AEDSP16_DEBUG", ")", "void", "__init", "aedsp16_pinfo", "(", "void", ")", "{", "DBG", "(", "(\"", "\\", "n", "Base", "address", ":", "%", "x", "\\", "n", "\"", ",", "decoded_hcfg", ".", "iobase", ")", ");", "DBG", "(", "(\"", "Joystick", ":", "%", "s", "present", "\\", "n", "\"", ",", "decoded_hcfg", ".", "joystick", "?", "\"\"", ":\"", "not", "\"", "))", ";", "DBG", "(", "(\"", "WSS", "addr", ":", "%", "x", "\\", "n", "\"", ",", "decoded_hcfg", ".", "wssbase", ")", ");", "DBG", "(", "(\"", "MPU", "-", "401", "addr", ":", "%", "x", "\\", "n", "\"", ",", "decoded_hcfg", ".", "mpubase", ")", ");", "DBG", "(", "(\"", "CDROM", ":", "%", "s", "present", "\\", "n", "\"", ",", "(", "decoded_hcfg", ".", "cdrom", "!", "=", "4", ")", "?\"", "\":", "\"", "not", "\"", "))", ";", "DBG", "(", "(\"", "CDROMADDR", ":", "%", "x", "\\", "n", "\\", "n", "\"", ",", "decoded_hcfg", ".", "cdrombase", ")", ");", "}", "#", "endif", "static", "void", "__init", "aedsp16_hard_decode", "(", "void", ")", "{", "DBG", "(", "(\"", "aedsp16_hard_decode", ":", "0x", "%", "x", ",", "0x", "%", "x", "\\", "n", "\"", ",", "hard_cfg", "[", "0", "]", ",", "hard_cfg", "[", "1", "]", "))", ";", "/", "*", "*", "Decode", "Cfg", "Bytes", ".", "*", "/", "decoded_hcfg", ".", "iobase", "=", "IOBASE", "(", "hard_cfg", "[", "0", "]", ");", "decoded_hcfg", ".", "joystick", "=", "JOY", "(", "hard_cfg", "[", "0", "]", ");", "decoded_hcfg", ".", "wssbase", "=", "WSSADDR", "(", "hard_cfg", "[", "0", "]", ");", "decoded_hcfg", ".", "mpubase", "=", "MPUADDR", "(", "hard_cfg", "[", "0", "]", ");", "decoded_hcfg", ".", "cdrom", "=", "CDROM", "(", "hard_cfg", "[", "1", "]", ");", "decoded_hcfg", ".", "cdrombase", "=", "CDROMADDR", "(", "hard_cfg", "[", "1", "]", ");", "#", "if", "defined", "(", "AEDSP16_INFO", ")", "|", "|", "defined", "(", "AEDSP16_DEBUG", ")", "printk", "(", "\"", "Original", "sound", "card", "configuration", ":", "\\", "n", "\"", ");", "aedsp16_pinfo", "(", ");", "#", "endif", "/", "*", "*", "Now", "set", "up", "the", "real", "kernel", "configuration", ".", "*", "/", "decoded_hcfg", ".", "iobase", "=", "ae_config", ".", "base_io", ";", "decoded_hcfg", ".", "wssbase", "=", "ae_config", ".", "mss_base", ";", "decoded_hcfg", ".", "mpubase", "=", "ae_config", ".", "mpu_base", ";", "#", "if", "defined", "(", "CONFIG_SC6600_JOY", ")", "decoded_hcfg", ".", "joystick", "=", "CONFIG_SC6600_JOY", ";", "/", "*", "Enable", "*", "/", "#", "endif", "#", "if", "defined", "(", "CONFIG_SC6600_CDROM", ")", "decoded_hcfg", ".", "cdrom", "=", "CONFIG_SC6600_CDROM", ";", "/", "*", "4", ":", "N", "-", "3", ":", "I", "-", "2", ":", "G", "-", "1", ":", "P", "-", "0", ":", "S", "*", "/", "#", "endif", "#", "if", "defined", "(", "CONFIG_SC6600_CDROMBASE", ")", "decoded_hcfg", ".", "cdrombase", "=", "CONFIG_SC6600_CDROMBASE", ";", "/", "*", "0", "Disable", "*", "/", "#", "endif", "#", "if", "defined", "(", "AEDSP16_DEBUG", ")", "DBG", "(", "(\"", "New", "Values", ":", "\\", "n", "\"", "))", ";", "aedsp16_pinfo", "(", ");", "#", "endif", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "}", "static", "void", "__init", "aedsp16_hard_encode", "(", "void", ")", "{", "DBG", "(", "(\"", "aedsp16_hard_encode", ":", "0x", "%", "x", ",", "0x", "%", "x", "\\", "n", "\"", ",", "hard_cfg", "[", "0", "]", ",", "hard_cfg", "[", "1", "]", "))", ";", "hard_cfg", "[", "0", "]", "=", "0", ";", "hard_cfg", "[", "1", "]", "=", "0", ";", "hard_cfg", "[", "0", "]", "|", "=", "0x20", ";", "BLDIOBASE", "(", "hard_cfg", "[", "0", "]", ",", "decoded_hcfg", ".", "iobase", ")", ";", "BLDWSSADDR", "(", "hard_cfg", "[", "0", "]", ",", "decoded_hcfg", ".", "wssbase", ")", ";", "BLDMPUADDR", "(", "hard_cfg", "[", "0", "]", ",", "decoded_hcfg", ".", "mpubase", ")", ";", "BLDJOY", "(", "hard_cfg", "[", "0", "]", ",", "decoded_hcfg", ".", "joystick", ")", ";", "BLDCDROM", "(", "hard_cfg", "[", "1", "]", ",", "decoded_hcfg", ".", "cdrom", ")", ";", "BLDCDROMADDR", "(", "hard_cfg", "[", "1", "]", ",", "decoded_hcfg", ".", "cdrombase", ")", ";", "#", "if", "defined", "(", "AEDSP16_DEBUG", ")", "aedsp16_pinfo", "(", ");", "#", "endif", "DBG", "(", "(\"", "aedsp16_hard_encode", ":", "0x", "%", "x", ",", "0x", "%", "x", "\\", "n", "\"", ",", "hard_cfg", "[", "0", "]", ",", "hard_cfg", "[", "1", "]", "))", ";", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "}", "static", "int", "__init", "aedsp16_hard_write", "(", "int", "port", ")", "{", "DBG", "(", "(\"", "aedsp16_hard_write", ":", "\\", "n", "\"", "))", ";", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_6C", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_6C", ")", ";", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_5C", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_5C", ")", ";", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "hard_cfg", "[", "0", "]", "))", "{", "printk", "(", "\"[", "AEDSP16", "]", "DATA", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "hard_cfg", "[", "0", "]", ");", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "hard_cfg", "[", "1", "]", "))", "{", "printk", "(", "\"[", "AEDSP16", "]", "DATA", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "hard_cfg", "[", "1", "]", ");", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_C5", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_C5", ")", ";", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "static", "int", "__init", "aedsp16_hard_read", "(", "int", "port", ")", "{", "DBG", "(", "(\"", "aedsp16_hard_read", ":", "\\", "n", "\"", "))", ";", "if", "(", "aedsp16_write", "(", "port", ",", "READ_HARD_CFG", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "READ_HARD_CFG", ")", ";", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "if", "(", "(", "hard_cfg", "[", "0", "]", "=", "aedsp16_read", "(", "port", ")", ")", "=", "=", "-", "1", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_read", "after", "CMD", "0x", "%", "x", ":", "failed", "\\", "n", "\"", ",", "READ_HARD_CFG", ")", ";", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "if", "(", "(", "hard_cfg", "[", "1", "]", "=", "aedsp16_read", "(", "port", ")", ")", "=", "=", "-", "1", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_read", "after", "CMD", "0x", "%", "x", ":", "failed", "\\", "n", "\"", ",", "READ_HARD_CFG", ")", ";", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_read", "(", "port", ")", "=", "=", "-", "1", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_read", "after", "CMD", "0x", "%", "x", ":", "failed", "\\", "n", "\"", ",", "READ_HARD_CFG", ")", ";", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "static", "int", "__init", "aedsp16_ext_cfg_write", "(", "int", "port", ")", "{", "int", "extcfg", ",", "val", ";", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_66", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_66", ")", ";", "return", "FALSE", ";", "}", "extcfg", "=", "7", ";", "if", "(", "decoded_hcfg", ".", "cdrom", "!", "=", "2", ")", "extcfg", "=", "0x0F", ";", "if", "(", "(", "decoded_hcfg", ".", "cdrom", "=", "=", "4", ")", "|", "|", "(", "decoded_hcfg", ".", "cdrom", "=", "=", "3", ")", ")", "extcfg", "&", "=", "~", "2", ";", "if", "(", "decoded_hcfg", ".", "cdrombase", "=", "=", "0", ")", "extcfg", "&", "=", "~", "2", ";", "if", "(", "decoded_hcfg", ".", "mpubase", "=", "=", "0", ")", "extcfg", "&", "=", "~", "1", ";", "if", "(", "aedsp16_write", "(", "port", ",", "extcfg", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "Write", "extcfg", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "0", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "Write", "extcfg", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "if", "(", "decoded_hcfg", ".", "cdrom", "=", "=", "3", ")", "{", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_52", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_52", ")", ";", "return", "FALSE", ";", "}", "if", "(", "(", "val", "=", "aedsp16_read", "(", "port", ")", ")", "=", "=", "-", "1", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_read", "after", "CMD", "0x", "%", "x", ":", "failed", "\\", "n", "\"", ",", "COMMAND_52", ")", ";", "return", "FALSE", ";", "}", "val", "&", "=", "0x7F", ";", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_60", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_60", ")", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "val", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "Write", "val", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "}", "return", "TRUE", ";", "}", "#", "endif", "/", "*", "CONFIG_SC6600", "*", "/", "static", "int", "__init", "aedsp16_cfg_write", "(", "int", "port", ")", "{", "if", "(", "aedsp16_write", "(", "port", ",", "WRITE_MDIRQ_CFG", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "WRITE_MDIRQ_CFG", ")", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "soft_cfg", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "Initialization", "of", "(", "M", ")", "IRQ", "and", "DMA", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "return", "TRUE", ";", "}", "static", "int", "__init", "aedsp16_init_mss", "(", "int", "port", ")", "{", "DBG", "(", "(\"", "aedsp16_init_mss", ":", "\\", "n", "\"", "))", ";", "mdelay", "(", "10", ")", ";", "if", "(", "aedsp16_write", "(", "port", ",", "DSP_INIT_MSS", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_init_mss", "[", "0x", "%", "x", "]", ":", "failed", "!", "\\", "n", "\"", ",", "DSP_INIT_MSS", ")", ";", "DBG", "(", "(\"", "failure", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "mdelay", "(", "10", ")", ";", "if", "(", "aedsp16_cfg_write", "(", "port", ")", "=", "=", "FALSE", ")", "return", "FALSE", ";", "outb", "(", "soft_cfg_mss", ",", "ae_config", ".", "mss_base", ")", ";", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "static", "int", "__init", "aedsp16_setup_board", "(", "int", "port", ")", "{", "int", "loop", "=", "RETRY", ";", "#", "if", "defined", "(", "CONFIG_SC6600", ")", "int", "val", "=", "0", ";", "if", "(", "aedsp16_hard_read", "(", "port", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_hard_read", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_52", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_52", ")", ";", "return", "FALSE", ";", "}", "if", "(", "(", "val", "=", "aedsp16_read", "(", "port", ")", ")", "=", "=", "-", "1", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_read", "after", "CMD", "0x", "%", "x", ":", "failed", "\\", "n", "\"", ",", "COMMAND_52", ")", ";", "return", "FALSE", ";", "}", "#", "endif", "do", "{", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_88", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_88", ")", ";", "return", "FALSE", ";", "}", "mdelay", "(", "10", ")", ";", "}", "while", "(", "(", "aedsp16_wait_data", "(", "port", ")", "=", "=", "FALSE", ")", "&", "&", "loop", "-", "-)", ";", "if", "(", "aedsp16_read", "(", "port", ")", "=", "=", "-", "1", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_read", "after", "CMD", "0x", "%", "x", ":", "failed", "\\", "n", "\"", ",", "COMMAND_88", ")", ";", "return", "FALSE", ";", "}", "#", "if", "!", "defined", "(", "CONFIG_SC6600", ")", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_5C", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_5C", ")", ";", "return", "FALSE", ";", "}", "#", "endif", "if", "(", "aedsp16_cfg_write", "(", "port", ")", "=", "=", "FALSE", ")", "return", "FALSE", ";", "#", "if", "defined", "(", "CONFIG_SC6600", ")", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_60", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_60", ")", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "val", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "DATA", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "val", ")", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_6E", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_6E", ")", ";", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "ver", "[", "0", "]", "))", "{", "printk", "(", "\"[", "AEDSP16", "]", "DATA", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "ver", "[", "0", "]", ");", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "ver", "[", "1", "]", "))", "{", "printk", "(", "\"[", "AEDSP16", "]", "DATA", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "ver", "[", "1", "]", ");", "return", "FALSE", ";", "}", "if", "(", "aedsp16_hard_write", "(", "port", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_hard_write", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "if", "(", "aedsp16_write", "(", "port", ",", "COMMAND_5C", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "COMMAND_5C", ")", ";", "return", "FALSE", ";", "}", "#", "if", "defined", "(", "THIS_IS_A_THING_I_HAVE_NOT_TESTED_YET", ")", "if", "(", "aedsp16_cfg_write", "(", "port", ")", "=", "=", "FALSE", ")", "return", "FALSE", ";", "#", "endif", "#", "endif", "return", "TRUE", ";", "}", "static", "int", "__init", "aedsp16_stdcfg", "(", "int", "port", ")", "{", "if", "(", "aedsp16_write", "(", "port", ",", "WRITE_MDIRQ_CFG", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "WRITE_MDIRQ_CFG", ")", ";", "return", "FALSE", ";", "}", "/", "*", "*", "0x0A", "=", "=", "(", "IRQ", "7", ",", "DMA", "1", ",", "MIRQ", "0", ")", "*", "/", "if", "(", "aedsp16_write", "(", "port", ",", "0x0A", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_stdcfg", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "return", "TRUE", ";", "}", "static", "int", "__init", "aedsp16_dsp_version", "(", "int", "port", ")", "{", "int", "len", "=", "0", ";", "int", "ret", ";", "DBG", "(", "(\"", "Get", "DSP", "Version", ":", "\\", "n", "\"", "))", ";", "if", "(", "aedsp16_write", "(", "ae_config", ".", "base_io", ",", "GET_DSP_VERSION", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "GET_DSP_VERSION", ")", ";", "DBG", "(", "(\"", "failed", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "do", "{", "if", "(", "(", "ret", "=", "aedsp16_read", "(", "port", ")", ")", "=", "=", "-", "1", ")", "{", "DBG", "(", "(\"", "failed", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "/", "*", "*", "We", "already", "know", "how", "many", "int", "are", "stored", "(", "2", ")", ",", "so", "we", "know", "when", "the", "*", "string", "is", "finished", ".", "*", "/", "ver", "[", "len", "+", "+]", "=", "ret", ";", "}", "while", "(", "len", "<", "CARDVERDIGITS", ")", ";", "sprintf", "(", "DSPVersion", ",", "\"", "%", "d", ".", "%", "d", "\"", ",", "ver", "[", "0", "]", ",", "ver", "[", "1", "]", ");", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "static", "int", "__init", "aedsp16_dsp_copyright", "(", "int", "port", ")", "{", "int", "len", "=", "0", ";", "int", "ret", ";", "DBG", "(", "(\"", "Get", "DSP", "Copyright", ":", "\\", "n", "\"", "))", ";", "if", "(", "aedsp16_write", "(", "ae_config", ".", "base_io", ",", "GET_DSP_COPYRIGHT", ")", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "CMD", "0x", "%", "x", ":", "failed", "!", "\\", "n", "\"", ",", "GET_DSP_COPYRIGHT", ")", ";", "DBG", "(", "(\"", "failed", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "do", "{", "if", "(", "(", "ret", "=", "aedsp16_read", "(", "port", ")", ")", "=", "=", "-", "1", ")", "{", "/", "*", "*", "If", "no", "more", "data", "available", ",", "return", "to", "the", "caller", ",", "no", "error", "if", "len", ">", "0", ".", "*", "We", "have", "no", "other", "way", "to", "know", "when", "the", "string", "is", "finished", ".", "*", "/", "if", "(", "len", ")", "break", ";", "else", "{", "DBG", "(", "(\"", "failed", ".", "\\", "n", "\"", "))", ";", "return", "FALSE", ";", "}", "}", "DSPCopyright", "[", "len", "+", "+]", "=", "ret", ";", "}", "while", "(", "len", "<", "CARDNAMELEN", ")", ";", "DBG", "(", "(\"", "success", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "static", "void", "__init", "aedsp16_init_tables", "(", "void", ")", "{", "int", "i", "=", "0", ";", "memset", "(", "DSPCopyright", ",", "0", ",", "CARDNAMELEN", "+", "1", ")", ";", "memset", "(", "DSPVersion", ",", "0", ",", "CARDVERLEN", "+", "1", ")", ";", "for", "(", "i", "=", "0", ";", "orIRQ", "[", "i", "]", ".", "or", ";", "i", "+", "+)", "if", "(", "orIRQ", "[", "i", "]", ".", "val", "=", "=", "ae_config", ".", "irq", ")", "{", "soft_cfg", "|", "=", "orIRQ", "[", "i", "]", ".", "or", ";", "soft_cfg_mss", "|", "=", "orIRQ", "[", "i", "]", ".", "or", ";", "}", "for", "(", "i", "=", "0", ";", "orMIRQ", "[", "i", "]", ".", "or", ";", "i", "+", "+)", "if", "(", "orMIRQ", "[", "i", "]", ".", "or", "=", "=", "ae_config", ".", "mpu_irq", ")", "soft_cfg", "|", "=", "orMIRQ", "[", "i", "]", ".", "or", ";", "for", "(", "i", "=", "0", ";", "orDMA", "[", "i", "]", ".", "or", ";", "i", "+", "+)", "if", "(", "orDMA", "[", "i", "]", ".", "val", "=", "=", "ae_config", ".", "dma", ")", "{", "soft_cfg", "|", "=", "orDMA", "[", "i", "]", ".", "or", ";", "soft_cfg_mss", "|", "=", "orDMA", "[", "i", "]", ".", "or", ";", "}", "}", "static", "int", "__init", "aedsp16_init_board", "(", "void", ")", "{", "aedsp16_init_tables", "(", ");", "if", "(", "aedsp16_dsp_reset", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_dsp_reset", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "if", "(", "aedsp16_dsp_copyright", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_dsp_copyright", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "/", "*", "*", "My", "AEDSP16", "card", "return", "SC", "-", "6000", "in", "DSPCopyright", ",", "so", "*", "if", "we", "have", "something", "different", ",", "we", "have", "to", "be", "warned", ".", "*", "/", "if", "(", "strcmp", "(", "\"", "SC", "-", "6000", "\"", ",", "DSPCopyright", ")", ")", "printk", "(", "\"[", "AEDSP16", "]", "Warning", ":", "non", "SC", "-", "6000", "audio", "card", "!", "\\", "n", "\"", ");", "if", "(", "aedsp16_dsp_version", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_dsp_version", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "if", "(", "aedsp16_stdcfg", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_stdcfg", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "#", "if", "defined", "(", "CONFIG_SC6600", ")", "if", "(", "aedsp16_hard_read", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_hard_read", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "aedsp16_hard_decode", "(", ");", "aedsp16_hard_encode", "(", ");", "if", "(", "aedsp16_hard_write", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_hard_write", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "if", "(", "aedsp16_ext_cfg_write", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_ext_cfg_write", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "#", "endif", "/", "*", "CONFIG_SC6600", "*", "/", "if", "(", "aedsp16_setup_board", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "aedsp16_setup_board", ":", "failed", "!", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "if", "(", "ae_config", ".", "mss_base", "!", "=", "-", "1", ")", "{", "if", "(", "ae_config", ".", "init", "&", "INIT_MSS", ")", "{", "if", "(", "aedsp16_init_mss", "(", "ae_config", ".", "base_io", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "\"[", "AEDSP16", "]", "Can", "not", "initialize", "\"", "\"", "Microsoft", "Sound", "System", "mode", ".", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "}", "}", "#", "if", "!", "defined", "(", "MODULE", ")", "|", "|", "defined", "(", "AEDSP16_INFO", ")", "|", "|", "defined", "(", "AEDSP16_DEBUG", ")", "printk", "(", "\"", "Audio", "Excel", "DSP", "16", "init", "v", "%", "s", "(", "%", "s", "%", "s", ")", "[", "\",", "VERSION", ",", "DSPCopyright", ",", "DSPVersion", ")", ";", "if", "(", "ae_config", ".", "mpu_base", "!", "=", "-", "1", ")", "{", "if", "(", "ae_config", ".", "init", "&", "INIT_MPU401", ")", "{", "printk", "(", "\"", "MPU401", "\"", ");", "if", "(", "(", "ae_config", ".", "init", "&", "INIT_MSS", ")", "|", "|", "(", "ae_config", ".", "init", "&", "INIT_SBPRO", ")", ")", "printk", "(", "\"", "\"", ");", "}", "}", "if", "(", "ae_config", ".", "mss_base", "=", "=", "-", "1", ")", "{", "if", "(", "ae_config", ".", "init", "&", "INIT_SBPRO", ")", "{", "printk", "(", "\"", "SBPro", "\"", ");", "if", "(", "ae_config", ".", "init", "&", "INIT_MSS", ")", "printk", "(", "\"", "\"", ");", "}", "}", "if", "(", "ae_config", ".", "mss_base", "!", "=", "-", "1", ")", "if", "(", "ae_config", ".", "init", "&", "INIT_MSS", ")", "printk", "(", "\"", "MSS", "\"", ");", "printk", "(", "\"]", "\\", "n", "\"", ");", "#", "endif", "/", "*", "MODULE", "|", "|", "AEDSP16_INFO", "|", "|", "AEDSP16_DEBUG", "*", "/", "mdelay", "(", "10", ")", ";", "return", "TRUE", ";", "}", "static", "int", "__init", "init_aedsp16_sb", "(", "void", ")", "{", "DBG", "(", "(\"", "init_aedsp16_sb", ":", "\"", "))", ";", "/", "*", "*", "If", "the", "card", "is", "already", "init", "'", "ed", "MSS", ",", "we", "can", "not", "init", "it", "to", "SBPRO", "too", "*", "because", "the", "board", "can", "not", "emulate", "simultaneously", "MSS", "and", "SBPRO", ".", "*", "/", "if", "(", "ae_config", ".", "init", "&", "INIT_MSS", ")", "return", "FALSE", ";", "if", "(", "ae_config", ".", "init", "&", "INIT_SBPRO", ")", "return", "FALSE", ";", "ae_config", ".", "init", "|", "=", "INIT_SBPRO", ";", "DBG", "(", "(\"", "done", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "static", "void", "uninit_aedsp16_sb", "(", "void", ")", "{", "DBG", "(", "(\"", "uninit_aedsp16_sb", ":", "\"", "))", ";", "ae_config", ".", "init", "&", "=", "~", "INIT_SBPRO", ";", "DBG", "(", "(\"", "done", ".", "\\", "n", "\"", "))", ";", "}", "static", "int", "__init", "init_aedsp16_mss", "(", "void", ")", "{", "DBG", "(", "(\"", "init_aedsp16_mss", ":", "\"", "))", ";", "/", "*", "*", "If", "the", "card", "is", "already", "init", "'", "ed", "SBPRO", ",", "we", "can", "not", "init", "it", "to", "MSS", "too", "*", "because", "the", "board", "can", "not", "emulate", "simultaneously", "MSS", "and", "SBPRO", ".", "*", "/", "if", "(", "ae_config", ".", "init", "&", "INIT_SBPRO", ")", "return", "FALSE", ";", "if", "(", "ae_config", ".", "init", "&", "INIT_MSS", ")", "return", "FALSE", ";", "/", "*", "*", "We", "must", "allocate", "the", "CONFIG_AEDSP16_BASE", "region", "too", "because", "these", "are", "the", "*", "I", "/", "O", "ports", "to", "access", "card", "'", "s", "control", "registers", ".", "*", "/", "if", "(", "!(", "ae_config", ".", "init", "&", "INIT_MPU401", ")", ")", "{", "if", "(", "!", "request_region", "(", "ae_config", ".", "base_io", ",", "IOBASE_REGION_SIZE", ",", "\"", "aedsp16", "(", "base", ")", "\")", ")", "{", "printk", "(", "\"", "AEDSP16", "BASE", "I", "/", "O", "port", "region", "is", "already", "in", "use", ".", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "}", "ae_config", ".", "init", "|", "=", "INIT_MSS", ";", "DBG", "(", "(\"", "done", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "static", "void", "uninit_aedsp16_mss", "(", "void", ")", "{", "DBG", "(", "(\"", "uninit_aedsp16_mss", ":", "\"", "))", ";", "if", "(", "(!", "(", "ae_config", ".", "init", "&", "INIT_MPU401", ")", ")", "&", "&", "(", "ae_config", ".", "init", "&", "INIT_MSS", ")", ")", "{", "release_region", "(", "ae_config", ".", "base_io", ",", "IOBASE_REGION_SIZE", ")", ";", "DBG", "(", "(\"", "AEDSP16", "base", "region", "released", ".", "\\", "n", "\"", "))", ";", "}", "ae_config", ".", "init", "&", "=", "~", "INIT_MSS", ";", "DBG", "(", "(\"", "done", ".", "\\", "n", "\"", "))", ";", "}", "static", "int", "__init", "init_aedsp16_mpu", "(", "void", ")", "{", "DBG", "(", "(\"", "init_aedsp16_mpu", ":", "\"", "))", ";", "if", "(", "ae_config", ".", "init", "&", "INIT_MPU401", ")", "return", "FALSE", ";", "/", "*", "*", "We", "must", "request", "the", "CONFIG_AEDSP16_BASE", "region", "too", "because", "these", "are", "the", "I", "/", "O", "*", "ports", "to", "access", "card", "'", "s", "control", "registers", ".", "*", "/", "if", "(", "!(", "ae_config", ".", "init", "&", "(", "INIT_MSS", "|", "INIT_SBPRO", ")", "))", "{", "if", "(", "!", "request_region", "(", "ae_config", ".", "base_io", ",", "IOBASE_REGION_SIZE", ",", "\"", "aedsp16", "(", "base", ")", "\")", ")", "{", "printk", "(", "\"", "AEDSP16", "BASE", "I", "/", "O", "port", "region", "is", "already", "in", "use", ".", "\\", "n", "\"", ");", "return", "FALSE", ";", "}", "}", "ae_config", ".", "init", "|", "=", "INIT_MPU401", ";", "DBG", "(", "(\"", "done", ".", "\\", "n", "\"", "))", ";", "return", "TRUE", ";", "}", "static", "void", "uninit_aedsp16_mpu", "(", "void", ")", "{", "DBG", "(", "(\"", "uninit_aedsp16_mpu", ":", "\"", "))", ";", "if", "(", "(!", "(", "ae_config", ".", "init", "&", "(", "INIT_MSS", "|", "INIT_SBPRO", ")", "))", "&", "&", "(", "ae_config", ".", "init", "&", "INIT_MPU401", ")", ")", "{", "release_region", "(", "ae_config", ".", "base_io", ",", "IOBASE_REGION_SIZE", ")", ";", "DBG", "(", "(\"", "AEDSP16", "base", "region", "released", ".", "\\", "n", "\"", "))", ";", "}", "ae_config", ".", "init", "&", "=", "~", "INIT_MPU401", ";", "DBG", "(", "(\"", "done", ".", "\\", "n", "\"", "))", ";", "}", "static", "int", "__init", "init_aedsp16", "(", "void", ")", "{", "int", "initialized", "=", "FALSE", ";", "DBG", "(", "(\"", "Initializing", "BASE", "[", "0x", "%", "x", "]", "IRQ", "[", "%", "d", "]", "DMA", "[", "%", "d", "]", "MIRQ", "[", "%", "d", "]", "\\", "n", "\"", ",", "ae_config", ".", "base_io", ",", "ae_config", ".", "irq", ",", "ae_config", ".", "dma", ",", "ae_config", ".", "mpu_irq", ")", ");", "if", "(", "ae_config", ".", "mss_base", "=", "=", "-", "1", ")", "{", "if", "(", "init_aedsp16_sb", "(", ")", "=", "=", "FALSE", ")", "{", "uninit_aedsp16_sb", "(", ");", "}", "else", "{", "initialized", "=", "TRUE", ";", "}", "}", "if", "(", "ae_config", ".", "mpu_base", "!", "=", "-", "1", ")", "{", "if", "(", "init_aedsp16_mpu", "(", ")", "=", "=", "FALSE", ")", "{", "uninit_aedsp16_mpu", "(", ");", "}", "else", "{", "initialized", "=", "TRUE", ";", "}", "}", "/", "*", "*", "In", "the", "sequence", "of", "init", "routines", ",", "the", "MSS", "init", "MUST", "be", "the", "last", "!", "*", "This", "because", "of", "the", "special", "register", "programming", "the", "MSS", "mode", "needs", ".", "*", "A", "board", "reset", "would", "disable", "the", "MSS", "mode", "restoring", "the", "default", "SBPRO", "*", "mode", ".", "*", "/", "if", "(", "ae_config", ".", "mss_base", "!", "=", "-", "1", ")", "{", "if", "(", "init_aedsp16_mss", "(", ")", "=", "=", "FALSE", ")", "{", "uninit_aedsp16_mss", "(", ");", "}", "else", "{", "initialized", "=", "TRUE", ";", "}", "}", "if", "(", "initialized", ")", "initialized", "=", "aedsp16_init_board", "(", ");", "return", "initialized", ";", "}", "static", "void", "__exit", "uninit_aedsp16", "(", "void", ")", "{", "if", "(", "ae_config", ".", "mss_base", "!", "=", "-", "1", ")", "uninit_aedsp16_mss", "(", ");", "else", "uninit_aedsp16_sb", "(", ");", "if", "(", "ae_config", ".", "mpu_base", "!", "=", "-", "1", ")", "uninit_aedsp16_mpu", "(", ");", "}", "static", "int", "__initdata", "io", "=", "-", "1", ";", "static", "int", "__initdata", "irq", "=", "-", "1", ";", "static", "int", "__initdata", "dma", "=", "-", "1", ";", "static", "int", "__initdata", "mpu_irq", "=", "-", "1", ";", "static", "int", "__initdata", "mss_base", "=", "-", "1", ";", "static", "int", "__initdata", "mpu_base", "=", "-", "1", ";", "module_param_hw", "(", "io", ",", "int", ",", "ioport", ",", "0", ")", ";", "MODULE_PARM_DESC", "(", "io", ",", "\"", "I", "/", "O", "base", "address", "(", "0x220", "0x240", ")", "\")", ";", "module_param_hw", "(", "irq", ",", "int", ",", "irq", ",", "0", ")", ";", "MODULE_PARM_DESC", "(", "irq", ",", "\"", "IRQ", "line", "(", "5", "7", "9", "10", "11", ")", "\")", ";", "module_param_hw", "(", "dma", ",", "int", ",", "dma", ",", "0", ")", ";", "MODULE_PARM_DESC", "(", "dma", ",", "\"", "dma", "line", "(", "0", "1", "3", ")", "\")", ";", "module_param_hw", "(", "mpu_irq", ",", "int", ",", "irq", ",", "0", ")", ";", "MODULE_PARM_DESC", "(", "mpu_irq", ",", "\"", "MPU", "-", "401", "IRQ", "line", "(", "5", "7", "9", "10", "0", ")", "\")", ";", "module_param_hw", "(", "mss_base", ",", "int", ",", "ioport", ",", "0", ")", ";", "MODULE_PARM_DESC", "(", "mss_base", ",", "\"", "MSS", "emulation", "I", "/", "O", "base", "address", "(", "0x530", "0xE80", ")", "\")", ";", "module_param_hw", "(", "mpu_base", ",", "int", ",", "ioport", ",", "0", ")", ";", "MODULE_PARM_DESC", "(", "mpu_base", ",", "\"", "MPU", "-", "401", "I", "/", "O", "base", "address", "(", "0x300", "0x310", "0x320", "0x330", ")", "\")", ";", "MODULE_AUTHOR", "(", "\"", "Riccardo", "Facchetti", "<", "fizban", "@", "tin", ".", "it", ">", "\")", ";", "MODULE_DESCRIPTION", "(", "\"", "Audio", "Excel", "DSP", "16", "Driver", "Version", "\"", "VERSION", ")", ";", "MODULE_LICENSE", "(", "\"", "GPL", "\"", ");", "static", "int", "__init", "do_init_aedsp16", "(", "void", ")", "{", "printk", "(", "\"", "Audio", "Excel", "DSP", "16", "init", "driver", "Copyright", "(", "C", ")", "Riccardo", "Facchetti", "1995", "-", "98", "\\", "n", "\"", ");", "if", "(", "io", "=", "=", "-", "1", "|", "|", "dma", "=", "=", "-", "1", "|", "|", "irq", "=", "=", "-", "1", ")", "{", "printk", "(", "KERN_INFO", "\"", "aedsp16", ":", "I", "/", "O", ",", "IRQ", "and", "DMA", "are", "mandatory", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "ae_config", ".", "base_io", "=", "io", ";", "ae_config", ".", "irq", "=", "irq", ";", "ae_config", ".", "dma", "=", "dma", ";", "ae_config", ".", "mss_base", "=", "mss_base", ";", "ae_config", ".", "mpu_base", "=", "mpu_base", ";", "ae_config", ".", "mpu_irq", "=", "mpu_irq", ";", "if", "(", "init_aedsp16", "(", ")", "=", "=", "FALSE", ")", "{", "printk", "(", "KERN_ERR", "\"", "aedsp16", ":", "initialization", "failed", "\\", "n", "\"", ");", "/", "*", "*", "XXX", "*", "What", "error", "should", "we", "return", "here", "?", "*", "/", "return", "-", "EINVAL", ";", "}", "return", "0", ";", "}", "static", "void", "__exit", "cleanup_aedsp16", "(", "void", ")", "{", "uninit_aedsp16", "(", ");", "}", "module_init", "(", "do_init_aedsp16", ")", ";", "module_exit", "(", "cleanup_aedsp16", ")", ";", "#", "ifndef", "MODULE", "static", "int", "__init", "setup_aedsp16", "(", "char", "*", "str", ")", "{", "/", "*", "io", ",", "irq", ",", "dma", ",", "mss_io", ",", "mpu_io", ",", "mpu_irq", "*", "/", "int", "ints", "[", "7", "]", ";", "str", "=", "get_options", "(", "str", ",", "ARRAY_SIZE", "(", "ints", ")", ",", "ints", ")", ";", "io", "=", "ints", "[", "1", "]", ";", "irq", "=", "ints", "[", "2", "]", ";", "dma", "=", "ints", "[", "3", "]", ";", "mss_base", "=", "ints", "[", "4", "]", ";", "mpu_base", "=", "ints", "[", "5", "]", ";", "mpu_irq", "=", "ints", "[", "6", "]", ";", "return", "1", ";", "}", "__setup", "(", "\"", "aedsp16", "=", "\",", "setup_aedsp16", ")", ";", "#", "endif", "@", "@", "-", "1", ",", "985", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "audio", ".", "c", "*", "*", "Device", "file", "manager", "for", "/", "dev", "/", "audio", "*", "/", "/", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "/", "/", "*", "*", "Thomas", "Sailer", ":", "ioctl", "code", "reworked", "(", "vmalloc", "/", "vfree", "removed", ")", "*", "Thomas", "Sailer", ":", "moved", "several", "static", "variables", "into", "struct", "audio_operations", "*", "(", "which", "is", "grossly", "misnamed", "btw", ".", ")", "because", "they", "have", "the", "same", "*", "lifetime", "as", "the", "rest", "in", "there", "and", "dynamic", "allocation", "saves", "*", "12k", "or", "so", "*", "Thomas", "Sailer", ":", "use", "more", "logical", "O_NONBLOCK", "semantics", "*", "Daniel", "Rodriksson", ":", "reworked", "the", "use", "of", "the", "device", "specific", "copy_user", "*", "still", "generic", "*", "Horst", "von", "Brand", ":", "Add", "missing", "#", "include", "<", "linux", "/", "string", ".", "h", ">", "*", "Chris", "Rankin", ":", "Update", "the", "module", "-", "usage", "counter", "for", "the", "coprocessor", ",", "*", "and", "decrement", "the", "counters", "again", "if", "we", "cannot", "open", "*", "the", "audio", "device", ".", "*", "/", "#", "include", "<", "linux", "/", "stddef", ".", "h", ">", "#", "include", "<", "linux", "/", "string", ".", "h", ">", "#", "include", "<", "linux", "/", "kmod", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "ulaw", ".", "h", "\"", "#", "include", "\"", "coproc", ".", "h", "\"", "#", "define", "NEUTRAL8", "0x80", "#", "define", "NEUTRAL16", "0x00", "static", "int", "dma_ioctl", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", ";", "static", "int", "set_format", "(", "int", "dev", ",", "int", "fmt", ")", "{", "if", "(", "fmt", "!", "=", "AFMT_QUERY", ")", "{", "audio_devs", "[", "dev", "]", "->", "local_conversion", "=", "0", ";", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "format_mask", "&", "fmt", ")", ")", "/", "*", "Not", "supported", "*", "/", "{", "if", "(", "fmt", "=", "=", "AFMT_MU_LAW", ")", "{", "fmt", "=", "AFMT_U8", ";", "audio_devs", "[", "dev", "]", "->", "local_conversion", "=", "CNV_MU_LAW", ";", "}", "else", "fmt", "=", "AFMT_U8", ";", "/", "*", "This", "is", "always", "supported", "*", "/", "}", "audio_devs", "[", "dev", "]", "->", "audio_format", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "set_bits", "(", "dev", ",", "fmt", ")", ";", "audio_devs", "[", "dev", "]", "->", "local_format", "=", "fmt", ";", "}", "else", "return", "audio_devs", "[", "dev", "]", "->", "local_format", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "local_conversion", ")", "return", "audio_devs", "[", "dev", "]", "->", "local_conversion", ";", "else", "return", "audio_devs", "[", "dev", "]", "->", "local_format", ";", "}", "int", "audio_open", "(", "int", "dev", ",", "struct", "file", "*", "file", ")", "{", "int", "ret", ";", "int", "bits", ";", "int", "dev_type", "=", "dev", "&", "0x0f", ";", "int", "mode", "=", "translate_mode", "(", "file", ")", ";", "const", "struct", "audio_driver", "*", "driver", ";", "const", "struct", "coproc_operations", "*", "coprocessor", ";", "dev", "=", "dev", ">", ">", "4", ";", "if", "(", "dev_type", "=", "=", "SND_DEV_DSP16", ")", "bits", "=", "16", ";", "else", "bits", "=", "8", ";", "if", "(", "dev", "<", "0", "|", "|", "dev", ">", "=", "num_audiodevs", ")", "return", "-", "ENXIO", ";", "driver", "=", "audio_devs", "[", "dev", "]", "->", "d", ";", "if", "(", "!", "try_module_get", "(", "driver", "-", ">", "owner", ")", ")", "return", "-", "ENODEV", ";", "if", "(", "(", "ret", "=", "DMAbuf_open", "(", "dev", ",", "mode", ")", ")", "<", "0", ")", "goto", "error_1", ";", "if", "(", "(", "coprocessor", "=", "audio_devs", "[", "dev", "]", "->", "coproc", ")", "!", "=", "NULL", ")", "{", "if", "(", "!", "try_module_get", "(", "coprocessor", "-", ">", "owner", ")", ")", "goto", "error_2", ";", "if", "(", "(", "ret", "=", "coprocessor", "-", ">", "open", "(", "coprocessor", "-", ">", "devc", ",", "COPR_PCM", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "Sound", ":", "Can", "'", "t", "access", "coprocessor", "device", "\\", "n", "\"", ");", "goto", "error_3", ";", "}", "}", "audio_devs", "[", "dev", "]", "->", "local_conversion", "=", "0", ";", "if", "(", "dev_type", "=", "=", "SND_DEV_AUDIO", ")", "set_format", "(", "dev", ",", "AFMT_MU_LAW", ")", ";", "else", "set_format", "(", "dev", ",", "bits", ")", ";", "audio_devs", "[", "dev", "]", "->", "audio_mode", "=", "AM_NONE", ";", "return", "0", ";", "/", "*", "*", "Clean", "-", "up", "stack", ":", "this", "is", "what", "needs", "(", "un", ")", "doing", "if", "*", "we", "can", "'", "t", "open", "the", "audio", "device", ".", "..", "*", "/", "error_3", ":", "module_put", "(", "coprocessor", "-", ">", "owner", ")", ";", "error_2", ":", "DMAbuf_release", "(", "dev", ",", "mode", ")", ";", "error_1", ":", "module_put", "(", "driver", "-", ">", "owner", ")", ";", "return", "ret", ";", "}", "static", "void", "sync_output", "(", "int", "dev", ")", "{", "int", "p", ",", "i", ";", "int", "l", ";", "struct", "dma_buffparms", "*", "dmap", "=", "audio_devs", "[", "dev", "]", "->", "dmap_out", ";", "if", "(", "dmap", "-", ">", "fragment_size", "<", "=", "0", ")", "return", ";", "dmap", "-", ">", "flags", "|", "=", "DMA_POST", ";", "/", "*", "Align", "the", "write", "pointer", "with", "fragment", "boundaries", "*", "/", "if", "(", "(", "l", "=", "dmap", "-", ">", "user_counter", "%", "dmap", "-", ">", "fragment_size", ")", ">", "0", ")", "{", "int", "len", ";", "unsigned", "long", "offs", "=", "dmap", "-", ">", "user_counter", "%", "dmap", "-", ">", "bytes_in_use", ";", "len", "=", "dmap", "-", ">", "fragment_size", "-", "l", ";", "memset", "(", "dmap", "-", ">", "raw_buf", "+", "offs", ",", "dmap", "-", ">", "neutral_byte", ",", "len", ")", ";", "DMAbuf_move_wrpointer", "(", "dev", ",", "len", ")", ";", "}", "/", "*", "*", "Clean", "all", "unused", "buffer", "fragments", ".", "*", "/", "p", "=", "dmap", "-", ">", "qtail", ";", "dmap", "-", ">", "flags", "|", "=", "DMA_POST", ";", "for", "(", "i", "=", "dmap", "-", ">", "qlen", "+", "1", ";", "i", "<", "dmap", "-", ">", "nbufs", ";", "i", "+", "+)", "{", "p", "=", "(", "p", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "if", "(", "((", "dmap", "-", ">", "raw_buf", "+", "p", "*", "dmap", "-", ">", "fragment_size", ")", "+", "dmap", "-", ">", "fragment_size", ")", ">", "(", "dmap", "-", ">", "raw_buf", "+", "dmap", "-", ">", "buffsize", ")", ")", "printk", "(", "KERN_ERR", "\"", "audio", ":", "Buffer", "error", "2", "\\", "n", "\"", ");", "memset", "(", "dmap", "-", ">", "raw_buf", "+", "p", "*", "dmap", "-", ">", "fragment_size", ",", "dmap", "-", ">", "neutral_byte", ",", "dmap", "-", ">", "fragment_size", ")", ";", "}", "dmap", "-", ">", "flags", "|", "=", "DMA_DIRTY", ";", "}", "void", "audio_release", "(", "int", "dev", ",", "struct", "file", "*", "file", ")", "{", "const", "struct", "coproc_operations", "*", "coprocessor", ";", "int", "mode", "=", "translate_mode", "(", "file", ")", ";", "dev", "=", "dev", ">", ">", "4", ";", "/", "*", "*", "We", "do", "this", "in", "DMAbuf_release", "(", ").", "Why", "are", "we", "doing", "it", "*", "here", "?", "Why", "don", "'", "t", "we", "test", "the", "file", "mode", "before", "setting", "*", "both", "flags", "?", "DMAbuf_release", "(", ")", "does", ".", "*", ".", "..", "pester", ".", "..", "pester", ".", "..", "pester", ".", "..", "*", "/", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "closing", "=", "1", ";", "audio_devs", "[", "dev", "]", "->", "dmap_in", "-", ">", "closing", "=", "1", ";", "/", "*", "*", "We", "need", "to", "make", "sure", "we", "allocated", "the", "dmap_out", "buffer", "*", "before", "we", "go", "mucking", "around", "with", "it", "in", "sync_output", "(", ").", "*", "/", "if", "(", "mode", "&", "OPEN_WRITE", ")", "sync_output", "(", "dev", ")", ";", "if", "(", "(", "coprocessor", "=", "audio_devs", "[", "dev", "]", "->", "coproc", ")", "!", "=", "NULL", ")", "{", "coprocessor", "-", ">", "close", "(", "coprocessor", "-", ">", "devc", ",", "COPR_PCM", ")", ";", "module_put", "(", "coprocessor", "-", ">", "owner", ")", ";", "}", "DMAbuf_release", "(", "dev", ",", "mode", ")", ";", "module_put", "(", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "owner", ")", ";", "}", "static", "void", "translate_bytes", "(", "const", "unsigned", "char", "*", "table", ",", "unsigned", "char", "*", "buff", ",", "int", "n", ")", "{", "unsigned", "long", "i", ";", "if", "(", "n", "<", "=", "0", ")", "return", ";", "for", "(", "i", "=", "0", ";", "i", "<", "n", ";", "+", "+", "i", ")", "buff", "[", "i", "]", "=", "table", "[", "buff", "[", "i", "]", "];", "}", "int", "audio_write", "(", "int", "dev", ",", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "int", "count", ")", "{", "int", "c", ",", "p", ",", "l", ",", "buf_size", ",", "used", ",", "returned", ";", "int", "err", ";", "char", "*", "dma_buf", ";", "dev", "=", "dev", ">", ">", "4", ";", "p", "=", "0", ";", "c", "=", "count", ";", "if", "(", "count", "<", "0", ")", "return", "-", "EINVAL", ";", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "-", "EPERM", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", ")", "audio_devs", "[", "dev", "]", "->", "audio_mode", "|", "=", "AM_WRITE", ";", "else", "audio_devs", "[", "dev", "]", "->", "audio_mode", "=", "AM_WRITE", ";", "if", "(", "!", "count", ")", "/", "*", "Flush", "output", "*", "/", "{", "sync_output", "(", "dev", ")", ";", "return", "0", ";", "}", "while", "(", "c", ")", "{", "if", "(", "(", "err", "=", "DMAbuf_getwrbuffer", "(", "dev", ",", "&", "dma_buf", ",", "&", "buf_size", ",", "!", "!(", "file", "-", ">", "f_flags", "&", "O_NONBLOCK", ")", "))", "<", "0", ")", "{", "/", "*", "Handle", "nonblocking", "mode", "*", "/", "if", "(", "(", "file", "-", ">", "f_flags", "&", "O_NONBLOCK", ")", "&", "&", "err", "=", "=", "-", "EAGAIN", ")", "return", "p", "?", "p", ":", "-", "EAGAIN", ";", "/", "*", "No", "more", "space", ".", "Return", "#", "of", "accepted", "bytes", "*", "/", "return", "err", ";", "}", "l", "=", "c", ";", "if", "(", "l", ">", "buf_size", ")", "l", "=", "buf_size", ";", "returned", "=", "l", ";", "used", "=", "l", ";", "if", "(", "!", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "copy_user", ")", "{", "if", "(", "(", "dma_buf", "+", "l", ")", ">", "(", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "raw_buf", "+", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "buffsize", ")", ")", "{", "printk", "(", "KERN_ERR", "\"", "audio", ":", "Buffer", "error", "3", "(", "%", "lx", ",", "%", "d", ")", ",", "(", "%", "lx", ",", "%", "d", ")", "\\", "n", "\"", ",", "(", "long", ")", "dma_buf", ",", "l", ",", "(", "long", ")", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "raw_buf", ",", "(", "int", ")", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "buffsize", ")", ";", "return", "-", "EDOM", ";", "}", "if", "(", "dma_buf", "<", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "raw_buf", ")", "{", "printk", "(", "KERN_ERR", "\"", "audio", ":", "Buffer", "error", "13", "(", "%", "lx", "<", "%", "lx", ")", "\\", "n", "\"", ",", "(", "long", ")", "dma_buf", ",", "(", "long", ")", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "raw_buf", ")", ";", "return", "-", "EDOM", ";", "}", "if", "(", "copy_from_user", "(", "dma_buf", ",", "&", "(", "buf", ")", "[", "p", "]", ",", "l", ")", ")", "return", "-", "EFAULT", ";", "}", "else", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "copy_user", "(", "dev", ",", "dma_buf", ",", "0", ",", "buf", ",", "p", ",", "c", ",", "buf_size", ",", "&", "used", ",", "&", "returned", ",", "l", ")", ";", "l", "=", "returned", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "local_conversion", "&", "CNV_MU_LAW", ")", "{", "translate_bytes", "(", "ulaw_dsp", ",", "(", "unsigned", "char", "*", ")", "dma_buf", ",", "l", ")", ";", "}", "c", "-", "=", "used", ";", "p", "+", "=", "used", ";", "DMAbuf_move_wrpointer", "(", "dev", ",", "l", ")", ";", "}", "return", "count", ";", "}", "int", "audio_read", "(", "int", "dev", ",", "struct", "file", "*", "file", ",", "char", "__user", "*", "buf", ",", "int", "count", ")", "{", "int", "c", ",", "p", ",", "l", ";", "char", "*", "dmabuf", ";", "int", "buf_no", ";", "dev", "=", "dev", ">", ">", "4", ";", "p", "=", "0", ";", "c", "=", "count", ";", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", ")", "return", "-", "EPERM", ";", "if", "(", "(", "audio_devs", "[", "dev", "]", "->", "audio_mode", "&", "AM_WRITE", ")", "&", "&", "!", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", ")", ")", "sync_output", "(", "dev", ")", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", ")", "audio_devs", "[", "dev", "]", "->", "audio_mode", "|", "=", "AM_READ", ";", "else", "audio_devs", "[", "dev", "]", "->", "audio_mode", "=", "AM_READ", ";", "while", "(", "c", ")", "{", "if", "(", "(", "buf_no", "=", "DMAbuf_getrdbuffer", "(", "dev", ",", "&", "dmabuf", ",", "&", "l", ",", "!", "!(", "file", "-", ">", "f_flags", "&", "O_NONBLOCK", ")", "))", "<", "0", ")", "{", "/", "*", "*", "Nonblocking", "mode", "handling", ".", "Return", "current", "#", "of", "bytes", "*", "/", "if", "(", "p", ">", "0", ")", "/", "*", "Avoid", "throwing", "away", "data", "*", "/", "return", "p", ";", "/", "*", "Return", "it", "instead", "*", "/", "if", "(", "(", "file", "-", ">", "f_flags", "&", "O_NONBLOCK", ")", "&", "&", "buf_no", "=", "=", "-", "EAGAIN", ")", "return", "-", "EAGAIN", ";", "return", "buf_no", ";", "}", "if", "(", "l", ">", "c", ")", "l", "=", "c", ";", "/", "*", "*", "Insert", "any", "local", "processing", "here", ".", "*", "/", "if", "(", "audio_devs", "[", "dev", "]", "->", "local_conversion", "&", "CNV_MU_LAW", ")", "{", "translate_bytes", "(", "dsp_ulaw", ",", "(", "unsigned", "char", "*", ")", "dmabuf", ",", "l", ")", ";", "}", "{", "char", "*", "fixit", "=", "dmabuf", ";", "if", "(", "copy_to_user", "(", "&(", "buf", ")", "[", "p", "]", ",", "fixit", ",", "l", ")", ")", "return", "-", "EFAULT", ";", "}", "DMAbuf_rmchars", "(", "dev", ",", "buf_no", ",", "l", ")", ";", "p", "+", "=", "l", ";", "c", "-", "=", "l", ";", "}", "return", "count", "-", "c", ";", "}", "int", "audio_ioctl", "(", "int", "dev", ",", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", "{", "int", "val", ",", "count", ";", "unsigned", "long", "flags", ";", "struct", "dma_buffparms", "*", "dmap", ";", "int", "__user", "*", "p", "=", "arg", ";", "dev", "=", "dev", ">", ">", "4", ";", "if", "(", "_IOC_TYPE", "(", "cmd", ")", "=", "=", "'", "C", "'", ")", "{", "if", "(", "audio_devs", "[", "dev", "]", "->", "coproc", ")", "/", "*", "Coprocessor", "ioctl", "*", "/", "return", "audio_devs", "[", "dev", "]", "->", "coproc", "-", ">", "ioctl", "(", "audio_devs", "[", "dev", "]", "->", "coproc", "-", ">", "devc", ",", "cmd", ",", "arg", ",", "0", ")", ";", "/", "*", "else", "printk", "(", "KERN_DEBUG", "\"", "/", "dev", "/", "dsp", "%", "d", ":", "No", "coprocessor", "for", "this", "device", "\\", "n", "\"", ",", "dev", ")", ";", "*", "/", "return", "-", "ENXIO", ";", "}", "else", "switch", "(", "cmd", ")", "{", "case", "SNDCTL_DSP_SYNC", ":", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "0", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "fragment_size", "=", "=", "0", ")", "return", "0", ";", "sync_output", "(", "dev", ")", ";", "DMAbuf_sync", "(", "dev", ")", ";", "DMAbuf_reset", "(", "dev", ")", ";", "return", "0", ";", "case", "SNDCTL_DSP_POST", ":", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "0", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "fragment_size", "=", "=", "0", ")", "return", "0", ";", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "flags", "|", "=", "DMA_POST", "|", "DMA_DIRTY", ";", "sync_output", "(", "dev", ")", ";", "dma_ioctl", "(", "dev", ",", "SNDCTL_DSP_POST", ",", "NULL", ")", ";", "return", "0", ";", "case", "SNDCTL_DSP_RESET", ":", "audio_devs", "[", "dev", "]", "->", "audio_mode", "=", "AM_NONE", ";", "DMAbuf_reset", "(", "dev", ")", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETFMTS", ":", "val", "=", "audio_devs", "[", "dev", "]", "->", "format_mask", "|", "AFMT_MU_LAW", ";", "break", ";", "case", "SNDCTL_DSP_SETFMT", ":", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "val", "=", "set_format", "(", "dev", ",", "val", ")", ";", "break", ";", "case", "SNDCTL_DSP_GETISPACE", ":", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", ")", "return", "0", ";", "if", "(", "(", "audio_devs", "[", "dev", "]", "->", "audio_mode", "&", "AM_WRITE", ")", "&", "&", "!", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", ")", ")", "return", "-", "EBUSY", ";", "return", "dma_ioctl", "(", "dev", ",", "cmd", ",", "arg", ")", ";", "case", "SNDCTL_DSP_GETOSPACE", ":", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "-", "EPERM", ";", "if", "(", "(", "audio_devs", "[", "dev", "]", "->", "audio_mode", "&", "AM_READ", ")", "&", "&", "!", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", ")", ")", "return", "-", "EBUSY", ";", "return", "dma_ioctl", "(", "dev", ",", "cmd", ",", "arg", ")", ";", "case", "SNDCTL_DSP_NONBLOCK", ":", "spin_lock", "(", "&", "file", "-", ">", "f_lock", ")", ";", "file", "-", ">", "f_flags", "|", "=", "O_NONBLOCK", ";", "spin_unlock", "(", "&", "file", "-", ">", "f_lock", ")", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETCAPS", ":", "val", "=", "1", "|", "DSP_CAP_MMAP", ";", "/", "*", "Revision", "level", "of", "this", "ioctl", "(", ")", "*", "/", "if", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", "&", "&", "audio_devs", "[", "dev", "]", "->", "open_mode", "=", "=", "OPEN_READWRITE", ")", "val", "|", "=", "DSP_CAP_DUPLEX", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "coproc", ")", "val", "|", "=", "DSP_CAP_COPROC", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "local_qlen", ")", "/", "*", "Device", "has", "hidden", "buffers", "*", "/", "val", "|", "=", "DSP_CAP_BATCH", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "trigger", ")", "/", "*", "Supports", "SETTRIGGER", "*", "/", "val", "|", "=", "DSP_CAP_TRIGGER", ";", "break", ";", "case", "SOUND_PCM_WRITE_RATE", ":", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "val", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "set_speed", "(", "dev", ",", "val", ")", ";", "break", ";", "case", "SOUND_PCM_READ_RATE", ":", "val", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "set_speed", "(", "dev", ",", "0", ")", ";", "break", ";", "case", "SNDCTL_DSP_STEREO", ":", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "val", ">", "1", "|", "|", "val", "<", "0", ")", "return", "-", "EINVAL", ";", "val", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "set_channels", "(", "dev", ",", "val", "+", "1", ")", "-", "1", ";", "break", ";", "case", "SOUND_PCM_WRITE_CHANNELS", ":", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "val", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "set_channels", "(", "dev", ",", "val", ")", ";", "break", ";", "case", "SOUND_PCM_READ_CHANNELS", ":", "val", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "set_channels", "(", "dev", ",", "0", ")", ";", "break", ";", "case", "SOUND_PCM_READ_BITS", ":", "val", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "set_bits", "(", "dev", ",", "0", ")", ";", "break", ";", "case", "SNDCTL_DSP_SETDUPLEX", ":", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "!", "=", "OPEN_READWRITE", ")", "return", "-", "EPERM", ";", "return", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", ")", "?", "0", ":", "-", "EIO", ";", "case", "SNDCTL_DSP_PROFILE", ":", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "applic_profile", "=", "val", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", "audio_devs", "[", "dev", "]", "->", "dmap_in", "-", ">", "applic_profile", "=", "val", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETODELAY", ":", "dmap", "=", "audio_devs", "[", "dev", "]", "->", "dmap_out", ";", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_ALLOC_DONE", ")", ")", "{", "val", "=", "0", ";", "break", ";", "}", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "/", "*", "Compute", "number", "of", "bytes", "that", "have", "been", "played", "*", "/", "count", "=", "DMAbuf_get_buffer_pointer", "(", "dev", ",", "dmap", ",", "DMODE_OUTPUT", ")", ";", "if", "(", "count", "<", "dmap", "-", ">", "fragment_size", "&", "&", "dmap", "-", ">", "qhead", "!", "=", "0", ")", "count", "+", "=", "dmap", "-", ">", "bytes_in_use", ";", "/", "*", "Pointer", "wrap", "not", "handled", "yet", "*", "/", "count", "+", "=", "dmap", "-", ">", "byte_counter", ";", "/", "*", "Subtract", "current", "count", "from", "the", "number", "of", "bytes", "written", "by", "app", "*", "/", "count", "=", "dmap", "-", ">", "user_counter", "-", "count", ";", "if", "(", "count", "<", "0", ")", "count", "=", "0", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "val", "=", "count", ";", "break", ";", "default", ":", "return", "dma_ioctl", "(", "dev", ",", "cmd", ",", "arg", ")", ";", "}", "return", "put_user", "(", "val", ",", "p", ")", ";", "}", "void", "audio_init_devices", "(", "void", ")", "{", "/", "*", "*", "NOTE", "!", "This", "routine", "could", "be", "called", "several", "times", "during", "boot", ".", "*", "/", "}", "void", "reorganize_buffers", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ",", "int", "recording", ")", "{", "/", "*", "*", "This", "routine", "breaks", "the", "physical", "device", "buffers", "to", "logical", "ones", ".", "*", "/", "struct", "audio_operations", "*", "dsp_dev", "=", "audio_devs", "[", "dev", "]", ";", "unsigned", "i", ",", "n", ";", "unsigned", "sr", ",", "nc", ",", "sz", ",", "bsz", ";", "sr", "=", "dsp_dev", "-", ">", "d", "-", ">", "set_speed", "(", "dev", ",", "0", ")", ";", "nc", "=", "dsp_dev", "-", ">", "d", "-", ">", "set_channels", "(", "dev", ",", "0", ")", ";", "sz", "=", "dsp_dev", "-", ">", "d", "-", ">", "set_bits", "(", "dev", ",", "0", ")", ";", "if", "(", "sz", "=", "=", "8", ")", "dmap", "-", ">", "neutral_byte", "=", "NEUTRAL8", ";", "else", "dmap", "-", ">", "neutral_byte", "=", "NEUTRAL16", ";", "if", "(", "sr", "<", "1", "|", "|", "nc", "<", "1", "|", "|", "sz", "<", "1", ")", "{", "/", "*", "printk", "(", "KERN_DEBUG", "\"", "Warning", ":", "Invalid", "PCM", "parameters", "[", "%", "d", "]", "sr", "=", "%", "d", ",", "nc", "=", "%", "d", ",", "sz", "=", "%", "d", "\\", "n", "\"", ",", "dev", ",", "sr", ",", "nc", ",", "sz", ")", ";*", "/", "sr", "=", "DSP_DEFAULT_SPEED", ";", "nc", "=", "1", ";", "sz", "=", "8", ";", "}", "sz", "=", "sr", "*", "nc", "*", "sz", ";", "sz", "/", "=", "8", ";", "/", "*", "#", "bits", "-", ">", "#", "bytes", "*", "/", "dmap", "-", ">", "data_rate", "=", "sz", ";", "if", "(", "!", "dmap", "-", ">", "needs_reorg", ")", "return", ";", "dmap", "-", ">", "needs_reorg", "=", "0", ";", "if", "(", "dmap", "-", ">", "fragment_size", "=", "=", "0", ")", "{", "/", "*", "Compute", "the", "fragment", "size", "using", "the", "default", "algorithm", "*", "/", "/", "*", "*", "Compute", "a", "buffer", "size", "for", "time", "not", "exceeding", "1", "second", ".", "*", "Usually", "this", "algorithm", "gives", "a", "buffer", "size", "for", "0", ".", "5", "to", "1", ".", "0", "seconds", "*", "of", "sound", "(", "using", "the", "current", "speed", ",", "sample", "size", "and", "#", "channels", ")", ".", "*", "/", "bsz", "=", "dmap", "-", ">", "buffsize", ";", "while", "(", "bsz", ">", "sz", ")", "bsz", "/", "=", "2", ";", "if", "(", "bsz", "=", "=", "dmap", "-", ">", "buffsize", ")", "bsz", "/", "=", "2", ";", "/", "*", "Needs", "at", "least", "2", "buffers", "*", "/", "/", "*", "*", "Split", "the", "computed", "fragment", "to", "smaller", "parts", ".", "After", "3", ".", "5a9", "*", "the", "default", "subdivision", "is", "4", "which", "should", "give", "better", "*", "results", "when", "recording", ".", "*", "/", "if", "(", "dmap", "-", ">", "subdivision", "=", "=", "0", ")", "/", "*", "Not", "already", "set", "*", "/", "{", "dmap", "-", ">", "subdivision", "=", "4", ";", "/", "*", "Init", "to", "the", "default", "value", "*", "/", "if", "(", "(", "bsz", "/", "dmap", "-", ">", "subdivision", ")", ">", "4096", ")", "dmap", "-", ">", "subdivision", "*", "=", "2", ";", "if", "(", "(", "bsz", "/", "dmap", "-", ">", "subdivision", ")", "<", "4096", ")", "dmap", "-", ">", "subdivision", "=", "1", ";", "}", "bsz", "/", "=", "dmap", "-", ">", "subdivision", ";", "if", "(", "bsz", "<", "16", ")", "bsz", "=", "16", ";", "/", "*", "Just", "a", "sanity", "check", "*", "/", "dmap", "-", ">", "fragment_size", "=", "bsz", ";", "}", "else", "{", "/", "*", "*", "The", "process", "has", "specified", "the", "buffer", "size", "with", "SNDCTL_DSP_SETFRAGMENT", "or", "*", "the", "buffer", "size", "computation", "has", "already", "been", "done", ".", "*", "/", "if", "(", "dmap", "-", ">", "fragment_size", ">", "(", "dmap", "-", ">", "buffsize", "/", "2", ")", ")", "dmap", "-", ">", "fragment_size", "=", "(", "dmap", "-", ">", "buffsize", "/", "2", ")", ";", "bsz", "=", "dmap", "-", ">", "fragment_size", ";", "}", "if", "(", "audio_devs", "[", "dev", "]", "->", "min_fragment", ")", "if", "(", "bsz", "<", "(", "1", "<", "<", "audio_devs", "[", "dev", "]", "->", "min_fragment", ")", ")", "bsz", "=", "1", "<", "<", "audio_devs", "[", "dev", "]", "->", "min_fragment", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "max_fragment", ")", "if", "(", "bsz", ">", "(", "1", "<", "<", "audio_devs", "[", "dev", "]", "->", "max_fragment", ")", ")", "bsz", "=", "1", "<", "<", "audio_devs", "[", "dev", "]", "->", "max_fragment", ";", "bsz", "&", "=", "~", "0x07", ";", "/", "*", "Force", "size", "which", "is", "multiple", "of", "8", "bytes", "*", "/", "#", "ifdef", "OS_DMA_ALIGN_CHECK", "OS_DMA_ALIGN_CHECK", "(", "bsz", ")", ";", "#", "endif", "n", "=", "dmap", "-", ">", "buffsize", "/", "bsz", ";", "if", "(", "n", ">", "MAX_SUB_BUFFERS", ")", "n", "=", "MAX_SUB_BUFFERS", ";", "if", "(", "n", ">", "dmap", "-", ">", "max_fragments", ")", "n", "=", "dmap", "-", ">", "max_fragments", ";", "if", "(", "n", "<", "2", ")", "{", "n", "=", "2", ";", "bsz", "/", "=", "2", ";", "}", "dmap", "-", ">", "nbufs", "=", "n", ";", "dmap", "-", ">", "bytes_in_use", "=", "n", "*", "bsz", ";", "dmap", "-", ">", "fragment_size", "=", "bsz", ";", "dmap", "-", ">", "max_byte_counter", "=", "(", "dmap", "-", ">", "data_rate", "*", "60", "*", "60", ")", "+", "dmap", "-", ">", "bytes_in_use", ";", "/", "*", "Approximately", "one", "hour", "*", "/", "if", "(", "dmap", "-", ">", "raw_buf", ")", "{", "memset", "(", "dmap", "-", ">", "raw_buf", ",", "dmap", "-", ">", "neutral_byte", ",", "dmap", "-", ">", "bytes_in_use", ")", ";", "}", "for", "(", "i", "=", "0", ";", "i", "<", "dmap", "-", ">", "nbufs", ";", "i", "+", "+)", "{", "dmap", "-", ">", "counts", "[", "i", "]", "=", "0", ";", "}", "dmap", "-", ">", "flags", "|", "=", "DMA_ALLOC_DONE", "|", "DMA_EMPTY", ";", "}", "static", "int", "dma_subdivide", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ",", "int", "fact", ")", "{", "if", "(", "fact", "=", "=", "0", ")", "{", "fact", "=", "dmap", "-", ">", "subdivision", ";", "if", "(", "fact", "=", "=", "0", ")", "fact", "=", "1", ";", "return", "fact", ";", "}", "if", "(", "dmap", "-", ">", "subdivision", "!", "=", "0", "|", "|", "dmap", "-", ">", "fragment_size", ")", "/", "*", "Too", "late", "to", "change", "*", "/", "return", "-", "EINVAL", ";", "if", "(", "fact", ">", "MAX_REALTIME_FACTOR", ")", "return", "-", "EINVAL", ";", "if", "(", "fact", "!", "=", "1", "&", "&", "fact", "!", "=", "2", "&", "&", "fact", "!", "=", "4", "&", "&", "fact", "!", "=", "8", "&", "&", "fact", "!", "=", "16", ")", "return", "-", "EINVAL", ";", "dmap", "-", ">", "subdivision", "=", "fact", ";", "return", "fact", ";", "}", "static", "int", "dma_set_fragment", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ",", "int", "fact", ")", "{", "int", "bytes", ",", "count", ";", "if", "(", "fact", "=", "=", "0", ")", "return", "-", "EIO", ";", "if", "(", "dmap", "-", ">", "subdivision", "!", "=", "0", "|", "|", "dmap", "-", ">", "fragment_size", ")", "/", "*", "Too", "late", "to", "change", "*", "/", "return", "-", "EINVAL", ";", "bytes", "=", "fact", "&", "0xffff", ";", "count", "=", "(", "fact", ">", ">", "16", ")", "&", "0x7fff", ";", "if", "(", "count", "=", "=", "0", ")", "count", "=", "MAX_SUB_BUFFERS", ";", "else", "if", "(", "count", "<", "MAX_SUB_BUFFERS", ")", "count", "+", "+;", "if", "(", "bytes", "<", "4", "|", "|", "bytes", ">", "17", ")", "/", "*", "<", "16", "|", "|", ">", "512k", "*", "/", "return", "-", "EINVAL", ";", "if", "(", "count", "<", "2", ")", "return", "-", "EINVAL", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "min_fragment", ">", "0", ")", "if", "(", "bytes", "<", "audio_devs", "[", "dev", "]", "->", "min_fragment", ")", "bytes", "=", "audio_devs", "[", "dev", "]", "->", "min_fragment", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "max_fragment", ">", "0", ")", "if", "(", "bytes", ">", "audio_devs", "[", "dev", "]", "->", "max_fragment", ")", "bytes", "=", "audio_devs", "[", "dev", "]", "->", "max_fragment", ";", "#", "ifdef", "OS_DMA_MINBITS", "if", "(", "bytes", "<", "OS_DMA_MINBITS", ")", "bytes", "=", "OS_DMA_MINBITS", ";", "#", "endif", "dmap", "-", ">", "fragment_size", "=", "(", "1", "<", "<", "bytes", ")", ";", "dmap", "-", ">", "max_fragments", "=", "count", ";", "if", "(", "dmap", "-", ">", "fragment_size", ">", "dmap", "-", ">", "buffsize", ")", "dmap", "-", ">", "fragment_size", "=", "dmap", "-", ">", "buffsize", ";", "if", "(", "dmap", "-", ">", "fragment_size", "=", "=", "dmap", "-", ">", "buffsize", "&", "&", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_AUTOMODE", ")", "dmap", "-", ">", "fragment_size", "/", "=", "2", ";", "/", "*", "Needs", "at", "least", "2", "buffers", "*", "/", "dmap", "-", ">", "subdivision", "=", "1", ";", "/", "*", "Disable", "SNDCTL_DSP_SUBDIVIDE", "*", "/", "return", "bytes", "|", "(", "(", "count", "-", "1", ")", "<", "<", "16", ")", ";", "}", "static", "int", "dma_ioctl", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", "{", "struct", "dma_buffparms", "*", "dmap_out", "=", "audio_devs", "[", "dev", "]", "->", "dmap_out", ";", "struct", "dma_buffparms", "*", "dmap_in", "=", "audio_devs", "[", "dev", "]", "->", "dmap_in", ";", "struct", "dma_buffparms", "*", "dmap", ";", "audio_buf_info", "info", ";", "count_info", "cinfo", ";", "int", "fact", ",", "ret", ",", "changed", ",", "bits", ",", "count", ",", "err", ";", "unsigned", "long", "flags", ";", "switch", "(", "cmd", ")", "{", "case", "SNDCTL_DSP_SUBDIVIDE", ":", "ret", "=", "0", ";", "if", "(", "get_user", "(", "fact", ",", "(", "int", "__user", "*", ")", "arg", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", "ret", "=", "dma_subdivide", "(", "dev", ",", "dmap_out", ",", "fact", ")", ";", "if", "(", "ret", "<", "0", ")", "return", "ret", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "!", "=", "OPEN_WRITE", "|", "|", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", "&", "&", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", ")", "ret", "=", "dma_subdivide", "(", "dev", ",", "dmap_in", ",", "fact", ")", ";", "if", "(", "ret", "<", "0", ")", "return", "ret", ";", "break", ";", "case", "SNDCTL_DSP_GETISPACE", ":", "case", "SNDCTL_DSP_GETOSPACE", ":", "dmap", "=", "dmap_out", ";", "if", "(", "cmd", "=", "=", "SNDCTL_DSP_GETISPACE", "&", "&", "!", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "cmd", "=", "=", "SNDCTL_DSP_GETOSPACE", "&", "&", "!", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "cmd", "=", "=", "SNDCTL_DSP_GETISPACE", "&", "&", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", ")", "dmap", "=", "dmap_in", ";", "if", "(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "return", "-", "EINVAL", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_ALLOC_DONE", ")", ")", "reorganize_buffers", "(", "dev", ",", "dmap", ",", "(", "cmd", "=", "=", "SNDCTL_DSP_GETISPACE", ")", ");", "info", ".", "fragstotal", "=", "dmap", "-", ">", "nbufs", ";", "if", "(", "cmd", "=", "=", "SNDCTL_DSP_GETISPACE", ")", "info", ".", "fragments", "=", "dmap", "-", ">", "qlen", ";", "else", "{", "if", "(", "!", "DMAbuf_space_in_queue", "(", "dev", ")", ")", "info", ".", "fragments", "=", "0", ";", "else", "{", "info", ".", "fragments", "=", "DMAbuf_space_in_queue", "(", "dev", ")", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "local_qlen", ")", "{", "int", "tmp", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "local_qlen", "(", "dev", ")", ";", "if", "(", "tmp", "&", "&", "info", ".", "fragments", ")", "tmp", "-", "-;", "/", "*", "*", "This", "buffer", "has", "been", "counted", "twice", "*", "/", "info", ".", "fragments", "-", "=", "tmp", ";", "}", "}", "}", "if", "(", "info", ".", "fragments", "<", "0", ")", "info", ".", "fragments", "=", "0", ";", "else", "if", "(", "info", ".", "fragments", ">", "dmap", "-", ">", "nbufs", ")", "info", ".", "fragments", "=", "dmap", "-", ">", "nbufs", ";", "info", ".", "fragsize", "=", "dmap", "-", ">", "fragment_size", ";", "info", ".", "bytes", "=", "info", ".", "fragments", "*", "dmap", "-", ">", "fragment_size", ";", "if", "(", "cmd", "=", "=", "SNDCTL_DSP_GETISPACE", "&", "&", "dmap", "-", ">", "qlen", ")", "info", ".", "bytes", "-", "=", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", ";", "else", "{", "info", ".", "fragments", "=", "info", ".", "bytes", "/", "dmap", "-", ">", "fragment_size", ";", "info", ".", "bytes", "-", "=", "dmap", "-", ">", "user_counter", "%", "dmap", "-", ">", "fragment_size", ";", "}", "if", "(", "copy_to_user", "(", "arg", ",", "&", "info", ",", "sizeof", "(", "info", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_DSP_SETTRIGGER", ":", "if", "(", "get_user", "(", "bits", ",", "(", "int", "__user", "*", ")", "arg", ")", ")", "return", "-", "EFAULT", ";", "bits", "&", "=", "audio_devs", "[", "dev", "]", "->", "open_mode", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "trigger", "=", "=", "NULL", ")", "return", "-", "EINVAL", ";", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", ")", "&", "&", "(", "bits", "&", "PCM_ENABLE_INPUT", ")", "&", "&", "(", "bits", "&", "PCM_ENABLE_OUTPUT", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "bits", "&", "PCM_ENABLE_INPUT", ")", "{", "spin_lock_irqsave", "(", "&", "dmap_in", "-", ">", "lock", ",", "flags", ")", ";", "changed", "=", "(", "audio_devs", "[", "dev", "]", "->", "enable_bits", "^", "bits", ")", "&", "PCM_ENABLE_INPUT", ";", "if", "(", "changed", "&", "&", "audio_devs", "[", "dev", "]", "->", "go", ")", "{", "reorganize_buffers", "(", "dev", ",", "dmap_in", ",", "1", ")", ";", "if", "(", "(", "err", "=", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "prepare_for_input", "(", "dev", ",", "dmap_in", "-", ">", "fragment_size", ",", "dmap_in", "-", ">", "nbufs", ")", ")", "<", "0", ")", "{", "spin_unlock_irqrestore", "(", "&", "dmap_in", "-", ">", "lock", ",", "flags", ")", ";", "return", "err", ";", "}", "dmap_in", "-", ">", "dma_mode", "=", "DMODE_INPUT", ";", "audio_devs", "[", "dev", "]", "->", "enable_bits", "|", "=", "PCM_ENABLE_INPUT", ";", "DMAbuf_activate_recording", "(", "dev", ",", "dmap_in", ")", ";", "}", "else", "audio_devs", "[", "dev", "]", "->", "enable_bits", "&", "=", "~", "PCM_ENABLE_INPUT", ";", "spin_unlock_irqrestore", "(", "&", "dmap_in", "-", ">", "lock", ",", "flags", ")", ";", "}", "if", "(", "bits", "&", "PCM_ENABLE_OUTPUT", ")", "{", "spin_lock_irqsave", "(", "&", "dmap_out", "-", ">", "lock", ",", "flags", ")", ";", "changed", "=", "(", "audio_devs", "[", "dev", "]", "->", "enable_bits", "^", "bits", ")", "&", "PCM_ENABLE_OUTPUT", ";", "if", "(", "changed", "&", "&", "(", "dmap_out", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", "|", "|", "dmap_out", "-", ">", "qlen", ">", "0", ")", "&", "&", "audio_devs", "[", "dev", "]", "->", "go", ")", "{", "if", "(", "!(", "dmap_out", "-", ">", "flags", "&", "DMA_ALLOC_DONE", ")", ")", "reorganize_buffers", "(", "dev", ",", "dmap_out", ",", "0", ")", ";", "dmap_out", "-", ">", "dma_mode", "=", "DMODE_OUTPUT", ";", "audio_devs", "[", "dev", "]", "->", "enable_bits", "|", "=", "PCM_ENABLE_OUTPUT", ";", "dmap_out", "-", ">", "counts", "[", "dmap_out", "-", ">", "qhead", "]", "=", "dmap_out", "-", ">", "fragment_size", ";", "DMAbuf_launch_output", "(", "dev", ",", "dmap_out", ")", ";", "}", "else", "audio_devs", "[", "dev", "]", "->", "enable_bits", "&", "=", "~", "PCM_ENABLE_OUTPUT", ";", "spin_unlock_irqrestore", "(", "&", "dmap_out", "-", ">", "lock", ",", "flags", ")", ";", "}", "#", "if", "0", "if", "(", "changed", "&", "&", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "trigger", ")", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "trigger", "(", "dev", ",", "bits", "*", "audio_devs", "[", "dev", "]", "->", "go", ")", ";", "#", "endif", "/", "*", "Falls", "through", ".", "..", "*", "/", "case", "SNDCTL_DSP_GETTRIGGER", ":", "ret", "=", "audio_devs", "[", "dev", "]", "->", "enable_bits", ";", "break", ";", "case", "SNDCTL_DSP_SETSYNCRO", ":", "if", "(", "!", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "trigger", ")", "return", "-", "EINVAL", ";", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "trigger", "(", "dev", ",", "0", ")", ";", "audio_devs", "[", "dev", "]", "->", "go", "=", "0", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETIPTR", ":", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", ")", "return", "-", "EINVAL", ";", "spin_lock_irqsave", "(", "&", "dmap_in", "-", ">", "lock", ",", "flags", ")", ";", "cinfo", ".", "bytes", "=", "dmap_in", "-", ">", "byte_counter", ";", "cinfo", ".", "ptr", "=", "DMAbuf_get_buffer_pointer", "(", "dev", ",", "dmap_in", ",", "DMODE_INPUT", ")", "&", "~", "3", ";", "if", "(", "cinfo", ".", "ptr", "<", "dmap_in", "-", ">", "fragment_size", "&", "&", "dmap_in", "-", ">", "qtail", "!", "=", "0", ")", "cinfo", ".", "bytes", "+", "=", "dmap_in", "-", ">", "bytes_in_use", ";", "/", "*", "Pointer", "wrap", "not", "handled", "yet", "*", "/", "cinfo", ".", "blocks", "=", "dmap_in", "-", ">", "qlen", ";", "cinfo", ".", "bytes", "+", "=", "cinfo", ".", "ptr", ";", "if", "(", "dmap_in", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "dmap_in", "-", ">", "qlen", "=", "0", ";", "/", "*", "Reset", "interrupt", "counter", "*", "/", "spin_unlock_irqrestore", "(", "&", "dmap_in", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "copy_to_user", "(", "arg", ",", "&", "cinfo", ",", "sizeof", "(", "cinfo", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETOPTR", ":", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "-", "EINVAL", ";", "spin_lock_irqsave", "(", "&", "dmap_out", "-", ">", "lock", ",", "flags", ")", ";", "cinfo", ".", "bytes", "=", "dmap_out", "-", ">", "byte_counter", ";", "cinfo", ".", "ptr", "=", "DMAbuf_get_buffer_pointer", "(", "dev", ",", "dmap_out", ",", "DMODE_OUTPUT", ")", "&", "~", "3", ";", "if", "(", "cinfo", ".", "ptr", "<", "dmap_out", "-", ">", "fragment_size", "&", "&", "dmap_out", "-", ">", "qhead", "!", "=", "0", ")", "cinfo", ".", "bytes", "+", "=", "dmap_out", "-", ">", "bytes_in_use", ";", "/", "*", "Pointer", "wrap", "not", "handled", "yet", "*", "/", "cinfo", ".", "blocks", "=", "dmap_out", "-", ">", "qlen", ";", "cinfo", ".", "bytes", "+", "=", "cinfo", ".", "ptr", ";", "if", "(", "dmap_out", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "dmap_out", "-", ">", "qlen", "=", "0", ";", "/", "*", "Reset", "interrupt", "counter", "*", "/", "spin_unlock_irqrestore", "(", "&", "dmap_out", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "copy_to_user", "(", "arg", ",", "&", "cinfo", ",", "sizeof", "(", "cinfo", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETODELAY", ":", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "!(", "dmap_out", "-", ">", "flags", "&", "DMA_ALLOC_DONE", ")", ")", "{", "ret", "=", "0", ";", "break", ";", "}", "spin_lock_irqsave", "(", "&", "dmap_out", "-", ">", "lock", ",", "flags", ")", ";", "/", "*", "Compute", "number", "of", "bytes", "that", "have", "been", "played", "*", "/", "count", "=", "DMAbuf_get_buffer_pointer", "(", "dev", ",", "dmap_out", ",", "DMODE_OUTPUT", ")", ";", "if", "(", "count", "<", "dmap_out", "-", ">", "fragment_size", "&", "&", "dmap_out", "-", ">", "qhead", "!", "=", "0", ")", "count", "+", "=", "dmap_out", "-", ">", "bytes_in_use", ";", "/", "*", "Pointer", "wrap", "not", "handled", "yet", "*", "/", "count", "+", "=", "dmap_out", "-", ">", "byte_counter", ";", "/", "*", "Subtract", "current", "count", "from", "the", "number", "of", "bytes", "written", "by", "app", "*", "/", "count", "=", "dmap_out", "-", ">", "user_counter", "-", "count", ";", "if", "(", "count", "<", "0", ")", "count", "=", "0", ";", "spin_unlock_irqrestore", "(", "&", "dmap_out", "-", ">", "lock", ",", "flags", ")", ";", "ret", "=", "count", ";", "break", ";", "case", "SNDCTL_DSP_POST", ":", "if", "(", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "qlen", ">", "0", ")", "if", "(", "!(", "audio_devs", "[", "dev", "]", "->", "dmap_out", "-", ">", "flags", "&", "DMA_ACTIVE", ")", ")", "DMAbuf_launch_output", "(", "dev", ",", "audio_devs", "[", "dev", "]", "->", "dmap_out", ")", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETBLKSIZE", ":", "dmap", "=", "dmap_out", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", "reorganize_buffers", "(", "dev", ",", "dmap_out", ",", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "=", "=", "OPEN_READ", ")", ");", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "=", "=", "OPEN_READ", "|", "|", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", "&", "&", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", ")", "reorganize_buffers", "(", "dev", ",", "dmap_in", ",", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "=", "=", "OPEN_READ", ")", ");", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "=", "=", "OPEN_READ", ")", "dmap", "=", "dmap_in", ";", "ret", "=", "dmap", "-", ">", "fragment_size", ";", "break", ";", "case", "SNDCTL_DSP_SETFRAGMENT", ":", "ret", "=", "0", ";", "if", "(", "get_user", "(", "fact", ",", "(", "int", "__user", "*", ")", "arg", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", "ret", "=", "dma_set_fragment", "(", "dev", ",", "dmap_out", ",", "fact", ")", ";", "if", "(", "ret", "<", "0", ")", "return", "ret", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "=", "=", "OPEN_READ", "|", "|", "(", "audio_devs", "[", "dev", "]", "->", "flags", "&", "DMA_DUPLEX", "&", "&", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", ")", "ret", "=", "dma_set_fragment", "(", "dev", ",", "dmap_in", ",", "fact", ")", ";", "if", "(", "ret", "<", "0", ")", "return", "ret", ";", "if", "(", "!", "arg", ")", "/", "*", "don", "'", "t", "know", "what", "this", "is", "good", "for", ",", "but", "preserve", "old", "semantics", "*", "/", "return", "0", ";", "break", ";", "default", ":", "if", "(", "!", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "ioctl", ")", "return", "-", "EINVAL", ";", "return", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "ioctl", "(", "dev", ",", "cmd", ",", "arg", ")", ";", "}", "return", "put_user", "(", "ret", ",", "(", "int", "__user", "*", ")", "arg", ")", ";", "}", "@", "@", "-", "1", ",", "39", "+", "0", ",", "0", "@", "@", "#", "include", "<", "stdio", ".", "h", ">", "#", "include", "<", "string", ".", "h", ">", "#", "include", "<", "stdlib", ".", "h", ">", "int", "main", "(", "int", "argc", ",", "const", "char", "*", "argv", "[", "]", ")", "{", "const", "char", "*", "varname", ";", "int", "i", "=", "0", ";", "int", "c", ";", "int", "id", "=", "0", ";", "if", "(", "argv", "[", "1", "]", "&", "&", "strcmp", "(", "argv", "[", "1", "]", ",\"", "-", "i", "\"", ")=", "=", "0", ")", "{", "argv", "+", "+;", "argc", "-", "-;", "id", "=", "1", ";", "}", "if", "(", "argc", "=", "=", "1", ")", "{", "fprintf", "(", "stderr", ",", "\"", "bin2hex", ":", "[", "-", "i", "]", "firmware", "\\", "n", "\"", ");", "exit", "(", "1", ")", ";", "}", "varname", "=", "argv", "[", "1", "]", ";", "printf", "(", "\"", "/*", "automatically", "generated", "by", "bin2hex", "*", "/\\", "n", "\"", ")", ";", "printf", "(", "\"", "static", "unsigned", "char", "%", "s", "[", "]", "%", "s", "=", "\\", "n", "{", "\\", "n", "\"", ",", "varname", ",", "id", "?", "\"", "__initdata", "\"", ":\"", "\")", ";", "while", "(", "(", "c", "=", "getchar", "(", ")", ")", "!", "=", "EOF", ")", "{", "if", "(", "i", "!", "=", "0", "&", "&", "i", "%", "10", "=", "=", "0", ")", "printf", "(", "\"", "\\", "n", "\"", ")", ";", "printf", "(", "\"", "0x", "%", "02lx", ",", "\",", "c", "&", "0xFFl", ")", ";", "i", "+", "+;", "}", "printf", "(", "\"", "};", "\\", "nstatic", "int", "%", "sLen", "=", "%", "d", ";", "\\", "n", "\"", ",", "varname", ",", "i", ")", ";", "return", "0", ";", "}", "@", "@", "-", "1", ",", "12", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Definitions", "for", "various", "on", "board", "processors", "on", "the", "sound", "cards", ".", "For", "*", "example", "DSP", "processors", ".", "*", "/", "/", "*", "*", "Coprocessor", "access", "types", "*", "/", "#", "define", "COPR_CUSTOM", "0x0001", "/", "*", "Custom", "applications", "*", "/", "#", "define", "COPR_MIDI", "0x0002", "/", "*", "MIDI", "(", "MPU", "-", "401", ")", "emulation", "*", "/", "#", "define", "COPR_PCM", "0x0004", "/", "*", "Digitized", "voice", "applications", "*", "/", "#", "define", "COPR_SYNTH", "0x0008", "/", "*", "Music", "synthesis", "*", "/", "@", "@", "-", "1", ",", "256", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "dev_table", ".", "c", "*", "*", "Device", "call", "tables", ".", "*", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "/", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "struct", "audio_operations", "*", "audio_devs", "[", "MAX_AUDIO_DEV", "]", ";", "EXPORT_SYMBOL", "(", "audio_devs", ")", ";", "int", "num_audiodevs", ";", "EXPORT_SYMBOL", "(", "num_audiodevs", ")", ";", "struct", "mixer_operations", "*", "mixer_devs", "[", "MAX_MIXER_DEV", "]", ";", "EXPORT_SYMBOL", "(", "mixer_devs", ")", ";", "int", "num_mixers", ";", "EXPORT_SYMBOL", "(", "num_mixers", ")", ";", "struct", "synth_operations", "*", "synth_devs", "[", "MAX_SYNTH_DEV", "+", "MAX_MIDI_DEV", "]", ";", "EXPORT_SYMBOL", "(", "synth_devs", ")", ";", "int", "num_synths", ";", "struct", "midi_operations", "*", "midi_devs", "[", "MAX_MIDI_DEV", "]", ";", "EXPORT_SYMBOL", "(", "midi_devs", ")", ";", "int", "num_midis", ";", "EXPORT_SYMBOL", "(", "num_midis", ")", ";", "struct", "sound_timer_operations", "*", "sound_timer_devs", "[", "MAX_TIMER_DEV", "]", "=", "{", "&", "default_sound_timer", ",", "NULL", "}", ";", "EXPORT_SYMBOL", "(", "sound_timer_devs", ")", ";", "int", "num_sound_timers", "=", "1", ";", "static", "int", "sound_alloc_audiodev", "(", "void", ")", ";", "int", "sound_install_audiodrv", "(", "int", "vers", ",", "char", "*", "name", ",", "struct", "audio_driver", "*", "driver", ",", "int", "driver_size", ",", "int", "flags", ",", "unsigned", "int", "format_mask", ",", "void", "*", "devc", ",", "int", "dma1", ",", "int", "dma2", ")", "{", "struct", "audio_driver", "*", "d", ";", "struct", "audio_operations", "*", "op", ";", "int", "num", ";", "if", "(", "vers", "!", "=", "AUDIO_DRIVER_VERSION", "|", "|", "driver_size", ">", "sizeof", "(", "struct", "audio_driver", ")", ")", "{", "printk", "(", "KERN_ERR", "\"", "Sound", ":", "Incompatible", "audio", "driver", "for", "%", "s", "\\", "n", "\"", ",", "name", ")", ";", "return", "-", "EINVAL", ";", "}", "num", "=", "sound_alloc_audiodev", "(", ");", "if", "(", "num", "=", "=", "-", "1", ")", "{", "printk", "(", "KERN_ERR", "\"", "sound", ":", "Too", "many", "audio", "drivers", "\\", "n", "\"", ");", "return", "-", "EBUSY", ";", "}", "d", "=", "(", "struct", "audio_driver", "*", ")", "(", "sound_mem_blocks", "[", "sound_nblocks", "]", "=", "vmalloc", "(", "sizeof", "(", "struct", "audio_driver", ")", "))", ";", "sound_nblocks", "+", "+;", "if", "(", "sound_nblocks", ">", "=", "MAX_MEM_BLOCKS", ")", "sound_nblocks", "=", "MAX_MEM_BLOCKS", "-", "1", ";", "op", "=", "(", "struct", "audio_operations", "*", ")", "(", "sound_mem_blocks", "[", "sound_nblocks", "]", "=", "vzalloc", "(", "sizeof", "(", "struct", "audio_operations", ")", "))", ";", "sound_nblocks", "+", "+;", "if", "(", "sound_nblocks", ">", "=", "MAX_MEM_BLOCKS", ")", "sound_nblocks", "=", "MAX_MEM_BLOCKS", "-", "1", ";", "if", "(", "d", "=", "=", "NULL", "|", "|", "op", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "Sound", ":", "Can", "'", "t", "allocate", "driver", "for", "(", "%", "s", ")", "\\", "n", "\"", ",", "name", ")", ";", "sound_unload_audiodev", "(", "num", ")", ";", "return", "-", "ENOMEM", ";", "}", "init_waitqueue_head", "(", "&", "op", "-", ">", "in_sleeper", ")", ";", "init_waitqueue_head", "(", "&", "op", "-", ">", "out_sleeper", ")", ";", "init_waitqueue_head", "(", "&", "op", "-", ">", "poll_sleeper", ")", ";", "if", "(", "driver_size", "<", "sizeof", "(", "struct", "audio_driver", ")", ")", "memset", "(", "(", "char", "*", ")", "d", ",", "0", ",", "sizeof", "(", "struct", "audio_driver", ")", ");", "memcpy", "(", "(", "char", "*", ")", "d", ",", "(", "char", "*", ")", "driver", ",", "driver_size", ")", ";", "op", "-", ">", "d", "=", "d", ";", "strlcpy", "(", "op", "-", ">", "name", ",", "name", ",", "sizeof", "(", "op", "-", ">", "name", ")", ");", "op", "-", ">", "flags", "=", "flags", ";", "op", "-", ">", "format_mask", "=", "format_mask", ";", "op", "-", ">", "devc", "=", "devc", ";", "/", "*", "*", "Hardcoded", "defaults", "*", "/", "audio_devs", "[", "num", "]", "=", "op", ";", "DMAbuf_init", "(", "num", ",", "dma1", ",", "dma2", ")", ";", "audio_init_devices", "(", ");", "return", "num", ";", "}", "EXPORT_SYMBOL", "(", "sound_install_audiodrv", ")", ";", "int", "sound_install_mixer", "(", "int", "vers", ",", "char", "*", "name", ",", "struct", "mixer_operations", "*", "driver", ",", "int", "driver_size", ",", "void", "*", "devc", ")", "{", "struct", "mixer_operations", "*", "op", ";", "int", "n", "=", "sound_alloc_mixerdev", "(", ");", "if", "(", "n", "=", "=", "-", "1", ")", "{", "printk", "(", "KERN_ERR", "\"", "Sound", ":", "Too", "many", "mixer", "drivers", "\\", "n", "\"", ");", "return", "-", "EBUSY", ";", "}", "if", "(", "vers", "!", "=", "MIXER_DRIVER_VERSION", "|", "|", "driver_size", ">", "sizeof", "(", "struct", "mixer_operations", ")", ")", "{", "printk", "(", "KERN_ERR", "\"", "Sound", ":", "Incompatible", "mixer", "driver", "for", "%", "s", "\\", "n", "\"", ",", "name", ")", ";", "return", "-", "EINVAL", ";", "}", "/", "*", "FIXME", ":", "This", "leaks", "a", "mixer_operations", "struct", "every", "time", "its", "called", "until", "you", "unload", "sound", "!", "*", "/", "op", "=", "(", "struct", "mixer_operations", "*", ")", "(", "sound_mem_blocks", "[", "sound_nblocks", "]", "=", "vzalloc", "(", "sizeof", "(", "struct", "mixer_operations", ")", "))", ";", "sound_nblocks", "+", "+;", "if", "(", "sound_nblocks", ">", "=", "MAX_MEM_BLOCKS", ")", "sound_nblocks", "=", "MAX_MEM_BLOCKS", "-", "1", ";", "if", "(", "op", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "Sound", ":", "Can", "'", "t", "allocate", "mixer", "driver", "for", "(", "%", "s", ")", "\\", "n", "\"", ",", "name", ")", ";", "return", "-", "ENOMEM", ";", "}", "memcpy", "(", "(", "char", "*", ")", "op", ",", "(", "char", "*", ")", "driver", ",", "driver_size", ")", ";", "strlcpy", "(", "op", "-", ">", "name", ",", "name", ",", "sizeof", "(", "op", "-", ">", "name", ")", ");", "op", "-", ">", "devc", "=", "devc", ";", "mixer_devs", "[", "n", "]", "=", "op", ";", "return", "n", ";", "}", "EXPORT_SYMBOL", "(", "sound_install_mixer", ")", ";", "void", "sound_unload_audiodev", "(", "int", "dev", ")", "{", "if", "(", "dev", "!", "=", "-", "1", ")", "{", "DMAbuf_deinit", "(", "dev", ")", ";", "audio_devs", "[", "dev", "]", "=", "NULL", ";", "unregister_sound_dsp", "(", "(", "dev", "<", "<", "4", ")", "+", "3", ")", ";", "}", "}", "EXPORT_SYMBOL", "(", "sound_unload_audiodev", ")", ";", "static", "int", "sound_alloc_audiodev", "(", "void", ")", "{", "int", "i", "=", "register_sound_dsp", "(", "&", "oss_sound_fops", ",", "-", "1", ")", ";", "if", "(", "i", "=", "=-", "1", ")", "return", "i", ";", "i", ">", ">=", "4", ";", "if", "(", "i", ">", "=", "num_audiodevs", ")", "num_audiodevs", "=", "i", "+", "1", ";", "return", "i", ";", "}", "int", "sound_alloc_mididev", "(", "void", ")", "{", "int", "i", "=", "register_sound_midi", "(", "&", "oss_sound_fops", ",", "-", "1", ")", ";", "if", "(", "i", "=", "=-", "1", ")", "return", "i", ";", "i", ">", ">=", "4", ";", "if", "(", "i", ">", "=", "num_midis", ")", "num_midis", "=", "i", "+", "1", ";", "return", "i", ";", "}", "EXPORT_SYMBOL", "(", "sound_alloc_mididev", ")", ";", "int", "sound_alloc_synthdev", "(", "void", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "MAX_SYNTH_DEV", ";", "i", "+", "+)", "{", "if", "(", "synth_devs", "[", "i", "]", "=", "=", "NULL", ")", "{", "if", "(", "i", ">", "=", "num_synths", ")", "num_synths", "+", "+;", "return", "i", ";", "}", "}", "return", "-", "1", ";", "}", "EXPORT_SYMBOL", "(", "sound_alloc_synthdev", ")", ";", "int", "sound_alloc_mixerdev", "(", "void", ")", "{", "int", "i", "=", "register_sound_mixer", "(", "&", "oss_sound_fops", ",", "-", "1", ")", ";", "if", "(", "i", "=", "=-", "1", ")", "return", "-", "1", ";", "i", ">", ">=", "4", ";", "if", "(", "i", ">", "=", "num_mixers", ")", "num_mixers", "=", "i", "+", "1", ";", "return", "i", ";", "}", "EXPORT_SYMBOL", "(", "sound_alloc_mixerdev", ")", ";", "int", "sound_alloc_timerdev", "(", "void", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "MAX_TIMER_DEV", ";", "i", "+", "+)", "{", "if", "(", "sound_timer_devs", "[", "i", "]", "=", "=", "NULL", ")", "{", "if", "(", "i", ">", "=", "num_sound_timers", ")", "num_sound_timers", "+", "+;", "return", "i", ";", "}", "}", "return", "-", "1", ";", "}", "EXPORT_SYMBOL", "(", "sound_alloc_timerdev", ")", ";", "void", "sound_unload_mixerdev", "(", "int", "dev", ")", "{", "if", "(", "dev", "!", "=", "-", "1", ")", "{", "mixer_devs", "[", "dev", "]", "=", "NULL", ";", "unregister_sound_mixer", "(", "dev", "<", "<", "4", ")", ";", "num_mixers", "-", "-;", "}", "}", "EXPORT_SYMBOL", "(", "sound_unload_mixerdev", ")", ";", "void", "sound_unload_mididev", "(", "int", "dev", ")", "{", "if", "(", "dev", "!", "=", "-", "1", ")", "{", "midi_devs", "[", "dev", "]", "=", "NULL", ";", "unregister_sound_midi", "(", "(", "dev", "<", "<", "4", ")", "+", "2", ")", ";", "}", "}", "EXPORT_SYMBOL", "(", "sound_unload_mididev", ")", ";", "void", "sound_unload_synthdev", "(", "int", "dev", ")", "{", "if", "(", "dev", "!", "=", "-", "1", ")", "synth_devs", "[", "dev", "]", "=", "NULL", ";", "}", "EXPORT_SYMBOL", "(", "sound_unload_synthdev", ")", ";", "void", "sound_unload_timerdev", "(", "int", "dev", ")", "{", "if", "(", "dev", "!", "=", "-", "1", ")", "sound_timer_devs", "[", "dev", "]", "=", "NULL", ";", "}", "EXPORT_SYMBOL", "(", "sound_unload_timerdev", ")", ";", "@", "@", "-", "1", ",", "390", "+", "0", ",", "0", "@", "@", "/", "*", "*", "dev_table", ".", "h", "*", "*", "Global", "definitions", "for", "device", "call", "tables", "*", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "/", "#", "ifndef", "_DEV_TABLE_H_", "#", "define", "_DEV_TABLE_H_", "#", "include", "<", "linux", "/", "spinlock", ".", "h", ">", "/", "*", "*", "Sound", "card", "numbers", "27", "to", "999", ".", "(", "1", "to", "26", "are", "defined", "in", "soundcard", ".", "h", ")", "*", "Numbers", "1000", "to", "N", "are", "reserved", "for", "driver", "'", "s", "internal", "use", ".", "*", "/", "#", "define", "SNDCARD_DESKPROXL", "27", "/", "*", "Compaq", "Deskpro", "XL", "*", "/", "#", "define", "SNDCARD_VIDC", "28", "/", "*", "ARMs", "VIDC", "*", "/", "#", "define", "SNDCARD_SBPNP", "29", "#", "define", "SNDCARD_SOFTOSS", "36", "#", "define", "SNDCARD_VMIDI", "37", "#", "define", "SNDCARD_OPL3SA1", "38", "/", "*", "Note", ":", "clash", "in", "msnd", ".", "h", "*", "/", "#", "define", "SNDCARD_OPL3SA1_SB", "39", "#", "define", "SNDCARD_OPL3SA1_MPU", "40", "#", "define", "SNDCARD_WAVEFRONT", "41", "#", "define", "SNDCARD_OPL3SA2", "42", "#", "define", "SNDCARD_OPL3SA2_MPU", "43", "#", "define", "SNDCARD_WAVEARTIST", "44", "/", "*", "Waveartist", "*", "/", "#", "define", "SNDCARD_OPL3SA2_MSS", "45", "/", "*", "Originally", "missed", "*", "/", "#", "define", "SNDCARD_AD1816", "88", "/", "*", "*", "NOTE", "!", "NOTE", "!", "NOTE", "!", "NOTE", "!", "*", "*", "If", "you", "modify", "this", "file", ",", "please", "check", "the", "dev_table", ".", "c", "also", ".", "*", "*", "NOTE", "!", "NOTE", "!", "NOTE", "!", "NOTE", "!", "*", "/", "struct", "driver_info", "{", "char", "*", "driver_id", ";", "int", "card_subtype", ";", "/", "*", "Driver", "specific", ".", "Usually", "0", "*", "/", "int", "card_type", ";", "/", "*", "From", "soundcard", ".", "h", "*", "/", "char", "*", "name", ";", "void", "(", "*", "attach", ")", "(", "struct", "address_info", "*", "hw_config", ")", ";", "int", "(", "*", "probe", ")", "(", "struct", "address_info", "*", "hw_config", ")", ";", "void", "(", "*", "unload", ")", "(", "struct", "address_info", "*", "hw_config", ")", ";", "}", ";", "struct", "card_info", "{", "int", "card_type", ";", "/", "*", "Link", "(", "search", "key", ")", "to", "the", "driver", "list", "*", "/", "struct", "address_info", "config", ";", "int", "enabled", ";", "void", "*", "for_driver_use", ";", "}", ";", "/", "*", "*", "Device", "specific", "parameters", "(", "used", "only", "by", "dmabuf", ".", "c", ")", "*", "/", "#", "define", "MAX_SUB_BUFFERS", "(", "32", "*", "MAX_REALTIME_FACTOR", ")", "#", "define", "DMODE_NONE", "0", "#", "define", "DMODE_OUTPUT", "PCM_ENABLE_OUTPUT", "#", "define", "DMODE_INPUT", "PCM_ENABLE_INPUT", "struct", "dma_buffparms", "{", "int", "dma_mode", ";", "/", "*", "DMODE_INPUT", ",", "DMODE_OUTPUT", "or", "DMODE_NONE", "*", "/", "int", "closing", ";", "/", "*", "*", "Pointers", "to", "raw", "buffers", "*", "/", "char", "*", "raw_buf", ";", "unsigned", "long", "raw_buf_phys", ";", "int", "buffsize", ";", "/", "*", "*", "Device", "state", "tables", "*", "/", "unsigned", "long", "flags", ";", "#", "define", "DMA_BUSY", "0x00000001", "#", "define", "DMA_RESTART", "0x00000002", "#", "define", "DMA_ACTIVE", "0x00000004", "#", "define", "DMA_STARTED", "0x00000008", "#", "define", "DMA_EMPTY", "0x00000010", "#", "define", "DMA_ALLOC_DONE", "0x00000020", "#", "define", "DMA_SYNCING", "0x00000040", "#", "define", "DMA_DIRTY", "0x00000080", "#", "define", "DMA_POST", "0x00000100", "#", "define", "DMA_NODMA", "0x00000200", "#", "define", "DMA_NOTIMEOUT", "0x00000400", "int", "open_mode", ";", "/", "*", "*", "Queue", "parameters", ".", "*", "/", "int", "qlen", ";", "int", "qhead", ";", "int", "qtail", ";", "spinlock_t", "lock", ";", "int", "cfrag", ";", "/", "*", "Current", "incomplete", "fragment", "(", "write", ")", "*", "/", "int", "nbufs", ";", "int", "counts", "[", "MAX_SUB_BUFFERS", "]", ";", "int", "subdivision", ";", "int", "fragment_size", ";", "int", "needs_reorg", ";", "int", "max_fragments", ";", "int", "bytes_in_use", ";", "int", "underrun_count", ";", "unsigned", "long", "byte_counter", ";", "unsigned", "long", "user_counter", ";", "unsigned", "long", "max_byte_counter", ";", "int", "data_rate", ";", "/", "*", "Bytes", "/", "second", "*", "/", "int", "mapping_flags", ";", "#", "define", "DMA_MAP_MAPPED", "0x00000001", "char", "neutral_byte", ";", "int", "dma", ";", "/", "*", "DMA", "channel", "*", "/", "int", "applic_profile", ";", "/", "*", "Application", "profile", "(", "APF_", "*", ")", "*", "/", "/", "*", "Interrupt", "callback", "stuff", "*", "/", "void", "(", "*", "audio_callback", ")", "(", "int", "dev", ",", "int", "parm", ")", ";", "int", "callback_parm", ";", "int", "buf_flags", "[", "MAX_SUB_BUFFERS", "]", ";", "#", "define", "BUFF_EOF", "0x00000001", "/", "*", "Increment", "eof", "count", "*", "/", "#", "define", "BUFF_DIRTY", "0x00000002", "/", "*", "Buffer", "written", "*", "/", "}", ";", "/", "*", "*", "Structure", "for", "use", "with", "various", "microcontrollers", "and", "DSP", "processors", "*", "in", "the", "recent", "sound", "cards", ".", "*", "/", "typedef", "struct", "coproc_operations", "{", "char", "name", "[", "64", "]", ";", "struct", "module", "*", "owner", ";", "int", "(", "*", "open", ")", "(", "void", "*", "devc", ",", "int", "sub_device", ")", ";", "void", "(", "*", "close", ")", "(", "void", "*", "devc", ",", "int", "sub_device", ")", ";", "int", "(", "*", "ioctl", ")", "(", "void", "*", "devc", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ",", "int", "local", ")", ";", "void", "(", "*", "reset", ")", "(", "void", "*", "devc", ")", ";", "void", "*", "devc", ";", "/", "*", "Driver", "specific", "info", "*", "/", "}", "coproc_operations", ";", "struct", "audio_driver", "{", "struct", "module", "*", "owner", ";", "int", "(", "*", "open", ")", "(", "int", "dev", ",", "int", "mode", ")", ";", "void", "(", "*", "close", ")", "(", "int", "dev", ")", ";", "void", "(", "*", "output_block", ")", "(", "int", "dev", ",", "unsigned", "long", "buf", ",", "int", "count", ",", "int", "intrflag", ")", ";", "void", "(", "*", "start_input", ")", "(", "int", "dev", ",", "unsigned", "long", "buf", ",", "int", "count", ",", "int", "intrflag", ")", ";", "int", "(", "*", "ioctl", ")", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", ";", "int", "(", "*", "prepare_for_input", ")", "(", "int", "dev", ",", "int", "bufsize", ",", "int", "nbufs", ")", ";", "int", "(", "*", "prepare_for_output", ")", "(", "int", "dev", ",", "int", "bufsize", ",", "int", "nbufs", ")", ";", "void", "(", "*", "halt_io", ")", "(", "int", "dev", ")", ";", "int", "(", "*", "local_qlen", ")", "(", "int", "dev", ")", ";", "void", "(", "*", "copy_user", ")", "(", "int", "dev", ",", "char", "*", "localbuf", ",", "int", "localoffs", ",", "const", "char", "__user", "*", "userbuf", ",", "int", "useroffs", ",", "int", "max_in", ",", "int", "max_out", ",", "int", "*", "used", ",", "int", "*", "returned", ",", "int", "len", ")", ";", "void", "(", "*", "halt_input", ")", "(", "int", "dev", ")", ";", "void", "(", "*", "halt_output", ")", "(", "int", "dev", ")", ";", "void", "(", "*", "trigger", ")", "(", "int", "dev", ",", "int", "bits", ")", ";", "int", "(", "*", "set_speed", ")", "(", "int", "dev", ",", "int", "speed", ")", ";", "unsigned", "int", "(", "*", "set_bits", ")", "(", "int", "dev", ",", "unsigned", "int", "bits", ")", ";", "short", "(", "*", "set_channels", ")", "(", "int", "dev", ",", "short", "channels", ")", ";", "void", "(", "*", "postprocess_write", ")", "(", "int", "dev", ")", ";", "/", "*", "Device", "spesific", "postprocessing", "for", "written", "data", "*", "/", "void", "(", "*", "preprocess_read", ")", "(", "int", "dev", ")", ";", "/", "*", "Device", "spesific", "preprocessing", "for", "read", "data", "*", "/", "void", "(", "*", "mmap", ")", "(", "int", "dev", ")", ";", "}", ";", "struct", "audio_operations", "{", "char", "name", "[", "128", "]", ";", "int", "flags", ";", "#", "define", "NOTHING_SPECIAL", "0x00", "#", "define", "NEEDS_RESTART", "0x01", "#", "define", "DMA_AUTOMODE", "0x02", "#", "define", "DMA_DUPLEX", "0x04", "#", "define", "DMA_PSEUDO_AUTOMODE", "0x08", "#", "define", "DMA_HARDSTOP", "0x10", "#", "define", "DMA_EXACT", "0x40", "#", "define", "DMA_NORESET", "0x80", "int", "format_mask", ";", "/", "*", "Bitmask", "for", "supported", "audio", "formats", "*", "/", "void", "*", "devc", ";", "/", "*", "Driver", "specific", "info", "*", "/", "struct", "audio_driver", "*", "d", ";", "void", "*", "portc", ";", "/", "*", "Driver", "specific", "info", "*", "/", "struct", "dma_buffparms", "*", "dmap_in", ",", "*", "dmap_out", ";", "struct", "coproc_operations", "*", "coproc", ";", "int", "mixer_dev", ";", "int", "enable_bits", ";", "int", "open_mode", ";", "int", "go", ";", "int", "min_fragment", ";", "/", "*", "0", "=", "=", "unlimited", "*", "/", "int", "max_fragment", ";", "/", "*", "0", "=", "=", "unlimited", "*", "/", "int", "parent_dev", ";", "/", "*", "0", "-", ">", "no", "parent", ",", "1", "to", "n", "-", ">", "parent", "=", "parent_dev", "+", "1", "*", "/", "/", "*", "fields", "formerly", "in", "dmabuf", ".", "c", "*", "/", "wait_queue_head_t", "in_sleeper", ";", "wait_queue_head_t", "out_sleeper", ";", "wait_queue_head_t", "poll_sleeper", ";", "/", "*", "fields", "formerly", "in", "audio", ".", "c", "*", "/", "int", "audio_mode", ";", "#", "define", "AM_NONE", "0", "#", "define", "AM_WRITE", "OPEN_WRITE", "#", "define", "AM_READ", "OPEN_READ", "int", "local_format", ";", "int", "audio_format", ";", "int", "local_conversion", ";", "#", "define", "CNV_MU_LAW", "0x00000001", "/", "*", "large", "structures", "at", "the", "end", "to", "keep", "offsets", "small", "*", "/", "struct", "dma_buffparms", "dmaps", "[", "2", "]", ";", "}", ";", "int", "*", "load_mixer_volumes", "(", "char", "*", "name", ",", "int", "*", "levels", ",", "int", "present", ")", ";", "struct", "mixer_operations", "{", "struct", "module", "*", "owner", ";", "char", "id", "[", "16", "]", ";", "char", "name", "[", "64", "]", ";", "int", "(", "*", "ioctl", ")", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", ";", "void", "*", "devc", ";", "int", "modify_counter", ";", "}", ";", "struct", "synth_operations", "{", "struct", "module", "*", "owner", ";", "char", "*", "id", ";", "/", "*", "Unique", "identifier", "(", "ASCII", ")", "max", "29", "char", "*", "/", "struct", "synth_info", "*", "info", ";", "int", "midi_dev", ";", "int", "synth_type", ";", "int", "synth_subtype", ";", "int", "(", "*", "open", ")", "(", "int", "dev", ",", "int", "mode", ")", ";", "void", "(", "*", "close", ")", "(", "int", "dev", ")", ";", "int", "(", "*", "ioctl", ")", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", ";", "int", "(", "*", "kill_note", ")", "(", "int", "dev", ",", "int", "voice", ",", "int", "note", ",", "int", "velocity", ")", ";", "int", "(", "*", "start_note", ")", "(", "int", "dev", ",", "int", "voice", ",", "int", "note", ",", "int", "velocity", ")", ";", "int", "(", "*", "set_instr", ")", "(", "int", "dev", ",", "int", "voice", ",", "int", "instr", ")", ";", "void", "(", "*", "reset", ")", "(", "int", "dev", ")", ";", "void", "(", "*", "hw_control", ")", "(", "int", "dev", ",", "unsigned", "char", "*", "event", ")", ";", "int", "(", "*", "load_patch", ")", "(", "int", "dev", ",", "int", "format", ",", "const", "char", "__user", "*", "addr", ",", "int", "count", ",", "int", "pmgr_flag", ")", ";", "void", "(", "*", "aftertouch", ")", "(", "int", "dev", ",", "int", "voice", ",", "int", "pressure", ")", ";", "void", "(", "*", "controller", ")", "(", "int", "dev", ",", "int", "voice", ",", "int", "ctrl_num", ",", "int", "value", ")", ";", "void", "(", "*", "panning", ")", "(", "int", "dev", ",", "int", "voice", ",", "int", "value", ")", ";", "void", "(", "*", "volume_method", ")", "(", "int", "dev", ",", "int", "mode", ")", ";", "void", "(", "*", "bender", ")", "(", "int", "dev", ",", "int", "chn", ",", "int", "value", ")", ";", "int", "(", "*", "alloc_voice", ")", "(", "int", "dev", ",", "int", "chn", ",", "int", "note", ",", "struct", "voice_alloc_info", "*", "alloc", ")", ";", "void", "(", "*", "setup_voice", ")", "(", "int", "dev", ",", "int", "voice", ",", "int", "chn", ")", ";", "int", "(", "*", "send_sysex", ")", "(", "int", "dev", ",", "unsigned", "char", "*", "bytes", ",", "int", "len", ")", ";", "struct", "voice_alloc_info", "alloc", ";", "struct", "channel_info", "chn_info", "[", "16", "]", ";", "int", "emulation", ";", "#", "define", "EMU_GM", "1", "/", "*", "General", "MIDI", "*", "/", "#", "define", "EMU_XG", "2", "/", "*", "Yamaha", "XG", "*", "/", "#", "define", "MAX_SYSEX_BUF", "64", "unsigned", "char", "sysex_buf", "[", "MAX_SYSEX_BUF", "]", ";", "int", "sysex_ptr", ";", "}", ";", "struct", "midi_input_info", "{", "/", "*", "MIDI", "input", "scanner", "variables", "*", "/", "#", "define", "MI_MAX", "10", "volatile", "int", "m_busy", ";", "unsigned", "char", "m_buf", "[", "MI_MAX", "]", ";", "unsigned", "char", "m_prev_status", ";", "/", "*", "For", "running", "status", "*", "/", "int", "m_ptr", ";", "#", "define", "MST_INIT", "0", "#", "define", "MST_DATA", "1", "#", "define", "MST_SYSEX", "2", "int", "m_state", ";", "int", "m_left", ";", "}", ";", "struct", "midi_operations", "{", "struct", "module", "*", "owner", ";", "struct", "midi_info", "info", ";", "struct", "synth_operations", "*", "converter", ";", "struct", "midi_input_info", "in_info", ";", "int", "(", "*", "open", ")", "(", "int", "dev", ",", "int", "mode", ",", "void", "(", "*", "inputintr", ")", "(", "int", "dev", ",", "unsigned", "char", "data", ")", ",", "void", "(", "*", "outputintr", ")", "(", "int", "dev", ")", ")", ";", "void", "(", "*", "close", ")", "(", "int", "dev", ")", ";", "int", "(", "*", "ioctl", ")", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", ";", "int", "(", "*", "outputc", ")", "(", "int", "dev", ",", "unsigned", "char", "data", ")", ";", "int", "(", "*", "start_read", ")", "(", "int", "dev", ")", ";", "int", "(", "*", "end_read", ")", "(", "int", "dev", ")", ";", "void", "(", "*", "kick", ")", "(", "int", "dev", ")", ";", "int", "(", "*", "command", ")", "(", "int", "dev", ",", "unsigned", "char", "*", "data", ")", ";", "int", "(", "*", "buffer_status", ")", "(", "int", "dev", ")", ";", "int", "(", "*", "prefix_cmd", ")", "(", "int", "dev", ",", "unsigned", "char", "status", ")", ";", "struct", "coproc_operations", "*", "coproc", ";", "void", "*", "devc", ";", "}", ";", "struct", "sound_lowlev_timer", "{", "int", "dev", ";", "int", "priority", ";", "unsigned", "int", "(", "*", "tmr_start", ")", "(", "int", "dev", ",", "unsigned", "int", "usecs", ")", ";", "void", "(", "*", "tmr_disable", ")", "(", "int", "dev", ")", ";", "void", "(", "*", "tmr_restart", ")", "(", "int", "dev", ")", ";", "}", ";", "struct", "sound_timer_operations", "{", "struct", "module", "*", "owner", ";", "struct", "sound_timer_info", "info", ";", "int", "priority", ";", "int", "devlink", ";", "int", "(", "*", "open", ")", "(", "int", "dev", ",", "int", "mode", ")", ";", "void", "(", "*", "close", ")", "(", "int", "dev", ")", ";", "int", "(", "*", "event", ")", "(", "int", "dev", ",", "unsigned", "char", "*", "ev", ")", ";", "unsigned", "long", "(", "*", "get_time", ")", "(", "int", "dev", ")", ";", "int", "(", "*", "ioctl", ")", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", ";", "void", "(", "*", "arm_timer", ")", "(", "int", "dev", ",", "long", "time", ")", ";", "}", ";", "extern", "struct", "sound_timer_operations", "default_sound_timer", ";", "extern", "struct", "audio_operations", "*", "audio_devs", "[", "MAX_AUDIO_DEV", "]", ";", "extern", "int", "num_audiodevs", ";", "extern", "struct", "mixer_operations", "*", "mixer_devs", "[", "MAX_MIXER_DEV", "]", ";", "extern", "int", "num_mixers", ";", "extern", "struct", "synth_operations", "*", "synth_devs", "[", "MAX_SYNTH_DEV", "+", "MAX_MIDI_DEV", "]", ";", "extern", "int", "num_synths", ";", "extern", "struct", "midi_operations", "*", "midi_devs", "[", "MAX_MIDI_DEV", "]", ";", "extern", "int", "num_midis", ";", "extern", "struct", "sound_timer_operations", "*", "sound_timer_devs", "[", "MAX_TIMER_DEV", "]", ";", "extern", "int", "num_sound_timers", ";", "extern", "int", "sound_map_buffer", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ",", "buffmem_desc", "*", "info", ")", ";", "void", "sound_timer_init", "(", "struct", "sound_lowlev_timer", "*", "t", ",", "char", "*", "name", ")", ";", "void", "sound_dma_intr", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ",", "int", "chan", ")", ";", "#", "define", "AUDIO_DRIVER_VERSION", "2", "#", "define", "MIXER_DRIVER_VERSION", "2", "int", "sound_install_audiodrv", "(", "int", "vers", ",", "char", "*", "name", ",", "struct", "audio_driver", "*", "driver", ",", "int", "driver_size", ",", "int", "flags", ",", "unsigned", "int", "format_mask", ",", "void", "*", "devc", ",", "int", "dma1", ",", "int", "dma2", ")", ";", "int", "sound_install_mixer", "(", "int", "vers", ",", "char", "*", "name", ",", "struct", "mixer_operations", "*", "driver", ",", "int", "driver_size", ",", "void", "*", "devc", ")", ";", "void", "sound_unload_audiodev", "(", "int", "dev", ")", ";", "void", "sound_unload_mixerdev", "(", "int", "dev", ")", ";", "void", "sound_unload_mididev", "(", "int", "dev", ")", ";", "void", "sound_unload_synthdev", "(", "int", "dev", ")", ";", "void", "sound_unload_timerdev", "(", "int", "dev", ")", ";", "int", "sound_alloc_mixerdev", "(", "void", ")", ";", "int", "sound_alloc_timerdev", "(", "void", ")", ";", "int", "sound_alloc_synthdev", "(", "void", ")", ";", "int", "sound_alloc_mididev", "(", "void", ")", ";", "#", "endif", "/", "*", "_DEV_TABLE_H_", "*", "/", "@", "@", "-", "1", ",", "1268", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "dmabuf", ".", "c", "*", "*", "The", "DMA", "buffer", "manager", "for", "digitized", "voice", "applications", "*", "/", "/", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "*", "Thomas", "Sailer", ":", "moved", "several", "static", "variables", "into", "struct", "audio_operations", "*", "(", "which", "is", "grossly", "misnamed", "btw", ".", ")", "because", "they", "have", "the", "same", "*", "lifetime", "as", "the", "rest", "in", "there", "and", "dynamic", "allocation", "saves", "*", "12k", "or", "so", "*", "Thomas", "Sailer", ":", "remove", "{", "in", ",", "out", "}", "_sleep_flag", ".", "It", "was", "used", "for", "the", "sleeper", "to", "*", "determine", "if", "it", "was", "woken", "up", "by", "the", "expiring", "timeout", "or", "by", "*", "an", "explicit", "wake_up", ".", "The", "return", "value", "from", "schedule_timeout", "*", "can", "be", "used", "instead", ";", "if", "0", ",", "the", "wakeup", "was", "due", "to", "the", "timeout", ".", "*", "*", "Rob", "Riggs", "Added", "persistent", "DMA", "buffers", "(", "1998", "/", "10", "/", "17", ")", "*", "/", "#", "define", "BE_CONSERVATIVE", "#", "define", "SAMPLE_ROUNDUP", "0", "#", "include", "<", "linux", "/", "mm", ".", "h", ">", "#", "include", "<", "linux", "/", "gfp", ".", "h", ">", "#", "include", "<", "linux", "/", "sched", "/", "signal", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "sleep", ".", "h", "\"", "#", "define", "DMAP_FREE_ON_CLOSE", "0", "#", "define", "DMAP_KEEP_ON_CLOSE", "1", "extern", "int", "sound_dmap_flag", ";", "static", "void", "dma_reset_output", "(", "int", "dev", ")", ";", "static", "void", "dma_reset_input", "(", "int", "dev", ")", ";", "static", "int", "local_start_dma", "(", "struct", "audio_operations", "*", "adev", ",", "unsigned", "long", "physaddr", ",", "int", "count", ",", "int", "dma_mode", ")", ";", "static", "int", "debugmem", ";", "/", "*", "switched", "off", "by", "default", "*", "/", "static", "int", "dma_buffsize", "=", "DSP_BUFFSIZE", ";", "static", "long", "dmabuf_timeout", "(", "struct", "dma_buffparms", "*", "dmap", ")", "{", "long", "tmout", ";", "tmout", "=", "(", "dmap", "-", ">", "fragment_size", "*", "HZ", ")", "/", "dmap", "-", ">", "data_rate", ";", "tmout", "+", "=", "HZ", "/", "5", ";", "/", "*", "Some", "safety", "distance", "*", "/", "if", "(", "tmout", "<", "(", "HZ", "/", "2", ")", ")", "tmout", "=", "HZ", "/", "2", ";", "if", "(", "tmout", ">", "20", "*", "HZ", ")", "tmout", "=", "20", "*", "HZ", ";", "return", "tmout", ";", "}", "static", "int", "sound_alloc_dmap", "(", "struct", "dma_buffparms", "*", "dmap", ")", "{", "char", "*", "start_addr", ",", "*", "end_addr", ";", "int", "dma_pagesize", ";", "int", "sz", ",", "size", ";", "struct", "page", "*", "page", ";", "dmap", "-", ">", "mapping_flags", "&", "=", "~", "DMA_MAP_MAPPED", ";", "if", "(", "dmap", "-", ">", "raw_buf", "!", "=", "NULL", ")", "return", "0", ";", "/", "*", "Already", "done", "*", "/", "if", "(", "dma_buffsize", "<", "4096", ")", "dma_buffsize", "=", "4096", ";", "dma_pagesize", "=", "(", "dmap", "-", ">", "dma", "<", "4", ")", "?", "(", "64", "*", "1024", ")", ":", "(", "128", "*", "1024", ")", ";", "/", "*", "*", "Now", "check", "for", "the", "Cyrix", "problem", ".", "*", "/", "if", "(", "isa_dma_bridge_buggy", "=", "=", "2", ")", "dma_pagesize", "=", "32768", ";", "dmap", "-", ">", "raw_buf", "=", "NULL", ";", "dmap", "-", ">", "buffsize", "=", "dma_buffsize", ";", "if", "(", "dmap", "-", ">", "buffsize", ">", "dma_pagesize", ")", "dmap", "-", ">", "buffsize", "=", "dma_pagesize", ";", "start_addr", "=", "NULL", ";", "/", "*", "*", "Now", "loop", "until", "we", "get", "a", "free", "buffer", ".", "Try", "to", "get", "smaller", "buffer", "if", "*", "it", "fails", ".", "Don", "'", "t", "accept", "smaller", "than", "8k", "buffer", "for", "performance", "*", "reasons", ".", "*", "/", "while", "(", "start_addr", "=", "=", "NULL", "&", "&", "dmap", "-", ">", "buffsize", ">", "PAGE_SIZE", ")", "{", "for", "(", "sz", "=", "0", ",", "size", "=", "PAGE_SIZE", ";", "size", "<", "dmap", "-", ">", "buffsize", ";", "sz", "+", "+,", "size", "<", "<=", "1", ")", ";", "dmap", "-", ">", "buffsize", "=", "PAGE_SIZE", "*", "(", "1", "<", "<", "sz", ")", ";", "start_addr", "=", "(", "char", "*", ")", "__get_free_pages", "(", "GFP_ATOMIC", "|", "GFP_DMA", "|", "__GFP_NOWARN", ",", "sz", ")", ";", "if", "(", "start_addr", "=", "=", "NULL", ")", "dmap", "-", ">", "buffsize", "/", "=", "2", ";", "}", "if", "(", "start_addr", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_WARNING", "\"", "Sound", "error", ":", "Couldn", "'", "t", "allocate", "DMA", "buffer", "\\", "n", "\"", ");", "return", "-", "ENOMEM", ";", "}", "else", "{", "/", "*", "make", "some", "checks", "*", "/", "end_addr", "=", "start_addr", "+", "dmap", "-", ">", "buffsize", "-", "1", ";", "if", "(", "debugmem", ")", "printk", "(", "KERN_DEBUG", "\"", "sound", ":", "start", "0x", "%", "lx", ",", "end", "0x", "%", "lx", "\\", "n", "\"", ",", "(", "long", ")", "start_addr", ",", "(", "long", ")", "end_addr", ")", ";", "/", "*", "now", "check", "if", "it", "fits", "into", "the", "same", "dma", "-", "pagesize", "*", "/", "if", "(", "((", "long", ")", "start_addr", "&", "~", "(", "dma_pagesize", "-", "1", ")", ")", "!", "=", "(", "(", "long", ")", "end_addr", "&", "~", "(", "dma_pagesize", "-", "1", ")", ")", "|", "|", "end_addr", ">", "=", "(", "char", "*", ")", "(", "MAX_DMA_ADDRESS", ")", ")", "{", "printk", "(", "KERN_ERR", "\"", "sound", ":", "Got", "invalid", "address", "0x", "%", "lx", "for", "%", "db", "DMA", "-", "buffer", "\\", "n", "\"", ",", "(", "long", ")", "start_addr", ",", "dmap", "-", ">", "buffsize", ")", ";", "return", "-", "EFAULT", ";", "}", "}", "dmap", "-", ">", "raw_buf", "=", "start_addr", ";", "dmap", "-", ">", "raw_buf_phys", "=", "dma_map_single", "(", "NULL", ",", "start_addr", ",", "dmap", "-", ">", "buffsize", ",", "DMA_BIDIRECTIONAL", ")", ";", "for", "(", "page", "=", "virt_to_page", "(", "start_addr", ")", ";", "page", "<", "=", "virt_to_page", "(", "end_addr", ")", ";", "page", "+", "+)", "SetPageReserved", "(", "page", ")", ";", "return", "0", ";", "}", "static", "void", "sound_free_dmap", "(", "struct", "dma_buffparms", "*", "dmap", ")", "{", "int", "sz", ",", "size", ";", "struct", "page", "*", "page", ";", "unsigned", "long", "start_addr", ",", "end_addr", ";", "if", "(", "dmap", "-", ">", "raw_buf", "=", "=", "NULL", ")", "return", ";", "if", "(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "return", ";", "/", "*", "Don", "'", "t", "free", "mmapped", "buffer", ".", "Will", "use", "it", "next", "time", "*", "/", "for", "(", "sz", "=", "0", ",", "size", "=", "PAGE_SIZE", ";", "size", "<", "dmap", "-", ">", "buffsize", ";", "sz", "+", "+,", "size", "<", "<=", "1", ")", ";", "start_addr", "=", "(", "unsigned", "long", ")", "dmap", "-", ">", "raw_buf", ";", "end_addr", "=", "start_addr", "+", "dmap", "-", ">", "buffsize", ";", "for", "(", "page", "=", "virt_to_page", "(", "start_addr", ")", ";", "page", "<", "=", "virt_to_page", "(", "end_addr", ")", ";", "page", "+", "+)", "ClearPageReserved", "(", "page", ")", ";", "dma_unmap_single", "(", "NULL", ",", "dmap", "-", ">", "raw_buf_phys", ",", "dmap", "-", ">", "buffsize", ",", "DMA_BIDIRECTIONAL", ")", ";", "free_pages", "(", "(", "unsigned", "long", ")", "dmap", "-", ">", "raw_buf", ",", "sz", ")", ";", "dmap", "-", ">", "raw_buf", "=", "NULL", ";", "}", "/", "*", "Intel", "version", "!", "!!", "!!", "!!", "!!", "*", "/", "static", "int", "sound_start_dma", "(", "struct", "dma_buffparms", "*", "dmap", ",", "unsigned", "long", "physaddr", ",", "int", "count", ",", "int", "dma_mode", ")", "{", "unsigned", "long", "flags", ";", "int", "chan", "=", "dmap", "-", ">", "dma", ";", "/", "*", "printk", "(", "\"", "Start", "DMA", "%", "d", "%", "d", ",", "%", "d", "\\", "n", "\"", ",", "chan", ",", "(", "int", ")", "(", "physaddr", "-", "dmap", "-", ">", "raw_buf_phys", ")", ",", "count", ")", ";", "*", "/", "flags", "=", "claim_dma_lock", "(", ");", "disable_dma", "(", "chan", ")", ";", "clear_dma_ff", "(", "chan", ")", ";", "set_dma_mode", "(", "chan", ",", "dma_mode", ")", ";", "set_dma_addr", "(", "chan", ",", "physaddr", ")", ";", "set_dma_count", "(", "chan", ",", "count", ")", ";", "enable_dma", "(", "chan", ")", ";", "release_dma_lock", "(", "flags", ")", ";", "return", "0", ";", "}", "static", "void", "dma_init_buffers", "(", "struct", "dma_buffparms", "*", "dmap", ")", "{", "dmap", "-", ">", "qlen", "=", "dmap", "-", ">", "qhead", "=", "dmap", "-", ">", "qtail", "=", "dmap", "-", ">", "user_counter", "=", "0", ";", "dmap", "-", ">", "byte_counter", "=", "0", ";", "dmap", "-", ">", "max_byte_counter", "=", "8000", "*", "60", "*", "60", ";", "dmap", "-", ">", "bytes_in_use", "=", "dmap", "-", ">", "buffsize", ";", "dmap", "-", ">", "dma_mode", "=", "DMODE_NONE", ";", "dmap", "-", ">", "mapping_flags", "=", "0", ";", "dmap", "-", ">", "neutral_byte", "=", "0x80", ";", "dmap", "-", ">", "data_rate", "=", "8000", ";", "dmap", "-", ">", "cfrag", "=", "-", "1", ";", "dmap", "-", ">", "closing", "=", "0", ";", "dmap", "-", ">", "nbufs", "=", "1", ";", "dmap", "-", ">", "flags", "=", "DMA_BUSY", ";", "/", "*", "Other", "flags", "off", "*", "/", "}", "static", "int", "open_dmap", "(", "struct", "audio_operations", "*", "adev", ",", "int", "mode", ",", "struct", "dma_buffparms", "*", "dmap", ")", "{", "int", "err", ";", "if", "(", "dmap", "-", ">", "flags", "&", "DMA_BUSY", ")", "return", "-", "EBUSY", ";", "if", "(", "(", "err", "=", "sound_alloc_dmap", "(", "dmap", ")", ")", "<", "0", ")", "return", "err", ";", "if", "(", "dmap", "-", ">", "raw_buf", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_WARNING", "\"", "Sound", ":", "DMA", "buffers", "not", "available", "\\", "n", "\"", ");", "return", "-", "ENOSPC", ";", "/", "*", "Memory", "allocation", "failed", "during", "boot", "*", "/", "}", "if", "(", "dmap", "-", ">", "dma", ">", "=", "0", "&", "&", "sound_open_dma", "(", "dmap", "-", ">", "dma", ",", "adev", "-", ">", "name", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "Unable", "to", "grab", "(", "2", ")", "DMA", "%", "d", "for", "the", "audio", "driver", "\\", "n", "\"", ",", "dmap", "-", ">", "dma", ")", ";", "return", "-", "EBUSY", ";", "}", "dma_init_buffers", "(", "dmap", ")", ";", "spin_lock_init", "(", "&", "dmap", "-", ">", "lock", ")", ";", "dmap", "-", ">", "open_mode", "=", "mode", ";", "dmap", "-", ">", "subdivision", "=", "dmap", "-", ">", "underrun_count", "=", "0", ";", "dmap", "-", ">", "fragment_size", "=", "0", ";", "dmap", "-", ">", "max_fragments", "=", "65536", ";", "/", "*", "Just", "a", "large", "value", "*", "/", "dmap", "-", ">", "byte_counter", "=", "0", ";", "dmap", "-", ">", "max_byte_counter", "=", "8000", "*", "60", "*", "60", ";", "dmap", "-", ">", "applic_profile", "=", "APF_NORMAL", ";", "dmap", "-", ">", "needs_reorg", "=", "1", ";", "dmap", "-", ">", "audio_callback", "=", "NULL", ";", "dmap", "-", ">", "callback_parm", "=", "0", ";", "return", "0", ";", "}", "static", "void", "close_dmap", "(", "struct", "audio_operations", "*", "adev", ",", "struct", "dma_buffparms", "*", "dmap", ")", "{", "unsigned", "long", "flags", ";", "if", "(", "dmap", "-", ">", "dma", ">", "=", "0", ")", "{", "sound_close_dma", "(", "dmap", "-", ">", "dma", ")", ";", "flags", "=", "claim_dma_lock", "(", ");", "disable_dma", "(", "dmap", "-", ">", "dma", ")", ";", "release_dma_lock", "(", "flags", ")", ";", "}", "if", "(", "dmap", "-", ">", "flags", "&", "DMA_BUSY", ")", "dmap", "-", ">", "dma_mode", "=", "DMODE_NONE", ";", "dmap", "-", ">", "flags", "&", "=", "~", "DMA_BUSY", ";", "if", "(", "sound_dmap_flag", "=", "=", "DMAP_FREE_ON_CLOSE", ")", "sound_free_dmap", "(", "dmap", ")", ";", "}", "static", "unsigned", "int", "default_set_bits", "(", "int", "dev", ",", "unsigned", "int", "bits", ")", "{", "mm_segment_t", "fs", "=", "get_fs", "(", ");", "set_fs", "(", "get_ds", "(", "))", ";", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "ioctl", "(", "dev", ",", "SNDCTL_DSP_SETFMT", ",", "(", "void", "__user", "*", ")&", "bits", ")", ";", "set_fs", "(", "fs", ")", ";", "return", "bits", ";", "}", "static", "int", "default_set_speed", "(", "int", "dev", ",", "int", "speed", ")", "{", "mm_segment_t", "fs", "=", "get_fs", "(", ");", "set_fs", "(", "get_ds", "(", "))", ";", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "ioctl", "(", "dev", ",", "SNDCTL_DSP_SPEED", ",", "(", "void", "__user", "*", ")&", "speed", ")", ";", "set_fs", "(", "fs", ")", ";", "return", "speed", ";", "}", "static", "short", "default_set_channels", "(", "int", "dev", ",", "short", "channels", ")", "{", "int", "c", "=", "channels", ";", "mm_segment_t", "fs", "=", "get_fs", "(", ");", "set_fs", "(", "get_ds", "(", "))", ";", "audio_devs", "[", "dev", "]", "->", "d", "-", ">", "ioctl", "(", "dev", ",", "SNDCTL_DSP_CHANNELS", ",", "(", "void", "__user", "*", ")&", "c", ")", ";", "set_fs", "(", "fs", ")", ";", "return", "c", ";", "}", "static", "void", "check_driver", "(", "struct", "audio_driver", "*", "d", ")", "{", "if", "(", "d", "-", ">", "set_speed", "=", "=", "NULL", ")", "d", "-", ">", "set_speed", "=", "default_set_speed", ";", "if", "(", "d", "-", ">", "set_bits", "=", "=", "NULL", ")", "d", "-", ">", "set_bits", "=", "default_set_bits", ";", "if", "(", "d", "-", ">", "set_channels", "=", "=", "NULL", ")", "d", "-", ">", "set_channels", "=", "default_set_channels", ";", "}", "int", "DMAbuf_open", "(", "int", "dev", ",", "int", "mode", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "int", "retval", ";", "struct", "dma_buffparms", "*", "dmap_in", "=", "NULL", ";", "struct", "dma_buffparms", "*", "dmap_out", "=", "NULL", ";", "if", "(", "!", "adev", ")", "return", "-", "ENXIO", ";", "if", "(", "!(", "adev", "-", ">", "flags", "&", "DMA_DUPLEX", ")", ")", "adev", "-", ">", "dmap_in", "=", "adev", "-", ">", "dmap_out", ";", "check_driver", "(", "adev", "-", ">", "d", ")", ";", "if", "(", "(", "retval", "=", "adev", "-", ">", "d", "-", ">", "open", "(", "dev", ",", "mode", ")", ")", "<", "0", ")", "return", "retval", ";", "dmap_out", "=", "adev", "-", ">", "dmap_out", ";", "dmap_in", "=", "adev", "-", ">", "dmap_in", ";", "if", "(", "dmap_in", "=", "=", "dmap_out", ")", "adev", "-", ">", "flags", "&", "=", "~", "DMA_DUPLEX", ";", "if", "(", "mode", "&", "OPEN_WRITE", ")", "{", "if", "(", "(", "retval", "=", "open_dmap", "(", "adev", ",", "mode", ",", "dmap_out", ")", ")", "<", "0", ")", "{", "adev", "-", ">", "d", "-", ">", "close", "(", "dev", ")", ";", "return", "retval", ";", "}", "}", "adev", "-", ">", "enable_bits", "=", "mode", ";", "if", "(", "mode", "=", "=", "OPEN_READ", "|", "|", "(", "mode", "!", "=", "OPEN_WRITE", "&", "&", "(", "adev", "-", ">", "flags", "&", "DMA_DUPLEX", ")", "))", "{", "if", "(", "(", "retval", "=", "open_dmap", "(", "adev", ",", "mode", ",", "dmap_in", ")", ")", "<", "0", ")", "{", "adev", "-", ">", "d", "-", ">", "close", "(", "dev", ")", ";", "if", "(", "mode", "&", "OPEN_WRITE", ")", "close_dmap", "(", "adev", ",", "dmap_out", ")", ";", "return", "retval", ";", "}", "}", "adev", "-", ">", "open_mode", "=", "mode", ";", "adev", "-", ">", "go", "=", "1", ";", "adev", "-", ">", "d", "-", ">", "set_bits", "(", "dev", ",", "8", ")", ";", "adev", "-", ">", "d", "-", ">", "set_channels", "(", "dev", ",", "1", ")", ";", "adev", "-", ">", "d", "-", ">", "set_speed", "(", "dev", ",", "DSP_DEFAULT_SPEED", ")", ";", "if", "(", "adev", "-", ">", "dmap_out", "-", ">", "dma_mode", "=", "=", "DMODE_OUTPUT", ")", "memset", "(", "adev", "-", ">", "dmap_out", "-", ">", "raw_buf", ",", "adev", "-", ">", "dmap_out", "-", ">", "neutral_byte", ",", "adev", "-", ">", "dmap_out", "-", ">", "bytes_in_use", ")", ";", "return", "0", ";", "}", "/", "*", "MUST", "not", "hold", "the", "spinlock", "*", "/", "void", "DMAbuf_reset", "(", "int", "dev", ")", "{", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_WRITE", ")", "dma_reset_output", "(", "dev", ")", ";", "if", "(", "audio_devs", "[", "dev", "]", "->", "open_mode", "&", "OPEN_READ", ")", "dma_reset_input", "(", "dev", ")", ";", "}", "static", "void", "dma_reset_output", "(", "int", "dev", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "unsigned", "long", "flags", ",", "f", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_STARTED", ")", ")", "/", "*", "DMA", "is", "not", "active", "*", "/", "return", ";", "/", "*", "*", "First", "wait", "until", "the", "current", "fragment", "has", "been", "played", "completely", "*", "/", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "adev", "-", ">", "dmap_out", "-", ">", "flags", "|", "=", "DMA_SYNCING", ";", "adev", "-", ">", "dmap_out", "-", ">", "underrun_count", "=", "0", ";", "if", "(", "!", "signal_pending", "(", "current", ")", "&", "&", "adev", "-", ">", "dmap_out", "-", ">", "qlen", "&", "&", "adev", "-", ">", "dmap_out", "-", ">", "underrun_count", "=", "=", "0", ")", "{", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "oss_broken_sleep_on", "(", "&", "adev", "-", ">", "out_sleeper", ",", "dmabuf_timeout", "(", "dmap", ")", ");", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "adev", "-", ">", "dmap_out", "-", ">", "flags", "&", "=", "~", "(", "DMA_SYNCING", "|", "DMA_ACTIVE", ")", ";", "/", "*", "*", "Finally", "shut", "the", "device", "off", "*", "/", "if", "(", "!(", "adev", "-", ">", "flags", "&", "DMA_DUPLEX", ")", "|", "|", "!", "adev", "-", ">", "d", "-", ">", "halt_output", ")", "adev", "-", ">", "d", "-", ">", "halt_io", "(", "dev", ")", ";", "else", "adev", "-", ">", "d", "-", ">", "halt_output", "(", "dev", ")", ";", "adev", "-", ">", "dmap_out", "-", ">", "flags", "&", "=", "~", "DMA_STARTED", ";", "f", "=", "claim_dma_lock", "(", ");", "clear_dma_ff", "(", "dmap", "-", ">", "dma", ")", ";", "disable_dma", "(", "dmap", "-", ">", "dma", ")", ";", "release_dma_lock", "(", "f", ")", ";", "dmap", "-", ">", "byte_counter", "=", "0", ";", "reorganize_buffers", "(", "dev", ",", "adev", "-", ">", "dmap_out", ",", "0", ")", ";", "dmap", "-", ">", "qlen", "=", "dmap", "-", ">", "qhead", "=", "dmap", "-", ">", "qtail", "=", "dmap", "-", ">", "user_counter", "=", "0", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "static", "void", "dma_reset_input", "(", "int", "dev", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "unsigned", "long", "flags", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_in", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "!(", "adev", "-", ">", "flags", "&", "DMA_DUPLEX", ")", "|", "|", "!", "adev", "-", ">", "d", "-", ">", "halt_input", ")", "adev", "-", ">", "d", "-", ">", "halt_io", "(", "dev", ")", ";", "else", "adev", "-", ">", "d", "-", ">", "halt_input", "(", "dev", ")", ";", "adev", "-", ">", "dmap_in", "-", ">", "flags", "&", "=", "~", "DMA_STARTED", ";", "dmap", "-", ">", "qlen", "=", "dmap", "-", ">", "qhead", "=", "dmap", "-", ">", "qtail", "=", "dmap", "-", ">", "user_counter", "=", "0", ";", "dmap", "-", ">", "byte_counter", "=", "0", ";", "reorganize_buffers", "(", "dev", ",", "adev", "-", ">", "dmap_in", ",", "1", ")", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "/", "*", "MUST", "be", "called", "with", "holding", "the", "dmap", "-", ">", "lock", "*", "/", "void", "DMAbuf_launch_output", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "if", "(", "!(", "(", "adev", "-", ">", "enable_bits", "*", "adev", "-", ">", "go", ")", "&", "PCM_ENABLE_OUTPUT", ")", ")", "return", ";", "/", "*", "Don", "'", "t", "start", "DMA", "yet", "*", "/", "dmap", "-", ">", "dma_mode", "=", "DMODE_OUTPUT", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_ACTIVE", ")", "|", "|", "!", "(", "adev", "-", ">", "flags", "&", "DMA_AUTOMODE", ")", "|", "|", "(", "dmap", "-", ">", "flags", "&", "DMA_NODMA", ")", ")", "{", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_STARTED", ")", ")", "{", "reorganize_buffers", "(", "dev", ",", "dmap", ",", "0", ")", ";", "if", "(", "adev", "-", ">", "d", "-", ">", "prepare_for_output", "(", "dev", ",", "dmap", "-", ">", "fragment_size", ",", "dmap", "-", ">", "nbufs", ")", ")", "return", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_NODMA", ")", ")", "local_start_dma", "(", "adev", ",", "dmap", "-", ">", "raw_buf_phys", ",", "dmap", "-", ">", "bytes_in_use", ",", "DMA_MODE_WRITE", ")", ";", "dmap", "-", ">", "flags", "|", "=", "DMA_STARTED", ";", "}", "if", "(", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", "=", "=", "0", ")", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", "=", "dmap", "-", ">", "fragment_size", ";", "dmap", "-", ">", "dma_mode", "=", "DMODE_OUTPUT", ";", "adev", "-", ">", "d", "-", ">", "output_block", "(", "dev", ",", "dmap", "-", ">", "raw_buf_phys", "+", "dmap", "-", ">", "qhead", "*", "dmap", "-", ">", "fragment_size", ",", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", ",", "1", ")", ";", "if", "(", "adev", "-", ">", "d", "-", ">", "trigger", ")", "adev", "-", ">", "d", "-", ">", "trigger", "(", "dev", ",", "adev", "-", ">", "enable_bits", "*", "adev", "-", ">", "go", ")", ";", "}", "dmap", "-", ">", "flags", "|", "=", "DMA_ACTIVE", ";", "}", "int", "DMAbuf_sync", "(", "int", "dev", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "unsigned", "long", "flags", ";", "int", "n", "=", "0", ";", "struct", "dma_buffparms", "*", "dmap", ";", "if", "(", "!", "adev", "-", ">", "go", "&", "&", "!", "(", "adev", "-", ">", "enable_bits", "&", "PCM_ENABLE_OUTPUT", ")", ")", "return", "0", ";", "if", "(", "adev", "-", ">", "dmap_out", "-", ">", "dma_mode", "=", "=", "DMODE_OUTPUT", ")", "{", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "dmap", "-", ">", "qlen", ">", "0", "&", "&", "!", "(", "dmap", "-", ">", "flags", "&", "DMA_ACTIVE", ")", ")", "DMAbuf_launch_output", "(", "dev", ",", "dmap", ")", ";", "adev", "-", ">", "dmap_out", "-", ">", "flags", "|", "=", "DMA_SYNCING", ";", "adev", "-", ">", "dmap_out", "-", ">", "underrun_count", "=", "0", ";", "while", "(", "!", "signal_pending", "(", "current", ")", "&", "&", "n", "+", "+", "<", "adev", "-", ">", "dmap_out", "-", ">", "nbufs", "&", "&", "adev", "-", ">", "dmap_out", "-", ">", "qlen", "&", "&", "adev", "-", ">", "dmap_out", "-", ">", "underrun_count", "=", "=", "0", ")", "{", "long", "t", "=", "dmabuf_timeout", "(", "dmap", ")", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "/", "*", "FIXME", ":", "not", "safe", "may", "miss", "events", "*", "/", "t", "=", "oss_broken_sleep_on", "(", "&", "adev", "-", ">", "out_sleeper", ",", "t", ")", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "!", "t", ")", "{", "adev", "-", ">", "dmap_out", "-", ">", "flags", "&", "=", "~", "DMA_SYNCING", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "return", "adev", "-", ">", "dmap_out", "-", ">", "qlen", ";", "}", "}", "adev", "-", ">", "dmap_out", "-", ">", "flags", "&", "=", "~", "(", "DMA_SYNCING", "|", "DMA_ACTIVE", ")", ";", "/", "*", "*", "Some", "devices", "such", "as", "GUS", "have", "huge", "amount", "of", "on", "board", "RAM", "for", "the", "*", "audio", "data", ".", "We", "have", "to", "wait", "until", "the", "device", "has", "finished", "playing", ".", "*", "/", "/", "*", "still", "holding", "the", "lock", "*", "/", "if", "(", "adev", "-", ">", "d", "-", ">", "local_qlen", ")", "{", "/", "*", "Device", "has", "hidden", "buffers", "*", "/", "while", "(", "!", "signal_pending", "(", "current", ")", "&", "&", "adev", "-", ">", "d", "-", ">", "local_qlen", "(", "dev", ")", "){", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "oss_broken_sleep_on", "(", "&", "adev", "-", ">", "out_sleeper", ",", "dmabuf_timeout", "(", "dmap", ")", ");", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "}", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "adev", "-", ">", "dmap_out", "-", ">", "dma_mode", "=", "DMODE_NONE", ";", "return", "adev", "-", ">", "dmap_out", "-", ">", "qlen", ";", "}", "int", "DMAbuf_release", "(", "int", "dev", ",", "int", "mode", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", ";", "unsigned", "long", "flags", ";", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "if", "(", "adev", "-", ">", "open_mode", "&", "OPEN_WRITE", ")", "adev", "-", ">", "dmap_out", "-", ">", "closing", "=", "1", ";", "if", "(", "adev", "-", ">", "open_mode", "&", "OPEN_READ", ")", "{", "adev", "-", ">", "dmap_in", "-", ">", "closing", "=", "1", ";", "dmap", "=", "adev", "-", ">", "dmap_in", ";", "}", "if", "(", "adev", "-", ">", "open_mode", "&", "OPEN_WRITE", ")", "if", "(", "!(", "adev", "-", ">", "dmap_out", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", ")", "if", "(", "!", "signal_pending", "(", "current", ")", "&", "&", "(", "adev", "-", ">", "dmap_out", "-", ">", "dma_mode", "=", "=", "DMODE_OUTPUT", ")", ")", "DMAbuf_sync", "(", "dev", ")", ";", "if", "(", "adev", "-", ">", "dmap_out", "-", ">", "dma_mode", "=", "=", "DMODE_OUTPUT", ")", "memset", "(", "adev", "-", ">", "dmap_out", "-", ">", "raw_buf", ",", "adev", "-", ">", "dmap_out", "-", ">", "neutral_byte", ",", "adev", "-", ">", "dmap_out", "-", ">", "bytes_in_use", ")", ";", "DMAbuf_reset", "(", "dev", ")", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "adev", "-", ">", "d", "-", ">", "close", "(", "dev", ")", ";", "if", "(", "adev", "-", ">", "open_mode", "&", "OPEN_WRITE", ")", "close_dmap", "(", "adev", ",", "adev", "-", ">", "dmap_out", ")", ";", "if", "(", "adev", "-", ">", "open_mode", "=", "=", "OPEN_READ", "|", "|", "(", "adev", "-", ">", "open_mode", "!", "=", "OPEN_WRITE", "&", "&", "(", "adev", "-", ">", "flags", "&", "DMA_DUPLEX", ")", "))", "close_dmap", "(", "adev", ",", "adev", "-", ">", "dmap_in", ")", ";", "adev", "-", ">", "open_mode", "=", "0", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "return", "0", ";", "}", "/", "*", "called", "with", "dmap", "-", ">", "lock", "dold", "*", "/", "int", "DMAbuf_activate_recording", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "int", "err", ";", "if", "(", "!(", "adev", "-", ">", "open_mode", "&", "OPEN_READ", ")", ")", "return", "0", ";", "if", "(", "!(", "adev", "-", ">", "enable_bits", "&", "PCM_ENABLE_INPUT", ")", ")", "return", "0", ";", "if", "(", "dmap", "-", ">", "dma_mode", "=", "=", "DMODE_OUTPUT", ")", "{", "/", "*", "Direction", "change", "*", "/", "/", "*", "release", "lock", "-", "it", "'", "s", "not", "recursive", "*", "/", "spin_unlock_irq", "(", "&", "dmap", "-", ">", "lock", ")", ";", "DMAbuf_sync", "(", "dev", ")", ";", "DMAbuf_reset", "(", "dev", ")", ";", "spin_lock_irq", "(", "&", "dmap", "-", ">", "lock", ")", ";", "dmap", "-", ">", "dma_mode", "=", "DMODE_NONE", ";", "}", "if", "(", "!", "dmap", "-", ">", "dma_mode", ")", "{", "reorganize_buffers", "(", "dev", ",", "dmap", ",", "1", ")", ";", "if", "(", "(", "err", "=", "adev", "-", ">", "d", "-", ">", "prepare_for_input", "(", "dev", ",", "dmap", "-", ">", "fragment_size", ",", "dmap", "-", ">", "nbufs", ")", ")", "<", "0", ")", "return", "err", ";", "dmap", "-", ">", "dma_mode", "=", "DMODE_INPUT", ";", "}", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_ACTIVE", ")", ")", "{", "if", "(", "dmap", "-", ">", "needs_reorg", ")", "reorganize_buffers", "(", "dev", ",", "dmap", ",", "0", ")", ";", "local_start_dma", "(", "adev", ",", "dmap", "-", ">", "raw_buf_phys", ",", "dmap", "-", ">", "bytes_in_use", ",", "DMA_MODE_READ", ")", ";", "adev", "-", ">", "d", "-", ">", "start_input", "(", "dev", ",", "dmap", "-", ">", "raw_buf_phys", "+", "dmap", "-", ">", "qtail", "*", "dmap", "-", ">", "fragment_size", ",", "dmap", "-", ">", "fragment_size", ",", "0", ")", ";", "dmap", "-", ">", "flags", "|", "=", "DMA_ACTIVE", ";", "if", "(", "adev", "-", ">", "d", "-", ">", "trigger", ")", "adev", "-", ">", "d", "-", ">", "trigger", "(", "dev", ",", "adev", "-", ">", "enable_bits", "*", "adev", "-", ">", "go", ")", ";", "}", "return", "0", ";", "}", "/", "*", "acquires", "lock", "*", "/", "int", "DMAbuf_getrdbuffer", "(", "int", "dev", ",", "char", "*", "*", "buf", ",", "int", "*", "len", ",", "int", "dontblock", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "unsigned", "long", "flags", ";", "int", "err", "=", "0", ",", "n", "=", "0", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_in", ";", "if", "(", "!(", "adev", "-", ">", "open_mode", "&", "OPEN_READ", ")", ")", "return", "-", "EIO", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "dmap", "-", ">", "needs_reorg", ")", "reorganize_buffers", "(", "dev", ",", "dmap", ",", "0", ")", ";", "if", "(", "adev", "-", ">", "dmap_in", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "{", "/", "*", "printk", "(", "KERN_WARNING", "\"", "Sound", ":", "Can", "'", "t", "read", "from", "mmapped", "device", "(", "1", ")", "\\", "n", "\"", ");", "*/", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "return", "-", "EINVAL", ";", "}", "else", "while", "(", "dmap", "-", ">", "qlen", "<", "=", "0", "&", "&", "n", "+", "+", "<", "10", ")", "{", "long", "timeout", "=", "MAX_SCHEDULE_TIMEOUT", ";", "if", "(", "!(", "adev", "-", ">", "enable_bits", "&", "PCM_ENABLE_INPUT", ")", "|", "|", "!", "adev", "-", ">", "go", ")", "{", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "return", "-", "EAGAIN", ";", "}", "if", "(", "(", "err", "=", "DMAbuf_activate_recording", "(", "dev", ",", "dmap", ")", ")", "<", "0", ")", "{", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "return", "err", ";", "}", "/", "*", "Wait", "for", "the", "next", "block", "*", "/", "if", "(", "dontblock", ")", "{", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "return", "-", "EAGAIN", ";", "}", "if", "(", "adev", "-", ">", "go", ")", "timeout", "=", "dmabuf_timeout", "(", "dmap", ")", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "timeout", "=", "oss_broken_sleep_on", "(", "&", "adev", "-", ">", "in_sleeper", ",", "timeout", ")", ";", "if", "(", "!", "timeout", ")", "{", "/", "*", "FIXME", ":", "include", "device", "name", "*", "/", "err", "=", "-", "EIO", ";", "printk", "(", "KERN_WARNING", "\"", "Sound", ":", "DMA", "(", "input", ")", "timed", "out", "-", "IRQ", "/", "DRQ", "config", "error", "?", "\\", "n", "\"", ");", "dma_reset_input", "(", "dev", ")", ";", "}", "else", "err", "=", "-", "EINTR", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "dmap", "-", ">", "qlen", "<", "=", "0", ")", "return", "err", "?", "err", ":", "-", "EINTR", ";", "*", "buf", "=", "&", "dmap", "-", ">", "raw_buf", "[", "dmap", "-", ">", "qhead", "*", "dmap", "-", ">", "fragment_size", "+", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", "];", "*", "len", "=", "dmap", "-", ">", "fragment_size", "-", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", ";", "return", "dmap", "-", ">", "qhead", ";", "}", "int", "DMAbuf_rmchars", "(", "int", "dev", ",", "int", "buff_no", ",", "int", "c", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_in", ";", "int", "p", "=", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", "+", "c", ";", "if", "(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "{", "/", "*", "printk", "(", "\"", "Sound", ":", "Can", "'", "t", "read", "from", "mmapped", "device", "(", "2", ")", "\\", "n", "\"", ");", "*/", "return", "-", "EINVAL", ";", "}", "else", "if", "(", "dmap", "-", ">", "qlen", "<", "=", "0", ")", "return", "-", "EIO", ";", "else", "if", "(", "p", ">", "=", "dmap", "-", ">", "fragment_size", ")", "{", "/", "*", "This", "buffer", "is", "completely", "empty", "*", "/", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", "=", "0", ";", "dmap", "-", ">", "qlen", "-", "-;", "dmap", "-", ">", "qhead", "=", "(", "dmap", "-", ">", "qhead", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "}", "else", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", "=", "p", ";", "return", "0", ";", "}", "/", "*", "MUST", "be", "called", "with", "dmap", "-", ">", "lock", "hold", "*", "/", "int", "DMAbuf_get_buffer_pointer", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ",", "int", "direction", ")", "{", "/", "*", "*", "Try", "to", "approximate", "the", "active", "byte", "position", "of", "the", "DMA", "pointer", "within", "the", "*", "buffer", "area", "as", "well", "as", "possible", ".", "*", "/", "int", "pos", ";", "unsigned", "long", "f", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_ACTIVE", ")", ")", "pos", "=", "0", ";", "else", "{", "int", "chan", "=", "dmap", "-", ">", "dma", ";", "f", "=", "claim_dma_lock", "(", ");", "clear_dma_ff", "(", "chan", ")", ";", "if", "(", "!", "isa_dma_bridge_buggy", ")", "disable_dma", "(", "dmap", "-", ">", "dma", ")", ";", "pos", "=", "get_dma_residue", "(", "chan", ")", ";", "pos", "=", "dmap", "-", ">", "bytes_in_use", "-", "pos", ";", "if", "(", "!(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", ")", "{", "if", "(", "direction", "=", "=", "DMODE_OUTPUT", ")", "{", "if", "(", "dmap", "-", ">", "qhead", "=", "=", "0", ")", "if", "(", "pos", ">", "dmap", "-", ">", "fragment_size", ")", "pos", "=", "0", ";", "}", "else", "{", "if", "(", "dmap", "-", ">", "qtail", "=", "=", "0", ")", "if", "(", "pos", ">", "dmap", "-", ">", "fragment_size", ")", "pos", "=", "0", ";", "}", "}", "if", "(", "pos", "<", "0", ")", "pos", "=", "0", ";", "if", "(", "pos", ">", "=", "dmap", "-", ">", "bytes_in_use", ")", "pos", "=", "0", ";", "if", "(", "!", "isa_dma_bridge_buggy", ")", "enable_dma", "(", "dmap", "-", ">", "dma", ")", ";", "release_dma_lock", "(", "f", ")", ";", "}", "/", "*", "printk", "(", "\"", "%", "04x", "\"", ",", "pos", ")", ";", "*", "/", "return", "pos", ";", "}", "/", "*", "*", "DMAbuf_start_devices", "(", ")", "is", "called", "by", "the", "/", "dev", "/", "music", "driver", "to", "start", "*", "one", "or", "more", "audio", "devices", "at", "desired", "moment", ".", "*", "/", "void", "DMAbuf_start_devices", "(", "unsigned", "int", "devmask", ")", "{", "struct", "audio_operations", "*", "adev", ";", "int", "dev", ";", "for", "(", "dev", "=", "0", ";", "dev", "<", "num_audiodevs", ";", "dev", "+", "+)", "{", "if", "(", "!(", "devmask", "&", "(", "1", "<", "<", "dev", ")", "))", "continue", ";", "if", "(", "!(", "adev", "=", "audio_devs", "[", "dev", "]", "))", "continue", ";", "if", "(", "adev", "-", ">", "open_mode", "=", "=", "0", ")", "continue", ";", "if", "(", "adev", "-", ">", "go", ")", "continue", ";", "/", "*", "OK", "to", "start", "the", "device", "*", "/", "adev", "-", ">", "go", "=", "1", ";", "if", "(", "adev", "-", ">", "d", "-", ">", "trigger", ")", "adev", "-", ">", "d", "-", ">", "trigger", "(", "dev", ",", "adev", "-", ">", "enable_bits", "*", "adev", "-", ">", "go", ")", ";", "}", "}", "/", "*", "via", "poll", "called", "without", "a", "lock", "?", "*/", "int", "DMAbuf_space_in_queue", "(", "int", "dev", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "int", "len", ",", "max", ",", "tmp", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "int", "lim", "=", "dmap", "-", ">", "nbufs", ";", "if", "(", "lim", "<", "2", ")", "lim", "=", "2", ";", "if", "(", "dmap", "-", ">", "qlen", ">", "=", "lim", ")", "/", "*", "No", "space", "at", "all", "*", "/", "return", "0", ";", "/", "*", "*", "Verify", "that", "there", "are", "no", "more", "pending", "buffers", "than", "the", "limit", "*", "defined", "by", "the", "process", ".", "*", "/", "max", "=", "dmap", "-", ">", "max_fragments", ";", "if", "(", "max", ">", "lim", ")", "max", "=", "lim", ";", "len", "=", "dmap", "-", ">", "qlen", ";", "if", "(", "adev", "-", ">", "d", "-", ">", "local_qlen", ")", "{", "tmp", "=", "adev", "-", ">", "d", "-", ">", "local_qlen", "(", "dev", ")", ";", "if", "(", "tmp", "&", "&", "len", ")", "tmp", "-", "-;", "/", "*", "This", "buffer", "has", "been", "counted", "twice", "*", "/", "len", "+", "=", "tmp", ";", "}", "if", "(", "dmap", "-", ">", "byte_counter", "%", "dmap", "-", ">", "fragment_size", ")", "/", "*", "There", "is", "a", "partial", "fragment", "*", "/", "len", "=", "len", "+", "1", ";", "if", "(", "len", ">", "=", "max", ")", "return", "0", ";", "return", "max", "-", "len", ";", "}", "/", "*", "MUST", "not", "hold", "the", "spinlock", "-", "this", "function", "may", "sleep", "*", "/", "static", "int", "output_sleep", "(", "int", "dev", ",", "int", "dontblock", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "int", "err", "=", "0", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "long", "timeout", ";", "long", "timeout_value", ";", "if", "(", "dontblock", ")", "return", "-", "EAGAIN", ";", "if", "(", "!(", "adev", "-", ">", "enable_bits", "&", "PCM_ENABLE_OUTPUT", ")", ")", "return", "-", "EAGAIN", ";", "/", "*", "*", "Wait", "for", "free", "space", "*", "/", "if", "(", "signal_pending", "(", "current", ")", ")", "return", "-", "EINTR", ";", "timeout", "=", "(", "adev", "-", ">", "go", "&", "&", "!", "(", "dmap", "-", ">", "flags", "&", "DMA_NOTIMEOUT", ")", ");", "if", "(", "timeout", ")", "timeout_value", "=", "dmabuf_timeout", "(", "dmap", ")", ";", "else", "timeout_value", "=", "MAX_SCHEDULE_TIMEOUT", ";", "timeout_value", "=", "oss_broken_sleep_on", "(", "&", "adev", "-", ">", "out_sleeper", ",", "timeout_value", ")", ";", "if", "(", "timeout", "!", "=", "MAX_SCHEDULE_TIMEOUT", "&", "&", "!", "timeout_value", ")", "{", "printk", "(", "KERN_WARNING", "\"", "Sound", ":", "DMA", "(", "output", ")", "timed", "out", "-", "IRQ", "/", "DRQ", "config", "error", "?", "\\", "n", "\"", ");", "dma_reset_output", "(", "dev", ")", ";", "}", "else", "{", "if", "(", "signal_pending", "(", "current", ")", ")", "err", "=", "-", "EINTR", ";", "}", "return", "err", ";", "}", "/", "*", "called", "with", "the", "lock", "held", "*", "/", "static", "int", "find_output_space", "(", "int", "dev", ",", "char", "*", "*", "buf", ",", "int", "*", "size", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "unsigned", "long", "active_offs", ";", "long", "len", ",", "offs", ";", "int", "maxfrags", ";", "int", "occupied_bytes", "=", "(", "dmap", "-", ">", "user_counter", "%", "dmap", "-", ">", "fragment_size", ")", ";", "*", "buf", "=", "dmap", "-", ">", "raw_buf", ";", "if", "(", "!(", "maxfrags", "=", "DMAbuf_space_in_queue", "(", "dev", ")", ")", "&", "&", "!", "occupied_bytes", ")", "return", "0", ";", "#", "ifdef", "BE_CONSERVATIVE", "active_offs", "=", "dmap", "-", ">", "byte_counter", "+", "dmap", "-", ">", "qhead", "*", "dmap", "-", ">", "fragment_size", ";", "#", "else", "active_offs", "=", "max", "(", "DMAbuf_get_buffer_pointer", "(", "dev", ",", "dmap", ",", "DMODE_OUTPUT", ")", ",", "0", ")", ";", "/", "*", "Check", "for", "pointer", "wrapping", "situation", "*", "/", "if", "(", "active_offs", ">", "=", "dmap", "-", ">", "bytes_in_use", ")", "active_offs", "=", "0", ";", "active_offs", "+", "=", "dmap", "-", ">", "byte_counter", ";", "#", "endif", "offs", "=", "(", "dmap", "-", ">", "user_counter", "%", "dmap", "-", ">", "bytes_in_use", ")", "&", "~", "SAMPLE_ROUNDUP", ";", "if", "(", "offs", "<", "0", "|", "|", "offs", ">", "=", "dmap", "-", ">", "bytes_in_use", ")", "{", "printk", "(", "KERN_ERR", "\"", "Sound", ":", "Got", "unexpected", "offs", "%", "ld", ".", "Giving", "up", ".", "\\", "n", "\"", ",", "offs", ")", ";", "printk", "(", "\"", "Counter", "=", "%", "ld", ",", "bytes", "=", "%", "d", "\\", "n", "\"", ",", "dmap", "-", ">", "user_counter", ",", "dmap", "-", ">", "bytes_in_use", ")", ";", "return", "0", ";", "}", "*", "buf", "=", "dmap", "-", ">", "raw_buf", "+", "offs", ";", "len", "=", "active_offs", "+", "dmap", "-", ">", "bytes_in_use", "-", "dmap", "-", ">", "user_counter", ";", "/", "*", "Number", "of", "unused", "bytes", "in", "buffer", "*", "/", "if", "(", "(", "offs", "+", "len", ")", ">", "dmap", "-", ">", "bytes_in_use", ")", "len", "=", "dmap", "-", ">", "bytes_in_use", "-", "offs", ";", "if", "(", "len", "<", "0", ")", "{", "return", "0", ";", "}", "if", "(", "len", ">", "(", "(", "maxfrags", "*", "dmap", "-", ">", "fragment_size", ")", "-", "occupied_bytes", ")", ")", "len", "=", "(", "maxfrags", "*", "dmap", "-", ">", "fragment_size", ")", "-", "occupied_bytes", ";", "*", "size", "=", "len", "&", "~", "SAMPLE_ROUNDUP", ";", "return", "(", "*", "size", ">", "0", ")", ";", "}", "/", "*", "acquires", "lock", "*", "/", "int", "DMAbuf_getwrbuffer", "(", "int", "dev", ",", "char", "*", "*", "buf", ",", "int", "*", "size", ",", "int", "dontblock", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "unsigned", "long", "flags", ";", "int", "err", "=", "-", "EIO", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "if", "(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "{", "/", "*", "printk", "(", "KERN_DEBUG", "\"", "Sound", ":", "Can", "'", "t", "write", "to", "mmapped", "device", "(", "3", ")", "\\", "n", "\"", ");", "*/", "return", "-", "EINVAL", ";", "}", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "dmap", "-", ">", "needs_reorg", ")", "reorganize_buffers", "(", "dev", ",", "dmap", ",", "0", ")", ";", "if", "(", "dmap", "-", ">", "dma_mode", "=", "=", "DMODE_INPUT", ")", "{", "/", "*", "Direction", "change", "*", "/", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "DMAbuf_reset", "(", "dev", ")", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "dmap", "-", ">", "dma_mode", "=", "DMODE_OUTPUT", ";", "while", "(", "find_output_space", "(", "dev", ",", "buf", ",", "size", ")", "<", "=", "0", ")", "{", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "(", "err", "=", "output_sleep", "(", "dev", ",", "dontblock", ")", ")", "<", "0", ")", "{", "return", "err", ";", "}", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "return", "0", ";", "}", "/", "*", "has", "to", "acquire", "dmap", "-", ">", "lock", "*", "/", "int", "DMAbuf_move_wrpointer", "(", "int", "dev", ",", "int", "l", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "unsigned", "long", "ptr", ";", "unsigned", "long", "end_ptr", ",", "p", ";", "int", "post", ";", "unsigned", "long", "flags", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "post", "=", "(", "dmap", "-", ">", "flags", "&", "DMA_POST", ")", ";", "ptr", "=", "(", "dmap", "-", ">", "user_counter", "/", "dmap", "-", ">", "fragment_size", ")", "*", "dmap", "-", ">", "fragment_size", ";", "dmap", "-", ">", "flags", "&", "=", "~", "DMA_POST", ";", "dmap", "-", ">", "cfrag", "=", "-", "1", ";", "dmap", "-", ">", "user_counter", "+", "=", "l", ";", "dmap", "-", ">", "flags", "|", "=", "DMA_DIRTY", ";", "if", "(", "dmap", "-", ">", "byte_counter", ">", "=", "dmap", "-", ">", "max_byte_counter", ")", "{", "/", "*", "Wrap", "the", "byte", "counters", "*", "/", "long", "decr", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "byte_counter", "=", "(", "dmap", "-", ">", "byte_counter", "%", "dmap", "-", ">", "bytes_in_use", ")", ";", "decr", "-", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "user_counter", "-", "=", "decr", ";", "}", "end_ptr", "=", "(", "dmap", "-", ">", "user_counter", "/", "dmap", "-", ">", "fragment_size", ")", "*", "dmap", "-", ">", "fragment_size", ";", "p", "=", "(", "dmap", "-", ">", "user_counter", "-", "1", ")", "%", "dmap", "-", ">", "bytes_in_use", ";", "dmap", "-", ">", "neutral_byte", "=", "dmap", "-", ">", "raw_buf", "[", "p", "]", ";", "/", "*", "Update", "the", "fragment", "based", "bookkeeping", "too", "*", "/", "while", "(", "ptr", "<", "end_ptr", ")", "{", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qtail", "]", "=", "dmap", "-", ">", "fragment_size", ";", "dmap", "-", ">", "qtail", "=", "(", "dmap", "-", ">", "qtail", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "dmap", "-", ">", "qlen", "+", "+;", "ptr", "+", "=", "dmap", "-", ">", "fragment_size", ";", "}", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qtail", "]", "=", "dmap", "-", ">", "user_counter", "-", "ptr", ";", "/", "*", "*", "Let", "the", "low", "level", "driver", "perform", "some", "postprocessing", "to", "*", "the", "written", "data", ".", "*", "/", "if", "(", "adev", "-", ">", "d", "-", ">", "postprocess_write", ")", "adev", "-", ">", "d", "-", ">", "postprocess_write", "(", "dev", ")", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_ACTIVE", ")", ")", "if", "(", "dmap", "-", ">", "qlen", ">", "1", "|", "|", "(", "dmap", "-", ">", "qlen", ">", "0", "&", "&", "(", "post", "|", "|", "dmap", "-", ">", "qlen", ">", "=", "dmap", "-", ">", "nbufs", "-", "1", ")", "))", "DMAbuf_launch_output", "(", "dev", ",", "dmap", ")", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "return", "0", ";", "}", "int", "DMAbuf_start_dma", "(", "int", "dev", ",", "unsigned", "long", "physaddr", ",", "int", "count", ",", "int", "dma_mode", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "(", "dma_mode", "=", "=", "DMA_MODE_WRITE", ")", "?", "adev", "-", ">", "dmap_out", ":", "adev", "-", ">", "dmap_in", ";", "if", "(", "dmap", "-", ">", "raw_buf", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "sound", ":", "DMA", "buffer", "(", "1", ")", "=", "=", "NULL", "\\", "n", "\"", ");", "printk", "(", "\"", "Device", "%", "d", ",", "chn", "=", "%", "s", "\\", "n", "\"", ",", "dev", ",", "(", "dmap", "=", "=", "adev", "-", ">", "dmap_out", ")", "?", "\"", "out", "\"", ":", "\"", "in", "\"", ");", "return", "0", ";", "}", "if", "(", "dmap", "-", ">", "dma", "<", "0", ")", "return", "0", ";", "sound_start_dma", "(", "dmap", ",", "physaddr", ",", "count", ",", "dma_mode", ")", ";", "return", "count", ";", "}", "EXPORT_SYMBOL", "(", "DMAbuf_start_dma", ")", ";", "static", "int", "local_start_dma", "(", "struct", "audio_operations", "*", "adev", ",", "unsigned", "long", "physaddr", ",", "int", "count", ",", "int", "dma_mode", ")", "{", "struct", "dma_buffparms", "*", "dmap", "=", "(", "dma_mode", "=", "=", "DMA_MODE_WRITE", ")", "?", "adev", "-", ">", "dmap_out", ":", "adev", "-", ">", "dmap_in", ";", "if", "(", "dmap", "-", ">", "raw_buf", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "sound", ":", "DMA", "buffer", "(", "2", ")", "=", "=", "NULL", "\\", "n", "\"", ");", "printk", "(", "KERN_ERR", "\"", "Device", "%", "s", ",", "chn", "=", "%", "s", "\\", "n", "\"", ",", "adev", "-", ">", "name", ",", "(", "dmap", "=", "=", "adev", "-", ">", "dmap_out", ")", "?", "\"", "out", "\"", ":", "\"", "in", "\"", ");", "return", "0", ";", "}", "if", "(", "dmap", "-", ">", "flags", "&", "DMA_NODMA", ")", "return", "1", ";", "if", "(", "dmap", "-", ">", "dma", "<", "0", ")", "return", "0", ";", "sound_start_dma", "(", "dmap", ",", "dmap", "-", ">", "raw_buf_phys", ",", "dmap", "-", ">", "bytes_in_use", ",", "dma_mode", "|", "DMA_AUTOINIT", ")", ";", "dmap", "-", ">", "flags", "|", "=", "DMA_STARTED", ";", "return", "count", ";", "}", "static", "void", "finish_output_interrupt", "(", "int", "dev", ",", "struct", "dma_buffparms", "*", "dmap", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "if", "(", "dmap", "-", ">", "audio_callback", "!", "=", "NULL", ")", "dmap", "-", ">", "audio_callback", "(", "dev", ",", "dmap", "-", ">", "callback_parm", ")", ";", "wake_up", "(", "&", "adev", "-", ">", "out_sleeper", ")", ";", "wake_up", "(", "&", "adev", "-", ">", "poll_sleeper", ")", ";", "}", "/", "*", "called", "with", "dmap", "-", ">", "lock", "held", "in", "irq", "context", "*", "/", "static", "void", "do_outputintr", "(", "int", "dev", ",", "int", "dummy", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "int", "this_fragment", ";", "if", "(", "dmap", "-", ">", "raw_buf", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "Sound", ":", "Error", ".", "Audio", "interrupt", "(", "%", "d", ")", "after", "freeing", "buffers", ".", "\\", "n", "\"", ",", "dev", ")", ";", "return", ";", "}", "if", "(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "{", "/", "*", "Virtual", "memory", "mapped", "access", "*", "/", "/", "*", "mmapped", "access", "*", "/", "dmap", "-", ">", "qhead", "=", "(", "dmap", "-", ">", "qhead", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "if", "(", "dmap", "-", ">", "qhead", "=", "=", "0", ")", "{", "/", "*", "Wrapped", "*", "/", "dmap", "-", ">", "byte_counter", "+", "=", "dmap", "-", ">", "bytes_in_use", ";", "if", "(", "dmap", "-", ">", "byte_counter", ">", "=", "dmap", "-", ">", "max_byte_counter", ")", "{", "/", "*", "Overflow", "*", "/", "long", "decr", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "byte_counter", "=", "(", "dmap", "-", ">", "byte_counter", "%", "dmap", "-", ">", "bytes_in_use", ")", ";", "decr", "-", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "user_counter", "-", "=", "decr", ";", "}", "}", "dmap", "-", ">", "qlen", "+", "+;", "/", "*", "Yes", "increment", "it", "(", "don", "'", "t", "decrement", ")", "*", "/", "if", "(", "!(", "adev", "-", ">", "flags", "&", "DMA_AUTOMODE", ")", ")", "dmap", "-", ">", "flags", "&", "=", "~", "DMA_ACTIVE", ";", "dmap", "-", ">", "counts", "[", "dmap", "-", ">", "qhead", "]", "=", "dmap", "-", ">", "fragment_size", ";", "DMAbuf_launch_output", "(", "dev", ",", "dmap", ")", ";", "finish_output_interrupt", "(", "dev", ",", "dmap", ")", ";", "return", ";", "}", "dmap", "-", ">", "qlen", "-", "-;", "this_fragment", "=", "dmap", "-", ">", "qhead", ";", "dmap", "-", ">", "qhead", "=", "(", "dmap", "-", ">", "qhead", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "if", "(", "dmap", "-", ">", "qhead", "=", "=", "0", ")", "{", "/", "*", "Wrapped", "*", "/", "dmap", "-", ">", "byte_counter", "+", "=", "dmap", "-", ">", "bytes_in_use", ";", "if", "(", "dmap", "-", ">", "byte_counter", ">", "=", "dmap", "-", ">", "max_byte_counter", ")", "{", "/", "*", "Overflow", "*", "/", "long", "decr", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "byte_counter", "=", "(", "dmap", "-", ">", "byte_counter", "%", "dmap", "-", ">", "bytes_in_use", ")", ";", "decr", "-", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "user_counter", "-", "=", "decr", ";", "}", "}", "if", "(", "!(", "adev", "-", ">", "flags", "&", "DMA_AUTOMODE", ")", ")", "dmap", "-", ">", "flags", "&", "=", "~", "DMA_ACTIVE", ";", "/", "*", "*", "This", "is", "dmap", "-", ">", "qlen", "<", "=", "0", "except", "when", "closing", "when", "*", "dmap", "-", ">", "qlen", "<", "0", "*", "/", "while", "(", "dmap", "-", ">", "qlen", "<", "=", "-", "dmap", "-", ">", "closing", ")", "{", "dmap", "-", ">", "underrun_count", "+", "+;", "dmap", "-", ">", "qlen", "+", "+;", "if", "(", "(", "dmap", "-", ">", "flags", "&", "DMA_DIRTY", ")", "&", "&", "dmap", "-", ">", "applic_profile", "!", "=", "APF_CPUINTENS", ")", "{", "dmap", "-", ">", "flags", "&", "=", "~", "DMA_DIRTY", ";", "memset", "(", "adev", "-", ">", "dmap_out", "-", ">", "raw_buf", ",", "adev", "-", ">", "dmap_out", "-", ">", "neutral_byte", ",", "adev", "-", ">", "dmap_out", "-", ">", "buffsize", ")", ";", "}", "dmap", "-", ">", "user_counter", "+", "=", "dmap", "-", ">", "fragment_size", ";", "dmap", "-", ">", "qtail", "=", "(", "dmap", "-", ">", "qtail", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "}", "if", "(", "dmap", "-", ">", "qlen", ">", "0", ")", "DMAbuf_launch_output", "(", "dev", ",", "dmap", ")", ";", "finish_output_interrupt", "(", "dev", ",", "dmap", ")", ";", "}", "/", "*", "called", "in", "irq", "context", "*", "/", "void", "DMAbuf_outputintr", "(", "int", "dev", ",", "int", "notify_only", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "unsigned", "long", "flags", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_NODMA", ")", ")", "{", "int", "chan", "=", "dmap", "-", ">", "dma", ",", "pos", ",", "n", ";", "unsigned", "long", "f", ";", "f", "=", "claim_dma_lock", "(", ");", "if", "(", "!", "isa_dma_bridge_buggy", ")", "disable_dma", "(", "dmap", "-", ">", "dma", ")", ";", "clear_dma_ff", "(", "chan", ")", ";", "pos", "=", "dmap", "-", ">", "bytes_in_use", "-", "get_dma_residue", "(", "chan", ")", ";", "if", "(", "!", "isa_dma_bridge_buggy", ")", "enable_dma", "(", "dmap", "-", ">", "dma", ")", ";", "release_dma_lock", "(", "f", ")", ";", "pos", "=", "pos", "/", "dmap", "-", ">", "fragment_size", ";", "/", "*", "Actual", "qhead", "*", "/", "if", "(", "pos", "<", "0", "|", "|", "pos", ">", "=", "dmap", "-", ">", "nbufs", ")", "pos", "=", "0", ";", "n", "=", "0", ";", "while", "(", "dmap", "-", ">", "qhead", "!", "=", "pos", "&", "&", "n", "+", "+", "<", "dmap", "-", ">", "nbufs", ")", "do_outputintr", "(", "dev", ",", "notify_only", ")", ";", "}", "else", "do_outputintr", "(", "dev", ",", "notify_only", ")", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "EXPORT_SYMBOL", "(", "DMAbuf_outputintr", ")", ";", "/", "*", "called", "with", "dmap", "-", ">", "lock", "held", "in", "irq", "context", "*", "/", "static", "void", "do_inputintr", "(", "int", "dev", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_in", ";", "if", "(", "dmap", "-", ">", "raw_buf", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "Sound", ":", "Fatal", "error", ".", "Audio", "interrupt", "after", "freeing", "buffers", ".", "\\", "n", "\"", ");", "return", ";", "}", "if", "(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "{", "dmap", "-", ">", "qtail", "=", "(", "dmap", "-", ">", "qtail", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "if", "(", "dmap", "-", ">", "qtail", "=", "=", "0", ")", "{", "/", "*", "Wrapped", "*", "/", "dmap", "-", ">", "byte_counter", "+", "=", "dmap", "-", ">", "bytes_in_use", ";", "if", "(", "dmap", "-", ">", "byte_counter", ">", "=", "dmap", "-", ">", "max_byte_counter", ")", "{", "/", "*", "Overflow", "*", "/", "long", "decr", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "byte_counter", "=", "(", "dmap", "-", ">", "byte_counter", "%", "dmap", "-", ">", "bytes_in_use", ")", "+", "dmap", "-", ">", "bytes_in_use", ";", "decr", "-", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "user_counter", "-", "=", "decr", ";", "}", "}", "dmap", "-", ">", "qlen", "+", "+;", "if", "(", "!(", "adev", "-", ">", "flags", "&", "DMA_AUTOMODE", ")", ")", "{", "if", "(", "dmap", "-", ">", "needs_reorg", ")", "reorganize_buffers", "(", "dev", ",", "dmap", ",", "0", ")", ";", "local_start_dma", "(", "adev", ",", "dmap", "-", ">", "raw_buf_phys", ",", "dmap", "-", ">", "bytes_in_use", ",", "DMA_MODE_READ", ")", ";", "adev", "-", ">", "d", "-", ">", "start_input", "(", "dev", ",", "dmap", "-", ">", "raw_buf_phys", "+", "dmap", "-", ">", "qtail", "*", "dmap", "-", ">", "fragment_size", ",", "dmap", "-", ">", "fragment_size", ",", "1", ")", ";", "if", "(", "adev", "-", ">", "d", "-", ">", "trigger", ")", "adev", "-", ">", "d", "-", ">", "trigger", "(", "dev", ",", "adev", "-", ">", "enable_bits", "*", "adev", "-", ">", "go", ")", ";", "}", "dmap", "-", ">", "flags", "|", "=", "DMA_ACTIVE", ";", "}", "else", "if", "(", "dmap", "-", ">", "qlen", ">", "=", "(", "dmap", "-", ">", "nbufs", "-", "1", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "Sound", ":", "Recording", "overrun", "\\", "n", "\"", ");", "dmap", "-", ">", "underrun_count", "+", "+;", "/", "*", "Just", "throw", "away", "the", "oldest", "fragment", "but", "keep", "the", "engine", "running", "*", "/", "dmap", "-", ">", "qhead", "=", "(", "dmap", "-", ">", "qhead", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "dmap", "-", ">", "qtail", "=", "(", "dmap", "-", ">", "qtail", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "}", "else", "if", "(", "dmap", "-", ">", "qlen", ">", "=", "0", "&", "&", "dmap", "-", ">", "qlen", "<", "dmap", "-", ">", "nbufs", ")", "{", "dmap", "-", ">", "qlen", "+", "+;", "dmap", "-", ">", "qtail", "=", "(", "dmap", "-", ">", "qtail", "+", "1", ")", "%", "dmap", "-", ">", "nbufs", ";", "if", "(", "dmap", "-", ">", "qtail", "=", "=", "0", ")", "{", "/", "*", "Wrapped", "*", "/", "dmap", "-", ">", "byte_counter", "+", "=", "dmap", "-", ">", "bytes_in_use", ";", "if", "(", "dmap", "-", ">", "byte_counter", ">", "=", "dmap", "-", ">", "max_byte_counter", ")", "{", "/", "*", "Overflow", "*", "/", "long", "decr", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "byte_counter", "=", "(", "dmap", "-", ">", "byte_counter", "%", "dmap", "-", ">", "bytes_in_use", ")", "+", "dmap", "-", ">", "bytes_in_use", ";", "decr", "-", "=", "dmap", "-", ">", "byte_counter", ";", "dmap", "-", ">", "user_counter", "-", "=", "decr", ";", "}", "}", "}", "if", "(", "!(", "adev", "-", ">", "flags", "&", "DMA_AUTOMODE", ")", "|", "|", "(", "dmap", "-", ">", "flags", "&", "DMA_NODMA", ")", ")", "{", "local_start_dma", "(", "adev", ",", "dmap", "-", ">", "raw_buf_phys", ",", "dmap", "-", ">", "bytes_in_use", ",", "DMA_MODE_READ", ")", ";", "adev", "-", ">", "d", "-", ">", "start_input", "(", "dev", ",", "dmap", "-", ">", "raw_buf_phys", "+", "dmap", "-", ">", "qtail", "*", "dmap", "-", ">", "fragment_size", ",", "dmap", "-", ">", "fragment_size", ",", "1", ")", ";", "if", "(", "adev", "-", ">", "d", "-", ">", "trigger", ")", "adev", "-", ">", "d", "-", ">", "trigger", "(", "dev", ",", "adev", "-", ">", "enable_bits", "*", "adev", "-", ">", "go", ")", ";", "}", "dmap", "-", ">", "flags", "|", "=", "DMA_ACTIVE", ";", "if", "(", "dmap", "-", ">", "qlen", ">", "0", ")", "{", "wake_up", "(", "&", "adev", "-", ">", "in_sleeper", ")", ";", "wake_up", "(", "&", "adev", "-", ">", "poll_sleeper", ")", ";", "}", "}", "/", "*", "called", "in", "irq", "context", "*", "/", "void", "DMAbuf_inputintr", "(", "int", "dev", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_in", ";", "unsigned", "long", "flags", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "!(", "dmap", "-", ">", "flags", "&", "DMA_NODMA", ")", ")", "{", "int", "chan", "=", "dmap", "-", ">", "dma", ",", "pos", ",", "n", ";", "unsigned", "long", "f", ";", "f", "=", "claim_dma_lock", "(", ");", "if", "(", "!", "isa_dma_bridge_buggy", ")", "disable_dma", "(", "dmap", "-", ">", "dma", ")", ";", "clear_dma_ff", "(", "chan", ")", ";", "pos", "=", "dmap", "-", ">", "bytes_in_use", "-", "get_dma_residue", "(", "chan", ")", ";", "if", "(", "!", "isa_dma_bridge_buggy", ")", "enable_dma", "(", "dmap", "-", ">", "dma", ")", ";", "release_dma_lock", "(", "f", ")", ";", "pos", "=", "pos", "/", "dmap", "-", ">", "fragment_size", ";", "/", "*", "Actual", "qhead", "*", "/", "if", "(", "pos", "<", "0", "|", "|", "pos", ">", "=", "dmap", "-", ">", "nbufs", ")", "pos", "=", "0", ";", "n", "=", "0", ";", "while", "(", "dmap", "-", ">", "qtail", "!", "=", "pos", "&", "&", "+", "+", "n", "<", "dmap", "-", ">", "nbufs", ")", "do_inputintr", "(", "dev", ")", ";", "}", "else", "do_inputintr", "(", "dev", ")", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "EXPORT_SYMBOL", "(", "DMAbuf_inputintr", ")", ";", "void", "DMAbuf_init", "(", "int", "dev", ",", "int", "dma1", ",", "int", "dma2", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "/", "*", "*", "NOTE", "!", "This", "routine", "could", "be", "called", "several", "times", ".", "*", "/", "if", "(", "adev", "&", "&", "adev", "-", ">", "dmap_out", "=", "=", "NULL", ")", "{", "if", "(", "adev", "-", ">", "d", "=", "=", "NULL", ")", "panic", "(", "\"", "OSS", ":", "audio_devs", "[", "%", "d", "]", "->", "d", "=", "=", "NULL", "\\", "n", "\"", ",", "dev", ")", ";", "if", "(", "adev", "-", ">", "parent_dev", ")", "{", "/", "*", "Use", "DMA", "map", "of", "the", "parent", "dev", "*", "/", "int", "parent", "=", "adev", "-", ">", "parent_dev", "-", "1", ";", "adev", "-", ">", "dmap_out", "=", "audio_devs", "[", "parent", "]", "->", "dmap_out", ";", "adev", "-", ">", "dmap_in", "=", "audio_devs", "[", "parent", "]", "->", "dmap_in", ";", "}", "else", "{", "adev", "-", ">", "dmap_out", "=", "adev", "-", ">", "dmap_in", "=", "&", "adev", "-", ">", "dmaps", "[", "0", "]", ";", "adev", "-", ">", "dmap_out", "-", ">", "dma", "=", "dma1", ";", "if", "(", "adev", "-", ">", "flags", "&", "DMA_DUPLEX", ")", "{", "adev", "-", ">", "dmap_in", "=", "&", "adev", "-", ">", "dmaps", "[", "1", "]", ";", "adev", "-", ">", "dmap_in", "-", ">", "dma", "=", "dma2", ";", "}", "}", "/", "*", "Persistent", "DMA", "buffers", "allocated", "here", "*", "/", "if", "(", "sound_dmap_flag", "=", "=", "DMAP_KEEP_ON_CLOSE", ")", "{", "if", "(", "adev", "-", ">", "dmap_in", "-", ">", "raw_buf", "=", "=", "NULL", ")", "sound_alloc_dmap", "(", "adev", "-", ">", "dmap_in", ")", ";", "if", "(", "adev", "-", ">", "dmap_out", "-", ">", "raw_buf", "=", "=", "NULL", ")", "sound_alloc_dmap", "(", "adev", "-", ">", "dmap_out", ")", ";", "}", "}", "}", "/", "*", "No", "kernel", "lock", "-", "DMAbuf_activate_recording", "protected", "by", "global", "cli", "/", "sti", "*", "/", "static", "unsigned", "int", "poll_input", "(", "struct", "file", "*", "file", ",", "int", "dev", ",", "poll_table", "*", "wait", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_in", ";", "if", "(", "!(", "adev", "-", ">", "open_mode", "&", "OPEN_READ", ")", ")", "return", "0", ";", "if", "(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "{", "if", "(", "dmap", "-", ">", "qlen", ")", "return", "POLLIN", "|", "POLLRDNORM", ";", "return", "0", ";", "}", "if", "(", "dmap", "-", ">", "dma_mode", "!", "=", "DMODE_INPUT", ")", "{", "if", "(", "dmap", "-", ">", "dma_mode", "=", "=", "DMODE_NONE", "&", "&", "adev", "-", ">", "enable_bits", "&", "PCM_ENABLE_INPUT", "&", "&", "!", "dmap", "-", ">", "qlen", "&", "&", "adev", "-", ">", "go", ")", "{", "unsigned", "long", "flags", ";", "spin_lock_irqsave", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "DMAbuf_activate_recording", "(", "dev", ",", "dmap", ")", ";", "spin_unlock_irqrestore", "(", "&", "dmap", "-", ">", "lock", ",", "flags", ")", ";", "}", "return", "0", ";", "}", "if", "(", "!", "dmap", "-", ">", "qlen", ")", "return", "0", ";", "return", "POLLIN", "|", "POLLRDNORM", ";", "}", "static", "unsigned", "int", "poll_output", "(", "struct", "file", "*", "file", ",", "int", "dev", ",", "poll_table", "*", "wait", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "struct", "dma_buffparms", "*", "dmap", "=", "adev", "-", ">", "dmap_out", ";", "if", "(", "!(", "adev", "-", ">", "open_mode", "&", "OPEN_WRITE", ")", ")", "return", "0", ";", "if", "(", "dmap", "-", ">", "mapping_flags", "&", "DMA_MAP_MAPPED", ")", "{", "if", "(", "dmap", "-", ">", "qlen", ")", "return", "POLLOUT", "|", "POLLWRNORM", ";", "return", "0", ";", "}", "if", "(", "dmap", "-", ">", "dma_mode", "=", "=", "DMODE_INPUT", ")", "return", "0", ";", "if", "(", "dmap", "-", ">", "dma_mode", "=", "=", "DMODE_NONE", ")", "return", "POLLOUT", "|", "POLLWRNORM", ";", "if", "(", "!", "DMAbuf_space_in_queue", "(", "dev", ")", ")", "return", "0", ";", "return", "POLLOUT", "|", "POLLWRNORM", ";", "}", "unsigned", "int", "DMAbuf_poll", "(", "struct", "file", "*", "file", ",", "int", "dev", ",", "poll_table", "*", "wait", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "poll_wait", "(", "file", ",", "&", "adev", "-", ">", "poll_sleeper", ",", "wait", ")", ";", "return", "poll_input", "(", "file", ",", "dev", ",", "wait", ")", "|", "poll_output", "(", "file", ",", "dev", ",", "wait", ")", ";", "}", "void", "DMAbuf_deinit", "(", "int", "dev", ")", "{", "struct", "audio_operations", "*", "adev", "=", "audio_devs", "[", "dev", "]", ";", "/", "*", "This", "routine", "is", "called", "when", "driver", "is", "being", "unloaded", "*", "/", "if", "(", "!", "adev", ")", "return", ";", "/", "*", "Persistent", "DMA", "buffers", "deallocated", "here", "*", "/", "if", "(", "sound_dmap_flag", "=", "=", "DMAP_KEEP_ON_CLOSE", ")", "{", "sound_free_dmap", "(", "adev", "-", ">", "dmap_out", ")", ";", "if", "(", "adev", "-", ">", "flags", "&", "DMA_DUPLEX", ")", "sound_free_dmap", "(", "adev", "-", ">", "dmap_in", ")", ";", "}", "}", "@", "@", "-", "1", ",", "101", "+", "0", ",", "0", "@", "@", "/", "*", "*", "hex2hex", "reads", "stdin", "in", "Intel", "HEX", "format", "and", "produces", "an", "*", "(", "unsigned", "char", ")", "array", "which", "contains", "the", "bytes", "and", "writes", "it", "*", "to", "stdout", "using", "C", "syntax", "*", "/", "#", "include", "<", "stdio", ".", "h", ">", "#", "include", "<", "string", ".", "h", ">", "#", "include", "<", "stdlib", ".", "h", ">", "#", "define", "ABANDON", "(", "why", ")", "{", "fprintf", "(", "stderr", ",", "\"", "%", "s", "\\", "n", "\"", ",", "why", ")", ";", "exit", "(", "1", ")", ";", "}", "#", "define", "MAX_SIZE", "(", "256", "*", "1024", ")", "unsigned", "char", "buf", "[", "MAX_SIZE", "]", ";", "static", "int", "loadhex", "(", "FILE", "*", "inf", ",", "unsigned", "char", "*", "buf", ")", "{", "int", "l", "=", "0", ",", "c", ",", "i", ";", "while", "(", "(", "c", "=", "getc", "(", "inf", ")", ")!", "=", "EOF", ")", "{", "if", "(", "c", "=", "=", "'", ":'", ")", "/", "*", "Sync", "with", "beginning", "of", "line", "*", "/", "{", "int", "n", ",", "check", ";", "unsigned", "char", "sum", ";", "int", "addr", ";", "int", "linetype", ";", "if", "(", "fscanf", "(", "inf", ",", "\"", "%", "02x", "\"", ",", "&", "n", ")", "!", "=", "1", ")", "ABANDON", "(", "\"", "File", "format", "error", "\"", ");", "sum", "=", "n", ";", "if", "(", "fscanf", "(", "inf", ",", "\"", "%", "04x", "\"", ",", "&", "addr", ")", "!", "=", "1", ")", "ABANDON", "(", "\"", "File", "format", "error", "\"", ");", "sum", "+", "=", "addr", "/", "256", ";", "sum", "+", "=", "addr", "%", "256", ";", "if", "(", "fscanf", "(", "inf", ",", "\"", "%", "02x", "\"", ",", "&", "linetype", ")", "!", "=", "1", ")", "ABANDON", "(", "\"", "File", "format", "error", "\"", ");", "sum", "+", "=", "linetype", ";", "if", "(", "linetype", "!", "=", "0", ")", "continue", ";", "for", "(", "i", "=", "0", ";", "i", "<", "n", ";", "i", "+", "+)", "{", "if", "(", "fscanf", "(", "inf", ",", "\"", "%", "02x", "\"", ",", "&", "c", ")", "!", "=", "1", ")", "ABANDON", "(", "\"", "File", "format", "error", "\"", ");", "if", "(", "addr", ">", "=", "MAX_SIZE", ")", "ABANDON", "(", "\"", "File", "too", "large", "\"", ");", "buf", "[", "addr", "+", "+]", "=", "c", ";", "if", "(", "addr", ">", "l", ")", "l", "=", "addr", ";", "sum", "+", "=", "c", ";", "}", "if", "(", "fscanf", "(", "inf", ",", "\"", "%", "02x", "\"", ",", "&", "check", ")", "!", "=", "1", ")", "ABANDON", "(", "\"", "File", "format", "error", "\"", ");", "sum", "=", "~", "sum", "+", "1", ";", "if", "(", "check", "!", "=", "sum", ")", "ABANDON", "(", "\"", "Line", "checksum", "error", "\"", ");", "}", "}", "return", "l", ";", "}", "int", "main", "(", "int", "argc", ",", "const", "char", "*", "argv", "[", "]", ")", "{", "const", "char", "*", "varline", ";", "int", "i", ",", "l", ";", "int", "id", "=", "0", ";", "if", "(", "argv", "[", "1", "]", "&", "&", "strcmp", "(", "argv", "[", "1", "]", ",", "\"", "-", "i", "\"", ")=", "=", "0", ")", "{", "argv", "+", "+;", "argc", "-", "-;", "id", "=", "1", ";", "}", "if", "(", "argv", "[", "1", "]", "==", "NULL", ")", "{", "fprintf", "(", "stderr", ",", "\"", "hex2hex", ":", "[", "-", "i", "]", "filename", "\\", "n", "\"", ");", "exit", "(", "1", ")", ";", "}", "varline", "=", "argv", "[", "1", "]", ";", "l", "=", "loadhex", "(", "stdin", ",", "buf", ")", ";", "printf", "(", "\"/", "*\\", "n", "*", "\\", "t", "Computer", "generated", "file", ".", "Do", "not", "edit", ".", "\\", "n", "*", "/\\", "n", "\"", ");", "printf", "(", "\"", "static", "int", "%", "s_len", "=", "%", "d", ";", "\\", "n", "\"", ",", "varline", ",", "l", ")", ";", "printf", "(", "\"", "static", "unsigned", "char", "%", "s", "[", "]", "%", "s", "=", "{", "\\", "n", "\"", ",", "varline", ",", "id", "?", "\"", "__initdata", "\"", ":\"", "\")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "l", ";", "i", "+", "+)", "{", "if", "(", "i", ")", "printf", "(", "\",", "\")", ";", "if", "(", "i", "&", "&", "!", "(", "i", "%", "16", ")", ")", "printf", "(", "\"\\", "n", "\"", ");", "printf", "(", "\"", "0x", "%", "02x", "\"", ",", "buf", "[", "i", "]", ");", "}", "printf", "(", "\"\\", "n", "}", ";\\", "n", "\\", "n", "\"", ");", "return", "0", ";", "}", "@", "@", "-", "1", ",", "229", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Initialisation", "code", "for", "Cyrix", "/", "NatSemi", "VSA1", "softaudio", "*", "*", "(", "C", ")", "Copyright", "2003", "Red", "Hat", "Inc", "<", "alan", "@", "lxorguk", ".", "ukuu", ".", "org", ".", "uk", ">", "*", "*", "XpressAudio", "(", "tm", ")", "is", "used", "on", "the", "Cyrix", "MediaGX", "(", "now", "NatSemi", "Geode", ")", "systems", ".", "*", "The", "older", "version", "(", "VSA1", ")", "provides", "fairly", "good", "soundblaster", "emulation", "*", "although", "there", "are", "a", "couple", "of", "bugs", ":", "large", "DMA", "buffers", "break", "record", ",", "*", "and", "the", "MPU", "event", "handling", "seems", "suspect", ".", "VSA2", "allows", "the", "native", "driver", "*", "to", "control", "the", "AC97", "audio", "engine", "directly", "and", "requires", "a", "different", "driver", ".", "*", "*", "Thanks", "to", "National", "Semiconductor", "for", "providing", "the", "needed", "information", "*", "on", "the", "XpressAudio", "(", "tm", ")", "internals", ".", "*", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "*", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "the", "*", "Free", "Software", "Foundation", ";", "either", "version", "2", ",", "or", "(", "at", "your", "option", ")", "any", "*", "later", "version", ".", "*", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "but", "*", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "*", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "TO", "DO", ":", "*", "Investigate", "whether", "we", "can", "portably", "support", "Cognac", "(", "5520", ")", "in", "the", "*", "same", "manner", ".", "*", "/", "#", "include", "<", "linux", "/", "delay", ".", "h", ">", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "pci", ".", "h", ">", "#", "include", "<", "linux", "/", "slab", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "sb", ".", "h", "\"", "/", "*", "*", "Read", "a", "soundblaster", "compatible", "mixer", "register", ".", "*", "In", "this", "case", "we", "are", "actually", "reading", "an", "SMI", "trap", "*", "not", "real", "hardware", ".", "*", "/", "static", "u8", "mixer_read", "(", "unsigned", "long", "io", ",", "u8", "reg", ")", "{", "outb", "(", "reg", ",", "io", "+", "4", ")", ";", "udelay", "(", "20", ")", ";", "reg", "=", "inb", "(", "io", "+", "5", ")", ";", "udelay", "(", "20", ")", ";", "return", "reg", ";", "}", "static", "int", "probe_one", "(", "struct", "pci_dev", "*", "pdev", ",", "const", "struct", "pci_device_id", "*", "ent", ")", "{", "struct", "address_info", "*", "hw_config", ";", "unsigned", "long", "base", ";", "void", "__iomem", "*", "mem", ";", "unsigned", "long", "io", ";", "u16", "map", ";", "u8", "irq", ",", "dma8", ",", "dma16", ";", "int", "oldquiet", ";", "extern", "int", "sb_be_quiet", ";", "base", "=", "pci_resource_start", "(", "pdev", ",", "0", ")", ";", "if", "(", "base", "=", "=", "0UL", ")", "return", "1", ";", "mem", "=", "ioremap", "(", "base", ",", "128", ")", ";", "if", "(", "!", "mem", ")", "return", "1", ";", "map", "=", "readw", "(", "mem", "+", "0x18", ")", ";", "/", "*", "Read", "the", "SMI", "enables", "*", "/", "iounmap", "(", "mem", ")", ";", "/", "*", "Map", "bits", "0", ":", "1", "*", "0x20", "+", "0x200", "=", "sb", "base", "2", "sb", "enable", "3", "adlib", "enable", "5", "MPU", "enable", "0x330", "6", "MPU", "enable", "0x300", "The", "other", "bits", "may", "be", "used", "internally", "so", "must", "be", "masked", "*", "/", "io", "=", "0x220", "+", "0x20", "*", "(", "map", "&", "3", ")", ";", "if", "(", "map", "&", "(", "1", "<", "<", "2", ")", ")", "printk", "(", "KERN_INFO", "\"", "kahlua", ":", "XpressAudio", "at", "0x", "%", "lx", "\\", "n", "\"", ",", "io", ")", ";", "else", "return", "1", ";", "if", "(", "map", "&", "(", "1", "<", "<", "5", ")", ")", "printk", "(", "KERN_INFO", "\"", "kahlua", ":", "MPU", "at", "0x300", "\\", "n", "\"", ");", "else", "if", "(", "map", "&", "(", "1", "<", "<", "6", ")", ")", "printk", "(", "KERN_INFO", "\"", "kahlua", ":", "MPU", "at", "0x330", "\\", "n", "\"", ");", "irq", "=", "mixer_read", "(", "io", ",", "0x80", ")", "&", "0x0F", ";", "dma8", "=", "mixer_read", "(", "io", ",", "0x81", ")", ";", "/", "/", "printk", "(", "\"", "IRQ", "=", "%", "x", "MAP", "=", "%", "x", "DMA", "=", "%", "x", "\\", "n", "\"", ",", "irq", ",", "map", ",", "dma8", ")", ";", "if", "(", "dma8", "&", "0x20", ")", "dma16", "=", "5", ";", "else", "if", "(", "dma8", "&", "0x40", ")", "dma16", "=", "6", ";", "else", "if", "(", "dma8", "&", "0x80", ")", "dma16", "=", "7", ";", "else", "{", "printk", "(", "KERN_ERR", "\"", "kahlua", ":", "No", "16bit", "DMA", "enabled", ".", "\\", "n", "\"", ");", "return", "1", ";", "}", "if", "(", "dma8", "&", "0x01", ")", "dma8", "=", "0", ";", "else", "if", "(", "dma8", "&", "0x02", ")", "dma8", "=", "1", ";", "else", "if", "(", "dma8", "&", "0x08", ")", "dma8", "=", "3", ";", "else", "{", "printk", "(", "KERN_ERR", "\"", "kahlua", ":", "No", "8bit", "DMA", "enabled", ".", "\\", "n", "\"", ");", "return", "1", ";", "}", "if", "(", "irq", "&", "1", ")", "irq", "=", "9", ";", "else", "if", "(", "irq", "&", "2", ")", "irq", "=", "5", ";", "else", "if", "(", "irq", "&", "4", ")", "irq", "=", "7", ";", "else", "if", "(", "irq", "&", "8", ")", "irq", "=", "10", ";", "else", "{", "printk", "(", "KERN_ERR", "\"", "kahlua", ":", "SB", "IRQ", "not", "set", ".", "\\", "n", "\"", ");", "return", "1", ";", "}", "printk", "(", "KERN_INFO", "\"", "kahlua", ":", "XpressAudio", "on", "IRQ", "%", "d", ",", "DMA", "%", "d", ",", "%", "d", "\\", "n", "\"", ",", "irq", ",", "dma8", ",", "dma16", ")", ";", "hw_config", "=", "kzalloc", "(", "sizeof", "(", "struct", "address_info", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "hw_config", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "kahlua", ":", "out", "of", "memory", ".", "\\", "n", "\"", ");", "return", "1", ";", "}", "pci_set_drvdata", "(", "pdev", ",", "hw_config", ")", ";", "hw_config", "-", ">", "io_base", "=", "io", ";", "hw_config", "-", ">", "irq", "=", "irq", ";", "hw_config", "-", ">", "dma", "=", "dma8", ";", "hw_config", "-", ">", "dma2", "=", "dma16", ";", "hw_config", "-", ">", "name", "=", "\"", "Cyrix", "XpressAudio", "\"", ";", "hw_config", "-", ">", "driver_use_1", "=", "SB_NO_MIDI", "|", "SB_PCI_IRQ", ";", "if", "(", "!", "request_region", "(", "io", ",", "16", ",", "\"", "soundblaster", "\"", "))", "goto", "err_out_free", ";", "if", "(", "sb_dsp_detect", "(", "hw_config", ",", "0", ",", "0", ",", "NULL", ")", "==", "0", ")", "{", "printk", "(", "KERN_ERR", "\"", "kahlua", ":", "audio", "not", "responding", ".", "\\", "n", "\"", ");", "release_region", "(", "io", ",", "16", ")", ";", "goto", "err_out_free", ";", "}", "oldquiet", "=", "sb_be_quiet", ";", "sb_be_quiet", "=", "1", ";", "if", "(", "sb_dsp_init", "(", "hw_config", ",", "THIS_MODULE", ")", ")", "{", "sb_be_quiet", "=", "oldquiet", ";", "goto", "err_out_free", ";", "}", "sb_be_quiet", "=", "oldquiet", ";", "return", "0", ";", "err_out_free", ":", "kfree", "(", "hw_config", ")", ";", "return", "1", ";", "}", "static", "void", "remove_one", "(", "struct", "pci_dev", "*", "pdev", ")", "{", "struct", "address_info", "*", "hw_config", "=", "pci_get_drvdata", "(", "pdev", ")", ";", "sb_dsp_unload", "(", "hw_config", ",", "0", ")", ";", "kfree", "(", "hw_config", ")", ";", "}", "MODULE_AUTHOR", "(", "\"", "Alan", "Cox", "\"", ");", "MODULE_DESCRIPTION", "(", "\"", "Kahlua", "VSA1", "PCI", "Audio", "\"", ");", "MODULE_LICENSE", "(", "\"", "GPL", "\"", ");", "/", "*", "*", "5530", "only", ".", "The", "5510", "/", "5520", "decode", "is", "different", ".", "*", "/", "static", "const", "struct", "pci_device_id", "id_tbl", "[", "]", "=", "{", "{", "PCI_VDEVICE", "(", "CYRIX", ",", "PCI_DEVICE_ID_CYRIX_5530_AUDIO", ")", ",", "0", "}", ",", "{", "}", "}", ";", "MODULE_DEVICE_TABLE", "(", "pci", ",", "id_tbl", ")", ";", "static", "struct", "pci_driver", "kahlua_driver", "=", "{", ".", "name", "=", "\"", "kahlua", "\"", ",", ".", "id_table", "=", "id_tbl", ",", ".", "probe", "=", "probe_one", ",", ".", "remove", "=", "remove_one", ",", "}", ";", "static", "int", "__init", "kahlua_init_module", "(", "void", ")", "{", "printk", "(", "KERN_INFO", "\"", "Cyrix", "Kahlua", "VSA1", "XpressAudio", "support", "(", "c", ")", "Copyright", "2003", "Red", "Hat", "Inc", "\\", "n", "\"", ");", "return", "pci_register_driver", "(", "&", "kahlua_driver", ")", ";", "}", "static", "void", "kahlua_cleanup_module", "(", "void", ")", "{", "pci_unregister_driver", "(", "&", "kahlua_driver", ")", ";", "}", "module_init", "(", "kahlua_init_module", ")", ";", "module_exit", "(", "kahlua_cleanup_module", ")", ";", "@", "@", "-", "1", ",", "22", "+", "0", ",", "0", "@", "@", "static", "unsigned", "char", "ctrl_def_values", "[", "128", "]", "=", "{", "0x40", ",", "0x00", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x7f", ",", "/", "*", "0", "to", "7", "*", "/", "0x40", ",", "0x40", ",", "0x40", ",", "0x7f", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "/", "*", "8", "to", "15", "*", "/", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "/", "*", "16", "to", "23", "*", "/", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "0x40", ",", "/", "*", "24", "to", "31", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "32", "to", "39", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "40", "to", "47", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "48", "to", "55", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "56", "to", "63", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "64", "to", "71", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "72", "to", "79", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "80", "to", "87", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "88", "to", "95", "*", "/", "0x00", ",", "0x00", ",", "0x7f", ",", "0x7f", ",", "0x7f", ",", "0x7f", ",", "0x00", ",", "0x00", ",", "/", "*", "96", "to", "103", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "104", "to", "111", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "112", "to", "119", "*", "/", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "0x00", ",", "/", "*", "120", "to", "127", "*", "/", "}", ";", "@", "@", "-", "1", ",", "712", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "midi_synth", ".", "c", "*", "*", "High", "level", "midi", "sequencer", "manager", "for", "dumb", "MIDI", "interfaces", ".", "*", "/", "/", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "/", "/", "*", "*", "Thomas", "Sailer", ":", "ioctl", "code", "reworked", "(", "vmalloc", "/", "vfree", "removed", ")", "*", "Andrew", "Veliath", ":", "fixed", "running", "status", "in", "MIDI", "input", "state", "machine", "*", "/", "#", "define", "USE_SEQ_MACROS", "#", "define", "USE_SIMPLE_MACROS", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "define", "_MIDI_SYNTH_C_", "#", "include", "\"", "midi_synth", ".", "h", "\"", "static", "int", "midi2synth", "[", "MAX_MIDI_DEV", "]", ";", "static", "int", "sysex_state", "[", "MAX_MIDI_DEV", "]", "=", "{", "0", "}", ";", "static", "unsigned", "char", "prev_out_status", "[", "MAX_MIDI_DEV", "]", ";", "#", "define", "STORE", "(", "cmd", ")", "\\", "{", "\\", "int", "len", ";", "\\", "unsigned", "char", "obuf", "[", "8", "]", ";", "\\", "cmd", ";", "\\", "seq_input_event", "(", "obuf", ",", "len", ")", ";", "\\", "}", "#", "define", "_seqbuf", "obuf", "#", "define", "_seqbufptr", "0", "#", "define", "_SEQ_ADVBUF", "(", "x", ")", "len", "=", "x", "void", "do_midi_msg", "(", "int", "synthno", ",", "unsigned", "char", "*", "msg", ",", "int", "mlen", ")", "{", "switch", "(", "msg", "[", "0", "]", "&", "0xf0", ")", "{", "case", "0x90", ":", "if", "(", "msg", "[", "2", "]", "!", "=", "0", ")", "{", "STORE", "(", "SEQ_START_NOTE", "(", "synthno", ",", "msg", "[", "0", "]", "&", "0x0f", ",", "msg", "[", "1", "]", ",", "msg", "[", "2", "]", "))", ";", "break", ";", "}", "msg", "[", "2", "]", "=", "64", ";", "case", "0x80", ":", "STORE", "(", "SEQ_STOP_NOTE", "(", "synthno", ",", "msg", "[", "0", "]", "&", "0x0f", ",", "msg", "[", "1", "]", ",", "msg", "[", "2", "]", "))", ";", "break", ";", "case", "0xA0", ":", "STORE", "(", "SEQ_KEY_PRESSURE", "(", "synthno", ",", "msg", "[", "0", "]", "&", "0x0f", ",", "msg", "[", "1", "]", ",", "msg", "[", "2", "]", "))", ";", "break", ";", "case", "0xB0", ":", "STORE", "(", "SEQ_CONTROL", "(", "synthno", ",", "msg", "[", "0", "]", "&", "0x0f", ",", "msg", "[", "1", "]", ",", "msg", "[", "2", "]", "))", ";", "break", ";", "case", "0xC0", ":", "STORE", "(", "SEQ_SET_PATCH", "(", "synthno", ",", "msg", "[", "0", "]", "&", "0x0f", ",", "msg", "[", "1", "]", "))", ";", "break", ";", "case", "0xD0", ":", "STORE", "(", "SEQ_CHN_PRESSURE", "(", "synthno", ",", "msg", "[", "0", "]", "&", "0x0f", ",", "msg", "[", "1", "]", "))", ";", "break", ";", "case", "0xE0", ":", "STORE", "(", "SEQ_BENDER", "(", "synthno", ",", "msg", "[", "0", "]", "&", "0x0f", ",", "(", "msg", "[", "1", "]", "&", "0x7f", ")", "|", "(", "(", "msg", "[", "2", "]", "&", "0x7f", ")", "<", "<", "7", ")", "))", ";", "break", ";", "default", ":", "/", "*", "printk", "(", "\"", "MPU", ":", "Unknown", "midi", "channel", "message", "%", "02x", "\\", "n", "\"", ",", "msg", "[", "0", "]", ");", "*", "/", ";", "}", "}", "EXPORT_SYMBOL", "(", "do_midi_msg", ")", ";", "static", "void", "midi_outc", "(", "int", "midi_dev", ",", "int", "data", ")", "{", "int", "timeout", ";", "for", "(", "timeout", "=", "0", ";", "timeout", "<", "3200", ";", "timeout", "+", "+)", "if", "(", "midi_devs", "[", "midi_dev", "]", "->", "outputc", "(", "midi_dev", ",", "(", "unsigned", "char", ")", "(", "data", "&", "0xff", ")", "))", "{", "if", "(", "data", "&", "0x80", ")", "/", "*", "*", "Status", "byte", "*", "/", "prev_out_status", "[", "midi_dev", "]", "=", "(", "unsigned", "char", ")", "(", "data", "&", "0xff", ")", ";", "/", "*", "*", "Store", "for", "running", "status", "*", "/", "return", ";", "/", "*", "*", "Mission", "complete", "*", "/", "}", "/", "*", "*", "Sorry", "!", "No", "space", "on", "buffers", ".", "*", "/", "printk", "(", "\"", "Midi", "send", "timed", "out", "\\", "n", "\"", ");", "}", "static", "int", "prefix_cmd", "(", "int", "midi_dev", ",", "unsigned", "char", "status", ")", "{", "if", "(", "(", "char", "*", ")", "midi_devs", "[", "midi_dev", "]", "->", "prefix_cmd", "=", "=", "NULL", ")", "return", "1", ";", "return", "midi_devs", "[", "midi_dev", "]", "->", "prefix_cmd", "(", "midi_dev", ",", "status", ")", ";", "}", "static", "void", "midi_synth_input", "(", "int", "orig_dev", ",", "unsigned", "char", "data", ")", "{", "int", "dev", ";", "struct", "midi_input_info", "*", "inc", ";", "static", "unsigned", "char", "len_tab", "[", "]", "=", "/", "*", "#", "of", "data", "bytes", "following", "a", "status", "*", "/", "{", "2", ",", "/", "*", "8x", "*", "/", "2", ",", "/", "*", "9x", "*", "/", "2", ",", "/", "*", "Ax", "*", "/", "2", ",", "/", "*", "Bx", "*", "/", "1", ",", "/", "*", "Cx", "*", "/", "1", ",", "/", "*", "Dx", "*", "/", "2", ",", "/", "*", "Ex", "*", "/", "0", "/", "*", "Fx", "*", "/", "}", ";", "if", "(", "orig_dev", "<", "0", "|", "|", "orig_dev", ">", "num_midis", "|", "|", "midi_devs", "[", "orig_dev", "]", "=", "=", "NULL", ")", "return", ";", "if", "(", "data", "=", "=", "0xfe", ")", "/", "*", "Ignore", "active", "sensing", "*", "/", "return", ";", "dev", "=", "midi2synth", "[", "orig_dev", "]", ";", "inc", "=", "&", "midi_devs", "[", "orig_dev", "]", "->", "in_info", ";", "switch", "(", "inc", "-", ">", "m_state", ")", "{", "case", "MST_INIT", ":", "if", "(", "data", "&", "0x80", ")", "/", "*", "MIDI", "status", "byte", "*", "/", "{", "if", "(", "(", "data", "&", "0xf0", ")", "=", "=", "0xf0", ")", "/", "*", "Common", "message", "*", "/", "{", "switch", "(", "data", ")", "{", "case", "0xf0", ":", "/", "*", "Sysex", "*", "/", "inc", "-", ">", "m_state", "=", "MST_SYSEX", ";", "break", ";", "/", "*", "Sysex", "*", "/", "case", "0xf1", ":", "/", "*", "MTC", "quarter", "frame", "*", "/", "case", "0xf3", ":", "/", "*", "Song", "select", "*", "/", "inc", "-", ">", "m_state", "=", "MST_DATA", ";", "inc", "-", ">", "m_ptr", "=", "1", ";", "inc", "-", ">", "m_left", "=", "1", ";", "inc", "-", ">", "m_buf", "[", "0", "]", "=", "data", ";", "break", ";", "case", "0xf2", ":", "/", "*", "Song", "position", "pointer", "*", "/", "inc", "-", ">", "m_state", "=", "MST_DATA", ";", "inc", "-", ">", "m_ptr", "=", "1", ";", "inc", "-", ">", "m_left", "=", "2", ";", "inc", "-", ">", "m_buf", "[", "0", "]", "=", "data", ";", "break", ";", "default", ":", "inc", "-", ">", "m_buf", "[", "0", "]", "=", "data", ";", "inc", "-", ">", "m_ptr", "=", "1", ";", "do_midi_msg", "(", "dev", ",", "inc", "-", ">", "m_buf", ",", "inc", "-", ">", "m_ptr", ")", ";", "inc", "-", ">", "m_ptr", "=", "0", ";", "inc", "-", ">", "m_left", "=", "0", ";", "}", "}", "else", "{", "inc", "-", ">", "m_state", "=", "MST_DATA", ";", "inc", "-", ">", "m_ptr", "=", "1", ";", "inc", "-", ">", "m_left", "=", "len_tab", "[", "(", "data", ">", ">", "4", ")", "-", "8", "]", ";", "inc", "-", ">", "m_buf", "[", "0", "]", "=", "inc", "-", ">", "m_prev_status", "=", "data", ";", "}", "}", "else", "if", "(", "inc", "-", ">", "m_prev_status", "&", "0x80", ")", "{", "/", "*", "Data", "byte", "(", "use", "running", "status", ")", "*", "/", "inc", "-", ">", "m_ptr", "=", "2", ";", "inc", "-", ">", "m_buf", "[", "1", "]", "=", "data", ";", "inc", "-", ">", "m_buf", "[", "0", "]", "=", "inc", "-", ">", "m_prev_status", ";", "inc", "-", ">", "m_left", "=", "len_tab", "[", "(", "inc", "-", ">", "m_buf", "[", "0", "]", ">", ">", "4", ")", "-", "8", "]", "-", "1", ";", "if", "(", "inc", "-", ">", "m_left", ">", "0", ")", "inc", "-", ">", "m_state", "=", "MST_DATA", ";", "/", "*", "Not", "done", "yet", "*", "/", "else", "{", "inc", "-", ">", "m_state", "=", "MST_INIT", ";", "do_midi_msg", "(", "dev", ",", "inc", "-", ">", "m_buf", ",", "inc", "-", ">", "m_ptr", ")", ";", "inc", "-", ">", "m_ptr", "=", "0", ";", "}", "}", "break", ";", "/", "*", "MST_INIT", "*", "/", "case", "MST_DATA", ":", "inc", "-", ">", "m_buf", "[", "inc", "-", ">", "m_ptr", "+", "+]", "=", "data", ";", "if", "(", "--", "inc", "-", ">", "m_left", "<", "=", "0", ")", "{", "inc", "-", ">", "m_state", "=", "MST_INIT", ";", "do_midi_msg", "(", "dev", ",", "inc", "-", ">", "m_buf", ",", "inc", "-", ">", "m_ptr", ")", ";", "inc", "-", ">", "m_ptr", "=", "0", ";", "}", "break", ";", "/", "*", "MST_DATA", "*", "/", "case", "MST_SYSEX", ":", "if", "(", "data", "=", "=", "0xf7", ")", "/", "*", "Sysex", "end", "*", "/", "{", "inc", "-", ">", "m_state", "=", "MST_INIT", ";", "inc", "-", ">", "m_left", "=", "0", ";", "inc", "-", ">", "m_ptr", "=", "0", ";", "}", "break", ";", "/", "*", "MST_SYSEX", "*", "/", "default", ":", "printk", "(", "\"", "MIDI", "%", "d", ":", "Unexpected", "state", "%", "d", "(", "%", "02x", ")", "\\", "n", "\"", ",", "orig_dev", ",", "inc", "-", ">", "m_state", ",", "(", "int", ")", "data", ")", ";", "inc", "-", ">", "m_state", "=", "MST_INIT", ";", "}", "}", "static", "void", "leave_sysex", "(", "int", "dev", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "int", "timeout", "=", "0", ";", "if", "(", "!", "sysex_state", "[", "dev", "]", ")", "return", ";", "sysex_state", "[", "dev", "]", "=", "0", ";", "while", "(", "!", "midi_devs", "[", "orig_dev", "]", "->", "outputc", "(", "orig_dev", ",", "0xf7", ")", "&", "&", "timeout", "<", "1000", ")", "timeout", "+", "+;", "sysex_state", "[", "dev", "]", "=", "0", ";", "}", "static", "void", "midi_synth_output", "(", "int", "dev", ")", "{", "/", "*", "*", "Currently", "NOP", "*", "/", "}", "int", "midi_synth_ioctl", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", "{", "/", "*", "*", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "*", "/", "switch", "(", "cmd", ")", "{", "case", "SNDCTL_SYNTH_INFO", ":", "if", "(", "__copy_to_user", "(", "arg", ",", "synth_devs", "[", "dev", "]", "->", "info", ",", "sizeof", "(", "struct", "synth_info", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_SYNTH_MEMAVL", ":", "return", "0x7fffffff", ";", "default", ":", "return", "-", "EINVAL", ";", "}", "}", "EXPORT_SYMBOL", "(", "midi_synth_ioctl", ")", ";", "int", "midi_synth_kill_note", "(", "int", "dev", ",", "int", "channel", ",", "int", "note", ",", "int", "velocity", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "int", "msg", ",", "chn", ";", "if", "(", "note", "<", "0", "|", "|", "note", ">", "127", ")", "return", "0", ";", "if", "(", "channel", "<", "0", "|", "|", "channel", ">", "15", ")", "return", "0", ";", "if", "(", "velocity", "<", "0", ")", "velocity", "=", "0", ";", "if", "(", "velocity", ">", "127", ")", "velocity", "=", "127", ";", "leave_sysex", "(", "dev", ")", ";", "msg", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0xf0", ";", "chn", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0x0f", ";", "if", "(", "chn", "=", "=", "channel", "&", "&", "(", "(", "msg", "=", "=", "0x90", "&", "&", "velocity", "=", "=", "64", ")", "|", "|", "msg", "=", "=", "0x80", ")", ")", "{", "/", "*", "*", "Use", "running", "status", "*", "/", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "note", ")", ")", "return", "0", ";", "midi_outc", "(", "orig_dev", ",", "note", ")", ";", "if", "(", "msg", "=", "=", "0x90", ")", "/", "*", "*", "Running", "status", "=", "Note", "on", "*", "/", "midi_outc", "(", "orig_dev", ",", "0", ")", ";", "/", "*", "*", "Note", "on", "with", "velocity", "0", "=", "=", "note", "*", "off", "*", "/", "else", "midi_outc", "(", "orig_dev", ",", "velocity", ")", ";", "}", "else", "{", "if", "(", "velocity", "=", "=", "64", ")", "{", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0x90", "|", "(", "channel", "&", "0x0f", ")", "))", "return", "0", ";", "midi_outc", "(", "orig_dev", ",", "0x90", "|", "(", "channel", "&", "0x0f", ")", ");", "/", "*", "*", "Note", "on", "*", "/", "midi_outc", "(", "orig_dev", ",", "note", ")", ";", "midi_outc", "(", "orig_dev", ",", "0", ")", ";", "/", "*", "*", "Zero", "G", "*", "/", "}", "else", "{", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0x80", "|", "(", "channel", "&", "0x0f", ")", "))", "return", "0", ";", "midi_outc", "(", "orig_dev", ",", "0x80", "|", "(", "channel", "&", "0x0f", ")", ");", "/", "*", "*", "Note", "off", "*", "/", "midi_outc", "(", "orig_dev", ",", "note", ")", ";", "midi_outc", "(", "orig_dev", ",", "velocity", ")", ";", "}", "}", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_kill_note", ")", ";", "int", "midi_synth_set_instr", "(", "int", "dev", ",", "int", "channel", ",", "int", "instr_no", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "if", "(", "instr_no", "<", "0", "|", "|", "instr_no", ">", "127", ")", "instr_no", "=", "0", ";", "if", "(", "channel", "<", "0", "|", "|", "channel", ">", "15", ")", "return", "0", ";", "leave_sysex", "(", "dev", ")", ";", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0xc0", "|", "(", "channel", "&", "0x0f", ")", "))", "return", "0", ";", "midi_outc", "(", "orig_dev", ",", "0xc0", "|", "(", "channel", "&", "0x0f", ")", ");", "/", "*", "*", "Program", "change", "*", "/", "midi_outc", "(", "orig_dev", ",", "instr_no", ")", ";", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_set_instr", ")", ";", "int", "midi_synth_start_note", "(", "int", "dev", ",", "int", "channel", ",", "int", "note", ",", "int", "velocity", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "int", "msg", ",", "chn", ";", "if", "(", "note", "<", "0", "|", "|", "note", ">", "127", ")", "return", "0", ";", "if", "(", "channel", "<", "0", "|", "|", "channel", ">", "15", ")", "return", "0", ";", "if", "(", "velocity", "<", "0", ")", "velocity", "=", "0", ";", "if", "(", "velocity", ">", "127", ")", "velocity", "=", "127", ";", "leave_sysex", "(", "dev", ")", ";", "msg", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0xf0", ";", "chn", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0x0f", ";", "if", "(", "chn", "=", "=", "channel", "&", "&", "msg", "=", "=", "0x90", ")", "{", "/", "*", "*", "Use", "running", "status", "*", "/", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "note", ")", ")", "return", "0", ";", "midi_outc", "(", "orig_dev", ",", "note", ")", ";", "midi_outc", "(", "orig_dev", ",", "velocity", ")", ";", "}", "else", "{", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0x90", "|", "(", "channel", "&", "0x0f", ")", "))", "return", "0", ";", "midi_outc", "(", "orig_dev", ",", "0x90", "|", "(", "channel", "&", "0x0f", ")", ");", "/", "*", "*", "Note", "on", "*", "/", "midi_outc", "(", "orig_dev", ",", "note", ")", ";", "midi_outc", "(", "orig_dev", ",", "velocity", ")", ";", "}", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_start_note", ")", ";", "void", "midi_synth_reset", "(", "int", "dev", ")", "{", "leave_sysex", "(", "dev", ")", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_reset", ")", ";", "int", "midi_synth_open", "(", "int", "dev", ",", "int", "mode", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "int", "err", ";", "struct", "midi_input_info", "*", "inc", ";", "if", "(", "orig_dev", "<", "0", "|", "|", "orig_dev", ">", "=", "num_midis", "|", "|", "midi_devs", "[", "orig_dev", "]", "=", "=", "NULL", ")", "return", "-", "ENXIO", ";", "midi2synth", "[", "orig_dev", "]", "=", "dev", ";", "sysex_state", "[", "dev", "]", "=", "0", ";", "prev_out_status", "[", "orig_dev", "]", "=", "0", ";", "if", "(", "(", "err", "=", "midi_devs", "[", "orig_dev", "]", "->", "open", "(", "orig_dev", ",", "mode", ",", "midi_synth_input", ",", "midi_synth_output", ")", ")", "<", "0", ")", "return", "err", ";", "inc", "=", "&", "midi_devs", "[", "orig_dev", "]", "->", "in_info", ";", "/", "*", "save_flags", "(", "flags", ")", ";", "cli", "(", ");", "don", "'", "t", "know", "against", "what", "irqhandler", "to", "protect", "*", "/", "inc", "-", ">", "m_busy", "=", "0", ";", "inc", "-", ">", "m_state", "=", "MST_INIT", ";", "inc", "-", ">", "m_ptr", "=", "0", ";", "inc", "-", ">", "m_left", "=", "0", ";", "inc", "-", ">", "m_prev_status", "=", "0x00", ";", "/", "*", "restore_flags", "(", "flags", ")", ";", "*", "/", "return", "1", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_open", ")", ";", "void", "midi_synth_close", "(", "int", "dev", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "leave_sysex", "(", "dev", ")", ";", "/", "*", "*", "Shut", "up", "the", "synths", "by", "sending", "just", "single", "active", "sensing", "message", ".", "*", "/", "midi_devs", "[", "orig_dev", "]", "->", "outputc", "(", "orig_dev", ",", "0xfe", ")", ";", "midi_devs", "[", "orig_dev", "]", "->", "close", "(", "orig_dev", ")", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_close", ")", ";", "void", "midi_synth_hw_control", "(", "int", "dev", ",", "unsigned", "char", "*", "event", ")", "{", "}", "EXPORT_SYMBOL", "(", "midi_synth_hw_control", ")", ";", "int", "midi_synth_load_patch", "(", "int", "dev", ",", "int", "format", ",", "const", "char", "__user", "*", "addr", ",", "int", "count", ",", "int", "pmgr_flag", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "struct", "sysex_info", "sysex", ";", "int", "i", ";", "unsigned", "long", "left", ",", "src_offs", ",", "eox_seen", "=", "0", ";", "int", "first_byte", "=", "1", ";", "int", "hdr_size", "=", "(", "unsigned", "long", ")", "&", "sysex", ".", "data", "[", "0", "]", "-", "(", "unsigned", "long", ")", "&", "sysex", ";", "leave_sysex", "(", "dev", ")", ";", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0xf0", ")", ")", "return", "0", ";", "/", "*", "Invalid", "patch", "format", "*", "/", "if", "(", "format", "!", "=", "SYSEX_PATCH", ")", "return", "-", "EINVAL", ";", "/", "*", "Patch", "header", "too", "short", "*", "/", "if", "(", "count", "<", "hdr_size", ")", "return", "-", "EINVAL", ";", "count", "-", "=", "hdr_size", ";", "/", "*", "*", "Copy", "the", "header", "from", "user", "space", "*", "/", "if", "(", "copy_from_user", "(", "&", "sysex", ",", "addr", ",", "hdr_size", ")", ")", "return", "-", "EFAULT", ";", "/", "*", "Sysex", "record", "too", "short", "*", "/", "if", "(", "(", "unsigned", ")", "count", "<", "(", "unsigned", ")", "sysex", ".", "len", ")", "sysex", ".", "len", "=", "count", ";", "left", "=", "sysex", ".", "len", ";", "src_offs", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "left", "&", "&", "!", "signal_pending", "(", "current", ")", ";", "i", "+", "+)", "{", "unsigned", "char", "data", ";", "if", "(", "get_user", "(", "data", ",", "(", "unsigned", "char", "__user", "*", ")(", "addr", "+", "hdr_size", "+", "i", ")", "))", "return", "-", "EFAULT", ";", "eox_seen", "=", "(", "i", ">", "0", "&", "&", "data", "&", "0x80", ")", ";", "/", "*", "End", "of", "sysex", "*", "/", "if", "(", "eox_seen", "&", "&", "data", "!", "=", "0xf7", ")", "data", "=", "0xf7", ";", "if", "(", "i", "=", "=", "0", ")", "{", "if", "(", "data", "!", "=", "0xf0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "midi_synth", ":", "Sysex", "start", "missing", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "}", "while", "(", "!", "midi_devs", "[", "orig_dev", "]", "->", "outputc", "(", "orig_dev", ",", "(", "unsigned", "char", ")", "(", "data", "&", "0xff", ")", ")", "&", "&", "!", "signal_pending", "(", "current", ")", ")", "schedule", "(", ");", "if", "(", "!", "first_byte", "&", "&", "data", "&", "0x80", ")", "return", "0", ";", "first_byte", "=", "0", ";", "}", "if", "(", "!", "eox_seen", ")", "midi_outc", "(", "orig_dev", ",", "0xf7", ")", ";", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_load_patch", ")", ";", "void", "midi_synth_panning", "(", "int", "dev", ",", "int", "channel", ",", "int", "pressure", ")", "{", "}", "EXPORT_SYMBOL", "(", "midi_synth_panning", ")", ";", "void", "midi_synth_aftertouch", "(", "int", "dev", ",", "int", "channel", ",", "int", "pressure", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "int", "msg", ",", "chn", ";", "if", "(", "pressure", "<", "0", "|", "|", "pressure", ">", "127", ")", "return", ";", "if", "(", "channel", "<", "0", "|", "|", "channel", ">", "15", ")", "return", ";", "leave_sysex", "(", "dev", ")", ";", "msg", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0xf0", ";", "chn", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0x0f", ";", "if", "(", "msg", "!", "=", "0xd0", "|", "|", "chn", "!", "=", "channel", ")", "/", "*", "*", "Test", "for", "running", "status", "*", "/", "{", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0xd0", "|", "(", "channel", "&", "0x0f", ")", "))", "return", ";", "midi_outc", "(", "orig_dev", ",", "0xd0", "|", "(", "channel", "&", "0x0f", ")", ");", "/", "*", "*", "Channel", "pressure", "*", "/", "}", "else", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "pressure", ")", ")", "return", ";", "midi_outc", "(", "orig_dev", ",", "pressure", ")", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_aftertouch", ")", ";", "void", "midi_synth_controller", "(", "int", "dev", ",", "int", "channel", ",", "int", "ctrl_num", ",", "int", "value", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "int", "chn", ",", "msg", ";", "if", "(", "ctrl_num", "<", "0", "|", "|", "ctrl_num", ">", "127", ")", "return", ";", "if", "(", "channel", "<", "0", "|", "|", "channel", ">", "15", ")", "return", ";", "leave_sysex", "(", "dev", ")", ";", "msg", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0xf0", ";", "chn", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0x0f", ";", "if", "(", "msg", "!", "=", "0xb0", "|", "|", "chn", "!", "=", "channel", ")", "{", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0xb0", "|", "(", "channel", "&", "0x0f", ")", "))", "return", ";", "midi_outc", "(", "orig_dev", ",", "0xb0", "|", "(", "channel", "&", "0x0f", ")", ");", "}", "else", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "ctrl_num", ")", ")", "return", ";", "midi_outc", "(", "orig_dev", ",", "ctrl_num", ")", ";", "midi_outc", "(", "orig_dev", ",", "value", "&", "0x7f", ")", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_controller", ")", ";", "void", "midi_synth_bender", "(", "int", "dev", ",", "int", "channel", ",", "int", "value", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "int", "msg", ",", "prev_chn", ";", "if", "(", "channel", "<", "0", "|", "|", "channel", ">", "15", ")", "return", ";", "if", "(", "value", "<", "0", "|", "|", "value", ">", "16383", ")", "return", ";", "leave_sysex", "(", "dev", ")", ";", "msg", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0xf0", ";", "prev_chn", "=", "prev_out_status", "[", "orig_dev", "]", "&", "0x0f", ";", "if", "(", "msg", "!", "=", "0xd0", "|", "|", "prev_chn", "!", "=", "channel", ")", "/", "*", "*", "Test", "for", "running", "status", "*", "/", "{", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0xe0", "|", "(", "channel", "&", "0x0f", ")", "))", "return", ";", "midi_outc", "(", "orig_dev", ",", "0xe0", "|", "(", "channel", "&", "0x0f", ")", ");", "}", "else", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "value", "&", "0x7f", ")", ")", "return", ";", "midi_outc", "(", "orig_dev", ",", "value", "&", "0x7f", ")", ";", "midi_outc", "(", "orig_dev", ",", "(", "value", ">", ">", "7", ")", "&", "0x7f", ")", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_bender", ")", ";", "void", "midi_synth_setup_voice", "(", "int", "dev", ",", "int", "voice", ",", "int", "channel", ")", "{", "}", "EXPORT_SYMBOL", "(", "midi_synth_setup_voice", ")", ";", "int", "midi_synth_send_sysex", "(", "int", "dev", ",", "unsigned", "char", "*", "bytes", ",", "int", "len", ")", "{", "int", "orig_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "len", ";", "i", "+", "+)", "{", "switch", "(", "bytes", "[", "i", "]", ")", "{", "case", "0xf0", ":", "/", "*", "Start", "sysex", "*", "/", "if", "(", "!", "prefix_cmd", "(", "orig_dev", ",", "0xf0", ")", ")", "return", "0", ";", "sysex_state", "[", "dev", "]", "=", "1", ";", "break", ";", "case", "0xf7", ":", "/", "*", "End", "sysex", "*", "/", "if", "(", "!", "sysex_state", "[", "dev", "]", ")", "/", "*", "Orphan", "sysex", "end", "*", "/", "return", "0", ";", "sysex_state", "[", "dev", "]", "=", "0", ";", "break", ";", "default", ":", "if", "(", "!", "sysex_state", "[", "dev", "]", ")", "return", "0", ";", "if", "(", "bytes", "[", "i", "]", "&", "0x80", ")", "/", "*", "Error", ".", "Another", "message", "before", "sysex", "end", "*", "/", "{", "bytes", "[", "i", "]", "=", "0xf7", ";", "/", "*", "Sysex", "end", "*", "/", "sysex_state", "[", "dev", "]", "=", "0", ";", "}", "}", "if", "(", "!", "midi_devs", "[", "orig_dev", "]", "->", "outputc", "(", "orig_dev", ",", "bytes", "[", "i", "]", "))", "{", "/", "*", "*", "Hardware", "level", "buffer", "is", "full", ".", "Abort", "the", "sysex", "message", ".", "*", "/", "int", "timeout", "=", "0", ";", "bytes", "[", "i", "]", "=", "0xf7", ";", "sysex_state", "[", "dev", "]", "=", "0", ";", "while", "(", "!", "midi_devs", "[", "orig_dev", "]", "->", "outputc", "(", "orig_dev", ",", "bytes", "[", "i", "]", ")", "&", "&", "timeout", "<", "1000", ")", "timeout", "+", "+;", "}", "if", "(", "!", "sysex_state", "[", "dev", "]", ")", "return", "0", ";", "}", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "midi_synth_send_sysex", ")", ";", "@", "@", "-", "1", ",", "47", "+", "0", ",", "0", "@", "@", "int", "midi_synth_ioctl", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", ";", "int", "midi_synth_kill_note", "(", "int", "dev", ",", "int", "channel", ",", "int", "note", ",", "int", "velocity", ")", ";", "int", "midi_synth_set_instr", "(", "int", "dev", ",", "int", "channel", ",", "int", "instr_no", ")", ";", "int", "midi_synth_start_note", "(", "int", "dev", ",", "int", "channel", ",", "int", "note", ",", "int", "volume", ")", ";", "void", "midi_synth_reset", "(", "int", "dev", ")", ";", "int", "midi_synth_open", "(", "int", "dev", ",", "int", "mode", ")", ";", "void", "midi_synth_close", "(", "int", "dev", ")", ";", "void", "midi_synth_hw_control", "(", "int", "dev", ",", "unsigned", "char", "*", "event", ")", ";", "int", "midi_synth_load_patch", "(", "int", "dev", ",", "int", "format", ",", "const", "char", "__user", "*", "addr", ",", "int", "count", ",", "int", "pmgr_flag", ")", ";", "void", "midi_synth_panning", "(", "int", "dev", ",", "int", "channel", ",", "int", "pressure", ")", ";", "void", "midi_synth_aftertouch", "(", "int", "dev", ",", "int", "channel", ",", "int", "pressure", ")", ";", "void", "midi_synth_controller", "(", "int", "dev", ",", "int", "channel", ",", "int", "ctrl_num", ",", "int", "value", ")", ";", "void", "midi_synth_bender", "(", "int", "dev", ",", "int", "chn", ",", "int", "value", ")", ";", "void", "midi_synth_setup_voice", "(", "int", "dev", ",", "int", "voice", ",", "int", "chn", ")", ";", "int", "midi_synth_send_sysex", "(", "int", "dev", ",", "unsigned", "char", "*", "bytes", ",", "int", "len", ")", ";", "#", "ifndef", "_MIDI_SYNTH_C_", "static", "struct", "synth_info", "std_synth_info", "=", "{", "MIDI_SYNTH_NAME", ",", "0", ",", "SYNTH_TYPE_MIDI", ",", "0", ",", "0", ",", "128", ",", "0", ",", "128", ",", "MIDI_SYNTH_CAPS", "}", ";", "static", "struct", "synth_operations", "std_midi_synth", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "id", "=", "\"", "MIDI", "\"", ",", ".", "info", "=", "&", "std_synth_info", ",", ".", "midi_dev", "=", "0", ",", ".", "synth_type", "=", "SYNTH_TYPE_MIDI", ",", ".", "synth_subtype", "=", "0", ",", ".", "open", "=", "midi_synth_open", ",", ".", "close", "=", "midi_synth_close", ",", ".", "ioctl", "=", "midi_synth_ioctl", ",", ".", "kill_note", "=", "midi_synth_kill_note", ",", ".", "start_note", "=", "midi_synth_start_note", ",", ".", "set_instr", "=", "midi_synth_set_instr", ",", ".", "reset", "=", "midi_synth_reset", ",", ".", "hw_control", "=", "midi_synth_hw_control", ",", ".", "load_patch", "=", "midi_synth_load_patch", ",", ".", "aftertouch", "=", "midi_synth_aftertouch", ",", ".", "controller", "=", "midi_synth_controller", ",", ".", "panning", "=", "midi_synth_panning", ",", ".", "bender", "=", "midi_synth_bender", ",", ".", "setup_voice", "=", "midi_synth_setup_voice", ",", ".", "send_sysex", "=", "midi_synth_send_sysex", "}", ";", "#", "endif", "@", "@", "-", "1", ",", "427", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "midibuf", ".", "c", "*", "*", "Device", "file", "manager", "for", "/", "dev", "/", "midi", "#", "*", "/", "/", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "/", "/", "*", "*", "Thomas", "Sailer", ":", "ioctl", "code", "reworked", "(", "vmalloc", "/", "vfree", "removed", ")", "*", "/", "#", "include", "<", "linux", "/", "stddef", ".", "h", ">", "#", "include", "<", "linux", "/", "kmod", ".", "h", ">", "#", "include", "<", "linux", "/", "spinlock", ".", "h", ">", "#", "include", "<", "linux", "/", "sched", "/", "signal", ".", "h", ">", "#", "define", "MIDIBUF_C", "#", "include", "\"", "sound_config", ".", "h", "\"", "/", "*", "*", "Don", "'", "t", "make", "MAX_QUEUE_SIZE", "larger", "than", "4000", "*", "/", "#", "define", "MAX_QUEUE_SIZE", "4000", "static", "wait_queue_head_t", "midi_sleeper", "[", "MAX_MIDI_DEV", "]", ";", "static", "wait_queue_head_t", "input_sleeper", "[", "MAX_MIDI_DEV", "]", ";", "struct", "midi_buf", "{", "int", "len", ",", "head", ",", "tail", ";", "unsigned", "char", "queue", "[", "MAX_QUEUE_SIZE", "]", ";", "}", ";", "struct", "midi_parms", "{", "long", "prech_timeout", ";", "/", "*", "*", "Timeout", "before", "the", "first", "ch", "*", "/", "}", ";", "static", "struct", "midi_buf", "*", "midi_out_buf", "[", "MAX_MIDI_DEV", "]", "=", "{", "NULL", "}", ";", "static", "struct", "midi_buf", "*", "midi_in_buf", "[", "MAX_MIDI_DEV", "]", "=", "{", "NULL", "}", ";", "static", "struct", "midi_parms", "parms", "[", "MAX_MIDI_DEV", "]", ";", "static", "void", "midi_poll", "(", "unsigned", "long", "dummy", ")", ";", "static", "DEFINE_TIMER", "(", "poll_timer", ",", "midi_poll", ",", "0", ",", "0", ")", ";", "static", "volatile", "int", "open_devs", ";", "static", "DEFINE_SPINLOCK", "(", "lock", ")", ";", "#", "define", "DATA_AVAIL", "(", "q", ")", "(", "q", "-", ">", "len", ")", "#", "define", "SPACE_AVAIL", "(", "q", ")", "(", "MAX_QUEUE_SIZE", "-", "q", "-", ">", "len", ")", "#", "define", "QUEUE_BYTE", "(", "q", ",", "data", ")", "\\", "if", "(", "SPACE_AVAIL", "(", "q", ")", ")", "\\", "{", "\\", "unsigned", "long", "flags", ";", "\\", "spin_lock_irqsave", "(", "&", "lock", ",", "flags", ")", ";", "\\", "q", "-", ">", "queue", "[", "q", "-", ">", "tail", "]", "=", "(", "data", ")", ";", "\\", "q", "-", ">", "len", "+", "+;", "q", "-", ">", "tail", "=", "(", "q", "-", ">", "tail", "+", "1", ")", "%", "MAX_QUEUE_SIZE", ";", "\\", "spin_unlock_irqrestore", "(", "&", "lock", ",", "flags", ")", ";", "\\", "}", "#", "define", "REMOVE_BYTE", "(", "q", ",", "data", ")", "\\", "if", "(", "DATA_AVAIL", "(", "q", ")", ")", "\\", "{", "\\", "unsigned", "long", "flags", ";", "\\", "spin_lock_irqsave", "(", "&", "lock", ",", "flags", ")", ";", "\\", "data", "=", "q", "-", ">", "queue", "[", "q", "-", ">", "head", "]", ";", "\\", "q", "-", ">", "len", "-", "-;", "q", "-", ">", "head", "=", "(", "q", "-", ">", "head", "+", "1", ")", "%", "MAX_QUEUE_SIZE", ";", "\\", "spin_unlock_irqrestore", "(", "&", "lock", ",", "flags", ")", ";", "\\", "}", "static", "void", "drain_midi_queue", "(", "int", "dev", ")", "{", "/", "*", "*", "Give", "the", "Midi", "driver", "time", "to", "drain", "its", "output", "queues", "*", "/", "if", "(", "midi_devs", "[", "dev", "]", "->", "buffer_status", "!", "=", "NULL", ")", "wait_event_interruptible_timeout", "(", "midi_sleeper", "[", "dev", "]", ",", "!", "midi_devs", "[", "dev", "]", "->", "buffer_status", "(", "dev", ")", ",", "HZ", "/", "10", ")", ";", "}", "static", "void", "midi_input_intr", "(", "int", "dev", ",", "unsigned", "char", "data", ")", "{", "if", "(", "midi_in_buf", "[", "dev", "]", "=", "=", "NULL", ")", "return", ";", "if", "(", "data", "=", "=", "0xfe", ")", "/", "*", "*", "Active", "sensing", "*", "/", "return", ";", "/", "*", "*", "Ignore", "*", "/", "if", "(", "SPACE_AVAIL", "(", "midi_in_buf", "[", "dev", "]", "))", "{", "QUEUE_BYTE", "(", "midi_in_buf", "[", "dev", "]", ",", "data", ")", ";", "wake_up", "(", "&", "input_sleeper", "[", "dev", "]", ");", "}", "}", "static", "void", "midi_output_intr", "(", "int", "dev", ")", "{", "/", "*", "*", "Currently", "NOP", "*", "/", "}", "static", "void", "midi_poll", "(", "unsigned", "long", "dummy", ")", "{", "unsigned", "long", "flags", ";", "int", "dev", ";", "spin_lock_irqsave", "(", "&", "lock", ",", "flags", ")", ";", "if", "(", "open_devs", ")", "{", "for", "(", "dev", "=", "0", ";", "dev", "<", "num_midis", ";", "dev", "+", "+)", "if", "(", "midi_devs", "[", "dev", "]", "!", "=", "NULL", "&", "&", "midi_out_buf", "[", "dev", "]", "!", "=", "NULL", ")", "{", "while", "(", "DATA_AVAIL", "(", "midi_out_buf", "[", "dev", "]", "))", "{", "int", "ok", ";", "int", "c", "=", "midi_out_buf", "[", "dev", "]", "->", "queue", "[", "midi_out_buf", "[", "dev", "]", "->", "head", "]", ";", "spin_unlock_irqrestore", "(", "&", "lock", ",", "flags", ")", ";/", "*", "Give", "some", "time", "to", "others", "*", "/", "ok", "=", "midi_devs", "[", "dev", "]", "->", "outputc", "(", "dev", ",", "c", ")", ";", "spin_lock_irqsave", "(", "&", "lock", ",", "flags", ")", ";", "if", "(", "!", "ok", ")", "break", ";", "midi_out_buf", "[", "dev", "]", "->", "head", "=", "(", "midi_out_buf", "[", "dev", "]", "->", "head", "+", "1", ")", "%", "MAX_QUEUE_SIZE", ";", "midi_out_buf", "[", "dev", "]", "->", "len", "-", "-;", "}", "if", "(", "DATA_AVAIL", "(", "midi_out_buf", "[", "dev", "]", ")", "<", "100", ")", "wake_up", "(", "&", "midi_sleeper", "[", "dev", "]", ");", "}", "poll_timer", ".", "expires", "=", "(", "1", ")", "+", "jiffies", ";", "add_timer", "(", "&", "poll_timer", ")", ";", "/", "*", "*", "Come", "back", "later", "*", "/", "}", "spin_unlock_irqrestore", "(", "&", "lock", ",", "flags", ")", ";", "}", "int", "MIDIbuf_open", "(", "int", "dev", ",", "struct", "file", "*", "file", ")", "{", "int", "mode", ",", "err", ";", "dev", "=", "dev", ">", ">", "4", ";", "mode", "=", "translate_mode", "(", "file", ")", ";", "if", "(", "num_midis", ">", "MAX_MIDI_DEV", ")", "{", "printk", "(", "KERN_ERR", "\"", "midi", ":", "Too", "many", "midi", "interfaces", "\\", "n", "\"", ");", "num_midis", "=", "MAX_MIDI_DEV", ";", "}", "if", "(", "dev", "<", "0", "|", "|", "dev", ">", "=", "num_midis", "|", "|", "midi_devs", "[", "dev", "]", "=", "=", "NULL", ")", "return", "-", "ENXIO", ";", "/", "*", "*", "Interrupts", "disabled", ".", "Be", "careful", "*", "/", "module_put", "(", "midi_devs", "[", "dev", "]", "->", "owner", ")", ";", "if", "(", "(", "err", "=", "midi_devs", "[", "dev", "]", "->", "open", "(", "dev", ",", "mode", ",", "midi_input_intr", ",", "midi_output_intr", ")", ")", "<", "0", ")", "return", "err", ";", "parms", "[", "dev", "]", ".", "prech_timeout", "=", "MAX_SCHEDULE_TIMEOUT", ";", "midi_in_buf", "[", "dev", "]", "=", "vmalloc", "(", "sizeof", "(", "struct", "midi_buf", ")", ");", "if", "(", "midi_in_buf", "[", "dev", "]", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_WARNING", "\"", "midi", ":", "Can", "'", "t", "allocate", "buffer", "\\", "n", "\"", ");", "midi_devs", "[", "dev", "]", "->", "close", "(", "dev", ")", ";", "return", "-", "EIO", ";", "}", "midi_in_buf", "[", "dev", "]", "->", "len", "=", "midi_in_buf", "[", "dev", "]", "->", "head", "=", "midi_in_buf", "[", "dev", "]", "->", "tail", "=", "0", ";", "midi_out_buf", "[", "dev", "]", "=", "vmalloc", "(", "sizeof", "(", "struct", "midi_buf", ")", ");", "if", "(", "midi_out_buf", "[", "dev", "]", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_WARNING", "\"", "midi", ":", "Can", "'", "t", "allocate", "buffer", "\\", "n", "\"", ");", "midi_devs", "[", "dev", "]", "->", "close", "(", "dev", ")", ";", "vfree", "(", "midi_in_buf", "[", "dev", "]", ");", "midi_in_buf", "[", "dev", "]", "=", "NULL", ";", "return", "-", "EIO", ";", "}", "midi_out_buf", "[", "dev", "]", "->", "len", "=", "midi_out_buf", "[", "dev", "]", "->", "head", "=", "midi_out_buf", "[", "dev", "]", "->", "tail", "=", "0", ";", "open_devs", "+", "+;", "init_waitqueue_head", "(", "&", "midi_sleeper", "[", "dev", "]", ");", "init_waitqueue_head", "(", "&", "input_sleeper", "[", "dev", "]", ");", "if", "(", "open_devs", "<", "2", ")", "/", "*", "This", "was", "first", "open", "*", "/", "{", "poll_timer", ".", "expires", "=", "1", "+", "jiffies", ";", "add_timer", "(", "&", "poll_timer", ")", ";", "/", "*", "Start", "polling", "*", "/", "}", "return", "err", ";", "}", "void", "MIDIbuf_release", "(", "int", "dev", ",", "struct", "file", "*", "file", ")", "{", "int", "mode", ";", "dev", "=", "dev", ">", ">", "4", ";", "mode", "=", "translate_mode", "(", "file", ")", ";", "if", "(", "dev", "<", "0", "|", "|", "dev", ">", "=", "num_midis", "|", "|", "midi_devs", "[", "dev", "]", "=", "=", "NULL", ")", "return", ";", "/", "*", "*", "Wait", "until", "the", "queue", "is", "empty", "*", "/", "if", "(", "mode", "!", "=", "OPEN_READ", ")", "{", "midi_devs", "[", "dev", "]", "->", "outputc", "(", "dev", ",", "0xfe", ")", ";", "/", "*", "*", "Active", "sensing", "to", "shut", "the", "*", "devices", "*", "/", "wait_event_interruptible", "(", "midi_sleeper", "[", "dev", "]", ",", "!", "DATA_AVAIL", "(", "midi_out_buf", "[", "dev", "]", "))", ";", "/", "*", "*", "Sync", "*", "/", "drain_midi_queue", "(", "dev", ")", ";", "/", "*", "*", "Ensure", "the", "output", "queues", "are", "empty", "*", "/", "}", "midi_devs", "[", "dev", "]", "->", "close", "(", "dev", ")", ";", "open_devs", "-", "-;", "if", "(", "open_devs", "=", "=", "0", ")", "del_timer_sync", "(", "&", "poll_timer", ")", ";", "vfree", "(", "midi_in_buf", "[", "dev", "]", ");", "vfree", "(", "midi_out_buf", "[", "dev", "]", ");", "midi_in_buf", "[", "dev", "]", "=", "NULL", ";", "midi_out_buf", "[", "dev", "]", "=", "NULL", ";", "module_put", "(", "midi_devs", "[", "dev", "]", "->", "owner", ")", ";", "}", "int", "MIDIbuf_write", "(", "int", "dev", ",", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "int", "count", ")", "{", "int", "c", ",", "n", ",", "i", ";", "unsigned", "char", "tmp_data", ";", "dev", "=", "dev", ">", ">", "4", ";", "if", "(", "!", "count", ")", "return", "0", ";", "c", "=", "0", ";", "while", "(", "c", "<", "count", ")", "{", "n", "=", "SPACE_AVAIL", "(", "midi_out_buf", "[", "dev", "]", ");", "if", "(", "n", "=", "=", "0", ")", "{", "/", "*", "*", "No", "space", "just", "now", ".", "*", "/", "if", "(", "file", "-", ">", "f_flags", "&", "O_NONBLOCK", ")", "{", "c", "=", "-", "EAGAIN", ";", "goto", "out", ";", "}", "if", "(", "wait_event_interruptible", "(", "midi_sleeper", "[", "dev", "]", ",", "SPACE_AVAIL", "(", "midi_out_buf", "[", "dev", "]", "))", ")", "{", "c", "=", "-", "EINTR", ";", "goto", "out", ";", "}", "n", "=", "SPACE_AVAIL", "(", "midi_out_buf", "[", "dev", "]", ");", "}", "if", "(", "n", ">", "(", "count", "-", "c", ")", ")", "n", "=", "count", "-", "c", ";", "for", "(", "i", "=", "0", ";", "i", "<", "n", ";", "i", "+", "+)", "{", "/", "*", "BROKE", "BROKE", "BROKE", "-", "CAN", "'", "T", "DO", "THIS", "WITH", "CLI", "!", "!", "*", "/", "/", "*", "yes", ",", "think", "the", "same", ",", "so", "I", "removed", "the", "cli", "(", ")", "brackets", "QUEUE_BYTE", "is", "protected", "against", "interrupts", "*", "/", "if", "(", "copy_from_user", "(", "(", "char", "*", ")", "&", "tmp_data", ",", "&", "(", "buf", ")", "[", "c", "]", ",", "1", ")", ")", "{", "c", "=", "-", "EFAULT", ";", "goto", "out", ";", "}", "QUEUE_BYTE", "(", "midi_out_buf", "[", "dev", "]", ",", "tmp_data", ")", ";", "c", "+", "+;", "}", "}", "out", ":", "return", "c", ";", "}", "int", "MIDIbuf_read", "(", "int", "dev", ",", "struct", "file", "*", "file", ",", "char", "__user", "*", "buf", ",", "int", "count", ")", "{", "int", "n", ",", "c", "=", "0", ";", "unsigned", "char", "tmp_data", ";", "dev", "=", "dev", ">", ">", "4", ";", "if", "(", "!", "DATA_AVAIL", "(", "midi_in_buf", "[", "dev", "]", "))", "{", "/", "*", "*", "No", "data", "yet", ",", "wait", "*", "/", "if", "(", "file", "-", ">", "f_flags", "&", "O_NONBLOCK", ")", "{", "c", "=", "-", "EAGAIN", ";", "goto", "out", ";", "}", "wait_event_interruptible_timeout", "(", "input_sleeper", "[", "dev", "]", ",", "DATA_AVAIL", "(", "midi_in_buf", "[", "dev", "]", "),", "parms", "[", "dev", "]", ".", "prech_timeout", ")", ";", "if", "(", "signal_pending", "(", "current", ")", ")", "c", "=", "-", "EINTR", ";", "/", "*", "The", "user", "is", "getting", "restless", "*", "/", "}", "if", "(", "c", "=", "=", "0", "&", "&", "DATA_AVAIL", "(", "midi_in_buf", "[", "dev", "]", "))", "/", "*", "*", "Got", "some", "bytes", "*", "/", "{", "n", "=", "DATA_AVAIL", "(", "midi_in_buf", "[", "dev", "]", ");", "if", "(", "n", ">", "count", ")", "n", "=", "count", ";", "c", "=", "0", ";", "while", "(", "c", "<", "n", ")", "{", "char", "*", "fixit", ";", "REMOVE_BYTE", "(", "midi_in_buf", "[", "dev", "]", ",", "tmp_data", ")", ";", "fixit", "=", "(", "char", "*", ")", "&", "tmp_data", ";", "/", "*", "BROKE", "BROKE", "BROKE", "*", "/", "/", "*", "yes", "removed", "the", "cli", "(", ")", "brackets", "again", "should", "q", "-", ">", "len", ",", "tail", "&", "head", "be", "atomic_t", "?", "*", "/", "if", "(", "copy_to_user", "(", "&(", "buf", ")", "[", "c", "]", ",", "fixit", ",", "1", ")", ")", "{", "c", "=", "-", "EFAULT", ";", "goto", "out", ";", "}", "c", "+", "+;", "}", "}", "out", ":", "return", "c", ";", "}", "int", "MIDIbuf_ioctl", "(", "int", "dev", ",", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", "{", "int", "val", ";", "dev", "=", "dev", ">", ">", "4", ";", "if", "(", "((", "cmd", ">", ">", "8", ")", "&", "0xff", ")", "=", "=", "'", "C", "'", ")", "{", "if", "(", "midi_devs", "[", "dev", "]", "->", "coproc", ")", "/", "*", "Coprocessor", "ioctl", "*", "/", "return", "midi_devs", "[", "dev", "]", "->", "coproc", "-", ">", "ioctl", "(", "midi_devs", "[", "dev", "]", "->", "coproc", "-", ">", "devc", ",", "cmd", ",", "arg", ",", "0", ")", ";", "/", "*", "printk", "(", "\"/", "dev", "/", "midi", "%", "d", ":", "No", "coprocessor", "for", "this", "device", "\\", "n", "\"", ",", "dev", ")", ";*", "/", "return", "-", "ENXIO", ";", "}", "else", "{", "switch", "(", "cmd", ")", "{", "case", "SNDCTL_MIDI_PRETIME", ":", "if", "(", "get_user", "(", "val", ",", "(", "int", "__user", "*", ")", "arg", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "val", "<", "0", ")", "val", "=", "0", ";", "val", "=", "(", "HZ", "*", "val", ")", "/", "10", ";", "parms", "[", "dev", "]", ".", "prech_timeout", "=", "val", ";", "return", "put_user", "(", "val", ",", "(", "int", "__user", "*", ")", "arg", ")", ";", "default", ":", "if", "(", "!", "midi_devs", "[", "dev", "]", "->", "ioctl", ")", "return", "-", "EINVAL", ";", "return", "midi_devs", "[", "dev", "]", "->", "ioctl", "(", "dev", ",", "cmd", ",", "arg", ")", ";", "}", "}", "}", "/", "*", "No", "kernel", "lock", "-", "fine", "*", "/", "unsigned", "int", "MIDIbuf_poll", "(", "int", "dev", ",", "struct", "file", "*", "file", ",", "poll_table", "*", "wait", ")", "{", "unsigned", "int", "mask", "=", "0", ";", "dev", "=", "dev", ">", ">", "4", ";", "/", "*", "input", "*", "/", "poll_wait", "(", "file", ",", "&", "input_sleeper", "[", "dev", "]", ",", "wait", ")", ";", "if", "(", "DATA_AVAIL", "(", "midi_in_buf", "[", "dev", "]", "))", "mask", "|", "=", "POLLIN", "|", "POLLRDNORM", ";", "/", "*", "output", "*", "/", "poll_wait", "(", "file", ",", "&", "midi_sleeper", "[", "dev", "]", ",", "wait", ")", ";", "if", "(", "!", "SPACE_AVAIL", "(", "midi_out_buf", "[", "dev", "]", "))", "mask", "|", "=", "POLLOUT", "|", "POLLWRNORM", ";", "return", "mask", ";", "}", "int", "MIDIbuf_avail", "(", "int", "dev", ")", "{", "if", "(", "midi_in_buf", "[", "dev", "]", ")", "return", "DATA_AVAIL", "(", "midi_in_buf", "[", "dev", "]", ");", "return", "0", ";", "}", "EXPORT_SYMBOL", "(", "MIDIbuf_avail", ")", ";", "@", "@", "-", "1", ",", "1804", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "mpu401", ".", "c", "*", "*", "The", "low", "level", "driver", "for", "Roland", "MPU", "-", "401", "compatible", "Midi", "cards", ".", "*", "/", "/", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "*", "*", "Thomas", "Sailer", "ioctl", "code", "reworked", "(", "vmalloc", "/", "vfree", "removed", ")", "*", "Alan", "Cox", "modularisation", ",", "use", "normal", "request_irq", ",", "use", "dev_id", "*", "Bartlomiej", "Zolnierkiewicz", "removed", "some", "__init", "to", "allow", "using", "many", "drivers", "*", "Chris", "Rankin", "Update", "the", "module", "-", "usage", "counter", "for", "the", "coprocessor", "*", "Zwane", "Mwaikambo", "Changed", "attach", "/", "unload", "resource", "freeing", "*", "/", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "slab", ".", "h", ">", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "interrupt", ".", "h", ">", "#", "include", "<", "linux", "/", "spinlock", ".", "h", ">", "#", "define", "USE_SEQ_MACROS", "#", "define", "USE_SIMPLE_MACROS", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "coproc", ".", "h", "\"", "#", "include", "\"", "mpu401", ".", "h", "\"", "static", "int", "timer_mode", "=", "TMR_INTERNAL", ",", "timer_caps", "=", "TMR_INTERNAL", ";", "struct", "mpu_config", "{", "int", "base", ";", "/", "*", "*", "I", "/", "O", "base", "*", "/", "int", "irq", ";", "int", "opened", ";", "/", "*", "*", "Open", "mode", "*", "/", "int", "devno", ";", "int", "synthno", ";", "int", "uart_mode", ";", "int", "initialized", ";", "int", "mode", ";", "#", "define", "MODE_MIDI", "1", "#", "define", "MODE_SYNTH", "2", "unsigned", "char", "version", ",", "revision", ";", "unsigned", "int", "capabilities", ";", "#", "define", "MPU_CAP_INTLG", "0x10000000", "#", "define", "MPU_CAP_SYNC", "0x00000010", "#", "define", "MPU_CAP_FSK", "0x00000020", "#", "define", "MPU_CAP_CLS", "0x00000040", "#", "define", "MPU_CAP_SMPTE", "0x00000080", "#", "define", "MPU_CAP_2PORT", "0x00000001", "int", "timer_flag", ";", "#", "define", "MBUF_MAX", "10", "#", "define", "BUFTEST", "(", "dc", ")", "if", "(", "dc", "-", ">", "m_ptr", ">", "=", "MBUF_MAX", "|", "|", "dc", "-", ">", "m_ptr", "<", "0", ")", "\\", "{", "printk", "(", "\"", "MPU", ":", "Invalid", "buffer", "pointer", "%", "d", "/", "%", "d", ",", "s", "=", "%", "d", "\\", "n", "\"", ",", "dc", "-", ">", "m_ptr", ",", "dc", "-", ">", "m_left", ",", "dc", "-", ">", "m_state", ")", ";", "dc", "-", ">", "m_ptr", "-", "-;", "}", "int", "m_busy", ";", "unsigned", "char", "m_buf", "[", "MBUF_MAX", "]", ";", "int", "m_ptr", ";", "int", "m_state", ";", "int", "m_left", ";", "unsigned", "char", "last_status", ";", "void", "(", "*", "inputintr", ")", "(", "int", "dev", ",", "unsigned", "char", "data", ")", ";", "int", "shared_irq", ";", "int", "*", "osp", ";", "spinlock_t", "lock", ";", "}", ";", "#", "define", "DATAPORT", "(", "base", ")", "(", "base", ")", "#", "define", "COMDPORT", "(", "base", ")", "(", "base", "+", "1", ")", "#", "define", "STATPORT", "(", "base", ")", "(", "base", "+", "1", ")", "static", "void", "mpu401_close", "(", "int", "dev", ")", ";", "static", "inline", "int", "mpu401_status", "(", "struct", "mpu_config", "*", "devc", ")", "{", "return", "inb", "(", "STATPORT", "(", "devc", "-", ">", "base", ")", ");", "}", "#", "define", "input_avail", "(", "devc", ")", "(", "!(", "mpu401_status", "(", "devc", ")", "&", "INPUT_AVAIL", ")", ")", "#", "define", "output_ready", "(", "devc", ")", "(", "!(", "mpu401_status", "(", "devc", ")", "&", "OUTPUT_READY", ")", ")", "static", "inline", "void", "write_command", "(", "struct", "mpu_config", "*", "devc", ",", "unsigned", "char", "cmd", ")", "{", "outb", "(", "cmd", ",", "COMDPORT", "(", "devc", "-", ">", "base", ")", ");", "}", "static", "inline", "int", "read_data", "(", "struct", "mpu_config", "*", "devc", ")", "{", "return", "inb", "(", "DATAPORT", "(", "devc", "-", ">", "base", ")", ");", "}", "static", "inline", "void", "write_data", "(", "struct", "mpu_config", "*", "devc", ",", "unsigned", "char", "byte", ")", "{", "outb", "(", "byte", ",", "DATAPORT", "(", "devc", "-", ">", "base", ")", ");", "}", "#", "define", "OUTPUT_READY", "0x40", "#", "define", "INPUT_AVAIL", "0x80", "#", "define", "MPU_ACK", "0xFE", "#", "define", "MPU_RESET", "0xFF", "#", "define", "UART_MODE_ON", "0x3F", "static", "struct", "mpu_config", "dev_conf", "[", "MAX_MIDI_DEV", "]", ";", "static", "int", "n_mpu_devs", ";", "static", "int", "reset_mpu401", "(", "struct", "mpu_config", "*", "devc", ")", ";", "static", "void", "set_uart_mode", "(", "int", "dev", ",", "struct", "mpu_config", "*", "devc", ",", "int", "arg", ")", ";", "static", "int", "mpu_timer_init", "(", "int", "midi_dev", ")", ";", "static", "void", "mpu_timer_interrupt", "(", "void", ")", ";", "static", "void", "timer_ext_event", "(", "struct", "mpu_config", "*", "devc", ",", "int", "event", ",", "int", "parm", ")", ";", "static", "struct", "synth_info", "mpu_synth_info_proto", "=", "{", "\"", "MPU", "-", "401", "MIDI", "interface", "\"", ",", "0", ",", "SYNTH_TYPE_MIDI", ",", "MIDI_TYPE_MPU401", ",", "0", ",", "128", ",", "0", ",", "128", ",", "SYNTH_CAP_INPUT", "}", ";", "static", "struct", "synth_info", "mpu_synth_info", "[", "MAX_MIDI_DEV", "]", ";", "/", "*", "*", "States", "for", "the", "input", "scanner", "*", "/", "#", "define", "ST_INIT", "0", "/", "*", "Ready", "for", "timing", "byte", "or", "msg", "*", "/", "#", "define", "ST_TIMED", "1", "/", "*", "Leading", "timing", "byte", "rcvd", "*", "/", "#", "define", "ST_DATABYTE", "2", "/", "*", "Waiting", "for", "(", "nr_left", ")", "data", "bytes", "*", "/", "#", "define", "ST_SYSMSG", "100", "/", "*", "System", "message", "(", "sysx", "etc", ")", ".", "*", "/", "#", "define", "ST_SYSEX", "101", "/", "*", "System", "exclusive", "msg", "*", "/", "#", "define", "ST_MTC", "102", "/", "*", "Midi", "Time", "Code", "(", "MTC", ")", "qframe", "msg", "*", "/", "#", "define", "ST_SONGSEL", "103", "/", "*", "Song", "select", "*", "/", "#", "define", "ST_SONGPOS", "104", "/", "*", "Song", "position", "pointer", "*", "/", "static", "unsigned", "char", "len_tab", "[", "]", "=", "/", "*", "#", "of", "data", "bytes", "following", "a", "status", "*", "/", "{", "2", ",", "/", "*", "8x", "*", "/", "2", ",", "/", "*", "9x", "*", "/", "2", ",", "/", "*", "Ax", "*", "/", "2", ",", "/", "*", "Bx", "*", "/", "1", ",", "/", "*", "Cx", "*", "/", "1", ",", "/", "*", "Dx", "*", "/", "2", ",", "/", "*", "Ex", "*", "/", "0", "/", "*", "Fx", "*", "/", "}", ";", "#", "define", "STORE", "(", "cmd", ")", "\\", "{", "\\", "int", "len", ";", "\\", "unsigned", "char", "obuf", "[", "8", "]", ";", "\\", "cmd", ";", "\\", "seq_input_event", "(", "obuf", ",", "len", ")", ";", "\\", "}", "#", "define", "_seqbuf", "obuf", "#", "define", "_seqbufptr", "0", "#", "define", "_SEQ_ADVBUF", "(", "x", ")", "len", "=", "x", "static", "int", "mpu_input_scanner", "(", "struct", "mpu_config", "*", "devc", ",", "unsigned", "char", "midic", ")", "{", "switch", "(", "devc", "-", ">", "m_state", ")", "{", "case", "ST_INIT", ":", "switch", "(", "midic", ")", "{", "case", "0xf8", ":", "/", "*", "Timer", "overflow", "*", "/", "break", ";", "case", "0xfc", ":", "printk", "(", "\"<", "all", "end", ">", "\")", ";", "break", ";", "case", "0xfd", ":", "if", "(", "devc", "-", ">", "timer_flag", ")", "mpu_timer_interrupt", "(", ");", "break", ";", "case", "0xfe", ":", "return", "MPU_ACK", ";", "case", "0xf0", ":", "case", "0xf1", ":", "case", "0xf2", ":", "case", "0xf3", ":", "case", "0xf4", ":", "case", "0xf5", ":", "case", "0xf6", ":", "case", "0xf7", ":", "printk", "(", "\"<", "Trk", "data", "rq", "#", "%", "d", ">", "\",", "midic", "&", "0x0f", ")", ";", "break", ";", "case", "0xf9", ":", "printk", "(", "\"<", "conductor", "rq", ">", "\")", ";", "break", ";", "case", "0xff", ":", "devc", "-", ">", "m_state", "=", "ST_SYSMSG", ";", "break", ";", "default", ":", "if", "(", "midic", "<", "=", "0xef", ")", "{", "/", "*", "printk", "(", "\"", "mpu", "time", ":", "%", "d", "\"", ",", "midic", ")", ";", "*", "/", "devc", "-", ">", "m_state", "=", "ST_TIMED", ";", "}", "else", "printk", "(", "\"<", "MPU", ":", "Unknown", "event", "%", "02x", ">", "\"", ",", "midic", ")", ";", "}", "break", ";", "case", "ST_TIMED", ":", "{", "int", "msg", "=", "(", "(", "int", ")", "(", "midic", "&", "0xf0", ")", ">", ">", "4", ")", ";", "devc", "-", ">", "m_state", "=", "ST_DATABYTE", ";", "if", "(", "msg", "<", "8", ")", "/", "*", "Data", "byte", "*", "/", "{", "/", "*", "printk", "(", "\"", "midi", "msg", "(", "running", "status", ")", "\"", ");", "*", "/", "msg", "=", "(", "(", "int", ")", "(", "devc", "-", ">", "last_status", "&", "0xf0", ")", ">", ">", "4", ")", ";", "msg", "-", "=", "8", ";", "devc", "-", ">", "m_left", "=", "len_tab", "[", "msg", "]", "-", "1", ";", "devc", "-", ">", "m_ptr", "=", "2", ";", "devc", "-", ">", "m_buf", "[", "0", "]", "=", "devc", "-", ">", "last_status", ";", "devc", "-", ">", "m_buf", "[", "1", "]", "=", "midic", ";", "if", "(", "devc", "-", ">", "m_left", "<", "=", "0", ")", "{", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "do_midi_msg", "(", "devc", "-", ">", "synthno", ",", "devc", "-", ">", "m_buf", ",", "devc", "-", ">", "m_ptr", ")", ";", "devc", "-", ">", "m_ptr", "=", "0", ";", "}", "}", "else", "if", "(", "msg", "=", "=", "0xf", ")", "/", "*", "MPU", "MARK", "*", "/", "{", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "switch", "(", "midic", ")", "{", "case", "0xf8", ":", "/", "*", "printk", "(", "\"", "NOP", "\"", ");", "*", "/", "break", ";", "case", "0xf9", ":", "/", "*", "printk", "(", "\"", "meas", "end", "\"", ");", "*", "/", "break", ";", "case", "0xfc", ":", "/", "*", "printk", "(", "\"", "data", "end", "\"", ");", "*", "/", "break", ";", "default", ":", "printk", "(", "\"", "Unknown", "MPU", "mark", "%", "02x", "\\", "n", "\"", ",", "midic", ")", ";", "}", "}", "else", "{", "devc", "-", ">", "last_status", "=", "midic", ";", "/", "*", "printk", "(", "\"", "midi", "msg", "\"", ");", "*", "/", "msg", "-", "=", "8", ";", "devc", "-", ">", "m_left", "=", "len_tab", "[", "msg", "]", ";", "devc", "-", ">", "m_ptr", "=", "1", ";", "devc", "-", ">", "m_buf", "[", "0", "]", "=", "midic", ";", "if", "(", "devc", "-", ">", "m_left", "<", "=", "0", ")", "{", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "do_midi_msg", "(", "devc", "-", ">", "synthno", ",", "devc", "-", ">", "m_buf", ",", "devc", "-", ">", "m_ptr", ")", ";", "devc", "-", ">", "m_ptr", "=", "0", ";", "}", "}", "}", "break", ";", "case", "ST_SYSMSG", ":", "switch", "(", "midic", ")", "{", "case", "0xf0", ":", "printk", "(", "\"<", "SYX", ">", "\")", ";", "devc", "-", ">", "m_state", "=", "ST_SYSEX", ";", "break", ";", "case", "0xf1", ":", "devc", "-", ">", "m_state", "=", "ST_MTC", ";", "break", ";", "case", "0xf2", ":", "devc", "-", ">", "m_state", "=", "ST_SONGPOS", ";", "devc", "-", ">", "m_ptr", "=", "0", ";", "break", ";", "case", "0xf3", ":", "devc", "-", ">", "m_state", "=", "ST_SONGSEL", ";", "break", ";", "case", "0xf6", ":", "/", "*", "printk", "(", "\"", "tune_request", "\\", "n", "\"", ");", "*", "/", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "break", ";", "/", "*", "*", "Real", "time", "messages", "*", "/", "case", "0xf8", ":", "/", "*", "midi", "clock", "*", "/", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "timer_ext_event", "(", "devc", ",", "TMR_CLOCK", ",", "0", ")", ";", "break", ";", "case", "0xfA", ":", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "timer_ext_event", "(", "devc", ",", "TMR_START", ",", "0", ")", ";", "break", ";", "case", "0xFB", ":", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "timer_ext_event", "(", "devc", ",", "TMR_CONTINUE", ",", "0", ")", ";", "break", ";", "case", "0xFC", ":", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "timer_ext_event", "(", "devc", ",", "TMR_STOP", ",", "0", ")", ";", "break", ";", "case", "0xFE", ":", "/", "*", "active", "sensing", "*", "/", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "break", ";", "case", "0xff", ":", "/", "*", "printk", "(", "\"", "midi", "hard", "reset", "\"", ");", "*", "/", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "break", ";", "default", ":", "printk", "(", "\"", "unknown", "MIDI", "sysmsg", "%", "0x", "\\", "n", "\"", ",", "midic", ")", ";", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "}", "break", ";", "case", "ST_MTC", ":", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "printk", "(", "\"", "MTC", "frame", "%", "x02", "\\", "n", "\"", ",", "midic", ")", ";", "break", ";", "case", "ST_SYSEX", ":", "if", "(", "midic", "=", "=", "0xf7", ")", "{", "printk", "(", "\"<", "EOX", ">", "\")", ";", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "}", "else", "printk", "(", "\"%", "02x", "\"", ",", "midic", ")", ";", "break", ";", "case", "ST_SONGPOS", ":", "BUFTEST", "(", "devc", ")", ";", "devc", "-", ">", "m_buf", "[", "devc", "-", ">", "m_ptr", "+", "+]", "=", "midic", ";", "if", "(", "devc", "-", ">", "m_ptr", "=", "=", "2", ")", "{", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "devc", "-", ">", "m_ptr", "=", "0", ";", "timer_ext_event", "(", "devc", ",", "TMR_SPP", ",", "(", "(", "devc", "-", ">", "m_buf", "[", "1", "]", "&", "0x7f", ")", "<", "<", "7", ")", "|", "(", "devc", "-", ">", "m_buf", "[", "0", "]", "&", "0x7f", ")", ");", "}", "break", ";", "case", "ST_DATABYTE", ":", "BUFTEST", "(", "devc", ")", ";", "devc", "-", ">", "m_buf", "[", "devc", "-", ">", "m_ptr", "+", "+]", "=", "midic", ";", "if", "(", "(-", "-", "devc", "-", ">", "m_left", ")", "<", "=", "0", ")", "{", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "do_midi_msg", "(", "devc", "-", ">", "synthno", ",", "devc", "-", ">", "m_buf", ",", "devc", "-", ">", "m_ptr", ")", ";", "devc", "-", ">", "m_ptr", "=", "0", ";", "}", "break", ";", "default", ":", "printk", "(", "\"", "Bad", "state", "%", "d", "\"", ",", "devc", "-", ">", "m_state", ")", ";", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "}", "return", "1", ";", "}", "static", "void", "mpu401_input_loop", "(", "struct", "mpu_config", "*", "devc", ")", "{", "unsigned", "long", "flags", ";", "int", "busy", ";", "int", "n", ";", "spin_lock_irqsave", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "busy", "=", "devc", "-", ">", "m_busy", ";", "devc", "-", ">", "m_busy", "=", "1", ";", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "busy", ")", "/", "*", "Already", "inside", "the", "scanner", "*", "/", "return", ";", "n", "=", "50", ";", "while", "(", "input_avail", "(", "devc", ")", "&", "&", "n", "-", "-", ">", "0", ")", "{", "unsigned", "char", "c", "=", "read_data", "(", "devc", ")", ";", "if", "(", "devc", "-", ">", "mode", "=", "=", "MODE_SYNTH", ")", "{", "mpu_input_scanner", "(", "devc", ",", "c", ")", ";", "}", "else", "if", "(", "devc", "-", ">", "opened", "&", "OPEN_READ", "&", "&", "devc", "-", ">", "inputintr", "!", "=", "NULL", ")", "devc", "-", ">", "inputintr", "(", "devc", "-", ">", "devno", ",", "c", ")", ";", "}", "devc", "-", ">", "m_busy", "=", "0", ";", "}", "static", "irqreturn_t", "mpuintr", "(", "int", "irq", ",", "void", "*", "dev_id", ")", "{", "struct", "mpu_config", "*", "devc", ";", "int", "dev", "=", "(", "int", ")", "(", "unsigned", "long", ")", "dev_id", ";", "int", "handled", "=", "0", ";", "devc", "=", "&", "dev_conf", "[", "dev", "]", ";", "if", "(", "input_avail", "(", "devc", ")", ")", "{", "handled", "=", "1", ";", "if", "(", "devc", "-", ">", "base", "!", "=", "0", "&", "&", "(", "devc", "-", ">", "opened", "&", "OPEN_READ", "|", "|", "devc", "-", ">", "mode", "=", "=", "MODE_SYNTH", ")", ")", "mpu401_input_loop", "(", "devc", ")", ";", "else", "{", "/", "*", "Dummy", "read", "(", "just", "to", "acknowledge", "the", "interrupt", ")", "*", "/", "read_data", "(", "devc", ")", ";", "}", "}", "return", "IRQ_RETVAL", "(", "handled", ")", ";", "}", "static", "int", "mpu401_open", "(", "int", "dev", ",", "int", "mode", ",", "void", "(", "*", "input", ")", "(", "int", "dev", ",", "unsigned", "char", "data", ")", ",", "void", "(", "*", "output", ")", "(", "int", "dev", ")", ")", "{", "int", "err", ";", "struct", "mpu_config", "*", "devc", ";", "struct", "coproc_operations", "*", "coprocessor", ";", "if", "(", "dev", "<", "0", "|", "|", "dev", ">", "=", "num_midis", "|", "|", "midi_devs", "[", "dev", "]", "=", "=", "NULL", ")", "return", "-", "ENXIO", ";", "devc", "=", "&", "dev_conf", "[", "dev", "]", ";", "if", "(", "devc", "-", ">", "opened", ")", "return", "-", "EBUSY", ";", "/", "*", "*", "Verify", "that", "the", "device", "is", "really", "running", ".", "*", "Some", "devices", "(", "such", "as", "Ensoniq", "SoundScape", "don", "'", "t", "*", "work", "before", "the", "on", "board", "processor", "(", "OBP", ")", "is", "initialized", "*", "by", "downloading", "its", "microcode", ".", "*", "/", "if", "(", "!", "devc", "-", ">", "initialized", ")", "{", "if", "(", "mpu401_status", "(", "devc", ")", "=", "=", "0xff", ")", "/", "*", "Bus", "float", "*", "/", "{", "printk", "(", "KERN_ERR", "\"", "mpu401", ":", "Device", "not", "initialized", "properly", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "reset_mpu401", "(", "devc", ")", ";", "}", "if", "(", "(", "coprocessor", "=", "midi_devs", "[", "dev", "]", "->", "coproc", ")", "!", "=", "NULL", ")", "{", "if", "(", "!", "try_module_get", "(", "coprocessor", "-", ">", "owner", ")", ")", "{", "mpu401_close", "(", "dev", ")", ";", "return", "-", "ENODEV", ";", "}", "if", "(", "(", "err", "=", "coprocessor", "-", ">", "open", "(", "coprocessor", "-", ">", "devc", ",", "COPR_MIDI", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "MPU", "-", "401", ":", "Can", "'", "t", "access", "coprocessor", "device", "\\", "n", "\"", ");", "mpu401_close", "(", "dev", ")", ";", "return", "err", ";", "}", "}", "set_uart_mode", "(", "dev", ",", "devc", ",", "1", ")", ";", "devc", "-", ">", "mode", "=", "MODE_MIDI", ";", "devc", "-", ">", "synthno", "=", "0", ";", "mpu401_input_loop", "(", "devc", ")", ";", "devc", "-", ">", "inputintr", "=", "input", ";", "devc", "-", ">", "opened", "=", "mode", ";", "return", "0", ";", "}", "static", "void", "mpu401_close", "(", "int", "dev", ")", "{", "struct", "mpu_config", "*", "devc", ";", "struct", "coproc_operations", "*", "coprocessor", ";", "devc", "=", "&", "dev_conf", "[", "dev", "]", ";", "if", "(", "devc", "-", ">", "uart_mode", ")", "reset_mpu401", "(", "devc", ")", ";", "/", "*", "*", "This", "disables", "the", "UART", "mode", "*", "/", "devc", "-", ">", "mode", "=", "0", ";", "devc", "-", ">", "inputintr", "=", "NULL", ";", "coprocessor", "=", "midi_devs", "[", "dev", "]", "->", "coproc", ";", "if", "(", "coprocessor", ")", "{", "coprocessor", "-", ">", "close", "(", "coprocessor", "-", ">", "devc", ",", "COPR_MIDI", ")", ";", "module_put", "(", "coprocessor", "-", ">", "owner", ")", ";", "}", "devc", "-", ">", "opened", "=", "0", ";", "}", "static", "int", "mpu401_out", "(", "int", "dev", ",", "unsigned", "char", "midi_byte", ")", "{", "int", "timeout", ";", "unsigned", "long", "flags", ";", "struct", "mpu_config", "*", "devc", ";", "devc", "=", "&", "dev_conf", "[", "dev", "]", ";", "/", "*", "*", "Sometimes", "it", "takes", "about", "30000", "loops", "before", "the", "output", "becomes", "ready", "*", "(", "After", "reset", ")", ".", "Normally", "it", "takes", "just", "about", "10", "loops", ".", "*", "/", "for", "(", "timeout", "=", "30000", ";", "timeout", ">", "0", "&", "&", "!", "output_ready", "(", "devc", ")", ";", "timeout", "-", "-)", ";", "spin_lock_irqsave", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "!", "output_ready", "(", "devc", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Send", "data", "timeout", "\\", "n", "\"", ");", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "return", "0", ";", "}", "write_data", "(", "devc", ",", "midi_byte", ")", ";", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "return", "1", ";", "}", "static", "int", "mpu401_command", "(", "int", "dev", ",", "mpu_command_rec", "*", "cmd", ")", "{", "int", "i", ",", "timeout", ",", "ok", ";", "unsigned", "long", "flags", ";", "struct", "mpu_config", "*", "devc", ";", "devc", "=", "&", "dev_conf", "[", "dev", "]", ";", "if", "(", "devc", "-", ">", "uart_mode", ")", "/", "*", "*", "Not", "possible", "in", "UART", "mode", "*", "/", "{", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "commands", "not", "possible", "in", "the", "UART", "mode", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "/", "*", "*", "Test", "for", "input", "since", "pending", "input", "seems", "to", "block", "the", "output", ".", "*", "/", "if", "(", "input_avail", "(", "devc", ")", ")", "mpu401_input_loop", "(", "devc", ")", ";", "/", "*", "*", "Sometimes", "it", "takes", "about", "50000", "loops", "before", "the", "output", "becomes", "ready", "*", "(", "After", "reset", ")", ".", "Normally", "it", "takes", "just", "about", "10", "loops", ".", "*", "/", "timeout", "=", "50000", ";", "retry", ":", "if", "(", "timeout", "-", "-", "<", "=", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Command", "(", "0x", "%", "x", ")", "timeout", "\\", "n", "\"", ",", "(", "int", ")", "cmd", "-", ">", "cmd", ")", ";", "return", "-", "EIO", ";", "}", "spin_lock_irqsave", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "!", "output_ready", "(", "devc", ")", ")", "{", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "goto", "retry", ";", "}", "write_command", "(", "devc", ",", "cmd", "-", ">", "cmd", ")", ";", "ok", "=", "0", ";", "for", "(", "timeout", "=", "50000", ";", "timeout", ">", "0", "&", "&", "!", "ok", ";", "timeout", "-", "-)", "{", "if", "(", "input_avail", "(", "devc", ")", ")", "{", "if", "(", "devc", "-", ">", "opened", "&", "&", "devc", "-", ">", "mode", "=", "=", "MODE_SYNTH", ")", "{", "if", "(", "mpu_input_scanner", "(", "devc", ",", "read_data", "(", "devc", ")", ")", "=", "=", "MPU_ACK", ")", "ok", "=", "1", ";", "}", "else", "{", "/", "*", "Device", "is", "not", "currently", "open", ".", "Use", "simpler", "method", "*", "/", "if", "(", "read_data", "(", "devc", ")", "=", "=", "MPU_ACK", ")", "ok", "=", "1", ";", "}", "}", "}", "if", "(", "!", "ok", ")", "{", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "return", "-", "EIO", ";", "}", "if", "(", "cmd", "-", ">", "nr_args", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "cmd", "-", ">", "nr_args", ";", "i", "+", "+)", "{", "for", "(", "timeout", "=", "3000", ";", "timeout", ">", "0", "&", "&", "!", "output_ready", "(", "devc", ")", ";", "timeout", "-", "-)", ";", "if", "(", "!", "mpu401_out", "(", "dev", ",", "cmd", "-", ">", "data", "[", "i", "]", "))", "{", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Command", "(", "0x", "%", "x", ")", ",", "parm", "send", "failed", ".", "\\", "n", "\"", ",", "(", "int", ")", "cmd", "-", ">", "cmd", ")", ";", "return", "-", "EIO", ";", "}", "}", "}", "cmd", "-", ">", "data", "[", "0", "]", "=", "0", ";", "if", "(", "cmd", "-", ">", "nr_returns", ")", "{", "for", "(", "i", "=", "0", ";", "i", "<", "cmd", "-", ">", "nr_returns", ";", "i", "+", "+)", "{", "ok", "=", "0", ";", "for", "(", "timeout", "=", "5000", ";", "timeout", ">", "0", "&", "&", "!", "ok", ";", "timeout", "-", "-)", "if", "(", "input_avail", "(", "devc", ")", ")", "{", "cmd", "-", ">", "data", "[", "i", "]", "=", "read_data", "(", "devc", ")", ";", "ok", "=", "1", ";", "}", "if", "(", "!", "ok", ")", "{", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "return", "-", "EIO", ";", "}", "}", "}", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "return", "0", ";", "}", "static", "int", "mpu_cmd", "(", "int", "dev", ",", "int", "cmd", ",", "int", "data", ")", "{", "int", "ret", ";", "static", "mpu_command_rec", "rec", ";", "rec", ".", "cmd", "=", "cmd", "&", "0xff", ";", "rec", ".", "nr_args", "=", "(", "(", "cmd", "&", "0xf0", ")", "=", "=", "0xE0", ")", ";", "rec", ".", "nr_returns", "=", "(", "(", "cmd", "&", "0xf0", ")", "=", "=", "0xA0", ")", ";", "rec", ".", "data", "[", "0", "]", "=", "data", "&", "0xff", ";", "if", "(", "(", "ret", "=", "mpu401_command", "(", "dev", ",", "&", "rec", ")", ")", "<", "0", ")", "return", "ret", ";", "return", "(", "unsigned", "char", ")", "rec", ".", "data", "[", "0", "]", ";", "}", "static", "int", "mpu401_prefix_cmd", "(", "int", "dev", ",", "unsigned", "char", "status", ")", "{", "struct", "mpu_config", "*", "devc", "=", "&", "dev_conf", "[", "dev", "]", ";", "if", "(", "devc", "-", ">", "uart_mode", ")", "return", "1", ";", "if", "(", "status", "<", "0xf0", ")", "{", "if", "(", "mpu_cmd", "(", "dev", ",", "0xD0", ",", "0", ")", "<", "0", ")", "return", "0", ";", "return", "1", ";", "}", "switch", "(", "status", ")", "{", "case", "0xF0", ":", "if", "(", "mpu_cmd", "(", "dev", ",", "0xDF", ",", "0", ")", "<", "0", ")", "return", "0", ";", "return", "1", ";", "default", ":", "return", "0", ";", "}", "}", "static", "int", "mpu401_start_read", "(", "int", "dev", ")", "{", "return", "0", ";", "}", "static", "int", "mpu401_end_read", "(", "int", "dev", ")", "{", "return", "0", ";", "}", "static", "int", "mpu401_ioctl", "(", "int", "dev", ",", "unsigned", "cmd", ",", "void", "__user", "*", "arg", ")", "{", "struct", "mpu_config", "*", "devc", ";", "mpu_command_rec", "rec", ";", "int", "val", ",", "ret", ";", "devc", "=", "&", "dev_conf", "[", "dev", "]", ";", "switch", "(", "cmd", ")", "{", "case", "SNDCTL_MIDI_MPUMODE", ":", "if", "(", "!(", "devc", "-", ">", "capabilities", "&", "MPU_CAP_INTLG", ")", ")", "{", "/", "*", "No", "intelligent", "mode", "*", "/", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Intelligent", "mode", "not", "supported", "by", "the", "HW", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "get_user", "(", "val", ",", "(", "int", "__user", "*", ")", "arg", ")", ")", "return", "-", "EFAULT", ";", "set_uart_mode", "(", "dev", ",", "devc", ",", "!", "val", ")", ";", "return", "0", ";", "case", "SNDCTL_MIDI_MPUCMD", ":", "if", "(", "copy_from_user", "(", "&", "rec", ",", "arg", ",", "sizeof", "(", "rec", ")", "))", "return", "-", "EFAULT", ";", "if", "(", "(", "ret", "=", "mpu401_command", "(", "dev", ",", "&", "rec", ")", ")", "<", "0", ")", "return", "ret", ";", "if", "(", "copy_to_user", "(", "arg", ",", "&", "rec", ",", "sizeof", "(", "rec", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "default", ":", "return", "-", "EINVAL", ";", "}", "}", "static", "void", "mpu401_kick", "(", "int", "dev", ")", "{", "}", "static", "int", "mpu401_buffer_status", "(", "int", "dev", ")", "{", "return", "0", ";", "/", "*", "*", "No", "data", "in", "buffers", "*", "/", "}", "static", "int", "mpu_synth_ioctl", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", "{", "int", "midi_dev", ";", "struct", "mpu_config", "*", "devc", ";", "midi_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "if", "(", "midi_dev", "<", "0", "|", "|", "midi_dev", ">", "=", "num_midis", "|", "|", "midi_devs", "[", "midi_dev", "]", "=", "=", "NULL", ")", "return", "-", "ENXIO", ";", "devc", "=", "&", "dev_conf", "[", "midi_dev", "]", ";", "switch", "(", "cmd", ")", "{", "case", "SNDCTL_SYNTH_INFO", ":", "if", "(", "copy_to_user", "(", "arg", ",", "&", "mpu_synth_info", "[", "midi_dev", "]", ",", "sizeof", "(", "struct", "synth_info", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_SYNTH_MEMAVL", ":", "return", "0x7fffffff", ";", "default", ":", "return", "-", "EINVAL", ";", "}", "}", "static", "int", "mpu_synth_open", "(", "int", "dev", ",", "int", "mode", ")", "{", "int", "midi_dev", ",", "err", ";", "struct", "mpu_config", "*", "devc", ";", "struct", "coproc_operations", "*", "coprocessor", ";", "midi_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "if", "(", "midi_dev", "<", "0", "|", "|", "midi_dev", ">", "num_midis", "|", "|", "midi_devs", "[", "midi_dev", "]", "=", "=", "NULL", ")", "return", "-", "ENXIO", ";", "devc", "=", "&", "dev_conf", "[", "midi_dev", "]", ";", "/", "*", "*", "Verify", "that", "the", "device", "is", "really", "running", ".", "*", "Some", "devices", "(", "such", "as", "Ensoniq", "SoundScape", "don", "'", "t", "*", "work", "before", "the", "on", "board", "processor", "(", "OBP", ")", "is", "initialized", "*", "by", "downloading", "its", "microcode", ".", "*", "/", "if", "(", "!", "devc", "-", ">", "initialized", ")", "{", "if", "(", "mpu401_status", "(", "devc", ")", "=", "=", "0xff", ")", "/", "*", "Bus", "float", "*", "/", "{", "printk", "(", "KERN_ERR", "\"", "mpu401", ":", "Device", "not", "initialized", "properly", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "reset_mpu401", "(", "devc", ")", ";", "}", "if", "(", "devc", "-", ">", "opened", ")", "return", "-", "EBUSY", ";", "devc", "-", ">", "mode", "=", "MODE_SYNTH", ";", "devc", "-", ">", "synthno", "=", "dev", ";", "devc", "-", ">", "inputintr", "=", "NULL", ";", "coprocessor", "=", "midi_devs", "[", "midi_dev", "]", "->", "coproc", ";", "if", "(", "coprocessor", ")", "{", "if", "(", "!", "try_module_get", "(", "coprocessor", "-", ">", "owner", ")", ")", "return", "-", "ENODEV", ";", "if", "(", "(", "err", "=", "coprocessor", "-", ">", "open", "(", "coprocessor", "-", ">", "devc", ",", "COPR_MIDI", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Can", "'", "t", "access", "coprocessor", "device", "\\", "n", "\"", ");", "return", "err", ";", "}", "}", "devc", "-", ">", "opened", "=", "mode", ";", "reset_mpu401", "(", "devc", ")", ";", "if", "(", "mode", "&", "OPEN_READ", ")", "{", "mpu_cmd", "(", "midi_dev", ",", "0x8B", ",", "0", ")", ";", "/", "*", "Enable", "data", "in", "stop", "mode", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x34", ",", "0", ")", ";", "/", "*", "Return", "timing", "bytes", "in", "stop", "mode", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x87", ",", "0", ")", ";", "/", "*", "Enable", "pitch", "&", "controller", "*", "/", "}", "return", "0", ";", "}", "static", "void", "mpu_synth_close", "(", "int", "dev", ")", "{", "int", "midi_dev", ";", "struct", "mpu_config", "*", "devc", ";", "struct", "coproc_operations", "*", "coprocessor", ";", "midi_dev", "=", "synth_devs", "[", "dev", "]", "->", "midi_dev", ";", "devc", "=", "&", "dev_conf", "[", "midi_dev", "]", ";", "mpu_cmd", "(", "midi_dev", ",", "0x15", ",", "0", ")", ";", "/", "*", "Stop", "recording", ",", "playback", "and", "MIDI", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x8a", ",", "0", ")", ";", "/", "*", "Disable", "data", "in", "stopped", "mode", "*", "/", "devc", "-", ">", "inputintr", "=", "NULL", ";", "coprocessor", "=", "midi_devs", "[", "midi_dev", "]", "->", "coproc", ";", "if", "(", "coprocessor", ")", "{", "coprocessor", "-", ">", "close", "(", "coprocessor", "-", ">", "devc", ",", "COPR_MIDI", ")", ";", "module_put", "(", "coprocessor", "-", ">", "owner", ")", ";", "}", "devc", "-", ">", "opened", "=", "0", ";", "devc", "-", ">", "mode", "=", "0", ";", "}", "#", "define", "MIDI_SYNTH_NAME", "\"", "MPU", "-", "401", "UART", "Midi", "\"", "#", "define", "MIDI_SYNTH_CAPS", "SYNTH_CAP_INPUT", "#", "include", "\"", "midi_synth", ".", "h", "\"", "static", "struct", "synth_operations", "mpu401_synth_proto", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "id", "=", "\"", "MPU401", "\"", ",", ".", "info", "=", "NULL", ",", ".", "midi_dev", "=", "0", ",", ".", "synth_type", "=", "SYNTH_TYPE_MIDI", ",", ".", "synth_subtype", "=", "0", ",", ".", "open", "=", "mpu_synth_open", ",", ".", "close", "=", "mpu_synth_close", ",", ".", "ioctl", "=", "mpu_synth_ioctl", ",", ".", "kill_note", "=", "midi_synth_kill_note", ",", ".", "start_note", "=", "midi_synth_start_note", ",", ".", "set_instr", "=", "midi_synth_set_instr", ",", ".", "reset", "=", "midi_synth_reset", ",", ".", "hw_control", "=", "midi_synth_hw_control", ",", ".", "load_patch", "=", "midi_synth_load_patch", ",", ".", "aftertouch", "=", "midi_synth_aftertouch", ",", ".", "controller", "=", "midi_synth_controller", ",", ".", "panning", "=", "midi_synth_panning", ",", ".", "bender", "=", "midi_synth_bender", ",", ".", "setup_voice", "=", "midi_synth_setup_voice", ",", ".", "send_sysex", "=", "midi_synth_send_sysex", "}", ";", "static", "struct", "synth_operations", "*", "mpu401_synth_operations", "[", "MAX_MIDI_DEV", "]", ";", "static", "struct", "midi_operations", "mpu401_midi_proto", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "info", "=", "{", "\"", "MPU", "-", "401", "Midi", "\"", ",", "0", ",", "MIDI_CAP_MPU401", ",", "SNDCARD_MPU401", "}", ",", ".", "in_info", "=", "{", "0", "}", ",", ".", "open", "=", "mpu401_open", ",", ".", "close", "=", "mpu401_close", ",", ".", "ioctl", "=", "mpu401_ioctl", ",", ".", "outputc", "=", "mpu401_out", ",", ".", "start_read", "=", "mpu401_start_read", ",", ".", "end_read", "=", "mpu401_end_read", ",", ".", "kick", "=", "mpu401_kick", ",", ".", "buffer_status", "=", "mpu401_buffer_status", ",", ".", "prefix_cmd", "=", "mpu401_prefix_cmd", "}", ";", "static", "struct", "midi_operations", "mpu401_midi_operations", "[", "MAX_MIDI_DEV", "]", ";", "static", "void", "mpu401_chk_version", "(", "int", "n", ",", "struct", "mpu_config", "*", "devc", ")", "{", "int", "tmp", ";", "devc", "-", ">", "version", "=", "devc", "-", ">", "revision", "=", "0", ";", "tmp", "=", "mpu_cmd", "(", "n", ",", "0xAC", ",", "0", ")", ";", "if", "(", "tmp", "<", "0", ")", "return", ";", "if", "(", "(", "tmp", "&", "0xf0", ")", ">", "0x20", ")", "/", "*", "Why", "it", "'", "s", "larger", "than", "2", ".", "x", "?", "??", "*", "/", "return", ";", "devc", "-", ">", "version", "=", "tmp", ";", "if", "(", "(", "tmp", "=", "mpu_cmd", "(", "n", ",", "0xAD", ",", "0", ")", ")", "<", "0", ")", "{", "devc", "-", ">", "version", "=", "0", ";", "return", ";", "}", "devc", "-", ">", "revision", "=", "tmp", ";", "}", "int", "attach_mpu401", "(", "struct", "address_info", "*", "hw_config", ",", "struct", "module", "*", "owner", ")", "{", "unsigned", "long", "flags", ";", "char", "revision_char", ";", "int", "m", ",", "ret", ";", "struct", "mpu_config", "*", "devc", ";", "hw_config", "-", ">", "slots", "[", "1", "]", "=", "-", "1", ";", "m", "=", "sound_alloc_mididev", "(", ");", "if", "(", "m", "=", "=", "-", "1", ")", "{", "printk", "(", "KERN_WARNING", "\"", "MPU", "-", "401", ":", "Too", "many", "midi", "devices", "detected", "\\", "n", "\"", ");", "ret", "=", "-", "ENOMEM", ";", "goto", "out_err", ";", "}", "devc", "=", "&", "dev_conf", "[", "m", "]", ";", "devc", "-", ">", "base", "=", "hw_config", "-", ">", "io_base", ";", "devc", "-", ">", "osp", "=", "hw_config", "-", ">", "osp", ";", "devc", "-", ">", "irq", "=", "hw_config", "-", ">", "irq", ";", "devc", "-", ">", "opened", "=", "0", ";", "devc", "-", ">", "uart_mode", "=", "0", ";", "devc", "-", ">", "initialized", "=", "0", ";", "devc", "-", ">", "version", "=", "0", ";", "devc", "-", ">", "revision", "=", "0", ";", "devc", "-", ">", "capabilities", "=", "0", ";", "devc", "-", ">", "timer_flag", "=", "0", ";", "devc", "-", ">", "m_busy", "=", "0", ";", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "devc", "-", ">", "shared_irq", "=", "hw_config", "-", ">", "always_detect", ";", "spin_lock_init", "(", "&", "devc", "-", ">", "lock", ")", ";", "if", "(", "devc", "-", ">", "irq", "<", "0", ")", "{", "devc", "-", ">", "irq", "*", "=", "-", "1", ";", "devc", "-", ">", "shared_irq", "=", "1", ";", "}", "if", "(", "!", "hw_config", "-", ">", "always_detect", ")", "{", "/", "*", "Verify", "the", "hardware", "again", "*", "/", "if", "(", "!", "reset_mpu401", "(", "devc", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Device", "didn", "'", "t", "respond", "\\", "n", "\"", ");", "ret", "=", "-", "ENODEV", ";", "goto", "out_mididev", ";", "}", "if", "(", "!", "devc", "-", ">", "shared_irq", ")", "{", "if", "(", "request_irq", "(", "devc", "-", ">", "irq", ",", "mpuintr", ",", "0", ",", "\"", "mpu401", "\"", ",", "hw_config", ")", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Failed", "to", "allocate", "IRQ", "%", "d", "\\", "n", "\"", ",", "devc", "-", ">", "irq", ")", ";", "ret", "=", "-", "ENOMEM", ";", "goto", "out_mididev", ";", "}", "}", "spin_lock_irqsave", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "mpu401_chk_version", "(", "m", ",", "devc", ")", ";", "if", "(", "devc", "-", ">", "version", "=", "=", "0", ")", "mpu401_chk_version", "(", "m", ",", "devc", ")", ";", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "}", "if", "(", "devc", "-", ">", "version", "!", "=", "0", ")", "if", "(", "mpu_cmd", "(", "m", ",", "0xC5", ",", "0", ")", ">", "=", "0", ")", "/", "*", "Set", "timebase", "OK", "*", "/", "if", "(", "mpu_cmd", "(", "m", ",", "0xE0", ",", "120", ")", ">", "=", "0", ")", "/", "*", "Set", "tempo", "OK", "*", "/", "devc", "-", ">", "capabilities", "|", "=", "MPU_CAP_INTLG", ";", "/", "*", "Supports", "intelligent", "mode", "*", "/", "mpu401_synth_operations", "[", "m", "]", "=", "kmalloc", "(", "sizeof", "(", "struct", "synth_operations", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "mpu401_synth_operations", "[", "m", "]", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "mpu401", ":", "Can", "'", "t", "allocate", "memory", "\\", "n", "\"", ");", "ret", "=", "-", "ENOMEM", ";", "goto", "out_irq", ";", "}", "if", "(", "!(", "devc", "-", ">", "capabilities", "&", "MPU_CAP_INTLG", ")", ")", "/", "*", "No", "intelligent", "mode", "*", "/", "{", "memcpy", "(", "(", "char", "*", ")", "mpu401_synth_operations", "[", "m", "]", ",", "(", "char", "*", ")", "&", "std_midi_synth", ",", "sizeof", "(", "struct", "synth_operations", ")", ");", "}", "else", "{", "memcpy", "(", "(", "char", "*", ")", "mpu401_synth_operations", "[", "m", "]", ",", "(", "char", "*", ")", "&", "mpu401_synth_proto", ",", "sizeof", "(", "struct", "synth_operations", ")", ");", "}", "if", "(", "owner", ")", "mpu401_synth_operations", "[", "m", "]", "->", "owner", "=", "owner", ";", "memcpy", "(", "(", "char", "*", ")", "&", "mpu401_midi_operations", "[", "m", "]", ",", "(", "char", "*", ")", "&", "mpu401_midi_proto", ",", "sizeof", "(", "struct", "midi_operations", ")", ");", "mpu401_midi_operations", "[", "m", "]", ".", "converter", "=", "mpu401_synth_operations", "[", "m", "]", ";", "memcpy", "(", "(", "char", "*", ")", "&", "mpu_synth_info", "[", "m", "]", ",", "(", "char", "*", ")", "&", "mpu_synth_info_proto", ",", "sizeof", "(", "struct", "synth_info", ")", ");", "n_mpu_devs", "+", "+;", "if", "(", "devc", "-", ">", "version", "=", "=", "0x20", "&", "&", "devc", "-", ">", "revision", ">", "=", "0x07", ")", "/", "*", "MusicQuest", "interface", "*", "/", "{", "int", "ports", "=", "(", "devc", "-", ">", "revision", "&", "0x08", ")", "?", "32", ":", "16", ";", "devc", "-", ">", "capabilities", "|", "=", "MPU_CAP_SYNC", "|", "MPU_CAP_SMPTE", "|", "MPU_CAP_CLS", "|", "MPU_CAP_2PORT", ";", "revision_char", "=", "(", "devc", "-", ">", "revision", "=", "=", "0x7f", ")", "?", "'", "M", "'", ":", "'", "'", ";", "sprintf", "(", "mpu_synth_info", "[", "m", "]", ".", "name", ",", "\"", "MQX", "-", "%", "d", "%", "c", "MIDI", "Interface", "#", "%", "d", "\"", ",", "ports", ",", "revision_char", ",", "n_mpu_devs", ")", ";", "}", "else", "{", "revision_char", "=", "devc", "-", ">", "revision", "?", "devc", "-", ">", "revision", "+", "'", "@'", ":", "'", "'", ";", "if", "(", "(", "int", ")", "devc", "-", ">", "revision", ">", "(", "'", "Z", "'", "-", "'", "@'", "))", "revision_char", "=", "'", "+'", ";", "devc", "-", ">", "capabilities", "|", "=", "MPU_CAP_SYNC", "|", "MPU_CAP_FSK", ";", "if", "(", "hw_config", "-", ">", "name", ")", "sprintf", "(", "mpu_synth_info", "[", "m", "]", ".", "name", ",", "\"", "%", "s", "(", "MPU401", ")", "\",", "hw_config", "-", ">", "name", ")", ";", "else", "sprintf", "(", "mpu_synth_info", "[", "m", "]", ".", "name", ",", "\"", "MPU", "-", "401", "%", "d", ".", "%", "d", "%", "c", "MIDI", "#", "%", "d", "\"", ",", "(", "int", ")", "(", "devc", "-", ">", "version", "&", "0xf0", ")", ">", ">", "4", ",", "devc", "-", ">", "version", "&", "0x0f", ",", "revision_char", ",", "n_mpu_devs", ")", ";", "}", "strcpy", "(", "mpu401_midi_operations", "[", "m", "]", ".", "info", ".", "name", ",", "mpu_synth_info", "[", "m", "]", ".", "name", ")", ";", "conf_printf", "(", "mpu_synth_info", "[", "m", "]", ".", "name", ",", "hw_config", ")", ";", "mpu401_synth_operations", "[", "m", "]", "->", "midi_dev", "=", "devc", "-", ">", "devno", "=", "m", ";", "mpu401_synth_operations", "[", "devc", "-", ">", "devno", "]", "->", "info", "=", "&", "mpu_synth_info", "[", "devc", "-", ">", "devno", "]", ";", "if", "(", "devc", "-", ">", "capabilities", "&", "MPU_CAP_INTLG", ")", "/", "*", "Intelligent", "mode", "*", "/", "hw_config", "-", ">", "slots", "[", "2", "]", "=", "mpu_timer_init", "(", "m", ")", ";", "midi_devs", "[", "m", "]", "=", "&", "mpu401_midi_operations", "[", "devc", "-", ">", "devno", "]", ";", "if", "(", "owner", ")", "midi_devs", "[", "m", "]", "->", "owner", "=", "owner", ";", "hw_config", "-", ">", "slots", "[", "1", "]", "=", "m", ";", "sequencer_init", "(", ");", "return", "0", ";", "out_irq", ":", "free_irq", "(", "devc", "-", ">", "irq", ",", "hw_config", ")", ";", "out_mididev", ":", "sound_unload_mididev", "(", "m", ")", ";", "out_err", ":", "release_region", "(", "hw_config", "-", ">", "io_base", ",", "2", ")", ";", "return", "ret", ";", "}", "static", "int", "reset_mpu401", "(", "struct", "mpu_config", "*", "devc", ")", "{", "unsigned", "long", "flags", ";", "int", "ok", ",", "timeout", ",", "n", ";", "int", "timeout_limit", ";", "/", "*", "*", "Send", "the", "RESET", "command", ".", "Try", "again", "if", "no", "success", "at", "the", "first", "time", ".", "*", "(", "If", "the", "device", "is", "in", "the", "UART", "mode", ",", "it", "will", "not", "ack", "the", "reset", "cmd", ")", ".", "*", "/", "ok", "=", "0", ";", "timeout_limit", "=", "devc", "-", ">", "initialized", "?", "30000", ":", "100000", ";", "devc", "-", ">", "initialized", "=", "1", ";", "for", "(", "n", "=", "0", ";", "n", "<", "2", "&", "&", "!", "ok", ";", "n", "+", "+)", "{", "for", "(", "timeout", "=", "timeout_limit", ";", "timeout", ">", "0", "&", "&", "!", "ok", ";", "timeout", "-", "-)", "ok", "=", "output_ready", "(", "devc", ")", ";", "write_command", "(", "devc", ",", "MPU_RESET", ")", ";", "/", "*", "*", "Send", "MPU", "-", "401", "RESET", "Command", "*", "/", "/", "*", "*", "Wait", "at", "least", "25", "msec", ".", "This", "method", "is", "not", "accurate", "so", "let", "'", "s", "make", "the", "*", "loop", "bit", "longer", ".", "Cannot", "sleep", "since", "this", "is", "called", "during", "boot", ".", "*", "/", "for", "(", "timeout", "=", "timeout_limit", "*", "2", ";", "timeout", ">", "0", "&", "&", "!", "ok", ";", "timeout", "-", "-)", "{", "spin_lock_irqsave", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "input_avail", "(", "devc", ")", ")", "if", "(", "read_data", "(", "devc", ")", "=", "=", "MPU_ACK", ")", "ok", "=", "1", ";", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "}", "}", "devc", "-", ">", "m_state", "=", "ST_INIT", ";", "devc", "-", ">", "m_ptr", "=", "0", ";", "devc", "-", ">", "m_left", "=", "0", ";", "devc", "-", ">", "last_status", "=", "0", ";", "devc", "-", ">", "uart_mode", "=", "0", ";", "return", "ok", ";", "}", "static", "void", "set_uart_mode", "(", "int", "dev", ",", "struct", "mpu_config", "*", "devc", ",", "int", "arg", ")", "{", "if", "(", "!", "arg", "&", "&", "(", "devc", "-", ">", "capabilities", "&", "MPU_CAP_INTLG", ")", ")", "return", ";", "if", "(", "(", "devc", "-", ">", "uart_mode", "=", "=", "0", ")", "=", "=", "(", "arg", "=", "=", "0", ")", ")", "return", ";", "/", "*", "Already", "set", "*", "/", "reset_mpu401", "(", "devc", ")", ";", "/", "*", "This", "exits", "the", "uart", "mode", "*", "/", "if", "(", "arg", ")", "{", "if", "(", "mpu_cmd", "(", "dev", ",", "UART_MODE_ON", ",", "0", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "\"", "mpu401", ":", "Can", "'", "t", "enter", "UART", "mode", "\\", "n", "\"", ");", "devc", "-", ">", "uart_mode", "=", "0", ";", "return", ";", "}", "}", "devc", "-", ">", "uart_mode", "=", "arg", ";", "}", "int", "probe_mpu401", "(", "struct", "address_info", "*", "hw_config", ",", "struct", "resource", "*", "ports", ")", "{", "int", "ok", "=", "0", ";", "struct", "mpu_config", "tmp_devc", ";", "tmp_devc", ".", "base", "=", "hw_config", "-", ">", "io_base", ";", "tmp_devc", ".", "irq", "=", "hw_config", "-", ">", "irq", ";", "tmp_devc", ".", "initialized", "=", "0", ";", "tmp_devc", ".", "opened", "=", "0", ";", "tmp_devc", ".", "osp", "=", "hw_config", "-", ">", "osp", ";", "if", "(", "hw_config", "-", ">", "always_detect", ")", "return", "1", ";", "if", "(", "inb", "(", "hw_config", "-", ">", "io_base", "+", "1", ")", "=", "=", "0xff", ")", "{", "DDB", "(", "printk", "(", "\"", "MPU401", ":", "Port", "%", "x", "looks", "dead", ".", "\\", "n", "\"", ",", "hw_config", "-", ">", "io_base", ")", ");", "return", "0", ";", "/", "*", "Just", "bus", "float", "?", "*", "/", "}", "ok", "=", "reset_mpu401", "(", "&", "tmp_devc", ")", ";", "if", "(", "!", "ok", ")", "{", "DDB", "(", "printk", "(", "\"", "MPU401", ":", "Reset", "failed", "on", "port", "%", "x", "\\", "n", "\"", ",", "hw_config", "-", ">", "io_base", ")", ");", "}", "return", "ok", ";", "}", "void", "unload_mpu401", "(", "struct", "address_info", "*", "hw_config", ")", "{", "void", "*", "p", ";", "int", "n", "=", "hw_config", "-", ">", "slots", "[", "1", "]", ";", "if", "(", "n", "!", "=", "-", "1", ")", "{", "release_region", "(", "hw_config", "-", ">", "io_base", ",", "2", ")", ";", "if", "(", "hw_config", "-", ">", "always_detect", "=", "=", "0", "&", "&", "hw_config", "-", ">", "irq", ">", "0", ")", "free_irq", "(", "hw_config", "-", ">", "irq", ",", "hw_config", ")", ";", "p", "=", "mpu401_synth_operations", "[", "n", "]", ";", "sound_unload_mididev", "(", "n", ")", ";", "sound_unload_timerdev", "(", "hw_config", "-", ">", "slots", "[", "2", "]", ");", "kfree", "(", "p", ")", ";", "}", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "Timer", "stuff", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "static", "volatile", "int", "timer_initialized", "=", "0", ",", "timer_open", "=", "0", ",", "tmr_running", "=", "0", ";", "static", "volatile", "int", "curr_tempo", ",", "curr_timebase", ",", "hw_timebase", ";", "static", "int", "max_timebase", "=", "8", ";", "/", "*", "8", "*", "24", "=", "192", "ppqn", "*", "/", "static", "volatile", "unsigned", "long", "next_event_time", ";", "static", "volatile", "unsigned", "long", "curr_ticks", ",", "curr_clocks", ";", "static", "unsigned", "long", "prev_event_time", ";", "static", "int", "metronome_mode", ";", "static", "unsigned", "long", "clocks2ticks", "(", "unsigned", "long", "clocks", ")", "{", "/", "*", "*", "The", "MPU", "-", "401", "supports", "just", "a", "limited", "set", "of", "possible", "timebase", "values", ".", "*", "Since", "the", "applications", "require", "more", "choices", ",", "the", "driver", "has", "to", "*", "program", "the", "HW", "to", "do", "its", "best", "and", "to", "convert", "between", "the", "HW", "and", "*", "actual", "timebases", ".", "*", "/", "return", "(", "(", "clocks", "*", "curr_timebase", ")", "+", "(", "hw_timebase", "/", "2", ")", ")", "/", "hw_timebase", ";", "}", "static", "void", "set_timebase", "(", "int", "midi_dev", ",", "int", "val", ")", "{", "int", "hw_val", ";", "if", "(", "val", "<", "48", ")", "val", "=", "48", ";", "if", "(", "val", ">", "1000", ")", "val", "=", "1000", ";", "hw_val", "=", "val", ";", "hw_val", "=", "(", "hw_val", "+", "12", ")", "/", "24", ";", "if", "(", "hw_val", ">", "max_timebase", ")", "hw_val", "=", "max_timebase", ";", "if", "(", "mpu_cmd", "(", "midi_dev", ",", "0xC0", "|", "(", "hw_val", "&", "0x0f", ")", ",", "0", ")", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Can", "'", "t", "set", "HW", "timebase", "to", "%", "d", "\\", "n", "\"", ",", "hw_val", "*", "24", ")", ";", "return", ";", "}", "hw_timebase", "=", "hw_val", "*", "24", ";", "curr_timebase", "=", "val", ";", "}", "static", "void", "tmr_reset", "(", "struct", "mpu_config", "*", "devc", ")", "{", "unsigned", "long", "flags", ";", "spin_lock_irqsave", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "next_event_time", "=", "(", "unsigned", "long", ")", "-", "1", ";", "prev_event_time", "=", "0", ";", "curr_ticks", "=", "curr_clocks", "=", "0", ";", "spin_unlock_irqrestore", "(", "&", "devc", "-", ">", "lock", ",", "flags", ")", ";", "}", "static", "void", "set_timer_mode", "(", "int", "midi_dev", ")", "{", "if", "(", "timer_mode", "&", "TMR_MODE_CLS", ")", "mpu_cmd", "(", "midi_dev", ",", "0x3c", ",", "0", ")", ";", "/", "*", "Use", "CLS", "sync", "*", "/", "else", "if", "(", "timer_mode", "&", "TMR_MODE_SMPTE", ")", "mpu_cmd", "(", "midi_dev", ",", "0x3d", ",", "0", ")", ";", "/", "*", "Use", "SMPTE", "sync", "*", "/", "if", "(", "timer_mode", "&", "TMR_INTERNAL", ")", "{", "mpu_cmd", "(", "midi_dev", ",", "0x80", ",", "0", ")", ";", "/", "*", "Use", "MIDI", "sync", "*", "/", "}", "else", "{", "if", "(", "timer_mode", "&", "(", "TMR_MODE_MIDI", "|", "TMR_MODE_CLS", ")", ")", "{", "mpu_cmd", "(", "midi_dev", ",", "0x82", ",", "0", ")", ";", "/", "*", "Use", "MIDI", "sync", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x91", ",", "0", ")", ";", "/", "*", "Enable", "ext", "MIDI", "ctrl", "*", "/", "}", "else", "if", "(", "timer_mode", "&", "TMR_MODE_FSK", ")", "mpu_cmd", "(", "midi_dev", ",", "0x81", ",", "0", ")", ";", "/", "*", "Use", "FSK", "sync", "*", "/", "}", "}", "static", "void", "stop_metronome", "(", "int", "midi_dev", ")", "{", "mpu_cmd", "(", "midi_dev", ",", "0x84", ",", "0", ")", ";", "/", "*", "Disable", "metronome", "*", "/", "}", "static", "void", "setup_metronome", "(", "int", "midi_dev", ")", "{", "int", "numerator", ",", "denominator", ";", "int", "clks_per_click", ",", "num_32nds_per_beat", ";", "int", "beats_per_measure", ";", "numerator", "=", "(", "(", "unsigned", ")", "metronome_mode", ">", ">", "24", ")", "&", "0xff", ";", "denominator", "=", "(", "(", "unsigned", ")", "metronome_mode", ">", ">", "16", ")", "&", "0xff", ";", "clks_per_click", "=", "(", "(", "unsigned", ")", "metronome_mode", ">", ">", "8", ")", "&", "0xff", ";", "num_32nds_per_beat", "=", "(", "unsigned", ")", "metronome_mode", "&", "0xff", ";", "beats_per_measure", "=", "(", "numerator", "*", "4", ")", ">", ">", "denominator", ";", "if", "(", "!", "metronome_mode", ")", "mpu_cmd", "(", "midi_dev", ",", "0x84", ",", "0", ")", ";", "/", "*", "Disable", "metronome", "*", "/", "else", "{", "mpu_cmd", "(", "midi_dev", ",", "0xE4", ",", "clks_per_click", ")", ";", "mpu_cmd", "(", "midi_dev", ",", "0xE6", ",", "beats_per_measure", ")", ";", "mpu_cmd", "(", "midi_dev", ",", "0x83", ",", "0", ")", ";", "/", "*", "Enable", "metronome", "without", "accents", "*", "/", "}", "}", "static", "int", "mpu_start_timer", "(", "int", "midi_dev", ")", "{", "struct", "mpu_config", "*", "devc", "=", "&", "dev_conf", "[", "midi_dev", "]", ";", "tmr_reset", "(", "devc", ")", ";", "set_timer_mode", "(", "midi_dev", ")", ";", "if", "(", "tmr_running", ")", "return", "TIMER_NOT_ARMED", ";", "/", "*", "Already", "running", "*", "/", "if", "(", "timer_mode", "&", "TMR_INTERNAL", ")", "{", "mpu_cmd", "(", "midi_dev", ",", "0x02", ",", "0", ")", ";", "/", "*", "Send", "MIDI", "start", "*", "/", "tmr_running", "=", "1", ";", "return", "TIMER_NOT_ARMED", ";", "}", "else", "{", "mpu_cmd", "(", "midi_dev", ",", "0x35", ",", "0", ")", ";", "/", "*", "Enable", "mode", "messages", "to", "PC", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x38", ",", "0", ")", ";", "/", "*", "Enable", "sys", "common", "messages", "to", "PC", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x39", ",", "0", ")", ";", "/", "*", "Enable", "real", "time", "messages", "to", "PC", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x97", ",", "0", ")", ";", "/", "*", "Enable", "system", "exclusive", "messages", "to", "PC", "*", "/", "}", "return", "TIMER_ARMED", ";", "}", "static", "int", "mpu_timer_open", "(", "int", "dev", ",", "int", "mode", ")", "{", "int", "midi_dev", "=", "sound_timer_devs", "[", "dev", "]", "->", "devlink", ";", "struct", "mpu_config", "*", "devc", "=", "&", "dev_conf", "[", "midi_dev", "]", ";", "if", "(", "timer_open", ")", "return", "-", "EBUSY", ";", "tmr_reset", "(", "devc", ")", ";", "curr_tempo", "=", "50", ";", "mpu_cmd", "(", "midi_dev", ",", "0xE0", ",", "50", ")", ";", "curr_timebase", "=", "hw_timebase", "=", "120", ";", "set_timebase", "(", "midi_dev", ",", "120", ")", ";", "timer_open", "=", "1", ";", "metronome_mode", "=", "0", ";", "set_timer_mode", "(", "midi_dev", ")", ";", "mpu_cmd", "(", "midi_dev", ",", "0xe7", ",", "0x04", ")", ";", "/", "*", "Send", "all", "clocks", "to", "host", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x95", ",", "0", ")", ";", "/", "*", "Enable", "clock", "to", "host", "*", "/", "return", "0", ";", "}", "static", "void", "mpu_timer_close", "(", "int", "dev", ")", "{", "int", "midi_dev", "=", "sound_timer_devs", "[", "dev", "]", "->", "devlink", ";", "timer_open", "=", "tmr_running", "=", "0", ";", "mpu_cmd", "(", "midi_dev", ",", "0x15", ",", "0", ")", ";", "/", "*", "Stop", "all", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x94", ",", "0", ")", ";", "/", "*", "Disable", "clock", "to", "host", "*", "/", "mpu_cmd", "(", "midi_dev", ",", "0x8c", ",", "0", ")", ";", "/", "*", "Disable", "measure", "end", "messages", "to", "host", "*", "/", "stop_metronome", "(", "midi_dev", ")", ";", "}", "static", "int", "mpu_timer_event", "(", "int", "dev", ",", "unsigned", "char", "*", "event", ")", "{", "unsigned", "char", "command", "=", "event", "[", "1", "]", ";", "unsigned", "long", "parm", "=", "*", "(", "unsigned", "int", "*", ")", "&", "event", "[", "4", "]", ";", "int", "midi_dev", "=", "sound_timer_devs", "[", "dev", "]", "->", "devlink", ";", "switch", "(", "command", ")", "{", "case", "TMR_WAIT_REL", ":", "parm", "+", "=", "prev_event_time", ";", "case", "TMR_WAIT_ABS", ":", "if", "(", "parm", ">", "0", ")", "{", "long", "time", ";", "if", "(", "parm", "<", "=", "curr_ticks", ")", "/", "*", "It", "'", "s", "the", "time", "*", "/", "return", "TIMER_NOT_ARMED", ";", "time", "=", "parm", ";", "next_event_time", "=", "prev_event_time", "=", "time", ";", "return", "TIMER_ARMED", ";", "}", "break", ";", "case", "TMR_START", ":", "if", "(", "tmr_running", ")", "break", ";", "return", "mpu_start_timer", "(", "midi_dev", ")", ";", "case", "TMR_STOP", ":", "mpu_cmd", "(", "midi_dev", ",", "0x01", ",", "0", ")", ";", "/", "*", "Send", "MIDI", "stop", "*", "/", "stop_metronome", "(", "midi_dev", ")", ";", "tmr_running", "=", "0", ";", "break", ";", "case", "TMR_CONTINUE", ":", "if", "(", "tmr_running", ")", "break", ";", "mpu_cmd", "(", "midi_dev", ",", "0x03", ",", "0", ")", ";", "/", "*", "Send", "MIDI", "continue", "*", "/", "setup_metronome", "(", "midi_dev", ")", ";", "tmr_running", "=", "1", ";", "break", ";", "case", "TMR_TEMPO", ":", "if", "(", "parm", ")", "{", "if", "(", "parm", "<", "8", ")", "parm", "=", "8", ";", "if", "(", "parm", ">", "250", ")", "parm", "=", "250", ";", "if", "(", "mpu_cmd", "(", "midi_dev", ",", "0xE0", ",", "parm", ")", "<", "0", ")", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Can", "'", "t", "set", "tempo", "to", "%", "d", "\\", "n", "\"", ",", "(", "int", ")", "parm", ")", ";", "curr_tempo", "=", "parm", ";", "}", "break", ";", "case", "TMR_ECHO", ":", "seq_copy_to_input", "(", "event", ",", "8", ")", ";", "break", ";", "case", "TMR_TIMESIG", ":", "if", "(", "metronome_mode", ")", "/", "*", "Metronome", "enabled", "*", "/", "{", "metronome_mode", "=", "parm", ";", "setup_metronome", "(", "midi_dev", ")", ";", "}", "break", ";", "default", ":", ";", "}", "return", "TIMER_NOT_ARMED", ";", "}", "static", "unsigned", "long", "mpu_timer_get_time", "(", "int", "dev", ")", "{", "if", "(", "!", "timer_open", ")", "return", "0", ";", "return", "curr_ticks", ";", "}", "static", "int", "mpu_timer_ioctl", "(", "int", "dev", ",", "unsigned", "int", "command", ",", "void", "__user", "*", "arg", ")", "{", "int", "midi_dev", "=", "sound_timer_devs", "[", "dev", "]", "->", "devlink", ";", "int", "__user", "*", "p", "=", "(", "int", "__user", "*", ")", "arg", ";", "switch", "(", "command", ")", "{", "case", "SNDCTL_TMR_SOURCE", ":", "{", "int", "parm", ";", "if", "(", "get_user", "(", "parm", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "parm", "&", "=", "timer_caps", ";", "if", "(", "parm", "!", "=", "0", ")", "{", "timer_mode", "=", "parm", ";", "if", "(", "timer_mode", "&", "TMR_MODE_CLS", ")", "mpu_cmd", "(", "midi_dev", ",", "0x3c", ",", "0", ")", ";", "/", "*", "Use", "CLS", "sync", "*", "/", "else", "if", "(", "timer_mode", "&", "TMR_MODE_SMPTE", ")", "mpu_cmd", "(", "midi_dev", ",", "0x3d", ",", "0", ")", ";", "/", "*", "Use", "SMPTE", "sync", "*", "/", "}", "if", "(", "put_user", "(", "timer_mode", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "timer_mode", ";", "}", "break", ";", "case", "SNDCTL_TMR_START", ":", "mpu_start_timer", "(", "midi_dev", ")", ";", "return", "0", ";", "case", "SNDCTL_TMR_STOP", ":", "tmr_running", "=", "0", ";", "mpu_cmd", "(", "midi_dev", ",", "0x01", ",", "0", ")", ";", "/", "*", "Send", "MIDI", "stop", "*", "/", "stop_metronome", "(", "midi_dev", ")", ";", "return", "0", ";", "case", "SNDCTL_TMR_CONTINUE", ":", "if", "(", "tmr_running", ")", "return", "0", ";", "tmr_running", "=", "1", ";", "mpu_cmd", "(", "midi_dev", ",", "0x03", ",", "0", ")", ";", "/", "*", "Send", "MIDI", "continue", "*", "/", "return", "0", ";", "case", "SNDCTL_TMR_TIMEBASE", ":", "{", "int", "val", ";", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "val", ")", "set_timebase", "(", "midi_dev", ",", "val", ")", ";", "if", "(", "put_user", "(", "curr_timebase", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "curr_timebase", ";", "}", "break", ";", "case", "SNDCTL_TMR_TEMPO", ":", "{", "int", "val", ";", "int", "ret", ";", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "val", ")", "{", "if", "(", "val", "<", "8", ")", "val", "=", "8", ";", "if", "(", "val", ">", "250", ")", "val", "=", "250", ";", "if", "(", "(", "ret", "=", "mpu_cmd", "(", "midi_dev", ",", "0xE0", ",", "val", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "mpu401", ":", "Can", "'", "t", "set", "tempo", "to", "%", "d", "\\", "n", "\"", ",", "(", "int", ")", "val", ")", ";", "return", "ret", ";", "}", "curr_tempo", "=", "val", ";", "}", "if", "(", "put_user", "(", "curr_tempo", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "curr_tempo", ";", "}", "break", ";", "case", "SNDCTL_SEQ_CTRLRATE", ":", "{", "int", "val", ";", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "val", "!", "=", "0", ")", "/", "*", "Can", "'", "t", "change", "*", "/", "return", "-", "EINVAL", ";", "val", "=", "(", "(", "curr_tempo", "*", "curr_timebase", ")", "+", "30", ")", "/", "60", ";", "if", "(", "put_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "val", ";", "}", "break", ";", "case", "SNDCTL_SEQ_GETTIME", ":", "if", "(", "put_user", "(", "curr_ticks", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "curr_ticks", ";", "case", "SNDCTL_TMR_METRONOME", ":", "if", "(", "get_user", "(", "metronome_mode", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "setup_metronome", "(", "midi_dev", ")", ";", "return", "0", ";", "default", ":", ";", "}", "return", "-", "EINVAL", ";", "}", "static", "void", "mpu_timer_arm", "(", "int", "dev", ",", "long", "time", ")", "{", "if", "(", "time", "<", "0", ")", "time", "=", "curr_ticks", "+", "1", ";", "else", "if", "(", "time", "<", "=", "curr_ticks", ")", "/", "*", "It", "'", "s", "the", "time", "*", "/", "return", ";", "next_event_time", "=", "prev_event_time", "=", "time", ";", "return", ";", "}", "static", "struct", "sound_timer_operations", "mpu_timer", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "info", "=", "{", "\"", "MPU", "-", "401", "Timer", "\"", ",", "0", "}", ",", ".", "priority", "=", "10", ",", "/", "*", "Priority", "*", "/", ".", "devlink", "=", "0", ",", "/", "*", "Local", "device", "link", "*", "/", ".", "open", "=", "mpu_timer_open", ",", ".", "close", "=", "mpu_timer_close", ",", ".", "event", "=", "mpu_timer_event", ",", ".", "get_time", "=", "mpu_timer_get_time", ",", ".", "ioctl", "=", "mpu_timer_ioctl", ",", ".", "arm_timer", "=", "mpu_timer_arm", "}", ";", "static", "void", "mpu_timer_interrupt", "(", "void", ")", "{", "if", "(", "!", "timer_open", ")", "return", ";", "if", "(", "!", "tmr_running", ")", "return", ";", "curr_clocks", "+", "+;", "curr_ticks", "=", "clocks2ticks", "(", "curr_clocks", ")", ";", "if", "(", "curr_ticks", ">", "=", "next_event_time", ")", "{", "next_event_time", "=", "(", "unsigned", "long", ")", "-", "1", ";", "sequencer_timer", "(", "0", ")", ";", "}", "}", "static", "void", "timer_ext_event", "(", "struct", "mpu_config", "*", "devc", ",", "int", "event", ",", "int", "parm", ")", "{", "int", "midi_dev", "=", "devc", "-", ">", "devno", ";", "if", "(", "!", "devc", "-", ">", "timer_flag", ")", "return", ";", "switch", "(", "event", ")", "{", "case", "TMR_CLOCK", ":", "printk", "(", "\"<", "MIDI", "clk", ">", "\")", ";", "break", ";", "case", "TMR_START", ":", "printk", "(", "\"", "Ext", "MIDI", "start", "\\", "n", "\"", ");", "if", "(", "!", "tmr_running", ")", "{", "if", "(", "timer_mode", "&", "TMR_EXTERNAL", ")", "{", "tmr_running", "=", "1", ";", "setup_metronome", "(", "midi_dev", ")", ";", "next_event_time", "=", "0", ";", "STORE", "(", "SEQ_START_TIMER", "(", "))", ";", "}", "}", "break", ";", "case", "TMR_STOP", ":", "printk", "(", "\"", "Ext", "MIDI", "stop", "\\", "n", "\"", ");", "if", "(", "timer_mode", "&", "TMR_EXTERNAL", ")", "{", "tmr_running", "=", "0", ";", "stop_metronome", "(", "midi_dev", ")", ";", "STORE", "(", "SEQ_STOP_TIMER", "(", "))", ";", "}", "break", ";", "case", "TMR_CONTINUE", ":", "printk", "(", "\"", "Ext", "MIDI", "continue", "\\", "n", "\"", ");", "if", "(", "timer_mode", "&", "TMR_EXTERNAL", ")", "{", "tmr_running", "=", "1", ";", "setup_metronome", "(", "midi_dev", ")", ";", "STORE", "(", "SEQ_CONTINUE_TIMER", "(", "))", ";", "}", "break", ";", "case", "TMR_SPP", ":", "printk", "(", "\"", "Songpos", ":", "%", "d", "\\", "n", "\"", ",", "parm", ")", ";", "if", "(", "timer_mode", "&", "TMR_EXTERNAL", ")", "{", "STORE", "(", "SEQ_SONGPOS", "(", "parm", ")", ");", "}", "break", ";", "}", "}", "static", "int", "mpu_timer_init", "(", "int", "midi_dev", ")", "{", "struct", "mpu_config", "*", "devc", ";", "int", "n", ";", "devc", "=", "&", "dev_conf", "[", "midi_dev", "]", ";", "if", "(", "timer_initialized", ")", "return", "-", "1", ";", "/", "*", "There", "is", "already", "a", "similar", "timer", "*", "/", "timer_initialized", "=", "1", ";", "mpu_timer", ".", "devlink", "=", "midi_dev", ";", "dev_conf", "[", "midi_dev", "]", ".", "timer_flag", "=", "1", ";", "n", "=", "sound_alloc_timerdev", "(", ");", "if", "(", "n", "=", "=", "-", "1", ")", "n", "=", "0", ";", "sound_timer_devs", "[", "n", "]", "=", "&", "mpu_timer", ";", "if", "(", "devc", "-", ">", "version", "<", "0x20", ")", "/", "*", "Original", "MPU", "-", "401", "*", "/", "timer_caps", "=", "TMR_INTERNAL", "|", "TMR_EXTERNAL", "|", "TMR_MODE_FSK", "|", "TMR_MODE_MIDI", ";", "else", "{", "/", "*", "*", "The", "version", "number", "2", ".", "0", "is", "used", "(", "at", "least", ")", "by", "the", "*", "MusicQuest", "cards", "and", "the", "Roland", "Super", "-", "MPU", ".", "*", "*", "MusicQuest", "has", "given", "a", "special", "meaning", "to", "the", "bits", "of", "the", "*", "revision", "number", ".", "The", "Super", "-", "MPU", "returns", "0", ".", "*", "/", "if", "(", "devc", "-", ">", "revision", ")", "timer_caps", "|", "=", "TMR_EXTERNAL", "|", "TMR_MODE_MIDI", ";", "if", "(", "devc", "-", ">", "revision", "&", "0x02", ")", "timer_caps", "|", "=", "TMR_MODE_CLS", ";", "if", "(", "devc", "-", ">", "revision", "&", "0x40", ")", "max_timebase", "=", "10", ";", "/", "*", "Has", "the", "216", "and", "240", "ppqn", "modes", "*", "/", "}", "timer_mode", "=", "(", "TMR_INTERNAL", "|", "TMR_MODE_MIDI", ")", "&", "timer_caps", ";", "return", "n", ";", "}", "EXPORT_SYMBOL", "(", "probe_mpu401", ")", ";", "EXPORT_SYMBOL", "(", "attach_mpu401", ")", ";", "EXPORT_SYMBOL", "(", "unload_mpu401", ")", ";", "static", "struct", "address_info", "cfg", ";", "static", "int", "io", "=", "-", "1", ";", "static", "int", "irq", "=", "-", "1", ";", "module_param_hw", "(", "irq", ",", "int", ",", "irq", ",", "0", ")", ";", "module_param_hw", "(", "io", ",", "int", ",", "ioport", ",", "0", ")", ";", "static", "int", "__init", "init_mpu401", "(", "void", ")", "{", "int", "ret", ";", "/", "*", "Can", "be", "loaded", "either", "for", "module", "use", "or", "to", "provide", "functions", "to", "others", "*", "/", "if", "(", "io", "!", "=", "-", "1", "&", "&", "irq", "!", "=", "-", "1", ")", "{", "struct", "resource", "*", "ports", ";", "cfg", ".", "irq", "=", "irq", ";", "cfg", ".", "io_base", "=", "io", ";", "ports", "=", "request_region", "(", "io", ",", "2", ",", "\"", "mpu401", "\"", ");", "if", "(", "!", "ports", ")", "return", "-", "EBUSY", ";", "if", "(", "probe_mpu401", "(", "&", "cfg", ",", "ports", ")", "=", "=", "0", ")", "{", "release_region", "(", "io", ",", "2", ")", ";", "return", "-", "ENODEV", ";", "}", "if", "(", "(", "ret", "=", "attach_mpu401", "(", "&", "cfg", ",", "THIS_MODULE", ")", "))", "return", "ret", ";", "}", "return", "0", ";", "}", "static", "void", "__exit", "cleanup_mpu401", "(", "void", ")", "{", "if", "(", "io", "!", "=", "-", "1", "&", "&", "irq", "!", "=", "-", "1", ")", "{", "/", "*", "Check", "for", "use", "by", ",", "for", "example", ",", "sscape", "driver", "*", "/", "unload_mpu401", "(", "&", "cfg", ")", ";", "}", "}", "module_init", "(", "init_mpu401", ")", ";", "module_exit", "(", "cleanup_mpu401", ")", ";", "#", "ifndef", "MODULE", "static", "int", "__init", "setup_mpu401", "(", "char", "*", "str", ")", "{", "/", "*", "io", ",", "irq", "*", "/", "int", "ints", "[", "3", "]", ";", "str", "=", "get_options", "(", "str", ",", "ARRAY_SIZE", "(", "ints", ")", ",", "ints", ")", ";", "io", "=", "ints", "[", "1", "]", ";", "irq", "=", "ints", "[", "2", "]", ";", "return", "1", ";", "}", "__setup", "(", "\"", "mpu401", "=", "\",", "setup_mpu401", ")", ";", "#", "endif", "MODULE_LICENSE", "(", "\"", "GPL", "\"", ");", "@", "@", "-", "1", ",", "11", "+", "0", ",", "0", "@", "@", "/", "*", "From", "uart401", ".", "c", "*", "/", "int", "probe_uart401", "(", "struct", "address_info", "*", "hw_config", ",", "struct", "module", "*", "owner", ")", ";", "void", "unload_uart401", "(", "struct", "address_info", "*", "hw_config", ")", ";", "irqreturn_t", "uart401intr", "(", "int", "irq", ",", "void", "*", "dev_id", ")", ";", "/", "*", "From", "mpu401", ".", "c", "*", "/", "int", "probe_mpu401", "(", "struct", "address_info", "*", "hw_config", ",", "struct", "resource", "*", "ports", ")", ";", "int", "attach_mpu401", "(", "struct", "address_info", "*", "hw_config", ",", "struct", "module", "*", "owner", ")", ";", "void", "unload_mpu401", "(", "struct", "address_info", "*", "hw_info", ")", ";", "@", "@", "-", "1", ",", "413", "+", "0", ",", "0", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "msnd", ".", "c", "-", "Driver", "Base", "*", "*", "Turtle", "Beach", "MultiSound", "Sound", "Card", "Driver", "for", "Linux", "*", "*", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "*", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "*", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "*", "(", "at", "your", "option", ")", "any", "later", "version", ".", "*", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "*", "GNU", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "*", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "*", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "kernel", ".", "h", ">", "#", "include", "<", "linux", "/", "vmalloc", ".", "h", ">", "#", "include", "<", "linux", "/", "types", ".", "h", ">", "#", "include", "<", "linux", "/", "delay", ".", "h", ">", "#", "include", "<", "linux", "/", "mm", ".", "h", ">", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "interrupt", ".", "h", ">", "#", "include", "<", "asm", "/", "io", ".", "h", ">", "#", "include", "<", "linux", "/", "uaccess", ".", "h", ">", "#", "include", "<", "linux", "/", "spinlock", ".", "h", ">", "#", "include", "<", "asm", "/", "irq", ".", "h", ">", "#", "include", "\"", "msnd", ".", "h", "\"", "#", "define", "LOGNAME", "\"", "msnd", "\"", "#", "define", "MSND_MAX_DEVS", "4", "static", "multisound_dev_t", "*", "devs", "[", "MSND_MAX_DEVS", "]", ";", "static", "int", "num_devs", ";", "int", "msnd_register", "(", "multisound_dev_t", "*", "dev", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "MSND_MAX_DEVS", ";", "+", "+", "i", ")", "if", "(", "devs", "[", "i", "]", "=", "=", "NULL", ")", "break", ";", "if", "(", "i", "=", "=", "MSND_MAX_DEVS", ")", "return", "-", "ENOMEM", ";", "devs", "[", "i", "]", "=", "dev", ";", "+", "+", "num_devs", ";", "return", "0", ";", "}", "void", "msnd_unregister", "(", "multisound_dev_t", "*", "dev", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "MSND_MAX_DEVS", ";", "+", "+", "i", ")", "if", "(", "devs", "[", "i", "]", "=", "=", "dev", ")", "break", ";", "if", "(", "i", "=", "=", "MSND_MAX_DEVS", ")", "{", "printk", "(", "KERN_WARNING", "LOGNAME", "\"", ":", "Unregistering", "unknown", "device", "\\", "n", "\"", ");", "return", ";", "}", "devs", "[", "i", "]", "=", "NULL", ";", "-", "-", "num_devs", ";", "}", "void", "msnd_init_queue", "(", "void", "__iomem", "*", "base", ",", "int", "start", ",", "int", "size", ")", "{", "writew", "(", "PCTODSP_BASED", "(", "start", ")", ",", "base", "+", "JQS_wStart", ")", ";", "writew", "(", "PCTODSP_OFFSET", "(", "size", ")", "-", "1", ",", "base", "+", "JQS_wSize", ")", ";", "writew", "(", "0", ",", "base", "+", "JQS_wHead", ")", ";", "writew", "(", "0", ",", "base", "+", "JQS_wTail", ")", ";", "}", "void", "msnd_fifo_init", "(", "msnd_fifo", "*", "f", ")", "{", "f", "-", ">", "data", "=", "NULL", ";", "}", "void", "msnd_fifo_free", "(", "msnd_fifo", "*", "f", ")", "{", "vfree", "(", "f", "-", ">", "data", ")", ";", "f", "-", ">", "data", "=", "NULL", ";", "}", "int", "msnd_fifo_alloc", "(", "msnd_fifo", "*", "f", ",", "size_t", "n", ")", "{", "msnd_fifo_free", "(", "f", ")", ";", "f", "-", ">", "data", "=", "vmalloc", "(", "n", ")", ";", "f", "-", ">", "n", "=", "n", ";", "f", "-", ">", "tail", "=", "0", ";", "f", "-", ">", "head", "=", "0", ";", "f", "-", ">", "len", "=", "0", ";", "if", "(", "!", "f", "-", ">", "data", ")", "return", "-", "ENOMEM", ";", "return", "0", ";", "}", "void", "msnd_fifo_make_empty", "(", "msnd_fifo", "*", "f", ")", "{", "f", "-", ">", "len", "=", "f", "-", ">", "tail", "=", "f", "-", ">", "head", "=", "0", ";", "}", "int", "msnd_fifo_write_io", "(", "msnd_fifo", "*", "f", ",", "char", "__iomem", "*", "buf", ",", "size_t", "len", ")", "{", "int", "count", "=", "0", ";", "while", "(", "(", "count", "<", "len", ")", "&", "&", "(", "f", "-", ">", "len", "!", "=", "f", "-", ">", "n", ")", ")", "{", "int", "nwritten", ";", "if", "(", "f", "-", ">", "head", "<", "=", "f", "-", ">", "tail", ")", "{", "nwritten", "=", "len", "-", "count", ";", "if", "(", "nwritten", ">", "f", "-", ">", "n", "-", "f", "-", ">", "tail", ")", "nwritten", "=", "f", "-", ">", "n", "-", "f", "-", ">", "tail", ";", "}", "else", "{", "nwritten", "=", "f", "-", ">", "head", "-", "f", "-", ">", "tail", ";", "if", "(", "nwritten", ">", "len", "-", "count", ")", "nwritten", "=", "len", "-", "count", ";", "}", "memcpy_fromio", "(", "f", "-", ">", "data", "+", "f", "-", ">", "tail", ",", "buf", ",", "nwritten", ")", ";", "count", "+", "=", "nwritten", ";", "buf", "+", "=", "nwritten", ";", "f", "-", ">", "len", "+", "=", "nwritten", ";", "f", "-", ">", "tail", "+", "=", "nwritten", ";", "f", "-", ">", "tail", "%", "=", "f", "-", ">", "n", ";", "}", "return", "count", ";", "}", "int", "msnd_fifo_write", "(", "msnd_fifo", "*", "f", ",", "const", "char", "*", "buf", ",", "size_t", "len", ")", "{", "int", "count", "=", "0", ";", "while", "(", "(", "count", "<", "len", ")", "&", "&", "(", "f", "-", ">", "len", "!", "=", "f", "-", ">", "n", ")", ")", "{", "int", "nwritten", ";", "if", "(", "f", "-", ">", "head", "<", "=", "f", "-", ">", "tail", ")", "{", "nwritten", "=", "len", "-", "count", ";", "if", "(", "nwritten", ">", "f", "-", ">", "n", "-", "f", "-", ">", "tail", ")", "nwritten", "=", "f", "-", ">", "n", "-", "f", "-", ">", "tail", ";", "}", "else", "{", "nwritten", "=", "f", "-", ">", "head", "-", "f", "-", ">", "tail", ";", "if", "(", "nwritten", ">", "len", "-", "count", ")", "nwritten", "=", "len", "-", "count", ";", "}", "memcpy", "(", "f", "-", ">", "data", "+", "f", "-", ">", "tail", ",", "buf", ",", "nwritten", ")", ";", "count", "+", "=", "nwritten", ";", "buf", "+", "=", "nwritten", ";", "f", "-", ">", "len", "+", "=", "nwritten", ";", "f", "-", ">", "tail", "+", "=", "nwritten", ";", "f", "-", ">", "tail", "%", "=", "f", "-", ">", "n", ";", "}", "return", "count", ";", "}", "int", "msnd_fifo_read_io", "(", "msnd_fifo", "*", "f", ",", "char", "__iomem", "*", "buf", ",", "size_t", "len", ")", "{", "int", "count", "=", "0", ";", "while", "(", "(", "count", "<", "len", ")", "&", "&", "(", "f", "-", ">", "len", ">", "0", ")", ")", "{", "int", "nread", ";", "if", "(", "f", "-", ">", "tail", "<", "=", "f", "-", ">", "head", ")", "{", "nread", "=", "len", "-", "count", ";", "if", "(", "nread", ">", "f", "-", ">", "n", "-", "f", "-", ">", "head", ")", "nread", "=", "f", "-", ">", "n", "-", "f", "-", ">", "head", ";", "}", "else", "{", "nread", "=", "f", "-", ">", "tail", "-", "f", "-", ">", "head", ";", "if", "(", "nread", ">", "len", "-", "count", ")", "nread", "=", "len", "-", "count", ";", "}", "memcpy_toio", "(", "buf", ",", "f", "-", ">", "data", "+", "f", "-", ">", "head", ",", "nread", ")", ";", "count", "+", "=", "nread", ";", "buf", "+", "=", "nread", ";", "f", "-", ">", "len", "-", "=", "nread", ";", "f", "-", ">", "head", "+", "=", "nread", ";", "f", "-", ">", "head", "%", "=", "f", "-", ">", "n", ";", "}", "return", "count", ";", "}", "int", "msnd_fifo_read", "(", "msnd_fifo", "*", "f", ",", "char", "*", "buf", ",", "size_t", "len", ")", "{", "int", "count", "=", "0", ";", "while", "(", "(", "count", "<", "len", ")", "&", "&", "(", "f", "-", ">", "len", ">", "0", ")", ")", "{", "int", "nread", ";", "if", "(", "f", "-", ">", "tail", "<", "=", "f", "-", ">", "head", ")", "{", "nread", "=", "len", "-", "count", ";", "if", "(", "nread", ">", "f", "-", ">", "n", "-", "f", "-", ">", "head", ")", "nread", "=", "f", "-", ">", "n", "-", "f", "-", ">", "head", ";", "}", "else", "{", "nread", "=", "f", "-", ">", "tail", "-", "f", "-", ">", "head", ";", "if", "(", "nread", ">", "len", "-", "count", ")", "nread", "=", "len", "-", "count", ";", "}", "memcpy", "(", "buf", ",", "f", "-", ">", "data", "+", "f", "-", ">", "head", ",", "nread", ")", ";", "count", "+", "=", "nread", ";", "buf", "+", "=", "nread", ";", "f", "-", ">", "len", "-", "=", "nread", ";", "f", "-", ">", "head", "+", "=", "nread", ";", "f", "-", ">", "head", "%", "=", "f", "-", ">", "n", ";", "}", "return", "count", ";", "}", "static", "int", "msnd_wait_TXDE", "(", "multisound_dev_t", "*", "dev", ")", "{", "register", "unsigned", "int", "io", "=", "dev", "-", ">", "io", ";", "register", "int", "timeout", "=", "1000", ";", "while", "(", "timeout", "-", "-", ">", "0", ")", "if", "(", "msnd_inb", "(", "io", "+", "HP_ISR", ")", "&", "HPISR_TXDE", ")", "return", "0", ";", "return", "-", "EIO", ";", "}", "static", "int", "msnd_wait_HC0", "(", "multisound_dev_t", "*", "dev", ")", "{", "register", "unsigned", "int", "io", "=", "dev", "-", ">", "io", ";", "register", "int", "timeout", "=", "1000", ";", "while", "(", "timeout", "-", "-", ">", "0", ")", "if", "(", "!(", "msnd_inb", "(", "io", "+", "HP_CVR", ")", "&", "HPCVR_HC", ")", ")", "return", "0", ";", "return", "-", "EIO", ";", "}", "int", "msnd_send_dsp_cmd", "(", "multisound_dev_t", "*", "dev", ",", "BYTE", "cmd", ")", "{", "unsigned", "long", "flags", ";", "spin_lock_irqsave", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "msnd_wait_HC0", "(", "dev", ")", "=", "=", "0", ")", "{", "msnd_outb", "(", "cmd", ",", "dev", "-", ">", "io", "+", "HP_CVR", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "return", "0", ";", "}", "spin_unlock_irqrestore", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Send", "DSP", "command", "timeout", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "int", "msnd_send_word", "(", "multisound_dev_t", "*", "dev", ",", "unsigned", "char", "high", ",", "unsigned", "char", "mid", ",", "unsigned", "char", "low", ")", "{", "register", "unsigned", "int", "io", "=", "dev", "-", ">", "io", ";", "if", "(", "msnd_wait_TXDE", "(", "dev", ")", "=", "=", "0", ")", "{", "msnd_outb", "(", "high", ",", "io", "+", "HP_TXH", ")", ";", "msnd_outb", "(", "mid", ",", "io", "+", "HP_TXM", ")", ";", "msnd_outb", "(", "low", ",", "io", "+", "HP_TXL", ")", ";", "return", "0", ";", "}", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Send", "host", "word", "timeout", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "int", "msnd_upload_host", "(", "multisound_dev_t", "*", "dev", ",", "char", "*", "bin", ",", "int", "len", ")", "{", "int", "i", ";", "if", "(", "len", "%", "3", "!", "=", "0", ")", "{", "printk", "(", "KERN_WARNING", "LOGNAME", "\"", ":", "Upload", "host", "data", "not", "multiple", "of", "3", "!", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "for", "(", "i", "=", "0", ";", "i", "<", "len", ";", "i", "+", "=", "3", ")", "if", "(", "msnd_send_word", "(", "dev", ",", "bin", "[", "i", "]", ",", "bin", "[", "i", "+", "1", "]", ",", "bin", "[", "i", "+", "2", "]", ")", "!", "=", "0", ")", "return", "-", "EIO", ";", "msnd_inb", "(", "dev", "-", ">", "io", "+", "HP_RXL", ")", ";", "msnd_inb", "(", "dev", "-", ">", "io", "+", "HP_CVR", ")", ";", "return", "0", ";", "}", "int", "msnd_enable_irq", "(", "multisound_dev_t", "*", "dev", ")", "{", "unsigned", "long", "flags", ";", "if", "(", "dev", "-", ">", "irq_ref", "+", "+)", "return", "0", ";", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Enabling", "IRQ", "\\", "n", "\"", ");", "spin_lock_irqsave", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "msnd_wait_TXDE", "(", "dev", ")", "=", "=", "0", ")", "{", "msnd_outb", "(", "msnd_inb", "(", "dev", "-", ">", "io", "+", "HP_ICR", ")", "|", "HPICR_TREQ", ",", "dev", "-", ">", "io", "+", "HP_ICR", ")", ";", "if", "(", "dev", "-", ">", "type", "=", "=", "msndClassic", ")", "msnd_outb", "(", "dev", "-", ">", "irqid", ",", "dev", "-", ">", "io", "+", "HP_IRQM", ")", ";", "msnd_outb", "(", "msnd_inb", "(", "dev", "-", ">", "io", "+", "HP_ICR", ")", "&", "~", "HPICR_TREQ", ",", "dev", "-", ">", "io", "+", "HP_ICR", ")", ";", "msnd_outb", "(", "msnd_inb", "(", "dev", "-", ">", "io", "+", "HP_ICR", ")", "|", "HPICR_RREQ", ",", "dev", "-", ">", "io", "+", "HP_ICR", ")", ";", "enable_irq", "(", "dev", "-", ">", "irq", ")", ";", "msnd_init_queue", "(", "dev", "-", ">", "DSPQ", ",", "dev", "-", ">", "dspq_data_buff", ",", "dev", "-", ">", "dspq_buff_size", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "return", "0", ";", "}", "spin_unlock_irqrestore", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Enable", "IRQ", "failed", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "int", "msnd_disable_irq", "(", "multisound_dev_t", "*", "dev", ")", "{", "unsigned", "long", "flags", ";", "if", "(", "--", "dev", "-", ">", "irq_ref", ">", "0", ")", "return", "0", ";", "if", "(", "dev", "-", ">", "irq_ref", "<", "0", ")", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "IRQ", "ref", "count", "is", "%", "d", "\\", "n", "\"", ",", "dev", "-", ">", "irq_ref", ")", ";", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Disabling", "IRQ", "\\", "n", "\"", ");", "spin_lock_irqsave", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "if", "(", "msnd_wait_TXDE", "(", "dev", ")", "=", "=", "0", ")", "{", "msnd_outb", "(", "msnd_inb", "(", "dev", "-", ">", "io", "+", "HP_ICR", ")", "&", "~", "HPICR_RREQ", ",", "dev", "-", ">", "io", "+", "HP_ICR", ")", ";", "if", "(", "dev", "-", ">", "type", "=", "=", "msndClassic", ")", "msnd_outb", "(", "HPIRQ_NONE", ",", "dev", "-", ">", "io", "+", "HP_IRQM", ")", ";", "disable_irq", "(", "dev", "-", ">", "irq", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "return", "0", ";", "}", "spin_unlock_irqrestore", "(", "&", "dev", "-", ">", "lock", ",", "flags", ")", ";", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Disable", "IRQ", "failed", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "#", "ifndef", "LINUX20", "EXPORT_SYMBOL", "(", "msnd_register", ")", ";", "EXPORT_SYMBOL", "(", "msnd_unregister", ")", ";", "EXPORT_SYMBOL", "(", "msnd_init_queue", ")", ";", "EXPORT_SYMBOL", "(", "msnd_fifo_init", ")", ";", "EXPORT_SYMBOL", "(", "msnd_fifo_free", ")", ";", "EXPORT_SYMBOL", "(", "msnd_fifo_alloc", ")", ";", "EXPORT_SYMBOL", "(", "msnd_fifo_make_empty", ")", ";", "EXPORT_SYMBOL", "(", "msnd_fifo_write_io", ")", ";", "EXPORT_SYMBOL", "(", "msnd_fifo_read_io", ")", ";", "EXPORT_SYMBOL", "(", "msnd_fifo_write", ")", ";", "EXPORT_SYMBOL", "(", "msnd_fifo_read", ")", ";", "EXPORT_SYMBOL", "(", "msnd_send_dsp_cmd", ")", ";", "EXPORT_SYMBOL", "(", "msnd_send_word", ")", ";", "EXPORT_SYMBOL", "(", "msnd_upload_host", ")", ";", "EXPORT_SYMBOL", "(", "msnd_enable_irq", ")", ";", "EXPORT_SYMBOL", "(", "msnd_disable_irq", ")", ";", "#", "endif", "#", "ifdef", "MODULE", "MODULE_AUTHOR", "(", "\"", "Andrew", "Veliath", "<", "andrewtv", "@", "usa", ".", "net", ">", "\")", ";", "MODULE_DESCRIPTION", "(", "\"", "Turtle", "Beach", "MultiSound", "Driver", "Base", "\"", ");", "MODULE_LICENSE", "(", "\"", "GPL", "\"", ");", "int", "init_module", "(", "void", ")", "{", "return", "0", ";", "}", "void", "cleanup_module", "(", "void", ")", "{", "}", "#", "endif", "@", "@", "-", "1", ",", "278", "+", "0", ",", "0", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "msnd", ".", "h", "*", "*", "Turtle", "Beach", "MultiSound", "Sound", "Card", "Driver", "for", "Linux", "*", "*", "Some", "parts", "of", "this", "header", "file", "were", "derived", "from", "the", "Turtle", "Beach", "*", "MultiSound", "Driver", "Development", "Kit", ".", "*", "*", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "*", "Copyright", "(", "C", ")", "1993", "Turtle", "Beach", "Systems", ",", "Inc", ".", "*", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "*", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "*", "(", "at", "your", "option", ")", "any", "later", "version", ".", "*", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "*", "GNU", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "*", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "*", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "ifndef", "__MSND_H", "#", "define", "__MSND_H", "#", "define", "VERSION", "\"", "0", ".", "8", ".", "3", ".", "1", "\"", "#", "define", "DEFSAMPLERATE", "DSP_DEFAULT_SPEED", "#", "define", "DEFSAMPLESIZE", "AFMT_U8", "#", "define", "DEFCHANNELS", "1", "#", "define", "DEFFIFOSIZE", "128", "#", "define", "SNDCARD_MSND", "38", "#", "define", "SRAM_BANK_SIZE", "0x8000", "#", "define", "SRAM_CNTL_START", "0x7F00", "#", "define", "DSP_BASE_ADDR", "0x4000", "#", "define", "DSP_BANK_BASE", "0x4000", "#", "define", "HP_ICR", "0x00", "#", "define", "HP_CVR", "0x01", "#", "define", "HP_ISR", "0x02", "#", "define", "HP_IVR", "0x03", "#", "define", "HP_NU", "0x04", "#", "define", "HP_INFO", "0x04", "#", "define", "HP_TXH", "0x05", "#", "define", "HP_RXH", "0x05", "#", "define", "HP_TXM", "0x06", "#", "define", "HP_RXM", "0x06", "#", "define", "HP_TXL", "0x07", "#", "define", "HP_RXL", "0x07", "#", "define", "HP_ICR_DEF", "0x00", "#", "define", "HP_CVR_DEF", "0x12", "#", "define", "HP_ISR_DEF", "0x06", "#", "define", "HP_IVR_DEF", "0x0f", "#", "define", "HP_NU_DEF", "0x00", "#", "define", "HP_IRQM", "0x09", "#", "define", "HPR_BLRC", "0x08", "#", "define", "HPR_SPR1", "0x09", "#", "define", "HPR_SPR2", "0x0A", "#", "define", "HPR_TCL0", "0x0B", "#", "define", "HPR_TCL1", "0x0C", "#", "define", "HPR_TCL2", "0x0D", "#", "define", "HPR_TCL3", "0x0E", "#", "define", "HPR_TCL4", "0x0F", "#", "define", "HPICR_INIT", "0x80", "#", "define", "HPICR_HM1", "0x40", "#", "define", "HPICR_HM0", "0x20", "#", "define", "HPICR_HF1", "0x10", "#", "define", "HPICR_HF0", "0x08", "#", "define", "HPICR_TREQ", "0x02", "#", "define", "HPICR_RREQ", "0x01", "#", "define", "HPCVR_HC", "0x80", "#", "define", "HPISR_HREQ", "0x80", "#", "define", "HPISR_DMA", "0x40", "#", "define", "HPISR_HF3", "0x10", "#", "define", "HPISR_HF2", "0x08", "#", "define", "HPISR_TRDY", "0x04", "#", "define", "HPISR_TXDE", "0x02", "#", "define", "HPISR_RXDF", "0x01", "#", "define", "HPIO_290", "0", "#", "define", "HPIO_260", "1", "#", "define", "HPIO_250", "2", "#", "define", "HPIO_240", "3", "#", "define", "HPIO_230", "4", "#", "define", "HPIO_220", "5", "#", "define", "HPIO_210", "6", "#", "define", "HPIO_3E0", "7", "#", "define", "HPMEM_NONE", "0", "#", "define", "HPMEM_B000", "1", "#", "define", "HPMEM_C800", "2", "#", "define", "HPMEM_D000", "3", "#", "define", "HPMEM_D400", "4", "#", "define", "HPMEM_D800", "5", "#", "define", "HPMEM_E000", "6", "#", "define", "HPMEM_E800", "7", "#", "define", "HPIRQ_NONE", "0", "#", "define", "HPIRQ_5", "1", "#", "define", "HPIRQ_7", "2", "#", "define", "HPIRQ_9", "3", "#", "define", "HPIRQ_10", "4", "#", "define", "HPIRQ_11", "5", "#", "define", "HPIRQ_12", "6", "#", "define", "HPIRQ_15", "7", "#", "define", "HIMT_PLAY_DONE", "0x00", "#", "define", "HIMT_RECORD_DONE", "0x01", "#", "define", "HIMT_MIDI_EOS", "0x02", "#", "define", "HIMT_MIDI_OUT", "0x03", "#", "define", "HIMT_MIDI_IN_UCHAR", "0x0E", "#", "define", "HIMT_DSP", "0x0F", "#", "define", "HDEX_BASE", "0x92", "#", "define", "HDEX_PLAY_START", "(", "0", "+", "HDEX_BASE", ")", "#", "define", "HDEX_PLAY_STOP", "(", "1", "+", "HDEX_BASE", ")", "#", "define", "HDEX_PLAY_PAUSE", "(", "2", "+", "HDEX_BASE", ")", "#", "define", "HDEX_PLAY_RESUME", "(", "3", "+", "HDEX_BASE", ")", "#", "define", "HDEX_RECORD_START", "(", "4", "+", "HDEX_BASE", ")", "#", "define", "HDEX_RECORD_STOP", "(", "5", "+", "HDEX_BASE", ")", "#", "define", "HDEX_MIDI_IN_START", "(", "6", "+", "HDEX_BASE", ")", "#", "define", "HDEX_MIDI_IN_STOP", "(", "7", "+", "HDEX_BASE", ")", "#", "define", "HDEX_MIDI_OUT_START", "(", "8", "+", "HDEX_BASE", ")", "#", "define", "HDEX_MIDI_OUT_STOP", "(", "9", "+", "HDEX_BASE", ")", "#", "define", "HDEX_AUX_REQ", "(", "10", "+", "HDEX_BASE", ")", "#", "define", "HIWORD", "(", "l", ")", "(", "(", "WORD", ")", "((", "((", "DWORD", ")", "(", "l", ")", ")", ">", ">", "16", ")", "&", "0xFFFF", ")", ")", "#", "define", "LOWORD", "(", "l", ")", "(", "(", "WORD", ")", "(", "DWORD", ")", "(", "l", ")", ")", "#", "define", "HIBYTE", "(", "w", ")", "(", "(", "BYTE", ")", "((", "(", "WORD", ")", "(", "w", ")", ">", ">", "8", ")", "&", "0xFF", ")", ")", "#", "define", "LOBYTE", "(", "w", ")", "(", "(", "BYTE", ")", "(", "w", ")", ")", "#", "define", "MAKELONG", "(", "low", ",", "hi", ")", "(", "(", "long", ")", "((", "(", "WORD", ")", "(", "low", ")", ")|", "((", "(", "DWORD", ")", "((", "WORD", ")", "(", "hi", ")", "))", "<<", "16", ")", "))", "#", "define", "MAKEWORD", "(", "low", ",", "hi", ")", "(", "(", "WORD", ")", "((", "(", "BYTE", ")", "(", "low", ")", ")|", "((", "(", "WORD", ")", "((", "BYTE", ")", "(", "hi", ")", "))", "<<", "8", ")", "))", "#", "define", "PCTODSP_OFFSET", "(", "w", ")", "(", "USHORT", ")", "((", "w", ")", "/", "2", ")", "#", "define", "PCTODSP_BASED", "(", "w", ")", "(", "USHORT", ")", "((", "(", "w", ")", "/", "2", ")", "+", "DSP_BASE_ADDR", ")", "#", "define", "DSPTOPC_BASED", "(", "w", ")", "(", "((", "w", ")", "-", "DSP_BASE_ADDR", ")", "*", "2", ")", "#", "ifdef", "SLOWIO", "#", "define", "msnd_outb", "outb_p", "#", "define", "msnd_inb", "inb_p", "#", "else", "#", "define", "msnd_outb", "outb", "#", "define", "msnd_inb", "inb", "#", "endif", "/", "*", "JobQueueStruct", "*", "/", "#", "define", "JQS_wStart", "0x00", "#", "define", "JQS_wSize", "0x02", "#", "define", "JQS_wHead", "0x04", "#", "define", "JQS_wTail", "0x06", "#", "define", "JQS__size", "0x08", "/", "*", "DAQueueDataStruct", "*", "/", "#", "define", "DAQDS_wStart", "0x00", "#", "define", "DAQDS_wSize", "0x02", "#", "define", "DAQDS_wFormat", "0x04", "#", "define", "DAQDS_wSampleSize", "0x06", "#", "define", "DAQDS_wChannels", "0x08", "#", "define", "DAQDS_wSampleRate", "0x0A", "#", "define", "DAQDS_wIntMsg", "0x0C", "#", "define", "DAQDS_wFlags", "0x0E", "#", "define", "DAQDS__size", "0x10", "typedef", "u8", "BYTE", ";", "typedef", "u16", "USHORT", ";", "typedef", "u16", "WORD", ";", "typedef", "u32", "DWORD", ";", "typedef", "void", "__iomem", "*", "LPDAQD", ";", "/", "*", "Generic", "FIFO", "*", "/", "typedef", "struct", "{", "size_t", "n", ",", "len", ";", "char", "*", "data", ";", "int", "head", ",", "tail", ";", "}", "msnd_fifo", ";", "typedef", "struct", "multisound_dev", "{", "/", "*", "Linux", "device", "info", "*", "/", "char", "*", "name", ";", "int", "dsp_minor", ",", "mixer_minor", ";", "int", "ext_midi_dev", ",", "hdr_midi_dev", ";", "/", "*", "Hardware", "resources", "*", "/", "int", "io", ",", "numio", ";", "int", "memid", ",", "irqid", ";", "int", "irq", ",", "irq_ref", ";", "unsigned", "char", "info", ";", "void", "__iomem", "*", "base", ";", "/", "*", "Motorola", "56k", "DSP", "SMA", "*", "/", "void", "__iomem", "*", "SMA", ";", "void", "__iomem", "*", "DAPQ", ",", "*", "DARQ", ",", "*", "MODQ", ",", "*", "MIDQ", ",", "*", "DSPQ", ";", "void", "__iomem", "*", "pwDSPQData", ",", "*", "pwMIDQData", ",", "*", "pwMODQData", ";", "int", "dspq_data_buff", ",", "dspq_buff_size", ";", "/", "*", "State", "variables", "*", "/", "enum", "{", "msndClassic", ",", "msndPinnacle", "}", "type", ";", "fmode_t", "mode", ";", "unsigned", "long", "flags", ";", "#", "define", "F_RESETTING", "0", "#", "define", "F_HAVEDIGITAL", "1", "#", "define", "F_AUDIO_WRITE_INUSE", "2", "#", "define", "F_WRITING", "3", "#", "define", "F_WRITEBLOCK", "4", "#", "define", "F_WRITEFLUSH", "5", "#", "define", "F_AUDIO_READ_INUSE", "6", "#", "define", "F_READING", "7", "#", "define", "F_READBLOCK", "8", "#", "define", "F_EXT_MIDI_INUSE", "9", "#", "define", "F_HDR_MIDI_INUSE", "10", "#", "define", "F_DISABLE_WRITE_NDELAY", "11", "wait_queue_head_t", "writeblock", ";", "wait_queue_head_t", "readblock", ";", "wait_queue_head_t", "writeflush", ";", "spinlock_t", "lock", ";", "int", "nresets", ";", "unsigned", "long", "recsrc", ";", "int", "left_levels", "[", "32", "]", ";", "int", "right_levels", "[", "32", "]", ";", "int", "mixer_mod_count", ";", "int", "calibrate_signal", ";", "int", "play_sample_size", ",", "play_sample_rate", ",", "play_channels", ";", "int", "play_ndelay", ";", "int", "rec_sample_size", ",", "rec_sample_rate", ",", "rec_channels", ";", "int", "rec_ndelay", ";", "BYTE", "bCurrentMidiPatch", ";", "/", "*", "Digital", "audio", "FIFOs", "*", "/", "msnd_fifo", "DAPF", ",", "DARF", ";", "int", "fifosize", ";", "int", "last_playbank", ",", "last_recbank", ";", "/", "*", "MIDI", "in", "callback", "*", "/", "void", "(", "*", "midi_in_interrupt", ")", "(", "struct", "multisound_dev", "*", ");", "}", "multisound_dev_t", ";", "#", "ifndef", "mdelay", "#", "define", "mdelay", "(", "a", ")", "udelay", "(", "(", "a", ")", "*", "1000", ")", "#", "endif", "int", "msnd_register", "(", "multisound_dev_t", "*", "dev", ")", ";", "void", "msnd_unregister", "(", "multisound_dev_t", "*", "dev", ")", ";", "void", "msnd_init_queue", "(", "void", "__iomem", "*", ",", "int", "start", ",", "int", "size", ")", ";", "void", "msnd_fifo_init", "(", "msnd_fifo", "*", "f", ")", ";", "void", "msnd_fifo_free", "(", "msnd_fifo", "*", "f", ")", ";", "int", "msnd_fifo_alloc", "(", "msnd_fifo", "*", "f", ",", "size_t", "n", ")", ";", "void", "msnd_fifo_make_empty", "(", "msnd_fifo", "*", "f", ")", ";", "int", "msnd_fifo_write_io", "(", "msnd_fifo", "*", "f", ",", "char", "__iomem", "*", "buf", ",", "size_t", "len", ")", ";", "int", "msnd_fifo_read_io", "(", "msnd_fifo", "*", "f", ",", "char", "__iomem", "*", "buf", ",", "size_t", "len", ")", ";", "int", "msnd_fifo_write", "(", "msnd_fifo", "*", "f", ",", "const", "char", "*", "buf", ",", "size_t", "len", ")", ";", "int", "msnd_fifo_read", "(", "msnd_fifo", "*", "f", ",", "char", "*", "buf", ",", "size_t", "len", ")", ";", "int", "msnd_send_dsp_cmd", "(", "multisound_dev_t", "*", "dev", ",", "BYTE", "cmd", ")", ";", "int", "msnd_send_word", "(", "multisound_dev_t", "*", "dev", ",", "unsigned", "char", "high", ",", "unsigned", "char", "mid", ",", "unsigned", "char", "low", ")", ";", "int", "msnd_upload_host", "(", "multisound_dev_t", "*", "dev", ",", "char", "*", "bin", ",", "int", "len", ")", ";", "int", "msnd_enable_irq", "(", "multisound_dev_t", "*", "dev", ")", ";", "int", "msnd_disable_irq", "(", "multisound_dev_t", "*", "dev", ")", ";", "#", "endif", "/", "*", "__MSND_H", "*", "/", "@", "@", "-", "1", ",", "3", "+", "0", ",", "0", "@", "@", "/", "*", "The", "work", "is", "in", "msnd_pinnacle", ".", "c", ",", "just", "define", "MSND_CLASSIC", "before", "it", ".", "*", "/", "#", "define", "MSND_CLASSIC", "#", "include", "\"", "msnd_pinnacle", ".", "c", "\"", "@", "@", "-", "1", ",", "185", "+", "0", ",", "0", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "msnd_classic", ".", "h", "*", "*", "Turtle", "Beach", "MultiSound", "Sound", "Card", "Driver", "for", "Linux", "*", "*", "Some", "parts", "of", "this", "header", "file", "were", "derived", "from", "the", "Turtle", "Beach", "*", "MultiSound", "Driver", "Development", "Kit", ".", "*", "*", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "*", "Copyright", "(", "C", ")", "1993", "Turtle", "Beach", "Systems", ",", "Inc", ".", "*", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "*", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "*", "(", "at", "your", "option", ")", "any", "later", "version", ".", "*", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "*", "GNU", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "*", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "*", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "ifndef", "__MSND_CLASSIC_H", "#", "define", "__MSND_CLASSIC_H", "#", "define", "DSP_NUMIO", "0x10", "#", "define", "HP_MEMM", "0x08", "#", "define", "HP_BITM", "0x0E", "#", "define", "HP_WAIT", "0x0D", "#", "define", "HP_DSPR", "0x0A", "#", "define", "HP_PROR", "0x0B", "#", "define", "HP_BLKS", "0x0C", "#", "define", "HPPRORESET_OFF", "0", "#", "define", "HPPRORESET_ON", "1", "#", "define", "HPDSPRESET_OFF", "0", "#", "define", "HPDSPRESET_ON", "1", "#", "define", "HPBLKSEL_0", "0", "#", "define", "HPBLKSEL_1", "1", "#", "define", "HPWAITSTATE_0", "0", "#", "define", "HPWAITSTATE_1", "1", "#", "define", "HPBITMODE_16", "0", "#", "define", "HPBITMODE_8", "1", "#", "define", "HIDSP_INT_PLAY_UNDER", "0x00", "#", "define", "HIDSP_INT_RECORD_OVER", "0x01", "#", "define", "HIDSP_INPUT_CLIPPING", "0x02", "#", "define", "HIDSP_MIDI_IN_OVER", "0x10", "#", "define", "HIDSP_MIDI_OVERRUN_ERR", "0x13", "#", "define", "HDEXAR_CLEAR_PEAKS", "1", "#", "define", "HDEXAR_IN_SET_POTS", "2", "#", "define", "HDEXAR_AUX_SET_POTS", "3", "#", "define", "HDEXAR_CAL_A_TO_D", "4", "#", "define", "HDEXAR_RD_EXT_DSP_BITS", "5", "#", "define", "TIME_PRO_RESET_DONE", "0x028A", "#", "define", "TIME_PRO_SYSEX", "0x0040", "#", "define", "TIME_PRO_RESET", "0x0032", "#", "define", "AGND", "0x01", "#", "define", "SIGNAL", "0x02", "#", "define", "EXT_DSP_BIT_DCAL", "0x0001", "#", "define", "EXT_DSP_BIT_MIDI_CON", "0x0002", "#", "define", "BUFFSIZE", "0x8000", "#", "define", "HOSTQ_SIZE", "0x40", "#", "define", "SRAM_CNTL_START", "0x7F00", "#", "define", "SMA_STRUCT_START", "0x7F40", "#", "define", "DAP_BUFF_SIZE", "0x2400", "#", "define", "DAR_BUFF_SIZE", "0x2000", "#", "define", "DAPQ_STRUCT_SIZE", "0x10", "#", "define", "DARQ_STRUCT_SIZE", "0x10", "#", "define", "DAPQ_BUFF_SIZE", "(", "3", "*", "0x10", ")", "#", "define", "DARQ_BUFF_SIZE", "(", "3", "*", "0x10", ")", "#", "define", "MODQ_BUFF_SIZE", "0x400", "#", "define", "MIDQ_BUFF_SIZE", "0x200", "#", "define", "DSPQ_BUFF_SIZE", "0x40", "#", "define", "DAPQ_DATA_BUFF", "0x6C00", "#", "define", "DARQ_DATA_BUFF", "0x6C30", "#", "define", "MODQ_DATA_BUFF", "0x6C60", "#", "define", "MIDQ_DATA_BUFF", "0x7060", "#", "define", "DSPQ_DATA_BUFF", "0x7260", "#", "define", "DAPQ_OFFSET", "SRAM_CNTL_START", "#", "define", "DARQ_OFFSET", "(", "SRAM_CNTL_START", "+", "0x08", ")", "#", "define", "MODQ_OFFSET", "(", "SRAM_CNTL_START", "+", "0x10", ")", "#", "define", "MIDQ_OFFSET", "(", "SRAM_CNTL_START", "+", "0x18", ")", "#", "define", "DSPQ_OFFSET", "(", "SRAM_CNTL_START", "+", "0x20", ")", "#", "define", "MOP_SYNTH", "0x10", "#", "define", "MOP_EXTOUT", "0x32", "#", "define", "MOP_EXTTHRU", "0x02", "#", "define", "MOP_OUTMASK", "0x01", "#", "define", "MIP_EXTIN", "0x01", "#", "define", "MIP_SYNTH", "0x00", "#", "define", "MIP_INMASK", "0x32", "/", "*", "Classic", "SMA", "Common", "Data", "*", "/", "#", "define", "SMA_wCurrPlayBytes", "0x0000", "#", "define", "SMA_wCurrRecordBytes", "0x0002", "#", "define", "SMA_wCurrPlayVolLeft", "0x0004", "#", "define", "SMA_wCurrPlayVolRight", "0x0006", "#", "define", "SMA_wCurrInVolLeft", "0x0008", "#", "define", "SMA_wCurrInVolRight", "0x000a", "#", "define", "SMA_wUser_3", "0x000c", "#", "define", "SMA_wUser_4", "0x000e", "#", "define", "SMA_dwUser_5", "0x0010", "#", "define", "SMA_dwUser_6", "0x0014", "#", "define", "SMA_wUser_7", "0x0018", "#", "define", "SMA_wReserved_A", "0x001a", "#", "define", "SMA_wReserved_B", "0x001c", "#", "define", "SMA_wReserved_C", "0x001e", "#", "define", "SMA_wReserved_D", "0x0020", "#", "define", "SMA_wReserved_E", "0x0022", "#", "define", "SMA_wReserved_F", "0x0024", "#", "define", "SMA_wReserved_G", "0x0026", "#", "define", "SMA_wReserved_H", "0x0028", "#", "define", "SMA_wCurrDSPStatusFlags", "0x002a", "#", "define", "SMA_wCurrHostStatusFlags", "0x002c", "#", "define", "SMA_wCurrInputTagBits", "0x002e", "#", "define", "SMA_wCurrLeftPeak", "0x0030", "#", "define", "SMA_wCurrRightPeak", "0x0032", "#", "define", "SMA_wExtDSPbits", "0x0034", "#", "define", "SMA_bExtHostbits", "0x0036", "#", "define", "SMA_bBoardLevel", "0x0037", "#", "define", "SMA_bInPotPosRight", "0x0038", "#", "define", "SMA_bInPotPosLeft", "0x0039", "#", "define", "SMA_bAuxPotPosRight", "0x003a", "#", "define", "SMA_bAuxPotPosLeft", "0x003b", "#", "define", "SMA_wCurrMastVolLeft", "0x003c", "#", "define", "SMA_wCurrMastVolRight", "0x003e", "#", "define", "SMA_bUser_12", "0x0040", "#", "define", "SMA_bUser_13", "0x0041", "#", "define", "SMA_wUser_14", "0x0042", "#", "define", "SMA_wUser_15", "0x0044", "#", "define", "SMA_wCalFreqAtoD", "0x0046", "#", "define", "SMA_wUser_16", "0x0048", "#", "define", "SMA_wUser_17", "0x004a", "#", "define", "SMA__size", "0x004c", "#", "ifdef", "HAVE_DSPCODEH", "#", "include", "\"", "msndperm", ".", "c", "\"", "#", "include", "\"", "msndinit", ".", "c", "\"", "#", "define", "PERMCODE", "msndperm", "#", "define", "INITCODE", "msndinit", "#", "define", "PERMCODESIZE", "sizeof", "(", "msndperm", ")", "#", "define", "INITCODESIZE", "sizeof", "(", "msndinit", ")", "#", "else", "#", "ifndef", "CONFIG_MSNDCLAS_INIT_FILE", "#", "define", "CONFIG_MSNDCLAS_INIT_FILE", "\\", "\"", "/", "etc", "/", "sound", "/", "msndinit", ".", "bin", "\"", "#", "endif", "#", "ifndef", "CONFIG_MSNDCLAS_PERM_FILE", "#", "define", "CONFIG_MSNDCLAS_PERM_FILE", "\\", "\"", "/", "etc", "/", "sound", "/", "msndperm", ".", "bin", "\"", "#", "endif", "#", "define", "PERMCODEFILE", "CONFIG_MSNDCLAS_PERM_FILE", "#", "define", "INITCODEFILE", "CONFIG_MSNDCLAS_INIT_FILE", "#", "define", "PERMCODE", "dspini", "#", "define", "INITCODE", "permini", "#", "define", "PERMCODESIZE", "sizeof_dspini", "#", "define", "INITCODESIZE", "sizeof_permini", "#", "endif", "#", "define", "LONGNAME", "\"", "MultiSound", "(", "Classic", "/", "Monterey", "/", "Tahiti", ")", "\"", "#", "endif", "/", "*", "__MSND_CLASSIC_H", "*", "/", "@", "@", "-", "1", ",", "1941", "+", "0", ",", "0", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "Turtle", "Beach", "MultiSound", "Sound", "Card", "Driver", "for", "Linux", "*", "Linux", "2", ".", "0", "/", "2", ".", "2", "Version", "*", "*", "msnd_pinnacle", ".", "c", "/", "msnd_classic", ".", "c", "*", "*", "-", "-", "If", "MSND_CLASSIC", "is", "defined", ":", "*", "*", "-", ">", "driver", "for", "Turtle", "Beach", "Classic", "/", "Monterey", "/", "Tahiti", "*", "*", "-", "-", "Else", "*", "*", "-", ">", "driver", "for", "Turtle", "Beach", "Pinnacle", "/", "Fiji", "*", "*", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "*", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "*", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "*", "(", "at", "your", "option", ")", "any", "later", "version", ".", "*", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "*", "GNU", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "*", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "*", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "*", "*", "12", "-", "3", "-", "2000", "Modified", "IO", "port", "validation", "Steve", "Sycamore", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "include", "<", "linux", "/", "kernel", ".", "h", ">", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "types", ".", "h", ">", "#", "include", "<", "linux", "/", "delay", ".", "h", ">", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "interrupt", ".", "h", ">", "#", "include", "<", "linux", "/", "mutex", ".", "h", ">", "#", "include", "<", "linux", "/", "gfp", ".", "h", ">", "#", "include", "<", "linux", "/", "sched", "/", "signal", ".", "h", ">", "#", "include", "<", "asm", "/", "irq", ".", "h", ">", "#", "include", "<", "asm", "/", "io", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "sound_firmware", ".", "h", "\"", "#", "ifdef", "MSND_CLASSIC", "#", "ifndef", "__alpha__", "#", "define", "SLOWIO", "#", "endif", "#", "endif", "#", "include", "\"", "msnd", ".", "h", "\"", "#", "ifdef", "MSND_CLASSIC", "#", "ifdef", "CONFIG_MSNDCLAS_HAVE_BOOT", "#", "define", "HAVE_DSPCODEH", "#", "endif", "#", "include", "\"", "msnd_classic", ".", "h", "\"", "#", "define", "LOGNAME", "\"", "msnd_classic", "\"", "#", "else", "#", "ifdef", "CONFIG_MSNDPIN_HAVE_BOOT", "#", "define", "HAVE_DSPCODEH", "#", "endif", "#", "include", "\"", "msnd_pinnacle", ".", "h", "\"", "#", "define", "LOGNAME", "\"", "msnd_pinnacle", "\"", "#", "endif", "#", "ifndef", "CONFIG_MSND_WRITE_NDELAY", "#", "define", "CONFIG_MSND_WRITE_NDELAY", "1", "#", "endif", "#", "define", "get_play_delay_jiffies", "(", "size", ")", "(", "(", "size", ")", "*", "HZ", "*", "\\", "dev", ".", "play_sample_size", "/", "8", "/", "\\", "dev", ".", "play_sample_rate", "/", "\\", "dev", ".", "play_channels", ")", "#", "define", "get_rec_delay_jiffies", "(", "size", ")", "(", "(", "size", ")", "*", "HZ", "*", "\\", "dev", ".", "rec_sample_size", "/", "8", "/", "\\", "dev", ".", "rec_sample_rate", "/", "\\", "dev", ".", "rec_channels", ")", "static", "DEFINE_MUTEX", "(", "msnd_pinnacle_mutex", ")", ";", "static", "multisound_dev_t", "dev", ";", "#", "ifndef", "HAVE_DSPCODEH", "static", "char", "*", "dspini", ",", "*", "permini", ";", "static", "int", "sizeof_dspini", ",", "sizeof_permini", ";", "#", "endif", "static", "int", "dsp_full_reset", "(", "void", ")", ";", "static", "void", "dsp_write_flush", "(", "void", ")", ";", "static", "__inline__", "int", "chk_send_dsp_cmd", "(", "multisound_dev_t", "*", "dev", ",", "register", "BYTE", "cmd", ")", "{", "if", "(", "msnd_send_dsp_cmd", "(", "dev", ",", "cmd", ")", "=", "=", "0", ")", "return", "0", ";", "dsp_full_reset", "(", ");", "return", "msnd_send_dsp_cmd", "(", "dev", ",", "cmd", ")", ";", "}", "static", "void", "reset_play_queue", "(", "void", ")", "{", "int", "n", ";", "LPDAQD", "lpDAQ", ";", "dev", ".", "last_playbank", "=", "-", "1", ";", "writew", "(", "PCTODSP_OFFSET", "(", "0", "*", "DAQDS__size", ")", ",", "dev", ".", "DAPQ", "+", "JQS_wHead", ")", ";", "writew", "(", "PCTODSP_OFFSET", "(", "0", "*", "DAQDS__size", ")", ",", "dev", ".", "DAPQ", "+", "JQS_wTail", ")", ";", "for", "(", "n", "=", "0", ",", "lpDAQ", "=", "dev", ".", "base", "+", "DAPQ_DATA_BUFF", ";", "n", "<", "3", ";", "+", "+", "n", ",", "lpDAQ", "+", "=", "DAQDS__size", ")", "{", "writew", "(", "PCTODSP_BASED", "(", "(", "DWORD", ")", "(", "DAP_BUFF_SIZE", "*", "n", ")", "),", "lpDAQ", "+", "DAQDS_wStart", ")", ";", "writew", "(", "0", ",", "lpDAQ", "+", "DAQDS_wSize", ")", ";", "writew", "(", "1", ",", "lpDAQ", "+", "DAQDS_wFormat", ")", ";", "writew", "(", "dev", ".", "play_sample_size", ",", "lpDAQ", "+", "DAQDS_wSampleSize", ")", ";", "writew", "(", "dev", ".", "play_channels", ",", "lpDAQ", "+", "DAQDS_wChannels", ")", ";", "writew", "(", "dev", ".", "play_sample_rate", ",", "lpDAQ", "+", "DAQDS_wSampleRate", ")", ";", "writew", "(", "HIMT_PLAY_DONE", "*", "0x100", "+", "n", ",", "lpDAQ", "+", "DAQDS_wIntMsg", ")", ";", "writew", "(", "n", ",", "lpDAQ", "+", "DAQDS_wFlags", ")", ";", "}", "}", "static", "void", "reset_record_queue", "(", "void", ")", "{", "int", "n", ";", "LPDAQD", "lpDAQ", ";", "unsigned", "long", "flags", ";", "dev", ".", "last_recbank", "=", "2", ";", "writew", "(", "PCTODSP_OFFSET", "(", "0", "*", "DAQDS__size", ")", ",", "dev", ".", "DARQ", "+", "JQS_wHead", ")", ";", "writew", "(", "PCTODSP_OFFSET", "(", "dev", ".", "last_recbank", "*", "DAQDS__size", ")", ",", "dev", ".", "DARQ", "+", "JQS_wTail", ")", ";", "/", "*", "Critical", "section", ":", "bank", "1", "access", "*", "/", "spin_lock_irqsave", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "msnd_outb", "(", "HPBLKSEL_1", ",", "dev", ".", "io", "+", "HP_BLKS", ")", ";", "memset_io", "(", "dev", ".", "base", ",", "0", ",", "DAR_BUFF_SIZE", "*", "3", ")", ";", "msnd_outb", "(", "HPBLKSEL_0", ",", "dev", ".", "io", "+", "HP_BLKS", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "for", "(", "n", "=", "0", ",", "lpDAQ", "=", "dev", ".", "base", "+", "DARQ_DATA_BUFF", ";", "n", "<", "3", ";", "+", "+", "n", ",", "lpDAQ", "+", "=", "DAQDS__size", ")", "{", "writew", "(", "PCTODSP_BASED", "(", "(", "DWORD", ")", "(", "DAR_BUFF_SIZE", "*", "n", ")", ")", "+", "0x4000", ",", "lpDAQ", "+", "DAQDS_wStart", ")", ";", "writew", "(", "DAR_BUFF_SIZE", ",", "lpDAQ", "+", "DAQDS_wSize", ")", ";", "writew", "(", "1", ",", "lpDAQ", "+", "DAQDS_wFormat", ")", ";", "writew", "(", "dev", ".", "rec_sample_size", ",", "lpDAQ", "+", "DAQDS_wSampleSize", ")", ";", "writew", "(", "dev", ".", "rec_channels", ",", "lpDAQ", "+", "DAQDS_wChannels", ")", ";", "writew", "(", "dev", ".", "rec_sample_rate", ",", "lpDAQ", "+", "DAQDS_wSampleRate", ")", ";", "writew", "(", "HIMT_RECORD_DONE", "*", "0x100", "+", "n", ",", "lpDAQ", "+", "DAQDS_wIntMsg", ")", ";", "writew", "(", "n", ",", "lpDAQ", "+", "DAQDS_wFlags", ")", ";", "}", "}", "static", "void", "reset_queues", "(", "void", ")", "{", "if", "(", "dev", ".", "mode", "&", "FMODE_WRITE", ")", "{", "msnd_fifo_make_empty", "(", "&", "dev", ".", "DAPF", ")", ";", "reset_play_queue", "(", ");", "}", "if", "(", "dev", ".", "mode", "&", "FMODE_READ", ")", "{", "msnd_fifo_make_empty", "(", "&", "dev", ".", "DARF", ")", ";", "reset_record_queue", "(", ");", "}", "}", "static", "int", "dsp_set_format", "(", "struct", "file", "*", "file", ",", "int", "val", ")", "{", "int", "data", ",", "i", ";", "LPDAQD", "lpDAQ", ",", "lpDARQ", ";", "lpDAQ", "=", "dev", ".", "base", "+", "DAPQ_DATA_BUFF", ";", "lpDARQ", "=", "dev", ".", "base", "+", "DARQ_DATA_BUFF", ";", "switch", "(", "val", ")", "{", "case", "AFMT_U8", ":", "case", "AFMT_S16_LE", ":", "data", "=", "val", ";", "break", ";", "default", ":", "data", "=", "DEFSAMPLESIZE", ";", "break", ";", "}", "for", "(", "i", "=", "0", ";", "i", "<", "3", ";", "+", "+", "i", ",", "lpDAQ", "+", "=", "DAQDS__size", ",", "lpDARQ", "+", "=", "DAQDS__size", ")", "{", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "writew", "(", "data", ",", "lpDAQ", "+", "DAQDS_wSampleSize", ")", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", "writew", "(", "data", ",", "lpDARQ", "+", "DAQDS_wSampleSize", ")", ";", "}", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "dev", ".", "play_sample_size", "=", "data", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", "dev", ".", "rec_sample_size", "=", "data", ";", "return", "data", ";", "}", "static", "int", "dsp_get_frag_size", "(", "void", ")", "{", "int", "size", ";", "size", "=", "dev", ".", "fifosize", "/", "4", ";", "if", "(", "size", ">", "32", "*", "1024", ")", "size", "=", "32", "*", "1024", ";", "return", "size", ";", "}", "static", "int", "dsp_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "{", "int", "val", ",", "i", ",", "data", ",", "tmp", ";", "LPDAQD", "lpDAQ", ",", "lpDARQ", ";", "audio_buf_info", "abinfo", ";", "unsigned", "long", "flags", ";", "int", "__user", "*", "p", "=", "(", "int", "__user", "*", ")", "arg", ";", "lpDAQ", "=", "dev", ".", "base", "+", "DAPQ_DATA_BUFF", ";", "lpDARQ", "=", "dev", ".", "base", "+", "DARQ_DATA_BUFF", ";", "switch", "(", "cmd", ")", "{", "case", "SNDCTL_DSP_SUBDIVIDE", ":", "case", "SNDCTL_DSP_SETFRAGMENT", ":", "case", "SNDCTL_DSP_SETDUPLEX", ":", "case", "SNDCTL_DSP_POST", ":", "return", "0", ";", "case", "SNDCTL_DSP_GETIPTR", ":", "case", "SNDCTL_DSP_GETOPTR", ":", "case", "SNDCTL_DSP_MAPINBUF", ":", "case", "SNDCTL_DSP_MAPOUTBUF", ":", "return", "-", "EINVAL", ";", "case", "SNDCTL_DSP_GETOSPACE", ":", "if", "(", "!(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", ")", "return", "-", "EINVAL", ";", "spin_lock_irqsave", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "abinfo", ".", "fragsize", "=", "dsp_get_frag_size", "(", ");", "abinfo", ".", "bytes", "=", "dev", ".", "DAPF", ".", "n", "-", "dev", ".", "DAPF", ".", "len", ";", "abinfo", ".", "fragstotal", "=", "dev", ".", "DAPF", ".", "n", "/", "abinfo", ".", "fragsize", ";", "abinfo", ".", "fragments", "=", "abinfo", ".", "bytes", "/", "abinfo", ".", "fragsize", ";", "spin_unlock_irqrestore", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "return", "copy_to_user", "(", "(", "void", "__user", "*", ")", "arg", ",", "&", "abinfo", ",", "sizeof", "(", "abinfo", ")", ")", "?", "-", "EFAULT", ":", "0", ";", "case", "SNDCTL_DSP_GETISPACE", ":", "if", "(", "!(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", ")", "return", "-", "EINVAL", ";", "spin_lock_irqsave", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "abinfo", ".", "fragsize", "=", "dsp_get_frag_size", "(", ");", "abinfo", ".", "bytes", "=", "dev", ".", "DARF", ".", "n", "-", "dev", ".", "DARF", ".", "len", ";", "abinfo", ".", "fragstotal", "=", "dev", ".", "DARF", ".", "n", "/", "abinfo", ".", "fragsize", ";", "abinfo", ".", "fragments", "=", "abinfo", ".", "bytes", "/", "abinfo", ".", "fragsize", ";", "spin_unlock_irqrestore", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "return", "copy_to_user", "(", "(", "void", "__user", "*", ")", "arg", ",", "&", "abinfo", ",", "sizeof", "(", "abinfo", ")", ")", "?", "-", "EFAULT", ":", "0", ";", "case", "SNDCTL_DSP_RESET", ":", "dev", ".", "nresets", "=", "0", ";", "reset_queues", "(", ");", "return", "0", ";", "case", "SNDCTL_DSP_SYNC", ":", "dsp_write_flush", "(", ");", "return", "0", ";", "case", "SNDCTL_DSP_GETBLKSIZE", ":", "tmp", "=", "dsp_get_frag_size", "(", ");", "if", "(", "put_user", "(", "tmp", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETFMTS", ":", "val", "=", "AFMT_S16_LE", "|", "AFMT_U8", ";", "if", "(", "put_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_DSP_SETFMT", ":", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "data", "=", "val", "=", "=", "AFMT_QUERY", "?", "dev", ".", "play_sample_size", ":", "dsp_set_format", "(", "file", ",", "val", ")", ";", "else", "data", "=", "val", "=", "=", "AFMT_QUERY", "?", "dev", ".", "rec_sample_size", ":", "dsp_set_format", "(", "file", ",", "val", ")", ";", "if", "(", "put_user", "(", "data", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_DSP_NONBLOCK", ":", "if", "(", "!", "test_bit", "(", "F_DISABLE_WRITE_NDELAY", ",", "&", "dev", ".", "flags", ")", "&", "&", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "dev", ".", "play_ndelay", "=", "1", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", "dev", ".", "rec_ndelay", "=", "1", ";", "return", "0", ";", "case", "SNDCTL_DSP_GETCAPS", ":", "val", "=", "DSP_CAP_DUPLEX", "|", "DSP_CAP_BATCH", ";", "if", "(", "put_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_DSP_SPEED", ":", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "val", "<", "8000", ")", "val", "=", "8000", ";", "if", "(", "val", ">", "48000", ")", "val", "=", "48000", ";", "data", "=", "val", ";", "for", "(", "i", "=", "0", ";", "i", "<", "3", ";", "+", "+", "i", ",", "lpDAQ", "+", "=", "DAQDS__size", ",", "lpDARQ", "+", "=", "DAQDS__size", ")", "{", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "writew", "(", "data", ",", "lpDAQ", "+", "DAQDS_wSampleRate", ")", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", "writew", "(", "data", ",", "lpDARQ", "+", "DAQDS_wSampleRate", ")", ";", "}", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "dev", ".", "play_sample_rate", "=", "data", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", "dev", ".", "rec_sample_rate", "=", "data", ";", "if", "(", "put_user", "(", "data", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_DSP_CHANNELS", ":", "case", "SNDCTL_DSP_STEREO", ":", "if", "(", "get_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "cmd", "=", "=", "SNDCTL_DSP_CHANNELS", ")", "{", "switch", "(", "val", ")", "{", "case", "1", ":", "case", "2", ":", "data", "=", "val", ";", "break", ";", "default", ":", "val", "=", "data", "=", "2", ";", "break", ";", "}", "}", "else", "{", "switch", "(", "val", ")", "{", "case", "0", ":", "data", "=", "1", ";", "break", ";", "default", ":", "val", "=", "1", ";", "case", "1", ":", "data", "=", "2", ";", "break", ";", "}", "}", "for", "(", "i", "=", "0", ";", "i", "<", "3", ";", "+", "+", "i", ",", "lpDAQ", "+", "=", "DAQDS__size", ",", "lpDARQ", "+", "=", "DAQDS__size", ")", "{", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "writew", "(", "data", ",", "lpDAQ", "+", "DAQDS_wChannels", ")", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", "writew", "(", "data", ",", "lpDARQ", "+", "DAQDS_wChannels", ")", ";", "}", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "dev", ".", "play_channels", "=", "data", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", "dev", ".", "rec_channels", "=", "data", ";", "if", "(", "put_user", "(", "val", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "return", "-", "EINVAL", ";", "}", "static", "int", "mixer_get", "(", "int", "d", ")", "{", "if", "(", "d", ">", "31", ")", "return", "-", "EINVAL", ";", "switch", "(", "d", ")", "{", "case", "SOUND_MIXER_VOLUME", ":", "case", "SOUND_MIXER_PCM", ":", "case", "SOUND_MIXER_LINE", ":", "case", "SOUND_MIXER_IMIX", ":", "case", "SOUND_MIXER_LINE1", ":", "#", "ifndef", "MSND_CLASSIC", "case", "SOUND_MIXER_MIC", ":", "case", "SOUND_MIXER_SYNTH", ":", "#", "endif", "return", "(", "dev", ".", "left_levels", "[", "d", "]", ">", ">", "8", ")", "*", "100", "/", "0xff", "|", "(", "((", "dev", ".", "right_levels", "[", "d", "]", ">", ">", "8", ")", "*", "100", "/", "0xff", ")", "<", "<", "8", ")", ";", "default", ":", "return", "0", ";", "}", "}", "#", "define", "update_volm", "(", "a", ",", "b", ")", "\\", "writew", "(", "(", "dev", ".", "left_levels", "[", "a", "]", ">", ">", "1", ")", "*", "\\", "readw", "(", "dev", ".", "SMA", "+", "SMA_wCurrMastVolLeft", ")", "/", "0xffff", ",", "\\", "dev", ".", "SMA", "+", "SMA_", "#", "#", "b", "#", "#", "Left", ")", ";", "\\", "writew", "(", "(", "dev", ".", "right_levels", "[", "a", "]", ">", ">", "1", ")", "*", "\\", "readw", "(", "dev", ".", "SMA", "+", "SMA_wCurrMastVolRight", ")", "/", "0xffff", ",", "\\", "dev", ".", "SMA", "+", "SMA_", "#", "#", "b", "#", "#", "Right", ")", ";", "#", "define", "update_potm", "(", "d", ",", "s", ",", "ar", ")", "\\", "writeb", "(", "(", "dev", ".", "left_levels", "[", "d", "]", ">", ">", "8", ")", "*", "\\", "readw", "(", "dev", ".", "SMA", "+", "SMA_wCurrMastVolLeft", ")", "/", "0xffff", ",", "\\", "dev", ".", "SMA", "+", "SMA_", "#", "#", "s", "#", "#", "Left", ")", ";", "\\", "writeb", "(", "(", "dev", ".", "right_levels", "[", "d", "]", ">", ">", "8", ")", "*", "\\", "readw", "(", "dev", ".", "SMA", "+", "SMA_wCurrMastVolRight", ")", "/", "0xffff", ",", "\\", "dev", ".", "SMA", "+", "SMA_", "#", "#", "s", "#", "#", "Right", ")", ";", "\\", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "ar", ")", "=", "=", "0", ")", "\\", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", ";", "#", "define", "update_pot", "(", "d", ",", "s", ",", "ar", ")", "\\", "writeb", "(", "dev", ".", "left_levels", "[", "d", "]", ">", ">", "8", ",", "\\", "dev", ".", "SMA", "+", "SMA_", "#", "#", "s", "#", "#", "Left", ")", ";", "\\", "writeb", "(", "dev", ".", "right_levels", "[", "d", "]", ">", ">", "8", ",", "\\", "dev", ".", "SMA", "+", "SMA_", "#", "#", "s", "#", "#", "Right", ")", ";", "\\", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "ar", ")", "=", "=", "0", ")", "\\", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", ";", "static", "int", "mixer_set", "(", "int", "d", ",", "int", "value", ")", "{", "int", "left", "=", "value", "&", "0x000000ff", ";", "int", "right", "=", "(", "value", "&", "0x0000ff00", ")", ">", ">", "8", ";", "int", "bLeft", ",", "bRight", ";", "int", "wLeft", ",", "wRight", ";", "int", "updatemaster", "=", "0", ";", "if", "(", "d", ">", "31", ")", "return", "-", "EINVAL", ";", "bLeft", "=", "left", "*", "0xff", "/", "100", ";", "wLeft", "=", "left", "*", "0xffff", "/", "100", ";", "bRight", "=", "right", "*", "0xff", "/", "100", ";", "wRight", "=", "right", "*", "0xffff", "/", "100", ";", "dev", ".", "left_levels", "[", "d", "]", "=", "wLeft", ";", "dev", ".", "right_levels", "[", "d", "]", "=", "wRight", ";", "switch", "(", "d", ")", "{", "/", "*", "master", "volume", "unscaled", "controls", "*", "/", "case", "SOUND_MIXER_LINE", ":", "/", "*", "line", "pot", "control", "*", "/", "/", "*", "scaled", "by", "IMIX", "in", "digital", "mix", "*", "/", "writeb", "(", "bLeft", ",", "dev", ".", "SMA", "+", "SMA_bInPotPosLeft", ")", ";", "writeb", "(", "bRight", ",", "dev", ".", "SMA", "+", "SMA_bInPotPosRight", ")", ";", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "HDEXAR_IN_SET_POTS", ")", "=", "=", "0", ")", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", ";", "break", ";", "#", "ifndef", "MSND_CLASSIC", "case", "SOUND_MIXER_MIC", ":", "/", "*", "mic", "pot", "control", "*", "/", "/", "*", "scaled", "by", "IMIX", "in", "digital", "mix", "*", "/", "writeb", "(", "bLeft", ",", "dev", ".", "SMA", "+", "SMA_bMicPotPosLeft", ")", ";", "writeb", "(", "bRight", ",", "dev", ".", "SMA", "+", "SMA_bMicPotPosRight", ")", ";", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "HDEXAR_MIC_SET_POTS", ")", "=", "=", "0", ")", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", ";", "break", ";", "#", "endif", "case", "SOUND_MIXER_VOLUME", ":", "/", "*", "master", "volume", "*", "/", "writew", "(", "wLeft", ",", "dev", ".", "SMA", "+", "SMA_wCurrMastVolLeft", ")", ";", "writew", "(", "wRight", ",", "dev", ".", "SMA", "+", "SMA_wCurrMastVolRight", ")", ";", "/", "*", "fall", "through", "*", "/", "case", "SOUND_MIXER_LINE1", ":", "/", "*", "aux", "pot", "control", "*", "/", "/", "*", "scaled", "by", "master", "volume", "*", "/", "/", "*", "fall", "through", "*", "/", "/", "*", "digital", "controls", "*", "/", "case", "SOUND_MIXER_SYNTH", ":", "/", "*", "synth", "vol", "(", "dsp", "mix", ")", "*", "/", "case", "SOUND_MIXER_PCM", ":", "/", "*", "pcm", "vol", "(", "dsp", "mix", ")", "*", "/", "case", "SOUND_MIXER_IMIX", ":", "/", "*", "input", "monitor", "(", "dsp", "mix", ")", "*", "/", "/", "*", "scaled", "by", "master", "volume", "*", "/", "updatemaster", "=", "1", ";", "break", ";", "default", ":", "return", "0", ";", "}", "if", "(", "updatemaster", ")", "{", "/", "*", "update", "master", "volume", "scaled", "controls", "*", "/", "update_volm", "(", "SOUND_MIXER_PCM", ",", "wCurrPlayVol", ")", ";", "update_volm", "(", "SOUND_MIXER_IMIX", ",", "wCurrInVol", ")", ";", "#", "ifndef", "MSND_CLASSIC", "update_volm", "(", "SOUND_MIXER_SYNTH", ",", "wCurrMHdrVol", ")", ";", "#", "endif", "update_potm", "(", "SOUND_MIXER_LINE1", ",", "bAuxPotPos", ",", "HDEXAR_AUX_SET_POTS", ")", ";", "}", "return", "mixer_get", "(", "d", ")", ";", "}", "static", "void", "mixer_setup", "(", "void", ")", "{", "update_pot", "(", "SOUND_MIXER_LINE", ",", "bInPotPos", ",", "HDEXAR_IN_SET_POTS", ")", ";", "update_potm", "(", "SOUND_MIXER_LINE1", ",", "bAuxPotPos", ",", "HDEXAR_AUX_SET_POTS", ")", ";", "update_volm", "(", "SOUND_MIXER_PCM", ",", "wCurrPlayVol", ")", ";", "update_volm", "(", "SOUND_MIXER_IMIX", ",", "wCurrInVol", ")", ";", "#", "ifndef", "MSND_CLASSIC", "update_pot", "(", "SOUND_MIXER_MIC", ",", "bMicPotPos", ",", "HDEXAR_MIC_SET_POTS", ")", ";", "update_volm", "(", "SOUND_MIXER_SYNTH", ",", "wCurrMHdrVol", ")", ";", "#", "endif", "}", "static", "unsigned", "long", "set_recsrc", "(", "unsigned", "long", "recsrc", ")", "{", "if", "(", "dev", ".", "recsrc", "=", "=", "recsrc", ")", "return", "dev", ".", "recsrc", ";", "#", "ifdef", "HAVE_NORECSRC", "else", "if", "(", "recsrc", "=", "=", "0", ")", "dev", ".", "recsrc", "=", "0", ";", "#", "endif", "else", "dev", ".", "recsrc", "^", "=", "recsrc", ";", "#", "ifndef", "MSND_CLASSIC", "if", "(", "dev", ".", "recsrc", "&", "SOUND_MASK_IMIX", ")", "{", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "HDEXAR_SET_ANA_IN", ")", "=", "=", "0", ")", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", ";", "}", "else", "if", "(", "dev", ".", "recsrc", "&", "SOUND_MASK_SYNTH", ")", "{", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "HDEXAR_SET_SYNTH_IN", ")", "=", "=", "0", ")", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", ";", "}", "else", "if", "(", "(", "dev", ".", "recsrc", "&", "SOUND_MASK_DIGITAL1", ")", "&", "&", "test_bit", "(", "F_HAVEDIGITAL", ",", "&", "dev", ".", "flags", ")", ")", "{", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "HDEXAR_SET_DAT_IN", ")", "=", "=", "0", ")", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", ";", "}", "else", "{", "#", "ifdef", "HAVE_NORECSRC", "/", "*", "Select", "no", "input", "(", "?)", "*", "/", "dev", ".", "recsrc", "=", "0", ";", "#", "else", "dev", ".", "recsrc", "=", "SOUND_MASK_IMIX", ";", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "HDEXAR_SET_ANA_IN", ")", "=", "=", "0", ")", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", ";", "#", "endif", "}", "#", "endif", "/", "*", "MSND_CLASSIC", "*", "/", "return", "dev", ".", "recsrc", ";", "}", "static", "unsigned", "long", "force_recsrc", "(", "unsigned", "long", "recsrc", ")", "{", "dev", ".", "recsrc", "=", "0", ";", "return", "set_recsrc", "(", "recsrc", ")", ";", "}", "#", "define", "set_mixer_info", "(", ")", "\\", "memset", "(", "&", "info", ",", "0", ",", "sizeof", "(", "info", ")", ");", "\\", "strlcpy", "(", "info", ".", "id", ",", "\"", "MSNDMIXER", "\"", ",", "sizeof", "(", "info", ".", "id", ")", ");", "\\", "strlcpy", "(", "info", ".", "name", ",", "\"", "MultiSound", "Mixer", "\"", ",", "sizeof", "(", "info", ".", "name", ")", ");", "static", "int", "mixer_ioctl", "(", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "{", "if", "(", "cmd", "=", "=", "SOUND_MIXER_INFO", ")", "{", "mixer_info", "info", ";", "set_mixer_info", "(", ");", "info", ".", "modify_counter", "=", "dev", ".", "mixer_mod_count", ";", "if", "(", "copy_to_user", "(", "(", "void", "__user", "*", ")", "arg", ",", "&", "info", ",", "sizeof", "(", "info", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "else", "if", "(", "cmd", "=", "=", "SOUND_OLD_MIXER_INFO", ")", "{", "_old_mixer_info", "info", ";", "set_mixer_info", "(", ");", "if", "(", "copy_to_user", "(", "(", "void", "__user", "*", ")", "arg", ",", "&", "info", ",", "sizeof", "(", "info", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "}", "else", "if", "(", "cmd", "=", "=", "SOUND_MIXER_PRIVATE1", ")", "{", "dev", ".", "nresets", "=", "0", ";", "dsp_full_reset", "(", ");", "return", "0", ";", "}", "else", "if", "(", "((", "cmd", ">", ">", "8", ")", "&", "0xff", ")", "=", "=", "'", "M", "'", ")", "{", "int", "val", "=", "0", ";", "if", "(", "_SIOC_DIR", "(", "cmd", ")", "&", "_SIOC_WRITE", ")", "{", "switch", "(", "cmd", "&", "0xff", ")", "{", "case", "SOUND_MIXER_RECSRC", ":", "if", "(", "get_user", "(", "val", ",", "(", "int", "__user", "*", ")", "arg", ")", ")", "return", "-", "EFAULT", ";", "val", "=", "set_recsrc", "(", "val", ")", ";", "break", ";", "default", ":", "if", "(", "get_user", "(", "val", ",", "(", "int", "__user", "*", ")", "arg", ")", ")", "return", "-", "EFAULT", ";", "val", "=", "mixer_set", "(", "cmd", "&", "0xff", ",", "val", ")", ";", "break", ";", "}", "+", "+", "dev", ".", "mixer_mod_count", ";", "return", "put_user", "(", "val", ",", "(", "int", "__user", "*", ")", "arg", ")", ";", "}", "else", "{", "switch", "(", "cmd", "&", "0xff", ")", "{", "case", "SOUND_MIXER_RECSRC", ":", "val", "=", "dev", ".", "recsrc", ";", "break", ";", "case", "SOUND_MIXER_DEVMASK", ":", "case", "SOUND_MIXER_STEREODEVS", ":", "val", "=", "SOUND_MASK_PCM", "|", "SOUND_MASK_LINE", "|", "SOUND_MASK_IMIX", "|", "SOUND_MASK_LINE1", "|", "#", "ifndef", "MSND_CLASSIC", "SOUND_MASK_MIC", "|", "SOUND_MASK_SYNTH", "|", "#", "endif", "SOUND_MASK_VOLUME", ";", "break", ";", "case", "SOUND_MIXER_RECMASK", ":", "#", "ifdef", "MSND_CLASSIC", "val", "=", "0", ";", "#", "else", "val", "=", "SOUND_MASK_IMIX", "|", "SOUND_MASK_SYNTH", ";", "if", "(", "test_bit", "(", "F_HAVEDIGITAL", ",", "&", "dev", ".", "flags", ")", ")", "val", "|", "=", "SOUND_MASK_DIGITAL1", ";", "#", "endif", "break", ";", "case", "SOUND_MIXER_CAPS", ":", "val", "=", "SOUND_CAP_EXCL_INPUT", ";", "break", ";", "default", ":", "if", "(", "(", "val", "=", "mixer_get", "(", "cmd", "&", "0xff", ")", ")", "<", "0", ")", "return", "-", "EINVAL", ";", "break", ";", "}", "}", "return", "put_user", "(", "val", ",", "(", "int", "__user", "*", ")", "arg", ")", ";", "}", "return", "-", "EINVAL", ";", "}", "static", "long", "dev_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ")", "{", "int", "minor", "=", "iminor", "(", "file_inode", "(", "file", ")", ");", "int", "ret", ";", "if", "(", "cmd", "=", "=", "OSS_GETVERSION", ")", "{", "int", "sound_version", "=", "SOUND_VERSION", ";", "return", "put_user", "(", "sound_version", ",", "(", "int", "__user", "*", ")", "arg", ")", ";", "}", "ret", "=", "-", "EINVAL", ";", "mutex_lock", "(", "&", "msnd_pinnacle_mutex", ")", ";", "if", "(", "minor", "=", "=", "dev", ".", "dsp_minor", ")", "ret", "=", "dsp_ioctl", "(", "file", ",", "cmd", ",", "arg", ")", ";", "else", "if", "(", "minor", "=", "=", "dev", ".", "mixer_minor", ")", "ret", "=", "mixer_ioctl", "(", "cmd", ",", "arg", ")", ";", "mutex_unlock", "(", "&", "msnd_pinnacle_mutex", ")", ";", "return", "ret", ";", "}", "static", "void", "dsp_write_flush", "(", "void", ")", "{", "int", "timeout", "=", "get_play_delay_jiffies", "(", "dev", ".", "DAPF", ".", "len", ")", ";", "if", "(", "!(", "dev", ".", "mode", "&", "FMODE_WRITE", ")", "|", "|", "!", "test_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", ")", "return", ";", "set_bit", "(", "F_WRITEFLUSH", ",", "&", "dev", ".", "flags", ")", ";", "wait_event_interruptible_timeout", "(", "dev", ".", "writeflush", ",", "!", "test_bit", "(", "F_WRITEFLUSH", ",", "&", "dev", ".", "flags", ")", ",", "timeout", ")", ";", "clear_bit", "(", "F_WRITEFLUSH", ",", "&", "dev", ".", "flags", ")", ";", "if", "(", "!", "signal_pending", "(", "current", ")", ")", "{", "__set_current_state", "(", "TASK_INTERRUPTIBLE", ")", ";", "schedule_timeout", "(", "get_play_delay_jiffies", "(", "DAP_BUFF_SIZE", ")", ");", "}", "clear_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", ";", "}", "static", "void", "dsp_halt", "(", "struct", "file", "*", "file", ")", "{", "if", "(", "(", "file", "?", "file", "-", ">", "f_mode", ":", "dev", ".", "mode", ")", "&", "FMODE_READ", ")", "{", "clear_bit", "(", "F_READING", ",", "&", "dev", ".", "flags", ")", ";", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_RECORD_STOP", ")", ";", "msnd_disable_irq", "(", "&", "dev", ")", ";", "if", "(", "file", ")", "{", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Stopping", "read", "for", "%", "p", "\\", "n", "\"", ",", "file", ")", ";", "dev", ".", "mode", "&", "=", "~", "FMODE_READ", ";", "}", "clear_bit", "(", "F_AUDIO_READ_INUSE", ",", "&", "dev", ".", "flags", ")", ";", "}", "if", "(", "(", "file", "?", "file", "-", ">", "f_mode", ":", "dev", ".", "mode", ")", "&", "FMODE_WRITE", ")", "{", "if", "(", "test_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", ")", "{", "dsp_write_flush", "(", ");", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_PLAY_STOP", ")", ";", "}", "msnd_disable_irq", "(", "&", "dev", ")", ";", "if", "(", "file", ")", "{", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Stopping", "write", "for", "%", "p", "\\", "n", "\"", ",", "file", ")", ";", "dev", ".", "mode", "&", "=", "~", "FMODE_WRITE", ";", "}", "clear_bit", "(", "F_AUDIO_WRITE_INUSE", ",", "&", "dev", ".", "flags", ")", ";", "}", "}", "static", "int", "dsp_release", "(", "struct", "file", "*", "file", ")", "{", "dsp_halt", "(", "file", ")", ";", "return", "0", ";", "}", "static", "int", "dsp_open", "(", "struct", "file", "*", "file", ")", "{", "if", "(", "(", "file", "?", "file", "-", ">", "f_mode", ":", "dev", ".", "mode", ")", "&", "FMODE_WRITE", ")", "{", "set_bit", "(", "F_AUDIO_WRITE_INUSE", ",", "&", "dev", ".", "flags", ")", ";", "clear_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", ";", "msnd_fifo_make_empty", "(", "&", "dev", ".", "DAPF", ")", ";", "reset_play_queue", "(", ");", "if", "(", "file", ")", "{", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Starting", "write", "for", "%", "p", "\\", "n", "\"", ",", "file", ")", ";", "dev", ".", "mode", "|", "=", "FMODE_WRITE", ";", "}", "msnd_enable_irq", "(", "&", "dev", ")", ";", "}", "if", "(", "(", "file", "?", "file", "-", ">", "f_mode", ":", "dev", ".", "mode", ")", "&", "FMODE_READ", ")", "{", "set_bit", "(", "F_AUDIO_READ_INUSE", ",", "&", "dev", ".", "flags", ")", ";", "clear_bit", "(", "F_READING", ",", "&", "dev", ".", "flags", ")", ";", "msnd_fifo_make_empty", "(", "&", "dev", ".", "DARF", ")", ";", "reset_record_queue", "(", ");", "if", "(", "file", ")", "{", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Starting", "read", "for", "%", "p", "\\", "n", "\"", ",", "file", ")", ";", "dev", ".", "mode", "|", "=", "FMODE_READ", ";", "}", "msnd_enable_irq", "(", "&", "dev", ")", ";", "}", "return", "0", ";", "}", "static", "void", "set_default_play_audio_parameters", "(", "void", ")", "{", "dev", ".", "play_sample_size", "=", "DEFSAMPLESIZE", ";", "dev", ".", "play_sample_rate", "=", "DEFSAMPLERATE", ";", "dev", ".", "play_channels", "=", "DEFCHANNELS", ";", "}", "static", "void", "set_default_rec_audio_parameters", "(", "void", ")", "{", "dev", ".", "rec_sample_size", "=", "DEFSAMPLESIZE", ";", "dev", ".", "rec_sample_rate", "=", "DEFSAMPLERATE", ";", "dev", ".", "rec_channels", "=", "DEFCHANNELS", ";", "}", "static", "void", "set_default_audio_parameters", "(", "void", ")", "{", "set_default_play_audio_parameters", "(", ");", "set_default_rec_audio_parameters", "(", ");", "}", "static", "int", "dev_open", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")", "{", "int", "minor", "=", "iminor", "(", "inode", ")", ";", "int", "err", "=", "0", ";", "mutex_lock", "(", "&", "msnd_pinnacle_mutex", ")", ";", "if", "(", "minor", "=", "=", "dev", ".", "dsp_minor", ")", "{", "if", "(", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", "&", "&", "test_bit", "(", "F_AUDIO_WRITE_INUSE", ",", "&", "dev", ".", "flags", ")", ")", "|", "|", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", "&", "&", "test_bit", "(", "F_AUDIO_READ_INUSE", ",", "&", "dev", ".", "flags", ")", "))", "{", "err", "=", "-", "EBUSY", ";", "goto", "out", ";", "}", "if", "(", "(", "err", "=", "dsp_open", "(", "file", ")", ")", ">", "=", "0", ")", "{", "dev", ".", "nresets", "=", "0", ";", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_WRITE", ")", "{", "set_default_play_audio_parameters", "(", ");", "if", "(", "!", "test_bit", "(", "F_DISABLE_WRITE_NDELAY", ",", "&", "dev", ".", "flags", ")", ")", "dev", ".", "play_ndelay", "=", "(", "file", "-", ">", "f_flags", "&", "O_NDELAY", ")", "?", "1", ":", "0", ";", "else", "dev", ".", "play_ndelay", "=", "0", ";", "}", "if", "(", "file", "-", ">", "f_mode", "&", "FMODE_READ", ")", "{", "set_default_rec_audio_parameters", "(", ");", "dev", ".", "rec_ndelay", "=", "(", "file", "-", ">", "f_flags", "&", "O_NDELAY", ")", "?", "1", ":", "0", ";", "}", "}", "}", "else", "if", "(", "minor", "=", "=", "dev", ".", "mixer_minor", ")", "{", "/", "*", "nothing", "*", "/", "}", "else", "err", "=", "-", "EINVAL", ";", "out", ":", "mutex_unlock", "(", "&", "msnd_pinnacle_mutex", ")", ";", "return", "err", ";", "}", "static", "int", "dev_release", "(", "struct", "inode", "*", "inode", ",", "struct", "file", "*", "file", ")", "{", "int", "minor", "=", "iminor", "(", "inode", ")", ";", "int", "err", "=", "0", ";", "mutex_lock", "(", "&", "msnd_pinnacle_mutex", ")", ";", "if", "(", "minor", "=", "=", "dev", ".", "dsp_minor", ")", "err", "=", "dsp_release", "(", "file", ")", ";", "else", "if", "(", "minor", "=", "=", "dev", ".", "mixer_minor", ")", "{", "/", "*", "nothing", "*", "/", "}", "else", "err", "=", "-", "EINVAL", ";", "mutex_unlock", "(", "&", "msnd_pinnacle_mutex", ")", ";", "return", "err", ";", "}", "static", "__inline__", "int", "pack_DARQ_to_DARF", "(", "register", "int", "bank", ")", "{", "register", "int", "size", ",", "timeout", "=", "3", ";", "register", "WORD", "wTmp", ";", "LPDAQD", "DAQD", ";", "/", "*", "Increment", "the", "tail", "and", "check", "for", "queue", "wrap", "*", "/", "wTmp", "=", "readw", "(", "dev", ".", "DARQ", "+", "JQS_wTail", ")", "+", "PCTODSP_OFFSET", "(", "DAQDS__size", ")", ";", "if", "(", "wTmp", ">", "readw", "(", "dev", ".", "DARQ", "+", "JQS_wSize", ")", ")", "wTmp", "=", "0", ";", "while", "(", "wTmp", "=", "=", "readw", "(", "dev", ".", "DARQ", "+", "JQS_wHead", ")", "&", "&", "timeout", "-", "-)", "udelay", "(", "1", ")", ";", "writew", "(", "wTmp", ",", "dev", ".", "DARQ", "+", "JQS_wTail", ")", ";", "/", "*", "Get", "our", "digital", "audio", "queue", "struct", "*", "/", "DAQD", "=", "bank", "*", "DAQDS__size", "+", "dev", ".", "base", "+", "DARQ_DATA_BUFF", ";", "/", "*", "Get", "length", "of", "data", "*", "/", "size", "=", "readw", "(", "DAQD", "+", "DAQDS_wSize", ")", ";", "/", "*", "Read", "data", "from", "the", "head", "(", "unprotected", "bank", "1", "access", "okay", "since", "this", "is", "only", "called", "inside", "an", "interrupt", ")", "*", "/", "msnd_outb", "(", "HPBLKSEL_1", ",", "dev", ".", "io", "+", "HP_BLKS", ")", ";", "msnd_fifo_write_io", "(", "&", "dev", ".", "DARF", ",", "dev", ".", "base", "+", "bank", "*", "DAR_BUFF_SIZE", ",", "size", ")", ";", "msnd_outb", "(", "HPBLKSEL_0", ",", "dev", ".", "io", "+", "HP_BLKS", ")", ";", "return", "1", ";", "}", "static", "__inline__", "int", "pack_DAPF_to_DAPQ", "(", "register", "int", "start", ")", "{", "register", "WORD", "DAPQ_tail", ";", "register", "int", "protect", "=", "start", ",", "nbanks", "=", "0", ";", "LPDAQD", "DAQD", ";", "DAPQ_tail", "=", "readw", "(", "dev", ".", "DAPQ", "+", "JQS_wTail", ")", ";", "while", "(", "DAPQ_tail", "!", "=", "readw", "(", "dev", ".", "DAPQ", "+", "JQS_wHead", ")", "|", "|", "start", ")", "{", "register", "int", "bank_num", "=", "DAPQ_tail", "/", "PCTODSP_OFFSET", "(", "DAQDS__size", ")", ";", "register", "int", "n", ";", "unsigned", "long", "flags", ";", "/", "*", "Write", "the", "data", "to", "the", "new", "tail", "*", "/", "if", "(", "protect", ")", "{", "/", "*", "Critical", "section", ":", "protect", "fifo", "in", "non", "-", "interrupt", "*", "/", "spin_lock_irqsave", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "n", "=", "msnd_fifo_read_io", "(", "&", "dev", ".", "DAPF", ",", "dev", ".", "base", "+", "bank_num", "*", "DAP_BUFF_SIZE", ",", "DAP_BUFF_SIZE", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "}", "else", "{", "n", "=", "msnd_fifo_read_io", "(", "&", "dev", ".", "DAPF", ",", "dev", ".", "base", "+", "bank_num", "*", "DAP_BUFF_SIZE", ",", "DAP_BUFF_SIZE", ")", ";", "}", "if", "(", "!", "n", ")", "break", ";", "if", "(", "start", ")", "start", "=", "0", ";", "/", "*", "Get", "our", "digital", "audio", "queue", "struct", "*", "/", "DAQD", "=", "bank_num", "*", "DAQDS__size", "+", "dev", ".", "base", "+", "DAPQ_DATA_BUFF", ";", "/", "*", "Write", "size", "of", "this", "bank", "*", "/", "writew", "(", "n", ",", "DAQD", "+", "DAQDS_wSize", ")", ";", "+", "+", "nbanks", ";", "/", "*", "Then", "advance", "the", "tail", "*", "/", "DAPQ_tail", "=", "(", "++", "bank_num", "%", "3", ")", "*", "PCTODSP_OFFSET", "(", "DAQDS__size", ")", ";", "writew", "(", "DAPQ_tail", ",", "dev", ".", "DAPQ", "+", "JQS_wTail", ")", ";", "/", "*", "Tell", "the", "DSP", "to", "play", "the", "bank", "*", "/", "msnd_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_PLAY_START", ")", ";", "}", "return", "nbanks", ";", "}", "static", "int", "dsp_read", "(", "char", "__user", "*", "buf", ",", "size_t", "len", ")", "{", "int", "count", "=", "len", ";", "char", "*", "page", "=", "(", "char", "*", ")", "__get_free_page", "(", "GFP_KERNEL", ")", ";", "int", "timeout", "=", "get_rec_delay_jiffies", "(", "DAR_BUFF_SIZE", ")", ";", "if", "(", "!", "page", ")", "return", "-", "ENOMEM", ";", "while", "(", "count", ">", "0", ")", "{", "int", "n", ",", "k", ";", "unsigned", "long", "flags", ";", "k", "=", "PAGE_SIZE", ";", "if", "(", "k", ">", "count", ")", "k", "=", "count", ";", "/", "*", "Critical", "section", ":", "protect", "fifo", "in", "non", "-", "interrupt", "*", "/", "spin_lock_irqsave", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "n", "=", "msnd_fifo_read", "(", "&", "dev", ".", "DARF", ",", "page", ",", "k", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "if", "(", "copy_to_user", "(", "buf", ",", "page", ",", "n", ")", ")", "{", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "return", "-", "EFAULT", ";", "}", "buf", "+", "=", "n", ";", "count", "-", "=", "n", ";", "if", "(", "n", "=", "=", "k", "&", "&", "count", ")", "continue", ";", "if", "(", "!", "test_bit", "(", "F_READING", ",", "&", "dev", ".", "flags", ")", "&", "&", "dev", ".", "mode", "&", "FMODE_READ", ")", "{", "dev", ".", "last_recbank", "=", "-", "1", ";", "if", "(", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_RECORD_START", ")", "=", "=", "0", ")", "set_bit", "(", "F_READING", ",", "&", "dev", ".", "flags", ")", ";", "}", "if", "(", "dev", ".", "rec_ndelay", ")", "{", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "return", "count", "=", "=", "len", "?", "-", "EAGAIN", ":", "len", "-", "count", ";", "}", "if", "(", "count", ">", "0", ")", "{", "set_bit", "(", "F_READBLOCK", ",", "&", "dev", ".", "flags", ")", ";", "if", "(", "wait_event_interruptible_timeout", "(", "dev", ".", "readblock", ",", "test_bit", "(", "F_READBLOCK", ",", "&", "dev", ".", "flags", ")", ",", "timeout", ")", "<", "=", "0", ")", "clear_bit", "(", "F_READING", ",", "&", "dev", ".", "flags", ")", ";", "if", "(", "signal_pending", "(", "current", ")", ")", "{", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "return", "-", "EINTR", ";", "}", "}", "}", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "return", "len", "-", "count", ";", "}", "static", "int", "dsp_write", "(", "const", "char", "__user", "*", "buf", ",", "size_t", "len", ")", "{", "int", "count", "=", "len", ";", "char", "*", "page", "=", "(", "char", "*", ")", "__get_free_page", "(", "GFP_KERNEL", ")", ";", "int", "timeout", "=", "get_play_delay_jiffies", "(", "DAP_BUFF_SIZE", ")", ";", "if", "(", "!", "page", ")", "return", "-", "ENOMEM", ";", "while", "(", "count", ">", "0", ")", "{", "int", "n", ",", "k", ";", "unsigned", "long", "flags", ";", "k", "=", "PAGE_SIZE", ";", "if", "(", "k", ">", "count", ")", "k", "=", "count", ";", "if", "(", "copy_from_user", "(", "page", ",", "buf", ",", "k", ")", ")", "{", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "return", "-", "EFAULT", ";", "}", "/", "*", "Critical", "section", ":", "protect", "fifo", "in", "non", "-", "interrupt", "*", "/", "spin_lock_irqsave", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "n", "=", "msnd_fifo_write", "(", "&", "dev", ".", "DAPF", ",", "page", ",", "k", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "buf", "+", "=", "n", ";", "count", "-", "=", "n", ";", "if", "(", "count", "&", "&", "n", "=", "=", "k", ")", "continue", ";", "if", "(", "!", "test_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", "&", "&", "(", "dev", ".", "mode", "&", "FMODE_WRITE", ")", ")", "{", "dev", ".", "last_playbank", "=", "-", "1", ";", "if", "(", "pack_DAPF_to_DAPQ", "(", "1", ")", ">", "0", ")", "set_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", ";", "}", "if", "(", "dev", ".", "play_ndelay", ")", "{", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "return", "count", "=", "=", "len", "?", "-", "EAGAIN", ":", "len", "-", "count", ";", "}", "if", "(", "count", ">", "0", ")", "{", "set_bit", "(", "F_WRITEBLOCK", ",", "&", "dev", ".", "flags", ")", ";", "wait_event_interruptible_timeout", "(", "dev", ".", "writeblock", ",", "test_bit", "(", "F_WRITEBLOCK", ",", "&", "dev", ".", "flags", ")", ",", "timeout", ")", ";", "if", "(", "signal_pending", "(", "current", ")", ")", "{", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "return", "-", "EINTR", ";", "}", "}", "}", "free_page", "(", "(", "unsigned", "long", ")", "page", ")", ";", "return", "len", "-", "count", ";", "}", "static", "ssize_t", "dev_read", "(", "struct", "file", "*", "file", ",", "char", "__user", "*", "buf", ",", "size_t", "count", ",", "loff_t", "*", "off", ")", "{", "int", "minor", "=", "iminor", "(", "file_inode", "(", "file", ")", ");", "if", "(", "minor", "=", "=", "dev", ".", "dsp_minor", ")", "return", "dsp_read", "(", "buf", ",", "count", ")", ";", "else", "return", "-", "EINVAL", ";", "}", "static", "ssize_t", "dev_write", "(", "struct", "file", "*", "file", ",", "const", "char", "__user", "*", "buf", ",", "size_t", "count", ",", "loff_t", "*", "off", ")", "{", "int", "minor", "=", "iminor", "(", "file_inode", "(", "file", ")", ");", "if", "(", "minor", "=", "=", "dev", ".", "dsp_minor", ")", "return", "dsp_write", "(", "buf", ",", "count", ")", ";", "else", "return", "-", "EINVAL", ";", "}", "static", "__inline__", "void", "eval_dsp_msg", "(", "register", "WORD", "wMessage", ")", "{", "switch", "(", "HIBYTE", "(", "wMessage", ")", ")", "{", "case", "HIMT_PLAY_DONE", ":", "if", "(", "dev", ".", "last_playbank", "=", "=", "LOBYTE", "(", "wMessage", ")", "|", "|", "!", "test_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", ")", "break", ";", "dev", ".", "last_playbank", "=", "LOBYTE", "(", "wMessage", ")", ";", "if", "(", "pack_DAPF_to_DAPQ", "(", "0", ")", "<", "=", "0", ")", "{", "if", "(", "!", "test_bit", "(", "F_WRITEBLOCK", ",", "&", "dev", ".", "flags", ")", ")", "{", "if", "(", "test_and_clear_bit", "(", "F_WRITEFLUSH", ",", "&", "dev", ".", "flags", ")", ")", "wake_up_interruptible", "(", "&", "dev", ".", "writeflush", ")", ";", "}", "clear_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", ";", "}", "if", "(", "test_and_clear_bit", "(", "F_WRITEBLOCK", ",", "&", "dev", ".", "flags", ")", ")", "wake_up_interruptible", "(", "&", "dev", ".", "writeblock", ")", ";", "break", ";", "case", "HIMT_RECORD_DONE", ":", "if", "(", "dev", ".", "last_recbank", "=", "=", "LOBYTE", "(", "wMessage", ")", ")", "break", ";", "dev", ".", "last_recbank", "=", "LOBYTE", "(", "wMessage", ")", ";", "pack_DARQ_to_DARF", "(", "dev", ".", "last_recbank", ")", ";", "if", "(", "test_and_clear_bit", "(", "F_READBLOCK", ",", "&", "dev", ".", "flags", ")", ")", "wake_up_interruptible", "(", "&", "dev", ".", "readblock", ")", ";", "break", ";", "case", "HIMT_DSP", ":", "switch", "(", "LOBYTE", "(", "wMessage", ")", ")", "{", "#", "ifndef", "MSND_CLASSIC", "case", "HIDSP_PLAY_UNDER", ":", "#", "endif", "case", "HIDSP_INT_PLAY_UNDER", ":", "/", "*", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Play", "underflow", "\\", "n", "\"", ");", "*", "/", "clear_bit", "(", "F_WRITING", ",", "&", "dev", ".", "flags", ")", ";", "break", ";", "case", "HIDSP_INT_RECORD_OVER", ":", "/", "*", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "Record", "overflow", "\\", "n", "\"", ");", "*", "/", "clear_bit", "(", "F_READING", ",", "&", "dev", ".", "flags", ")", ";", "break", ";", "default", ":", "/", "*", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "DSP", "message", "%", "d", "0x", "%", "02x", "\\", "n", "\"", ",", "LOBYTE", "(", "wMessage", ")", ",", "LOBYTE", "(", "wMessage", ")", ");", "*", "/", "break", ";", "}", "break", ";", "case", "HIMT_MIDI_IN_UCHAR", ":", "if", "(", "dev", ".", "midi_in_interrupt", ")", "(", "*", "dev", ".", "midi_in_interrupt", ")", "(&", "dev", ")", ";", "break", ";", "default", ":", "/", "*", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "HIMT", "message", "%", "d", "0x", "%", "02x", "\\", "n", "\"", ",", "HIBYTE", "(", "wMessage", ")", ",", "HIBYTE", "(", "wMessage", ")", ");", "*", "/", "break", ";", "}", "}", "static", "irqreturn_t", "intr", "(", "int", "irq", ",", "void", "*", "dev_id", ")", "{", "/", "*", "Send", "ack", "to", "DSP", "*", "/", "msnd_inb", "(", "dev", ".", "io", "+", "HP_RXL", ")", ";", "/", "*", "Evaluate", "queued", "DSP", "messages", "*", "/", "while", "(", "readw", "(", "dev", ".", "DSPQ", "+", "JQS_wTail", ")", "!", "=", "readw", "(", "dev", ".", "DSPQ", "+", "JQS_wHead", ")", ")", "{", "register", "WORD", "wTmp", ";", "eval_dsp_msg", "(", "readw", "(", "dev", ".", "pwDSPQData", "+", "2", "*", "readw", "(", "dev", ".", "DSPQ", "+", "JQS_wHead", ")", "))", ";", "if", "(", "(", "wTmp", "=", "readw", "(", "dev", ".", "DSPQ", "+", "JQS_wHead", ")", "+", "1", ")", ">", "readw", "(", "dev", ".", "DSPQ", "+", "JQS_wSize", ")", ")", "writew", "(", "0", ",", "dev", ".", "DSPQ", "+", "JQS_wHead", ")", ";", "else", "writew", "(", "wTmp", ",", "dev", ".", "DSPQ", "+", "JQS_wHead", ")", ";", "}", "return", "IRQ_HANDLED", ";", "}", "static", "const", "struct", "file_operations", "dev_fileops", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "read", "=", "dev_read", ",", ".", "write", "=", "dev_write", ",", ".", "unlocked_ioctl", "=", "dev_ioctl", ",", ".", "open", "=", "dev_open", ",", ".", "release", "=", "dev_release", ",", ".", "llseek", "=", "noop_llseek", ",", "}", ";", "static", "int", "reset_dsp", "(", "void", ")", "{", "int", "timeout", "=", "100", ";", "msnd_outb", "(", "HPDSPRESET_ON", ",", "dev", ".", "io", "+", "HP_DSPR", ")", ";", "mdelay", "(", "1", ")", ";", "#", "ifndef", "MSND_CLASSIC", "dev", ".", "info", "=", "msnd_inb", "(", "dev", ".", "io", "+", "HP_INFO", ")", ";", "#", "endif", "msnd_outb", "(", "HPDSPRESET_OFF", ",", "dev", ".", "io", "+", "HP_DSPR", ")", ";", "mdelay", "(", "1", ")", ";", "while", "(", "timeout", "-", "-", ">", "0", ")", "{", "if", "(", "msnd_inb", "(", "dev", ".", "io", "+", "HP_CVR", ")", "=", "=", "HP_CVR_DEF", ")", "return", "0", ";", "mdelay", "(", "1", ")", ";", "}", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Cannot", "reset", "DSP", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "static", "int", "__init", "probe_multisound", "(", "void", ")", "{", "#", "ifndef", "MSND_CLASSIC", "char", "*", "xv", ",", "*", "rev", "=", "NULL", ";", "char", "*", "pin", "=", "\"", "Pinnacle", "\"", ",", "*", "fiji", "=", "\"", "Fiji", "\"", ";", "char", "*", "pinfiji", "=", "\"", "Pinnacle", "/", "Fiji", "\"", ";", "#", "endif", "if", "(", "!", "request_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ",", "\"", "probing", "\"", "))", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "I", "/", "O", "port", "conflict", "\\", "n", "\"", ");", "return", "-", "ENODEV", ";", "}", "if", "(", "reset_dsp", "(", ")", "<", "0", ")", "{", "release_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ")", ";", "return", "-", "ENODEV", ";", "}", "#", "ifdef", "MSND_CLASSIC", "dev", ".", "name", "=", "\"", "Classic", "/", "Tahiti", "/", "Monterey", "\"", ";", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "%", "s", ",", "\"", "#", "else", "switch", "(", "dev", ".", "info", ">", ">", "4", ")", "{", "case", "0xf", ":", "xv", "=", "\"", "<=", "1", ".", "15", "\"", ";", "break", ";", "case", "0x1", ":", "xv", "=", "\"", "1", ".", "18", "/", "1", ".", "2", "\"", ";", "break", ";", "case", "0x2", ":", "xv", "=", "\"", "1", ".", "3", "\"", ";", "break", ";", "case", "0x3", ":", "xv", "=", "\"", "1", ".", "4", "\"", ";", "break", ";", "default", ":", "xv", "=", "\"", "unknown", "\"", ";", "break", ";", "}", "switch", "(", "dev", ".", "info", "&", "0x7", ")", "{", "case", "0x0", ":", "rev", "=", "\"", "I", "\"", ";", "dev", ".", "name", "=", "pin", ";", "break", ";", "case", "0x1", ":", "rev", "=", "\"", "F", "\"", ";", "dev", ".", "name", "=", "pin", ";", "break", ";", "case", "0x2", ":", "rev", "=", "\"", "G", "\"", ";", "dev", ".", "name", "=", "pin", ";", "break", ";", "case", "0x3", ":", "rev", "=", "\"", "H", "\"", ";", "dev", ".", "name", "=", "pin", ";", "break", ";", "case", "0x4", ":", "rev", "=", "\"", "E", "\"", ";", "dev", ".", "name", "=", "fiji", ";", "break", ";", "case", "0x5", ":", "rev", "=", "\"", "C", "\"", ";", "dev", ".", "name", "=", "fiji", ";", "break", ";", "case", "0x6", ":", "rev", "=", "\"", "D", "\"", ";", "dev", ".", "name", "=", "fiji", ";", "break", ";", "case", "0x7", ":", "rev", "=", "\"", "A", "-", "B", "(", "Fiji", ")", "or", "A", "-", "E", "(", "Pinnacle", ")", "\";", "dev", ".", "name", "=", "pinfiji", ";", "break", ";", "}", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "%", "s", "revision", "%", "s", ",", "Xilinx", "version", "%", "s", ",", "\"", "#", "endif", "/", "*", "MSND_CLASSIC", "*", "/", "\"", "I", "/", "O", "0x", "%", "x", "-", "0x", "%", "x", ",", "IRQ", "%", "d", ",", "memory", "mapped", "to", "%", "p", "-", "%", "p", "\\", "n", "\"", ",", "dev", ".", "name", ",", "#", "ifndef", "MSND_CLASSIC", "rev", ",", "xv", ",", "#", "endif", "dev", ".", "io", ",", "dev", ".", "io", "+", "dev", ".", "numio", "-", "1", ",", "dev", ".", "irq", ",", "dev", ".", "base", ",", "dev", ".", "base", "+", "0x7fff", ")", ";", "release_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ")", ";", "return", "0", ";", "}", "static", "int", "init_sma", "(", "void", ")", "{", "static", "int", "initted", ";", "WORD", "mastVolLeft", ",", "mastVolRight", ";", "unsigned", "long", "flags", ";", "#", "ifdef", "MSND_CLASSIC", "msnd_outb", "(", "dev", ".", "memid", ",", "dev", ".", "io", "+", "HP_MEMM", ")", ";", "#", "endif", "msnd_outb", "(", "HPBLKSEL_0", ",", "dev", ".", "io", "+", "HP_BLKS", ")", ";", "if", "(", "initted", ")", "{", "mastVolLeft", "=", "readw", "(", "dev", ".", "SMA", "+", "SMA_wCurrMastVolLeft", ")", ";", "mastVolRight", "=", "readw", "(", "dev", ".", "SMA", "+", "SMA_wCurrMastVolRight", ")", ";", "}", "else", "mastVolLeft", "=", "mastVolRight", "=", "0", ";", "memset_io", "(", "dev", ".", "base", ",", "0", ",", "0x8000", ")", ";", "/", "*", "Critical", "section", ":", "bank", "1", "access", "*", "/", "spin_lock_irqsave", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "msnd_outb", "(", "HPBLKSEL_1", ",", "dev", ".", "io", "+", "HP_BLKS", ")", ";", "memset_io", "(", "dev", ".", "base", ",", "0", ",", "0x8000", ")", ";", "msnd_outb", "(", "HPBLKSEL_0", ",", "dev", ".", "io", "+", "HP_BLKS", ")", ";", "spin_unlock_irqrestore", "(", "&", "dev", ".", "lock", ",", "flags", ")", ";", "dev", ".", "pwDSPQData", "=", "(", "dev", ".", "base", "+", "DSPQ_DATA_BUFF", ")", ";", "dev", ".", "pwMODQData", "=", "(", "dev", ".", "base", "+", "MODQ_DATA_BUFF", ")", ";", "dev", ".", "pwMIDQData", "=", "(", "dev", ".", "base", "+", "MIDQ_DATA_BUFF", ")", ";", "/", "*", "Motorola", "56k", "shared", "memory", "base", "*", "/", "dev", ".", "SMA", "=", "dev", ".", "base", "+", "SMA_STRUCT_START", ";", "/", "*", "Digital", "audio", "play", "queue", "*", "/", "dev", ".", "DAPQ", "=", "dev", ".", "base", "+", "DAPQ_OFFSET", ";", "msnd_init_queue", "(", "dev", ".", "DAPQ", ",", "DAPQ_DATA_BUFF", ",", "DAPQ_BUFF_SIZE", ")", ";", "/", "*", "Digital", "audio", "record", "queue", "*", "/", "dev", ".", "DARQ", "=", "dev", ".", "base", "+", "DARQ_OFFSET", ";", "msnd_init_queue", "(", "dev", ".", "DARQ", ",", "DARQ_DATA_BUFF", ",", "DARQ_BUFF_SIZE", ")", ";", "/", "*", "MIDI", "out", "queue", "*", "/", "dev", ".", "MODQ", "=", "dev", ".", "base", "+", "MODQ_OFFSET", ";", "msnd_init_queue", "(", "dev", ".", "MODQ", ",", "MODQ_DATA_BUFF", ",", "MODQ_BUFF_SIZE", ")", ";", "/", "*", "MIDI", "in", "queue", "*", "/", "dev", ".", "MIDQ", "=", "dev", ".", "base", "+", "MIDQ_OFFSET", ";", "msnd_init_queue", "(", "dev", ".", "MIDQ", ",", "MIDQ_DATA_BUFF", ",", "MIDQ_BUFF_SIZE", ")", ";", "/", "*", "DSP", "-", ">", "host", "message", "queue", "*", "/", "dev", ".", "DSPQ", "=", "dev", ".", "base", "+", "DSPQ_OFFSET", ";", "msnd_init_queue", "(", "dev", ".", "DSPQ", ",", "DSPQ_DATA_BUFF", ",", "DSPQ_BUFF_SIZE", ")", ";", "/", "*", "Setup", "some", "DSP", "values", "*", "/", "#", "ifndef", "MSND_CLASSIC", "writew", "(", "1", ",", "dev", ".", "SMA", "+", "SMA_wCurrPlayFormat", ")", ";", "writew", "(", "dev", ".", "play_sample_size", ",", "dev", ".", "SMA", "+", "SMA_wCurrPlaySampleSize", ")", ";", "writew", "(", "dev", ".", "play_channels", ",", "dev", ".", "SMA", "+", "SMA_wCurrPlayChannels", ")", ";", "writew", "(", "dev", ".", "play_sample_rate", ",", "dev", ".", "SMA", "+", "SMA_wCurrPlaySampleRate", ")", ";", "#", "endif", "writew", "(", "dev", ".", "play_sample_rate", ",", "dev", ".", "SMA", "+", "SMA_wCalFreqAtoD", ")", ";", "writew", "(", "mastVolLeft", ",", "dev", ".", "SMA", "+", "SMA_wCurrMastVolLeft", ")", ";", "writew", "(", "mastVolRight", ",", "dev", ".", "SMA", "+", "SMA_wCurrMastVolRight", ")", ";", "#", "ifndef", "MSND_CLASSIC", "writel", "(", "0x00010000", ",", "dev", ".", "SMA", "+", "SMA_dwCurrPlayPitch", ")", ";", "writel", "(", "0x00000001", ",", "dev", ".", "SMA", "+", "SMA_dwCurrPlayRate", ")", ";", "#", "endif", "writew", "(", "0x303", ",", "dev", ".", "SMA", "+", "SMA_wCurrInputTagBits", ")", ";", "initted", "=", "1", ";", "return", "0", ";", "}", "static", "int", "__init", "calibrate_adc", "(", "WORD", "srate", ")", "{", "writew", "(", "srate", ",", "dev", ".", "SMA", "+", "SMA_wCalFreqAtoD", ")", ";", "if", "(", "dev", ".", "calibrate_signal", "=", "=", "0", ")", "writew", "(", "readw", "(", "dev", ".", "SMA", "+", "SMA_wCurrHostStatusFlags", ")", "|", "0x0001", ",", "dev", ".", "SMA", "+", "SMA_wCurrHostStatusFlags", ")", ";", "else", "writew", "(", "readw", "(", "dev", ".", "SMA", "+", "SMA_wCurrHostStatusFlags", ")", "&", "~", "0x0001", ",", "dev", ".", "SMA", "+", "SMA_wCurrHostStatusFlags", ")", ";", "if", "(", "msnd_send_word", "(", "&", "dev", ",", "0", ",", "0", ",", "HDEXAR_CAL_A_TO_D", ")", "=", "=", "0", "&", "&", "chk_send_dsp_cmd", "(", "&", "dev", ",", "HDEX_AUX_REQ", ")", "=", "=", "0", ")", "{", "schedule_timeout_interruptible", "(", "HZ", "/", "3", ")", ";", "return", "0", ";", "}", "printk", "(", "KERN_WARNING", "LOGNAME", "\"", ":", "ADC", "calibration", "failed", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "static", "int", "upload_dsp_code", "(", "void", ")", "{", "int", "ret", "=", "0", ";", "msnd_outb", "(", "HPBLKSEL_0", ",", "dev", ".", "io", "+", "HP_BLKS", ")", ";", "#", "ifndef", "HAVE_DSPCODEH", "INITCODESIZE", "=", "mod_firmware_load", "(", "INITCODEFILE", ",", "&", "INITCODE", ")", ";", "if", "(", "!", "INITCODE", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Error", "loading", "\"", "INITCODEFILE", ")", ";", "return", "-", "EBUSY", ";", "}", "PERMCODESIZE", "=", "mod_firmware_load", "(", "PERMCODEFILE", ",", "&", "PERMCODE", ")", ";", "if", "(", "!", "PERMCODE", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Error", "loading", "\"", "PERMCODEFILE", ")", ";", "vfree", "(", "INITCODE", ")", ";", "return", "-", "EBUSY", ";", "}", "#", "endif", "memcpy_toio", "(", "dev", ".", "base", ",", "PERMCODE", ",", "PERMCODESIZE", ")", ";", "if", "(", "msnd_upload_host", "(", "&", "dev", ",", "INITCODE", ",", "INITCODESIZE", ")", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "LOGNAME", "\"", ":", "Error", "uploading", "to", "DSP", "\\", "n", "\"", ");", "ret", "=", "-", "ENODEV", ";", "goto", "out", ";", "}", "#", "ifdef", "HAVE_DSPCODEH", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "DSP", "firmware", "uploaded", "(", "resident", ")", "\\", "n", "\"", ");", "#", "else", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "DSP", "firmware", "uploaded", "\\", "n", "\"", ");", "#", "endif", "out", ":", "#", "ifndef", "HAVE_DSPCODEH", "vfree", "(", "INITCODE", ")", ";", "vfree", "(", "PERMCODE", ")", ";", "#", "endif", "return", "ret", ";", "}", "#", "ifdef", "MSND_CLASSIC", "static", "void", "reset_proteus", "(", "void", ")", "{", "msnd_outb", "(", "HPPRORESET_ON", ",", "dev", ".", "io", "+", "HP_PROR", ")", ";", "mdelay", "(", "TIME_PRO_RESET", ")", ";", "msnd_outb", "(", "HPPRORESET_OFF", ",", "dev", ".", "io", "+", "HP_PROR", ")", ";", "mdelay", "(", "TIME_PRO_RESET_DONE", ")", ";", "}", "#", "endif", "static", "int", "initialize", "(", "void", ")", "{", "int", "err", ",", "timeout", ";", "#", "ifdef", "MSND_CLASSIC", "msnd_outb", "(", "HPWAITSTATE_0", ",", "dev", ".", "io", "+", "HP_WAIT", ")", ";", "msnd_outb", "(", "HPBITMODE_16", ",", "dev", ".", "io", "+", "HP_BITM", ")", ";", "reset_proteus", "(", ");", "#", "endif", "if", "(", "(", "err", "=", "init_sma", "(", "))", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "LOGNAME", "\"", ":", "Cannot", "initialize", "SMA", "\\", "n", "\"", ");", "return", "err", ";", "}", "if", "(", "(", "err", "=", "reset_dsp", "(", "))", "<", "0", ")", "return", "err", ";", "if", "(", "(", "err", "=", "upload_dsp_code", "(", "))", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "LOGNAME", "\"", ":", "Cannot", "upload", "DSP", "code", "\\", "n", "\"", ");", "return", "err", ";", "}", "timeout", "=", "200", ";", "while", "(", "readw", "(", "dev", ".", "base", ")", ")", "{", "mdelay", "(", "1", ")", ";", "if", "(", "!", "timeout", "-", "-)", "{", "printk", "(", "KERN_DEBUG", "LOGNAME", "\"", ":", "DSP", "reset", "timeout", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "}", "mixer_setup", "(", ");", "return", "0", ";", "}", "static", "int", "dsp_full_reset", "(", "void", ")", "{", "int", "rv", ";", "if", "(", "test_bit", "(", "F_RESETTING", ",", "&", "dev", ".", "flags", ")", "|", "|", "+", "+", "dev", ".", "nresets", ">", "10", ")", "return", "0", ";", "set_bit", "(", "F_RESETTING", ",", "&", "dev", ".", "flags", ")", ";", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "DSP", "reset", "\\", "n", "\"", ");", "dsp_halt", "(", "NULL", ")", ";", "/", "*", "Unconditionally", "halt", "*", "/", "if", "(", "(", "rv", "=", "initialize", "(", "))", ")", "printk", "(", "KERN_WARNING", "LOGNAME", "\"", ":", "DSP", "reset", "failed", "\\", "n", "\"", ");", "force_recsrc", "(", "dev", ".", "recsrc", ")", ";", "dsp_open", "(", "NULL", ")", ";", "clear_bit", "(", "F_RESETTING", ",", "&", "dev", ".", "flags", ")", ";", "return", "rv", ";", "}", "static", "int", "__init", "attach_multisound", "(", "void", ")", "{", "int", "err", ";", "if", "(", "(", "err", "=", "request_irq", "(", "dev", ".", "irq", ",", "intr", ",", "0", ",", "dev", ".", "name", ",", "&", "dev", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Couldn", "'", "t", "grab", "IRQ", "%", "d", "\\", "n", "\"", ",", "dev", ".", "irq", ")", ";", "return", "err", ";", "}", "if", "(", "request_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ",", "dev", ".", "name", ")", "=", "=", "NULL", ")", "{", "free_irq", "(", "dev", ".", "irq", ",", "&", "dev", ")", ";", "return", "-", "EBUSY", ";", "}", "err", "=", "dsp_full_reset", "(", ");", "if", "(", "err", "<", "0", ")", "{", "release_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ")", ";", "free_irq", "(", "dev", ".", "irq", ",", "&", "dev", ")", ";", "return", "err", ";", "}", "if", "(", "(", "err", "=", "msnd_register", "(", "&", "dev", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Unable", "to", "register", "MultiSound", "\\", "n", "\"", ");", "release_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ")", ";", "free_irq", "(", "dev", ".", "irq", ",", "&", "dev", ")", ";", "return", "err", ";", "}", "if", "(", "(", "dev", ".", "dsp_minor", "=", "register_sound_dsp", "(", "&", "dev_fileops", ",", "-", "1", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Unable", "to", "register", "DSP", "operations", "\\", "n", "\"", ");", "msnd_unregister", "(", "&", "dev", ")", ";", "release_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ")", ";", "free_irq", "(", "dev", ".", "irq", ",", "&", "dev", ")", ";", "return", "dev", ".", "dsp_minor", ";", "}", "if", "(", "(", "dev", ".", "mixer_minor", "=", "register_sound_mixer", "(", "&", "dev_fileops", ",", "-", "1", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Unable", "to", "register", "mixer", "operations", "\\", "n", "\"", ");", "unregister_sound_mixer", "(", "dev", ".", "mixer_minor", ")", ";", "msnd_unregister", "(", "&", "dev", ")", ";", "release_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ")", ";", "free_irq", "(", "dev", ".", "irq", ",", "&", "dev", ")", ";", "return", "dev", ".", "mixer_minor", ";", "}", "dev", ".", "ext_midi_dev", "=", "dev", ".", "hdr_midi_dev", "=", "-", "1", ";", "disable_irq", "(", "dev", ".", "irq", ")", ";", "calibrate_adc", "(", "dev", ".", "play_sample_rate", ")", ";", "#", "ifndef", "MSND_CLASSIC", "force_recsrc", "(", "SOUND_MASK_IMIX", ")", ";", "#", "endif", "return", "0", ";", "}", "static", "void", "__exit", "unload_multisound", "(", "void", ")", "{", "release_region", "(", "dev", ".", "io", ",", "dev", ".", "numio", ")", ";", "free_irq", "(", "dev", ".", "irq", ",", "&", "dev", ")", ";", "unregister_sound_mixer", "(", "dev", ".", "mixer_minor", ")", ";", "unregister_sound_dsp", "(", "dev", ".", "dsp_minor", ")", ";", "msnd_unregister", "(", "&", "dev", ")", ";", "}", "#", "ifndef", "MSND_CLASSIC", "/", "*", "Pinnacle", "/", "Fiji", "Logical", "Device", "Configuration", "*", "/", "static", "int", "__init", "msnd_write_cfg", "(", "int", "cfg", ",", "int", "reg", ",", "int", "value", ")", "{", "msnd_outb", "(", "reg", ",", "cfg", ")", ";", "msnd_outb", "(", "value", ",", "cfg", "+", "1", ")", ";", "if", "(", "value", "!", "=", "msnd_inb", "(", "cfg", "+", "1", ")", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "msnd_write_cfg", ":", "I", "/", "O", "error", "\\", "n", "\"", ");", "return", "-", "EIO", ";", "}", "return", "0", ";", "}", "static", "int", "__init", "msnd_write_cfg_io0", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "io", ")", "{", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IO0_BASEHI", ",", "HIBYTE", "(", "io", ")", "))", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IO0_BASELO", ",", "LOBYTE", "(", "io", ")", "))", "return", "-", "EIO", ";", "return", "0", ";", "}", "static", "int", "__init", "msnd_write_cfg_io1", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "io", ")", "{", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IO1_BASEHI", ",", "HIBYTE", "(", "io", ")", "))", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IO1_BASELO", ",", "LOBYTE", "(", "io", ")", "))", "return", "-", "EIO", ";", "return", "0", ";", "}", "static", "int", "__init", "msnd_write_cfg_irq", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "irq", ")", "{", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IRQ_NUMBER", ",", "LOBYTE", "(", "irq", ")", "))", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_IRQ_TYPE", ",", "IRQTYPE_EDGE", ")", ")", "return", "-", "EIO", ";", "return", "0", ";", "}", "static", "int", "__init", "msnd_write_cfg_mem", "(", "int", "cfg", ",", "int", "num", ",", "int", "mem", ")", "{", "WORD", "wmem", ";", "mem", ">", ">=", "8", ";", "mem", "&", "=", "0xfff", ";", "wmem", "=", "(", "WORD", ")", "mem", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_MEMBASEHI", ",", "HIBYTE", "(", "wmem", ")", "))", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_MEMBASELO", ",", "LOBYTE", "(", "wmem", ")", "))", "return", "-", "EIO", ";", "if", "(", "wmem", "&", "&", "msnd_write_cfg", "(", "cfg", ",", "IREG_MEMCONTROL", ",", "(", "MEMTYPE_HIADDR", "|", "MEMTYPE_16BIT", ")", "))", "return", "-", "EIO", ";", "return", "0", ";", "}", "static", "int", "__init", "msnd_activate_logical", "(", "int", "cfg", ",", "int", "num", ")", "{", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_ACTIVATE", ",", "LD_ACTIVATE", ")", ")", "return", "-", "EIO", ";", "return", "0", ";", "}", "static", "int", "__init", "msnd_write_cfg_logical", "(", "int", "cfg", ",", "int", "num", ",", "WORD", "io0", ",", "WORD", "io1", ",", "WORD", "irq", ",", "int", "mem", ")", "{", "if", "(", "msnd_write_cfg", "(", "cfg", ",", "IREG_LOGDEVICE", ",", "num", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg_io0", "(", "cfg", ",", "num", ",", "io0", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg_io1", "(", "cfg", ",", "num", ",", "io1", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg_irq", "(", "cfg", ",", "num", ",", "irq", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_write_cfg_mem", "(", "cfg", ",", "num", ",", "mem", ")", ")", "return", "-", "EIO", ";", "if", "(", "msnd_activate_logical", "(", "cfg", ",", "num", ")", ")", "return", "-", "EIO", ";", "return", "0", ";", "}", "typedef", "struct", "msnd_pinnacle_cfg_device", "{", "WORD", "io0", ",", "io1", ",", "irq", ";", "int", "mem", ";", "}", "msnd_pinnacle_cfg_t", "[", "4", "]", ";", "static", "int", "__init", "msnd_pinnacle_cfg_devices", "(", "int", "cfg", ",", "int", "reset", ",", "msnd_pinnacle_cfg_t", "device", ")", "{", "int", "i", ";", "/", "*", "Reset", "devices", "if", "told", "to", "*", "/", "if", "(", "reset", ")", "{", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "Resetting", "all", "devices", "\\", "n", "\"", ");", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "+", "+", "i", ")", "if", "(", "msnd_write_cfg_logical", "(", "cfg", ",", "i", ",", "0", ",", "0", ",", "0", ",", "0", ")", ")", "return", "-", "EIO", ";", "}", "/", "*", "Configure", "specified", "devices", "*", "/", "for", "(", "i", "=", "0", ";", "i", "<", "4", ";", "+", "+", "i", ")", "{", "switch", "(", "i", ")", "{", "case", "0", ":", "/", "*", "DSP", "*", "/", "if", "(", "!(", "device", "[", "i", "]", ".", "io0", "&", "&", "device", "[", "i", "]", ".", "irq", "&", "&", "device", "[", "i", "]", ".", "mem", ")", ")", "continue", ";", "break", ";", "case", "1", ":", "/", "*", "MPU", "*", "/", "if", "(", "!(", "device", "[", "i", "]", ".", "io0", "&", "&", "device", "[", "i", "]", ".", "irq", ")", ")", "continue", ";", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "Configuring", "MPU", "to", "I", "/", "O", "0x", "%", "x", "IRQ", "%", "d", "\\", "n", "\"", ",", "device", "[", "i", "]", ".", "io0", ",", "device", "[", "i", "]", ".", "irq", ")", ";", "break", ";", "case", "2", ":", "/", "*", "IDE", "*", "/", "if", "(", "!(", "device", "[", "i", "]", ".", "io0", "&", "&", "device", "[", "i", "]", ".", "io1", "&", "&", "device", "[", "i", "]", ".", "irq", ")", ")", "continue", ";", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "Configuring", "IDE", "to", "I", "/", "O", "0x", "%", "x", ",", "0x", "%", "x", "IRQ", "%", "d", "\\", "n", "\"", ",", "device", "[", "i", "]", ".", "io0", ",", "device", "[", "i", "]", ".", "io1", ",", "device", "[", "i", "]", ".", "irq", ")", ";", "break", ";", "case", "3", ":", "/", "*", "Joystick", "*", "/", "if", "(", "!(", "device", "[", "i", "]", ".", "io0", ")", ")", "continue", ";", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "Configuring", "joystick", "to", "I", "/", "O", "0x", "%", "x", "\\", "n", "\"", ",", "device", "[", "i", "]", ".", "io0", ")", ";", "break", ";", "}", "/", "*", "Configure", "the", "device", "*", "/", "if", "(", "msnd_write_cfg_logical", "(", "cfg", ",", "i", ",", "device", "[", "i", "]", ".", "io0", ",", "device", "[", "i", "]", ".", "io1", ",", "device", "[", "i", "]", ".", "irq", ",", "device", "[", "i", "]", ".", "mem", ")", ")", "return", "-", "EIO", ";", "}", "return", "0", ";", "}", "#", "endif", "#", "ifdef", "MODULE", "MODULE_AUTHOR", "(", "\"", "Andrew", "Veliath", "<", "andrewtv", "@", "usa", ".", "net", ">", "\")", ";", "MODULE_DESCRIPTION", "(", "\"", "Turtle", "Beach", "\"", "LONGNAME", "\"", "Linux", "Driver", "\"", ");", "MODULE_LICENSE", "(", "\"", "GPL", "\"", ");", "static", "int", "io", "__initdata", "=", "-", "1", ";", "static", "int", "irq", "__initdata", "=", "-", "1", ";", "static", "int", "mem", "__initdata", "=", "-", "1", ";", "static", "int", "write_ndelay", "__initdata", "=", "-", "1", ";", "#", "ifndef", "MSND_CLASSIC", "/", "*", "Pinnacle", "/", "Fiji", "non", "-", "PnP", "Config", "Port", "*", "/", "static", "int", "cfg", "__initdata", "=", "-", "1", ";", "/", "*", "Extra", "Peripheral", "Configuration", "*", "/", "static", "int", "reset", "__initdata", "=", "0", ";", "static", "int", "mpu_io", "__initdata", "=", "0", ";", "static", "int", "mpu_irq", "__initdata", "=", "0", ";", "static", "int", "ide_io0", "__initdata", "=", "0", ";", "static", "int", "ide_io1", "__initdata", "=", "0", ";", "static", "int", "ide_irq", "__initdata", "=", "0", ";", "static", "int", "joystick_io", "__initdata", "=", "0", ";", "/", "*", "If", "we", "have", "the", "digital", "daugherboard", ".", "..", "*", "/", "static", "bool", "digital", "__initdata", "=", "false", ";", "#", "endif", "static", "int", "fifosize", "__initdata", "=", "DEFFIFOSIZE", ";", "static", "int", "calibrate_signal", "__initdata", "=", "0", ";", "#", "else", "/", "*", "not", "a", "module", "*", "/", "static", "int", "write_ndelay", "__initdata", "=", "-", "1", ";", "#", "ifdef", "MSND_CLASSIC", "static", "int", "io", "__initdata", "=", "CONFIG_MSNDCLAS_IO", ";", "static", "int", "irq", "__initdata", "=", "CONFIG_MSNDCLAS_IRQ", ";", "static", "int", "mem", "__initdata", "=", "CONFIG_MSNDCLAS_MEM", ";", "#", "else", "/", "*", "Pinnacle", "/", "Fiji", "*", "/", "static", "int", "io", "__initdata", "=", "CONFIG_MSNDPIN_IO", ";", "static", "int", "irq", "__initdata", "=", "CONFIG_MSNDPIN_IRQ", ";", "static", "int", "mem", "__initdata", "=", "CONFIG_MSNDPIN_MEM", ";", "/", "*", "Pinnacle", "/", "Fiji", "non", "-", "PnP", "Config", "Port", "*", "/", "#", "ifdef", "CONFIG_MSNDPIN_NONPNP", "#", "ifndef", "CONFIG_MSNDPIN_CFG", "#", "define", "CONFIG_MSNDPIN_CFG", "0x250", "#", "endif", "#", "else", "#", "ifdef", "CONFIG_MSNDPIN_CFG", "#", "undef", "CONFIG_MSNDPIN_CFG", "#", "endif", "#", "define", "CONFIG_MSNDPIN_CFG", "-", "1", "#", "endif", "static", "int", "cfg", "__initdata", "=", "CONFIG_MSNDPIN_CFG", ";", "/", "*", "If", "not", "a", "module", ",", "we", "don", "'", "t", "need", "to", "bother", "with", "reset", "=", "1", "*", "/", "static", "int", "reset", ";", "/", "*", "Extra", "Peripheral", "Configuration", "(", "Default", ":", "Disable", ")", "*", "/", "#", "ifndef", "CONFIG_MSNDPIN_MPU_IO", "#", "define", "CONFIG_MSNDPIN_MPU_IO", "0", "#", "endif", "static", "int", "mpu_io", "__initdata", "=", "CONFIG_MSNDPIN_MPU_IO", ";", "#", "ifndef", "CONFIG_MSNDPIN_MPU_IRQ", "#", "define", "CONFIG_MSNDPIN_MPU_IRQ", "0", "#", "endif", "static", "int", "mpu_irq", "__initdata", "=", "CONFIG_MSNDPIN_MPU_IRQ", ";", "#", "ifndef", "CONFIG_MSNDPIN_IDE_IO0", "#", "define", "CONFIG_MSNDPIN_IDE_IO0", "0", "#", "endif", "static", "int", "ide_io0", "__initdata", "=", "CONFIG_MSNDPIN_IDE_IO0", ";", "#", "ifndef", "CONFIG_MSNDPIN_IDE_IO1", "#", "define", "CONFIG_MSNDPIN_IDE_IO1", "0", "#", "endif", "static", "int", "ide_io1", "__initdata", "=", "CONFIG_MSNDPIN_IDE_IO1", ";", "#", "ifndef", "CONFIG_MSNDPIN_IDE_IRQ", "#", "define", "CONFIG_MSNDPIN_IDE_IRQ", "0", "#", "endif", "static", "int", "ide_irq", "__initdata", "=", "CONFIG_MSNDPIN_IDE_IRQ", ";", "#", "ifndef", "CONFIG_MSNDPIN_JOYSTICK_IO", "#", "define", "CONFIG_MSNDPIN_JOYSTICK_IO", "0", "#", "endif", "static", "int", "joystick_io", "__initdata", "=", "CONFIG_MSNDPIN_JOYSTICK_IO", ";", "/", "*", "Have", "SPDIF", "(", "Digital", ")", "Daughterboard", "*", "/", "#", "ifndef", "CONFIG_MSNDPIN_DIGITAL", "#", "define", "CONFIG_MSNDPIN_DIGITAL", "0", "#", "endif", "static", "bool", "digital", "__initdata", "=", "CONFIG_MSNDPIN_DIGITAL", ";", "#", "endif", "/", "*", "MSND_CLASSIC", "*", "/", "#", "ifndef", "CONFIG_MSND_FIFOSIZE", "#", "define", "CONFIG_MSND_FIFOSIZE", "DEFFIFOSIZE", "#", "endif", "static", "int", "fifosize", "__initdata", "=", "CONFIG_MSND_FIFOSIZE", ";", "#", "ifndef", "CONFIG_MSND_CALSIGNAL", "#", "define", "CONFIG_MSND_CALSIGNAL", "0", "#", "endif", "static", "int", "calibrate_signal", "__initdata", "=", "CONFIG_MSND_CALSIGNAL", ";", "#", "endif", "/", "*", "MODULE", "*", "/", "module_param_hw", "(", "io", ",", "int", ",", "ioport", ",", "0", ")", ";", "module_param_hw", "(", "irq", ",", "int", ",", "irq", ",", "0", ")", ";", "module_param_hw", "(", "mem", ",", "int", ",", "iomem", ",", "0", ")", ";", "module_param", "(", "write_ndelay", ",", "int", ",", "0", ")", ";", "module_param", "(", "fifosize", ",", "int", ",", "0", ")", ";", "module_param", "(", "calibrate_signal", ",", "int", ",", "0", ")", ";", "#", "ifndef", "MSND_CLASSIC", "module_param", "(", "digital", ",", "bool", ",", "0", ")", ";", "module_param_hw", "(", "cfg", ",", "int", ",", "ioport", ",", "0", ")", ";", "module_param", "(", "reset", ",", "int", ",", "0", ")", ";", "module_param_hw", "(", "mpu_io", ",", "int", ",", "ioport", ",", "0", ")", ";", "module_param_hw", "(", "mpu_irq", ",", "int", ",", "irq", ",", "0", ")", ";", "module_param_hw", "(", "ide_io0", ",", "int", ",", "ioport", ",", "0", ")", ";", "module_param_hw", "(", "ide_io1", ",", "int", ",", "ioport", ",", "0", ")", ";", "module_param_hw", "(", "ide_irq", ",", "int", ",", "irq", ",", "0", ")", ";", "module_param_hw", "(", "joystick_io", ",", "int", ",", "ioport", ",", "0", ")", ";", "#", "endif", "static", "int", "__init", "msnd_init", "(", "void", ")", "{", "int", "err", ";", "#", "ifndef", "MSND_CLASSIC", "static", "msnd_pinnacle_cfg_t", "pinnacle_devs", ";", "#", "endif", "/", "*", "MSND_CLASSIC", "*", "/", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "Turtle", "Beach", "\"", "LONGNAME", "\"", "Linux", "Driver", "Version", "\"", "VERSION", "\"", ",", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "\\", "n", "\"", ");", "if", "(", "io", "=", "=", "-", "1", "|", "|", "irq", "=", "=", "-", "1", "|", "|", "mem", "=", "=", "-", "1", ")", "printk", "(", "KERN_WARNING", "LOGNAME", "\"", ":", "io", ",", "irq", "and", "mem", "must", "be", "set", "\\", "n", "\"", ");", "#", "ifdef", "MSND_CLASSIC", "if", "(", "io", "=", "=", "-", "1", "|", "|", "!", "(", "io", "=", "=", "0x290", "|", "|", "io", "=", "=", "0x260", "|", "|", "io", "=", "=", "0x250", "|", "|", "io", "=", "=", "0x240", "|", "|", "io", "=", "=", "0x230", "|", "|", "io", "=", "=", "0x220", "|", "|", "io", "=", "=", "0x210", "|", "|", "io", "=", "=", "0x3e0", ")", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "\\", "\"", "io", "\\", "\"", "-", "DSP", "I", "/", "O", "base", "must", "be", "set", "to", "0x210", ",", "0x220", ",", "0x230", ",", "0x240", ",", "0x250", ",", "0x260", ",", "0x290", ",", "or", "0x3E0", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "#", "else", "if", "(", "io", "=", "=", "-", "1", "|", "|", "io", "<", "0x100", "|", "|", "io", ">", "0x3e0", "|", "|", "(", "io", "%", "0x10", ")", "!", "=", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "\\", "\"", "io", "\\", "\"", "-", "DSP", "I", "/", "O", "base", "must", "within", "the", "range", "0x100", "to", "0x3E0", "and", "must", "be", "evenly", "divisible", "by", "0x10", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "#", "endif", "/", "*", "MSND_CLASSIC", "*", "/", "if", "(", "irq", "=", "=", "-", "1", "|", "|", "!", "(", "irq", "=", "=", "5", "|", "|", "irq", "=", "=", "7", "|", "|", "irq", "=", "=", "9", "|", "|", "irq", "=", "=", "10", "|", "|", "irq", "=", "=", "11", "|", "|", "irq", "=", "=", "12", ")", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "\\", "\"", "irq", "\\", "\"", "-", "must", "be", "set", "to", "5", ",", "7", ",", "9", ",", "10", ",", "11", "or", "12", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "mem", "=", "=", "-", "1", "|", "|", "!", "(", "mem", "=", "=", "0xb0000", "|", "|", "mem", "=", "=", "0xc8000", "|", "|", "mem", "=", "=", "0xd0000", "|", "|", "mem", "=", "=", "0xd8000", "|", "|", "mem", "=", "=", "0xe0000", "|", "|", "mem", "=", "=", "0xe8000", ")", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "\\", "\"", "mem", "\\", "\"", "-", "must", "be", "set", "to", "\"", "\"", "0xb0000", ",", "0xc8000", ",", "0xd0000", ",", "0xd8000", ",", "0xe0000", "or", "0xe8000", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "#", "ifdef", "MSND_CLASSIC", "switch", "(", "irq", ")", "{", "case", "5", ":", "dev", ".", "irqid", "=", "HPIRQ_5", ";", "break", ";", "case", "7", ":", "dev", ".", "irqid", "=", "HPIRQ_7", ";", "break", ";", "case", "9", ":", "dev", ".", "irqid", "=", "HPIRQ_9", ";", "break", ";", "case", "10", ":", "dev", ".", "irqid", "=", "HPIRQ_10", ";", "break", ";", "case", "11", ":", "dev", ".", "irqid", "=", "HPIRQ_11", ";", "break", ";", "case", "12", ":", "dev", ".", "irqid", "=", "HPIRQ_12", ";", "break", ";", "}", "switch", "(", "mem", ")", "{", "case", "0xb0000", ":", "dev", ".", "memid", "=", "HPMEM_B000", ";", "break", ";", "case", "0xc8000", ":", "dev", ".", "memid", "=", "HPMEM_C800", ";", "break", ";", "case", "0xd0000", ":", "dev", ".", "memid", "=", "HPMEM_D000", ";", "break", ";", "case", "0xd8000", ":", "dev", ".", "memid", "=", "HPMEM_D800", ";", "break", ";", "case", "0xe0000", ":", "dev", ".", "memid", "=", "HPMEM_E000", ";", "break", ";", "case", "0xe8000", ":", "dev", ".", "memid", "=", "HPMEM_E800", ";", "break", ";", "}", "#", "else", "if", "(", "cfg", "=", "=", "-", "1", ")", "{", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "Assuming", "PnP", "mode", "\\", "n", "\"", ");", "}", "else", "if", "(", "cfg", "!", "=", "0x250", "&", "&", "cfg", "!", "=", "0x260", "&", "&", "cfg", "!", "=", "0x270", ")", "{", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "Config", "port", "must", "be", "0x250", ",", "0x260", "or", "0x270", "(", "or", "unspecified", "for", "PnP", "mode", ")", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "else", "{", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "Non", "-", "PnP", "mode", ":", "configuring", "at", "port", "0x", "%", "x", "\\", "n", "\"", ",", "cfg", ")", ";", "/", "*", "DSP", "*", "/", "pinnacle_devs", "[", "0", "]", ".", "io0", "=", "io", ";", "pinnacle_devs", "[", "0", "]", ".", "irq", "=", "irq", ";", "pinnacle_devs", "[", "0", "]", ".", "mem", "=", "mem", ";", "/", "*", "The", "following", "are", "Pinnacle", "specific", "*", "/", "/", "*", "MPU", "*", "/", "pinnacle_devs", "[", "1", "]", ".", "io0", "=", "mpu_io", ";", "pinnacle_devs", "[", "1", "]", ".", "irq", "=", "mpu_irq", ";", "/", "*", "IDE", "*", "/", "pinnacle_devs", "[", "2", "]", ".", "io0", "=", "ide_io0", ";", "pinnacle_devs", "[", "2", "]", ".", "io1", "=", "ide_io1", ";", "pinnacle_devs", "[", "2", "]", ".", "irq", "=", "ide_irq", ";", "/", "*", "Joystick", "*", "/", "pinnacle_devs", "[", "3", "]", ".", "io0", "=", "joystick_io", ";", "if", "(", "!", "request_region", "(", "cfg", ",", "2", ",", "\"", "Pinnacle", "/", "Fiji", "Config", "\"", "))", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Config", "port", "0x", "%", "x", "conflict", "\\", "n", "\"", ",", "cfg", ")", ";", "return", "-", "EIO", ";", "}", "if", "(", "msnd_pinnacle_cfg_devices", "(", "cfg", ",", "reset", ",", "pinnacle_devs", ")", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Device", "configuration", "error", "\\", "n", "\"", ");", "release_region", "(", "cfg", ",", "2", ")", ";", "return", "-", "EIO", ";", "}", "release_region", "(", "cfg", ",", "2", ")", ";", "}", "#", "endif", "/", "*", "MSND_CLASSIC", "*", "/", "if", "(", "fifosize", "<", "16", ")", "fifosize", "=", "16", ";", "if", "(", "fifosize", ">", "1024", ")", "fifosize", "=", "1024", ";", "set_default_audio_parameters", "(", ");", "#", "ifdef", "MSND_CLASSIC", "dev", ".", "type", "=", "msndClassic", ";", "#", "else", "dev", ".", "type", "=", "msndPinnacle", ";", "#", "endif", "dev", ".", "io", "=", "io", ";", "dev", ".", "numio", "=", "DSP_NUMIO", ";", "dev", ".", "irq", "=", "irq", ";", "dev", ".", "base", "=", "ioremap", "(", "mem", ",", "0x8000", ")", ";", "dev", ".", "fifosize", "=", "fifosize", "*", "1024", ";", "dev", ".", "calibrate_signal", "=", "calibrate_signal", "?", "1", ":", "0", ";", "dev", ".", "recsrc", "=", "0", ";", "dev", ".", "dspq_data_buff", "=", "DSPQ_DATA_BUFF", ";", "dev", ".", "dspq_buff_size", "=", "DSPQ_BUFF_SIZE", ";", "if", "(", "write_ndelay", "=", "=", "-", "1", ")", "write_ndelay", "=", "CONFIG_MSND_WRITE_NDELAY", ";", "if", "(", "write_ndelay", ")", "clear_bit", "(", "F_DISABLE_WRITE_NDELAY", ",", "&", "dev", ".", "flags", ")", ";", "else", "set_bit", "(", "F_DISABLE_WRITE_NDELAY", ",", "&", "dev", ".", "flags", ")", ";", "#", "ifndef", "MSND_CLASSIC", "if", "(", "digital", ")", "set_bit", "(", "F_HAVEDIGITAL", ",", "&", "dev", ".", "flags", ")", ";", "#", "endif", "init_waitqueue_head", "(", "&", "dev", ".", "writeblock", ")", ";", "init_waitqueue_head", "(", "&", "dev", ".", "readblock", ")", ";", "init_waitqueue_head", "(", "&", "dev", ".", "writeflush", ")", ";", "msnd_fifo_init", "(", "&", "dev", ".", "DAPF", ")", ";", "msnd_fifo_init", "(", "&", "dev", ".", "DARF", ")", ";", "spin_lock_init", "(", "&", "dev", ".", "lock", ")", ";", "printk", "(", "KERN_INFO", "LOGNAME", "\"", ":", "%", "u", "byte", "audio", "FIFOs", "(", "x2", ")", "\\", "n", "\"", ",", "dev", ".", "fifosize", ")", ";", "if", "(", "(", "err", "=", "msnd_fifo_alloc", "(", "&", "dev", ".", "DAPF", ",", "dev", ".", "fifosize", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Couldn", "'", "t", "allocate", "write", "FIFO", "\\", "n", "\"", ");", "return", "err", ";", "}", "if", "(", "(", "err", "=", "msnd_fifo_alloc", "(", "&", "dev", ".", "DARF", ",", "dev", ".", "fifosize", ")", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Couldn", "'", "t", "allocate", "read", "FIFO", "\\", "n", "\"", ");", "msnd_fifo_free", "(", "&", "dev", ".", "DAPF", ")", ";", "return", "err", ";", "}", "if", "(", "(", "err", "=", "probe_multisound", "(", "))", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Probe", "failed", "\\", "n", "\"", ");", "msnd_fifo_free", "(", "&", "dev", ".", "DAPF", ")", ";", "msnd_fifo_free", "(", "&", "dev", ".", "DARF", ")", ";", "return", "err", ";", "}", "if", "(", "(", "err", "=", "attach_multisound", "(", "))", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "LOGNAME", "\"", ":", "Attach", "failed", "\\", "n", "\"", ");", "msnd_fifo_free", "(", "&", "dev", ".", "DAPF", ")", ";", "msnd_fifo_free", "(", "&", "dev", ".", "DARF", ")", ";", "return", "err", ";", "}", "return", "0", ";", "}", "static", "void", "__exit", "msdn_cleanup", "(", "void", ")", "{", "unload_multisound", "(", ");", "msnd_fifo_free", "(", "&", "dev", ".", "DAPF", ")", ";", "msnd_fifo_free", "(", "&", "dev", ".", "DARF", ")", ";", "}", "module_init", "(", "msnd_init", ")", ";", "module_exit", "(", "msdn_cleanup", ")", ";", "@", "@", "-", "1", ",", "246", "+", "0", ",", "0", "@", "@", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "*", "*", "msnd_pinnacle", ".", "h", "*", "*", "Turtle", "Beach", "MultiSound", "Sound", "Card", "Driver", "for", "Linux", "*", "*", "Some", "parts", "of", "this", "header", "file", "were", "derived", "from", "the", "Turtle", "Beach", "*", "MultiSound", "Driver", "Development", "Kit", ".", "*", "*", "Copyright", "(", "C", ")", "1998", "Andrew", "Veliath", "*", "Copyright", "(", "C", ")", "1993", "Turtle", "Beach", "Systems", ",", "Inc", ".", "*", "*", "This", "program", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "*", "it", "under", "the", "terms", "of", "the", "GNU", "General", "Public", "License", "as", "published", "by", "*", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", "of", "the", "License", ",", "or", "*", "(", "at", "your", "option", ")", "any", "later", "version", ".", "*", "*", "This", "program", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "*", "GNU", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "General", "Public", "License", "*", "along", "with", "this", "program", ";", "if", "not", ",", "write", "to", "the", "Free", "Software", "*", "Foundation", ",", "Inc", ".", ",", "675", "Mass", "Ave", ",", "Cambridge", ",", "MA", "02139", ",", "USA", ".", "*", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "#", "ifndef", "__MSND_PINNACLE_H", "#", "define", "__MSND_PINNACLE_H", "#", "define", "DSP_NUMIO", "0x08", "#", "define", "IREG_LOGDEVICE", "0x07", "#", "define", "IREG_ACTIVATE", "0x30", "#", "define", "LD_ACTIVATE", "0x01", "#", "define", "LD_DISACTIVATE", "0x00", "#", "define", "IREG_EECONTROL", "0x3F", "#", "define", "IREG_MEMBASEHI", "0x40", "#", "define", "IREG_MEMBASELO", "0x41", "#", "define", "IREG_MEMCONTROL", "0x42", "#", "define", "IREG_MEMRANGEHI", "0x43", "#", "define", "IREG_MEMRANGELO", "0x44", "#", "define", "MEMTYPE_8BIT", "0x00", "#", "define", "MEMTYPE_16BIT", "0x02", "#", "define", "MEMTYPE_RANGE", "0x00", "#", "define", "MEMTYPE_HIADDR", "0x01", "#", "define", "IREG_IO0_BASEHI", "0x60", "#", "define", "IREG_IO0_BASELO", "0x61", "#", "define", "IREG_IO1_BASEHI", "0x62", "#", "define", "IREG_IO1_BASELO", "0x63", "#", "define", "IREG_IRQ_NUMBER", "0x70", "#", "define", "IREG_IRQ_TYPE", "0x71", "#", "define", "IRQTYPE_HIGH", "0x02", "#", "define", "IRQTYPE_LOW", "0x00", "#", "define", "IRQTYPE_LEVEL", "0x01", "#", "define", "IRQTYPE_EDGE", "0x00", "#", "define", "HP_DSPR", "0x04", "#", "define", "HP_BLKS", "0x04", "#", "define", "HPDSPRESET_OFF", "2", "#", "define", "HPDSPRESET_ON", "0", "#", "define", "HPBLKSEL_0", "2", "#", "define", "HPBLKSEL_1", "3", "#", "define", "HIMT_DAT_OFF", "0x03", "#", "define", "HIDSP_PLAY_UNDER", "0x00", "#", "define", "HIDSP_INT_PLAY_UNDER", "0x01", "#", "define", "HIDSP_SSI_TX_UNDER", "0x02", "#", "define", "HIDSP_RECQ_OVERFLOW", "0x08", "#", "define", "HIDSP_INT_RECORD_OVER", "0x09", "#", "define", "HIDSP_SSI_RX_OVERFLOW", "0x0a", "#", "define", "HIDSP_MIDI_IN_OVER", "0x10", "#", "define", "HIDSP_MIDI_FRAME_ERR", "0x11", "#", "define", "HIDSP_MIDI_PARITY_ERR", "0x12", "#", "define", "HIDSP_MIDI_OVERRUN_ERR", "0x13", "#", "define", "HIDSP_INPUT_CLIPPING", "0x20", "#", "define", "HIDSP_MIX_CLIPPING", "0x30", "#", "define", "HIDSP_DAT_IN_OFF", "0x21", "#", "define", "HDEXAR_SET_ANA_IN", "0", "#", "define", "HDEXAR_CLEAR_PEAKS", "1", "#", "define", "HDEXAR_IN_SET_POTS", "2", "#", "define", "HDEXAR_AUX_SET_POTS", "3", "#", "define", "HDEXAR_CAL_A_TO_D", "4", "#", "define", "HDEXAR_RD_EXT_DSP_BITS", "5", "#", "define", "HDEXAR_SET_SYNTH_IN", "4", "#", "define", "HDEXAR_READ_DAT_IN", "5", "#", "define", "HDEXAR_MIC_SET_POTS", "6", "#", "define", "HDEXAR_SET_DAT_IN", "7", "#", "define", "HDEXAR_SET_SYNTH_48", "8", "#", "define", "HDEXAR_SET_SYNTH_44", "9", "#", "define", "TIME_PRO_RESET_DONE", "0x028A", "#", "define", "TIME_PRO_SYSEX", "0x001E", "#", "define", "TIME_PRO_RESET", "0x0032", "#", "define", "AGND", "0x01", "#", "define", "SIGNAL", "0x02", "#", "define", "EXT_DSP_BIT_DCAL", "0x0001", "#", "define", "EXT_DSP_BIT_MIDI_CON", "0x0002", "#", "define", "BUFFSIZE", "0x8000", "#", "define", "HOSTQ_SIZE", "0x40", "#", "define", "SRAM_CNTL_START", "0x7F00", "#", "define", "SMA_STRUCT_START", "0x7F40", "#", "define", "DAP_BUFF_SIZE", "0x2400", "#", "define", "DAR_BUFF_SIZE", "0x2000", "#", "define", "DAPQ_STRUCT_SIZE", "0x10", "#", "define", "DARQ_STRUCT_SIZE", "0x10", "#", "define", "DAPQ_BUFF_SIZE", "(", "3", "*", "0x10", ")", "#", "define", "DARQ_BUFF_SIZE", "(", "3", "*", "0x10", ")", "#", "define", "MODQ_BUFF_SIZE", "0x400", "#", "define", "MIDQ_BUFF_SIZE", "0x800", "#", "define", "DSPQ_BUFF_SIZE", "0x5A0", "#", "define", "DAPQ_DATA_BUFF", "0x6C00", "#", "define", "DARQ_DATA_BUFF", "0x6C30", "#", "define", "MODQ_DATA_BUFF", "0x6C60", "#", "define", "MIDQ_DATA_BUFF", "0x7060", "#", "define", "DSPQ_DATA_BUFF", "0x7860", "#", "define", "DAPQ_OFFSET", "SRAM_CNTL_START", "#", "define", "DARQ_OFFSET", "(", "SRAM_CNTL_START", "+", "0x08", ")", "#", "define", "MODQ_OFFSET", "(", "SRAM_CNTL_START", "+", "0x10", ")", "#", "define", "MIDQ_OFFSET", "(", "SRAM_CNTL_START", "+", "0x18", ")", "#", "define", "DSPQ_OFFSET", "(", "SRAM_CNTL_START", "+", "0x20", ")", "#", "define", "MOP_WAVEHDR", "0", "#", "define", "MOP_EXTOUT", "1", "#", "define", "MOP_HWINIT", "0xfe", "#", "define", "MOP_NONE", "0xff", "#", "define", "MOP_MAX", "1", "#", "define", "MIP_EXTIN", "0", "#", "define", "MIP_WAVEHDR", "1", "#", "define", "MIP_HWINIT", "0xfe", "#", "define", "MIP_MAX", "1", "/", "*", "Pinnacle", "/", "Fiji", "SMA", "Common", "Data", "*", "/", "#", "define", "SMA_wCurrPlayBytes", "0x0000", "#", "define", "SMA_wCurrRecordBytes", "0x0002", "#", "define", "SMA_wCurrPlayVolLeft", "0x0004", "#", "define", "SMA_wCurrPlayVolRight", "0x0006", "#", "define", "SMA_wCurrInVolLeft", "0x0008", "#", "define", "SMA_wCurrInVolRight", "0x000a", "#", "define", "SMA_wCurrMHdrVolLeft", "0x000c", "#", "define", "SMA_wCurrMHdrVolRight", "0x000e", "#", "define", "SMA_dwCurrPlayPitch", "0x0010", "#", "define", "SMA_dwCurrPlayRate", "0x0014", "#", "define", "SMA_wCurrMIDIIOPatch", "0x0018", "#", "define", "SMA_wCurrPlayFormat", "0x001a", "#", "define", "SMA_wCurrPlaySampleSize", "0x001c", "#", "define", "SMA_wCurrPlayChannels", "0x001e", "#", "define", "SMA_wCurrPlaySampleRate", "0x0020", "#", "define", "SMA_wCurrRecordFormat", "0x0022", "#", "define", "SMA_wCurrRecordSampleSize", "0x0024", "#", "define", "SMA_wCurrRecordChannels", "0x0026", "#", "define", "SMA_wCurrRecordSampleRate", "0x0028", "#", "define", "SMA_wCurrDSPStatusFlags", "0x002a", "#", "define", "SMA_wCurrHostStatusFlags", "0x002c", "#", "define", "SMA_wCurrInputTagBits", "0x002e", "#", "define", "SMA_wCurrLeftPeak", "0x0030", "#", "define", "SMA_wCurrRightPeak", "0x0032", "#", "define", "SMA_bMicPotPosLeft", "0x0034", "#", "define", "SMA_bMicPotPosRight", "0x0035", "#", "define", "SMA_bMicPotMaxLeft", "0x0036", "#", "define", "SMA_bMicPotMaxRight", "0x0037", "#", "define", "SMA_bInPotPosLeft", "0x0038", "#", "define", "SMA_bInPotPosRight", "0x0039", "#", "define", "SMA_bAuxPotPosLeft", "0x003a", "#", "define", "SMA_bAuxPotPosRight", "0x003b", "#", "define", "SMA_bInPotMaxLeft", "0x003c", "#", "define", "SMA_bInPotMaxRight", "0x003d", "#", "define", "SMA_bAuxPotMaxLeft", "0x003e", "#", "define", "SMA_bAuxPotMaxRight", "0x003f", "#", "define", "SMA_bInPotMaxMethod", "0x0040", "#", "define", "SMA_bAuxPotMaxMethod", "0x0041", "#", "define", "SMA_wCurrMastVolLeft", "0x0042", "#", "define", "SMA_wCurrMastVolRight", "0x0044", "#", "define", "SMA_wCalFreqAtoD", "0x0046", "#", "define", "SMA_wCurrAuxVolLeft", "0x0048", "#", "define", "SMA_wCurrAuxVolRight", "0x004a", "#", "define", "SMA_wCurrPlay1VolLeft", "0x004c", "#", "define", "SMA_wCurrPlay1VolRight", "0x004e", "#", "define", "SMA_wCurrPlay2VolLeft", "0x0050", "#", "define", "SMA_wCurrPlay2VolRight", "0x0052", "#", "define", "SMA_wCurrPlay3VolLeft", "0x0054", "#", "define", "SMA_wCurrPlay3VolRight", "0x0056", "#", "define", "SMA_wCurrPlay4VolLeft", "0x0058", "#", "define", "SMA_wCurrPlay4VolRight", "0x005a", "#", "define", "SMA_wCurrPlay1PeakLeft", "0x005c", "#", "define", "SMA_wCurrPlay1PeakRight", "0x005e", "#", "define", "SMA_wCurrPlay2PeakLeft", "0x0060", "#", "define", "SMA_wCurrPlay2PeakRight", "0x0062", "#", "define", "SMA_wCurrPlay3PeakLeft", "0x0064", "#", "define", "SMA_wCurrPlay3PeakRight", "0x0066", "#", "define", "SMA_wCurrPlay4PeakLeft", "0x0068", "#", "define", "SMA_wCurrPlay4PeakRight", "0x006a", "#", "define", "SMA_wCurrPlayPeakLeft", "0x006c", "#", "define", "SMA_wCurrPlayPeakRight", "0x006e", "#", "define", "SMA_wCurrDATSR", "0x0070", "#", "define", "SMA_wCurrDATRXCHNL", "0x0072", "#", "define", "SMA_wCurrDATTXCHNL", "0x0074", "#", "define", "SMA_wCurrDATRXRate", "0x0076", "#", "define", "SMA_dwDSPPlayCount", "0x0078", "#", "define", "SMA__size", "0x007c", "#", "ifdef", "HAVE_DSPCODEH", "#", "include", "\"", "pndsperm", ".", "c", "\"", "#", "include", "\"", "pndspini", ".", "c", "\"", "#", "define", "PERMCODE", "pndsperm", "#", "define", "INITCODE", "pndspini", "#", "define", "PERMCODESIZE", "sizeof", "(", "pndsperm", ")", "#", "define", "INITCODESIZE", "sizeof", "(", "pndspini", ")", "#", "else", "#", "ifndef", "CONFIG_MSNDPIN_INIT_FILE", "#", "define", "CONFIG_MSNDPIN_INIT_FILE", "\\", "\"", "/", "etc", "/", "sound", "/", "pndspini", ".", "bin", "\"", "#", "endif", "#", "ifndef", "CONFIG_MSNDPIN_PERM_FILE", "#", "define", "CONFIG_MSNDPIN_PERM_FILE", "\\", "\"", "/", "etc", "/", "sound", "/", "pndsperm", ".", "bin", "\"", "#", "endif", "#", "define", "PERMCODEFILE", "CONFIG_MSNDPIN_PERM_FILE", "#", "define", "INITCODEFILE", "CONFIG_MSNDPIN_INIT_FILE", "#", "define", "PERMCODE", "dspini", "#", "define", "INITCODE", "permini", "#", "define", "PERMCODESIZE", "sizeof_dspini", "#", "define", "INITCODESIZE", "sizeof_permini", "#", "endif", "#", "define", "LONGNAME", "\"", "MultiSound", "(", "Pinnacle", "/", "Fiji", ")", "\"", "#", "endif", "/", "*", "__MSND_PINNACLE_H", "*", "/", "@", "@", "-", "1", ",", "1255", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "opl3", ".", "c", "*", "*", "A", "low", "level", "driver", "for", "Yamaha", "YM3812", "and", "OPL", "-", "3", "-", "chips", "*", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "*", "*", "Changes", "*", "Thomas", "Sailer", "ioctl", "code", "reworked", "(", "vmalloc", "/", "vfree", "removed", ")", "*", "Alan", "Cox", "modularisation", ",", "fixed", "sound_mem", "allocs", ".", "*", "Christoph", "Hellwig", "Adapted", "to", "module_init", "/", "module_exit", "*", "Arnaldo", "C", ".", "de", "Melo", "get", "rid", "of", "check_region", ",", "use", "request_region", "for", "*", "OPL4", ",", "release", "it", "on", "exit", ",", "some", "cleanups", ".", "*", "*", "Status", "*", "Believed", "to", "work", ".", "Badly", "needs", "rewriting", "a", "bit", "to", "support", "multiple", "*", "OPL3", "devices", ".", "*", "/", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "slab", ".", "h", ">", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "delay", ".", "h", ">", "/", "*", "*", "Major", "improvements", "to", "the", "FM", "handling", "30AUG92", "by", "Rob", "Hooft", ",", "*", "hooft", "@", "chem", ".", "ruu", ".", "nl", "*", "/", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "opl3_hw", ".", "h", "\"", "#", "define", "MAX_VOICE", "18", "#", "define", "OFFS_4OP", "11", "struct", "voice_info", "{", "unsigned", "char", "keyon_byte", ";", "long", "bender", ";", "long", "bender_range", ";", "unsigned", "long", "orig_freq", ";", "unsigned", "long", "current_freq", ";", "int", "volume", ";", "int", "mode", ";", "int", "panning", ";", "/", "*", "0xffff", "means", "not", "set", "*", "/", "}", ";", "struct", "opl_devinfo", "{", "int", "base", ";", "int", "left_io", ",", "right_io", ";", "int", "nr_voice", ";", "int", "lv_map", "[", "MAX_VOICE", "]", ";", "struct", "voice_info", "voc", "[", "MAX_VOICE", "]", ";", "struct", "voice_alloc_info", "*", "v_alloc", ";", "struct", "channel_info", "*", "chn_info", ";", "struct", "sbi_instrument", "i_map", "[", "SBFM_MAXINSTR", "]", ";", "struct", "sbi_instrument", "*", "act_i", "[", "MAX_VOICE", "]", ";", "struct", "synth_info", "fm_info", ";", "int", "busy", ";", "int", "model", ";", "unsigned", "char", "cmask", ";", "int", "is_opl4", ";", "}", ";", "static", "struct", "opl_devinfo", "*", "devc", "=", "NULL", ";", "static", "int", "detected_model", ";", "static", "int", "store_instr", "(", "int", "instr_no", ",", "struct", "sbi_instrument", "*", "instr", ")", ";", "static", "void", "freq_to_fnum", "(", "int", "freq", ",", "int", "*", "block", ",", "int", "*", "fnum", ")", ";", "static", "void", "opl3_command", "(", "int", "io_addr", ",", "unsigned", "int", "addr", ",", "unsigned", "int", "val", ")", ";", "static", "int", "opl3_kill_note", "(", "int", "dev", ",", "int", "voice", ",", "int", "note", ",", "int", "velocity", ")", ";", "static", "void", "enter_4op_mode", "(", "void", ")", "{", "int", "i", ";", "static", "int", "v4op", "[", "MAX_VOICE", "]", "=", "{", "0", ",", "1", ",", "2", ",", "9", ",", "10", ",", "11", ",", "6", ",", "7", ",", "8", ",", "15", ",", "16", ",", "17", "}", ";", "devc", "-", ">", "cmask", "=", "0x3f", ";", "/", "*", "Connect", "all", "possible", "4", "OP", "voice", "operators", "*", "/", "opl3_command", "(", "devc", "-", ">", "right_io", ",", "CONNECTION_SELECT_REGISTER", ",", "0x3f", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "3", ";", "i", "+", "+)", "pv_map", "[", "i", "]", ".", "voice_mode", "=", "4", ";", "for", "(", "i", "=", "3", ";", "i", "<", "6", ";", "i", "+", "+)", "pv_map", "[", "i", "]", ".", "voice_mode", "=", "0", ";", "for", "(", "i", "=", "9", ";", "i", "<", "12", ";", "i", "+", "+)", "pv_map", "[", "i", "]", ".", "voice_mode", "=", "4", ";", "for", "(", "i", "=", "12", ";", "i", "<", "15", ";", "i", "+", "+)", "pv_map", "[", "i", "]", ".", "voice_mode", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "12", ";", "i", "+", "+)", "devc", "-", ">", "lv_map", "[", "i", "]", "=", "v4op", "[", "i", "]", ";", "devc", "-", ">", "v_alloc", "-", ">", "max_voice", "=", "devc", "-", ">", "nr_voice", "=", "12", ";", "}", "static", "int", "opl3_ioctl", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", "{", "struct", "sbi_instrument", "ins", ";", "switch", "(", "cmd", ")", "{", "case", "SNDCTL_FM_LOAD_INSTR", ":", "printk", "(", "KERN_WARNING", "\"", "Warning", ":", "Obsolete", "ioctl", "(", "SNDCTL_FM_LOAD_INSTR", ")", "used", ".", "Fix", "the", "program", ".", "\\", "n", "\"", ");", "if", "(", "copy_from_user", "(", "&", "ins", ",", "arg", ",", "sizeof", "(", "ins", ")", "))", "return", "-", "EFAULT", ";", "if", "(", "ins", ".", "channel", "<", "0", "|", "|", "ins", ".", "channel", ">", "=", "SBFM_MAXINSTR", ")", "{", "printk", "(", "KERN_WARNING", "\"", "FM", "Error", ":", "Invalid", "instrument", "number", "%", "d", "\\", "n", "\"", ",", "ins", ".", "channel", ")", ";", "return", "-", "EINVAL", ";", "}", "return", "store_instr", "(", "ins", ".", "channel", ",", "&", "ins", ")", ";", "case", "SNDCTL_SYNTH_INFO", ":", "devc", "-", ">", "fm_info", ".", "nr_voices", "=", "(", "devc", "-", ">", "nr_voice", "=", "=", "12", ")", "?", "6", ":", "devc", "-", ">", "nr_voice", ";", "if", "(", "copy_to_user", "(", "arg", ",", "&", "devc", "-", ">", "fm_info", ",", "sizeof", "(", "devc", "-", ">", "fm_info", ")", "))", "return", "-", "EFAULT", ";", "return", "0", ";", "case", "SNDCTL_SYNTH_MEMAVL", ":", "return", "0x7fffffff", ";", "case", "SNDCTL_FM_4OP_ENABLE", ":", "if", "(", "devc", "-", ">", "model", "=", "=", "2", ")", "enter_4op_mode", "(", ");", "return", "0", ";", "default", ":", "return", "-", "EINVAL", ";", "}", "}", "static", "int", "opl3_detect", "(", "int", "ioaddr", ")", "{", "/", "*", "*", "This", "function", "returns", "1", "if", "the", "FM", "chip", "is", "present", "at", "the", "given", "I", "/", "O", "port", "*", "The", "detection", "algorithm", "plays", "with", "the", "timer", "built", "in", "the", "FM", "chip", "and", "*", "looks", "for", "a", "change", "in", "the", "status", "register", ".", "*", "*", "Note", "!", "The", "timers", "of", "the", "FM", "chip", "are", "not", "connected", "to", "AdLib", "(", "and", "compatible", ")", "*", "boards", ".", "*", "*", "Note2", "!", "The", "chip", "is", "initialized", "if", "detected", ".", "*", "/", "unsigned", "char", "stat1", ",", "signature", ";", "int", "i", ";", "if", "(", "devc", "!", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "opl3", ":", "Only", "one", "OPL3", "supported", ".", "\\", "n", "\"", ");", "return", "0", ";", "}", "devc", "=", "kzalloc", "(", "sizeof", "(", "*", "devc", ")", ",", "GFP_KERNEL", ")", ";", "if", "(", "devc", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "opl3", ":", "Can", "'", "t", "allocate", "memory", "for", "the", "device", "control", "\"", "\"", "structure", "\\", "n", "\"", ");", "return", "0", ";", "}", "strcpy", "(", "devc", "-", ">", "fm_info", ".", "name", ",", "\"", "OPL2", "\"", ");", "if", "(", "!", "request_region", "(", "ioaddr", ",", "4", ",", "devc", "-", ">", "fm_info", ".", "name", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "opl3", ":", "I", "/", "O", "port", "0x", "%", "x", "already", "in", "use", "\\", "n", "\"", ",", "ioaddr", ")", ";", "goto", "cleanup_devc", ";", "}", "devc", "-", ">", "base", "=", "ioaddr", ";", "/", "*", "Reset", "timers", "1", "and", "2", "*", "/", "opl3_command", "(", "ioaddr", ",", "TIMER_CONTROL_REGISTER", ",", "TIMER1_MASK", "|", "TIMER2_MASK", ")", ";", "/", "*", "Reset", "the", "IRQ", "of", "the", "FM", "chip", "*", "/", "opl3_command", "(", "ioaddr", ",", "TIMER_CONTROL_REGISTER", ",", "IRQ_RESET", ")", ";", "signature", "=", "stat1", "=", "inb", "(", "ioaddr", ")", ";", "/", "*", "Status", "register", "*", "/", "if", "(", "signature", "!", "=", "0x00", "&", "&", "signature", "!", "=", "0x06", "&", "&", "signature", "!", "=", "0x02", "&", "&", "signature", "!", "=", "0x0f", ")", "{", "MDB", "(", "printk", "(", "KERN_INFO", "\"", "OPL3", "not", "detected", "%", "x", "\\", "n", "\"", ",", "signature", ")", ");", "goto", "cleanup_region", ";", "}", "if", "(", "signature", "=", "=", "0x06", ")", "/", "*", "OPL2", "*", "/", "{", "detected_model", "=", "2", ";", "}", "else", "if", "(", "signature", "=", "=", "0x00", "|", "|", "signature", "=", "=", "0x0f", ")", "/", "*", "OPL3", "or", "OPL4", "*", "/", "{", "unsigned", "char", "tmp", ";", "detected_model", "=", "3", ";", "/", "*", "*", "Detect", "availability", "of", "OPL4", "(", "_experimental_", ")", ".", "Works", "probably", "*", "only", "after", "a", "cold", "boot", ".", "In", "addition", "the", "OPL4", "port", "*", "of", "the", "chip", "may", "not", "be", "connected", "to", "the", "PC", "bus", "at", "all", ".", "*", "/", "opl3_command", "(", "ioaddr", "+", "2", ",", "OPL3_MODE_REGISTER", ",", "0x00", ")", ";", "opl3_command", "(", "ioaddr", "+", "2", ",", "OPL3_MODE_REGISTER", ",", "OPL3_ENABLE", "|", "OPL4_ENABLE", ")", ";", "if", "(", "(", "tmp", "=", "inb", "(", "ioaddr", ")", ")", "=", "=", "0x02", ")", "/", "*", "Have", "a", "OPL4", "*", "/", "{", "detected_model", "=", "4", ";", "}", "if", "(", "request_region", "(", "ioaddr", "-", "8", ",", "2", ",", "\"", "OPL4", "\"", "))", "/", "*", "OPL4", "port", "was", "free", "*", "/", "{", "int", "tmp", ";", "outb", "(", "(", "0x02", ")", ",", "ioaddr", "-", "8", ")", ";", "/", "*", "Select", "OPL4", "ID", "register", "*", "/", "udelay", "(", "10", ")", ";", "tmp", "=", "inb", "(", "ioaddr", "-", "7", ")", ";", "/", "*", "Read", "it", "*", "/", "udelay", "(", "10", ")", ";", "if", "(", "tmp", "=", "=", "0x20", ")", "/", "*", "OPL4", "should", "return", "0x20", "here", "*", "/", "{", "detected_model", "=", "4", ";", "outb", "(", "(", "0xF8", ")", ",", "ioaddr", "-", "8", ")", ";", "/", "*", "Select", "OPL4", "FM", "mixer", "control", "*", "/", "udelay", "(", "10", ")", ";", "outb", "(", "(", "0x1B", ")", ",", "ioaddr", "-", "7", ")", ";", "/", "*", "Write", "value", "*", "/", "udelay", "(", "10", ")", ";", "}", "else", "{", "/", "*", "release", "OPL4", "port", "*", "/", "release_region", "(", "ioaddr", "-", "8", ",", "2", ")", ";", "detected_model", "=", "3", ";", "}", "}", "opl3_command", "(", "ioaddr", "+", "2", ",", "OPL3_MODE_REGISTER", ",", "0", ")", ";", "}", "for", "(", "i", "=", "0", ";", "i", "<", "9", ";", "i", "+", "+)", "opl3_command", "(", "ioaddr", ",", "KEYON_BLOCK", "+", "i", ",", "0", ")", ";", "/", "*", "*", "Note", "off", "*", "/", "opl3_command", "(", "ioaddr", ",", "TEST_REGISTER", ",", "ENABLE_WAVE_SELECT", ")", ";", "opl3_command", "(", "ioaddr", ",", "PERCOSSION_REGISTER", ",", "0x00", ")", ";", "/", "*", "*", "Melodic", "mode", ".", "*", "/", "return", "1", ";", "cleanup_region", ":", "release_region", "(", "ioaddr", ",", "4", ")", ";", "cleanup_devc", ":", "kfree", "(", "devc", ")", ";", "devc", "=", "NULL", ";", "return", "0", ";", "}", "static", "int", "opl3_kill_note", "(", "int", "devno", ",", "int", "voice", ",", "int", "note", ",", "int", "velocity", ")", "{", "struct", "physical_voice_info", "*", "map", ";", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", "0", ";", "devc", "-", ">", "v_alloc", "-", ">", "map", "[", "voice", "]", "=", "0", ";", "map", "=", "&", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "voice", "]", "];", "if", "(", "map", "-", ">", "voice_mode", "=", "=", "0", ")", "return", "0", ";", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KEYON_BLOCK", "+", "map", "-", ">", "voice_num", ",", "devc", "-", ">", "voc", "[", "voice", "]", ".", "keyon_byte", "&", "~", "0x20", ")", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "keyon_byte", "=", "0", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender", "=", "0", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "volume", "=", "64", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "panning", "=", "0xffff", ";", "/", "*", "Not", "set", "*", "/", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender_range", "=", "200", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "orig_freq", "=", "0", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "current_freq", "=", "0", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "mode", "=", "0", ";", "return", "0", ";", "}", "#", "define", "HIHAT", "0", "#", "define", "CYMBAL", "1", "#", "define", "TOMTOM", "2", "#", "define", "SNARE", "3", "#", "define", "BDRUM", "4", "#", "define", "UNDEFINED", "TOMTOM", "#", "define", "DEFAULT", "TOMTOM", "static", "int", "store_instr", "(", "int", "instr_no", ",", "struct", "sbi_instrument", "*", "instr", ")", "{", "if", "(", "instr", "-", ">", "key", "!", "=", "FM_PATCH", "&", "&", "(", "instr", "-", ">", "key", "!", "=", "OPL3_PATCH", "|", "|", "devc", "-", ">", "model", "!", "=", "2", ")", ")", "printk", "(", "KERN_WARNING", "\"", "FM", "warning", ":", "Invalid", "patch", "format", "field", "(", "key", ")", "0x", "%", "x", "\\", "n", "\"", ",", "instr", "-", ">", "key", ")", ";", "memcpy", "(", "(", "char", "*", ")", "&", "(", "devc", "-", ">", "i_map", "[", "instr_no", "]", "),", "(", "char", "*", ")", "instr", ",", "sizeof", "(", "*", "instr", ")", ");", "return", "0", ";", "}", "static", "int", "opl3_set_instr", "(", "int", "dev", ",", "int", "voice", ",", "int", "instr_no", ")", "{", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", "0", ";", "if", "(", "instr_no", "<", "0", "|", "|", "instr_no", ">", "=", "SBFM_MAXINSTR", ")", "instr_no", "=", "0", ";", "/", "*", "Acoustic", "piano", "(", "usually", ")", "*", "/", "devc", "-", ">", "act_i", "[", "voice", "]", "=", "&", "devc", "-", ">", "i_map", "[", "instr_no", "]", ";", "return", "0", ";", "}", "/", "*", "*", "The", "next", "table", "looks", "magical", ",", "but", "it", "certainly", "is", "not", ".", "Its", "values", "have", "*", "been", "calculated", "as", "table", "[", "i", "]", "=", "8", "*", "log", "(", "i", "/", "64", ")", "/", "log", "(", "2", ")", "with", "an", "obvious", "exception", "*", "for", "i", "=", "0", ".", "This", "log", "-", "table", "converts", "a", "linear", "volume", "-", "scaling", "(", "0", ".", ".", "127", ")", "to", "a", "*", "logarithmic", "scaling", "as", "present", "in", "the", "FM", "-", "synthesizer", "chips", ".", "so", ":", "Volume", "*", "64", "=", "0", "db", "=", "relative", "volume", "0", "and", ":", "Volume", "32", "=", "-", "6", "db", "=", "relative", "*", "volume", "-", "8", "it", "was", "implemented", "as", "a", "table", "because", "it", "is", "only", "128", "bytes", "and", "*", "it", "saves", "a", "lot", "of", "log", "(", ")", "calculations", ".", "(", "RH", ")", "*", "/", "static", "char", "fm_volume_table", "[", "128", "]", "=", "{", "-", "64", ",", "-", "48", ",", "-", "40", ",", "-", "35", ",", "-", "32", ",", "-", "29", ",", "-", "27", ",", "-", "26", ",", "-", "24", ",", "-", "23", ",", "-", "21", ",", "-", "20", ",", "-", "19", ",", "-", "18", ",", "-", "18", ",", "-", "17", ",", "-", "16", ",", "-", "15", ",", "-", "15", ",", "-", "14", ",", "-", "13", ",", "-", "13", ",", "-", "12", ",", "-", "12", ",", "-", "11", ",", "-", "11", ",", "-", "10", ",", "-", "10", ",", "-", "10", ",", "-", "9", ",", "-", "9", ",", "-", "8", ",", "-", "8", ",", "-", "8", ",", "-", "7", ",", "-", "7", ",", "-", "7", ",", "-", "6", ",", "-", "6", ",", "-", "6", ",", "-", "5", ",", "-", "5", ",", "-", "5", ",", "-", "5", ",", "-", "4", ",", "-", "4", ",", "-", "4", ",", "-", "4", ",", "-", "3", ",", "-", "3", ",", "-", "3", ",", "-", "3", ",", "-", "2", ",", "-", "2", ",", "-", "2", ",", "-", "2", ",", "-", "2", ",", "-", "1", ",", "-", "1", ",", "-", "1", ",", "-", "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "2", ",", "3", ",", "3", ",", "3", ",", "3", ",", "3", ",", "3", ",", "3", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "4", ",", "5", ",", "5", ",", "5", ",", "5", ",", "5", ",", "5", ",", "5", ",", "5", ",", "5", ",", "6", ",", "6", ",", "6", ",", "6", ",", "6", ",", "6", ",", "6", ",", "6", ",", "6", ",", "7", ",", "7", ",", "7", ",", "7", ",", "7", ",", "7", ",", "7", ",", "7", ",", "7", ",", "7", ",", "8", ",", "8", ",", "8", ",", "8", ",", "8", "}", ";", "static", "void", "calc_vol", "(", "unsigned", "char", "*", "regbyte", ",", "int", "volume", ",", "int", "main_vol", ")", "{", "int", "level", "=", "(", "~*", "regbyte", "&", "0x3f", ")", ";", "if", "(", "main_vol", ">", "127", ")", "main_vol", "=", "127", ";", "volume", "=", "(", "volume", "*", "main_vol", ")", "/", "127", ";", "if", "(", "level", ")", "level", "+", "=", "fm_volume_table", "[", "volume", "]", ";", "if", "(", "level", ">", "0x3f", ")", "level", "=", "0x3f", ";", "if", "(", "level", "<", "0", ")", "level", "=", "0", ";", "*", "regbyte", "=", "(", "*", "regbyte", "&", "0xc0", ")", "|", "(", "~", "level", "&", "0x3f", ")", ";", "}", "static", "void", "set_voice_volume", "(", "int", "voice", ",", "int", "volume", ",", "int", "main_vol", ")", "{", "unsigned", "char", "vol1", ",", "vol2", ",", "vol3", ",", "vol4", ";", "struct", "sbi_instrument", "*", "instr", ";", "struct", "physical_voice_info", "*", "map", ";", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", ";", "map", "=", "&", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "voice", "]", "];", "instr", "=", "devc", "-", ">", "act_i", "[", "voice", "]", ";", "if", "(", "!", "instr", ")", "instr", "=", "&", "devc", "-", ">", "i_map", "[", "0", "]", ";", "if", "(", "instr", "-", ">", "channel", "<", "0", ")", "return", ";", "if", "(", "devc", "-", ">", "voc", "[", "voice", "]", ".", "mode", "=", "=", "0", ")", "return", ";", "if", "(", "devc", "-", ">", "voc", "[", "voice", "]", ".", "mode", "=", "=", "2", ")", "{", "vol1", "=", "instr", "-", ">", "operators", "[", "2", "]", ";", "vol2", "=", "instr", "-", ">", "operators", "[", "3", "]", ";", "if", "(", "(", "instr", "-", ">", "operators", "[", "10", "]", "&", "0x01", ")", ")", "{", "calc_vol", "(", "&", "vol1", ",", "volume", ",", "main_vol", ")", ";", "calc_vol", "(", "&", "vol2", ",", "volume", ",", "main_vol", ")", ";", "}", "else", "{", "calc_vol", "(", "&", "vol2", ",", "volume", ",", "main_vol", ")", ";", "}", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "0", "]", ",", "vol1", ")", ";", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "1", "]", ",", "vol2", ")", ";", "}", "else", "{", "/", "*", "*", "4", "OP", "voice", "*", "/", "int", "connection", ";", "vol1", "=", "instr", "-", ">", "operators", "[", "2", "]", ";", "vol2", "=", "instr", "-", ">", "operators", "[", "3", "]", ";", "vol3", "=", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "2", "]", ";", "vol4", "=", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "3", "]", ";", "/", "*", "*", "The", "connection", "method", "for", "4", "OP", "devc", "-", ">", "voc", "is", "defined", "by", "the", "rightmost", "*", "bits", "at", "the", "offsets", "10", "and", "10", "+", "OFFS_4OP", "*", "/", "connection", "=", "(", "(", "instr", "-", ">", "operators", "[", "10", "]", "&", "0x01", ")", "<", "<", "1", ")", "|", "(", "instr", "-", ">", "operators", "[", "10", "+", "OFFS_4OP", "]", "&", "0x01", ")", ";", "switch", "(", "connection", ")", "{", "case", "0", ":", "calc_vol", "(", "&", "vol4", ",", "volume", ",", "main_vol", ")", ";", "break", ";", "case", "1", ":", "calc_vol", "(", "&", "vol2", ",", "volume", ",", "main_vol", ")", ";", "calc_vol", "(", "&", "vol4", ",", "volume", ",", "main_vol", ")", ";", "break", ";", "case", "2", ":", "calc_vol", "(", "&", "vol1", ",", "volume", ",", "main_vol", ")", ";", "calc_vol", "(", "&", "vol4", ",", "volume", ",", "main_vol", ")", ";", "break", ";", "case", "3", ":", "calc_vol", "(", "&", "vol1", ",", "volume", ",", "main_vol", ")", ";", "calc_vol", "(", "&", "vol3", ",", "volume", ",", "main_vol", ")", ";", "calc_vol", "(", "&", "vol4", ",", "volume", ",", "main_vol", ")", ";", "break", ";", "default", ":", ";", "}", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "0", "]", ",", "vol1", ")", ";", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "1", "]", ",", "vol2", ")", ";", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "2", "]", ",", "vol3", ")", ";", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "3", "]", ",", "vol4", ")", ";", "}", "}", "static", "int", "opl3_start_note", "(", "int", "dev", ",", "int", "voice", ",", "int", "note", ",", "int", "volume", ")", "{", "unsigned", "char", "data", ",", "fpc", ";", "int", "block", ",", "fnum", ",", "freq", ",", "voice_mode", ",", "pan", ";", "struct", "sbi_instrument", "*", "instr", ";", "struct", "physical_voice_info", "*", "map", ";", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", "0", ";", "map", "=", "&", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "voice", "]", "];", "pan", "=", "devc", "-", ">", "voc", "[", "voice", "]", ".", "panning", ";", "if", "(", "map", "-", ">", "voice_mode", "=", "=", "0", ")", "return", "0", ";", "if", "(", "note", "=", "=", "255", ")", "/", "*", "*", "Just", "change", "the", "volume", "*", "/", "{", "set_voice_volume", "(", "voice", ",", "volume", ",", "devc", "-", ">", "voc", "[", "voice", "]", ".", "volume", ")", ";", "return", "0", ";", "}", "/", "*", "*", "Kill", "previous", "note", "before", "playing", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "1", "]", ",", "0xff", ")", ";", "/", "*", "*", "Carrier", "*", "volume", "to", "*", "min", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "0", "]", ",", "0xff", ")", ";", "/", "*", "*", "Modulator", "*", "volume", "to", "*", "/", "if", "(", "map", "-", ">", "voice_mode", "=", "=", "4", ")", "{", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "2", "]", ",", "0xff", ")", ";", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KSL_LEVEL", "+", "map", "-", ">", "op", "[", "3", "]", ",", "0xff", ")", ";", "}", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KEYON_BLOCK", "+", "map", "-", ">", "voice_num", ",", "0x00", ")", ";", "/", "*", "*", "Note", "*", "off", "*", "/", "instr", "=", "devc", "-", ">", "act_i", "[", "voice", "]", ";", "if", "(", "!", "instr", ")", "instr", "=", "&", "devc", "-", ">", "i_map", "[", "0", "]", ";", "if", "(", "instr", "-", ">", "channel", "<", "0", ")", "{", "printk", "(", "KERN_WARNING", "\"", "opl3", ":", "Initializing", "voice", "%", "d", "with", "undefined", "instrument", "\\", "n", "\"", ",", "voice", ")", ";", "return", "0", ";", "}", "if", "(", "map", "-", ">", "voice_mode", "=", "=", "2", "&", "&", "instr", "-", ">", "key", "=", "=", "OPL3_PATCH", ")", "return", "0", ";", "/", "*", "*", "Cannot", "play", "*", "/", "voice_mode", "=", "map", "-", ">", "voice_mode", ";", "if", "(", "voice_mode", "=", "=", "4", ")", "{", "int", "voice_shift", ";", "voice_shift", "=", "(", "map", "-", ">", "ioaddr", "=", "=", "devc", "-", ">", "left_io", ")", "?", "0", ":", "3", ";", "voice_shift", "+", "=", "map", "-", ">", "voice_num", ";", "if", "(", "instr", "-", ">", "key", "!", "=", "OPL3_PATCH", ")", "/", "*", "*", "Just", "2", "OP", "patch", "*", "/", "{", "voice_mode", "=", "2", ";", "devc", "-", ">", "cmask", "&", "=", "~", "(", "1", "<", "<", "voice_shift", ")", ";", "}", "else", "{", "devc", "-", ">", "cmask", "|", "=", "(", "1", "<", "<", "voice_shift", ")", ";", "}", "opl3_command", "(", "devc", "-", ">", "right_io", ",", "CONNECTION_SELECT_REGISTER", ",", "devc", "-", ">", "cmask", ")", ";", "}", "/", "*", "*", "Set", "Sound", "Characteristics", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "AM_VIB", "+", "map", "-", ">", "op", "[", "0", "]", ",", "instr", "-", ">", "operators", "[", "0", "]", ");", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "AM_VIB", "+", "map", "-", ">", "op", "[", "1", "]", ",", "instr", "-", ">", "operators", "[", "1", "]", ");", "/", "*", "*", "Set", "Attack", "/", "Decay", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "ATTACK_DECAY", "+", "map", "-", ">", "op", "[", "0", "]", ",", "instr", "-", ">", "operators", "[", "4", "]", ");", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "ATTACK_DECAY", "+", "map", "-", ">", "op", "[", "1", "]", ",", "instr", "-", ">", "operators", "[", "5", "]", ");", "/", "*", "*", "Set", "Sustain", "/", "Release", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "SUSTAIN_RELEASE", "+", "map", "-", ">", "op", "[", "0", "]", ",", "instr", "-", ">", "operators", "[", "6", "]", ");", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "SUSTAIN_RELEASE", "+", "map", "-", ">", "op", "[", "1", "]", ",", "instr", "-", ">", "operators", "[", "7", "]", ");", "/", "*", "*", "Set", "Wave", "Select", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "WAVE_SELECT", "+", "map", "-", ">", "op", "[", "0", "]", ",", "instr", "-", ">", "operators", "[", "8", "]", ");", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "WAVE_SELECT", "+", "map", "-", ">", "op", "[", "1", "]", ",", "instr", "-", ">", "operators", "[", "9", "]", ");", "/", "*", "*", "Set", "Feedback", "/", "Connection", "*", "/", "fpc", "=", "instr", "-", ">", "operators", "[", "10", "]", ";", "if", "(", "pan", "!", "=", "0xffff", ")", "{", "fpc", "&", "=", "~", "STEREO_BITS", ";", "if", "(", "pan", "<", "-", "64", ")", "fpc", "|", "=", "VOICE_TO_LEFT", ";", "else", "if", "(", "pan", ">", "64", ")", "fpc", "|", "=", "VOICE_TO_RIGHT", ";", "else", "fpc", "|", "=", "(", "VOICE_TO_LEFT", "|", "VOICE_TO_RIGHT", ")", ";", "}", "if", "(", "!(", "fpc", "&", "0x30", ")", ")", "fpc", "|", "=", "0x30", ";", "/", "*", "*", "Ensure", "that", "at", "least", "one", "chn", "is", "enabled", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "FEEDBACK_CONNECTION", "+", "map", "-", ">", "voice_num", ",", "fpc", ")", ";", "/", "*", "*", "If", "the", "voice", "is", "a", "4", "OP", "one", ",", "initialize", "the", "operators", "3", "and", "4", "also", "*", "/", "if", "(", "voice_mode", "=", "=", "4", ")", "{", "/", "*", "*", "Set", "Sound", "Characteristics", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "AM_VIB", "+", "map", "-", ">", "op", "[", "2", "]", ",", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "0", "]", ");", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "AM_VIB", "+", "map", "-", ">", "op", "[", "3", "]", ",", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "1", "]", ");", "/", "*", "*", "Set", "Attack", "/", "Decay", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "ATTACK_DECAY", "+", "map", "-", ">", "op", "[", "2", "]", ",", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "4", "]", ");", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "ATTACK_DECAY", "+", "map", "-", ">", "op", "[", "3", "]", ",", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "5", "]", ");", "/", "*", "*", "Set", "Sustain", "/", "Release", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "SUSTAIN_RELEASE", "+", "map", "-", ">", "op", "[", "2", "]", ",", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "6", "]", ");", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "SUSTAIN_RELEASE", "+", "map", "-", ">", "op", "[", "3", "]", ",", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "7", "]", ");", "/", "*", "*", "Set", "Wave", "Select", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "WAVE_SELECT", "+", "map", "-", ">", "op", "[", "2", "]", ",", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "8", "]", ");", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "WAVE_SELECT", "+", "map", "-", ">", "op", "[", "3", "]", ",", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "9", "]", ");", "/", "*", "*", "Set", "Feedback", "/", "Connection", "*", "/", "fpc", "=", "instr", "-", ">", "operators", "[", "OFFS_4OP", "+", "10", "]", ";", "if", "(", "!(", "fpc", "&", "0x30", ")", ")", "fpc", "|", "=", "0x30", ";", "/", "*", "*", "Ensure", "that", "at", "least", "one", "chn", "is", "enabled", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "FEEDBACK_CONNECTION", "+", "map", "-", ">", "voice_num", "+", "3", ",", "fpc", ")", ";", "}", "devc", "-", ">", "voc", "[", "voice", "]", ".", "mode", "=", "voice_mode", ";", "set_voice_volume", "(", "voice", ",", "volume", ",", "devc", "-", ">", "voc", "[", "voice", "]", ".", "volume", ")", ";", "freq", "=", "devc", "-", ">", "voc", "[", "voice", "]", ".", "orig_freq", "=", "note_to_freq", "(", "note", ")", "/", "1000", ";", "/", "*", "*", "Since", "the", "pitch", "bender", "may", "have", "been", "set", "before", "playing", "the", "note", ",", "we", "*", "have", "to", "calculate", "the", "bending", "now", ".", "*", "/", "freq", "=", "compute_finetune", "(", "devc", "-", ">", "voc", "[", "voice", "]", ".", "orig_freq", ",", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender", ",", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender_range", ",", "0", ")", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "current_freq", "=", "freq", ";", "freq_to_fnum", "(", "freq", ",", "&", "block", ",", "&", "fnum", ")", ";", "/", "*", "*", "Play", "note", "*", "/", "data", "=", "fnum", "&", "0xff", ";", "/", "*", "*", "Least", "significant", "bits", "of", "fnumber", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "FNUM_LOW", "+", "map", "-", ">", "voice_num", ",", "data", ")", ";", "data", "=", "0x20", "|", "(", "(", "block", "&", "0x7", ")", "<", "<", "2", ")", "|", "(", "(", "fnum", ">", ">", "8", ")", "&", "0x3", ")", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "keyon_byte", "=", "data", ";", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KEYON_BLOCK", "+", "map", "-", ">", "voice_num", ",", "data", ")", ";", "if", "(", "voice_mode", "=", "=", "4", ")", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KEYON_BLOCK", "+", "map", "-", ">", "voice_num", "+", "3", ",", "data", ")", ";", "return", "0", ";", "}", "static", "void", "freq_to_fnum", "(", "int", "freq", ",", "int", "*", "block", ",", "int", "*", "fnum", ")", "{", "int", "f", ",", "octave", ";", "/", "*", "*", "Converts", "the", "note", "frequency", "to", "block", "and", "fnum", "values", "for", "the", "FM", "chip", "*", "/", "/", "*", "*", "First", "try", "to", "compute", "the", "block", "-", "value", "(", "octave", ")", "where", "the", "note", "belongs", "*", "/", "f", "=", "freq", ";", "octave", "=", "5", ";", "if", "(", "f", "=", "=", "0", ")", "octave", "=", "0", ";", "else", "if", "(", "f", "<", "261", ")", "{", "while", "(", "f", "<", "261", ")", "{", "octave", "-", "-;", "f", "<", "<=", "1", ";", "}", "}", "else", "if", "(", "f", ">", "493", ")", "{", "while", "(", "f", ">", "493", ")", "{", "octave", "+", "+;", "f", ">", ">=", "1", ";", "}", "}", "if", "(", "octave", ">", "7", ")", "octave", "=", "7", ";", "*", "fnum", "=", "freq", "*", "(", "1", "<", "<", "(", "20", "-", "octave", ")", ")", "/", "49716", ";", "*", "block", "=", "octave", ";", "}", "static", "void", "opl3_command", "(", "int", "io_addr", ",", "unsigned", "int", "addr", ",", "unsigned", "int", "val", ")", "{", "int", "i", ";", "/", "*", "*", "The", "original", "2", "-", "OP", "synth", "requires", "a", "quite", "long", "delay", "after", "writing", "to", "a", "*", "register", ".", "The", "OPL", "-", "3", "survives", "with", "just", "two", "INBs", "*", "/", "outb", "(", "((", "unsigned", "char", ")", "(", "addr", "&", "0xff", ")", "),", "io_addr", ")", ";", "if", "(", "devc", "-", ">", "model", "!", "=", "2", ")", "udelay", "(", "10", ")", ";", "else", "for", "(", "i", "=", "0", ";", "i", "<", "2", ";", "i", "+", "+)", "inb", "(", "io_addr", ")", ";", "outb", "(", "((", "unsigned", "char", ")", "(", "val", "&", "0xff", ")", "),", "io_addr", "+", "1", ")", ";", "if", "(", "devc", "-", ">", "model", "!", "=", "2", ")", "udelay", "(", "30", ")", ";", "else", "for", "(", "i", "=", "0", ";", "i", "<", "2", ";", "i", "+", "+)", "inb", "(", "io_addr", ")", ";", "}", "static", "void", "opl3_reset", "(", "int", "devno", ")", "{", "int", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "18", ";", "i", "+", "+)", "devc", "-", ">", "lv_map", "[", "i", "]", "=", "i", ";", "for", "(", "i", "=", "0", ";", "i", "<", "devc", "-", ">", "nr_voice", ";", "i", "+", "+)", "{", "opl3_command", "(", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "ioaddr", ",", "KSL_LEVEL", "+", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "op", "[", "0", "]", ",", "0xff", ")", ";", "opl3_command", "(", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "ioaddr", ",", "KSL_LEVEL", "+", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "op", "[", "1", "]", ",", "0xff", ")", ";", "if", "(", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "voice_mode", "=", "=", "4", ")", "{", "opl3_command", "(", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "ioaddr", ",", "KSL_LEVEL", "+", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "op", "[", "2", "]", ",", "0xff", ")", ";", "opl3_command", "(", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "ioaddr", ",", "KSL_LEVEL", "+", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "i", "]", "].", "op", "[", "3", "]", ",", "0xff", ")", ";", "}", "opl3_kill_note", "(", "devno", ",", "i", ",", "0", ",", "64", ")", ";", "}", "if", "(", "devc", "-", ">", "model", "=", "=", "2", ")", "{", "devc", "-", ">", "v_alloc", "-", ">", "max_voice", "=", "devc", "-", ">", "nr_voice", "=", "18", ";", "for", "(", "i", "=", "0", ";", "i", "<", "18", ";", "i", "+", "+)", "pv_map", "[", "i", "]", ".", "voice_mode", "=", "2", ";", "}", "}", "static", "int", "opl3_open", "(", "int", "dev", ",", "int", "mode", ")", "{", "int", "i", ";", "if", "(", "devc", "-", ">", "busy", ")", "return", "-", "EBUSY", ";", "devc", "-", ">", "busy", "=", "1", ";", "devc", "-", ">", "v_alloc", "-", ">", "max_voice", "=", "devc", "-", ">", "nr_voice", "=", "(", "devc", "-", ">", "model", "=", "=", "2", ")", "?", "18", ":", "9", ";", "devc", "-", ">", "v_alloc", "-", ">", "timestamp", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "18", ";", "i", "+", "+)", "{", "devc", "-", ">", "v_alloc", "-", ">", "map", "[", "i", "]", "=", "0", ";", "devc", "-", ">", "v_alloc", "-", ">", "alloc_times", "[", "i", "]", "=", "0", ";", "}", "devc", "-", ">", "cmask", "=", "0x00", ";", "/", "*", "*", "Just", "2", "OP", "mode", "*", "/", "if", "(", "devc", "-", ">", "model", "=", "=", "2", ")", "opl3_command", "(", "devc", "-", ">", "right_io", ",", "CONNECTION_SELECT_REGISTER", ",", "devc", "-", ">", "cmask", ")", ";", "return", "0", ";", "}", "static", "void", "opl3_close", "(", "int", "dev", ")", "{", "devc", "-", ">", "busy", "=", "0", ";", "devc", "-", ">", "v_alloc", "-", ">", "max_voice", "=", "devc", "-", ">", "nr_voice", "=", "(", "devc", "-", ">", "model", "=", "=", "2", ")", "?", "18", ":", "9", ";", "devc", "-", ">", "fm_info", ".", "nr_drums", "=", "0", ";", "devc", "-", ">", "fm_info", ".", "perc_mode", "=", "0", ";", "opl3_reset", "(", "dev", ")", ";", "}", "static", "void", "opl3_hw_control", "(", "int", "dev", ",", "unsigned", "char", "*", "event", ")", "{", "}", "static", "int", "opl3_load_patch", "(", "int", "dev", ",", "int", "format", ",", "const", "char", "__user", "*", "addr", ",", "int", "count", ",", "int", "pmgr_flag", ")", "{", "struct", "sbi_instrument", "ins", ";", "if", "(", "count", "<", "sizeof", "(", "ins", ")", ")", "{", "printk", "(", "KERN_WARNING", "\"", "FM", "Error", ":", "Patch", "record", "too", "short", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "copy_from_user", "(", "&", "ins", ",", "addr", ",", "sizeof", "(", "ins", ")", "))", "return", "-", "EFAULT", ";", "if", "(", "ins", ".", "channel", "<", "0", "|", "|", "ins", ".", "channel", ">", "=", "SBFM_MAXINSTR", ")", "{", "printk", "(", "KERN_WARNING", "\"", "FM", "Error", ":", "Invalid", "instrument", "number", "%", "d", "\\", "n", "\"", ",", "ins", ".", "channel", ")", ";", "return", "-", "EINVAL", ";", "}", "ins", ".", "key", "=", "format", ";", "return", "store_instr", "(", "ins", ".", "channel", ",", "&", "ins", ")", ";", "}", "static", "void", "opl3_panning", "(", "int", "dev", ",", "int", "voice", ",", "int", "value", ")", "{", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "panning", "=", "value", ";", "}", "static", "void", "opl3_volume_method", "(", "int", "dev", ",", "int", "mode", ")", "{", "}", "#", "define", "SET_VIBRATO", "(", "cell", ")", "{", "\\", "tmp", "=", "instr", "-", ">", "operators", "[", "(", "cell", "-", "1", ")", "+(", "((", "cell", "-", "1", ")", "/", "2", ")", "*", "OFFS_4OP", ")", "];", "\\", "if", "(", "pressure", ">", "110", ")", "\\", "tmp", "|", "=", "0x40", ";", "/", "*", "Vibrato", "on", "*", "/", "\\", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "AM_VIB", "+", "map", "-", ">", "op", "[", "cell", "-", "1", "]", ",", "tmp", ")", ";}", "static", "void", "opl3_aftertouch", "(", "int", "dev", ",", "int", "voice", ",", "int", "pressure", ")", "{", "int", "tmp", ";", "struct", "sbi_instrument", "*", "instr", ";", "struct", "physical_voice_info", "*", "map", ";", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", ";", "map", "=", "&", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "voice", "]", "];", "if", "(", "map", "-", ">", "voice_mode", "=", "=", "0", ")", "return", ";", "/", "*", "*", "Adjust", "the", "amount", "of", "vibrato", "depending", "the", "pressure", "*", "/", "instr", "=", "devc", "-", ">", "act_i", "[", "voice", "]", ";", "if", "(", "!", "instr", ")", "instr", "=", "&", "devc", "-", ">", "i_map", "[", "0", "]", ";", "if", "(", "devc", "-", ">", "voc", "[", "voice", "]", ".", "mode", "=", "=", "4", ")", "{", "int", "connection", "=", "(", "(", "instr", "-", ">", "operators", "[", "10", "]", "&", "0x01", ")", "<", "<", "1", ")", "|", "(", "instr", "-", ">", "operators", "[", "10", "+", "OFFS_4OP", "]", "&", "0x01", ")", ";", "switch", "(", "connection", ")", "{", "case", "0", ":", "SET_VIBRATO", "(", "4", ")", ";", "break", ";", "case", "1", ":", "SET_VIBRATO", "(", "2", ")", ";", "SET_VIBRATO", "(", "4", ")", ";", "break", ";", "case", "2", ":", "SET_VIBRATO", "(", "1", ")", ";", "SET_VIBRATO", "(", "4", ")", ";", "break", ";", "case", "3", ":", "SET_VIBRATO", "(", "1", ")", ";", "SET_VIBRATO", "(", "3", ")", ";", "SET_VIBRATO", "(", "4", ")", ";", "break", ";", "}", "/", "*", "*", "Not", "implemented", "yet", "*", "/", "}", "else", "{", "SET_VIBRATO", "(", "1", ")", ";", "if", "(", "(", "instr", "-", ">", "operators", "[", "10", "]", "&", "0x01", ")", ")", "/", "*", "*", "Additive", "synthesis", "*", "/", "SET_VIBRATO", "(", "2", ")", ";", "}", "}", "#", "undef", "SET_VIBRATO", "static", "void", "bend_pitch", "(", "int", "dev", ",", "int", "voice", ",", "int", "value", ")", "{", "unsigned", "char", "data", ";", "int", "block", ",", "fnum", ",", "freq", ";", "struct", "physical_voice_info", "*", "map", ";", "map", "=", "&", "pv_map", "[", "devc", "-", ">", "lv_map", "[", "voice", "]", "];", "if", "(", "map", "-", ">", "voice_mode", "=", "=", "0", ")", "return", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender", "=", "value", ";", "if", "(", "!", "value", ")", "return", ";", "if", "(", "!(", "devc", "-", ">", "voc", "[", "voice", "]", ".", "keyon_byte", "&", "0x20", ")", ")", "return", ";", "/", "*", "*", "Not", "keyed", "on", "*", "/", "freq", "=", "compute_finetune", "(", "devc", "-", ">", "voc", "[", "voice", "]", ".", "orig_freq", ",", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender", ",", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender_range", ",", "0", ")", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "current_freq", "=", "freq", ";", "freq_to_fnum", "(", "freq", ",", "&", "block", ",", "&", "fnum", ")", ";", "data", "=", "fnum", "&", "0xff", ";", "/", "*", "*", "Least", "significant", "bits", "of", "fnumber", "*", "/", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "FNUM_LOW", "+", "map", "-", ">", "voice_num", ",", "data", ")", ";", "data", "=", "0x20", "|", "(", "(", "block", "&", "0x7", ")", "<", "<", "2", ")", "|", "(", "(", "fnum", ">", ">", "8", ")", "&", "0x3", ")", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "keyon_byte", "=", "data", ";", "opl3_command", "(", "map", "-", ">", "ioaddr", ",", "KEYON_BLOCK", "+", "map", "-", ">", "voice_num", ",", "data", ")", ";", "}", "static", "void", "opl3_controller", "(", "int", "dev", ",", "int", "voice", ",", "int", "ctrl_num", ",", "int", "value", ")", "{", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", ";", "switch", "(", "ctrl_num", ")", "{", "case", "CTRL_PITCH_BENDER", ":", "bend_pitch", "(", "dev", ",", "voice", ",", "value", ")", ";", "break", ";", "case", "CTRL_PITCH_BENDER_RANGE", ":", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender_range", "=", "value", ";", "break", ";", "case", "CTL_MAIN_VOLUME", ":", "devc", "-", ">", "voc", "[", "voice", "]", ".", "volume", "=", "value", "/", "128", ";", "break", ";", "case", "CTL_PAN", ":", "devc", "-", ">", "voc", "[", "voice", "]", ".", "panning", "=", "(", "value", "*", "2", ")", "-", "128", ";", "break", ";", "}", "}", "static", "void", "opl3_bender", "(", "int", "dev", ",", "int", "voice", ",", "int", "value", ")", "{", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", ";", "bend_pitch", "(", "dev", ",", "voice", ",", "value", "-", "8192", ")", ";", "}", "static", "int", "opl3_alloc_voice", "(", "int", "dev", ",", "int", "chn", ",", "int", "note", ",", "struct", "voice_alloc_info", "*", "alloc", ")", "{", "int", "i", ",", "p", ",", "best", ",", "first", ",", "avail", ",", "best_time", "=", "0x7fffffff", ";", "struct", "sbi_instrument", "*", "instr", ";", "int", "is4op", ";", "int", "instr_no", ";", "if", "(", "chn", "<", "0", "|", "|", "chn", ">", "15", ")", "instr_no", "=", "0", ";", "else", "instr_no", "=", "devc", "-", ">", "chn_info", "[", "chn", "]", ".", "pgm_num", ";", "instr", "=", "&", "devc", "-", ">", "i_map", "[", "instr_no", "]", ";", "if", "(", "instr", "-", ">", "channel", "<", "0", "|", "|", "/", "*", "Instrument", "not", "loaded", "*", "/", "devc", "-", ">", "nr_voice", "!", "=", "12", ")", "/", "*", "Not", "in", "4", "OP", "mode", "*", "/", "is4op", "=", "0", ";", "else", "if", "(", "devc", "-", ">", "nr_voice", "=", "=", "12", ")", "/", "*", "4", "OP", "mode", "*", "/", "is4op", "=", "(", "instr", "-", ">", "key", "=", "=", "OPL3_PATCH", ")", ";", "else", "is4op", "=", "0", ";", "if", "(", "is4op", ")", "{", "first", "=", "p", "=", "0", ";", "avail", "=", "6", ";", "}", "else", "{", "if", "(", "devc", "-", ">", "nr_voice", "=", "=", "12", ")", "/", "*", "4", "OP", "mode", ".", "Use", "the", "'", "2", "OP", "only", "'", "operators", "first", "*", "/", "first", "=", "p", "=", "6", ";", "else", "first", "=", "p", "=", "0", ";", "avail", "=", "devc", "-", ">", "nr_voice", ";", "}", "/", "*", "*", "Now", "try", "to", "find", "a", "free", "voice", "*", "/", "best", "=", "first", ";", "for", "(", "i", "=", "0", ";", "i", "<", "avail", ";", "i", "+", "+)", "{", "if", "(", "alloc", "-", ">", "map", "[", "p", "]", "=", "=", "0", ")", "{", "return", "p", ";", "}", "if", "(", "alloc", "-", ">", "alloc_times", "[", "p", "]", "<", "best_time", ")", "/", "*", "Find", "oldest", "playing", "note", "*", "/", "{", "best_time", "=", "alloc", "-", ">", "alloc_times", "[", "p", "]", ";", "best", "=", "p", ";", "}", "p", "=", "(", "p", "+", "1", ")", "%", "avail", ";", "}", "/", "*", "*", "Insert", "some", "kind", "of", "priority", "mechanism", "here", ".", "*", "/", "if", "(", "best", "<", "0", ")", "best", "=", "0", ";", "if", "(", "best", ">", "devc", "-", ">", "nr_voice", ")", "best", "-", "=", "devc", "-", ">", "nr_voice", ";", "return", "best", ";", "/", "*", "All", "devc", "-", ">", "voc", "in", "use", ".", "Select", "the", "first", "one", ".", "*", "/", "}", "static", "void", "opl3_setup_voice", "(", "int", "dev", ",", "int", "voice", ",", "int", "chn", ")", "{", "struct", "channel_info", "*", "info", ";", "if", "(", "voice", "<", "0", "|", "|", "voice", ">", "=", "devc", "-", ">", "nr_voice", ")", "return", ";", "if", "(", "chn", "<", "0", "|", "|", "chn", ">", "15", ")", "return", ";", "info", "=", "&", "synth_devs", "[", "dev", "]", "->", "chn_info", "[", "chn", "]", ";", "opl3_set_instr", "(", "dev", ",", "voice", ",", "info", "-", ">", "pgm_num", ")", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender", "=", "0", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "bender_range", "=", "info", "-", ">", "bender_range", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "volume", "=", "info", "-", ">", "controllers", "[", "CTL_MAIN_VOLUME", "]", ";", "devc", "-", ">", "voc", "[", "voice", "]", ".", "panning", "=", "(", "info", "-", ">", "controllers", "[", "CTL_PAN", "]", "*", "2", ")", "-", "128", ";", "}", "static", "struct", "synth_operations", "opl3_operations", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "id", "=", "\"", "OPL", "\"", ",", ".", "info", "=", "NULL", ",", ".", "midi_dev", "=", "0", ",", ".", "synth_type", "=", "SYNTH_TYPE_FM", ",", ".", "synth_subtype", "=", "FM_TYPE_ADLIB", ",", ".", "open", "=", "opl3_open", ",", ".", "close", "=", "opl3_close", ",", ".", "ioctl", "=", "opl3_ioctl", ",", ".", "kill_note", "=", "opl3_kill_note", ",", ".", "start_note", "=", "opl3_start_note", ",", ".", "set_instr", "=", "opl3_set_instr", ",", ".", "reset", "=", "opl3_reset", ",", ".", "hw_control", "=", "opl3_hw_control", ",", ".", "load_patch", "=", "opl3_load_patch", ",", ".", "aftertouch", "=", "opl3_aftertouch", ",", ".", "controller", "=", "opl3_controller", ",", ".", "panning", "=", "opl3_panning", ",", ".", "volume_method", "=", "opl3_volume_method", ",", ".", "bender", "=", "opl3_bender", ",", ".", "alloc_voice", "=", "opl3_alloc_voice", ",", ".", "setup_voice", "=", "opl3_setup_voice", "}", ";", "static", "int", "opl3_init", "(", "int", "ioaddr", ",", "struct", "module", "*", "owner", ")", "{", "int", "i", ";", "int", "me", ";", "if", "(", "devc", "=", "=", "NULL", ")", "{", "printk", "(", "KERN_ERR", "\"", "opl3", ":", "Device", "control", "structure", "not", "initialized", ".", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "if", "(", "(", "me", "=", "sound_alloc_synthdev", "(", "))", "=", "=", "-", "1", ")", "{", "printk", "(", "KERN_WARNING", "\"", "opl3", ":", "Too", "many", "synthesizers", "\\", "n", "\"", ");", "return", "-", "1", ";", "}", "devc", "-", ">", "nr_voice", "=", "9", ";", "devc", "-", ">", "fm_info", ".", "device", "=", "0", ";", "devc", "-", ">", "fm_info", ".", "synth_type", "=", "SYNTH_TYPE_FM", ";", "devc", "-", ">", "fm_info", ".", "synth_subtype", "=", "FM_TYPE_ADLIB", ";", "devc", "-", ">", "fm_info", ".", "perc_mode", "=", "0", ";", "devc", "-", ">", "fm_info", ".", "nr_voices", "=", "9", ";", "devc", "-", ">", "fm_info", ".", "nr_drums", "=", "0", ";", "devc", "-", ">", "fm_info", ".", "instr_bank_size", "=", "SBFM_MAXINSTR", ";", "devc", "-", ">", "fm_info", ".", "capabilities", "=", "0", ";", "devc", "-", ">", "left_io", "=", "ioaddr", ";", "devc", "-", ">", "right_io", "=", "ioaddr", "+", "2", ";", "if", "(", "detected_model", "<", "=", "2", ")", "devc", "-", ">", "model", "=", "1", ";", "else", "{", "devc", "-", ">", "model", "=", "2", ";", "if", "(", "detected_model", "=", "=", "4", ")", "devc", "-", ">", "is_opl4", "=", "1", ";", "}", "opl3_operations", ".", "info", "=", "&", "devc", "-", ">", "fm_info", ";", "synth_devs", "[", "me", "]", "=", "&", "opl3_operations", ";", "if", "(", "owner", ")", "synth_devs", "[", "me", "]", "->", "owner", "=", "owner", ";", "sequencer_init", "(", ");", "devc", "-", ">", "v_alloc", "=", "&", "opl3_operations", ".", "alloc", ";", "devc", "-", ">", "chn_info", "=", "&", "opl3_operations", ".", "chn_info", "[", "0", "]", ";", "if", "(", "devc", "-", ">", "model", "=", "=", "2", ")", "{", "if", "(", "devc", "-", ">", "is_opl4", ")", "strcpy", "(", "devc", "-", ">", "fm_info", ".", "name", ",", "\"", "Yamaha", "OPL4", "/", "OPL3", "FM", "\"", ");", "else", "strcpy", "(", "devc", "-", ">", "fm_info", ".", "name", ",", "\"", "Yamaha", "OPL3", "\"", ");", "devc", "-", ">", "v_alloc", "-", ">", "max_voice", "=", "devc", "-", ">", "nr_voice", "=", "18", ";", "devc", "-", ">", "fm_info", ".", "nr_drums", "=", "0", ";", "devc", "-", ">", "fm_info", ".", "synth_subtype", "=", "FM_TYPE_OPL3", ";", "devc", "-", ">", "fm_info", ".", "capabilities", "|", "=", "SYNTH_CAP_OPL3", ";", "for", "(", "i", "=", "0", ";", "i", "<", "18", ";", "i", "+", "+)", "{", "if", "(", "pv_map", "[", "i", "]", ".", "ioaddr", "=", "=", "USE_LEFT", ")", "pv_map", "[", "i", "]", ".", "ioaddr", "=", "devc", "-", ">", "left_io", ";", "else", "pv_map", "[", "i", "]", ".", "ioaddr", "=", "devc", "-", ">", "right_io", ";", "}", "opl3_command", "(", "devc", "-", ">", "right_io", ",", "OPL3_MODE_REGISTER", ",", "OPL3_ENABLE", ")", ";", "opl3_command", "(", "devc", "-", ">", "right_io", ",", "CONNECTION_SELECT_REGISTER", ",", "0x00", ")", ";", "}", "else", "{", "strcpy", "(", "devc", "-", ">", "fm_info", ".", "name", ",", "\"", "Yamaha", "OPL2", "\"", ");", "devc", "-", ">", "v_alloc", "-", ">", "max_voice", "=", "devc", "-", ">", "nr_voice", "=", "9", ";", "devc", "-", ">", "fm_info", ".", "nr_drums", "=", "0", ";", "for", "(", "i", "=", "0", ";", "i", "<", "18", ";", "i", "+", "+)", "pv_map", "[", "i", "]", ".", "ioaddr", "=", "devc", "-", ">", "left_io", ";", "}", "conf_printf2", "(", "devc", "-", ">", "fm_info", ".", "name", ",", "ioaddr", ",", "0", ",", "-", "1", ",", "-", "1", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "SBFM_MAXINSTR", ";", "i", "+", "+)", "devc", "-", ">", "i_map", "[", "i", "]", ".", "channel", "=", "-", "1", ";", "return", "me", ";", "}", "static", "int", "me", ";", "static", "int", "io", "=", "-", "1", ";", "module_param_hw", "(", "io", ",", "int", ",", "ioport", ",", "0", ")", ";", "static", "int", "__init", "init_opl3", "(", "void", ")", "{", "printk", "(", "KERN_INFO", "\"", "YM3812", "and", "OPL", "-", "3", "driver", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", ",", "Rob", "Hooft", "1993", "-", "1996", "\\", "n", "\"", ");", "if", "(", "io", "!", "=", "-", "1", ")", "/", "*", "User", "loading", "pure", "OPL3", "module", "*", "/", "{", "if", "(", "!", "opl3_detect", "(", "io", ")", ")", "{", "return", "-", "ENODEV", ";", "}", "me", "=", "opl3_init", "(", "io", ",", "THIS_MODULE", ")", ";", "}", "return", "0", ";", "}", "static", "void", "__exit", "cleanup_opl3", "(", "void", ")", "{", "if", "(", "devc", "&", "&", "io", "!", "=", "-", "1", ")", "{", "if", "(", "devc", "-", ">", "base", ")", "{", "release_region", "(", "devc", "-", ">", "base", ",", "4", ")", ";", "if", "(", "devc", "-", ">", "is_opl4", ")", "release_region", "(", "devc", "-", ">", "base", "-", "8", ",", "2", ")", ";", "}", "kfree", "(", "devc", ")", ";", "devc", "=", "NULL", ";", "sound_unload_synthdev", "(", "me", ")", ";", "}", "}", "module_init", "(", "init_opl3", ")", ";", "module_exit", "(", "cleanup_opl3", ")", ";", "#", "ifndef", "MODULE", "static", "int", "__init", "setup_opl3", "(", "char", "*", "str", ")", "{", "/", "*", "io", "*", "/", "int", "ints", "[", "2", "]", ";", "str", "=", "get_options", "(", "str", ",", "ARRAY_SIZE", "(", "ints", ")", ",", "ints", ")", ";", "io", "=", "ints", "[", "1", "]", ";", "return", "1", ";", "}", "__setup", "(", "\"", "opl3", "=", "\",", "setup_opl3", ")", ";", "#", "endif", "MODULE_LICENSE", "(", "\"", "GPL", "\"", ");", "@", "@", "-", "1", ",", "246", "+", "0", ",", "0", "@", "@", "/", "*", "*", "opl3_hw", ".", "h", "-", "Definitions", "of", "the", "OPL", "-", "3", "registers", "*", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "*", "*", "The", "OPL", "-", "3", "mode", "is", "switched", "on", "by", "writing", "0x01", ",", "to", "the", "offset", "5", "*", "of", "the", "right", "side", ".", "*", "*", "Another", "special", "register", "at", "the", "right", "side", "is", "at", "offset", "4", ".", "It", "contains", "*", "a", "bit", "mask", "defining", "which", "voices", "are", "used", "as", "4", "OP", "voices", ".", "*", "*", "The", "percussive", "mode", "is", "implemented", "in", "the", "left", "side", "only", ".", "*", "*", "With", "the", "above", "exceptions", "the", "both", "sides", "can", "be", "operated", "independently", ".", "*", "*", "A", "4", "OP", "voice", "can", "be", "created", "by", "setting", "the", "corresponding", "*", "bit", "at", "offset", "4", "of", "the", "right", "side", ".", "*", "*", "For", "example", "setting", "the", "rightmost", "bit", "(", "0x01", ")", "changes", "the", "*", "first", "voice", "on", "the", "right", "side", "to", "the", "4", "OP", "mode", ".", "The", "fourth", "*", "voice", "is", "made", "inaccessible", ".", "*", "*", "If", "a", "voice", "is", "set", "to", "the", "2", "OP", "mode", ",", "it", "works", "like", "2", "OP", "modes", "*", "of", "the", "original", "YM3812", "(", "AdLib", ")", ".", "In", "addition", "the", "voice", "can", "*", "be", "connected", "the", "left", ",", "right", "or", "both", "stereo", "channels", ".", "It", "can", "*", "even", "be", "left", "unconnected", ".", "This", "works", "with", "4", "OP", "voices", "also", ".", "*", "*", "The", "stereo", "connection", "bits", "are", "located", "in", "the", "FEEDBACK_CONNECTION", "*", "register", "of", "the", "voice", "(", "0xC0", "-", "0xC8", ")", ".", "In", "4", "OP", "voices", "these", "bits", "are", "*", "in", "the", "second", "half", "of", "the", "voice", ".", "*", "/", "/", "*", "*", "Register", "numbers", "for", "the", "global", "registers", "*", "/", "#", "define", "TEST_REGISTER", "0x01", "#", "define", "ENABLE_WAVE_SELECT", "0x20", "#", "define", "TIMER1_REGISTER", "0x02", "#", "define", "TIMER2_REGISTER", "0x03", "#", "define", "TIMER_CONTROL_REGISTER", "0x04", "/", "*", "Left", "side", "*", "/", "#", "define", "IRQ_RESET", "0x80", "#", "define", "TIMER1_MASK", "0x40", "#", "define", "TIMER2_MASK", "0x20", "#", "define", "TIMER1_START", "0x01", "#", "define", "TIMER2_START", "0x02", "#", "define", "CONNECTION_SELECT_REGISTER", "0x04", "/", "*", "Right", "side", "*", "/", "#", "define", "RIGHT_4OP_0", "0x01", "#", "define", "RIGHT_4OP_1", "0x02", "#", "define", "RIGHT_4OP_2", "0x04", "#", "define", "LEFT_4OP_0", "0x08", "#", "define", "LEFT_4OP_1", "0x10", "#", "define", "LEFT_4OP_2", "0x20", "#", "define", "OPL3_MODE_REGISTER", "0x05", "/", "*", "Right", "side", "*", "/", "#", "define", "OPL3_ENABLE", "0x01", "#", "define", "OPL4_ENABLE", "0x02", "#", "define", "KBD_SPLIT_REGISTER", "0x08", "/", "*", "Left", "side", "*", "/", "#", "define", "COMPOSITE_SINE_WAVE_MODE", "0x80", "/", "*", "Don", "'", "t", "use", "with", "OPL", "-", "3", "?", "*", "/", "#", "define", "KEYBOARD_SPLIT", "0x40", "#", "define", "PERCOSSION_REGISTER", "0xbd", "/", "*", "Left", "side", "only", "*", "/", "#", "define", "TREMOLO_DEPTH", "0x80", "#", "define", "VIBRATO_DEPTH", "0x40", "#", "define", "PERCOSSION_ENABLE", "0x20", "#", "define", "BASSDRUM_ON", "0x10", "#", "define", "SNAREDRUM_ON", "0x08", "#", "define", "TOMTOM_ON", "0x04", "#", "define", "CYMBAL_ON", "0x02", "#", "define", "HIHAT_ON", "0x01", "/", "*", "*", "Offsets", "to", "the", "register", "banks", "for", "operators", ".", "To", "get", "the", "*", "register", "number", "just", "add", "the", "operator", "offset", "to", "the", "bank", "offset", "*", "*", "AM", "/", "VIB", "/", "EG", "/", "KSR", "/", "Multiple", "(", "0x20", "to", "0x35", ")", "*", "/", "#", "define", "AM_VIB", "0x20", "#", "define", "TREMOLO_ON", "0x80", "#", "define", "VIBRATO_ON", "0x40", "#", "define", "SUSTAIN_ON", "0x20", "#", "define", "KSR", "0x10", "/", "*", "Key", "scaling", "rate", "*", "/", "#", "define", "MULTIPLE_MASK", "0x0f", "/", "*", "Frequency", "multiplier", "*", "/", "/", "*", "*", "KSL", "/", "Total", "level", "(", "0x40", "to", "0x55", ")", "*", "/", "#", "define", "KSL_LEVEL", "0x40", "#", "define", "KSL_MASK", "0xc0", "/", "*", "Envelope", "scaling", "bits", "*", "/", "#", "define", "TOTAL_LEVEL_MASK", "0x3f", "/", "*", "Strength", "(", "volume", ")", "of", "OP", "*", "/", "/", "*", "*", "Attack", "/", "Decay", "rate", "(", "0x60", "to", "0x75", ")", "*", "/", "#", "define", "ATTACK_DECAY", "0x60", "#", "define", "ATTACK_MASK", "0xf0", "#", "define", "DECAY_MASK", "0x0f", "/", "*", "*", "Sustain", "level", "/", "Release", "rate", "(", "0x80", "to", "0x95", ")", "*", "/", "#", "define", "SUSTAIN_RELEASE", "0x80", "#", "define", "SUSTAIN_MASK", "0xf0", "#", "define", "RELEASE_MASK", "0x0f", "/", "*", "*", "Wave", "select", "(", "0xE0", "to", "0xF5", ")", "*", "/", "#", "define", "WAVE_SELECT", "0xe0", "/", "*", "*", "Offsets", "to", "the", "register", "banks", "for", "voices", ".", "Just", "add", "to", "the", "*", "voice", "number", "to", "get", "the", "register", "number", ".", "*", "*", "F", "-", "Number", "low", "bits", "(", "0xA0", "to", "0xA8", ")", ".", "*", "/", "#", "define", "FNUM_LOW", "0xa0", "/", "*", "*", "F", "-", "number", "high", "bits", "/", "Key", "on", "/", "Block", "(", "octave", ")", "(", "0xB0", "to", "0xB8", ")", "*", "/", "#", "define", "KEYON_BLOCK", "0xb0", "#", "define", "KEYON_BIT", "0x20", "#", "define", "BLOCKNUM_MASK", "0x1c", "#", "define", "FNUM_HIGH_MASK", "0x03", "/", "*", "*", "Feedback", "/", "Connection", "(", "0xc0", "to", "0xc8", ")", "*", "*", "These", "registers", "have", "two", "new", "bits", "when", "the", "OPL", "-", "3", "mode", "*", "is", "selected", ".", "These", "bits", "controls", "connecting", "the", "voice", "*", "to", "the", "stereo", "channels", ".", "For", "4", "OP", "voices", "this", "bit", "is", "*", "defined", "in", "the", "second", "half", "of", "the", "voice", "(", "add", "3", "to", "the", "*", "register", "offset", ")", ".", "*", "*", "For", "4", "OP", "voices", "the", "connection", "bit", "is", "used", "in", "the", "*", "both", "halves", "(", "gives", "4", "ways", "to", "connect", "the", "operators", ")", ".", "*", "/", "#", "define", "FEEDBACK_CONNECTION", "0xc0", "#", "define", "FEEDBACK_MASK", "0x0e", "/", "*", "Valid", "just", "for", "1st", "OP", "of", "a", "voice", "*", "/", "#", "define", "CONNECTION_BIT", "0x01", "/", "*", "*", "In", "the", "4", "OP", "mode", "there", "is", "four", "possible", "configurations", "how", "the", "*", "operators", "can", "be", "connected", "together", "(", "in", "2", "OP", "modes", "there", "is", "just", "*", "AM", "or", "FM", ")", ".", "The", "4", "OP", "connection", "mode", "is", "defined", "by", "the", "rightmost", "*", "bit", "of", "the", "FEEDBACK_CONNECTION", "(", "0xC0", "-", "0xC8", ")", "on", "the", "both", "halves", ".", "*", "*", "First", "half", "Second", "half", "Mode", "*", "*", "+", "--", "-+", "*", "v", "|", "*", "0", "0", ">", "+-", "1", "-", "+-", "-", "2", "-", "-", "3", "-", "-", "4", "-", "->", "*", "*", "*", "*", "+", "--", "-+", "*", "|", "|", "*", "0", "1", ">", "+-", "1", "-", "+-", "-", "2", "-", "+", "*", "|", "->", "*", ">", "--", "3", "-", "--", "-", "4", "-", "+", "*", "*", "+", "--", "-+", "*", "|", "|", "*", "1", "0", ">", "+-", "1", "-", "+-", "--", "--", "+", "*", "|", "->", "*", ">", "--", "2", "-", "-", "3", "-", "-", "4", "-", "+", "*", "*", "+", "--", "-+", "*", "|", "|", "*", "1", "1", ">", "+-", "1", "-", "+-", "-+", "*", "|", "*", ">", "--", "2", "-", "-", "3", "-", "+-", ">", "*", "|", "*", ">", "--", "4", "-", "--", "-+", "*", "/", "#", "define", "STEREO_BITS", "0x30", "/", "*", "OPL", "-", "3", "only", "*", "/", "#", "define", "VOICE_TO_LEFT", "0x10", "#", "define", "VOICE_TO_RIGHT", "0x20", "/", "*", "*", "Definition", "table", "for", "the", "physical", "voices", "*", "/", "struct", "physical_voice_info", "{", "unsigned", "char", "voice_num", ";", "unsigned", "char", "voice_mode", ";", "/", "*", "0", "=", "unavailable", ",", "2", "=", "2", "OP", ",", "4", "=", "4", "OP", "*", "/", "unsigned", "short", "ioaddr", ";", "/", "*", "I", "/", "O", "port", "(", "left", "or", "right", "side", ")", "*", "/", "unsigned", "char", "op", "[", "4", "]", ";", "/", "*", "Operator", "offsets", "*", "/", "}", ";", "/", "*", "*", "There", "is", "18", "possible", "2", "OP", "voices", "*", "(", "9", "in", "the", "left", "and", "9", "in", "the", "right", ")", ".", "*", "The", "first", "OP", "is", "the", "modulator", "and", "2nd", "is", "the", "carrier", ".", "*", "*", "The", "first", "three", "voices", "in", "the", "both", "sides", "may", "be", "connected", "*", "with", "another", "voice", "to", "a", "4", "OP", "voice", ".", "For", "example", "voice", "0", "*", "can", "be", "connected", "with", "voice", "3", ".", "The", "operators", "of", "voice", "3", "are", "*", "used", "as", "operators", "3", "and", "4", "of", "the", "new", "4", "OP", "voice", ".", "*", "In", "this", "case", "the", "2", "OP", "voice", "number", "0", "is", "the", "'", "first", "half", "'", "and", "*", "voice", "3", "is", "the", "second", ".", "*", "/", "#", "define", "USE_LEFT", "0", "#", "define", "USE_RIGHT", "1", "static", "struct", "physical_voice_info", "pv_map", "[", "18", "]", "=", "{", "/", "*", "No", "Mode", "Side", "OP1", "OP2", "OP3", "OP4", "*", "/", "/", "*", "-", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "--", "*", "/", "{", "0", ",", "2", ",", "USE_LEFT", ",", "{", "0x00", ",", "0x03", ",", "0x08", ",", "0x0b", "}", "},", "{", "1", ",", "2", ",", "USE_LEFT", ",", "{", "0x01", ",", "0x04", ",", "0x09", ",", "0x0c", "}", "},", "{", "2", ",", "2", ",", "USE_LEFT", ",", "{", "0x02", ",", "0x05", ",", "0x0a", ",", "0x0d", "}", "},", "{", "3", ",", "2", ",", "USE_LEFT", ",", "{", "0x08", ",", "0x0b", ",", "0x00", ",", "0x00", "}", "},", "{", "4", ",", "2", ",", "USE_LEFT", ",", "{", "0x09", ",", "0x0c", ",", "0x00", ",", "0x00", "}", "},", "{", "5", ",", "2", ",", "USE_LEFT", ",", "{", "0x0a", ",", "0x0d", ",", "0x00", ",", "0x00", "}", "},", "{", "6", ",", "2", ",", "USE_LEFT", ",", "{", "0x10", ",", "0x13", ",", "0x00", ",", "0x00", "}", "},", "/", "*", "Used", "by", "percussive", "voices", "*", "/", "{", "7", ",", "2", ",", "USE_LEFT", ",", "{", "0x11", ",", "0x14", ",", "0x00", ",", "0x00", "}", "},", "/", "*", "if", "the", "percussive", "mode", "*", "/", "{", "8", ",", "2", ",", "USE_LEFT", ",", "{", "0x12", ",", "0x15", ",", "0x00", ",", "0x00", "}", "},", "/", "*", "is", "selected", "*", "/", "{", "0", ",", "2", ",", "USE_RIGHT", ",", "{", "0x00", ",", "0x03", ",", "0x08", ",", "0x0b", "}", "},", "{", "1", ",", "2", ",", "USE_RIGHT", ",", "{", "0x01", ",", "0x04", ",", "0x09", ",", "0x0c", "}", "},", "{", "2", ",", "2", ",", "USE_RIGHT", ",", "{", "0x02", ",", "0x05", ",", "0x0a", ",", "0x0d", "}", "},", "{", "3", ",", "2", ",", "USE_RIGHT", ",", "{", "0x08", ",", "0x0b", ",", "0x00", ",", "0x00", "}", "},", "{", "4", ",", "2", ",", "USE_RIGHT", ",", "{", "0x09", ",", "0x0c", ",", "0x00", ",", "0x00", "}", "},", "{", "5", ",", "2", ",", "USE_RIGHT", ",", "{", "0x0a", ",", "0x0d", ",", "0x00", ",", "0x00", "}", "},", "{", "6", ",", "2", ",", "USE_RIGHT", ",", "{", "0x10", ",", "0x13", ",", "0x00", ",", "0x00", "}", "},", "{", "7", ",", "2", ",", "USE_RIGHT", ",", "{", "0x11", ",", "0x14", ",", "0x00", ",", "0x00", "}", "},", "{", "8", ",", "2", ",", "USE_RIGHT", ",", "{", "0x12", ",", "0x15", ",", "0x00", ",", "0x00", "}", "}", "}", ";", "/", "*", "*", "DMA", "buffer", "calls", "*", "/", "@", "@", "-", "1", ",", "45", "+", "0", ",", "0", "@", "@", "#", "define", "ALLOW_SELECT", "#", "undef", "NO_INLINE_ASM", "#", "define", "SHORT_BANNERS", "#", "define", "MANUAL_PNP", "#", "undef", "DO_TIMINGS", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "ifdef", "__KERNEL__", "#", "include", "<", "linux", "/", "string", ".", "h", ">", "#", "include", "<", "linux", "/", "fs", ".", "h", ">", "#", "include", "<", "asm", "/", "dma", ".", "h", ">", "#", "include", "<", "asm", "/", "io", ".", "h", ">", "#", "include", "<", "asm", "/", "param", ".", "h", ">", "#", "include", "<", "linux", "/", "sched", ".", "h", ">", "#", "include", "<", "linux", "/", "slab", ".", "h", ">", "#", "include", "<", "linux", "/", "ioport", ".", "h", ">", "#", "include", "<", "asm", "/", "page", ".", "h", ">", "#", "include", "<", "linux", "/", "vmalloc", ".", "h", ">", "#", "include", "<", "linux", "/", "uaccess", ".", "h", ">", "#", "include", "<", "linux", "/", "poll", ".", "h", ">", "#", "include", "<", "linux", "/", "pci", ".", "h", ">", "#", "endif", "#", "include", "<", "linux", "/", "soundcard", ".", "h", ">", "#", "define", "FALSE", "0", "#", "define", "TRUE", "1", "extern", "int", "sound_alloc_dma", "(", "int", "chn", ",", "char", "*", "deviceID", ")", ";", "extern", "int", "sound_open_dma", "(", "int", "chn", ",", "char", "*", "deviceID", ")", ";", "extern", "void", "sound_free_dma", "(", "int", "chn", ")", ";", "extern", "void", "sound_close_dma", "(", "int", "chn", ")", ";", "extern", "void", "reprogram_timer", "(", "void", ")", ";", "#", "define", "USE_AUTOINIT_DMA", "extern", "void", "*", "sound_mem_blocks", "[", "1024", "]", ";", "extern", "int", "sound_nblocks", ";", "#", "undef", "PSEUDO_DMA_AUTOINIT", "#", "define", "ALLOW_BUFFER_MAPPING", "extern", "const", "struct", "file_operations", "oss_sound_fops", ";", "@", "@", "-", "1", ",", "20", "+", "0", ",", "0", "@", "@", "/", "*", "From", "pas_card", ".", "c", "*", "/", "int", "pas_set_intr", "(", "int", "mask", ")", ";", "int", "pas_remove_intr", "(", "int", "mask", ")", ";", "unsigned", "char", "pas_read", "(", "int", "ioaddr", ")", ";", "void", "pas_write", "(", "unsigned", "char", "data", ",", "int", "ioaddr", ")", ";", "/", "*", "From", "pas_audio", ".", "c", "*", "/", "void", "pas_pcm_interrupt", "(", "unsigned", "char", "status", ",", "int", "cause", ")", ";", "void", "pas_pcm_init", "(", "struct", "address_info", "*", "hw_config", ")", ";", "/", "*", "From", "pas_mixer", ".", "c", "*", "/", "int", "pas_init_mixer", "(", "void", ")", ";", "/", "*", "From", "pas_midi", ".", "c", "*", "/", "void", "pas_midi_init", "(", "void", ")", ";", "void", "pas_midi_interrupt", "(", "void", ")", ";", "/", "*", "From", "pas2_mixer", ".", "c", "*", "/", "void", "mix_write", "(", "unsigned", "char", "data", ",", "int", "ioaddr", ")", ";", "@", "@", "-", "1", ",", "458", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "pas2_card", ".", "c", "*", "*", "Detection", "routine", "for", "the", "Pro", "Audio", "Spectrum", "cards", ".", "*", "/", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "interrupt", ".", "h", ">", "#", "include", "<", "linux", "/", "module", ".", "h", ">", "#", "include", "<", "linux", "/", "spinlock", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "pas2", ".", "h", "\"", "#", "include", "\"", "sb", ".", "h", "\"", "static", "unsigned", "char", "dma_bits", "[", "]", "=", "{", "4", ",", "1", ",", "2", ",", "3", ",", "0", ",", "5", ",", "6", ",", "7", "}", ";", "static", "unsigned", "char", "irq_bits", "[", "]", "=", "{", "0", ",", "0", ",", "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "0", ",", "1", ",", "7", ",", "8", ",", "9", ",", "0", ",", "10", ",", "11", "}", ";", "static", "unsigned", "char", "sb_irq_bits", "[", "]", "=", "{", "0x00", ",", "0x00", ",", "0x08", ",", "0x10", ",", "0x00", ",", "0x18", ",", "0x00", ",", "0x20", ",", "0x00", ",", "0x08", ",", "0x28", ",", "0x30", ",", "0x38", ",", "0", ",", "0", "}", ";", "static", "unsigned", "char", "sb_dma_bits", "[", "]", "=", "{", "0x00", ",", "0x40", ",", "0x80", ",", "0xC0", ",", "0", ",", "0", ",", "0", ",", "0", "}", ";", "/", "*", "*", "The", "Address", "Translation", "code", "is", "used", "to", "convert", "I", "/", "O", "register", "addresses", "to", "*", "be", "relative", "to", "the", "given", "base", "-", "register", "*", "/", "int", "pas_translate_code", "=", "0", ";", "static", "int", "pas_intr_mask", ";", "static", "int", "pas_irq", ";", "static", "int", "pas_sb_base", ";", "DEFINE_SPINLOCK", "(", "pas_lock", ")", ";", "#", "ifndef", "CONFIG_PAS_JOYSTICK", "static", "bool", "joystick", ";", "#", "else", "static", "bool", "joystick", "=", "1", ";", "#", "endif", "#", "ifdef", "SYMPHONY_PAS", "static", "bool", "symphony", "=", "1", ";", "#", "else", "static", "bool", "symphony", ";", "#", "endif", "#", "ifdef", "BROKEN_BUS_CLOCK", "static", "bool", "broken_bus_clock", "=", "1", ";", "#", "else", "static", "bool", "broken_bus_clock", ";", "#", "endif", "static", "struct", "address_info", "cfg", ";", "static", "struct", "address_info", "cfg2", ";", "char", "pas_model", "=", "0", ";", "static", "char", "*", "pas_model_names", "[", "]", "=", "{", "\"", "\",", "\"", "Pro", "AudioSpectrum", "+", "\",", "\"", "CDPC", "\"", ",", "\"", "Pro", "AudioSpectrum", "16", "\"", ",", "\"", "Pro", "AudioSpectrum", "16D", "\"", "}", ";", "/", "*", "*", "pas_read", "(", ")", "and", "pas_write", "(", ")", "are", "equivalents", "of", "inb", "and", "outb", "*", "These", "routines", "perform", "the", "I", "/", "O", "address", "translation", "required", "*", "to", "support", "other", "than", "the", "default", "base", "address", "*", "/", "unsigned", "char", "pas_read", "(", "int", "ioaddr", ")", "{", "return", "inb", "(", "ioaddr", "+", "pas_translate_code", ")", ";", "}", "void", "pas_write", "(", "unsigned", "char", "data", ",", "int", "ioaddr", ")", "{", "outb", "(", "(", "data", ")", ",", "ioaddr", "+", "pas_translate_code", ")", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Begin", "of", "the", "Interrupt", "Handler", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "static", "irqreturn_t", "pasintr", "(", "int", "irq", ",", "void", "*", "dev_id", ")", "{", "int", "status", ";", "status", "=", "pas_read", "(", "0x0B89", ")", ";", "pas_write", "(", "status", ",", "0x0B89", ")", ";", "/", "*", "Clear", "interrupt", "*", "/", "if", "(", "status", "&", "0x08", ")", "{", "pas_pcm_interrupt", "(", "status", ",", "1", ")", ";", "status", "&", "=", "~", "0x08", ";", "}", "if", "(", "status", "&", "0x10", ")", "{", "pas_midi_interrupt", "(", ");", "status", "&", "=", "~", "0x10", ";", "}", "return", "IRQ_HANDLED", ";", "}", "int", "pas_set_intr", "(", "int", "mask", ")", "{", "if", "(", "!", "mask", ")", "return", "0", ";", "pas_intr_mask", "|", "=", "mask", ";", "pas_write", "(", "pas_intr_mask", ",", "0x0B8B", ")", ";", "return", "0", ";", "}", "int", "pas_remove_intr", "(", "int", "mask", ")", "{", "if", "(", "!", "mask", ")", "return", "0", ";", "pas_intr_mask", "&", "=", "~", "mask", ";", "pas_write", "(", "pas_intr_mask", ",", "0x0B8B", ")", ";", "return", "0", ";", "}", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "End", "of", "the", "Interrupt", "handler", "*", "**", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "/", "**", "**", "**", "**", "**", "**", "**", "**", "**", "*", "Begin", "of", "the", "Initialization", "Code", "*", "**", "**", "**", "**", "**", "**", "**", "**", "*/", "static", "int", "__init", "config_pas_hw", "(", "struct", "address_info", "*", "hw_config", ")", "{", "char", "ok", "=", "1", ";", "unsigned", "int_ptrs", ";", "/", "*", "scsi", "/", "sound", "interrupt", "pointers", "*", "/", "pas_irq", "=", "hw_config", "-", ">", "irq", ";", "pas_write", "(", "0x00", ",", "0x0B8B", ")", ";", "pas_write", "(", "0x36", ",", "0x138B", ")", ";", "pas_write", "(", "0x36", ",", "0x1388", ")", ";", "pas_write", "(", "0", ",", "0x1388", ")", ";", "pas_write", "(", "0x74", ",", "0x138B", ")", ";", "pas_write", "(", "0x74", ",", "0x1389", ")", ";", "pas_write", "(", "0", ",", "0x1389", ")", ";", "pas_write", "(", "0x80", "|", "0x40", "|", "0x20", "|", "1", ",", "0x0B8A", ")", ";", "pas_write", "(", "0x80", "|", "0x20", "|", "0x10", "|", "0x08", "|", "0x01", ",", "0xF8A", ")", ";", "pas_write", "(", "0x01", "|", "0x02", "|", "0x04", "|", "0x10", "/", "*", "*", "|", "*", "0x80", "*", "/", ",", "0xB88", ")", ";", "pas_write", "(", "0x80", "|", "(", "joystick", "?", "0x40", ":", "0", ")", ",", "0xF388", ")", ";", "if", "(", "pas_irq", "<", "0", "|", "|", "pas_irq", ">", "15", ")", "{", "printk", "(", "KERN_ERR", "\"", "PAS16", ":", "Invalid", "IRQ", "%", "d", "\"", ",", "pas_irq", ")", ";", "hw_config", "-", ">", "irq", "=", "-", "1", ";", "ok", "=", "0", ";", "}", "else", "{", "int_ptrs", "=", "pas_read", "(", "0xF38A", ")", ";", "int_ptrs", "=", "(", "int_ptrs", "&", "0xf0", ")", "|", "irq_bits", "[", "pas_irq", "]", ";", "pas_write", "(", "int_ptrs", ",", "0xF38A", ")", ";", "if", "(", "!", "irq_bits", "[", "pas_irq", "]", ")", "{", "printk", "(", "KERN_ERR", "\"", "PAS16", ":", "Invalid", "IRQ", "%", "d", "\"", ",", "pas_irq", ")", ";", "hw_config", "-", ">", "irq", "=", "-", "1", ";", "ok", "=", "0", ";", "}", "else", "{", "if", "(", "request_irq", "(", "pas_irq", ",", "pasintr", ",", "0", ",", "\"", "PAS16", "\"", ",", "hw_config", ")", "<", "0", ")", "{", "printk", "(", "KERN_ERR", "\"", "PAS16", ":", "Cannot", "allocate", "IRQ", "%", "d", "\\", "n", "\"", ",", "pas_irq", ")", ";", "hw_config", "-", ">", "irq", "=", "-", "1", ";", "ok", "=", "0", ";", "}", "}", "}", "if", "(", "hw_config", "-", ">", "dma", "<", "0", "|", "|", "hw_config", "-", ">", "dma", ">", "7", ")", "{", "printk", "(", "KERN_ERR", "\"", "PAS16", ":", "Invalid", "DMA", "selection", "%", "d", "\"", ",", "hw_config", "-", ">", "dma", ")", ";", "hw_config", "-", ">", "dma", "=", "-", "1", ";", "ok", "=", "0", ";", "}", "else", "{", "pas_write", "(", "dma_bits", "[", "hw_config", "-", ">", "dma", "]", ",", "0xF389", ")", ";", "if", "(", "!", "dma_bits", "[", "hw_config", "-", ">", "dma", "]", ")", "{", "printk", "(", "KERN_ERR", "\"", "PAS16", ":", "Invalid", "DMA", "selection", "%", "d", "\"", ",", "hw_config", "-", ">", "dma", ")", ";", "hw_config", "-", ">", "dma", "=", "-", "1", ";", "ok", "=", "0", ";", "}", "else", "{", "if", "(", "sound_alloc_dma", "(", "hw_config", "-", ">", "dma", ",", "\"", "PAS16", "\"", "))", "{", "printk", "(", "KERN_ERR", "\"", "pas2_card", ".", "c", ":", "Can", "'", "t", "allocate", "DMA", "channel", "\\", "n", "\"", ");", "hw_config", "-", ">", "dma", "=", "-", "1", ";", "ok", "=", "0", ";", "}", "}", "}", "/", "*", "*", "This", "fixes", "the", "timing", "problems", "of", "the", "PAS", "due", "to", "the", "Symphony", "chipset", "*", "as", "per", "Media", "Vision", ".", "Only", "define", "this", "if", "your", "PAS", "doesn", "'", "t", "work", "correctly", ".", "*", "/", "if", "(", "symphony", ")", "{", "outb", "(", "(", "0x05", ")", ",", "0xa8", ")", ";", "outb", "(", "(", "0x60", ")", ",", "0xa9", ")", ";", "}", "if", "(", "broken_bus_clock", ")", "pas_write", "(", "0x01", "|", "0x10", "|", "0x20", "|", "0x04", ",", "0x8388", ")", ";", "else", "/", "*", "*", "pas_write", "(", "0x01", ",", "0x8388", ")", ";", "*", "/", "pas_write", "(", "0x01", "|", "0x10", "|", "0x20", ",", "0x8388", ")", ";", "pas_write", "(", "0x18", ",", "0x838A", ")", ";", "/", "*", "?", "??", "*", "/", "pas_write", "(", "0x20", "|", "0x01", ",", "0x0B8A", ")", ";", "/", "*", "Mute", "off", ",", "filter", "=", "17", ".", "897", "kHz", "*", "/", "pas_write", "(", "8", ",", "0xBF8A", ")", ";", "mix_write", "(", "0x80", "|", "5", ",", "0x078B", ")", ";", "mix_write", "(", "5", ",", "0x078B", ")", ";", "{", "struct", "address_info", "*", "sb_config", ";", "sb_config", "=", "&", "cfg2", ";", "if", "(", "sb_config", "-", ">", "io_base", ")", "{", "unsigned", "char", "irq_dma", ";", "/", "*", "*", "Turn", "on", "Sound", "Blaster", "compatibility", "*", "bit", "1", "=", "SB", "emulation", "*", "bit", "0", "=", "MPU401", "emulation", "(", "CDPC", "only", ":", "-(", ")", "*", "/", "pas_write", "(", "0x02", ",", "0xF788", ")", ";", "/", "*", "*", "\"", "Emulation", "address", "\"", "*", "/", "pas_write", "(", "(", "sb_config", "-", ">", "io_base", ">", ">", "4", ")", "&", "0x0f", ",", "0xF789", ")", ";", "pas_sb_base", "=", "sb_config", "-", ">", "io_base", ";", "if", "(", "!", "sb_dma_bits", "[", "sb_config", "-", ">", "dma", "]", ")", "printk", "(", "KERN_ERR", "\"", "PAS16", "Warning", ":", "Invalid", "SB", "DMA", "%", "d", "\\", "n", "\\", "n", "\"", ",", "sb_config", "-", ">", "dma", ")", ";", "if", "(", "!", "sb_irq_bits", "[", "sb_config", "-", ">", "irq", "]", ")", "printk", "(", "KERN_ERR", "\"", "PAS16", "Warning", ":", "Invalid", "SB", "IRQ", "%", "d", "\\", "n", "\\", "n", "\"", ",", "sb_config", "-", ">", "irq", ")", ";", "irq_dma", "=", "sb_dma_bits", "[", "sb_config", "-", ">", "dma", "]", "|", "sb_irq_bits", "[", "sb_config", "-", ">", "irq", "]", ";", "pas_write", "(", "irq_dma", ",", "0xFB8A", ")", ";", "}", "else", "pas_write", "(", "0x00", ",", "0xF788", ")", ";", "}", "if", "(", "!", "ok", ")", "printk", "(", "KERN_WARNING", "\"", "PAS16", ":", "Driver", "not", "enabled", "\\", "n", "\"", ");", "return", "ok", ";", "}", "static", "int", "__init", "detect_pas_hw", "(", "struct", "address_info", "*", "hw_config", ")", "{", "unsigned", "char", "board_id", ",", "foo", ";", "/", "*", "*", "WARNING", ":", "Setting", "an", "option", "like", "W", ":", "1", "or", "so", "that", "disables", "warm", "boot", "reset", "*", "of", "the", "card", "will", "screw", "up", "this", "detect", "code", "something", "fierce", ".", "Adding", "code", "*", "to", "handle", "this", "means", "possibly", "interfering", "with", "other", "cards", "on", "the", "bus", "if", "*", "you", "have", "something", "on", "base", "port", "0x388", ".", "SO", "be", "forewarned", ".", "*", "/", "outb", "(", "(", "0xBC", ")", ",", "0x9A01", ")", ";", "/", "*", "Activate", "first", "board", "*", "/", "outb", "(", "(", "hw_config", "-", ">", "io_base", ">", ">", "2", ")", ",", "0x9A01", ")", ";", "/", "*", "Set", "base", "address", "*", "/", "pas_translate_code", "=", "hw_config", "-", ">", "io_base", "-", "0x388", ";", "pas_write", "(", "1", ",", "0xBF88", ")", ";", "/", "*", "Select", "one", "wait", "states", "*", "/", "board_id", "=", "pas_read", "(", "0x0B8B", ")", ";", "if", "(", "board_id", "=", "=", "0xff", ")", "return", "0", ";", "/", "*", "*", "We", "probably", "have", "a", "PAS", "-", "series", "board", ",", "now", "check", "for", "a", "PAS16", "-", "series", "board", "*", "by", "trying", "to", "change", "the", "board", "revision", "bits", ".", "PAS16", "-", "series", "hardware", "won", "'", "t", "*", "let", "you", "do", "this", "-", "the", "bits", "are", "read", "-", "only", ".", "*", "/", "foo", "=", "board_id", "^", "0xe0", ";", "pas_write", "(", "foo", ",", "0x0B8B", ")", ";", "foo", "=", "pas_read", "(", "0x0B8B", ")", ";", "pas_write", "(", "board_id", ",", "0x0B8B", ")", ";", "if", "(", "board_id", "!", "=", "foo", ")", "return", "0", ";", "pas_model", "=", "pas_read", "(", "0xFF88", ")", ";", "return", "pas_model", ";", "}", "static", "void", "__init", "attach_pas_card", "(", "struct", "address_info", "*", "hw_config", ")", "{", "pas_irq", "=", "hw_config", "-", ">", "irq", ";", "if", "(", "detect_pas_hw", "(", "hw_config", ")", ")", "{", "if", "(", "(", "pas_model", "=", "pas_read", "(", "0xFF88", ")", "))", "{", "char", "temp", "[", "100", "]", ";", "if", "(", "pas_model", "<", "0", "|", "|", "pas_model", ">", "=", "ARRAY_SIZE", "(", "pas_model_names", ")", ")", "{", "printk", "(", "KERN_ERR", "\"", "pas2", "unrecognized", "model", ".", "\\", "n", "\"", ");", "return", ";", "}", "sprintf", "(", "temp", ",", "\"", "%", "s", "rev", "%", "d", "\"", ",", "pas_model_names", "[", "(", "int", ")", "pas_model", "]", ",", "pas_read", "(", "0x2789", ")", ");", "conf_printf", "(", "temp", ",", "hw_config", ")", ";", "}", "if", "(", "config_pas_hw", "(", "hw_config", ")", ")", "{", "pas_pcm_init", "(", "hw_config", ")", ";", "pas_midi_init", "(", ");", "pas_init_mixer", "(", ");", "}", "}", "}", "static", "inline", "int", "__init", "probe_pas", "(", "struct", "address_info", "*", "hw_config", ")", "{", "return", "detect_pas_hw", "(", "hw_config", ")", ";", "}", "static", "void", "__exit", "unload_pas", "(", "struct", "address_info", "*", "hw_config", ")", "{", "extern", "int", "pas_audiodev", ";", "extern", "int", "pas2_mididev", ";", "if", "(", "hw_config", "-", ">", "dma", ">", "0", ")", "sound_free_dma", "(", "hw_config", "-", ">", "dma", ")", ";", "if", "(", "hw_config", "-", ">", "irq", ">", "0", ")", "free_irq", "(", "hw_config", "-", ">", "irq", ",", "hw_config", ")", ";", "if", "(", "pas_audiodev", "!", "=-", "1", ")", "sound_unload_mixerdev", "(", "audio_devs", "[", "pas_audiodev", "]", "->", "mixer_dev", ")", ";", "if", "(", "pas2_mididev", "!", "=-", "1", ")", "sound_unload_mididev", "(", "pas2_mididev", ")", ";", "if", "(", "pas_audiodev", "!", "=-", "1", ")", "sound_unload_audiodev", "(", "pas_audiodev", ")", ";", "}", "static", "int", "__initdata", "io", "=", "-", "1", ";", "static", "int", "__initdata", "irq", "=", "-", "1", ";", "static", "int", "__initdata", "dma", "=", "-", "1", ";", "static", "int", "__initdata", "dma16", "=", "-", "1", ";", "/", "*", "Set", "this", "for", "modules", "that", "need", "it", "*", "/", "static", "int", "__initdata", "sb_io", "=", "0", ";", "static", "int", "__initdata", "sb_irq", "=", "-", "1", ";", "static", "int", "__initdata", "sb_dma", "=", "-", "1", ";", "static", "int", "__initdata", "sb_dma16", "=", "-", "1", ";", "module_param_hw", "(", "io", ",", "int", ",", "ioport", ",", "0", ")", ";", "module_param_hw", "(", "irq", ",", "int", ",", "irq", ",", "0", ")", ";", "module_param_hw", "(", "dma", ",", "int", ",", "dma", ",", "0", ")", ";", "module_param_hw", "(", "dma16", ",", "int", ",", "dma", ",", "0", ")", ";", "module_param_hw", "(", "sb_io", ",", "int", ",", "ioport", ",", "0", ")", ";", "module_param_hw", "(", "sb_irq", ",", "int", ",", "irq", ",", "0", ")", ";", "module_param_hw", "(", "sb_dma", ",", "int", ",", "dma", ",", "0", ")", ";", "module_param_hw", "(", "sb_dma16", ",", "int", ",", "dma", ",", "0", ")", ";", "module_param", "(", "joystick", ",", "bool", ",", "0", ")", ";", "module_param", "(", "symphony", ",", "bool", ",", "0", ")", ";", "module_param", "(", "broken_bus_clock", ",", "bool", ",", "0", ")", ";", "MODULE_LICENSE", "(", "\"", "GPL", "\"", ");", "static", "int", "__init", "init_pas2", "(", "void", ")", "{", "printk", "(", "KERN_INFO", "\"", "Pro", "Audio", "Spectrum", "driver", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1996", "\\", "n", "\"", ");", "cfg", ".", "io_base", "=", "io", ";", "cfg", ".", "irq", "=", "irq", ";", "cfg", ".", "dma", "=", "dma", ";", "cfg", ".", "dma2", "=", "dma16", ";", "cfg2", ".", "io_base", "=", "sb_io", ";", "cfg2", ".", "irq", "=", "sb_irq", ";", "cfg2", ".", "dma", "=", "sb_dma", ";", "cfg2", ".", "dma2", "=", "sb_dma16", ";", "if", "(", "cfg", ".", "io_base", "=", "=", "-", "1", "|", "|", "cfg", ".", "dma", "=", "=", "-", "1", "|", "|", "cfg", ".", "irq", "=", "=", "-", "1", ")", "{", "printk", "(", "KERN_INFO", "\"", "I", "/", "O", ",", "IRQ", ",", "DMA", "and", "type", "are", "mandatory", "\\", "n", "\"", ");", "return", "-", "EINVAL", ";", "}", "if", "(", "!", "probe_pas", "(", "&", "cfg", ")", ")", "return", "-", "ENODEV", ";", "attach_pas_card", "(", "&", "cfg", ")", ";", "return", "0", ";", "}", "static", "void", "__exit", "cleanup_pas2", "(", "void", ")", "{", "unload_pas", "(", "&", "cfg", ")", ";", "}", "module_init", "(", "init_pas2", ")", ";", "module_exit", "(", "cleanup_pas2", ")", ";", "#", "ifndef", "MODULE", "static", "int", "__init", "setup_pas2", "(", "char", "*", "str", ")", "{", "/", "*", "io", ",", "irq", ",", "dma", ",", "dma2", ",", "sb_io", ",", "sb_irq", ",", "sb_dma", ",", "sb_dma2", "*", "/", "int", "ints", "[", "9", "]", ";", "str", "=", "get_options", "(", "str", ",", "ARRAY_SIZE", "(", "ints", ")", ",", "ints", ")", ";", "io", "=", "ints", "[", "1", "]", ";", "irq", "=", "ints", "[", "2", "]", ";", "dma", "=", "ints", "[", "3", "]", ";", "dma16", "=", "ints", "[", "4", "]", ";", "sb_io", "=", "ints", "[", "5", "]", ";", "sb_irq", "=", "ints", "[", "6", "]", ";", "sb_dma", "=", "ints", "[", "7", "]", ";", "sb_dma16", "=", "ints", "[", "8", "]", ";", "return", "1", ";", "}", "__setup", "(", "\"", "pas2", "=", "\",", "setup_pas2", ")", ";", "#", "endif", "@", "@", "-", "1", ",", "262", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "pas2_midi", ".", "c", "*", "*", "The", "low", "level", "driver", "for", "the", "PAS", "Midi", "Interface", ".", "*", "/", "/", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "*", "Bartlomiej", "Zolnierkiewicz", ":", "Added", "__init", "to", "pas_init_mixer", "(", ")", "*", "/", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "<", "linux", "/", "spinlock", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "pas2", ".", "h", "\"", "extern", "spinlock_t", "pas_lock", ";", "static", "int", "midi_busy", ",", "input_opened", ";", "static", "int", "my_dev", ";", "int", "pas2_mididev", "=", "-", "1", ";", "static", "unsigned", "char", "tmp_queue", "[", "256", "]", ";", "static", "volatile", "int", "qlen", ";", "static", "volatile", "unsigned", "char", "qhead", ",", "qtail", ";", "static", "void", "(", "*", "midi_input_intr", ")", "(", "int", "dev", ",", "unsigned", "char", "data", ")", ";", "static", "int", "pas_midi_open", "(", "int", "dev", ",", "int", "mode", ",", "void", "(", "*", "input", ")", "(", "int", "dev", ",", "unsigned", "char", "data", ")", ",", "void", "(", "*", "output", ")", "(", "int", "dev", ")", ")", "{", "int", "err", ";", "unsigned", "long", "flags", ";", "unsigned", "char", "ctrl", ";", "if", "(", "midi_busy", ")", "return", "-", "EBUSY", ";", "/", "*", "*", "Reset", "input", "and", "output", "FIFO", "pointers", "*", "/", "pas_write", "(", "0x20", "|", "0x40", ",", "0x178b", ")", ";", "spin_lock_irqsave", "(", "&", "pas_lock", ",", "flags", ")", ";", "if", "(", "(", "err", "=", "pas_set_intr", "(", "0x10", ")", ")", "<", "0", ")", "{", "spin_unlock_irqrestore", "(", "&", "pas_lock", ",", "flags", ")", ";", "return", "err", ";", "}", "/", "*", "*", "Enable", "input", "available", "and", "output", "FIFO", "empty", "interrupts", "*", "/", "ctrl", "=", "0", ";", "input_opened", "=", "0", ";", "midi_input_intr", "=", "input", ";", "if", "(", "mode", "=", "=", "OPEN_READ", "|", "|", "mode", "=", "=", "OPEN_READWRITE", ")", "{", "ctrl", "|", "=", "0x04", ";", "/", "*", "Enable", "input", "*", "/", "input_opened", "=", "1", ";", "}", "if", "(", "mode", "=", "=", "OPEN_WRITE", "|", "|", "mode", "=", "=", "OPEN_READWRITE", ")", "{", "ctrl", "|", "=", "0x08", "|", "0x10", ";", "/", "*", "Enable", "output", "*", "/", "}", "pas_write", "(", "ctrl", ",", "0x178b", ")", ";", "/", "*", "*", "Acknowledge", "any", "pending", "interrupts", "*", "/", "pas_write", "(", "0xff", ",", "0x1B88", ")", ";", "spin_unlock_irqrestore", "(", "&", "pas_lock", ",", "flags", ")", ";", "midi_busy", "=", "1", ";", "qlen", "=", "qhead", "=", "qtail", "=", "0", ";", "return", "0", ";", "}", "static", "void", "pas_midi_close", "(", "int", "dev", ")", "{", "/", "*", "*", "Reset", "FIFO", "pointers", ",", "disable", "intrs", "*", "/", "pas_write", "(", "0x20", "|", "0x40", ",", "0x178b", ")", ";", "pas_remove_intr", "(", "0x10", ")", ";", "midi_busy", "=", "0", ";", "}", "static", "int", "dump_to_midi", "(", "unsigned", "char", "midi_byte", ")", "{", "int", "fifo_space", ",", "x", ";", "fifo_space", "=", "(", "(", "x", "=", "pas_read", "(", "0x1B89", ")", ")", ">", ">", "4", ")", "&", "0x0f", ";", "/", "*", "*", "The", "MIDI", "FIFO", "space", "register", "and", "it", "'", "s", "documentation", "is", "nonunderstandable", ".", "*", "There", "seem", "to", "be", "no", "way", "to", "differentiate", "between", "buffer", "full", "and", "buffer", "*", "empty", "situations", ".", "For", "this", "reason", "we", "don", "'", "t", "never", "write", "the", "buffer", "*", "completely", "full", ".", "In", "this", "way", "we", "can", "assume", "that", "0", "(", "or", "is", "it", "15", ")", "*", "means", "that", "the", "buffer", "is", "empty", ".", "*", "/", "if", "(", "fifo_space", "<", "2", "&", "&", "fifo_space", "!", "=", "0", ")", "/", "*", "Full", "(", "almost", ")", "*", "/", "return", "0", ";", "/", "*", "Ask", "upper", "layers", "to", "retry", "after", "some", "time", "*", "/", "pas_write", "(", "midi_byte", ",", "0x178A", ")", ";", "return", "1", ";", "}", "static", "int", "pas_midi_out", "(", "int", "dev", ",", "unsigned", "char", "midi_byte", ")", "{", "unsigned", "long", "flags", ";", "/", "*", "*", "Drain", "the", "local", "queue", "first", "*", "/", "spin_lock_irqsave", "(", "&", "pas_lock", ",", "flags", ")", ";", "while", "(", "qlen", "&", "&", "dump_to_midi", "(", "tmp_queue", "[", "qhead", "]", "))", "{", "qlen", "-", "-;", "qhead", "+", "+;", "}", "spin_unlock_irqrestore", "(", "&", "pas_lock", ",", "flags", ")", ";", "/", "*", "*", "Output", "the", "byte", "if", "the", "local", "queue", "is", "empty", ".", "*", "/", "if", "(", "!", "qlen", ")", "if", "(", "dump_to_midi", "(", "midi_byte", ")", ")", "return", "1", ";", "/", "*", "*", "Put", "to", "the", "local", "queue", "*", "/", "if", "(", "qlen", ">", "=", "256", ")", "return", "0", ";", "/", "*", "Local", "queue", "full", "*", "/", "spin_lock_irqsave", "(", "&", "pas_lock", ",", "flags", ")", ";", "tmp_queue", "[", "qtail", "]", "=", "midi_byte", ";", "qlen", "+", "+;", "qtail", "+", "+;", "spin_unlock_irqrestore", "(", "&", "pas_lock", ",", "flags", ")", ";", "return", "1", ";", "}", "static", "int", "pas_midi_start_read", "(", "int", "dev", ")", "{", "return", "0", ";", "}", "static", "int", "pas_midi_end_read", "(", "int", "dev", ")", "{", "return", "0", ";", "}", "static", "void", "pas_midi_kick", "(", "int", "dev", ")", "{", "}", "static", "int", "pas_buffer_status", "(", "int", "dev", ")", "{", "return", "qlen", ";", "}", "#", "define", "MIDI_SYNTH_NAME", "\"", "Pro", "Audio", "Spectrum", "Midi", "\"", "#", "define", "MIDI_SYNTH_CAPS", "SYNTH_CAP_INPUT", "#", "include", "\"", "midi_synth", ".", "h", "\"", "static", "struct", "midi_operations", "pas_midi_operations", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "info", "=", "{", "\"", "Pro", "Audio", "Spectrum", "\"", ",", "0", ",", "0", ",", "SNDCARD_PAS", "}", ",", ".", "converter", "=", "&", "std_midi_synth", ",", ".", "in_info", "=", "{", "0", "}", ",", ".", "open", "=", "pas_midi_open", ",", ".", "close", "=", "pas_midi_close", ",", ".", "outputc", "=", "pas_midi_out", ",", ".", "start_read", "=", "pas_midi_start_read", ",", ".", "end_read", "=", "pas_midi_end_read", ",", ".", "kick", "=", "pas_midi_kick", ",", ".", "buffer_status", "=", "pas_buffer_status", ",", "}", ";", "void", "__init", "pas_midi_init", "(", "void", ")", "{", "int", "dev", "=", "sound_alloc_mididev", "(", ");", "if", "(", "dev", "=", "=", "-", "1", ")", "{", "printk", "(", "KERN_WARNING", "\"", "pas_midi_init", ":", "Too", "many", "midi", "devices", "detected", "\\", "n", "\"", ");", "return", ";", "}", "std_midi_synth", ".", "midi_dev", "=", "my_dev", "=", "dev", ";", "midi_devs", "[", "dev", "]", "=", "&", "pas_midi_operations", ";", "pas2_mididev", "=", "dev", ";", "sequencer_init", "(", ");", "}", "void", "pas_midi_interrupt", "(", "void", ")", "{", "unsigned", "char", "stat", ";", "int", "i", ",", "incount", ";", "stat", "=", "pas_read", "(", "0x1B88", ")", ";", "if", "(", "stat", "&", "0x04", ")", "/", "*", "Input", "data", "available", "*", "/", "{", "incount", "=", "pas_read", "(", "0x1B89", ")", "&", "0x0f", ";", "/", "*", "Input", "FIFO", "size", "*", "/", "if", "(", "!", "incount", ")", "incount", "=", "16", ";", "for", "(", "i", "=", "0", ";", "i", "<", "incount", ";", "i", "+", "+)", "if", "(", "input_opened", ")", "{", "midi_input_intr", "(", "my_dev", ",", "pas_read", "(", "0x178A", ")", ");", "}", "else", "pas_read", "(", "0x178A", ")", ";", "/", "*", "Flush", "*", "/", "}", "if", "(", "stat", "&", "(", "0x08", "|", "0x10", ")", ")", "{", "spin_lock", "(", "&", "pas_lock", ")", ";/", "*", "called", "in", "irq", "context", "*", "/", "while", "(", "qlen", "&", "&", "dump_to_midi", "(", "tmp_queue", "[", "qhead", "]", "))", "{", "qlen", "-", "-;", "qhead", "+", "+;", "}", "spin_unlock", "(", "&", "pas_lock", ")", ";", "}", "if", "(", "stat", "&", "0x40", ")", "{", "printk", "(", "KERN_WARNING", "\"", "MIDI", "output", "overrun", "%", "x", ",", "%", "x", "\\", "n", "\"", ",", "pas_read", "(", "0x1B89", ")", ",", "stat", ")", ";", "}", "pas_write", "(", "stat", ",", "0x1B88", ")", ";", "/", "*", "Acknowledge", "interrupts", "*", "/", "}", "@", "@", "-", "1", ",", "327", "+", "0", ",", "0", "@", "@", "/", "*", "*", "sound", "/", "oss", "/", "pas2_mixer", ".", "c", "*", "*", "Mixer", "routines", "for", "the", "Pro", "Audio", "Spectrum", "cards", ".", "*", "/", "/", "*", "*", "Copyright", "(", "C", ")", "by", "Hannu", "Savolainen", "1993", "-", "1997", "*", "*", "OSS", "/", "Free", "for", "Linux", "is", "distributed", "under", "the", "GNU", "GENERAL", "PUBLIC", "LICENSE", "(", "GPL", ")", "*", "Version", "2", "(", "June", "1991", ")", ".", "See", "the", "\"", "COPYING", "\"", "file", "distributed", "with", "this", "software", "*", "for", "more", "info", ".", "*", "/", "/", "*", "*", "Thomas", "Sailer", ":", "ioctl", "code", "reworked", "(", "vmalloc", "/", "vfree", "removed", ")", "*", "Bartlomiej", "Zolnierkiewicz", ":", "added", "__init", "to", "pas_init_mixer", "(", ")", "*", "/", "#", "include", "<", "linux", "/", "init", ".", "h", ">", "#", "include", "\"", "sound_config", ".", "h", "\"", "#", "include", "\"", "pas2", ".", "h", "\"", "extern", "int", "pas_translate_code", ";", "extern", "char", "pas_model", ";", "extern", "int", "*", "pas_osp", ";", "extern", "int", "pas_audiodev", ";", "static", "int", "rec_devices", "=", "(", "SOUND_MASK_MIC", ")", ";", "/", "*", "Default", "recording", "source", "*", "/", "static", "int", "mode_control", ";", "#", "define", "POSSIBLE_RECORDING_DEVICES", "(", "SOUND_MASK_SYNTH", "|", "SOUND_MASK_SPEAKER", "|", "SOUND_MASK_LINE", "|", "SOUND_MASK_MIC", "|", "\\", "SOUND_MASK_CD", "|", "SOUND_MASK_ALTPCM", ")", "#", "define", "SUPPORTED_MIXER_DEVICES", "(", "SOUND_MASK_SYNTH", "|", "SOUND_MASK_PCM", "|", "SOUND_MASK_SPEAKER", "|", "SOUND_MASK_LINE", "|", "SOUND_MASK_MIC", "|", "\\", "SOUND_MASK_CD", "|", "SOUND_MASK_ALTPCM", "|", "SOUND_MASK_IMIX", "|", "\\", "SOUND_MASK_VOLUME", "|", "SOUND_MASK_BASS", "|", "SOUND_MASK_TREBLE", "|", "SOUND_MASK_RECLEV", ")", "static", "int", "*", "levels", ";", "static", "int", "default_levels", "[", "32", "]", "=", "{", "0x3232", ",", "/", "*", "Master", "Volume", "*", "/", "0x3232", ",", "/", "*", "Bass", "*", "/", "0x3232", ",", "/", "*", "Treble", "*", "/", "0x5050", ",", "/", "*", "FM", "*", "/", "0x4b4b", ",", "/", "*", "PCM", "*", "/", "0x3232", ",", "/", "*", "PC", "Speaker", "*", "/", "0x4b4b", ",", "/", "*", "Ext", "Line", "*", "/", "0x4b4b", ",", "/", "*", "Mic", "*", "/", "0x4b4b", ",", "/", "*", "CD", "*", "/", "0x6464", ",", "/", "*", "Recording", "monitor", "*", "/", "0x4b4b", ",", "/", "*", "SB", "PCM", "*", "/", "0x6464", "/", "*", "Recording", "level", "*", "/", "}", ";", "void", "mix_write", "(", "unsigned", "char", "data", ",", "int", "ioaddr", ")", "{", "/", "*", "*", "The", "Revision", "D", "cards", "have", "a", "problem", "with", "their", "MVA508", "interface", ".", "The", "*", "kludge", "-", "o", "-", "rama", "fix", "is", "to", "make", "a", "16", "-", "bit", "quantity", "with", "identical", "LSB", "and", "*", "MSBs", "out", "of", "the", "output", "byte", "and", "to", "do", "a", "16", "-", "bit", "out", "to", "the", "mixer", "port", "*", "1", ".", "We", "need", "to", "do", "this", "because", "it", "isn", "'", "t", "timing", "problem", "but", "chip", "access", "*", "sequence", "problem", ".", "*", "/", "if", "(", "pas_model", "=", "=", "4", ")", "{", "outw", "(", "data", "|", "(", "data", "<", "<", "8", ")", ",", "(", "ioaddr", "+", "pas_translate_code", ")", "-", "1", ")", ";", "outb", "(", "(", "0x80", ")", ",", "0", ")", ";", "}", "else", "pas_write", "(", "data", ",", "ioaddr", ")", ";", "}", "static", "int", "mixer_output", "(", "int", "right_vol", ",", "int", "left_vol", ",", "int", "div", ",", "int", "bits", ",", "int", "mixer", ")", "/", "*", "Input", "or", "output", "mixer", "*", "/", "{", "int", "left", "=", "left_vol", "*", "div", "/", "100", ";", "int", "right", "=", "right_vol", "*", "div", "/", "100", ";", "if", "(", "bits", "&", "0x10", ")", "{", "left", "|", "=", "mixer", ";", "right", "|", "=", "mixer", ";", "}", "if", "(", "bits", "=", "=", "0x03", "|", "|", "bits", "=", "=", "0x04", ")", "{", "mix_write", "(", "0x80", "|", "bits", ",", "0x078B", ")", ";", "mix_write", "(", "left", ",", "0x078B", ")", ";", "right_vol", "=", "left_vol", ";", "}", "else", "{", "mix_write", "(", "0x80", "|", "0x20", "|", "bits", ",", "0x078B", ")", ";", "mix_write", "(", "left", ",", "0x078B", ")", ";", "mix_write", "(", "0x80", "|", "0x40", "|", "bits", ",", "0x078B", ")", ";", "mix_write", "(", "right", ",", "0x078B", ")", ";", "}", "return", "(", "left_vol", "|", "(", "right_vol", "<", "<", "8", ")", ");", "}", "static", "void", "set_mode", "(", "int", "new_mode", ")", "{", "mix_write", "(", "0x80", "|", "0x05", ",", "0x078B", ")", ";", "mix_write", "(", "new_mode", ",", "0x078B", ")", ";", "mode_control", "=", "new_mode", ";", "}", "static", "int", "pas_mixer_set", "(", "int", "whichDev", ",", "unsigned", "int", "level", ")", "{", "int", "left", ",", "right", ",", "devmask", ",", "changed", ",", "i", ",", "mixer", "=", "0", ";", "left", "=", "level", "&", "0x7f", ";", "right", "=", "(", "level", "&", "0x7f00", ")", ">", ">", "8", ";", "if", "(", "whichDev", "<", "SOUND_MIXER_NRDEVICES", ")", "{", "if", "(", "(", "1", "<", "<", "whichDev", ")", "&", "rec_devices", ")", "mixer", "=", "0x20", ";", "else", "mixer", "=", "0x00", ";", "}", "switch", "(", "whichDev", ")", "{", "case", "SOUND_MIXER_VOLUME", ":", "/", "*", "Master", "volume", "(", "0", "-", "63", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "63", ",", "0x01", ",", "0", ")", ";", "break", ";", "/", "*", "*", "Note", "!", "Bass", "and", "Treble", "are", "mono", "devices", ".", "Will", "use", "just", "the", "left", "*", "channel", ".", "*", "/", "case", "SOUND_MIXER_BASS", ":", "/", "*", "Bass", "(", "0", "-", "12", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "12", ",", "0x03", ",", "0", ")", ";", "break", ";", "case", "SOUND_MIXER_TREBLE", ":", "/", "*", "Treble", "(", "0", "-", "12", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "12", ",", "0x04", ",", "0", ")", ";", "break", ";", "case", "SOUND_MIXER_SYNTH", ":", "/", "*", "Internal", "synthesizer", "(", "0", "-", "31", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "31", ",", "0x10", "|", "0x00", ",", "mixer", ")", ";", "break", ";", "case", "SOUND_MIXER_PCM", ":", "/", "*", "PAS", "PCM", "(", "0", "-", "31", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "31", ",", "0x10", "|", "0x05", ",", "mixer", ")", ";", "break", ";", "case", "SOUND_MIXER_ALTPCM", ":", "/", "*", "SB", "PCM", "(", "0", "-", "31", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "31", ",", "0x10", "|", "0x07", ",", "mixer", ")", ";", "break", ";", "case", "SOUND_MIXER_SPEAKER", ":", "/", "*", "PC", "speaker", "(", "0", "-", "31", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "31", ",", "0x10", "|", "0x06", ",", "mixer", ")", ";", "break", ";", "case", "SOUND_MIXER_LINE", ":", "/", "*", "External", "line", "(", "0", "-", "31", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "31", ",", "0x10", "|", "0x02", ",", "mixer", ")", ";", "break", ";", "case", "SOUND_MIXER_CD", ":", "/", "*", "CD", "(", "0", "-", "31", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "31", ",", "0x10", "|", "0x03", ",", "mixer", ")", ";", "break", ";", "case", "SOUND_MIXER_MIC", ":", "/", "*", "External", "microphone", "(", "0", "-", "31", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "31", ",", "0x10", "|", "0x04", ",", "mixer", ")", ";", "break", ";", "case", "SOUND_MIXER_IMIX", ":", "/", "*", "Recording", "monitor", "(", "0", "-", "31", ")", "(", "Output", "mixer", "only", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "31", ",", "0x10", "|", "0x01", ",", "0x00", ")", ";", "break", ";", "case", "SOUND_MIXER_RECLEV", ":", "/", "*", "Recording", "level", "(", "0", "-", "15", ")", "*", "/", "levels", "[", "whichDev", "]", "=", "mixer_output", "(", "right", ",", "left", ",", "15", ",", "0x02", ",", "0", ")", ";", "break", ";", "case", "SOUND_MIXER_RECSRC", ":", "devmask", "=", "level", "&", "POSSIBLE_RECORDING_DEVICES", ";", "changed", "=", "devmask", "^", "rec_devices", ";", "rec_devices", "=", "devmask", ";", "for", "(", "i", "=", "0", ";", "i", "<", "SOUND_MIXER_NRDEVICES", ";", "i", "+", "+)", "if", "(", "changed", "&", "(", "1", "<", "<", "i", ")", ")", "{", "pas_mixer_set", "(", "i", ",", "levels", "[", "i", "]", ");", "}", "return", "rec_devices", ";", "break", ";", "default", ":", "return", "-", "EINVAL", ";", "}", "return", "(", "levels", "[", "whichDev", "]", ");", "}", "/", "**", "**", "*/", "static", "void", "pas_mixer_reset", "(", "void", ")", "{", "int", "foo", ";", "for", "(", "foo", "=", "0", ";", "foo", "<", "SOUND_MIXER_NRDEVICES", ";", "foo", "+", "+)", "pas_mixer_set", "(", "foo", ",", "levels", "[", "foo", "]", ");", "set_mode", "(", "0x04", "|", "0x01", ")", ";", "}", "static", "int", "pas_mixer_ioctl", "(", "int", "dev", ",", "unsigned", "int", "cmd", ",", "void", "__user", "*", "arg", ")", "{", "int", "level", ",", "v", ";", "int", "__user", "*", "p", "=", "(", "int", "__user", "*", ")", "arg", ";", "if", "(", "cmd", "=", "=", "SOUND_MIXER_PRIVATE1", ")", "{", "/", "*", "Set", "loudness", "bit", "*", "/", "if", "(", "get_user", "(", "level", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "level", "=", "=", "-", "1", ")", "/", "*", "Return", "current", "settings", "*", "/", "level", "=", "(", "mode_control", "&", "0x04", ")", ";", "else", "{", "mode_control", "&", "=", "~", "0x04", ";", "if", "(", "level", ")", "mode_control", "|", "=", "0x04", ";", "set_mode", "(", "mode_control", ")", ";", "}", "level", "=", "!", "!", "level", ";", "return", "put_user", "(", "level", ",", "p", ")", ";", "}", "if", "(", "cmd", "=", "=", "SOUND_MIXER_PRIVATE2", ")", "{", "/", "*", "Set", "enhance", "bit", "*", "/", "if", "(", "get_user", "(", "level", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "level", "=", "=", "-", "1", ")", "{", "/", "*", "Return", "current", "settings", "*", "/", "if", "(", "!(", "mode_control", "&", "0x03", ")", ")", "level", "=", "0", ";", "else", "level", "=", "(", "(", "mode_control", "&", "0x03", ")", "+", "1", ")", "*", "20", ";", "}", "else", "{", "int", "i", "=", "0", ";", "level", "&", "=", "0x7f", ";", "if", "(", "level", ")", "i", "=", "(", "level", "/", "20", ")", "-", "1", ";", "mode_control", "&", "=", "~", "0x03", ";", "mode_control", "|", "=", "i", "&", "0x03", ";", "set_mode", "(", "mode_control", ")", ";", "if", "(", "i", ")", "i", "=", "(", "i", "+", "1", ")", "*", "20", ";", "level", "=", "i", ";", "}", "return", "put_user", "(", "level", ",", "p", ")", ";", "}", "if", "(", "cmd", "=", "=", "SOUND_MIXER_PRIVATE3", ")", "{", "/", "*", "Set", "mute", "bit", "*", "/", "if", "(", "get_user", "(", "level", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "level", "=", "=", "-", "1", ")", "/", "*", "Return", "current", "settings", "*", "/", "level", "=", "!", "(", "pas_read", "(", "0x0B8A", ")", "&", "0x20", ")", ";", "else", "{", "if", "(", "level", ")", "pas_write", "(", "pas_read", "(", "0x0B8A", ")", "&", "(", "~", "0x20", ")", ",", "0x0B8A", ")", ";", "else", "pas_write", "(", "pas_read", "(", "0x0B8A", ")", "|", "0x20", ",", "0x0B8A", ")", ";", "level", "=", "!", "(", "pas_read", "(", "0x0B8A", ")", "&", "0x20", ")", ";", "}", "return", "put_user", "(", "level", ",", "p", ")", ";", "}", "if", "(", "((", "cmd", ">", ">", "8", ")", "&", "0xff", ")", "=", "=", "'", "M", "'", ")", "{", "if", "(", "get_user", "(", "v", ",", "p", ")", ")", "return", "-", "EFAULT", ";", "if", "(", "_SIOC_DIR", "(", "cmd", ")", "&", "_SIOC_WRITE", ")", "{", "v", "=", "pas_mixer_set", "(", "cmd", "&", "0xff", ",", "v", ")", ";", "}", "else", "{", "switch", "(", "cmd", "&", "0xff", ")", "{", "case", "SOUND_MIXER_RECSRC", ":", "v", "=", "rec_devices", ";", "break", ";", "case", "SOUND_MIXER_STEREODEVS", ":", "v", "=", "SUPPORTED_MIXER_DEVICES", "&", "~", "(", "SOUND_MASK_BASS", "|", "SOUND_MASK_TREBLE", ")", ";", "break", ";", "case", "SOUND_MIXER_DEVMASK", ":", "v", "=", "SUPPORTED_MIXER_DEVICES", ";", "break", ";", "case", "SOUND_MIXER_RECMASK", ":", "v", "=", "POSSIBLE_RECORDING_DEVICES", "&", "SUPPORTED_MIXER_DEVICES", ";", "break", ";", "case", "SOUND_MIXER_CAPS", ":", "v", "=", "0", ";", "/", "*", "No", "special", "capabilities", "*", "/", "break", ";", "default", ":", "v", "=", "levels", "[", "cmd", "&", "0xff", "]", ";", "break", ";", "}", "}", "return", "put_user", "(", "v", ",", "p", ")", ";", "}", "return", "-", "EINVAL", ";", "}", "static", "struct", "mixer_operations", "pas_mixer_operations", "=", "{", ".", "owner", "=", "THIS_MODULE", ",", ".", "id", "=", "\"", "PAS16", "\"", ",", ".", "name", "=", "\"", "Pro", "Audio", "Spectrum", "16", "\"", ",", ".", "ioctl", "=", "pas_mixer_ioctl", "}", ";", "int", "__init", "pas_init_mixer", "(", "void", ")", "{", "int", "d", ";", "levels", "=", "load_mixer_volumes", "(", "\"", "PAS16_1", "\"", ",", "default_levels", ",", "1", ")", ";", "pas_mixer_reset", "(", ");", "if", "(", "(", "d", "=", "sound_alloc_mixerdev", "(", "))", "!", "=", "-", "1", ")", "{", "audio_devs", "[", "pas_audiodev", "]", "->", "mixer_dev", "=", "d", ";", "mixer_devs", "[", "d", "]", "=", "&", "pas_mixer_operations", ";", "}", "return", "1", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(over-boundary", "access", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1250", ",", "18", "+", "1250", ",", "72", "@", "@", "ENTRY", "(", "nmi", ")", "*", "a", "nested", "NMI", "that", "updated", "the", "copy", "interrupt", "stack", "frame", ",", "a", "*", "jump", "will", "be", "made", "to", "the", "repeat_nmi", "code", "that", "will", "handle", "the", "second", "*", "NMI", ".", "*", "*", "However", ",", "espfix", "prevents", "us", "from", "directly", "returning", "to", "userspace", "*", "with", "a", "single", "IRET", "instruction", ".", "Similarly", ",", "IRET", "to", "user", "mode", "*", "can", "fault", ".", "We", "therefore", "handle", "NMIs", "from", "user", "space", "like", "*", "other", "IST", "entries", ".", "*", "/", "/", "*", "Use", "%", "rdx", "as", "our", "temp", "variable", "throughout", "*", "/", "pushq", "%", "rdx", "testb", "$", "3", ",", "CS", "-", "RIP", "+", "8", "(", "%", "rsp", ")", "jz", ".", "Lnmi_from_kernel", "/", "*", "*", "NMI", "from", "user", "mode", ".", "We", "need", "to", "run", "on", "the", "thread", "stack", ",", "but", "we", "*", "can", "'", "t", "go", "through", "the", "normal", "entry", "paths", ":", "NMIs", "are", "masked", ",", "and", "*", "we", "don", "'", "t", "want", "to", "enable", "interrupts", ",", "because", "then", "we", "'", "ll", "end", "*", "up", "in", "an", "awkward", "situation", "in", "which", "IRQs", "are", "on", "but", "NMIs", "*", "are", "off", ".", "*", "/", "SWAPGS", "cld", "movq", "%", "rsp", ",", "%", "rdx", "movq", "PER_CPU_VAR", "(", "cpu_current_top_of_stack", ")", ",", "%", "rsp", "pushq", "5", "*", "8", "(", "%", "rdx", ")", "/", "*", "pt_regs", "-", ">", "ss", "*", "/", "pushq", "4", "*", "8", "(", "%", "rdx", ")", "/", "*", "pt_regs", "-", ">", "rsp", "*", "/", "pushq", "3", "*", "8", "(", "%", "rdx", ")", "/", "*", "pt_regs", "-", ">", "flags", "*", "/", "pushq", "2", "*", "8", "(", "%", "rdx", ")", "/", "*", "pt_regs", "-", ">", "cs", "*", "/", "pushq", "1", "*", "8", "(", "%", "rdx", ")", "/", "*", "pt_regs", "-", ">", "rip", "*", "/", "pushq", "$", "-", "1", "/", "*", "pt_regs", "-", ">", "orig_ax", "*", "/", "pushq", "%", "rdi", "/", "*", "pt_regs", "-", ">", "di", "*", "/", "pushq", "%", "rsi", "/", "*", "pt_regs", "-", ">", "si", "*", "/", "pushq", "(", "%", "rdx", ")", "/", "*", "pt_regs", "-", ">", "dx", "*", "/", "pushq", "%", "rcx", "/", "*", "pt_regs", "-", ">", "cx", "*", "/", "pushq", "%", "rax", "/", "*", "pt_regs", "-", ">", "ax", "*", "/", "pushq", "%", "r8", "/", "*", "pt_regs", "-", ">", "r8", "*", "/", "pushq", "%", "r9", "/", "*", "pt_regs", "-", ">", "r9", "*", "/", "pushq", "%", "r10", "/", "*", "pt_regs", "-", ">", "r10", "*", "/", "pushq", "%", "r11", "/", "*", "pt_regs", "-", ">", "r11", "*", "/", "pushq", "%", "rbx", "/", "*", "pt_regs", "-", ">", "rbx", "*", "/", "pushq", "%", "rbp", "/", "*", "pt_regs", "-", ">", "rbp", "*", "/", "pushq", "%", "r12", "/", "*", "pt_regs", "-", ">", "r12", "*", "/", "pushq", "%", "r13", "/", "*", "pt_regs", "-", ">", "r13", "*", "/", "pushq", "%", "r14", "/", "*", "pt_regs", "-", ">", "r14", "*", "/", "pushq", "%", "r15", "/", "*", "pt_regs", "-", ">", "r15", "*", "/", "/", "*", "*", "If", "%", "cs", "was", "not", "the", "kernel", "segment", ",", "then", "the", "NMI", "triggered", "in", "user", "*", "space", ",", "which", "means", "it", "is", "definitely", "not", "nested", ".", "*", "At", "this", "point", "we", "no", "longer", "need", "to", "worry", "about", "stack", "damage", "*", "due", "to", "nesting", "-", "-", "we", "'", "re", "on", "the", "normal", "thread", "stack", "and", "we", "'", "re", "*", "done", "with", "the", "NMI", "stack", ".", "*", "/", "cmpl", "$", "__KERNEL_CS", ",", "16", "(", "%", "rsp", ")", "jne", "first_nmi", "movq", "%", "rsp", ",", "%", "rdi", "movq", "$", "-", "1", ",", "%", "rsi", "call", "do_nmi", "/", "*", "*", "Return", "back", "to", "user", "mode", ".", "We", "must", "*", "not", "*", "do", "the", "normal", "exit", "*", "work", ",", "because", "we", "don", "'", "t", "want", "to", "enable", "interrupts", ".", "Fortunately", ",", "*", "do_nmi", "doesn", "'", "t", "modify", "pt_regs", ".", "*", "/", "SWAPGS", "jmp", "restore_c_regs_and_iret", ".", "Lnmi_from_kernel", ":", "/", "*", "*", "Check", "the", "special", "variable", "on", "the", "stack", "to", "see", "if", "NMIs", "are", "*", "executing", "."], "docstring_tokens": ["gain", "elevated", "privileges", "on", "the", "system", "or", "cause", "the", "system", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "284", ",", "16", "+", "284", ",", "7", "@", "@", "private", "boolean", "isInvalidEncodedPath", "(", "String", "resourcePath", ")", "{", "/", "/", "Use", "URLDecoder", "(", "vs", "UriUtils", ")", "to", "preserve", "potentially", "decoded", "UTF", "-", "8", "chars", ".", "..", "try", "{", "String", "decodedPath", "=", "URLDecoder", ".", "decode", "(", "resourcePath", ",", "\"", "UTF", "-", "8", "\"", ");", "int", "separatorIndex", "=", "decodedPath", ".", "indexOf", "(", "\".", ".\"", ")", "+", "2", ";", "if", "(", "separatorIndex", ">", "1", "&", "&", "separatorIndex", "<", "decodedPath", ".", "length", "(", "))", "{", "char", "separator", "=", "decodedPath", ".", "charAt", "(", "separatorIndex", ")", ";", "if", "(", "separator", "=", "=", "'", "/'", "|", "|", "separator", "=", "=", "'", "\\\\", "')", "{", "if", "(", "logger", ".", "isTraceEnabled", "(", "))", "{", "logger", ".", "trace", "(", "\"", "Resolved", "resource", "path", "contains", "\\", "\".", "./", "\\\"", "after", "decoding", ":", "\"", "+", "resourcePath", ")", ";", "}", "}", "return", "true", ";", "}", "return", "(", "decodedPath", ".", "contains", "(", "\".", "./", "\")", "|", "|", "decodedPath", ".", "contains", "(", "\".", ".\\", "\\\"", "))", ";", "}", "catch", "(", "UnsupportedEncodingException", "ex", ")", "{", "/", "/", "Should", "never", "happen", ".", ".."], "docstring_tokens": ["serve", "static", "resources"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "461", ",", "12", "+", "461", ",", "13", "@", "@", "private", "String", "trace", "(", "Throwable", "t", ")", "{", "return", "result", ";", "}", "private", "static", "Set", "<", "String", ">", "keysWithVariableValues", "(", "Map", "<", "String", ",", "String", ">", "rawConfig", ",", "Pattern", "pattern", ")", "{", "/", "/", "Visible", "for", "testing", "static", "Set", "<", "String", ">", "keysWithVariableValues", "(", "Map", "<", "String", ",", "String", ">", "rawConfig", ",", "Pattern", "pattern", ")", "{", "Set", "<", "String", ">", "keys", "=", "new", "HashSet", "<", ">(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "config", ":", "rawConfig", ".", "entrySet", "(", "))", "{", "if", "(", "config", ".", "getValue", "(", ")", "!", "=", "null", ")", "{", "Matcher", "matcher", "=", "pattern", ".", "matcher", "(", "config", ".", "getValue", "(", "))", ";", "if", "(", "matcher", ".", "matches", "(", "))", "{", "if", "(", "matcher", ".", "find", "(", "))", "{", "keys", ".", "add", "(", "config", ".", "getKey", "(", "))", ";", "}", "}", "@", "@", "-", "18", ",", "6", "+", "18", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "config", ".", "ConfigDef", ";", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "config", ".", "ConfigException", ";", "import", "org", ".", "apache", ".", "kafka", ".", "common", ".", "config", ".", "ConfigTransformer", ";", "import", "org", ".", "apache", ".", "kafka", ".", "connect", ".", "connector", ".", "ConnectRecord", ";", "import", "org", ".", "apache", ".", "kafka", ".", "connect", ".", "connector", ".", "Connector", ";", "import", "org", ".", "apache", ".", "kafka", ".", "connect", ".", "runtime", ".", "distributed", ".", "ClusterConfigState", ";", "@", "@", "-", "52", ",", "6", "+", "53", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "static", "org", ".", "apache", ".", "kafka", ".", "connect", ".", "runtime", ".", "AbstractHerder", ".", "keysWithVariableValues", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "easymock", ".", "PowerMock", ".", "verifyAll", ";", "import", "static", "org", ".", "powermock", ".", "api", ".", "easymock", ".", "PowerMock", ".", "replayAll", ";", "import", "static", "org", ".", "easymock", ".", "EasyMock", ".", "strictMock", ";", "@", "@", "-", "322", ",", "6", "+", "324", ",", "32", "@", "@", "public", "void", "testReverseTransformConfigs", "(", ")", "throws", "Exception", "{", "assertFalse", "(", "reverseTransformed", ".", "get", "(", "0", ")", ".", "containsKey", "(", "TEST_KEY3", ")", ");", "}", "@", "Test", "public", "void", "testConfigProviderRegex", "(", ")", "{", "testConfigProviderRegex", "(", "\"\\", "\"$", "{:", ":}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"$", "{:", ":}", "\")", ";", "testConfigProviderRegex", "(", "\"\\", "\"$", "{:", "/", "a", ":", "somevar", "}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"\\", "\"$", "{", "file", ":", ":", "somevar", "}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"$", "{", "file", ":", "/", "a", "/", "b", "/", "c", ":", "}\"", ");", "testConfigProviderRegex", "(", "\"$", "{", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "\")", ";", "testConfigProviderRegex", "(", "\"\\", "\"$", "{", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "=", "\\\"", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "\\\"", "\")", ";", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "=", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "\")", ";", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "=", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "not", "null", "\"", ");", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "=", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "somevar", "}", "password", "=", "${", "file", ":", "/", "tmp", "/", "somefile", ".", "txt", ":", "othervar", "}", "\")", ";", "testConfigProviderRegex", "(", "\"", "plain", ".", "PlainLoginModule", "required", "username", "\"", ",", "false", ")", ";", "}", "private", "void", "testConfigProviderRegex", "(", "String", "rawConnConfig", ")", "{", "testConfigProviderRegex", "(", "rawConnConfig", ",", "true", ")", ";", "}", "private", "void", "testConfigProviderRegex", "(", "String", "rawConnConfig", ",", "boolean", "expected", ")", "{", "Set", "<", "String", ">", "keys", "=", "keysWithVariableValues", "(", "Collections", ".", "singletonMap", "(", "\"", "key", "\"", ",", "rawConnConfig", ")", ",", "ConfigTransformer", ".", "DEFAULT_PATTERN", ")", ";", "boolean", "actual", "=", "keys", "!", "=", "null", "&", "&", "!", "keys", ".", "isEmpty", "(", ")", "&", "&", "keys", ".", "contains", "(", "\"", "key", "\"", ");", "assertEquals", "(", "String", ".", "format", "(", "\"%", "s", "should", "have", "matched", "regex", "\"", ",", "rawConnConfig", ")", ",", "expected", ",", "actual", ")", ";", "}", "private", "AbstractHerder", "createConfigValidationHerder", "(", "Class", "<", "?", "extends", "Connector", ">", "connectorClass", ")", "{", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "class", "ConnectRestApiTest", "(", "KafkaTest", ")", ":", "INPUT_FILE2", "=", "\"", "/", "mnt", "/", "connect", ".", "input2", "\"", "OUTPUT_FILE", "=", "\"", "/", "mnt", "/", "connect", ".", "output", "\"", "TOPIC", "=", "\"", "${", "file", ":", "%", "s", ":", "topic", ".", "external", "}", "\"", "%", "ConnectServiceBase", ".", "EXTERNAL_CONFIGS_FILE", "TOPIC", "=", "\"", "topic", "-", "${", "file", ":", "%", "s", ":", "topic", ".", "external", "}", "\"", "%", "ConnectServiceBase", ".", "EXTERNAL_CONFIGS_FILE", "TOPIC_TEST", "=", "\"", "test", "\"", "DEFAULT_BATCH_SIZE", "=", "\"", "2000", "\""], "docstring_tokens": ["obtain", "sensitive", "information", "in", "tasks", "endpoint"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1275", ",", "6", "+", "1275", ",", "53", "@", "@", "static", "void", "check_unsafe_exec", "(", "struct", "linux_binprm", "*", "bprm", ")", "spin_unlock", "(", "&", "p", "-", ">", "fs", "-", ">", "lock", ")", ";", "}", "static", "void", "bprm_fill_uid", "(", "struct", "linux_binprm", "*", "bprm", ")", "{", "struct", "inode", "*", "inode", ";", "unsigned", "int", "mode", ";", "kuid_t", "uid", ";", "kgid_t", "gid", ";", "/", "*", "clear", "any", "previous", "set", "[", "ug", "]", "id", "data", "from", "a", "previous", "binary", "*", "/", "bprm", "-", ">", "cred", "-", ">", "euid", "=", "current_euid", "(", ");", "bprm", "-", ">", "cred", "-", ">", "egid", "=", "current_egid", "(", ");", "if", "(", "bprm", "-", ">", "file", "-", ">", "f_path", ".", "mnt", "-", ">", "mnt_flags", "&", "MNT_NOSUID", ")", "return", ";", "if", "(", "task_no_new_privs", "(", "current", ")", ")", "return", ";", "inode", "=", "file_inode", "(", "bprm", "-", ">", "file", ")", ";", "mode", "=", "READ_ONCE", "(", "inode", "-", ">", "i_mode", ")", ";", "if", "(", "!(", "mode", "&", "(", "S_ISUID", "|", "S_ISGID", ")", "))", "return", ";", "/", "*", "Be", "careful", "if", "suid", "/", "sgid", "is", "set", "*", "/", "mutex_lock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "/", "*", "reload", "atomically", "mode", "/", "uid", "/", "gid", "now", "that", "lock", "held", "*", "/", "mode", "=", "inode", "-", ">", "i_mode", ";", "uid", "=", "inode", "-", ">", "i_uid", ";", "gid", "=", "inode", "-", ">", "i_gid", ";", "mutex_unlock", "(", "&", "inode", "-", ">", "i_mutex", ")", ";", "/", "*", "We", "ignore", "suid", "/", "sgid", "if", "there", "are", "no", "mappings", "for", "them", "in", "the", "ns", "*", "/", "if", "(", "!", "kuid_has_mapping", "(", "bprm", "-", ">", "cred", "-", ">", "user_ns", ",", "uid", ")", "|", "|", "!", "kgid_has_mapping", "(", "bprm", "-", ">", "cred", "-", ">", "user_ns", ",", "gid", ")", ")", "return", ";", "if", "(", "mode", "&", "S_ISUID", ")", "{", "bprm", "-", ">", "per_clear", "|", "=", "PER_CLEAR_ON_SETID", ";", "bprm", "-", ">", "cred", "-", ">", "euid", "=", "uid", ";", "}", "if", "(", "(", "mode", "&", "(", "S_ISGID", "|", "S_IXGRP", ")", ")", "=", "=", "(", "S_ISGID", "|", "S_IXGRP", ")", ")", "{", "bprm", "-", ">", "per_clear", "|", "=", "PER_CLEAR_ON_SETID", ";", "bprm", "-", ">", "cred", "-", ">", "egid", "=", "gid", ";", "}", "}", "/", "*", "*", "Fill", "the", "binprm", "structure", "from", "the", "inode", ".", "*", "Check", "permissions", ",", "then", "read", "the", "first", "128", "(", "BINPRM_BUF_SIZE", ")", "bytes", "@", "@", "-", "1283", ",", "36", "+", "1330", ",", "9", "@", "@", "static", "void", "check_unsafe_exec", "(", "struct", "linux_binprm", "*", "bprm", ")", "*", "/", "int", "prepare_binprm", "(", "struct", "linux_binprm", "*", "bprm", ")", "{", "struct", "inode", "*", "inode", "=", "file_inode", "(", "bprm", "-", ">", "file", ")", ";", "umode_t", "mode", "=", "inode", "-", ">", "i_mode", ";", "int", "retval", ";", "/", "*", "clear", "any", "previous", "set", "[", "ug", "]", "id", "data", "from", "a", "previous", "binary", "*", "/", "bprm", "-", ">", "cred", "-", ">", "euid", "=", "current_euid", "(", ");", "bprm", "-", ">", "cred", "-", ">", "egid", "=", "current_egid", "(", ");", "if", "(", "!(", "bprm", "-", ">", "file", "-", ">", "f_path", ".", "mnt", "-", ">", "mnt_flags", "&", "MNT_NOSUID", ")", "&", "&", "!", "task_no_new_privs", "(", "current", ")", "&", "&", "kuid_has_mapping", "(", "bprm", "-", ">", "cred", "-", ">", "user_ns", ",", "inode", "-", ">", "i_uid", ")", "&", "&", "kgid_has_mapping", "(", "bprm", "-", ">", "cred", "-", ">", "user_ns", ",", "inode", "-", ">", "i_gid", ")", ")", "{", "/", "*", "Set", "-", "uid", "?", "*", "/", "if", "(", "mode", "&", "S_ISUID", ")", "{", "bprm", "-", ">", "per_clear", "|", "=", "PER_CLEAR_ON_SETID", ";", "bprm", "-", ">", "cred", "-", ">", "euid", "=", "inode", "-", ">", "i_uid", ";", "}", "/", "*", "Set", "-", "gid", "?", "*", "/", "/", "*", "*", "If", "setgid", "is", "set", "but", "no", "group", "execute", "bit", "then", "this", "*", "is", "a", "candidate", "for", "mandatory", "locking", ",", "not", "a", "setgid", "*", "executable", ".", "*", "/", "if", "(", "(", "mode", "&", "(", "S_ISGID", "|", "S_IXGRP", ")", ")", "=", "=", "(", "S_ISGID", "|", "S_IXGRP", ")", ")", "{", "bprm", "-", ">", "per_clear", "|", "=", "PER_CLEAR_ON_SETID", ";", "bprm", "-", ">", "cred", "-", ">", "egid", "=", "inode", "-", ">", "i_gid", ";", "}", "}", "bprm_fill_uid", "(", "bprm", ")", ";", "/", "*", "fill", "in", "binprm", "security", "blob", "*", "/", "retval", "=", "security_bprm_set_creds", "(", "bprm", ")", ";"], "docstring_tokens": ["gain", "elevated", "privileges", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "85", ",", "6", "+", "85", ",", "7", "@", "@", "static", "int", "vivid_fb_ioctl", "(", "struct", "fb_info", "*", "info", ",", "unsigned", "cmd", ",", "unsigned", "long", "arg", ")", "case", "FBIOGET_VBLANK", ":", "{", "struct", "fb_vblank", "vblank", ";", "memset", "(", "&", "vblank", ",", "0", ",", "sizeof", "(", "vblank", ")", ");", "vblank", ".", "flags", "=", "FB_VBLANK_HAVE_COUNT", "|", "FB_VBLANK_HAVE_VCOUNT", "|", "FB_VBLANK_HAVE_VSYNC", ";", "vblank", ".", "count", "=", "0", ";"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "25", ",", "9", "+", "25", ",", "7", "@", "@", "import", "javax", ".", "net", ".", "ssl", ".", "HostnameVerifier", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLContext", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLEngine", ";", "import", "java", ".", "security", ".", "GeneralSecurityException", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "LinkedList", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "68", ",", "7", "+", "66", ",", "6", "@", "@", "protected", "ExecutorService", "applicationThreadPool", ";", "protected", "ProxyServerSelector", "proxyServerSelector", ";", "protected", "SSLContext", "sslContext", ";", "protected", "SSLEngineFactory", "sslEngineFactory", ";", "protected", "AsyncHttpProviderConfig", "<", "?,", "?", ">", "providerConfig", ";", "protected", "ConnectionsPool", "<", "?,", "?", ">", "connectionsPool", ";", "protected", "Realm", "realm", ";", "@", "@", "-", "86", ",", "6", "+", "83", ",", "7", "@", "@", "protected", "boolean", "useRelativeURIsWithSSLProxies", ";", "protected", "int", "maxConnectionLifeTimeInMs", ";", "protected", "TimeConverter", "timeConverter", ";", "protected", "boolean", "acceptAnyCertificate", ";", "protected", "AsyncHttpClientConfig", "(", ")", "{", "}", "@", "@", "-", "106", ",", "7", "+", "104", ",", "6", "@", "@", "private", "AsyncHttpClientConfig", "(", "int", "maxTotalConnections", ",", "ExecutorService", "applicationThreadPool", ",", "ProxyServerSelector", "proxyServerSelector", ",", "SSLContext", "sslContext", ",", "SSLEngineFactory", "sslEngineFactory", ",", "AsyncHttpProviderConfig", "<", "?,", "?", ">", "providerConfig", ",", "ConnectionsPool", "<", "?,", "?", ">", "connectionsPool", ",", "Realm", "realm", ",", "List", "<", "RequestFilter", ">", "requestFilters", ",", "@", "@", "-", "121", ",", "7", "+", "118", ",", "8", "@", "@", "private", "AsyncHttpClientConfig", "(", "int", "maxTotalConnections", ",", "int", "ioThreadMultiplier", ",", "boolean", "strict302Handling", ",", "boolean", "useRelativeURIsWithSSLProxies", ",", "TimeConverter", "timeConverter", ")", "{", "TimeConverter", "timeConverter", ",", "/", "/", "boolean", "acceptAnyCertificate", ")", "{", "this", ".", "maxTotalConnections", "=", "maxTotalConnections", ";", "this", ".", "maxConnectionPerHost", "=", "maxConnectionPerHost", ";", "@", "@", "-", "137", ",", "7", "+", "135", ",", "6", "@", "@", "private", "AsyncHttpClientConfig", "(", "int", "maxTotalConnections", ",", "this", ".", "userAgent", "=", "userAgent", ";", "this", ".", "allowPoolingConnection", "=", "keepAlive", ";", "this", ".", "sslContext", "=", "sslContext", ";", "this", ".", "sslEngineFactory", "=", "sslEngineFactory", ";", "this", ".", "providerConfig", "=", "providerConfig", ";", "this", ".", "connectionsPool", "=", "connectionsPool", ";", "this", ".", "realm", "=", "realm", ";", "@", "@", "-", "161", ",", "6", "+", "158", ",", "7", "@", "@", "private", "AsyncHttpClientConfig", "(", "int", "maxTotalConnections", ",", "this", ".", "proxyServerSelector", "=", "proxyServerSelector", ";", "this", ".", "disableUrlEncodingForBoundedRequests", "=", "disableUrlEncodingForBoundedRequests", ";", "this", ".", "timeConverter", "=", "timeConverter", ";", "this", ".", "acceptAnyCertificate", "=", "acceptAnyCertificate", ";", "}", "/", "**", "@", "@", "-", "310", ",", "28", "+", "308", ",", "6", "@", "@", "public", "SSLContext", "getSSLContext", "(", ")", "{", "return", "connectionsPool", ";", "}", "/", "**", "*", "Return", "an", "instance", "of", "{", "@", "link", "SSLEngineFactory", "}", "used", "for", "SSL", "connection", ".", "*", "*", "@", "return", "an", "instance", "of", "{", "@", "link", "SSLEngineFactory", "}", "used", "for", "SSL", "connection", ".", "*", "/", "public", "SSLEngineFactory", "getSSLEngineFactory", "(", ")", "{", "if", "(", "sslEngineFactory", "=", "=", "null", ")", "{", "return", "new", "SSLEngineFactory", "(", ")", "{", "public", "SSLEngine", "newSSLEngine", "(", ")", "{", "if", "(", "sslContext", "!", "=", "null", ")", "{", "SSLEngine", "sslEngine", "=", "sslContext", ".", "createSSLEngine", "(", ");", "sslEngine", ".", "setUseClientMode", "(", "true", ")", ";", "return", "sslEngine", ";", "}", "else", "{", "return", "null", ";", "}", "}", "}", ";", "}", "return", "sslEngineFactory", ";", "}", "/", "**", "*", "Return", "the", "{", "@", "link", "com", ".", "ning", ".", "http", ".", "client", ".", "AsyncHttpProviderConfig", "}", "*", "@", "@", "-", "491", ",", "12", "+", "467", ",", "19", "@", "@", "public", "int", "getMaxConnectionLifeTimeInMs", "(", ")", "{", "}", "/", "**", "*", "@", "return", "1", ".", "8", ".", "2", "*", "since", "1", ".", "8", ".", "2", "*", "/", "public", "TimeConverter", "getTimeConverter", "(", ")", "{", "return", "timeConverter", ";", "}", "/", "**", "*", "since", "1", ".", "9", ".", "0", "*", "/", "public", "boolean", "isAcceptAnyCertificate", "(", ")", "{", "return", "acceptAnyCertificate", ";", "}", "/", "**", "*", "Builder", "for", "an", "{", "@", "link", "AsyncHttpClient", "}", "*", "/", "@", "@", "-", "525", ",", "11", "+", "508", ",", "11", "@", "@", "public", "TimeConverter", "getTimeConverter", "(", ")", "{", "private", "boolean", "removeQueryParamOnRedirect", "=", "defaultRemoveQueryParamOnRedirect", "(", ");", "private", "boolean", "strict302Handling", "=", "defaultStrict302Handling", "(", ");", "private", "HostnameVerifier", "hostnameVerifier", "=", "defaultHostnameVerifier", "(", ");", "private", "boolean", "acceptAnyCertificate", "=", "defaultAcceptAnyCertificate", "(", ");", "private", "ExecutorService", "applicationThreadPool", ";", "private", "ProxyServerSelector", "proxyServerSelector", "=", "null", ";", "private", "SSLContext", "sslContext", ";", "private", "SSLEngineFactory", "sslEngineFactory", ";", "private", "AsyncHttpProviderConfig", "<", "?,", "?", ">", "providerConfig", ";", "private", "ConnectionsPool", "<", "?,", "?", ">", "connectionsPool", ";", "private", "Realm", "realm", ";", "@", "@", "-", "713", ",", "31", "+", "696", ",", "13", "@", "@", "public", "Builder", "setProxyServer", "(", "ProxyServer", "proxyServer", ")", "{", "return", "this", ";", "}", "/", "**", "*", "Set", "the", "{", "@", "link", "SSLEngineFactory", "}", "for", "secure", "connection", ".", "*", "*", "@", "param", "sslEngineFactory", "the", "{", "@", "link", "SSLEngineFactory", "}", "for", "secure", "connection", "*", "@", "return", "a", "{", "@", "link", "Builder", "}", "*", "/", "public", "Builder", "setSSLEngineFactory", "(", "SSLEngineFactory", "sslEngineFactory", ")", "{", "this", ".", "sslEngineFactory", "=", "sslEngineFactory", ";", "return", "this", ";", "}", "/", "**", "*", "Set", "the", "{", "@", "link", "SSLContext", "}", "for", "secure", "connection", ".", "*", "*", "@", "param", "sslContext", "the", "{", "@", "link", "SSLContext", "}", "for", "secure", "connection", "*", "@", "return", "a", "{", "@", "link", "Builder", "}", "*", "/", "public", "Builder", "setSSLContext", "(", "final", "SSLContext", "sslContext", ")", "{", "this", ".", "sslEngineFactory", "=", "new", "SSLEngineFactory", "(", ")", "{", "public", "SSLEngine", "newSSLEngine", "(", ")", "throws", "GeneralSecurityException", "{", "SSLEngine", "sslEngine", "=", "sslContext", ".", "createSSLEngine", "(", ");", "sslEngine", ".", "setUseClientMode", "(", "true", ")", ";", "return", "sslEngine", ";", "}", "}", ";", "this", ".", "sslContext", "=", "sslContext", ";", "return", "this", ";", "}", "@", "@", "-", "998", ",", "6", "+", "963", ",", "11", "@", "@", "public", "Builder", "setTimeConverter", "(", "TimeConverter", "timeConverter", ")", "{", "return", "this", ";", "}", "public", "Builder", "setAcceptAnyCertificate", "(", "boolean", "acceptAnyCertificate", ")", "{", "this", ".", "acceptAnyCertificate", "=", "acceptAnyCertificate", ";", "return", "this", ";", "}", "/", "**", "*", "Create", "a", "config", "builder", "with", "values", "taken", "from", "the", "given", "prototype", "configuration", ".", "*", "@", "@", "-", "1018", ",", "7", "+", "988", ",", "6", "@", "@", "public", "Builder", "(", "AsyncHttpClientConfig", "prototype", ")", "{", "realm", "=", "prototype", ".", "getRealm", "(", ");", "requestTimeoutInMs", "=", "prototype", ".", "getRequestTimeoutInMs", "(", ");", "sslContext", "=", "prototype", ".", "getSSLContext", "(", ");", "sslEngineFactory", "=", "prototype", ".", "getSSLEngineFactory", "(", ");", "userAgent", "=", "prototype", ".", "getUserAgent", "(", ");", "followRedirect", "=", "prototype", ".", "isFollowRedirect", "(", ");", "compressionEnabled", "=", "prototype", ".", "isCompressionEnabled", "(", ");", "@", "@", "-", "1041", ",", "6", "+", "1010", ",", "7", "@", "@", "public", "Builder", "(", "AsyncHttpClientConfig", "prototype", ")", "{", "hostnameVerifier", "=", "prototype", ".", "getHostnameVerifier", "(", ");", "strict302Handling", "=", "prototype", ".", "isStrict302Handling", "(", ");", "timeConverter", "=", "prototype", ".", "timeConverter", ";", "acceptAnyCertificate", "=", "prototype", ".", "acceptAnyCertificate", ";", "}", "/", "**", "@", "@", "-", "1073", ",", "40", "+", "1043", ",", "39", "@", "@", "public", "Thread", "newThread", "(", "Runnable", "r", ")", "{", "proxyServerSelector", "=", "ProxyServerSelector", ".", "NO_PROXY_SELECTOR", ";", "}", "return", "new", "AsyncHttpClientConfig", "(", "maxTotalConnections", ",", "maxConnectionPerHost", ",", "connectionTimeOutInMs", ",", "webSocketIdleTimeoutInMs", ",", "idleConnectionInPoolTimeoutInMs", ",", "idleConnectionTimeoutInMs", ",", "requestTimeoutInMs", ",", "maxConnectionLifeTimeInMs", ",", "followRedirect", ",", "maxDefaultRedirects", ",", "compressionEnabled", ",", "userAgent", ",", "allowPoolingConnection", ",", "applicationThreadPool", ",", "proxyServerSelector", ",", "sslContext", ",", "sslEngineFactory", ",", "providerConfig", ",", "connectionsPool", ",", "realm", ",", "requestFilters", ",", "responseFilters", ",", "ioExceptionFilters", ",", "requestCompressionLevel", ",", "maxRequestRetry", ",", "allowSslConnectionPool", ",", "disableUrlEncodingForBoundedRequests", ",", "removeQueryParamOnRedirect", ",", "hostnameVerifier", ",", "ioThreadMultiplier", ",", "strict302Handling", ",", "useRelativeURIsWithSSLProxies", ",", "timeConverter", ")", ";", "return", "new", "AsyncHttpClientConfig", "(", "maxTotalConnections", ",", "/", "/", "maxConnectionPerHost", ",", "/", "/", "connectionTimeOutInMs", ",", "/", "/", "webSocketIdleTimeoutInMs", ",", "/", "/", "idleConnectionInPoolTimeoutInMs", ",", "/", "/", "idleConnectionTimeoutInMs", ",", "/", "/", "requestTimeoutInMs", ",", "/", "/", "maxConnectionLifeTimeInMs", ",", "/", "/", "followRedirect", ",", "/", "/", "maxDefaultRedirects", ",", "/", "/", "compressionEnabled", ",", "/", "/", "userAgent", ",", "/", "/", "allowPoolingConnection", ",", "/", "/", "applicationThreadPool", ",", "/", "/", "proxyServerSelector", ",", "/", "/", "sslContext", ",", "/", "/", "providerConfig", ",", "/", "/", "connectionsPool", ",", "/", "/", "realm", ",", "/", "/", "requestFilters", ",", "/", "/", "responseFilters", ",", "/", "/", "ioExceptionFilters", ",", "/", "/", "requestCompressionLevel", ",", "/", "/", "maxRequestRetry", ",", "/", "/", "allowSslConnectionPool", ",", "/", "/", "disableUrlEncodingForBoundedRequests", ",", "/", "/", "removeQueryParamOnRedirect", ",", "/", "/", "hostnameVerifier", ",", "/", "/", "ioThreadMultiplier", ",", "/", "/", "strict302Handling", ",", "/", "/", "useRelativeURIsWithSSLProxies", ",", "/", "/", "timeConverter", ",", "/", "/", "acceptAnyCertificate", ")", ";", "}", "}", "}", "@", "@", "-", "67", ",", "6", "+", "67", ",", "7", "@", "@", "void", "configureDefaults", "(", ")", "{", "removeQueryParamOnRedirect", "=", "defaultRemoveQueryParamOnRedirect", "(", ");", "strict302Handling", "=", "defaultStrict302Handling", "(", ");", "hostnameVerifier", "=", "defaultHostnameVerifier", "(", ");", "acceptAnyCertificate", "=", "defaultAcceptAnyCertificate", "(", ");", "if", "(", "defaultUseProxySelector", "(", "))", "{", "proxyServerSelector", "=", "ProxyUtils", ".", "getJdkDefaultProxyServerSelector", "(", ");", "@", "@", "-", "173", ",", "11", "+", "174", ",", "6", "@", "@", "public", "AsyncHttpClientConfigBean", "setSslContext", "(", "SSLContext", "sslContext", ")", "{", "return", "this", ";", "}", "public", "AsyncHttpClientConfigBean", "setSslEngineFactory", "(", "SSLEngineFactory", "sslEngineFactory", ")", "{", "this", ".", "sslEngineFactory", "=", "sslEngineFactory", ";", "return", "this", ";", "}", "public", "AsyncHttpClientConfigBean", "setProviderConfig", "(", "AsyncHttpProviderConfig", "<", "?,", "?", ">", "providerConfig", ")", "{", "this", ".", "providerConfig", "=", "providerConfig", ";", "return", "this", ";", "@", "@", "-", "242", ",", "4", "+", "238", ",", "9", "@", "@", "public", "AsyncHttpClientConfigBean", "setIoThreadMultiplier", "(", "int", "ioThreadMultiplier", ")", "{", "this", ".", "ioThreadMultiplier", "=", "ioThreadMultiplier", ";", "return", "this", ";", "}", "public", "AsyncHttpClientConfigBean", "setAcceptAnyCertificate", "(", "boolean", "acceptAnyCertificate", ")", "{", "this", ".", "acceptAnyCertificate", "=", "acceptAnyCertificate", ";", "return", "this", ";", "}", "}", "@", "@", "-", "121", ",", "4", "+", "121", ",", "8", "@", "@", "public", "static", "boolean", "defaultRemoveQueryParamOnRedirect", "(", ")", "{", "public", "static", "HostnameVerifier", "defaultHostnameVerifier", "(", ")", "{", "return", "new", "DefaultHostnameVerifier", "(", ");", "}", "public", "static", "boolean", "defaultAcceptAnyCertificate", "(", ")", "{", "return", "getBoolean", "(", "ASYNC_CLIENT", "+", "\"", "acceptAnyCertificate", "\"", ",", "false", ")", ";", "}", "}", "@", "@", "-", "1", ",", "32", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Copyright", "2010", "Ning", ",", "Inc", ".", "*", "*", "Ning", "licenses", "this", "file", "to", "you", "under", "the", "Apache", "License", ",", "version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "the", "*", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", ":", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "*", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "*", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "com", ".", "ning", ".", "http", ".", "client", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLEngine", ";", "import", "java", ".", "security", ".", "GeneralSecurityException", ";", "/", "**", "*", "Factory", "that", "creates", "an", "{", "@", "link", "SSLEngine", "}", "to", "be", "used", "for", "a", "single", "SSL", "connection", ".", "*", "/", "public", "interface", "SSLEngineFactory", "{", "/", "**", "*", "Creates", "new", "{", "@", "link", "SSLEngine", "}", ".", "*", "*", "@", "return", "new", "engine", "*", "@", "throws", "GeneralSecurityException", "if", "the", "SSLEngine", "cannot", "be", "created", "*", "/", "SSLEngine", "newSSLEngine", "(", ")", "throws", "GeneralSecurityException", ";", "}", "@", "@", "-", "539", ",", "11", "+", "539", ",", "6", "@", "@", "public", "Builder", "setExecutorService", "(", "ExecutorService", "applicationThreadPool", ")", "{", "return", "this", ";", "}", "public", "Builder", "setSSLEngineFactory", "(", "SSLEngineFactory", "sslEngineFactory", ")", "{", "configBuilder", ".", "setSSLEngineFactory", "(", "sslEngineFactory", ")", ";", "return", "this", ";", "}", "public", "Builder", "setSSLContext", "(", "final", "SSLContext", "sslContext", ")", "{", "configBuilder", ".", "setSSLContext", "(", "sslContext", ")", ";", "return", "this", ";", "@", "@", "-", "669", ",", "6", "+", "664", ",", "11", "@", "@", "public", "Builder", "setProviderClass", "(", "String", "providerClass", ")", "{", "return", "this", ";", "}", "public", "Builder", "setAcceptAnyCertificate", "(", "boolean", "acceptAnyCertificate", ")", "{", "configBuilder", ".", "setAcceptAnyCertificate", "(", "acceptAnyCertificate", ")", ";", "return", "this", ";", "}", "public", "SimpleAsyncHttpClient", "build", "(", ")", "{", "if", "(", "realmBuilder", "!", "=", "null", ")", "{", "@", "@", "-", "383", ",", "7", "+", "383", ",", "7", "@", "@", "public", "void", "onTimeout", "(", "Connection", "connection", ")", "{", "boolean", "defaultSecState", "=", "(", "context", "!", "=", "null", ")", ";", "if", "(", "context", "=", "=", "null", ")", "{", "try", "{", "context", "=", "SslUtils", ".", "getSSLContext", "(", ");", "context", "=", "SslUtils", ".", "getInstance", "(", ").", "getSSLContext", "(", "clientConfig", ".", "isAcceptAnyCertificate", "(", "))", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "@", "@", "-", "186", ",", "7", "+", "186", ",", "7", "@", "@", "private", "HttpURLConnection", "createUrlConnection", "(", "Request", "request", ")", "throws", "IOExceptio", "SSLContext", "sslContext", "=", "config", ".", "getSSLContext", "(", ");", "if", "(", "sslContext", "=", "=", "null", ")", "{", "try", "{", "sslContext", "=", "SslUtils", ".", "getSSLContext", "(", ");", "sslContext", "=", "SslUtils", ".", "getInstance", "(", ").", "getSSLContext", "(", "config", ".", "isAcceptAnyCertificate", "(", "))", ";", "}", "catch", "(", "NoSuchAlgorithmException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ".", "getMessage", "(", "))", ";", "}", "catch", "(", "GeneralSecurityException", "e", ")", "{", "@", "@", "-", "373", ",", "7", "+", "373", ",", "7", "@", "@", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "ChannelPipeline", "pipeline", "=", "pipeline", "(", ");", "try", "{", "SSLEngine", "sslEngine", "=", "createSSLEngine", "(", ");", "SSLEngine", "sslEngine", "=", "SslUtils", ".", "getInstance", "(", ").", "createClientSSLEngine", "(", "config", ")", ";", "SslHandler", "sslHandler", "=", "handshakeTimeoutInMillis", ">", "0", "?", "new", "SslHandler", "(", "sslEngine", ",", "getDefaultBufferPool", "(", "),", "false", ",", "ImmediateExecutor", ".", "INSTANCE", ",", "nettyTimer", ",", "handshakeTimeoutInMillis", ")", ":", "new", "SslHandler", "(", "sslEngine", ")", ";", "pipeline", ".", "addLast", "(", "SSL_HANDLER", ",", "sslHandler", ")", ";", "@", "@", "-", "399", ",", "7", "+", "399", ",", "7", "@", "@", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "ChannelPipeline", "pipeline", "=", "pipeline", "(", ");", "try", "{", "pipeline", ".", "addLast", "(", "SSL_HANDLER", ",", "new", "SslHandler", "(", "createSSLEngine", "(", "))", ");", "pipeline", ".", "addLast", "(", "SSL_HANDLER", ",", "new", "SslHandler", "(", "SslUtils", ".", "getInstance", "(", ").", "createClientSSLEngine", "(", "config", ")", "))", ";", "}", "catch", "(", "Throwable", "ex", ")", "{", "abort", "(", "cl", ".", "future", "(", "),", "ex", ")", ";", "}", "@", "@", "-", "437", ",", "14", "+", "437", ",", "6", "@", "@", "private", "Channel", "lookupInCache", "(", "UriComponents", "uri", ",", "ProxyServer", "proxy", ",", "ConnectionPo", "return", "null", ";", "}", "private", "SSLEngine", "createSSLEngine", "(", ")", "throws", "IOException", ",", "GeneralSecurityException", "{", "SSLEngine", "sslEngine", "=", "config", ".", "getSSLEngineFactory", "(", ").", "newSSLEngine", "(", ");", "if", "(", "sslEngine", "=", "=", "null", ")", "{", "sslEngine", "=", "SslUtils", ".", "getSSLEngine", "(", ");", "}", "return", "sslEngine", ";", "}", "private", "HttpClientCodec", "createHttpClientCodec", "(", ")", "{", "return", "new", "HttpClientCodec", "(", "httpClientCodecMaxInitialLineLength", ",", "httpClientCodecMaxHeaderSize", ",", "httpClientCodecMaxChunkSize", ")", ";", "}", "@", "@", "-", "460", ",", "7", "+", "452", ",", "7", "@", "@", "private", "Channel", "verifyChannelPipeline", "(", "Channel", "channel", ",", "String", "scheme", ")", "throws", "IOE", "}", "else", "if", "(", "channel", ".", "getPipeline", "(", ").", "get", "(", "HTTP_HANDLER", ")", "!", "=", "null", "&", "&", "HTTP", ".", "equalsIgnoreCase", "(", "scheme", ")", ")", "{", "return", "channel", ";", "}", "else", "if", "(", "channel", ".", "getPipeline", "(", ").", "get", "(", "SSL_HANDLER", ")", "=", "=", "null", "&", "&", "isSecure", "(", "scheme", ")", ")", "{", "channel", ".", "getPipeline", "(", ").", "addFirst", "(", "SSL_HANDLER", ",", "new", "SslHandler", "(", "createSSLEngine", "(", "))", ");", "channel", ".", "getPipeline", "(", ").", "addFirst", "(", "SSL_HANDLER", ",", "new", "SslHandler", "(", "SslUtils", ".", "getInstance", "(", ").", "createClientSSLEngine", "(", "config", ")", "))", ";", "}", "return", "channel", ";", "}", "@", "@", "-", "1383", ",", "7", "+", "1375", ",", "7", "@", "@", "private", "void", "upgradeProtocol", "(", "ChannelPipeline", "p", ",", "String", "scheme", ")", "throws", "IOExceptio", "if", "(", "isSecure", "(", "scheme", ")", ")", "{", "if", "(", "p", ".", "get", "(", "SSL_HANDLER", ")", "=", "=", "null", ")", "{", "p", ".", "addFirst", "(", "HTTP_HANDLER", ",", "createHttpClientCodec", "(", "))", ";", "p", ".", "addFirst", "(", "SSL_HANDLER", ",", "new", "SslHandler", "(", "createSSLEngine", "(", "))", ");", "p", ".", "addFirst", "(", "SSL_HANDLER", ",", "new", "SslHandler", "(", "SslUtils", ".", "getInstance", "(", ").", "createClientSSLEngine", "(", "config", ")", "))", ";", "}", "else", "{", "p", ".", "addAfter", "(", "SSL_HANDLER", ",", "HTTP_HANDLER", ",", "createHttpClientCodec", "(", "))", ";", "}", "@", "@", "-", "44", ",", "4", "+", "44", ",", "8", "@", "@", "public", "static", "boolean", "getBoolean", "(", "String", "systemPropName", ",", "boolean", "defaultValue", ")", "{", "String", "systemPropValue", "=", "System", ".", "getProperty", "(", "systemPropName", ")", ";", "return", "systemPropValue", "!", "=", "null", "?", "systemPropValue", ".", "equalsIgnoreCase", "(", "\"", "true", "\"", ")", ":", "defaultValue", ";", "}", "public", "static", "<", "T", ">", "T", "withDefault", "(", "T", "value", ",", "T", "defaults", ")", "{", "return", "value", "!", "=", "null", "?", "value", ":", "value", ";", "}", "}", "@", "@", "-", "15", ",", "101", "+", "15", ",", "43", "@", "@", "*", "/", "package", "com", ".", "ning", ".", "http", ".", "util", ";", "import", "javax", ".", "net", ".", "ssl", ".", "KeyManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "KeyManagerFactory", ";", "import", "com", ".", "ning", ".", "http", ".", "client", ".", "AsyncHttpClientConfig", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLContext", ";", "import", "javax", ".", "net", ".", "ssl", ".", "SSLEngine", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManager", ";", "import", "javax", ".", "net", ".", "ssl", ".", "TrustManagerFactory", ";", "import", "javax", ".", "net", ".", "ssl", ".", "X509TrustManager", ";", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "security", ".", "GeneralSecurityException", ";", "import", "java", ".", "security", ".", "KeyStore", ";", "import", "java", ".", "security", ".", "SecureRandom", ";", "import", "java", ".", "security", ".", "Security", ";", "/", "**", "*", "This", "class", "is", "a", "copy", "of", "http", ":", "//", "github", ".", "com", "/", "sonatype", "/", "wagon", "-", "ning", "/", "raw", "/", "master", "/", "src", "/", "main", "/", "java", "/", "org", "/", "apache", "/", "maven", "/", "wagon", "/", "providers", "/", "http", "/", "SslUtils", ".", "java", "*", "/", "public", "class", "SslUtils", "{", "private", "static", "SSLContext", "context", "=", "null", ";", "public", "static", "SSLEngine", "getSSLEngine", "(", ")", "throws", "GeneralSecurityException", ",", "IOException", "{", "SSLEngine", "engine", "=", "null", ";", "SSLContext", "context", "=", "getSSLContext", "(", ");", "if", "(", "context", "!", "=", "null", ")", "{", "engine", "=", "context", ".", "createSSLEngine", "(", ");", "engine", ".", "setUseClientMode", "(", "true", ")", ";", "}", "return", "engine", ";", "private", "static", "class", "SingletonHolder", "{", "public", "static", "final", "SslUtils", "instance", "=", "new", "SslUtils", "(", ");", "}", "public", "static", "SSLContext", "getSSLContext", "(", ")", "throws", "GeneralSecurityException", ",", "IOException", "{", "if", "(", "context", "=", "=", "null", ")", "{", "SSLConfig", "config", "=", "new", "SSLConfig", "(", ");", "if", "(", "config", ".", "keyStoreLocation", "=", "=", "null", "|", "|", "config", ".", "trustStoreLocation", "=", "=", "null", ")", "{", "context", "=", "getLooseSSLContext", "(", ");", "}", "else", "{", "context", "=", "getStrictSSLContext", "(", "config", ")", ";", "}", "}", "return", "context", ";", "public", "static", "SslUtils", "getInstance", "(", ")", "{", "return", "SingletonHolder", ".", "instance", ";", "}", "static", "SSLContext", "getStrictSSLContext", "(", "SSLConfig", "config", ")", "throws", "GeneralSecurityException", ",", "IOException", "{", "KeyStore", "keyStore", "=", "KeyStore", ".", "getInstance", "(", "config", ".", "keyStoreType", ")", ";", "InputStream", "keystoreInputStream", "=", "new", "FileInputStream", "(", "config", ".", "keyStoreLocation", ")", ";", "try", "{", "keyStore", ".", "load", "(", "keystoreInputStream", ",", "(", "config", ".", "keyStorePassword", "=", "=", "null", ")", "?", "null", ":", "config", ".", "keyStorePassword", ".", "toCharArray", "(", "))", ";", "}", "finally", "{", "keystoreInputStream", ".", "close", "(", ");", "public", "SSLEngine", "createClientSSLEngine", "(", "AsyncHttpClientConfig", "config", ")", "throws", "GeneralSecurityException", ",", "IOException", "{", "SSLContext", "sslContext", "=", "config", ".", "getSSLContext", "(", ");", "if", "(", "sslContext", "=", "=", "null", ")", "{", "sslContext", "=", "SslUtils", ".", "getInstance", "(", ").", "getSSLContext", "(", "config", ".", "isAcceptAnyCertificate", "(", "))", ";", "}", "KeyManagerFactory", "keyManagerFactory", "=", "KeyManagerFactory", ".", "getInstance", "(", "config", ".", "keyManagerAlgorithm", ")", ";", "keyManagerFactory", ".", "init", "(", "keyStore", ",", "(", "config", ".", "keyManagerPassword", "=", "=", "null", ")", "?", "null", ":", "config", ".", "keyManagerPassword", ".", "toCharArray", "(", "))", ";", "KeyManager", "[", "]", "keyManagers", "=", "keyManagerFactory", ".", "getKeyManagers", "(", ");", "KeyStore", "trustStore", "=", "KeyStore", ".", "getInstance", "(", "config", ".", "trustStoreType", ")", ";", "InputStream", "truststoreInputStream", "=", "new", "FileInputStream", "(", "config", ".", "trustStoreLocation", ")", ";", "try", "{", "trustStore", ".", "load", "(", "truststoreInputStream", ",", "(", "config", ".", "trustStorePassword", "=", "=", "null", ")", "?", "null", ":", "config", ".", "trustStorePassword", ".", "toCharArray", "(", "))", ";", "}", "finally", "{", "truststoreInputStream", ".", "close", "(", ");", "}", "TrustManagerFactory", "trustManagerFactory", "=", "TrustManagerFactory", ".", "getInstance", "(", "config", ".", "trustManagerAlgorithm", ")", ";", "trustManagerFactory", ".", "init", "(", "trustStore", ")", ";", "TrustManager", "[", "]", "trustManagers", "=", "trustManagerFactory", ".", "getTrustManagers", "(", ");", "SSLContext", "context", "=", "SSLContext", ".", "getInstance", "(", "\"", "TLS", "\"", ");", "context", ".", "init", "(", "keyManagers", ",", "trustManagers", ",", "null", ")", ";", "return", "context", ";", "SSLEngine", "sslEngine", "=", "sslContext", ".", "createSSLEngine", "(", ");", "sslEngine", ".", "setUseClientMode", "(", "true", ")", ";", "return", "sslEngine", ";", "}", "static", "SSLContext", "getLooseSSLContext", "(", ")", "throws", "GeneralSecurityException", "{", "SSLContext", "sslContext", "=", "SSLContext", ".", "getInstance", "(", "\"", "TLS", "\"", ");", "sslContext", ".", "init", "(", "null", ",", "new", "TrustManager", "[", "]{", "LooseTrustManager", ".", "INSTANCE", "}", ",", "new", "SecureRandom", "(", "))", ";", "return", "sslContext", ";", "public", "SSLContext", "getSSLContext", "(", "boolean", "acceptAnyCertificate", ")", "throws", "GeneralSecurityException", ",", "IOException", "{", "/", "/", "SSLContext", ".", "getDefault", "(", ")", "doesn", "'", "t", "exist", "in", "JDK5", "return", "acceptAnyCertificate", "?", "looseTrustManagerSSLContext", ":", "SSLContext", ".", "getInstance", "(", "\"", "Default", "\"", ");", "}", "static", "class", "LooseTrustManager", "implements", "X509TrustManager", "{", "public", "static", "final", "LooseTrustManager", "INSTANCE", "=", "new", "LooseTrustManager", "(", ");", "static", "class", "LooseTrustManager", "implements", "X509TrustManager", "{", "public", "java", ".", "security", ".", "cert", ".", "X509Certificate", "[", "]", "getAcceptedIssuers", "(", ")", "{", "return", "new", "java", ".", "security", ".", "cert", ".", "X509Certificate", "[", "0", "]", ";", "@", "@", "-", "122", ",", "53", "+", "64", ",", "15", "@", "@", "public", "void", "checkServerTrusted", "(", "java", ".", "security", ".", "cert", ".", "X509Certificate", "[", "]", "certs", ",", "Strin", "}", "}", "private", "final", "static", "class", "SSLConfig", "{", "public", "String", "keyStoreLocation", ";", "public", "String", "keyStoreType", "=", "\"", "JKS", "\"", ";", "public", "String", "keyStorePassword", "=", "\"", "changeit", "\"", ";", "public", "String", "keyManagerAlgorithm", "=", "\"", "SunX509", "\"", ";", "public", "String", "keyManagerPassword", "=", "\"", "changeit", "\"", ";", "public", "String", "trustStoreLocation", ";", "public", "String", "trustStoreType", "=", "\"", "JKS", "\"", ";", "private", "SSLContext", "looseTrustManagerSSLContext", "=", "looseTrustManagerSSLContext", "(", ");", "public", "String", "trustStorePassword", "=", "\"", "changeit", "\"", ";", "public", "String", "trustManagerAlgorithm", "=", "\"", "SunX509", "\"", ";", "public", "SSLConfig", "(", ")", "{", "keyStoreLocation", "=", "System", ".", "getProperty", "(", "\"", "javax", ".", "net", ".", "ssl", ".", "keyStore", "\"", ");", "keyStorePassword", "=", "System", ".", "getProperty", "(", "\"", "javax", ".", "net", ".", "ssl", ".", "keyStorePassword", "\"", ",", "\"", "changeit", "\"", ");", "keyStoreType", "=", "System", ".", "getProperty", "(", "\"", "javax", ".", "net", ".", "ssl", ".", "keyStoreType", "\"", ",", "KeyStore", ".", "getDefaultType", "(", "))", ";", "keyManagerAlgorithm", "=", "Security", ".", "getProperty", "(", "\"", "ssl", ".", "KeyManagerFactory", ".", "algorithm", "\"", ");", "if", "(", "keyManagerAlgorithm", "=", "=", "null", ")", "{", "keyManagerAlgorithm", "=", "\"", "SunX509", "\"", ";", "}", "keyManagerPassword", "=", "System", ".", "getProperty", "(", "\"", "javax", ".", "net", ".", "ssl", ".", "keyStorePassword", "\"", ",", "\"", "changeit", "\"", ");", "trustStoreLocation", "=", "System", ".", "getProperty", "(", "\"", "javax", ".", "net", ".", "ssl", ".", "trustStore", "\"", ");", "if", "(", "trustStoreLocation", "=", "=", "null", ")", "{", "trustStoreLocation", "=", "keyStoreLocation", ";", "trustStorePassword", "=", "keyStorePassword", ";", "trustStoreType", "=", "keyStoreType", ";", "}", "else", "{", "trustStorePassword", "=", "System", ".", "getProperty", "(", "\"", "javax", ".", "net", ".", "ssl", ".", "trustStorePassword", "\"", ",", "\"", "changeit", "\"", ");", "trustStoreType", "=", "System", ".", "getProperty", "(", "\"", "javax", ".", "net", ".", "ssl", ".", "trustStoreType", "\"", ",", "KeyStore", ".", "getDefaultType", "(", "))", ";", "}", "trustManagerAlgorithm", "=", "Security", ".", "getProperty", "(", "\"", "ssl", ".", "TrustManagerFactory", ".", "algorithm", "\"", ");", "if", "(", "trustManagerAlgorithm", "=", "=", "null", ")", "{", "trustManagerAlgorithm", "=", "\"", "SunX509", "\"", ";", "}", "private", "SSLContext", "looseTrustManagerSSLContext", "(", ")", "{", "try", "{", "SSLContext", "sslContext", "=", "SSLContext", ".", "getInstance", "(", "\"", "TLS", "\"", ");", "sslContext", ".", "init", "(", "null", ",", "new", "TrustManager", "[", "]", "{", "new", "LooseTrustManager", "(", ")", "}", ",", "new", "SecureRandom", "(", "))", ";", "return", "sslContext", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "ExceptionInInitializerError", "(", "e", ")", ";", "}", "}", "}", "@", "@", "-", "120", ",", "7", "+", "120", ",", "11", "@", "@", "public", "void", "setUpGlobal", "(", ")", "throws", "Exception", "{", "public", "void", "httpToHttpsRedirect", "(", ")", "throws", "Throwable", "{", "isSet", ".", "getAndSet", "(", "false", ")", ";", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setMaximumNumberOfRedirects", "(", "5", ")", ".", "setFollowRedirect", "(", "true", ")", ".", "build", "(", ");", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setMaximumNumberOfRedirects", "(", "5", ")", "//", ".", "setFollowRedirect", "(", "true", ")", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "c", "=", "getAsyncHttpClient", "(", "cg", ")", ";", "Response", "response", "=", "c", ".", "prepareGet", "(", "getTargetUrl", "(", "))", ".", "setHeader", "(", "\"", "X", "-", "redirect", "\"", ",", "getTargetUrl2", "(", "))", ".", "execute", "(", ").", "get", "(", ");", "@", "@", "-", "138", ",", "7", "+", "142", ",", "11", "@", "@", "public", "String", "getTargetUrl2", "(", ")", "{", "public", "void", "httpToHttpsProperConfig", "(", ")", "throws", "Throwable", "{", "isSet", ".", "getAndSet", "(", "false", ")", ";", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setMaximumNumberOfRedirects", "(", "5", ")", ".", "setFollowRedirect", "(", "true", ")", ".", "build", "(", ");", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setMaximumNumberOfRedirects", "(", "5", ")", "//", ".", "setFollowRedirect", "(", "true", ")", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "c", "=", "getAsyncHttpClient", "(", "cg", ")", ";", "try", "{", "Response", "response", "=", "c", ".", "prepareGet", "(", "getTargetUrl", "(", "))", ".", "setHeader", "(", "\"", "X", "-", "redirect", "\"", ",", "getTargetUrl2", "(", ")", "+", "\"", "/", "test2", "\"", ").", "execute", "(", ").", "get", "(", ");", "@", "@", "-", "160", ",", "7", "+", "168", ",", "11", "@", "@", "public", "void", "httpToHttpsProperConfig", "(", ")", "throws", "Throwable", "{", "public", "void", "relativeLocationUrl", "(", ")", "throws", "Throwable", "{", "isSet", ".", "getAndSet", "(", "false", ")", ";", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setMaximumNumberOfRedirects", "(", "5", ")", ".", "setFollowRedirect", "(", "true", ")", ".", "build", "(", ");", "AsyncHttpClientConfig", "cg", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setMaximumNumberOfRedirects", "(", "5", ")", "//", ".", "setFollowRedirect", "(", "true", ")", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "c", "=", "getAsyncHttpClient", "(", "cg", ")", ";", "try", "{", "Response", "response", "=", "c", ".", "prepareGet", "(", "getTargetUrl", "(", "))", ".", "setHeader", "(", "\"", "X", "-", "redirect", "\"", ",", "\"", "/", "foo", "/", "test", "\"", ").", "execute", "(", ").", "get", "(", ");", "@", "@", "-", "90", ",", "12", "+", "90", ",", "14", "@", "@", "public", "void", "setUpGlobal", "(", ")", "throws", "Exception", "{", "@", "Test", "(", "groups", "=", "{", "\"", "online", "\"", ",", "\"", "default_provider", "\"", "}", ")", "public", "void", "testRequestProxy", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "ExecutionException", ",", "TimeoutException", "{", "AsyncHttpClientConfig", ".", "Builder", "b", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ");", "b", ".", "setFollowRedirect", "(", "true", ")", ";", "ProxyServer", "ps", "=", "new", "ProxyServer", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "port1", ")", ";", "AsyncHttpClientConfig", "config", "=", "b", ".", "build", "(", ");", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setFollowRedirect", "(", "true", ")", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "asyncHttpClient", "=", "getAsyncHttpClient", "(", "config", ")", ";", "try", "{", "RequestBuilder", "rb", "=", "new", "RequestBuilder", "(", "\"", "GET", "\"", ").", "setProxyServer", "(", "ps", ")", ".", "setUrl", "(", "getTargetUrl2", "(", "))", ";", "@", "@", "-", "122", ",", "13", "+", "124", ",", "12", "@", "@", "public", "Response", "onCompleted", "(", "Response", "response", ")", "throws", "Exception", "{", "@", "Test", "(", "groups", "=", "{", "\"", "online", "\"", ",", "\"", "default_provider", "\"", "}", ")", "public", "void", "testConfigProxy", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "ExecutionException", ",", "TimeoutException", "{", "AsyncHttpClientConfig", ".", "Builder", "b", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ");", "b", ".", "setFollowRedirect", "(", "true", ")", ";", "ProxyServer", "ps", "=", "new", "ProxyServer", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "port1", ")", ";", "b", ".", "setProxyServer", "(", "ps", ")", ";", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setProxyServer", "(", "new", "ProxyServer", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "port1", ")", ")/", "/", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "setFollowRedirect", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClientConfig", "config", "=", "b", ".", "build", "(", ");", "AsyncHttpClient", "asyncHttpClient", "=", "getAsyncHttpClient", "(", "config", ")", ";", "try", "{", "RequestBuilder", "rb", "=", "new", "RequestBuilder", "(", "\"", "GET", "\"", ").", "setUrl", "(", "getTargetUrl2", "(", "))", ";", "@", "@", "-", "155", ",", "7", "+", "156", ",", "14", "@", "@", "public", "Response", "onCompleted", "(", "Response", "response", ")", "throws", "Exception", "{", "@", "Test", "(", "groups", "=", "{", "\"", "online", "\"", ",", "\"", "default_provider", "\"", "}", ")", "public", "void", "testSimpleAHCConfigProxy", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "ExecutionException", ",", "TimeoutException", "{", "SimpleAsyncHttpClient", "client", "=", "new", "SimpleAsyncHttpClient", ".", "Builder", "(", ").", "setProxyProtocol", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ")", ".", "setProxyHost", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ").", "setProxyPort", "(", "port1", ")", ".", "setFollowRedirects", "(", "true", ")", ".", "setUrl", "(", "getTargetUrl2", "(", "))", ".", "setHeader", "(", "\"", "Content", "-", "Type", "\"", ",", "\"", "text", "/", "html", "\"", ").", "build", "(", ");", "SimpleAsyncHttpClient", "client", "=", "new", "SimpleAsyncHttpClient", ".", "Builder", "(", ")/", "/", ".", "setProxyProtocol", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ")", "//", ".", "setProxyHost", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ")/", "/", ".", "setProxyPort", "(", "port1", ")", "//", ".", "setFollowRedirects", "(", "true", ")", "//", ".", "setUrl", "(", "getTargetUrl2", "(", "))", "//", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "setHeader", "(", "\"", "Content", "-", "Type", "\"", ",", "\"", "text", "/", "html", "\"", ").", "build", "(", ");", "try", "{", "Response", "r", "=", "client", ".", "get", "(", ").", "get", "(", ");", "@", "@", "-", "168", ",", "7", "+", "176", ",", "12", "@", "@", "public", "void", "testSimpleAHCConfigProxy", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "@", "Test", "(", "groups", "=", "{", "\"", "standalone", "\"", ",", "\"", "default_provider", "\"", "}", ")", "public", "void", "testNonProxyHostsSsl", "(", ")", "throws", "IOException", ",", "ExecutionException", ",", "TimeoutException", ",", "InterruptedException", "{", "AsyncHttpClient", "client", "=", "getAsyncHttpClient", "(", "null", ")", ";", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")/", "/", ".", "setAcceptAnyCertificate", "(", "true", ")", "//", ".", "build", "(", ");", "AsyncHttpClient", "client", "=", "getAsyncHttpClient", "(", "config", ")", ";", "try", "{", "Response", "resp", "=", "client", ".", "prepareGet", "(", "getTargetUrl2", "(", "))", ".", "setProxyServer", "(", "new", "ProxyServer", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "port1", "-", "1", ")", ".", "addNonProxyHost", "(", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", "))", ".", "execute", "(", ").", "get", "(", "3", ",", "TimeUnit", ".", "SECONDS", ")", ";", "@", "@", "-", "139", ",", "6", "+", "139", ",", "7", "@", "@", "private", "void", "doSimpleFeeder", "(", "final", "boolean", "secure", ")", "{", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")", ".", "setMaximumConnectionsPerHost", "(", "60", ")", ".", "setMaximumConnectionsTotal", "(", "60", ")", ".", "setAcceptAnyCertificate", "(", "true", ")", ".", "build", "(", ");", "final", "AsyncHttpClient", "client", "=", "new", "AsyncHttpClient", "(", "new", "GrizzlyAsyncHttpProvider", "(", "config", ")", ",", "config", ")", ";", "@", "@", "-", "243", ",", "6", "+", "244", ",", "7", "@", "@", "private", "void", "doNonBlockingFeeder", "(", "final", "boolean", "secure", ")", "{", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ")", ".", "setMaximumConnectionsPerHost", "(", "60", ")", ".", "setMaximumConnectionsTotal", "(", "60", ")", ".", "setAcceptAnyCertificate", "(", "true", ")", ".", "build", "(", ");", "final", "AsyncHttpClient", "client", "=", "new", "AsyncHttpClient", "(", "new", "GrizzlyAsyncHttpProvider", "(", "config", ")", ",", "config", ")", ";", "@", "@", "-", "102", ",", "7", "+", "102", ",", "7", "@", "@", "protected", "String", "getTargetUrl", "(", ")", "{", "public", "void", "echoText", "(", ")", "throws", "Exception", "{", "ProxyServer", "ps", "=", "new", "ProxyServer", "(", "ProxyServer", ".", "Protocol", ".", "HTTPS", ",", "\"", "127", ".", "0", ".", "0", ".", "1", "\"", ",", "port1", ")", ";", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setProxyServer", "(", "ps", ")", ".", "build", "(", ");", "AsyncHttpClientConfig", "config", "=", "new", "AsyncHttpClientConfig", ".", "Builder", "(", ").", "setProxyServer", "(", "ps", ")", ".", "setAcceptAnyCertificate", "(", "true", ")", ".", "build", "(", ");", "AsyncHttpClient", "asyncHttpClient", "=", "getAsyncHttpClient", "(", "config", ")", ";", "try", "{", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";"], "docstring_tokens": ["launch", "further", "attacks", "against", "a", "vulnerable", "target"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "21", "+", "1", ",", "18", "@", "@", "\ufeff", "PHP", "NEWS", "|", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "||", "?", "?", "?", "??", "2010", ",", "PHP", "5", ".", "2", ".", "15", "02", "Dec", "2010", ",", "PHP", "5", ".", "2", ".", "15RC2", "09", "Dec", "2010", ",", "PHP", "5", ".", "2", ".", "15", "-", "Fixed", "extract", "(", ")", "to", "do", "not", "overwrite", "$", "GLOBALS", "and", "$", "this", "when", "using", "EXTR_OVERWRITE", ".", "(", "jorto", "at", "redhat", "dot", "com", ")", "18", "Nov", "2010", ",", "PHP", "5", ".", "2", ".", "15RC1", "EXTR_OVERWRITE", ".", "(", "jorto", "at", "redhat", "dot", "com", ")", "-", "Fixed", "crash", "in", "zip", "extract", "method", "(", "possible", "CWE", "-", "170", ")", ".", "(", "Maksymilian", "Arciemowicz", ",", "Pierre", ")", "-", "Fixed", "a", "possible", "double", "free", "in", "imap", "extension", "(", "Identified", "by", "Mateusz", "Kocielski", ")", ".", "(", "CVE", "-", "2010", "-", "4150", ")", ".", "(", "Ilia", ")", "-", "Fixed", "possible", "flaw", "in", "open_basedir", "(", "CVE", "-", "2010", "-", "3436", ")", ".", "(", "Pierre", ")", "-", "Fixed", "possible", "crash", "in", "mssql_fetch_batch", "(", ").", "(", "Kalle", ")", "-", "Fixed", "NULL", "pointer", "dereference", "in", "ZipArchive", ":", ":", "getArchiveComment", ".", "(", "CVE", "-", "2010", "-", "3709", ")", ".", "(", "Maksymilian", "Arciemowicz", ")", "-", "Fixed", "bug", "#", "53492", "(", "fix", "crash", "if", "anti", "-", "aliasing", "steps", "are", "invalid", ")", ".", "(", "Pierre", ")", "-", "Fixed", "bug", "#", "53323", "(", "pdo_firebird", "getAttribute", "(", ")", "crash", ")", ".", "(", "preeves", "at", "ibphoenix", "dot", "com", ")", "-", "Fixed", "bug", "#", "52929", "(", "Segfault", "in", "filter_var", "with", "FILTER_VALIDATE_EMAIL", "with", "@", "@", "-", "4593", ",", "6", "+", "4593", ",", "11", "@", "@", "PHP_FUNCTION", "(", "imagepstext", ")", "return", ";", "}", "if", "(", "aa_steps", "!", "=", "4", "|", "|", "aa_steps", "!", "=", "16", ")", "{", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "AA", "steps", "must", "be", "4", "or", "16", "\"", ");", "RETURN_FALSE", ";", "}", "ZEND_FETCH_RESOURCE", "(", "bg_img", ",", "gdImagePtr", ",", "&", "img", ",", "-", "1", ",", "\"", "Image", "\"", ",", "le_gd", ")", ";", "ZEND_FETCH_RESOURCE", "(", "f_ind", ",", "int", "*", ",", "&", "fnt", ",", "-", "1", ",", "\"", "Type", "1", "font", "\"", ",", "le_ps_font", ")", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "cause", "the", "application", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1582", ",", "7", "+", "1582", ",", "7", "@", "@", "int", "MoxaDriverIoctl", "(", "unsigned", "int", "cmd", ",", "unsigned", "long", "arg", ",", "int", "port", ")", "if", "(", "copy_from_user", "(", "&", "dltmp", ",", "argp", ",", "sizeof", "(", "struct", "dl_str", ")", "))", "return", "-", "EFAULT", ";", "if", "(", "dltmp", ".", "cardno", "<", "0", "|", "|", "dltmp", ".", "cardno", ">", "=", "MAX_BOARDS", ")", "if", "(", "dltmp", ".", "cardno", "<", "0", "|", "|", "dltmp", ".", "cardno", ">", "=", "MAX_BOARDS", "|", "|", "dltmp", ".", "len", "<", "0", ")", "return", "-", "EINVAL", ";", "switch", "(", "cmd", ")", "@", "@", "-", "2529", ",", "6", "+", "2529", ",", "8", "@", "@", "static", "int", "moxaloadbios", "(", "int", "cardno", ",", "unsigned", "char", "__user", "*", "tmp", ",", "int", "len", ")", "void", "__iomem", "*", "baseAddr", ";", "int", "i", ";", "if", "(", "len", "<", "0", "|", "|", "len", ">", "sizeof", "(", "moxaBuff", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "moxaBuff", ",", "tmp", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "baseAddr", "=", "moxa_boards", "[", "cardno", "]", ".", "basemem", ";", "@", "@", "-", "2576", ",", "7", "+", "2578", ",", "7", "@", "@", "static", "int", "moxaload320b", "(", "int", "cardno", ",", "unsigned", "char", "__user", "*", "tmp", ",", "int", "len", ")", "void", "__iomem", "*", "baseAddr", ";", "int", "i", ";", "if", "(", "len", ">", "sizeof", "(", "moxaBuff", ")", ")", "if", "(", "len", "<", "0", "|", "|", "len", ">", "sizeof", "(", "moxaBuff", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "moxaBuff", ",", "tmp", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "@", "@", "-", "2596", ",", "6", "+", "2598", ",", "8", "@", "@", "static", "int", "moxaloadcode", "(", "int", "cardno", ",", "unsigned", "char", "__user", "*", "tmp", ",", "int", "len", ")", "void", "__iomem", "*", "baseAddr", ",", "*", "ofsAddr", ";", "int", "retval", ",", "port", ",", "i", ";", "if", "(", "len", "<", "0", "|", "|", "len", ">", "sizeof", "(", "moxaBuff", ")", ")", "return", "-", "EINVAL", ";", "if", "(", "copy_from_user", "(", "moxaBuff", ",", "tmp", ",", "len", ")", ")", "return", "-", "EFAULT", ";", "baseAddr", "=", "moxa_boards", "[", "cardno", "]", ".", "basemem", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "201", ",", "6", "+", "201", ",", "21", "@", "@", "static", "void", "php_str2num", "(", "bc_num", "*", "num", ",", "char", "*", "str", "TSRMLS_DC", ")", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "split_bc_num", "Convert", "to", "bc_num", "detecting", "scale", "*", "/", "static", "bc_num", "split_bc_num", "(", "bc_num", "num", ")", "{", "bc_num", "newnum", ";", "if", "(", "num", "-", ">", "n_refs", ">", "=", "1", ")", "{", "return", "num", ";", "}", "newnum", "=", "_bc_new_num_ex", "(", "0", ",", "0", ",", "0", ")", ";", "*", "newnum", "=", "*", "num", ";", "newnum", "-", ">", "n_refs", "=", "1", ";", "num", "-", ">", "n_refs", "-", "-;", "return", "newnum", ";", "}", "/", "*", "}", "}}", "*", "/", "/", "*", "{", "{{", "proto", "string", "bcadd", "(", "string", "left_operand", ",", "string", "right_operand", "[", ",", "int", "scale", "]", ")", "Returns", "the", "sum", "of", "two", "arbitrary", "precision", "numbers", "*", "/", "PHP_FUNCTION", "(", "bcadd", ")", "@", "@", "-", "214", ",", "7", "+", "229", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcadd", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "@", "@", "-", "225", ",", "11", "+", "240", ",", "12", "@", "@", "PHP_FUNCTION", "(", "bcadd", ")", "php_str2num", "(", "&", "first", ",", "left", "TSRMLS_CC", ")", ";", "php_str2num", "(", "&", "second", ",", "right", "TSRMLS_CC", ")", ";", "bc_add", "(", "first", ",", "second", ",", "&", "result", ",", "scale", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "Z_STRLEN_P", "(", "return_value", ")", "=", "strlen", "(", "Z_STRVAL_P", "(", "return_value", ")", ");", "Z_TYPE_P", "(", "return_value", ")", "=", "IS_STRING", ";", "@", "@", "-", "253", ",", "7", "+", "269", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcsub", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "@", "@", "-", "266", ",", "6", "+", "282", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcsub", ")", "bc_sub", "(", "first", ",", "second", ",", "&", "result", ",", "scale", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "@", "@", "-", "292", ",", "11", "+", "309", ",", "11", "@", "@", "PHP_FUNCTION", "(", "bcmul", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "bc_init_num", "(", "&", "first", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "second", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "result", "TSRMLS_CC", ")", ";", "@", "@", "-", "305", ",", "6", "+", "322", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcmul", ")", "bc_multiply", "(", "first", ",", "second", ",", "&", "result", ",", "scale", "TSRMLS_CC", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "@", "@", "-", "331", ",", "11", "+", "349", ",", "11", "@", "@", "PHP_FUNCTION", "(", "bcdiv", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "bc_init_num", "(", "&", "first", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "second", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "result", "TSRMLS_CC", ")", ";", "@", "@", "-", "345", ",", "6", "+", "363", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcdiv", ")", "switch", "(", "bc_divide", "(", "first", ",", "second", ",", "&", "result", ",", "scale", "TSRMLS_CC", ")", ")", "{", "case", "0", ":", "/", "*", "OK", "*", "/", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "@", "@", "-", "374", ",", "13", "+", "393", ",", "13", "@", "@", "PHP_FUNCTION", "(", "bcmod", ")", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "ss", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "bc_init_num", "(", "&", "first", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "second", "TSRMLS_CC", ")", ";", "bc_init_num", "(", "&", "result", "TSRMLS_CC", ")", ";", "bc_str2num", "(", "&", "first", ",", "left", ",", "0", "TSRMLS_CC", ")", ";", "bc_str2num", "(", "&", "second", ",", "right", ",", "0", "TSRMLS_CC", ")", ";", "switch", "(", "bc_modulo", "(", "first", ",", "second", ",", "&", "result", ",", "0", "TSRMLS_CC", ")", ")", "{", "case", "0", ":", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "@", "@", "-", "391", ",", "7", "+", "410", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcmod", ")", "php_error_docref", "(", "NULL", "TSRMLS_CC", ",", "E_WARNING", ",", "\"", "Division", "by", "zero", "\"", ");", "break", ";", "}", "bc_free_num", "(", "&", "first", ")", ";", "bc_free_num", "(", "&", "second", ")", ";", "bc_free_num", "(", "&", "result", ")", ";", "@", "@", "-", "424", ",", "16", "+", "443", ",", "17", "@", "@", "PHP_FUNCTION", "(", "bcpowmod", ")", "scale_int", "=", "(", "int", ")", "(", "(", "int", ")", "scale", "<", "0", ")", "?", "0", ":", "scale", ";", "if", "(", "bc_raisemod", "(", "first", ",", "second", ",", "mod", ",", "&", "result", ",", "scale_int", "TSRMLS_CC", ")", "!", "=", "-", "1", ")", "{", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "-", ">", "n_scale", "=", "scale", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale_int", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale_int", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "Z_STRLEN_P", "(", "return_value", ")", "=", "strlen", "(", "Z_STRVAL_P", "(", "return_value", ")", ");", "Z_TYPE_P", "(", "return_value", ")", "=", "IS_STRING", ";", "}", "else", "{", "RETVAL_FALSE", ";", "}", "bc_free_num", "(", "&", "first", ")", ";", "bc_free_num", "(", "&", "second", ")", ";", "bc_free_num", "(", "&", "mod", ")", ";", "@", "@", "-", "455", ",", "7", "+", "475", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcpow", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "@", "@", "-", "468", ",", "6", "+", "488", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bcpow", ")", "bc_raise", "(", "first", ",", "second", ",", "&", "result", ",", "scale", "TSRMLS_CC", ")", ";", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "@", "@", "-", "494", ",", "16", "+", "515", ",", "17", "@", "@", "PHP_FUNCTION", "(", "bcsqrt", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "s", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "2", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "bc_init_num", "(", "&", "result", "TSRMLS_CC", ")", ";", "php_str2num", "(", "&", "result", ",", "left", "TSRMLS_CC", ")", ";", "if", "(", "bc_sqrt", "(", "&", "result", ",", "scale", "TSRMLS_CC", ")", "!", "=", "0", ")", "{", "if", "(", "result", "-", ">", "n_scale", ">", "scale", ")", "{", "result", "=", "split_bc_num", "(", "result", ")", ";", "result", "-", ">", "n_scale", "=", "scale", ";", "}", "Z_STRVAL_P", "(", "return_value", ")", "=", "bc_num2str", "(", "result", ")", ";", "@", "@", "-", "531", ",", "7", "+", "553", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bccomp", ")", "if", "(", "zend_parse_parameters", "(", "argc", "TSRMLS_CC", ",", "\"", "ss", "|", "l", "\"", ",", "&", "left", ",", "&", "left_len", ",", "&", "right", ",", "&", "right_len", ",", "&", "scale_param", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "if", "(", "argc", "=", "=", "3", ")", "{", "scale", "=", "(", "int", ")", "(", "(", "int", ")", "scale_param", "<", "0", ")", "?", "0", ":", "scale_param", ";", "}", "@", "@", "-", "555", ",", "7", "+", "577", ",", "7", "@", "@", "PHP_FUNCTION", "(", "bccomp", ")", "PHP_FUNCTION", "(", "bcscale", ")", "{", "long", "new_scale", ";", "if", "(", "zend_parse_parameters", "(", "ZEND_NUM_ARGS", "(", ")", "TSRMLS_CC", ",", "\"", "l", "\"", ",", "&", "new_scale", ")", "=", "=", "FAILURE", ")", "{", "return", ";", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "13", "@", "@", "-", "-", "TEST", "-", "-", "Bug", "72093", ":", "bcpowmod", "accepts", "negative", "scale", "and", "corrupts", "_one_", "definition", "-", "-", "SKIPIF", "-", "-", "<", "?", "php", "if", "(", "!", "extension_loaded", "(", "\"", "bcmath", "\"", "))", "print", "\"", "skip", "\"", ";", "?", ">", "-", "-", "FILE", "-", "-", "<", "?", "php", "var_dump", "(", "bcpowmod", "(", "1", ",", "\"", "A", "\"", ",", "128", ",", "-", "200", ")", ");", "var_dump", "(", "bcpowmod", "(", "1", ",", "1", ".", "2", ",", "1", ",", "1", ")", ");", "?", ">", "-", "-", "EXPECTF", "-", "-", "string", "(", "1", ")", "\"", "1", "\"", "bc", "math", "warning", ":", "non", "-", "zero", "scale", "in", "exponent", "string", "(", "3", ")", "\"", "0", ".", "0", "\"", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "/", "*", "edit", "configure", ".", "in", "to", "change", "version", "number", "*", "/", "#", "define", "PHP_MAJOR_VERSION", "5", "#", "define", "PHP_MINOR_VERSION", "5", "#", "define", "PHP_RELEASE_VERSION", "35", "#", "define", "PHP_RELEASE_VERSION", "27", "#", "define", "PHP_EXTRA_VERSION", "\"", "-", "dev", "\"", "#", "define", "PHP_VERSION", "\"", "5", ".", "5", ".", "35", "-", "dev", "\"", "#", "define", "PHP_VERSION_ID", "50535", "#", "define", "PHP_VERSION", "\"", "5", ".", "5", ".", "27", "-", "dev", "\"", "#", "define", "PHP_VERSION_ID", "50527"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "37", ",", "17", "+", "37", ",", "13", "@", "@", "<", "@", "s", ".", "textfield", "label", "=", "\"", "Enter", "Some", "Text", "\"", "name", "=", "\"", "text", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "action", ":", "actionPrefix", "\"", "value", "=", "\"%", "{'", "action", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "action", "=", "\"", "actionPrefix", "\"", "value", "=", "\"%", "{'", "action", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "method", ":", "alternateMethod", "\"", "value", "=", "\"%", "{'", "method", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "redirect", ":", "http", ":", "//", "www", ".", "google", ".", "com", "\"", "value", "=", "\"%", "{'", "redirect", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "redirect", "-", "action", ":", "redirectActionPrefix", "\"", "value", "=", "\"%", "{'", "redirect", "-", "action", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "method", "=", "\"", "alternateMethod", "\"", "value", "=", "\"%", "{'", "method", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "value", "=", "\"", "Normal", "Submit", "\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "name", "=", "\"", "action", ":", "redirectActionPrefixAction", "\"", "value", "=", "\"%", "{'", "redirect", "-", "action", "without", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "@", "s", ".", "submit", "action", "=", "\"", "redirectActionPrefixAction", "\"", "value", "=", "\"%", "{'", "redirectAction", "without", "prefix", "'", "}\"", "cssClass", "=", "\"", "btn", "\"", "/", ">", "<", "/@", "s", ".", "form", ">", "<", "/", "div", ">", "@", "@", "-", "33", ",", "11", "+", "33", ",", "15", "@", "@", "import", "org", ".", "apache", ".", "struts2", ".", "RequestUtils", ";", "import", "org", ".", "apache", ".", "struts2", ".", "ServletActionContext", ";", "import", "org", ".", "apache", ".", "struts2", ".", "StrutsConstants", ";", "import", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "ServletRedirectResult", ";", "import", "org", ".", "apache", ".", "struts2", ".", "util", ".", "PrefixTrie", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "/", "**", "@", "@", "-", "164", ",", "8", "+", "168", ",", "6", "@", "@", "protected", "static", "final", "String", "METHOD_PREFIX", "=", "\"", "method", ":", "\";", "protected", "static", "final", "String", "ACTION_PREFIX", "=", "\"", "action", ":", "\";", "protected", "static", "final", "String", "REDIRECT_PREFIX", "=", "\"", "redirect", ":", "\";", "protected", "static", "final", "String", "REDIRECT_ACTION_PREFIX", "=", "\"", "redirectAction", ":", "\";", "protected", "boolean", "allowDynamicMethodCalls", "=", "true", ";", "protected", "boolean", "allowSlashesInActionNames", "=", "false", ";", "@", "@", "-", "186", ",", "8", "+", "188", ",", "7", "@", "@", "public", "DefaultActionMapper", "(", ")", "{", "put", "(", "METHOD_PREFIX", ",", "new", "ParameterAction", "(", ")", "{", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "if", "(", "allowDynamicMethodCalls", ")", "{", "mapping", ".", "setMethod", "(", "key", ".", "substring", "(", "METHOD_PREFIX", ".", "length", "(", "))", ");", "mapping", ".", "setMethod", "(", "key", ".", "substring", "(", "METHOD_PREFIX", ".", "length", "(", "))", ");", "}", "}", "}", ");", "@", "@", "-", "203", ",", "34", "+", "204", ",", "10", "@", "@", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "name", "=", "name", ".", "substring", "(", "0", ",", "bang", ")", ";", "}", "}", "mapping", ".", "setName", "(", "name", ")", ";", "mapping", ".", "setName", "(", "cleanupActionName", "(", "name", ")", ");", "}", "}", ");", "put", "(", "REDIRECT_PREFIX", ",", "new", "ParameterAction", "(", ")", "{", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "ServletRedirectResult", "redirect", "=", "new", "ServletRedirectResult", "(", ");", "container", ".", "inject", "(", "redirect", ")", ";", "redirect", ".", "setLocation", "(", "key", ".", "substring", "(", "REDIRECT_PREFIX", ".", "length", "(", "))", ");", "mapping", ".", "setResult", "(", "redirect", ")", ";", "}", "}", ");", "put", "(", "REDIRECT_ACTION_PREFIX", ",", "new", "ParameterAction", "(", ")", "{", "public", "void", "execute", "(", "String", "key", ",", "ActionMapping", "mapping", ")", "{", "String", "location", "=", "key", ".", "substring", "(", "REDIRECT_ACTION_PREFIX", ".", "length", "(", "))", ";", "ServletRedirectResult", "redirect", "=", "new", "ServletRedirectResult", "(", ");", "container", ".", "inject", "(", "redirect", ")", ";", "String", "extension", "=", "getDefaultExtension", "(", ");", "if", "(", "extension", "!", "=", "null", "&", "&", "extension", ".", "length", "(", ")", ">", "0", ")", "{", "location", "+", "=", "\"", ".\"", "+", "extension", ";", "}", "redirect", ".", "setLocation", "(", "location", ")", ";", "mapping", ".", "setResult", "(", "redirect", ")", ";", "}", "}", ");", "}", "}", ";", "}", "@", "@", "-", "21", ",", "21", "+", "21", ",", "17", "@", "@", "package", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "mapper", ";", "import", "com", ".", "mockobjects", ".", "dynamic", ".", "Mock", ";", "import", "com", ".", "mockobjects", ".", "servlet", ".", "MockHttpServletRequest", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "ActionContext", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "ActionInvocation", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "Result", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "Configuration", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "ConfigurationManager", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "entities", ".", "PackageConfig", ";", "import", "com", ".", "opensymphony", ".", "xwork2", ".", "config", ".", "impl", ".", "DefaultConfiguration", ";", "import", "org", ".", "apache", ".", "struts2", ".", "ServletActionContext", ";", "import", "org", ".", "apache", ".", "struts2", ".", "StrutsTestCase", ";", "import", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "ServletRedirectResult", ";", "import", "org", ".", "apache", ".", "struts2", ".", "dispatcher", ".", "StrutsResultSupport", ";", "import", "org", ".", "apache", ".", "struts2", ".", "views", ".", "jsp", ".", "StrutsMockHttpServletRequest", ";", "import", "org", ".", "apache", ".", "struts2", ".", "views", ".", "jsp", ".", "StrutsMockHttpServletResponse", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "@", "@", "-", "447", ",", "7", "+", "443", ",", "7", "@", "@", "public", "void", "testActionPrefix_fromIEImageButton", "(", ")", "throws", "Exception", "{", "public", "void", "testRedirectPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "REDIRECT_PREFIX", "+", "\"", "http", ":", "//", "www", ".", "google", ".", "com", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "\"", "redirect", ":", "\"", "+", "\"", "http", ":", "//", "www", ".", "google", ".", "com", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", ".", "action", "\"", ");", "@", "@", "-", "458", ",", "25", "+", "454", ",", "28", "@", "@", "public", "void", "testRedirectPrefix", "(", ")", "throws", "Exception", "{", "ActionMapping", "actionMapping", "=", "defaultActionMapper", ".", "getMapping", "(", "request", ",", "configManager", ")", ";", "Result", "result", "=", "actionMapping", ".", "getResult", "(", ");", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "ServletRedirectResult", ")", ";", "Mock", "invMock", "=", "new", "Mock", "(", "ActionInvocation", ".", "class", ")", ";", "ActionInvocation", "inv", "=", "(", "ActionInvocation", ")", "invMock", ".", "proxy", "(", ");", "ActionContext", "ctx", "=", "ActionContext", ".", "getContext", "(", ");", "ctx", ".", "put", "(", "ServletActionContext", ".", "HTTP_REQUEST", ",", "request", ")", ";", "StrutsMockHttpServletResponse", "response", "=", "new", "StrutsMockHttpServletResponse", "(", ");", "ctx", ".", "put", "(", "ServletActionContext", ".", "HTTP_RESPONSE", ",", "response", ")", ";", "invMock", ".", "expectAndReturn", "(", "\"", "getInvocationContext", "\"", ",", "ctx", ")", ";", "invMock", ".", "expectAndReturn", "(", "\"", "getStack", "\"", ",", "ctx", ".", "getValueStack", "(", "))", ";", "result", ".", "execute", "(", "inv", ")", ";", "assertEquals", "(", "\"", "http", ":", "//", "www", ".", "google", ".", "com", "\"", ",", "response", ".", "getRedirectURL", "(", "))", ";", "/", "/", "TODO", ":", "need", "to", "test", "location", "but", "there", "'", "s", "noaccess", "to", "the", "property", "/", "method", ",", "unless", "we", "use", "reflection", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testUnsafeRedirectPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "\"", "redirect", ":", "\"", "+", "\"", "http", ":", "//", "%{", "3", "*", "4", "}", "\",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", ".", "action", "\"", ");", "request", ".", "setParameterMap", "(", "parameterMap", ")", ";", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "defaultActionMapper", ".", "setContainer", "(", "container", ")", ";", "ActionMapping", "actionMapping", "=", "defaultActionMapper", ".", "getMapping", "(", "request", ",", "configManager", ")", ";", "Result", "result", "=", "actionMapping", ".", "getResult", "(", ");", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "REDIRECT_ACTION_PREFIX", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", ".", "action", "\"", ");", "@", "@", "-", "488", ",", "17", "+", "487", ",", "29", "@", "@", "public", "void", "testRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "StrutsResultSupport", "result", "=", "(", "StrutsResultSupport", ")", "actionMapping", ".", "getResult", "(", ");", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "ServletRedirectResult", ")", ";", "assertNull", "(", "result", ")", ";", "}", "assertEquals", "(", "\"", "myAction", ".", "action", "\"", ",", "result", ".", "getLocation", "(", "))", ";", "public", "void", "testUnsafeRedirectActionPrefix", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "%{", "3", "*", "4", "}", "\",", "\"", "\")", ";", "/", "/", "TODO", ":", "need", "to", "test", "location", "but", "there", "'", "s", "noaccess", "to", "the", "property", "/", "method", ",", "unless", "we", "use", "reflection", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", ".", "action", "\"", ");", "request", ".", "setParameterMap", "(", "parameterMap", ")", ";", "DefaultActionMapper", "defaultActionMapper", "=", "new", "DefaultActionMapper", "(", ");", "defaultActionMapper", ".", "setContainer", "(", "container", ")", ";", "ActionMapping", "actionMapping", "=", "defaultActionMapper", ".", "getMapping", "(", "request", ",", "configManager", ")", ";", "StrutsResultSupport", "result", "=", "(", "StrutsResultSupport", ")", "actionMapping", ".", "getResult", "(", ");", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testRedirectActionPrefixWithEmptyExtension", "(", ")", "throws", "Exception", "{", "Map", "parameterMap", "=", "new", "HashMap", "(", ");", "parameterMap", ".", "put", "(", "DefaultActionMapper", ".", "REDIRECT_ACTION_PREFIX", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "parameterMap", ".", "put", "(", "\"", "redirectAction", ":", "\"", "+", "\"", "myAction", "\"", ",", "\"", "\")", ";", "StrutsMockHttpServletRequest", "request", "=", "new", "StrutsMockHttpServletRequest", "(", ");", "request", ".", "setupGetServletPath", "(", "\"/", "someServletPath", "\"", ");", "@", "@", "-", "511", ",", "12", "+", "522", ",", "7", "@", "@", "public", "void", "testRedirectActionPrefixWithEmptyExtension", "(", ")", "throws", "Exception", "{", "StrutsResultSupport", "result", "=", "(", "StrutsResultSupport", ")", "actionMapping", ".", "getResult", "(", ");", "assertNotNull", "(", "result", ")", ";", "assertTrue", "(", "result", "instanceof", "ServletRedirectResult", ")", ";", "assertEquals", "(", "\"", "myAction", "\"", ",", "result", ".", "getLocation", "(", "))", ";", "/", "/", "TODO", ":", "need", "to", "test", "location", "but", "there", "'", "s", "noaccess", "to", "the", "property", "/", "method", ",", "unless", "we", "use", "reflection", "assertNull", "(", "result", ")", ";", "}", "public", "void", "testCustomActionPrefix", "(", ")", "throws", "Exception", "{"], "docstring_tokens": ["affects", "other", "products"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "74", ",", "6", "+", "74", ",", "11", "@", "@", "static", "int", "__verify_planes_array", "(", "struct", "vb2_buffer", "*", "vb", ",", "const", "struct", "v4l2_buffer", "return", "0", ";", "}", "static", "int", "__verify_planes_array_core", "(", "struct", "vb2_buffer", "*", "vb", ",", "const", "void", "*", "pb", ")", "{", "return", "__verify_planes_array", "(", "vb", ",", "pb", ")", ";", "}", "/", "**", "*", "__verify_length", "(", ")", "-", "Verify", "that", "the", "bytesused", "value", "for", "each", "plane", "fits", "in", "*", "the", "plane", "length", "and", "that", "the", "data", "offset", "doesn", "'", "t", "exceed", "the", "bytesused", "value", ".", "@", "@", "-", "437", ",", "6", "+", "442", ",", "7", "@", "@", "static", "int", "__fill_vb2_buffer", "(", "struct", "vb2_buffer", "*", "vb", ",", "}", "static", "const", "struct", "vb2_buf_ops", "v4l2_buf_ops", "=", "{", ".", "verify_planes_array", "=", "__verify_planes_array_core", ",", ".", "fill_user_buffer", "=", "__fill_v4l2_buffer", ",", ".", "fill_vb2_buffer", "=", "__fill_vb2_buffer", ",", ".", "copy_timestamp", "=", "__copy_timestamp", ","], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(kernel", "memory", "write", "operation", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "719", ",", "8", "+", "719", ",", "9", "@", "@", "int", "ssl3_client_hello", "(", "SSL", "*", "s", ")", "}", "else", "i", "=", "1", ";", "if", "(", "i", ")", "ssl_fill_hello_random", "(", "s", ",", "0", ",", "p", ",", "sizeof", "(", "s", "-", ">", "s3", "-", ">", "client_random", ")", ");", "if", "(", "i", "&", "&", "ssl_fill_hello_random", "(", "s", ",", "0", ",", "p", ",", "sizeof", "(", "s", "-", ">", "s3", "-", ">", "client_random", ")", ")", "<", "=", "0", ")", "goto", "err", ";", "/", "*", "Do", "the", "message", "type", "and", "length", "last", "*", "/", "d", "=", "p", "=", "ssl_handshake_start", "(", "s", ")", ";"], "docstring_tokens": ["complete", "a", "handshake", "and", "generate", "the", "client", "random"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "817", ",", "26", "+", "817", ",", "49", "@", "@", "static", "int", "ati_remote2_probe", "(", "struct", "usb_interface", "*", "interface", ",", "const", "struct", "usb_d", "ar2", "-", ">", "udev", "=", "udev", ";", "/", "*", "Sanity", "check", ",", "first", "interface", "must", "have", "an", "endpoint", "*", "/", "if", "(", "alt", "-", ">", "desc", ".", "bNumEndpoints", "<", "1", "|", "|", "!", "alt", "-", ">", "endpoint", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "%", "s", "(", "):", "interface", "0", "must", "have", "an", "endpoint", "\\", "n", "\"", ",", "__func__", ")", ";", "r", "=", "-", "ENODEV", ";", "goto", "fail1", ";", "}", "ar2", "-", ">", "intf", "[", "0", "]", "=", "interface", ";", "ar2", "-", ">", "ep", "[", "0", "]", "=", "&", "alt", "-", ">", "endpoint", "[", "0", "]", ".", "desc", ";", "/", "*", "Sanity", "check", ",", "the", "device", "must", "have", "two", "interfaces", "*", "/", "ar2", "-", ">", "intf", "[", "1", "]", "=", "usb_ifnum_to_if", "(", "udev", ",", "1", ")", ";", "if", "(", "(", "udev", "-", ">", "actconfig", "-", ">", "desc", ".", "bNumInterfaces", "<", "2", ")", "|", "|", "!", "ar2", "-", ">", "intf", "[", "1", "]", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "%", "s", "(", "):", "need", "2", "interfaces", ",", "found", "%", "d", "\\", "n", "\"", ",", "__func__", ",", "udev", "-", ">", "actconfig", "-", ">", "desc", ".", "bNumInterfaces", ")", ";", "r", "=", "-", "ENODEV", ";", "goto", "fail1", ";", "}", "r", "=", "usb_driver_claim_interface", "(", "&", "ati_remote2_driver", ",", "ar2", "-", ">", "intf", "[", "1", "]", ",", "ar2", ")", ";", "if", "(", "r", ")", "goto", "fail1", ";", "/", "*", "Sanity", "check", ",", "second", "interface", "must", "have", "an", "endpoint", "*", "/", "alt", "=", "ar2", "-", ">", "intf", "[", "1", "]", "->", "cur_altsetting", ";", "if", "(", "alt", "-", ">", "desc", ".", "bNumEndpoints", "<", "1", "|", "|", "!", "alt", "-", ">", "endpoint", ")", "{", "dev_err", "(", "&", "interface", "-", ">", "dev", ",", "\"", "%", "s", "(", "):", "interface", "1", "must", "have", "an", "endpoint", "\\", "n", "\"", ",", "__func__", ")", ";", "r", "=", "-", "ENODEV", ";", "goto", "fail2", ";", "}", "ar2", "-", ">", "ep", "[", "1", "]", "=", "&", "alt", "-", ">", "endpoint", "[", "0", "]", ".", "desc", ";", "r", "=", "ati_remote2_urb_init", "(", "ar2", ")", ";", "if", "(", "r", ")", "goto", "fail2", ";", "goto", "fail3", ";", "ar2", "-", ">", "channel_mask", "=", "channel_mask", ";", "ar2", "-", ">", "mode_mask", "=", "mode_mask", ";", "r", "=", "ati_remote2_setup", "(", "ar2", ",", "ar2", "-", ">", "channel_mask", ")", ";", "if", "(", "r", ")", "goto", "fail2", ";", "goto", "fail3", ";", "usb_make_path", "(", "udev", ",", "ar2", "-", ">", "phys", ",", "sizeof", "(", "ar2", "-", ">", "phys", ")", ");", "strlcat", "(", "ar2", "-", ">", "phys", ",", "\"", "/", "input0", "\"", ",", "sizeof", "(", "ar2", "-", ">", "phys", ")", ");", "@", "@", "-", "845", ",", "22", "+", "868", ",", "23", "@", "@", "static", "int", "ati_remote2_probe", "(", "struct", "usb_interface", "*", "interface", ",", "const", "struct", "usb_d", "r", "=", "sysfs_create_group", "(", "&", "udev", "-", ">", "dev", ".", "kobj", ",", "&", "ati_remote2_attr_group", ")", ";", "if", "(", "r", ")", "goto", "fail2", ";", "goto", "fail3", ";", "r", "=", "ati_remote2_input_init", "(", "ar2", ")", ";", "if", "(", "r", ")", "goto", "fail3", ";", "goto", "fail4", ";", "usb_set_intfdata", "(", "interface", ",", "ar2", ")", ";", "interface", "-", ">", "needs_remote_wakeup", "=", "1", ";", "return", "0", ";", "fail3", ":", "fail4", ":", "sysfs_remove_group", "(", "&", "udev", "-", ">", "dev", ".", "kobj", ",", "&", "ati_remote2_attr_group", ")", ";", "fail2", ":", "fail3", ":", "ati_remote2_urb_cleanup", "(", "ar2", ")", ";", "fail2", ":", "usb_driver_release_interface", "(", "&", "ati_remote2_driver", ",", "ar2", "-", ">", "intf", "[", "1", "]", ");", "fail1", ":", "kfree", "(", "ar2", ")", ";"], "docstring_tokens": ["the", "kernel", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1368", ",", "7", "+", "1368", ",", "7", "@", "@", "static", "int", "make_indexed_dir", "(", "handle_t", "*", "handle", ",", "struct", "dentry", "*", "dentry", ",", "struct", "fake_dirent", "*", "fde", ";", "blocksize", "=", "dir", "-", ">", "i_sb", "-", ">", "s_blocksize", ";", "dxtrace", "(", "printk", "(", "KERN_DEBUG", "\"", "Creating", "index", "\\", "n", "\"", "))", ";", "dxtrace", "(", "printk", "(", "KERN_DEBUG", "\"", "Creating", "index", ":", "inode", "%", "lu", "\\", "n", "\"", ",", "dir", "-", ">", "i_ino", ")", ");", "retval", "=", "ext4_journal_get_write_access", "(", "handle", ",", "bh", ")", ";", "if", "(", "retval", ")", "{", "ext4_std_error", "(", "dir", "-", ">", "i_sb", ",", "retval", ")", ";", "@", "@", "-", "1377", ",", "6", "+", "1377", ",", "20", "@", "@", "static", "int", "make_indexed_dir", "(", "handle_t", "*", "handle", ",", "struct", "dentry", "*", "dentry", ",", "}", "root", "=", "(", "struct", "dx_root", "*", ")", "bh", "-", ">", "b_data", ";", "/", "*", "The", "0th", "block", "becomes", "the", "root", ",", "move", "the", "dirents", "out", "*", "/", "fde", "=", "&", "root", "-", ">", "dotdot", ";", "de", "=", "(", "struct", "ext4_dir_entry_2", "*", ")(", "(", "char", "*", ")", "fde", "ext4_rec_len_from_disk", "(", "fde", "-", ">", "rec_len", ")", ");", "if", "(", "(", "char", "*", ")", "de", ">", "=", "(", "((", "char", "*", ")", "root", ")", "+", "blocksize", ")", ")", "{", "ext4_error", "(", "dir", "-", ">", "i_sb", ",", "__func__", ",", "\"", "invalid", "rec_len", "for", "'", "..", "'", "in", "inode", "%", "lu", "\"", ",", "dir", "-", ">", "i_ino", ")", ";", "brelse", "(", "bh", ")", ";", "return", "-", "EIO", ";", "}", "len", "=", "(", "(", "char", "*", ")", "root", ")", "+", "blocksize", "-", "(", "char", "*", ")", "de", ";", "/", "*", "Allocate", "new", "block", "for", "the", "0th", "block", "'", "s", "dirents", "*", "/", "bh2", "=", "ext4_append", "(", "handle", ",", "dir", ",", "&", "block", ",", "&", "retval", ")", ";", "if", "(", "!(", "bh2", ")", ")", "{", "brelse", "(", "bh", ")", ";", "@", "@", "-", "1385", ",", "11", "+", "1399", ",", "6", "@", "@", "static", "int", "make_indexed_dir", "(", "handle_t", "*", "handle", ",", "struct", "dentry", "*", "dentry", ",", "EXT4_I", "(", "dir", ")", "->", "i_flags", "|", "=", "EXT4_INDEX_FL", ";", "data1", "=", "bh2", "-", ">", "b_data", ";", "/", "*", "The", "0th", "block", "becomes", "the", "root", ",", "move", "the", "dirents", "out", "*", "/", "fde", "=", "&", "root", "-", ">", "dotdot", ";", "de", "=", "(", "struct", "ext4_dir_entry_2", "*", ")(", "(", "char", "*", ")", "fde", "+", "ext4_rec_len_from_disk", "(", "fde", "-", ">", "rec_len", ")", ");", "len", "=", "(", "(", "char", "*", ")", "root", ")", "+", "blocksize", "-", "(", "char", "*", ")", "de", ";", "memcpy", "(", "data1", ",", "de", ",", "len", ")", ";", "de", "=", "(", "struct", "ext4_dir_entry_2", "*", ")", "data1", ";", "top", "=", "data1", "+", "len", ";"], "docstring_tokens": ["denying", "service", "to", "legitimate", "users"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "3", "+", "1", ",", "6", "@", "@", "2", ".", "1", ".", "4", "*", "If", "no", "JMX", "flags", "are", "set", "start", "a", "localhost", "only", "JMX", "service", "2", ".", "1", ".", "3", "*", "Fix", "HSHA", "/", "offheap_objects", "corruption", "(", "CASSANDRA", "-", "8719", ")", "*", "Upgrade", "libthrift", "to", "0", ".", "9", ".", "2", "(", "CASSANDRA", "-", "8685", ")", "@", "@", "-", "13", ",", "6", "+", "13", ",", "12", "@", "@", "restore", "snapshots", "created", "with", "the", "previous", "major", "version", "using", "the", "'", "sstableloader", "'", "tool", ".", "You", "can", "upgrade", "the", "file", "format", "of", "your", "snapshots", "using", "the", "provided", "'", "sstableupgrade", "'", "tool", ".", "2", ".", "1", ".", "4", "=", "==", "==", "The", "default", "JMX", "config", "now", "listens", "to", "localhost", "only", ".", "You", "must", "enable", "the", "other", "JMX", "flags", "in", "cassandra", "-", "env", ".", "sh", "manually", ".", "2", ".", "1", ".", "3", "=", "==", "==", "@", "@", "-", "65", ",", "10", "+", "65", ",", "13", "@", "@", "set", "JAVA_OPTS", "=", "-", "ea", "^", "-", "XX", ":", "MaxTenuringThreshold", "=", "1", "^", "-", "XX", ":", "CMSInitiatingOccupancyFraction", "=", "75", "^", "-", "XX", ":", "+", "UseCMSInitiatingOccupancyOnly", "^", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "port", "=", "7199", "^", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "ssl", "=", "false", "^", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "authenticate", "=", "false", "^", "-", "Dlogback", ".", "configurationFile", "=", "logback", ".", "xml", "-", "Dlogback", ".", "configurationFile", "=", "logback", ".", "xml", "^", "-", "Dcassandra", ".", "jmx", ".", "local", ".", "port", "=", "7199", "REM", "*", "**", "*", "JMX", "REMOTE", "ACCESS", "SETTINGS", "SEE", ":", "https", ":", "//", "wiki", ".", "apache", ".", "org", "/", "cassandra", "/", "JmxSecurity", "*", "**", "REM", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "port", "=", "7199", "^", "REM", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "ssl", "=", "false", "^", "REM", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "authenticate", "=", "true", "^", "REM", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "password", ".", "file", "=", "C", ":", "\\", "jmxremote", ".", "password", "REM", "*", "**", "**", "CLASSPATH", "library", "setting", "*", "**", "**", "REM", "Ensure", "that", "any", "user", "defined", "CLASSPATH", "variables", "are", "not", "used", "on", "startup", "@", "@", "-", "25", ",", "7", "+", "25", ",", "7", "@", "@", "<", "property", "name", "=", "\"", "debuglevel", "\"", "value", "=", "\"", "source", ",", "lines", ",", "vars", "\"", "/>", "<", "!-", "-", "default", "version", "and", "SCM", "information", "-", "->", "<", "property", "name", "=", "\"", "base", ".", "version", "\"", "value", "=", "\"", "2", ".", "1", ".", "3", "\"", "/>", "<", "property", "name", "=", "\"", "base", ".", "version", "\"", "value", "=", "\"", "2", ".", "1", ".", "4", "\"", "/>", "<", "property", "name", "=", "\"", "scm", ".", "connection", "\"", "value", "=", "\"", "scm", ":", "git", ":", "//", "git", ".", "apache", ".", "org", "/", "cassandra", ".", "git", "\"", "/>", "<", "property", "name", "=", "\"", "scm", ".", "developerConnection", "\"", "value", "=", "\"", "scm", ":", "git", ":", "//", "git", ".", "apache", ".", "org", "/", "cassandra", ".", "git", "\"", "/>", "<", "property", "name", "=", "\"", "scm", ".", "url", "\"", "value", "=", "\"", "http", ":", "//", "git", "-", "wip", "-", "us", ".", "apache", ".", "org", "/", "repos", "/", "asf", "?", "p", "=", "cassandra", ".", "git", ";", "a", "=", "tree", "\"", "/>", "@", "@", "-", "1113", ",", "6", "+", "1113", ",", "7", "@", "@", "<", "jvmarg", "value", "=", "\"-", "Xss256k", "\"", "/>", "<", "jvmarg", "value", "=", "\"-", "Dcassandra", ".", "memtable_row_overhead_computation_step", "=", "100", "\"", "/>", "<", "jvmarg", "value", "=", "\"-", "Dcassandra", ".", "test", ".", "use_prepared", "=", "${", "cassandra", ".", "test", ".", "use_prepared", "}", "\"/", ">", "<", "jvmarg", "value", "=", "\"-", "Dcassandra", ".", "jmx", ".", "local", ".", "port", "=", "7199", "\"", "/", ">", "<", "jvmarg", "value", "=", "\"-", "Dcassandra", ".", "test", ".", "offsetseed", "=", "@{", "poffset", "}", "\"/", ">", "<", "optjvmargs", "/", ">", "<", "classpath", ">", "@", "@", "-", "400", ",", "10", "+", "400", ",", "17", "@", "@", "Function", "SetCassandraEnvironment", "#", "https", ":", "//", "blogs", ".", "oracle", ".", "com", "/", "jmxetc", "/", "entry", "/", "troubleshooting_connection_problems_in_jconsole", "#", "for", "more", "on", "configuring", "JMX", "through", "firewalls", ",", "etc", ".", "(", "Short", "version", ":", "#", "get", "it", "working", "with", "no", "firewall", "first", ".", ")", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "port", "=", "$", "JMX_PORT", "\"", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "ssl", "=", "false", "\"", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "authenticate", "=", "false", "\"", "#", "#", "Due", "to", "potential", "security", "exploits", ",", "Cassandra", "ships", "with", "JMX", "accessible", "#", "*", "only", "*", "from", "localhost", ".", "To", "enable", "remote", "JMX", "connections", ",", "uncomment", "lines", "below", "#", "with", "authentication", "and", "ssl", "enabled", ".", "See", "https", ":", "//", "wiki", ".", "apache", ".", "org", "/", "cassandra", "/", "JmxSecurity", "#", "#", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "port", "=", "$", "JMX_PORT", "\"", "#", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "ssl", "=", "false", "\"", "#", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "authenticate", "=", "true", "\"", "#", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "password", ".", "file", "=", "C", ":", "/", "jmxremote", ".", "password", "\"", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "-", "Dcassandra", ".", "jmx", ".", "local", ".", "port", "=", "$", "JMX_PORT", "-", "XX", ":", "+", "DisableExplicitGC", "\"", "$", "env", ":", "JVM_OPTS", "=", "\"$", "env", ":", "JVM_OPTS", "$", "JVM_EXTRA_OPTS", "\"", "$", "env", ":", "JVM_OPTS", "=", "\"", "$", "env", ":", "JVM_OPTS", "-", "Dlog4j", ".", "configuration", "=", "log4j", "-", "server", ".", "properties", "\"", "@", "@", "-", "270", ",", "6", "+", "270", ",", "22", "@", "@", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Djava", ".", "net", ".", "preferIPv4Stack", "=", "true", "\"", "#", "https", ":", "//", "blogs", ".", "oracle", ".", "com", "/", "jmxetc", "/", "entry", "/", "troubleshooting_connection_problems_in_jconsole", "#", "for", "more", "on", "configuring", "JMX", "through", "firewalls", ",", "etc", ".", "(", "Short", "version", ":", "#", "get", "it", "working", "with", "no", "firewall", "first", ".", ")", "#", "#", "Cassandra", "ships", "with", "JMX", "accessible", "*", "only", "*", "from", "localhost", ".", "#", "To", "enable", "remote", "JMX", "connections", ",", "uncomment", "lines", "below", "#", "with", "authentication", "and", "/", "or", "ssl", "enabled", ".", "See", "https", ":", "//", "wiki", ".", "apache", ".", "org", "/", "cassandra", "/", "JmxSecurity", "#", "LOCAL_JMX", "=", "yes", "if", "[", "\"", "$", "LOCAL_JMX", "\"", "=", "\"", "yes", "\"", "]", ";", "then", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcassandra", ".", "jmx", ".", "local", ".", "port", "=", "$", "JMX_PORT", "-", "XX", ":", "+", "DisableExplicitGC", "\"", "else", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "port", "=", "$", "JMX_PORT", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "rmi", ".", "port", "=", "$", "JMX_PORT", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "ssl", "=", "false", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "authenticate", "=", "true", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "password", ".", "file", "=", "/", "etc", "/", "cassandra", "/", "jmxremote", ".", "password", "\"", "fi", "#", "To", "use", "mx4j", ",", "an", "HTML", "interface", "for", "JMX", ",", "add", "mx4j", "-", "tools", ".", "jar", "to", "the", "lib", "/", "#", "directory", ".", "@", "@", "-", "279", ",", "11", "+", "295", ",", "6", "@", "@", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Djava", ".", "net", ".", "preferIPv4Stack", "=", "true", "\"", "#", "MX4J_ADDRESS", "=", "\"-", "Dmx4jaddress", "=", "127", ".", "0", ".", "0", ".", "1", "\"", "#", "MX4J_PORT", "=", "\"-", "Dmx4jport", "=", "8081", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "port", "=", "$", "JMX_PORT", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "rmi", ".", "port", "=", "$", "JMX_PORT", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "ssl", "=", "false", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "authenticate", "=", "false", "\"", "#", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "-", "Dcom", ".", "sun", ".", "management", ".", "jmxremote", ".", "password", ".", "file", "=", "/", "etc", "/", "cassandra", "/", "jmxremote", ".", "password", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "$", "MX4J_ADDRESS", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "$", "MX4J_PORT", "\"", "JVM_OPTS", "=", "\"$", "JVM_OPTS", "$", "JVM_EXTRA_OPTS", "\"", "@", "@", "-", "1", ",", "3", "+", "1", ",", "9", "@", "@", "cassandra", "(", "2", ".", "1", ".", "4", ")", "unstable", ";", "urgency", "=", "medium", "*", "New", "release", "-", "-", "Jake", "Luciani", "<", "jake", "@", "apache", ".", "org", ">", "Fri", ",", "27", "Mar", "2015", "13", ":", "48", ":", "25", "-", "0400", "cassandra", "(", "2", ".", "1", ".", "3", ")", "unstable", ";", "urgency", "=", "medium", "*", "New", "release", "@", "@", "-", "23", ",", "14", "+", "23", ",", "16", "@", "@", "import", "java", ".", "lang", ".", "management", ".", "MemoryPoolMXBean", ";", "import", "java", ".", "net", ".", "InetAddress", ";", "import", "java", ".", "net", ".", "UnknownHostException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "import", "java", ".", "rmi", ".", "server", ".", "RMIServerSocketFactory", ";", "import", "java", ".", "util", ".", "*;", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "javax", ".", "management", ".", "MBeanServer", ";", "import", "javax", ".", "management", ".", "ObjectName", ";", "import", "javax", ".", "management", ".", "StandardMBean", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXConnectorServer", ";", "import", "javax", ".", "management", ".", "remote", ".", "JMXServiceURL", ";", "import", "javax", ".", "management", ".", "remote", ".", "rmi", ".", "RMIConnectorServer", ";", "import", "com", ".", "google", ".", "common", ".", "collect", ".", "Iterables", ";", "import", "com", ".", "google", ".", "common", ".", "util", ".", "concurrent", ".", "Uninterruptibles", ";", "@", "@", "-", "66", ",", "9", "+", "68", ",", "61", "@", "@", "public", "class", "CassandraDaemon", "{", "public", "static", "final", "String", "MBEAN_NAME", "=", "\"", "org", ".", "apache", ".", "cassandra", ".", "db", ":", "type", "=", "NativeAccess", "\"", ";", "public", "static", "JMXConnectorServer", "jmxServer", "=", "null", ";", "private", "static", "final", "Logger", "logger", "=", "LoggerFactory", ".", "getLogger", "(", "CassandraDaemon", ".", "class", ")", ";", "private", "static", "void", "maybeInitJmx", "(", ")", "{", "String", "jmxPort", "=", "System", ".", "getProperty", "(", "\"", "com", ".", "sun", ".", "management", ".", "jmxremote", ".", "port", "\"", ");", "if", "(", "jmxPort", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "JMX", "is", "not", "enabled", "to", "receive", "remote", "connections", ".", "Please", "see", "cassandra", "-", "env", ".", "sh", "for", "more", "info", ".", "\")", ";", "jmxPort", "=", "System", ".", "getProperty", "(", "\"", "cassandra", ".", "jmx", ".", "local", ".", "port", "\"", ");", "if", "(", "jmxPort", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "cassandra", ".", "jmx", ".", "local", ".", "port", "missing", "from", "cassandra", "-", "env", ".", "sh", ",", "unable", "to", "start", "local", "JMX", "service", ".", "\"", "+", "jmxPort", ")", ";", "}", "else", "{", "System", ".", "setProperty", "(", "\"", "java", ".", "rmi", ".", "server", ".", "hostname", "\"", ",\"", "127", ".", "0", ".", "0", ".", "1", "\"", ");", "try", "{", "RMIServerSocketFactory", "serverFactory", "=", "new", "RMIServerSocketFactoryImpl", "(", ");", "LocateRegistry", ".", "createRegistry", "(", "Integer", ".", "valueOf", "(", "jmxPort", ")", ",", "null", ",", "serverFactory", ")", ";", "StringBuffer", "url", "=", "new", "StringBuffer", "(", ");", "url", ".", "append", "(", "\"", "service", ":", "jmx", ":", "\")", ";", "url", ".", "append", "(", "\"", "rmi", ":", "//", "localhost", "/", "jndi", "/", "\")", ";", "url", ".", "append", "(", "\"", "rmi", ":", "//", "localhost", ":", "\")", ".", "append", "(", "jmxPort", ")", ".", "append", "(", "\"/", "jmxrmi", "\"", ");", "Map", "env", "=", "new", "HashMap", "(", ");", "env", ".", "put", "(", "RMIConnectorServer", ".", "RMI_SERVER_SOCKET_FACTORY_ATTRIBUTE", ",", "serverFactory", ")", ";", "jmxServer", "=", "new", "RMIConnectorServer", "(", "new", "JMXServiceURL", "(", "url", ".", "toString", "(", "))", ",", "env", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ")", ";", "jmxServer", ".", "start", "(", ");", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "error", "(", "\"", "Error", "starting", "local", "jmx", "server", ":", "\"", ",", "e", ")", ";", "}", "}", "}", "else", "{", "logger", ".", "info", "(", "\"", "JMX", "is", "enabled", "to", "receive", "remote", "connections", "on", "port", ":", "\"", "+", "jmxPort", ")", ";", "}", "}", "private", "static", "final", "CassandraDaemon", "instance", "=", "new", "CassandraDaemon", "(", ");", "/", "**", "@", "@", "-", "159", ",", "6", "+", "213", ",", "8", "@", "@", "else", "if", "(", "!", "javaVmName", ".", "contains", "(", "\"", "HotSpot", "\"", "))", "CLibrary", ".", "tryMlockall", "(", ");", "maybeInitJmx", "(", ");", "Thread", ".", "setDefaultUncaughtExceptionHandler", "(", "new", "Thread", ".", "UncaughtExceptionHandler", "(", ")", "{", "public", "void", "uncaughtException", "(", "Thread", "t", ",", "Throwable", "e", ")", "@", "@", "-", "432", ",", "6", "+", "488", ",", "18", "@", "@", "public", "void", "stop", "(", ")", "/", "/", "We", "rely", "on", "the", "shutdown", "hook", "to", "drain", "the", "node", "if", "(", "FBUtilities", ".", "isWindows", "(", "))", "System", ".", "exit", "(", "0", ")", ";", "if", "(", "jmxServer", "!", "=", "null", ")", "{", "try", "{", "jmxServer", ".", "stop", "(", ");", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "error", "(", "\"", "Error", "shutting", "down", "local", "JMX", "server", ":", "\"", ",", "e", ")", ";", "}", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "34", "@", "@", "package", "org", ".", "apache", ".", "cassandra", ".", "utils", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "net", ".", "*;", "import", "java", ".", "rmi", ".", "server", ".", "RMIServerSocketFactory", ";", "import", "javax", ".", "net", ".", "ServerSocketFactory", ";", "public", "class", "RMIServerSocketFactoryImpl", "implements", "RMIServerSocketFactory", "{", "public", "ServerSocket", "createServerSocket", "(", "final", "int", "pPort", ")", "throws", "IOException", "{", "return", "ServerSocketFactory", ".", "getDefault", "(", ").", "createServerSocket", "(", "pPort", ",", "0", ",", "InetAddress", ".", "getLoopbackAddress", "(", "))", ";", "}", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "obj", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "obj", "=", "=", "this", ")", "{", "return", "true", ";", "}", "return", "obj", ".", "getClass", "(", ").", "equals", "(", "getClass", "(", "))", ";", "}", "public", "int", "hashCode", "(", ")", "{", "return", "RMIServerSocketFactoryImpl", ".", "class", ".", "hashCode", "(", ");", "}", "}"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system", "with", "the", "privileges", "of", "the", "victim"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "32", ",", "10", "+", "32", ",", "15", "@", "@", "public", "final", "class", "ReconciliationReportParser", "{", "private", "static", "final", "XMLInputFactory", "INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "ReconciliationReport", "parse", "(", "final", "Date", "run", ",", "final", "InputStream", "in", ")", "throws", "XMLStreamException", "{", "XMLStreamReader", "streamReader", "=", "INPUT_FACTORY", ".", "createXMLStreamReader", "(", "in", ")", ";", "XMLStreamReader", "streamReader", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "in", ")", ";", "streamReader", ".", "nextTag", "(", ");", "/", "/", "root", "streamReader", ".", "nextTag", "(", ");", "/", "/", "report", "streamReader", ".", "nextTag", "(", ");", "/", "/", "reportlet", "@", "@", "-", "41", ",", "6", "+", "41", ",", "13", "@", "@", "private", "static", "final", "ObjectMapper", "OBJECT_MAPPER", "=", "new", "ObjectMapper", "(", ");", "private", "static", "final", "XMLInputFactory", "XML_INPUT_FACTORY", "=", "XMLInputFactory", ".", "newInstance", "(", ");", "static", "{", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "IS_SUPPORTING_EXTERNAL_ENTITIES", ",", "Boolean", ".", "FALSE", ")", ";", "XML_INPUT_FACTORY", ".", "setProperty", "(", "XMLInputFactory", ".", "SUPPORT_DTD", ",", "Boolean", ".", "FALSE", ")", ";", "}", "public", "static", "Deployment", "deployDefinition", "(", "final", "ProcessEngine", "engine", ",", "final", "String", "resourceName", ",", "final", "byte", "[", "]", "definition", ")", "{", "@", "@", "-", "58", ",", "7", "+", "65", ",", "7", "@", "@", "public", "static", "void", "deployModel", "(", "final", "ProcessEngine", "engine", ",", "final", "ProcessDefiniti", "getResourceAsStream", "(", "procDef", ".", "getDeploymentId", "(", "),", "procDef", ".", "getResourceName", "(", "))", ";", "InputStreamReader", "isr", "=", "new", "InputStreamReader", "(", "bpmnStream", ")", ")", "{", "xtr", "=", "XMLInputFactory", ".", "newInstance", "(", ").", "createXMLStreamReader", "(", "isr", ")", ";", "xtr", "=", "XML_INPUT_FACTORY", ".", "createXMLStreamReader", "(", "isr", ")", ";", "BpmnModel", "bpmnModel", "=", "new", "BpmnXMLConverter", "(", ").", "convertToBpmnModel", "(", "xtr", ")", ";", "Model", "model", "=", "engine", ".", "getRepositoryService", "(", ").", "newModel", "(", ");", "@", "@", "-", "18", ",", "16", "+", "18", ",", "14", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "syncope", ".", "core", ".", "flowable", ".", "support", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "sql", ".", "DataSource", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringUtils", ";", "import", "org", ".", "flowable", ".", "engine", ".", "ProcessEngine", ";", "import", "org", ".", "flowable", ".", "common", ".", "engine", ".", "impl", ".", "cfg", ".", "SpringBeanFactoryProxyMap", ";", "import", "org", ".", "flowable", ".", "common", ".", "engine", ".", "impl", ".", "interceptor", ".", "EngineConfigurationConstants", ";", "import", "org", ".", "flowable", ".", "engine", ".", "form", ".", "AbstractFormType", ";", "import", "org", ".", "flowable", ".", "engine", ".", "impl", ".", "util", ".", "EngineServiceUtil", ";", "import", "org", ".", "flowable", ".", "idm", ".", "spring", ".", "SpringIdmEngineConfiguration", ";", "import", "org", ".", "flowable", ".", "spring", ".", "SpringExpressionManager", ";", "@", "@", "-", "84", ",", "9", "+", "82", ",", "8", "@", "@", "public", "DomainProcessEngine", "getObject", "(", ")", "throws", "Exception", "{", "EngineConfigurationConstants", ".", "KEY_IDM_ENGINE_CONFIG", ",", "ctx", ".", "getBean", "(", "SpringIdmEngineConfiguration", ".", "class", ")", ");", "}", "List", "<", "AbstractFormType", ">", "customFormTypes", "=", "new", "ArrayList", "<", ">(", ");", "customFormTypes", ".", "add", "(", "new", "DropdownFormType", "(", "null", ")", ");", "conf", ".", "setCustomFormTypes", "(", "customFormTypes", ")", ";", "conf", ".", "setEnableSafeBpmnXml", "(", "true", ")", ";", "conf", ".", "setCustomFormTypes", "(", "Arrays", ".", "asList", "(", "new", "DropdownFormType", "(", "null", ")", "))", ";", "engines", ".", "put", "(", "domain", ",", "conf", ".", "buildProcessEngine", "(", "))", ";", "}"], "docstring_tokens": ["read", "or", "write", "arbitrary", "files", "or", "execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "12", ",", "6", "+", "12", ",", "10", "@", "@", "PHP", "NEWS", ".", "Fixed", "bug", "#", "70111", "(", "Segfault", "when", "a", "function", "uses", "both", "an", "explicit", "return", "type", "and", "an", "explicit", "cast", ")", ".", "(", "Laruence", ")", "-", "Standard", ":", ".", "Fixed", "bug", "#", "70140", "(", "str_ireplace", "/", "php_string_tolower", "-", "Arbitrary", "Code", "Execution", ")", ".", "(", "Laruence", ")", "23", "Jul", "2015", ",", "PHP", "7", ".", "0", ".", "0", "Beta", "2", "-", "Core", ":", "@", "@", "-", "4055", ",", "7", "+", "4055", ",", "7", "@", "@", "static", "zend_long", "php_str_replace_in_subject", "(", "zval", "*", "search", ",", "zval", "*", "replace", ",", "zval", "*", "s", "Z_STRVAL_P", "(", "search", ")", ",", "Z_STRLEN_P", "(", "search", ")", ",", "Z_STRVAL_P", "(", "replace", ")", ",", "Z_STRLEN_P", "(", "replace", ")", ",", "&", "replace_count", ")", ");", "}", "else", "{", "lc_subject_str", "=", "php_string_tolower", "(", "Z_STR_P", "(", "subject", ")", ");", "lc_subject_str", "=", "php_string_tolower", "(", "subject_str", ")", ";", "ZVAL_STR", "(", "result", ",", "php_str_to_str_i_ex", "(", "subject_str", ",", "ZSTR_VAL", "(", "lc_subject_str", ")", ",", "Z_STR_P", "(", "search", ")", ",", "Z_STRVAL_P", "(", "replace", ")", ",", "Z_STRLEN_P", "(", "replace", ")", ",", "&", "replace_count", ")", ");"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system", "or", "cause", "the", "application", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "332", ",", "7", "+", "332", ",", "7", "@", "@", "int", "EVP_EncryptUpdate", "(", "EVP_CIPHER_CTX", "*", "ctx", ",", "unsigned", "char", "*", "out", ",", "int", "*", "outl", ",", "bl", "=", "ctx", "-", ">", "cipher", "-", ">", "block_size", ";", "OPENSSL_assert", "(", "bl", "<", "=", "(", "int", ")", "sizeof", "(", "ctx", "-", ">", "buf", ")", ");", "if", "(", "i", "!", "=", "0", ")", "{", "if", "(", "i", "+", "inl", "<", "bl", ")", "{", "if", "(", "bl", "-", "i", ">", "inl", ")", "{", "memcpy", "(", "&(", "ctx", "-", ">", "buf", "[", "i", "]", "),", "in", ",", "inl", ")", ";", "ctx", "-", ">", "buf_len", "+", "=", "inl", ";", "*", "outl", "=", "0", ";"], "docstring_tokens": ["casuse", "allocation", "of", "large", "amounts", "of", "memory", "potentially", "consuming", "excessive", "resources", "or", "exhausting", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1033", ",", "20", "+", "1033", ",", "11", "@", "@", "public", "OAuth2Authentication", "loadAuthentication", "(", "String", "accessToken", ")", "throws", "Authen", "throw", "new", "InvalidTokenException", "(", "\"", "Invalid", "access", "token", "value", ",", "must", "be", "at", "least", "30", "characters", ":", "\"+", "accessToken", ")", ";", "}", "TokenValidation", "tokenValidation", "=", "validateToken", "(", "accessToken", ")", ";", "Map", "<", "String", ",", "Object", ">", "claims", "=", "tokenValidation", ".", "getClaims", "(", ");", "Object", "jtiClaim", "=", "claims", ".", "get", "(", "JTI", ")", ";", "TokenValidation", "tokenValidation", "=", "validateToken", "(", "accessToken", ")", ".", "checkAccessToken", "(", ")", ".", "throwIfInvalid", "(", ");", "if", "(", "jtiClaim", "=", "=", "null", ")", "{", "throw", "new", "InvalidTokenException", "(", "\"", "The", "token", "must", "contain", "a", "jti", "claim", ".", "\")", ";", "}", "else", "{", "if", "(", "jtiClaim", ".", "toString", "(", ").", "endsWith", "(", "REFRESH_TOKEN_SUFFIX", ")", ")", "{", "throw", "new", "InvalidTokenException", "(", "\"", "Invalid", "access", "token", "was", "provided", ".", "\"", ")", ";", "}", "}", "Map", "<", "String", ",", "Object", ">", "claims", "=", "tokenValidation", ".", "getClaims", "(", ");", "accessToken", "=", "tokenValidation", ".", "getJwt", "(", ").", "getEncoded", "(", ");", "@", "@", "-", "1110", ",", "7", "+", "1101", ",", "10", "@", "@", "public", "OAuth2Authentication", "loadAuthentication", "(", "String", "accessToken", ")", "throws", "Authen", "*", "/", "@", "Override", "public", "OAuth2AccessToken", "readAccessToken", "(", "String", "accessToken", ")", "{", "TokenValidation", "tokenValidation", "=", "validateToken", "(", "accessToken", ")", ";", "TokenValidation", "tokenValidation", "=", "validateToken", "(", "accessToken", ")", ".", "checkAccessToken", "(", ")", ".", "throwIfInvalid", "(", ");", "Map", "<", "String", ",", "Object", ">", "claims", "=", "tokenValidation", ".", "getClaims", "(", ");", "accessToken", "=", "tokenValidation", ".", "getJwt", "(", ").", "getEncoded", "(", ");", "@", "@", "-", "58", ",", "9", "+", "58", ",", "11", "@", "@", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "CLIENT_ID", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "EXP", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "ISS", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "JTI", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "REVOCATION_SIGNATURE", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "SCOPE", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "USER_ID", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "TokenConstants", ".", "REFRESH_TOKEN_SUFFIX", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "UaaTokenUtils", ".", "isUserToken", ";", "public", "class", "TokenValidation", "{", "@", "@", "-", "492", ",", "4", "+", "494", ",", "19", "@", "@", "public", "Jwt", "getJwt", "(", ")", "{", "public", "Map", "<", "String", ",", "Object", ">", "getClaims", "(", ")", "{", "return", "claims", ";", "}", "public", "TokenValidation", "checkAccessToken", "(", ")", "{", "Object", "jti", "=", "this", ".", "getClaims", "(", ").", "get", "(", "JTI", ")", ";", "if", "(", "jti", "=", "=", "null", ")", "{", "addError", "(", "\"", "The", "token", "must", "contain", "a", "jti", "claim", ".", "\")", ";", "return", "this", ";", "}", "if", "(", "jti", ".", "toString", "(", ").", "endsWith", "(", "REFRESH_TOKEN_SUFFIX", ")", ")", "{", "addError", "(", "\"", "Invalid", "access", "token", ".", "\")", ";", "}", "return", "this", ";", "}", "}", "@", "@", "-", "1667", ",", "6", "+", "1667", ",", "54", "@", "@", "public", "void", "testReadAccessToken_No_PII", "(", ")", "{", "readAccessToken", "(", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "ClaimConstants", ".", "EMAIL", ",", "ClaimConstants", ".", "USER_NAME", ")", "))", ";", "}", "@", "Test", "public", "void", "testReadAccessToken_When_Given_Refresh_token_should_throw_exception", "(", ")", "{", "tokenServices", ".", "setExcludedClaims", "(", "new", "HashSet", "<", ">(", "Arrays", ".", "asList", "(", "ClaimConstants", ".", "EMAIL", ",", "ClaimConstants", ".", "USER_NAME", ")", "))", ";", "AuthorizationRequest", "authorizationRequest", "=", "new", "AuthorizationRequest", "(", "CLIENT_ID", ",", "tokenSupport", ".", "requestedAuthScopes", ")", ";", "authorizationRequest", ".", "setResourceIds", "(", "new", "HashSet", "<", ">(", "tokenSupport", ".", "resourceIds", ")", ");", "Map", "<", "String", ",", "String", ">", "azParameters", "=", "new", "HashMap", "<", ">(", "authorizationRequest", ".", "getRequestParameters", "(", "))", ";", "azParameters", ".", "put", "(", "GRANT_TYPE", ",", "AUTHORIZATION_CODE", ")", ";", "authorizationRequest", ".", "setRequestParameters", "(", "azParameters", ")", ";", "Authentication", "userAuthentication", "=", "tokenSupport", ".", "defaultUserAuthentication", ";", "Calendar", "expiresAt1", "=", "Calendar", ".", "getInstance", "(", ");", "expiresAt1", ".", "add", "(", "Calendar", ".", "MILLISECOND", ",", "3000", ")", ";", "Calendar", "updatedAt1", "=", "Calendar", ".", "getInstance", "(", ");", "updatedAt1", ".", "add", "(", "Calendar", ".", "MILLISECOND", ",", "-", "1000", ")", ";", "tokenSupport", ".", "approvalStore", ".", "addApproval", "(", "new", "Approval", "(", ")", ".", "setUserId", "(", "tokenSupport", ".", "userId", ")", ".", "setClientId", "(", "CLIENT_ID", ")", ".", "setScope", "(", "tokenSupport", ".", "readScope", ".", "get", "(", "0", ")", ")", ".", "setExpiresAt", "(", "expiresAt1", ".", "getTime", "(", "))", ".", "setStatus", "(", "ApprovalStatus", ".", "APPROVED", ")", ".", "setLastUpdatedAt", "(", "updatedAt1", ".", "getTime", "(", "))", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "tokenSupport", ".", "approvalStore", ".", "addApproval", "(", "new", "Approval", "(", ")", ".", "setUserId", "(", "tokenSupport", ".", "userId", ")", ".", "setClientId", "(", "CLIENT_ID", ")", ".", "setScope", "(", "tokenSupport", ".", "writeScope", ".", "get", "(", "0", ")", ")", ".", "setExpiresAt", "(", "expiresAt1", ".", "getTime", "(", "))", ".", "setStatus", "(", "ApprovalStatus", ".", "APPROVED", ")", ".", "setLastUpdatedAt", "(", "updatedAt1", ".", "getTime", "(", "))", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "Approval", "approval", "=", "new", "Approval", "(", ")", ".", "setUserId", "(", "tokenSupport", ".", "userId", ")", ".", "setClientId", "(", "CLIENT_ID", ")", ".", "setScope", "(", "OPENID", ")", ".", "setExpiresAt", "(", "expiresAt1", ".", "getTime", "(", "))", ".", "setStatus", "(", "ApprovalStatus", ".", "APPROVED", ")", ".", "setLastUpdatedAt", "(", "updatedAt1", ".", "getTime", "(", "))", ";", "tokenSupport", ".", "approvalStore", ".", "addApproval", "(", "approval", ",", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ";", "OAuth2Authentication", "authentication", "=", "new", "OAuth2Authentication", "(", "authorizationRequest", ".", "createOAuth2Request", "(", "),", "userAuthentication", ")", ";", "OAuth2AccessToken", "accessToken", "=", "tokenServices", ".", "createAccessToken", "(", "authentication", ")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", ".", "\")", ";", "tokenServices", ".", "readAccessToken", "(", "accessToken", ".", "getRefreshToken", "(", ").", "getValue", "(", "))", ";", "}", "public", "void", "readAccessToken", "(", "Set", "<", "String", ">", "excludedClaims", ")", "{", "tokenServices", ".", "setExcludedClaims", "(", "excludedClaims", ")", ";", "AuthorizationRequest", "authorizationRequest", "=", "new", "AuthorizationRequest", "(", "CLIENT_ID", ",", "tokenSupport", ".", "requestedAuthScopes", ")", ";", "@", "@", "-", "1907", ",", "7", "+", "1955", ",", "7", "@", "@", "public", "void", "loadAuthentication_when_given_an_opaque_refreshToken_should_throw_ex", "String", "refreshTokenValue", "=", "tokenProvisioning", ".", "retrieve", "(", "compositeToken", ".", "getRefreshToken", "(", ").", "getValue", "(", "),", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ".", "getValue", "(", ");", "expectedException", ".", "expect", "(", "InvalidTokenException", ".", "class", ")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", "was", "provided", ".", "\")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", ".", "\")", ";", "tokenServices", ".", "loadAuthentication", "(", "refreshTokenValue", ")", ";", "}", "@", "@", "-", "1937", ",", "7", "+", "1985", ",", "7", "@", "@", "public", "void", "loadAuthentication_when_given_an_refresh_jwt_should_throw_exception", "(", "String", "refreshTokenValue", "=", "tokenProvisioning", ".", "retrieve", "(", "refreshToken", ".", "getClaims", "(", ").", "get", "(", "\"", "jti", "\"", ").", "toString", "(", "),", "IdentityZoneHolder", ".", "get", "(", ").", "getId", "(", "))", ".", "getValue", "(", ");", "expectedException", ".", "expect", "(", "InvalidTokenException", ".", "class", ")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", "was", "provided", ".", "\")", ";", "expectedException", ".", "expectMessage", "(", "\"", "Invalid", "access", "token", ".", "\")", ";", "tokenServices", ".", "loadAuthentication", "(", "refreshTokenValue", ")", ";", "}", "@", "@", "-", "20", ",", "6", "+", "20", ",", "7", "@", "@", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUser", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "user", ".", "UaaUserDatabase", ";", "import", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "zone", ".", "IdentityZoneHolder", ";", "import", "org", ".", "hamcrest", ".", "CoreMatchers", ";", "import", "org", ".", "junit", ".", "Before", ";", "import", "org", ".", "junit", ".", "Rule", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "46", ",", "13", "+", "47", ",", "19", "@", "@", "import", "static", "java", ".", "util", ".", "Collections", ".", "EMPTY_LIST", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "client", ".", "ClientConstants", ".", "REQUIRED_USER_GROUPS", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "EMAIL", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "JTI", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "oauth", ".", "token", ".", "ClaimConstants", ".", "USER_NAME", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "TokenValidation", ".", "validate", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "UaaMapUtils", ".", "entry", ";", "import", "static", "org", ".", "cloudfoundry", ".", "identity", ".", "uaa", ".", "util", ".", "UaaMapUtils", ".", "map", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "equalTo", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "hasItems", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "is", ";", "import", "static", "org", ".", "hamcrest", ".", "CoreMatchers", ".", "not", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "containsInAnyOrder", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "empty", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasItem", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "hasSize", ";", "import", "static", "org", ".", "hamcrest", ".", "Matchers", ".", "instanceOf", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertThat", ";", "@", "@", "-", "210", ",", "12", "+", "217", ",", "53", "@", "@", "public", "void", "validateToken", "(", ")", "throws", "Exception", "{", ".", "checkRevocationSignature", "(", "Collections", ".", "singletonList", "(", "\"", "fa1c787d", "\"", "))", ".", "checkAudience", "(", "\"", "acme", "\"", ",", "\"", "app", "\"", ")", ".", "checkRevocableTokenStore", "(", "revocableTokenProvisioning", ")", ".", "checkAccessToken", "(", ")", ";", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "empty", "(", "))", ";", "assertTrue", "(", "validation", ".", "isValid", "(", "))", ";", "}", "@", "Test", "public", "void", "validateAccessToken", "(", ")", "throws", "Exception", "{", "content", ".", "put", "(", "JTI", ",", "\"", "8b14f193", "-", "8212", "-", "4af2", "-", "9927", "-", "e3ae903f94a6", "-", "r", "\"", ");", "TokenValidation", "validation", "=", "validate", "(", "getToken", "(", "))", ".", "checkAccessToken", "(", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "not", "(", "empty", "(", "))", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "hasSize", "(", "1", ")", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", ").", "get", "(", "0", ")", ",", "instanceOf", "(", "InvalidTokenException", ".", "class", ")", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", ").", "get", "(", "0", ")", ".", "getMessage", "(", "),", "is", "(", "\"", "Invalid", "access", "token", ".", "\")", ");", "assertThat", "(", "validation", ".", "isValid", "(", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "validateAccessToken_with_dashR_in_JTI_should_fail_validation", "(", ")", "throws", "Exception", "{", "content", ".", "put", "(", "JTI", ",", "\"", "8b14f193", "-", "r", "-", "8212", "-", "4af2", "-", "9927", "-", "e3ae903f94a6", "\"", ");", "TokenValidation", "validation", "=", "validate", "(", "getToken", "(", "))", ".", "checkAccessToken", "(", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "empty", "(", "))", ";", "assertThat", "(", "validation", ".", "isValid", "(", "),", "is", "(", "true", ")", ");", "}", "@", "Test", "public", "void", "validateAccessToken_without_jti_should_fail_validation", "(", ")", "throws", "Exception", "{", "content", ".", "put", "(", "JTI", ",", "null", ")", ";", "TokenValidation", "validation", "=", "validate", "(", "getToken", "(", "))", ".", "checkAccessToken", "(", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", "),", "hasSize", "(", "1", ")", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", ").", "get", "(", "0", ")", ",", "instanceOf", "(", "InvalidTokenException", ".", "class", ")", ");", "assertThat", "(", "validation", ".", "getValidationErrors", "(", ").", "get", "(", "0", ")", ".", "getMessage", "(", "),", "is", "(", "\"", "The", "token", "must", "contain", "a", "jti", "claim", ".", "\")", ");", "assertThat", "(", "validation", ".", "isValid", "(", "),", "is", "(", "false", ")", ");", "}", "@", "Test", "public", "void", "validateToken_Without_Email_And_Username", "(", ")", "throws", "Exception", "{", "TokenValidation", "validation", "=", "validate", "(", "getToken", "(", "Arrays", ".", "asList", "(", "EMAIL", ",", "USER_NAME", ")", "))"], "docstring_tokens": ["bypass", "access", "restrictions"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "212", ",", "9", "+", "212", ",", "21", "@", "@", "private", "boolean", "isIdentityRemoved", "(", "WebSubjectContext", "subjectContext", ")", "{", "if", "(", "log", ".", "isTraceEnabled", "(", "))", "{", "log", ".", "trace", "(", "\"", "Acquired", "Base64", "encoded", "identity", "[", "\"", "+", "base64", "+", "\"", "]\"", ");", "}", "byte", "[", "]", "decoded", "=", "Base64", ".", "decode", "(", "base64", ")", ";", "byte", "[", "]", "decoded", ";", "try", "{", "decoded", "=", "Base64", ".", "decode", "(", "base64", ")", ";", "}", "catch", "(", "RuntimeException", "rtEx", ")", "{", "/", "*", "*", "https", ":", "//", "issues", ".", "apache", ".", "org", "/", "jira", "/", "browse", "/", "SHIRO", "-", "766", ":", "*", "If", "the", "base64", "string", "cannot", "be", "decoded", ",", "just", "assume", "there", "is", "no", "valid", "cookie", "value", ".", "*", "*", "/", "getCookie", "(", ").", "removeFrom", "(", "request", ",", "response", ")", ";", "log", ".", "warn", "(", "\"", "Unable", "to", "decode", "existing", "base64", "encoded", "entity", ":", "[", "\"", "+", "base64", "+", "\"", "].", "\",", "rtEx", ")", ";", "return", "null", ";", "}", "if", "(", "log", ".", "isTraceEnabled", "(", "))", "{", "log", ".", "trace", "(", "\"", "Base64", "decoded", "byte", "array", "length", ":", "\"", "+", "(", "decoded", "!", "=", "null", "?", "decoded", ".", "length", ":", "0", ")", "+", "\"", "bytes", ".", "\")", ";", "log", ".", "trace", "(", "\"", "Base64", "decoded", "byte", "array", "length", ":", "\"", "+", "decoded", ".", "length", "+", "\"", "bytes", ".", "\")", ";", "}", "return", "decoded", ";", "}", "else", "{", "@", "@", "-", "35", ",", "6", "+", "35", ",", "8", "@", "@", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletRequest", ";", "import", "javax", ".", "servlet", ".", "http", ".", "HttpServletResponse", ";", "import", "java", ".", "util", ".", "UUID", ";", "import", "static", "org", ".", "easymock", ".", "EasyMock", ".", "*;", "import", "static", "org", ".", "junit", ".", "Assert", ".", "*;", "@", "@", "-", "244", ",", "4", "+", "246", ",", "30", "@", "@", "public", "void", "onLogout", "(", ")", "{", "verify", "(", "mockResponse", ")", ";", "verify", "(", "cookie", ")", ";", "}", "@", "Test", "public", "void", "shouldIgnoreInvalidCookieValues", "(", ")", "{", "/", "/", "given", "HttpServletRequest", "mockRequest", "=", "createMock", "(", "HttpServletRequest", ".", "class", ")", ";", "HttpServletResponse", "mockResponse", "=", "createMock", "(", "HttpServletResponse", ".", "class", ")", ";", "WebSubjectContext", "context", "=", "new", "DefaultWebSubjectContext", "(", ");", "context", ".", "setServletRequest", "(", "mockRequest", ")", ";", "context", ".", "setServletResponse", "(", "mockResponse", ")", ";", "CookieRememberMeManager", "mgr", "=", "new", "CookieRememberMeManager", "(", ");", "Cookie", "[", "]", "cookies", "=", "new", "Cookie", "[", "]{", "new", "Cookie", "(", "CookieRememberMeManager", ".", "DEFAULT_REMEMBER_ME_COOKIE_NAME", ",", "UUID", ".", "randomUUID", "(", ").", "toString", "(", ")", "+", "\"", "%%", "ldapRealm", "\"", ")", "}", ";", "expect", "(", "mockRequest", ".", "getAttribute", "(", "ShiroHttpServletRequest", ".", "IDENTITY_REMOVED_KEY", ")", ").", "andReturn", "(", "null", ")", ";", "expect", "(", "mockRequest", ".", "getContextPath", "(", "))", ".", "andReturn", "(", "null", ")", ";", "expect", "(", "mockRequest", ".", "getCookies", "(", "))", ".", "andReturn", "(", "cookies", ")", ";", "replay", "(", "mockRequest", ")", ";", "/", "/", "when", "final", "byte", "[", "]", "rememberedSerializedIdentity", "=", "mgr", ".", "getRememberedSerializedIdentity", "(", "context", ")", ";", "/", "/", "then", "assertNull", "(", "\"", "should", "ignore", "invalid", "cookie", "values", "\"", ",", "rememberedSerializedIdentity", ")", ";", "}", "}"], "docstring_tokens": ["bypass", "access", "restrictions"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "21", ",", "6", "+", "21", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "Processor", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "http", ".", "HttpConstants", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "http", ".", "HttpOperationFailedException", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "jetty", ".", "BaseJettyTest", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "http", ".", "HttpComponent", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "jetty", ".", "BaseJettyTest", ";"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "33", ",", "8", "+", "33", ",", "8", "@", "@", "<", "properties", ">", "<", "!-", "-", "Name", "to", "display", "by", "the", "Extension", "Manager", "-", "->", "<", "xwiki", ".", "extension", ".", "name", ">", "Dashboard", "Macro", "<", "/", "xwiki", ".", "extension", ".", "name", ">", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "54", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "22", "<", "/", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "71", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "41", "<", "/", "xwiki", ".", "pitest", ".", "mutationThreshold", ">", "<", "!-", "-", "TODO", ":", "Remove", "once", "the", "tests", "have", "been", "fixed", "to", "not", "output", "anything", "to", "the", "console", "!", "-", "->", "<", "xwiki", ".", "surefire", ".", "captureconsole", ".", "skip", ">", "true", "<", "/", "xwiki", ".", "surefire", ".", "captureconsole", ".", "skip", ">", "<", "/", "properties", ">", "@", "@", "-", "54", ",", "6", "+", "54", ",", "7", "@", "@", "import", "org", ".", "xwiki", ".", "rendering", ".", "syntax", ".", "Syntax", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "MacroTransformationContext", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "util", ".", "ParserUtils", ";", "import", "org", ".", "xwiki", ".", "security", ".", "authorization", ".", "AuthorExecutor", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityEngine", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityManager", ";", "@", "@", "-", "76", ",", "7", "+", "77", ",", "7", "@", "@", "*", "The", "reference", "to", "the", "gadgets", "class", ",", "relative", "to", "the", "current", "wiki", ".", "<", "br", ">", "*", "TODO", ":", "to", "make", "sure", "that", "this", "class", "exists", "before", "trying", "to", "read", "objects", "of", "this", "type", ".", "*", "/", "private", "static", "final", "EntityReference", "GADGET_CLASS", "=", "protected", "static", "final", "EntityReference", "GADGET_CLASS", "=", "new", "EntityReference", "(", "\"", "GadgetClass", "\"", ",", "EntityType", ".", "DOCUMENT", ",", "new", "EntityReference", "(", "\"", "XWiki", "\"", ",", "EntityType", ".", "SPACE", ")", ");", "/", "**", "@", "@", "-", "104", ",", "6", "+", "105", ",", "9", "@", "@", "@", "Named", "(", "\"", "local", "\"", ")", "private", "EntityReferenceSerializer", "<", "String", ">", "localReferenceSerializer", ";", "@", "Inject", "private", "AuthorExecutor", "authorExecutor", ";", "/", "**", "*", "Used", "to", "get", "the", "Velocity", "Engine", "and", "Velocity", "Context", "to", "use", "to", "evaluate", "the", "titles", "of", "the", "gadgets", ".", "*", "/", "@", "@", "-", "137", ",", "7", "+", "141", ",", "7", "@", "@", "DocumentReference", "gadgetsClass", "=", "currentReferenceEntityResolver", ".", "resolve", "(", "GADGET_CLASS", ")", ";", "List", "<", "BaseObject", ">", "gadgetObjects", "=", "sourceDoc", ".", "getXObjects", "(", "gadgetsClass", ")", ";", "if", "(", "gadgetObjects", "=", "=", "null", ")", "{", "if", "(", "gadgetObjects", "=", "=", "null", "|", "|", "gadgetObjects", ".", "isEmpty", "(", "))", "{", "return", "new", "ArrayList", "<", ">(", ");", "}", "@", "@", "-", "198", ",", "9", "+", "202", ",", "11", "@", "@", "/", "/", "parse", "both", "the", "title", "and", "content", "in", "the", "syntax", "of", "the", "transformation", "context", "List", "<", "Block", ">", "titleBlocks", "=", "renderGadgetProperty", "(", "gadgetTitle", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "context", ")", ";", "renderGadgetProperty", "(", "gadgetTitle", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "xObject", ".", "getOwnerDocument", "(", "),", "context", ")", ";", "List", "<", "Block", ">", "contentBlocks", "=", "renderGadgetProperty", "(", "content", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "context", ")", ";", "renderGadgetProperty", "(", "content", ",", "sourceSyntax", ",", "xObject", ".", "getDocumentReference", "(", "),", "xObject", ".", "getOwnerDocument", "(", "),", "context", ")", ";", "/", "/", "create", "a", "gadget", "will", "all", "these", "and", "add", "the", "gadget", "to", "the", "container", "of", "gadgets", "Gadget", "gadget", "=", "new", "Gadget", "(", "id", ",", "titleBlocks", ",", "contentBlocks", ",", "position", ")", ";", "@", "@", "-", "217", ",", "12", "+", "223", ",", "16", "@", "@", "}", "private", "List", "<", "Block", ">", "renderGadgetProperty", "(", "String", "content", ",", "Syntax", "sourceSyntax", ",", "EntityReference", "sourceReference", ",", "MacroTransformationContext", "context", ")", "throws", "MissingParserException", ",", "ParseException", ",", "ContentExecutorException", "XWikiDocument", "ownerDocument", ",", "MacroTransformationContext", "context", ")", "throws", "Exception", "{", "XDOM", "xdom", "=", "this", ".", "contentExecutor", ".", "execute", "(", "content", ",", "sourceSyntax", ",", "sourceReference", ",", "context", ")", ";", "List", "<", "Block", ">", "xdomBlocks", "=", "xdom", ".", "getChildren", "(", ");", "this", ".", "parserUtils", ".", "removeTopLevelParagraph", "(", "xdomBlocks", ")", ";", "return", "xdomBlocks", ";", "/", "/", "Ensure", "that", "the", "gadgets", "are", "executed", "with", "the", "proper", "rights", ".", "return", "authorExecutor", ".", "call", "(", "()", "-", ">", "{", "XDOM", "xdom", "=", "this", ".", "contentExecutor", ".", "execute", "(", "content", ",", "sourceSyntax", ",", "sourceReference", ",", "context", ")", ";", "List", "<", "Block", ">", "xdomBlocks", "=", "xdom", ".", "getChildren", "(", ");", "this", ".", "parserUtils", ".", "removeTopLevelParagraph", "(", "xdomBlocks", ")", ";", "return", "xdomBlocks", ";", "}", ",", "ownerDocument", ".", "getAuthorReference", "(", "),", "ownerDocument", ".", "getDocumentReference", "(", "))", ";", "}", "/", "**", "@", "@", "-", "0", ",", "0", "+", "1", ",", "192", "@", "@", "/", "*", "*", "See", "the", "NOTICE", "file", "distributed", "with", "this", "work", "for", "additional", "*", "information", "regarding", "copyright", "ownership", ".", "*", "*", "This", "is", "free", "software", ";", "you", "can", "redistribute", "it", "and", "/", "or", "modify", "it", "*", "under", "the", "terms", "of", "the", "GNU", "Lesser", "General", "Public", "License", "as", "*", "published", "by", "the", "Free", "Software", "Foundation", ";", "either", "version", "2", ".", "1", "of", "*", "the", "License", ",", "or", "(", "at", "your", "option", ")", "any", "later", "version", ".", "*", "*", "This", "software", "is", "distributed", "in", "the", "hope", "that", "it", "will", "be", "useful", ",", "*", "but", "WITHOUT", "ANY", "WARRANTY", ";", "without", "even", "the", "implied", "warranty", "of", "*", "MERCHANTABILITY", "or", "FITNESS", "FOR", "A", "PARTICULAR", "PURPOSE", ".", "See", "the", "GNU", "*", "Lesser", "General", "Public", "License", "for", "more", "details", ".", "*", "*", "You", "should", "have", "received", "a", "copy", "of", "the", "GNU", "Lesser", "General", "Public", "*", "License", "along", "with", "this", "software", ";", "if", "not", ",", "write", "to", "the", "Free", "*", "Software", "Foundation", ",", "Inc", ".", ",", "51", "Franklin", "St", ",", "Fifth", "Floor", ",", "Boston", ",", "MA", "*", "02110", "-", "1301", "USA", ",", "or", "see", "the", "FSF", "site", ":", "http", ":", "//", "www", ".", "fsf", ".", "org", ".", "*", "/", "package", "org", ".", "xwiki", ".", "rendering", ".", "internal", ".", "macro", ".", "dashboard", ";", "import", "java", ".", "io", ".", "StringWriter", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "Callable", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "BeforeEach", ";", "import", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Test", ";", "import", "org", ".", "mockito", ".", "Mock", ";", "import", "org", ".", "mockito", ".", "invocation", ".", "InvocationOnMock", ";", "import", "org", ".", "mockito", ".", "stubbing", ".", "Answer", ";", "import", "org", ".", "xwiki", ".", "component", ".", "manager", ".", "ComponentLookupException", ";", "import", "org", ".", "xwiki", ".", "context", ".", "Execution", ";", "import", "org", ".", "xwiki", ".", "context", ".", "ExecutionContext", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "DocumentReference", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "DocumentReferenceResolver", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "EntityReference", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "block", ".", "WordBlock", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "block", ".", "XDOM", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "executor", ".", "ContentExecutor", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "macro", ".", "dashboard", ".", "Gadget", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "MacroTransformationContext", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "TransformationContext", ";", "import", "org", ".", "xwiki", ".", "security", ".", "authorization", ".", "AuthorExecutor", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "ComponentTest", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "InjectMockComponents", ";", "import", "org", ".", "xwiki", ".", "test", ".", "junit5", ".", "mockito", ".", "MockComponent", ";", "import", "org", ".", "xwiki", ".", "test", ".", "mockito", ".", "MockitoComponentManager", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityEngine", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "VelocityManager", ";", "import", "org", ".", "xwiki", ".", "velocity", ".", "XWikiVelocityException", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWiki", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWikiContext", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "XWikiException", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "doc", ".", "XWikiDocument", ";", "import", "com", ".", "xpn", ".", "xwiki", ".", "objects", ".", "BaseObject", ";", "import", "static", "org", ".", "junit", ".", "jupiter", ".", "api", ".", "Assertions", ".", "assertEquals", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "any", ";", "import", "static", "org", ".", "mockito", ".", "ArgumentMatchers", ".", "eq", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "mock", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "verify", ";", "import", "static", "org", ".", "mockito", ".", "Mockito", ".", "when", ";", "@", "ComponentTest", "public", "class", "DefaultGadgetSourceTest", "{", "@", "InjectMockComponents", "private", "DefaultGadgetSource", "defaultGadgetSource", ";", "private", "static", "final", "String", "testSource", "=", "\"", "XWiki", ".", "Test", "\"", ";", "private", "static", "final", "String", "transformationId", "=", "\"", "fooId", "\"", ";", "@", "MockComponent", "private", "AuthorExecutor", "authorExecutor", ";", "@", "Mock", "private", "DocumentReference", "documentReference", ";", "@", "Mock", "private", "XWikiDocument", "xWikiDocument", ";", "@", "Mock", "private", "XWikiDocument", "ownerDocument", ";", "@", "Mock", "private", "DocumentReference", "ownerAuthorReference", ";", "@", "Mock", "private", "DocumentReference", "ownerSourceReference", ";", "@", "Mock", "private", "XWiki", "xwiki", ";", "@", "Mock", "private", "XWikiContext", "xWikiContext", ";", "@", "Mock", "private", "DocumentReference", "gadgetClassReference", ";", "@", "Mock", "private", "MacroTransformationContext", "macroTransformationContext", ";", "@", "BeforeEach", "public", "void", "setup", "(", "MockitoComponentManager", "componentManager", ")", "throws", "Exception", "{", "DocumentReferenceResolver", "<", "String", ">", "currentReferenceResolver", "=", "componentManager", ".", "getInstance", "(", "DocumentReferenceResolver", ".", "TYPE_STRING", ",", "\"", "current", "\"", ");", "when", "(", "currentReferenceResolver", ".", "resolve", "(", "testSource", ")", ").", "thenReturn", "(", "documentReference", ")", ";", "Execution", "execution", "=", "componentManager", ".", "getInstance", "(", "Execution", ".", "class", ")", ";", "ExecutionContext", "executionContext", "=", "mock", "(", "ExecutionContext", ".", "class", ")", ";", "when", "(", "execution", ".", "getContext", "(", "))", ".", "thenReturn", "(", "executionContext", ")", ";", "when", "(", "executionContext", ".", "getProperty", "(", "\"", "xwikicontext", "\"", "))", ".", "thenReturn", "(", "xWikiContext", ")", ";", "when", "(", "xWikiContext", ".", "getWiki", "(", "))", ".", "thenReturn", "(", "xwiki", ")", ";", "when", "(", "xwiki", ".", "getDocument", "(", "documentReference", ",", "xWikiContext", ")", ").", "thenReturn", "(", "xWikiDocument", ")", ";", "DocumentReferenceResolver", "<", "EntityReference", ">", "currentReferenceEntityResolver", "=", "componentManager", ".", "getInstance", "(", "DocumentReferenceResolver", ".", "TYPE_REFERENCE", ",", "\"", "current", "\"", ");", "when", "(", "currentReferenceEntityResolver", ".", "resolve", "(", "DefaultGadgetSource", ".", "GADGET_CLASS", ")", ").", "thenReturn", "(", "gadgetClassReference", ")", ";", "TransformationContext", "transformationContext", "=", "mock", "(", "TransformationContext", ".", "class", ")", ";", "when", "(", "macroTransformationContext", ".", "getTransformationContext", "(", "))", ".", "thenReturn", "(", "transformationContext", ")", ";", "when", "(", "transformationContext", ".", "getId", "(", "))", ".", "thenReturn", "(", "transformationId", ")", ";", "VelocityManager", "velocityManager", "=", "componentManager", ".", "getInstance", "(", "VelocityManager", ".", "class", ")", ";", "VelocityEngine", "velocityEngine", "=", "mock", "(", "VelocityEngine", ".", "class", ")", ";", "when", "(", "velocityManager", ".", "getVelocityEngine", "(", "))", ".", "thenReturn", "(", "velocityEngine", ")", ";", "when", "(", "velocityEngine", ".", "evaluate", "(", "any", "(", "),", "any", "(", "),", "any", "(", "),", "any", "(", "String", ".", "class", ")", "))", ".", "then", "(", "new", "Answer", "<", "Void", ">", "()", "{", "@", "Override", "public", "Void", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "Object", "[", "]", "args", "=", "invocation", ".", "getArguments", "(", ");", "StringWriter", "stringWriter", "=", "(", "StringWriter", ")", "args", "[", "1", "]", ";", "String", "title", "=", "(", "String", ")", "args", "[", "3", "]", ";", "stringWriter", ".", "append", "(", "title", ")", ";", "return", "null", ";", "}", "}", ");", "AuthorExecutor", "authorExecutor", "=", "componentManager", ".", "getInstance", "(", "AuthorExecutor", ".", "class", ")", ";", "when", "(", "authorExecutor", ".", "call", "(", "any", "(", "),", "eq", "(", "ownerAuthorReference", ")", ",", "eq", "(", "ownerSourceReference", ")", "))", ".", "then", "(", "new", "Answer", "<", "Object", ">", "()", "{", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocationOnMock", ")", "throws", "Throwable", "{", "Callable", "callable", "=", "(", "Callable", ")", "invocationOnMock", ".", "getArguments", "(", ")[", "0", "]", ";", "return", "callable", ".", "call", "(", ");", "}", "}", ");", "ContentExecutor", "<", "MacroTransformationContext", ">", "contentExecutor", "=", "componentManager", ".", "getInstance", "(", "ContentExecutor", ".", "TYPE_MACRO_TRANSFORMATION", ")", ";", "when", "(", "contentExecutor", ".", "execute", "(", "any", "(", "),", "any", "(", "),", "any", "(", "),", "any", "(", "))", ").", "then", "(", "new", "Answer", "<", "XDOM", ">", "()", "{", "@", "Override", "public", "XDOM", "answer", "(", "InvocationOnMock", "invocationOnMock", ")", "throws", "Throwable", "{", "String", "content", "=", "invocationOnMock", ".", "getArgument", "(", "0", ")", ";", "XDOM", "xdom", "=", "new", "XDOM", "(", "Collections", ".", "singletonList", "(", "new", "WordBlock", "(", "content", ")", "))", ";", "return", "xdom", ";", "}", "}", ");", "when", "(", "ownerDocument", ".", "getAuthorReference", "(", "))", ".", "thenReturn", "(", "ownerAuthorReference", ")", ";", "when", "(", "ownerDocument", ".", "getDocumentReference", "(", "))", ".", "thenReturn", "(", "ownerSourceReference", ")", ";", "}", "@", "Test", "public", "void", "getGadgets", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "new", "ArrayList", "<", ">(", "),", "this", ".", "defaultGadgetSource", ".", "getGadgets", "(", "testSource", ",", "macroTransformationContext", ")", ");", "BaseObject", "gadgetObject1", "=", "mock", "(", "BaseObject", ".", "class", ")", ";", "when", "(", "xWikiDocument", ".", "getXObjects", "(", "gadgetClassReference", ")", ").", "thenReturn", "(", "Collections", ".", "singletonList", "(", "gadgetObject1", ")", ");", "when", "(", "gadgetObject1", ".", "getOwnerDocument", "(", "))", ".", "thenReturn", "(", "ownerDocument", ")", ";", "when", "(", "gadgetObject1", ".", "getStringValue", "(", "\"", "title", "\"", "))", ".", "thenReturn", "(", "\"", "Gadget", "1", "\"", ");", "when", "(", "gadgetObject1", ".", "getLargeStringValue", "(", "\"", "content", "\"", "))", ".", "thenReturn", "(", "\"", "Some", "content", "\"", ");", "when", "(", "gadgetObject1", ".", "getStringValue", "(", "\"", "position", "\"", "))", ".", "thenReturn", "(", "\"", "0", "\"", ");", "when", "(", "gadgetObject1", ".", "getNumber", "(", "))", ".", "thenReturn", "(", "42", ")", ";", "List", "<", "Gadget", ">", "gadgets", "=", "this", ".", "defaultGadgetSource", ".", "getGadgets", "(", "testSource", ",", "macroTransformationContext", ")", ";", "assertEquals", "(", "1", ",", "gadgets", ".", "size", "(", "))", ";", "Gadget", "gadget", "=", "gadgets", ".", "get", "(", "0", ")", ";", "assertEquals", "(", "\"", "Gadget", "1", "\"", ",", "gadget", ".", "getTitle", "(", ").", "get", "(", "0", ")", ".", "toString", "(", "))", ";", "assertEquals", "(", "\"", "Some", "content", "\"", ",", "gadget", ".", "getContent", "(", ").", "get", "(", "0", ")", ".", "toString", "(", "))", ";", "assertEquals", "(", "\"", "42", "\"", ",", "gadget", ".", "getId", "(", "))", ";", "}", "}", "@", "@", "-", "32", ",", "7", "+", "32", ",", "7", "@", "@", "<", "packaging", ">", "jar", "<", "/", "packaging", ">", "<", "description", ">", "XWiki", "Platform", "-", "Rendering", "-", "Parser", "<", "/", "description", ">", "<", "properties", ">", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "92", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "0", ".", "83", "<", "/", "xwiki", ".", "jacoco", ".", "instructionRatio", ">", "<", "/", "properties", ">", "<", "dependencies", ">", "<", "dependency", ">", "@", "@", "-", "19", ",", "12", "+", "19", ",", "16", "@", "@", "*", "/", "package", "org", ".", "xwiki", ".", "rendering", ".", "executor", ";", "import", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ";", "import", "org", ".", "xwiki", ".", "component", ".", "annotation", ".", "Role", ";", "import", "org", ".", "xwiki", ".", "component", ".", "util", ".", "DefaultParameterizedType", ";", "import", "org", ".", "xwiki", ".", "model", ".", "reference", ".", "EntityReference", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "block", ".", "XDOM", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "parser", ".", "MissingParserException", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "parser", ".", "ParseException", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "syntax", ".", "Syntax", ";", "import", "org", ".", "xwiki", ".", "rendering", ".", "transformation", ".", "MacroTransformationContext", ";", "/", "**", "*", "Parse", "the", "passed", "content", "and", "execute", "it", ".", "@", "@", "-", "36", ",", "6", "+", "40", ",", "14", "@", "@", "@", "Role", "public", "interface", "ContentExecutor", "<", "T", ">", "{", "/", "**", "*", "Type", "instance", "for", "{", "@", "code", "ContentExecutor", "<", "MacroTransformationContext", ">", "}.", "*", "*", "@", "since", "12", ".", "0RC1", ",", "11", ".", "10", ".", "3", ",", "11", ".", "3", ".", "7", "*", "/", "ParameterizedType", "TYPE_MACRO_TRANSFORMATION", "=", "new", "DefaultParameterizedType", "(", "null", ",", "ContentExecutor", ".", "class", ",", "MacroTransformationContext", ".", "class", ")", ";", "/", "**", "*", "Parse", "and", "execute", "content", ".", "*"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "730", ",", "43", "+", "730", ",", "50", "@", "@", "size_t", "iov_iter_copy_from_user_atomic", "(", "struct", "page", "*", "page", ",", "}", "EXPORT_SYMBOL", "(", "iov_iter_copy_from_user_atomic", ")", ";", "static", "inline", "void", "pipe_truncate", "(", "struct", "iov_iter", "*", "i", ")", "{", "struct", "pipe_inode_info", "*", "pipe", "=", "i", "-", ">", "pipe", ";", "if", "(", "pipe", "-", ">", "nrbufs", ")", "{", "size_t", "off", "=", "i", "-", ">", "iov_offset", ";", "int", "idx", "=", "i", "-", ">", "idx", ";", "int", "nrbufs", "=", "(", "idx", "-", "pipe", "-", ">", "curbuf", ")", "&", "(", "pipe", "-", ">", "buffers", "-", "1", ")", ";", "if", "(", "off", ")", "{", "pipe", "-", ">", "bufs", "[", "idx", "]", ".", "len", "=", "off", "-", "pipe", "-", ">", "bufs", "[", "idx", "]", ".", "offset", ";", "idx", "=", "next_idx", "(", "idx", ",", "pipe", ")", ";", "nrbufs", "+", "+;", "}", "while", "(", "pipe", "-", ">", "nrbufs", ">", "nrbufs", ")", "{", "pipe_buf_release", "(", "pipe", ",", "&", "pipe", "-", ">", "bufs", "[", "idx", "]", ");", "idx", "=", "next_idx", "(", "idx", ",", "pipe", ")", ";", "pipe", "-", ">", "nrbufs", "-", "-;", "}", "}", "}", "static", "void", "pipe_advance", "(", "struct", "iov_iter", "*", "i", ",", "size_t", "size", ")", "{", "struct", "pipe_inode_info", "*", "pipe", "=", "i", "-", ">", "pipe", ";", "struct", "pipe_buffer", "*", "buf", ";", "int", "idx", "=", "i", "-", ">", "idx", ";", "size_t", "off", "=", "i", "-", ">", "iov_offset", ",", "orig_sz", ";", "if", "(", "unlikely", "(", "i", "-", ">", "count", "<", "size", ")", ")", "size", "=", "i", "-", ">", "count", ";", "orig_sz", "=", "size", ";", "if", "(", "size", ")", "{", "struct", "pipe_buffer", "*", "buf", ";", "size_t", "off", "=", "i", "-", ">", "iov_offset", ",", "left", "=", "size", ";", "int", "idx", "=", "i", "-", ">", "idx", ";", "if", "(", "off", ")", "/", "*", "make", "it", "relative", "to", "the", "beginning", "of", "buffer", "*", "/", "size", "+", "=", "off", "-", "pipe", "-", ">", "bufs", "[", "idx", "]", ".", "offset", ";", "left", "+", "=", "off", "-", "pipe", "-", ">", "bufs", "[", "idx", "]", ".", "offset", ";", "while", "(", "1", ")", "{", "buf", "=", "&", "pipe", "-", ">", "bufs", "[", "idx", "]", ";", "if", "(", "size", "<", "=", "buf", "-", ">", "len", ")", "if", "(", "left", "<", "=", "buf", "-", ">", "len", ")", "break", ";", "size", "-", "=", "buf", "-", ">", "len", ";", "left", "-", "=", "buf", "-", ">", "len", ";", "idx", "=", "next_idx", "(", "idx", ",", "pipe", ")", ";", "}", "buf", "-", ">", "len", "=", "size", ";", "i", "-", ">", "idx", "=", "idx", ";", "off", "=", "i", "-", ">", "iov_offset", "=", "buf", "-", ">", "offset", "+", "size", ";", "}", "if", "(", "off", ")", "idx", "=", "next_idx", "(", "idx", ",", "pipe", ")", ";", "if", "(", "pipe", "-", ">", "nrbufs", ")", "{", "int", "unused", "=", "(", "pipe", "-", ">", "curbuf", "+", "pipe", "-", ">", "nrbufs", ")", "&", "(", "pipe", "-", ">", "buffers", "-", "1", ")", ";", "/", "*", "[", "curbuf", ",", "unused", ")", "is", "in", "use", ".", "Free", "[", "idx", ",", "unused", ")", "*", "/", "while", "(", "idx", "!", "=", "unused", ")", "{", "pipe_buf_release", "(", "pipe", ",", "&", "pipe", "-", ">", "bufs", "[", "idx", "]", ");", "idx", "=", "next_idx", "(", "idx", ",", "pipe", ")", ";", "pipe", "-", ">", "nrbufs", "-", "-;", "}", "i", "-", ">", "iov_offset", "=", "buf", "-", ">", "offset", "+", "left", ";", "}", "i", "-", ">", "count", "-", "=", "orig_sz", ";", "i", "-", ">", "count", "-", "=", "size", ";", "/", "*", ".", "..", "and", "discard", "everything", "past", "that", "point", "*", "/", "pipe_truncate", "(", "i", ")", ";", "}", "void", "iov_iter_advance", "(", "struct", "iov_iter", "*", "i", ",", "size_t", "size", ")", "@", "@", "-", "826", ",", "6", "+", "833", ",", "7", "@", "@", "void", "iov_iter_pipe", "(", "struct", "iov_iter", "*", "i", ",", "int", "direction", ",", "size_t", "count", ")", "{", "BUG_ON", "(", "direction", "!", "=", "ITER_PIPE", ")", ";", "WARN_ON", "(", "pipe", "-", ">", "nrbufs", "=", "=", "pipe", "-", ">", "buffers", ")", ";", "i", "-", ">", "type", "=", "direction", ";", "i", "-", ">", "pipe", "=", "pipe", ";", "i", "-", ">", "idx", "=", "(", "pipe", "-", ">", "curbuf", "+", "pipe", "-", ">", "nrbufs", ")", "&", "(", "pipe", "-", ">", "buffers", "-", "1", ")", ";"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "uninitialized", "heap-memory", "locations", "in", "opportunistic", "circumstances"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "277", ",", "7", "+", "277", ",", "7", "@", "@", "static", "int", "dvb_ca_ioctl", "(", "struct", "file", "*", "file", ",", "unsigned", "int", "cmd", ",", "void", "*", "parg", ")", "{", "ca_slot_info_t", "*", "info", "=", "(", "ca_slot_info_t", "*", ")", "parg", ";", "if", "(", "info", "-", ">", "num", ">", "1", ")", "if", "(", "info", "-", ">", "num", "<", "0", "|", "|", "info", "-", ">", "num", ">", "1", ")", "return", "-", "EINVAL", ";", "av7110", "-", ">", "ci_slot", "[", "info", "-", ">", "num", "]", ".", "num", "=", "info", "-", ">", "num", ";", "av7110", "-", ">", "ci_slot", "[", "info", "-", ">", "num", "]", ".", "type", "=", "FW_CI_LL_SUPPORT", "(", "av7110", "-", ">", "arm_app", ")", "?"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "corruption", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "74", ",", "6", "+", "74", ",", "11", "@", "@", "The", "<", "action", ">", "type", "attribute", "can", "be", "add", ",", "update", ",", "fix", ",", "remove", ".", "It", "is", "now", "possible", "to", "specify", "the", "arguments", "of", "zstd", "-", "jni", "'", "s", "ZstdOutputStream", "constructors", "via", "Commons", "Compress", "as", "well", ".", "<", "/", "action", ">", "<", "action", "issue", "=", "\"", "COMPRESS", "-", "463", "\"", "type", "=", "\"", "fix", "\"", "date", "=", "\"", "2018", "-", "08", "-", "09", "\"", ">", "ZipArchiveInputStream", "#", "read", "would", "silently", "return", "-", "1", "on", "a", "corrupted", "stored", "entry", "and", "even", "return", ">", "0", "after", "hitting", "the", "end", "of", "the", "archive", ".", "<", "/", "action", ">", "<", "/", "release", ">", "<", "release", "version", "=", "\"", "1", ".", "17", "\"", "date", "=", "\"", "2018", "-", "06", "-", "03", "\"", "description", "=", "\"", "Release", "1", ".", "17", "\"", ">", "@", "@", "-", "525", ",", "7", "+", "525", ",", "8", "@", "@", "private", "int", "readStored", "(", "final", "byte", "[", "]", "buffer", ",", "final", "int", "offset", ",", "final", "int", "length", ")", "buf", ".", "position", "(", "0", ")", ";", "final", "int", "l", "=", "in", ".", "read", "(", "buf", ".", "array", "(", "))", ";", "if", "(", "l", "=", "=", "-", "1", ")", "{", "return", "-", "1", ";", "buf", ".", "limit", "(", "0", ")", ";", "throw", "new", "IOException", "(", "\"", "Truncated", "ZIP", "file", "\"", ");", "}", "buf", ".", "limit", "(", "l", ")", ";", "@", "@", "-", "96", ",", "6", "+", "96", ",", "13", "@", "@", "public", "void", "testRead7ZipMultiVolumeArchiveForStream", "(", ")", "throws", "IOException", "{", "assertEquals", "(", "\"", "Truncated", "ZIP", "file", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "try", "{", "zi", ".", "read", "(", "buffer", ")", ";", "fail", "(", "\"", "shouldn", "'", "t", "be", "able", "to", "read", "from", "truncated", "entry", "after", "exception", "\"", ");", "}", "catch", "(", "final", "IOException", "e", ")", "{", "assertEquals", "(", "\"", "Truncated", "ZIP", "file", "\"", ",", "e", ".", "getMessage", "(", "))", ";", "}", "/", "/", "and", "now", "we", "get", "another", "entry", ",", "which", "should", "also", "yield", "/", "/", "an", "exception", "try", "{", "@", "@", "-", "421", ",", "6", "+", "421", ",", "75", "@", "@", "private", "void", "multiByteReadConsistentlyReturnsMinusOneAtEof", "(", "File", "file", ")", "throws", "Exc", "}", "}", "@", "Test", "public", "void", "singleByteReadThrowsAtEofForCorruptedStoredEntry", "(", ")", "throws", "Exception", "{", "byte", "[", "]", "content", ";", "try", "(", "FileInputStream", "fs", "=", "new", "FileInputStream", "(", "getFile", "(", "\"", "COMPRESS", "-", "264", ".", "zip", "\"", "))", ")", "{", "content", "=", "IOUtils", ".", "toByteArray", "(", "fs", ")", ";", "}", "/", "/", "make", "size", "much", "bigger", "than", "entry", "'", "s", "real", "size", "for", "(", "int", "i", "=", "17", ";", "i", "<", "26", ";", "i", "+", "+)", "{", "content", "[", "i", "]", "=", "(", "byte", ")", "0xff", ";", "}", "try", "(", "ByteArrayInputStream", "in", "=", "new", "ByteArrayInputStream", "(", "content", ")", ";", "ZipArchiveInputStream", "archive", "=", "new", "ZipArchiveInputStream", "(", "in", ")", ")", "{", "ArchiveEntry", "e", "=", "archive", ".", "getNextEntry", "(", ");", "try", "{", "IOUtils", ".", "toByteArray", "(", "archive", ")", ";", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "IOException", "ex", ")", "{", "assertEquals", "(", "\"", "Truncated", "ZIP", "file", "\"", ",", "ex", ".", "getMessage", "(", "))", ";", "}", "try", "{", "archive", ".", "read", "(", ");", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "IOException", "ex", ")", "{", "assertEquals", "(", "\"", "Truncated", "ZIP", "file", "\"", ",", "ex", ".", "getMessage", "(", "))", ";", "}", "try", "{", "archive", ".", "read", "(", ");", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "IOException", "ex", ")", "{", "assertEquals", "(", "\"", "Truncated", "ZIP", "file", "\"", ",", "ex", ".", "getMessage", "(", "))", ";", "}", "}", "}", "@", "Test", "public", "void", "multiByteReadThrowsAtEofForCorruptedStoredEntry", "(", ")", "throws", "Exception", "{", "byte", "[", "]", "content", ";", "try", "(", "FileInputStream", "fs", "=", "new", "FileInputStream", "(", "getFile", "(", "\"", "COMPRESS", "-", "264", ".", "zip", "\"", "))", ")", "{", "content", "=", "IOUtils", ".", "toByteArray", "(", "fs", ")", ";", "}", "/", "/", "make", "size", "much", "bigger", "than", "entry", "'", "s", "real", "size", "for", "(", "int", "i", "=", "17", ";", "i", "<", "26", ";", "i", "+", "+)", "{", "content", "[", "i", "]", "=", "(", "byte", ")", "0xff", ";", "}", "byte", "[", "]", "buf", "=", "new", "byte", "[", "2", "]", ";", "try", "(", "ByteArrayInputStream", "in", "=", "new", "ByteArrayInputStream", "(", "content", ")", ";", "ZipArchiveInputStream", "archive", "=", "new", "ZipArchiveInputStream", "(", "in", ")", ")", "{", "ArchiveEntry", "e", "=", "archive", ".", "getNextEntry", "(", ");", "try", "{", "IOUtils", ".", "toByteArray", "(", "archive", ")", ";", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "IOException", "ex", ")", "{", "assertEquals", "(", "\"", "Truncated", "ZIP", "file", "\"", ",", "ex", ".", "getMessage", "(", "))", ";", "}", "try", "{", "archive", ".", "read", "(", "buf", ")", ";", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "IOException", "ex", ")", "{", "assertEquals", "(", "\"", "Truncated", "ZIP", "file", "\"", ",", "ex", ".", "getMessage", "(", "))", ";", "}", "try", "{", "archive", ".", "read", "(", "buf", ")", ";", "fail", "(", "\"", "expected", "exception", "\"", ");", "}", "catch", "(", "IOException", "ex", ")", "{", "assertEquals", "(", "\"", "Truncated", "ZIP", "file", "\"", ",", "ex", ".", "getMessage", "(", "))", ";", "}", "}", "}", "private", "static", "byte", "[", "]", "readEntry", "(", "ZipArchiveInputStream", "zip", ",", "ZipArchiveEntry", "zae", ")", "throws", "IOException", "{", "final", "int", "len", "=", "(", "int", ")", "zae", ".", "getSize", "(", ");", "final", "byte", "[", "]", "buff", "=", "new", "byte", "[", "len", "]", ";"], "docstring_tokens": ["the", "application", "to", "enter", "into", "an", "infinite", "loop"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "44", ",", "7", "+", "44", ",", "7", "@", "@", "static", "const", "smpl_t", "freqs", "[", "]", "=", "{", "0", ".", ",", "20", ".", ",", "25", ".", ",", "31", ".", "5", ",", "40", ".", ",", "50", ".", ",", "63", ".", ",", "80", ".", ",", "100", ".", ",", "125", ".", ",", "160", ".", ",", "200", ".", ",", "250", ".", ",", "315", ".", ",", "400", ".", ",", "500", ".", ",", "630", ".", ",", "800", ".", ",", "1000", ".", ",", "1250", ".", ",", "1600", ".", ",", "2000", ".", ",", "2500", ".", ",", "3150", ".", ",", "4000", ".", ",", "5000", ".", ",", "6300", ".", ",", "8000", ".", ",", "9000", ".", ",", "10000", ".", ",", "12500", ".", ",", "15000", ".", ",", "20000", ".", ",", "25100", "12500", ".", ",", "15000", ".", ",", "20000", ".", ",", "25100", ".", ",", "-", "1", ".", "}", ";", "static", "const", "smpl_t", "weight", "[", "]", "=", "{", "@", "@", "-", "72", ",", "7", "+", "72", ",", "8", "@", "@", "new_aubio_pitchyinfft", "(", "uint_t", "samplerate", ",", "uint_t", "bufsize", ")", "p", "-", ">", "weight", "=", "new_fvec", "(", "bufsize", "/", "2", "+", "1", ")", ";", "for", "(", "i", "=", "0", ";", "i", "<", "p", "-", ">", "weight", "-", ">", "length", ";", "i", "+", "+)", "{", "freq", "=", "(", "smpl_t", ")", "i", "/", "(", "smpl_t", ")", "bufsize", "*", "(", "smpl_t", ")", "samplerate", ";", "while", "(", "freq", ">", "freqs", "[", "j", "]", ")", "{", "while", "(", "freq", ">", "freqs", "[", "j", "]", "&", "&", "freqs", "[", "j", "]", ">", "0", ")", "{", "AUBIO_DBG", "(", "\"", "freq", "%", "3", ".", "5f", ">", "%", "3", ".", "5f", "\\", "tsamplerate", "%", "d", "(", "Hz", ")", "\\", "t", "(", "weight", "length", "%", "d", ",", "bufsize", "%", "d", ")", "%", "d", "%", "d", "\\", "n", "\"", ",", "freq", ",", "freqs", "[", "j", "]", ",", "samplerate", ",", "p", "-", ">", "weight", "-", ">", "length", ",", "bufsize", ",", "i", ",", "j", ")", ";", "j", "+", "=", "1", ";", "}", "a0", "=", "weight", "[", "j", "-", "1", "]", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1008", ",", "13", "+", "1008", ",", "15", "@", "@", "ModuleExport", "size_t", "RegisterMPCImage", "(", "void", ")", "entry", "=", "SetMagickInfo", "(", "\"", "CACHE", "\"", ");", "entry", "-", ">", "description", "=", "ConstantString", "(", "\"", "Magick", "Persistent", "Cache", "image", "format", "\"", ");", "entry", "-", ">", "module", "=", "ConstantString", "(", "\"", "MPC", "\"", ");", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "stealth", "=", "MagickTrue", ";", "(", "void", ")", "RegisterMagickInfo", "(", "entry", ")", ";", "entry", "=", "SetMagickInfo", "(", "\"", "MPC", "\"", ");", "entry", "-", ">", "decoder", "=", "(", "DecodeImageHandler", "*", ")", "ReadMPCImage", ";", "entry", "-", ">", "encoder", "=", "(", "EncodeImageHandler", "*", ")", "WriteMPCImage", ";", "entry", "-", ">", "magick", "=", "(", "IsImageFormatHandler", "*", ")", "IsMPC", ";", "entry", "-", ">", "description", "=", "ConstantString", "(", "\"", "Magick", "Persistent", "Cache", "image", "format", "\"", ");", "entry", "-", ">", "seekable_stream", "=", "MagickTrue", ";", "entry", "-", ">", "module", "=", "ConstantString", "(", "\"", "MPC", "\"", ");", "(", "void", ")", "RegisterMagickInfo", "(", "entry", ")", ";", "return", "(", "MagickImageCoderSignature", ")", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(application", "crash", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "853", ",", "8", "+", "853", ",", "10", "@", "@", "public", "SocketState", "process", "(", "SocketWrapperBase", "<", "S", ">", "wrapper", ",", "SocketEvent", "status", ")", "{", "/", "/", "Assume", "direct", "HTTP", "/", "2", "connection", "UpgradeProtocol", "upgradeProtocol", "=", "getProtocol", "(", ").", "getUpgradeProtocol", "(", "\"", "h2c", "\"", ");", "if", "(", "upgradeProtocol", "!", "=", "null", ")", "{", "processor", "=", "upgradeProtocol", ".", "getProcessor", "(", "wrapper", ",", "getProtocol", "(", ").", "getAdapter", "(", "))", ";", "/", "/", "Release", "the", "Http11", "processor", "to", "be", "re", "-", "used", "release", "(", "processor", ")", ";", "/", "/", "Create", "the", "upgrade", "processor", "processor", "=", "upgradeProtocol", ".", "getProcessor", "(", "wrapper", ",", "getProtocol", "(", ").", "getAdapter", "(", "))", ";", "wrapper", ".", "unRead", "(", "leftOverInput", ")", ";", "/", "/", "Associate", "with", "the", "processor", "with", "the", "connection", "wrapper", ".", "setCurrentProcessor", "(", "processor", ")", ";", "@", "@", "-", "864", ",", "7", "+", "866", ",", "8", "@", "@", "public", "SocketState", "process", "(", "SocketWrapperBase", "<", "S", ">", "wrapper", ",", "SocketEvent", "status", ")", "{", "\"", "abstractConnectionHandler", ".", "negotiatedProcessor", ".", "fail", "\"", ",", "\"", "h2c", "\"", "))", ";", "}", "return", "SocketState", ".", "CLOSED", ";", "/", "/", "Exit", "loop", "and", "trigger", "appropriate", "clean", "-", "up", "state", "=", "SocketState", ".", "CLOSED", ";", "}", "}", "else", "{", "HttpUpgradeHandler", "httpUpgradeHandler", "=", "upgradeToken", ".", "getHttpUpgradeHandler", "(", ");", "@", "@", "-", "110", ",", "6", "+", "110", ",", "10", "@", "@", "<", "fix", ">", "Reduce", "the", "memory", "footprint", "of", "closed", "HTTP", "/", "2", "streams", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Ensure", "that", "the", "HTTP", "/", "1", ".", "1", "processor", "is", "correctly", "recycled", "when", "a", "direct", "connection", "to", "h2c", "is", "made", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Jasper", "\"", ">"], "docstring_tokens": ["a", "denial", "of", "service", "."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "90", ",", "7", "+", "90", ",", "7", "@", "@", "static", "int", "snd_hrtimer_start", "(", "struct", "snd_timer", "*", "t", ")", "struct", "snd_hrtimer", "*", "stime", "=", "t", "-", ">", "private_data", ";", "atomic_set", "(", "&", "stime", "-", ">", "running", ",", "0", ")", ";", "hrtimer_cancel", "(", "&", "stime", "-", ">", "hrt", ")", ";", "hrtimer_try_to_cancel", "(", "&", "stime", "-", ">", "hrt", ")", ";", "hrtimer_start", "(", "&", "stime", "-", ">", "hrt", ",", "ns_to_ktime", "(", "t", "-", ">", "sticks", "*", "resolution", ")", ",", "HRTIMER_MODE_REL", ")", ";", "atomic_set", "(", "&", "stime", "-", ">", "running", ",", "1", ")", ";", "@", "@", "-", "101", ",", "6", "+", "101", ",", "7", "@", "@", "static", "int", "snd_hrtimer_stop", "(", "struct", "snd_timer", "*", "t", ")", "{", "struct", "snd_hrtimer", "*", "stime", "=", "t", "-", ">", "private_data", ";", "atomic_set", "(", "&", "stime", "-", ">", "running", ",", "0", ")", ";", "hrtimer_try_to_cancel", "(", "&", "stime", "-", ">", "hrt", ")", ";", "return", "0", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(deadlock", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "157", ",", "7", "+", "157", ",", "7", "@", "@", "with", "the", "following", "path", "and", "query", "parameters", ":", "|", "*", "delimiter", "*", "(", "codec", ")", "|", "The", "delimiter", "to", "use", "for", "the", "textline", "codec", ".", "Possible", "values", "are", "LINE", "and", "NULL", ".", "|", "LINE", "|", "TextLineDelimiter", "|", "*", "encoders", "*", "(", "codec", ")", "|", "A", "list", "of", "encoders", "to", "be", "used", ".", "You", "can", "use", "a", "String", "which", "have", "values", "separated", "by", "comma", ",", "and", "have", "the", "values", "be", "looked", "up", "in", "the", "Registry", ".", "Just", "remember", "to", "prefix", "the", "value", "with", "#", "so", "Camel", "knows", "it", "should", "lookup", ".", "|", "|", "List", "|", "*", "encoding", "*", "(", "codec", ")", "|", "The", "encoding", "(", "a", "charset", "name", ")", "to", "use", "for", "the", "textline", "codec", ".", "If", "not", "provided", ",", "Camel", "will", "use", "the", "JVM", "default", "Charset", ".", "|", "|", "String", "|", "*", "textline", "*", "(", "codec", ")", "|", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "|", "false", "|", "boolean", "|", "*", "textline", "*", "(", "codec", ")", "|", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", "-", "however", "only", "Strings", "are", "allowed", "to", "be", "serialized", "by", "default", ".", "|", "false", "|", "boolean", "|", "*", "enabledProtocols", "*", "(", "security", ")", "|", "Which", "protocols", "to", "enable", "when", "using", "SSL", "|", "TLSv1", ",", "TLSv1", ".", "1", ",", "TLSv1", ".", "2", "|", "String", "|", "*", "keyStoreFile", "*", "(", "security", ")", "|", "Client", "side", "certificate", "keystore", "to", "be", "used", "for", "encryption", "|", "|", "File", "|", "*", "keyStoreFormat", "*", "(", "security", ")", "|", "Keystore", "format", "to", "be", "used", "for", "payload", "encryption", ".", "Defaults", "to", "JKS", "if", "not", "set", "|", "|", "String", "@", "@", "-", "257", ",", "7", "+", "257", ",", "7", "@", "@", "The", "component", "supports", "80", "options", ",", "which", "are", "listed", "below", ".", "|", "*", "camel", ".", "component", ".", "netty", ".", "configuration", ".", "ssl", "-", "handler", "*", "|", "Reference", "to", "a", "class", "that", "could", "be", "used", "to", "return", "an", "SSL", "Handler", "|", "|", "SslHandler", "|", "*", "camel", ".", "component", ".", "netty", ".", "configuration", ".", "sync", "*", "|", "Setting", "to", "set", "endpoint", "as", "one", "-", "way", "or", "request", "-", "response", "|", "true", "|", "Boolean", "|", "*", "camel", ".", "component", ".", "netty", ".", "configuration", ".", "tcp", "-", "no", "-", "delay", "*", "|", "Setting", "to", "improve", "TCP", "protocol", "performance", "|", "true", "|", "Boolean", "|", "*", "camel", ".", "component", ".", "netty", ".", "configuration", ".", "textline", "*", "|", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "|", "false", "|", "Boolean", "|", "*", "camel", ".", "component", ".", "netty", ".", "configuration", ".", "textline", "*", "|", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "However", "note", "that", "only", "Strings", "are", "serialized", ",", "anything", "else", "will", "only", "be", "serialized", "with", "a", "custom", "encoder", "/", "decoder", ".", "|", "false", "|", "Boolean", "|", "*", "camel", ".", "component", ".", "netty", ".", "configuration", ".", "transfer", "-", "exchange", "*", "|", "Only", "used", "for", "TCP", ".", "You", "can", "transfer", "the", "exchange", "over", "the", "wire", "instead", "of", "just", "the", "body", ".", "The", "following", "fields", "are", "transferred", ":", "In", "body", ",", "Out", "body", ",", "fault", "body", ",", "In", "headers", ",", "Out", "headers", ",", "fault", "headers", ",", "exchange", "properties", ",", "exchange", "exception", ".", "This", "requires", "that", "the", "objects", "are", "serializable", ".", "Camel", "will", "exclude", "any", "non", "-", "serializable", "objects", "and", "log", "it", "at", "WARN", "level", ".", "|", "false", "|", "Boolean", "|", "*", "camel", ".", "component", ".", "netty", ".", "configuration", ".", "trust", "-", "store", "-", "resource", "*", "|", "Server", "side", "certificate", "keystore", "to", "be", "used", "for", "encryption", ".", "Is", "loaded", "by", "default", "from", "classpath", ",", "but", "you", "can", "prefix", "with", "\"", "classpath", ":", "\",", "\"", "file", ":", "\",", "or", "\"", "http", ":", "\"", "to", "load", "the", "resource", "from", "different", "systems", ".", "|", "|", "String", "|", "*", "camel", ".", "component", ".", "netty", ".", "configuration", ".", "udp", "-", "byte", "-", "array", "-", "codec", "*", "|", "For", "UDP", "only", ".", "If", "enabled", "the", "using", "byte", "array", "codec", "instead", "of", "Java", "serialization", "protocol", ".", "|", "false", "|", "Boolean", "@", "@", "-", "378", ",", "16", "+", "378", ",", "28", "@", "@", "operations", ".", "=", "==", "A", "UDP", "Netty", "endpoint", "using", "Request", "-", "Reply", "and", "serialized", "object", "payload", "Note", "that", "Object", "serialization", "is", "not", "allowed", "by", "default", ",", "and", "so", "a", "decoder", "must", "be", "configured", ".", "[", "source", ",", "java", "]", "@", "BindToRegistry", "(", "\"", "decoder", "\"", ")", "public", "ChannelHandler", "getDecoder", "(", ")", "throws", "Exception", "{", "return", "new", "DefaultChannelHandlerFactory", "(", ")", "{", "@", "Override", "public", "ChannelHandler", "newChannelHandler", "(", ")", "{", "return", "new", "DatagramPacketObjectDecoder", "(", "ClassResolvers", ".", "weakCachingResolver", "(", "null", ")", ");", "}", "}", ";", "}", "RouteBuilder", "builder", "=", "new", "RouteBuilder", "(", ")", "{", "public", "void", "configure", "(", ")", "{", "from", "(", "\"", "netty", ":", "udp", ":", "//", "0", ".", "0", ".", "0", ".", "0", ":", "5155", "?", "sync", "=", "true", "\"", ")", "from", "(", "\"", "netty", ":", "udp", ":", "//", "0", ".", "0", ".", "0", ".", "0", ":", "5155", "?", "sync", "=", "true", "&", "decoders", "=", "#", "decoder", "\"", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "Poetry", "poetry", "=", "(", "Poetry", ")", "exchange", ".", "getIn", "(", ").", "getBody", "(", ");", "poetry", ".", "setPoet", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "poetry", ")", ";", "/", "/", "Process", "poetry", "in", "some", "way", "exchange", ".", "getOut", "(", ").", "setBody", "(", "\"", "Message", "received", ")", ";", "}", "}", "}", "@", "@", "-", "23", ",", "21", "+", "23", ",", "16", "@", "@", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "LengthFieldBasedFrameDecoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "bytes", ".", "ByteArrayDecoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "bytes", ".", "ByteArrayEncoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "serialization", ".", "ClassResolvers", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "string", ".", "StringDecoder", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "string", ".", "StringEncoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketByteArrayDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketByteArrayEncoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketDelimiterDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketEncoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketObjectDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketObjectEncoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketStringDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DatagramPacketStringEncoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "DelimiterBasedFrameDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "ObjectDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "ObjectEncoder", ";", "/", "**", "*", "Helper", "to", "create", "commonly", "used", "{", "@", "link", "ChannelHandlerFactory", "}", "instances", ".", "@", "@", "-", "64", ",", "32", "+", "59", ",", "6", "@", "@", "public", "static", "ChannelHandlerFactory", "newStringDecoder", "(", "Charset", "charset", ",", "String", "pro", "}", "public", "static", "ChannelHandlerFactory", "newObjectDecoder", "(", "String", "protocol", ")", "{", "if", "(", "\"", "udp", "\"", ".", "equalsIgnoreCase", "(", "protocol", ")", ")", "{", "return", "new", "DefaultChannelHandlerFactory", "(", ")", "{", "@", "Override", "public", "ChannelHandler", "newChannelHandler", "(", ")", "{", "return", "new", "DatagramPacketObjectDecoder", "(", "ClassResolvers", ".", "weakCachingResolver", "(", "null", ")", ");", "}", "}", ";", "}", "else", "{", "return", "new", "DefaultChannelHandlerFactory", "(", ")", "{", "@", "Override", "public", "ChannelHandler", "newChannelHandler", "(", ")", "{", "return", "new", "ObjectDecoder", "(", "ClassResolvers", ".", "weakCachingResolver", "(", "null", ")", ");", "}", "}", ";", "}", "}", "public", "static", "ChannelHandlerFactory", "newObjectEncoder", "(", "String", "protocol", ")", "{", "if", "(", "\"", "udp", "\"", ".", "equals", "(", "protocol", ")", ")", "{", "return", "new", "ShareableChannelHandlerFactory", "(", "new", "DatagramPacketObjectEncoder", "(", "))", ";", "}", "else", "{", "return", "new", "ShareableChannelHandlerFactory", "(", "new", "ObjectEncoder", "(", "))", ";", "}", "}", "public", "static", "ChannelHandlerFactory", "newDelimiterBasedFrameDecoder", "(", "final", "int", "maxFrameLength", ",", "final", "ByteBuf", "[", "]", "delimiters", ",", "String", "protocol", ")", "{", "return", "newDelimiterBasedFrameDecoder", "(", "maxFrameLength", ",", "delimiters", ",", "true", ",", "protocol", ")", ";", "}", "@", "@", "-", "209", ",", "7", "+", "209", ",", "7", "@", "@", "public", "void", "parseURI", "(", "URI", "uri", ",", "Map", "<", "String", ",", "Object", ">", "parameters", ",", "NettyComponent", "com", "if", "(", "\"", "udp", "\"", ".", "equalsIgnoreCase", "(", "protocol", ")", ")", "{", "encoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newDatagramPacketEncoder", "(", "))", ";", "}", "/", "/", "are", "we", "textline", "or", "object", "?", "/", "/", "are", "we", "textline", "or", "byte", "array", "if", "(", "isTextline", "(", "))", "{", "Charset", "charset", "=", "getEncoding", "(", ")", "!", "=", "null", "?", "Charset", ".", "forName", "(", "getEncoding", "(", "))", ":", "CharsetUtil", ".", "UTF_8", ";", "encoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newStringEncoder", "(", "charset", ",", "protocol", ")", ");", "@", "@", "-", "225", ",", "11", "+", "225", ",", "10", "@", "@", "public", "void", "parseURI", "(", "URI", "uri", ",", "Map", "<", "String", ",", "Object", ">", "parameters", ",", "NettyComponent", "com", "encoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newByteArrayEncoder", "(", "protocol", ")", ");", "decoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newByteArrayDecoder", "(", "protocol", ")", ");", "}", "else", "{", "/", "/", "object", "serializable", "is", "then", "used", "encoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newObjectEncoder", "(", "protocol", ")", ");", "decoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newObjectDecoder", "(", "protocol", ")", ");", "LOG", ".", "debug", "(", "\"", "Using", "object", "encoders", "and", "decoders", "\"", ");", "/", "/", "Fall", "back", "to", "allowing", "Strings", "to", "be", "serialized", "only", "Charset", "charset", "=", "getEncoding", "(", ")", "!", "=", "null", "?", "Charset", ".", "forName", "(", "getEncoding", "(", "))", ":", "CharsetUtil", ".", "UTF_8", ";", "encoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newStringEncoder", "(", "charset", ",", "protocol", ")", ");", "decoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newStringDecoder", "(", "charset", ",", "protocol", ")", ");", "}", "if", "(", "\"", "udp", "\"", ".", "equalsIgnoreCase", "(", "protocol", ")", ")", "{", "decoders", ".", "add", "(", "ChannelHandlerFactories", ".", "newDatagramPacketDecoder", "(", "))", ";", "@", "@", "-", "300", ",", "7", "+", "299", ",", "8", "@", "@", "public", "boolean", "isTextline", "(", ")", "{", "/", "**", "*", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "indicate", "a", "text", "line", "based", "codec", ";", "*", "if", "not", "specified", "or", "the", "value", "is", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "*", "if", "not", "specified", "or", "the", "value", "is", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", "-", "however", "only", "Strings", "*", "are", "allowed", "to", "be", "serialized", "by", "default", ".", "*", "/", "public", "void", "setTextline", "(", "boolean", "textline", ")", "{", "this", ".", "textline", "=", "textline", ";", "@", "@", "-", "30", ",", "12", "+", "30", ",", "6", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "&", "backlog", "=", "500", "\"", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "if", "(", "exchange", ".", "getIn", "(", ").", "getBody", "(", ")", "instanceof", "Poetry", ")", "{", "Poetry", "poetry", "=", "(", "Poetry", ")", "exchange", ".", "getIn", "(", ").", "getBody", "(", ");", "poetry", ".", "setPoet", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "poetry", ")", ";", "return", ";", "}", "exchange", ".", "getOut", "(", ").", "setBody", "(", "\"", "When", "You", "Go", "Home", ",", "Tell", "Them", "Of", "Us", "And", "Say", ",", "For", "Your", "Tomorrow", ",", "We", "Gave", "Our", "Today", ".", "\")", ";", "}", "}", ");", "@", "@", "-", "26", ",", "14", "+", "26", ",", "20", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "Future", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "org", ".", "apache", ".", "camel", ".", "BindToRegistry", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Processor", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "NotifyBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "ObjectDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "ObjectEncoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "StopWatch", ";", "import", "org", ".", "junit", ".", "Ignore", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "io", ".", "netty", ".", "channel", ".", "ChannelHandler", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "serialization", ".", "ClassResolvers", ";", "public", "class", "NettyConcurrentTest", "extends", "BaseNettyTest", "{", "@", "Test", "@", "@", "-", "69", ",", "7", "+", "75", ",", "7", "@", "@", "private", "void", "doSendMessages", "(", "int", "files", ",", "int", "poolSize", ")", "throws", "Exception", "{", "final", "int", "index", "=", "i", ";", "Future", "<", "String", ">", "out", "=", "executor", ".", "submit", "(", "new", "Callable", "<", "String", ">", "()", "{", "public", "String", "call", "(", ")", "throws", "Exception", "{", "String", "reply", "=", "template", ".", "requestBody", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}\"", ",", "index", ",", "String", ".", "class", ")", ";", "String", "reply", "=", "template", ".", "requestBody", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "encoders", "=", "#", "encoder", "&", "decoders", "=", "#", "decoder", "\"", ",", "index", ",", "String", ".", "class", ")", ";", "log", ".", "debug", "(", "\"", "Sent", "{", "}", "received", "{", "}\"", ",", "index", ",", "reply", ")", ";", "assertEquals", "(", "\"", "Bye", "\"", "+", "index", ",", "reply", ")", ";", "return", "reply", ";", "@", "@", "-", "93", ",", "11", "+", "99", ",", "26", "@", "@", "public", "String", "call", "(", ")", "throws", "Exception", "{", "executor", ".", "shutdownNow", "(", ");", "}", "@", "BindToRegistry", "(", "\"", "encoder", "\"", ")", "public", "ChannelHandler", "getEncoder", "(", ")", "throws", "Exception", "{", "return", "new", "ShareableChannelHandlerFactory", "(", "new", "ObjectEncoder", "(", "))", ";", "}", "@", "BindToRegistry", "(", "\"", "decoder", "\"", ")", "public", "ChannelHandler", "getDecoder", "(", ")", "throws", "Exception", "{", "return", "new", "DefaultChannelHandlerFactory", "(", ")", "{", "@", "Override", "public", "ChannelHandler", "newChannelHandler", "(", ")", "{", "return", "new", "ObjectDecoder", "(", "ClassResolvers", ".", "weakCachingResolver", "(", "null", ")", ");", "}", "}", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "\"", ").", "process", "(", "new", "Processor", "(", ")", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "&", "encoders", "=", "#", "encoder", "&", "decoders", "=", "#", "decoder", "\"", ").", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "String", "body", "=", "exchange", ".", "getIn", "(", ").", "getBody", "(", "String", ".", "class", ")", ";", "exchange", ".", "getOut", "(", ").", "setBody", "(", "\"", "Bye", "\"", "+", "body", ")", ";", "@", "@", "-", "30", ",", "12", "+", "30", ",", "6", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "&", "option", ".", "child", ".", "keepAlive", "=", "false", "\"", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "if", "(", "exchange", ".", "getIn", "(", ").", "getBody", "(", ")", "instanceof", "Poetry", ")", "{", "Poetry", "poetry", "=", "(", "Poetry", ")", "exchange", ".", "getIn", "(", ").", "getBody", "(", ");", "poetry", ".", "setPoet", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "poetry", ")", ";", "return", ";", "}", "exchange", ".", "getOut", "(", ").", "setBody", "(", "\"", "When", "You", "Go", "Home", ",", "Tell", "Them", "Of", "Us", "And", "Say", ",", "For", "Your", "Tomorrow", ",", "We", "Gave", "Our", "Today", ".", "\")", ";", "}", "}", ");", "@", "@", "-", "19", ",", "6", "+", "19", ",", "7", "@", "@", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "org", ".", "apache", ".", "camel", ".", "BindToRegistry", ";", "import", "org", ".", "apache", ".", "camel", ".", "EndpointInject", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Message", ";", "@", "@", "-", "29", ",", "6", "+", "30", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "camel", ".", "util", ".", "IOHelper", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "io", ".", "netty", ".", "channel", ".", "ChannelHandler", ";", "public", "class", "NettyTCPAsyncTest", "extends", "BaseNettyTest", "{", "@", "EndpointInject", "(", "\"", "mock", ":", "result", "\"", ")", "protected", "MockEndpoint", "resultEndpoint", ";", "@", "@", "-", "50", ",", "11", "+", "53", ",", "21", "@", "@", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "}", ");", "}", "@", "BindToRegistry", "(", "\"", "encoder", "\"", ")", "public", "ChannelHandler", "getEncoder", "(", ")", "throws", "Exception", "{", "return", "ChannelHandlerFactories", ".", "newByteArrayEncoder", "(", "\"", "tcp", "\"", ");", "}", "@", "BindToRegistry", "(", "\"", "decoder", "\"", ")", "public", "ChannelHandler", "getDecoder", "(", ")", "throws", "Exception", "{", "return", "ChannelHandlerFactories", ".", "newByteArrayDecoder", "(", "\"", "tcp", "\"", ");", "}", "@", "Test", "public", "void", "testTCPInOnlyWithNettyConsumer", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "sendFile", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "\"", ");", "sendFile", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "&", "encoders", "=", "#", "encoder", "\"", ");", "mock", ".", "assertIsSatisfied", "(", ");", "}", "@", "@", "-", "64", ",", "7", "+", "77", ",", "7", "@", "@", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "\"", ")", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "&", "decoders", "=", "#", "decoder", "\"", ")", ".", "to", "(", "\"", "log", ":", "result", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "}", "@", "@", "-", "19", ",", "6", "+", "19", ",", "7", "@", "@", "import", "java", ".", "io", ".", "FileInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "org", ".", "apache", ".", "camel", ".", "BindToRegistry", ";", "import", "org", ".", "apache", ".", "camel", ".", "EndpointInject", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Message", ";", "@", "@", "-", "30", ",", "6", "+", "31", ",", "8", "@", "@", "import", "org", ".", "junit", ".", "Assert", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "io", ".", "netty", ".", "channel", ".", "ChannelHandler", ";", "/", "**", "*", "In", "this", "test", "we", "are", "checking", "that", "same", "netty", "endpoint", "can", "be", "safely", "called", "twice", "*", "in", "single", "route", "with", "reconnect", ".", "It", "requires", "for", "processing", "to", "be", "fully", "async", "otherwise", "@", "@", "-", "60", ",", "6", "+", "63", ",", "11", "@", "@", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "Assert", ".", "assertFalse", "(", "exchange", ".", "isFailed", "(", "))", ";", "}", "@", "BindToRegistry", "(", "\"", "encoder", "\"", ")", "public", "ChannelHandler", "getEncoder", "(", ")", "throws", "Exception", "{", "return", "ChannelHandlerFactories", ".", "newByteArrayEncoder", "(", "\"", "tcp", "\"", ");", "}", "@", "Test", "public", "void", "testTCPChainedConnectionFromCallbackThread", "(", ")", "throws", "Exception", "{", "MockEndpoint", "mock", "=", "getMockEndpoint", "(", "\"", "mock", ":", "result", "\"", ");", "@", "@", "-", "74", ",", "11", "+", "82", ",", "11", "@", "@", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "\"", ")", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "&", "encoders", "=", "#", "encoder", "\"", ")", ".", "to", "(", "\"", "log", ":", "result", "\"", ")", ".", "to", "(", "\"", "mock", ":", "result", "\"", ");", "from", "(", "\"", "direct", ":", "nettyCall", "\"", ")", ".", "to", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "&", "disconnect", "=", "true", "&", "workerCount", "=", "1", "\"", ");", ".", "to", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "&", "disconnect", "=", "true", "&", "workerCount", "=", "1", "&", "encoders", "=", "#", "encoder", "\"", ");", "from", "(", "\"", "direct", ":", "chainedCalls", "\"", ")", ".", "to", "(", "\"", "direct", ":", "nettyCall", "\"", ")", ".", "to", "(", "\"", "direct", ":", "nettyCall", "\"", ");", "@", "@", "-", "31", ",", "13", "+", "31", ",", "6", "@", "@", "public", "void", "testTCPStringInOutWithNettyConsumer", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "When", "You", "Go", "Home", ",", "Tell", "Them", "Of", "Us", "And", "Say", ",", "For", "Your", "Tomorrow", ",", "We", "Gave", "Our", "Today", ".", "\",", "response", ")", ";", "}", "@", "Test", "public", "void", "testTCPObjectInOutWithNettyConsumer", "(", ")", "throws", "Exception", "{", "Poetry", "poetry", "=", "new", "Poetry", "(", ");", "Poetry", "response", "=", "(", "Poetry", ")", "template", ".", "requestBody", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "&", "lazyChannelCreation", "=", "false", "\"", ",", "poetry", ")", ";", "assertEquals", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ",", "response", ".", "getPoet", "(", "))", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "@", "-", "46", ",", "12", "+", "39", ",", "6", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "\"", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "if", "(", "exchange", ".", "getIn", "(", ").", "getBody", "(", ")", "instanceof", "Poetry", ")", "{", "Poetry", "poetry", "=", "(", "Poetry", ")", "exchange", ".", "getIn", "(", ").", "getBody", "(", ");", "poetry", ".", "setPoet", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "poetry", ")", ";", "return", ";", "}", "exchange", ".", "getOut", "(", ").", "setBody", "(", "\"", "When", "You", "Go", "Home", ",", "Tell", "Them", "Of", "Us", "And", "Say", ",", "For", "Your", "Tomorrow", ",", "We", "Gave", "Our", "Today", ".", "\")", ";", "}", "}", ");", "@", "@", "-", "44", ",", "13", "+", "44", ",", "6", "@", "@", "public", "void", "testTCPStringInOutWithNettyConsumer2Times", "(", ")", "throws", "Exception", "{", "assertEquals", "(", "\"", "When", "You", "Go", "Home", ",", "Tell", "Them", "Of", "Us", "And", "Say", ",", "For", "Your", "Tomorrow", ",", "We", "Gave", "Our", "Today", ".", "\",", "response", ")", ";", "}", "@", "Test", "public", "void", "testTCPObjectInOutWithNettyConsumer", "(", ")", "throws", "Exception", "{", "Poetry", "poetry", "=", "new", "Poetry", "(", ");", "Poetry", "response", "=", "(", "Poetry", ")", "template", ".", "requestBody", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "\"", ",", "poetry", ")", ";", "assertEquals", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ",", "response", ".", "getPoet", "(", "))", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "@", "-", "59", ",", "12", "+", "52", ",", "6", "@", "@", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "\"", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "if", "(", "exchange", ".", "getIn", "(", ").", "getBody", "(", ")", "instanceof", "Poetry", ")", "{", "Poetry", "poetry", "=", "(", "Poetry", ")", "exchange", ".", "getIn", "(", ").", "getBody", "(", ");", "poetry", ".", "setPoet", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "poetry", ")", ";", "return", ";", "}", "exchange", ".", "getOut", "(", ").", "setBody", "(", "\"", "When", "You", "Go", "Home", ",", "Tell", "Them", "Of", "Us", "And", "Say", ",", "For", "Your", "Tomorrow", ",", "We", "Gave", "Our", "Today", ".", "\")", ";", "}", "}", ");", "@", "@", "-", "18", ",", "15", "+", "18", ",", "21", "@", "@", "import", "java", ".", "nio", ".", "charset", ".", "Charset", ";", "import", "org", ".", "apache", ".", "camel", ".", "BindToRegistry", ";", "import", "org", ".", "apache", ".", "camel", ".", "Endpoint", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "ExchangePattern", ";", "import", "org", ".", "apache", ".", "camel", ".", "Message", ";", "import", "org", ".", "apache", ".", "camel", ".", "Processor", ";", "import", "org", ".", "apache", ".", "camel", ".", "Producer", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "ObjectDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "ObjectEncoder", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "io", ".", "netty", ".", "channel", ".", "ChannelHandler", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "serialization", ".", "ClassResolvers", ";", "public", "class", "NettyTransferExchangeOptionTest", "extends", "BaseNettyTest", "{", "@", "Test", "@", "@", "-", "41", ",", "8", "+", "47", ",", "23", "@", "@", "public", "void", "testNettyTransferExchangeOptionWithException", "(", ")", "throws", "Exception", "{", "assertExchange", "(", "exchange", ",", "true", ")", ";", "}", "@", "BindToRegistry", "(", "\"", "encoder", "\"", ")", "public", "ChannelHandler", "getEncoder", "(", ")", "throws", "Exception", "{", "return", "new", "ShareableChannelHandlerFactory", "(", "new", "ObjectEncoder", "(", "))", ";", "}", "@", "BindToRegistry", "(", "\"", "decoder", "\"", ")", "public", "ChannelHandler", "getDecoder", "(", ")", "throws", "Exception", "{", "return", "new", "DefaultChannelHandlerFactory", "(", ")", "{", "@", "Override", "public", "ChannelHandler", "newChannelHandler", "(", ")", "{", "return", "new", "ObjectDecoder", "(", "ClassResolvers", ".", "weakCachingResolver", "(", "null", ")", ");", "}", "}", ";", "}", "private", "Exchange", "sendExchange", "(", "boolean", "setException", ")", "throws", "Exception", "{", "Endpoint", "endpoint", "=", "context", ".", "getEndpoint", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "transferExchange", "=", "true", "\"", ");", "Endpoint", "endpoint", "=", "context", ".", "getEndpoint", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "transferExchange", "=", "true", "&", "encoders", "=", "#", "encoder", "&", "decoders", "=", "#", "decoder", "\"", ");", "Exchange", "exchange", "=", "endpoint", ".", "createExchange", "(", ");", "Message", "message", "=", "exchange", ".", "getIn", "(", ");", "@", "@", "-", "93", ",", "7", "+", "114", ",", "7", "@", "@", "private", "void", "assertExchange", "(", "Exchange", "exchange", ",", "boolean", "hasException", ")", "{", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "{", "return", "new", "RouteBuilder", "(", ")", "{", "public", "void", "configure", "(", ")", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "transferExchange", "=", "true", "\"", ").", "process", "(", "new", "Processor", "(", ")", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "transferExchange", "=", "true", "&", "encoders", "=", "#", "encoder", "&", "decoders", "=", "#", "decoder", "\"", ").", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "e", ")", "throws", "InterruptedException", "{", "assertNotNull", "(", "e", ".", "getIn", "(", ").", "getBody", "(", "))", ";", "assertNotNull", "(", "e", ".", "getIn", "(", ").", "getHeaders", "(", "))", ";", "@", "@", "-", "42", ",", "7", "+", "42", ",", "7", "@", "@", "public", "void", "testUDPInOnlyWithNettyConsumer", "(", ")", "throws", "Exception", "{", "mock", ".", "expectedMessageCount", "(", "1", ")", ";", "mock", ".", "message", "(", "0", ")", ".", "body", "(", ").", "startsWith", "(", "\"", "Song", "Of", "A", "Dream", "\"", ".", "getBytes", "(", "))", ";", "sendFile", "(", "\"", "netty", ":", "udp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "\"", ");", "sendFile", "(", "\"", "netty", ":", "udp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "false", "&", "udpByteArrayCodec", "=", "true", "\"", ");", "mock", ".", "assertIsSatisfied", "(", ");", "}", "@", "@", "-", "1", ",", "50", "+", "0", ",", "0", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Processor", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "junit", ".", "Test", ";", "public", "class", "NettyUDPObjectSyncTest", "extends", "BaseNettyTest", "{", "@", "Test", "public", "void", "testUDPObjectInOutWithNettyConsumer", "(", ")", "throws", "Exception", "{", "Poetry", "poetry", "=", "new", "Poetry", "(", ");", "Poetry", "response", "=", "template", ".", "requestBody", "(", "\"", "netty", ":", "udp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "\"", ",", "poetry", ",", "Poetry", ".", "class", ")", ";", "assertEquals", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ",", "response", ".", "getPoet", "(", "))", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "udp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "\"", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "Poetry", "poetry", "=", "(", "Poetry", ")", "exchange", ".", "getIn", "(", ").", "getBody", "(", ");", "poetry", ".", "setPoet", "(", "\"", "Dr", ".", "Sarojini", "Naidu", "\"", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "poetry", ")", ";", "}", "}", ");", "}", "}", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "116", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "apache", ".", "camel", ".", "BindToRegistry", ";", "import", "org", ".", "apache", ".", "camel", ".", "CamelExecutionException", ";", "import", "org", ".", "apache", ".", "camel", ".", "Exchange", ";", "import", "org", ".", "apache", ".", "camel", ".", "Processor", ";", "import", "org", ".", "apache", ".", "camel", ".", "builder", ".", "RouteBuilder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "ObjectDecoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "component", ".", "netty", ".", "codec", ".", "ObjectEncoder", ";", "import", "org", ".", "apache", ".", "camel", ".", "test", ".", "AvailablePortFinder", ";", "import", "org", ".", "junit", ".", "BeforeClass", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "io", ".", "netty", ".", "channel", ".", "ChannelHandler", ";", "import", "io", ".", "netty", ".", "handler", ".", "codec", ".", "serialization", ".", "ClassResolvers", ";", "/", "**", "*", "Object", "Serialization", "is", "not", "allowed", "by", "default", ".", "However", "it", "can", "be", "enabled", "by", "adding", "specific", "encoders", "/", "decoders", ".", "*", "/", "public", "class", "ObjectSerializationTest", "extends", "BaseNettyTest", "{", "private", "static", "volatile", "int", "port2", ";", "@", "BeforeClass", "public", "static", "void", "initPort2", "(", ")", "throws", "Exception", "{", "port2", "=", "AvailablePortFinder", ".", "getNextAvailable", "(", ");", "}", "@", "Test", "public", "void", "testObjectSerializationFailureByDefault", "(", ")", "throws", "Exception", "{", "Date", "date", "=", "new", "Date", "(", ");", "try", "{", "template", ".", "requestBody", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "&", "encoders", "=", "#", "encoder", "\"", ",", "date", ",", "Date", ".", "class", ")", ";", "fail", "(", "\"", "Should", "have", "thrown", "exception", "\"", ");", "}", "catch", "(", "CamelExecutionException", "e", ")", "{", "/", "/", "expected", "}", "}", "@", "Test", "public", "void", "testObjectSerializationAllowedViaDecoder", "(", ")", "throws", "Exception", "{", "Date", "date", "=", "new", "Date", "(", ");", "Date", "receivedDate", "=", "template", ".", "requestBody", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port2", "}", "}?", "sync", "=", "true", "&", "encoders", "=", "#", "encoder", "&", "decoders", "=", "#", "decoder", "\"", ",", "date", ",", "Date", ".", "class", ")", ";", "assertEquals", "(", "date", ",", "receivedDate", ")", ";", "}", "@", "Override", "@", "BindToRegistry", "(", "\"", "prop", "\"", ")", "public", "Properties", "loadProperties", "(", ")", "throws", "Exception", "{", "Properties", "prop", "=", "new", "Properties", "(", ");", "prop", ".", "setProperty", "(", "\"", "port", "\"", ",", "\"", "\"", "+", "getPort", "(", "))", ";", "prop", ".", "setProperty", "(", "\"", "port2", "\"", ",", "\"", "\"", "+", "port2", ")", ";", "return", "prop", ";", "}", "@", "BindToRegistry", "(", "\"", "encoder", "\"", ")", "public", "ChannelHandler", "getEncoder", "(", ")", "throws", "Exception", "{", "return", "new", "ShareableChannelHandlerFactory", "(", "new", "ObjectEncoder", "(", "))", ";", "}", "@", "BindToRegistry", "(", "\"", "decoder", "\"", ")", "public", "ChannelHandler", "getDecoder", "(", ")", "throws", "Exception", "{", "return", "new", "DefaultChannelHandlerFactory", "(", ")", "{", "@", "Override", "public", "ChannelHandler", "newChannelHandler", "(", ")", "{", "return", "new", "ObjectDecoder", "(", "ClassResolvers", ".", "weakCachingResolver", "(", "null", ")", ");", "}", "}", ";", "}", "@", "Override", "protected", "RouteBuilder", "createRouteBuilder", "(", ")", "throws", "Exception", "{", "return", "new", "RouteBuilder", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", ")", "throws", "Exception", "{", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port", "}", "}?", "sync", "=", "true", "\"", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "Object", "obj", "=", "exchange", ".", "getIn", "(", ").", "getBody", "(", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "obj", ")", ";", "}", "}", ");", "from", "(", "\"", "netty", ":", "tcp", ":", "//", "localhost", ":", "{{", "port2", "}", "}?", "sync", "=", "true", "&", "decoders", "=", "#", "decoder", "&", "encoders", "=", "#", "encoder", "\"", ")", ".", "process", "(", "new", "Processor", "(", ")", "{", "public", "void", "process", "(", "Exchange", "exchange", ")", "throws", "Exception", "{", "Object", "obj", "=", "exchange", ".", "getIn", "(", ").", "getBody", "(", ");", "exchange", ".", "getOut", "(", ").", "setBody", "(", "obj", ")", ";", "}", "}", ");", "}", "}", ";", "}", "}", "@", "@", "-", "543", ",", "7", "+", "543", ",", "8", "@", "@", "default", "NettyEndpointConsumerBuilder", "encoding", "(", "String", "encoding", ")", "{", "/", "**", "*", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "*", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", "-", "however", "only", "*", "Strings", "are", "allowed", "to", "be", "serialized", "by", "default", ".", "*", "*", "The", "option", "is", "a", ":", "<", "code", ">", "boolean", "<", "/", "code", ">", "type", ".", "*", "@", "@", "-", "557", ",", "7", "+", "558", ",", "8", "@", "@", "default", "NettyEndpointConsumerBuilder", "textline", "(", "boolean", "textline", ")", "{", "/", "**", "*", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "*", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", "-", "however", "only", "*", "Strings", "are", "allowed", "to", "be", "serialized", "by", "default", ".", "*", "*", "The", "option", "will", "be", "converted", "to", "a", "<", "code", ">", "boolean", "<", "/", "code", ">", "type", ".", "*", "@", "@", "-", "2041", ",", "7", "+", "2043", ",", "8", "@", "@", "default", "NettyEndpointProducerBuilder", "encoding", "(", "String", "encoding", ")", "{", "/", "**", "*", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "*", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", "-", "however", "only", "*", "Strings", "are", "allowed", "to", "be", "serialized", "by", "default", ".", "*", "*", "The", "option", "is", "a", ":", "<", "code", ">", "boolean", "<", "/", "code", ">", "type", ".", "*", "@", "@", "-", "2055", ",", "7", "+", "2058", ",", "8", "@", "@", "default", "NettyEndpointProducerBuilder", "textline", "(", "boolean", "textline", ")", "{", "/", "**", "*", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "*", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", "-", "however", "only", "*", "Strings", "are", "allowed", "to", "be", "serialized", "by", "default", ".", "*", "*", "The", "option", "will", "be", "converted", "to", "a", "<", "code", ">", "boolean", "<", "/", "code", ">", "type", ".", "*", "@", "@", "-", "3377", ",", "7", "+", "3381", ",", "8", "@", "@", "default", "NettyEndpointBuilder", "encoding", "(", "String", "encoding", ")", "{", "/", "**", "*", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "*", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", "-", "however", "only", "*", "Strings", "are", "allowed", "to", "be", "serialized", "by", "default", ".", "*", "*", "The", "option", "is", "a", ":", "<", "code", ">", "boolean", "<", "/", "code", ">", "type", ".", "*", "@", "@", "-", "3391", ",", "7", "+", "3396", ",", "8", "@", "@", "default", "NettyEndpointBuilder", "textline", "(", "boolean", "textline", ")", "{", "/", "**", "*", "Only", "used", "for", "TCP", ".", "If", "no", "codec", "is", "specified", ",", "you", "can", "use", "this", "flag", "to", "*", "indicate", "a", "text", "line", "based", "codec", ";", "if", "not", "specified", "or", "the", "value", "is", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", ".", "*", "false", ",", "then", "Object", "Serialization", "is", "assumed", "over", "TCP", "-", "however", "only", "*", "Strings", "are", "allowed", "to", "be", "serialized", "by", "default", ".", "*", "*", "The", "option", "will", "be", "converted", "to", "a", "<", "code", ">", "boolean", "<", "/", "code", ">", "type", ".", "*"], "docstring_tokens": ["execute", "arbitrary", "code", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "202", ",", "7", "+", "202", ",", "7", "@", "@", "public", "void", "doIndex", "(", "StaplerResponse", "rsp", ")", "throws", "IOException", "{", "@", "WebMethod", "(", "name", "=", "\"", "heapdump", ".", "hprof", "\"", ")", "public", "void", "doHeapDump", "(", "StaplerRequest", "req", ",", "StaplerResponse", "rsp", ")", "throws", "IOException", ",", "InterruptedException", "{", "owner", ".", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "owner", ".", "checkPermission", "(", "Jenkins", ".", "RUN_SCRIPTS", ")", ";", "rsp", ".", "setContentType", "(", "\"", "application", "/", "octet", "-", "stream", "\"", ");", "FilePath", "dump", "=", "obtain", "(", ");"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1700", ",", "7", "+", "1700", ",", "7", "@", "@", "int", "main", "(", "int", "argc", ",", "char", "*", "argv", "[", "])", "{", "FILE", "*", "fp", ";", "long", "position", ";", "char", "*", "filename", "=", "\"", "/", "tmp", "/", "phpglibccheck", "\"", ";", "char", "*", "filename", "=", "tmpnam", "(", "NULL", ")", ";", "fp", "=", "fopen", "(", "filename", ",", "\"", "w", "\"", ");", "if", "(", "fp", "=", "=", "NULL", ")", "{"], "docstring_tokens": ["overwrite", "arbitrary", "files", "on", "the", "system", "with", "elevated", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "29", ",", "10", "+", "29", ",", "9", "@", "@", "static", "inline", "void", "mac_fix_string", "(", "char", "*", "stg", ",", "int", "len", ")", "int", "mac_partition", "(", "struct", "parsed_partitions", "*", "state", ")", "{", "int", "slot", "=", "1", ";", "Sector", "sect", ";", "unsigned", "char", "*", "data", ";", "int", "blk", ",", "blocks_in_map", ";", "int", "slot", ",", "blocks_in_map", ";", "unsigned", "secsize", ";", "#", "ifdef", "CONFIG_PPC_PMAC", "int", "found_root", "=", "0", ";", "@", "@", "-", "59", ",", "10", "+", "58", ",", "14", "@", "@", "int", "mac_partition", "(", "struct", "parsed_partitions", "*", "state", ")", "put_dev_sector", "(", "sect", ")", ";", "return", "0", ";", "/", "*", "not", "a", "MacOS", "disk", "*", "/", "}", "strlcat", "(", "state", "-", ">", "pp_buf", ",", "\"", "[", "mac", "]", "\",", "PAGE_SIZE", ")", ";", "blocks_in_map", "=", "be32_to_cpu", "(", "part", "-", ">", "map_count", ")", ";", "for", "(", "blk", "=", "1", ";", "blk", "<", "=", "blocks_in_map", ";", "+", "+", "blk", ")", "{", "int", "pos", "=", "blk", "*", "secsize", ";", "if", "(", "blocks_in_map", "<", "0", "|", "|", "blocks_in_map", ">", "=", "DISK_MAX_PARTS", ")", "{", "put_dev_sector", "(", "sect", ")", ";", "return", "0", ";", "}", "strlcat", "(", "state", "-", ">", "pp_buf", ",", "\"", "[", "mac", "]", "\",", "PAGE_SIZE", ")", ";", "for", "(", "slot", "=", "1", ";", "slot", "<", "=", "blocks_in_map", ";", "+", "+", "slot", ")", "{", "int", "pos", "=", "slot", "*", "secsize", ";", "put_dev_sector", "(", "sect", ")", ";", "data", "=", "read_part_sector", "(", "state", ",", "pos", "/", "512", ",", "&", "sect", ")", ";", "if", "(", "!", "data", ")", "@", "@", "-", "113", ",", "13", "+", "116", ",", "11", "@", "@", "int", "mac_partition", "(", "struct", "parsed_partitions", "*", "state", ")", "}", "if", "(", "goodness", ">", "found_root_goodness", ")", "{", "found_root", "=", "blk", ";", "found_root", "=", "slot", ";", "found_root_goodness", "=", "goodness", ";", "}", "}", "#", "endif", "/", "*", "CONFIG_PPC_PMAC", "*", "/", "+", "+", "slot", ";", "}", "#", "ifdef", "CONFIG_PPC_PMAC", "if", "(", "found_root_goodness", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(panic", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "20", ",", "11", "+", "20", ",", "10", "@", "@", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilder", ";", "import", "javax", ".", "xml", ".", "parsers", ".", "DocumentBuilderFactory", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "tuple", ".", "ImmutablePair", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "tuple", ".", "Pair", ";", "import", "org", ".", "apache", ".", "cxf", ".", "staxutils", ".", "StaxUtils", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "org", ".", "w3c", ".", "dom", ".", "Document", ";", "@", "@", "-", "52", ",", "11", "+", "51", ",", "8", "@", "@", "public", "void", "setAuthorizations", "(", "final", "String", "authorizations", ")", "{", "private", "void", "init", "(", ")", "{", "authMap", "=", "new", "HashMap", "<", "Pair", "<", "String", ",", "String", ">", ",", "String", ">", "()", ";", "DocumentBuilderFactory", "dbf", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ");", "dbf", ".", "setNamespaceAware", "(", "true", ")", ";", "try", "{", "DocumentBuilder", "db", "=", "dbf", ".", "newDocumentBuilder", "(", ");", "Document", "doc", "=", "db", ".", "parse", "(", "getClass", "(", ").", "getResource", "(", "\"/", "\"", "+", "authorizations", ")", ".", "openStream", "(", "))", ";", "Document", "doc", "=", "StaxUtils", ".", "read", "(", "getClass", "(", ").", "getResource", "(", "\"/", "\"", "+", "authorizations", ")", ".", "openStream", "(", "))", ";", "doc", ".", "getDocumentElement", "(", ").", "normalize", "(", ");", "Node", "authNode", "=", "null", ";", "@", "@", "-", "24", ",", "8", "+", "24", ",", "11", "@", "@", "import", "java", ".", "util", ".", "zip", ".", "Deflater", ";", "import", "java", ".", "util", ".", "zip", ".", "ZipEntry", ";", "import", "java", ".", "util", ".", "zip", ".", "ZipOutputStream", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "OutputKeys", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXTransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "TransformerHandler", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamResult", ";", "@", "@", "-", "40", ",", "6", "+", "43", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "syncope", ".", "core", ".", "rest", ".", "data", ".", "ReportDataBinder", ";", "import", "org", ".", "apache", ".", "syncope", ".", "core", ".", "util", ".", "ApplicationContextProvider", ";", "import", "org", ".", "apache", ".", "syncope", ".", "core", ".", "util", ".", "ExceptionUtil", ";", "import", "org", ".", "apache", ".", "syncope", ".", "core", ".", "util", ".", "VoidURIResolver", ";", "import", "org", ".", "quartz", ".", "DisallowConcurrentExecution", ";", "import", "org", ".", "quartz", ".", "Job", ";", "import", "org", ".", "quartz", ".", "JobExecutionContext", ";", "@", "@", "-", "62", ",", "6", "+", "66", ",", "18", "@", "@", "*", "/", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "ReportJob", ".", "class", ")", ";", "private", "static", "final", "SAXTransformerFactory", "TRANSFORMER_FACTORY", ";", "static", "{", "TRANSFORMER_FACTORY", "=", "(", "SAXTransformerFactory", ")", "TransformerFactory", ".", "newInstance", "(", ");", "TRANSFORMER_FACTORY", ".", "setURIResolver", "(", "new", "VoidURIResolver", "(", "))", ";", "try", "{", "TRANSFORMER_FACTORY", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Could", "not", "enable", "secure", "XML", "processing", "\"", ",", "e", ")", ";", "}", "}", "/", "**", "*", "Report", "DAO", ".", "*", "/", "@", "@", "-", "119", ",", "8", "+", "135", ",", "7", "@", "@", "public", "void", "execute", "(", "final", "JobExecutionContext", "context", ")", "throws", "JobExecutionExcept", "ZipOutputStream", "zos", "=", "new", "ZipOutputStream", "(", "baos", ")", ";", "zos", ".", "setLevel", "(", "Deflater", ".", "BEST_COMPRESSION", ")", ";", "try", "{", "SAXTransformerFactory", "tFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "handler", "=", "tFactory", ".", "newTransformerHandler", "(", ");", "handler", "=", "TRANSFORMER_FACTORY", ".", "newTransformerHandler", "(", ");", "Transformer", "serializer", "=", "handler", ".", "getTransformer", "(", ");", "serializer", ".", "setOutputProperty", "(", "OutputKeys", ".", "ENCODING", ",", "SyncopeConstants", ".", "DEFAULT_ENCODING", ")", ";", "serializer", ".", "setOutputProperty", "(", "OutputKeys", ".", "INDENT", ",", "\"", "yes", "\"", ");", "@", "@", "-", "153", ",", "7", "+", "168", ",", "7", "@", "@", "public", "void", "execute", "(", "final", "JobExecutionContext", "context", ")", "throws", "JobExecutionExcept", "if", "(", "reportletClass", "!", "=", "null", ")", "{", "Reportlet", "<", "ReportletConf", ">", "autowired", "=", "(", "Reportlet", "<", "ReportletConf", ">", ")", "ApplicationContextProvider", ".", "getBeanFactory", "(", ").", "createBean", "(", "reportletClass", ",", "AbstractBeanDefinition", ".", "AUTOWIRE_BY_TYPE", ",", "false", ")", ";", "createBean", "(", "reportletClass", ",", "AbstractBeanDefinition", ".", "AUTOWIRE_BY_TYPE", ",", "false", ")", ";", "autowired", ".", "setConf", "(", "reportletConf", ")", ";", "/", "/", "invoke", "reportlet", "@", "@", "-", "29", ",", "13", "+", "29", ",", "13", "@", "@", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "zip", ".", "ZipInputStream", ";", "import", "javax", ".", "xml", ".", "transform", ".", "stream", ".", "StreamSource", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "optional", ".", "pipeline", ".", "components", ".", "sax", ".", "fop", ".", "FopSerializer", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "NonCachingPipeline", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "Pipeline", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "SAXPipelineComponent", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "component", ".", "XMLGenerator", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "component", ".", "XMLSerializer", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "component", ".", "XSLTTransformer", ";", "import", "org", ".", "apache", ".", "commons", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang3", ".", "ArrayUtils", ";", "import", "org", ".", "apache", ".", "syncope", ".", "common", ".", "report", ".", "ReportletConf", ";", "@", "@", "-", "195", ",", "28", "+", "195", ",", "32", "@", "@", "public", "void", "exportExecutionResult", "(", "final", "OutputStream", "os", ",", "final", "ReportExec", "report", "switch", "(", "format", ")", "{", "case", "HTML", ":", "XSLTTransformer", "xsl2html", "=", "new", "XSLTTransformer", "(", "getClass", "(", ").", "getResource", "(", "\"/", "report", "/", "report2html", ".", "xsl", "\"", "))", ";", "XSLTTransformer", "xsl2html", "=", "new", "XSLTTransformer", "(", "new", "StreamSource", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "report", "/", "report2html", ".", "xsl", "\"", "))", ");", "xsl2html", ".", "setParameters", "(", "parameters", ")", ";", "pipeline", ".", "addComponent", "(", "xsl2html", ")", ";", "pipeline", ".", "addComponent", "(", "XMLSerializer", ".", "createXHTMLSerializer", "(", "))", ";", "break", ";", "case", "PDF", ":", "XSLTTransformer", "xsl2pdf", "=", "new", "XSLTTransformer", "(", "getClass", "(", ").", "getResource", "(", "\"/", "report", "/", "report2fo", ".", "xsl", "\"", "))", ";", "XSLTTransformer", "xsl2pdf", "=", "new", "XSLTTransformer", "(", "new", "StreamSource", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "report", "/", "report2fo", ".", "xsl", "\"", "))", ");", "xsl2pdf", ".", "setParameters", "(", "parameters", ")", ";", "pipeline", ".", "addComponent", "(", "xsl2pdf", ")", ";", "pipeline", ".", "addComponent", "(", "new", "FopSerializer", "(", "MimeConstants", ".", "MIME_PDF", ")", ");", "break", ";", "case", "RTF", ":", "XSLTTransformer", "xsl2rtf", "=", "new", "XSLTTransformer", "(", "getClass", "(", ").", "getResource", "(", "\"/", "report", "/", "report2fo", ".", "xsl", "\"", "))", ";", "XSLTTransformer", "xsl2rtf", "=", "new", "XSLTTransformer", "(", "new", "StreamSource", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "report", "/", "report2fo", ".", "xsl", "\"", "))", ");", "xsl2rtf", ".", "setParameters", "(", "parameters", ")", ";", "pipeline", ".", "addComponent", "(", "xsl2rtf", ")", ";", "pipeline", ".", "addComponent", "(", "new", "FopSerializer", "(", "MimeConstants", ".", "MIME_RTF", ")", ");", "break", ";", "case", "CSV", ":", "XSLTTransformer", "xsl2csv", "=", "new", "XSLTTransformer", "(", "getClass", "(", ").", "getResource", "(", "\"/", "report", "/", "report2csv", ".", "xsl", "\"", "))", ";", "XSLTTransformer", "xsl2csv", "=", "new", "XSLTTransformer", "(", "new", "StreamSource", "(", "getClass", "(", ").", "getResourceAsStream", "(", "\"/", "report", "/", "report2csv", ".", "xsl", "\"", "))", ");", "xsl2csv", ".", "setParameters", "(", "parameters", ")", ";", "pipeline", ".", "addComponent", "(", "xsl2csv", ")", ";", "pipeline", ".", "addComponent", "(", "new", "TextSerializer", "(", "))", ";", "@", "@", "-", "0", ",", "0", "+", "1", ",", "201", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "or", "more", "*", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "distributed", "with", "*", "this", "work", "for", "additional", "information", "regarding", "copyright", "ownership", ".", "*", "The", "ASF", "licenses", "this", "file", "to", "You", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "*", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "syncope", ".", "core", ".", "rest", ".", "controller", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Templates", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXResult", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "SAXTransformerFactory", ";", "import", "javax", ".", "xml", ".", "transform", ".", "sax", ".", "TransformerHandler", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "SetupException", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "caching", ".", "CacheKey", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "component", ".", "CachingPipelineComponent", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "pipeline", ".", "util", ".", "StringRepresentation", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "AbstractSAXTransformer", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "SAXConsumer", ";", "import", "org", ".", "apache", ".", "cocoon", ".", "sax", ".", "util", ".", "SAXConsumerAdapter", ";", "import", "org", ".", "apache", ".", "syncope", ".", "core", ".", "util", ".", "VoidURIResolver", ";", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "public", "class", "XSLTTransformer", "extends", "AbstractSAXTransformer", "implements", "CachingPipelineComponent", "{", "private", "static", "final", "Logger", "LOG", "=", "LoggerFactory", ".", "getLogger", "(", "XSLTTransformer", ".", "class", ")", ";", "/", "**", "*", "A", "generic", "transformer", "factory", "to", "parse", "XSLTs", ".", "*", "/", "private", "static", "final", "SAXTransformerFactory", "TRAX_FACTORY", "=", "createNewSAXTransformerFactory", "(", ");", "/", "**", "*", "The", "XSLT", "parameters", "name", "pattern", ".", "*", "/", "private", "static", "final", "Pattern", "XSLT_PARAMETER_NAME_PATTERN", "=", "Pattern", ".", "compile", "(", "\"[", "a", "-", "zA", "-", "Z_", "]", "[\\", "\\", "w", "\\", "\\-", "\\\\", ".]", "*\"", ");", "/", "**", "*", "The", "XSLT", "parameters", "reference", ".", "*", "/", "private", "Map", "<", "String", ",", "Object", ">", "parameters", ";", "/", "**", "*", "The", "XSLT", "Template", "reference", ".", "*", "/", "private", "Templates", "templates", ";", "private", "Source", "source", ";", "public", "XSLTTransformer", "(", "final", "Source", "source", ")", "{", "super", "(", ");", "this", ".", "load", "(", "source", ",", "null", ")", ";", "}", "/", "**", "*", "Creates", "a", "new", "transformer", "reading", "the", "XSLT", "from", "the", "Source", "source", "and", "setting", "the", "TransformerFactory", "attributes", ".", "*", "*", "This", "constructor", "is", "useful", "when", "users", "want", "to", "perform", "XSLT", "transformation", "using", "<", "a", "*", "href", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "-", "j", "/", "xsltc_usage", ".", "html", "\"", ">", "xsltc", "<", "/", "a", ">", ".", "*", "*", "@", "param", "source", "the", "XSLT", "source", "*", "@", "param", "attributes", "the", "Transformer", "Factory", "attributes", "*", "/", "public", "XSLTTransformer", "(", "final", "Source", "source", ",", "final", "Map", "<", "String", ",", "Object", ">", "attributes", ")", "{", "super", "(", ");", "this", ".", "load", "(", "source", ",", "attributes", ")", ";", "}", "/", "**", "*", "Method", "useful", "to", "create", "a", "new", "transformer", "reading", "the", "XSLT", "from", "the", "URL", "source", "and", "setting", "the", "Transformer", "*", "Factory", "attributes", ".", "*", "*", "This", "method", "is", "useful", "when", "users", "want", "to", "perform", "XSLT", "transformation", "using", "<", "a", "*", "href", "=", "\"", "http", ":", "//", "xml", ".", "apache", ".", "org", "/", "xalan", "-", "j", "/", "xsltc_usage", ".", "html", "\"", ">", "xsltc", "<", "/", "a", ">", ".", "*", "*", "@", "param", "source", "the", "XSLT", "source", "*", "@", "param", "attributes", "the", "Transformer", "Factory", "attributes", "*", "/", "private", "void", "load", "(", "final", "Source", "source", ",", "final", "Map", "<", "String", ",", "Object", ">", "attributes", ")", "{", "if", "(", "source", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "The", "parameter", "'", "source", "'", "mustn", "'", "t", "be", "null", ".", "\")", ";", "}", "this", ".", "source", "=", "source", ";", "this", ".", "load", "(", "this", ".", "source", ",", "this", ".", "source", ".", "toString", "(", "),", "attributes", ")", ";", "}", "private", "void", "load", "(", "final", "Source", "source", ",", "final", "String", "localCacheKey", ",", "final", "Map", "<", "String", ",", "Object", ">", "attributes", ")", "{", "LOG", ".", "debug", "(", "\"{", "}", "local", "cache", "miss", ":", "{", "}\"", ",", "getClass", "(", ").", "getSimpleName", "(", "),", "localCacheKey", ")", ";", "/", "/", "XSLT", "has", "to", "be", "parsed", "final", "SAXTransformerFactory", "transformerFactory", ";", "if", "(", "attributes", "=", "=", "null", "|", "|", "attributes", ".", "isEmpty", "(", "))", "{", "transformerFactory", "=", "TRAX_FACTORY", ";", "}", "else", "{", "transformerFactory", "=", "createNewSAXTransformerFactory", "(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "attribute", ":", "attributes", ".", "entrySet", "(", "))", "{", "transformerFactory", ".", "setAttribute", "(", "attribute", ".", "getKey", "(", "),", "attribute", ".", "getValue", "(", "))", ";", "}", "}", "try", "{", "this", ".", "templates", "=", "transformerFactory", ".", "newTemplates", "(", "source", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "throw", "new", "SetupException", "(", "\"", "Impossible", "to", "read", "XSLT", "from", "'", "\"", "+", "source", "+", "\"", "',", "see", "nested", "exception", "\"", ",", "e", ")", ";", "}", "}", "/", "**", "*", "Sets", "the", "XSLT", "parameters", "to", "be", "applied", "to", "XSLT", "stylesheet", ".", "*", "*", "@", "param", "parameters", "the", "XSLT", "parameters", "to", "be", "applied", "to", "XSLT", "stylesheet", "*", "/", "public", "void", "setParameters", "(", "final", "Map", "<", "String", ",", "?", "extends", "Object", ">", "parameters", ")", "{", "if", "(", "parameters", "=", "=", "null", ")", "{", "this", ".", "parameters", "=", "null", ";", "}", "else", "{", "this", ".", "parameters", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "(", "parameters", ")", ";", "}", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/", "@", "Override", "protected", "void", "setSAXConsumer", "(", "final", "SAXConsumer", "consumer", ")", "{", "TransformerHandler", "transformerHandler", ";", "try", "{", "transformerHandler", "=", "TRAX_FACTORY", ".", "newTransformerHandler", "(", "this", ".", "templates", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "SetupException", "(", "\"", "Could", "not", "initialize", "transformer", "handler", ".", "\",", "e", ")", ";", "}", "if", "(", "this", ".", "parameters", "!", "=", "null", ")", "{", "final", "Transformer", "transformer", "=", "transformerHandler", ".", "getTransformer", "(", ");", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "entry", ":", "this", ".", "parameters", ".", "entrySet", "(", "))", "{", "final", "String", "name", "=", "entry", ".", "getKey", "(", ");", "/", "/", "is", "valid", "XSLT", "parameter", "name", "if", "(", "XSLT_PARAMETER_NAME_PATTERN", ".", "matcher", "(", "name", ")", ".", "matches", "(", "))", "{", "transformer", ".", "setParameter", "(", "name", ",", "entry", ".", "getValue", "(", "))", ";", "}", "}", "}", "final", "SAXResult", "result", "=", "new", "SAXResult", "(", ");", "result", ".", "setHandler", "(", "consumer", ")", ";", "/", "/", "According", "to", "TrAX", "specs", ",", "all", "TransformerHandlers", "are", "LexicalHandlers", "result", ".", "setLexicalHandler", "(", "consumer", ")", ";", "transformerHandler", ".", "setResult", "(", "result", ")", ";", "final", "SAXConsumerAdapter", "saxConsumerAdapter", "=", "new", "SAXConsumerAdapter", "(", ");", "saxConsumerAdapter", ".", "setContentHandler", "(", "transformerHandler", ")", ";", "super", ".", "setSAXConsumer", "(", "saxConsumerAdapter", ")", ";", "}", "@", "Override", "public", "CacheKey", "constructCacheKey", "(", ")", "{", "return", "null", ";", "}", "/", "**", "*", "Utility", "method", "to", "create", "a", "new", "transformer", "factory", ".", "*", "*", "@", "return", "a", "new", "transformer", "factory", "*", "/", "private", "static", "SAXTransformerFactory", "createNewSAXTransformerFactory", "(", ")", "{", "SAXTransformerFactory", "transformerFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", ".", "setURIResolver", "(", "new", "VoidURIResolver", "(", "))", ";", "try", "{", "transformerFactory", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "Could", "not", "enable", "secure", "XML", "processing", "\"", ",", "e", ")", ";", "}", "return", "transformerFactory", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "StringRepresentation", ".", "buildString", "(", "this", ",", "\"", "src", "=", "<\"", "+", "this", ".", "source", "+", "\"", ">\"", ");", "}", "}", "@", "@", "-", "40", ",", "6", "+", "40", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "TreeMap", ";", "import", "java", ".", "util", ".", "TreeSet", ";", "import", "javax", ".", "xml", ".", "XMLConstants", ";", "import", "javax", ".", "xml", ".", "transform", ".", "OutputKeys", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Transformer", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerConfigurationException", ";", "@", "@", "-", "346", ",", "6", "+", "347", ",", "8", "@", "@", "public", "void", "export", "(", "final", "OutputStream", "os", ",", "final", "String", "wfTablePrefix", ")", "StreamResult", "streamResult", "=", "new", "StreamResult", "(", "os", ")", ";", "final", "SAXTransformerFactory", "transformerFactory", "=", "(", "SAXTransformerFactory", ")", "SAXTransformerFactory", ".", "newInstance", "(", ");", "transformerFactory", ".", "setURIResolver", "(", "new", "VoidURIResolver", "(", "))", ";", "transformerFactory", ".", "setFeature", "(", "XMLConstants", ".", "FEATURE_SECURE_PROCESSING", ",", "true", ")", ";", "TransformerHandler", "handler", "=", "transformerFactory", ".", "newTransformerHandler", "(", ");", "Transformer", "serializer", "=", "handler", ".", "getTransformer", "(", ");", "@", "@", "-", "0", ",", "0", "+", "1", ",", "35", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "*", "software", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "*", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "*", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "*", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "syncope", ".", "core", ".", "util", ";", "import", "javax", ".", "xml", ".", "transform", ".", "Source", ";", "import", "javax", ".", "xml", ".", "transform", ".", "TransformerException", ";", "import", "javax", ".", "xml", ".", "transform", ".", "URIResolver", ";", "/", "**", "*", "This", "implementation", "disallows", "any", "XSLT", "include", ",", "for", "security", "reasons", ".", "*", "/", "public", "class", "VoidURIResolver", "implements", "URIResolver", "{", "@", "Override", "public", "Source", "resolve", "(", "final", "String", "href", ",", "final", "String", "base", ")", "throws", "TransformerException", "{", "return", "null", ";", "}", "}"], "docstring_tokens": ["reveal", "partial", "information", "about", "user", "password", "hashes"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "142", ",", "7", "+", "142", ",", "7", "@", "@", "static", "void", "dump_one_vdso_page", "(", "struct", "page", "*", "pg", ",", "struct", "page", "*", "upg", ")", "printk", "(", "\"", "kpg", ":", "%", "p", "(", "c", ":", "%", "d", ",", "f", ":", "%", "08lx", ")", "\",", "__va", "(", "page_to_pfn", "(", "pg", ")", "<", "<", "PAGE_SHIFT", ")", ",", "page_count", "(", "pg", ")", ",", "pg", "-", ">", "flags", ")", ";", "if", "(", "upg", "/", "*", "&", "&", "pg", "!", "=", "upg", "*", "/)", "{", "if", "(", "upg", "&", "&", "!", "IS_ERR", "(", "upg", ")", "/", "*", "&", "&", "pg", "!", "=", "upg", "*", "/)", "{", "printk", "(", "\"", "upg", ":", "%", "p", "(", "c", ":", "%", "d", ",", "f", ":", "%", "08lx", ")", "\",", "__va", "(", "page_to_pfn", "(", "upg", ")", "<", "<", "PAGE_SHIFT", ")", ",", "page_count", "(", "upg", ")", ",", "@", "@", "-", "999", ",", "17", "+", "999", ",", "15", "@", "@", "struct", "page", "*", "follow_page", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "address", ",", "goto", "no_page_table", ";", "ptep", "=", "pte_offset_map_lock", "(", "mm", ",", "pmd", ",", "address", ",", "&", "ptl", ")", ";", "if", "(", "!", "ptep", ")", "goto", "out", ";", "pte", "=", "*", "ptep", ";", "if", "(", "!", "pte_present", "(", "pte", ")", ")", "goto", "unlock", ";", "goto", "no_page", ";", "if", "(", "(", "flags", "&", "FOLL_WRITE", ")", "&", "&", "!", "pte_write", "(", "pte", ")", ")", "goto", "unlock", ";", "page", "=", "vm_normal_page", "(", "vma", ",", "address", ",", "pte", ")", ";", "if", "(", "unlikely", "(", "!", "page", ")", ")", "goto", "unlock", ";", "goto", "bad_page", ";", "if", "(", "flags", "&", "FOLL_GET", ")", "get_page", "(", "page", ")", ";", "@", "@", "-", "1024", ",", "6", "+", "1022", ",", "15", "@", "@", "struct", "page", "*", "follow_page", "(", "struct", "vm_area_struct", "*", "vma", ",", "unsigned", "long", "address", ",", "out", ":", "return", "page", ";", "bad_page", ":", "pte_unmap_unlock", "(", "ptep", ",", "ptl", ")", ";", "return", "ERR_PTR", "(", "-", "EFAULT", ")", ";", "no_page", ":", "pte_unmap_unlock", "(", "ptep", ",", "ptl", ")", ";", "if", "(", "!", "pte_none", "(", "pte", ")", ")", "return", "page", ";", "/", "*", "Fall", "through", "to", "ZERO_PAGE", "handling", "*", "/", "no_page_table", ":", "/", "*", "*", "When", "core", "dumping", "an", "enormous", "anonymous", "area", "that", "nobody", "@", "@", "-", "1159", ",", "6", "+", "1166", ",", "8", "@", "@", "int", "get_user_pages", "(", "struct", "task_struct", "*", "tsk", ",", "struct", "mm_struct", "*", "mm", ",", "cond_resched", "(", ");", "}", "if", "(", "IS_ERR", "(", "page", ")", ")", "return", "i", "?", "i", ":", "PTR_ERR", "(", "page", ")", ";", "if", "(", "pages", ")", "{", "pages", "[", "i", "]", "=", "page", ";", "@", "@", "-", "865", ",", "6", "+", "865", ",", "11", "@", "@", "static", "int", "do_move_pages", "(", "struct", "mm_struct", "*", "mm", ",", "struct", "page_to_node", "*", "pm", ",", "goto", "set_status", ";", "page", "=", "follow_page", "(", "vma", ",", "pp", "-", ">", "addr", ",", "FOLL_GET", ")", ";", "err", "=", "PTR_ERR", "(", "page", ")", ";", "if", "(", "IS_ERR", "(", "page", ")", ")", "goto", "set_status", ";", "err", "=", "-", "ENOENT", ";", "if", "(", "!", "page", ")", "goto", "set_status", ";", "@", "@", "-", "928", ",", "6", "+", "933", ",", "11", "@", "@", "static", "int", "do_pages_stat", "(", "struct", "mm_struct", "*", "mm", ",", "struct", "page_to_node", "*", "pm", ")", "goto", "set_status", ";", "page", "=", "follow_page", "(", "vma", ",", "pm", "-", ">", "addr", ",", "0", ")", ";", "err", "=", "PTR_ERR", "(", "page", ")", ";", "if", "(", "IS_ERR", "(", "page", ")", ")", "goto", "set_status", ";", "err", "=", "-", "ENOENT", ";", "/", "*", "Use", "PageReserved", "to", "check", "for", "zero", "page", "*", "/", "if", "(", "!", "page", "|", "|", "PageReserved", "(", "page", ")", ")"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "58", ",", "6", "+", "58", ",", "7", "@", "@", "MAILSTREAM", "DEFAULTPROTO", ";", "#", "define", "CRLF", "\"", "\\", "015", "\\", "012", "\"", "#", "define", "PHP_EXPUNGE", "32768", "#", "define", "PHP_IMAP_ADDRESS_SIZE_BUF", "10", "static", "void", "_php_make_header_object", "(", "zval", "*", "myzvalue", ",", "ENVELOPE", "*", "en", "TSRMLS_DC", ")", ";", "static", "void", "_php_imap_add_body", "(", "zval", "*", "arg", ",", "BODY", "*", "body", "TSRMLS_DC", ")", ";", "@", "@", "-", "3546", ",", "7", "+", "3547", ",", "7", "@", "@", "PHP_FUNCTION", "(", "imap_mime_header_decode", ")", "static", "int", "_php_imap_address_size", "(", "ADDRESS", "*", "addresslist", ")", "{", "ADDRESS", "*", "tmp", ";", "int", "ret", "=", "0", ";", "int", "ret", "=", "0", ",", "num_ent", "=", "0", ";", "tmp", "=", "addresslist", ";", "@", "@", "-", "3555", ",", "10", "+", "3556", ",", "15", "@", "@", "static", "int", "_php_imap_address_size", "(", "ADDRESS", "*", "addresslist", ")", "ret", "+", "=", "(", "tmp", "-", ">", "adl", ")", "?", "strlen", "(", "tmp", "-", ">", "adl", ")", ":", "0", ";", "ret", "+", "=", "(", "tmp", "-", ">", "mailbox", ")", "?", "strlen", "(", "tmp", "-", ">", "mailbox", ")", ":", "0", ";", "ret", "+", "=", "(", "tmp", "-", ">", "host", ")", "?", "strlen", "(", "tmp", "-", ">", "host", ")", ":", "0", ";", "num_ent", "+", "+;", "}", "while", "(", "(", "tmp", "=", "tmp", "-", ">", "next", ")", ");", "/", "*", "rfc822_write_address_full", "(", ")", "needs", "some", "extra", "space", "for", "'", "<>", ",'", ",", "etc", ".", "*", "/", "ret", "+", "=", "(", "ret", ")", "?", "MAILTMPLEN", ":", "0", ";", "/", "*", "*", "rfc822_write_address_full", "(", ")", "needs", "some", "extra", "space", "for", "'", "<>", ",'", ",", "etc", ".", "*", "for", "this", "perpouse", "we", "allocate", "additional", "PHP_IMAP_ADDRESS_SIZE_BUF", "bytes", "*", "by", "default", "this", "buffer", "is", "10", "bytes", "long", "*", "/", "ret", "+", "=", "(", "ret", ")", "?", "num_ent", "*", "PHP_IMAP_ADDRESS_SIZE_BUF", ":", "0", ";", "return", "ret", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "3", "+", "1", ",", "9", "@", "@", "2019", "-", "04", "-", "23", "Dirk", "Frederickx", "(", "brushed", "AT", "apache", "DOT", "org", ")", "*", "2", ".", "11", ".", "0", "-", "M4", "-", "git", "-", "05", "*", "[", "JSPWIKI", "-", "1108", "]", "interwiki", "links", "with", "illegal", "characters", "causes", "XSS", "vulnerability", "2019", "-", "04", "-", "22", "Dirk", "Frederickx", "(", "brushed", "AT", "apache", "DOT", "org", ")", "*", "2", ".", "11", ".", "0", "-", "M4", "-", "git", "-", "04", "@", "@", "-", "72", ",", "7", "+", "72", ",", "7", "@", "@", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "<", "p", ">", "*", "If", "the", "build", "identifier", "is", "empty", ",", "it", "is", "not", "added", ".", "*", "/", "public", "static", "final", "String", "BUILD", "=", "\"", "04", "\"", ";", "public", "static", "final", "String", "BUILD", "=", "\"", "05", "\"", ";", "/", "**", "*", "This", "is", "the", "generic", "version", "string", "you", "should", "use", "when", "printing", "out", "the", "version", ".", "It", "is", "of", "@", "@", "-", "1315", ",", "7", "+", "1315", ",", "8", "@", "@", "else", "if", "(", "link", ".", "isInterwikiLink", "(", ")", ")", "}", "else", "{", "Object", "[", "]", "args", "=", "{", "extWiki", "}", ";", "Object", "[", "]", "args", "=", "{", "escapeHTMLEntities", "(", "extWiki", ")", "}", ";", "addElement", "(", "makeError", "(", "MessageFormat", ".", "format", "(", "rb", ".", "getString", "(", "\"", "markupparser", ".", "error", ".", "nointerwikiref", "\"", ")", ",", "args", ")", ")", ")", ";", "}", "}", "@", "@", "-", "2076", ",", "7", "+", "2077", ",", "7", "@", "@", "else", "if", "(", "Character", ".", "isLetter", "(", "(", "char", ")", "ch", ")", ")", "/", "/", "Pop", "out", "only", "spaces", ",", "so", "that", "the", "upcoming", "EOL", "check", "does", "not", "check", "the", "/", "/", "next", "line", ".", "/", "/", "if", "(", "ch", "=", "=", "'", "\\", "n", "'", "|", "|", "ch", "=", "=", "'", "\\", "r", "'", ")", "else", "if", "(", "ch", "=", "=", "'", "\\", "n", "'", "|", "|", "ch", "=", "=", "'", "\\", "r", "'", ")", "{", "pushBack", "(", "ch", ")", ";", "}"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "918", ",", "7", "+", "918", ",", "7", "@", "@", "vhost_scsi_handle_vq", "(", "struct", "vhost_scsi", "*", "vs", ",", "struct", "vhost_virtqueue", "*", "vq", ")", "struct", "iov_iter", "in_iter", ",", "prot_iter", ",", "data_iter", ";", "u64", "tag", ";", "u32", "exp_data_len", ",", "data_direction", ";", "int", "ret", ",", "prot_bytes", ";", "int", "ret", ",", "prot_bytes", ",", "c", "=", "0", ";", "u16", "lun", ";", "u8", "task_attr", ";", "bool", "t10_pi", "=", "vhost_has_feature", "(", "vq", ",", "VIRTIO_SCSI_F_T10_PI", ")", ";", "@", "@", "-", "938", ",", "7", "+", "938", ",", "7", "@", "@", "vhost_scsi_handle_vq", "(", "struct", "vhost_scsi", "*", "vs", ",", "struct", "vhost_virtqueue", "*", "vq", ")", "vhost_disable_notify", "(", "&", "vs", "-", ">", "dev", ",", "vq", ")", ";", "for", "(", ";;", ")", "{", "do", "{", "ret", "=", "vhost_scsi_get_desc", "(", "vs", ",", "vq", ",", "&", "vc", ")", ";", "if", "(", "ret", ")", "goto", "err", ";", "@", "@", "-", "1118", ",", "7", "+", "1118", ",", "7", "@", "@", "vhost_scsi_handle_vq", "(", "struct", "vhost_scsi", "*", "vs", ",", "struct", "vhost_virtqueue", "*", "vq", ")", "break", ";", "else", "if", "(", "ret", "=", "=", "-", "EIO", ")", "vhost_scsi_send_bad_target", "(", "vs", ",", "vq", ",", "vc", ".", "head", ",", "vc", ".", "out", ")", ";", "}", "}", "while", "(", "likely", "(", "!", "vhost_exceeds_weight", "(", "vq", ",", "+", "+", "c", ",", "0", ")", "))", ";", "out", ":", "mutex_unlock", "(", "&", "vq", "-", ">", "mutex", ")", ";", "}", "@", "@", "-", "1177", ",", "7", "+", "1177", ",", "7", "@", "@", "vhost_scsi_ctl_handle_vq", "(", "struct", "vhost_scsi", "*", "vs", ",", "struct", "vhost_virtqueue", "*", "vq", ")", "}", "v_req", ";", "struct", "vhost_scsi_ctx", "vc", ";", "size_t", "typ_size", ";", "int", "ret", ";", "int", "ret", ",", "c", "=", "0", ";", "mutex_lock", "(", "&", "vq", "-", ">", "mutex", ")", ";", "/", "*", "@", "@", "-", "1191", ",", "7", "+", "1191", ",", "7", "@", "@", "vhost_scsi_ctl_handle_vq", "(", "struct", "vhost_scsi", "*", "vs", ",", "struct", "vhost_virtqueue", "*", "vq", ")", "vhost_disable_notify", "(", "&", "vs", "-", ">", "dev", ",", "vq", ")", ";", "for", "(", ";;", ")", "{", "do", "{", "ret", "=", "vhost_scsi_get_desc", "(", "vs", ",", "vq", ",", "&", "vc", ")", ";", "if", "(", "ret", ")", "goto", "err", ";", "@", "@", "-", "1270", ",", "7", "+", "1270", ",", "7", "@", "@", "vhost_scsi_ctl_handle_vq", "(", "struct", "vhost_scsi", "*", "vs", ",", "struct", "vhost_virtqueue", "*", "vq", ")", "break", ";", "else", "if", "(", "ret", "=", "=", "-", "EIO", ")", "vhost_scsi_send_bad_target", "(", "vs", ",", "vq", ",", "vc", ".", "head", ",", "vc", ".", "out", ")", ";", "}", "}", "while", "(", "likely", "(", "!", "vhost_exceeds_weight", "(", "vq", ",", "+", "+", "c", ",", "0", ")", "))", ";", "out", ":", "mutex_unlock", "(", "&", "vq", "-", ">", "mutex", ")", ";", "}"], "docstring_tokens": ["the", "application", "to", "enter", "into", "an", "infinite", "loop"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "758", ",", "9", "+", "758", ",", "9", "@", "@", "static", "int", "iscsi_add_notunderstood_response", "(", "}", "INIT_LIST_HEAD", "(", "&", "extra_response", "-", ">", "er_list", ")", ";", "strncpy", "(", "extra_response", "-", ">", "key", ",", "key", ",", "strlen", "(", "key", ")", "+", "1", ")", ";", "strncpy", "(", "extra_response", "-", ">", "value", ",", "NOTUNDERSTOOD", ",", "strlen", "(", "NOTUNDERSTOOD", ")", "+", "1", ")", ";", "strlcpy", "(", "extra_response", "-", ">", "key", ",", "key", ",", "sizeof", "(", "extra_response", "-", ">", "key", ")", ");", "strlcpy", "(", "extra_response", "-", ">", "value", ",", "NOTUNDERSTOOD", ",", "sizeof", "(", "extra_response", "-", ">", "value", ")", ");", "list_add_tail", "(", "&", "extra_response", "-", ">", "er_list", ",", "&", "param_list", "-", ">", "extra_response_list", ")", ";", "@", "@", "-", "1629", ",", "8", "+", "1629", ",", "6", "@", "@", "int", "iscsi_decode_text_input", "(", "if", "(", "phase", "&", "PHASE_SECURITY", ")", "{", "if", "(", "iscsi_check_for_auth_key", "(", "key", ")", ">", "0", ")", "{", "char", "*", "tmpptr", "=", "key", "+", "strlen", "(", "key", ")", ";", "*", "tmpptr", "=", "'", "='", ";", "kfree", "(", "tmpbuf", ")", ";", "return", "1", ";", "}", "@", "@", "-", "1", ",", "8", "+", "1", ",", "10", "@", "@", "#", "ifndef", "ISCSI_PARAMETERS_H", "#", "define", "ISCSI_PARAMETERS_H", "#", "include", "<", "scsi", "/", "iscsi_proto", ".", "h", ">", "struct", "iscsi_extra_response", "{", "char", "key", "[", "64", "]", ";", "char", "key", "[", "KEY_MAXLEN", "]", ";", "char", "value", "[", "32", "]", ";", "struct", "list_head", "er_list", ";", "}", "____cacheline_aligned", ";"], "docstring_tokens": ["overflow", "a", "buffer", "and", "execute", "arbitrary", "code", "on", "the", "system", "or", "cause", "the", "application", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "889", ",", "6", "+", "889", ",", "7", "@", "@", "public", "HttpResponse", "doUploadPlugin", "(", "StaplerRequest", "req", ")", "throws", "IOException", ",", "Servl", "@", "Restricted", "(", "NoExternalUse", ".", "class", ")", "@", "RequirePOST", "public", "HttpResponse", "doCheckUpdatesServer", "(", ")", "throws", "IOException", "{", "Jenkins", ".", "getInstance", "(", ").", "checkPermission", "(", "Jenkins", ".", "ADMINISTER", ")", ";", "for", "(", "UpdateSite", "site", ":", "Jenkins", ".", "getInstance", "(", ").", "getUpdateCenter", "(", ").", "getSites", "(", "))", "{", "FormValidation", "v", "=", "site", ".", "updateDirectlyNow", "(", "DownloadService", ".", "signatureCheck", ")", ";", "if", "(", "v", ".", "kind", "!", "=", "FormValidation", ".", "Kind", ".", "OK", ")", "{"], "docstring_tokens": ["trigger", "updating", "of", "update", "site", "metadata"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "283", ",", "7", "+", "283", ",", "14", "@", "@", "NOKPROBE_SYMBOL", "(", "do_async_page_fault", ")", ";", "static", "void", "__init", "paravirt_ops_setup", "(", "void", ")", "{", "pv_info", ".", "name", "=", "\"", "KVM", "\"", ";", "pv_info", ".", "paravirt_enabled", "=", "1", ";", "/", "*", "*", "KVM", "isn", "'", "t", "paravirt", "in", "the", "sense", "of", "paravirt_enabled", ".", "A", "KVM", "*", "guest", "kernel", "works", "like", "a", "bare", "metal", "kernel", "with", "additional", "*", "features", ",", "and", "paravirt_enabled", "is", "about", "features", "that", "are", "*", "missing", ".", "*", "/", "pv_info", ".", "paravirt_enabled", "=", "0", ";", "if", "(", "kvm_para_has_feature", "(", "KVM_FEATURE_NOP_IO_DELAY", ")", ")", "pv_cpu_ops", ".", "io_delay", "=", "kvm_io_delay", ";", "@", "@", "-", "261", ",", "7", "+", "261", ",", "6", "@", "@", "void", "__init", "kvmclock_init", "(", "void", ")", "#", "endif", "kvm_get_preset_lpj", "(", ");", "clocksource_register_hz", "(", "&", "kvm_clock", ",", "NSEC_PER_SEC", ")", ";", "pv_info", ".", "paravirt_enabled", "=", "1", ";", "pv_info", ".", "name", "=", "\"", "KVM", "\"", ";", "if", "(", "kvm_para_has_feature", "(", "KVM_FEATURE_CLOCKSOURCE_STABLE_BIT", ")", ")"], "docstring_tokens": ["bypass", "the", "ASLR", "protection", "mechanism"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "105", ",", "75", "+", "105", ",", "12", "@", "@", "*", "/", "String", "hash", "(", "String", "plaintext", ",", "String", "salt", ",", "int", "iterations", ")", "throws", "EncryptionException", ";", "/", "**", "*", "Encrypts", "the", "provided", "plaintext", "and", "returns", "a", "ciphertext", "string", "using", "the", "*", "master", "secret", "key", "and", "default", "cipher", "transformation", ".", "*", "<", "/", "p", ">", "<", "p", ">", "*", "<", "b", ">", "Compatibility", "with", "earlier", "ESAPI", "versions", ":", "</", "b", ">", "The", "symmetric", "encryption", "*", "in", "ESAPI", "2", ".", "0", "and", "later", "is", "not", "compatible", "with", "the", "encryption", "in", "ESAPI", "1", ".", "4", "*", "or", "earlier", ".", "Not", "only", "are", "the", "interfaces", "slightly", "different", ",", "but", "they", "format", "*", "of", "the", "serialized", "encrypted", "data", "is", "incompatible", ".", "Therefore", ",", "if", "you", "have", "*", "encrypted", "data", "with", "ESAPI", "1", ".", "4", "or", "earlier", ",", "you", "must", "first", "encrypt", "it", "and", "*", "then", "re", "-", "encrypt", "it", "with", "ESAPI", "2", ".", "0", ".", "Backward", "compatibility", "with", "ESAPI", "1", ".", "4", "*", "was", "proposed", "to", "both", "the", "ESAPI", "Developers", "and", "ESAPI", "Users", "mailing", "lists", "*", "and", "voted", "down", ".", "More", "details", "are", "available", "in", "the", "ESAPI", "document", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "owasp", "-", "esapi", "-", "java", ".", "googlecode", ".", "com", "/", "svn", "/", "trunk", "/", "documentation", "/", "esapi4java", "-", "core", "-", "2", ".", "0", "-", "readme", "-", "crypto", "-", "changes", ".", "html", "\"", ">", "*", "Why", "Is", "OWASP", "Changing", "ESAPI", "Encryption", "?", "</", "a", ">", "*", "<", "/", "p", ">", "<", "p", ">", "*", "<", "b", ">", "Why", "this", "method", "is", "deprecated", ":", "</", "b", ">", "Most", "cryptographers", "strongly", "suggest", "*", "that", "if", "you", "are", "creating", "crypto", "functionality", "for", "general", "-", "purpose", "use", ",", "*", "at", "a", "minimum", "you", "should", "ensure", "that", "it", "provides", "authenticity", ",", "integrity", ",", "*", "and", "confidentiality", ".", "This", "method", "only", "provides", "confidentiality", ",", "but", "not", "*", "authenticity", "or", "integrity", ".", "Therefore", ",", "you", "are", "encouraged", "to", "use", "*", "one", "of", "the", "other", "encryption", "methods", "referenced", "below", ".", "Because", "this", "*", "method", "provides", "neither", "authenticity", "nor", "integrity", ",", "it", "may", "be", "*", "removed", "in", "some", "future", "ESAPI", "Java", "release", ".", "Note", ":", "there", "are", "some", "cases", "*", "where", "authenticity", "/", "integrity", "are", "not", "that", "important", ".", "For", "instance", ",", "consider", "*", "a", "case", "where", "the", "encrypted", "data", "is", "never", "out", "of", "your", "application", "'", "s", "control", ".", "For", "*", "example", ",", "if", "you", "receive", "data", "that", "your", "application", "is", "encrypting", "itself", "and", "then", "*", "storing", "the", "encrypted", "data", "in", "its", "own", "database", "for", "later", "use", "(", "and", "no", "other", "*", "applications", "can", "query", "or", "update", "that", "column", "of", "the", "database", ")", ",", "providing", "*", "confidentiality", "alone", "might", "be", "sufficient", ".", "However", ",", "if", "there", "are", "cases", "*", "where", "your", "application", "will", "be", "sending", "or", "receiving", "already", "encrypted", "data", "*", "over", "an", "insecure", ",", "unauthenticated", "channel", ",", "in", "such", "cases", "authenticity", "and", "*", "integrity", "of", "the", "encrypted", "data", "likely", "is", "important", "and", "this", "method", "should", "*", "be", "avoided", "in", "favor", "of", "one", "of", "the", "other", "two", ".", "*", "*", "@", "param", "plaintext", "*", "the", "plaintext", "{", "@", "code", "String", "}", "to", "encrypt", ".", "Note", "that", "if", "you", "are", "encrypting", "*", "general", "bytes", ",", "you", "should", "encypt", "that", "byte", "array", "to", "a", "String", "using", "*", "\"", "UTF", "-", "8", "\"", "encoding", ".", "*", "*", "@", "return", "*", "the", "encrypted", ",", "base64", "-", "encoded", "String", "representation", "of", "'", "plaintext", "'", "plus", "*", "the", "random", "IV", "used", ".", "*", "*", "@", "throws", "EncryptionException", "*", "if", "the", "specified", "encryption", "algorithm", "could", "not", "be", "found", "or", "another", "problem", "exists", "with", "*", "the", "encryption", "of", "'", "plaintext", "'", "*", "*", "@", "see", "#", "encrypt", "(", "PlainText", ")", "*", "@", "see", "#", "encrypt", "(", "SecretKey", ",", "PlainText", ")", "*", "*", "@", "deprecated", "As", "of", "1", ".", "4", ".", "2", ";", "use", "{", "@", "link", "#", "encrypt", "(", "PlainText", ")", "}", "instead", ",", "which", "*", "also", "ensures", "message", "authenticity", ".", "This", "method", "will", "be", "*", "completely", "removed", "as", "of", "the", "next", "major", "release", "or", "point", "*", "release", "(", "3", ".", "0", "or", "2", ".", "1", ",", "whichever", "comes", "first", ")", "as", "per", "OWASP", "*", "deprecation", "policy", ".", "*", "/", "@", "Deprecated", "String", "encrypt", "(", "String", "plaintext", ")", "throws", "EncryptionException", ";", "/", "**", "*", "Encrypts", "the", "provided", "plaintext", "bytes", "using", "the", "cipher", "transformation", "*", "specified", "by", "the", "property", "<", "code", ">", "Encryptor", ".", "CipherTransformation", "<", "/", "code", ">", "*", "and", "the", "<", "i", ">", "master", "encryption", "key", "<", "/", "i", ">", "as", "specified", "by", "the", "property", "*", "{", "@", "code", "Encryptor", ".", "MasterKey", "}", "as", "defined", "in", "the", "<", "code", ">", "ESAPI", ".", "properties", "<", "/", "code", ">", "file", ".", "*", "<", "/", "p", ">", "<", "p", ">", "*", "This", "method", "is", "preferred", "over", "{", "@", "link", "#", "encrypt", "(", "String", ")", "}", "because", "it", "also", "*", "allows", "encrypting", "of", "general", "byte", "streams", "rather", "than", "simply", "strings", "and", "*", "also", "because", "it", "returns", "a", "{", "@", "code", "CipherText", "}", "object", "and", "thus", "supports", "*", "cipher", "modes", "that", "require", "an", "Initialization", "Vector", "(", "IV", ")", ",", "such", "as", "*", "Cipher", "Block", "Chaining", "(", "CBC", ")", ".", "*", "<", "/", "p", ">", "*", "*", "@", "param", "plaintext", "The", "{", "@", "code", "PlainText", "}", "to", "be", "encrypted", ".", "*", "@", "return", "the", "{", "@", "code", "CipherText", "}", "object", "from", "which", "the", "raw", "ciphertext", ",", "the", "@", "@", "-", "217", ",", "68", "+", "154", ",", "11", "@", "@", "CipherText", "encrypt", "(", "SecretKey", "key", ",", "PlainText", "plaintext", ")", "throws", "EncryptionException", ";", "/", "**", "*", "Decrypts", "the", "provided", "ciphertext", "and", "returns", "a", "plaintext", "string", "using", "the", "*", "master", "secret", "key", "and", "default", "cipher", "transformation", ".", "*", "<", "/", "p", ">", "<", "p", ">", "*", "<", "b", ">", "Compatibility", "with", "earlier", "ESAPI", "versions", ":", "</", "b", ">", "The", "symmetric", "encryption", "*", "in", "ESAPI", "2", ".", "0", "and", "later", "is", "not", "compatible", "with", "the", "encryption", "in", "ESAPI", "1", ".", "4", "*", "or", "earlier", ".", "Not", "only", "are", "the", "interfaces", "slightly", "different", ",", "but", "they", "format", "*", "of", "the", "serialized", "encrypted", "data", "is", "incompatible", ".", "Therefore", ",", "if", "you", "have", "*", "encrypted", "data", "with", "ESAPI", "1", ".", "4", "or", "earlier", ",", "you", "must", "first", "encrypt", "it", "and", "*", "then", "re", "-", "encrypt", "it", "with", "ESAPI", "2", ".", "0", ".", "Backward", "compatibility", "with", "ESAPI", "1", ".", "4", "*", "was", "proposed", "to", "both", "the", "ESAPI", "Developers", "and", "ESAPI", "Users", "mailing", "lists", "*", "and", "voted", "down", ".", "More", "details", "are", "available", "in", "the", "ESAPI", "document", "*", "<", "a", "href", "=", "\"", "http", ":", "//", "owasp", "-", "esapi", "-", "java", ".", "googlecode", ".", "com", "/", "svn", "/", "trunk", "/", "documentation", "/", "esapi4java", "-", "core", "-", "2", ".", "0", "-", "readme", "-", "crypto", "-", "changes", ".", "html", "\"", ">", "*", "Why", "Is", "OWASP", "Changing", "ESAPI", "Encryption", "?", "</", "a", ">", "*", "<", "/", "p", ">", "<", "p", ">", "*", "<", "b", ">", "Why", "this", "method", "is", "deprecated", ":", "</", "b", ">", "Most", "cryptographers", "strongly", "suggest", "*", "that", "if", "you", "are", "creating", "crypto", "functionality", "for", "general", "-", "purpose", "use", ",", "*", "at", "a", "minimum", "you", "should", "ensure", "that", "it", "provides", "authenticity", ",", "integrity", ",", "*", "and", "confidentiality", ".", "This", "method", "only", "provides", "confidentiality", ",", "but", "not", "*", "authenticity", "or", "integrity", ".", "Therefore", ",", "you", "are", "encouraged", "to", "use", "*", "one", "of", "the", "other", "encryption", "methods", "referenced", "below", ".", "Because", "this", "*", "method", "provides", "neither", "authenticity", "nor", "integrity", ",", "it", "may", "be", "*", "removed", "in", "some", "future", "ESAPI", "Java", "release", ".", "Note", ":", "there", "are", "some", "cases", "*", "where", "authenticity", "/", "integrity", "are", "not", "that", "important", ".", "For", "instance", ",", "consider", "*", "a", "case", "where", "the", "encrypted", "data", "is", "never", "out", "of", "your", "application", "'", "s", "control", ".", "For", "*", "example", ",", "if", "you", "receive", "data", "that", "your", "application", "is", "encrypting", "itself", "and", "then", "*", "storing", "the", "encrypted", "data", "in", "its", "own", "database", "for", "later", "use", "(", "and", "no", "other", "*", "applications", "can", "query", "or", "update", "that", "column", "of", "the", "database", ")", ",", "providing", "*", "confidentiality", "alone", "might", "be", "sufficient", ".", "However", ",", "if", "there", "are", "cases", "*", "where", "your", "application", "will", "be", "sending", "or", "receiving", "already", "encrypted", "data", "*", "over", "an", "insecure", ",", "unauthenticated", "channel", ",", "in", "such", "cases", "authenticity", "and", "*", "integrity", "of", "the", "encrypted", "data", "likely", "is", "important", "and", "this", "method", "should", "*", "be", "avoided", "in", "favor", "of", "one", "of", "the", "other", "two", ".", "*", "*", "@", "param", "ciphertext", "*", "the", "ciphertext", "(", "the", "encrypted", "plaintext", ")", "that", "resulted", "from", "*", "encrypting", "using", "the", "method", "{", "@", "link", "#", "encrypt", "(", "String", ")", "}.", "*", "*", "@", "return", "*", "the", "decrypted", "ciphertext", "(", "i", ".", "e", ".", ",", "the", "corresponding", "plaintext", ")", ".", "*", "*", "@", "throws", "EncryptionException", "*", "if", "the", "specified", "encryption", "algorithm", "could", "not", "be", "found", "or", "another", "problem", "exists", "with", "*", "the", "decryption", "of", "'", "plaintext", "'", "*", "*", "@", "deprecated", "As", "of", "1", ".", "4", ".", "2", ";", "use", "{", "@", "link", "#", "decrypt", "(", "CipherText", ")", "}", "instead", ",", "which", "*", "also", "ensures", "message", "authenticity", ".", "This", "method", "will", "be", "*", "completely", "removed", "as", "of", "the", "next", "major", "release", "or", "point", "*", "release", "(", "3", ".", "0", "or", "2", ".", "1", ",", "whichever", "comes", "first", ")", "as", "per", "OWASP", "*", "deprecation", "policy", ".", "*", "/", "@", "Deprecated", "String", "decrypt", "(", "String", "ciphertext", ")", "throws", "EncryptionException", ";", "/", "**", "*", "Decrypts", "the", "provided", "{", "@", "link", "CipherText", "}", "using", "the", "information", "from", "it", "*", "and", "the", "<", "i", ">", "master", "encryption", "key", "<", "/", "i", ">", "as", "specified", "by", "the", "property", "*", "{", "@", "code", "Encryptor", ".", "MasterKey", "}", "as", "defined", "in", "the", "{", "@", "code", "ESAPI", ".", "properties", "}", "*", "file", ".", "*", "<", "/", "p", ">", "<", "p", ">", "*", "This", "decrypt", "method", "is", "to", "be", "preferred", "over", "the", "deprecated", "*", "{", "@", "link", "#", "decrypt", "(", "String", ")", "}", "method", "because", "this", "method", "can", "handle", "plaintext", "*", "bytes", "that", "were", "encrypted", "with", "cipher", "modes", "requiring", "IVs", ",", "such", "as", "CBC", ".", "*", "<", "/", "p", ">", "*", "@", "param", "ciphertext", "The", "{", "@", "code", "CipherText", "}", "object", "to", "be", "decrypted", ".", "*", "@", "return", "The", "{", "@", "code", "PlainText", "}", "object", "resulting", "from", "decrypting", "the", "specified", "@", "@", "-", "65", ",", "7", "+", "65", ",", "9", "@", "@", "/", "/", "reflected", "in", "the", "class", "CipherTextSerializer", ".", "/", "/", "This", "should", "be", "*", "same", "*", "version", "as", "in", "CipherTextSerializer", "and", "KeyDerivationFunction", ".", "/", "/", "If", "one", "changes", ",", "the", "other", "should", "as", "well", "to", "accommodate", "any", "differences", ".", "public", "static", "final", "int", "cipherTextVersion", "=", "20110203", ";", "/", "/", "Format", ":", "YYYYMMDD", ",", "max", "is", "99991231", ".", "/", "/", "Previous", "versions", ":", "20110203", "-", "Original", "version", "(", "ESAPI", "releases", "2", ".", "0", "&", "2", ".", "0", ".", "1", ")", "/", "/", "20130830", "-", "Fix", "to", "issue", "#", "306", "(", "release", "2", ".", "1", ".", "0", ")", "public", "static", "final", "int", "cipherTextVersion", "=", "20130830", ";", "/", "/", "Format", ":", "YYYYMMDD", ",", "max", "is", "99991231", ".", "/", "/", "Required", "by", "Serializable", "classes", ".", "private", "static", "final", "long", "serialVersionUID", "=", "cipherTextVersion", ";", "/", "/", "Format", ":", "YYYYMMDD", "@", "@", "-", "435", ",", "21", "+", "437", ",", "23", "@", "@", "void", "storeSeparateMAC", "(", "byte", "[", "]", "macValue", ")", "{", "*", "@", "return", "True", "if", "the", "ciphertext", "has", "not", "be", "tampered", "with", ",", "and", "false", "otherwise", ".", "*", "/", "public", "boolean", "validateMAC", "(", "SecretKey", "authKey", ")", "{", "boolean", "usesMAC", "=", "ESAPI", ".", "securityConfiguration", "(", ").", "useMACforCipherText", "(", ");", "boolean", "requiresMAC", "=", "ESAPI", ".", "securityConfiguration", "(", ").", "useMACforCipherText", "(", ");", "if", "(", "usesMAC", "&", "&", "macComputed", "(", ")", ")", "{", "/", "/", "Uses", "MAC", "and", "it", "was", "computed", "if", "(", "requiresMAC", "&", "&", "macComputed", "(", ")", ")", "{", "/", "/", "Uses", "MAC", "and", "it", "was", "computed", "/", "/", "Calculate", "MAC", "from", "HMAC", "-", "SHA1", "(", "nonce", ",", "IV", "+", "plaintext", ")", "and", "/", "/", "compare", "to", "stored", "value", "(", "separate_mac_", ")", ".", "If", "same", ",", "then", "return", "true", ",", "/", "/", "else", "return", "false", ".", "byte", "[", "]", "mac", "=", "computeMAC", "(", "authKey", ")", ";", "assert", "mac", ".", "length", "=", "=", "separate_mac_", ".", "length", ":", "\"", "MACs", "are", "of", "differnt", "lengths", ".", "Should", "both", "be", "the", "same", ".", "\";", "return", "CryptoHelper", ".", "arrayCompare", "(", "mac", ",", "separate_mac_", ")", ";", "/", "/", "Safe", "compare", "!", "!!", "}", "else", "if", "(", "!", "usesMAC", ")", "{", "/", "/", "Doesn", "'", "t", "use", "MAC", "}", "else", "if", "(", "!", "requiresMAC", ")", "{", "/", "/", "Doesn", "'", "t", "require", "a", "MAC", "return", "true", ";", "}", "else", "{", "/", "/", "Uses", "MAC", "but", "it", "has", "not", "been", "computed", "/", "stored", ".", "logger", ".", "warning", "(", "Logger", ".", "SECURITY_FAILURE", ",", "\"", "Cannot", "validate", "MAC", "as", "it", "was", "never", "computed", "and", "stored", ".", "\"", "+", "\"", "Decryption", "result", "may", "be", "garbage", "even", "when", "decryption", "succeeds", ".", "\")", ";", "return", "true", ";", "/", "/", "Need", "to", "return", "'", "true", "'", "here", "because", "of", "encrypt", "(", ")", "/", "decrypt", "(", ")", "methods", "don", "'", "t", "support", "this", ".", "}", "else", "{", "/", "/", "This", "*", "used", "*", "to", "be", "the", "case", "(", "for", "versions", "2", ".", "0", "and", "2", ".", "0", ".", "1", ")", "where", "we", "tried", "to", "/", "/", "accomodate", "the", "deprecated", "decrypt", "(", ")", "method", "from", "ESAPI", "1", ".", "4", ".", "Unfortunately", ",", "/", "/", "that", "was", "an", "EPIC", "FAIL", ".", "(", "See", "Google", "Issue", "#", "306", "for", "details", ".", ")", "logger", ".", "warning", "(", "Logger", ".", "SECURITY_FAILURE", ",", "\"", "MAC", "may", "have", "been", "tampered", "with", "(", "e", ".", "g", ".", ",", "length", "set", "to", "0", ")", ".\"", ");", "return", "false", ";", "/", "/", "Deprecated", "decrypt", "(", ")", "method", "removed", ",", "so", "now", "return", "false", ".", "}", "}", "@", "@", "-", "474", ",", "8", "+", "478", ",", "8", "@", "@", "public", "boolean", "validateMAC", "(", "SecretKey", "authKey", ")", "{", "/", "/", "If", "we", "are", "supposed", "to", "be", "using", "a", "(", "separate", ")", "MAC", ",", "also", "make", "sure", "/", "/", "that", "it", "has", "been", "computed", "/", "stored", ".", "boolean", "usesMAC", "=", "ESAPI", ".", "securityConfiguration", "(", ").", "useMACforCipherText", "(", ");", "if", "(", "usesMAC", "&", "&", "!", "macComputed", "(", ")", ")", "{", "boolean", "requiresMAC", "=", "ESAPI", ".", "securityConfiguration", "(", ").", "useMACforCipherText", "(", ");", "if", "(", "requiresMAC", "&", "&", "!", "macComputed", "(", ")", ")", "{", "String", "msg", "=", "\"", "Programming", "error", ":", "MAC", "is", "required", "for", "this", "cipher", "mode", "(", "\"", "+", "getCipherMode", "(", ")", "+", "\"", "),", "but", "MAC", "has", "not", "yet", "been", "\"", "+", "\"", "computed", "and", "stored", ".", "Call", "the", "method", "\"", "+", "@", "@", "-", "32", ",", "7", "+", "32", ",", "9", "@", "@", "public", "class", "CipherTextSerializer", "{", "/", "/", "This", "should", "be", "*", "same", "*", "version", "as", "in", "CipherText", "&", "KeyDerivationFunction", ".", "/", "/", "If", "one", "changes", ",", "the", "other", "should", "as", "well", "to", "accommodate", "any", "differences", ".", "public", "static", "final", "int", "cipherTextSerializerVersion", "=", "20110203", ";", "/", "/", "Format", ":", "YYYYMMDD", ",", "max", "is", "99991231", ".", "/", "/", "Previous", "versions", ":", "20110203", "-", "Original", "version", "(", "ESAPI", "releases", "2", ".", "0", "&", "2", ".", "0", ".", "1", ")", "/", "/", "20130830", "-", "Fix", "to", "issue", "#", "306", "(", "release", "2", ".", "1", ".", "0", ")", "public", "static", "final", "int", "cipherTextSerializerVersion", "=", "20130830", ";", "/", "/", "Format", ":", "YYYYMMDD", ",", "max", "is", "99991231", ".", "private", "static", "final", "long", "serialVersionUID", "=", "cipherTextSerializerVersion", ";", "private", "static", "final", "Logger", "logger", "=", "ESAPI", ".", "getLogger", "(", "\"", "CipherTextSerializer", "\"", ");", "@", "@", "-", "234", ",", "7", "+", "236", ",", "7", "@", "@", "private", "CipherText", "convertToCipherText", "(", "byte", "[", "]", "cipherTextSerializedBytes", ")", "debug", "(", "\"", "kdfPrf", ":", "\"", "+", "kdfPrf", ")", ";", "assert", "kdfPrf", ">", "=", "0", "&", "&", "kdfPrf", "<", "=", "15", ":", "\"", "kdfPrf", "=", "=", "\"", "+", "kdfPrf", "+", "\"", "must", "be", "between", "0", "and", "15", ".", "\";", "int", "kdfVers", "=", "(", "kdfInfo", "&", "0x07ffffff", ")", ";", "assert", "kdfVers", ">", "0", "&", "&", "kdfVers", "<", "=", "99991231", ":", "\"", "KDF", "Version", "(", "\"", "+", "kdfVers", "+", "\"", ")", "out", "of", "range", ".", "\";", "/", "/", "Really", "should", "be", ">", "=", "20110203", "(", "earliest", ")", ".", "assert", "kdfVers", ">", "=", "20110203", "&", "&", "kdfVers", "<", "=", "99991231", ":", "\"", "KDF", "Version", "(", "\"", "+", "kdfVers", "+", "\"", ")", "out", "of", "range", ".", "\";", "/", "/", "20110203", "(", "orig", "version", ")", ".", "debug", "(", "\"", "convertToCipherText", ":", "kdfPrf", "=", "\"", "+", "kdfPrf", "+", "\"", ",", "kdfVers", "=", "\"", "+", "kdfVers", ")", ";", "if", "(", "kdfVers", "!", "=", "CipherText", ".", "cipherTextVersion", ")", "{", "/", "/", "NOTE", ":", "In", "future", ",", "support", "backward", "compatibility", "via", "this", "mechanism", ".", "When", "we", "do", "this", "@", "@", "-", "49", ",", "12", "+", "49", ",", "15", "@", "@", "*", "{", "@", "link", "CipherTextSerializer", "#", "cipherTextSerializerVersion", "}", "to", "make", "sure", "*", "that", "these", "classes", "are", "all", "kept", "in", "-", "sync", "in", "order", "to", "support", "backward", "*", "compatibility", "of", "previously", "encrypted", "data", ".", "*", "*", "<", "pre", ">", "*", "Previous", "versions", ":", "20110203", "-", "Original", "version", "(", "ESAPI", "releases", "2", ".", "0", "&", "2", ".", "0", ".", "1", ")", "*", "20130830", "-", "Fix", "to", "issue", "#", "306", "(", "release", "2", ".", "1", ".", "0", ")", "*", "<", "/", "pre", ">", "*", "@", "see", "CipherTextSerializer", "#", "asSerializedByteArray", "(", ")", "*", "@", "see", "CipherText", "#", "asPortableSerializedByteArray", "(", ")", "*", "@", "see", "CipherText", "#", "fromPortableSerializedBytes", "(", "byte", "[", "])", "*", "/", "public", "static", "final", "int", "kdfVersion", "=", "20110203", ";", "/", "/", "Format", ":", "YYYYMMDD", ",", "max", "is", "99991231", ".", "public", "static", "final", "int", "kdfVersion", "=", "20130830", ";", "/", "/", "Format", ":", "YYYYMMDD", ",", "max", "is", "99991231", ".", "private", "static", "final", "long", "serialVersionUID", "=", "kdfVersion", ";", "/", "/", "Format", ":", "YYYYMMDD", "/", "/", "Pseudo", "-", "random", "function", "algorithms", "suitable", "for", "NIST", "KDF", "in", "counter", "mode", ".", "@", "@", "-", "329", ",", "28", "+", "329", ",", "6", "@", "@", "public", "String", "hash", "(", "String", "plaintext", ",", "String", "salt", ",", "int", "iterations", ")", "throws", "Encrypt", "throw", "new", "EncryptionException", "(", "\"", "Internal", "error", "\"", ",", "\"", "Can", "'", "t", "find", "encoding", "for", "\"", "+", "encoding", ",", "ex", ")", ";", "}", "}", "/", "**", "*", "Convenience", "method", "that", "encrypts", "plaintext", "strings", "the", "new", "way", "(", "default", "*", "is", "CBC", "mode", "and", "PKCS5", "padding", ")", ".", "This", "encryption", "method", "uses", "the", "master", "*", "encryption", "key", "specified", "by", "the", "{", "@", "code", "Encryptor", ".", "MasterKey", "}", "property", "*", "in", "{", "@", "code", "ESAPI", ".", "properties", "}", ".", "*", "*", "@", "param", "plaintext", "A", "String", "to", "be", "encrypted", "*", "@", "return", "A", "base64", "-", "encoded", "combination", "of", "IV", "+", "raw", "ciphertext", "*", "@", "throws", "EncryptionException", "Thrown", "when", "something", "goes", "wrong", "with", "the", "*", "encryption", ".", "*", "*", "@", "see", "org", ".", "owasp", ".", "esapi", ".", "Encryptor", "#", "encrypt", "(", "PlainText", ")", "*", "/", "@", "Deprecated", "public", "String", "encrypt", "(", "String", "plaintext", ")", "throws", "EncryptionException", "{", "logWarning", "(", "\"", "encrypt", "\"", ",", "\"", "Calling", "deprecated", "encrypt", "(", ")", "method", ".", "\")", ";", "CipherText", "ct", "=", "null", ";", "ct", "=", "encrypt", "(", "new", "PlainText", "(", "plaintext", ")", ")", ";", "return", "ct", ".", "getEncodedIVCipherText", "(", ");", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "@", "@", "-", "366", ",", "10", "+", "344", ",", "15", "@", "@", "public", "CipherText", "encrypt", "(", "PlainText", "plaintext", ")", "throws", "EncryptionException", "{", "public", "CipherText", "encrypt", "(", "SecretKey", "key", ",", "PlainText", "plain", ")", "throws", "EncryptionException", "{", "if", "(", "key", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"(", "Master", ")", "encryption", "key", "arg", "may", "not", "be", "null", ".", "Is", "Encryptor", ".", "MasterKey", "set", "?", "\")", ";", "}", "if", "(", "plain", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "PlainText", "may", "arg", "not", "be", "null", "\"", ");", "}", "byte", "[", "]", "plaintext", "=", "plain", ".", "asBytes", "(", ");", "boolean", "overwritePlaintext", "=", "ESAPI", ".", "securityConfiguration", "(", ").", "overwritePlainText", "(", ");", "assert", "key", "!", "=", "null", ":", "\"", "(", "Master", ")", "encryption", "key", "may", "not", "be", "null", "\"", ";", "boolean", "success", "=", "false", ";", "/", "/", "Used", "in", "'", "finally", "'", "clause", ".", "String", "xform", "=", "null", ";", "int", "keySize", "=", "key", ".", "getEncoded", "(", ").", "length", "*", "8", ";", "/", "/", "Convert", "to", "#", "bits", "@", "@", "-", "569", ",", "53", "+", "552", ",", "6", "@", "@", "public", "CipherText", "encrypt", "(", "SecretKey", "key", ",", "PlainText", "plain", ")", "}", "}", "/", "**", "*", "Convenience", "method", "that", "decrypts", "previously", "encrypted", "plaintext", "strings", "*", "that", "were", "encrypted", "using", "the", "new", "encryption", "mechanism", "(", "with", "CBC", "mode", "and", "*", "PKCS5", "padding", "by", "default", ")", ".", "This", "decryption", "method", "uses", "the", "master", "*", "encryption", "key", "specified", "by", "the", "{", "@", "code", "Encryptor", ".", "MasterKey", "}", "property", "*", "in", "{", "@", "code", "ESAPI", ".", "properties", "}", ".", "*", "*", "@", "param", "b64IVCiphertext", "A", "base64", "-", "encoded", "representation", "of", "the", "*", "IV", "+", "raw", "ciphertext", "string", "to", "be", "decrypted", "with", "*", "the", "default", "master", "key", ".", "*", "@", "return", "The", "plaintext", "string", "prior", "to", "encryption", ".", "*", "@", "throws", "EncryptionException", "When", "something", "fails", "with", "the", "decryption", ".", "*", "*", "@", "see", "org", ".", "owasp", ".", "esapi", ".", "Encryptor", "#", "decrypt", "(", "CipherText", ")", "*", "/", "@", "Deprecated", "public", "String", "decrypt", "(", "String", "b64IVCiphertext", ")", "throws", "EncryptionException", "{", "logWarning", "(", "\"", "decrypt", "\"", ",", "\"", "Calling", "deprecated", "decrypt", "(", ")", "method", ".", "\")", ";", "CipherText", "ct", "=", "null", ";", "try", "{", "/", "/", "We", "assume", "that", "the", "default", "cipher", "transform", "was", "used", "to", "encrypt", "this", ".", "ct", "=", "new", "CipherText", "(", ");", "/", "/", "Need", "to", "base64", "decode", "the", "IV", "+", "ciphertext", "and", "extract", "the", "IV", "to", "set", "it", "in", "CipherText", "object", ".", "byte", "[", "]", "ivPlusRawCipherText", "=", "ESAPI", ".", "encoder", "(", ").", "decodeFromBase64", "(", "b64IVCiphertext", ")", ";", "int", "blockSize", "=", "ct", ".", "getBlockSize", "(", ");", "/", "/", "Size", "in", "bytes", ".", "byte", "[", "]", "iv", "=", "new", "byte", "[", "blockSize", "]", ";", "CryptoHelper", ".", "copyByteArray", "(", "ivPlusRawCipherText", ",", "iv", ",", "blockSize", ")", ";", "/", "/", "Copy", "the", "first", "blockSize", "bytes", "into", "iv", "array", "int", "cipherTextSize", "=", "ivPlusRawCipherText", ".", "length", "-", "blockSize", ";", "byte", "[", "]", "rawCipherText", "=", "new", "byte", "[", "cipherTextSize", "]", ";", "System", ".", "arraycopy", "(", "ivPlusRawCipherText", ",", "blockSize", ",", "rawCipherText", ",", "0", ",", "cipherTextSize", ")", ";", "ct", ".", "setIVandCiphertext", "(", "iv", ",", "rawCipherText", ")", ";", "/", "/", "Now", "the", "CipherText", "object", "should", "be", "prepared", "to", "use", "it", "to", "decrypt", ".", "PlainText", "plaintext", "=", "decrypt", "(", "ct", ")", ";", "return", "plaintext", ".", "toString", "(", ");", "/", "/", "Convert", "back", "to", "a", "Java", "String", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "/", "/", "Should", "never", "happen", ";", "UTF", "-", "8", "should", "be", "in", "rt", ".", "jar", ".", "logger", ".", "error", "(", "Logger", ".", "SECURITY_FAILURE", ",", "\"", "UTF", "-", "8", "encoding", "not", "available", "!", "Decryption", "failed", ".", "\",", "e", ")", ";", "return", "null", ";", "/", "/", "CHECKME", ":", "Or", "re", "-", "throw", "or", "what", "?", "Could", "also", "use", "native", "encoding", ",", "but", "that", "'", "s", "/", "/", "likely", "to", "cause", "unexpected", "and", "undesired", "effects", "far", "downstream", ".", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "error", "(", "Logger", ".", "SECURITY_FAILURE", ",", "\"", "Base64", "decoding", "of", "IV", "+", "ciphertext", "failed", ".", "Decryption", "failed", ".", "\",", "e", ")", ";", "return", "null", ";", "}", "}", "/", "**", "*", "{", "@", "inheritDoc", "}", "*", "/"], "docstring_tokens": ["bypass", "a", "MAC", "and", "possibly", "launch", "a", "padding", "oracle", "attacks", "against", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2335", ",", "6", "+", "2335", ",", "8", "@", "@", "static", "int", "ext4_check_descriptors", "(", "struct", "super_block", "*", "sb", ",", "ext4_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "ext4_check_descriptors", ":", "\"", "\"", "Block", "bitmap", "for", "group", "%", "u", "overlaps", "\"", "\"", "superblock", "\"", ",", "i", ")", ";", "if", "(", "!", "sb_rdonly", "(", "sb", ")", ")", "return", "0", ";", "}", "if", "(", "block_bitmap", "<", "first_block", "|", "|", "block_bitmap", ">", "last_block", ")", "{", "ext4_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "ext4_check_descriptors", ":", "\"", "@", "@", "-", "2347", ",", "6", "+", "2349", ",", "8", "@", "@", "static", "int", "ext4_check_descriptors", "(", "struct", "super_block", "*", "sb", ",", "ext4_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "ext4_check_descriptors", ":", "\"", "\"", "Inode", "bitmap", "for", "group", "%", "u", "overlaps", "\"", "\"", "superblock", "\"", ",", "i", ")", ";", "if", "(", "!", "sb_rdonly", "(", "sb", ")", ")", "return", "0", ";", "}", "if", "(", "inode_bitmap", "<", "first_block", "|", "|", "inode_bitmap", ">", "last_block", ")", "{", "ext4_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "ext4_check_descriptors", ":", "\"", "@", "@", "-", "2359", ",", "6", "+", "2363", ",", "8", "@", "@", "static", "int", "ext4_check_descriptors", "(", "struct", "super_block", "*", "sb", ",", "ext4_msg", "(", "sb", ",", "KERN_ERR", ",", "\"", "ext4_check_descriptors", ":", "\"", "\"", "Inode", "table", "for", "group", "%", "u", "overlaps", "\"", "\"", "superblock", "\"", ",", "i", ")", ";", "if", "(", "!", "sb_rdonly", "(", "sb", ")", ")", "return", "0", ";", "}", "if", "(", "inode_table", "<", "first_block", "|", "|", "inode_table", "+", "sbi", "-", ">", "s_itb_per_group", "-", "1", ">", "last_block", ")", "{"], "docstring_tokens": ["the", "system", "to", "crash"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "10", ",", "6", "+", "10", ",", "7", "@", "@", "const", "UserNotification", "=", "{", "hideDuration", ":", "1000", ",", "timeOut", ":", "10000", ",", "extendedTimeOut", ":", "1000", ",", "escapeHtml", ":", "true", ",", "}", ");", "}", ",", "warning", "(", "message", ",", "title", ")", "{", "@", "@", "-", "21", ",", "6", "+", "22", ",", "7", "@", "@", "const", "UserNotification", "=", "{", "hideDuration", ":", "1000", ",", "timeOut", ":", "7000", ",", "extendedTimeOut", ":", "1000", ",", "escapeHtml", ":", "true", ",", "}", ");", "}", ",", "success", "(", "message", ",", "title", ")", "{", "@", "@", "-", "32", ",", "6", "+", "34", ",", "7", "@", "@", "const", "UserNotification", "=", "{", "hideDuration", ":", "1000", ",", "timeOut", ":", "7000", ",", "extendedTimeOut", ":", "1000", ",", "escapeHtml", ":", "true", ",", "}", ");", "}", ",", "}", ";"], "docstring_tokens": ["steal", "the", "victim's", "cookie-based", "authentication", "credentials"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "355", ",", "6", "+", "355", ",", "7", "@", "@", "static", "int", "wanxl_ioctl", "(", "struct", "net_device", "*", "dev", ",", "struct", "ifreq", "*", "ifr", ",", "int", "cmd", ")", "ifr", "-", ">", "ifr_settings", ".", "size", "=", "size", ";", "/", "*", "data", "size", "wanted", "*", "/", "return", "-", "ENOBUFS", ";", "}", "memset", "(", "&", "line", ",", "0", ",", "sizeof", "(", "line", ")", ");", "line", ".", "clock_type", "=", "get_status", "(", "port", ")", "->", "clocking", ";", "line", ".", "clock_rate", "=", "0", ";", "line", ".", "loopback", "=", "0", ";"], "docstring_tokens": ["obtain", "sensitive", "information", "from", "kernel", "memory"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "20", ",", "7", "+", "20", ",", "6", "@", "@", "#", "define", "THREAD_SIZE_ORDER", "1", "#", "define", "THREAD_SIZE", "(", "PAGE_SIZE", "<", "<", "THREAD_SIZE_ORDER", ")", "#", "define", "STACKFAULT_STACK", "0", "#", "define", "DOUBLEFAULT_STACK", "1", "#", "define", "NMI_STACK", "0", "#", "define", "DEBUG_STACK", "0", "@", "@", "-", "14", ",", "12", "+", "14", ",", "11", "@", "@", "#", "define", "IRQ_STACK_ORDER", "2", "#", "define", "IRQ_STACK_SIZE", "(", "PAGE_SIZE", "<", "<", "IRQ_STACK_ORDER", ")", "#", "define", "STACKFAULT_STACK", "1", "#", "define", "DOUBLEFAULT_STACK", "2", "#", "define", "NMI_STACK", "3", "#", "define", "DEBUG_STACK", "4", "#", "define", "MCE_STACK", "5", "#", "define", "N_EXCEPTION_STACKS", "5", "/", "*", "hw", "limit", ":", "7", "*", "/", "#", "define", "DOUBLEFAULT_STACK", "1", "#", "define", "NMI_STACK", "2", "#", "define", "DEBUG_STACK", "3", "#", "define", "MCE_STACK", "4", "#", "define", "N_EXCEPTION_STACKS", "4", "/", "*", "hw", "limit", ":", "7", "*", "/", "#", "define", "PUD_PAGE_SIZE", "(", "_AC", "(", "1", ",", "UL", ")", "<", "<", "PUD_SHIFT", ")", "#", "define", "PUD_PAGE_MASK", "(", "~(", "PUD_PAGE_SIZE", "-", "1", ")", ")", "@", "@", "-", "39", ",", "6", "+", "39", ",", "7", "@", "@", "asmlinkage", "void", "simd_coprocessor_error", "(", "void", ")", ";", "#", "ifdef", "CONFIG_TRACING", "asmlinkage", "void", "trace_page_fault", "(", "void", ")", ";", "#", "define", "trace_stack_segment", "stack_segment", "#", "define", "trace_divide_error", "divide_error", "#", "define", "trace_bounds", "bounds", "#", "define", "trace_invalid_op", "invalid_op", "@", "@", "-", "24", ",", "7", "+", "24", ",", "6", "@", "@", "static", "char", "x86_stack_ids", "[", "][", "8", "]", "=", "{", "[", "DEBUG_STACK", "-", "1", "]", "=", "\"", "#", "DB", "\"", ",", "[", "NMI_STACK", "-", "1", "]", "=", "\"", "NMI", "\"", ",", "[", "DOUBLEFAULT_STACK", "-", "1", "]", "=", "\"", "#", "DF", "\"", ",", "[", "STACKFAULT_STACK", "-", "1", "]", "=", "\"", "#", "SS", "\"", ",", "[", "MCE_STACK", "-", "1", "]", "=", "\"", "#", "MC", "\"", ",", "#", "if", "DEBUG_STKSZ", ">", "EXCEPTION_STKSZ", "[", "N_EXCEPTION_STACKS", ".", "..", "@", "@", "-", "1259", ",", "7", "+", "1259", ",", "7", "@", "@", "apicinterrupt3", "HYPERVISOR_CALLBACK_VECTOR", "\\", "idtentry", "debug", "do_debug", "has_error_code", "=", "0", "paranoid", "=", "1", "shift_ist", "=", "DEBUG_STACK", "idtentry", "int3", "do_int3", "has_error_code", "=", "0", "paranoid", "=", "1", "shift_ist", "=", "DEBUG_STACK", "idtentry", "stack_segment", "do_stack_segment", "has_error_code", "=", "1", "paranoid", "=", "1", "idtentry", "stack_segment", "do_stack_segment", "has_error_code", "=", "1", "#", "ifdef", "CONFIG_XEN", "idtentry", "xen_debug", "do_debug", "has_error_code", "=", "0", "idtentry", "xen_int3", "do_int3", "has_error_code", "=", "0", "@", "@", "-", "233", ",", "27", "+", "233", ",", "11", "@", "@", "DO_ERROR", "(", "X86_TRAP_UD", ",", "SIGILL", ",", "\"", "invalid", "opcode", "\"", ",", "invalid_op", ")", "DO_ERROR", "(", "X86_TRAP_OLD_MF", ",", "SIGFPE", ",", "\"", "coprocessor", "segment", "overrun", "\"", ",", "coprocessor_segment_overrun", ")", "DO_ERROR", "(", "X86_TRAP_TS", ",", "SIGSEGV", ",", "\"", "invalid", "TSS", "\"", ",", "invalid_TSS", ")", "DO_ERROR", "(", "X86_TRAP_NP", ",", "SIGBUS", ",", "\"", "segment", "not", "present", "\"", ",", "segment_not_present", ")", "#", "ifdef", "CONFIG_X86_32", "DO_ERROR", "(", "X86_TRAP_SS", ",", "SIGBUS", ",", "\"", "stack", "segment", "\"", ",", "stack_segment", ")", "#", "endif", "DO_ERROR", "(", "X86_TRAP_AC", ",", "SIGBUS", ",", "\"", "alignment", "check", "\"", ",", "alignment_check", ")", "#", "ifdef", "CONFIG_X86_64", "/", "*", "Runs", "on", "IST", "stack", "*", "/", "dotraplinkage", "void", "do_stack_segment", "(", "struct", "pt_regs", "*", "regs", ",", "long", "error_code", ")", "{", "enum", "ctx_state", "prev_state", ";", "prev_state", "=", "exception_enter", "(", ");", "if", "(", "notify_die", "(", "DIE_TRAP", ",", "\"", "stack", "segment", "\"", ",", "regs", ",", "error_code", ",", "X86_TRAP_SS", ",", "SIGBUS", ")", "!", "=", "NOTIFY_STOP", ")", "{", "preempt_conditional_sti", "(", "regs", ")", ";", "do_trap", "(", "X86_TRAP_SS", ",", "SIGBUS", ",", "\"", "stack", "segment", "\"", ",", "regs", ",", "error_code", ",", "NULL", ")", ";", "preempt_conditional_cli", "(", "regs", ")", ";", "}", "exception_exit", "(", "prev_state", ")", ";", "}", "dotraplinkage", "void", "do_double_fault", "(", "struct", "pt_regs", "*", "regs", ",", "long", "error_code", ")", "{", "static", "const", "char", "str", "[", "]", "=", "\"", "double", "fault", "\"", ";", "@", "@", "-", "802", ",", "7", "+", "786", ",", "7", "@", "@", "void", "__init", "trap_init", "(", "void", ")", "set_intr_gate", "(", "X86_TRAP_OLD_MF", ",", "coprocessor_segment_overrun", ")", ";", "set_intr_gate", "(", "X86_TRAP_TS", ",", "invalid_TSS", ")", ";", "set_intr_gate", "(", "X86_TRAP_NP", ",", "segment_not_present", ")", ";", "set_intr_gate_ist", "(", "X86_TRAP_SS", ",", "&", "stack_segment", ",", "STACKFAULT_STACK", ")", ";", "set_intr_gate", "(", "X86_TRAP_SS", ",", "stack_segment", ")", ";", "set_intr_gate", "(", "X86_TRAP_GP", ",", "general_protection", ")", ";", "set_intr_gate", "(", "X86_TRAP_SPURIOUS", ",", "spurious_interrupt_bug", ")", ";", "set_intr_gate", "(", "X86_TRAP_MF", ",", "coprocessor_error", ")", ";"], "docstring_tokens": ["massive", "memory", "corruption", "and", "an", "eventual", "crash", "or", "reboot"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "87", ",", "10", "+", "87", ",", "10", "@", "@", "public", "Response", "upload", "(", "@", "QueryParam", "(", "\"", "modelId", "\"", ")", "@", "DefaultValue", "(", "\"", "org", ".", "onosproject", ".", "mod", "*", "/", "public", "static", "String", "getValidModelId", "(", "String", "id", ")", "throws", "IllegalArgumentException", "{", "/", "/", "checking", "weather", "modelId", "contains", "the", "alphanumeric", "character", "or", "not", ".", "/", "/", "checking", "whether", "modelId", "contains", "the", "alphanumeric", "character", "or", "not", ".", "if", "(", "id", ".", "matches", "(", "\".", "*[", "A", "-", "Za", "-", "z0", "-", "9", "]", ".*", "\")", ")", "{", "/", "/", "replacing", "special", "characters", "with", "'", "_", "'", "id", "=", "id", ".", "replaceAll", "(", "\"[", "\\\\", "s", "\\", "\\/", ":*", "?\\", "\"\\", "\\[", "\\\\", "]<", ">|", "$@", "!#", "%&", "()", "{}", "';", ".,", "-]", "\",", "\"", "_", "\"", ");", "id", "=", "id", ".", "replaceAll", "(", "\"[", "\\\\", "s", "\\", "\\/", ":*", "?\\", "\"\\", "\\[", "\\\\", "]<", ">|", "$@", "!#", "%&", "()", "{}", "'`", ";.", ",-", "]\"", ",", "\"", "_", "\"", ");", "/", "/", "remove", "leading", "and", "trailing", "underscore", "id", "=", "id", ".", "replaceAll", "(", "\"^", "_", "+", "|", "_", "+", "$\"", ",", "\"", "\")", ";", "/", "/", "replacing", "the", "consecutive", "underscores", "'", "_", "'", "to", "single", "_"], "docstring_tokens": ["execute", "arbitrary", "commands", "on", "the", "controller", "."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "186", ",", "6", "+", "186", ",", "8", "@", "@", "public", "static", "Path", "getDataFolder", "(", "String", "pi", ",", "String", "dataFolderName", ",", "String", "dataRe", "*", "/", "public", "static", "Path", "getDataFilePath", "(", "String", "pi", ",", "String", "dataFolderName", ",", "String", "altDataFolderName", ",", "String", "fileName", ")", "throws", "PresentationException", ",", "IndexUnreachableException", "{", "/", "/", "make", "sure", "fileName", "is", "a", "pure", "filename", "and", "not", "a", "path", "fileName", "=", "Paths", ".", "get", "(", "fileName", ")", ".", "getFileName", "(", ").", "toString", "(", ");", "java", ".", "nio", ".", "file", ".", "Path", "dataFolderPath", "=", "getDataFolder", "(", "pi", ",", "dataFolderName", ")", ";", "if", "(", "StringUtils", ".", "isNotBlank", "(", "fileName", ")", ")", "{", "dataFolderPath", "=", "dataFolderPath", ".", "resolve", "(", "fileName", ")", ";"], "docstring_tokens": ["view", "arbitrary", "files", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "45", ",", "6", "+", "45", ",", "7", "@", "@", "import", "org", ".", "slf4j", ".", "Logger", ";", "import", "org", ".", "slf4j", ".", "LoggerFactory", ";", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "lang", ".", "Exception", ";", "import", "java", ".", "lang", ".", "Object", ";", "@", "@", "-", "491", ",", "6", "+", "492", ",", "25", "@", "@", "public", "void", "testPrepareStatement", "(", ")", "{", "expectedException", ")", ";", "}", "@", "Test", "public", "void", "testPrepareStatementWithSetBinaryStream", "(", ")", "throws", "SQLException", "{", "PreparedStatement", "stmt", "=", "con", ".", "prepareStatement", "(", "\"", "select", "under_col", "from", "\"", "+", "tableName", "+", "\"", "where", "value", "=", "?\"", ");", "stmt", ".", "setBinaryStream", "(", "1", ",", "new", "ByteArrayInputStream", "(", "\"'", "val_238", "'", "or", "under_col", "<", ">", "0", "\"", ".", "getBytes", "(", "))", ");", "ResultSet", "res", "=", "stmt", ".", "executeQuery", "(", ");", "assertFalse", "(", "res", ".", "next", "(", "))", ";", "}", "@", "Test", "public", "void", "testPrepareStatementWithSetString", "(", ")", "throws", "SQLException", "{", "PreparedStatement", "stmt", "=", "con", ".", "prepareStatement", "(", "\"", "select", "under_col", "from", "\"", "+", "tableName", "+", "\"", "where", "value", "=", "?\"", ");", "stmt", ".", "setString", "(", "1", ",", "\"", "val_238", "\\", "\\'", "or", "under_col", "<", ">", "0", "-", "-\"", ");", "ResultSet", "res", "=", "stmt", ".", "executeQuery", "(", ");", "assertFalse", "(", "res", ".", "next", "(", "))", ";", "stmt", ".", "setString", "(", "1", ",", "\"", "anyStringHere", "\\", "\\'", "or", "1", "=", "1", "-", "-\"", ");", "res", "=", "stmt", ".", "executeQuery", "(", ");", "assertFalse", "(", "res", ".", "next", "(", "))", ";", "}", "private", "PreparedStatement", "createPreapredStatementUsingSetObject", "(", "String", "sql", ")", "throws", "SQLException", "{", "PreparedStatement", "ps", "=", "con", ".", "prepareStatement", "(", "sql", ")", ";", "@", "@", "-", "276", ",", "7", "+", "276", ",", "7", "@", "@", "public", "void", "setBigDecimal", "(", "int", "parameterIndex", ",", "BigDecimal", "x", ")", "throws", "SQLException", "public", "void", "setBinaryStream", "(", "int", "parameterIndex", ",", "InputStream", "x", ")", "throws", "SQLException", "{", "String", "str", "=", "new", "Scanner", "(", "x", ",", "\"", "UTF", "-", "8", "\"", ").", "useDelimiter", "(", "\"\\", "\\", "A", "\"", ").", "next", "(", ");", "this", ".", "parameters", ".", "put", "(", "parameterIndex", ",", "str", ")", ";", "setString", "(", "parameterIndex", ",", "str", ")", ";", "}", "/", "*", "@", "@", "-", "696", ",", "15", "+", "696", ",", "37", "@", "@", "public", "void", "setShort", "(", "int", "parameterIndex", ",", "short", "x", ")", "throws", "SQLException", "{", "this", ".", "parameters", ".", "put", "(", "parameterIndex", ",", "\"\"", "+", "x", ")", ";", "}", "private", "String", "replaceBackSlashSingleQuote", "(", "String", "x", ")", "{", "/", "/", "scrutinize", "escape", "pair", ",", "specifically", ",", "replace", "\\", "'", "to", "'", "StringBuffer", "newX", "=", "new", "StringBuffer", "(", ");", "for", "(", "int", "i", "=", "0", ";", "i", "<", "x", ".", "length", "(", ");", "i", "+", "+)", "{", "char", "c", "=", "x", ".", "charAt", "(", "i", ")", ";", "if", "(", "c", "=", "=", "'", "\\\\", "'", "&", "&", "i", "<", "x", ".", "length", "(", ")-", "1", ")", "{", "char", "c1", "=", "x", ".", "charAt", "(", "i", "+", "1", ")", ";", "if", "(", "c1", "=", "=", "'", "\\'", "')", "{", "newX", ".", "append", "(", "c1", ")", ";", "}", "else", "{", "newX", ".", "append", "(", "c", ")", ";", "newX", ".", "append", "(", "c1", ")", ";", "}", "i", "+", "+;", "}", "else", "{", "newX", ".", "append", "(", "c", ")", ";", "}", "}", "return", "newX", ".", "toString", "(", ");", "}", "/", "*", "*", "(", "non", "-", "Javadoc", ")", "*", "*", "@", "see", "java", ".", "sql", ".", "PreparedStatement", "#", "setString", "(", "int", ",", "java", ".", "lang", ".", "String", ")", "*", "/", "public", "void", "setString", "(", "int", "parameterIndex", ",", "String", "x", ")", "throws", "SQLException", "{", "x", "=", "x", ".", "replace", "(", "\"'", "\",", "\"", "\\\\", "'\"", ");", "this", ".", "parameters", ".", "put", "(", "parameterIndex", ",", "\"'", "\"+", "x", "+", "\"'", "\")", ";", "x", "=", "replaceBackSlashSingleQuote", "(", "x", ")", ";", "x", "=", "x", ".", "replace", "(", "\"'", "\",", "\"", "\\\\", "'\"", ");", "this", ".", "parameters", ".", "put", "(", "parameterIndex", ",", "\"", "'\"", "+", "x", "+", "\"'", "\")", ";", "}", "/", "*"], "docstring_tokens": ["modify", "or", "delete", "information", "in", "the", "back-end", "database"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "2246", ",", "7", "+", "2246", ",", "7", "@", "@", "static", "int", "do_tcp_setsockopt", "(", "struct", "sock", "*", "sk", ",", "int", "level", ",", "/", "*", "Values", "greater", "than", "interface", "MTU", "won", "'", "t", "take", "effect", ".", "However", "*", "at", "the", "point", "when", "this", "call", "is", "done", "we", "typically", "don", "'", "t", "yet", "*", "know", "which", "interface", "is", "going", "to", "be", "used", "*", "/", "if", "(", "val", "<", "8", "|", "|", "val", ">", "MAX_TCP_WINDOW", ")", "{", "if", "(", "val", "<", "64", "|", "|", "val", ">", "MAX_TCP_WINDOW", ")", "{", "err", "=", "-", "EINVAL", ";", "break", ";", "}"], "docstring_tokens": ["denial-of-service", "condition"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "62", ",", "6", "+", "62", ",", "7", "@", "@", "#", "include", "\"", "magick", "/", "log", ".", "h", "\"", "#", "include", "\"", "magick", "/", "magick", ".", "h", "\"", "#", "include", "\"", "magick", "/", "memory_", ".", "h", "\"", "#", "include", "\"", "magick", "/", "memory", "-", "private", ".", "h", "\"", "#", "include", "\"", "magick", "/", "module", ".", "h", "\"", "#", "include", "\"", "magick", "/", "monitor", ".", "h", "\"", "#", "include", "\"", "magick", "/", "monitor", "-", "private", ".", "h", "\"", "@", "@", "-", "1903", ",", "14", "+", "1904", ",", "13", "@", "@", "RestoreMSCWarning", "}", "(", "void", ")", "SetImageStorageClass", "(", "image", ",", "DirectClass", ")", ";", "number_pixels", "=", "(", "MagickSizeType", ")", "columns", "*", "rows", ";", "if", "(", "(", "number_pixels", "*", "sizeof", "(", "uint32", ")", ")", "!", "=", "(", "MagickSizeType", ")", "(", "(", "size_t", ")", "(", "number_pixels", "*", "sizeof", "(", "uint32", ")", "))", ")", "if", "(", "HeapOverflowSanityCheck", "(", "rows", ",", "sizeof", "(", "*", "tile_pixels", ")", ")", "!", "=", "MagickFalse", ")", "{", "TIFFClose", "(", "tiff", ")", ";", "ThrowReaderException", "(", "ResourceLimitError", ",", "\"", "MemoryAllocationFailed", "\"", ");", "}", "tile_pixels", "=", "(", "uint32", "*", ")", "AcquireQuantumMemory", "(", "number_pixels", ",", "sizeof", "(", "*", "tile_pixels", ")", ");", "tile_pixels", "=", "(", "uint32", "*", ")", "AcquireQuantumMemory", "(", "columns", ",", "rows", "*", "sizeof", "(", "*", "tile_pixels", ")", ");", "if", "(", "tile_pixels", "=", "=", "(", "uint32", "*", ")", "NULL", ")", "{", "TIFFClose", "(", "tiff", ")", ";", "@", "@", "-", "2012", ",", "14", "+", "2012", ",", "13", "@", "@", "RestoreMSCWarning", "Convert", "TIFF", "image", "to", "DirectClass", "MIFF", "image", ".", "*", "/", "number_pixels", "=", "(", "MagickSizeType", ")", "image", "-", ">", "columns", "*", "image", "-", ">", "rows", ";", "if", "(", "(", "number_pixels", "*", "sizeof", "(", "uint32", ")", ")", "!", "=", "(", "MagickSizeType", ")", "(", "(", "size_t", ")", "(", "number_pixels", "*", "sizeof", "(", "uint32", ")", "))", ")", "if", "(", "HeapOverflowSanityCheck", "(", "image", "-", ">", "rows", ",", "sizeof", "(", "*", "pixels", ")", ")", "!", "=", "MagickFalse", ")", "{", "TIFFClose", "(", "tiff", ")", ";", "ThrowReaderException", "(", "ResourceLimitError", ",", "\"", "MemoryAllocationFailed", "\"", ");", "}", "pixel_info", "=", "AcquireVirtualMemory", "(", "image", "-", ">", "columns", ",", "image", "-", ">", "rows", "*", "sizeof", "(", "uint32", ")", ");", "sizeof", "(", "*", "pixels", ")", ");", "if", "(", "pixel_info", "=", "=", "(", "MemoryInfo", "*", ")", "NULL", ")", "{", "TIFFClose", "(", "tiff", ")", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(application", "crash", ")", "or", "have", "other", "unspecified", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "6", ",", "15", "+", "6", ",", "15", "@", "@", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "*", "/", "package", "org", ".", "apache", ".", "kylin", ".", "common", ".", "util", ";", "@", "@", "-", "163", ",", "4", "+", "163", ",", "34", "@", "@", "private", "void", "copyRemote", "(", "String", "localFile", ",", "String", "destDir", ")", "throws", "IOException", "{", "}", "}", "public", "static", "final", "String", "COMMAND_INJECT_REX", "=", "\"", "[", "&", "`>", "|{", "}(", ")$", ";\\", "\\-", "#~", "!+", "*\u201d", "\\\\", "\\\\", "]+", "\";", "/", "**", "*", "<", "pre", ">", "*", "Check", "parameter", "for", "preventing", "command", "injection", ",", "replace", "illegal", "character", "into", "empty", "character", ".", "*", "*", "Note", ":", "*", "1", ".", "Whitespace", "is", "also", "refused", "because", "parameter", "is", "a", "single", "word", ",", "should", "not", "contains", "it", "*", "2", ".", "Some", "character", "may", "be", "illegal", "but", "still", "be", "accepted", "because", "commandParameter", "maybe", "a", "URI", "/", "path", "expression", ",", "*", "you", "may", "check", "\"", "Character", "part", "\"", "in", "https", ":", "//", "docs", ".", "oracle", ".", "com", "/", "javase", "/", "8", "/", "docs", "/", "api", "/", "java", "/", "net", "/", "URI", ".", "html", ",", "*", "here", "is", "the", "character", "which", "is", "not", "banned", ".", "*", "*", "1", ".", "dot", ".", "*", "2", ".", "slash", "/", "*", "3", ".", "colon", ":", "*", "4", ".", "equal", "=", "*", "5", ".", "?", "*", "6", ".", "@", "*", "7", ".", "bracket", "[", "]", "*", "8", ".", "comma", ",", "*", "9", ".", "%", "*", "<", "/", "pre", ">", "*", "/", "public", "static", "String", "checkParameter", "(", "String", "commandParameter", ")", "{", "String", "repaired", "=", "commandParameter", ".", "replaceAll", "(", "COMMAND_INJECT_REX", ",", "\"", "\")", ";", "if", "(", "repaired", ".", "length", "(", ")", "!", "=", "commandParameter", ".", "length", "(", "))", "{", "logger", ".", "info", "(", "\"", "Detected", "illegal", "character", "in", "command", "{", "},", "replace", "it", "to", "{", "}.", "\",", "commandParameter", ",", "repaired", ")", ";", "}", "return", "repaired", ";", "}", "}", "@", "@", "-", "0", ",", "0", "+", "1", ",", "42", "@", "@", "/", "*", "*", "Licensed", "to", "the", "Apache", "Software", "Foundation", "(", "ASF", ")", "under", "one", "*", "or", "more", "contributor", "license", "agreements", ".", "See", "the", "NOTICE", "file", "*", "distributed", "with", "this", "work", "for", "additional", "information", "*", "regarding", "copyright", "ownership", ".", "The", "ASF", "licenses", "this", "file", "*", "to", "you", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "*", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "*", "with", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "*", "*", "http", ":", "//", "www", ".", "apache", ".", "org", "/", "licenses", "/", "LICENSE", "-", "2", ".", "0", "*", "*", "Unless", "required", "by", "applicable", "law", "or", "agreed", "to", "in", "writing", ",", "software", "*", "distributed", "under", "the", "License", "is", "distributed", "on", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "*", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "*", "See", "the", "License", "for", "the", "specific", "language", "governing", "permissions", "and", "*", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "apache", ".", "kylin", ".", "common", ".", "util", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertEquals", ";", "public", "class", "CliCommandExecutorTest", "{", "@", "Test", "public", "void", "testCmd", "(", ")", "{", "String", "[", "][", "]", "commands", "=", "{", "{", "\"", "nslookup", "unknown", ".", "com", "&", "\",", "\"", "nslookupunknown", ".", "com", "\"", "},", "{", "\"", "cat", "`", "whoami", "`", "\",", "\"", "catwhoami", "\"", "},", "{", "\"", "whoami", ">", "/", "var", "/", "www", "/", "static", "/", "whoami", ".", "txt", "\"", ",", "\"", "whoami", "/", "var", "/", "www", "/", "static", "/", "whoami", ".", "txt", "\"", "},", "{", "\"", "c1", "|", "|", "c2", "#", "|", "|", "c3", "|", "|", "*", "c4", "\\", "\\\"", ",", "\"", "c1c2c3c4", "\"", "},", "{", "\"", "c1", "&", "&\"", ",", "\"", "c1", "\"", "},", "{", "\"", "c1", "+", ">", "c2", "[", "p1", "]", "%\"", ",", "\"", "c1c2", "[", "p1", "]", "%\"", "},", "{", "\"", "c1", "|", "$", "{", "c2", "}", "\",", "\"", "c1c2", "\"", "},", "}", ";", "for", "(", "String", "[", "]", "pair", ":", "commands", ")", "{", "assertEquals", "(", "pair", "[", "1", "]", ",", "CliCommandExecutor", ".", "checkParameter", "(", "pair", "[", "0", "]", "))", ";", "}", "}", "}", "@", "@", "-", "1130", ",", "8", "+", "1130", ",", "13", "@", "@", "public", "void", "migrateCube", "(", "CubeInstance", "cube", ",", "String", "projectName", ")", "{", "\"", "Destination", "configuration", "should", "not", "be", "empty", ".", "\")", ";", "String", "stringBuilder", "=", "(", "\"%", "s", "/", "bin", "/", "kylin", ".", "sh", "org", ".", "apache", ".", "kylin", ".", "tool", ".", "CubeMigrationCLI", "%", "s", "%", "s", "%", "s", "%", "s", "%", "s", "%", "s", "true", "true", "\"", ");", "String", "cmd", "=", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "stringBuilder", ",", "KylinConfig", ".", "getKylinHome", "(", "),", "srcCfgUri", ",", "dstCfgUri", ",", "cube", ".", "getName", "(", "),", "projectName", ",", "config", ".", "isAutoMigrateCubeCopyAcl", "(", "),", "config", ".", "isAutoMigrateCubePurge", "(", "))", ";", "String", "cmd", "=", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "stringBuilder", ",", "KylinConfig", ".", "getKylinHome", "(", "),", "CliCommandExecutor", ".", "checkParameter", "(", "srcCfgUri", ")", ",", "CliCommandExecutor", ".", "checkParameter", "(", "dstCfgUri", ")", ",", "cube", ".", "getName", "(", "),", "CliCommandExecutor", ".", "checkParameter", "(", "projectName", ")", ",", "config", ".", "isAutoMigrateCubeCopyAcl", "(", "),", "config", ".", "isAutoMigrateCubePurge", "(", "))", ";", "logger", ".", "info", "(", "\"", "One", "click", "migration", "cmd", ":", "\"", "+", "cmd", ")", ";"], "docstring_tokens": ["execute", "arbitrary", "commands", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "56", ",", "6", "+", "56", ",", "7", "@", "@", "enum", "IPSTATS_MIB_ECT1PKTS", ",", "/", "*", "InECT1Pkts", "*", "/", "IPSTATS_MIB_ECT0PKTS", ",", "/", "*", "InECT0Pkts", "*", "/", "IPSTATS_MIB_CEPKTS", ",", "/", "*", "InCEPkts", "*", "/", "IPSTATS_MIB_REASM_OVERLAPS", ",", "/", "*", "ReasmOverlaps", "*", "/", "__IPSTATS_MIB_MAX", "}", ";", "@", "@", "-", "277", ",", "6", "+", "277", ",", "7", "@", "@", "static", "int", "ip_frag_reinit", "(", "struct", "ipq", "*", "qp", ")", "/", "*", "Add", "new", "segment", "to", "existing", "queue", ".", "*", "/", "static", "int", "ip_frag_queue", "(", "struct", "ipq", "*", "qp", ",", "struct", "sk_buff", "*", "skb", ")", "{", "struct", "net", "*", "net", "=", "container_of", "(", "qp", "-", ">", "q", ".", "net", ",", "struct", "net", ",", "ipv4", ".", "frags", ")", ";", "struct", "sk_buff", "*", "prev", ",", "*", "next", ";", "struct", "net_device", "*", "dev", ";", "unsigned", "int", "fragsize", ";", "@", "@", "-", "357", ",", "65", "+", "358", ",", "23", "@", "@", "static", "int", "ip_frag_queue", "(", "struct", "ipq", "*", "qp", ",", "struct", "sk_buff", "*", "skb", ")", "}", "found", ":", "/", "*", "We", "found", "where", "to", "put", "this", "one", ".", "Check", "for", "overlap", "with", "*", "preceding", "fragment", ",", "and", ",", "if", "needed", ",", "align", "things", "so", "that", "*", "any", "overlaps", "are", "eliminated", ".", "/", "*", "RFC5722", ",", "Section", "4", ",", "amended", "by", "Errata", "ID", ":", "3089", "*", "When", "reassembling", "an", "IPv6", "datagram", ",", "if", "*", "one", "or", "more", "its", "constituent", "fragments", "is", "determined", "to", "be", "an", "*", "overlapping", "fragment", ",", "the", "entire", "datagram", "(", "and", "any", "constituent", "*", "fragments", ")", "MUST", "be", "silently", "discarded", ".", "*", "*", "We", "do", "the", "same", "here", "for", "IPv4", ".", "*", "/", "if", "(", "prev", ")", "{", "int", "i", "=", "(", "prev", "-", ">", "ip_defrag_offset", "+", "prev", "-", ">", "len", ")", "-", "offset", ";", "if", "(", "i", ">", "0", ")", "{", "offset", "+", "=", "i", ";", "err", "=", "-", "EINVAL", ";", "if", "(", "end", "<", "=", "offset", ")", "goto", "err", ";", "err", "=", "-", "ENOMEM", ";", "if", "(", "!", "pskb_pull", "(", "skb", ",", "i", ")", ")", "goto", "err", ";", "if", "(", "skb", "-", ">", "ip_summed", "!", "=", "CHECKSUM_UNNECESSARY", ")", "skb", "-", ">", "ip_summed", "=", "CHECKSUM_NONE", ";", "}", "}", "/", "*", "Is", "there", "an", "overlap", "with", "the", "previous", "fragment", "?", "*", "/", "if", "(", "prev", "&", "&", "(", "prev", "-", ">", "ip_defrag_offset", "+", "prev", "-", ">", "len", ")", ">", "offset", ")", "goto", "discard_qp", ";", "err", "=", "-", "ENOMEM", ";", "while", "(", "next", "&", "&", "next", "-", ">", "ip_defrag_offset", "<", "end", ")", "{", "int", "i", "=", "end", "-", "next", "-", ">", "ip_defrag_offset", ";", "/", "*", "overlap", "is", "'", "i", "'", "bytes", "*", "/", "if", "(", "i", "<", "next", "-", ">", "len", ")", "{", "int", "delta", "=", "-", "next", "-", ">", "truesize", ";", "/", "*", "Eat", "head", "of", "the", "next", "overlapped", "fragment", "*", "and", "leave", "the", "loop", ".", "The", "next", "ones", "cannot", "overlap", ".", "*", "/", "if", "(", "!", "pskb_pull", "(", "next", ",", "i", ")", ")", "goto", "err", ";", "delta", "+", "=", "next", "-", ">", "truesize", ";", "if", "(", "delta", ")", "add_frag_mem_limit", "(", "qp", "-", ">", "q", ".", "net", ",", "delta", ")", ";", "next", "-", ">", "ip_defrag_offset", "+", "=", "i", ";", "qp", "-", ">", "q", ".", "meat", "-", "=", "i", ";", "if", "(", "next", "-", ">", "ip_summed", "!", "=", "CHECKSUM_UNNECESSARY", ")", "next", "-", ">", "ip_summed", "=", "CHECKSUM_NONE", ";", "break", ";", "}", "else", "{", "struct", "sk_buff", "*", "free_it", "=", "next", ";", "/", "*", "Old", "fragment", "is", "completely", "overridden", "with", "*", "new", "one", "drop", "it", ".", "*", "/", "next", "=", "next", "-", ">", "next", ";", "if", "(", "prev", ")", "prev", "-", ">", "next", "=", "next", ";", "else", "qp", "-", ">", "q", ".", "fragments", "=", "next", ";", "qp", "-", ">", "q", ".", "meat", "-", "=", "free_it", "-", ">", "len", ";", "sub_frag_mem_limit", "(", "qp", "-", ">", "q", ".", "net", ",", "free_it", "-", ">", "truesize", ")", ";", "kfree_skb", "(", "free_it", ")", ";", "}", "}", "/", "*", "Is", "there", "an", "overlap", "with", "the", "next", "fragment", "?", "*", "/", "if", "(", "next", "&", "&", "next", "-", ">", "ip_defrag_offset", "<", "end", ")", "goto", "discard_qp", ";", "/", "*", "Note", ":", "skb", "-", ">", "ip_defrag_offset", "and", "skb", "-", ">", "dev", "share", "the", "same", "location", "*", "/", "dev", "=", "skb", "-", ">", "dev", ";", "@", "@", "-", "463", ",", "6", "+", "422", ",", "10", "@", "@", "static", "int", "ip_frag_queue", "(", "struct", "ipq", "*", "qp", ",", "struct", "sk_buff", "*", "skb", ")", "skb_dst_drop", "(", "skb", ")", ";", "return", "-", "EINPROGRESS", ";", "discard_qp", ":", "inet_frag_kill", "(", "&", "qp", "-", ">", "q", ")", ";", "err", "=", "-", "EINVAL", ";", "__IP_INC_STATS", "(", "net", ",", "IPSTATS_MIB_REASM_OVERLAPS", ")", ";", "err", ":", "kfree_skb", "(", "skb", ")", ";", "return", "err", ";", "@", "@", "-", "119", ",", "6", "+", "119", ",", "7", "@", "@", "static", "const", "struct", "snmp_mib", "snmp4_ipextstats_list", "[", "]", "=", "{", "SNMP_MIB_ITEM", "(", "\"", "InECT1Pkts", "\"", ",", "IPSTATS_MIB_ECT1PKTS", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "InECT0Pkts", "\"", ",", "IPSTATS_MIB_ECT0PKTS", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "InCEPkts", "\"", ",", "IPSTATS_MIB_CEPKTS", ")", ",", "SNMP_MIB_ITEM", "(", "\"", "ReasmOverlaps", "\"", ",", "IPSTATS_MIB_REASM_OVERLAPS", ")", ",", "SNMP_MIB_SENTINEL", "}", ";"], "docstring_tokens": ["a", "remote", "denial", "of", "service"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "296", ",", "12", "+", "296", ",", "16", "@", "@", "void", "recycle", "(", ")", "{", "void", "nextRequest", "(", ")", "{", "request", ".", "recycle", "(", ");", "/", "/", "Copy", "leftover", "bytes", "to", "the", "beginning", "of", "the", "buffer", "if", "(", "byteBuffer", ".", "remaining", "(", ")", ">", "0", "&", "&", "byteBuffer", ".", "position", "(", ")", ">", "0", ")", "{", "byteBuffer", ".", "compact", "(", ");", "if", "(", "byteBuffer", ".", "position", "(", ")", ">", "0", ")", "{", "if", "(", "byteBuffer", ".", "remaining", "(", ")", ">", "0", ")", "{", "/", "/", "Copy", "leftover", "bytes", "to", "the", "beginning", "of", "the", "buffer", "byteBuffer", ".", "compact", "(", ");", "byteBuffer", ".", "flip", "(", ");", "}", "else", "{", "/", "/", "Reset", "position", "and", "limit", "to", "0", "byteBuffer", ".", "position", "(", "0", ")", ".", "limit", "(", "0", ")", ";", "}", "}", "/", "/", "Always", "reset", "pos", "to", "zero", "byteBuffer", ".", "limit", "(", "byteBuffer", ".", "limit", "(", ")", "-", "byteBuffer", ".", "position", "(", "))", ".", "position", "(", "0", ")", ";", "/", "/", "Recycle", "filters", "for", "(", "int", "i", "=", "0", ";", "i", "<", "=", "lastActiveFilter", ";", "i", "+", "+)", "{", "@", "@", "-", "83", ",", "6", "+", "83", ",", "11", "@", "@", "when", "configured", "with", "an", "address", "of", "<", "code", ">", "0", ".", "0", ".", "0", ".", "0", "<", "/", "code", ">", "or", "<", "code", ">", "::", "</", "code", ">", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Correct", "a", "regression", "in", "the", "refactoring", "to", "make", "wider", "use", "of", "<", "code", ">", "ByteBuffer", "<", "/", "code", ">", "that", "caused", "an", "intermittent", "failure", "in", "the", "unit", "tests", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Web", "Applications", "\"", ">"], "docstring_tokens": ["read", "data", "that", "was", "intended", "to", "be", "associated", "with", "a", "different", "request", "."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "199", ",", "7", "+", "199", ",", "7", "@", "@", "public", "void", "start", "(", ")", "{", "createExecutorService", "(", ");", "listenerNotifier", "=", "ClientListenerNotifier", ".", "create", "(", "codec", ",", "marshaller", ",", "transportFactory", ")", ";", "listenerNotifier", "=", "ClientListenerNotifier", ".", "create", "(", "codec", ",", "marshaller", ",", "transportFactory", ",", "configuration", ".", "serialWhitelist", "(", "))", ";", "transportFactory", ".", "start", "(", "codec", ",", "configuration", ",", "defaultCacheTopologyId", ",", "listenerNotifier", ")", ";", "synchronized", "(", "cacheName2RemoteCache", ")", "{", "@", "@", "-", "321", ",", "7", "+", "321", ",", "7", "@", "@", "private", "void", "startRemoteCache", "(", "RemoteCacheHolder", "remoteCacheHolder", ")", "{", "RemoteCacheImpl", "<", "?,", "?", ">", "remoteCache", "=", "remoteCacheHolder", ".", "remoteCache", ";", "OperationsFactory", "operationsFactory", "=", "new", "OperationsFactory", "(", "transportFactory", ",", "remoteCache", ".", "getName", "(", "),", "remoteCacheHolder", ".", "forceReturnValue", ",", "codec", ",", "listenerNotifier", ",", "asyncExecutorService", ",", "configuration", ".", "clientIntelligence", "(", "))", ";", "asyncExecutorService", ",", "configuration", ")", ";", "remoteCache", ".", "init", "(", "marshaller", ",", "asyncExecutorService", ",", "operationsFactory", ",", "configuration", ".", "keySizeEstimate", "(", "),", "configuration", ".", "valueSizeEstimate", "(", "))", ";", "}", "@", "@", "-", "341", ",", "7", "+", "341", ",", "7", "@", "@", "public", "Marshaller", "getMarshaller", "(", ")", "{", "}", "public", "RemoteCacheManagerAdmin", "administration", "(", ")", "{", "OperationsFactory", "operationsFactory", "=", "new", "OperationsFactory", "(", "transportFactory", ",", "codec", ",", "asyncExecutorService", ",", "configuration", ".", "clientIntelligence", "(", "))", ";", "OperationsFactory", "operationsFactory", "=", "new", "OperationsFactory", "(", "transportFactory", ",", "codec", ",", "asyncExecutorService", ",", "configuration", ")", ";", "return", "new", "RemoteCacheManagerAdminImpl", "(", "operationsFactory", ")", ";", "}", "@", "@", "-", "165", ",", "6", "+", "165", ",", "11", "@", "@", "public", "ConfigurationBuilder", "maxRetries", "(", "int", "retriesPerServer", ")", "{", "return", "builder", ".", "maxRetries", "(", "retriesPerServer", ")", ";", "}", "@", "Override", "public", "ConfigurationBuilder", "addJavaSerialWhiteList", "(", "String", ".", "..", "regExs", ")", "{", "return", "builder", ".", "addJavaSerialWhiteList", "(", "regExs", ")", ";", "}", "@", "Override", "public", "ConfigurationBuilder", "withProperties", "(", "Properties", "properties", ")", "{", "return", "builder", ".", "withProperties", "(", "properties", ")", ";", "@", "@", "-", "48", ",", "13", "+", "48", ",", "14", "@", "@", "private", "final", "int", "maxRetries", ";", "private", "final", "NearCacheConfiguration", "nearCache", ";", "private", "final", "List", "<", "ClusterConfiguration", ">", "clusters", ";", "private", "final", "List", "<", "String", ">", "serialWhitelist", ";", "Configuration", "(", "ExecutorFactoryConfiguration", "asyncExecutorFactory", ",", "Class", "<", "?", "extends", "FailoverRequestBalancingStrategy", ">", "balancingStrategyClass", ",", "FailoverRequestBalancingStrategy", "balancingStrategy", ",", "ClassLoader", "classLoader", ",", "ClientIntelligence", "clientIntelligence", ",", "ConnectionPoolConfiguration", "connectionPool", ",", "int", "connectionTimeout", ",", "Class", "<", "?", "extends", "ConsistentHash", ">", "[]", "consistentHashImpl", ",", "boolean", "forceReturnValues", ",", "int", "keySizeEstimate", ",", "Marshaller", "marshaller", ",", "Class", "<", "?", "extends", "Marshaller", ">", "marshallerClass", ",", "ProtocolVersion", "protocolVersion", ",", "List", "<", "ServerConfiguration", ">", "servers", ",", "int", "socketTimeout", ",", "SecurityConfiguration", "security", ",", "boolean", "tcpNoDelay", ",", "boolean", "tcpKeepAlive", ",", "Class", "<", "?", "extends", "TransportFactory", ">", "transportFactory", ",", "int", "valueSizeEstimate", ",", "int", "maxRetries", ",", "NearCacheConfiguration", "nearCache", ",", "List", "<", "ClusterConfiguration", ">", "clusters", ")", "{", "List", "<", "ClusterConfiguration", ">", "clusters", ",", "List", "<", "String", ">", "serialWhitelist", ")", "{", "this", ".", "asyncExecutorFactory", "=", "asyncExecutorFactory", ";", "this", ".", "balancingStrategyClass", "=", "balancingStrategyClass", ";", "this", ".", "balancingStrategy", "=", "balancingStrategy", ";", "@", "@", "-", "78", ",", "6", "+", "79", ",", "7", "@", "@", "this", ".", "valueSizeEstimate", "=", "valueSizeEstimate", ";", "this", ".", "nearCache", "=", "nearCache", ";", "this", ".", "clusters", "=", "clusters", ";", "this", ".", "serialWhitelist", "=", "serialWhitelist", ";", "}", "public", "ExecutorFactoryConfiguration", "asyncExecutorFactory", "(", ")", "{", "@", "@", "-", "185", ",", "6", "+", "187", ",", "10", "@", "@", "public", "int", "maxRetries", "(", ")", "{", "return", "maxRetries", ";", "}", "public", "List", "<", "String", ">", "serialWhitelist", "(", ")", "{", "return", "serialWhitelist", ";", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "Configuration", "[", "asyncExecutorFactory", "=", "\"", "+", "asyncExecutorFactory", "+", "\"", ",", "balancingStrategyClass", "=", "\"", "+", "balancingStrategyClass", "+", "\"", ",", "balancingStrategy", "=", "\"", "+", "balancingStrategy", "@", "@", "-", "193", ",", "6", "+", "199", ",", "7", "@", "@", "public", "String", "toString", "(", ")", "{", "+", "forceReturnValues", "+", "\"", ",", "keySizeEstimate", "=", "\"", "+", "keySizeEstimate", "+", "\"", ",", "marshallerClass", "=", "\"", "+", "marshallerClass", "+", "\"", ",", "marshaller", "=", "\"", "+", "marshaller", "+", "\"", ",", "protocolVersion", "=", "\"", "+", "protocolVersion", "+", "\"", ",", "servers", "=", "\"", "+", "servers", "+", "\"", ",", "socketTimeout", "=", "\"", "+", "socketTimeout", "+", "\"", ",", "security", "=", "\"", "+", "security", "+", "\"", ",", "tcpNoDelay", "=", "\"", "+", "tcpNoDelay", "+", "\"", ",", "tcpKeepAlive", "=", "\"", "+", "tcpKeepAlive", "+", "\"", ",", "transportFactory", "=", "\"", "+", "transportFactory", "+", "\"", ",", "valueSizeEstimate", "=", "\"", "+", "valueSizeEstimate", "+", "\"", ",", "maxRetries", "=", "\"", "+", "maxRetries", "+", "\"", ",", "serialWhiteList", "=", "\"", "+", "serialWhitelist", "+", "\"", "nearCache", "=", "\"", "+", "nearCache", "+", "\"", "]\"", ";", "}", "@", "@", "-", "295", ",", "6", "+", "302", ",", "8", "@", "@", "public", "Properties", "properties", "(", ")", "{", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "entry", ":", "security", ".", "authentication", "(", ").", "saslProperties", "(", ").", "entrySet", "(", "))", "properties", ".", "setProperty", "(", "ConfigurationProperties", ".", "SASL_PROPERTIES_PREFIX", "+", "'", ".'", "+", "entry", ".", "getKey", "(", "),", "entry", ".", "getValue", "(", "))", ";", "properties", ".", "setProperty", "(", "ConfigurationProperties", ".", "JAVA_SERIAL_WHITELIST", ",", "String", ".", "join", "(", "\",", "\",", "serialWhitelist", ")", ");", "return", "properties", ";", "}", "}", "@", "@", "-", "2", ",", "6", "+", "2", ",", "8", "@", "@", "import", "java", ".", "lang", ".", "ref", ".", "WeakReference", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Properties", ";", "@", "@", "-", "68", ",", "6", "+", "70", ",", "7", "@", "@", "private", "int", "valueSizeEstimate", "=", "ConfigurationProperties", ".", "DEFAULT_VALUE_SIZE", ";", "private", "int", "maxRetries", "=", "ConfigurationProperties", ".", "DEFAULT_MAX_RETRIES", ";", "private", "final", "NearCacheConfigurationBuilder", "nearCache", ";", "private", "final", "List", "<", "String", ">", "whiteListRegExs", "=", "new", "ArrayList", "<", ">(", ");", "private", "final", "List", "<", "ClusterConfigurationBuilder", ">", "clusters", "=", "new", "ArrayList", "<", "ClusterConfigurationBuilder", ">", "()", ";", "@", "@", "-", "281", ",", "6", "+", "284", ",", "12", "@", "@", "public", "ConfigurationBuilder", "maxRetries", "(", "int", "maxRetries", ")", "{", "return", "this", ";", "}", "@", "Override", "public", "ConfigurationBuilder", "addJavaSerialWhiteList", "(", "String", ".", "..", "regEx", ")", "{", "this", ".", "whiteListRegExs", ".", "addAll", "(", "Arrays", ".", "asList", "(", "regEx", ")", ");", "return", "this", ";", "}", "@", "Override", "public", "ConfigurationBuilder", "withProperties", "(", "Properties", "properties", ")", "{", "TypedProperties", "typed", "=", "TypedProperties", ".", "toTypedProperties", "(", "properties", ")", ";", "@", "@", "-", "322", ",", "6", "+", "331", ",", "13", "@", "@", "public", "ConfigurationBuilder", "withProperties", "(", "Properties", "properties", ")", "{", "this", ".", "maxRetries", "(", "typed", ".", "getIntProperty", "(", "ConfigurationProperties", ".", "MAX_RETRIES", ",", "maxRetries", ",", "true", ")", ");", "this", ".", "security", ".", "ssl", "(", ").", "withProperties", "(", "properties", ")", ";", "this", ".", "security", ".", "authentication", "(", ").", "withProperties", "(", "properties", ")", ";", "String", "serialWhitelist", "=", "typed", ".", "getProperty", "(", "ConfigurationProperties", ".", "JAVA_SERIAL_WHITELIST", ")", ";", "if", "(", "serialWhitelist", "!", "=", "null", ")", "{", "String", "[", "]", "classes", "=", "serialWhitelist", ".", "split", "(", "\",", "\")", ";", "Collections", ".", "addAll", "(", "this", ".", "whiteListRegExs", ",", "classes", ")", ";", "}", "return", "this", ";", "}", "@", "@", "-", "362", ",", "7", "+", "378", ",", "7", "@", "@", "public", "Configuration", "create", "(", ")", "{", "return", "new", "Configuration", "(", "asyncExecutorFactory", ".", "create", "(", "),", "balancingStrategyClass", ",", "balancingStrategy", ",", "classLoader", "=", "=", "null", "?", "null", ":", "classLoader", ".", "get", "(", "),", "clientIntelligence", ",", "connectionPool", ".", "create", "(", "),", "connectionTimeout", ",", "consistentHashImpl", ",", "forceReturnValues", ",", "keySizeEstimate", ",", "marshaller", ",", "marshallerClass", ",", "protocolVersion", ",", "servers", ",", "socketTimeout", ",", "security", ".", "create", "(", "),", "tcpNoDelay", ",", "tcpKeepAlive", ",", "transportFactory", ",", "valueSizeEstimate", ",", "maxRetries", ",", "nearCache", ".", "create", "(", "),", "serverClusterConfigs", ")", ";", "valueSizeEstimate", ",", "maxRetries", ",", "nearCache", ".", "create", "(", "),", "serverClusterConfigs", ",", "whiteListRegExs", ")", ";", "}", "@", "Override", "@", "@", "-", "405", ",", "6", "+", "421", ",", "8", "@", "@", "public", "ConfigurationBuilder", "read", "(", "Configuration", "template", ")", "{", "this", ".", "valueSizeEstimate", "=", "template", ".", "valueSizeEstimate", "(", ");", "this", ".", "maxRetries", "=", "template", ".", "maxRetries", "(", ");", "this", ".", "nearCache", ".", "read", "(", "template", ".", "nearCache", "(", "))", ";", "this", ".", "whiteListRegExs", ".", "addAll", "(", "template", ".", "serialWhitelist", "(", "))", ";", "return", "this", ";", "}", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "package", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "ProtocolVersion", ";", "@", "@", "-", "182", ",", "6", "+", "183", ",", "12", "@", "@", "*", "/", "ConfigurationBuilder", "maxRetries", "(", "int", "maxRetries", ")", ";", "/", "**", "*", "List", "of", "regular", "expressions", "for", "classes", "that", "can", "be", "deserialized", "using", "standard", "Java", "deserialization", "*", "when", "reading", "data", "that", "might", "have", "been", "stored", "with", "a", "different", "endpoint", ",", "e", ".", "g", ".", "REST", ".", "*", "/", "ConfigurationBuilder", "addJavaSerialWhiteList", "(", "String", ".", "..", "regEx", ")", ";", "/", "**", "*", "Configures", "this", "builder", "using", "the", "specified", "properties", "*", "/", "@", "@", "-", "64", ",", "19", "+", "64", ",", "21", "@", "@", "private", "final", "TransportFactory", "transportFactory", ";", "private", "final", "Consumer", "<", "WrappedByteArray", ">", "failoverClientListener", "=", "this", ":", ":", "failoverClientListener", ";", "private", "final", "List", "<", "String", ">", "whitelist", ";", "protected", "ClientListenerNotifier", "(", "ExecutorService", "executor", ",", "Codec", "codec", ",", "Marshaller", "marshaller", ",", "TransportFactory", "transportFactory", ")", "{", "Marshaller", "marshaller", ",", "TransportFactory", "transportFactory", ",", "List", "<", "String", ">", "whitelist", ")", "{", "this", ".", "executor", "=", "executor", ";", "this", ".", "codec", "=", "codec", ";", "this", ".", "marshaller", "=", "marshaller", ";", "this", ".", "transportFactory", "=", "transportFactory", ";", "this", ".", "whitelist", "=", "whitelist", ";", "}", "public", "static", "ClientListenerNotifier", "create", "(", "Codec", "codec", ",", "Marshaller", "marshaller", ",", "TransportFactory", "transportFactory", ")", "{", "public", "static", "ClientListenerNotifier", "create", "(", "Codec", "codec", ",", "Marshaller", "marshaller", ",", "TransportFactory", "transportFactory", ",", "List", "<", "String", ">", "whitelist", ")", "{", "ExecutorService", "executor", "=", "Executors", ".", "newCachedThreadPool", "(", "getRestoreThreadNameThreadFactory", "(", "))", ";", "return", "new", "ClientListenerNotifier", "(", "executor", ",", "codec", ",", "marshaller", ",", "transportFactory", ")", ";", "return", "new", "ClientListenerNotifier", "(", "executor", ",", "codec", ",", "marshaller", ",", "transportFactory", ",", "whitelist", ")", ";", "}", "private", "static", "ThreadFactory", "getRestoreThreadNameThreadFactory", "(", ")", "{", "@", "@", "-", "277", ",", "7", "+", "279", ",", "7", "@", "@", "public", "void", "run", "(", ")", "{", "while", "(", "!", "Thread", ".", "currentThread", "(", ").", "isInterrupted", "(", "))", "{", "ClientEvent", "clientEvent", "=", "null", ";", "try", "{", "clientEvent", "=", "codec", ".", "readEvent", "(", "transport", ",", "op", ".", "listenerId", ",", "marshaller", ")", ";", "clientEvent", "=", "codec", ".", "readEvent", "(", "transport", ",", "op", ".", "listenerId", ",", "marshaller", ",", "whitelist", ")", ";", "invokeClientEvent", "(", "clientEvent", ")", ";", "/", "/", "Nullify", "event", ",", "makes", "it", "easier", "to", "identify", "network", "vs", "invocation", "error", "messages", "clientEvent", "=", "null", ";", "@", "@", "-", "61", ",", "6", "+", "61", ",", "7", "@", "@", "public", "static", "final", "String", "SASL_PROPERTIES_PREFIX", "=", "\"", "infinispan", ".", "client", ".", "hotrod", ".", "sasl_properties", "\"", ";", "public", "static", "final", "Pattern", "SASL_PROPERTIES_PREFIX_REGEX", "=", "Pattern", ".", "compile", "(", "'^", "'", "+", "ConfigurationProperties", ".", "SASL_PROPERTIES_PREFIX", "+", "'", ".'", ");", "public", "static", "final", "String", "JAVA_SERIAL_WHITELIST", "=", "\"", "infinispan", ".", "client", ".", "hotrod", ".", "java_serial_whitelist", "\"", ";", "/", "/", "defaults", "@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "package", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "iteration", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "@", "@", "-", "8", ",", "7", "+", "9", ",", "7", "@", "@", "*", "/", "public", "interface", "KeyTracker", "{", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ")", ";", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", ";", "void", "segmentsFinished", "(", "byte", "[", "]", "finishedSegments", ")", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "package", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "iteration", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "@", "@", "-", "9", ",", "7", "+", "10", ",", "7", "@", "@", "class", "NoOpSegmentKeyTracker", "implements", "KeyTracker", "{", "@", "Override", "public", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ")", "{", "public", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", "{", "return", "true", ";", "}", "@", "@", "-", "1", ",", "6", "+", "1", ",", "7", "@", "@", "package", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "iteration", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "infinispan", ".", "commons", ".", "marshall", ".", "WrappedByteArray", ";", "@", "@", "-", "17", ",", "7", "+", "18", ",", "7", "@", "@", "private", "Set", "<", "WrappedByteArray", ">", "keys", "=", "new", "HashSet", "<", ">(", ");", "@", "Override", "public", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ")", "{", "public", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", "{", "return", "keys", ".", "add", "(", "new", "WrappedByteArray", "(", "key", ")", ");", "}", "@", "@", "-", "2", ",", "6", "+", "2", ",", "7", "@", "@", "import", "java", ".", "util", ".", "BitSet", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicReferenceArray", ";", "import", "java", ".", "util", ".", "stream", ".", "IntStream", ";", "@", "@", "-", "38", ",", "9", "+", "39", ",", "9", "@", "@", "public", "SegmentKeyTracker", "(", "Marshaller", "marshaller", ",", "SegmentConsistentHash", "segmentCon", "segmentStream", ".", "forEach", "(", "i", "-", ">", "keysPerSegment", ".", "set", "(", "i", ",", "new", "HashSet", "<", ">(", "))", ");", "}", "public", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ")", "{", "public", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", "{", "int", "segment", "=", "HotRodConstants", ".", "hasCompatibility", "(", "status", ")", "?", "segmentConsistentHash", ".", "getSegment", "(", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "key", ",", "status", ")", ")", ":", "segmentConsistentHash", ".", "getSegment", "(", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "key", ",", "status", ",", "whitelist", ")", ")", ":", "segmentConsistentHash", ".", "getSegment", "(", "key", ")", ";", "boolean", "result", "=", "keysPerSegment", ".", "get", "(", "segment", ")", ".", "add", "(", "new", "WrappedByteArray", "(", "key", ")", ");", "if", "(", "log", ".", "isTraceEnabled", "(", "))", "@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "VersionedOperationResponse", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "26", ",", "8", "+", "26", ",", "8", "@", "@", "protected", "final", "byte", "[", "]", "keyBytes", ";", "protected", "AbstractKeyOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "key", "=", "key", ";", "this", ".", "keyBytes", "=", "keyBytes", ";", "}", "@", "@", "-", "52", ",", "7", "+", "52", ",", "7", "@", "@", "protected", "short", "sendKeyOperation", "(", "byte", "[", "]", "key", ",", "Transport", "transport", ",", "byte", "opCode", ",", "b", "}", "protected", "T", "returnPossiblePrevValue", "(", "Transport", "transport", ",", "short", "status", ")", "{", "return", "(", "T", ")", "codec", ".", "returnPossiblePrevValue", "(", "transport", ",", "status", ",", "flags", ")", ";", "return", "(", "T", ")", "codec", ".", "returnPossiblePrevValue", "(", "transport", ",", "status", ",", "flags", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "}", "protected", "VersionedOperationResponse", "returnVersionedOperationResponse", "(", "Transport", "transport", ",", "HeaderParams", "params", ")", "{", "@", "@", "-", "3", ",", "7", "+", "3", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "31", ",", "9", "+", "31", ",", "9", "@", "@", "protected", "final", "TimeUnit", "maxIdleTimeUnit", ";", "protected", "AbstractKeyValueOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "value", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "value", "=", "value", ";", "this", ".", "lifespan", "=", "lifespan", ";", "this", ".", "maxIdle", "=", "maxIdle", ";", "@", "@", "-", "8", ",", "7", "+", "8", ",", "7", "@", "@", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "RemoteCacheManager", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "annotation", ".", "ClientListener", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "event", ".", "ClientEvent", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "event", ".", "ClientListenerNotifier", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "@", "@", "-", "44", ",", "10", "+", "44", ",", "10", "@", "@", "public", "final", "byte", "[", "][", "]", "converterFactoryParams", ";", "protected", "AddClientListenerOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "String", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "String", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ",", "ClientListenerNotifier", "listenerNotifier", ",", "Object", "listener", ",", "byte", "[", "][", "]", "filterFactoryParams", ",", "byte", "[", "][", "]", "converterFactoryParams", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "RemoteCacheManager", ".", "cacheNameBytes", "(", "cacheName", ")", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "super", "(", "codec", ",", "transportFactory", ",", "RemoteCacheManager", ".", "cacheNameBytes", "(", "cacheName", ")", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "listenerId", "=", "generateListenerId", "(", ");", "this", ".", "listenerNotifier", "=", "listenerNotifier", ";", "this", ".", "listener", "=", "listener", ";", "@", "@", "-", "94", ",", "7", "+", "94", ",", "7", "@", "@", "protected", "Short", "executeOperation", "(", "Transport", "transport", ")", "{", "Either", "<", "Short", ",", "ClientEvent", ">", "either", ";", "do", "{", "/", "/", "Process", "state", "transfer", "related", "events", "or", "add", "listener", "response", "either", "=", "codec", ".", "readHeaderOrEvent", "(", "dedicatedTransport", ",", "params", ",", "listenerId", ",", "listenerNotifier", ".", "getMarshaller", "(", "))", ";", "either", "=", "codec", ".", "readHeaderOrEvent", "(", "dedicatedTransport", ",", "params", ",", "listenerId", ",", "listenerNotifier", ".", "getMarshaller", "(", "),", "cfg", ".", "serialWhitelist", "(", "))", ";", "switch", "(", "either", ".", "type", "(", "))", "{", "case", "LEFT", ":", "if", "(", "HotRodConstants", ".", "isSuccess", "(", "either", ".", "left", "(", "))", ")", "@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "22", ",", "8", "+", "22", ",", "8", "@", "@", "private", "final", "Transport", "transport", ";", "public", "AuthMechListOperation", "(", "Codec", "codec", ",", "AtomicInteger", "topologyId", ",", "ClientIntelligence", "clientIntelligence", ",", "Transport", "transport", ")", "{", "super", "(", "codec", ",", "0", ",", "clientIntelligence", ",", "DEFAULT_CACHE_NAME_BYTES", ",", "topologyId", ")", ";", "public", "AuthMechListOperation", "(", "Codec", "codec", ",", "AtomicInteger", "topologyId", ",", "Configuration", "cfg", ",", "Transport", "transport", ")", "{", "super", "(", "codec", ",", "0", ",", "cfg", ",", "DEFAULT_CACHE_NAME_BYTES", ",", "topologyId", ")", ";", "this", ".", "transport", "=", "transport", ";", "}", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "22", ",", "9", "+", "22", ",", "9", "@", "@", "private", "final", "String", "saslMechanism", ";", "private", "final", "byte", "[", "]", "response", ";", "public", "AuthOperation", "(", "Codec", "codec", ",", "AtomicInteger", "topologyId", ",", "ClientIntelligence", "clientIntelligence", ",", "Transport", "transport", ",", "public", "AuthOperation", "(", "Codec", "codec", ",", "AtomicInteger", "topologyId", ",", "Configuration", "cfg", ",", "Transport", "transport", ",", "String", "saslMechanism", ",", "byte", "response", "[", "])", "{", "super", "(", "codec", ",", "0", ",", "clientIntelligence", ",", "DEFAULT_CACHE_NAME_BYTES", ",", "topologyId", ")", ";", "super", "(", "codec", ",", "0", ",", "cfg", ",", "DEFAULT_CACHE_NAME_BYTES", ",", "topologyId", ")", ";", "this", ".", "transport", "=", "transport", ";", "this", ".", "saslMechanism", "=", "saslMechanism", ";", "this", ".", "response", "=", "response", ";", "@", "@", "-", "5", ",", "7", "+", "5", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "21", ",", "8", "+", "21", ",", "8", "@", "@", "private", "final", "int", "scope", ";", "public", "BulkGetKeysOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "int", "scope", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ",", "int", "scope", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "scope", "=", "scope", ";", "}", "@", "@", "-", "39", ",", "7", "+", "39", ",", "7", "@", "@", "protected", "Transport", "getTransport", "(", "int", "retryCount", ",", "Set", "<", "SocketAddress", ">", "failedServer", "short", "status", "=", "readHeaderAndValidate", "(", "transport", ",", "params", ")", ";", "Set", "<", "K", ">", "result", "=", "new", "HashSet", "<", "K", ">", "()", ";", "while", "(", "transport", ".", "readByte", "(", ")", "=", "=", "1", ")", "{", "/", "/", "there", "'", "s", "more", "!", "result", ".", "add", "(", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ");", "result", ".", "add", "(", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ");", "}", "return", "result", ";", "}", "@", "@", "-", "6", ",", "7", "+", "6", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "23", ",", "8", "+", "23", ",", "8", "@", "@", "private", "final", "int", "entryCount", ";", "public", "BulkGetOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "int", "entryCount", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "int", "flags", ",", "Configuration", "cfg", ",", "int", "entryCount", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "entryCount", "=", "entryCount", ";", "}", "@", "@", "-", "41", ",", "8", "+", "41", ",", "8", "@", "@", "protected", "Transport", "getTransport", "(", "int", "retryCount", ",", "Set", "<", "SocketAddress", ">", "failedServer", "short", "status", "=", "readHeaderAndValidate", "(", "transport", ",", "params", ")", ";", "Map", "<", "K", ",", "V", ">", "result", "=", "new", "HashMap", "<", "K", ",", "V", ">", "()", ";", "while", "(", "transport", ".", "readByte", "(", ")", "=", "=", "1", ")", "{", "/", "/", "there", "'", "s", "more", "!", "K", "key", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "V", "value", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "K", "key", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "V", "value", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "result", ".", "put", "(", "key", ",", "value", ")", ";", "}", "return", "result", ";", "@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "22", ",", "8", "+", "22", ",", "8", "@", "@", "public", "class", "ClearOperation", "extends", "RetryOnFailureOperation", "<", "Void", ">", "{", "public", "ClearOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "20", ",", "8", "+", "20", ",", "8", "@", "@", "public", "class", "ContainsKeyOperation", "extends", "AbstractKeyOperation", "<", "Boolean", ">", "{", "public", "ContainsKeyOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "6", ",", "7", "+", "6", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "24", ",", "9", "+", "24", ",", "9", "@", "@", "private", "final", "Map", "<", "String", ",", "byte", "[", "]>", "marshalledParams", ";", "protected", "ExecuteOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ",", "String", "taskName", ",", "Map", "<", "String", ",", "byte", "[", "]>", "marshalledParams", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", "=", "=", "null", "?", "DEFAULT_CACHE_NAME_BYTES", ":", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", "=", "=", "null", "?", "DEFAULT_CACHE_NAME_BYTES", ":", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "taskName", "=", "taskName", ";", "this", ".", "marshalledParams", "=", "marshalledParams", ";", "}", "@", "@", "-", "48", ",", "7", "+", "48", ",", "7", "@", "@", "protected", "T", "executeOperation", "(", "Transport", "transport", ")", "{", "}", "transport", ".", "flush", "(", ");", "short", "status", "=", "readHeaderAndValidate", "(", "transport", ",", "params", ")", ";", "return", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "return", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "}", "}", "@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "TransportFactory", ";", "@", "@", "-", "19", ",", "8", "+", "19", ",", "8", "@", "@", "protected", "FaultTolerantPingOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "30", ",", "7", "+", "30", ",", "7", "@", "@", "protected", "Transport", "getTransport", "(", "int", "retryCount", ",", "Set", "<", "SocketAddress", ">", "failedServer", "@", "Override", "protected", "PingOperation", ".", "PingResult", "executeOperation", "(", "Transport", "transport", ")", "{", "return", "new", "PingOperation", "(", "codec", ",", "topologyId", ",", "clientIntelligence", ",", "transport", ",", "cacheName", ")", ".", "execute", "(", ");", "return", "new", "PingOperation", "(", "codec", ",", "topologyId", ",", "cfg", ",", "transport", ",", "cacheName", ")", ".", "execute", "(", ");", "}", "}", "@", "@", "-", "6", ",", "7", "+", "6", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "25", ",", "8", "+", "25", ",", "8", "@", "@", "public", "GetAllOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Set", "<", "byte", "[", "]>", "keys", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "keys", "=", "keys", ";", "}", "@", "@", "-", "45", ",", "8", "+", "45", ",", "8", "@", "@", "public", "GetAllOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "int", "size", "=", "transport", ".", "readVInt", "(", ");", "Map", "<", "K", ",", "V", ">", "result", "=", "new", "HashMap", "<", "K", ",", "V", ">", "(", "size", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "size", ";", "+", "+", "i", ")", "{", "K", "key", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "V", "value", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "K", "key", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "V", "value", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "result", ".", "put", "(", "key", ",", "value", ")", ";", "}", "return", "result", ";", "@", "@", "-", "10", ",", "7", "+", "10", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "TransportFactory", ";", "@", "@", "-", "22", ",", "8", "+", "22", ",", "8", "@", "@", "private", "final", "Set", "<", "byte", "[", "]>", "keys", ";", "protected", "GetAllParallelOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Set", "<", "byte", "[", "]>", "keys", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "ExecutorService", "executorService", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ",", "executorService", ")", ";", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ",", "ExecutorService", "executorService", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ",", "executorService", ")", ";", "this", ".", "keys", "=", "keys", ";", "}", "@", "@", "-", "43", ",", "7", "+", "43", ",", "7", "@", "@", "protected", "GetAllParallelOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", "return", "splittedKeys", ".", "values", "(", ").", "stream", "(", ").", "map", "(", "keysSubset", "-", ">", "new", "GetAllOperation", "<", "K", ",", "V", ">", "(", "codec", ",", "transportFactory", ",", "keysSubset", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ").", "collect", "(", "Collectors", ".", "toList", "(", "))", ";", "flags", ",", "cfg", ")", ").", "collect", "(", "Collectors", ".", "toList", "(", "))", ";", "}", "@", "Override", "@", "@", "-", "1", ",", "8", "+", "1", ",", "10", "@", "@", "package", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "operations", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "21", ",", "8", "+", "23", ",", "8", "@", "@", "public", "GetOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "33", ",", "7", "+", "35", ",", "7", "@", "@", "public", "V", "executeOperation", "(", "Transport", "transport", ")", "{", "result", "=", "null", ";", "}", "else", "{", "if", "(", "HotRodConstants", ".", "isSuccess", "(", "status", ")", ")", "{", "result", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "result", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "}", "}", "return", "result", ";", "@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "VersionedMetadata", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "VersionedMetadataImpl", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "26", ",", "8", "+", "26", ",", "8", "@", "@", "private", "boolean", "retryable", ";", "public", "GetStreamOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "int", "offset", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "int", "offset", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "offset", "=", "offset", ";", "retryable", "=", "true", ";", "}", "@", "@", "-", "3", ",", "7", "+", "3", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "MetadataValue", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "MetadataValueImpl", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "@", "@", "-", "29", ",", "8", "+", "29", ",", "8", "@", "@", "public", "GetWithMetadataOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "57", ",", "7", "+", "57", ",", "7", "@", "@", "public", "GetWithMetadataOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "if", "(", "trace", ")", "{", "log", ".", "tracef", "(", "\"", "Received", "version", ":", "%", "d", "\"", ",", "version", ")", ";", "}", "V", "value", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "V", "value", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "result", "=", "new", "MetadataValueImpl", "<", "V", ">", "(", "creation", ",", "lifespan", ",", "lastUsed", ",", "maxIdle", ",", "version", ",", "value", ")", ";", "}", "return", "result", ";", "@", "@", "-", "1", ",", "9", "+", "1", ",", "11", "@", "@", "package", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "operations", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "VersionedValue", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "VersionedValueImpl", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "@", "@", "-", "30", ",", "8", "+", "32", ",", "8", "@", "@", "public", "GetWithVersionOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "45", ",", "7", "+", "47", ",", "7", "@", "@", "public", "GetWithVersionOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "O", "if", "(", "trace", ")", "{", "log", ".", "tracef", "(", "\"", "Received", "version", ":", "%", "d", "\"", ",", "version", ")", ";", "}", "V", "value", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "V", "value", "=", "codec", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "result", "=", "new", "VersionedValueImpl", "<", "V", ">", "(", "version", ",", "value", ")", ";", "}", "return", "result", ";", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "@", "@", "-", "29", ",", "14", "+", "29", ",", "14", "@", "@", "protected", "final", "Codec", "codec", ";", "protected", "final", "ClientIntelligence", "clientIntelligence", ";", "protected", "final", "Configuration", "cfg", ";", "private", "static", "final", "byte", "NO_TX", "=", "0", ";", "private", "static", "final", "byte", "XA_TX", "=", "1", ";", "protected", "HotRodOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ")", "{", "protected", "HotRodOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ")", "{", "this", ".", "flags", "=", "flags", ";", "this", ".", "clientIntelligence", "=", "clientIntelligence", ";", "this", ".", "cfg", "=", "cfg", ";", "this", ".", "cacheName", "=", "cacheName", ";", "this", ".", "topologyId", "=", "topologyId", ";", "this", ".", "codec", "=", "codec", ";", "@", "@", "-", "47", ",", "7", "+", "47", ",", "7", "@", "@", "protected", "HotRodOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "ClientIntelligence", "clientIntel", "protected", "final", "HeaderParams", "writeHeader", "(", "Transport", "transport", ",", "short", "operationCode", ")", "{", "HeaderParams", "params", "=", "new", "HeaderParams", "(", ")", ".", "opCode", "(", "operationCode", ")", ".", "cacheName", "(", "cacheName", ")", ".", "flags", "(", "flags", ")", ".", "clientIntel", "(", "clientIntelligence", ")", ".", "clientIntel", "(", "cfg", ".", "clientIntelligence", "(", "))", ".", "topologyId", "(", "topologyId", ")", ".", "txMarker", "(", "NO_TX", ")", ".", "topologyAge", "(", "transport", ".", "getTransportFactory", "(", ").", "getTopologyAge", "(", "))", ";", "return", "codec", ".", "writeHeader", "(", "transport", ",", "params", ")", ";", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "18", ",", "10", "+", "18", ",", "10", "@", "@", "private", "final", "TransportFactory", "transportFactory", ";", "private", "final", "Transport", "transport", ";", "protected", "IterationEndOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "cacheName", ",", "protected", "IterationEndOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "String", "iterationId", ",", "TransportFactory", "transportFactory", ",", "Transport", "transport", ")", "{", "super", "(", "codec", ",", "flags", ",", "clientIntelligence", ",", "cacheName", ",", "topologyId", ")", ";", "super", "(", "codec", ",", "flags", ",", "cfg", ",", "cacheName", ",", "topologyId", ")", ";", "this", ".", "iterationId", "=", "iterationId", ";", "this", ".", "transportFactory", "=", "transportFactory", ";", "this", ".", "transport", "=", "transport", ";", "@", "@", "-", "6", ",", "7", "+", "6", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Map", ".", "Entry", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "MetadataValueImpl", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "iteration", ".", "KeyTracker", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "@", "@", "-", "28", ",", "15", "+", "28", ",", "16", "@", "@", "private", "final", "String", "iterationId", ";", "private", "final", "Transport", "transport", ";", "private", "final", "List", "<", "String", ">", "whitelist", ";", "private", "final", "KeyTracker", "segmentKeyTracker", ";", "protected", "IterationNextOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "cacheName", ",", "protected", "IterationNextOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "String", "iterationId", ",", "Transport", "transport", ",", "KeyTracker", "segmentKeyTracker", ")", "{", "super", "(", "codec", ",", "flags", ",", "clientIntelligence", ",", "cacheName", ",", "topologyId", ")", ";", "KeyTracker", "segmentKeyTracker", ",", "List", "<", "String", ">", "whitelist", ")", "{", "super", "(", "codec", ",", "flags", ",", "cfg", ",", "cacheName", ",", "topologyId", ")", ";", "this", ".", "iterationId", "=", "iterationId", ";", "this", ".", "transport", "=", "transport", ";", "this", ".", "whitelist", "=", "whitelist", ";", "this", ".", "segmentKeyTracker", "=", "segmentKeyTracker", ";", "}", "@", "@", "-", "88", ",", "7", "+", "89", ",", "7", "@", "@", "protected", "IterationNextOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "ClientIntelligence", "clie", "value", "=", "new", "MetadataValueImpl", "<", ">(", "creation", ",", "lifespan", ",", "lastUsed", ",", "maxIdle", ",", "version", ",", "value", ")", ";", "}", "if", "(", "segmentKeyTracker", ".", "track", "(", "key", ",", "status", ")", ")", "{", "if", "(", "segmentKeyTracker", ".", "track", "(", "key", ",", "status", ",", "whitelist", ")", ")", "{", "entries", ".", "add", "(", "new", "SimpleEntry", "<", ">(", "unmarshall", "(", "key", ",", "status", ")", ",", "(", "E", ")", "value", ")", ");", "}", "}", "@", "@", "-", "102", ",", "7", "+", "103", ",", "7", "@", "@", "protected", "IterationNextOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "ClientIntelligence", "clie", "private", "Object", "unmarshall", "(", "byte", "[", "]", "bytes", ",", "short", "status", ")", "{", "Marshaller", "marshaller", "=", "transport", ".", "getTransportFactory", "(", ").", "getMarshaller", "(", ");", "return", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "bytes", ",", "status", ")", ";", "return", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "bytes", ",", "status", ",", "whitelist", ")", ";", "}", "}", "@", "@", "-", "7", ",", "7", "+", "7", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "consistenthash", ".", "SegmentConsistentHash", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "27", ",", "10", "+", "27", ",", "10", "@", "@", "private", "final", "TransportFactory", "transportFactory", ";", "private", "final", "boolean", "metadata", ";", "IterationStartOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "IterationStartOperation", "(", "Codec", "codec", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "String", "filterConverterFactory", ",", "byte", "[", "][", "]", "filterParameters", ",", "Set", "<", "Integer", ">", "segments", ",", "int", "batchSize", ",", "TransportFactory", "transportFactory", ",", "boolean", "metadata", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "filterConverterFactory", "=", "filterConverterFactory", ";", "this", ".", "filterParameters", "=", "filterParameters", ";", "this", ".", "segments", "=", "segments", ";", "@", "@", "-", "9", ",", "7", "+", "9", ",", "7", "@", "@", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "CacheTopologyInfo", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "Flag", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "RemoteCacheManager", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "event", ".", "ClientListenerNotifier", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "iteration", ".", "KeyTracker", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "@", "@", "-", "47", ",", "10", "+", "47", ",", "10", "@", "@", "private", "final", "ExecutorService", "executorService", ";", "private", "final", "ClientIntelligence", "clientIntelligence", ";", "private", "final", "Configuration", "cfg", ";", "public", "OperationsFactory", "(", "TransportFactory", "transportFactory", ",", "String", "cacheName", ",", "boolean", "forceReturnValue", ",", "Codec", "codec", ",", "ClientListenerNotifier", "listenerNotifier", ",", "ExecutorService", "executorService", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "codec", ",", "ClientListenerNotifier", "listenerNotifier", ",", "ExecutorService", "executorService", ",", "Configuration", "cfg", ")", "{", "this", ".", "transportFactory", "=", "transportFactory", ";", "this", ".", "executorService", "=", "executorService", ";", "this", ".", "cacheNameBytes", "=", "cacheName", "=", "=", "null", "?", "null", ":", "RemoteCacheManager", ".", "cacheNameBytes", "(", "cacheName", ")", ";", "@", "@", "-", "61", ",", "11", "+", "61", ",", "11", "@", "@", "public", "OperationsFactory", "(", "TransportFactory", "transportFactory", ",", "String", "cacheName", ",", "bo", "this", ".", "forceReturnValue", "=", "forceReturnValue", ";", "this", ".", "codec", "=", "codec", ";", "this", ".", "listenerNotifier", "=", "listenerNotifier", ";", "this", ".", "clientIntelligence", "=", "clientIntelligence", ";", "this", ".", "cfg", "=", "cfg", ";", "}", "public", "OperationsFactory", "(", "TransportFactory", "transportFactory", ",", "Codec", "codec", ",", "ExecutorService", "executorService", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "this", "(", "transportFactory", ",", "null", ",", "false", ",", "codec", ",", "null", ",", "executorService", ",", "clientIntelligence", ")", ";", "public", "OperationsFactory", "(", "TransportFactory", "transportFactory", ",", "Codec", "codec", ",", "ExecutorService", "executorService", ",", "Configuration", "cfg", ")", "{", "this", "(", "transportFactory", ",", "null", ",", "false", ",", "codec", ",", "null", ",", "executorService", ",", "cfg", ")", ";", "}", "public", "ClientListenerNotifier", "getListenerNotifier", "(", ")", "{", "@", "@", "-", "78", ",", "110", "+", "78", ",", "110", "@", "@", "public", "ClientListenerNotifier", "getListenerNotifier", "(", ")", "{", "public", "<", "V", ">", "GetOperation", "<", "V", ">", "newGetKeyOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ")", "{", "return", "new", "GetOperation", "<", ">(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "<", "K", ",", "V", ">", "GetAllParallelOperation", "<", "K", ",", "V", ">", "newGetAllOperation", "(", "Set", "<", "byte", "[", "]>", "keys", ")", "{", "return", "new", "GetAllParallelOperation", "<", ">(", "codec", ",", "transportFactory", ",", "keys", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "executorService", ")", ";", "cfg", ",", "executorService", ")", ";", "}", "public", "<", "V", ">", "RemoveOperation", "<", "V", ">", "newRemoveOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ")", "{", "return", "new", "RemoveOperation", "<", ">(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "<", "V", ">", "RemoveIfUnmodifiedOperation", "<", "V", ">", "newRemoveIfUnmodifiedOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "long", "version", ")", "{", "return", "new", "RemoveIfUnmodifiedOperation", "<", ">(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "version", ")", ";", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "version", ")", ";", "}", "public", "ReplaceIfUnmodifiedOperation", "newReplaceIfUnmodifiedOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ",", "long", "version", ")", "{", "return", "new", "ReplaceIfUnmodifiedOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "lifespan", ",", "maxIdle", ")", ",", "clientIntelligence", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ",", "version", ")", ";", "cfg", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ",", "version", ")", ";", "}", "public", "<", "V", ">", "GetWithVersionOperation", "<", "V", ">", "newGetWithVersionOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ")", "{", "return", "new", "GetWithVersionOperation", "<", ">(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "<", "V", ">", "GetWithMetadataOperation", "<", "V", ">", "newGetWithMetadataOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ")", "{", "return", "new", "GetWithMetadataOperation", "<", ">(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "StatsOperation", "newStatsOperation", "(", ")", "{", "return", "new", "StatsOperation", "(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "<", "V", ">", "PutOperation", "<", "V", ">", "newPutKeyValueOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "return", "new", "PutOperation", "<", ">(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "lifespan", ",", "maxIdle", ")", ",", "clientIntelligence", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "cfg", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "}", "public", "PutAllParallelOperation", "newPutAllOperation", "(", "Map", "<", "byte", "[", "],", "byte", "[", "]>", "map", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "return", "new", "PutAllParallelOperation", "(", "codec", ",", "transportFactory", ",", "map", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "lifespan", ",", "maxIdle", ")", ",", "clientIntelligence", ",", "codec", ",", "transportFactory", ",", "map", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "lifespan", ",", "maxIdle", ")", ",", "cfg", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ",", "executorService", ")", ";", "}", "public", "<", "V", ">", "PutIfAbsentOperation", "<", "V", ">", "newPutIfAbsentOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanUnit", ",", "long", "maxIdleTime", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "return", "new", "PutIfAbsentOperation", "<", ">(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "lifespan", ",", "maxIdleTime", ")", ",", "clientIntelligence", ",", "value", ",", "lifespan", ",", "lifespanUnit", ",", "maxIdleTime", ",", "maxIdleTimeUnit", ")", ";", "cfg", ",", "value", ",", "lifespan", ",", "lifespanUnit", ",", "maxIdleTime", ",", "maxIdleTimeUnit", ")", ";", "}", "public", "<", "V", ">", "ReplaceOperation", "<", "V", ">", "newReplaceOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "values", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "return", "new", "ReplaceOperation", "<", ">(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "lifespan", ",", "maxIdle", ")", ",", "clientIntelligence", ",", "values", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "cfg", ",", "values", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "}", "public", "ContainsKeyOperation", "newContainsKeyOperation", "(", "Object", "key", ",", "byte", "[", "]", "keyBytes", ")", "{", "return", "new", "ContainsKeyOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "ClearOperation", "newClearOperation", "(", ")", "{", "return", "new", "ClearOperation", "(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "<", "K", ",", "V", ">", "BulkGetOperation", "<", "K", ",", "V", ">", "newBulkGetOperation", "(", "int", "size", ")", "{", "return", "new", "BulkGetOperation", "(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "size", ")", ";", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "size", ")", ";", "}", "public", "<", "K", ">", "BulkGetKeysOperation", "<", "K", ">", "newBulkGetKeysOperation", "(", "int", "scope", ")", "{", "return", "new", "BulkGetKeysOperation", "<", ">(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "scope", ")", ";", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "scope", ")", ";", "}", "public", "AddClientListenerOperation", "newAddClientListenerOperation", "(", "Object", "listener", ")", "{", "return", "new", "AddClientListenerOperation", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "listenerNotifier", ",", "cacheName", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "listenerNotifier", ",", "listener", ",", "null", ",", "null", ")", ";", "}", "public", "AddClientListenerOperation", "newAddClientListenerOperation", "(", "Object", "listener", ",", "byte", "[", "][", "]", "filterFactoryParams", ",", "byte", "[", "][", "]", "converterFactoryParams", ")", "{", "return", "new", "AddClientListenerOperation", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "listenerNotifier", ",", "cacheName", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "listenerNotifier", ",", "listener", ",", "filterFactoryParams", ",", "converterFactoryParams", ")", ";", "}", "public", "RemoveClientListenerOperation", "newRemoveClientListenerOperation", "(", "Object", "listener", ")", "{", "return", "new", "RemoveClientListenerOperation", "(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "listenerNotifier", ",", "listener", ")", ";", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "listenerNotifier", ",", "listener", ")", ";", "}", "/", "**", "@", "@", "-", "191", ",", "7", "+", "191", ",", "7", "@", "@", "public", "RemoveClientListenerOperation", "newRemoveClientListenerOperation", "(", "Object", "lis", "*", "@", "return", "a", "ping", "operation", "for", "a", "particular", "node", "*", "/", "public", "PingOperation", "newPingOperation", "(", "Transport", "transport", ")", "{", "return", "new", "PingOperation", "(", "codec", ",", "topologyId", ",", "clientIntelligence", ",", "transport", ",", "cacheNameBytes", ")", ";", "return", "new", "PingOperation", "(", "codec", ",", "topologyId", ",", "cfg", ",", "transport", ",", "cacheNameBytes", ")", ";", "}", "/", "**", "@", "@", "-", "203", ",", "21", "+", "203", ",", "21", "@", "@", "public", "PingOperation", "newPingOperation", "(", "Transport", "transport", ")", "{", "*", "/", "public", "FaultTolerantPingOperation", "newFaultTolerantPingOperation", "(", ")", "{", "return", "new", "FaultTolerantPingOperation", "(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "QueryOperation", "newQueryOperation", "(", "RemoteQuery", "remoteQuery", ")", "{", "return", "new", "QueryOperation", "(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "remoteQuery", ")", ";", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "remoteQuery", ")", ";", "}", "public", "SizeOperation", "newSizeOperation", "(", ")", "{", "return", "new", "SizeOperation", "(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "return", "new", "SizeOperation", "(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "<", "T", ">", "ExecuteOperation", "<", "T", ">", "newExecuteOperation", "(", "String", "taskName", ",", "Map", "<", "String", ",", "byte", "[", "]>", "marshalledParams", ")", "{", "return", "new", "ExecuteOperation", "<", ">(", "codec", ",", "transportFactory", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "taskName", ",", "marshalledParams", ")", ";", "topologyId", ",", "flags", "(", "),", "cfg", ",", "taskName", ",", "marshalledParams", ")", ";", "}", "private", "int", "flags", "(", "long", "lifespan", ",", "long", "maxIdle", ")", "{", "@", "@", "-", "265", ",", "30", "+", "265", ",", "30", "@", "@", "public", "CacheTopologyInfo", "getCacheTopologyInfo", "(", ")", "{", "}", "public", "IterationStartOperation", "newIterationStartOperation", "(", "String", "filterConverterFactory", ",", "byte", "[", "][", "]", "filterParameters", ",", "Set", "<", "Integer", ">", "segments", ",", "int", "batchSize", ",", "boolean", "metadata", ")", "{", "return", "new", "IterationStartOperation", "(", "codec", ",", "flags", "(", "),", "clientIntelligence", ",", "cacheNameBytes", ",", "topologyId", ",", "filterConverterFactory", ",", "filterParameters", ",", "segments", ",", "batchSize", ",", "transportFactory", ",", "metadata", ")", ";", "return", "new", "IterationStartOperation", "(", "codec", ",", "flags", "(", "),", "cfg", ",", "cacheNameBytes", ",", "topologyId", ",", "filterConverterFactory", ",", "filterParameters", ",", "segments", ",", "batchSize", ",", "transportFactory", ",", "metadata", ")", ";", "}", "public", "IterationEndOperation", "newIterationEndOperation", "(", "String", "iterationId", ",", "Transport", "transport", ")", "{", "return", "new", "IterationEndOperation", "(", "codec", ",", "flags", "(", "),", "clientIntelligence", ",", "cacheNameBytes", ",", "topologyId", ",", "iterationId", ",", "transportFactory", ",", "transport", ")", ";", "return", "new", "IterationEndOperation", "(", "codec", ",", "flags", "(", "),", "cfg", ",", "cacheNameBytes", ",", "topologyId", ",", "iterationId", ",", "transportFactory", ",", "transport", ")", ";", "}", "public", "<", "K", ",", "V", ">", "IterationNextOperation", "newIterationNextOperation", "(", "String", "iterationId", ",", "Transport", "transport", ",", "KeyTracker", "segmentKeyTracker", ")", "{", "return", "new", "IterationNextOperation", "(", "codec", ",", "flags", "(", "),", "clientIntelligence", ",", "cacheNameBytes", ",", "topologyId", ",", "iterationId", ",", "transport", ",", "segmentKeyTracker", ")", ";", "return", "new", "IterationNextOperation", "(", "codec", ",", "flags", "(", "),", "cfg", ",", "cacheNameBytes", ",", "topologyId", ",", "iterationId", ",", "transport", ",", "segmentKeyTracker", ",", "cfg", ".", "serialWhitelist", "(", "))", ";", "}", "public", "<", "K", ">", "GetStreamOperation", "newGetStreamOperation", "(", "K", "key", ",", "byte", "[", "]", "keyBytes", ",", "int", "offset", ")", "{", "return", "new", "GetStreamOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "offset", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ")", ";", "return", "new", "GetStreamOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "offset", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ")", ";", "}", "public", "<", "K", ">", "PutStreamOperation", "newPutStreamOperation", "(", "K", "key", ",", "byte", "[", "]", "keyBytes", ",", "long", "version", ",", "long", "lifespan", ",", "TimeUnit", "lifespanUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleUnit", ")", "{", "return", "new", "PutStreamOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "version", ",", "lifespan", ",", "lifespanUnit", ",", "maxIdle", ",", "maxIdleUnit", ")", ";", "return", "new", "PutStreamOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "version", ",", "lifespan", ",", "lifespanUnit", ",", "maxIdle", ",", "maxIdleUnit", ")", ";", "}", "public", "<", "K", ">", "PutStreamOperation", "newPutStreamOperation", "(", "K", "key", ",", "byte", "[", "]", "keyBytes", ",", "long", "lifespan", ",", "TimeUnit", "lifespanUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleUnit", ")", "{", "return", "new", "PutStreamOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "PutStreamOperation", ".", "VERSION_PUT", ",", "lifespan", ",", "lifespanUnit", ",", "maxIdle", ",", "maxIdleUnit", ")", ";", "return", "new", "PutStreamOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "PutStreamOperation", ".", "VERSION_PUT", ",", "lifespan", ",", "lifespanUnit", ",", "maxIdle", ",", "maxIdleUnit", ")", ";", "}", "public", "<", "K", ">", "PutStreamOperation", "newPutIfAbsentStreamOperation", "(", "K", "key", ",", "byte", "[", "]", "keyBytes", ",", "long", "lifespan", ",", "TimeUnit", "lifespanUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleUnit", ")", "{", "return", "new", "PutStreamOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "clientIntelligence", ",", "PutStreamOperation", ".", "VERSION_PUT_IF_ABSENT", ",", "lifespan", ",", "lifespanUnit", ",", "maxIdle", ",", "maxIdleUnit", ")", ";", "return", "new", "PutStreamOperation", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheNameBytes", ",", "topologyId", ",", "flags", "(", "),", "cfg", ",", "PutStreamOperation", ".", "VERSION_PUT_IF_ABSENT", ",", "lifespan", ",", "lifespanUnit", ",", "maxIdle", ",", "maxIdleUnit", ")", ";", "}", "}", "@", "@", "-", "11", ",", "6", "+", "11", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "ParallelOperationException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "TransportFactory", ";", "@", "@", "-", "30", ",", "8", "+", "31", ",", "8", "@", "@", "protected", "final", "CompletionService", "<", "T", ">", "completionService", ";", "protected", "ParallelHotRodOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "ExecutorService", "executorService", ")", "{", "super", "(", "codec", ",", "flags", ",", "clientIntelligence", ",", "cacheName", ",", "topologyId", ")", ";", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ",", "ExecutorService", "executorService", ")", "{", "super", "(", "codec", ",", "flags", ",", "cfg", ",", "cacheName", ",", "topologyId", ")", ";", "this", ".", "transportFactory", "=", "transportFactory", ";", "this", ".", "completionService", "=", "new", "ExecutorCompletionService", "<", ">(", "executorService", ")", ";", "}", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "HotRodClientException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "InvalidResponseException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "@", "@", "-", "28", ",", "12", "+", "28", ",", "12", "@", "@", "private", "final", "Transport", "transport", ";", "public", "PingOperation", "(", "Codec", "codec", ",", "AtomicInteger", "topologyId", ",", "ClientIntelligence", "clientIntelligence", ",", "Transport", "transport", ")", "{", "this", "(", "codec", ",", "topologyId", ",", "clientIntelligence", ",", "transport", ",", "DEFAULT_CACHE_NAME_BYTES", ")", ";", "public", "PingOperation", "(", "Codec", "codec", ",", "AtomicInteger", "topologyId", ",", "Configuration", "cfg", ",", "Transport", "transport", ")", "{", "this", "(", "codec", ",", "topologyId", ",", "cfg", ",", "transport", ",", "DEFAULT_CACHE_NAME_BYTES", ")", ";", "}", "public", "PingOperation", "(", "Codec", "codec", ",", "AtomicInteger", "topologyId", ",", "ClientIntelligence", "clientIntelligence", ",", "Transport", "transport", ",", "byte", "[", "]", "cacheName", ")", "{", "super", "(", "codec", ",", "0", ",", "clientIntelligence", ",", "cacheName", ",", "topologyId", ")", ";", "public", "PingOperation", "(", "Codec", "codec", ",", "AtomicInteger", "topologyId", ",", "Configuration", "cfg", ",", "Transport", "transport", ",", "byte", "[", "]", "cacheName", ")", "{", "super", "(", "codec", ",", "0", ",", "cfg", ",", "cacheName", ",", "topologyId", ")", ";", "this", ".", "transport", "=", "transport", ";", "}", "@", "@", "-", "7", ",", "7", "+", "7", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "InvalidResponseException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "28", ",", "9", "+", "28", ",", "9", "@", "@", "public", "PutAllOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Map", "<", "byte", "[", "],", "byte", "[", "]>", "map", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "int", "flags", ",", "Configuration", "cfg", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "map", "=", "map", ";", "this", ".", "lifespan", "=", "lifespan", ";", "this", ".", "lifespanTimeUnit", "=", "lifespanTimeUnit", ";", "@", "@", "-", "9", ",", "7", "+", "9", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "java", ".", "util", ".", "stream", ".", "Collectors", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "TransportFactory", ";", "@", "@", "-", "25", ",", "10", "+", "25", ",", "10", "@", "@", "private", "final", "TimeUnit", "maxIdleTimeUnit", ";", "public", "PutAllParallelOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Map", "<", "byte", "[", "],", "byte", "[", "]>", "map", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "long", "lifespan", ",", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ",", "ExecutorService", "executorService", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ",", "executorService", ")", ";", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ",", "executorService", ")", ";", "this", ".", "map", "=", "map", ";", "this", ".", "lifespan", "=", "lifespan", ";", "this", ".", "lifespanTimeUnit", "=", "lifespanTimeUnit", ";", "@", "@", "-", "52", ",", "7", "+", "52", ",", "7", "@", "@", "public", "PutAllParallelOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "M", "return", "splittedMaps", ".", "values", "(", ").", "stream", "(", ").", "map", "(", "mapSubset", "-", ">", "new", "PutAllOperation", "(", "codec", ",", "transportFactory", ",", "mapSubset", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ").", "collect", "(", "Collectors", ".", "toList", "(", "))", ";", "cfg", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ").", "collect", "(", "Collectors", ".", "toList", "(", "))", ";", "}", "@", "Override", "@", "@", "-", "3", ",", "7", "+", "3", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "28", ",", "9", "+", "28", ",", "9", "@", "@", "public", "PutIfAbsentOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdleTime", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ",", "value", ",", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdleTime", ",", "maxIdleTimeUnit", ")", ";", "}", "@", "@", "-", "4", ",", "6", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "InvalidResponseException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "@", "@", "-", "23", ",", "10", "+", "24", ",", "10", "@", "@", "public", "PutOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "flags", ",", "cfg", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "}", "@", "Override", "@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "InvalidResponseException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "33", ",", "10", "+", "33", ",", "10", "@", "@", "public", "PutStreamOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "long", "version", ",", "int", "flags", ",", "Configuration", "cfg", ",", "long", "version", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "flags", ",", "cfg", ")", ";", "this", ".", "version", "=", "version", ";", "this", ".", "lifespan", "=", "lifespan", ";", "this", ".", "maxIdle", "=", "maxIdle", ";", "@", "@", "-", "10", ",", "7", "+", "10", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "HotRodClientException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "33", ",", "8", "+", "33", ",", "8", "@", "@", "private", "final", "RemoteQuery", "remoteQuery", ";", "public", "QueryOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "RemoteQuery", "remoteQuery", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "int", "flags", ",", "Configuration", "cfg", ",", "RemoteQuery", "remoteQuery", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "remoteQuery", "=", "remoteQuery", ";", "}", "@", "@", "-", "3", ",", "7", "+", "3", ",", "7", "@", "@", "import", "java", ".", "net", ".", "SocketAddress", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "event", ".", "ClientListenerNotifier", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "29", ",", "9", "+", "29", ",", "9", "@", "@", "protected", "RemoveClientListenerOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "Configuration", "cfg", ",", "ClientListenerNotifier", "listenerNotifier", ",", "Object", "listener", ")", "{", "super", "(", "codec", ",", "flags", ",", "clientIntelligence", ",", "cacheName", ",", "topologyId", ")", ";", "super", "(", "codec", ",", "flags", ",", "cfg", ",", "cacheName", ",", "topologyId", ")", ";", "this", ".", "transportFactory", "=", "transportFactory", ";", "this", ".", "listenerNotifier", "=", "listenerNotifier", ";", "this", ".", "listener", "=", "listener", ";", "@", "@", "-", "3", ",", "6", "+", "3", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "VersionedOperationResponse", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "25", ",", "9", "+", "26", ",", "9", "@", "@", "public", "RemoveIfUnmodifiedOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "int", "flags", ",", "Configuration", "cfg", ",", "long", "version", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "this", ".", "version", "=", "version", ";", "}", "@", "@", "-", "2", ",", "7", "+", "2", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "21", ",", "8", "+", "21", ",", "8", "@", "@", "public", "class", "RemoveOperation", "<", "V", ">", "extends", "AbstractKeyOperation", "<", "V", ">", "{", "public", "RemoveOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "4", ",", "6", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "VersionedOperationResponse", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "@", "@", "-", "21", ",", "9", "+", "22", ",", "9", "@", "@", "private", "final", "long", "version", ";", "public", "ReplaceIfUnmodifiedOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "value", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ",", "long", "version", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "this", ".", "version", "=", "version", ";", "}", "@", "@", "-", "3", ",", "7", "+", "3", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "TransportFactory", ";", "@", "@", "-", "22", ",", "9", "+", "22", ",", "9", "@", "@", "public", "ReplaceOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "Object", "key", ",", "byte", "[", "]", "keyBytes", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ",", "byte", "[", "]", "value", ",", "int", "flags", ",", "Configuration", "cfg", ",", "byte", "[", "]", "value", ",", "long", "lifespan", ",", "TimeUnit", "lifespanTimeUnit", ",", "long", "maxIdle", ",", "TimeUnit", "maxIdleTimeUnit", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ",", "value", ",", "super", "(", "codec", ",", "transportFactory", ",", "key", ",", "keyBytes", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ",", "value", ",", "lifespan", ",", "lifespanTimeUnit", ",", "maxIdle", ",", "maxIdleTimeUnit", ")", ";", "}", "@", "@", "-", "6", ",", "6", "+", "6", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "HotRodClientException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "RemoteIllegalLifecycleStateException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "RemoteNodeSuspectException", ";", "@", "@", "-", "38", ",", "8", "+", "39", ",", "8", "@", "@", "private", "boolean", "triedCompleteRestart", "=", "false", ";", "protected", "RetryOnFailureOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "flags", ",", "clientIntelligence", ",", "cacheName", ",", "topologyId", ")", ";", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "flags", ",", "cfg", ",", "cacheName", ",", "topologyId", ")", ";", "this", ".", "transportFactory", "=", "transportFactory", ";", "}", "@", "@", "-", "4", ",", "7", "+", "4", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "13", ",", "8", "+", "13", ",", "8", "@", "@", "public", "class", "SizeOperation", "extends", "RetryOnFailureOperation", "<", "Integer", ">", "{", "protected", "SizeOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "7", ",", "6", "+", "7", ",", "7", "@", "@", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "Codec", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HeaderParams", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "24", ",", "8", "+", "25", ",", "8", "@", "@", "public", "class", "StatsOperation", "extends", "RetryOnFailureOperation", "<", "Map", "<", "String", ",", "String", ">", ">", "{", "public", "StatsOperation", "(", "Codec", "codec", ",", "TransportFactory", "transportFactory", ",", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "ClientIntelligence", "clientIntelligence", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "clientIntelligence", ")", ";", "byte", "[", "]", "cacheName", ",", "AtomicInteger", "topologyId", ",", "int", "flags", ",", "Configuration", "cfg", ")", "{", "super", "(", "codec", ",", "transportFactory", ",", "cacheName", ",", "topologyId", ",", "flags", ",", "cfg", ")", ";", "}", "@", "Override", "@", "@", "-", "3", ",", "6", "+", "3", ",", "7", "@", "@", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "OutputStream", ";", "import", "java", ".", "lang", ".", "annotation", ".", "Annotation", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "@", "@", "-", "45", ",", "11", "+", "46", ",", "11", "@", "@", "void", "writeClientListenerParams", "(", "Transport", "transport", ",", "ClientListener", "clientListene", "*", "/", "short", "readHeader", "(", "Transport", "transport", ",", "HeaderParams", "params", ")", ";", "ClientEvent", "readEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ")", ";", "ClientEvent", "readEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "List", "<", "String", ">", "whitelist", ")", ";", "Either", "<", "Short", ",", "ClientEvent", ">", "readHeaderOrEvent", "(", "Transport", "transport", ",", "HeaderParams", "params", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ")", ";", "Either", "<", "Short", ",", "ClientEvent", ">", "readHeaderOrEvent", "(", "Transport", "transport", ",", "HeaderParams", "params", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "List", "<", "String", ">", "whitelist", ")", ";", "Object", "returnPossiblePrevValue", "(", "Transport", "transport", ",", "short", "status", ",", "int", "flags", ")", ";", "Object", "returnPossiblePrevValue", "(", "Transport", "transport", ",", "short", "status", ",", "int", "flags", ",", "List", "<", "String", ">", "whitelist", ")", ";", "/", "**", "*", "Logger", "for", "Hot", "Rod", "client", "codec", "@", "@", "-", "59", ",", "7", "+", "60", ",", "7", "@", "@", "void", "writeClientListenerParams", "(", "Transport", "transport", ",", "ClientListener", "clientListene", "/", "**", "*", "Read", "and", "unmarshall", "byte", "array", ".", "*", "/", "<", "T", ">", "T", "readUnmarshallByteArray", "(", "Transport", "transport", ",", "short", "status", ")", ";", "<", "T", ">", "T", "readUnmarshallByteArray", "(", "Transport", "transport", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", ";", "/", "**", "*", "Reads", "a", "stream", "of", "data", "@", "@", "-", "9", ",", "6", "+", "9", ",", "7", "@", "@", "import", "java", ".", "net", ".", "SocketAddress", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "@", "@", "-", "134", ",", "23", "+", "135", ",", "23", "@", "@", "public", "short", "readHeader", "(", "Transport", "transport", ",", "HeaderParams", "params", ")", "{", "}", "@", "Override", "public", "ClientEvent", "readEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ")", "{", "public", "ClientEvent", "readEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "List", "<", "String", ">", "whitelist", ")", "{", "return", "null", ";", "/", "/", "No", "events", "sent", "in", "Hot", "Rod", "1", ".", "x", "protocol", "}", "@", "Override", "public", "Either", "<", "Short", ",", "ClientEvent", ">", "readHeaderOrEvent", "(", "Transport", "transport", ",", "HeaderParams", "params", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ")", "{", "public", "Either", "<", "Short", ",", "ClientEvent", ">", "readHeaderOrEvent", "(", "Transport", "transport", ",", "HeaderParams", "params", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "List", "<", "String", ">", "whitelist", ")", "{", "return", "null", ";", "/", "/", "No", "events", "sent", "in", "Hot", "Rod", "1", ".", "x", "protocol", "}", "@", "Override", "public", "Object", "returnPossiblePrevValue", "(", "Transport", "transport", ",", "short", "status", ",", "int", "flags", ")", "{", "public", "Object", "returnPossiblePrevValue", "(", "Transport", "transport", ",", "short", "status", ",", "int", "flags", ",", "List", "<", "String", ">", "whitelist", ")", "{", "Marshaller", "marshaller", "=", "transport", ".", "getTransportFactory", "(", ").", "getMarshaller", "(", ");", "if", "(", "hasForceReturn", "(", "flags", ")", ")", "{", "byte", "[", "]", "bytes", "=", "transport", ".", "readArray", "(", ");", "if", "(", "trace", ")", "getLog", "(", ").", "tracef", "(", "\"", "Previous", "value", "bytes", "is", ":", "%", "s", "\"", ",", "Util", ".", "printArray", "(", "bytes", ",", "false", ")", ");", "/", "/", "0", "-", "length", "response", "means", "null", "return", "bytes", ".", "length", "=", "=", "0", "?", "null", ":", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "bytes", ",", "status", ")", ";", "return", "bytes", ".", "length", "=", "=", "0", "?", "null", ":", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "bytes", ",", "status", ",", "whitelist", ")", ";", "}", "else", "{", "return", "null", ";", "}", "@", "@", "-", "166", ",", "8", "+", "167", ",", "8", "@", "@", "public", "Log", "getLog", "(", ")", "{", "}", "@", "Override", "public", "<", "T", ">", "T", "readUnmarshallByteArray", "(", "Transport", "transport", ",", "short", "status", ")", "{", "return", "CodecUtils", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "public", "<", "T", ">", "T", "readUnmarshallByteArray", "(", "Transport", "transport", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", "{", "return", "CodecUtils", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "whitelist", ")", ";", "}", "@", "Override", "@", "@", "-", "50", ",", "8", "+", "50", ",", "8", "@", "@", "final", "boolean", "trace", "=", "getLog", "(", ").", "isTraceEnabled", "(", ");", "@", "Override", "public", "<", "T", ">", "T", "readUnmarshallByteArray", "(", "Transport", "transport", ",", "short", "status", ")", "{", "return", "CodecUtils", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ")", ";", "public", "<", "T", ">", "T", "readUnmarshallByteArray", "(", "Transport", "transport", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", "{", "return", "CodecUtils", ".", "readUnmarshallByteArray", "(", "transport", ",", "status", ",", "whitelist", ")", ";", "}", "@", "Override", "@", "@", "-", "163", ",", "14", "+", "163", ",", "14", "@", "@", "private", "short", "readPartialHeader", "(", "Transport", "transport", ",", "HeaderParams", "params", ",", "short", "}", "@", "Override", "public", "ClientEvent", "readEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ")", "{", "public", "ClientEvent", "readEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "List", "<", "String", ">", "whitelist", ")", "{", "readMagic", "(", "transport", ")", ";", "readMessageId", "(", "transport", ",", "null", ")", ";", "short", "eventTypeId", "=", "transport", ".", "readByte", "(", ");", "return", "readPartialEvent", "(", "transport", ",", "expectedListenerId", ",", "marshaller", ",", "eventTypeId", ")", ";", "return", "readPartialEvent", "(", "transport", ",", "expectedListenerId", ",", "marshaller", ",", "eventTypeId", ",", "whitelist", ")", ";", "}", "protected", "ClientEvent", "readPartialEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "short", "eventTypeId", ")", "{", "protected", "ClientEvent", "readPartialEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "short", "eventTypeId", ",", "List", "<", "String", ">", "whitelist", ")", "{", "short", "status", "=", "transport", ".", "readByte", "(", ");", "transport", ".", "readByte", "(", ");", "/", "/", "ignore", ",", "no", "topology", "expected", "ClientEvent", ".", "Type", "eventType", ";", "@", "@", "-", "199", ",", "20", "+", "199", ",", "20", "@", "@", "protected", "ClientEvent", "readPartialEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListe", "boolean", "isRetried", "=", "transport", ".", "readByte", "(", ")", "=", "=", "1", "?", "true", ":", "false", ";", "if", "(", "isCustom", "=", "=", "1", ")", "{", "final", "Object", "eventData", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "final", "Object", "eventData", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "return", "createCustomEvent", "(", "eventData", ",", "eventType", ",", "isRetried", ")", ";", "}", "else", "{", "switch", "(", "eventType", ")", "{", "case", "CLIENT_CACHE_ENTRY_CREATED", ":", "Object", "createdKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "Object", "createdKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "long", "createdDataVersion", "=", "transport", ".", "readLong", "(", ");", "return", "createCreatedEvent", "(", "createdKey", ",", "createdDataVersion", ",", "isRetried", ")", ";", "case", "CLIENT_CACHE_ENTRY_MODIFIED", ":", "Object", "modifiedKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "Object", "modifiedKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "long", "modifiedDataVersion", "=", "transport", ".", "readLong", "(", ");", "return", "createModifiedEvent", "(", "modifiedKey", ",", "modifiedDataVersion", ",", "isRetried", ")", ";", "case", "CLIENT_CACHE_ENTRY_REMOVED", ":", "Object", "removedKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "Object", "removedKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "return", "createRemovedEvent", "(", "removedKey", ",", "isRetried", ")", ";", "default", ":", "throw", "log", ".", "unknownEvent", "(", "eventTypeId", ")", ";", "@", "@", "-", "221", ",", "29", "+", "221", ",", "29", "@", "@", "protected", "ClientEvent", "readPartialEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListe", "}", "@", "Override", "public", "Either", "<", "Short", ",", "ClientEvent", ">", "readHeaderOrEvent", "(", "Transport", "transport", ",", "HeaderParams", "params", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ")", "{", "public", "Either", "<", "Short", ",", "ClientEvent", ">", "readHeaderOrEvent", "(", "Transport", "transport", ",", "HeaderParams", "params", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "List", "<", "String", ">", "whitelist", ")", "{", "readMagic", "(", "transport", ")", ";", "readMessageId", "(", "transport", ",", "null", ")", ";", "short", "opCode", "=", "transport", ".", "readByte", "(", ");", "switch", "(", "opCode", ")", "{", "case", "CACHE_ENTRY_CREATED_EVENT_RESPONSE", ":", "case", "CACHE_ENTRY_MODIFIED_EVENT_RESPONSE", ":", "case", "CACHE_ENTRY_REMOVED_EVENT_RESPONSE", ":", "ClientEvent", "clientEvent", "=", "readPartialEvent", "(", "transport", ",", "expectedListenerId", ",", "marshaller", ",", "opCode", ")", ";", "ClientEvent", "clientEvent", "=", "readPartialEvent", "(", "transport", ",", "expectedListenerId", ",", "marshaller", ",", "opCode", ",", "whitelist", ")", ";", "return", "Either", ".", "newRight", "(", "clientEvent", ")", ";", "default", ":", "return", "Either", ".", "newLeft", "(", "readPartialHeader", "(", "transport", ",", "params", ",", "opCode", ")", ");", "}", "}", "@", "Override", "public", "Object", "returnPossiblePrevValue", "(", "Transport", "transport", ",", "short", "status", ",", "int", "flags", ")", "{", "public", "Object", "returnPossiblePrevValue", "(", "Transport", "transport", ",", "short", "status", ",", "int", "flags", ",", "List", "<", "String", ">", "whitelist", ")", "{", "Marshaller", "marshaller", "=", "transport", ".", "getTransportFactory", "(", ").", "getMarshaller", "(", ");", "if", "(", "HotRodConstants", ".", "hasPrevious", "(", "status", ")", ")", "{", "byte", "[", "]", "bytes", "=", "transport", ".", "readArray", "(", ");", "if", "(", "trace", ")", "getLog", "(", ").", "tracef", "(", "\"", "Previous", "value", "bytes", "is", ":", "%", "s", "\"", ",", "printArray", "(", "bytes", ",", "false", ")", ");", "/", "/", "0", "-", "length", "response", "means", "null", "return", "bytes", ".", "length", "=", "=", "0", "?", "null", ":", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "bytes", ",", "status", ")", ";", "return", "bytes", ".", "length", "=", "=", "0", "?", "null", ":", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "bytes", ",", "status", ",", "whitelist", ")", ";", "}", "else", "{", "return", "null", ";", "}", "@", "@", "-", "3", ",", "6", "+", "3", ",", "7", "@", "@", "import", "static", "org", ".", "infinispan", ".", "commons", ".", "util", ".", "Util", ".", "printArray", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "annotation", ".", "ClientListener", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "event", ".", "ClientCacheEntryExpiredEvent", ";", "@", "@", "-", "34", ",", "7", "+", "35", ",", "7", "@", "@", "public", "void", "writeClientListenerParams", "(", "Transport", "transport", ",", "ClientListener", "client", "}", "@", "Override", "protected", "ClientEvent", "readPartialEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "short", "eventTypeId", ")", "{", "protected", "ClientEvent", "readPartialEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "short", "eventTypeId", ",", "List", "<", "String", ">", "whitelist", ")", "{", "short", "status", "=", "transport", ".", "readByte", "(", ");", "transport", ".", "readByte", "(", ");", "/", "/", "ignore", ",", "no", "topology", "expected", "ClientEvent", ".", "Type", "eventType", ";", "@", "@", "-", "65", ",", "25", "+", "66", ",", "25", "@", "@", "protected", "ClientEvent", "readPartialEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListe", "boolean", "isRetried", "=", "transport", ".", "readByte", "(", ")", "=", "=", "1", "?", "true", ":", "false", ";", "if", "(", "isCustom", "=", "=", "1", ")", "{", "final", "Object", "eventData", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "final", "Object", "eventData", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "return", "createCustomEvent", "(", "eventData", ",", "eventType", ",", "isRetried", ")", ";", "}", "else", "if", "(", "isCustom", "=", "=", "2", ")", "{", "/", "/", "New", "in", "2", ".", "1", ",", "dealing", "with", "raw", "custom", "events", "return", "createCustomEvent", "(", "transport", ".", "readArray", "(", "),", "eventType", ",", "isRetried", ")", ";", "/", "/", "Raw", "data", "}", "else", "{", "switch", "(", "eventType", ")", "{", "case", "CLIENT_CACHE_ENTRY_CREATED", ":", "Object", "createdKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "Object", "createdKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "long", "createdDataVersion", "=", "transport", ".", "readLong", "(", ");", "return", "createCreatedEvent", "(", "createdKey", ",", "createdDataVersion", ",", "isRetried", ")", ";", "case", "CLIENT_CACHE_ENTRY_MODIFIED", ":", "Object", "modifiedKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "Object", "modifiedKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "long", "modifiedDataVersion", "=", "transport", ".", "readLong", "(", ");", "return", "createModifiedEvent", "(", "modifiedKey", ",", "modifiedDataVersion", ",", "isRetried", ")", ";", "case", "CLIENT_CACHE_ENTRY_REMOVED", ":", "Object", "removedKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "Object", "removedKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "return", "createRemovedEvent", "(", "removedKey", ",", "isRetried", ")", ";", "case", "CLIENT_CACHE_ENTRY_EXPIRED", ":", "Object", "expiredKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ")", ";", "Object", "expiredKey", "=", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "transport", ".", "readArray", "(", "),", "status", ",", "whitelist", ")", ";", "return", "createExpiredEvent", "(", "expiredKey", ")", ";", "default", ":", "throw", "getLog", "(", ").", "unknownEvent", "(", "eventTypeId", ")", ";", "@", "@", "-", "1", ",", "5", "+", "1", ",", "6", "@", "@", "package", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "TimeUnit", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "@", "@", "-", "31", ",", "10", "+", "32", ",", "10", "@", "@", "public", "static", "int", "toSeconds", "(", "long", "duration", ",", "TimeUnit", "timeUnit", ")", "{", "return", "seconds", ";", "}", "static", "<", "T", ">", "T", "readUnmarshallByteArray", "(", "Transport", "transport", ",", "short", "status", ")", "{", "static", "<", "T", ">", "T", "readUnmarshallByteArray", "(", "Transport", "transport", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", "{", "byte", "[", "]", "bytes", "=", "transport", ".", "readArray", "(", ");", "Marshaller", "marshaller", "=", "transport", ".", "getTransportFactory", "(", ").", "getMarshaller", "(", ");", "return", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "bytes", ",", "status", ")", ";", "return", "MarshallerUtil", ".", "bytes2obj", "(", "marshaller", ",", "bytes", ",", "status", ",", "whitelist", ")", ";", "}", "}", "@", "@", "-", "127", ",", "12", "+", "127", ",", "12", "@", "@", "public", "SaslClient", "run", "(", ")", "throws", "Exception", "{", "}", "private", "List", "<", "String", ">", "mechList", "(", "TcpTransport", "tcpTransport", ",", "AtomicInteger", "topologyId", ")", "{", "AuthMechListOperation", "op", "=", "new", "AuthMechListOperation", "(", "codec", ",", "topologyId", ",", "configuration", ".", "clientIntelligence", "(", "),", "tcpTransport", ")", ";", "AuthMechListOperation", "op", "=", "new", "AuthMechListOperation", "(", "codec", ",", "topologyId", ",", "configuration", ",", "tcpTransport", ")", ";", "return", "op", ".", "execute", "(", ");", "}", "private", "byte", "[", "]", "auth", "(", "TcpTransport", "tcpTransport", ",", "AtomicInteger", "topologyId", ",", "String", "mech", ",", "byte", "[", "]", "response", ")", "{", "AuthOperation", "op", "=", "new", "AuthOperation", "(", "codec", ",", "topologyId", ",", "configuration", ".", "clientIntelligence", "(", "),", "tcpTransport", ",", "mech", ",", "response", ")", ";", "AuthOperation", "op", "=", "new", "AuthOperation", "(", "codec", ",", "topologyId", ",", "configuration", ",", "tcpTransport", ",", "mech", ",", "response", ")", ";", "return", "op", ".", "execute", "(", ");", "}", "@", "@", "-", "49", ",", "7", "+", "49", ",", "7", "@", "@", "public", "TcpTransport", "makeObject", "(", "SocketAddress", "address", ")", "throws", "Exception", "{", "}", "protected", "PingOperation", ".", "PingResult", "ping", "(", "TcpTransport", "tcpTransport", ",", "AtomicInteger", "topologyId", ")", "{", "PingOperation", "po", "=", "new", "PingOperation", "(", "codec", ",", "topologyId", ",", "configuration", ".", "clientIntelligence", "(", "),", "tcpTransport", ")", ";", "PingOperation", "po", "=", "new", "PingOperation", "(", "codec", ",", "topologyId", ",", "configuration", ",", "tcpTransport", ")", ";", "return", "po", ".", "execute", "(", ");", "}", "@", "@", "-", "7", ",", "6", "+", "7", ",", "7", "@", "@", "import", "static", "org", ".", "jboss", ".", "logging", ".", "Logger", ".", "Level", ".", "WARN", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InvalidClassException", ";", "import", "java", ".", "lang", ".", "reflect", ".", "Method", ";", "import", "java", ".", "net", ".", "SocketAddress", ";", "import", "java", ".", "util", ".", "Collection", ";", "@", "@", "-", "20", ",", "6", "+", "21", ",", "7", "@", "@", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "Transport", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "transport", ".", "tcp", ".", "TcpTransport", ";", "import", "org", ".", "infinispan", ".", "commons", ".", "CacheConfigurationException", ";", "import", "org", ".", "infinispan", ".", "commons", ".", "CacheException", ";", "import", "org", ".", "infinispan", ".", "commons", ".", "CacheListenerException", ";", "import", "org", ".", "jboss", ".", "logging", ".", "BasicLogger", ";", "import", "org", ".", "jboss", ".", "logging", ".", "annotations", ".", "Cause", ";", "@", "@", "-", "252", ",", "4", "+", "254", ",", "8", "@", "@", "@", "Message", "(", "value", "=", "\"", "Cannot", "specify", "both", "a", "callback", "handler", "and", "a", "username", "for", "authentication", "\"", ",", "id", "=", "4067", ")", "CacheConfigurationException", "callbackHandlerAndUsernameMutuallyExclusive", "(", ");", "@", "Message", "(", "value", "=", "\"", "Class", "'", "%", "s", "'", "blocked", "by", "Java", "standard", "deserialization", "white", "list", ".", "Adjust", "the", "client", "configuration", "java", "serialization", "white", "list", "regular", "expression", "to", "include", "this", "class", ".", "\",", "id", "=", "4068", ")", "CacheException", "classNotInWhitelist", "(", "String", "className", ")", ";", "}", "@", "@", "-", "2", ",", "13", "+", "2", ",", "21", "@", "@", "import", "java", ".", "io", ".", "ByteArrayInputStream", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "io", ".", "InvalidClassException", ";", "import", "java", ".", "io", ".", "ObjectInputStream", ";", "import", "java", ".", "io", ".", "ObjectStreamClass", ";", "import", "java", ".", "io", ".", "ObjectStreamConstants", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "regex", ".", "Matcher", ";", "import", "java", ".", "util", ".", "regex", ".", "Pattern", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "HotRodClientException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "protocol", ".", "HotRodConstants", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "logging", ".", "Log", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "logging", ".", "LogFactory", ";", "import", "org", ".", "infinispan", ".", "commons", ".", "CacheException", ";", "import", "org", ".", "infinispan", ".", "commons", ".", "marshall", ".", "Marshaller", ";", "import", "org", ".", "infinispan", ".", "commons", ".", "util", ".", "Util", ";", "@", "@", "-", "22", ",", "7", "+", "30", ",", "7", "@", "@", "private", "MarshallerUtil", "(", ")", "{", "}", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "public", "static", "<", "T", ">", "T", "bytes2obj", "(", "Marshaller", "marshaller", ",", "byte", "[", "]", "bytes", ",", "short", "status", ")", "{", "public", "static", "<", "T", ">", "T", "bytes2obj", "(", "Marshaller", "marshaller", ",", "byte", "[", "]", "bytes", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", "{", "if", "(", "bytes", "=", "=", "null", "|", "|", "bytes", ".", "length", "=", "=", "0", ")", "return", "null", ";", "try", "{", "Object", "ret", "=", "marshaller", ".", "objectFromByteBuffer", "(", "bytes", ")", ";", "@", "@", "-", "33", ",", "12", "+", "41", ",", "9", "@", "@", "private", "MarshallerUtil", "(", ")", "{", "}", "/", "/", "So", ",", "if", "the", "unmarshalled", "object", "is", "still", "a", "byte", "[", "],", "it", "could", "be", "a", "standard", "/", "/", "serialized", "object", ",", "so", "check", "for", "stream", "magic", "if", "(", "ret", "instanceof", "byte", "[", "]", "&", "&", "isJavaSerialized", "(", "(", "byte", "[", "])", "ret", ")", ")", "{", "try", "(", "ObjectInputStream", "ois", "=", "new", "ObjectInputStream", "(", "new", "ByteArrayInputStream", "(", "(", "byte", "[", "])", "ret", ")", "))", "{", "return", "(", "T", ")", "ois", ".", "readObject", "(", ");", "}", "catch", "(", "Exception", "ee", ")", "{", "if", "(", "log", ".", "isDebugEnabled", "(", "))", "log", ".", "debugf", "(", "\"", "Standard", "deserialization", "not", "in", "use", "for", "%", "s", "\"", ",", "Util", ".", "printArray", "(", "bytes", ")", ");", "}", "T", "ois", "=", "tryJavaDeserialize", "(", "bytes", ",", "(", "byte", "[", "])", "ret", ",", "whitelist", ")", ";", "if", "(", "ois", "!", "=", "null", ")", "return", "ois", ";", "}", "}", "@", "@", "-", "48", ",", "6", "+", "53", ",", "18", "@", "@", "private", "MarshallerUtil", "(", ")", "{", "}", "}", "}", "public", "static", "<", "T", ">", "T", "tryJavaDeserialize", "(", "byte", "[", "]", "bytes", ",", "byte", "[", "]", "ret", ",", "List", "<", "String", ">", "whitelist", ")", "{", "try", "(", "ObjectInputStream", "ois", "=", "new", "CheckedInputStream", "(", "new", "ByteArrayInputStream", "(", "ret", ")", ",", "whitelist", ")", ")", "{", "return", "(", "T", ")", "ois", ".", "readObject", "(", ");", "}", "catch", "(", "CacheException", "ce", ")", "{", "throw", "ce", ";", "}", "catch", "(", "Exception", "ee", ")", "{", "if", "(", "log", ".", "isDebugEnabled", "(", "))", "log", ".", "debugf", "(", "\"", "Standard", "deserialization", "not", "in", "use", "for", "%", "s", "\"", ",", "Util", ".", "printArray", "(", "bytes", ")", ");", "}", "return", "null", ";", "}", "private", "static", "boolean", "isJavaSerialized", "(", "byte", "[", "]", "bytes", ")", "{", "if", "(", "bytes", ".", "length", ">", "2", ")", "{", "short", "magic", "=", "(", "short", ")", "(", "(", "bytes", "[", "1", "]", "&", "0xFF", ")", "+", "(", "bytes", "[", "0", "]", "<", "<", "8", ")", ");", "@", "@", "-", "73", ",", "4", "+", "90", ",", "35", "@", "@", "static", "short", "getShort", "(", "byte", "[", "]", "b", ",", "int", "off", ")", "{", "}", "}", "private", "final", "static", "class", "CheckedInputStream", "extends", "ObjectInputStream", "{", "private", "final", "List", "<", "String", ">", "whitelist", ";", "public", "CheckedInputStream", "(", "InputStream", "in", ",", "List", "<", "String", ">", "whitelist", ")", "throws", "IOException", "{", "super", "(", "in", ")", ";", "this", ".", "whitelist", "=", "whitelist", ";", "}", "@", "Override", "protected", "Class", "<", "?>", "resolveClass", "(", "ObjectStreamClass", "desc", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "/", "/", "Enforce", "SerialKiller", "'", "s", "whitelist", "boolean", "safeClass", "=", "false", ";", "for", "(", "String", "whiteRegExp", ":", "whitelist", ")", "{", "Pattern", "whitePattern", "=", "Pattern", ".", "compile", "(", "whiteRegExp", ")", ";", "Matcher", "whiteMatcher", "=", "whitePattern", ".", "matcher", "(", "desc", ".", "getName", "(", "))", ";", "if", "(", "whiteMatcher", ".", "find", "(", "))", "{", "safeClass", "=", "true", ";", "if", "(", "log", ".", "isTraceEnabled", "(", "))", "log", ".", "tracef", "(", "\"", "Whitelist", "match", ":", "'", "%", "s", "'", "\",", "desc", ".", "getName", "(", "))", ";", "}", "}", "if", "(", "!", "safeClass", ")", "throw", "log", ".", "classNotInWhitelist", "(", "desc", ".", "getName", "(", "))", ";", "return", "super", ".", "resolveClass", "(", "desc", ")", ";", "}", "}", "}", "@", "@", "-", "15", ",", "6", "+", "15", ",", "7", "@", "@", "import", "static", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "ConfigurationProperties", ".", "REQUEST_BALANCING_STRATEGY", ";", "import", "static", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "ConfigurationProperties", ".", "SASL_MECHANISM", ";", "import", "static", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "ConfigurationProperties", ".", "SASL_PROPERTIES_PREFIX", ";", "import", "static", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "ConfigurationProperties", ".", "JAVA_SERIAL_WHITELIST", ";", "import", "static", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "ConfigurationProperties", ".", "SERVER_LIST", ";", "import", "static", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "ConfigurationProperties", ".", "SNI_HOST_NAME", ";", "import", "static", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "impl", ".", "ConfigurationProperties", ".", "SO_TIMEOUT", ";", "@", "@", "-", "35", ",", "7", "+", "36", ",", "10", "@", "@", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "io", ".", "InputStream", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Properties", ";", "import", "java", ".", "util", ".", "function", ".", "Function", ";", "@", "@", "-", "107", ",", "6", "+", "111", ",", "7", "@", "@", "OPTIONS", ".", "put", "(", "SASL_PROPERTIES_PREFIX", "+", "\"", ".", "A", "\"", ",", "c", "-", ">", "c", ".", "security", "(", ").", "authentication", "(", ").", "saslProperties", "(", ").", "get", "(", "\"", "A", "\"", "))", ";", "OPTIONS", ".", "put", "(", "SASL_PROPERTIES_PREFIX", "+", "\"", ".", "B", "\"", ",", "c", "-", ">", "c", ".", "security", "(", ").", "authentication", "(", ").", "saslProperties", "(", ").", "get", "(", "\"", "B", "\"", "))", ";", "OPTIONS", ".", "put", "(", "SASL_PROPERTIES_PREFIX", "+", "\"", ".", "C", "\"", ",", "c", "-", ">", "c", ".", "security", "(", ").", "authentication", "(", ").", "saslProperties", "(", ").", "get", "(", "\"", "C", "\"", "))", ";", "OPTIONS", ".", "put", "(", "JAVA_SERIAL_WHITELIST", ",", "Configuration", ":", ":", "serialWhitelist", ")", ";", "TYPES", ".", "put", "(", "Boolean", ".", "class", ",", "b", "-", ">", "Boolean", ".", "toString", "(", "(", "Boolean", ")", "b", ")", ");", "TYPES", ".", "put", "(", "ExhaustedAction", ".", "class", ",", "e", "-", ">", "Integer", ".", "toString", "(", "((", "ExhaustedAction", ")", "e", ")", ".", "ordinal", "(", "))", ");", "@", "@", "-", "118", ",", "6", "+", "123", ",", "15", "@", "@", "TYPES", ".", "put", "(", "MyCallbackHandler", ".", "class", ",", "c", "-", ">", "c", ")", ";", "TYPES", ".", "put", "(", "Subject", ".", "class", ",", "s", "-", ">", "s", ")", ";", "TYPES", ".", "put", "(", "ProtocolVersion", ".", "class", ",", "p", "-", ">", "p", ".", "toString", "(", "))", ";", "TYPES", ".", "put", "(", "mkClass", "(", "),", "l", "-", ">", "String", ".", "join", "(", "\",", "\",", "(", "List", "<", "String", ">", ")", "l", ")", ");", "}", "private", "static", "Class", "<", "?>", "mkClass", "(", ")", "{", "try", "{", "return", "Class", ".", "forName", "(", "\"", "java", ".", "util", ".", "Arrays", "$", "ArrayList", "\"", ");", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "CallbackHandler", "callbackHandler", "=", "new", "MyCallbackHandler", "(", ");", "@", "@", "-", "184", ",", "7", "+", "198", ",", "8", "@", "@", "public", "void", "testConfiguration", "(", ")", "{", ".", "callbackHandler", "(", "callbackHandler", ")", ".", "serverName", "(", "\"", "my", "-", "server", "-", "name", "\"", ")", ".", "clientSubject", "(", "clientSubject", ")", ".", "saslProperties", "(", "saslProperties", ")", ";", ".", "saslProperties", "(", "saslProperties", ")", ".", "addJavaSerialWhiteList", "(", "\".", "*", "Person", ".", "*\"", ",", "\"", ".*", "Employee", ".", "*\"", ");", "Configuration", "configuration", "=", "builder", ".", "build", "(", ");", "validateConfiguration", "(", "configuration", ")", ";", "@", "@", "-", "238", ",", "6", "+", "253", ",", "7", "@", "@", "public", "void", "testWithProperties", "(", ")", "{", "p", ".", "setProperty", "(", "SASL_PROPERTIES_PREFIX", "+", "\"", ".", "A", "\"", ",", "\"", "1", "\"", ");", "p", ".", "setProperty", "(", "SASL_PROPERTIES_PREFIX", "+", "\"", ".", "B", "\"", ",", "\"", "2", "\"", ");", "p", ".", "setProperty", "(", "SASL_PROPERTIES_PREFIX", "+", "\"", ".", "C", "\"", ",", "\"", "3", "\"", ");", "p", ".", "setProperty", "(", "JAVA_SERIAL_WHITELIST", ",", "\"", ".*", "Person", ".", "*,", ".*", "Employee", ".", "*\"", ");", "Configuration", "configuration", "=", "builder", ".", "withProperties", "(", "p", ")", ".", "build", "(", ");", "validateConfiguration", "(", "configuration", ")", ";", "@", "@", "-", "501", ",", "6", "+", "517", ",", "7", "@", "@", "private", "void", "validateConfiguration", "(", "Configuration", "configuration", ")", "{", "assertEqualsConfig", "(", "\"", "2", "\"", ",", "SASL_PROPERTIES_PREFIX", "+", "\"", ".", "B", "\"", ",", "configuration", ")", ";", "assertEqualsConfig", "(", "\"", "3", "\"", ",", "SASL_PROPERTIES_PREFIX", "+", "\"", ".", "C", "\"", ",", "configuration", ")", ";", "assertEqualsConfig", "(", "ProtocolVersion", ".", "PROTOCOL_VERSION_13", ",", "PROTOCOL_VERSION", ",", "configuration", ")", ";", "assertEqualsConfig", "(", "Arrays", ".", "asList", "(", "\".", "*", "Person", ".", "*\"", ",", "\"", ".*", "Employee", ".", "*\"", "),", "JAVA_SERIAL_WHITELIST", ",", "configuration", ")", ";", "}", "private", "void", "validateSSLContextConfiguration", "(", "Configuration", "configuration", ")", "{", "@", "@", "-", "45", ",", "7", "+", "45", ",", "7", "@", "@", "private", "ConfigurationBuilder", "getCacheConfiguration", "(", ")", "{", "List", "<", "Integer", ">", "finished", "=", "new", "ArrayList", "<", ">(", ");", "@", "Override", "public", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ")", "{", "public", "boolean", "track", "(", "byte", "[", "]", "key", ",", "short", "status", ",", "List", "<", "String", ">", "whitelist", ")", "{", "return", "true", ";", "}", "@", "@", "-", "5", ",", "6", "+", "5", ",", "7", "@", "@", "import", "static", "org", ".", "infinispan", ".", "test", ".", "TestingUtil", ".", "replaceField", ";", "import", "java", ".", "io", ".", "IOException", ";", "import", "java", ".", "util", ".", "List", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "java", ".", "util", ".", "stream", ".", "IntStream", ";", "@", "@", "-", "102", ",", "11", "+", "103", ",", "11", "@", "@", "protected", "int", "maxRetries", "(", ")", "{", "private", "final", "IOException", "failWith", "=", "new", "IOException", "(", "\"", "Connection", "reset", "by", "peer", "\"", ");", "@", "Override", "public", "ClientEvent", "readEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ")", "{", "public", "ClientEvent", "readEvent", "(", "Transport", "transport", ",", "byte", "[", "]", "expectedListenerId", ",", "Marshaller", "marshaller", ",", "List", "<", "String", ">", "whitelist", ")", "{", "if", "(", "failure", ")", "{", "throw", "new", "TransportException", "(", "failWith", ",", "transport", ".", "getRemoteSocketAddress", "(", "))", ";", "}", "return", "super", ".", "readEvent", "(", "transport", ",", "expectedListenerId", ",", "marshaller", ")", ";", "return", "super", ".", "readEvent", "(", "transport", ",", "expectedListenerId", ",", "marshaller", ",", "whitelist", ")", ";", "}", "private", "void", "induceFailure", "(", ")", "{", "@", "@", "-", "6", ",", "7", "+", "6", ",", "7", "@", "@", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ClientIntelligence", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "configuration", ".", "ConfigurationBuilder", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "HotRodClientException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "RemoteNodeSuspectException", ";", "import", "org", ".", "infinispan", ".", "client", ".", "hotrod", ".", "exceptions", ".", "TransportException", ";", "@", "@", "-", "80", ",", "7", "+", "80", ",", "7", "@", "@", "private", "void", "doRetryTest", "(", "int", "maxRetry", ",", "boolean", "failOnTransport", ")", "{", "private", "final", "boolean", "failOnTransport", ";", "public", "MockOperation", "(", "TransportFactory", "transportFactory", ",", "boolean", "failOnTransport", ")", "{", "super", "(", "null", ",", "transportFactory", ",", "null", ",", "null", ",", "0", ",", "ClientIntelligence", ".", "getDefault", "(", "))", ";", "super", "(", "null", ",", "transportFactory", ",", "null", ",", "null", ",", "0", ",", "new", "ConfigurationBuilder", "(", ").", "build", "(", "))", ";", "this", ".", "failOnTransport", "=", "failOnTransport", ";", "transportInvocationCount", "=", "new", "AtomicInteger", "(", "0", ")", ";", "executeInvocationCount", "=", "new", "AtomicInteger", "(", "0", ")", ";", "@", "@", "-", "184", ",", "6", "+", "184", ",", "7", "@", "@", "private", "void", "createHotRodCache", "(", "HotRodServer", "server", ")", "{", "hotrod", "=", "server", ";", "hotrodClient", "=", "new", "RemoteCacheManager", "(", "new", "ConfigurationBuilder", "(", ")", ".", "addServers", "(", "\"", "localhost", ":", "\"", "+", "hotrod", ".", "getPort", "(", "))", ".", "addJavaSerialWhiteList", "(", "\".", "*", "Person", ".", "*\"", ")", ".", "marshaller", "(", "marshaller", ")", ".", "build", "(", "))", ";", "hotrodCache", "=", "cacheName", ".", "isEmpty", "(", ")"], "docstring_tokens": ["attain", "remote", "code", "execution", "or", "conduct", "other", "attacks", "."]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "21", ",", "31", "+", "21", ",", "23", "@", "@", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "AuditInformation", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "RepositoryAdminException", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "admin", ".", "ArchivaAdministration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "FileType", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "LegacyArtifactPath", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "NetworkConfiguration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "OrganisationInformation", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "UiConfiguration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "*;", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "repository", ".", "AbstractRepositoryAdmin", ";", "import", "org", ".", "apache", ".", "archiva", ".", "configuration", ".", "Configuration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "configuration", ".", "UserInterfaceOptions", ";", "import", "org", ".", "apache", ".", "archiva", ".", "configuration", ".", "WebappConfiguration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "metadata", ".", "model", ".", "facets", ".", "AuditEvent", ";", "import", "org", ".", "apache", ".", "commons", ".", "codec", ".", "net", ".", "URLCodec", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringEscapeUtils", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "apache", ".", "http", ".", "impl", ".", "conn", ".", "PoolingClientConnectionManager", ";", "import", "org", ".", "apache", ".", "http", ".", "impl", ".", "conn", ".", "PoolingHttpClientConnectionManager", ";", "import", "org", ".", "apache", ".", "maven", ".", "wagon", ".", "providers", ".", "http", ".", "HttpWagon", ";", "import", "org", ".", "springframework", ".", "stereotype", ".", "Service", ";", "import", "org", ".", "springframework", ".", "util", ".", "ResourceUtils", ";", "import", "javax", ".", "annotation", ".", "PostConstruct", ";", "import", "javax", ".", "annotation", ".", "PreDestroy", ";", "import", "java", ".", "io", ".", "UnsupportedEncodingException", ";", "import", "java", ".", "net", ".", "MalformedURLException", ";", "import", "java", ".", "net", ".", "URL", ";", "import", "java", ".", "net", ".", "URLEncoder", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "net", ".", "URISyntaxException", ";", "import", "java", ".", "util", ".", "ArrayList", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "328", ",", "14", "+", "320", ",", "21", "@", "@", "public", "OrganisationInformation", "getOrganisationInformation", "(", ")", "return", "getModelMapper", "(", ").", "map", "(", "organisationInformation", ",", "OrganisationInformation", ".", "class", ")", ";", "}", "private", "void", "checkUrl", "(", "String", "url", ",", "String", "propertyName", ")", "throws", "RepositoryAdminException", "{", "private", "String", "fixUrl", "(", "String", "url", ",", "String", "propertyName", ")", "throws", "RepositoryAdminException", "{", "if", "(", "StringUtils", ".", "isNotEmpty", "(", "url", ")", ")", "{", "if", "(", "!", "ResourceUtils", ".", "isUrl", "(", "url", ")", ")", "{", "throw", "new", "RepositoryAdminException", "(", "\"", "Bad", "URL", "in", "\"", "+", "propertyName", "+", "\"", ":", "\"", "+", "url", ")", ";", "}", "try", "{", "URI", "urlToCheck", "=", "new", "URI", "(", "url", ")", ";", "return", "urlToCheck", ".", "toString", "(", ");", "}", "catch", "(", "URISyntaxException", "e", ")", "{", "throw", "new", "RepositoryAdminException", "(", "\"", "Bad", "URL", "in", "\"", "+", "propertyName", "+", "\"", ":", "\"", "+", "url", ")", ";", "}", "}", "return", "url", ";", "}", "@", "@", "-", "347", ",", "8", "+", "346", ",", "9", "@", "@", "private", "String", "convertName", "(", "String", "name", ")", "{", "public", "void", "setOrganisationInformation", "(", "OrganisationInformation", "organisationInformation", ")", "throws", "RepositoryAdminException", "{", "checkUrl", "(", "organisationInformation", ".", "getUrl", "(", "),", "\"", "url", "\"", ");", "checkUrl", "(", "organisationInformation", ".", "getLogoLocation", "(", "),", "\"", "logoLocation", "\"", ")", ";", "organisationInformation", ".", "setUrl", "(", "fixUrl", "(", "organisationInformation", ".", "getUrl", "(", "),", "\"", "url", "\"", "))", ";", "organisationInformation", ".", "setLogoLocation", "(", "fixUrl", "(", "organisationInformation", ".", "getLogoLocation", "(", "),", "\"", "logoLocation", "\"", ")", ");", "Configuration", "configuration", "=", "getArchivaConfiguration", "(", ")", ".", "getConfiguration", "(", ")", ";", "if", "(", "organisationInformation", "!", "=", "null", ")", "{", "@", "@", "-", "222", ",", "7", "+", "222", ",", "7", "@", "@", "public", "void", "badOrganisationInfoLogoLocation", "(", ")", "try", "{", "OrganisationInformation", "newOrganisationInformation", "=", "new", "OrganisationInformation", "(", ")", ";", "newOrganisationInformation", ".", "setLogoLocation", "(", "\"", "'/", "><", "svg", "/", "onload", "=", "alert", "(", "/", "logoLocation_xss", "/", ")>", "\"", ")", ";", "newOrganisationInformation", ".", "setLogoLocation", "(", "\"", "http", ":", "//", "www", ".", "foo", ".", "com", "'", "/>", "<", "svg", "/", "onload", "=", "alert", "(", "/", "logoLocation_xss", "/", ")>", "\"", ")", ";", "newOrganisationInformation", ".", "setName", "(", "\"", "foo", "org", "\"", ")", ";", "newOrganisationInformation", ".", "setUrl", "(", "\"", "http", ":", "//", "foo", ".", "com", "\"", ")", ";", "archivaAdministration", ".", "setOrganisationInformation", "(", "newOrganisationInformation", ")", ";", "@", "@", "-", "240", ",", "7", "+", "240", ",", "7", "@", "@", "public", "void", "badOrganisationInfoUrl", "(", ")", "try", "{", "OrganisationInformation", "newOrganisationInformation", "=", "new", "OrganisationInformation", "(", ")", ";", "newOrganisationInformation", ".", "setUrl", "(", "\"", "'/", "><", "svg", "/", "onload", "=", "alert", "(", "/", "url_xss", "/", ")>", "\"", ")", ";", "newOrganisationInformation", ".", "setUrl", "(", "\"", "http", ":", "//", "foo", ".", "com", "'", "/>", "<", "svg", "/", "onload", "=", "alert", "(", "/", "url_xss", "/", ")>", "\"", ")", ";", "newOrganisationInformation", ".", "setName", "(", "\"", "foo", "org", "\"", ")", ";", "newOrganisationInformation", ".", "setLogoLocation", "(", "\"", "http", ":", "//", "foo", ".", "com", "/", "bar", ".", "png", "\"", ")", ";", "archivaAdministration", ".", "setOrganisationInformation", "(", "newOrganisationInformation", ")", ";", "@", "@", "-", "20", ",", "11", "+", "20", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "RepositoryAdminException", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "admin", ".", "ArchivaAdministration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "FileType", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "LegacyArtifactPath", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "NetworkConfiguration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "OrganisationInformation", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "UiConfiguration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "*;", "import", "org", ".", "apache", ".", "archiva", ".", "repository", ".", "scanner", ".", "RepositoryContentConsumers", ";", "import", "org", ".", "apache", ".", "archiva", ".", "rest", ".", "api", ".", "model", ".", "AdminRepositoryConsumer", ";", "import", "org", ".", "apache", ".", "archiva", ".", "rest", ".", "api", ".", "services", ".", "ArchivaAdministrationService", ";", "@", "@", "-", "319", ",", "7", "+", "315", ",", "7", "@", "@", "public", "void", "setOrganisationInformation", "(", "OrganisationInformation", "organisationInfo", "}", "catch", "(", "RepositoryAdminException", "e", ")", "{", "throw", "new", "ArchivaRestServiceException", "(", "e", ".", "getMessage", "(", "),", "e", ")", ";", "throw", "new", "ArchivaRestServiceException", "(", "e", ".", "getMessage", "(", "),", "400", ",", "e", ")", ";", "}", "}", "@", "@", "-", "23", ",", "9", "+", "23", ",", "11", "@", "@", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "OrganisationInformation", ";", "import", "org", ".", "apache", ".", "archiva", ".", "admin", ".", "model", ".", "beans", ".", "UiConfiguration", ";", "import", "org", ".", "apache", ".", "archiva", ".", "rest", ".", "api", ".", "model", ".", "AdminRepositoryConsumer", ";", "import", "org", ".", "apache", ".", "archiva", ".", "rest", ".", "api", ".", "services", ".", "ArchivaRestServiceException", ";", "import", "org", ".", "apache", ".", "commons", ".", "lang", ".", "StringUtils", ";", "import", "org", ".", "junit", ".", "Test", ";", "import", "javax", ".", "ws", ".", "rs", ".", "BadRequestException", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "List", ";", "@", "@", "-", "92", ",", "6", "+", "94", ",", "60", "@", "@", "public", "void", "organisationInformationUpdate", "(", ")", "assertEquals", "(", "\"", "http", ":", "//", "foo", ".", "com", "\"", ",", "organisationInformation", ".", "getUrl", "(", ")", ")", ";", "}", "@", "Test", "public", "void", "badOrganizationLogoLocation", "(", ")", "throws", "Exception", "{", "OrganisationInformation", "organisationInformation", "=", "getArchivaAdministrationService", "(", ").", "getOrganisationInformation", "(", ");", "/", "/", "rest", "return", "an", "empty", "bean", "assertNotNull", "(", "organisationInformation", ")", ";", "assertTrue", "(", "StringUtils", ".", "isBlank", "(", "organisationInformation", ".", "getLogoLocation", "(", ")", ")", ")", ";", "assertTrue", "(", "StringUtils", ".", "isBlank", "(", "organisationInformation", ".", "getName", "(", ")", ")", ")", ";", "assertTrue", "(", "StringUtils", ".", "isBlank", "(", "organisationInformation", ".", "getUrl", "(", ")", ")", ")", ";", "organisationInformation", "=", "new", "OrganisationInformation", "(", ");", "organisationInformation", ".", "setLogoLocation", "(", "\"", "http", ":", "//", "foo", ".", "com", "'", "/>", "<", "svg", "/", "onload", "=", "alert", "(", "/", "logoLocation_xss", "/", ")>", "\"", ")", ";", "organisationInformation", ".", "setName", "(", "\"", "foo", "org", "\"", ")", ";", "organisationInformation", ".", "setUrl", "(", "\"", "http", ":", "//", "foo", ".", "com", "\"", ")", ";", "try", "{", "getArchivaAdministrationService", "(", ").", "setOrganisationInformation", "(", "organisationInformation", ")", ";", "fail", "(", "\"", "RepositoryAdminException", "expected", ".", "Bad", "URL", "content", "should", "not", "be", "allowed", "for", "logo", "location", ".", "\")", ";", "}", "catch", "(", "BadRequestException", "e", ")", "{", "/", "/", "OK", "}", "}", "@", "Test", "public", "void", "badOrganizationUrl", "(", ")", "throws", "Exception", "{", "OrganisationInformation", "organisationInformation", "=", "getArchivaAdministrationService", "(", ").", "getOrganisationInformation", "(", ");", "/", "/", "rest", "return", "an", "empty", "bean", "assertNotNull", "(", "organisationInformation", ")", ";", "assertTrue", "(", "StringUtils", ".", "isBlank", "(", "organisationInformation", ".", "getLogoLocation", "(", ")", ")", ")", ";", "assertTrue", "(", "StringUtils", ".", "isBlank", "(", "organisationInformation", ".", "getName", "(", ")", ")", ")", ";", "assertTrue", "(", "StringUtils", ".", "isBlank", "(", "organisationInformation", ".", "getUrl", "(", ")", ")", ")", ";", "organisationInformation", "=", "new", "OrganisationInformation", "(", ");", "organisationInformation", ".", "setLogoLocation", "(", "\"", "http", ":", "//", "foo", ".", "com", "/", "logo", ".", "jpg", "\"", ")", ";", "organisationInformation", ".", "setName", "(", "\"", "foo", "org", "\"", ")", ";", "organisationInformation", ".", "setUrl", "(", "\"", "http", ":", "//", "foo", ".", "com", "'", "/>", "<", "svg", "/", "onload", "=", "alert", "(", "/", "url_xss", "/", ")>", "\"", ")", ";", "try", "{", "getArchivaAdministrationService", "(", ").", "setOrganisationInformation", "(", "organisationInformation", ")", ";", "fail", "(", "\"", "RepositoryAdminException", "expected", ".", "Bad", "URL", "content", "should", "not", "be", "allowed", "for", "logo", "location", ".", "\")", ";", "}", "catch", "(", "BadRequestException", "e", ")", "{", "/", "/", "OK", "}", "}", "@", "Test", "public", "void", "uiConfigurationReadUpdate", "(", ")", "throws", "Exception"], "docstring_tokens": ["write", "files", "to", "the", "archiva", "server", "at", "arbitrary", "locations", "and", "delete", "files", "from", "the", "server"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "517", ",", "8", "+", "517", ",", "6", "@", "@", "static", "inline", "void", "choose_new_parent", "(", "task_t", "*", "p", ",", "task_t", "*", "reaper", ",", "task_t", "*", "child_re", "*", "/", "BUG_ON", "(", "p", "=", "=", "reaper", "|", "|", "reaper", "-", ">", "exit_state", ">", "=", "EXIT_ZOMBIE", ")", ";", "p", "-", ">", "real_parent", "=", "reaper", ";", "if", "(", "p", "-", ">", "parent", "=", "=", "p", "-", ">", "real_parent", ")", "BUG", "(", ");", "}", "static", "inline", "void", "reparent_thread", "(", "task_t", "*", "p", ",", "task_t", "*", "father", ",", "int", "traced", ")"], "docstring_tokens": ["a", "kernel", "panic", "in", "which", "the", "parent", "process", "is", "terminated"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "117", ",", "13", "+", "117", ",", "26", "@", "@", "static", "int", "atusb_read_reg", "(", "struct", "atusb", "*", "atusb", ",", "uint8_t", "reg", ")", "{", "struct", "usb_device", "*", "usb_dev", "=", "atusb", "-", ">", "usb_dev", ";", "int", "ret", ";", "uint8_t", "*", "buffer", ";", "uint8_t", "value", ";", "buffer", "=", "kmalloc", "(", "1", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "buffer", ")", "return", "-", "ENOMEM", ";", "dev_dbg", "(", "&", "usb_dev", "-", ">", "dev", ",", "\"", "atusb", ":", "reg", "=", "0x", "%", "x", "\\", "n", "\"", ",", "reg", ")", ";", "ret", "=", "atusb_control_msg", "(", "atusb", ",", "usb_rcvctrlpipe", "(", "usb_dev", ",", "0", ")", ",", "ATUSB_REG_READ", ",", "ATUSB_REQ_FROM_DEV", ",", "0", ",", "reg", ",", "&", "value", ",", "1", ",", "1000", ")", ";", "return", "ret", ">", "=", "0", "?", "value", ":", "ret", ";", "0", ",", "reg", ",", "buffer", ",", "1", ",", "1000", ")", ";", "if", "(", "ret", ">", "=", "0", ")", "{", "value", "=", "buffer", "[", "0", "]", ";", "kfree", "(", "buffer", ")", ";", "return", "value", ";", "}", "else", "{", "kfree", "(", "buffer", ")", ";", "return", "ret", ";", "}", "}", "static", "int", "atusb_write_subreg", "(", "struct", "atusb", "*", "atusb", ",", "uint8_t", "reg", ",", "uint8_t", "mask", ",", "@", "@", "-", "608", ",", "9", "+", "621", ",", "13", "@", "@", "static", "const", "struct", "ieee802154_ops", "atusb_ops", "=", "{", "static", "int", "atusb_get_and_show_revision", "(", "struct", "atusb", "*", "atusb", ")", "{", "struct", "usb_device", "*", "usb_dev", "=", "atusb", "-", ">", "usb_dev", ";", "unsigned", "char", "buffer", "[", "3", "]", ";", "unsigned", "char", "*", "buffer", ";", "int", "ret", ";", "buffer", "=", "kmalloc", "(", "3", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "buffer", ")", "return", "-", "ENOMEM", ";", "/", "*", "Get", "a", "couple", "of", "the", "ATMega", "Firmware", "values", "*", "/", "ret", "=", "atusb_control_msg", "(", "atusb", ",", "usb_rcvctrlpipe", "(", "usb_dev", ",", "0", ")", ",", "ATUSB_ID", ",", "ATUSB_REQ_FROM_DEV", ",", "0", ",", "0", ",", "@", "@", "-", "631", ",", "15", "+", "648", ",", "20", "@", "@", "static", "int", "atusb_get_and_show_revision", "(", "struct", "atusb", "*", "atusb", ")", "dev_info", "(", "&", "usb_dev", "-", ">", "dev", ",", "\"", "Please", "update", "to", "version", "0", ".", "2", "or", "newer", "\"", ");", "}", "kfree", "(", "buffer", ")", ";", "return", "ret", ";", "}", "static", "int", "atusb_get_and_show_build", "(", "struct", "atusb", "*", "atusb", ")", "{", "struct", "usb_device", "*", "usb_dev", "=", "atusb", "-", ">", "usb_dev", ";", "char", "build", "[", "ATUSB_BUILD_SIZE", "+", "1", "]", ";", "char", "*", "build", ";", "int", "ret", ";", "build", "=", "kmalloc", "(", "ATUSB_BUILD_SIZE", "+", "1", ",", "GFP_KERNEL", ")", ";", "if", "(", "!", "build", ")", "return", "-", "ENOMEM", ";", "ret", "=", "atusb_control_msg", "(", "atusb", ",", "usb_rcvctrlpipe", "(", "usb_dev", ",", "0", ")", ",", "ATUSB_BUILD", ",", "ATUSB_REQ_FROM_DEV", ",", "0", ",", "0", ",", "build", ",", "ATUSB_BUILD_SIZE", ",", "1000", ")", ";", "@", "@", "-", "648", ",", "6", "+", "670", ",", "7", "@", "@", "static", "int", "atusb_get_and_show_build", "(", "struct", "atusb", "*", "atusb", ")", "dev_info", "(", "&", "usb_dev", "-", ">", "dev", ",", "\"", "Firmware", ":", "build", "%", "s", "\\", "n", "\"", ",", "build", ")", ";", "}", "kfree", "(", "build", ")", ";", "return", "ret", ";", "}"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(system", "crash", "or", "memory", "corruption", ")", "or", "possibly", "have", "unspecified", "other", "impact"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "140", ",", "18", "+", "140", ",", "9", "@", "@", "struct", "sctp_chunk", "*", "sctp_inq_pop", "(", "struct", "sctp_inq", "*", "queue", ")", "}", "else", "{", "/", "*", "Nothing", "to", "do", ".", "Next", "chunk", "in", "the", "packet", ",", "please", ".", "*", "/", "ch", "=", "(", "sctp_chunkhdr_t", "*", ")", "chunk", "-", ">", "chunk_end", ";", "/", "*", "Force", "chunk", "-", ">", "skb", "-", ">", "data", "to", "chunk", "-", ">", "chunk_end", ".", "*", "/", "skb_pull", "(", "chunk", "-", ">", "skb", ",", "chunk", "-", ">", "chunk_end", "-", "chunk", "-", ">", "skb", "-", ">", "data", ")", ";", "/", "*", "Verify", "that", "we", "have", "at", "least", "chunk", "headers", "*", "worth", "of", "buffer", "left", ".", "*", "/", "if", "(", "skb_headlen", "(", "chunk", "-", ">", "skb", ")", "<", "sizeof", "(", "sctp_chunkhdr_t", ")", ")", "{", "sctp_chunk_free", "(", "chunk", ")", ";", "chunk", "=", "queue", "-", ">", "in_progress", "=", "NULL", ";", "}", "skb_pull", "(", "chunk", "-", ">", "skb", ",", "chunk", "-", ">", "chunk_end", "-", "chunk", "-", ">", "skb", "-", ">", "data", ")", ";", "/", "*", "We", "are", "guaranteed", "to", "pull", "a", "SCTP", "header", ".", "*", "/", "}", "}", "@", "@", "-", "187", ",", "24", "+", "178", ",", "14", "@", "@", "struct", "sctp_chunk", "*", "sctp_inq_pop", "(", "struct", "sctp_inq", "*", "queue", ")", "skb_pull", "(", "chunk", "-", ">", "skb", ",", "sizeof", "(", "sctp_chunkhdr_t", ")", ");", "chunk", "-", ">", "subh", ".", "v", "=", "NULL", ";", "/", "*", "Subheader", "is", "no", "longer", "valid", ".", "*", "/", "if", "(", "chunk", "-", ">", "chunk_end", "<", "skb_tail_pointer", "(", "chunk", "-", ">", "skb", ")", ")", "{", "if", "(", "chunk", "-", ">", "chunk_end", "+", "sizeof", "(", "sctp_chunkhdr_t", ")", "<", "skb_tail_pointer", "(", "chunk", "-", ">", "skb", ")", ")", "{", "/", "*", "This", "is", "not", "a", "singleton", "*", "/", "chunk", "-", ">", "singleton", "=", "0", ";", "}", "else", "if", "(", "chunk", "-", ">", "chunk_end", ">", "skb_tail_pointer", "(", "chunk", "-", ">", "skb", ")", ")", "{", "/", "*", "RFC", "2960", ",", "Section", "6", ".", "10", "Bundling", "*", "*", "Partial", "chunks", "MUST", "NOT", "be", "placed", "in", "an", "SCTP", "packet", ".", "*", "If", "the", "receiver", "detects", "a", "partial", "chunk", ",", "it", "MUST", "drop", "*", "the", "chunk", ".", "*", "*", "Since", "the", "end", "of", "the", "chunk", "is", "past", "the", "end", "of", "our", "buffer", "*", "(", "which", "contains", "the", "whole", "packet", ",", "we", "can", "freely", "discard", "*", "the", "whole", "packet", ".", "*", "/", "sctp_chunk_free", "(", "chunk", ")", ";", "chunk", "=", "queue", "-", ">", "in_progress", "=", "NULL", ";", "return", "NULL", ";", "/", "*", "Discard", "inside", "state", "machine", ".", "*", "/", "chunk", "-", ">", "pdiscard", "=", "1", ";", "chunk", "-", ">", "chunk_end", "=", "skb_tail_pointer", "(", "chunk", "-", ">", "skb", ")", ";", "}", "else", "{", "/", "*", "We", "are", "at", "the", "end", "of", "the", "packet", ",", "so", "mark", "the", "chunk", "*", "in", "case", "we", "need", "to", "send", "a", "SACK", ".", "@", "@", "-", "170", ",", "6", "+", "170", ",", "9", "@", "@", "sctp_chunk_length_valid", "(", "struct", "sctp_chunk", "*", "chunk", ",", "{", "__u16", "chunk_length", "=", "ntohs", "(", "chunk", "-", ">", "chunk_hdr", "-", ">", "length", ")", ";", "/", "*", "Previously", "already", "marked", "?", "*", "/", "if", "(", "unlikely", "(", "chunk", "-", ">", "pdiscard", ")", ")", "return", "0", ";", "if", "(", "unlikely", "(", "chunk_length", "<", "required_length", ")", ")", "return", "0", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(memory", "consumption", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "70", ",", "7", "+", "70", ",", "7", "@", "@", "@", "Inject", "public", "GroovyScriptEngineService", "(", "Settings", "settings", ")", "{", "super", "(", "settings", ")", ";", "this", ".", "sandboxed", "=", "settings", ".", "getAsBoolean", "(", "GROOVY_SCRIPT_SANDBOX_ENABLED", ",", "true", ")", ";", "this", ".", "sandboxed", "=", "settings", ".", "getAsBoolean", "(", "GROOVY_SCRIPT_SANDBOX_ENABLED", ",", "false", ")", ";", "this", ".", "blacklistAdditions", "=", "ImmutableSet", ".", "copyOf", "(", "settings", ".", "getAsArray", "(", "GROOVY_SCRIPT_BLACKLIST_PATCH", ",", "Strings", ".", "EMPTY_ARRAY", ")", ");", "reloadConfig", "(", ");", "}", "@", "@", "-", "27", ",", "6", "+", "27", ",", "7", "@", "@", "import", "org", ".", "elasticsearch", ".", "common", ".", "util", ".", "concurrent", ".", "AbstractRunnable", ";", "import", "org", ".", "elasticsearch", ".", "index", ".", "Index", ";", "import", "org", ".", "elasticsearch", ".", "index", ".", "shard", ".", "ShardId", ";", "import", "org", ".", "elasticsearch", ".", "script", ".", "ScriptService", ";", "import", "org", ".", "elasticsearch", ".", "test", ".", "ElasticsearchTestCase", ";", "import", "org", ".", "junit", ".", "Test", ";", "@", "@", "-", "394", ",", "6", "+", "395", ",", "7", "@", "@", "public", "NodeEnvironment", "newNodeEnvironment", "(", "Settings", "settings", ")", "throws", "IOException", ".", "put", "(", "settings", ")", ".", "put", "(", "\"", "path", ".", "home", "\"", ",", "newTempDirPath", "(", ").", "toAbsolutePath", "(", ").", "toString", "(", "))", ".", "put", "(", "NodeEnvironment", ".", "SETTING_CUSTOM_DATA_PATH_ENABLED", ",", "true", ")", ".", "put", "(", "ScriptService", ".", "DISABLE_DYNAMIC_SCRIPTING_SETTING", ",", "false", ")", ".", "putArray", "(", "\"", "path", ".", "data", "\"", ",", "tmpPaths", "(", "))", ".", "build", "(", ");", "return", "new", "NodeEnvironment", "(", "build", ",", "new", "Environment", "(", "build", ")", ");", "}", "@", "@", "-", "403", ",", "6", "+", "405", ",", "7", "@", "@", "public", "NodeEnvironment", "newNodeEnvironment", "(", "String", "[", "]", "dataPaths", ",", "Settings", "settings", ")", ".", "put", "(", "settings", ")", ".", "put", "(", "\"", "path", ".", "home", "\"", ",", "newTempDirPath", "(", ").", "toAbsolutePath", "(", ").", "toString", "(", "))", ".", "put", "(", "NodeEnvironment", ".", "SETTING_CUSTOM_DATA_PATH_ENABLED", ",", "true", ")", ".", "put", "(", "ScriptService", ".", "DISABLE_DYNAMIC_SCRIPTING_SETTING", ",", "false", ")", ".", "putArray", "(", "\"", "path", ".", "data", "\"", ",", "dataPaths", ")", ".", "build", "(", ");", "return", "new", "NodeEnvironment", "(", "build", ",", "new", "Environment", "(", "build", ")", ");", "}", "@", "@", "-", "34", ",", "11", "+", "34", ",", "18", "@", "@", "/", "**", "*", "Tests", "for", "the", "Groovy", "scripting", "sandbox", "*", "/", "@", "ElasticsearchIntegrationTest", ".", "ClusterScope", "(", "scope", "=", "ElasticsearchIntegrationTest", ".", "Scope", ".", "TEST", ")", "@", "ElasticsearchIntegrationTest", ".", "ClusterScope", "(", "scope", "=", "ElasticsearchIntegrationTest", ".", "Scope", ".", "TEST", ",", "numDataNodes", "=", "0", ")", "public", "class", "GroovySandboxScriptTests", "extends", "ElasticsearchIntegrationTest", "{", "@", "Test", "public", "void", "testSandboxedGroovyScript", "(", ")", "{", "public", "void", "testSandboxedGroovyScript", "(", ")", "throws", "Exception", "{", "int", "nodes", "=", "randomIntBetween", "(", "1", ",", "3", ")", ";", "Settings", "nodeSettings", "=", "ImmutableSettings", ".", "builder", "(", ")", ".", "put", "(", "GroovyScriptEngineService", ".", "GROOVY_SCRIPT_SANDBOX_ENABLED", ",", "true", ")", ".", "build", "(", ");", "internalCluster", "(", ").", "startNodesAsync", "(", "nodes", ",", "nodeSettings", ")", ".", "get", "(", ");", "client", "(", ").", "admin", "(", ").", "cluster", "(", ").", "prepareHealth", "(", ").", "setWaitForNodes", "(", "nodes", "+", "\"", "\")", ".", "get", "(", ");", "client", "(", ").", "prepareIndex", "(", "\"", "test", "\"", ",", "\"", "doc", "\"", ",", "\"", "1", "\"", ").", "setSource", "(", "\"", "foo", "\"", ",", "5", ")", ".", "setRefresh", "(", "true", ")", ".", "get", "(", ");", "/", "/", "Plain", "test", "@", "@", "-", "102", ",", "6", "+", "109", ",", "13", "@", "@", "public", "void", "testSandboxedGroovyScript", "(", ")", "{", "@", "Test", "public", "void", "testDynamicBlacklist", "(", ")", "throws", "Exception", "{", "int", "nodes", "=", "randomIntBetween", "(", "1", ",", "3", ")", ";", "Settings", "nodeSettings", "=", "ImmutableSettings", ".", "builder", "(", ")", ".", "put", "(", "GroovyScriptEngineService", ".", "GROOVY_SCRIPT_SANDBOX_ENABLED", ",", "true", ")", ".", "build", "(", ");", "internalCluster", "(", ").", "startNodesAsync", "(", "nodes", ",", "nodeSettings", ")", ".", "get", "(", ");", "client", "(", ").", "admin", "(", ").", "cluster", "(", ").", "prepareHealth", "(", ").", "setWaitForNodes", "(", "nodes", "+", "\"", "\")", ".", "get", "(", ");", "client", "(", ").", "prepareIndex", "(", "\"", "test", "\"", ",", "\"", "doc", "\"", ",", "\"", "1", "\"", ").", "setSource", "(", "\"", "foo", "\"", ",", "5", ")", ".", "setRefresh", "(", "true", ")", ".", "get", "(", ");", "testSuccess", "(", "\"[", "doc", "[", "'", "foo", "'", "].", "value", ",", "3", ",", "4", "]", ".", "isEmpty", "(", ")\"", ");", "@", "@", "-", "83", ",", "19", "+", "83", ",", "6", "@", "@", "public", "void", "testGroovyExceptionSerialization", "(", ")", "throws", "Exception", "{", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", ".", "contains", "(", "\"", "No", "such", "property", ":", "not_found", "\"", "),", "equalTo", "(", "true", ")", ");", "}", "try", "{", "client", "(", ").", "prepareSearch", "(", "\"", "test", "\"", ").", "setQuery", "(", "constantScoreQuery", "(", "scriptFilter", "(", "\"", "pr", "=", "Runtime", ".", "getRuntime", "(", ").", "exec", "(", "\\\"", "touch", "/", "tmp", "/", "gotcha", "\\", "\")", ";", "pr", ".", "waitFor", "(", ")\"", ").", "lang", "(", "\"", "groovy", "\"", "))", ").", "get", "(", ");", "fail", "(", "\"", "should", "have", "thrown", "an", "exception", "\"", ");", "}", "catch", "(", "SearchPhaseExecutionException", "e", ")", "{", "assertThat", "(", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", "+", "\"", "should", "not", "contained", "NotSerializableTransportException", "\"", ",", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", ".", "contains", "(", "\"", "NotSerializableTransportException", "\"", "),", "equalTo", "(", "false", ")", ");", "assertThat", "(", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", "+", "\"", "should", "have", "contained", "GroovyScriptCompilationException", "\"", ",", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", ".", "contains", "(", "\"", "GroovyScriptCompilationException", "\"", "),", "equalTo", "(", "true", ")", ");", "assertThat", "(", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", "+", "\"", "should", "have", "contained", "Method", "calls", "not", "allowed", "on", "[", "java", ".", "lang", ".", "Runtime", "]", "\",", "ExceptionsHelper", ".", "detailedMessage", "(", "e", ")", ".", "contains", "(", "\"", "Method", "calls", "not", "allowed", "on", "[", "java", ".", "lang", ".", "Runtime", "]", "\")", ",", "equalTo", "(", "true", ")", ");", "}", "try", "{", "client", "(", ").", "prepareSearch", "(", "\"", "test", "\"", ").", "setQuery", "(", "constantScoreQuery", "(", "scriptFilter", "(", "\"", "assert", "false", "\"", ").", "lang", "(", "\"", "groovy", "\"", "))", ").", "get", "(", ");", "@", "@", "-", "98", ",", "6", "+", "98", ",", "7", "@", "@", "private", "static", "Node", "newNode", "(", ")", "{", ".", "put", "(", "\"", "node", ".", "name", "\"", ",", "nodeName", "(", "))", ".", "put", "(", "IndexMetaData", ".", "SETTING_NUMBER_OF_SHARDS", ",", "1", ")", ".", "put", "(", "IndexMetaData", ".", "SETTING_NUMBER_OF_REPLICAS", ",", "0", ")", ".", "put", "(", "\"", "script", ".", "disable_dynamic", "\"", ",", "false", ")", ".", "put", "(", "EsExecutors", ".", "PROCESSORS", ",", "1", ")", "/", "/", "limit", "the", "number", "of", "threads", "created", ".", "put", "(", "\"", "http", ".", "enabled", "\"", ",", "false", ")", ".", "put", "(", "\"", "config", ".", "ignore_system_properties", "\"", ",", "true", ")", "/", "/", "make", "sure", "we", "get", "what", "we", "set", ":", ")"], "docstring_tokens": ["bypass", "the", "sandbox", "protection", "mechanism", "and", "execute", "arbitrary", "shell", "commands"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "447", ",", "8", "+", "447", ",", "10", "@", "@", "static", "void", "icmp6_send", "(", "struct", "sk_buff", "*", "skb", ",", "u8", "type", ",", "u8", "code", ",", "__u32", "info", ",", "if", "(", "__ipv6_addr_needs_scope_id", "(", "addr_type", ")", ")", "iif", "=", "skb", "-", ">", "dev", "-", ">", "ifindex", ";", "else", "iif", "=", "l3mdev_master_ifindex", "(", "skb_dst", "(", "skb", ")", "->", "dev", ")", ";", "else", "{", "dst", "=", "skb_dst", "(", "skb", ")", ";", "iif", "=", "l3mdev_master_ifindex", "(", "dst", "?", "dst", "-", ">", "dev", ":", "skb", "-", ">", "dev", ")", ";", "}", "/", "*", "*", "Must", "not", "send", "error", "if", "the", "source", "does", "not", "uniquely"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(panic", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "426", ",", "6", "+", "426", ",", "11", "@", "@", "static", "inline", "void", "sctp_assoc_pending_pmtu", "(", "struct", "sock", "*", "sk", ",", "struct", "sctp_associat", "asoc", "-", ">", "pmtu_pending", "=", "0", ";", "}", "static", "inline", "bool", "sctp_chunk_pending", "(", "const", "struct", "sctp_chunk", "*", "chunk", ")", "{", "return", "!", "list_empty", "(", "&", "chunk", "-", ">", "list", ")", ";", "}", "/", "*", "Walk", "through", "a", "list", "of", "TLV", "parameters", ".", "Don", "'", "t", "trust", "the", "*", "individual", "parameter", "lengths", "and", "instead", "depend", "on", "*", "the", "chunk", "length", "to", "indicate", "when", "to", "stop", ".", "Make", "sure", "@", "@", "-", "1668", ",", "6", "+", "1668", ",", "8", "@", "@", "struct", "sctp_chunk", "*", "sctp_assoc_lookup_asconf_ack", "(", "*", "ack", "chunk", "whose", "serial", "number", "matches", "that", "of", "the", "request", ".", "*", "/", "list_for_each_entry", "(", "ack", ",", "&", "asoc", "-", ">", "asconf_ack_list", ",", "transmitted_list", ")", "{", "if", "(", "sctp_chunk_pending", "(", "ack", ")", ")", "continue", ";", "if", "(", "ack", "-", ">", "subh", ".", "addip_hdr", "-", ">", "serial", "=", "=", "serial", ")", "{", "sctp_chunk_hold", "(", "ack", ")", ";", "return", "ack", ";"], "docstring_tokens": ["cause", "a", "denial", "of", "service", "(panic", ")"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "290", ",", "10", "+", "290", ",", "15", "@", "@", "static", "int", "rose_parse_national", "(", "unsigned", "char", "*", "p", ",", "struct", "rose_facilities_struct", "*", "facilities", "-", ">", "source_ndigis", "=", "0", ";", "facilities", "-", ">", "dest_ndigis", "=", "0", ";", "for", "(", "pt", "=", "p", "+", "2", ",", "lg", "=", "0", ";", "lg", "<", "l", ";", "pt", "+", "=", "AX25_ADDR_LEN", ",", "lg", "+", "=", "AX25_ADDR_LEN", ")", "{", "if", "(", "pt", "[", "6", "]", "&", "AX25_HBIT", ")", "if", "(", "pt", "[", "6", "]", "&", "AX25_HBIT", ")", "{", "if", "(", "facilities", "-", ">", "dest_ndigis", ">", "=", "ROSE_MAX_DIGIS", ")", "return", "-", "1", ";", "memcpy", "(", "&", "facilities", "-", ">", "dest_digis", "[", "facilities", "-", ">", "dest_ndigis", "+", "+]", ",", "pt", ",", "AX25_ADDR_LEN", ")", ";", "else", "}", "else", "{", "if", "(", "facilities", "-", ">", "source_ndigis", ">", "=", "ROSE_MAX_DIGIS", ")", "return", "-", "1", ";", "memcpy", "(", "&", "facilities", "-", ">", "source_digis", "[", "facilities", "-", ">", "source_ndigis", "+", "+]", ",", "pt", ",", "AX25_ADDR_LEN", ")", ";", "}", "}", "}", "p", "+", "=", "l", "+", "2", ";", "@", "@", "-", "333", ",", "6", "+", "338", ",", "11", "@", "@", "static", "int", "rose_parse_ccitt", "(", "unsigned", "char", "*", "p", ",", "struct", "rose_facilities_struct", "*", "fac", "case", "0xC0", ":", "l", "=", "p", "[", "1", "]", ";", "/", "*", "Prevent", "overflows", "*", "/", "if", "(", "l", "<", "10", "|", "|", "l", ">", "20", ")", "return", "-", "1", ";", "if", "(", "*", "p", "=", "=", "FAC_CCITT_DEST_NSAP", ")", "{", "memcpy", "(", "&", "facilities", "-", ">", "source_addr", ",", "p", "+", "7", ",", "ROSE_ADDR_LEN", ")", ";", "memcpy", "(", "callsign", ",", "p", "+", "12", ",", "l", "-", "10", ")", ";", "@", "@", "-", "373", ",", "12", "+", "383", ",", "16", "@", "@", "int", "rose_parse_facilities", "(", "unsigned", "char", "*", "p", ",", "switch", "(", "*", "p", ")", "{", "case", "FAC_NATIONAL", ":", "/", "*", "National", "*", "/", "len", "=", "rose_parse_national", "(", "p", "+", "1", ",", "facilities", ",", "facilities_len", "-", "1", ")", ";", "if", "(", "len", "<", "0", ")", "return", "0", ";", "facilities_len", "-", "=", "len", "+", "1", ";", "p", "+", "=", "len", "+", "1", ";", "break", ";", "case", "FAC_CCITT", ":", "/", "*", "CCITT", "*", "/", "len", "=", "rose_parse_ccitt", "(", "p", "+", "1", ",", "facilities", ",", "facilities_len", "-", "1", ")", ";", "if", "(", "len", "<", "0", ")", "return", "0", ";", "facilities_len", "-", "=", "len", "+", "1", ";", "p", "+", "=", "len", "+", "1", ";", "break", ";"], "docstring_tokens": ["since", "the", "out-of-bounds", "data", "is", "still", "validated", "by", "the", "parsing", "code"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1833", ",", "6", "+", "1833", ",", "10", "@", "@", "bytes", "respectively", ".", "Such", "letter", "suffixes", "can", "also", "be", "entirely", "omitted", ".", "and", "restore", "using", "xsave", ".", "The", "kernel", "will", "fallback", "to", "enabling", "legacy", "floating", "-", "point", "and", "sse", "state", ".", "eagerfpu", "=", "[", "X86", "]", "on", "enable", "eager", "fpu", "restore", "off", "disable", "eager", "fpu", "restore", "nohlt", "[", "BUGS", "=", "ARM", ",", "SH", "]", "Tells", "the", "kernel", "that", "the", "sleep", "(", "SH", ")", "or", "wfi", "(", "ARM", ")", "instruction", "doesn", "'", "t", "work", "correctly", "and", "not", "to", "use", "it", ".", "This", "is", "also", "useful", "when", "using", "JTAG", "debugger", ".", "@", "@", "-", "97", ",", "6", "+", "97", ",", "7", "@", "@", "#", "define", "X86_FEATURE_EXTD_APICID", "(", "3", "*", "32", "+", "26", ")", "/", "*", "has", "extended", "APICID", "(", "8", "bits", ")", "*", "/", "#", "define", "X86_FEATURE_AMD_DCM", "(", "3", "*", "32", "+", "27", ")", "/", "*", "multi", "-", "node", "processor", "*", "/", "#", "define", "X86_FEATURE_APERFMPERF", "(", "3", "*", "32", "+", "28", ")", "/", "*", "APERFMPERF", "*", "/", "#", "define", "X86_FEATURE_EAGER_FPU", "(", "3", "*", "32", "+", "29", ")", "/", "*", "\"", "eagerfpu", "\"", "Non", "lazy", "FPU", "restore", "*", "/", "/", "*", "Intel", "-", "defined", "CPU", "features", ",", "CPUID", "level", "0x00000001", "(", "ecx", ")", ",", "word", "4", "*", "/", "#", "define", "X86_FEATURE_XMM3", "(", "4", "*", "32", "+", "0", ")", "/", "*", "\"", "pni", "\"", "SSE", "-", "3", "*", "/", "@", "@", "-", "305", ",", "6", "+", "306", ",", "7", "@", "@", "extern", "const", "char", "*", "const", "x86_power_flags", "[", "32", "]", ";", "#", "define", "cpu_has_perfctr_core", "boot_cpu_has", "(", "X86_FEATURE_PERFCTR_CORE", ")", "#", "define", "cpu_has_cx8", "boot_cpu_has", "(", "X86_FEATURE_CX8", ")", "#", "define", "cpu_has_cx16", "boot_cpu_has", "(", "X86_FEATURE_CX16", ")", "#", "define", "cpu_has_eager_fpu", "boot_cpu_has", "(", "X86_FEATURE_EAGER_FPU", ")", "#", "if", "defined", "(", "CONFIG_X86_INVLPG", ")", "|", "|", "defined", "(", "CONFIG_X86_64", ")", "#", "define", "cpu_has_invlpg", "1", "@", "@", "-", "38", ",", "6", "+", "38", ",", "7", "@", "@", "int", "ia32_setup_frame", "(", "int", "sig", ",", "struct", "k_sigaction", "*", "ka", ",", "extern", "unsigned", "int", "mxcsr_feature_mask", ";", "extern", "void", "fpu_init", "(", "void", ")", ";", "extern", "void", "eager_fpu_init", "(", "void", ")", ";", "DECLARE_PER_CPU", "(", "struct", "task_struct", "*", ",", "fpu_owner_task", ")", ";", "@", "@", "-", "84", ",", "6", "+", "85", ",", "11", "@", "@", "static", "inline", "int", "is_x32_frame", "(", "void", ")", "#", "define", "X87_FSW_ES", "(", "1", "<", "<", "7", ")", "/", "*", "Exception", "Summary", "*", "/", "static", "__always_inline", "__pure", "bool", "use_eager_fpu", "(", "void", ")", "{", "return", "static_cpu_has", "(", "X86_FEATURE_EAGER_FPU", ")", ";", "}", "static", "__always_inline", "__pure", "bool", "use_xsaveopt", "(", "void", ")", "{", "return", "static_cpu_has", "(", "X86_FEATURE_XSAVEOPT", ")", ";", "@", "@", "-", "99", ",", "6", "+", "105", ",", "14", "@", "@", "static", "__always_inline", "__pure", "bool", "use_fxsr", "(", "void", ")", "return", "static_cpu_has", "(", "X86_FEATURE_FXSR", ")", ";", "}", "static", "inline", "void", "fx_finit", "(", "struct", "i387_fxsave_struct", "*", "fx", ")", "{", "memset", "(", "fx", ",", "0", ",", "xstate_size", ")", ";", "fx", "-", ">", "cwd", "=", "0x37f", ";", "if", "(", "cpu_has_xmm", ")", "fx", "-", ">", "mxcsr", "=", "MXCSR_DEFAULT", ";", "}", "extern", "void", "__sanitize_i387_state", "(", "struct", "task_struct", "*", ");", "static", "inline", "void", "sanitize_i387_state", "(", "struct", "task_struct", "*", "tsk", ")", "@", "@", "-", "291", ",", "13", "+", "305", ",", "13", "@", "@", "static", "inline", "void", "__thread_set_has_fpu", "(", "struct", "task_struct", "*", "tsk", ")", "static", "inline", "void", "__thread_fpu_end", "(", "struct", "task_struct", "*", "tsk", ")", "{", "__thread_clear_has_fpu", "(", "tsk", ")", ";", "if", "(", "!", "use_xsave", "(", "))", "if", "(", "!", "use_eager_fpu", "(", "))", "stts", "(", ");", "}", "static", "inline", "void", "__thread_fpu_begin", "(", "struct", "task_struct", "*", "tsk", ")", "{", "if", "(", "!", "use_xsave", "(", "))", "if", "(", "!", "use_eager_fpu", "(", "))", "clts", "(", ");", "__thread_set_has_fpu", "(", "tsk", ")", ";", "}", "@", "@", "-", "327", ",", "10", "+", "341", ",", "14", "@", "@", "static", "inline", "void", "drop_fpu", "(", "struct", "task_struct", "*", "tsk", ")", "static", "inline", "void", "drop_init_fpu", "(", "struct", "task_struct", "*", "tsk", ")", "{", "if", "(", "!", "use_xsave", "(", "))", "if", "(", "!", "use_eager_fpu", "(", "))", "drop_fpu", "(", "tsk", ")", ";", "else", "xrstor_state", "(", "init_xstate_buf", ",", "-", "1", ")", ";", "else", "{", "if", "(", "use_xsave", "(", "))", "xrstor_state", "(", "init_xstate_buf", ",", "-", "1", ")", ";", "else", "fxrstor_checking", "(", "&", "init_xstate_buf", "-", ">", "i387", ")", ";", "}", "}", "/", "*", "@", "@", "-", "370", ",", "7", "+", "388", ",", "7", "@", "@", "static", "inline", "fpu_switch_t", "switch_fpu_prepare", "(", "struct", "task_struct", "*", "old", ",", "struct", "ta", "*", "If", "the", "task", "has", "used", "the", "math", ",", "pre", "-", "load", "the", "FPU", "on", "xsave", "processors", "*", "or", "if", "the", "past", "5", "consecutive", "context", "-", "switches", "used", "math", ".", "*", "/", "fpu", ".", "preload", "=", "tsk_used_math", "(", "new", ")", "&", "&", "(", "use_xsave", "(", ")", "|", "|", "fpu", ".", "preload", "=", "tsk_used_math", "(", "new", ")", "&", "&", "(", "use_eager_fpu", "(", ")", "|", "|", "new", "-", ">", "fpu_counter", ">", "5", ")", ";", "if", "(", "__thread_has_fpu", "(", "old", ")", ")", "{", "if", "(", "!", "__save_init_fpu", "(", "old", ")", ")", "@", "@", "-", "383", ",", "14", "+", "401", ",", "14", "@", "@", "static", "inline", "fpu_switch_t", "switch_fpu_prepare", "(", "struct", "task_struct", "*", "old", ",", "struct", "ta", "new", "-", ">", "fpu_counter", "+", "+;", "__thread_set_has_fpu", "(", "new", ")", ";", "prefetch", "(", "new", "-", ">", "thread", ".", "fpu", ".", "state", ")", ";", "}", "else", "if", "(", "!", "use_xsave", "(", "))", "}", "else", "if", "(", "!", "use_eager_fpu", "(", "))", "stts", "(", ");", "}", "else", "{", "old", "-", ">", "fpu_counter", "=", "0", ";", "old", "-", ">", "thread", ".", "fpu", ".", "last_cpu", "=", "~", "0", ";", "if", "(", "fpu", ".", "preload", ")", "{", "new", "-", ">", "fpu_counter", "+", "+;", "if", "(", "!", "use_xsave", "(", ")", "&", "&", "fpu_lazy_restore", "(", "new", ",", "cpu", ")", ")", "if", "(", "!", "use_eager_fpu", "(", ")", "&", "&", "fpu_lazy_restore", "(", "new", ",", "cpu", ")", ")", "fpu", ".", "preload", "=", "0", ";", "else", "prefetch", "(", "new", "-", ">", "thread", ".", "fpu", ".", "state", ")", ";", "@", "@", "-", "452", ",", "15", "+", "470", ",", "23", "@", "@", "static", "inline", "void", "user_fpu_begin", "(", "void", ")", "preempt_enable", "(", ");", "}", "static", "inline", "void", "__save_fpu", "(", "struct", "task_struct", "*", "tsk", ")", "{", "if", "(", "use_xsave", "(", "))", "xsave_state", "(", "&", "tsk", "-", ">", "thread", ".", "fpu", ".", "state", "-", ">", "xsave", ",", "-", "1", ")", ";", "else", "fpu_fxsave", "(", "&", "tsk", "-", ">", "thread", ".", "fpu", ")", ";", "}", "/", "*", "*", "These", "disable", "preemption", "on", "their", "own", "and", "are", "safe", "*", "/", "static", "inline", "void", "save_init_fpu", "(", "struct", "task_struct", "*", "tsk", ")", "{", "WARN_ON_ONCE", "(", "!", "__thread_has_fpu", "(", "tsk", ")", ");", "if", "(", "use_xsave", "(", "))", "{", "xsave_state", "(", "&", "tsk", "-", ">", "thread", ".", "fpu", ".", "state", "-", ">", "xsave", ",", "-", "1", ")", ";", "if", "(", "use_eager_fpu", "(", "))", "{", "__save_fpu", "(", "tsk", ")", ";", "return", ";", "}", "@", "@", "-", "526", ",", "11", "+", "552", ",", "9", "@", "@", "static", "inline", "void", "fpu_free", "(", "struct", "fpu", "*", "fpu", ")", "static", "inline", "void", "fpu_copy", "(", "struct", "task_struct", "*", "dst", ",", "struct", "task_struct", "*", "src", ")", "{", "if", "(", "use_xsave", "(", "))", "{", "struct", "xsave_struct", "*", "xsave", "=", "&", "dst", "-", ">", "thread", ".", "fpu", ".", "state", "-", ">", "xsave", ";", "memset", "(", "&", "xsave", "-", ">", "xsave_hdr", ",", "0", ",", "sizeof", "(", "struct", "xsave_hdr_struct", ")", ");", "xsave_state", "(", "xsave", ",", "-", "1", ")", ";", "if", "(", "use_eager_fpu", "(", "))", "{", "memset", "(", "&", "dst", "-", ">", "thread", ".", "fpu", ".", "state", "-", ">", "xsave", ",", "0", ",", "xstate_size", ")", ";", "__save_fpu", "(", "dst", ")", ";", "}", "else", "{", "struct", "fpu", "*", "dfpu", "=", "&", "dst", "-", ">", "thread", ".", "fpu", ";", "struct", "fpu", "*", "sfpu", "=", "&", "src", "-", ">", "thread", ".", "fpu", ";", "@", "@", "-", "1297", ",", "7", "+", "1297", ",", "6", "@", "@", "void", "__cpuinit", "cpu_init", "(", "void", ")", "dbg_restore_debug_regs", "(", ");", "fpu_init", "(", ");", "xsave_init", "(", ");", "raw_local_save_flags", "(", "kernel_eflags", ")", ";", "@", "@", "-", "1352", ",", "6", "+", "1351", ",", "5", "@", "@", "void", "__cpuinit", "cpu_init", "(", "void", ")", "dbg_restore_debug_regs", "(", ");", "fpu_init", "(", ");", "xsave_init", "(", ");", "}", "#", "endif", "@", "@", "-", "22", ",", "9", "+", "22", ",", "8", "@", "@", "/", "*", "*", "Were", "we", "in", "an", "interrupt", "that", "interrupted", "kernel", "mode", "?", "*", "*", "For", "now", ",", "on", "xsave", "platforms", "we", "will", "return", "interrupted", "*", "kernel", "FPU", "as", "not", "-", "idle", ".", "TBD", ":", "As", "we", "use", "non", "-", "lazy", "FPU", "restore", "*", "for", "xsave", "platforms", ",", "ideally", "we", "can", "change", "the", "return", "value", "*", "For", "now", ",", "with", "eagerfpu", "we", "will", "return", "interrupted", "kernel", "FPU", "*", "state", "as", "not", "-", "idle", ".", "TBD", ":", "Ideally", "we", "can", "change", "the", "return", "value", "*", "to", "something", "like", "__thread_has_fpu", "(", "current", ")", ".", "But", "we", "need", "to", "*", "be", "careful", "of", "doing", "__thread_clear_has_fpu", "(", ")", "before", "saving", "*", "the", "FPU", "etc", "for", "supporting", "nested", "uses", "etc", ".", "For", "now", ",", "take", "@", "@", "-", "38", ",", "7", "+", "37", ",", "7", "@", "@", "*", "/", "static", "inline", "bool", "interrupted_kernel_fpu_idle", "(", "void", ")", "{", "if", "(", "use_xsave", "(", "))", "if", "(", "use_eager_fpu", "(", "))", "return", "0", ";", "return", "!", "__thread_has_fpu", "(", "current", ")", "&", "&", "@", "@", "-", "84", ",", "7", "+", "83", ",", "7", "@", "@", "void", "kernel_fpu_begin", "(", "void", ")", "__save_init_fpu", "(", "me", ")", ";", "__thread_clear_has_fpu", "(", "me", ")", ";", "/", "*", "We", "do", "'", "stts", "(", ")'", "in", "kernel_fpu_end", "(", ")", "*", "/", "}", "else", "if", "(", "!", "use_xsave", "(", "))", "{", "}", "else", "if", "(", "!", "use_eager_fpu", "(", "))", "{", "this_cpu_write", "(", "fpu_owner_task", ",", "NULL", ")", ";", "clts", "(", ");", "}", "@", "@", "-", "93", ",", "7", "+", "92", ",", "7", "@", "@", "EXPORT_SYMBOL", "(", "kernel_fpu_begin", ")", ";", "void", "kernel_fpu_end", "(", "void", ")", "{", "if", "(", "use_xsave", "(", "))", "if", "(", "use_eager_fpu", "(", "))", "math_state_restore", "(", ");", "else", "stts", "(", ");", "@", "@", "-", "122", ",", "7", "+", "121", ",", "6", "@", "@", "static", "void", "__cpuinit", "mxcsr_feature_mask_init", "(", "void", ")", "{", "unsigned", "long", "mask", "=", "0", ";", "clts", "(", ");", "if", "(", "cpu_has_fxsr", ")", "{", "memset", "(", "&", "fx_scratch", ",", "0", ",", "sizeof", "(", "struct", "i387_fxsave_struct", ")", ");", "asm", "volatile", "(", "\"", "fxsave", "%", "0", "\"", ":", ":", "\"", "m", "\"", "(", "fx_scratch", ")", ");", "@", "@", "-", "131", ",", "7", "+", "129", ",", "6", "@", "@", "static", "void", "__cpuinit", "mxcsr_feature_mask_init", "(", "void", ")", "mask", "=", "0x0000ffbf", ";", "}", "mxcsr_feature_mask", "&", "=", "mask", ";", "stts", "(", ");", "}", "static", "void", "__cpuinit", "init_thread_xstate", "(", "void", ")", "@", "@", "-", "185", ",", "9", "+", "182", ",", "8", "@", "@", "void", "__cpuinit", "fpu_init", "(", "void", ")", "init_thread_xstate", "(", ");", "mxcsr_feature_mask_init", "(", ");", "/", "*", "clean", "state", "in", "init", "*", "/", "current_thread_info", "(", ")-", ">", "status", "=", "0", ";", "clear_used_math", "(", ");", "xsave_init", "(", ");", "eager_fpu_init", "(", ");", "}", "void", "fpu_finit", "(", "struct", "fpu", "*", "fpu", ")", "@", "@", "-", "198", ",", "12", "+", "194", ",", "7", "@", "@", "void", "fpu_finit", "(", "struct", "fpu", "*", "fpu", ")", "}", "if", "(", "cpu_has_fxsr", ")", "{", "struct", "i387_fxsave_struct", "*", "fx", "=", "&", "fpu", "-", ">", "state", "-", ">", "fxsave", ";", "memset", "(", "fx", ",", "0", ",", "xstate_size", ")", ";", "fx", "-", ">", "cwd", "=", "0x37f", ";", "if", "(", "cpu_has_xmm", ")", "fx", "-", ">", "mxcsr", "=", "MXCSR_DEFAULT", ";", "fx_finit", "(", "&", "fpu", "-", ">", "state", "-", ">", "fxsave", ")", ";", "}", "else", "{", "struct", "i387_fsave_struct", "*", "fp", "=", "&", "fpu", "-", ">", "state", "-", ">", "fsave", ";", "memset", "(", "fp", ",", "0", ",", "xstate_size", ")", ";", "@", "@", "-", "156", ",", "7", "+", "156", ",", "7", "@", "@", "void", "flush_thread", "(", "void", ")", "*", "Free", "the", "FPU", "state", "for", "non", "xsave", "platforms", ".", "They", "get", "reallocated", "*", "lazily", "at", "the", "first", "use", ".", "*", "/", "if", "(", "!", "use_xsave", "(", "))", "if", "(", "!", "use_eager_fpu", "(", "))", "free_thread_xstate", "(", "tsk", ")", ";", "}", "@", "@", "-", "630", ",", "7", "+", "630", ",", "7", "@", "@", "EXPORT_SYMBOL_GPL", "(", "math_state_restore", ")", ";", "dotraplinkage", "void", "__kprobes", "do_device_not_available", "(", "struct", "pt_regs", "*", "regs", ",", "long", "error_code", ")", "{", "BUG_ON", "(", "use_xsave", "(", "))", ";", "BUG_ON", "(", "use_eager_fpu", "(", "))", ";", "#", "ifdef", "CONFIG_MATH_EMULATION", "if", "(", "read_cr0", "(", ")", "&", "X86_CR0_EM", ")", "{", "@", "@", "-", "400", ",", "7", "+", "400", ",", "7", "@", "@", "int", "__restore_xstate_sig", "(", "void", "__user", "*", "buf", ",", "void", "__user", "*", "buf_fx", ",", "int", "size", ")", "set_used_math", "(", ");", "}", "if", "(", "use_xsave", "(", "))", "if", "(", "use_eager_fpu", "(", "))", "math_state_restore", "(", ");", "return", "err", ";", "@", "@", "-", "450", ",", "28", "+", "450", ",", "10", "@", "@", "static", "void", "prepare_fx_sw_frame", "(", "void", ")", "*", "/", "static", "inline", "void", "xstate_enable", "(", "void", ")", "{", "clts", "(", ");", "set_in_cr4", "(", "X86_CR4_OSXSAVE", ")", ";", "xsetbv", "(", "XCR_XFEATURE_ENABLED_MASK", ",", "pcntxt_mask", ")", ";", "}", "/", "*", "*", "This", "is", "same", "as", "math_state_restore", "(", ").", "But", "use_xsave", "(", ")", "is", "not", "yet", "*", "patched", "to", "use", "math_state_restore", "(", ").", "*", "/", "static", "inline", "void", "init_restore_xstate", "(", "void", ")", "{", "init_fpu", "(", "current", ")", ";", "__thread_fpu_begin", "(", "current", ")", ";", "xrstor_state", "(", "init_xstate_buf", ",", "-", "1", ")", ";", "}", "static", "inline", "void", "xstate_enable_ap", "(", "void", ")", "{", "xstate_enable", "(", ");", "init_restore_xstate", "(", ");", "}", "/", "*", "*", "Record", "the", "offsets", "and", "sizes", "of", "different", "state", "managed", "by", "the", "xsave", "*", "memory", "layout", ".", "@", "@", "-", "500", ",", "17", "+", "482", ",", "20", "@", "@", "static", "void", "__init", "setup_xstate_features", "(", "void", ")", "/", "*", "*", "setup", "the", "xstate", "image", "representing", "the", "init", "state", "*", "/", "static", "void", "__init", "setup_xstate_init", "(", "void", ")", "static", "void", "__init", "setup_init_fpu_buf", "(", "void", ")", "{", "setup_xstate_features", "(", ");", "/", "*", "*", "Setup", "init_xstate_buf", "to", "represent", "the", "init", "state", "of", "*", "all", "the", "features", "managed", "by", "the", "xsave", "*", "/", "init_xstate_buf", "=", "alloc_bootmem_align", "(", "xstate_size", ",", "__alignof__", "(", "struct", "xsave_struct", ")", ");", "init_xstate_buf", "-", ">", "i387", ".", "mxcsr", "=", "MXCSR_DEFAULT", ";", "fx_finit", "(", "&", "init_xstate_buf", "-", ">", "i387", ")", ";", "if", "(", "!", "cpu_has_xsave", ")", "return", ";", "setup_xstate_features", "(", ");", "/", "*", "*", "Init", "all", "the", "features", "state", "with", "header_bv", "being", "0x0", "@", "@", "-", "523", ",", "6", "+", "508", ",", "17", "@", "@", "static", "void", "__init", "setup_xstate_init", "(", "void", ")", "xsave_state", "(", "init_xstate_buf", ",", "-", "1", ")", ";", "}", "static", "int", "disable_eagerfpu", ";", "static", "int", "__init", "eager_fpu_setup", "(", "char", "*", "s", ")", "{", "if", "(", "!", "strcmp", "(", "s", ",", "\"", "on", "\"", "))", "setup_force_cpu_cap", "(", "X86_FEATURE_EAGER_FPU", ")", ";", "else", "if", "(", "!", "strcmp", "(", "s", ",", "\"", "off", "\"", "))", "disable_eagerfpu", "=", "1", ";", "return", "1", ";", "}", "__setup", "(", "\"", "eagerfpu", "=", "\",", "eager_fpu_setup", ")", ";", "/", "*", "*", "Enable", "and", "initialize", "the", "xsave", "feature", ".", "*", "/", "@", "@", "-", "559", ",", "15", "+", "555", ",", "10", "@", "@", "static", "void", "__init", "xstate_enable_boot_cpu", "(", "void", ")", "update_regset_xstate_info", "(", "xstate_size", ",", "pcntxt_mask", ")", ";", "prepare_fx_sw_frame", "(", ");", "setup_xstate_init", "(", ");", "setup_init_fpu_buf", "(", ");", "pr_info", "(", "\"", "enabled", "xstate_bv", "0x", "%", "llx", ",", "cntxt", "size", "0x", "%", "x", "\\", "n", "\"", ",", "pcntxt_mask", ",", "xstate_size", ")", ";", "current", "-", ">", "thread", ".", "fpu", ".", "state", "=", "alloc_bootmem_align", "(", "xstate_size", ",", "__alignof__", "(", "struct", "xsave_struct", ")", ");", "init_restore_xstate", "(", ");", "}", "/", "*", "@", "@", "-", "586", ",", "6", "+", "577", ",", "42", "@", "@", "void", "__cpuinit", "xsave_init", "(", "void", ")", "return", ";", "this_func", "=", "next_func", ";", "next_func", "=", "xstate_enable_ap", ";", "next_func", "=", "xstate_enable", ";", "this_func", "(", ");", "}", "static", "inline", "void", "__init", "eager_fpu_init_bp", "(", "void", ")", "{", "current", "-", ">", "thread", ".", "fpu", ".", "state", "=", "alloc_bootmem_align", "(", "xstate_size", ",", "__alignof__", "(", "struct", "xsave_struct", ")", ");", "if", "(", "!", "init_xstate_buf", ")", "setup_init_fpu_buf", "(", ");", "}", "void", "__cpuinit", "eager_fpu_init", "(", "void", ")", "{", "static", "__refdata", "void", "(", "*", "boot_func", ")", "(", "void", ")", "=", "eager_fpu_init_bp", ";", "clear_used_math", "(", ");", "current_thread_info", "(", ")-", ">", "status", "=", "0", ";", "if", "(", "!", "cpu_has_eager_fpu", ")", "{", "stts", "(", ");", "return", ";", "}", "if", "(", "boot_func", ")", "{", "boot_func", "(", ");", "boot_func", "=", "NULL", ";", "}", "/", "*", "*", "This", "is", "same", "as", "math_state_restore", "(", ").", "But", "use_xsave", "(", ")", "is", "*", "not", "yet", "patched", "to", "use", "math_state_restore", "(", ").", "*", "/", "init_fpu", "(", "current", ")", ";", "__thread_fpu_begin", "(", "current", ")", ";", "if", "(", "cpu_has_xsave", ")", "xrstor_state", "(", "init_xstate_buf", ",", "-", "1", ")", ";", "else", "fxrstor_checking", "(", "&", "init_xstate_buf", "-", ">", "i387", ")", ";", "}"], "docstring_tokens": ["be", "leaked", "across", "process", "or", "virtual", "machine", "boundaries"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "25", ",", "10", "+", "25", ",", "11", "@", "@", "import", "java", ".", "net", ".", "ServerSocket", ";", "import", "java", ".", "net", ".", "Socket", ";", "import", "java", ".", "net", ".", "UnknownHostException", ";", "import", "java", ".", "rmi", ".", "AccessException", ";", "import", "java", ".", "rmi", ".", "AlreadyBoundException", ";", "import", "java", ".", "rmi", ".", "NotBoundException", ";", "import", "java", ".", "rmi", ".", "Remote", ";", "import", "java", ".", "rmi", ".", "RemoteException", ";", "import", "java", ".", "rmi", ".", "registry", ".", "LocateRegistry", ";", "import", "java", ".", "rmi", ".", "registry", ".", "Registry", ";", "import", "java", ".", "rmi", ".", "server", ".", "RMIClientSocketFactory", ";", "import", "java", ".", "rmi", ".", "server", ".", "RMIServerSocketFactory", ";", "import", "java", ".", "security", ".", "NoSuchAlgorithmException", ";", "@", "@", "-", "300", ",", "18", "+", "301", ",", "6", "@", "@", "private", "JMXConnectorServer", "createServer", "(", "String", "serverName", ",", "RMIClientSocketFactory", "registryCsf", ",", "RMIServerSocketFactory", "registrySsf", ",", "RMIClientSocketFactory", "serverCsf", ",", "RMIServerSocketFactory", "serverSsf", ")", "{", "/", "/", "Create", "the", "RMI", "registry", "Registry", "registry", ";", "try", "{", "registry", "=", "LocateRegistry", ".", "createRegistry", "(", "theRmiRegistryPort", ",", "registryCsf", ",", "registrySsf", ")", ";", "}", "catch", "(", "RemoteException", "e", ")", "{", "log", ".", "error", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "createRegistryFailed", "\"", ",", "serverName", ",", "Integer", ".", "toString", "(", "theRmiRegistryPort", ")", "),", "e", ")", ";", "return", "null", ";", "}", "if", "(", "bindAddress", "=", "=", "null", ")", "{", "bindAddress", "=", "\"", "localhost", "\"", ";", "}", "@", "@", "-", "332", ",", "11", "+", "321", ",", "20", "@", "@", "private", "JMXConnectorServer", "createServer", "(", "String", "serverName", ",", "cs", "=", "new", "RMIConnectorServer", "(", "serviceUrl", ",", "theEnv", ",", "server", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", "))", ";", "cs", ".", "start", "(", ");", "registry", ".", "bind", "(", "\"", "jmxrmi", "\"", ",", "server", ".", "toStub", "(", "))", ";", "Remote", "jmxServer", "=", "server", ".", "toStub", "(", ");", "/", "/", "Create", "the", "RMI", "registry", "try", "{", "new", "JmxRegistry", "(", "theRmiRegistryPort", ",", "registryCsf", ",", "registrySsf", ",", "\"", "jmxrmi", "\"", ",", "jmxServer", ")", ";", "}", "catch", "(", "RemoteException", "e", ")", "{", "log", ".", "error", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "createRegistryFailed", "\"", ",", "serverName", ",", "Integer", ".", "toString", "(", "theRmiRegistryPort", ")", "),", "e", ")", ";", "return", "null", ";", "}", "log", ".", "info", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "start", "\"", ",", "Integer", ".", "toString", "(", "theRmiRegistryPort", ")", ",", "Integer", ".", "toString", "(", "theRmiServerPort", ")", ",", "serverName", ")", ");", "}", "catch", "(", "IOException", "|", "AlreadyBoundException", "e", ")", "{", "}", "catch", "(", "IOException", "e", ")", "{", "log", ".", "error", "(", "sm", ".", "getString", "(", "\"", "jmxRemoteLifecycleListener", ".", "createServerFailed", "\"", ",", "serverName", ")", ",", "e", ")", ";", "@", "@", "-", "492", ",", "4", "+", "490", ",", "39", "@", "@", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "return", "true", ";", "}", "}", "private", "static", "class", "JmxRegistry", "extends", "sun", ".", "rmi", ".", "registry", ".", "RegistryImpl", "{", "private", "static", "final", "long", "serialVersionUID", "=", "-", "3772054804656428217L", ";", "private", "final", "String", "jmxName", ";", "private", "final", "Remote", "jmxServer", ";", "public", "JmxRegistry", "(", "int", "port", ",", "RMIClientSocketFactory", "csf", ",", "RMIServerSocketFactory", "ssf", ",", "String", "jmxName", ",", "Remote", "jmxServer", ")", "throws", "RemoteException", "{", "super", "(", "port", ",", "csf", ",", "ssf", ")", ";", "this", ".", "jmxName", "=", "jmxName", ";", "this", ".", "jmxServer", "=", "jmxServer", ";", "}", "@", "Override", "public", "Remote", "lookup", "(", "String", "name", ")", "throws", "RemoteException", ",", "NotBoundException", "{", "return", "(", "jmxName", ".", "equals", "(", "name", ")", ")", "?", "jmxServer", ":", "null", ";", "}", "@", "Override", "public", "void", "bind", "(", "String", "name", ",", "Remote", "obj", ")", "throws", "RemoteException", ",", "AlreadyBoundException", ",", "AccessException", "{", "}", "@", "Override", "public", "void", "unbind", "(", "String", "name", ")", "throws", "RemoteException", ",", "NotBoundException", ",", "AccessException", "{", "}", "@", "Override", "public", "void", "rebind", "(", "String", "name", ",", "Remote", "obj", ")", "throws", "RemoteException", ",", "AccessException", "{", "}", "@", "Override", "public", "String", "[", "]", "list", "(", ")", "throws", "RemoteException", "{", "return", "new", "String", "[", "]", "{", "jmxName", "}", ";", "}", "}", "}", "@", "@", "-", "85", ",", "6", "+", "85", ",", "9", "@", "@", "the", "final", "release", ".", "Note", "that", "this", "preview", "API", "has", "deprecated", "for", "over", "a", "year", "and", "may", "be", "removed", "as", "soon", "as", "the", "next", "8", ".", "5", ".", "x", "release", ".", "(", "markt", ")", "<", "/", "fix", ">", "<", "fix", ">", "Refactor", "JMX", "remote", "RMI", "registry", "creation", ".", "(", "remm", ")", "<", "/", "fix", ">", "<", "/", "changelog", ">", "<", "/", "subsection", ">", "<", "subsection", "name", "=", "\"", "Coyote", "\"", ">"], "docstring_tokens": ["gain", "elevated", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "26", ",", "6", "+", "26", ",", "10", "@", "@", "public", "class", "LongBitFormat", "implements", "Serializable", "{", "private", "static", "final", "long", "serialVersionUID", "=", "1L", ";", "public", "interface", "Enum", "{", "int", "getLength", "(", ");", "}", "private", "final", "String", "NAME", ";", "/", "**", "Bit", "offset", "*", "/", "private", "final", "int", "OFFSET", ";", "@", "@", "-", "69", ",", "4", "+", "73", ",", "8", "@", "@", "public", "long", "combine", "(", "long", "value", ",", "long", "record", ")", "{", "public", "long", "getMin", "(", ")", "{", "return", "MIN", ";", "}", "public", "int", "getLength", "(", ")", "{", "return", "LENGTH", ";", "}", "}", "@", "@", "-", "794", ",", "6", "+", "794", ",", "12", "@", "@", "public", "static", "final", "long", "DFS_IMAGE_TRANSFER_BOOTSTRAP_STANDBY_RATE_DEFAULT", "=", "0", ";", "/", "/", "no", "throttling", "/", "/", "String", "table", "in", "the", "fsimage", "utilizes", "an", "expanded", "bit", "range", ".", "public", "static", "final", "String", "DFS_IMAGE_EXPANDED_STRING_TABLES_KEY", "=", "\"", "dfs", ".", "image", ".", "string", "-", "tables", ".", "expanded", "\"", ";", "public", "static", "final", "boolean", "DFS_IMAGE_EXPANDED_STRING_TABLES_DEFAULT", "=", "false", ";", "/", "/", "Image", "transfer", "timeout", "public", "static", "final", "String", "DFS_IMAGE_TRANSFER_TIMEOUT_KEY", "=", "\"", "dfs", ".", "image", ".", "transfer", ".", "timeout", "\"", ";", "public", "static", "final", "int", "DFS_IMAGE_TRANSFER_TIMEOUT_DEFAULT", "=", "60", "*", "1000", ";", "@", "@", "-", "31", ",", "25", "+", "31", ",", "23", "@", "@", "/", "**", "*", "Class", "to", "pack", "an", "AclEntry", "into", "an", "integer", ".", "<", "br", ">", "*", "An", "ACL", "entry", "is", "represented", "by", "a", "32", "-", "bit", "integer", "in", "Big", "Endian", "format", ".", "<", "br", ">", "*", "The", "bits", "can", "be", "divided", "in", "four", "segments", ":", "<", "br", ">", "*", "[", "0", ":", "1", ")", "|", "|", "[", "1", ":", "3", ")", "|", "|", "[", "3", ":", "6", ")", "|", "|", "[", "6", ":", "7", ")", "|", "|", "[", "7", ":", "32", ")", "<", "br", ">", "*", "<", "br", ">", "*", "[", "0", ":", "1", ")", "-", "-", "the", "scope", "of", "the", "entry", "(", "AclEntryScope", ")", "<", "br", ">", "*", "[", "1", ":", "3", ")", "-", "-", "the", "type", "of", "the", "entry", "(", "AclEntryType", ")", "<", "br", ">", "*", "[", "3", ":", "6", ")", "-", "-", "the", "permission", "of", "the", "entry", "(", "FsAction", ")", "<", "br", ">", "*", "[", "6", ":", "7", ")", "-", "-", "A", "flag", "to", "indicate", "whether", "Named", "entry", "or", "not", "<", "br", ">", "*", "[", "7", ":", "8", ")", "-", "-", "Reserved", "<", "br", ">", "*", "[", "8", ":", "32", ")", "-", "-", "the", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "<", "br", ">", "*", "string", "in", "the", "StringTableSection", ".", "<", "br", ">", "*", "*", "Note", ":", "this", "format", "is", "used", "both", "in", "-", "memory", "and", "on", "-", "disk", ".", "Changes", "will", "be", "*", "incompatible", ".", "*", "*", "/", "public", "enum", "AclEntryStatusFormat", "{", "public", "enum", "AclEntryStatusFormat", "implements", "LongBitFormat", ".", "Enum", "{", "PERMISSION", "(", "null", ",", "3", ")", ",", "TYPE", "(", "PERMISSION", ".", "BITS", ",", "2", ")", ",", "SCOPE", "(", "TYPE", ".", "BITS", ",", "1", ")", ",", "NAME", "(", "SCOPE", ".", "BITS", ",", "24", ")", ";", "SCOPE", "(", "null", ",", "1", ")", ",", "TYPE", "(", "SCOPE", ".", "BITS", ",", "2", ")", ",", "PERMISSION", "(", "TYPE", ".", "BITS", ",", "3", ")", ",", "NAMED_ENTRY_CHECK", "(", "PERMISSION", ".", "BITS", ",", "1", ")", ",", "RESERVED", "(", "NAMED_ENTRY_CHECK", ".", "BITS", ",", "1", ")", ",", "NAME", "(", "RESERVED", ".", "BITS", ",", "24", ")", ";", "private", "static", "final", "FsAction", "[", "]", "FSACTION_VALUES", "=", "FsAction", ".", "values", "(", ");", "private", "static", "final", "AclEntryScope", "[", "]", "ACL_ENTRY_SCOPE_VALUES", "=", "AclEntryScope", ".", "values", "(", ");", "private", "static", "final", "AclEntryType", "[", "]", "ACL_ENTRY_TYPE_VALUES", "=", "AclEntryType", ".", "values", "(", ");", "private", "final", "LongBitFormat", "BITS", ";", "@", "@", "-", "59", ",", "30", "+", "57", ",", "29", "@", "@", "private", "AclEntryStatusFormat", "(", "LongBitFormat", "previous", ",", "int", "length", ")", "{", "static", "AclEntryScope", "getScope", "(", "int", "aclEntry", ")", "{", "int", "ordinal", "=", "(", "int", ")", "SCOPE", ".", "BITS", ".", "retrieve", "(", "aclEntry", ")", ";", "return", "AclEntryScope", ".", "values", "(", ")[", "ordinal", "]", ";", "return", "ACL_ENTRY_SCOPE_VALUES", "[", "ordinal", "]", ";", "}", "static", "AclEntryType", "getType", "(", "int", "aclEntry", ")", "{", "int", "ordinal", "=", "(", "int", ")", "TYPE", ".", "BITS", ".", "retrieve", "(", "aclEntry", ")", ";", "return", "AclEntryType", ".", "values", "(", ")[", "ordinal", "]", ";", "return", "ACL_ENTRY_TYPE_VALUES", "[", "ordinal", "]", ";", "}", "static", "FsAction", "getPermission", "(", "int", "aclEntry", ")", "{", "int", "ordinal", "=", "(", "int", ")", "PERMISSION", ".", "BITS", ".", "retrieve", "(", "aclEntry", ")", ";", "return", "FsAction", ".", "values", "(", ")[", "ordinal", "]", ";", "return", "FSACTION_VALUES", "[", "ordinal", "]", ";", "}", "static", "String", "getName", "(", "int", "aclEntry", ")", "{", "int", "nameExists", "=", "(", "int", ")", "NAMED_ENTRY_CHECK", ".", "BITS", ".", "retrieve", "(", "aclEntry", ")", ";", "if", "(", "nameExists", "=", "=", "0", ")", "{", "return", "null", ";", "}", "int", "id", "=", "(", "int", ")", "NAME", ".", "BITS", ".", "retrieve", "(", "aclEntry", ")", ";", "AclEntryType", "type", "=", "getType", "(", "aclEntry", ")", ";", "if", "(", "type", "=", "=", "AclEntryType", ".", "USER", ")", "{", "return", "SerialNumberManager", ".", "INSTANCE", ".", "getUser", "(", "id", ")", ";", "}", "else", "if", "(", "type", "=", "=", "AclEntryType", ".", "GROUP", ")", "{", "return", "SerialNumberManager", ".", "INSTANCE", ".", "getGroup", "(", "id", ")", ";", "return", "getName", "(", "aclEntry", ",", "null", ")", ";", "}", "static", "String", "getName", "(", "int", "aclEntry", ",", "SerialNumberManager", ".", "StringTable", "stringTable", ")", "{", "SerialNumberManager", "snm", "=", "getSerialNumberManager", "(", "getType", "(", "aclEntry", ")", ");", "if", "(", "snm", "!", "=", "null", ")", "{", "int", "nid", "=", "(", "int", ")", "NAME", ".", "BITS", ".", "retrieve", "(", "aclEntry", ")", ";", "return", "snm", ".", "getString", "(", "nid", ",", "stringTable", ")", ";", "}", "return", "null", ";", "}", "@", "@", "-", "94", ",", "29", "+", "91", ",", "26", "@", "@", "static", "int", "toInt", "(", "AclEntry", "aclEntry", ")", "{", "aclEntryInt", "=", "TYPE", ".", "BITS", ".", "combine", "(", "aclEntry", ".", "getType", "(", ").", "ordinal", "(", "),", "aclEntryInt", ")", ";", "aclEntryInt", "=", "PERMISSION", ".", "BITS", ".", "combine", "(", "aclEntry", ".", "getPermission", "(", ").", "ordinal", "(", "),", "aclEntryInt", ")", ";", "if", "(", "aclEntry", ".", "getName", "(", ")", "!", "=", "null", ")", "{", "aclEntryInt", "=", "NAMED_ENTRY_CHECK", ".", "BITS", ".", "combine", "(", "1", ",", "aclEntryInt", ")", ";", "if", "(", "aclEntry", ".", "getType", "(", ")", "=", "=", "AclEntryType", ".", "USER", ")", "{", "int", "userId", "=", "SerialNumberManager", ".", "INSTANCE", ".", "getUserSerialNumber", "(", "aclEntry", ".", "getName", "(", "))", ";", "aclEntryInt", "=", "NAME", ".", "BITS", ".", "combine", "(", "userId", ",", "aclEntryInt", ")", ";", "}", "else", "if", "(", "aclEntry", ".", "getType", "(", ")", "=", "=", "AclEntryType", ".", "GROUP", ")", "{", "int", "groupId", "=", "SerialNumberManager", ".", "INSTANCE", ".", "getGroupSerialNumber", "(", "aclEntry", ".", "getName", "(", "))", ";", "aclEntryInt", "=", "NAME", ".", "BITS", ".", "combine", "(", "groupId", ",", "aclEntryInt", ")", ";", "}", "SerialNumberManager", "snm", "=", "getSerialNumberManager", "(", "aclEntry", ".", "getType", "(", "))", ";", "if", "(", "snm", "!", "=", "null", ")", "{", "int", "nid", "=", "snm", ".", "getSerialNumber", "(", "aclEntry", ".", "getName", "(", "))", ";", "aclEntryInt", "=", "NAME", ".", "BITS", ".", "combine", "(", "nid", ",", "aclEntryInt", ")", ";", "}", "return", "(", "int", ")", "aclEntryInt", ";", "}", "static", "AclEntry", "toAclEntry", "(", "int", "aclEntry", ")", "{", "AclEntry", ".", "Builder", "builder", "=", "new", "AclEntry", ".", "Builder", "(", ");", "builder", ".", "setScope", "(", "getScope", "(", "aclEntry", ")", ").", "setType", "(", "getType", "(", "aclEntry", ")", ")", ".", "setPermission", "(", "getPermission", "(", "aclEntry", ")", ");", "if", "(", "getName", "(", "aclEntry", ")", "!", "=", "null", ")", "{", "builder", ".", "setName", "(", "getName", "(", "aclEntry", ")", ");", "}", "return", "builder", ".", "build", "(", ");", "return", "toAclEntry", "(", "aclEntry", ",", "null", ")", ";", "}", "static", "AclEntry", "toAclEntry", "(", "int", "aclEntry", ",", "SerialNumberManager", ".", "StringTable", "stringTable", ")", "{", "return", "new", "AclEntry", ".", "Builder", "(", ")", ".", "setScope", "(", "getScope", "(", "aclEntry", ")", ")", ".", "setType", "(", "getType", "(", "aclEntry", ")", ")", ".", "setPermission", "(", "getPermission", "(", "aclEntry", ")", ")", ".", "setName", "(", "getName", "(", "aclEntry", ",", "stringTable", ")", ")", ".", "build", "(", ");", "}", "public", "static", "int", "[", "]", "toInt", "(", "List", "<", "AclEntry", ">", "aclEntries", ")", "{", "@", "@", "-", "127", ",", "12", "+", "121", ",", "19", "@", "@", "static", "AclEntry", "toAclEntry", "(", "int", "aclEntry", ")", "{", "return", "entries", ";", "}", "public", "static", "ImmutableList", "<", "AclEntry", ">", "toAclEntries", "(", "int", "[", "]", "entries", ")", "{", "ImmutableList", ".", "Builder", "<", "AclEntry", ">", "b", "=", "new", "ImmutableList", ".", "Builder", "<", "AclEntry", ">", "()", ";", "for", "(", "int", "entry", ":", "entries", ")", "{", "AclEntry", "aclEntry", "=", "toAclEntry", "(", "entry", ")", ";", "b", ".", "add", "(", "aclEntry", ")", ";", "private", "static", "SerialNumberManager", "getSerialNumberManager", "(", "AclEntryType", "type", ")", "{", "switch", "(", "type", ")", "{", "case", "USER", ":", "return", "SerialNumberManager", ".", "USER", ";", "case", "GROUP", ":", "return", "SerialNumberManager", ".", "GROUP", ";", "default", ":", "return", "null", ";", "}", "return", "b", ".", "build", "(", ");", "}", "@", "Override", "public", "int", "getLength", "(", ")", "{", "return", "BITS", ".", "getLength", "(", ");", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "265", ",", "6", "+", "265", ",", "8", "@", "@", "public", "int", "getWriteHoldCount", "(", ")", "{", "}", ";", "FSDirectory", "(", "FSNamesystem", "ns", ",", "Configuration", "conf", ")", "throws", "IOException", "{", "/", "/", "used", "to", "enable", "/", "disable", "the", "use", "of", "expanded", "string", "tables", ".", "SerialNumberManager", ".", "initialize", "(", "conf", ")", ";", "this", ".", "dirLock", "=", "new", "ReentrantReadWriteLock", "(", "true", ")", ";", "/", "/", "fair", "this", ".", "inodeId", "=", "new", "INodeId", "(", ");", "rootDir", "=", "createRoot", "(", "ns", ")", ";", "@", "@", "-", "31", ",", "10", "+", "31", ",", "6", "@", "@", "import", "org", ".", "apache", ".", "hadoop", ".", "HadoopIllegalArgumentException", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "classification", ".", "InterfaceAudience", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "fs", ".", "permission", ".", "AclEntry", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "fs", ".", "permission", ".", "AclEntryScope", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "fs", ".", "permission", ".", "AclEntryType", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "fs", ".", "permission", ".", "FsAction", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "fs", ".", "permission", ".", "FsPermission", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "fs", ".", "permission", ".", "PermissionStatus", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "fs", ".", "StorageType", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "fs", ".", "XAttr", ";", "@", "@", "-", "60", ",", "6", "+", "56", ",", "8", "@", "@", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "INodeSection", ".", "XAttrFeatureProto", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "INodeSection", ".", "QuotaByStorageTypeEntryProto", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "INodeSection", ".", "QuotaByStorageTypeFeatureProto", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "INodeWithAdditionalFields", ".", "PermissionStatusFormat", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "SerialNumberManager", ".", "StringTable", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "snapshot", ".", "Snapshot", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "startupprogress", ".", "Phase", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "startupprogress", ".", "StartupProgress", ";", "@", "@", "-", "74", ",", "22", "+", "72", ",", "11", "@", "@", "@", "InterfaceAudience", ".", "Private", "public", "final", "class", "FSImageFormatPBINode", "{", "private", "final", "static", "long", "USER_GROUP_STRID_MASK", "=", "(", "1", "<", "<", "24", ")", "-", "1", ";", "private", "final", "static", "int", "USER_STRID_OFFSET", "=", "40", ";", "private", "final", "static", "int", "GROUP_STRID_OFFSET", "=", "16", ";", "public", "static", "final", "int", "ACL_ENTRY_NAME_MASK", "=", "(", "1", "<", "<", "24", ")", "-", "1", ";", "public", "static", "final", "int", "ACL_ENTRY_NAME_OFFSET", "=", "6", ";", "public", "static", "final", "int", "ACL_ENTRY_TYPE_OFFSET", "=", "3", ";", "public", "static", "final", "int", "ACL_ENTRY_SCOPE_OFFSET", "=", "5", ";", "public", "static", "final", "int", "ACL_ENTRY_PERM_MASK", "=", "7", ";", "private", "static", "final", "int", "ACL_ENTRY_TYPE_MASK", "=", "3", ";", "private", "static", "final", "int", "ACL_ENTRY_SCOPE_MASK", "=", "1", ";", "private", "static", "final", "FsAction", "[", "]", "FSACTION_VALUES", "=", "FsAction", ".", "values", "(", ");", "private", "static", "final", "AclEntryScope", "[", "]", "ACL_ENTRY_SCOPE_VALUES", "=", "AclEntryScope", ".", "values", "(", ");", "private", "static", "final", "AclEntryType", "[", "]", "ACL_ENTRY_TYPE_VALUES", "=", "AclEntryType", ".", "values", "(", ");", "public", "static", "final", "int", "XATTR_NAMESPACE_MASK", "=", "3", ";", "public", "static", "final", "int", "XATTR_NAMESPACE_OFFSET", "=", "30", ";", "@", "@", "-", "100", ",", "55", "+", "87", ",", "35", "@", "@", "public", "static", "final", "int", "XATTR_NAMESPACE_EXT_OFFSET", "=", "5", ";", "public", "static", "final", "int", "XATTR_NAMESPACE_EXT_MASK", "=", "1", ";", "private", "static", "final", "XAttr", ".", "NameSpace", "[", "]", "XATTR_NAMESPACE_VALUES", "=", "XAttr", ".", "NameSpace", ".", "values", "(", ");", "private", "static", "final", "Log", "LOG", "=", "LogFactory", ".", "getLog", "(", "FSImageFormatPBINode", ".", "class", ")", ";", "/", "/", "the", "loader", "must", "decode", "all", "fields", "referencing", "serial", "number", "based", "fields", "/", "/", "via", "to", "<", "Item", ">", "methods", "with", "the", "string", "table", ".", "public", "final", "static", "class", "Loader", "{", "public", "static", "PermissionStatus", "loadPermission", "(", "long", "id", ",", "final", "String", "[", "]", "stringTable", ")", "{", "short", "perm", "=", "(", "short", ")", "(", "id", "&", "(", "(", "1", "<", "<", "GROUP_STRID_OFFSET", ")", "-", "1", ")", ");", "int", "gsid", "=", "(", "int", ")", "(", "(", "id", ">", ">", "GROUP_STRID_OFFSET", ")", "&", "USER_GROUP_STRID_MASK", ")", ";", "int", "usid", "=", "(", "int", ")", "(", "(", "id", ">", ">", "USER_STRID_OFFSET", ")", "&", "USER_GROUP_STRID_MASK", ")", ";", "return", "new", "PermissionStatus", "(", "stringTable", "[", "usid", "]", ",", "stringTable", "[", "gsid", "]", ",", "new", "FsPermission", "(", "perm", ")", ");", "final", "StringTable", "stringTable", ")", "{", "return", "PermissionStatusFormat", ".", "toPermissionStatus", "(", "id", ",", "stringTable", ")", ";", "}", "public", "static", "ImmutableList", "<", "AclEntry", ">", "loadAclEntries", "(", "AclFeatureProto", "proto", ",", "final", "String", "[", "]", "stringTable", ")", "{", "AclFeatureProto", "proto", ",", "final", "StringTable", "stringTable", ")", "{", "ImmutableList", ".", "Builder", "<", "AclEntry", ">", "b", "=", "ImmutableList", ".", "builder", "(", ");", "for", "(", "int", "v", ":", "proto", ".", "getEntriesList", "(", "))", "{", "int", "p", "=", "v", "&", "ACL_ENTRY_PERM_MASK", ";", "int", "t", "=", "(", "v", ">", ">", "ACL_ENTRY_TYPE_OFFSET", ")", "&", "ACL_ENTRY_TYPE_MASK", ";", "int", "s", "=", "(", "v", ">", ">", "ACL_ENTRY_SCOPE_OFFSET", ")", "&", "ACL_ENTRY_SCOPE_MASK", ";", "int", "nid", "=", "(", "v", ">", ">", "ACL_ENTRY_NAME_OFFSET", ")", "&", "ACL_ENTRY_NAME_MASK", ";", "String", "name", "=", "stringTable", "[", "nid", "]", ";", "b", ".", "add", "(", "new", "AclEntry", ".", "Builder", "(", ").", "setName", "(", "name", ")", ".", "setPermission", "(", "FSACTION_VALUES", "[", "p", "]", ")", ".", "setScope", "(", "ACL_ENTRY_SCOPE_VALUES", "[", "s", "]", ")", ".", "setType", "(", "ACL_ENTRY_TYPE_VALUES", "[", "t", "]", ").", "build", "(", "))", ";", "b", ".", "add", "(", "AclEntryStatusFormat", ".", "toAclEntry", "(", "v", ",", "stringTable", ")", ");", "}", "return", "b", ".", "build", "(", ");", "}", "public", "static", "List", "<", "XAttr", ">", "loadXAttrs", "(", "XAttrFeatureProto", "proto", ",", "final", "String", "[", "]", "stringTable", ")", "{", "XAttrFeatureProto", "proto", ",", "final", "StringTable", "stringTable", ")", "{", "List", "<", "XAttr", ">", "b", "=", "new", "ArrayList", "<", ">(", ");", "for", "(", "XAttrCompactProto", "xAttrCompactProto", ":", "proto", ".", "getXAttrsList", "(", "))", "{", "int", "v", "=", "xAttrCompactProto", ".", "getName", "(", ");", "int", "nid", "=", "(", "v", ">", ">", "XATTR_NAME_OFFSET", ")", "&", "XATTR_NAME_MASK", ";", "int", "ns", "=", "(", "v", ">", ">", "XATTR_NAMESPACE_OFFSET", ")", "&", "XATTR_NAMESPACE_MASK", ";", "ns", "|", "=", "(", "(", "v", ">", ">", "XATTR_NAMESPACE_EXT_OFFSET", ")", "&", "XATTR_NAMESPACE_EXT_MASK", ")", "<", "<", "2", ";", "String", "name", "=", "stringTable", "[", "nid", "]", ";", "byte", "[", "]", "value", "=", "null", ";", "if", "(", "xAttrCompactProto", ".", "getValue", "(", ")", "!", "=", "null", ")", "{", "value", "=", "xAttrCompactProto", ".", "getValue", "(", ").", "toByteArray", "(", ");", "}", "b", ".", "add", "(", "new", "XAttr", ".", "Builder", "(", ").", "setNameSpace", "(", "XATTR_NAMESPACE_VALUES", "[", "ns", "]", ")", ".", "setName", "(", "name", ")", ".", "setValue", "(", "value", ")", ".", "build", "(", "))", ";", "b", ".", "add", "(", "XAttrFormat", ".", "toXAttr", "(", "v", ",", "value", ",", "stringTable", ")", ");", "}", "return", "b", ";", "@", "@", "-", "438", ",", "46", "+", "405", ",", "30", "@", "@", "private", "void", "loadRootINode", "(", "INodeSection", ".", "INode", "p", ")", "{", "}", "}", "/", "/", "the", "saver", "can", "directly", "write", "out", "fields", "referencing", "serial", "numbers", ".", "/", "/", "the", "serial", "number", "maps", "will", "be", "compacted", "when", "loading", ".", "public", "final", "static", "class", "Saver", "{", "private", "long", "numImageErrors", ";", "private", "static", "long", "buildPermissionStatus", "(", "INodeAttributes", "n", ",", "final", "SaverContext", ".", "DeduplicationMap", "<", "String", ">", "stringMap", ")", "{", "long", "userId", "=", "stringMap", ".", "getId", "(", "n", ".", "getUserName", "(", "))", ";", "long", "groupId", "=", "stringMap", ".", "getId", "(", "n", ".", "getGroupName", "(", "))", ";", "return", "(", "(", "userId", "&", "USER_GROUP_STRID_MASK", ")", "<", "<", "USER_STRID_OFFSET", ")", "|", "(", "(", "groupId", "&", "USER_GROUP_STRID_MASK", ")", "<", "<", "GROUP_STRID_OFFSET", ")", "|", "n", ".", "getFsPermissionShort", "(", ");", "private", "static", "long", "buildPermissionStatus", "(", "INodeAttributes", "n", ")", "{", "return", "n", ".", "getPermissionLong", "(", ");", "}", "private", "static", "AclFeatureProto", ".", "Builder", "buildAclEntries", "(", "AclFeature", "f", ",", "final", "SaverContext", ".", "DeduplicationMap", "<", "String", ">", "map", ")", "{", "private", "static", "AclFeatureProto", ".", "Builder", "buildAclEntries", "(", "AclFeature", "f", ")", "{", "AclFeatureProto", ".", "Builder", "b", "=", "AclFeatureProto", ".", "newBuilder", "(", ");", "for", "(", "int", "pos", "=", "0", ",", "e", ";", "pos", "<", "f", ".", "getEntriesSize", "(", ");", "pos", "+", "+)", "{", "e", "=", "f", ".", "getEntryAt", "(", "pos", ")", ";", "int", "nameId", "=", "map", ".", "getId", "(", "AclEntryStatusFormat", ".", "getName", "(", "e", ")", ");", "int", "v", "=", "(", "(", "nameId", "&", "ACL_ENTRY_NAME_MASK", ")", "<", "<", "ACL_ENTRY_NAME_OFFSET", ")", "|", "(", "AclEntryStatusFormat", ".", "getType", "(", "e", ")", ".", "ordinal", "(", ")", "<", "<", "ACL_ENTRY_TYPE_OFFSET", ")", "|", "(", "AclEntryStatusFormat", ".", "getScope", "(", "e", ")", ".", "ordinal", "(", ")", "<", "<", "ACL_ENTRY_SCOPE_OFFSET", ")", "|", "(", "AclEntryStatusFormat", ".", "getPermission", "(", "e", ")", ".", "ordinal", "(", "))", ";", "b", ".", "addEntries", "(", "v", ")", ";", "b", ".", "addEntries", "(", "e", ")", ";", "}", "return", "b", ";", "}", "private", "static", "XAttrFeatureProto", ".", "Builder", "buildXAttrs", "(", "XAttrFeature", "f", ",", "final", "SaverContext", ".", "DeduplicationMap", "<", "String", ">", "stringMap", ")", "{", "private", "static", "XAttrFeatureProto", ".", "Builder", "buildXAttrs", "(", "XAttrFeature", "f", ")", "{", "XAttrFeatureProto", ".", "Builder", "b", "=", "XAttrFeatureProto", ".", "newBuilder", "(", ");", "for", "(", "XAttr", "a", ":", "f", ".", "getXAttrs", "(", "))", "{", "XAttrCompactProto", ".", "Builder", "xAttrCompactBuilder", "=", "XAttrCompactProto", ".", "newBuilder", "(", ");", "int", "nsOrd", "=", "a", ".", "getNameSpace", "(", ").", "ordinal", "(", ");", "Preconditions", ".", "checkArgument", "(", "nsOrd", "<", "8", ",", "\"", "Too", "many", "namespaces", ".", "\")", ";", "int", "v", "=", "(", "(", "nsOrd", "&", "XATTR_NAMESPACE_MASK", ")", "<", "<", "XATTR_NAMESPACE_OFFSET", ")", "|", "(", "(", "stringMap", ".", "getId", "(", "a", ".", "getName", "(", "))", "&", "XATTR_NAME_MASK", ")", "<", "<", "XATTR_NAME_OFFSET", ")", ";", "v", "|", "=", "(", "((", "nsOrd", ">", ">", "2", ")", "&", "XATTR_NAMESPACE_EXT_MASK", ")", "<", "<", "XATTR_NAMESPACE_EXT_OFFSET", ")", ";", "int", "v", "=", "XAttrFormat", ".", "toInt", "(", "a", ")", ";", "xAttrCompactBuilder", ".", "setName", "(", "v", ")", ";", "if", "(", "a", ".", "getValue", "(", ")", "!", "=", "null", ")", "{", "xAttrCompactBuilder", ".", "setValue", "(", "PBHelperClient", ".", "getByteString", "(", "a", ".", "getValue", "(", "))", ");", "@", "@", "-", "509", ",", "7", "+", "460", ",", "7", "@", "@", "private", "static", "long", "buildPermissionStatus", "(", "INodeAttributes", "n", ",", "INodeSection", ".", "INodeFile", ".", "Builder", "b", "=", "INodeSection", ".", "INodeFile", ".", "newBuilder", "(", ")", ".", "setAccessTime", "(", "file", ".", "getAccessTime", "(", "))", ".", "setModificationTime", "(", "file", ".", "getModificationTime", "(", "))", ".", "setPermission", "(", "buildPermissionStatus", "(", "file", ",", "state", ".", "getStringMap", "(", "))", ")", ".", "setPermission", "(", "buildPermissionStatus", "(", "file", ")", ")", ".", "setPreferredBlockSize", "(", "file", ".", "getPreferredBlockSize", "(", "))", ".", "setStoragePolicyID", "(", "file", ".", "getLocalStoragePolicyID", "(", "))", ".", "setBlockType", "(", "PBHelperClient", ".", "convert", "(", "file", ".", "getBlockType", "(", "))", ");", "@", "@", "-", "522", ",", "11", "+", "473", ",", "11", "@", "@", "private", "static", "long", "buildPermissionStatus", "(", "INodeAttributes", "n", ",", "AclFeature", "f", "=", "file", ".", "getAclFeature", "(", ");", "if", "(", "f", "!", "=", "null", ")", "{", "b", ".", "setAcl", "(", "buildAclEntries", "(", "f", ",", "state", ".", "getStringMap", "(", "))", ");", "b", ".", "setAcl", "(", "buildAclEntries", "(", "f", ")", ");", "}", "XAttrFeature", "xAttrFeature", "=", "file", ".", "getXAttrFeature", "(", ");", "if", "(", "xAttrFeature", "!", "=", "null", ")", "{", "b", ".", "setXAttrs", "(", "buildXAttrs", "(", "xAttrFeature", ",", "state", ".", "getStringMap", "(", "))", ");", "b", ".", "setXAttrs", "(", "buildXAttrs", "(", "xAttrFeature", ")", ");", "}", "return", "b", ";", "}", "@", "@", "-", "538", ",", "19", "+", "489", ",", "19", "@", "@", "private", "static", "long", "buildPermissionStatus", "(", "INodeAttributes", "n", ",", ".", "newBuilder", "(", ").", "setModificationTime", "(", "dir", ".", "getModificationTime", "(", "))", ".", "setNsQuota", "(", "quota", ".", "getNameSpace", "(", "))", ".", "setDsQuota", "(", "quota", ".", "getStorageSpace", "(", "))", ".", "setPermission", "(", "buildPermissionStatus", "(", "dir", ",", "state", ".", "getStringMap", "(", "))", ");", ".", "setPermission", "(", "buildPermissionStatus", "(", "dir", ")", ");", "if", "(", "quota", ".", "getTypeSpaces", "(", ").", "anyGreaterOrEqual", "(", "0", ")", ")", "{", "b", ".", "setTypeQuotas", "(", "buildQuotaByStorageTypeEntries", "(", "quota", ")", ");", "}", "AclFeature", "f", "=", "dir", ".", "getAclFeature", "(", ");", "if", "(", "f", "!", "=", "null", ")", "{", "b", ".", "setAcl", "(", "buildAclEntries", "(", "f", ",", "state", ".", "getStringMap", "(", "))", ");", "b", ".", "setAcl", "(", "buildAclEntries", "(", "f", ")", ");", "}", "XAttrFeature", "xAttrFeature", "=", "dir", ".", "getXAttrFeature", "(", ");", "if", "(", "xAttrFeature", "!", "=", "null", ")", "{", "b", ".", "setXAttrs", "(", "buildXAttrs", "(", "xAttrFeature", ",", "state", ".", "getStringMap", "(", "))", ");", "b", ".", "setXAttrs", "(", "buildXAttrs", "(", "xAttrFeature", ")", ");", "}", "return", "b", ";", "}", "@", "@", "-", "711", ",", "7", "+", "662", ",", "7", "@", "@", "private", "void", "save", "(", "OutputStream", "out", ",", "INodeSymlink", "n", ")", "throws", "IOException", "{", "SaverContext", "state", "=", "parent", ".", "getSaverContext", "(", ");", "INodeSection", ".", "INodeSymlink", ".", "Builder", "b", "=", "INodeSection", ".", "INodeSymlink", ".", "newBuilder", "(", ")", ".", "setPermission", "(", "buildPermissionStatus", "(", "n", ",", "state", ".", "getStringMap", "(", "))", ")", ".", "setPermission", "(", "buildPermissionStatus", "(", "n", ")", ")", ".", "setTarget", "(", "ByteString", ".", "copyFrom", "(", "n", ".", "getSymlink", "(", "))", ")", ".", "setModificationTime", "(", "n", ".", "getModificationTime", "(", "))", ".", "setAccessTime", "(", "n", ".", "getAccessTime", "(", "))", ";", "@", "@", "-", "85", ",", "10", "+", "85", ",", "10", "@", "@", ".", "getLogger", "(", "FSImageFormatProtobuf", ".", "class", ")", ";", "public", "static", "final", "class", "LoaderContext", "{", "private", "String", "[", "]", "stringTable", ";", "private", "SerialNumberManager", ".", "StringTable", "stringTable", ";", "private", "final", "ArrayList", "<", "INodeReference", ">", "refList", "=", "Lists", ".", "newArrayList", "(", ");", "public", "String", "[", "]", "getStringTable", "(", ")", "{", "public", "SerialNumberManager", ".", "StringTable", "getStringTable", "(", ")", "{", "return", "stringTable", ";", "}", "@", "@", "-", "129", ",", "13", "+", "129", ",", "6", "@", "@", "int", "size", "(", ")", "{", "}", "private", "final", "ArrayList", "<", "INodeReference", ">", "refList", "=", "Lists", ".", "newArrayList", "(", ");", "private", "final", "DeduplicationMap", "<", "String", ">", "stringMap", "=", "DeduplicationMap", ".", "newMap", "(", ");", "public", "DeduplicationMap", "<", "String", ">", "getStringMap", "(", ")", "{", "return", "stringMap", ";", "}", "public", "ArrayList", "<", "INodeReference", ">", "getRefList", "(", ")", "{", "return", "refList", ";", "}", "@", "@", "-", "327", ",", "11", "+", "320", ",", "12", "@", "@", "private", "void", "loadNameSystemSection", "(", "InputStream", "in", ")", "throws", "IOException", "{", "private", "void", "loadStringTableSection", "(", "InputStream", "in", ")", "throws", "IOException", "{", "StringTableSection", "s", "=", "StringTableSection", ".", "parseDelimitedFrom", "(", "in", ")", ";", "ctx", ".", "stringTable", "=", "new", "String", "[", "s", ".", "getNumEntry", "(", ")", "+", "1", "]", ";", "ctx", ".", "stringTable", "=", "SerialNumberManager", ".", "newStringTable", "(", "s", ".", "getNumEntry", "(", "),", "s", ".", "getMaskBits", "(", "))", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "s", ".", "getNumEntry", "(", ");", "+", "+", "i", ")", "{", "StringTableSection", ".", "Entry", "e", "=", "StringTableSection", ".", "Entry", ".", "parseDelimitedFrom", "(", "in", ")", ";", "ctx", ".", "stringTable", "[", "e", ".", "getId", "(", ")]", "=", "e", ".", "getStr", "(", ");", "ctx", ".", "stringTable", ".", "put", "(", "e", ".", "getId", "(", "),", "e", ".", "getStr", "(", "))", ";", "}", "}", "@", "@", "-", "651", ",", "12", "+", "645", ",", "16", "@", "@", "private", "void", "saveNameSystemSection", "(", "FileSummary", ".", "Builder", "summary", ")", "private", "void", "saveStringTableSection", "(", "FileSummary", ".", "Builder", "summary", ")", "throws", "IOException", "{", "OutputStream", "out", "=", "sectionOutputStream", ";", "SerialNumberManager", ".", "StringTable", "stringTable", "=", "SerialNumberManager", ".", "getStringTable", "(", ");", "StringTableSection", ".", "Builder", "b", "=", "StringTableSection", ".", "newBuilder", "(", ")", ".", "setNumEntry", "(", "saverContext", ".", "stringMap", ".", "size", "(", "))", ";", ".", "setNumEntry", "(", "stringTable", ".", "size", "(", "))", ".", "setMaskBits", "(", "stringTable", ".", "getMaskBits", "(", "))", ";", "b", ".", "build", "(", ").", "writeDelimitedTo", "(", "out", ")", ";", "for", "(", "Entry", "<", "String", ",", "Integer", ">", "e", ":", "saverContext", ".", "stringMap", ".", "entrySet", "(", "))", "{", "for", "(", "Entry", "<", "Integer", ",", "String", ">", "e", ":", "stringTable", ")", "{", "StringTableSection", ".", "Entry", ".", "Builder", "eb", "=", "StringTableSection", ".", "Entry", ".", "newBuilder", "(", ").", "setId", "(", "e", ".", "getValue", "(", "))", ".", "setStr", "(", "e", ".", "getKey", "(", "))", ";", ".", "newBuilder", "(", ").", "setId", "(", "e", ".", "getKey", "(", "))", ".", "setStr", "(", "e", ".", "getValue", "(", "))", ";", "eb", ".", "build", "(", ").", "writeDelimitedTo", "(", "out", ")", ";", "}", "commitSection", "(", "summary", ",", "SectionName", ".", "STRING_TABLE", ")", ";", "@", "@", "-", "33", ",", "7", "+", "33", ",", "9", "@", "@", "@", "InterfaceAudience", ".", "Private", "public", "abstract", "class", "INodeWithAdditionalFields", "extends", "INode", "implements", "LinkedElement", "{", "enum", "PermissionStatusFormat", "{", "/", "/", "Note", ":", "this", "format", "is", "used", "both", "in", "-", "memory", "and", "on", "-", "disk", ".", "Changes", "will", "be", "/", "/", "incompatible", ".", "enum", "PermissionStatusFormat", "implements", "LongBitFormat", ".", "Enum", "{", "MODE", "(", "null", ",", "16", ")", ",", "GROUP", "(", "MODE", ".", "BITS", ",", "24", ")", ",", "USER", "(", "GROUP", ".", "BITS", ",", "24", ")", ";", "@", "@", "-", "46", ",", "12", "+", "48", ",", "14", "@", "@", "private", "PermissionStatusFormat", "(", "LongBitFormat", "previous", ",", "int", "length", ")", "{", "static", "String", "getUser", "(", "long", "permission", ")", "{", "final", "int", "n", "=", "(", "int", ")", "USER", ".", "BITS", ".", "retrieve", "(", "permission", ")", ";", "return", "SerialNumberManager", ".", "INSTANCE", ".", "getUser", "(", "n", ")", ";", "String", "s", "=", "SerialNumberManager", ".", "USER", ".", "getString", "(", "n", ")", ";", "assert", "s", "!", "=", "null", ";", "return", "s", ";", "}", "static", "String", "getGroup", "(", "long", "permission", ")", "{", "final", "int", "n", "=", "(", "int", ")", "GROUP", ".", "BITS", ".", "retrieve", "(", "permission", ")", ";", "return", "SerialNumberManager", ".", "INSTANCE", ".", "getGroup", "(", "n", ")", ";", "return", "SerialNumberManager", ".", "GROUP", ".", "getString", "(", "n", ")", ";", "}", "static", "short", "getMode", "(", "long", "permission", ")", "{", "@", "@", "-", "61", ",", "16", "+", "65", ",", "34", "@", "@", "static", "short", "getMode", "(", "long", "permission", ")", "{", "/", "**", "Encode", "the", "{", "@", "link", "PermissionStatus", "}", "to", "a", "long", ".", "*", "/", "static", "long", "toLong", "(", "PermissionStatus", "ps", ")", "{", "long", "permission", "=", "0L", ";", "final", "int", "user", "=", "SerialNumberManager", ".", "INSTANCE", ".", "getUserSerialNumber", "(", "final", "int", "user", "=", "SerialNumberManager", ".", "USER", ".", "getSerialNumber", "(", "ps", ".", "getUserName", "(", "))", ";", "assert", "user", "!", "=", "0", ";", "permission", "=", "USER", ".", "BITS", ".", "combine", "(", "user", ",", "permission", ")", ";", "final", "int", "group", "=", "SerialNumberManager", ".", "INSTANCE", ".", "getGroupSerialNumber", "(", "/", "/", "ideally", "should", "assert", "on", "group", "but", "inodes", "are", "created", "with", "null", "/", "/", "group", "and", "then", "updated", "only", "when", "added", "to", "a", "directory", ".", "final", "int", "group", "=", "SerialNumberManager", ".", "GROUP", ".", "getSerialNumber", "(", "ps", ".", "getGroupName", "(", "))", ";", "permission", "=", "GROUP", ".", "BITS", ".", "combine", "(", "group", ",", "permission", ")", ";", "final", "int", "mode", "=", "ps", ".", "getPermission", "(", ").", "toShort", "(", ");", "permission", "=", "MODE", ".", "BITS", ".", "combine", "(", "mode", ",", "permission", ")", ";", "return", "permission", ";", "}", "static", "PermissionStatus", "toPermissionStatus", "(", "long", "id", ",", "SerialNumberManager", ".", "StringTable", "stringTable", ")", "{", "int", "uid", "=", "(", "int", ")", "USER", ".", "BITS", ".", "retrieve", "(", "id", ")", ";", "int", "gid", "=", "(", "int", ")", "GROUP", ".", "BITS", ".", "retrieve", "(", "id", ")", ";", "return", "new", "PermissionStatus", "(", "SerialNumberManager", ".", "USER", ".", "getString", "(", "uid", ",", "stringTable", ")", ",", "SerialNumberManager", ".", "GROUP", ".", "getString", "(", "gid", ",", "stringTable", ")", ",", "new", "FsPermission", "(", "getMode", "(", "id", ")", "))", ";", "}", "@", "Override", "public", "int", "getLength", "(", ")", "{", "return", "BITS", ".", "getLength", "(", ");", "}", "}", "/", "**", "The", "inode", "id", ".", "*", "/", "@", "@", "-", "175", ",", "7", "+", "197", ",", "7", "@", "@", "final", "String", "getUserName", "(", "int", "snapshotId", ")", "{", "@", "Override", "final", "void", "setUser", "(", "String", "user", ")", "{", "int", "n", "=", "SerialNumberManager", ".", "INSTANCE", ".", "getUserSerialNumber", "(", "user", ")", ";", "int", "n", "=", "SerialNumberManager", ".", "USER", ".", "getSerialNumber", "(", "user", ")", ";", "updatePermissionStatus", "(", "PermissionStatusFormat", ".", "USER", ",", "n", ")", ";", "}", "@", "@", "-", "189", ",", "7", "+", "211", ",", "7", "@", "@", "final", "String", "getGroupName", "(", "int", "snapshotId", ")", "{", "@", "Override", "final", "void", "setGroup", "(", "String", "group", ")", "{", "int", "n", "=", "SerialNumberManager", ".", "INSTANCE", ".", "getGroupSerialNumber", "(", "group", ")", ";", "int", "n", "=", "SerialNumberManager", ".", "GROUP", ".", "getSerialNumber", "(", "group", ")", ";", "updatePermissionStatus", "(", "PermissionStatusFormat", ".", "GROUP", ",", "n", ")", ";", "}", "@", "@", "-", "17", ",", "23", "+", "17", ",", "195", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ";", "/", "**", "Manage", "name", "-", "to", "-", "serial", "-", "number", "maps", "for", "users", "and", "groups", ".", "*", "/", "class", "SerialNumberManager", "{", "/", "**", "This", "is", "the", "only", "instance", "of", "{", "@", "link", "SerialNumberManager", "}", ".*", "/", "static", "final", "SerialNumberManager", "INSTANCE", "=", "new", "SerialNumberManager", "(", ");", "import", "org", ".", "apache", ".", "hadoop", ".", "conf", ".", "Configuration", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "INodeWithAdditionalFields", ".", "PermissionStatusFormat", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "util", ".", "LongBitFormat", ";", "private", "final", "SerialNumberMap", "<", "String", ">", "usermap", "=", "new", "SerialNumberMap", "<", "String", ">", "()", ";", "private", "final", "SerialNumberMap", "<", "String", ">", "groupmap", "=", "new", "SerialNumberMap", "<", "String", ">", "()", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Map", ".", "Entry", ";", "private", "SerialNumberManager", "(", ")", "{", "}", "import", "static", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "DFSConfigKeys", ".", "DFS_IMAGE_EXPANDED_STRING_TABLES_DEFAULT", ";", "import", "static", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "DFSConfigKeys", ".", "DFS_IMAGE_EXPANDED_STRING_TABLES_KEY", ";", "int", "getUserSerialNumber", "(", "String", "u", ")", "{", "return", "usermap", ".", "get", "(", "u", ")", ";}", "int", "getGroupSerialNumber", "(", "String", "g", ")", "{", "return", "groupmap", ".", "get", "(", "g", ")", ";}", "String", "getUser", "(", "int", "n", ")", "{", "return", "usermap", ".", "get", "(", "n", ")", ";}", "String", "getGroup", "(", "int", "n", ")", "{", "return", "groupmap", ".", "get", "(", "n", ")", ";}", "/", "**", "Manage", "name", "-", "to", "-", "serial", "-", "number", "maps", "for", "various", "string", "tables", ".", "*", "/", "public", "enum", "SerialNumberManager", "{", "GLOBAL", "(", "),", "/", "/", "NEVER", "EVER", "directly", "access", "!", "USER", "(", "PermissionStatusFormat", ".", "USER", ",", "AclEntryStatusFormat", ".", "NAME", ")", ",", "GROUP", "(", "PermissionStatusFormat", ".", "GROUP", ",", "AclEntryStatusFormat", ".", "NAME", ")", ",", "XATTR", "(", "XAttrFormat", ".", "NAME", ")", ";", "{", "getUserSerialNumber", "(", "null", ")", ";", "getGroupSerialNumber", "(", "null", ")", ";", "private", "static", "final", "SerialNumberManager", "[", "]", "values", "=", "values", "(", ");", "private", "static", "final", "int", "maxEntryBits", ";", "private", "static", "final", "int", "maxEntryNumber", ";", "private", "static", "final", "int", "maskBits", ";", "private", "static", "boolean", "initialized", ";", "private", "SerialNumberMap", "<", "String", ">", "serialMap", ";", "private", "int", "bitLength", "=", "Integer", ".", "SIZE", ";", "private", "boolean", "enabled", ";", "static", "{", "maxEntryBits", "=", "Integer", ".", "numberOfLeadingZeros", "(", "values", ".", "length", ")", ";", "maxEntryNumber", "=", "(", "1", "<", "<", "maxEntryBits", ")", "-", "1", ";", "maskBits", "=", "Integer", ".", "SIZE", "-", "maxEntryBits", ";", "for", "(", "SerialNumberManager", "snm", ":", "values", ")", "{", "/", "/", "account", "for", "string", "table", "mask", "bits", ".", "snm", ".", "updateLength", "(", "maxEntryBits", ")", ";", "/", "/", "find", "max", "allowed", "length", "in", "case", "global", "is", "enabled", ".", "GLOBAL", ".", "updateLength", "(", "snm", ".", "getLength", "(", "))", ";", "}", "/", "/", "can", "reinitialize", "once", "later", ".", "initializeSerialMaps", "(", "DFS_IMAGE_EXPANDED_STRING_TABLES_DEFAULT", ")", ";", "}", "static", "synchronized", "void", "initialize", "(", "Configuration", "conf", ")", "{", "boolean", "useExpanded", "=", "conf", ".", "getBoolean", "(", "DFS_IMAGE_EXPANDED_STRING_TABLES_KEY", ",", "DFS_IMAGE_EXPANDED_STRING_TABLES_DEFAULT", ")", ";", "if", "(", "initialized", ")", "{", "if", "(", "useExpanded", "^", "!", "GLOBAL", ".", "enabled", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Cannot", "change", "serial", "maps", "\"", ");", "}", "return", ";", "}", "initializeSerialMaps", "(", "useExpanded", ")", ";", "for", "(", "SerialNumberManager", "snm", ":", "values", ")", "{", "if", "(", "snm", ".", "enabled", ")", "{", "FSDirectory", ".", "LOG", ".", "info", "(", "snm", "+", "\"", "serial", "map", ":", "bits", "=", "\"", "+", "snm", ".", "getLength", "(", ")", "\"", "maxEntries", "=", "\"", "+", "snm", ".", "serialMap", ".", "getMax", "(", "))", ";", "}", "}", "initialized", "=", "true", ";", "}", "private", "static", "void", "initializeSerialMaps", "(", "boolean", "useExpanded", ")", "{", "if", "(", "useExpanded", ")", "{", "/", "/", "initialize", "per", "-", "manager", "serial", "maps", "for", "all", "but", "global", ".", "for", "(", "SerialNumberManager", "snm", ":", "values", ")", "{", "snm", ".", "enabled", "=", "(", "snm", "!", "=", "GLOBAL", ")", ";", "snm", ".", "serialMap", "=", "snm", ".", "enabled", "?", "new", "SerialNumberMap", "<", "String", ">", "(", "snm", ")", ":", "null", ";", "}", "}", "else", "{", "/", "/", "initialize", "all", "managers", "to", "use", "the", "global", "serial", "map", ".", "SerialNumberMap", "<", "String", ">", "globalSerialMap", "=", "new", "SerialNumberMap", "<", ">(", "GLOBAL", ")", ";", "for", "(", "SerialNumberManager", "snm", ":", "values", ")", "{", "snm", ".", "enabled", "=", "(", "snm", "=", "=", "GLOBAL", ")", ";", "snm", ".", "serialMap", "=", "globalSerialMap", ";", "}", "}", "}", "SerialNumberManager", "(", "LongBitFormat", ".", "Enum", ".", "..", "elements", ")", "{", "/", "/", "compute", "the", "smallest", "bit", "length", "registered", "with", "the", "serial", "manager", ".", "for", "(", "LongBitFormat", ".", "Enum", "element", ":", "elements", ")", "{", "updateLength", "(", "element", ".", "getLength", "(", "))", ";", "}", "}", "int", "getLength", "(", ")", "{", "return", "bitLength", ";", "}", "private", "void", "updateLength", "(", "int", "maxLength", ")", "{", "bitLength", "=", "Math", ".", "min", "(", "bitLength", ",", "maxLength", ")", ";", "}", "public", "int", "getSerialNumber", "(", "String", "u", ")", "{", "return", "serialMap", ".", "get", "(", "u", ")", ";", "}", "public", "String", "getString", "(", "int", "id", ")", "{", "return", "serialMap", ".", "get", "(", "id", ")", ";", "}", "public", "String", "getString", "(", "int", "id", ",", "StringTable", "stringTable", ")", "{", "return", "(", "stringTable", "!", "=", "null", ")", "?", "stringTable", ".", "get", "(", "this", ",", "id", ")", ":", "getString", "(", "id", ")", ";", "}", "private", "int", "getMask", "(", "int", "bits", ")", "{", "return", "ordinal", "(", ")", "<", "<", "(", "Integer", ".", "SIZE", "-", "bits", ")", ";", "}", "private", "static", "int", "getMaskBits", "(", ")", "{", "return", "GLOBAL", ".", "enabled", "?", "0", ":", "maskBits", ";", "}", "private", "int", "size", "(", ")", "{", "return", "enabled", "?", "serialMap", ".", "size", "(", ")", ":", "0", ";", "}", "private", "Iterable", "<", "Entry", "<", "Integer", ",", "String", ">", ">", "entrySet", "(", ")", "{", "if", "(", "!", "enabled", ")", "{", "return", "Collections", ".", "emptySet", "(", ");", "}", "return", "serialMap", ".", "entrySet", "(", ");", "}", "/", "/", "returns", "snapshot", "of", "current", "values", "for", "a", "save", ".", "public", "static", "StringTable", "getStringTable", "(", ")", "{", "/", "/", "approximate", "size", "for", "capacity", ".", "int", "size", "=", "0", ";", "for", "(", "final", "SerialNumberManager", "snm", ":", "values", ")", "{", "size", "+", "=", "snm", ".", "size", "(", ");", "}", "int", "tableMaskBits", "=", "getMaskBits", "(", ");", "StringTable", "map", "=", "new", "StringTable", "(", "size", ",", "tableMaskBits", ")", ";", "for", "(", "final", "SerialNumberManager", "snm", ":", "values", ")", "{", "final", "int", "mask", "=", "snm", ".", "getMask", "(", "tableMaskBits", ")", ";", "for", "(", "Entry", "<", "Integer", ",", "String", ">", "entry", ":", "snm", ".", "entrySet", "(", "))", "{", "map", ".", "put", "(", "entry", ".", "getKey", "(", ")", "|", "mask", ",", "entry", ".", "getValue", "(", "))", ";", "}", "}", "return", "map", ";", "}", "/", "/", "returns", "an", "empty", "table", "for", "load", ".", "public", "static", "StringTable", "newStringTable", "(", "int", "size", ",", "int", "bits", ")", "{", "if", "(", "bits", ">", "maskBits", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "String", "table", "bits", "\"", "+", "bits", "+", "\"", ">", "\"", "+", "maskBits", ")", ";", "}", "return", "new", "StringTable", "(", "size", ",", "bits", ")", ";", "}", "public", "static", "class", "StringTable", "implements", "Iterable", "<", "Entry", "<", "Integer", ",", "String", ">", ">", "{", "private", "final", "int", "tableMaskBits", ";", "private", "final", "Map", "<", "Integer", ",", "String", ">", "map", ";", "private", "StringTable", "(", "int", "size", ",", "int", "loadingMaskBits", ")", "{", "this", ".", "tableMaskBits", "=", "loadingMaskBits", ";", "this", ".", "map", "=", "new", "HashMap", "<", ">(", "size", ")", ";", "}", "private", "String", "get", "(", "SerialNumberManager", "snm", ",", "int", "id", ")", "{", "if", "(", "tableMaskBits", "!", "=", "0", ")", "{", "if", "(", "id", ">", "maxEntryNumber", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "serial", "id", "\"", "+", "id", "+", "\"", ">", "\"", "+", "maxEntryNumber", ")", ";", "}", "id", "|", "=", "snm", ".", "getMask", "(", "tableMaskBits", ")", ";", "}", "return", "map", ".", "get", "(", "id", ")", ";", "}", "public", "void", "put", "(", "int", "id", ",", "String", "str", ")", "{", "map", ".", "put", "(", "id", ",", "str", ")", ";", "}", "public", "Iterator", "<", "Entry", "<", "Integer", ",", "String", ">", ">", "iterator", "(", ")", "{", "return", "map", ".", "entrySet", "(", ").", "iterator", "(", ");", "}", "public", "int", "size", "(", ")", "{", "return", "map", ".", "size", "(", ");", "}", "public", "int", "getMaskBits", "(", ")", "{", "return", "tableMaskBits", ";", "}", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "17", ",", "6", "+", "17", ",", "10", "@", "@", "*", "/", "package", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "Iterator", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentHashMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "ConcurrentMap", ";", "import", "java", ".", "util", ".", "concurrent", ".", "atomic", ".", "AtomicInteger", ";", "@", "@", "-", "35", ",", "21", "+", "39", ",", "33", "@", "@", "*", "/", "@", "InterfaceAudience", ".", "Private", "public", "class", "SerialNumberMap", "<", "T", ">", "{", "private", "final", "AtomicInteger", "max", "=", "new", "AtomicInteger", "(", "1", ")", ";", "private", "String", "name", ";", "private", "final", "int", "max", ";", "private", "final", "AtomicInteger", "current", "=", "new", "AtomicInteger", "(", "1", ")", ";", "private", "final", "ConcurrentMap", "<", "T", ",", "Integer", ">", "t2i", "=", "new", "ConcurrentHashMap", "<", "T", ",", "Integer", ">", "()", ";", "private", "final", "ConcurrentMap", "<", "Integer", ",", "T", ">", "i2t", "=", "new", "ConcurrentHashMap", "<", "Integer", ",", "T", ">", "()", ";", "SerialNumberMap", "(", "SerialNumberManager", "snm", ")", "{", "this", "(", "snm", ".", "name", "(", "),", "snm", ".", "getLength", "(", "))", ";", "}", "SerialNumberMap", "(", "String", "name", ",", "int", "bitLength", ")", "{", "this", ".", "name", "=", "name", ";", "this", ".", "max", "=", "(", "1", "<", "<", "bitLength", ")", "-", "1", ";", "}", "public", "int", "get", "(", "T", "t", ")", "{", "if", "(", "t", "=", "=", "null", ")", "{", "return", "0", ";", "}", "Integer", "sn", "=", "t2i", ".", "get", "(", "t", ")", ";", "if", "(", "sn", "=", "=", "null", ")", "{", "sn", "=", "max", ".", "getAndIncrement", "(", ");", "if", "(", "sn", "<", "0", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "Too", "many", "elements", "!", "\")", ";", "sn", "=", "current", ".", "getAndIncrement", "(", ");", "if", "(", "sn", ">", "max", ")", "{", "current", ".", "getAndDecrement", "(", ");", "throw", "new", "IllegalStateException", "(", "name", "+", "\"", ":", "serial", "number", "map", "is", "full", "\"", ");", "}", "Integer", "old", "=", "t2i", ".", "putIfAbsent", "(", "t", ",", "sn", ")", ";", "if", "(", "old", "!", "=", "null", ")", "{", "@", "@", "-", "66", ",", "14", "+", "82", ",", "27", "@", "@", "public", "T", "get", "(", "int", "i", ")", "{", "}", "T", "t", "=", "i2t", ".", "get", "(", "i", ")", ";", "if", "(", "t", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"!", "i2t", ".", "containsKey", "(", "\"", "+", "i", "+", "\"", "),", "this", "=", "\"", "+", "this", ")", ";", "throw", "new", "IllegalStateException", "(", "name", "+", "\"", ":", "serial", "number", "\"", "+", "i", "+", "\"", "does", "not", "exist", "\"", ");", "}", "return", "t", ";", "}", "int", "getMax", "(", ")", "{", "return", "max", ";", "}", "Set", "<", "Map", ".", "Entry", "<", "Integer", ",", "T", ">", ">", "entrySet", "(", ")", "{", "return", "new", "HashSet", "<", ">(", "i2t", ".", "entrySet", "(", "))", ";", "}", "public", "int", "size", "(", ")", "{", "return", "i2t", ".", "size", "(", ");", "}", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "max", "=", "\"", "+", "max", "+", "\"", ",\\", "n", "t2i", "=", "\"", "+", "t2i", "+", "\"", ",\\", "n", "i2t", "=", "\"", "+", "i2t", ";", "return", "\"", "current", "=", "\"", "+", "current", "+", "\"", ",\\", "n", "\"", "\"", "max", "=", "\"", "+", "max", "+", "\"", ",\\", "n", "t2i", "=", "\"", "+", "t2i", "+", "\"", ",\\", "n", "i2t", "=", "\"", "+", "i2t", ";", "}", "}", "\\", "No", "newline", "at", "end", "of", "file", "@", "@", "-", "31", ",", "52", "+", "31", ",", "66", "@", "@", "/", "**", "*", "Class", "to", "pack", "XAttrs", "into", "byte", "[", "].", "<", "br", ">", "*", "For", "each", "XAttr", ":", "<", "br", ">", "*", "The", "first", "4", "bytes", "represents", "XAttr", "namespace", "and", "name", "<", "br", ">", "*", "[", "0", ":", "3", ")", "-", "XAttr", "namespace", "<", "br", ">", "*", "[", "3", ":", "8", ")", "-", "Reserved", "<", "br", ">", "*", "[", "8", ":", "32", ")", "-", "The", "name", "of", "the", "entry", ",", "which", "is", "an", "ID", "that", "points", "to", "a", "*", "string", "in", "map", "<", "br", ">", "*", "The", "following", "two", "bytes", "represents", "the", "length", "of", "XAttr", "value", "<", "br", ">", "*", "The", "remaining", "bytes", "is", "the", "XAttr", "value", "<", "br", ">", "*", "*", "Note", ":", "this", "format", "is", "used", "both", "in", "-", "memory", "and", "on", "-", "disk", ".", "Changes", "will", "be", "*", "incompatible", ".", "*", "*", "/", "class", "XAttrFormat", "{", "private", "enum", "XAttrStatusFormat", "{", "NAMESPACE", "(", "null", ",", "3", ")", ",", "RESERVED", "(", "NAMESPACE", ".", "BITS", ",", "5", ")", ",", "NAME", "(", "RESERVED", ".", "BITS", ",", "24", ")", ";", "public", "enum", "XAttrFormat", "implements", "LongBitFormat", ".", "Enum", "{", "RESERVED", "(", "null", ",", "5", ")", ",", "NS_EXT", "(", "RESERVED", ".", "BITS", ",", "1", ")", ",", "NAME", "(", "NS_EXT", ".", "BITS", ",", "24", ")", ",", "NS", "(", "NAME", ".", "BITS", ",", "2", ")", ";", "private", "final", "LongBitFormat", "BITS", ";", "private", "static", "final", "int", "NS_EXT_SHIFT", "=", "NS", ".", "BITS", ".", "getLength", "(", ");", "private", "static", "final", "int", "NS_MASK", "=", "(", "1", "<", "<", "NS_EXT_SHIFT", ")", "-", "1", ";", "XAttrStatusFormat", "(", "LongBitFormat", "previous", ",", "int", "length", ")", "{", "BITS", "=", "new", "LongBitFormat", "(", "name", "(", "),", "previous", ",", "length", ",", "0", ")", ";", "}", "private", "static", "final", "int", "XATTR_VALUE_LEN_MAX", "=", "1", "<", "<", "16", ";", "private", "static", "final", "XAttr", ".", "NameSpace", "[", "]", "XATTR_NAMESPACE_VALUES", "=", "XAttr", ".", "NameSpace", ".", "values", "(", ");", "static", "XAttr", ".", "NameSpace", "getNamespace", "(", "int", "xattrStatus", ")", "{", "int", "ordinal", "=", "(", "int", ")", "NAMESPACE", ".", "BITS", ".", "retrieve", "(", "xattrStatus", ")", ";", "return", "XAttr", ".", "NameSpace", ".", "values", "(", ")[", "ordinal", "]", ";", "}", "private", "final", "LongBitFormat", "BITS", ";", "static", "String", "getName", "(", "int", "xattrStatus", ")", "{", "int", "id", "=", "(", "int", ")", "NAME", ".", "BITS", ".", "retrieve", "(", "xattrStatus", ")", ";", "return", "XAttrStorage", ".", "getName", "(", "id", ")", ";", "}", "XAttrFormat", "(", "LongBitFormat", "previous", ",", "int", "length", ")", "{", "BITS", "=", "new", "LongBitFormat", "(", "name", "(", "),", "previous", ",", "length", ",", "0", ")", ";", "}", "static", "int", "toInt", "(", "XAttr", ".", "NameSpace", "namespace", ",", "String", "name", ")", "{", "long", "xattrStatusInt", "=", "0", ";", "@", "Override", "public", "int", "getLength", "(", ")", "{", "return", "BITS", ".", "getLength", "(", ");", "}", "xattrStatusInt", "=", "NAMESPACE", ".", "BITS", ".", "combine", "(", "namespace", ".", "ordinal", "(", "),", "xattrStatusInt", ")", ";", "int", "nid", "=", "XAttrStorage", ".", "getNameSerialNumber", "(", "name", ")", ";", "xattrStatusInt", "=", "NAME", ".", "BITS", ".", "combine", "(", "nid", ",", "xattrStatusInt", ")", ";", "static", "XAttr", ".", "NameSpace", "getNamespace", "(", "int", "record", ")", "{", "long", "nid", "=", "NS", ".", "BITS", ".", "retrieve", "(", "record", ")", ";", "nid", "|", "=", "NS_EXT", ".", "BITS", ".", "retrieve", "(", "record", ")", "<", "<", "NS_EXT_SHIFT", ";", "return", "XATTR_NAMESPACE_VALUES", "[", "(", "int", ")", "nid", "]", ";", "}", "return", "(", "int", ")", "xattrStatusInt", ";", "}", "public", "static", "String", "getName", "(", "int", "record", ")", "{", "int", "nid", "=", "(", "int", ")", "NAME", ".", "BITS", ".", "retrieve", "(", "record", ")", ";", "return", "SerialNumberManager", ".", "XATTR", ".", "getString", "(", "nid", ")", ";", "}", "private", "static", "final", "int", "XATTR_VALUE_LEN_MAX", "=", "1", "<", "<", "16", ";", "static", "int", "toInt", "(", "XAttr", "a", ")", "{", "int", "nid", "=", "SerialNumberManager", ".", "XATTR", ".", "getSerialNumber", "(", "a", ".", "getName", "(", "))", ";", "int", "nsOrd", "=", "a", ".", "getNameSpace", "(", ").", "ordinal", "(", ");", "long", "value", "=", "NS", ".", "BITS", ".", "combine", "(", "nsOrd", "&", "NS_MASK", ",", "0L", ")", ";", "value", "=", "NS_EXT", ".", "BITS", ".", "combine", "(", "nsOrd", ">", ">>", "NS_EXT_SHIFT", ",", "value", ")", ";", "value", "=", "NAME", ".", "BITS", ".", "combine", "(", "nid", ",", "value", ")", ";", "return", "(", "int", ")", "value", ";", "}", "static", "XAttr", "toXAttr", "(", "int", "record", ",", "byte", "[", "]", "value", ",", "SerialNumberManager", ".", "StringTable", "stringTable", ")", "{", "int", "nid", "=", "(", "int", ")", "NAME", ".", "BITS", ".", "retrieve", "(", "record", ")", ";", "String", "name", "=", "SerialNumberManager", ".", "XATTR", ".", "getString", "(", "nid", ",", "stringTable", ")", ";", "return", "new", "XAttr", ".", "Builder", "(", ")", ".", "setNameSpace", "(", "getNamespace", "(", "record", ")", ")", ".", "setName", "(", "name", ")", ".", "setValue", "(", "value", ")", ".", "build", "(", ");", "}", "/", "**", "*", "Unpack", "byte", "[", "]", "to", "XAttrs", ".", "@", "@", "-", "95", ",", "8", "+", "109", ",", "8", "@", "@", "static", "int", "toInt", "(", "XAttr", ".", "NameSpace", "namespace", ",", "String", "name", ")", "{", "int", "v", "=", "Ints", ".", "fromBytes", "(", "attrs", "[", "i", "]", ",", "attrs", "[", "i", "+", "1", "]", ",", "attrs", "[", "i", "+", "2", "]", ",", "attrs", "[", "i", "+", "3", "]", ");", "i", "+", "=", "4", ";", "builder", ".", "setNameSpace", "(", "XAttrStatusFormat", ".", "getNamespace", "(", "v", ")", ");", "builder", ".", "setName", "(", "XAttrStatusFormat", ".", "getName", "(", "v", ")", ");", "builder", ".", "setNameSpace", "(", "XAttrFormat", ".", "getNamespace", "(", "v", ")", ");", "builder", ".", "setName", "(", "XAttrFormat", ".", "getName", "(", "v", ")", ");", "int", "vlen", "=", "(", "(", "0xff", "&", "attrs", "[", "i", "]", ")", "<", "<", "8", ")", "|", "(", "0xff", "&", "attrs", "[", "i", "+", "1", "]", ");", "i", "+", "=", "2", ";", "if", "(", "vlen", ">", "0", ")", "{", "@", "@", "-", "129", ",", "8", "+", "143", ",", "8", "@", "@", "static", "XAttr", "getXAttr", "(", "byte", "[", "]", "attrs", ",", "String", "prefixedName", ")", "{", "int", "v", "=", "Ints", ".", "fromBytes", "(", "attrs", "[", "i", "]", ",", "attrs", "[", "i", "+", "1", "]", ",", "attrs", "[", "i", "+", "2", "]", ",", "attrs", "[", "i", "+", "3", "]", ");", "i", "+", "=", "4", ";", "XAttr", ".", "NameSpace", "namespace", "=", "XAttrStatusFormat", ".", "getNamespace", "(", "v", ")", ";", "String", "name", "=", "XAttrStatusFormat", ".", "getName", "(", "v", ")", ";", "XAttr", ".", "NameSpace", "namespace", "=", "XAttrFormat", ".", "getNamespace", "(", "v", ")", ";", "String", "name", "=", "XAttrFormat", ".", "getName", "(", "v", ")", ";", "int", "vlen", "=", "(", "(", "0xff", "&", "attrs", "[", "i", "]", ")", "<", "<", "8", ")", "|", "(", "0xff", "&", "attrs", "[", "i", "+", "1", "]", ");", "i", "+", "=", "2", ";", "if", "(", "xAttr", ".", "getNameSpace", "(", ")", "=", "=", "namespace", "&", "&", "@", "@", "-", "161", ",", "7", "+", "175", ",", "8", "@", "@", "static", "XAttr", "getXAttr", "(", "byte", "[", "]", "attrs", ",", "String", "prefixedName", ")", "{", "ByteArrayOutputStream", "out", "=", "new", "ByteArrayOutputStream", "(", ");", "try", "{", "for", "(", "XAttr", "a", ":", "xAttrs", ")", "{", "int", "v", "=", "XAttrStatusFormat", ".", "toInt", "(", "a", ".", "getNameSpace", "(", "),", "a", ".", "getName", "(", "))", ";", "/", "/", "big", "-", "endian", "int", "v", "=", "XAttrFormat", ".", "toInt", "(", "a", ")", ";", "out", ".", "write", "(", "Ints", ".", "toByteArray", "(", "v", ")", ");", "int", "vlen", "=", "a", ".", "getValue", "(", ")", "=", "=", "null", "?", "0", ":", "a", ".", "getValue", "(", ").", "length", ";", "Preconditions", ".", "checkArgument", "(", "vlen", "<", "XATTR_VALUE_LEN_MAX", ",", "@", "@", "-", "31", ",", "17", "+", "31", ",", "6", "@", "@", "@", "InterfaceAudience", ".", "Private", "public", "class", "XAttrStorage", "{", "private", "static", "final", "SerialNumberMap", "<", "String", ">", "NAME_MAP", "=", "new", "SerialNumberMap", "<", ">(", ");", "public", "static", "int", "getNameSerialNumber", "(", "String", "name", ")", "{", "return", "NAME_MAP", ".", "get", "(", "name", ")", ";", "}", "public", "static", "String", "getName", "(", "int", "n", ")", "{", "return", "NAME_MAP", ".", "get", "(", "n", ")", ";", "}", "/", "**", "*", "Reads", "the", "extended", "attribute", "of", "an", "inode", "by", "name", "with", "prefix", ".", "*", "<", "p", "/", ">", "@", "@", "-", "51", ",", "6", "+", "51", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "INodeSection", ".", "INode", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "INodeFile", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "INodeId", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "SerialNumberManager", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "web", ".", "JsonUtil", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "web", ".", "resources", ".", "XAttrEncodingParam", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "io", ".", "IOUtils", ";", "@", "@", "-", "67", ",", "7", "+", "68", ",", "7", "@", "@", "class", "FSImageLoader", "{", "public", "static", "final", "Log", "LOG", "=", "LogFactory", ".", "getLog", "(", "FSImageHandler", ".", "class", ")", ";", "private", "final", "String", "[", "]", "stringTable", ";", "private", "final", "SerialNumberManager", ".", "StringTable", "stringTable", ";", "/", "/", "byte", "representation", "of", "inodes", ",", "sorted", "by", "id", "private", "final", "byte", "[", "][", "]", "inodes", ";", "private", "final", "Map", "<", "Long", ",", "long", "[", "]>", "dirmap", ";", "@", "@", "-", "93", ",", "8", "+", "94", ",", "8", "@", "@", "public", "int", "compare", "(", "byte", "[", "]", "o1", ",", "byte", "[", "]", "o2", ")", "{", "}", "}", ";", "private", "FSImageLoader", "(", "String", "[", "]", "stringTable", ",", "byte", "[", "][", "]", "inodes", ",", "Map", "<", "Long", ",", "long", "[", "]>", "dirmap", ")", "{", "private", "FSImageLoader", "(", "SerialNumberManager", ".", "StringTable", "stringTable", ",", "byte", "[", "][", "]", "inodes", ",", "Map", "<", "Long", ",", "long", "[", "]>", "dirmap", ")", "{", "this", ".", "stringTable", "=", "stringTable", ";", "this", ".", "inodes", "=", "inodes", ";", "this", ".", "dirmap", "=", "dirmap", ";", "@", "@", "-", "119", ",", "7", "+", "120", ",", "7", "@", "@", "static", "FSImageLoader", "load", "(", "String", "inputFile", ")", "throws", "IOException", "{", "try", "(", "FileInputStream", "fin", "=", "new", "FileInputStream", "(", "file", ".", "getFD", "(", "))", ")", "{", "/", "/", "Map", "to", "record", "INodeReference", "to", "the", "referred", "id", "ImmutableList", "<", "Long", ">", "refIdList", "=", "null", ";", "String", "[", "]", "stringTable", "=", "null", ";", "SerialNumberManager", ".", "StringTable", "stringTable", "=", "null", ";", "byte", "[", "][", "]", "inodes", "=", "null", ";", "Map", "<", "Long", ",", "long", "[", "]>", "dirmap", "=", "null", ";", "@", "@", "-", "242", ",", "16", "+", "243", ",", "17", "@", "@", "public", "int", "compare", "(", "FsImageProto", ".", "FileSummary", ".", "Section", "s1", ",", "return", "inodes", ";", "}", "static", "String", "[", "]", "loadStringTable", "(", "InputStream", "in", ")", "throws", "IOException", "{", "static", "SerialNumberManager", ".", "StringTable", "loadStringTable", "(", "InputStream", "in", ")", "throws", "IOException", "{", "FsImageProto", ".", "StringTableSection", "s", "=", "FsImageProto", ".", "StringTableSection", ".", "parseDelimitedFrom", "(", "in", ")", ";", "LOG", ".", "info", "(", "\"", "Loading", "\"", "+", "s", ".", "getNumEntry", "(", ")", "+", "\"", "strings", "\"", ");", "String", "[", "]", "stringTable", "=", "new", "String", "[", "s", ".", "getNumEntry", "(", ")", "+", "1", "]", ";", "SerialNumberManager", ".", "StringTable", "stringTable", "=", "SerialNumberManager", ".", "newStringTable", "(", "s", ".", "getNumEntry", "(", "),", "s", ".", "getMaskBits", "(", "))", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "s", ".", "getNumEntry", "(", ");", "+", "+", "i", ")", "{", "FsImageProto", ".", "StringTableSection", ".", "Entry", "e", "=", "FsImageProto", ".", "StringTableSection", ".", "Entry", ".", "parseDelimitedFrom", "(", "in", ")", ";", "stringTable", "[", "e", ".", "getId", "(", ")]", "=", "e", ".", "getStr", "(", ");", "stringTable", ".", "put", "(", "e", ".", "getId", "(", "),", "e", ".", "getStr", "(", "))", ";", "}", "return", "stringTable", ";", "}", "@", "@", "-", "33", ",", "6", "+", "33", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "INodeSection", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "INodeSection", ".", "INode", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "INodeId", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "SerialNumberManager", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "io", ".", "IOUtils", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "util", ".", "LimitInputStream", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "util", ".", "Time", ";", "@", "@", "-", "391", ",", "7", "+", "392", ",", "7", "@", "@", "public", "void", "sync", "(", ")", "throws", "IOException", "{", "}", "}", "private", "String", "[", "]", "stringTable", ";", "private", "SerialNumberManager", ".", "StringTable", "stringTable", ";", "private", "PrintStream", "out", ";", "private", "MetadataMap", "metadataMap", "=", "null", ";", "@", "@", "-", "63", ",", "7", "+", "63", ",", "7", "@", "@", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "SecretManagerSection", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "SnapshotDiffSection", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "SnapshotSection", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "FsImageProto", ".", "StringTableSection", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "SerialNumberManager", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "server", ".", "namenode", ".", "INodeFile", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "hdfs", ".", "util", ".", "XMLUtils", ";", "import", "org", ".", "apache", ".", "hadoop", ".", "io", ".", "erasurecode", ".", "ECSchema", ";", "@", "@", "-", "269", ",", "7", "+", "269", ",", "7", "@", "@", "private", "final", "Configuration", "conf", ";", "private", "final", "PrintStream", "out", ";", "private", "final", "SimpleDateFormat", "isoDateFormat", ";", "private", "String", "[", "]", "stringTable", ";", "private", "SerialNumberManager", ".", "StringTable", "stringTable", ";", "public", "static", "SimpleDateFormat", "createSimpleDateFormat", "(", ")", "{", "SimpleDateFormat", "format", "=", "@", "@", "-", "430", ",", "8", "+", "430", ",", "9", "@", "@", "private", "void", "dumpXattrs", "(", "INodeSection", ".", "XAttrFeatureProto", "xattrs", ")", "{", "(", "(", "XATTR_NAMESPACE_EXT_MASK", "&", "(", "encodedName", ">", ">", "XATTR_NAMESPACE_EXT_OFFSET", ")", ")", "<", "<", "2", ")", ";", "o", "(", "INODE_SECTION_NS", ",", "XAttrProtos", ".", "XAttrProto", ".", "XAttrNamespaceProto", ".", "valueOf", "(", "ns", ")", ".", "toString", "(", "))", ";", "o", "(", "SECTION_NAME", ",", "stringTable", "[", "XATTR_NAME_MASK", "&", "(", "encodedName", ">", ">", "XATTR_NAME_OFFSET", ")", "])", ";", "o", "(", "SECTION_NAME", ",", "SerialNumberManager", ".", "XATTR", ".", "getString", "(", "XATTR_NAME_MASK", "&", "(", "encodedName", ">", ">", "XATTR_NAME_OFFSET", ")", ",", "stringTable", ")", ");", "ByteString", "val", "=", "xattr", ".", "getValue", "(", ");", "if", "(", "val", ".", "isValidUtf8", "(", "))", "{", "o", "(", "INODE_SECTION_VAL", ",", "val", ".", "toStringUtf8", "(", "))", ";", "@", "@", "-", "784", ",", "10", "+", "785", ",", "9", "@", "@", "private", "void", "dumpSnapshotDiffSection", "(", "InputStream", "in", ")", "throws", "IOException", "{", ".", "o", "(", "SNAPSHOT_DIFF_SECTION_CHILDREN_SIZE", ",", "d", ".", "getChildrenSize", "(", "))", ".", "o", "(", "SNAPSHOT_DIFF_SECTION_IS_SNAPSHOT_ROOT", ",", "d", ".", "getIsSnapshotRoot", "(", "))", ".", "o", "(", "SECTION_NAME", ",", "d", ".", "getName", "(", ").", "toStringUtf8", "(", "))", ";", "INodeDirectory", "snapshotCopy", "=", "d", ".", "getSnapshotCopy", "(", ");", "if", "(", "snapshotCopy", "!", "=", "null", ")", "{", "if", "(", "d", ".", "hasSnapshotCopy", "(", "))", "{", "out", ".", "print", "(", "\"<", "\"", "+", "SNAPSHOT_DIFF_SECTION_SNAPSHOT_COPY", "+", "\"", ">\"", ");", "dumpINodeDirectory", "(", "snapshotCopy", ")", ";", "dumpINodeDirectory", "(", "d", ".", "getSnapshotCopy", "(", "))", ";", "out", ".", "print", "(", "\"<", "/\"", "+", "SNAPSHOT_DIFF_SECTION_SNAPSHOT_COPY", "+", "\"", ">\\", "n", "\"", ");", "}", "o", "(", "SNAPSHOT_DIFF_SECTION_CREATED_LIST_SIZE", ",", "d", ".", "getCreatedListSize", "(", "))", ";", "@", "@", "-", "851", ",", "13", "+", "851", ",", "7", "@", "@", "private", "void", "dumpSnapshotSection", "(", "InputStream", "in", ")", "throws", "IOException", "{", "}", "private", "void", "loadStringTable", "(", "InputStream", "in", ")", "throws", "IOException", "{", "StringTableSection", "s", "=", "StringTableSection", ".", "parseDelimitedFrom", "(", "in", ")", ";", "stringTable", "=", "new", "String", "[", "s", ".", "getNumEntry", "(", ")", "+", "1", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "s", ".", "getNumEntry", "(", ");", "+", "+", "i", ")", "{", "StringTableSection", ".", "Entry", "e", "=", "StringTableSection", ".", "Entry", ".", "parseDelimitedFrom", "(", "in", ")", ";", "stringTable", "[", "e", ".", "getId", "(", ")]", "=", "e", ".", "getStr", "(", ");", "}", "stringTable", "=", "FSImageLoader", ".", "loadStringTable", "(", "in", ")", ";", "}", "private", "PBImageXmlWriter", "o", "(", "final", "String", "e", ",", "final", "Object", "v", ")", "{", "@", "@", "-", "311", ",", "6", "+", "311", ",", "7", "@", "@", "message", "StringTableSection", "{", "optional", "string", "str", "=", "2", ";", "}", "optional", "uint32", "numEntry", "=", "1", ";", "optional", "uint32", "maskBits", "=", "2", "[", "default", "=", "0", "]", ";", "/", "/", "repeated", "Entry", "}", "@", "@", "-", "57", ",", "12", "+", "57", ",", "8", "@", "@", "private", "FSNamesystem", "makeNameSystemSpy", "(", "Block", "block", ",", "INodeFile", "file", ")", "/", "/", "set", "file", "'", "s", "parent", "as", "root", "and", "put", "the", "file", "to", "inodeMap", ",", "so", "/", "/", "FSNamesystem", "'", "s", "isFileDeleted", "(", ")", "method", "will", "return", "false", "on", "this", "file", "if", "(", "file", ".", "getParent", "(", ")", "=", "=", "null", ")", "{", "INodeDirectory", "mparent", "=", "mock", "(", "INodeDirectory", ".", "class", ")", ";", "INodeDirectory", "parent", "=", "new", "INodeDirectory", "(", "mparent", ".", "getId", "(", "),", "new", "byte", "[", "0", "]", ",", "mparent", ".", "getPermissionStatus", "(", "),", "mparent", ".", "getAccessTime", "(", "))", ";", "parent", ".", "setLocalName", "(", "new", "byte", "[", "0", "]", ");", "INodeDirectory", "parent", "=", "namesystem", ".", "getFSDirectory", "(", ").", "getRoot", "(", ");", "parent", ".", "addChild", "(", "file", ")", ";", "file", ".", "setParent", "(", "parent", ")", ";", "}", "namesystem", ".", "dir", ".", "getINodeMap", "(", ").", "put", "(", "file", ")", ";"], "docstring_tokens": ["the", "user/group", "information"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2002", "-", "2011", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2002", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "@", "@", "-", "10", ",", "23", "+", "10", ",", "14", "@", "@", "*", "an", "\"", "AS", "IS", "\"", "BASIS", ",", "WITHOUT", "WARRANTIES", "OR", "CONDITIONS", "OF", "ANY", "KIND", ",", "either", "express", "or", "implied", ".", "See", "the", "License", "for", "the", "*", "specific", "language", "governing", "permissions", "and", "limitations", "under", "the", "License", ".", "*", "/", "package", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "import", "org", ".", "springframework", ".", "http", ".", "ResponseEntity", ";", "import", "org", ".", "springframework", ".", "security", ".", "access", ".", "AccessDeniedException", ";", "import", "org", ".", "springframework", ".", "security", ".", "authentication", ".", "InsufficientAuthenticationException", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "Authentication", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "AuthenticationException", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "GrantedAuthority", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "OAuth2AccessToken", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "exceptions", ".", "BadClientCredentialsException", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "exceptions", ".", "ClientAuthenticationException", ";", "@", "@", "-", "51", ",", "6", "+", "42", ",", "7", "@", "@", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "code", ".", "InMemoryAuthorizationCodeServices", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "implicit", ".", "ImplicitTokenRequest", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "request", ".", "DefaultOAuth2RequestValidator", ";", "import", "org", ".", "springframework", ".", "util", ".", "ObjectUtils", ";", "import", "org", ".", "springframework", ".", "util", ".", "StringUtils", ";", "import", "org", ".", "springframework", ".", "web", ".", "HttpSessionRequiredException", ";", "import", "org", ".", "springframework", ".", "web", ".", "bind", ".", "annotation", ".", "ExceptionHandler", ";", "@", "@", "-", "68", ",", "6", "+", "60", ",", "16", "@", "@", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UriComponents", ";", "import", "org", ".", "springframework", ".", "web", ".", "util", ".", "UriComponentsBuilder", ";", "import", "java", ".", "net", ".", "URI", ";", "import", "java", ".", "security", ".", "Principal", ";", "import", "java", ".", "util", ".", "Collections", ";", "import", "java", ".", "util", ".", "Date", ";", "import", "java", ".", "util", ".", "HashMap", ";", "import", "java", ".", "util", ".", "HashSet", ";", "import", "java", ".", "util", ".", "LinkedHashMap", ";", "import", "java", ".", "util", ".", "Map", ";", "import", "java", ".", "util", ".", "Set", ";", "/", "**", "*", "<", "p", ">", "*", "Implementation", "of", "the", "Authorization", "Endpoint", "from", "the", "OAuth2", "specification", ".", "Accepts", "authorization", "requests", ",", "and", "@", "@", "-", "86", ",", "8", "+", "88", ",", "11", "@", "@", "*", "*", "/", "@", "FrameworkEndpoint", "@", "SessionAttributes", "(", "\"", "authorizationRequest", "\"", ")", "@", "SessionAttributes", "(", "{", "AuthorizationEndpoint", ".", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "AuthorizationEndpoint", ".", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", "}", ")", "public", "class", "AuthorizationEndpoint", "extends", "AbstractEndpoint", "{", "static", "final", "String", "AUTHORIZATION_REQUEST_ATTR_NAME", "=", "\"", "authorizationRequest", "\"", ";", "static", "final", "String", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", "=", "\"", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ".", "AuthorizationEndpoint", ".", "ORIGINAL_AUTHORIZATION_REQUEST", "\"", ";", "private", "AuthorizationCodeServices", "authorizationCodeServices", "=", "new", "InMemoryAuthorizationCodeServices", "(", ");", "@", "@", "-", "174", ",", "10", "+", "179", ",", "10", "@", "@", "public", "ModelAndView", "authorize", "(", "Map", "<", "String", ",", "Object", ">", "model", ",", "@", "RequestParam", "Map", "<", "Strin", "}", "}", "/", "/", "Place", "auth", "request", "into", "the", "model", "so", "that", "it", "is", "stored", "in", "the", "session", "/", "/", "for", "approveOrDeny", "to", "use", ".", "That", "way", "we", "make", "sure", "that", "auth", "request", "comes", "from", "the", "session", ",", "/", "/", "so", "any", "auth", "request", "parameters", "passed", "to", "approveOrDeny", "will", "be", "ignored", "and", "retrieved", "from", "the", "session", ".", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "authorizationRequest", ")", ";", "/", "/", "Store", "authorizationRequest", "AND", "an", "immutable", "Map", "of", "authorizationRequest", "in", "session", "/", "/", "which", "will", "be", "used", "to", "validate", "against", "in", "approveOrDeny", "(", ")", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "return", "getUserApprovalPageResponse", "(", "model", ",", "authorizationRequest", ",", "(", "Authentication", ")", "principal", ")", ";", "@", "@", "-", "189", ",", "6", "+", "194", ",", "33", "@", "@", "public", "ModelAndView", "authorize", "(", "Map", "<", "String", ",", "Object", ">", "model", ",", "@", "RequestParam", "Map", "<", "Strin", "}", "Map", "<", "String", ",", "Object", ">", "unmodifiableMap", "(", "AuthorizationRequest", "authorizationRequest", ")", "{", "Map", "<", "String", ",", "Object", ">", "authorizationRequestMap", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "()", ";", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "CLIENT_ID", ",", "authorizationRequest", ".", "getClientId", "(", "))", ";", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "STATE", ",", "authorizationRequest", ".", "getState", "(", "))", ";", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "REDIRECT_URI", ",", "authorizationRequest", ".", "getRedirectUri", "(", "))", ";", "if", "(", "authorizationRequest", ".", "getResponseTypes", "(", ")", "!", "=", "null", ")", "{", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "RESPONSE_TYPE", ",", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "String", ">", "(", "authorizationRequest", ".", "getResponseTypes", "(", "))", "))", ";", "}", "if", "(", "authorizationRequest", ".", "getScope", "(", ")", "!", "=", "null", ")", "{", "authorizationRequestMap", ".", "put", "(", "OAuth2Utils", ".", "SCOPE", ",", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "String", ">", "(", "authorizationRequest", ".", "getScope", "(", "))", "))", ";", "}", "authorizationRequestMap", ".", "put", "(", "\"", "approved", "\"", ",", "authorizationRequest", ".", "isApproved", "(", "))", ";", "if", "(", "authorizationRequest", ".", "getResourceIds", "(", ")", "!", "=", "null", ")", "{", "authorizationRequestMap", ".", "put", "(", "\"", "resourceIds", "\"", ",", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "String", ">", "(", "authorizationRequest", ".", "getResourceIds", "(", "))", "))", ";", "}", "if", "(", "authorizationRequest", ".", "getAuthorities", "(", ")", "!", "=", "null", ")", "{", "authorizationRequestMap", ".", "put", "(", "\"", "authorities", "\"", ",", "Collections", ".", "unmodifiableSet", "(", "new", "HashSet", "<", "GrantedAuthority", ">", "(", "authorizationRequest", ".", "getAuthorities", "(", "))", "))", ";", "}", "return", "Collections", ".", "unmodifiableMap", "(", "authorizationRequestMap", ")", ";", "}", "@", "RequestMapping", "(", "value", "=", "\"", "/", "oauth", "/", "authorize", "\"", ",", "method", "=", "RequestMethod", ".", "POST", ",", "params", "=", "OAuth2Utils", ".", "USER_OAUTH_APPROVAL", ")", "public", "View", "approveOrDeny", "(", "@", "RequestParam", "Map", "<", "String", ",", "String", ">", "approvalParameters", ",", "Map", "<", "String", ",", "?", ">", "model", ",", "SessionStatus", "sessionStatus", ",", "Principal", "principal", ")", "{", "@", "@", "-", "199", ",", "13", "+", "231", ",", "20", "@", "@", "public", "View", "approveOrDeny", "(", "@", "RequestParam", "Map", "<", "String", ",", "String", ">", "approvalParameters", ",", "\"", "User", "must", "be", "authenticated", "with", "Spring", "Security", "before", "authorizing", "an", "access", "token", ".", "\")", ";", "}", "AuthorizationRequest", "authorizationRequest", "=", "(", "AuthorizationRequest", ")", "model", ".", "get", "(", "\"", "authorizationRequest", "\"", ");", "AuthorizationRequest", "authorizationRequest", "=", "(", "AuthorizationRequest", ")", "model", ".", "get", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ")", ";", "if", "(", "authorizationRequest", "=", "=", "null", ")", "{", "sessionStatus", ".", "setComplete", "(", ");", "throw", "new", "InvalidRequestException", "(", "\"", "Cannot", "approve", "uninitialized", "authorization", "request", ".", "\")", ";", "}", "/", "/", "Check", "to", "ensure", "the", "Authorization", "Request", "was", "not", "modified", "during", "the", "user", "approval", "step", "@", "SuppressWarnings", "(", "\"", "unchecked", "\"", ")", "Map", "<", "String", ",", "Object", ">", "originalAuthorizationRequest", "=", "(", "Map", "<", "String", ",", "Object", ">", ")", "model", ".", "get", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ")", ";", "if", "(", "isAuthorizationRequestModified", "(", "authorizationRequest", ",", "originalAuthorizationRequest", ")", ")", "{", "throw", "new", "InvalidRequestException", "(", "\"", "Changes", "were", "detected", "from", "the", "original", "authorization", "request", ".", "\")", ";", "}", "try", "{", "Set", "<", "String", ">", "responseTypes", "=", "authorizationRequest", ".", "getResponseTypes", "(", ");", "@", "@", "-", "238", ",", "6", "+", "277", ",", "52", "@", "@", "public", "View", "approveOrDeny", "(", "@", "RequestParam", "Map", "<", "String", ",", "String", ">", "approvalParameters", ",", "}", "private", "boolean", "isAuthorizationRequestModified", "(", "AuthorizationRequest", "authorizationRequest", ",", "Map", "<", "String", ",", "Object", ">", "originalAuthorizationRequest", ")", "{", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getClientId", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "CLIENT_ID", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getState", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "STATE", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getRedirectUri", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "REDIRECT_URI", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getResponseTypes", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "RESPONSE_TYPE", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getScope", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "OAuth2Utils", ".", "SCOPE", ")", "))", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "isApproved", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "\"", "approved", "\"", "))", ")", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getResourceIds", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "\"", "resourceIds", "\"", "))", ")", "{", "return", "true", ";", "}", "if", "(", "!", "ObjectUtils", ".", "nullSafeEquals", "(", "authorizationRequest", ".", "getAuthorities", "(", "),", "originalAuthorizationRequest", ".", "get", "(", "\"", "authorities", "\"", "))", ")", "{", "return", "true", ";", "}", "return", "false", ";", "}", "/", "/", "We", "need", "explicit", "approval", "from", "the", "user", ".", "private", "ModelAndView", "getUserApprovalPageResponse", "(", "Map", "<", "String", ",", "Object", ">", "model", ",", "AuthorizationRequest", "authorizationRequest", ",", "Authentication", "principal", ")", "{", "@", "@", "-", "529", ",", "7", "+", "614", ",", "7", "@", "@", "private", "AuthorizationRequest", "getAuthorizationRequestForError", "(", "ServletWebRequest", "w", "/", "/", "If", "it", "'", "s", "already", "there", "then", "we", "are", "in", "the", "approveOrDeny", "phase", "and", "we", "can", "use", "the", "saved", "request", "AuthorizationRequest", "authorizationRequest", "=", "(", "AuthorizationRequest", ")", "sessionAttributeStore", ".", "retrieveAttribute", "(", "webRequest", ",", "\"", "authorizationRequest", "\"", ");", "webRequest", ",", "AUTHORIZATION_REQUEST_ATTR_NAME", ")", ";", "if", "(", "authorizationRequest", "!", "=", "null", ")", "{", "return", "authorizationRequest", ";", "}", "@", "@", "-", "1", ",", "5", "+", "1", ",", "5", "@", "@", "/", "*", "*", "Copyright", "2006", "-", "2011", "the", "original", "author", "or", "authors", ".", "*", "Copyright", "2006", "-", "2018", "the", "original", "author", "or", "authors", ".", "*", "*", "Licensed", "under", "the", "Apache", "License", ",", "Version", "2", ".", "0", "(", "the", "\"", "License", "\"", ");", "you", "may", "not", "use", "this", "file", "except", "in", "compliance", "with", "*", "the", "License", ".", "You", "may", "obtain", "a", "copy", "of", "the", "License", "at", "@", "@", "-", "16", ",", "6", "+", "16", ",", "8", "@", "@", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertFalse", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertNull", ";", "import", "static", "org", ".", "junit", ".", "Assert", ".", "assertTrue", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ".", "AuthorizationEndpoint", ".", "AUTHORIZATION_REQUEST_ATTR_NAME", ";", "import", "static", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "provider", ".", "endpoint", ".", "AuthorizationEndpoint", ".", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ";", "import", "java", ".", "util", ".", "Arrays", ";", "import", "java", ".", "util", ".", "Collections", ";", "@", "@", "-", "29", ",", "6", "+", "31", ",", "7", "@", "@", "import", "org", ".", "junit", ".", "Test", ";", "import", "org", ".", "springframework", ".", "security", ".", "authentication", ".", "UsernamePasswordAuthenticationToken", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "Authentication", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "authority", ".", "AuthorityUtils", ";", "import", "org", ".", "springframework", ".", "security", ".", "core", ".", "authority", ".", "SimpleGrantedAuthority", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "DefaultOAuth2AccessToken", ";", "import", "org", ".", "springframework", ".", "security", ".", "oauth2", ".", "common", ".", "OAuth2AccessToken", ";", "@", "@", "-", "152", ",", "8", "+", "155", ",", "9", "@", "@", "public", "void", "testStartAuthorizationCodeFlowForClientCredentialsFails", "(", ")", "throws", "Exc", "@", "Test", "public", "void", "testAuthorizationCodeWithFragment", "(", ")", "throws", "Exception", "{", "endpoint", ".", "setAuthorizationCodeServices", "(", "new", "StubAuthorizationCodeServices", "(", "))", ";", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "#", "bar", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "#", "bar", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "Collections", ".", "singletonMap", "(", "OAuth2Utils", ".", "USER_OAUTH_APPROVAL", ",", "\"", "true", "\"", "),", "model", ",", "sessionStatus", ",", "principal", ")", ";", "assertEquals", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "code", "=", "thecode", "#", "bar", "\"", ",", "(", "(", "RedirectView", ")", "result", ")", ".", "getUrl", "(", "))", ";", "@", "@", "-", "162", ",", "9", "+", "166", ",", "9", "@", "@", "public", "void", "testAuthorizationCodeWithFragment", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAuthorizationCodeWithQueryParams", "(", ")", "throws", "Exception", "{", "endpoint", ".", "setAuthorizationCodeServices", "(", "new", "StubAuthorizationCodeServices", "(", "))", ";", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "Collections", ".", "singletonMap", "(", "OAuth2Utils", ".", "USER_OAUTH_APPROVAL", ",", "\"", "true", "\"", "),", "model", ",", "sessionStatus", ",", "principal", ")", ";", "assertEquals", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "&", "code", "=", "thecode", "\"", ",", "(", "(", "RedirectView", ")", "result", ")", ".", "getUrl", "(", "))", ";", "@", "@", "-", "173", ",", "8", "+", "177", ",", "9", "@", "@", "public", "void", "testAuthorizationCodeWithQueryParams", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAuthorizationCodeWithTrickyState", "(", ")", "throws", "Exception", "{", "endpoint", ".", "setAuthorizationCodeServices", "(", "new", "StubAuthorizationCodeServices", "(", "))", ";", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "=", "?", "s", "\"", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "=", "?", "s", "\"", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "Collections", ".", "singletonMap", "(", "OAuth2Utils", ".", "USER_OAUTH_APPROVAL", ",", "\"", "true", "\"", "),", "model", ",", "sessionStatus", ",", "principal", ")", ";", "assertEquals", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "code", "=", "thecode", "&", "state", "=", "%", "20", "%", "3D", "?", "s", "\"", ",", "(", "(", "RedirectView", ")", "result", ")", ".", "getUrl", "(", "))", ";", "@", "@", "-", "183", ",", "10", "+", "188", ",", "10", "@", "@", "public", "void", "testAuthorizationCodeWithTrickyState", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAuthorizationCodeWithMultipleQueryParams", "(", ")", "throws", "Exception", "{", "endpoint", ".", "setAuthorizationCodeServices", "(", "new", "StubAuthorizationCodeServices", "(", "))", ";", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "&", "bar", "=", "foo", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "&", "bar", "=", "foo", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "Collections", ".", "singletonMap", "(", "OAuth2Utils", ".", "USER_OAUTH_APPROVAL", ",", "\"", "true", "\"", "),", "model", ",", "sessionStatus", ",", "principal", ")", ";", "assertEquals", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "bar", "&", "bar", "=", "foo", "&", "code", "=", "thecode", "\"", ",", "(", "(", "RedirectView", ")", "result", ")", ".", "getUrl", "(", "))", ";", "@", "@", "-", "195", ",", "10", "+", "200", ",", "10", "@", "@", "public", "void", "testAuthorizationCodeWithMultipleQueryParams", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAuthorizationCodeWithTrickyQueryParams", "(", ")", "throws", "Exception", "{", "endpoint", ".", "setAuthorizationCodeServices", "(", "new", "StubAuthorizationCodeServices", "(", "))", ";", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "b", "=", "&", "bar", "=", "f", "$", "\",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "?", "foo", "=", "b", "=", "&", "bar", "=", "f", "$", "\",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "Collections", ".", "singletonMap", "(", "OAuth2Utils", ".", "USER_OAUTH_APPROVAL", ",", "\"", "true", "\"", "),", "model", ",", "sessionStatus", ",", "principal", ")", ";", "String", "url", "=", "(", "(", "RedirectView", ")", "result", ")", ".", "getUrl", "(", ");", "@", "@", "-", "211", ",", "10", "+", "216", ",", "10", "@", "@", "public", "void", "testAuthorizationCodeWithTrickyQueryParams", "(", ")", "throws", "Exception", "{", "@", "Test", "public", "void", "testAuthorizationCodeWithTrickyEncodedQueryParams", "(", ")", "throws", "Exception", "{", "endpoint", ".", "setAuthorizationCodeServices", "(", "new", "StubAuthorizationCodeServices", "(", "))", ";", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "path", "?", "foo", "=", "b", "%", "20", "%", "3D", "&", "bar", "=", "f", "%", "20", "$", "\",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "path", "?", "foo", "=", "b", "%", "20", "%", "3D", "&", "bar", "=", "f", "%", "20", "$", "\",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "Collections", ".", "singletonMap", "(", "OAuth2Utils", ".", "USER_OAUTH_APPROVAL", ",", "\"", "true", "\"", "),", "model", ",", "sessionStatus", ",", "principal", ")", ";", "assertEquals", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "/", "path", "?", "foo", "=", "b", "%", "20", "%", "3D", "&", "bar", "=", "f", "%", "20", "$", "&", "code", "=", "thecode", "\"", ",", "(", "(", "RedirectView", ")", "result", ")", ".", "getUrl", "(", "))", ";", "@", "@", "-", "223", ",", "10", "+", "228", ",", "10", "@", "@", "public", "void", "testAuthorizationCodeWithTrickyEncodedQueryParams", "(", ")", "throws", "Exception", "@", "Test", "public", "void", "testAuthorizationCodeWithMoreTrickyEncodedQueryParams", "(", ")", "throws", "Exception", "{", "endpoint", ".", "setAuthorizationCodeServices", "(", "new", "StubAuthorizationCodeServices", "(", "))", ";", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", "?", "t", "=", "a", "%", "3Db", "%", "26ep", "%", "3Dtest", "%", "2540test", ".", "me", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", "?", "t", "=", "a", "%", "3Db", "%", "26ep", "%", "3Dtest", "%", "2540test", ".", "me", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "Collections", ".", "singletonMap", "(", "OAuth2Utils", ".", "USER_OAUTH_APPROVAL", ",", "\"", "true", "\"", "),", "model", ",", "sessionStatus", ",", "principal", ")", ";", "assertEquals", "(", "\"", "http", ":", "//", "anywhere", "?", "t", "=", "a", "%", "3Db", "%", "26ep", "%", "3Dtest", "%", "2540test", ".", "me", "&", "code", "=", "thecode", "\"", ",", "(", "(", "RedirectView", ")", "result", ")", ".", "getUrl", "(", "))", ";", "@", "@", "-", "508", ",", "15", "+", "513", ",", "17", "@", "@", "public", "void", "testApproveOrDeny", "(", ")", "throws", "Exception", "{", "request", ".", "setApproved", "(", "true", ")", ";", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "request", ")", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "assertTrue", "(", "\"", "Wrong", "view", ":", "\"", "+", "result", ",", "(", "(", "RedirectView", ")", "result", ")", ".", "getUrl", "(", ").", "startsWith", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", "))", ";", "}", "@", "Test", "public", "void", "testApprovalDenied", "(", ")", "throws", "Exception", "{", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ");", "AuthorizationRequest", "request", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "null", ",", "null", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "false", "\"", ");", "View", "result", "=", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "@", "@", "-", "541", ",", "7", "+", "548", ",", "7", "@", "@", "public", "void", "testRedirectUriOptionalForAuthorization", "(", ")", "throws", "Exception", "{", ".", "getRequestParameters", "(", "),", "sessionStatus", ",", "principal", ")", ";", "/", "/", "RedirectUri", "parameter", "should", "be", "null", "(", "SECOAUTH", "-", "333", ")", ",", "however", "the", "resolvedRedirectUri", "not", "AuthorizationRequest", "authorizationRequest", "=", "(", "AuthorizationRequest", ")", "result", ".", "getModelMap", "(", ").", "get", "(", "\"", "authorizationRequest", "\"", ");", "AUTHORIZATION_REQUEST_ATTR_NAME", ")", ";", "assertNull", "(", "authorizationRequest", ".", "getRequestParameters", "(", ").", "get", "(", "OAuth2Utils", ".", "REDIRECT_URI", ")", ");", "assertEquals", "(", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "authorizationRequest", ".", "getRedirectUri", "(", "))", ";", "}", "@", "@", "-", "556", ",", "9", "+", "563", ",", "107", "@", "@", "public", "void", "testApproveOrDenyWithOAuth2RequestWithoutRedirectUri", "(", ")", "throws", "Except", "request", ".", "setApproved", "(", "true", ")", ";", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "model", ".", "put", "(", "\"", "authorizationRequest", "\"", ",", "request", ")", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "request", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "request", ")", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedClientId", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setClientId", "(", "\"", "bar", "\"", ");", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedState", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setState", "(", "\"", "state", "-", "5678", "\"", ");", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedRedirectUri", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setRedirectUri", "(", "\"", "http", ":", "//", "somewhere", ".", "com", "\"", ");", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedResponseTypes", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setResponseTypes", "(", "Collections", ".", "singleton", "(", "\"", "implicit", "\"", "))", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedScope", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setScope", "(", "Arrays", ".", "asList", "(", "\"", "read", "\"", ",", "\"", "write", "\"", "))", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedApproved", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "authorizationRequest", ".", "setApproved", "(", "false", ")", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setApproved", "(", "true", ")", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedResourceIds", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setResourceIds", "(", "Collections", ".", "singleton", "(", "\"", "resource", "-", "other", "\"", "))", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "@", "Test", "(", "expected", "=", "InvalidRequestException", ".", "class", ")", "public", "void", "testApproveWithModifiedAuthorities", "(", ")", "throws", "Exception", "{", "AuthorizationRequest", "authorizationRequest", "=", "getAuthorizationRequest", "(", "\"", "foo", "\"", ",", "\"", "http", ":", "//", "anywhere", ".", "com", "\"", ",", "\"", "state", "-", "1234", "\"", ",", "\"", "read", "\"", ",", "Collections", ".", "singleton", "(", "\"", "code", "\"", "))", ";", "model", ".", "put", "(", "AUTHORIZATION_REQUEST_ATTR_NAME", ",", "authorizationRequest", ")", ";", "model", ".", "put", "(", "ORIGINAL_AUTHORIZATION_REQUEST_ATTR_NAME", ",", "endpoint", ".", "unmodifiableMap", "(", "authorizationRequest", ")", ");", "authorizationRequest", ".", "setAuthorities", "(", "AuthorityUtils", ".", "commaSeparatedStringToAuthorityList", "(", "\"", "authority", "-", "other", "\"", "))", ";", "/", "/", "Modify", "authorization", "request", "Map", "<", "String", ",", "String", ">", "approvalParameters", "=", "new", "HashMap", "<", "String", ",", "String", ">", "()", ";", "approvalParameters", ".", "put", "(", "\"", "user_oauth_approval", "\"", ",", "\"", "true", "\"", ");", "endpoint", ".", "approveOrDeny", "(", "approvalParameters", ",", "model", ",", "sessionStatus", ",", "principal", ")", ";", "}", "private", "class", "StubAuthorizationCodeServices", "implements", "AuthorizationCodeServices", "{"], "docstring_tokens": ["gain", "elevated", "privileges", "on", "the", "system"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "1226", ",", "7", "+", "1226", ",", "7", "@", "@", "int", "agp_generic_alloc_pages", "(", "struct", "agp_bridge_data", "*", "bridge", ",", "struct", "agp_memory", "*", "m", "int", "i", ",", "ret", "=", "-", "ENOMEM", ";", "for", "(", "i", "=", "0", ";", "i", "<", "num_pages", ";", "i", "+", "+)", "{", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", ")", ";", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", "|", "__GFP_ZERO", ")", ";", "/", "*", "agp_free_memory", "(", ")", "needs", "gart", "address", "*", "/", "if", "(", "page", "=", "=", "NULL", ")", "goto", "out", ";", "@", "@", "-", "1257", ",", "7", "+", "1257", ",", "7", "@", "@", "void", "*", "agp_generic_alloc_page", "(", "struct", "agp_bridge_data", "*", "bridge", ")", "{", "struct", "page", "*", "page", ";", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", ")", ";", "page", "=", "alloc_page", "(", "GFP_KERNEL", "|", "GFP_DMA32", "|", "__GFP_ZERO", ")", ";", "if", "(", "page", "=", "=", "NULL", ")", "return", "NULL", ";"], "docstring_tokens": ["obtain", "sensitive", "information"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "11", ",", "16", "+", "11", ",", "13", "@", "@", "function", "Extract", "(", "opts", ")", "{", "if", "(", "!(", "this", "instanceof", "Extract", ")", ")", "return", "new", "Extract", "(", "opts", ")", "tar", ".", "Parse", ".", "apply", "(", "this", ")", "/", "/", "have", "to", "dump", "into", "a", "directory", "opts", ".", "type", "=", "\"", "Directory", "\"", "opts", ".", "Directory", "=", "true", "if", "(", "typeof", "opts", "!", "==", "\"", "object", "\"", ")", "{", "opts", "=", "{", "path", ":", "opts", "}", "}", "/", "/", "better", "to", "drop", "in", "cwd", "?", "seems", "more", "standard", ".", "opts", ".", "path", "=", "opts", ".", "path", "|", "|", "path", ".", "resolve", "(", "\"", "node", "-", "tar", "-", "extract", "\"", ")", "/", "/", "have", "to", "dump", "into", "a", "directory", "opts", ".", "type", "=", "\"", "Directory", "\"", "opts", ".", "Directory", "=", "true", "@", "@", "-", "47", ",", "9", "+", "44", ",", "20", "@", "@", "function", "Extract", "(", "opts", ")", "{", "entry", ".", "linkpath", "=", "entry", ".", "props", ".", "linkpath", "=", "lp", "}", "}", "if", "(", "entry", ".", "type", "!", "==", "\"", "Link", "\"", ")", "return", "entry", ".", "linkpath", "=", "entry", ".", "props", ".", "linkpath", "=", "path", ".", "join", "(", "opts", ".", "path", ",", "path", ".", "join", "(", "\"/", "\",", "entry", ".", "props", ".", "linkpath", ")", ")", "if", "(", "entry", ".", "type", "=", "==", "\"", "Link", "\"", ")", "{", "entry", ".", "linkpath", "=", "entry", ".", "props", ".", "linkpath", "=", "path", ".", "join", "(", "opts", ".", "path", ",", "path", ".", "join", "(", "\"/", "\",", "entry", ".", "props", ".", "linkpath", ")", ")", "}", "if", "(", "entry", ".", "props", "&", "&", "entry", ".", "props", ".", "linkpath", ")", "{", "var", "linkpath", "=", "entry", ".", "props", ".", "linkpath", "/", "/", "normalize", "paths", "that", "point", "outside", "the", "extraction", "root", "if", "(", "path", ".", "resolve", "(", "opts", ".", "path", ",", "linkpath", ")", ".", "indexOf", "(", "opts", ".", "path", ")", "!", "==", "0", ")", "{", "entry", ".", "props", ".", "linkpath", "=", "path", ".", "join", "(", "opts", ".", "path", ",", "path", ".", "join", "(", "\"/", "\",", "linkpath", ")", ")", "}", "}", "}", ")", "this", ".", "_fst", ".", "on", "(", "\"", "ready", "\"", ",", "function", "(", ")", "{", "@", "@", "-", "0", ",", "0", "+", "1", ",", "141", "@", "@", "/", "/", "Set", "the", "umask", ",", "so", "that", "it", "works", "the", "same", "everywhere", ".", "process", ".", "umask", "(", "parseInt", "(", "'", "22", "'", ",", "8", ")", ")", "var", "fs", "=", "require", "(", "'", "fs", "'", ")", "var", "path", "=", "require", "(", "'", "path", "'", ")", "var", "fstream", "=", "require", "(", "'", "fstream", "'", ")", "var", "test", "=", "require", "(", "'", "tap", "'", ").", "test", "var", "tar", "=", "require", "(", "'.", "./", "tar", ".", "js", "'", ")", "var", "file", "=", "path", ".", "resolve", "(", "__dirname", ",", "'", "dir", "-", "normalization", ".", "tar", "'", ")", "var", "target", "=", "path", ".", "resolve", "(", "__dirname", ",", "'", "tmp", "/", "dir", "-", "normalization", "-", "test", "'", ")", "var", "ee", "=", "0", "var", "expectEntries", "=", "[", "{", "path", ":", "'", "fixtures", "/", "',", "mode", ":", "'", "755", "'", ",", "type", ":", "'", "5", "'", ",", "depth", ":", "undefined", ",", "size", ":", "0", ",", "linkpath", ":", "'", "',", "nlink", ":", "undefined", ",", "dev", ":", "undefined", ",", "ino", ":", "undefined", "}", ",", "{", "path", ":", "'", "fixtures", "/", "the", "-", "chumbler", "'", ",", "mode", ":", "'", "755", "'", ",", "type", ":", "'", "2", "'", ",", "depth", ":", "undefined", ",", "size", ":", "0", ",", "linkpath", ":", "path", ".", "resolve", "(", "target", ",", "'", "a", "/", "b", "/", "c", "/", "d", "/", "the", "-", "chumbler", "'", "),", "nlink", ":", "undefined", ",", "dev", ":", "undefined", ",", "ino", ":", "undefined", "}", "]", "var", "ef", "=", "0", "var", "expectFiles", "=", "[", "{", "path", ":", "'", "',", "mode", ":", "'", "40755", "'", ",", "type", ":", "'", "Directory", "'", ",", "depth", ":", "0", ",", "linkpath", ":", "undefined", "}", ",", "{", "path", ":", "'", "/", "fixtures", "'", ",", "mode", ":", "'", "40755", "'", ",", "type", ":", "'", "Directory", "'", ",", "depth", ":", "1", ",", "linkpath", ":", "undefined", "}", ",", "{", "path", ":", "'", "/", "fixtures", "/", "the", "-", "chumbler", "'", ",", "mode", ":", "'", "120755", "'", ",", "type", ":", "'", "SymbolicLink", "'", ",", "depth", ":", "2", ",", "size", ":", "95", ",", "linkpath", ":", "path", ".", "resolve", "(", "target", ",", "'", "a", "/", "b", "/", "c", "/", "d", "/", "the", "-", "chumbler", "'", "),", "nlink", ":", "1", "}", "]", "test", "(", "'", "preclean", "'", ",", "function", "(", "t", ")", "{", "require", "(", "'", "rimraf", "'", ").", "sync", "(", "path", ".", "join", "(", "__dirname", ",", "'", "/", "tmp", "/", "dir", "-", "normalization", "-", "test", "'", "))", "t", ".", "pass", "(", "'", "cleaned", "!", "')", "t", ".", "end", "(", ")", "}", ")", "test", "(", "'", "extract", "test", "'", ",", "function", "(", "t", ")", "{", "var", "extract", "=", "tar", ".", "Extract", "(", "target", ")", "var", "inp", "=", "fs", ".", "createReadStream", "(", "file", ")", "inp", ".", "pipe", "(", "extract", ")", "extract", ".", "on", "(", "'", "end", "'", ",", "function", "(", ")", "{", "t", ".", "equal", "(", "ee", ",", "expectEntries", ".", "length", ",", "'", "should", "see", "'", "+", "expectEntries", ".", "length", "+", "'", "entries", "'", ")", "/", "/", "should", "get", "no", "more", "entries", "after", "end", "extract", ".", "removeAllListeners", "(", "'", "entry", "'", ")", "extract", ".", "on", "(", "'", "entry", "'", ",", "function", "(", "e", ")", "{", "t", ".", "fail", "(", "'", "Should", "not", "get", "entries", "after", "end", "!", "')", "}", ")", "next", "(", ")", "}", ")", "extract", ".", "on", "(", "'", "entry", "'", ",", "function", "(", "entry", ")", "{", "var", "found", "=", "{", "path", ":", "entry", ".", "path", ",", "mode", ":", "entry", ".", "props", ".", "mode", ".", "toString", "(", "8", ")", ",", "type", ":", "entry", ".", "props", ".", "type", ",", "depth", ":", "entry", ".", "props", ".", "depth", ",", "size", ":", "entry", ".", "props", ".", "size", ",", "linkpath", ":", "entry", ".", "props", ".", "linkpath", ",", "nlink", ":", "entry", ".", "props", ".", "nlink", ",", "dev", ":", "entry", ".", "props", ".", "dev", ",", "ino", ":", "entry", ".", "props", ".", "ino", "}", "var", "wanted", "=", "expectEntries", "[", "ee", "+", "+]", "t", ".", "equivalent", "(", "found", ",", "wanted", ",", "'", "tar", "entry", "'", "+", "ee", "+", "'", "'", "+", "wanted", ".", "path", ")", "}", ")", "function", "next", "(", ")", "{", "var", "r", "=", "fstream", ".", "Reader", "(", "{", "path", ":", "target", ",", "type", ":", "'", "Directory", "'", ",", "sort", ":", "'", "alpha", "'", "}", ")", "r", ".", "on", "(", "'", "ready", "'", ",", "function", "(", ")", "{", "foundEntry", "(", "r", ")", "}", ")", "r", ".", "on", "(", "'", "end", "'", ",", "finish", ")", "function", "foundEntry", "(", "entry", ")", "{", "var", "p", "=", "entry", ".", "path", ".", "substr", "(", "target", ".", "length", ")", "var", "found", "=", "{", "path", ":", "p", ",", "mode", ":", "entry", ".", "props", ".", "mode", ".", "toString", "(", "8", ")", ",", "type", ":", "entry", ".", "props", ".", "type", ",", "depth", ":", "entry", ".", "props", ".", "depth", ",", "size", ":", "entry", ".", "props", ".", "size", ",", "linkpath", ":", "entry", ".", "props", ".", "linkpath", ",", "nlink", ":", "entry", ".", "props", ".", "nlink", "}", "var", "wanted", "=", "expectFiles", "[", "ef", "+", "+]", "t", ".", "has", "(", "found", ",", "wanted", ",", "'", "unpacked", "file", "'", "+", "ef", "+", "'", "'", "+", "wanted", ".", "path", ")", "entry", ".", "on", "(", "'", "entry", "'", ",", "foundEntry", ")", "}", "function", "finish", "(", ")", "{", "t", ".", "equal", "(", "ef", ",", "expectFiles", ".", "length", ",", "'", "should", "have", "'", "+", "ef", "+", "'", "items", "'", ")", "t", ".", "end", "(", ")", "}", "}", "}", ")"], "docstring_tokens": ["overwrite", "arbitrary", "files", "on", "the", "system", "with", "elevated", "privileges"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "57", ",", "30", "+", "57", ",", "17", "@", "@", "int", "rds_page_copy_user", "(", "struct", "page", "*", "page", ",", "unsigned", "long", "offset", ",", "unsigned", "long", "ret", ";", "void", "*", "addr", ";", "if", "(", "to_user", ")", "addr", "=", "kmap", "(", "page", ")", ";", "if", "(", "to_user", ")", "{", "rds_stats_add", "(", "s_copy_to_user", ",", "bytes", ")", ";", "else", "ret", "=", "copy_to_user", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "}", "else", "{", "rds_stats_add", "(", "s_copy_from_user", ",", "bytes", ")", ";", "addr", "=", "kmap_atomic", "(", "page", ",", "KM_USER0", ")", ";", "if", "(", "to_user", ")", "ret", "=", "__copy_to_user_inatomic", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "else", "ret", "=", "__copy_from_user_inatomic", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "kunmap_atomic", "(", "addr", ",", "KM_USER0", ")", ";", "if", "(", "ret", ")", "{", "addr", "=", "kmap", "(", "page", ")", ";", "if", "(", "to_user", ")", "ret", "=", "copy_to_user", "(", "ptr", ",", "addr", "+", "offset", ",", "bytes", ")", ";", "else", "ret", "=", "copy_from_user", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "kunmap", "(", "page", ")", ";", "if", "(", "ret", ")", "return", "-", "EFAULT", ";", "ret", "=", "copy_from_user", "(", "addr", "+", "offset", ",", "ptr", ",", "bytes", ")", ";", "}", "kunmap", "(", "page", ")", ";", "return", "0", ";", "return", "ret", "?", "-", "EFAULT", ":", "0", ";", "}", "EXPORT_SYMBOL_GPL", "(", "rds_page_copy_user", ")", ";"], "docstring_tokens": ["which", "can", "easily", "be", "used", "to", "escalate", "privileges", "to", "root"]}
{"contents": ["empty"], "code_tokens": ["@", "@", "-", "785", ",", "6", "+", "785", ",", "8", "@", "@", "xfs_ioc_fsgetxattr", "(", "{", "struct", "fsxattr", "fa", ";", "memset", "(", "&", "fa", ",", "0", ",", "sizeof", "(", "struct", "fsxattr", ")", ");", "xfs_ilock", "(", "ip", ",", "XFS_ILOCK_SHARED", ")", ";", "fa", ".", "fsx_xflags", "=", "xfs_ip2xflags", "(", "ip", ")", ";", "fa", ".", "fsx_extsize", "=", "ip", "-", ">", "i_d", ".", "di_extsize", "<", "<", "ip", "-", ">", "i_mount", "-", ">", "m_sb", ".", "sb_blocklog", ";"], "docstring_tokens": ["obtain", "potentially", "sensitive", "information", "from", "kernel", "stack", "memory"]}
